/*2.0.0.0*/ (function (n, t) { function i(i) { function h() { u.on("click", function () { s ? i.height() == 0 ? (i.height(r.gTab.getHeaderHeight()), f.show(), u.removeClass("fa-angle-double-down").addClass("fa-angle-double-up").removeClass("vis-ad-w-p-header-v")) : (i.height(0), f.hide(), u.removeClass("fa-angle-double-up").addClass("fa-angle-double-down").addClass("vis-ad-w-p-header-v")) : i.width() == 0 ? (i.width(r.gTab.getHeaderWidth()), f.show(), u.removeClass("fa-angle-double-right").addClass("fa-angle-double-left").removeClass("vis-ad-w-p-header-h")) : (i.width(0), f.hide(), u.removeClass("fa-angle-double-left").addClass("fa-angle-double-right").addClass("vis-ad-w-p-header-h")); r.sizeChangedListner && r.sizeChangedListner.onSizeChanged && r.sizeChangedListner.onSizeChanged() }) } var f = null, s = !1, r, u, e, o; this.headerItems = null; r = this; this.gTab = null; this.controls = []; this.textAlignEnum = { C: "Center", R: "flex-end", L: "flex-start" }; this.alignItemEnum = { C: "Center", T: "flex-start", B: "flex-end" }; this.windowNo = 0; this.dynamicStyle = []; this.styleTag = document.createElement("style"); u = i.find(".fa-angle-double-left"); i.css("flex-direction", "column"); u.parent().css("display", "flex"); this.setHeaderLayout = function (n, u) { if (n.getIsHeaderPanel() && (r.headerItems = n.getHeaderPanelItems(), r.gTab = n, r.windowNo = r.gTab.getWindowNo(), r.headerItems)) { f = t('<div class="vis-ad-w-p-header_root_common">'); var e = this.headerParentCustomUISettings(u); i.addClass(e) } }; this.setHeaderItems = function (i, u) { var b, v, h, f, g, nt, ht, ct, rt, ut, a, p; if (r.controls && r.controls.length > 0 && !i && !u) { for (h = 0; h < r.controls.length; h++)if (b = r.controls[h], b) { var k = b.control, f = b.field, c = k.control; if (c == null && !f.getIsHeading()) continue; p = o(f); e(p, c, f) } } else { if (!i) return; for (v = r.gTab.gridTable.gridFields, v = t.grep(v, function (n) { if (n.getIsHeaderPanelitem()) return n }), v = v.sort(function (n, t) { return n.getHeaderSeqno() - t.getHeaderSeqno() }), h = 0; h < v.length; h++)if (f = v[h], f.getIsHeaderPanelitem()) { var k = {}, d = f.getHeaderSeqno(), s = i.HeaderItems[d]; if (!s || s.length <= 0) continue; var ft = s.StartColumn, lt = s.ColumnSpan, et = s.StartRow, at = s.RowSpan, ot = s.JustifyItems, st = s.AlignItems, vt = s.Padding, tt = s.BackgroundColor; tt || (tt = ""); g = s.FontColor; g || (g = ""); nt = s.FontSize; nt || (nt = ""); var y = null, w = null, l = null, it = null, c = null, yt = this.applyCustomUISettings(d, ft, lt, et, at, ot, st, tt, g, nt, vt); if (y = t('<div class="vis-w-p-header-data-f ' + yt + '">'), w = t('<div class="vis-w-p-header-icon-f"><\/div>'), l = t('<div class="vis-w-p-header-Label-f"><\/div>'), f.getDisplayType() == n.DisplayType.Image && (l.addClass("vis-w-p-header-Label-center-f"), ht = this.justifyAlignImageItems(d, ot, st), l.addClass(ht)), it = n.VControlFactory.getHeaderLabel(f, !0), c = n.VControlFactory.getReadOnlyControl(r.gTab, f, !1, !1, !1), ct = this.applyCustomUIForFieldValue(d, ft, et, f), c.getControl().addClass(ct), k.control = c, r.controls.push({ control: k, field: f }), rt = t("<span><\/span>"), ut = n.VControlFactory.getIcon(f), c == null) continue; a = null; it && (a = it.getControl().addClass("vis-w-p-header-data-label")); p = o(f); e(p, c, f); f.getHeaderIconOnly() || f.getHeaderHeadingOnly() ? f.getHeaderIconOnly() && f.getHeaderHeadingOnly() ? y.append(l) : f.getHeaderIconOnly() ? (y.append(w), w.append(rt.append(ut))) : f.getHeaderHeadingOnly() && a && a.length > 0 && l.append(a) : (y.append(w), w.append(rt.append(ut)), a && a.length > 0 && l.append(a)); l.append(c.getControl()); y.append(l); u.append(y) } } }; e = function (t, i, r) { if (t) { if (t.startsWith && t.startsWith("<") && t.endsWith(">") && (t = t.replace("<", "").replace(">", "")), r.getDisplayType() == n.DisplayType.Image) { var u = i.getValue(); i.getControl().show(); u == t && i.refreshImage(t) } i.setValue(w2utils.encodeTags(t)) } else r.getDisplayType() == n.DisplayType.Image ? (i.getControl().hide(), i.setValue(null)) : i.setValue("- -", !0) }; o = function (t) { var i = t.getValue(), r, u; return i ? (r = t.getDisplayType(), t.lookup ? i = t.lookup.getDisplay(i, !0) : n.DisplayType.IsDate(r) ? i = r == n.DisplayType.DateTime ? new Date(i).toLocaleString() : r == n.DisplayType.Date ? new Date(i).toLocaleDateString() : new Date(i).toLocaleTimeString() : r == n.DisplayType.YesNo ? (u = i.toString(), t.getIsEncryptedColumn() && (u = n.secureEngine.decrypt(u)), i = u.equals("true")) : i = i.toString(), t.getIsEncryptedField() && i && i.length > 0 && (i = i.replace(/[a-zA-Z0-9-. ]/g, "*").replace(/[^a-zA-Z0-9-. ]/g, "*"))) : i = null, i }; this.getRoot = function () { return f }; this.getParent = function () { return i }; this.alignHorzontal = function () { s = !0; i.removeClass("vis-ad-w-p-header-l").addClass("vis-ad-w-p-header-t"); u.removeClass("fa-angle-double-left").addClass("fa-angle-double-up"); u.parent().css("background-color", "transparent"); i.css("flex-direction", "row") }; h(); this.disposeComponent = function () { u.remove(); u = null; this.styleTag.remove(); this.styleTag = null; this.headerItems = null; r = null; this.gTab = null; this.controls = null; f.remove(); f = null; i.remove(); i = null } } i.prototype.init = function (n) { var r = n.getHeaderBackColor(), f, c, o; this.setHeaderLayout(n, r); var e = this.getRoot(), l = this.getParent(), s = "vis-w-p-Header-Root-v", h = this.gTab.getHeaderHorizontal(), a = this.gTab.getHeaderHeight(), v = this.gTab.getHeaderWidth(), u = this.gTab.getHeaderPadding(), y = this.headerUISettings(h, a, v, "", u); if (e.addClass(y), h && (this.alignHorzontal(), s = "vis-w-p-Header-Root-h"), this.headerItems && !(this.headerItems.length <= 0)) { for (f = 0; f < this.headerItems.length; f++) { var i = this.headerItems[f], p = i.HeaderTotalRow, w = i.HeaderTotalColumn, r = i.HeaderBackColor, u = i.HeaderPadding; (r || (r = ""), u || (u = ""), c = this.fieldGroupContainerUISettings(w, p, r, u, f), o = t('<div class="' + s + " " + c + '">'), e.append(o), !i || !i.HeaderItems || i.HeaderItems.length <= 0) || this.setHeaderItems(i, o) } this.addStyleToDom(); l.append(e) } }; i.prototype.addSizeChangeListner = function (n) { this.sizeChangedListner = n }; i.prototype.fieldGroupContainerUISettings = function (n, t, i, r, u) { var f = "vis-ad-w-p-fg_container_" + t + "_" + n + "_" + this.windowNo + "_" + u; return this.dynamicStyle.push(" ." + f + " {"), this.dynamicStyle.push("grid-template-columns:repeat(" + n + ", 1fr);grid-template-rows:repeat(" + t + ", auto);padding:" + r + ";" + i), this.dynamicStyle.push("} "), f }; i.prototype.addStyleToDom = function () { this.styleTag.type = "text/css"; this.styleTag.innerHTML = this.dynamicStyle.join(" "); t(t("head")[0]).append(this.styleTag) }; i.prototype.headerUISettings = function (n, t, i, r, u) { var f = "vis-ad-w-p-header_root_" + this.windowNo; return this.dynamicStyle.push(" ." + f + " {display:flex;overflow:auto;"), n ? this.dynamicStyle.push("flex:1;flex-direction:row;height: " + t + "; ") : this.dynamicStyle.push("flex-direction:column;width: " + i + ";height:calc(100vh - 93px); "), this.dynamicStyle.push("padding:" + u + ";" + r), this.dynamicStyle.push("} "), f }; i.prototype.headerParentCustomUISettings = function (n) { var t = "vis-ad-w-p-header_Custom_" + this.windowNo; return this.dynamicStyle.push(" ." + t + " {flex:1;"), this.dynamicStyle.push("background: rgba(var(--v-c-primary));"), this.dynamicStyle.push(n), this.dynamicStyle.push("} "), t }; i.prototype.applyCustomUISettings = function (n, t, i, r, u, f, e, o, s, h, c) { var l = "vis-hp-FieldGroup_" + r + "_" + t + "_" + this.windowNo + "_" + n; return this.dynamicStyle.push("." + l + "  {grid-column:" + t + " / span " + i + "; grid-row: " + r + " / span " + u + ";"), this.dynamicStyle.push("justify-content:" + this.textAlignEnum[f] + ";align-items:" + this.alignItemEnum[e]), this.dynamicStyle.push(";font-size:" + h + ";color:" + s + ";padding:" + c + ";"), this.dynamicStyle.push(o), this.dynamicStyle.push("} "), l }; i.prototype.applyCustomUIForFieldValue = function (n, t, i, r) { var u = "vis-hp-FieldValue_" + i + "_" + t + "_" + this.windowNo + "_" + n; return this.dynamicStyle.push("." + u + "  {" + r.getHeaderStyle()), this.dynamicStyle.push("} "), u }; i.prototype.justifyAlignImageItems = function (n, t, i) { var r = "vis-w-p-header-label-center-justify_" + n + "_" + this.windowNo; return this.dynamicStyle.push(" ." + r + " {justify-content:" + this.textAlignEnum[t] + ";align-items:" + this.alignItemEnum[i] + "}"), r }; i.prototype.navigate = function () { this.setHeaderItems() }; i.prototype.dispose = function () { this.disposeComponent() }; n.HeaderPanel = i })(VIS, jQuery), function (n, t) { function i(n, i) { function s(t) { e && e.removeClass("vis-ad-w-p-ap-tp-o-li-selected"); e = null; c.empty(); t ? (e = t.addClass("vis-ad-w-p-ap-tp-o-li-selected"), a.text(t.data("name")), f.setCurrentPanel(t.data("cname"), n)) : f.setCurrentPanel(null); f.curTabPanel ? (c.append(f.curTabPanel.getRoot()), f.setSize(i)) : f.setSize(35) } var f, e; this.tabPanels = []; var l = document.importNode(r, !0), u = t(l.querySelector(".vis-ad-w-p-ap-tp-outerwrap")), o = u.find(".vis-ad-w-p-ap-tp-o-icorbar ul"), h = u.find(".vis-ad-w-p-ap-tp-o-b-head"), a = u.find(".vis-ad-w-p-ap-tp-o-b-head h6"), v = u.find(".vis-ad-w-p-ap-tp-o-b-head span"), c = u.find(".vis-ad-w-p-ap-tp-o-b-content"); this.isClosed = !0; i <= 50 ? i = i <= 0 ? 75 : 50 : i > 75 && (i = 75); i = 100 - i; i = t(document).width() * i / 100; f = this; e = null; o.on("click", "LI", function (n) { s(t(n.currentTarget)) }); v.on("click", function () { s(null) }); this.getRoot = function () { return u }; this.setPanelList = function (n, i) { o.append(n); s(t(o.find('li[data-panelid="' + i + '"]'))) }; this.setSize = function (n) { if ((this.isClosed || !n || !(n > 40)) && (n && n > 40 ? (u.css("height", n + "px"), u.css("width", n + "px"), this.isClosed = !1, h.show()) : (u.css("height", "35px"), u.css("width", "35px"), this.isClosed = !0, h.hide()), this.sizeChangedListner && this.sizeChangedListner.onSizeChanged)) this.sizeChangedListner.onSizeChanged(n && n > 40) }; this.disposeComponent = function () { u.remove(); e = null; f = null } } var r = document.querySelector("#vis-ad-tabpnltmp").content; i.prototype.init = function (t) { var i, e, u, r, f; if (this.gTab = t, i = this.gTab.getTabPanels(), e = 0, i && i.length > 0) for (u = [], e = i[0].getAD_TabPanel_ID(), r = 0; r < i.length; r++)f = "", f = i[r].getIconPath() ? i[r].getIconPath() : "fa fa-object-group", u.push('<li default="' + i[r].getIsDefault() + '" data-panelid="' + i[r].getAD_TabPanel_ID() + '" data-cname="' + i[r].getClassName() + '" data-name="' + i[r].getName() + '">'), f.indexOf(".") > -1 ? u.push('<img alt = "' + i[r].getName() + '" title = "' + i[r].getName() + '"  src = "' + n.Application.contextUrl + "Areas/" + f + '" onerror=this.src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/defpanel.ico"><\/img >') : u.push('<span> <i title = "' + i[r].getName() + '" class="' + f + '" ><\/i><\/span>'), u.push("<\/li>"), i[r].getIsDefault() && (e = i[r].getAD_TabPanel_ID()); this.setPanelList(u.join(" "), e) }; i.prototype.addSizeChangeListner = function (n) { this.sizeChangedListner = n }; i.prototype.setCurrentPanel = function (t, i) { var u, r; this.curTabPanel && (this.curTabPanel.dispose && this.curTabPanel.dispose(), this.curTabPanel = null); t && (u = n.Utility.getFunctionByName(t, window), u && (r = new u, r.startPanel(i, this.gTab), this.gTab.getRecord_ID() > -1 && r.refreshPanelData(this.gTab.getRecord_ID(), this.gTab.getTableModel().getRow(this.gTab.getCurrentRow())), this.curTabPanel = r)) }; i.prototype.refreshPanelData = function (n, t) { this.curTabPanel && this.curTabPanel.refreshPanelData(n, t) }; i.prototype.dispose = function () { this.disposeComponent(); this.sizeChnagedListner = null; this.gTab = null; this.curTabPanel && (this.curTabPanel.dispose(), this.curTabPanel = null) }; n.VTabPanel = i }(VIS, jQuery), function (n, t) { function e(n, i, r) { var u = null; return t.ajax({ url: h, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function y(i, r, u) { var f = null; return i.sql = n.secureEngine.encrypt(i.sql), t.ajax({ url: l, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: r, data: JSON.stringify(i) }).done(function (n) { f = n; u && u(n) }), f } function i() { function h() { var n = document.importNode(p, !0); i = t(n.querySelector(".vis-ad-w")); u = i.find(".vis-ad-w-body"); e = i.find("h5"); r = i.find(".vis-ad-w-close"); o = i.find(".vis-ad-w-toolbar"); f = i.find(".vis-ad-w-header") } var f, i, u, e, r, o, s; this.name; this.windowNo; this.id; this.img = null; this.cPanel; this.isHeaderVisible = !0; this.onClosed; this.title = "window"; f = null; o = null; this.onLoad = null; h(); this.setTitle = function (n) { this.title = n; e.text(this.title) }; this.setSize = function () { return }; this.hideHeader = function (n) { this.isHeaderVisible = !n; n ? f.hide() : f.show(); this.sizeChanged() }; this.hideCloseIcon = function (n) { n ? r.hide() : r.show() }; this.getRootLayout = function () { return i }; this.getContentGrid = function () { return u }; this.setToolbar = function (n) { o.append(n) }; s = this; r.on(n.Events.onTouchStartOrClick, function (n) { n.preventDefault(); n.stopPropagation(); s.dispose() }); this.disposeComponent = function () { s = null; r && r.off(n.Events.onTouchStartOrClick); r = null; i && i.remove(); u && u.remove(); i = u = e = r = null; this.setTitle = null; this.name = null; this.windowNo = null; this.id = null; this.setTitle = null; this.setName = null; this.getRootLayout = null; this.getContentGrid = null; this.onLoad = null } } function r(i) { var u, f, r; i && (this.action, this.toggle, this.enableDisable, this.pressed, this.isEnabled = !0, this.text, this.toolTipText, this.imageOnly, this.textOnly, this.onAction = null, this.isSmall, this.iconName = "", this.direction = "right", t.extend(!0, this, i), this.items = {}, this.$li, this.text || (this.text = n.I18N.getLabel(this.action), this.text.contains("&") && (this.text = this.text.replace("&", "")), this.toolTipText = this.toolTipText ? this.text + n.Msg.getMsg(this.toolTipText) : this.text, this.toolTipText.contains("&") && (this.toolTipText = this.text + this.toolTipText.replace("&", ""))), u = "", f = "", this.isSmall ? (u = this.iconName != "" ? this.iconName.toLowerCase() : this.action.toLowerCase(), (this.toggle || this.enableDisable) && (f = u + "x")) : (u = this.iconName != "" ? this.iconName.toLowerCase() : this.action.toLowerCase(), (this.toggle || this.enableDisable) && (f = u + "x")), this.imgUrl = "vis-" + u, this.imgUrlX = "vis-" + f); r = this; this.getListItm = function (i) { var u = t("<li>"), f = t("<div><\/div>"), e = !0; u.on(n.Events.onClick, function (n) { n.stopPropagation(); e && r.onAction && r.isEnabled && (r.toggle && r.setPressed(!r.pressed), e = !1, f.css("background-color", "red"), setTimeout(function () { f.css("background-color", "transparent"); r.onAction(r.action); e = !0 }, 10)) }); return this.textOnly ? u.append(t("<h5>").text(this.text)) : this.imageOnly ? (this.img = t('<i class="vis ' + this.imgUrl + '" title = "' + this.toolTipText + '"})>'), u.append(f), f.append(this.img)) : (this.direction == "r" ? u.append("<span>" + this.text + '<\/span> <i class="vis ' + this.imgUrl + '" title="' + this.toolTipText + '" ><\/i>') : u.append('<i class="vis ' + this.imgUrl + '" title="' + this.toolTipText + '"><\/i><span>' + this.text + "<\/span>"), this.img = u.find("i")), this.$li = u, u.popover, i && (this.items[i] = u), this.$li }; this.getListItmIT = function (i) { if (this.$li) return this.$li; var u = t("<li>"), f = t("<div><\/div>"), e = !0; u.on(n.Events.onClick, function (n) { n.stopPropagation(); e && r.onAction && r.isEnabled && (r.toggle && r.setPressed(!r.pressed), e = !1, f.css("background-color", "red"), setTimeout(function () { f.css("background-color", "transparent"); r.onAction(r.action); e = !0 }, 10)) }); return this.textOnly ? u.text(this.text) : this.imageOnly ? (this.img = t('<i class="vis ' + this.imgUrl + '" title = "' + this.toolTipText + '"})>'), u.append(f), f.append(this.img)) : (this.direction == "r" ? u.append("<span>" + this.text + '<\/span> <i class="vis ' + this.imgUrl + '" title="' + this.toolTipText + '" ><\/i>') : u.append('<i class="vis ' + this.imgUrl + '" title="' + this.toolTipText + '" ><\/i><span>' + this.text + "<\/span>"), this.img = u.find("i")), this.$li = u, i && (this.items[i] = u), this.$li }; this.disposeComponent = function () { r = null; this.getListItm = null; this.getListItmIT = null } } function u(i) { var l = document.importNode(o, !0), u = t(l.querySelector(".vis-ad-w-p-s-main")), h, c, f; this.$statusLine = u.find(".vis-ad-w-p-s-msg").find("span"); this.$statusDB = u.find(".vis-ad-w-p-s-statusdb"); this.$infoLine = u.find(".vis-ad-w-p-s-infoline"); var s = u.find(".vis-ad-w-p-s-result").find("span"), r = t("<select class='vis-statusbar-combo'>"), e = u.find(".vis-ad-w-p-s-plst"); this.text = ""; this.dse; this.merror; this.mtext; h = n.Msg.getMsg("ShowingResult"); c = n.Msg.getMsg("of"); this.onComboChange; i || this.$infoLine.hide(); this.getRoot = function () { return u }; this.render = function () { }; this.setPageItem = function (n) { e.append(n) }; this.setComboPage = function () { e.append(t("<li>").append(r)) }; this.setPageLine = function (n) { var v, f, y, t; if (n != null) { var i = n.getCurrentPage(), e = n.getTotalPage(), o = n.getPageSize(), l = n.getTotalRecords(), a = (i - 1) * o, u = a + o; if (u > l && (u = l), v = h + " " + (a + 1) + "-" + u + " " + c + " " + n.getTotalRecords(), s.text(v), e != r[0].options.length) { for (f = [], y = -1, t = 0; t < e; t++)f[t] = "<option>" + (t + 1) + "<\/option>"; r.empty(); r.html(f.join("")) } r[0].selectedIndex != i - 1 && (r[0].selectedIndex = i - 1) } }; this.setComboCallback = function (n) { selectionCallback = n }; f = this; r.on("change", function (n) { if (n.stopPropagation(), f.onComboChange) f.onComboChange(this.selectedIndex) }); this.$statusDB.on("click", function () { var t = n.Msg.getMsg("Who") + f.text, i = new n.RecordInfo(t, f.dse); i.show() }); this.disposeComponent = function () { f = null; u.remove(); r1Col1 = null; r2Col1 = null; u = null; this.getRoot = null; this.onComboChange = null; e.remove(); e = null; s = null; this.$statusLine = null; this.$statusDB = null; $seprator = null; this.disposeComponent = null; this.setPageItem = null; this.getRoot = null; this.render = null; this.setPageLine = null; this.$infoLine = null; this.text = null; this.dse = null; this.merror = null; this.mtext = null; r.empty(); r.remove(); r = null } } var s = 0, w = n.Logging.Level, f = n.Application.contextUrl, h = f + "JsonData/JDataSetWithCode", c = f + "JsonData/ExecuteNonQuer", l = f + "Form/JDataSet", a = function (t, i, r) { var o = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, e(f, o, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, b = function (t, i, r) { var o = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, e(f, o, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, k = function (t, i, r) { var f = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u; return i && (o.param = i), u = null, e(o, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, d = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n.join("/"), param: i }; return t.ajax({ url: c + "ies", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }, v = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, y(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, p = document.querySelector("#vis-ad-windowtmp").content, o; i.prototype.setName = function (n) { this.name = n }; i.prototype.getName = function () { return this.name }; i.prototype.sizeChanged = function (t, i) { t || (t = n.Env.getScreenHeight()); i || (i = window.innerWidth); var r = this.isHeaderVisible ? 85 : 43; try { this.cPanel.sizeChanged(t - r, i) } catch (u) { console.log("size changed error") } }; i.prototype.refresh = function () { return this.cPanel.refresh(), this }; i.prototype.keyDown = function (n) { return this.cPanel.keyDown && this.cPanel.keyDown(n), this }; i.prototype.navigateThroghtShortcut = function (n) { var i = t(document.activeElement), r; return i && i.length > 0 ? (i.trigger("change"), r = this, window.setTimeout(function () { r.cPanel.navigateThroghtShortcut && r.cPanel.navigateThroghtShortcut(n) }, 200)) : this.cPanel.navigateThroghtShortcut && this.cPanel.navigateThroghtShortcut(n), this }; i.prototype.initWindow = function (i, r, u, f, e) { var s, o; return this.cPanel = new n.APanel, this.getContentGrid().css("display", "flex"), s = n.Env.getWindowNo(), this.id = s + "_" + i, this.hid = f + "=" + i, o = this, this.hideHeader(!0), n.AEnv.getGridWindow(s, i, function (i) { var c, f, h; if (i.error != null) { n.ADialog.error(i.error); o.dispose(); o = null; return } c = t.parseJSON(i.result); n.context.setContextOfWindow(t.parseJSON(i.wCtx), s); o.cPanel.initPanel(c, r, o, !1, e); o.sizeChanged(); o.cPanel.createSearchAutoComplete(); o.cPanel.selectFirstTab(r != null); n.MLookupCache.initWindowLookup(s); f = o.cPanel.gridWindow; h = null; h = f.getFontName() != "" ? f.getFontName() : f.getImageUrl() != "" ? n.Application.contextUrl + "Images/Thumb16x16/" + f.getImageUrl() : "fa fa-window-maximize"; o.img = h; u && u(o.id, h, o.name, o.hid); o.onLoad && o.onLoad(); c = null; o = null }), this.AD_Window_ID = i, this.windowNo = s, this.getRootLayout().id = this.id, this.getRootLayout().attr("id", "AS_" + this.id), this.getContentGrid().append(this.cPanel.getRoot()), !0 }; i.prototype.setCFrameContent = function (n, t) { this.cPanel = n; this.windowNo = t; this.id = this.windowNo + "_CFrame"; this.getRootLayout().id = this.id; this.getRootLayout().attr("id", "AS_" + this.id); this.getContentGrid().append(this.cPanel.getRoot()) }; i.prototype.initForm = function (i, r, u) { var e, f; return this.cPanel = new n.AForm(n.Env.getScreenHeight() - 85), e = n.Env.getWindowNo(), this.id = e + "_" + i, this.hid = u + "=" + i, f = this, n.dataContext.getFormDataString({ AD_Form_ID: i }, function (i) { var u, o; if (i.error != null) { n.ADialog.error(i.error); f.dispose(); f = null; return } if (u = t.parseJSON(i.result), u.IsError) { n.ADialog.error(u.Message); f.dispose(); f = null; return } if (f.setTitle(u.DisplayName), f.setName(u.DisplayName), !f.cPanel.openForm(u, f, e)) { f.dispose(); f = null; return } f.sizeChanged(); o = "fa fa-list-alt"; f.img = o; r && r(f.id, o, f.name, f.hid); u = null; f = null }), this.windowNo = e, this.getRootLayout().id = this.id, this.getRootLayout().attr("id", "AS_" + this.id), this.getContentGrid().append(this.cPanel.getRoot()), !0 }; i.prototype.initProcess = function (i, r, u, f, e) { var h, o; return this.cPanel = new n.AProcess(i, n.Env.getScreenHeight() - s, f, e), h = n.Env.getWindowNo(), this.id = h + "_" + i, this.hid = u + "=" + i, o = this, this.hideHeader(!0), n.dataContext.getProcessDataString({ AD_Process_ID: i }, function (f) { var e, s; if (f.error != null) { n.ADialog.error(f.error); o.dispose(); o = null; return } if (e = t.parseJSON(f.result), e.IsError) { n.ADialog.error(e.Message); o.dispose(); o = null; return } if (o.setTitle(""), o.setName(e.Name), e.AD_Process_ID = i, !o.cPanel.init(e, o, h)) { o.dispose(); o = null; return } o.sizeChanged(); s = null; s = e.FontName != "" ? e.FontName : e.ImageUrl != "" ? n.Application.contextUrl + "Images/Thumb16x16/" + e.ImageUrl : u == "P" ? "fa fa-cog" : "vis vis-report"; o.img = s; r && r(o.id, s, o.name, o.hid); e = null; o = null }), this.windowNo = h, this.getRootLayout().id = this.id, this.getRootLayout().attr("id", "AS_" + this.id), this.getContentGrid().append(this.cPanel.getRoot()), !0 }; i.prototype.refreshProcess = function (n, t, i, r, u) { return this.cPanel && (this.cPanel.disposeComponent(), this.cPanel = null), r = !0, this.initProcess(n, t, i, r, u), u.disposeComponent && (u.getParameterContainer().empty().append(this.cPanel.getParametersContainer()), this.cPanel.getContentTable().css("height", u.getContentContainer().height()), u.getContentContainer().empty().append(this.cPanel.getContentTable()).append(this.cPanel.getBusyIndicator()).css("position", "relative"), u.getToolbarContainer().empty().append(this.cPanel.getToolbar())), this.cPanel }; i.prototype.getProcessPanel = function () { return this.cPanel }; i.prototype.getTitile = function () { return this.title }; i.prototype.getAD_Window_ID = function () { return this.AD_Window_ID }; i.prototype.show = function (n, t) { return n.append(this.getRootLayout()), t && t(this.id, null, this.name, this.hid), !0 }; i.prototype.refreshData = function () { this.cPanel.refreshData() }; i.prototype.getId = function () { return this.id }; i.prototype.getWindowNo = function () { return this.windowNo }; i.prototype.dispose = function () { if (!this.onClosed || this.onClosed(this.id, this.$layout, this.hid, this.AD_Window_ID)) return this.onClosed = null, this.cPanel && this.cPanel.dispose(), this.cPanel = null, this.children = null, this.disposeComponent(), !0 }; n.VTabbedPane = function () { var n = !1; this.oldTabIndex = -1; this.Items = []; this.ItemsIds = []; this.count = 0; this.dependents = []; this.TabItems = []; this.getIsWorkbench = function () { return n } }; n.VTabbedPane.prototype.setTabObject = function (n) { this.tabObj = n }; n.VTabbedPane.prototype.addTab = function (n, t, i, r) { var f, u, e; for (this.ItemsIds[this.count] = n, this.Items[this.count] = i, this.TabItems.push(r), f = t.getDependentOn(), u = 0; u < f.length; u++)e = f[u], this.dependents.indexOf(e) < 0 && this.dependents.push(e); this.count++ }; n.VTabbedPane.prototype.getIsTabChanged = function (t) { var u = this.ItemsIds.indexOf(t), f = this.oldTabIndex, r, h, i, e, s, o; if (u === f) return console.log("same tab"), !1; if (i = this.Items[u], r = null, i instanceof n.GridController && (r = i, h = r.getIsDisplayed(), !h)) return !1; if (r != null && f >= 0 && u != f && (i = this.Items[f], i != null && i instanceof n.GridController)) { if (r.getTabLevel() > i.getTabLevel() + 1) { for (e = u - 1; e >= 0; e--)if (s = this.Items[e], o = null, s instanceof n.GridController && (o = s, o.getTabLevel() == i.getTabLevel() + 1)) return n.ADialog.warn("TabSwitchJumpGo", !0, "", o.getTitle()), !1; return n.ADialog.warn("TabSwitchJump"), !1 } i.setMnemonics(!1) } return r != null && r.setMnemonics(!0), this.oldTabIndex = u, !0 }; n.VTabbedPane.prototype.restoreTabChange = function () { this.oldTabIndex = -1 }; n.VTabbedPane.prototype.getTabElement = function () { return this.Items[this.oldTabIndex] }; n.VTabbedPane.prototype.getSelectedIndex = function () { return this.oldTabIndex }; n.VTabbedPane.prototype.sizeChanged = function (n, t) { for (var i in this.Items) this.Items[i].sizeChanged(n, t) }; n.VTabbedPane.prototype.evaluate = function (t) { var r = t == null, u = null, i, f, e, o; if (r || (u = t, r = u != null ? this.dependents.indexOf(u) > -1 : !0), r) for (i = 0; i < this.TabItems.length; i++)f = this.Items[i], f instanceof n.GridController && (e = f, o = e.getIsDisplayed(), this.TabItems[i].setEnabled(o)) }; n.VTabbedPane.prototype.dispose = function () { for (var n in this.Items) this.Items[n].dispose(), this.Items[n] = null; this.TabItems.length = 0; this.TabItems = null; this.Items.length = 0; this.Items = null; this.ItemsIds.length = 0; this.ItemsIds = null; this.dependents.length = 0; this.dependents = null }; r.prototype.setPressed = function (n) { this.toggle && this.pressed != n && (this.pressed = n, this.img && this.toggle && (n ? (this.img.removeClass(this.imgUrl), this.img.addClass(this.imgUrlX)) : (this.img.removeClass(this.imgUrlX), this.img.addClass(this.imgUrl)))) }; r.prototype.setTextDirection = function (n) { this.direction = n }; r.prototype.getIsPressed = function () { return this.pressed }; r.prototype.getAction = function () { return this.action }; r.prototype.getPath = function () { return n.Application.contextUrl + "Areas/VIS/Images/base/" }; r.prototype.getSeprator = function (n, t) { var i = this.getPath(); return (i += n ? "seprator16.png" : "seprator24.png", t) ? "<li>|<\/li>" : '<li><img src="' + i + '"><\/li>' }; r.prototype.setEnabled = function (n) { this.isEnabled = n; this.$li && this.$li.css("opacity", n ? 1 : .6); this.img && this.img.prop("disabled", !n).css("opacity", n ? 1 : .6) }; r.prototype.show = function () { this.$li && this.$li.show(); this.img && this.img.show() }; r.prototype.hide = function () { this.$li && this.$li.hide(); this.img && this.img.hide() }; r.prototype.getItem = function () { return this.$li }; r.prototype.getIsEnabled = function () { return this.isEnabled }; r.prototype.dispose = function (t) { if (this.action = this.toggle = this.pressed = this.isEnabled = this.text = this.toolTipText = this.imageOnly = null, this.textOnly = this.onAction = this.isSmall = null, this.$li && (this.$li.off(n.Events.onClick), this.$li.remove(), this.$li = null), this.img && (this.img = null), t && t in this.items) { var i = this.items[t]; i && (i.off(n.Events.onClick), i.remove(), i = null); delete this.items[t] } this.disposeComponent() }; r.prototype.setIsRo; o = document.querySelector("#vis-ad-statusbartmp").content; u.prototype.setStatusDB = function (n, t) { n == null || n.length == 0 ? this.$statusDB.text("") : this.$statusDB.text(n); this.text = n; this.dse = t; this.setPageLine(t) }; u.prototype.setStatusLine = function (n, t) { this.merror = t; this.mtext = n; this.$statusLine.text(n) }; u.prototype.setInfo = function (n) { this.$infoLine.is(":visible") || this.$infoLine.show(); this.$infoLine.text(n) }; u.prototype.dispose = function () { this.disposeComponent() }; n.AParentDetail = function (i, r) { function y() { f = t("<div class='vis-apanel-bar'>"); c = t("<div class='vis-apanel-bar-fixpart' style='background-color:white'>"); o = t("<div class='vis-apanel-bar-varpart vis-apanel-bar-pdetail'>"); e = t('<div class="vis-apanel-lb-main">'); s = t("<div class='vis-apanel-lb-oflow' style='border-left: 1px solid white;'>").hide(); s.html("<a data-dir='u' href='javascript:void(0)'><img style='margin-left:10px' data-dir='u' src='" + n.Application.contextUrl + "Areas/VIS/Images/base/arrow-top.png' ><\/a><a data-dir='d' href='javascript:void(0)' ><img style='margin-left:10px' data-dir='d' src='" + n.Application.contextUrl + "Areas/VIS/Images/base/arrow-bottom.png' /><\/a>"); o.append(e).append(s); h = t("<div style='width:192px;overflow-y:auto;padding-left: 4px;padding-right:3px;'>"); e.append(h); f.append(o).append(c); r.append(f); f.hide() } function a() { for (var r = null, c = "", t = "", o, s, e = 0; e < v; e++)(r = l[e], t = null, t = r.getValue(), t && t != "" && r.getIsDisplayed()) && (c += "<h3>" + w2utils.encodeTags(r.getHeader()) + "<\/h3>", o = r.getDisplayType(), r.lookup ? t = r.lookup.getDisplay(t, !0) : n.DisplayType.IsDate(o) ? t = new Date(t).toLocaleString() : o == n.DisplayType.YesNo ? (s = t.toString(), r.getIsEncryptedColumn() && (s = n.secureEngine.decrypt(s)), t = s.equals("Y")) : t = t.toString(), r.getIsEncryptedColumn() && o != n.DisplayType.YesNo && (t = n.secureEngine.decrypt(t)), c += "<h5>" + w2utils.encodeTags(t) + "<\/h5>"); h.empty(); h.html("<h1>" + i.getMTab().getName() + "<\/h1>" + c); u.setSize(f.height()) } function p() { u.curGC && (u.curGC.multiRowResize(), u.curGC.aPanel.setWidth(-1, !0), u.curGC.aPanel.setTabNavigation()) } function w() { a(); u.curGC && (u.curGC.multiRowResize(), u.curGC.aPanel.setWidth(-1, !0), u.curGC.aPanel.setTabNavigation()) } var u; this.gc = i; this.$root = r; this.visible = !1; this.expaned = !1; this.curGC = null; var l = i.getMTab().getTableModel().getFields(), v = l.length, c, o, f = null, e, s, h; y(); u = this; c.on(n.Events.onTouchStartOrClick, function (n) { u.$root.width() > 20 ? u.hide() : u.show(); n.stopPropagation() }); s.on("click", function (n) { var r, o; if (n.stopPropagation(), r = t(n.target).data("dir"), r) { var s = e.height(), c = h.height(), u = e.scrollTop(), f = Math.ceil(s / 2), i = 0; if (r == "d") { if (u + f >= c - f) return; o = c - s; i = u + f; e.animate({ scrollTop: i > o ? o : i }, 1e3, "easeOutBounce") } else if (r == "u") { if (u == 0) return; i = u - f; e.animate({ scrollTop: i < 0 ? 0 : i }, 1e3, "easeOutBounce") } } }); this.show = function () { if (u.expaned) { a(); return } this.expaned = !0; u.visible && f.show(); r.animate({ width: "200px" }, 300, "swing"); o.show().animate({ width: "192px" }, 300, "swing", w) }; this.hide = function () { (this.expaned || !this.visible) && (this.expaned = !1, r.animate({ width: u.visible ? "8px" : "0px" }, 300, "swing"), u.visible || f.hide(), o.hide().animate({ width: "0px" }, 300, "swing", p)) }; this.setSize = function (t) { f.height(t); e.height(t); h.height() > e.height() && (n.Application.isMobile || (e.height(t - 40), s.show())) }; this.disposeComponenet = function () { this.gc = null; this.$root = null; this.visible = null; this.expaned = null; s.off("click"); c.off(n.Events.onTouchStartOrClick); c = o = null; f.remove(); f = null; u = null; this.curGC = null; l.length = 0; l = null; this.show = null; this.hide = null } }; n.AParentDetail.prototype.evaluate = function (n) { if (this.curGC = null, this.curGC = n, this.gc.getId() === n.getId()) this.visible = !1, this.hide(); else { if (this.curGC.isParentDetailVisible = !0, this.visible) return; this.visible = !0; this.show() } }; n.AParentDetail.prototype.dispose = function () { this.disposeComponenet() }; n.VSortTab = function (i, r, u, f, e, o) { function g() { b = t("<span>").text(n.Msg.getMsg("N")); k = t("<span>").text(n.Msg.getMsg("Y")); h = t("<ul class='vis-sortTab-select' " + (e ? " disabled" : "") + ">"); s = t("<ul class='vis-sortTab-select' " + (e ? " disabled" : "") + " >"); v = t("<button" + (e ? " disabled" : "") + " ><img src='" + w + "Left32.png' /><\/button"); a = t("<button" + (e ? " disabled" : "") + " ><img src='" + w + "Right32.png' /><\/button"); y = t("<button" + (e ? " disabled" : "") + " ><img src='" + w + "Up32.png' /><\/button"); p = t("<button" + (e ? " disabled" : "") + " ><img src='" + w + "Down32.png' /><\/button"); l = t("<table class='vis-apanel-sorttab' style='display:none;'>"); var i = t("<td class='vis-apanel-sorttab-td'>"); i.append(t("<div class='vis-apanel-sorttab-td-inner'>").append(b).append(h).append(t("<div class='vis-apanel-sorttab-td-right'>").append(a).append(v))); i.append(t("<div class='vis-apanel-sorttab-td-inner'>").append(k).append(s).append(t("<div class='vis-apanel-sorttab-td-right'>").append(y).append(p))); l.append(t("<tr>").append(i)) } var l, b, k, h, s, a, v, y, p, w, d, c; this.winNumber = i; this.tableName = null; this.columnSortName = null; this.columnYesNoName = null; this.keyColumnName = null; this.identifierColumnName = null; this.identifierTranslated = !1; this.parentColumnName = null; this.aPanel = null; this.log = n.Logging.VLogger.getVLogger("VSortTab"); w = n.Application.contextUrl + "Areas/VIS/Images/base/"; d = null; g(); this.dynInit(r, u, f); this.getRoot = function () { return l }; this.getId = function () { return o }; this.getlstModel = function (n) { return n ? s.find("li") : h.find("li") }; this.setLabelName = function (n, t) { b.text(n); k.text(t) }; this.setListOptions = function (n, t) { h.empty(); h.append(n); s.empty(); s.append(t) }; this.setOldValues = function (n) { d = n }; this.getOldValues = function () { return d }; c = this; v.on(n.Events.onTouchStartOrClick, function (n) { c.btn_Click("Left"); n.stopPropagation() }); a.on(n.Events.onTouchStartOrClick, function (n) { c.btn_Click("Right"); n.stopPropagation() }); y.on(n.Events.onTouchStartOrClick, function (n) { c.btn_Click("Up"); n.stopPropagation() }); p.on(n.Events.onTouchStartOrClick, function (n) { c.btn_Click("Down"); n.stopPropagation() }); h.on(n.Events.onClick, "LI", function () { t(this).toggleClass("vis-apanel-sorttab-selected") }); s.on(n.Events.onClick, "LI", function () { t(this).toggleClass("vis-apanel-sorttab-selected") }); this.btn_Click = function (n) { var e = !1, i = null, u, f, c, r, o; if (n == "Right") { for (i = h.find("li.vis-apanel-sorttab-selected"), s.children().removeClass("vis-apanel-sorttab-selected"), u = 0; u < i.length; u++)i[u].remove(), t(i[u]).toggleClass("vis-apanel-sorttab-selected"), s.append(i[u]), e = !0; i.length = 0; i = 0 } else if (n == "Left") { for (i = s.find("li.vis-apanel-sorttab-selected"), h.children().removeClass("vis-apanel-sorttab-selected"), f = 0; f < i.length; f++)i[f].remove(), t(i[f]).toggleClass("vis-apanel-sorttab-selected"), h.append(i[f]), e = !0; i.length = 0; i = 0 } else { if (i = s.find("li.vis-apanel-sorttab-selected"), i == null) return; if (c = i.length, c == 0) return; if (r = t(i[0]), r == null) return; if (s.children().removeClass("vis-apanel-sorttab-selected"), r.addClass("vis-apanel-sorttab-selected"), o = r.index(), n == "Up") { if (o == 0) return; r.remove(); r.insertBefore(s.find("li").eq(o - 1)); e = !0 } else if (n == "Down") { if (o >= s.children().length - 1) return; r.remove(); r.insertAfter(s.find("li").eq(o)); e = !0 } } e && this.aPanel != null && this.aPanel.aSave.setEnabled(!0) }; this.disposeComponent = function () { v.off(n.Events.onTouchStartOrClick); a.off(n.Events.onTouchStartOrClick); y.off(n.Events.onTouchStartOrClick); p.off(n.Events.onTouchStartOrClick); this.seletedTab = null; l.remove(); l = null; c = null; this.winNumber = null; this.tableName = null; this.columnSortName = null; this.columnYesNoName = null; this.keyColumnName = null; this.identifierColumnName = null; this.identifierTranslated = !1; this.parentColumnName = null; this.aPanel = null; this.log = null; h = null; s = null; y = p = v = a = null; this.btn_Click = this.setListOptions = this.getlstModel = this.setLabelName = this.setListOptions = this.getRoot = this.getId = null; console.log("dispose vSortTab") } }; n.VSortTab.prototype.dynInit = function (t, i, r) { var e = !n.Env.isBaseLanguage(n.Env.getCtx(), ""), o = "VIS_122", f = [], u, s; f[0] = new n.DB.SqlParam("@AD_Table_ID", t); f[1] = new n.DB.SqlParam("@AD_ColumnSortOrder_ID", i); f[2] = new n.DB.SqlParam("@AD_ColumnSortYesNo_ID", r); e && (o = "VIS_123", f = [], f[0] = new n.DB.SqlParam("@AD_Table_ID", t), f[1] = new n.DB.SqlParam("@AD_ColumnSortOrder_ID", i), f[2] = new n.DB.SqlParam("@AD_ColumnSortYesNo_ID", r), f[3] = new n.DB.SqlParam("@AD_Language", n.Env.getAD_Language(n.Env.getCtx()))); u = this; s = ""; a(o, f, function (t) { if (t != null) { for (var f = ""; t.read();)u.tableName = t.getString(0), i == t.get(1) ? (u.columnSortName = t.getString(2), f = t.getString(3)) : r == t.get(1) ? u.columnYesNoName = t.getString(2) : t.getString(4) == "Y" ? u.parentColumnName = t.getString(2) : t.getString(5) == "Y" ? u.keyColumnName = t.getString(2) : t.getString(6) == "Y" && (u.identifierColumnName = t.getString(2), e && (u.identifierTranslated = "Y" == t.getString(7))); t.close(); u.setLabelName(n.Msg.getMsg("Available"), f) } u = null }) }; n.VSortTab.prototype.setVisible = function (n) { n ? this.getRoot().show() : this.getRoot().hide() }; n.VSortTab.prototype.loadData = function () { var t = "", e; t += "SELECT t." + this.keyColumnName; t += this.identifierTranslated ? ",tt." : ",t."; t += this.identifierColumnName + ",t." + this.columnSortName; this.columnYesNoName != null && (t += ",t." + this.columnYesNoName); t += " FROM " + this.tableName + " t"; this.identifierTranslated && (t += ", " + this.tableName + "_Trl tt"); t += " WHERE t." + this.parentColumnName + "=@ID"; this.identifierTranslated && (t += " AND t." + this.keyColumnName + "=tt." + this.keyColumnName + " AND tt.AD_Language='" + n.context.getAD_Language() + "'"); t += " ORDER BY "; this.columnYesNoName != null && (t += "4 DESC,"); t += "3,2"; var c = n.Env.getCtx().getWindowContext(this.winNumber, this.parentColumnName), i = v(t, [new n.DB.SqlParam("@ID", c)]), o = "", s = "", r = []; try { while (i.read()) { var u = i.get(0), l = i.getString(1), f = i.get(2), h = f != 0; this.columnYesNoName != null && (h = i.getString(3) == "Y"); e = "<li data-value='" + u + "'>" + l + "<\/li>"; h ? (o += e, r.push({ key: u, value: f })) : (s += e, r.push({ key: u, value: f })) } i.close(); i.dispose(); this.setOldValues(r); this.setListOptions(s, o) } catch (a) { this.log.Log(n.Logging.Level.SEVERE, t, a) } this.aPanel.aSave.setEnabled(!1) }; n.VSortTab.prototype.saveData = function () { var u; if (this.aPanel.aSave.getIsEnabled()) { var f = this.getlstModel(), e = this, o = this.tableName, s = this.columnSortName, h = this.columnYesNoName, c = this.keyColumnName, i = [], r = []; f.each(function (n, u) { i.push(t(u).data("value")); r.push("N") }); u = this.getlstModel(!0); u.each(function (n, u) { i.push(t(u).data("value")); r.push("Y") }); t.ajax({ url: n.Application.contextUrl + "Form/SetFieldsSorting", async: !1, type: "POST", data: { values: JSON.stringify(i), noYes: JSON.stringify(r), tableName: o, keyColumnName: c, columnSortName: s, columnYesNoName: h, oldValues: JSON.stringify(e.getOldValues()) }, success: function () { }, error: function () { } }) } }; n.VSortTab.prototype.unRegisterAPanel = function () { this.saveData(); this.aPanel = null }; n.VSortTab.prototype.registerAPanel = function (n) { this.aPanel = n }; n.VSortTab.prototype.sizeChanged = function (n) { this.getRoot().height(n) }; n.VSortTab.prototype.dispose = function () { this.disposeComponent() }; n.RecordInfo = function (i, r) { function c() { e = null; s = null; u.remove(); u = null } var e = null, o = i, s = n.Logging.VLogger.getVLogger("VIS.RecordInfo"), u = t("<div style='min-width:550px;max-width:600px'>"), f = null, h = { CreatedBy: r.CreatedBy, Created: r.Created, Updated: r.Updated, UpdatedBy: r.UpdatedBy, Info: r.Info, AD_Table_ID: r.AD_Table_ID, Record_ID: r.Record_ID }; n.dataContext.getJSONData(n.Application.contextUrl + "JsonData/GetRecordInfo", { dse: h }, function (n) { var s, h, f, c, o; if (u.html("<span>" + n.Info + "<\/span>"), n.ShowGrid) { s = t("<table class='vis-advancedSearchTable'>"); h = t("<div class='vis-advancedSearchTableWrap vis-table-responsive' style='max-height:200px;overflow-y:auto'>").append(s); u.append(h); var i = "", e = "", r = null; for (f = 0, c = n.Rows.length; f < c; f++) { if (f == 0) { for (i += '<thead><tr class="vis-advancedSearchTableHead">', o = 0; o < n.Headers.length; o++)i += "<th>" + n.Headers[o] + "<\/th>"; i += "<\/tr><\/thead><tbody>" } e = '<tr class="vis-advancedSearchTableRow">'; r = n.Rows[f]; e += "<td>" + r.AD_Column_ID + "<\/td><td>" + r.NewValue + "<\/td><td>" + r.OldValue + "<\/td><td>" + r.UpdatedBy + "<\/td><td>" + Globalize.format(new Date(r.Updated), "f") + "<\/td>"; e += "<\/tr>"; i += e } i += "<\/tbody>"; s.html(i) } }); this.show = function () { f = new n.ChildDialog; f.setTitle(o); f.setContent(u); f.close = function () { c() }; f.show() } }; n.AWindow = i; n.AppsAction = r; n.StatusBar = u }(VIS, jQuery), function (n) { n.VTabbedPane = function () { var n = !1; this.oldTabIndex = -1; this.Items = []; this.ItemsIds = []; this.count = 0; this.dependents = []; this.TabItems = []; this.getIsWorkbench = function () { return n } }; n.VTabbedPane.prototype.setTabObject = function (n) { this.tabObj = n }; n.VTabbedPane.prototype.addTab = function (n, t, i, r) { var f, u, e; for (this.ItemsIds[this.count] = n, this.Items[this.count] = i, this.TabItems.push(r), f = t.getDependentOn(), u = 0; u < f.length; u++)e = f[u], this.dependents.indexOf(e) < 0 && this.dependents.push(e); this.count++ }; n.VTabbedPane.prototype.getIsTabChanged = function (t) { var u = this.ItemsIds.indexOf(t), f = this.oldTabIndex, r, h, i, e, s, o; if (u === f) return console.log("same tab"), !1; if (i = this.Items[u], r = null, i instanceof n.GridController && (r = i, h = r.getIsDisplayed(), !h)) return !1; if (r != null && f >= 0 && u != f && (i = this.Items[f], i != null && i instanceof n.GridController)) { if (r.getTabLevel() > i.getTabLevel() + 1) { for (e = u - 1; e >= 0; e--)if (s = this.Items[e], o = null, s instanceof n.GridController && (o = s, o.getTabLevel() == i.getTabLevel() + 1)) return n.ADialog.warn("TabSwitchJumpGo", !0, "", o.getTitle()), !1; return n.ADialog.warn("TabSwitchJump"), !1 } i.setMnemonics(!1) } return r != null && r.setMnemonics(!0), this.oldTabIndex = u, !0 }; n.VTabbedPane.prototype.restoreTabChange = function () { this.oldTabIndex = -1 }; n.VTabbedPane.prototype.getTabElement = function () { return this.Items[this.oldTabIndex] }; n.VTabbedPane.prototype.getSelectedIndex = function () { return this.oldTabIndex }; n.VTabbedPane.prototype.sizeChanged = function (n, t) { for (var i in this.Items) this.Items[i].sizeChanged(n, t) }; n.VTabbedPane.prototype.evaluate = function (t) { var r = t == null, u = null, i, f, e, o; if (r || (u = t, r = u != null ? this.dependents.indexOf(u) > -1 : !0), r) for (i = 0; i < this.TabItems.length; i++)f = this.Items[i], f instanceof n.GridController && (e = f, o = e.getIsDisplayed(), this.TabItems[i].setEnabled(o)) }; n.VTabbedPane.prototype.dispose = function () { for (var n in this.Items) this.Items[n].dispose(), this.Items[n] = null; this.TabItems.length = 0; this.TabItems = null; this.Items.length = 0; this.Items = null; this.ItemsIds.length = 0; this.ItemsIds = null; this.dependents.length = 0; this.dependents = null } }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { var a = f.getHtmlStyle(), v = '<div class="input-group vis-input-wrap">', o, s, e, c, h, l; if (r && (r.getControl()[0].tagName == "TEXTAREA" || r.getControl().hasClass("vis-ev-col-img-ctrl")) && (v = '<div class="input-group vis-input-wrap vis-ev-full-h">'), o = t(v), f.getShowIcon() && (f.getFontClass() != "" || f.getImageName() != "") && (s = ['<div class="input-group-prepend"><span class="input-group-text vis-color-primary">'], f.getFontClass() != "" ? s.push('<i class="' + f.getFontClass() + '"><\/i>') : s.push('<img src="' + n.Application.contextUrl + "Images/Thumb16x16/" + mFiled.getImageName() + '"><\/img>'), s.push("<\/span><\/div>"), o.append(s.join(" "))), r != null && a != "" && r.getControl().attr("style", a), e = t("<div class='vis-control-wrap'>"), r && (r.getControl()[0].tagName == "INPUT" || r.getControl()[0].tagName == "SELECT" || r.getControl()[0].tagName == "TEXTAREA") && r.getControl()[0].type != "checkbox" ? (e.append(r.getControl().attr("placeholder", " ").attr("data-placeholder", "")), i != null && e.append(i.getControl())) : (i != null && e.append(i.getControl()), r && e.append(r.getControl())), e.append("<span class='vis-ev-ctrlinfowrap' data-colname='" + f.getColumnName() + "' title='" + f.getDescription() + "'  tabindex='-1' data-toggle='popover' data-trigger='focus'><i class='vis vis-info' aria-hidden='true'><\/i><\/span'>"), e.append("<span class='vis-ev-col-msign'><i class='fa fa-exclamation' aria-hidden='true'><\/span'>"), o.append(e), r && (c = r.getBtnCount(), c > 0)) { for (r.getControl().attr("data-hasBtn", " "), h = 0; h < c;)l = r.getBtn(h), l != null && o.append(t('<div class="input-group-append">').append(l)), ++h; c = -1; h = 0 } u.append(o) } n.VGridPanel = function () { function st() { l = t("<div class='vis-ad-w-p-vc-ev-grid'>"); l.on("click", "span.vis-ev-ctrlinfowrap", ft) } function ft(n) { var i = t(n.currentTarget), r = i.data("colname"); r != "" && (k && (k.popover("dispose"), k = null), i.attr("data-content", ut[r].help), k = i.popover("show")) } function d(n, i, r, u) { n && (nt = e = t("<div class='vis-ev-col'><\/div>")); i && (nt = a = t("<div class='vis-ev-col vis-ev-col-start2'><\/div>")); r && (nt = p = t("<div class='vis-ev-col vis-ev-col-start3'><\/div>")); u && (nt = w = t("<div class='vis-ev-col vis-ev-col-start4'><\/div>")) } function g(n) { n ? n.rSpan <= 1 && (n = { rSpan: 1, cSpan: 0, cSpace: 0, set: !1 }) : (s = { rSpan: 1, cSpan: 0, cSpace: 0, set: !1 }, u = { rSpan: 1, cSpan: 0, cSpace: 0, set: !1 }, f = { rSpan: 1, cSpan: 0, cSpace: 0, set: !1 }, h = { rSpan: 1, cSpan: 0, cSpace: 0, set: !1 }) } function ht(n) { s.rSpan > 1 && (s.set && n == 1 ? s.set = !1 : --s.rSpan, g(s)); u.rSpan > 1 && (n == 2 && u.set ? u.set = !1 : --u.rSpan, g(u)); f.rSpan > 1 && (n == 3 && f.set ? f.set = !1 : --f.rSpan, g(f)); h.rSpan > 1 && (--h.rSpan, g(h)) } function et(n, t) { var c = n.getFieldBreadth(), o = n.getFieldColSpan(), i = n.getCellSpace(), l = n.getIsLongField(), v = n.getIsLineBreak(); if (v && (g(), t = !0), t && (ht(r), tt(), r = 0), r == 0) if (l) tt(), g(), d(!0), e.addClass("vis-ev-col-end4"), r = 4; else if (s.rSpan > 1) r += s.cSpan; else if (i > 0) i > 3 && (i = 3), r += i, i = 0; else if (e) r += 1; else { d(!0); o == 2 ? u.rSpan <= 1 && e.addClass("vis-ev-col-end2") : o == 3 ? u.rSpan <= 1 && f.rSpan <= 1 ? e.addClass("vis-ev-col-end3") : u.cSpan < 1 && e.addClass("vis-ev-col-end2") : o > 3 && (u.rSpan <= 1 && f.rSpan <= 1 && h.rSpan <= 1 ? e.addClass("vis-ev-col-end4") : u.rSpan <= 1 && f.rSpan <= 1 ? e.addClass("vis-ev-col-end3") : u.rSpan <= 1 && e.addClass("vis-ev-col-end2")); r += o - 1; c > 1 && (s.rSpan = c + 1, s.set = !0, s.cSpan = o, s.cSpace = i, e.css("grid-row", "span " + c)); return } if (r == 1) if (u.rSpan > 1) r += u.cSpan; else if (i > 0) i > 2 && (i = 2), r += i, i = 0; else if (a) r += 1; else { d(!1, !0); o == 2 ? f.rSpan <= 1 && a.addClass("vis-ev-col-end3") : o >= 3 && (f.rSpan <= 1 && h.rSpan <= 1 ? a.addClass("vis-ev-col-end4") : f.cSpan < 1 && a.addClass("vis-ev-col-end3")); r += o - 1; c > 1 && (u.rSpan = c + 1, u.set = !0, u.cSpan = o, u.cSpace = i, a.css("grid-row", "span " + c)); return } if (r == 2) if (f.rSpan > 1) r += f.cSpan; else if (i > 0) i > 1 && (i = 1), r += i, i = 0; else if (p) r += 1; else { d(!1, !1, !0); o >= 2 && h.rSpan <= 1 && p.addClass("vis-ev-col-end4"); r += o - 1; c > 1 && (f.rSpan = c + 1, f.set = !0, f.cSpan = o, f.cSpace = i, p.css("grid-row", "span " + c)); return } r == 3 && (h.rSpan > 1 || (w ? t = !0 : (d(!1, !1, !1, !0), o >= 2 && w.addClass("vis-ev-col-end4"), c > 1 && (h.rSpan = c + 1, h.set = !0, h.cSpan = o, h.cSpace = i, w.css("grid-row", "span " + c))))); e || a || p || w || et(n, t) } function tt() { e && l.append(e); a && l.append(a); p && l.append(p); w && l.append(w); e = a = p = w = $td4 = null } function ct(n) { var s, e, r, o, u; n.stopPropagation(); var i = t(this), h = i.data("name"), l = i.data("display"), f = !1; for (l === "show" ? (i.data("display", "hide"), t(i.children()[2]).addClass("vis-ev-col-fg-rotate")) : (i.data("display", "show"), f = !0, t(i.children()[2]).removeClass("vis-ev-col-fg-rotate")), s = c[h], e = 0; e < s.length; e++) { for (r = s[e], o = v[r.getColumnName()], u = 0; u < o.length; u++)o[u].tag = f, o[u].setVisible(f && r.getIsDisplayed(!0)); f && r.getIsDisplayed(!0) ? y[r.getColumnName()].show() : y[r.getColumnName()].hide() } } function lt(n) { if (o == null && (o = ""), n == null || n.length == 0 || n.equals(o)) return !1; o = n; tt(); d(!0); var i = t('<div class="vis-ev-col-fieldgroup" data-name="' + n + '" data-display="hide"><span class="vis-ev-col-fg-hdr">' + n + ' <\/span> <span class="vis-ev-col-fg-more" style="display:none"><i class="fa fa-ellipsis-h"><\/i><\/span><i class= "fa fa-angle-up  vis-ev-col-fg-rotate"><\/span><\/div>'); e.append(i); e.addClass("vis-ev-col-end4"); r = 0; i.on("click", ct); return !0 } function at(n) { if (o != null && !o.equals("")) { var t = null; c[o] && (t = c[o]); t == null && (t = [], c[o] = t); t.push(n) } } function ot(n, t) { v[n] ? v[n].push(t) : (v[n] = [], v[n].push(t)) } function vt(n) { if (o != null && !o.equals("")) { var t = null; c[o] && (t = c[o]); t == null && (t = [], c[o] = t); t.push(n); y[n.getColumnName()].hide() } } var o = null, r = -2, it = -1, b = [], rt = [], l, e, a, p, w, nt = null, s = { rSpan: 1, cSpan: 0, cSpace: 0, orgRSpan: 1 }, u = { rSpan: 1, cSpan: 0, cSpace: 0, orgRSpan: 1 }, f = { rSpan: 1, cSpan: 0, cSpace: 0, orgRSpan: 1 }, h = { rSpan: 1, cSpan: 0, cSpace: 0, orgRSpan: 1 }, v = {}, c = {}, y = {}, ut = {}, k = null; st(); this.addField = function (u, f) { var o = !1, e, s, h, l, c; if (f.getIsLink()) { b[++it] = u; rt.push(u); return } if (e = n.VControlFactory.getLabel(f), e != null || u != null) { if (s = f.getIsSameLine(), lt(f.getFieldGroup(), r) && (s = !1), s ? (++r, r > 3 ? (s = !1, o = !0) : r < 0 && (o = !0)) : o = !0, et(f, o), e != null && (f.getDescription().length > 0, ot(f.getColumnName(), e), b[++it] = e), u != null) { h = f.getVFormat(); switch (h) { case "": break; default: u.getControl().on("focusout", function (i) { var r = new RegExp(h); n.DisplayType.IsString(f.getDisplayType()) && t(i.target).val() != null && t(i.target).val().toString().trim().length > 0 && (r.test(t(i.target).val()) || n.ADialogUI.warn(n.Msg.getMsg("RegexFailed") + ":" + f.getHeader(), "", function () { t(i.target).focus() })) }) }l = u.getBtnCount(); ot(f.getColumnName(), u); b[++it] = u } (e != null || u != null) && (c = nt, i(e, u, c, f), y[f.getColumnName()] = c, vt(f), ut[f.getColumnName()] = { help: f.getHelp() }) } }; this.flushLayout = function () { tt() }; this.getRoot = function () { return l }; this.getComponents = function () { return b }; this.getLinkComponents = function () { return rt }; this.setVisible = function (n, t) { y[n] && (t ? y[n].show() : y[n].hide()) }; this.dispose = function () { var n, t; for (l.off("click", "span.vis-ev-ctrlinfowrap", ft), ut = {}, k && k.popover("dispose"), k = null, rt.length = 0, rt = null; b.length > 0;)b.pop().dispose(); for (n in v) v[n] = null, delete v[n]; v = null; y = {}; y = null; for (t in c) c[t].length = 0, c[t] = null, delete c[n]; c = null; it = null; b = null; l.remove(); l = null; this.addField = null; tt = null; at = null } } }(VIS, jQuery), function (n, t) { function i() { function o() { r = t("<div class='vis-cv-body vis-noselect'>"); n = t("<div class='vis-cv-main'>"); f = t("<div class='vis-cv-header'>"); r.append(n) } var r, n, f, u, i, e; this.cGroupInfo = {}; this.cCols = []; this.cConditions = []; this.cGroup = null; this.mTab; this.AD_Window_ID; this.AD_Tab_ID; this.groupCtrls = []; this.fields = []; this.grpCount = 0; this.grpColName = ""; this.hasIncludedCols = !1; this.onCardEdit = null; n = null; u = this; o(); this.getRoot = function () { return r }; this.getBody = function () { return n }; this.setHeader = function (n) { f.text(n) }; this.getHeader = function () { return f }; this.sizeChanged = function (n, t) { r.height(n - 12 + "px"); this.calculateWidth(t) }; this.calculateWidth = function (t) { var i = this.groupCtrls.length, r, u; if (!(i < 1)) { if (t) if (r = 262 * i, r > t) n.width(262 * i); else for (n.width(t), u = Math.ceil(t / i) - 24; i > 0;)--i, this.groupCtrls[i].setWidth(u); else n.width(262 * i); this.navigate() } }; n.on("click", "div.vis-cv-card", function (n) { var r, i, f; if (u.onCardEdit) if (r = t(n.target), r[0].nodeName == "SPAN" && r.hasClass("vis-cv-card-edit")) { if (i = r.data("recid"), i || i === 0) u.onCardEdit({ recid: i }) } else { for (f = 0; !r.hasClass("vis-cv-card");) { if (f > 5) break; r = r.parent(); f++ } if (i = r.data("recid"), i || i === 0) { u.onCardEdit({ recid: i }, !0); u.navigate(i, !1, !0) } } n.stopPropagation() }); this.getAD_CardView_ID = function () { return this.AD_CardView_ID }; this.getField_Group_ID = function () { return this.cGroup ? this.cGroup.getAD_Field_ID() : 0 }; i = null; e = null; this.navigate = function (t, r, u) { (t && (e = t), r) || (i && i.length > 0 && i.toggleClass("vis-cv-card-selected"), i = n.find("div.vis-cv-card[name~=vc_" + e + "]"), i.length != 0 && (i.toggleClass("vis-cv-card-selected"), u || i[0].scrollIntoView())) }; this.dC = function () { for (n.off("click"), this.onCardEdit = null, u = null, r.remove(), n.remove(), f.remove(), r = n = f = null, this.getRoot = this.getBody = this.setHeader = this.getHeader = this.dC = null, i = null, this.cGroupInfo = {}, this.cCols.length = 0, this.cConditions.length = 0, this.cGroup = null, this.mTab = null, this.fields.length = 0, this.grpCount = null; this.groupCtrls.length > 0;)this.groupCtrls.pop().dispose() } } function u(i, u, f, e, o) { function l() { var n = "<div class='vis-cv-cg vis-pull-left'> <div class='vis-cv-head' >" + f + "<\/div><div class='vis-cv-grpbody'><\/div><\/div>"; s = t(n); h = s.find(".vis-cv-grpbody"); i && s.css({ "margin-right": "0px", width: "100%" }) } function a() { for (var t = null, f = 0; f < u.length; f++)t = new r(e, u[f]), i && t.getRoot().width("240px").css({ margin: "5px 12px 12px 5px", float: n.Application.isRTL ? "right" : "left" }), c.push(t), h.append(t.getRoot()), t.evaluate(o) } var s = null, h, c = []; l(); a(); this.getRoot = function () { return s }; this.getBody = function () { return h }; this.setWidth = function (n) { s.width(n) }; this.dC = function () { while (c.length > 0) c.pop().dispose(); s.remove(); s = null; h = null; this.getBody = null; this.getRoot = null } } function r(i, r) { var f, s, e, o, h, u, c; for (this.record = r, f = t('<div class="vis-cv-card" data-recid=' + r.recid + " name = vc_" + r.recid + " ><\/div>"), s = t('<span class="glyphicon glyphicon-pencil vis-cv-card-edit vis-pull-right" data-recid=' + r.recid + "><\/span>"), f.append(s), e = null, h = 0; h < i.length; h++)e = i[h], u = r[e.getColumnName().toLowerCase()], o = e.getDisplayType(), n.DisplayType.IsLookup(o) ? u = e.getLookup().getDisplay(u) : n.DisplayType.YesNo == o ? u = u || u == "Y" ? n.Msg.getMsg("Yes") : u = n.Msg.getMsg("No") : n.DisplayType.IsDate(o) && (u = u ? o == n.DisplayType.Date ? Globalize.format(new Date(u), "d") : o == n.DisplayType.DateTime ? Globalize.format(new Date(u), "f") : Globalize.format(new Date(u), "t") : null), u || u == 0 || (u = " -- "), u = w2utils.encodeTags(u), c = "", c = n.Application.isRTL ? "<p><strong title='" + u + "'>" + u + "<\/strong> :" + e.getHeader() + "<\/p>" : "<p>" + e.getHeader() + ": <strong title='" + u + "'>" + u + "<\/strong><\/p>", f.append(t(c)); this.setColor = function (n, t) { n && f.css("background-color", n); t && f.css("color", n) }; s.on("touchstart", function () { t(this).css({ color: "gray" }) }); this.getRoot = function () { return f }; this.setWidth = function (n) { f.width(n) }; this.dC = function () { s.off("touchstart mouseover"); f.remove(); f = null; this.getRoot = null; this.dc = null } } i.prototype.tableModelChanged = function (t, i, r) { var u = null, f, e; if (t === n.VTable.prototype.ROW_REFRESH) u = i.recid ? i.recid : i; else if (t === n.VTable.prototype.ROW_UNDO) this.getBody().find("div.vis-cv-card[name~=vc_" + i + "]").remove(); else if (t === n.VTable.prototype.ROW_DELETE) { for (f = i.slice(); f.length > 0;)e = f.pop(), this.getBody().find("div.vis-cv-card[name~=vc_" + e + "]").remove(); isNaN(r) && (u = r[0]) } else t === n.VTable.prototype.ROW_ADD && (u = i.recid); u && this.navigate(u) }; i.prototype.setupCardView = function (t, i, r) { this.mTab = i; var u = this; n.dataContext.getCardViewInfo(i.getAD_Window_ID(), i.getAD_Tab_ID(), function (n) { u.setCardViewData(n) }); r.append(this.getHeader()); r.append(this.getRoot()) }; i.prototype.setCardViewData = function (n) { var i, t, r; if (this.hasIncludedCols = !1, this.fields = [], this.cGroup = null, this.cConditions = [], n) for (this.AD_CardView_ID = n.AD_CardView_ID, t = this.mTab.getFieldById(n.FieldGroupID), t && (this.cGroup = t), this.cConditions = n.Conditions, i = 0; i < n.IncludedCols.length; i++)t = this.mTab.getFieldById(n.IncludedCols[i]), t && this.fields.push(t), this.hasIncludedCols = !0; this.fields.length < 1 && this.fields.length < 1 && (t = this.mTab.getField("Name"), t && this.fields.push(t), t = this.mTab.getField("Description"), t && this.fields.push(t), t = this.mTab.getField("Help"), t && this.fields.push(t)); for (r in this.cGroupInfo) this.cGroupInfo[r].records.length = 0; this.cGroupInfo = {}; this.grpCount = 0; this.isProcessed = !1 }; i.prototype.createGroups = function () { var f, t, u, r, i; if (this.isProcessed) { for (f in this.cGroupInfo) this.cGroupInfo[f].records = []; return } if (this.cGroup) if (t = this.cGroup, t) { if (t.getDisplayType() == n.DisplayType.YesNo) this.cGroupInfo["true"] = { name: "Yes", records: [] }, this.cGroupInfo["false"] = { name: "No", records: [] }, this.grpCount = 2; else if (n.DisplayType.IsLookup(t.getDisplayType()) && t.getLookup()) for (u = t.getLookup(), u.fillCombobox(!0, !0, !0, !1), r = u.data, i = 0; i < r.length; i++)this.cGroupInfo[r[i].Key] = { name: r[i].Name, records: [] }, this.grpCount += 1; this.setHeader(t.getHeader()) } else this.setHeader(""); this.grpCount < 1 && (this.cGroupInfo.All = { name: n.Msg.getMsg("All"), records: [] }, this.grpCount = 1); this.isProcessed = !0 }; i.prototype.refreshUI = function (n) { var f, r, t, e, i; for (this.createGroups(), f = this.mTab.getTableModel().mSortList, r = this.getBody(); this.groupCtrls.length > 0;)this.groupCtrls.pop().dispose(); if (this.groupCtrls.length = 0, r.empty(), t = null, this.grpCount == 1) { e = ""; for (i in this.cGroupInfo) { e = this.cGroupInfo[i].name; break } t = new u(!0, f, e, this.fields, this.cConditions); this.groupCtrls.push(t); r.append(t.getRoot()) } else { this.filterRecord(f); for (i in this.cGroupInfo) t = new u(this.grpCount === 1, this.cGroupInfo[i].records, this.cGroupInfo[i].name, this.fields, this.cConditions), this.groupCtrls.push(t), r.append(t.getRoot()) } this.calculateWidth(n) }; i.prototype.filterRecord = function (n) { for (var e = n.length, o = this.cGroup.getColumnName().toLowerCase(), i = null, u = null, t, f, r = 0; r < e; r++)i = n[r], u = i[o], this.cGroupInfo[u] ? this.cGroupInfo[u].records.push(i) : (this.cGroupInfo.Other__1 || (this.cGroupInfo.Other__1 = { name: "Others", records: [] }, this.grpCount += 1), this.cGroupInfo.Other__1.records.push(i)); t = []; for (f in this.cGroupInfo) this.cGroupInfo[f].records.length < 1 && t.push(f); for (this.grpCount -= t.length; t.length > 0;)delete this.cGroupInfo[t.pop()] }; i.prototype.dispose = function () { this.dC() }; u.prototype.dispose = function () { this.dC() }; r.prototype.evaluate = function (t) { for (var i = null, r = 0; r < t.length; r++)(i = t[r], i.ConditionValue) && n.Evaluator.evaluateLogic(this, i.ConditionValue) && this.setColor(i.Color, i.FColor) }; r.prototype.getValueAsString = function (n) { var t = this.record[n.toLowerCase()]; return t ? (t === !0 ? t = "Y" : t && t.toString().endsWith(".000Z") && (t = t.replace(".000Z", "Z")), t = t.toString()) : t === !1 ? t = "N" : t === 0 && (t = "0"), t }; r.prototype.dispose = function () { this.dC() }; n.VCardView = i }(VIS, jQuery), function (n, t) { function i() { function r(n) { var i, r; return t.readOnly ? !1 : (i = t.grid.columns[n], !t.mTab.getTableModel().getIsInserting() && i.readOnly) ? !1 : (r = i.gridField, r.getIsEditable(!0, !0)) ? !0 : !1 } function u(n, i) { return t.readOnly ? !1 : i == t.indexActiveColumn && t.indexProcessedColumn == -1 ? !0 : f(n) ? !0 : !1 } function f(i) { var r, u; if (t.readOnly || i < 0) return !1; if (t.indexActiveColumn && t.indexActiveColumn > 0) if (r = t.grid.getCellValue(i, t.indexActiveColumn), typeof r == "boolean") { if (!r) return r } else if ("True".equals(r)) { if ("N".equals(r)) return !1 } else return !1; if (t.indexProcessedColumn && t.indexProcessedColumn > 0) if (u = t.grid.getCellValue(i, t.indexProcessedColumn), typeof u == "boolean") { if (u) return !1 } else if ("True".equals(u) || "Y".equals(u)) return !1; var f = e(i), o = f[0], s = f[1], h = f[2]; return n.MRole.canUpdate(o, s, t.AD_Table_ID, h, !1) } function e(i) { var e = -1, u, f, r; return typeof t.indexClientColumn != "undefined" && t.indexClientColumn != -1 && (r = t.grid.getCellValue(i, t.indexClientColumn), r != null && r !== "" && (e = n.Utility.Util.getValueOfInt(r))), u = 0, typeof t.indexOrgColumn != "undefined" && t.indexOrgColumn != -1 && (r = t.grid.getCellValue(i, t.indexOrgColumn), r != null && r !== "" && (u = n.Utility.Util.getValueOfInt(r))), f = 0, typeof t.indexKeyColumn != "undefined" && t.indexKeyColumn != -1 && (r = t.grid.getCellValue(i, t.indexKeyColumn), r != null && r !== "" && (f = n.Utility.Util.getValueOfInt(r))), [e, u, f] } this.grid = null; this.id = null; this.$container = null; this.rendered = !1; this.onSelect = null; this.onCellEditing = null; this.onCellValueChanged = null; this.onSort = null; this.onEdit = null; this.onAdd = null; this.editColumnIndex = -1; var t = this, i = { caption: "", sortable: !1, render: function () { return '<img src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/pencil.png"  />' }, size: "25px" }; this.getEditColumn = function () { return i }; this.onClick = function (n) { this.readOnly || (t.skipEditing = !1, this.records.length > 0 && this.records[t.mTab.getCurrentRow()].recid != n.recid && (t.skipEditing = !0)) }; this.onSingleClick = function () { }; this.onSelectLocal = function (n) { if (t.blockSelect) { t.blockSelect = !1; return } if (t.onSelect) t.onSelect(n) }; this.checkCellEditable = !0; this.onEditField = function (n) { if (t.skipEditing) { t.skipEditing = !1; n.isCancelled = !0; this.select({ recid: n.recid }); return } n.isCancelled = !r(n.column) || n.originalEvent && n.originalEvent.altKey; t.blockSelect = !n.isCancelled }; this.onChange = function (n) { if (t.grid.columns[n.column].editable.type == "checkbox") { if (this.records.length > 0 && this.records[t.mTab.getCurrentRow()].recid != n.recid) { n.isCancelled = !0; return } n.isCancelled = !r(n.column) } n.onComplete = function (n) { var i = { newValue: n.value_new, propertyName: t.grid.columns[n.column].field }; if (t.onCellValueChanged) t.onCellValueChanged(i, t.grid.columns[n.column].editable.type == "checkbox") } }; this.onUnSelect = function () { }; this.onRowAdd = function (n) { t.paintRow(n.index) }; this.paintRow = function (n) { var t = this.grid.records[n]; if (!u(n, 0)) { t.style = "background-color:rgba(var(--v-c-secondary), .7)"; return } t && t.style && delete t.style }; this.disposeComponenet = function () { t = null; i = null; this.getEditColumn = null; this.onClick = null } } i.prototype.ROW_ADD = "A"; i.prototype.ROW_DELETE = "D"; i.prototype.ROW_REFRESH = "F"; i.prototype.ROW_UNDO = "U"; i.prototype.setupGridTable = function (i, r, u, f, e, o) { var v, b, a, c, s, g, ft, p, nt, w; if (!e.getIsDisplayed(!0)) return 0; this.id = f; this.$container = u; this.mTab = e; this.AD_Table_ID = this.mTab.getAD_Table_ID(); var h = [], l = null, tt = r.length, k = 0, d = r.slice(0); for (d.sort(function (n, t) { return n.getMRSeqNo() - t.getMRSeqNo() }), v = -1, b = 0; b < d.length; b++)if (l = d[b], l != null) { a = l.getColumnName(); c = l.getDisplayType(); ++v; l.getIsKey() ? this.indexKeyColumn = v : a.equals("IsActive") ? this.indexActiveColumn = v : a.equals("Processed") ? this.indexProcessedColumn = v : a.equals("AD_Client_ID") ? this.indexClientColumn = v : a.equals("AD_Org_ID") && (this.indexOrgColumn = v); var y = l.getIsDisplayedMR ? l.getIsDisplayedMR() : l.getIsDisplayed(), it = l.getIsMandatory(!1), rt = l.getIsReadOnly(), ut = l.getIsEditable(!1); l.getIsHeading() || (s = { resizable: !0 }, s.gridField = l, (rt || !ut) && (s.readOnly = !0), s.caption = l.getHeader(), it && (s.caption += '<sup style="color:red;font-size: 11px;top: 0;">*<\/sup>'), s.field = a.toLowerCase(), s.hidden = !y, g = s.gridField.getColumnWidth(), s.size = g ? g + "px" : "100px", c == n.DisplayType.Amount ? (s.sortable = !0, s.customFormat = n.DisplayType.GetNumberFormat(c), s.render = function (n, t, i) { var u = h[i].field, r = n[u]; if (r) return parseFloat(r).toLocaleString(undefined, { minimumFractionDigits: h[i].customFormat.getMinFractionDigit(), maximumFractionDigits: h[i].customFormat.getMaxFractionDigit() }) }) : n.DisplayType.IsNumeric(c) ? (s.sortable = !0, s.customFormat = n.DisplayType.GetNumberFormat(c), s.render = function (n, t, i) { var u = h[i].field, r = n[u]; if (r) return parseFloat(r).toLocaleString(undefined, { minimumFractionDigits: h[i].customFormat.getMinFractionDigit(), maximumFractionDigits: h[i].customFormat.getMaxFractionDigit() }) }) : c == n.DisplayType.YesNo ? (s.sortable = !0, ft = a.toLowerCase(), s.editable = { type: "checkbox" }) : c == n.DisplayType.String || c == n.DisplayType.Text || c == n.DisplayType.TextLong || c == n.DisplayType.Memo ? (s.sortable = !0, s.render = l.getIsEncryptedField() ? function (n, t, i) { var u = h[i].field, r = n[u]; return (n.changes && typeof n.changes[u] != "undefined" && (r = n.changes[u]), r = n[h[i].field], r || r === 0) ? r.replace(/\w|\W/g, "*") : "" } : function (n, t, i) { var u = h[i].field, r = n[u]; return (n.changes && typeof n.changes[u] != "undefined" && (r = n.changes[u]), r || r == 0) ? w2utils.encodeTags(r) : "" }) : n.DisplayType.IsLookup(c) || c == n.DisplayType.ID ? (s.sortable = !0, s.lookup = l.getLookup(), y && (s.render = function (n, t, i) { var r = h[i].lookup, u = h[i].field, e = n[u], f; return n.changes && typeof n.changes[u] != "undefined", r && (f = r.getDisplay(e, !0)), f })) : n.DisplayType.IsDate(c) ? (s.sortable = !0, s.displayType = c, s.render = function (t, i, r) { var o = h[r], e = h[r].field, u = t[e], f; return t.changes && typeof t.changes[e] != "undefined" && (u = t.changes[e]), u ? o.displayType == n.DisplayType.Date ? (f = new Date(u), f.setMinutes(f.getTimezoneOffset() + f.getMinutes()), u = f.toLocaleDateString()) : u = o.displayType == n.DisplayType.DateTime ? new Date(u).toLocaleString() : new Date(u).toTimeString() : u = "", u }) : c == n.DisplayType.Location || c == n.DisplayType.Locator ? (s.sortable = !0, s.lookup = l.getLookup(), y && (s.render = function (n, t, i) { var f = h[i].lookup, u = h[i].field, r = n[u]; return n.changes && typeof n.changes[u] != "undefined" && (r = n.changes[u]), f && (r = f.getDisplay(r, !0), r = w2utils.encodeTags(r)), r })) : c == n.DisplayType.AmtDimension ? (s.sortable = !0, s.lookup = l.getLookup(), y && (s.render = function (n, t, i) { var f = h[i].lookup, u = h[i].field, r = n[u]; return n.changes && typeof n.changes[u] != "undefined" && (r = n.changes[u]), f && (r = f.getDisplay(r, !0), r = w2utils.encodeTags(r)), r })) : c == n.DisplayType.ProductContainer ? (s.sortable = !0, s.lookup = l.getLookup(), y && (s.render = function (n, t, i) { var f = h[i].lookup, u = h[i].field, r = n[u]; return n.changes && typeof n.changes[u] != "undefined" && (r = n.changes[u]), f && (r = f.getDisplay(r, !0), r = w2utils.encodeTags(r)), r })) : c == n.DisplayType.Account || c == n.DisplayType.PAttribute ? (s.sortable = !0, s.lookup = l.getLookup(), y && (s.render = function (n, t, i) { var f = h[i].lookup, u = h[i].field, r = n[u]; return n.changes && typeof n.changes[u] != "undefined" && (r = n.changes[u]), f && (r = f.getDisplay(r, !0), r = w2utils.encodeTags(r)), r })) : c == n.DisplayType.PAttribute ? (s.sortable = !0, s.render = "int") : c == n.DisplayType.Button ? s.sortable = !0 : c == n.DisplayType.Image ? (s.sortable = !0, s.render = function (t, i, r) { var u = h[r].field, f = t[u]; return (t.changes && typeof t.changes[u] != "undefined" && (f = t.changes[u]), !f) ? "-" : n.Msg.getElement1("AD_Image_ID") + "-" + f }) : n.DisplayType.IsLOB(c) ? (s.sortable = !0, s.render = function (n, t, i) { var u = h[i].field, r = n[u]; return n.changes && typeof n.changes[u] != "undefined" && (r = n.changes[u]), r || (r = ""), "#" + r.toString().length }) : (s.sortable = !0, s.render = function (n, t, i) { var u = h[i].field, r = n[u]; return (n.changes && typeof n.changes[u] != "undefined" && (r = n.changes[u]), r || r == 0) ? w2utils.encodeTags(r) : "" }), l.getHtmlStyle() != "" && (s.style = l.getHtmlStyle()), s.hidden || k++ , h.push(s), s.columnName = a, p = n.VControlFactory.getControl(e, l, !1, !1, !1), p.setReadOnly(!1), s.editable || (s.editable = { type: "custom", ctrl: p }), p.addVetoableChangeListener(o), p instanceof n.Controls.VButton && p.addActionListner(i)) } if (k > 0) { nt = Math.floor(100 / k); for (w in h) h[w].hidden || !h[w].size < 0 && (h[w].size = nt + "%", h[w].min = 100) } return this.grid = t().w2grid({ name: f, autoLoad: !1, columns: h, records: [], show: { toolbar: !1, columnHeaders: !0, lineNumbers: !1, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, recordHeight: 41, onSelect: this.onSelectLocal, onUnselect: this.onUnSelect, onSort: this.onSort, onClick: this.onSingleClick, onDblClick: this.onClick, onEditField: this.onEditField, onChange: this.onChange, onRowAdd: this.onRowAdd }), tt }; i.prototype.get = function (n, t) { return this.grid.get(n, t) }; i.prototype.activate = function () { this.grid && !this.rendred && (this.$container.w2render(this.grid.name), this.rendred = !0) }; i.prototype.setReadOnly = function (n) { this.readOnly = n }; i.prototype.getGrid = function () { return this.grid }; i.prototype.select = function (n) { var t = this.grid.getSelection(); if (t.indexOf(n) == -1) { if (t.length == 1) this.grid.unselect(t[0]); else if (t.length > 1) while (t.length > 0) this.grid.unselect(t.pop()); return this.grid.select(n) } }; i.prototype.add = function (n) { this.grid.add(n) }; i.prototype.clear = function () { this.grid.clear(!0); this.grid.reset() }; i.prototype.refresh = function () { this.grid.refresh() }; i.prototype.resize = function () { this.grid.resize() }; i.prototype.setRow = function (n) { isNaN(n) ? this.grid.set(n.recid, n) : this.grid.set(n) }; i.prototype.refreshRow = function (n, t) { if (!(this.grid.records.length < 1)) { var i = this.mTab.getCurrentRow(); i < 0 || (typeof n != "undefined" && (i = n), this.paintRow(t ? this.grid.get(n, !0) : i), this.grid.clearRowChanges(t ? n : this.grid.records[i].recid)) } }; i.prototype.refreshCells = function () { if (!(this.grid.records.length < 1)) { var n = this.mTab.getCurrentRow(); this.paintRow(n); this.grid.refreshRow(this.grid.records[n].recid) } }; i.prototype.refreshUndo = function () { if (!(this.grid.records.length < 1)) { var n = this.mTab.getCurrentRow(); this.grid.clearRowChanges(this.grid.records[n].recid); this.paintRow(n); this.grid.refreshRow(this.grid.records[n].recid) } }; i.prototype.getSelection = function (n) { return this.grid.getSelection(n) }; i.prototype.getSelectedRows = function () { for (var t = this.grid.getSelection(!0), i = [], n = 0, r = t.length; n < r; n++)i.push(this.grid.records[t[n]]); return i }; i.prototype.getColumnNames = function () { for (var t = this.grid.columns, i = {}, n = 0, r = t.length; n < r; n++)i[t[n].columnName] = t[n].caption; return i }; i.prototype.scrollInView = function (n) { this.grid.scrollIntoView(n) }; i.prototype.tableModelChanged = function (t, i, r) { var u, f, e; if (this.blockSelect = !0, t === n.VTable.prototype.ROW_REFRESH) this.setRow(i), this.refreshRow(i.recid, !0); else { if (u = null, t === n.VTable.prototype.ROW_UNDO) this.grid.unselect(i), this.grid.remove(i), r >= this.grid.records.length - 1 && this.grid.records.length > 0 ? (this.blockSelect = !1, u = this.grid.records[this.grid.records.length - 1].recid) : r < this.grid.records.length && (u = this.grid.records[r].recid); else if (t === n.VTable.prototype.ROW_ADD) this.grid.records.splice(r, 0, i), u = i.recid, this.grid.refresh(), this.blockSelect = !0; else if (t === n.VTable.prototype.ROW_DELETE) { for (f = i.slice(); f.length > 0;)e = f.pop(), this.grid.unselect(e), this.grid.remove(e); isNaN(r) ? u = r[0] : this.grid.records.length > 0 && (u = this.grid.records[this.grid.records.length - 1 < r ? this.grid.records.length - 1 : r].recid) } u && this.select(u) } this.blockSelect = !1 }; i.prototype.setDefaultFocus = function (n) { var t = this.grid.getSelection(), i = this.grid.getColumn(n.toLower(), !0); t && t.length > 0 && this.grid.dblClick(t[0], { metaKey: !0 }) }; i.prototype.dispose = function () { var n, t; this.grid.off("select", this.onSelect); this.grid.off("sort", this.onSort); this.grid.off("click", this.onClick); this.onSelect = null; this.onSort = null; n = this.grid.columns; for (t in n) n[t].editable.ctrl && n[t].editable.ctrl.dispose(); this.grid.destroy(); this.grid = null; this.id = null; this.$container = null; this.rendered = null; this.disposeComponenet() }; n.VTable = i }(VIS, jQuery), function (n, t) { function i() { function y(t, i) { var u = new google.maps.Marker({ position: t, animation: google.maps.Animation.DROP, map: n, title: i }); u.info = new google.maps.InfoWindow({ content: i }); u.info.open(n, u); google.maps.event.addListener(u, "click", function () { this.info.open(n, this) }); r.push(u) } function p(n, t, i) { window.setTimeout(function () { y(n, t) }, i) } function a(n) { for (var t = 0; t < r.length; t++)r[t].setMap(n), google.maps.event.clearListeners(r[t], "click"), r[t].info = null } function w() { a(null) } function v() { w(); r = [] } function b() { v(); n = null } function k() { n || (n = new google.maps.Map(f[0], c), d()) } function d() { var r = "", t = i.mapFields, n; if (t.length > 1) { for (n = 0; n < t.length; n++)r += "<option value=" + t[n].getColumnName() + " >" + t[n].getHeader() + "<\/option>"; o.html(r); o[0].selectedIndex = 0; nt() } else s.hide(), f.css("top", "0") } function g() { f = t('<div class="vis-mv-map">'); e = t('<div class="vis-apanel-busy vis-full-height">').hide(); s = t('<div class="vis-mv-header"> <select class="vis-mv-select vis-pull-right" /> <\/div>'); o = s.find(".vis-mv-select"); h.append(s).append(f).append(e); l && (c = { center: new google.maps.LatLng(26, 76), zoom: 4, mapTypeId: google.maps.MapTypeId.ROADMAP }) } function nt() { o.on("change", function () { i.setBusy(!0); i.curIndex = this.selectedIndex; i.setMapData(i.mapcols[i.curIndex]) }) } var n = null, h = t('<div class="vis-mv-main">'), f = "", e = "", r = [], c, u = null, o = null, s = null, i = this, l = window.google && google.maps ? !0 : !1; g(); this.setBusy = function (n) { n ? e.show() : e.hide() }; this.getRoot = function () { return h }; this.sizeChanged = function () { }; this.setMapData = function (t) { var e, r, f; if (l) { for (k(), v(), u = null, u = new google.maps.LatLngBounds, google.maps.event.trigger(n, "resize"), e = t.length, r = 0; r < e; r++)if (t[r].Latitude && t[r].Longitude) { f = null; try { f = new google.maps.LatLng(Number(t[r].Latitude), Number(t[r].Longitude)); p(f, t[r].msg, 100); u.extend(f); n.fitBounds(u) } catch (o) { console.log(o) } } n.fitBounds(u); i.setBusy(!1) } }; this.dc = function () { b(); h.remove(); this.cols = this.gc = this.aPanel = this.mapcols = null; this.mapFields = null; this.curIndex = 0; this.getRoot = null; this.dc = null } } i.prototype.setupMapView = function (n, t, i, r) { var u, f, e; for (this.mapFields = [], u = i.getMapColumns(), f = 0; f < u.length; f++)e = i.getField(u[f]), e && this.mapFields.push(e); this.cols = u; this.gc = t; this.aPanel = n; this.mapcols = {}; this.curIndex = 0; r.append(this.getRoot()) }; i.prototype.refreshUI = function () { var u = this.gc.getSelectedRows(), o = u.length, s, n, t, i, r; if (!(u.length < 1) && !(this.cols.length < 1)) { for (s = [[]], n = 0; n < this.cols.length; n++) { var h = this.cols[n], f = this.mapFields[n].getLookup(), e = []; for (t = 0; t < o; t++)i = u[t][h.toLowerCase()], i && (r = f.getLatLng(i), r && (r.msg = f.getDisplay(i), e.push(r))); this.mapcols[n] = e } this.setMapData(this.mapcols[this.curIndex]) } }; i.prototype.dispose = function () { this.dc() }; n.VMapView = i }(VIS, jQuery), function (n, t) { function u(n, i, r) { var u = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } var r = document.querySelector("#vis-ad-viewctrltmp").content, f = function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, f; return i && (o.param = i), f = null, u(o, e, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); f = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; e && r(f) }), f }, i = n.Application.contextUrl, o = i + "Form/JDataSet", e = i + "JsonData/JDataSetWithCode"; n.GridController = function (i, u, f) { function tt() { var n = document.importNode(r, !0); o = t(n.querySelector(".vis-ad-w-p-vc")).hide(); d = o.find(".vis-ad-w-p-vc-tree").hide(); v = o.find(".vis-ad-w-p-vc-actions").hide(); y = o.find(".vis-ad-w-p-vc-header"); h = t("<div class='vis-gc-vtable'>"); s = t("<div class='vis-ad-w-p-vc-editview' id='AS_" + f + "'>"); l = t("<div class='vis-gc-vcard'>"); a = t("<div class='vis-gc-vmap'>"); g = o.find(".vis-ad-w-p-vc-gc"); g.append(h).append(s).append(l).append(a) } function it() { nt = new n.AppsAction({ action: "new", parent: null, enableDisable: !0, toggle: !1, imageOnly: !0, isSmall: !0, onAction: k }); p = new n.AppsAction({ action: "edit", parent: null, enableDisable: !0, toggle: !1, imageOnly: !0, isSmall: !0, onAction: k }); v.append(p.getListItm()).append(nt.getListItm()) } var c, e, k; this.id = f; this.vGridPanel = new n.VGridPanel; this.vTable = new n.VTable; this.vCardView = new n.VCardView; this.vMapView = new n.VMapView; this.vHeaderPanel = null; this.windowNo = 0; this.aPanel = null; this.singleRow = !1; this.isCardRow = !1; this.doPaging = u; this.vIncludedGC = null; this.m_tree = null; this.onRowInserted = null; this.onRowInserting = null; this.rightPaneLinkItems = []; this.leftPaneLinkItems = []; this.showClient = !1; this.showOrg = !1; c = n.Env.getCtx().getShowClientOrg(); c == n.Env.SHOW_CLIENT_ONLY ? this.showClient = !0 : c == n.Env.SHOW_ORG_ONLY ? this.showOrg = !0 : c == n.Env.SHOW_CLIENT_ORG && (this.showOrg = !0, this.showClient = !0); this.isParentDetailVisible = !1; this.isIncludedGCVisible = !1; this.displayAsIncludedGC = !1; var s, l, a, v, o, y, w = [], h, d, g, b = null, nt, p = null; tt(); e = this; k = function (n) { if (n == "edit") { if (e.displayAsIncludedGC) { e.aPanel.tabActionPerformed(e.id) && e.switchSingleRow(); return } } else if (e.displayAsIncludedGC) { if (!e.aPanel.tabActionPerformed(e.id)) return; e.switchSingleRow(); setTimeout(function (n) { n.aPanel.cmd_new() }, 500, e) } }; it(); this.initLayout = function () { this.layoutLoaded = !0 }; this.sizeChanged = function () { }; this.sizeChanged(); s.append(this.vGridPanel.getRoot()); this.getRoot = function () { return o }; this.getTreeArea = function () { return d }; this.getId = function () { return f }; this.setRecord = function () { }; this.getVTablePanel = function () { return h }; this.getVPanel = function () { return s }; this.getVCardPanel = function () { return l }; this.getVMapPanel = function () { return a }; this.setUI = function (n) { n ? (y.html(this.gTab.getName()), y.css("display", "block"), v.css("display", "flex"), p.setEnabled(!1), this.vTable.grid.show.selectColumn = !1) : (y.css("display", "none"), v.css("display", "none"), this.vTable.grid.show.selectColumn = !0) }; this.enableDisableToolbarItems = function (n) { p.setEnabled(n) }; this.vTable.onSelect = function (n) { e.aPanel && e.aPanel.setBusy && e.aPanel.setBusy(!0); e.cancelSel = !1; e.onTableRowSelect(n); e.cancelSel && (n.isCancelled = !0); e.aPanel && e.aPanel.setBusy && e.aPanel.setBusy(!1) }; this.vTable.onCellValueChanged = function (n, t) { t ? window.setTimeout(function () { e.vetoablechange(n); e.vTable.refreshCells() }, 10) : (e.vetoablechange(n), e.vTable.refreshCells()) }; this.vCardView.onCardEdit = function (n, t) { e.onTableRowSelect(n); t || e.switchSingleRow() }; this.vTable.onSort = function () { window.setTimeout(function () { e.navigate(e.gTab.getCurrentRow(), !0) }, 10) }; this.disposeComponent = function () { this.rightPaneLinkItems.length = 0; this.rightPaneLinkItems = null; this.leftPaneLinkItems.length = 0; this.leftPaneLinkItems = null; h = null; $divRecords = null; for (var n = 0; n < w.length; n++)w[n].dispose("ul_" + this.id); w = null; this.seletedTab = null; this.vGridPanel.dispose(); this.vGridPanel = null; this.vCardView.dispose(); this.vCardView.onSelect = null; this.vMapView.dispose(); this.vTable.dispose(); this.vTable.onSelect = null; this.vTable.onSort = null; this.vTable = null; h = null; s = null; l = null; a = null; e = null; this.getId = null; this.getReocrdDiv = null; this.getRoot = null; this.getVTablePanel = null; this.getVPanel = null; this.getVCardPanel = null; o.remove(); o = null; b && b.destroy(); b = null; this.onRowInserted = null } }; n.GridController.prototype.initTabPanel = function (t, i) { this.vTabPanel = new n.VTabPanel(i, t); this.vTabPanel.init(this.getMTab()); this.vTabPanel.addSizeChangeListner(this) }; n.GridController.prototype.initHeaderPanel = function (t) { this.vHeaderPanel = new n.HeaderPanel(t); this.vHeaderPanel.init(this.getMTab()); this.vHeaderPanel.addSizeChangeListner(this) }; n.GridController.prototype.getTabPanel = function () { return this.vTabPanel.getRoot() }; n.GridController.prototype.onSizeChanged = function () { this.multiRowResize(); this.vIncludedGC && this.vIncludedGC.multiRowResize() }; n.GridController.prototype.refreshTabPanelData = function (n) { this.vTabPanel && this.vTabPanel.refreshPanelData(n, this.gTab.getTableModel().getRow(this.gTab.getCurrentRow())) }; n.GridController.prototype.initGrid = function (t, i, r, u) { var a = u.gridTable.gridFields, o = null, p = i + "_" + u.vo.AD_Tab_ID, w = i + "_c" + u.vo.AD_Tab_ID, b = i + "_m" + u.vo.AD_Tab_ID, l, v, h, e, s, y, c; if (u.getTableModel().setDoPaging(this.doPaging), l = n.MRole, l.getIsDisplayClient() && this.showClient || u.getField("AD_Client_ID").setDisplayed(!1), l.getIsDisplayOrg() && this.showOrg || u.getField("AD_Org_ID").setDisplayed(!1), v = this.vTable.setupGridTable(r, a, this.getVTablePanel(), p, u, this), u.addDataStatusListener(this), !t) { for (this.vCardView.setupCardView(r, u, this.getVCardPanel(), w), u.getIsMapView() && this.vMapView.setupMapView(r, this, u, this.getVMapPanel(), b), h = 0; h < v; h++)if (o = a[h], o.getIsDisplayed()) { if (e = n.VControlFactory.getControl(u, o, !1, !1, !1), e == null && !o.getIsHeading()) continue; e != null && (e.setReadOnly(!0), o.setPropertyChangeListener(e), e.addVetoableChangeListener(this)); this.vGridPanel.addField(e, o); e instanceof n.Controls.VButton && (o.getIsLink() && (o.getIsRightPaneLink() ? this.rightPaneLinkItems.push(e) : this.leftPaneLinkItems.push(e)), e.addActionListner(r)); e = null } this.vGridPanel.flushLayout() } s = 0; u.getIsTreeTab() && (y = "VIS_120", c = [], c[0] = new n.DB.SqlParam("@AD_Client_ID", n.Env.getCtx().getAD_Client_ID()), c[1] = new n.DB.SqlParam("@AD_Table_ID", u.getAD_Table_ID()), s = f(y, c), s > 0 && (this.treeID = s, u.getShowSummaryLevel() ? (this.onDemandTree = !0, this.m_tree = new n.TreePanel(i, !1, !0, !0, this), r.aShowSummaryLevel.show()) : (this.onDemandTree = !1, this.m_tree = new n.TreePanel(i, !1, !0, !1, this), r.aShowSummaryLevel.hide()), this.m_tree.setTabID(u.getAD_Tab_ID()), u.getTabNo() == 0 && this.m_tree.initTree(s), this.getTreeArea().append(this.m_tree.getRoot()), this.m_tree.addSelectionChangeListner(this), this.getTreeArea().show())); u.getTableModel().addTableModelListener(this.vTable); u.getTableModel().addCardModelListener(this.vCardView); u.getTableModel().addRowChangedListener(this); u.getTableModel().addQueryCompleteListner(this); u.getTableModel().setDoPaging(this.doPaging); u.getTableModel().setCurrentPage(1); this.gTab = u; this.windowNo = i; this.onlyMultiRow = t; this.aPanel = r; t || !u.getIsSingleRow() ? this.singleRow = !1 : this.switchSingleRow(!0) }; n.GridController.prototype.getIsHeaderPanel = function () { return this.gTab.getIsHeaderPanel() }; n.GridController.prototype.detachDynamicAction = function () { for (var n = 0, t = 0, n = 0, t = this.leftPaneLinkItems.length; n < t; n++)this.leftPaneLinkItems[n].getControl().detach(); for (n = 0, t = this.rightPaneLinkItems.length; n < t; n++)this.rightPaneLinkItems[n].getControl().detach(); n = null; t = null; this.vTabPanel && this.vTabPanel.getRoot().detach() }; n.GridController.prototype.switchRowPresentation = function () { this.singleRow ? this.switchMultiRow() : this.switchSingleRow() }; n.GridController.prototype.getIsSingleRow = function () { return this.singleRow }; n.GridController.prototype.getIsMapRow = function () { return this.isMapRow }; n.GridController.prototype.onTableRowSelect = function (n) { var i, r, t; if (!this.rowSetting && this.gTab.getRowCount() != 0) { if (i = this.vTable.get(n.recid, !0), r = this.gTab.getCurrentRow(), i == -1 && r >= 0) { this.vTable.select(n.recid); this.vCardView.navigate(n.recid, !this.isCardRow); return } if (i != r) this.rowSetting = !0, this.navigate(i), this.rowSetting = !1; else if (!this.settingGridSelecton) return; this.dynamicDisplay(-1); t = this; this.getIsSingleRow() ? t.vIncludedGC != null && t.switchIncludedGC() : window.setTimeout(function () { t.vIncludedGC != null && t.switchIncludedGC() }, 50) } }; n.GridController.prototype.switchIncludedGC = function () { this.vIncludedGC != null && this.switchIncludedGC() }; n.GridController.prototype.dynamicDisplay = function (t) { var l, e, r, i, u, o, f, c; if (this.gTab != null && !this.isCardRow && !this.isMapRow) { if (l = this.gTab.getRecord_ID(), !this.getIsSingleRow()) { this.dynamicDisplayLinks(t); return } if (this.gTab.getIsOpen()) { if (t >= 0) { var s = this.gTab.getField(t), i = s.getColumnName(), a = this.gTab.getDependantFields(i); if (a.length == 0 && s.getCallout().length > 0) return } var v = this.gTab.getRowCount() == 0, h = this.vGridPanel.getComponents(), y = h.length; for (e = 0; e < y; e++)r = h[e], i = r.getName(), i != null && (i.startsWith("lbl") && (i = i.substring(3)), u = this.gTab.getField(i), u != null && (u.getIsDisplayed(!0) ? (o = r.tag, !r.getIsVisible() && (o == null || o == "undefined" || o) && (r.setVisible(!0), this.vGridPanel.setVisible(i, !0)), r instanceof n.Controls.IControl && (f = r, v ? f.setReadOnly(!0) : (c = u.getIsEditable(!0) && !this.gTab.getIsReadOnly(), f.setReadOnly(!c), f.setMandatory(u.getIsMandatory(!0)), f.setBackground(u.getIsError()), !u.getIsDefaultFocus() || this.isDefaultFocusSet || r.getName().startsWith("lbl") || (f.setDefaultFocus(!0), this.isDefaultFocusSet = !0)))) : r.getIsVisible() && (r.setVisible(!1), this.vGridPanel.setVisible(i, !1)), u.getIsDisplayed(!0) || u.getIsMandatory(!0) || u.setError(!1))) } } }; n.GridController.prototype.dynamicDisplayLinks = function () { var s, o, f, t, r, i, e, u, h; if (!this.displayAsIncludedGC) for (s = this.gTab.getRowCount() == 0, o = this.vGridPanel.getLinkComponents(), f = 0; f < o.length; f++)t = o[f], r = t.getName(), r != null && (r.startsWith("lbl") && (r = r.substring(3)), i = this.gTab.getField(r), i != null && (i.getIsDisplayed(!0) ? (e = t.tag, !t.getIsVisible() && (e == null || e == "undefined" || e) && t.setVisible(!0), t instanceof n.Controls.IControl && (u = t, s ? u.setReadOnly(!0) : (h = i.getIsEditable(!0) && !this.gTab.getIsReadOnly(), u.setReadOnly(!h), u.setMandatory(i.getIsMandatory(!0)), u.setBackground(i.getIsError())))) : t.getIsVisible() && t.setVisible(!1), i.getIsDisplayed(!0) || i.getIsMandatory(!0) || i.setError(!1))) }; n.GridController.prototype.setDefaultFocus = function () { for (var e = this.gTab.getRowCount() == 0, r = this.vGridPanel.getComponents(), f = r.length, u, t, i, n = 0; n < f; n++)if (u = r[n], t = u.getName(), t != null && (i = this.gTab.getField(t), i != null && i.getIsDefaultFocus())) { this.vTable.setDefaultFocus(t); break } }; n.GridController.prototype.setVisible = function (n) { this.layoutLoaded || this.initLayout(); n ? (this.getRoot().show(), this.vTable.resize()) : this.getRoot().hide() }; n.GridController.prototype.getMTab = function () { return this.gTab }; n.GridController.prototype.getIsDisplayed = function () { return this.gTab.getIsDisplayed(!1) }; n.GridController.prototype.getTabLevel = function () { return this.gTab.getTabLevel() }; n.GridController.prototype.getTitle = function () { return this.gTab.getName() }; n.GridController.prototype.getSelection = function (n) { return this.vTable.getSelection(n) }; n.GridController.prototype.getSelectedRows = function () { return this.vTable.getSelectedRows() }; n.GridController.prototype.getColumnNames = function () { var t, i, n; if (this.colNames) return this.colNames; for (t = this.gTab.getTableModel().getFields(), i = {}, n = 0; n < t.length; n++)i[t[n].getColumnName()] = t[n].getHeader(); return this.colNames = i, this.colNames }; n.GridController.prototype.setMnemonics = function () { }; n.GridController.prototype.activate = function (n) { var t, i; this.vTable.activate(); n = n || {}; this.vTable.setReadOnly(!1); this.displayAsIncludedGC ? (i = this.aPanel.getLayout(), this.setUI(!1), this.getRoot().detach(), i.append(this.getRoot()), this.displayAsIncludedGC = !1, this.aPanel.getIncludedEmptyArea().css({ display: "none" })) : this.gTab.getIncluded_Tab_ID() == 0 && (t = n.vIncludedGC, t && (i = t.aPanel.getLayout(), t.setUI(!1), t.getRoot().detach(), this.aPanel.getIncludedEmptyArea().css({ display: "none" }))); this.isIncludedGCVisible = !1; this.vIncludedGC && (this.vIncludedGC.displayAsIncludedGC = !1, this.vIncludedGC.isIncludedGCVisible = !1); this.activateTree() }; n.GridController.prototype.multiRowResize = function () { this.singleRow || this.isCardRow || this.vTable.resize() }; n.GridController.prototype.activateTree = function () { var t, i, r, e, o, s, u, f; if (this.gTab.getIsTreeTab() && this.gTab.getTabNo() > 0) { if (t = 0, this.gTab.getTabLevel() > 0 && (i = this.gTab.getKeyColumnName(), r = "AD_Tree_ID", i.startsWith("CM") && (i.equals("CM_Container_ID") ? r = "AD_TreeCMC_ID" : i.equals("CM_CStage_ID") ? r = "AD_TreeCMS_ID" : i.equals("CM_Template_ID") ? r = "AD_TreeCMT_ID" : i.equals("CM_Media_ID") && (r = "AD_TreeCMM_ID")), t = n.Env.getCtx().getWindowContextAsInt(this.windowNo, r)), t == 0) { if (e = this.gTab.getAD_Table_ID(), o = n.Env.getCtx().getAD_Client_ID(), e == 0) return 0; s = "VIS_121"; u = []; u[0] = new n.DB.SqlParam("@AD_Client_ID", o); u[1] = new n.DB.SqlParam("@AD_Table_ID", e); f = executeReader(s, u); f.read() && (t = f.getInt(0)); f = null } this.m_tree != null && t > 0 && this.m_tree.initTree(t) } }; n.GridController.prototype.nodeSelectionChanged = function (n) { var u, t, f, r, i; if (n != null && (u = n.newValue, u != null)) { if (t = u, this.treeNodeID = t, this.onDemandTree) { this.aPanel && this.aPanel.setBusy && this.aPanel.setBusy(!0); this.gTab.setTreeNodeID(t); this.gTab.gridTable.setCurrentPage(1); this.gTab.setQuery(null); this.navigate(0); this.query(0, 0, !1, t, this.treeID, this.gTab.getAD_Table_ID()); return } for (f = this.gTab.getRowCount(), r = -1, i = 0; i < f; i++)if (this.gTab.getKeyID(i) == t) { r = i; break } r != -1 && this.navigate(r) } }; n.GridController.prototype.skipRowInserting = function (n) { this.skipInserting = n }; n.GridController.prototype.query = function (n, t, i, r, u, f) { this.aPanel && this.aPanel.setBusy && this.aPanel.setBusy(!0); this.onDemandTree && (r && this.gTab.setTreeNodeID(r), u && this.gTab.setTreeID(u), f && this.gTab.setTreeTable(f), this.aPanel.isSummaryVisible ? this.gTab.setShowSummaryNodes(!0) : this.gTab.setShowSummaryNodes(!1)); var e = this.gTab.prepareQuery(n, t, i, !1) }; n.GridController.prototype.queryCompleted = function () { this.vTable.clear(); this.gTab.clearSelectedRow(); this.vTable.add(this.gTab.getTableModel().getDataTable()); this.gTab.getTableModel().setSortModel(this.vTable.getGrid().records); this.displayAsIncludedGC || (this.onRowInserting ? this.onRowInserting() : this.checkInsertNewRow()); this.navigate(this.gTab.getCurrentRow(), !this.gTab.getTableModel().getIsInserting()); this.isCardRow && this.vCardView.refreshUI(this.getVCardPanel().width()); this.isMapRow && this.vMapView.refreshUI(this.getVMapPanel().width()); this.aPanel && this.aPanel.setBusy(!1); this.skipInserting = !1; this.dynamicDisplay(-1) }; n.GridController.prototype.checkInsertNewRow = function () { if (this.aPanel == null) return !1; var t = !0, i = this.gTab.getLinkColumnName(), r = n.context.getWindowContext(this.windowNo, i); return (i.Length > 0 && r.length == 0 && (t = !1), this.gTab.getTableModel().getTotalRowCount() == 0 && !this.gTab.getIsReadOnly() && (n.context.getIsAutoNew(this.windowNo) || this.gTab.getIsQueryNewRecord()) && t && this.gTab.getIsInsertRecord() && !this.skipInserting) ? (this.dataNew(!1), !0) : !1 }; n.GridController.prototype.vetoablechange = function (n) { var t = this.gTab.getTableModel(), i = this.gTab.getCurrentRow(), r = t.findColumn(n.propertyName); t.setValueAt(n.newValue, i, r) }; n.GridController.prototype.refreshUI = function () { this.dataRefreshAll() }; n.GridController.prototype.navigate = function (i, r) { var u; if (!r && i == this.gTab.getCurrentRow()) return this.gTab.getCurrentRow(); if (u = this.gTab.navigate(i, !0, r), u > -1 && !this.rowSetting ? (this.settingGridSelecton = !0, this.vTable.select(u), this.settingGridSelecton = !1, this.vCardView.navigate(u, !this.isCardRow)) : u > -1 && this.vCardView.navigate(u, !0), this.vHeaderPanel && this.vHeaderPanel.navigate(), u == -1) { this.cancelSel = !0; return } if (u > -1 && this.refreshTabPanelData(this.gTab.getRecord_ID()), this.m_tree != null && this.m_tree.setSelectedNode(this.gTab.getRecord_ID()), this.vTable.scrollInView(i), this.onDemandTree) { var f = this.gTab.getRecord_ID(), e = this.treeID, o = this.aPanel; t.ajax({ url: n.Application.contextUrl + "JsonData/GetTreeNodePath", data: { nodeID: f, treeID: e }, success: function (n) { var t = JSON.parse(n); o.setStatusLine(t) }, error: function (n) { console.log(n) } }) } return this.gTab.getCurrentRow() }; n.GridController.prototype.navigatePageExact = function (n) { this.gTab.getTableModel().setCurrentPage(n); this.query(this.gTab.getOnlyCurrentDays(), 0, !1, this.treeNodeID, this.treeID, this.gTab.getAD_Table_ID()) }; n.GridController.prototype.navigatePage = function (n) { this.gTab.getTableModel().setCurrentPageRelative(n); this.query(this.gTab.getOnlyCurrentDays(), 0, !1, this.treeNodeID, this.treeID, this.gTab.getAD_Table_ID()) }; n.GridController.prototype.navigateRelative = function (n) { return this.navigate(this.gTab.getCurrentRow() + n) }; n.GridController.prototype.dataRefresh = function () { var n = this.gTab.dataRefresh(); this.dynamicDisplay(-1); window.setTimeout(function (n) { n.switchIncludedGC(); n = null }, 500, this) }; n.GridController.prototype.dataRefreshAll = function () { this.gTab.getTableModel().dataRefreshAll() }; n.GridController.prototype.dataSave = function (n) { this.m_tree != null && this.gTab.SetSelectedNode(this.m_tree.currentNode); var t = this.gTab.dataSave(n); return t, t }; n.GridController.prototype.dataNew = function (n) { this.isDefaultFocusSet = !1; this.gTab.dataNew(n); this.dynamicDisplay(-1); this.switchIncludedGC(); this.onRowInserted && this.onRowInserted(); this.isDefaultFocusSet = !0 }; n.GridController.prototype.canDeleteRecords = function () { for (var i = this.vTable.getSelection(!0), f = this.vTable.getGrid().records, u = [], r, t = 0; t < i.length; t++)r = f[i[t]], "ad_client_id" in r && (n.MRole.getIsClientAccess(r.ad_client_id, !0) || u.push(i[t])); return u }; n.GridController.prototype.dataDelete = function () { var n = this.gTab.dataDelete(this.vTable.getSelection(!0)); return this.refreshTabPanelData(this.gTab.getRecord_ID()), this.dynamicDisplay(-1), n }; n.GridController.prototype.rowChanged = function (n, i) { var r; if (this.m_tree != null) { if (t.isArray(i) && !n) { for (r = 0; r < i.length; r++)this.m_tree.nodeChanged(n, i[r], "", "", "", ""); return } if (!(i <= 0)) { var f = this.gTab.getValue("Name"), e = this.gTab.getValue("Description"), u = this.gTab.getValue("IsSummary"), o = u == !0 || u == "Y", s = this.gTab.getValue("Action"); this.m_tree.nodeChanged(n, i, f, e, o, s) } } }; n.GridController.prototype.dataIgnore = function () { this.gTab.dataIgnore(); this.dynamicDisplay(-1); this.switchIncludedGC(); this.vTable.refreshUndo() }; n.GridController.prototype.dataStatusChanged = function (t) { var r, i, f, e, u, o, s, h; if (this.displayAsIncludedGC) { this.enableDisableToolbarItems(!0); return } if (this.aPanel.dataStatusChanged(t), r = t.getChangedColumn(), t.getIsChanged() && !(r < 0)) { if (i = this.gTab.getField(r), i != null) if (i.getCallout().length > 0) f = this.gTab.processFieldChange(i), f.length > 0 && n.ADialog.error(f); else for (e = i.getColumnName(), dependants = this.gTab.getDependantFields(e), u = 0; u < dependants.length; u++)(o = dependants[u], o != null) && (s = o.getLookup(), s != null) && (h = s.getValidation(), h.indexOf(e) != -1); this.dynamicDisplay(r); this.vHeaderPanel && this.vHeaderPanel.navigate() } }; n.GridController.prototype.includeTab = function (n) { var t = n.getMTab(); return this.gTab.getIncluded_Tab_ID() != t.getAD_Tab_ID() ? !1 : (this.vIncludedGC = n, this.vIncludedGC.switchMultiRow(), !0) }; n.GridController.prototype.switchSingleRow = function () { if (!this.onlyMultiRow && !this.singleRow) { this.singleRow = !0; this.isCardRow = !1; this.isMapRow = !1; var n = this.getVTablePanel(), t = this.getVPanel(); (this.isIncludedGCVisible || !0) && (n.hide(), t.css("display", "block"), this.getVCardPanel().hide(), this.getVMapPanel().hide()); this.dynamicDisplay(-1) } }; n.GridController.prototype.switchMultiRow = function () { if (this.singleRow) { this.singleRow = !1; this.isCardRow = !1; this.isMapRow = !1; var n = this.getVTablePanel(); this.getVPanel().hide(); this.getVCardPanel().hide(); this.getVMapPanel().hide(); this.isIncludedGCVisible ? n.css({ float: "right" }) : n.css({ float: "" }); n.show(); n = null; this.vTable.resize(); this.vTable.refreshRow() } }; n.GridController.prototype.switchCardRow = function () { if (!this.isCardRow) { this.singleRow = !1; this.isCardRow = !0; this.isMapRow = !1; this.getVTablePanel().hide(); this.getVPanel().hide(); this.getVMapPanel().hide(); var n = this.getVCardPanel(); this.isIncludedGCVisible ? n.css({ float: "right" }) : n.css({ float: "" }); n.show(); this.vCardView.refreshUI(this.getVCardPanel().width()); n = null } }; n.GridController.prototype.switchMapRow = function () { if (!this.isMapRow) { this.singleRow = !0; this.isCardRow = !1; this.isMapRow = !0; this.getVTablePanel().hide(); this.getVPanel().hide(); this.getVCardPanel().hide(); var n = this.getVMapPanel(); this.isIncludedGCVisible ? n.css({ float: "right" }) : n.css({ float: "" }); n.show(); this.vMapView.refreshUI(this.getVMapPanel().width()); n = null } }; n.GridController.prototype.switchIncludedGC = function () { var i, n, t; this.vIncludedGC && !this.displayAsIncludedGC && (i = this.isIncludedGCVisible, i || (n = this.aPanel.getIncludedEmptyArea(), n.empty(), t = this.vIncludedGC.getRoot(), t.detach(), this.vIncludedGC.setUI(!0), n.append(t), n.css("display", "flex"), t.show(), this.vIncludedGC.vTable.activate(), this.vIncludedGC.vTable.setReadOnly(!0), this.isIncludedGCVisible = !0, this.singleRow || (this.singleRow = !0, this.switchMultiRow()), this.vIncludedGC.displayAsIncludedGC = !0, this.vIncludedGC.singleRow = !0, this.vIncludedGC.switchMultiRow(), this.vTable.resize()), window.setTimeout(function (n) { n.vIncludedGC.query(0, 0, !1); n = null }, 1, this)) }; n.GridController.prototype.removeRecord = function () { var n = this.vTable.getSelection(!0), t; if (n && n.length > 0) for (t = 0; t < n.length; t++)this.vTable.grid.unselect(n[t] + 1), this.vTable.grid.remove(n[t] + 1); this.navigate(0); this.aPanel.setBusy(!1) }; n.GridController.prototype.dispose = function () { this.gTab.removeDataStatusListener(this.aPanel); this.gTab.removeDataStatusListener(); this.gTab.getTableModel().removeTableModelListener(this.vTable); this.gTab.getTableModel().removeCardModelListener(this.vCardView); this.gTab.getTableModel().removeRowChangedListener(); this.gTab.getTableModel().removeQueryCompleteListner(); this.disposeComponent(); this.gTab = null; this.windowNo = null; this.onlyMultiRow = null; this.aPanel = null; this.m_tree && this.m_tree.dispose(); this.vTabPanel && (this.vTabPanel.dispose(), this.vTabPanel = null); this.vHeaderPanel && this.vHeaderPanel.dispose(); this.m_tree = null }; n.GridController.prototype.HEADER_HEIGHT = 55 }(VIS, jQuery), function (n, t) { function o(n, i, r) { var u = null; return t.ajax({ url: c, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function i() { function vt() { var i = document.importNode(l, !0); u = t(i.querySelector(".vis-ad-w-p")); nt = u.find(".vis-ad-w-p-busy"); v = u.find(".vis-ad-w-p-tb-lc"); b = u.find(".vis-ad-w-p-nav-btns"); a = u.find(".vis-ad-w-p-t-c-tc"); y = u.find(".vis-ad-w-p-t-c"); k = u.find(".vis-ad-w-p-tabs-oflow").hide(); ht = u.find(".vis-ad-w-p-tabs-t"); et = u.find(".vis-ad-w-p-tb-rc-abar"); e = u.find(".vis-ad-w-p-a-m-slist"); p = u.find(".vis-ad-w-p-a-m-dlist"); c = u.find(".vis-ad-w-p-a-main"); it = u.find(".vis-ad-w-p-a-oflow"); rt = u.find(".vis-ad-w-p-header-l"); st = u.find(".vis-ad-w-p-center-inctab"); d = u.find(".vis-ad-w-p-tb-rc-a-list"); ut = u.find(".vis-ad-w-p-center-view"); tt = u.find(".vis-ad-w-p-status"); w = u.find(".vis-ad-w-p-actionpanel-r"); o = u.find(".vis-ad-w-p-tb-s-input"); s = u.find(".vis-ad-w-p-tb-s-icon"); h = u.find(".vis-ad-w-p-tb-s-icon-down"); o.attr("placeholder", n.Msg.getMsg("Search")); ft = u.find(".vis-ad-w-p-tb-s-btn"); ct = u.find(".vis-ad-w-p-tb-advsrch"); lt = u.find(".vis-ad-w-p-t-close"); at = u.find(".vis-ad-w-p-t-name h5") } function yt() { ht.show(); tt.show(); n.Application.isMobile && (it.hide(), c.addClass("vis-ad-w-p-a-main-mob")) } var r, i; this.$parentWindow; this.ctx = n.Env.getCtx(); this.curGC; this.curST; this.curTab; this.vTabbedPane = new n.VTabbedPane(!1); this.statusBar = new n.StatusBar; this.curWinTab = null; this.curTabIndex; this.firstTabId = null; this.toolbarCreated = !1; this.errorDisplayed = !1; this.isPersonalLock = n.MRole.getIsPersonalLock(); this.log = n.Logging.VLogger.getVLogger("APanel"); this.isSummaryVisible = !1; var ut, b, v, tt, a, y, k, o, ft, s, h, u, nt, d, et, e, p, c, it, rt = "", st, ht, w = null, ct = null, lt = null, at = null, g = [], ot = {}; this.defaultSearch = !0; this.isAutoCompleteOpen = !1; this.createSearchAutoComplete = function () { if (o) { var i = this; o.autocomplete({ select: function (t, i) { r.defaultSearch = !1; r.isSummaryVisible ? r.curTab.setShowSummaryNodes(!0) : r.curTab.setShowSummaryNodes(!1); var u = new n.Query(r.curTab.getTableName(), !1); r.curTab.searchText = i.item.value; r.curTab.userQueryID = i.item.id; i.item.code != n.Msg.getMsg("All") && u.addRestriction(i.item.code); r.curTab.getTableModel().setCurrentPage(1); r.curTab.setQuery(u); r.curGC.query(0, 0, !1); s.css("visibility", "visible"); h.css("visibility", "visible").css("transform", "rotate(360deg)"); t.stopPropagation() }, minLength: 0, open: function () { i.isAutoCompleteOpen = !0 }, close: function () { h.css("transform", "rotate(360deg)"); window.setTimeout(function () { i.isAutoCompleteOpen = !1 }, 400) }, source: [] }); o.autocomplete().data("ui-autocomplete")._renderItem = function (u, f) { var e = null, o; e = i.curTab.getTabLevel() == 0 ? f.defaultids && f.userid > 0 ? t("<span title='" + n.Msg.getMsg("DefaultSearch") + "'  data-id='" + f.id + "' class='VIS-winSearch-defaultIcon'><\/span>") : t("<span title='" + n.Msg.getMsg("MakeDefaultSearch") + "' data-id='" + f.id + "' class='VIS-winSearch-NonDefaultIcon'><\/span>") : t("<span title='" + n.Msg.getMsg("DefaultSearch") + "'  data-id='" + f.id + "'><\/span>"); o = t("<li>").append(t("<a style='display:block' title='" + f.title + "'>" + f.label + "<\/a>").append(e)).appendTo(u); e.on("click", function () { var i = t(this).data("id"); t.ajax({ url: n.Application.contextUrl + "JsonData/InsertUpdateDefaultSearch", dataType: "json", data: { AD_Tab_ID: r.curTab.getAD_Tab_ID(), AD_Table_ID: r.curTab.getAD_Table_ID(), AD_User_ID: r.ctx.getAD_User_ID(), AD_UserQuery_ID: i }, success: function () { }, error: function (n) { console.log(n) } }) }); return o } } }; r = this; vt(); tt.append(this.statusBar.getRoot()); this.setSize = function () { return }; i = function (n) { r.actionPerformed(n) }; this.onTabChange = function (n) { r.tabActionPerformed(n) }; this.statusBar.onComboChange = function (n) { r.setBusy(!0); setTimeout(function () { r.curGC.navigatePageExact(n + 1); r.curGC.onDemandTree || r.setBusy(!1) }, 100) }; this.createToolBar = function () { this.aRefresh = this.addActions(this.ACTION_NAME_REFRESH, null, !0, !0, !1, i, null, "Shct_Refresh"); this.aDelete = this.addActions(this.ACTION_NAME_DELETE, null, !0, !0, !1, i, null, "Shct_Delete"); this.aNew = this.addActions(this.ACTION_NAME_NEW, null, !0, !1, !1, i, null, "Shct_New"); this.aIgnore = this.addActions("Ignore", null, !0, !0, !1, i, null, "Shct_Ignore"); this.aSave = this.addActions("Save", null, !0, !0, !1, i, null, "Shct_Save"); this.aFind = this.addActions("Find", null, !0, !0, !1, i, null, "Shct_Find"); this.aInfo = this.addActions("Info", null, !0, !0, !1, i, null, "Shct_Info"); this.aReport = this.addActions("Report", null, !0, !0, !1, i, null, "Shct_Report"); this.aPrint = this.addActions("Print", null, !0, !0, !1, i, null, "Shct_Print"); v.append(this.aIgnore.getListItm()); v.append(this.aNew.getListItm()); v.append(this.aDelete.getListItm()); v.append(this.aSave.getListItm()); v.append(this.aRefresh.getListItm()); v.append(this.aReport.getListItm()); v.append(this.aPrint.getListItm()); ct.append(this.aFind.getListItm()); this.aPrevious = this.addActions(this.ACTION_NAME_PREV, null, !0, !0, !0, i, null, "Shct_PrevRec"); this.aFirst = this.addActions(this.ACTION_NAME_FIRST, null, !0, !0, !0, i, null, "Shct_FirstRec"); this.aLast = this.addActions(this.ACTION_NAME_LAST, null, !0, !0, !0, i, null, "Shct_LastRec"); this.aNext = this.addActions(this.ACTION_NAME_NEXT, null, !0, !0, !0, i, null, "Shct_NextRec"); this.aMulti = this.addActions("Multi", null, !1, !0, !0, i, !0, "Shct_MultiRow"); this.aCard = this.addActions("Card", null, !1, !0, !0, i, null, "Shct_CardView"); this.aMap = this.addActions("Map", null, !1, !0, !0, i); b.append(this.aPrevious.getListItm()).append(this.aNext.getListItm()); b.append(this.aMulti.getListItm()); b.append(this.aCard.getListItm()); b.append(this.aMap.getListItm().hide()); this.aPageUp = this.addActions(this.ACTION_NAME_PAGEUP, null, !0, !0, !0, i, null, "Shct_PageUp"); this.aPageFirst = this.addActions("PageFirst", null, !0, !0, !0, i, null, "Shct_PageFirst"); this.aPageLast = this.addActions("PageLast", null, !0, !0, !0, i, null, "Shct_PageLast"); this.aPageDown = this.addActions(this.ACTION_NAME_PAGEDOWN, null, !0, !0, !0, i, null, "Shct_PageDown"); var r = this.gridWindow; actionItemCount_Right = 0; r.getIsAppointment() && (this.aAppointment = this.addActions("Appointment", null, !1, !1, !1, i), this.aAppointment.setTextDirection("r"), e.append(this.aAppointment.getListItmIT())); r.getIsTask() && (this.aTask = this.addActions("Task", null, !1, !1, !1, i), this.aTask.setTextDirection("r"), e.append(this.aTask.getListItmIT())); r.getIsEmail() && (this.aEmail = this.addActions("EMail", null, !1, !1, !1, i), this.aEmail.setTextDirection("r"), e.append(this.aEmail.getListItmIT())); r.getIsLetter() && (this.aLetter = this.addActions("Letter", null, !1, !1, !1, i), this.aLetter.setTextDirection("r"), e.append(this.aLetter.getListItmIT())); r.getIsSms() && (this.aSms = this.addActions("Sms", null, !1, !1, !1, i), this.aSms.setTextDirection("r"), e.append(this.aSms.getListItmIT())); r.getIsFaxEmail() && (this.aFaxEmail = this.addActions("FaxEmail", null, !1, !1, !1, i), this.aFaxEmail.setTextDirection("r"), e.append(this.aFaxEmail.getListItmIT())); r.getIsChat() && (this.aChat = this.addActions(this.ACTION_NAME_CHAT, null, !1, !1, !1, i, !0), this.aChat.setTextDirection("r"), e.append(this.aChat.getListItmIT())); r.getIsAttachment() && (this.aAttachment = this.addActions("Attachment", null, !1, !1, !1, i, !0), this.aAttachment.setTextDirection("r"), e.append(this.aAttachment.getListItmIT())); r.getIsHistory() && (this.aHistory = this.addActions("History", null, !1, !1, !1, i), this.aHistory.setTextDirection("r"), e.append(this.aHistory.getListItmIT())); r.getIsCheckRequest() && (this.aRequest = this.addActions("Request", null, !0, !1, !1, i), this.aRequest.setTextDirection("r"), e.append(this.aRequest.getListItmIT())); n.AEnv.getIsWorkflowProcess() && (this.aWorkflow = this.addActions("Workflow", null, !0, !1, !1, i), this.aWorkflow.setTextDirection("r"), e.append(this.aWorkflow.getListItmIT())); r.getIsCopyReocrd() && (this.aCopy = this.addActions("Copy", null, !1, !1, !1, i), this.aCopy.setTextDirection("r"), e.append(this.aCopy.getListItmIT())); r.getIsSubscribedRecord() && (this.aSubscribe = this.addActions("Subscribe", null, !0, !1, !1, i, !0), this.aSubscribe.setTextDirection("r"), e.append(this.aSubscribe.getListItmIT())); r.getIsZoomAcross() && (this.aZoomAcross = this.addActions("ZoomAcross", null, !0, !1, !1, i), this.aZoomAcross.setTextDirection("r"), e.append(this.aZoomAcross.getListItmIT())); r.getIsCreatedDocument() && (this.aCreateDocument = this.addActions("CreateDocument", null, !1, !1, !1, i), this.aCreateDocument.setTextDirection("r"), e.append(this.aCreateDocument.getListItmIT())); r.getIsUploadedDocument() && (this.aUploadDocument = this.addActions("UploadDocument", null, !1, !1, !1, i), this.aUploadDocument.setTextDirection("r"), e.append(this.aUploadDocument.getListItmIT())); r.getIsViewDocument() && (this.aViewDocument = this.addActions("ViewDocument", null, !1, !1, !1, i, !0), this.aViewDocument.setTextDirection("r"), e.append(this.aViewDocument.getListItmIT())); r.getIsAttachDocumentFrom() && (this.aAttachFrom = this.addActions("AttachDocumentFrom", null, !1, !1, !1, i, !0), this.aAttachFrom.setTextDirection("r"), e.append(this.aAttachFrom.getListItmIT())); r.getIsMarkToExport() && (this.aMarkToExport = this.addActions("Mark", null, !1, !1, !1, i, !0), this.aMarkToExport.setTextDirection("r"), e.append(this.aMarkToExport.getListItmIT())); r.getIsImportMap() && (this.aImportMap = this.addActions("Import", null, !1, !1, !1, i), this.aImportMap.setTextDirection("r"), e.append(this.aImportMap.getListItmIT())); r.getIsArchive(); r.getIsAttachmail(); r.getIsRoleCenterView(); this.isPersonalLock && (this.aLock = this.addActions("Lock", null, !0, !1, !1, i, !0), this.aLock.setTextDirection("r"), e.append(this.aLock.getListItmIT()), this.aRecAccess = this.addActions("RecordAccess", null, !0, !1, !1, i, !0), this.aRecAccess.setTextDirection("r"), e.append(this.aRecAccess.getListItmIT())); this.aPreference = this.addActions("Preference", null, !1, !1, !0, i); n.MRole.getDefault().getIsShowPreference() && d.append(this.aPreference.getListItmIT()); this.aHelp = this.addActions("Help", null, !0, !1, !0, i); d.append(this.aHelp.getListItmIT()); this.aCardDialog = this.addActions("CardDialog", null, !0, !1, !0, i); d.append(this.aCardDialog.getListItmIT()); this.aShowSummaryLevel = this.addActions("ShowSummaryNodes", null, !0, !1, !0, i, !0); d.append(this.aShowSummaryLevel.getListItmIT()); r = null; this.statusBar.setPageItem(this.aPageUp.getListItm()); this.statusBar.setComboPage(); this.statusBar.setPageItem(this.aPageDown.getListItm()); this.statusBar.render(); this.toolbarCreated = !0; this.setRightBarVisibility = function (n) { n && t(d.parent()[0]).removeClass("show") }; yt() }; this.setDynamicActions = function () { if (this.curGC != null) { p.css("display", "none"); var n = 0, t = []; if (this.curGC.leftPaneLinkItems.length > 0) for (t = this.curGC.leftPaneLinkItems, n = 0; n < t.length; n++)p.append(t[n].getControl()); if (n = 0, this.curGC.rightPaneLinkItems.length > 0) for (t = this.curGC.rightPaneLinkItems, n = 0; n < t.length; n++)p.append(t[n].getControl()); (this.curGC.leftPaneLinkItems.length > 0 || this.curGC.rightPaneLinkItems.length > 0) && p.css("display", "flex"); t = null } }; this.getRoot = function () { return u }; this.getLayout = function () { return ut }; this.getIncludedEmptyArea = function () { return st }; this.getParentDetailPane = function () { return rt }; this.showTabPanel = function (n) { if (n) { var i = "vis-ad-w-p-center-flow-", r = "vis-ad-w-p-actionpanel-", t = this.curTab.getIsTPBottomAligned() ? "b" : "r", u = this.curTab.getIsTPBottomAligned() ? "r" : "b"; w.hasClass(r + t) || (w.parent().removeClass(i + u).addClass(i + t), w.removeClass(), w.addClass(r + t)); this.curGC && w.append(this.curGC.getTabPanel()); w.css({ display: "grid" }) } else w.css({ display: "none" }) }; this.setTabPanelclass = function () { }; this.setTabControl = function (t) { var i, r; for (g = t, i = 0; i < t.length; i++)r = t[i].getListItm(), ot[g[i].action] = r, a.append(r); a.width() > y.width() && (n.Application.isMobile || k.show()) }; this.setTabNavigation = function () { a.width() > y.width() ? n.Application.isMobile || k.show() : k.hide() }; this.setSelectedTab = function (n) { this.selectedTab && this.selectedTab.removeClass("vis-apanel-tab-selected"); this.selectedTab = ot[n]; this.selectedTab.addClass("vis-apanel-tab-selected") }; this.navigateThroghtShortcut = function (n) { var t = null; n ? (t = a.find(".vis-apanel-tab-selected").next(), (!t || t.length <= 0) && (t = a.children().first())) : (t = a.find(".vis-apanel-tab-selected").prev(), (!t || t.length <= 0) && (t = a.children().last())); t.trigger("click") }; this.setBusy = function (n, t) { this.isLocked = n; n ? nt[0].style.visibility = "visible" : (nt[0].style.visibility = "hidden", t) }; k.on("click", function (n) { var f, e; if (n.stopPropagation(), f = t(n.target).data("dir"), f) { var s = y.width(), o = a.width(), i = y.scrollLeft(), r = Math.ceil(s / 2), u = 0; if (f == "r") { if (i + r >= o - r) return; e = o - s; u = i + r; y.animate({ scrollLeft: u > e ? e : u }, 1e3) } else if (f == "b") { if (i == 0) return; u = i - r; y.animate({ scrollLeft: u < 0 ? 0 : u }, 1e3) } if (f == "rl") { if (i + r >= o - r) return; e = o - s; y.animate({ scrollLeft: e }, 500) } else if (f == "bf") { if (i == 0) return; u = i - r; y.animate({ scrollLeft: 0 }, 500) } } }); it.on("click", function (n) { var r, o; if (n.stopPropagation(), r = t(n.target).data("dir"), r) { var s = c.height(), h = e.height() + p.height(), u = c.scrollTop(), f = Math.ceil(s / 2), i = 0; if (r == "d") { if (u + f >= h - f) return; o = h - s; i = u + f; c.animate({ scrollTop: i > o ? o : i }, 1e3) } else if (r == "u") { if (u == 0) return; i = u - f; c.animate({ scrollTop: i < 0 ? 0 : i }, 1e3) } } }); ft.on(n.Events.onTouchStartOrClick, function (n) { r.cmd_find(o.val()); r.curTab.searchText = ""; o.val(""); n.stopPropagation() }); if (!n.Application.isMobile) o.on("keyup", function (t) { var u = t.charCode || t.keyCode, i; if (u == 13) { if (!r.defaultSearch) return; r.cmd_find(o.val()); o.val("") } else u == 8 && s.css("visibility") == "visible" && (t.preventDefault(), r.defaultSearch = !0, o.val(""), s.css("visibility", "hidden"), i = new n.Query, i.addRestriction(" 1 = 1 "), r.findRecords(i)) }); h.on("click", function () { r.isAutoCompleteOpen ? h.css("transform", "rotate(360deg)") : (h.css("transform", "rotate(180deg)"), r.refreshSavedASearchList(!0)) }); s.on("click", function () { s.css("visibility", "hidden"); r.defaultSearch = !0; r.curTab.searchText = ""; o.val(""); var t = new n.Query; r.findRecords(t); h.css("transform", "rotate(360deg)") }); this.setAdvancedSerachText = function (n, t) { n ? s.css("visibility", "hidden") : (s.css("visibility", "visible"), h.css("visibility", "visible")); o.val(t) }; this.toggleASearchIcons = function (n, t) { n && t ? (s.css("visibility", "visible"), h.css("visibility", "visible")) : n && !t ? (s.css("visibility", "hidden"), h.css("visibility", "visible")) : (s.css("visibility", "hidden"), h.css("visibility", "hidden")) }; this.setSearchFocus = function (n) { n ? o.focus() : o.trigger("focusout") }; this.refreshSavedASearchList = function (t, i) { var u = [], e; u[0] = new n.DB.SqlParam("@AD_Tab_ID", r.curTab.getAD_Tab_ID()); u[1] = new n.DB.SqlParam("@AD_User_ID", r.ctx.getAD_User_ID()); u[2] = new n.DB.SqlParam("@AD_Tab_ID1", r.curTab.getAD_Tab_ID()); u[3] = new n.DB.SqlParam("@AD_User_ID1", r.ctx.getAD_User_ID()); u[4] = new n.DB.SqlParam("@AD_Client_ID", r.ctx.getAD_Client_ID()); u[5] = new n.DB.SqlParam("@AD_Tab_ID2", r.curTab.getAD_Tab_ID()); u[6] = new n.DB.SqlParam("@AD_Table_ID", r.curTab.getAD_Table_ID()); e = this; f("VIS_116", u, function (r) { var f = [], c, u; if (r && r.tables[0].rows && r.tables[0].rows.length > 0) for (h.css("visibility", "visible"), f.push({ label: n.Msg.getMsg("All"), value: n.Msg.getMsg("All"), code: n.Msg.getMsg("All") }), c = !1, u = 0; u < r.tables[0].rows.length; u++)r.tables[0].rows[u].cells.ad_defaultuserquery_id > 0 ? (f.push({ title: r.tables[0].rows[u].cells.title, label: r.tables[0].rows[u].cells.name, value: r.tables[0].rows[u].cells.name, code: r.tables[0].rows[u].cells.code, id: r.tables[0].rows[u].cells.ad_userquery_id, defaultids: r.tables[0].rows[u].cells.ad_defaultuserquery_id, userid: r.tables[0].rows[u].cells.ad_defaultuserquery_id }), c = !0) : f.push({ title: r.tables[0].rows[u].cells.title, label: r.tables[0].rows[u].cells.name, value: r.tables[0].rows[u].cells.name, code: r.tables[0].rows[u].cells.code, id: r.tables[0].rows[u].cells.ad_userquery_id }); else e.toggleASearchIcons(!1, !1); i || (i = o.val()); i && i.length > 0 ? (i.length > 25 ? o.val(i.substr(0, 25) + "...") : o.val(i), s.css("visibility", "visible"), e.defaultSearch = !1) : s.css("visibility", "hidden"); o.autocomplete("option", "source", f); t && (o.autocomplete("search", ""), o.trigger("focus")) }) }; this.findRecords = function (n) { var t = !1, i; this.curTab.getTableModel().setCurrentPage(1); this.isSummaryVisible ? this.curTab.setShowSummaryNodes(!0) : this.curTab.setShowSummaryNodes(!1); this.curGC.skipRowInserting(!0); n != null && n.getIsActive() ? (this.curTab.setQuery(n), this.curGC.query(0, 0, t)) : (i = 0, this.curTab.setQuery(null), this.curGC.query(0, i, t)) }; this.setTitle = function (n) { at.text(n) }; lt.on("click", function () { r.$parentWindow.dispose() }); et.on(n.Events.onTouchStartOrClick, function (n) { n.stopPropagation(); n.preventDefault(); var t = parseInt(c.width()); t > 50 ? (e.find("span").hide(), p.find("span").hide()) : c.css({ position: "absolute" }); c.animate({ width: t > 50 ? "30" : "220" }, 300, "swing", function () { t < 50 ? (e.find("span").show(), p.find("span").show()) : (c.css({ position: "" }), c.css({ width: "" })); r.curGC && r.curGC.multiRowResize(); r.setTabNavigation() }) }); this.disposeComponent = function () { if (ft.off(n.Events.onTouchStartOrClick), o.remove(), o = null, et.off(n.onTouchStartOrClick), it.off("click"), k.off("click"), u.remove(), nt.remove(), u = nt = ut = b = v = tt = null, r = null, i = null, this.toolbarCreated && (this.aRefresh.dispose(), this.aDelete.dispose(), this.aNew.dispose(), this.aSave.dispose(), this.aPrevious.dispose(), this.aFirst.dispose(), this.aLast.dispose(), this.aNext.dispose(), this.aPageUp.dispose(), this.aPageFirst.dispose(), this.aPageLast.dispose(), this.aPageDown.dispose(), this.aCard.dispose(), this.aCardDialog.dispose(), this.aShowSummaryLevel && this.aShowSummaryLevel.dispose(), this.aChat && this.aChat.dispose(), this.aAppointment && this.aAppointment.dispose(), this.aHelp.dispose(), this.aSubscribe && this.aSubscribe.dispose(), this.aAttachment && this.aAttachment.dispose(), this.aHistory && this.aHistory.dispose(), this.aZoomAcross && this.aZoomAcross.dispose(), this.aRequest && this.aRequest.dispose(), this.aMarkToExport && this.aMarkToExport.dispose(), this.aWorkflow && this.aWorkflow.dispose(), this.aRecAccess && this.aRecAccess.dispose(), this.aImportMap && this.aImportMap.dispose(), this.aRefresh = this.aDelete = this.aNew = this.aPrevious = this.aFirst = this.aLast = this.aNext = null, this.aChat = this.aPageUp = this.aPageFirst = this.aPageLast = this.aPageDown = null, this.aHelp = this.aSubscribe = this.aAttachment = null, this.toolbarCreated = null, this.aZoomAcross = this.aRequest = this.aMark = this.aWorkflow = this.aHistory = null, this.aAppointment = null, this.aRecAccess = this.aImportMap = this.aCard = this.aCardDialog = this.aShowSummaryLevel = null), this.statusBar.dispose(), this.statusBar.onComboChange = null, this.statusBar = null, this.getRoot = null, this.getLayout = null, this.setBusy = null, this.createToolBar = null, this.$parentWindow = null, this.ctx = null, this.curGC = null, this.curST = null, this.curTab = null, this.vTabbedPane = null, this.curWinTab = null, this.curTabIndex = null, this.firstTabId = null, rt.remove(), rt = null, this.getParentDetailPane = null, g) for (var t = 0; t < g.length; t++)g[t].dispose(); g = null; ot = null; a.remove() } } function a(i) { t.ajax({ url: n.Application.contextUrl + "Posting/PostByNewLogic", dataType: "json", async: !0, data: { AD_Client_ID: n.context.getAD_Client_ID() }, error: function () { n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer")) }, success: function (n) { i && i(n.result) } }) } function r(n, t, i, r, u, f, e) { if (n.getProcess_ID() != 0) { var o = !0; return u.curTab.needSave(!0, !1) && (o = !1, u.cmd_save(!0, function (o) { if (o) return s(n, t, i, r, u, f, e) })), o ? s(n, t, i, r, u, f, e) : void 0 } } function s(i, r, f, e, o, s, h) { var a = i.getName(), c = !1, y = !0, v; try { if (i.getAskUserBGProcess() == !0 || i.getIsBackgroundProcess() == !0) { var p = t('<div class="vis-confirm-popup-check"><label>' + n.Msg.translate(n.context, "IsBackgroundProcess") + "<\/label><\/div>"), l = t('<input type="checkbox">'), w = i.getIsBackgroundProcess(); l.prop("checked", w); l.prop("disabled", w); p.prepend(l); n.ADialog.confirmCustomUI("StartProcess?", !0, i.getDescription() + "\n" + i.getHelp(), "Confirm", p, function (n) { if (n) return isBg = l.is(":checked"), u(i, r, f, e, h, o, c, a, isBg) }) } else if (v = i.getIsBackgroundProcess(), s || i.getDescription().equals("") && i.getHelp().equals("") || (y = !1, n.ADialog.confirm("StartProcess?", !0, i.getDescription() + "\n" + i.getHelp(), "Confirm", function (n) { if (n) return u(i, r, f, e, h, o, c, a, v) })), y) return u(i, r, f, e, h, o, c, a, v) } catch (b) { n.ADialog.error("Error?", !0, "error in process : " + b.message); c = !1 } return !1 } function u(t, i, r, u, f, e, o, s, h) { var l = t.getDescription(), c, a; return (l == null || l.length == 0) && (l = s), c = new n.ProcessInfo(l, t.getProcess_ID(), i, r), c.setAD_User_ID(u.getAD_User_ID()), c.setAD_Client_ID(u.getAD_Client_ID()), c.setAD_Window_ID(e.$parentWindow === undefined ? 0 : e.$parentWindow.AD_Window_ID), c.setIsBatch(f), c.setIsBackground(h), a = new n.ProcessCtl(e, c, null), t.isPdf ? c.setFileType(n.ProcessCtl.prototype.REPORT_TYPE_PDF) : t.isCsv && c.setFileType(n.ProcessCtl.prototype.REPORT_TYPE_CSV), a.process(e.curWindowNo), o = !0, e = null, t = null, f = !1, startWOasking = !1, actionProcessAfterSave = null, o } var h = n.Application.contextUrl, c = h + "JsonData/JDataSetWithCode", f = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, o(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, e = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, o(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, l = document.querySelector("#vis-ad-paneltmp").content; i.prototype.ACTION_NAME_FIRST = "First"; i.prototype.ACTION_NAME_LAST = "Last"; i.prototype.ACTION_NAME_PREV = "Previous"; i.prototype.ACTION_NAME_NEXT = "Next"; i.prototype.ACTION_NAME_PAGEDOWN = "PageDown"; i.prototype.ACTION_NAME_PAGEUP = "PageUp"; i.prototype.ACTION_NAME_NEW = "New"; i.prototype.ACTION_NAME_DELETE = "Delete"; i.prototype.ACTION_NAME_REFRESH = "Refresh"; i.prototype.ACTION_NAME_FIND = "Find"; i.prototype.ACTION_NAME_CHAT = "Chat"; i.prototype.ACTION_NAME_APPOINTMENT = "Appointment"; i.prototype.ACTION_NAME_ARCHIVE = "Archive"; i.prototype.keyDown = function (n) { if (n.altKey && this.curGC) { var t = this.aNew.getIsEnabled(); switch (n.keyCode) { case 78: t && this.actionPerformed(this.aNew.getAction()); break; case 83: this.ShortcutNavigation(this.aSave.getAction()); break; case 68: t && this.actionPerformed(this.aDelete.getAction()); break; case 90: t || this.actionPerformed(this.aIgnore.getAction()); break; case 80: t && this.actionPerformed(this.aPrint.getAction()); break; case 82: t && this.actionPerformed(this.aReport.getAction()); break; case 81: t && this.actionPerformed(this.aRefresh.getAction()); break; case 65: this.actionPerformed(this.aFind.getAction()); break; case 70: this.setSearchFocus(!0); break; case 37: this.ShortcutNavigation(this.aFirst.getAction()); break; case 39: this.ShortcutNavigation(this.aLast.getAction()); break; case 38: this.ShortcutNavigation(this.aPrevious.getAction()); break; case 40: this.ShortcutNavigation(this.aNext.getAction()); break; case 84: this.actionPerformed(this.aMulti.getAction()); break; case 86: this.actionPerformed(this.aCard.getAction()); break; case 88: this.$parentWindow.dispose(); break; case 33: if (n.ctrlKey) { this.aPageFirst.isEnabled && this.ShortcutNavigation(this.aPageFirst.getAction()); break } else { this.aPageUp.isEnabled && this.ShortcutNavigation(this.aPageUp.getAction()); break } case 34: if (n.ctrlKey) { this.aPageLast.isEnabled && this.ShortcutNavigation(this.aPageLast.getAction()); break } else { this.aPageDown.isEnabled && this.ShortcutNavigation(this.aPageDown.getAction()); break } }n.preventDefault(); n.stopPropagation() } else n.keyCode == 112 && (this.actionPerformed(this.aHelp.getAction()), n.preventDefault(), n.stopPropagation()) }; i.prototype.ShortcutNavigation = function (n) { var r = this, i = t(document.activeElement); i && i.length > 0 && i.trigger("change"); window.setTimeout(function () { r.actionPerformed(n) }, 200) }; i.prototype.sizeChanged = function () { this.setTabNavigation(); return }; i.prototype.refresh = function () { this.curGC && (this.curGC.vTable.resize(), this.curGC.vIncludedGC && this.curGC.vIncludedGC.vTable.refresh()) }; i.prototype.refreshData = function () { var n = this; window.setTimeout(function () { n.curTab.getAD_Tab_ID() == n.firstTabId.split("_")[1] ? n.curGC.dataRefreshAll() : n.selectFirstTab(!1, function () { n.curGC.dataRefreshAll() }); n.setBusy(!1) }, 100); this.setBusy(!0) }; i.prototype.addActions = function (t, i, r, u, f, e, o, s) { var t = new n.AppsAction({ action: t, parent: i, enableDisable: r, toggle: o, imageOnly: u, isSmall: f, onAction: e, toolTipText: s }); return t }; i.prototype.initPanel = function (i, r, u, f, e) { var a, v, s, p, b, o, y, k, w, nt, l, d, tt; this.$parentWindow = u; a = new n.GridWindow(i); this.gridWindow = a; this.createToolBar(); var h = u.getWindowNo(), g = this.ctx.isAutoNew(), c = a.getTabs(); for (this.ctx.setAutoCommit(h, this.ctx.isAutoCommit()), this.ctx.setAutoNew(h, g), this.ctx.setIsSOTrx(h, a.getIsSOTrx()), !g && a.getIsTransaction() && this.ctx.setAutoNew(h, !0), this.ctx.setContext(h, "WindowName", a.getName()), !r && e && (r = new n.Query, v = c[0].getKeyColumnName(), v.length == 0 && (v = c[0].getLinkColumnName()), v.length != 0 && (v.endsWith("_ID") ? r.addRestriction(v, n.Query.prototype.EQUAL, e) : r.addRestriction(v, n.Query.prototype.EQUAL, e))), p = [], b = {}, o = 0; o < c.length; o++)y = h + "_" + c[o].getAD_Tab_ID(), k = { action: y, text: c[o].getName(), toolTipText: c[o].getDescription(), textOnly: !0, iconName: "" }, c[o].getTabLevel() > 0 && (k.textOnly = !1, k.iconName = c[o].getTabLevel() > 3 ? "tl-4" : "tl-" + c[o].getTabLevel()), p[o] = new n.AppsAction(k), s = c[o], o === 0 && (this.curTab = s, r != null && s.setQuery(r)), w = null, s.getIsSortTab() ? (nt = new n.VSortTab(h, s.getAD_Table_ID(), s.getAD_ColumnSortOrder_ID(), s.getAD_ColumnSortYesNo_ID(), s.getIsReadOnly(), y), w = nt, o == 0 && (firstTabId = y)) : (l = new n.GridController(!0, !0, y), l.initGrid(!1, h, this, s), o === 0 && (this.curGC = l, this.firstTabId = y, s.getIsHeaderPanel() && l.initHeaderPanel(this.getParentDetailPane())), w = l, o === 0 && f && l.switchSingleRow(), s.getIncluded_Tab_ID() != 0 && (b[s.getIncluded_Tab_ID()] = l), s.getHasPanel() && l.initTabPanel(a.getWindowWidth(), h), t.isEmptyObject(b) || (d = b[s.getAD_Tab_ID()], d != null && (tt = d.includeTab(l)))), this.vTabbedPane.addTab(y, s, w, p[o]), w && this.getLayout().append(w.getRoot()), p[o].onAction = this.onTabChange; this.setTabControl(p); p = null; this.ctx.setWindowContext(h, "WindowName", i._vo.DisplayName); u.setTitle(n.Env.getHeader(this.ctx, h)); this.setTitle(n.Env.getHeader(this.ctx, h)); u.setName(i._vo.DisplayName); this.curWindowNo = h; i = null; u = null }; i.prototype.selectFirstTab = function (n) { this.curTab.setIsZoomAction(n); setTimeout(function (n) { n.tabActionPerformed(n.firstTabId); n.setTabNavigation(); n = null }, 10, this) }; i.prototype.getIsUILocked = function () { return this.isLocked }; i.prototype.lockUI = function () { this.setBusy(!0, !1) }; i.prototype.unlockUI = function (i) { var u = i != null && i.getAD_Process_ID() != this.curTab.getAD_Process_ID(), r; u && (this.curTab.dataRefresh(), i.getIsTimeout() && n.context.setWindowContext(this.curWindowNo, "Processed", "Y"), this.curGC.dynamicDisplay(-1), this.setStatusLine(i.getSummary(), i.getIsError()), i.customHTML && i.customHTML != "" ? this.displayDialog(t(i.customHTML)) : (n.ProcessInfoUtil.setLogFromDB(i), r = i.getLogInfo(), r.length > 0 && (n.ADialog.info(i.getTitle(), !0, r, ""), this.setStatusLine(i.getSummary(), i.getIsError())))); this.setBusy(!1, u) }; i.prototype.displayDialog = function (i) { var r = new n.ChildDialog; r.setTitle(""); var f = window.innerWidth - 150, e = window.innerHeight - 120, u = t('<div style="max-height: ' + e + "px; max-width: " + f + 'px; min-width: 150px; min-height: 60px;"><\/div>'); u.append(i); r.setContent(u); r.close = function () { r.dispose() }; r.show(); r.hidebuttons() }; i.prototype.actionPerformed = function (t) { if (!this.getIsUILocked()) { var i = this; setTimeout(function () { if (t.source instanceof n.Controls.VButton) { i.actionButton(t.source) || i.setBusy(!1, !0); return } i.actionPerformedCallback(i, t) }); this.setBusy(!0) } }; i.prototype.actionPerformedCallback = function (i, r) { var o, u, f, e, s, h; i.aFirst.getAction() === r ? (i.isDefaultFocusSet = !1, i.curGC.navigate(0)) : i.aPrevious.getAction() === r ? (i.isDefaultFocusSet = !1, i.curGC.navigateRelative(-1)) : i.aLast.getAction() === r ? (i.isDefaultFocusSet = !1, i.curGC.navigate(i.curTab.getRowCount() - 1)) : i.aNext.getAction() === r ? (i.isDefaultFocusSet = !1, i.curGC.navigateRelative(1)) : i.aMulti.getAction() === r ? (i.aMulti.setPressed(!i.curGC.getIsSingleRow()), i.curGC.switchRowPresentation()) : i.aCard.getAction() === r ? (i.aMulti.setPressed(!1), i.curGC.switchCardRow()) : i.aMap.getAction() === r ? (i.aMulti.setPressed(!0), i.curGC.switchMapRow()) : i.aPageUp.getAction() === r ? (i.isDefaultFocusSet = !1, i.curGC.navigatePage(-1)) : i.aPageFirst.getAction() === r ? (i.isDefaultFocusSet = !1, i.curGC.navigatePage(0)) : i.aPageDown.getAction() === r ? (i.isDefaultFocusSet = !1, i.curGC.navigatePage(1)) : i.aPageLast.getAction() === r ? (i.isDefaultFocusSet = !1, i.curGC.navigatePage("last")) : i.aRefresh.getAction() === r ? i.cmd_refresh() : i.aIgnore.getAction() === r ? i.cmd_ignore() : i.aSave.getAction() === r ? i.cmd_save(!0) : i.aNew.getAction() === r ? i.cmd_new(!1) : i.aCopy && i.aCopy.getAction() === r ? i.cmd_new(!0) : i.aDelete.getAction() === r ? i.cmd_delete() : i.aFind.getAction() === r ? i.cmd_finddialog() : i.aChat && i.aChat.getAction() === r ? i.cmd_chat() : i.aAttachment && i.aAttachment.getAction() === r ? i.cmd_attachment() : i.aHistory && i.aHistory.getAction() == r ? i.cmd_history() : i.aPreference.getAction() === r ? i.cmd_preference() : i.aHelp.getAction() === r ? i.cmd_help() : i.aCardDialog.getAction() === r ? i.cmd_cardDialog() : i.aAppointment && i.aAppointment.getAction() === r ? i.cmd_appointment() : i.aTask && i.aTask.getAction() === r ? i.cmd_task() : i.aSubscribe && i.aSubscribe.getAction() === r ? i.cmd_subscribe() : i.aImportMap && i.aImportMap.getAction() === r ? i.cmd_ImportMap() : i.aEmail && i.aEmail.getAction() === r ? i.cmd_email() : i.aLetter && i.aLetter.getAction() === r ? i.cmd_letter() : i.aSms && i.aSms.getAction() === r ? i.cmd_sms() : i.aInfo.getAction() === r ? i.cmd_infoWindow() : i.aZoomAcross && i.aZoomAcross.getAction() === r ? i.cmd_zoomAcross() : i.aRequest && i.aRequest.getAction() === r ? i.cmd_request() : i.aReport.getAction() === r ? i.cmd_report() : i.isPersonalLock && i.aLock.getAction() === r ? i.cmd_lock() : i.isPersonalLock && i.aRecAccess.getAction() === r ? i.cmd_recAccess() : i.aWorkflow != null && r === i.aWorkflow.getAction() ? i.curTab.getRecord_ID() > 0 && n.AEnv.startWorkflowProcess(i.curTab.getAD_Table_ID(), i.curTab.getRecord_ID()) : i.aPrint.getAction() === r ? i.cmd_print() : i.aCreateDocument && i.aCreateDocument.getAction() === r ? window.VADMS ? (u = new n.CFrame, o = new window.VADMS.editDocument(0, "", 0, "", 0, null, "", i.curTab.getAD_Window_ID(), i.curTab.getAD_Table_ID(), i.curTab.getRecord_ID()), u.setName(n.Msg.getMsg("VADMS_CreateDocument")), u.setTitle(n.Msg.getMsg("VADMS_CreateDocument")), u.hideHeader(!0), u.setContent(o), o.initialize(), u.show()) : n.ADialog.error("PleaseInstallDMSModule", !0, "") : i.aUploadDocument && i.aUploadDocument.getAction() === r ? window.VADMS ? window.VADMS.uploaddocument(0, i.curTab.getAD_Window_ID(), i.curTab.getAD_Table_ID(), i.curTab.getRecord_ID()) : n.ADialog.error("PleaseInstallDMSModule", !0, "") : i.aViewDocument && i.aViewDocument.getAction() === r ? window.VADMS ? (u = new n.CFrame, f = new window.VADMS.DocumentManagementSystem, u.setName(n.Msg.getMsg("VADMS_Document")), u.setTitle(n.Msg.getMsg("VADMS_Document")), u.hideHeader(!0), f.setWindowNo(n.Env.getWindowNo()), f.setWindowID(i.curTab.getAD_Window_ID()), f.setTableID(i.curTab.getAD_Table_ID()), f.setRecordID(i.curTab.getRecord_ID()), f.setWindowName(i.gridWindow.getName()), u.setContent(f), f.initialize(), u.show()) : n.ADialog.error("PleaseInstallDMSModule", !0, "") : i.aAttachFrom && i.aAttachFrom.getAction() === r ? window.VADMS ? (e = i, s = n.context.getContext("VADMS_Document_ID"), s.length > 0 && (h = { docID: s, winID: i.curTab.getAD_Window_ID(), tableID: i.curTab.getAD_Table_ID(), recID: i.curTab.getRecord_ID() }, t.ajax({ url: n.Application.contextUrl + "JsonData/AttachFrom", dataType: "json", data: h, success: function (t) { JSON.parse(t) == "OK" ? (e.curTab.loadDocuments(), e.aViewDocument.setPressed(e.curTab.hasDocument()), n.ADialog.confirm("AttachWithOther", !0, "", "Confirm", function (t) { t || n.context.setContext("VADMS_Document_ID", 0) }), e = null) : n.ADialog.error("NotAttached", !0, "") } }))) : n.ADialog.error("PleaseInstallDMSModule", !0, "") : i.aMarkToExport && i.aMarkToExport.getAction() === r ? i.cmd_markToExport() : i.aShowSummaryLevel.getAction() == r && i.ShowSummaryNodes(); i.setRightBarVisibility(!0); i.setBusy(!1); i = null }; i.prototype.actionButton = function (t) { var e = !1, o = !1, s = null, u = t.getColumnName(), i = n.context, r = this, h, c, f; if (u.equals("Record_ID")) { h = i.getContextAsInt(this.curWindowNo, "AD_Table_ID"); c = i.getContextAsInt(this.curWindowNo, "Record_ID"); n.AEnv.zoom(h, c); return } return f = !0, this.curTab.needSave(!0, !1) && (f = !1, this.cmd_save(!0, function (n) { n && r.actionButtonCallBack(t, e, o, s, u, i, r) })), f ? r.actionButtonCallBack(t, e, o, s, u, i, r) : void 0 }; i.prototype.actionButtonCallBack = function (i, u, f, e, o, s, h) { var g = this.curTab.getAD_Table_ID(), c = this.curTab.getRecord_ID(), nt, p, l, k, v, y, tt, w, b, d, it, rt; if (c == -1 && this.curTab.getKeyColumnName().equals("AD_Language") && (c = s.getContextAsInt(this.curWindowNo, "AD_Language_ID")), c == -1 && (i.getProcess_ID() == 306 || i.getProcess_ID() == 307) && (nt = this.curTab.getValue("AD_ChangeLog_ID"), c = nt), c == -1 && this.curTab.getKeyColumnName().equals("EntityType") && (c = this.curTab.getValue("AD_EntityType_ID")), c == -1 && this.curTab.getKeyColumnName().toUpperCase().endsWith("_ID")) { n.ADialog.error("SaveErrorRowNotFound", !0, ""); return } if (o.equals("PaymentRule")) { p = new n.VPayment(this.curWindowNo, this.curTab, i); p.show(); p.init(); p.onClose = function () { p.isInitOK() && (h.curGC.dynamicDisplay(i.getName()), h.cmd_save(!1), r(i, g, c, s, h, u, f)) }; return } if (o.equals("DocAction")) { l = new n.VDocAction(this.curWindowNo, this.curTab, c); l.show(); l.onClose = function () { if (l.getNumberOfOptions() == 0) { l.dispose(); h.log.info("DocAction - No Options"); return } if (!l.isStartProcess()) { l.dispose(); return } f = l.isBatch(); u = !0; r(i, g, c, s, h, u, f); l.dispose(); h = null }; return } if (o.equals("CreateFrom")) { if (k = !1, (this.curTab.getAD_Window_ID() == 341 || this.curTab.getAD_Window_ID() == 170) && (window.MMPM ? (y = MMPM.Requisition.prototype.create(this.curTab.getAD_Window_ID(), this.curTab.getRecord_ID()), k = !0) : window.DTD001 && (y = DTD001.Requisition.prototype.create(this.curTab.getAD_Window_ID(), this.curTab.getRecord_ID()), k = !0)), k) return; if (v = n.VCreateFrom.prototype.create(this.curTab), v != null) { v.isInitOK() ? (v.showDialog(), v.onClose = function () { v.dispose(); this.curTab.dataRefresh() }, v = null) : v.dispose(); return } } else { if (o.equals("GenerateSticker")) { window.DTD001 && (y = DTD001.StickerProduct.prototype.create(this.curTab.getAD_Window_ID(), this.curTab.getRecord_ID())); return } if (o.equals("DTD001_GenerateSticker")) { window.DTD001 && (y = DTD001.MRProductSticker.create(this.curTab.getAD_Window_ID(), this.curTab.getRecord_ID(), this.curTab.getTabLevel())); return } if (o.equals("BGT01_CreateLinePo")) { window.BGT01 && BGT01.CreateLineMovement(this.curTab.getAD_Window_ID(), this.curTab.getAD_Tab_ID(), this.curTab.getRecord_ID()); return } if (o == "Posted" && n.MRole.getDefault().getIsShowAcct()) { if (tt = n.context.getWindowContext(this.curWindowNo, "Processed"), tt != "Y" && (w = n.context.getWindowContext(this.curWindowNo, "DocStatus"), DocActionVariables.STATUS_Completed != w && DocActionVariables.STATUS_Closed != w && DocActionVariables.STATUS_Reversed != w && DocActionVariables.STATUS_Voided != w)) { n.ADialog.info(n.Msg.getMsg("PostDocNotComplete")); return } return b = this.curTab.getValue("Posted"), b != null && b == "Y" ? (d = new n.AcctViewer(n.context.getAD_Client_ID(), this.curTab.getAD_Table_ID(), this.curTab.getRecord_ID(), this.curWindowNo, this.curTab.getAD_Window_ID()), d != null && (this.setBusy(!1), d.showDialog()), d = null) : n.ADialog.confirm("PostImmediate?", !0, "", "Confirm", function (i) { var r = h, u; if (i) r.setBusy(!0, !0), u = b != null && b != "N", a(function (i) { var f = !1; if (i == "Yes" && (f = !0), window.FRPT && f) { var e = Number(n.context.getWindowTabContext(r.curWindowNo, 0, "AD_Org_ID")), o = r.curTab.getAD_Window_ID(), s = Number(n.context.getWindowTabContext(r.curWindowNo, 0, "C_DocType_ID")), h = FRPT.PostingLogic(r.curWindowNo, r.curTab.getAD_Table_ID(), r.curTab.getRecord_ID(), u, e, o, s); r.curGC.dataRefresh(); r.setBusy(!1, !0); return } t.ajax({ url: n.Application.contextUrl + "Posting/PostImmediate", dataType: "json", data: { AD_Client_ID: n.context.getAD_Client_ID(), AD_Table_ID: r.curTab.getAD_Table_ID(), Record_ID: r.curTab.getRecord_ID(), force: u }, error: function () { r.setBusy(!1, !0); n.ADialog.info("ERRORGettingPostingServer") }, success: function (t) { t.result != "OK" ? (r.setBusy(!1, !0), n.ADialog.info(t.result)) : (r.setBusy(!1, !0), r.curGC.dataRefresh()) } }) }); else return r.setBusy(!1, !0), !1 }), !1 } if (o.equals("SendNewEMail")) return } if (i.AD_Process_ID > 0) return it = r(i, g, c, s, h), h = null, it; i.AD_Form_ID > 0 && (n.MRole.getFormAccess(i.AD_Form_ID) ? rt = new n.WForm(n.Env.getScreenHeight(), i.AD_Form_ID, this.curTab, this.curWindowNo) : n.ADialog.warn("AccessTableNoView")) }; i.prototype.tabActionPerformed = function (t) { var i, h, u, c, o; if (!this.vTabbedPane.getIsTabChanged(t)) return console.log("tabNotChange"), !1; var l = !1, f = !1, e = this.vTabbedPane.getTabElement(t), r = this.curST || this.curGC, s = null; if (this.toggleASearchIcons(!1, !1), this.setAdvancedSerachText(!0, ""), i = this, !this.vTabbedPane.getIsWorkbench()) { if (this.curWinTab = this.vTabbedPane, h = this.curWinTab.getSelectedIndex(), l = h < this.curTabIndex, u = null, c = null, e instanceof n.VSortTab ? (c = e, f = !0) : u = e, o = !0, this.curGC != null) { if (this.curTab.needSave(!0, !1)) if (this.curTab.needSave(!0, !0)) if (this.ctx.isAutoCommit(this.curWindowNo)) { if (!this.curTab.dataSave(!0)) return this.vTabbedPane.restoreTabChange(), this.setBusy(!1, !0), !1 } else o = !1, n.ADialog.confirm("SaveChanges?", !0, this.curTab.getCommitWarning(), "Confirm", function (n) { if (n) { if (!i.curTab.dataSave(!0)) return i.vTabbedPane.restoreTabChange(), i.setBusy(!1, !0), !1 } else i.curTab.dataIgnore(); r = i.curGC; s = i.curGC; i.curGC = null; i.curST != null && (i.curST.saveData(), i.curST.unRegisterAPanel(), r = i.curST, i.curST = null); i.curTabIndex = h; f || (i.curGC = u); i.tabActionPerformedCallback(t, l, f, e, r, s, u, c) }); else i.curTab.dataIgnore(); o && (r = this.curGC, s = this.curGC, this.curGC = null) } o && (this.curST != null && (this.curST.saveData(), this.curST.unRegisterAPanel(), r = this.curST, this.curST = null), this.curTabIndex = h, f || (this.curGC = u)) } return o && i.tabActionPerformedCallback(t, l, f, e, r, s, u, c), !0 }; i.prototype.tabActionPerformedCallback2 = function (n, t) { n = this.curGC; t = this.curGC; this.curGC = null }; i.prototype.tabActionPerformedCallback3 = function (n, t, i, r) { this.curST != null && (this.curST.saveData(), this.curST.unRegisterAPanel(), n = this.curST, this.curST = null); this.curTabIndex = r; t || (this.curGC = i) }; i.prototype.tabActionPerformedCallback = function (t, i, r, u, f, e, o, s) { if (this.setSelectedTab(t), r) this.curST = s, s.registerAPanel(this), s.loadData(); else { if (o.activate(e), e && e.detachDynamicAction(), this.curTab = o.getMTab(), this.setDynamicActions(), !o.isZoomAction && this.curTab.getTabLevel() > 0) { var h = new n.Query; this.curTab.query = h } i && this.curTab.getIsCurrent() ? (this.curTab.getTabLevel() == 0 ? this.curTab.searchText ? this.setAdvancedSerachText(!1, this.curTab.searchText) : this.curTab.hasSavedAdvancedSearch && this.toggleASearchIcons(!0, !1) : this.curTab.searchText ? this.setAdvancedSerachText(!1, this.curTab.searchText) : this.curTab.hasSavedAdvancedSearch && this.toggleASearchIcons(!0, !1), o.dataRefresh()) : (this.curTab.getTableModel().setCurrentPage(1), (!this.curGC.onDemandTree || o.isZoomAction) && (this.curTab.searchText = "", this.setDefaultSearch(o), o.query(this.curTab.getOnlyCurrentDays(), 0, !1))); this.curGC.onDemandTree ? this.aShowSummaryLevel.show() : this.aShowSummaryLevel.hide() } r ? (this.aMulti.setPressed(!1), this.aMulti.setEnabled(!1), this.aCard.setEnabled(!1), this.aCardDialog.setEnabled(!1), this.aNew.setEnabled(!1), this.aDelete.setEnabled(!1), this.aFind.setEnabled(!1), this.aRefresh.setEnabled(!1), this.aNext.setEnabled(!1), this.aLast.setEnabled(!1), this.aFirst.setEnabled(!1), this.aPrevious.setEnabled(!1), this.aPageFirst.setEnabled(!1), this.aPageUp.setEnabled(!1), this.aPageLast.setEnabled(!1), this.aPageDown.setEnabled(!1)) : (this.aMulti.setEnabled(!0), this.aMulti.setPressed(this.curGC.getIsSingleRow() || this.curGC.getIsMapRow()), this.aCard.setEnabled(!0), this.aCardDialog.setEnabled(!0), this.aFind.setEnabled(!0), this.aRefresh.setEnabled(!0)); f.setVisible(!1); u.setVisible(!0); this.showTabPanel(this.curTab.getHasPanel()); this.refresh(); this.setTabNavigation(); this.aParentDetail && this.aParentDetail.evaluate(u); f = u = null; this.curTab.getAD_Process_ID() == 0 ? this.aPrint.setEnabled(!1) : this.aPrint.setEnabled(!0); this.curTab.getIsMapView() ? this.aMap.show() : this.aMap.hide() }; i.prototype.setDefaultSearch = function (t) { var i = this, u = [], r, o, e, s; if (u[0] = new n.DB.SqlParam("@AD_Tab_ID", this.curTab.getAD_Tab_ID()), u[1] = new n.DB.SqlParam("@AD_User_ID", this.ctx.getAD_User_ID()), u[2] = new n.DB.SqlParam("@AD_Tab_ID1", this.curTab.getAD_Tab_ID()), u[3] = new n.DB.SqlParam("@AD_User_ID1", this.ctx.getAD_User_ID()), u[4] = new n.DB.SqlParam("@AD_Client_ID", this.ctx.getAD_Client_ID()), u[5] = new n.DB.SqlParam("@AD_Tab_ID2", this.curTab.getAD_Tab_ID()), u[6] = new n.DB.SqlParam("@AD_Table_ID", this.curTab.getAD_Table_ID()), r = f("VIS_117", u), r && r.tables[0].rows && r.tables[0].rows.length > 0) if (i.curTab.hasSavedAdvancedSearch = !0, i.curTab.getTabLevel() != 0 || t.isZoomAction) i.toggleASearchIcons(!0, !1); else { for (o = !1, e = 0; e < r.tables[0].rows.length; e++)r.tables[0].rows[e].cells.ad_defaultuserquery_id > 0 && (o = !0, i.setAdvancedSerachText(!1, r.tables[0].rows[e].cells.name), s = new n.Query(i.curTab.getTableName(), !1), s.addRestriction(r.tables[0].rows[e].cells.code), i.curTab.setQuery(s), i.defaultSearch = !1, i.curTab.searchText = r.tables[0].rows[e].cells.name); !i.curTab.hasSavedAdvancedSearch; i.toggleASearchIcons(!0, o) } else i.toggleASearchIcons(!1, !1), i.setAdvancedSerachText(!0, "") }; i.prototype.dataStatusChanged = function (t) { var o = t.getMessage(), p = this.curTab.getIsQueryActive() || this.curTab.getOnlyCurrentDays() > 0, i, s, e, y, h, c, l, a, v; p && (o = "[ " + o + " ]"); this.statusBar.setStatusDB(o, t); (t.getAD_Message() != null || t.getInfo() != null) && (i = new StringBuilder, s = t.getMessage(), s != null && s.length > 0 && i.append(n.Msg.getMsg(t.getAD_Message())), e = t.getInfo(), e != null && e.length > 0 && (i.length() > 0 && !i.endsWith(":") && i.append(": "), i.append(e)), i.length() > 0 && (y = i.indexOf("\n"), y != -1 && i.replace("\n", " - "), this.setStatusLine(i.toString(), t.getIsError()))); t.getIsError() && !t.getIsConfirmed() ? (n.ADialog.error(t.getAD_Message(), !0, t.getInfo()), t.setConfirmed(!0), this.errorDisplayed = !0) : t.getIsWarning() && !t.getIsConfirmed() && (n.ADialog.warn(t.getAD_Message(), !0, t.getInfo()), t.setConfirmed(!0)); h = t.getIsFirstRow(); this.aFirst.setEnabled(!h); this.aPrevious.setEnabled(!h); c = t.getIsLastRow(); this.aNext.setEnabled(!c); this.aLast.setEnabled(!c); l = t.getIsFirstPage(); this.aPageFirst.setEnabled(!l); this.aPageUp.setEnabled(!l); a = t.getIsLastPage(); this.aPageLast.setEnabled(!a); this.aPageDown.setEnabled(!a); var r = t.getIsChanged() || t.getIsInserting(), u = this.curTab.getIsReadOnly(), f = !u; f && (f = this.curTab.getIsInsertRecord()); this.aNew.setEnabled(!r && f); this.aCopy && this.aCopy.setEnabled(!r && f); this.aRefresh.setEnabled(!r); this.aDelete.setEnabled(!r && !u && t.getCurrentRow() > -1); u && this.curTab.getIsAlwaysUpdateField() && (u = !1); this.aIgnore.setEnabled(r && !u); this.aSave.setEnabled(r && !u); this.aCardDialog.setEnabled(!r); t.getTotalRows() == 0 && f && (this.aNew.setEnabled(!0), this.aDelete.setEnabled(!1)); this.aMulti.setPressed(this.curGC.getIsSingleRow() || this.curGC.getIsMapRow()); this.aChat && this.aChat.setPressed(this.curTab.hasChat()); this.aAttachment && this.aAttachment.setPressed(this.curTab.hasAttachment()); this.aMarkToExport && this.aMarkToExport.setPressed(this.curTab.hasMarked()); this.aSubscribe && this.aSubscribe.setPressed(this.curTab.HasSubscribed()); this.isPersonalLock && (this.aLock.setEnabled(!0), this.aLock.setPressed(this.curTab.getIsLocked()), this.aRecAccess.setEnabled(!0)); this.curTab.getRecord_ID() == -1 ? (this.aChat && this.aChat.setEnabled(!1), this.aAttachment && this.aAttachment.setEnabled(!1), this.aSubscribe && this.aSubscribe.setEnabled(!1), this.aHistory && this.aHistory.setEnabled(!1), this.aEmail && this.aEmail.setEnabled(!1), this.aLetter && this.aLetter.setEnabled(!1), this.aSms && this.aSms.setEnabled(!1), this.aFaxEmail && this.aFaxEmail.setEnabled(!1), this.aCreateDocument && this.aCreateDocument.setEnabled(!1), this.aUploadDocument && this.aUploadDocument.setEnabled(!1), this.aViewDocument && this.aViewDocument.setEnabled(!1), this.aAttachFrom && this.aAttachFrom.setEnabled(!1), this.aZoomAcross && this.aZoomAcross.setEnabled(!1), this.aMarkToExport && this.aMarkToExport.setEnabled(!1), this.aArchive && this.aArchive.setEnabled(!1), this.aEmailAttach && this.aEmailAttach.setEnabled(!1), this.aAppointment && this.aAppointment.setEnabled(!1), this.aTask && this.aTask.setEnabled(!1), this.aRequest && this.aRequest.setEnabled(!1), this.aWorkflow && this.aWorkflow.setEnabled(!1), this.aCopy && this.aCopy.setEnabled(!1), this.aLock && this.aLock.setEnabled(!1), this.aRecAccess && this.aRecAccess.setEnabled(!1)) : (this.aChat && this.aChat.setEnabled(!0), this.aAttachment && this.aAttachment.setEnabled(!0), this.aSubscribe && this.aSubscribe.setEnabled(!0), this.aHistory && this.aHistory.setEnabled(!0), this.aEmail && this.aEmail.setEnabled(!0), this.aLetter && this.aLetter.setEnabled(!0), this.aSms && this.aSms.setEnabled(!0), this.aFaxEmail && this.aFaxEmail.setEnabled(!0), this.aImportMap && this.aImportMap.setEnabled(!0), this.aCreateDocument && this.aCreateDocument.setEnabled(!0), this.aUploadDocument && this.aUploadDocument.setEnabled(!0), this.aViewDocument && this.aViewDocument.setEnabled(!0), this.aAttachFrom && this.aAttachFrom.setEnabled(!0), this.aZoomAcross && this.aZoomAcross.setEnabled(!0), this.aMarkToExport && this.aMarkToExport.setEnabled(!0), this.aArchive && this.aArchive.setEnabled(!0), this.aEmailAttach && this.aEmailAttach.setEnabled(!0), this.aAppointment && this.aAppointment.setEnabled(!0), this.aTask && this.aTask.setEnabled(!0), this.aRequest && this.aRequest.setEnabled(!0), this.aWorkflow && this.aWorkflow.setEnabled(!0), this.aCopy && this.aCopy.setEnabled(!0), this.aLock && this.aLock.setEnabled(!0)); t.getIsInserting() ? this.statusBar.setInfo(null) : (v = n.GridTab.prototype.getTrxInfo(this.curTab.getTableName(), n.context, this.curTab.getWindowNo(), this.curTab.getTabNo()), v != null && this.statusBar.setInfo(v)); this.curWinTab == this.vTabbedPane && this.curWinTab.evaluate(null) }; i.prototype.setStatusLine = function (n, t) { this.statusBar.setStatusLine(n, t) }; i.prototype.cmd_refresh = function () { this.cmd_save(!1); this.curGC.dataRefreshAll() }; i.prototype.cmd_ignore = function () { this.curGC.dataIgnore() }; i.prototype.cmd_help = function () { var t = new n.Apps.help(this.gridWindow) }; i.prototype.cmd_cardDialog = function () { var t = new n.CVDialog(this); t.show() }; i.prototype.cmd_save = function (t, i) { var f, u, r; if (this.curST != null && (t = !1), this.errorDisplayed = !1, this.curST != null) { this.curST.saveData(); this.aSave.setEnabled(!1); return } return f = !0, this.curTab.getCommitWarning().length > 0 && this.curTab.needSave(!0, !1) && (f = !1, u = this, n.ADialog.confirm("SaveChanges?", !0, this.curTab.getCommitWarning(), "Confirm", function (n) { if (n) { var i = u.curGC.dataSave(t); t && !i && !u.errorDisplayed; this.curGC.refreshTabPanelData(this.curTab.getRecord_ID()); t && u.curGC.dynamicDisplay(-1) } }), i && i(r)), f ? (r = this.curGC.dataSave(t), t && !r && !this.errorDisplayed, t && this.curGC.dynamicDisplay(-1), i && i(r), this.curGC.refreshTabPanelData(this.curTab.getRecord_ID()), r) : void 0 }; i.prototype.cmd_new = function (n) { this.curTab.getIsInsertRecord() && this.curGC.dataNew(n) }; i.prototype.cmd_delete = function () { var t, i; if (!this.curTab.getIsReadOnly()) { if (t = this.curGC.canDeleteRecords(), t.length > 0) { n.ADialog.error("CannotDelete", !0, " [ " + t.join(",") + "]"); return } i = this; n.ADialog.confirm("DeleteRecord?", !0, "", "Confirm", function (n) { n && i.curGC.dataDelete() }) } }; i.prototype.cmd_find = function (n) { var t, r, i, u; if (this.curTab) { if (!this.defaultSearch) { this.defaultSearch = !0; return } this.setBusy(!0); t = null; n && n.trim() !== "" && (n = "%" + n + "%", t = this.curTab.getSearchQuery(n)); r = 0; i = !1; this.curTab.getTableModel().setCurrentPage(1); this.isSummaryVisible ? this.curTab.setShowSummaryNodes(!0) : this.curTab.setShowSummaryNodes(!1); this.curGC.skipRowInserting(!0); t != null && t.getIsActive() ? (this.curTab.setQuery(t), this.curGC.query(0, 0, i)) : (u = 0, this.curTab.setQuery(null), this.curGC.query(r, u, i)) } }; i.prototype.cmd_chat = function () { var o = this.curTab.getRecord_ID(), r, u, f, t, i, e; if (o == -1) { this.aChat.setEnabled(!1); return } for (r = null, u = null, f = 0; f < this.curTab.getFieldCount(); f++)if (t = this.curTab.getField(f), t.getIsKey() && (r = t.getHeader()), (t.getColumnName().toString() == "Name" || t.getColumnName().toString() == "DocumentNo") && t.getValue() != null && t.getValue() != "" && (u = t.getValue()), r != null && u != null) break; i = this; e = new n.Chat(o, this.curTab.getCM_ChatID(), this.curTab.getAD_Table_ID(), r + ": " + u, this.curWindowNo); e.onClose = function () { i.curTab.loadChats(); i.aChat.setPressed(i.curTab.hasChat()); i = null }; e.show() }; i.prototype.cmd_appointment = function () { var t = this.curTab.getRecord_ID(), i = this.curTab.getAD_Table_ID(); t != -1 && n.AppointmentsForm.init(i, t, 0, 0, !1, !0) }; i.prototype.cmd_task = function () { var t = this.curTab.getRecord_ID(), i = this.curTab.getAD_Table_ID(); t != -1 && n.AppointmentsForm.init(i, t, 0, 0, !0) }; i.prototype.cmd_letter = function () { var r = this.curTab.getRecord_ID(), i, t; if (r == -1) { this.aLetter.setEnabled(!1); return } i = new n.Email("", this.curTab, this.curGC, r, !1); t = new n.CFrame; t.setName(n.Msg.getMsg("Letter")); t.setTitle(n.Msg.getMsg("Letter")); t.hideHeader(!0); t.setContent(i); t.show(); i.initializeComponent() }; i.prototype.cmd_email = function () { var r = this.curTab.getRecord_ID(), i, t; if (r == -1) { this.aEmail.setEnabled(!1); return } i = new n.Email("", this.curTab, this.curGC, r, !0); t = new n.CFrame; t.setName(n.Msg.getMsg("EMail")); t.setTitle(n.Msg.getMsg("EMail")); t.hideHeader(!0); t.setContent(i); t.show(); i.initializeComponent() }; i.prototype.cmd_report = function () { var i, t, r, u, e, s, f, h, o; if (!n.MRole.getDefault().getIsCanReport(this.curTab.getAD_Table_ID())) { n.ADialog.warn("AccessCannotReport"); return } if (this.curTab.needSave(!0, !1)) { this.cmd_save(!0); return } for (i = null, i = this.curTab.query && this.curTab.query.list.length > 0 ? this.curTab.query : new n.Query(this.curTab.getTableName()), i.tableName = this.curTab.getTableName(), t = this.curTab.getLinkColumnName(), t.length == 0 && (t = this.curTab.getKeyColumnName()), r = null, u = null, e = 0, s = this.curTab.getFieldCount(); e < s; e++)if (f = this.curTab.getField(e), f.getIsKey() && (r = f.getHeader()), (f.getColumnName() == "Name" || f.getColumnName() == "DocumentNo") && f.getValue() != null && (u = f.getValue()), r != null && u != null) break; h = this.curTab.getParentColumnNames().length == 0; t.length != 0 && (h && (this.curTab.getLinkColumnName() == null || this.curTab.getLinkColumnName() == "") || (t.endsWith("_ID") ? r == null && u == null ? i.addRestriction(t, n.Query.prototype.EQUAL, n.context.getContextAsInt(this.curWindowNo, t)) : i.addRestriction(t, n.Query.prototype.EQUAL, n.context.getContextAsInt(this.curWindowNo, t), r, u) : r == null && u == null ? i.addRestriction(t, n.Query.prototype.EQUAL, n.context.getContext(this.curWindowNo, t)) : i.addRestriction(t, n.Query.prototype.EQUAL, n.context.getContext(this.curWindowNo, t), r, u))); o = this.curGC.onDemandTree ? this.isSummaryVisible ? new n.AReport(this.curTab.getAD_Table_ID(), i, this.curTab.getAD_Tab_ID(), this.curWindowNo, this.curTab, this.curGC.treeID, this.curGC.treeNodeID, !0) : new n.AReport(this.curTab.getAD_Table_ID(), i, this.curTab.getAD_Tab_ID(), this.curWindowNo, this.curTab, this.curGC.treeID, this.curGC.treeNodeID, !1) : new n.AReport(this.curTab.getAD_Table_ID(), i, this.curTab.getAD_Tab_ID(), this.curWindowNo, this.curTab, 0, 0, !1) }; i.prototype.cmd_print = function () { var i = this.curGC.getSelectedRows(), r, f, s, l, h, o, t, c, u; if (i.length == 0) { n.ADialog.info("SelectRecord"); return } if (r = this.curTab.getAD_Process_ID(), r != 0) if (f = "VIS_118", s = [], s[0] = new n.DB.SqlParam("@AD_Process_ID", r), l = e(f, s), f = "VIS_119", h = e(f), i.length > 1 && l > 0 && h && h.toString() > "1.0.0.3") { if (this.curTab.needSave(!0, !1)) { this.cmd_save(!0); return } for (o = "", t = 0; t < i.length; t++)t == 0 ? o = i[t][this.curTab.getKeyColumnName().toLower()] : o += "," + i[t][this.curTab.getKeyColumnName().toLower()]; u = new n.APrint(r, this.curTab.getAD_Table_ID(), 0, this.curWindowNo, o, this.curTab, !0); u.start(this.aPrint.getListItmIT()) } else { if (c = this.curTab.getRecord_ID(), c == -1) { n.ADialog.info(n.Msg.getMsg("SelectRecord")); return } if (this.curTab.needSave(!0, !1)) { this.cmd_save(!0); return } u = new n.APrint(r, this.curTab.getAD_Table_ID(), c, this.curWindowNo, null, this.curTab); u.start(this.aPrint.getListItmIT()) } }; i.prototype.cmd_sms = function () { var r = this.curTab.getRecord_ID(), i, t; if (r == -1) { this.aSms.setEnabled(!1); return } i = new n.Sms(this.curTab, this.curGC, r, !1); t = new n.CFrame; t.setName(n.Msg.getMsg("Sms")); t.setTitle(n.Msg.getMsg("Sms")); t.hideHeader(!0); t.setContent(i); t.show(); i.initializeComponent() }; i.prototype.cmd_subscribe = function () { var i = this.curTab.getRecord_ID(), t, r; if (i == -1) { this.aSubscribe.setEnabled(!1); return } t = this; r = function () { t.curTab.loadSubscribe(); t.aSubscribe.setPressed(t.curTab.HasSubscribed()) }; n.dataContext.subscribeUnsubscribeRecords(this.curTab.getCM_SubScribedID(), this.curTab.getAD_Window_ID(), i, this.curTab.getAD_Table_ID(), r) }; i.prototype.cmd_ImportMap = function () { if (window.VDIU) { if (this.curTab.getIsReadOnly()) { n.ADialog.warn("ReadOnly"); return } var i = new VDIU.ImportExcel(this.curTab.getAD_Window_ID(), this.gridWindow.getName()), t = new n.CFrame; t.setName(n.Msg.getMsg("Import")); t.setTitle(n.Msg.getMsg("Import")); t.setContent(i); t.show(); i.initialize() } else n.ADialog.error("PleaseInstallExcelImportModule") }; i.prototype.cmd_attachment = function () { if (this.curTab.getRecord_ID() < 1) { this.aAttachment.setEnabled(!1); return } var t = this, i = new n.attachmentForm(0, 0, this.curTab.getAD_Table_ID(), this.curTab.getRecord_ID(), ""); i.show(); i.onClose = function () { t.curTab.loadAttachments(); t.aAttachment.setPressed(t.curTab.hasAttachment()); t = null } }; i.prototype.cmd_history = function () { var t = null, i = 0, r = 0; (Object.keys(this.curGC.getColumnNames()).indexOf("C_BPartner_ID") > 0 || this.curTab.getField("C_BPartner_ID") != null && this.curTab.getField("C_BPartner_ID").getValue() > 0) && (i = this.curTab.getField("C_BPartner_ID").getValue()); (Object.keys(this.curGC.getColumnNames()).indexOf("AD_User_ID") > 0 || this.curTab.getField("AD_User_ID") != null && this.curTab.getField("AD_User_ID").getValue() > 0) && (r = this.curTab.getField("AD_User_ID").getValue()); t = new n.AttachmentHistory(this.curTab.getAD_Table_ID(), this.curTab.getRecord_ID(), i, r, this.curTab.getKeyColumnName()); t.show() }; i.prototype.cmd_finddialog = function () { var i = new n.Find(this.curWindowNo, this.curTab, 0), t = this, r = ""; i.onClose = function () { var e, o; if (i.getIsOKPressed() || i.needRefresh()) { t.setAdvancedSerachText(!0, ""); t.curTab.searchText = ""; t.isSummaryVisible ? t.curTab.setShowSummaryNodes(!0) : t.curTab.setShowSummaryNodes(!1); var u = i.getQuery(), s = i.getCurrentDays(), f = i.getIsCreated(); r = i.getSavedQueryName(); t.curTab.userQueryID = i.getSavedID(); i.dispose(); i = null; t.curTab.getTableModel().setCurrentPage(1); u != null && u.getIsActive() ? (t.curTab.setQuery(u), t.curGC.query(0, 0, f)) : u != null && (e = n.MRole.getDefault().getMaxQueryRecords(), t.curTab.setQuery(null), t.curGC.query(s, e, f)); o = t.curTab.getIsQueryActive() || t.curTab.getOnlyCurrentDays() > 0; t.aFind.setPressed(o) } t.refreshSavedASearchList(!1, r); t = null }; i.show() }; i.prototype.cmd_preference = function () { var t = new n.Framework.UserPreference; t.load(); t.showDialog(); t = null }; i.prototype.cmd_infoWindow = function () { n.InfoMenu.show(this.aInfo.getItem()) }; i.prototype.cmd_zoomAcross = function () { var r = this.curTab.getRecord_ID(), i, t, u; r > 0 && (i = new n.Query, t = this.curTab.getKeyColumnName(), t.length == 0 && (t = this.curTab.getLinkColumnName()), t.length != 0 && (t.endsWith("_ID") ? i.addRestriction(t, n.Query.prototype.EQUAL, n.context.getContextAsInt(this.curWindowNo, t)) : i.addRestriction(t, n.Query.prototype.EQUAL, n.context.getContext(this.curWindowNo, t))), u = new n.AZoomAcross(this.aZoomAcross, this.curTab.getTableName(), i, this.curTab.getAD_Window_ID(), this, this.aZoomAcross.getListItmIT(), t, r), u.init()) }; i.prototype.cmd_request = function () { var t = this.curTab.getRecord_ID(); if (t > 0) { var r = this.curTab.getAD_Table_ID(), u = this.curTab.getValue("C_BPartner_ID"), i = new n.ARequest(this.aRequest, r, t, u, null, this.aRequest.getListItmIT()); i.getRequests(); i = null } }; i.prototype.cmd_markToExport = function () { var f = this.curTab.getRecord_ID(), e = this.curGC.getSelectedRows(), h = null, o = this.curTab.getAD_Table_ID(), s = this.curTab.getTableName(), c, l, a, r, v, u, i, t; if (f == -1) { if (c = { AD_Table_ID: o }, l = n.dataContext.getJSONData(n.Application.contextUrl + "JsonData/GetKeyColumns", c), l == null) return } else { if (a = s + "_ID", r = "", this.curGC.singleRow) { h = f; i = new n.MarkModule; i.init(h, o, s); i.show(); t = this; i.onClose = function () { t.curTab.loadMarking(); t.aMarkToExport.setPressed(t.curTab.hasMarked()); t = null }; return } if (v = e.length, v == 1) r = f; else { for (u = 0; u < e.length; u++)r += e[u][a.toLowerCase()] + ","; r.endsWith(",") && (r = r.substring(0, r.length - 1)) } i = new n.MarkModule; i.init(r, o, s); i.show(); t = this; i.onClose = function () { t.curTab.loadMarking(); t.aMarkToExport.setPressed(t.curTab.hasMarked()); t = null }; return } }; i.prototype.cmd_lock = function () { var i = !1, t; this.isPersonalLock && ((t = this.curTab.getRecord_ID(), t == -1 || t < 0) || (this.curTab.locks(n.context, t, this.aLock.getIsPressed()), this.curTab.loadAttachments(), i = this.curTab.getIsLocked(), this.aLock.setPressed(i))) }; i.prototype.cmd_recAccess = function () { var t = new n.RecordAccessDialog; t.Load(this.curTab.getAD_Table_ID(), this.curTab.getRecord_ID()) }; i.prototype.ShowSummaryNodes = function () { this.isSummaryVisible ? (this.aShowSummaryLevel.setPressed(!1), this.isSummaryVisible = !1) : (this.aShowSummaryLevel.setPressed(!0), this.isSummaryVisible = !0) }; i.prototype.cmd_call = function () { var r = this.curTab.getRecord_ID(), u, i, t; if (r == -1) { this.aCall.setEnabled(!1); return } u = this.curTab.getAD_Table_ID(); VA048 && VA048.Apps ? (i = new VA048.Apps.CallForm, i.initializeComponent(u, r), t = new n.CFrame, t.setName(n.Msg.getMsg("Call")), t.setTitle(n.Msg.getMsg("Call")), t.hideHeader(!0), t.setContent(i), t.show()) : alert(n.Msg.getMsg("Please install Communication module first")) }; i.prototype.dispose = function () { this.aParentDetail && this.aParentDetail.dispose(); this.curST != null && (this.curST.unRegisterAPanel(), this.curST = null); this.vTabbedPane.dispose(); this.vTabbedPane = null; this.gridWindow && (this.gridWindow.dispose(), this.gridWindow = null, this.ctx.setAutoCommit(this.$parentWindow.getWindowNo(), !1), this.ctx.removeWindow(this.$parentWindow.getWindowNo()), n.MLookupCache.cacheReset(this.$parentWindow.getWindowNo())); this.ctx = null; this.$parentWindow = null; this.tabPages = null; this.curGC = null; this.curST = null; this.aParentDetail = null; this.curTab = null; this.disposeComponent() }; n.APanel = i }(VIS, jQuery)