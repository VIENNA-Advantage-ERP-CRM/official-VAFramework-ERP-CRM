/*** version 1.2.151.1***/(function (n) { function i(n, t) { if (!(n.originalEvent.touches.length > 1)) { n.preventDefault(); var i = n.originalEvent.changedTouches[0], r = document.createEvent("MouseEvents"); r.initMouseEvent(t, !0, !0, window, 1, i.screenX, i.screenY, i.clientX, i.clientY, !1, !1, !1, !1, 0, null); n.target.dispatchEvent(r) } } if (n.support.touch = "ontouchend" in document, n.support.touch) { var t = n.ui.mouse.prototype, u = t._mouseInit, f = t._mouseDestroy, r; t._touchStart = function (n) { var t = this; !r && t._mouseCapture(n.originalEvent.changedTouches[0]) && (r = !0, t._touchMoved = !1, i(n, "mouseover"), i(n, "mousemove"), i(n, "mousedown")) }; t._touchMove = function (n) { r && (this._touchMoved = !0, i(n, "mousemove")) }; t._touchEnd = function (n) { r && (i(n, "mouseup"), i(n, "mouseout"), this._touchMoved || i(n, "click"), r = !1) }; t._mouseInit = function () { var t = this; t.element.bind({ touchstart: n.proxy(t, "_touchStart"), touchmove: n.proxy(t, "_touchMove"), touchend: n.proxy(t, "_touchEnd") }); u.call(t) }; t._mouseDestroy = function () { var t = this; t.element.unbind({ touchstart: n.proxy(t, "_touchStart"), touchmove: n.proxy(t, "_touchMove"), touchend: n.proxy(t, "_touchEnd") }); f.call(t) } } })(jQuery); String.prototype.equals = function (n, t) { return t ? this.toString().toLowerCase() === n.toLowerCase() : this.toString() === n }; String.prototype.equalsIgnoreCase = function (n) { return this.toString().toLowerCase() === n.toLowerCase() }; String.prototype.startsWith = function (n) { return n === "" ? !0 : this == null || n == null ? !1 : (n = String(n), this.length >= n.length && this.slice(0, n.length) === n) }; String.prototype.endsWith = function (n) { return n === "" ? !0 : this == null || n == null ? !1 : (n = String(n), this.length >= n.length && this.slice(this.length - n.length) === n) }; String.prototype.contains = function (n) { return this.indexOf(n) > -1 }; String.prototype.toUpper = function () { return this.toUpperCase() }; String.prototype.toLower = function () { return this.toLowerCase() }; String.prototype.compareTo = function (n) { var u = this.length, f = n.length, o = u < f ? u : f, t, r, e; for (i = 0; i < o; i++)if (t = this.charCodeAt(i), r = n.charCodeAt(i), t != r) return t > r ? 1 : t < r ? -1 : 0; return e = u - f, e > 0 ? 1 : e < 0 ? -1 : 0 }; String.prototype.replaceAll = function (n, t) { var i = this; return i.replace(new RegExp(n, "g"), t) }; Number.prototype.compareTo = function (n) { var t = this - n; return t > 0 ? 1 : t < 0 ? -1 : 0 }; Array.prototype.indexOf || (Array.prototype.indexOf = function (n) { for (var t = 0; t < this.length; t++)if (this[t] === n) return t; return -1 }); StringBuilder = function (n) { this.str = n ? n : "" }; StringBuilder.prototype.append = function (n) { return this.str += n, this }; StringBuilder.prototype.toString = function () { return this.str }; StringBuilder.prototype.endsWith = function (n) { return this.str.endsWith(n) }; StringBuilder.prototype.replace = function (n, t) { var i = this.str; return i.replace(new RegExp(n, "g"), t) }; StringBuilder.prototype.indexOf = function (n) { return this.str.indexOf(n) }; StringBuilder.prototype.length = function () { return this.str.length }; StringBuilder.prototype.insert = function (n, t) { return this.str = n > 0 ? this.str.substring(0, n) + t + this.str.substring(n, this.str.length) : t + this.str, this.str }; StringBuilder.prototype.clear = function () { return this.str.length = 0, this.str = "", this }; Date.prototype.toUniversalTime = function () { return new Date(this.getTime()) }; VISUtil = window.VISUtil || {}, function (n, t) { function l(t, i, r) { var u = function (u) { var f, e, o; if (isNaN(u) || u === null) return 0; if (f = u.toString(), e = f.indexOf("."), e != -1) { if (o = f.substring(0, e), o.length > t) return o = o.substring(0, t), o + f.substring(e, f.Length - e) } else if (i === 0 && r === 0) { if (f > n.EnvConstants.INT32MAXVALUE) return n.EnvConstants.INT32MAXVALUE; if (f < -1 * (n.EnvConstants.INT32MAXVALUE + 1)) return -1 * (n.EnvConstants.INT32MAXVALUE + 1) } return u }; this.GetFormatedValue = function (n) { var t = u(n).toString(); return r != 0 && (t.indexOf(".") <= -1 ? t = parseFloat(t).toFixed(r) : t.split(".")[1].length > r ? (t = parseFloat(t).toFixed(i), t = parseFloat(t)) : r === i && (t = parseFloat(t).toFixed(r))), t }; this.GetConvertedNumber = function (n, t) { return t ? Number(String(n).replace(/[^0-9.-]+/g, "")) : Number(String(n).replace(/[^0-9,-]+/g, "").replace(/[,]+/g, ".")) }; this.GetConvertedString = function (n, t) { var i = ""; return t ? (i = n.match(/[.]+/g), i != null && i.length > 1 ? "" : String(String(n).replace(/[^0-9.-]+/g, ""))) : (i = n.match(/[,]+/g), i != null && i.length > 1 ? "" : String(String(n).replace(/[^0-9,-]+/g, "").replace(/[,]+/g, ","))) }; this.GetFormatAmount = function (n, t, i) { var e = window.navigator.language, o = String(n), f = "", u, r; return t == "init" ? f = o.split(".") : (t == "blur" || t == "formatOnly") && (f = i ? o.split(".") : o.split(",")), f[1] != undefined && (u = f[1].replace(/[\D\s\,_\-]+/g, "")), r = f[0].replace(/[\s\._]+/g, ""), r = r ? parseInt(r, 10) : 0, u != undefined ? t == "init" || t == "formatOnly" ? i ? r.toLocaleString(e) + "." + u : r.toLocaleString(e) + "," + u : i ? r + "." + u : r + "," + u : t == "init" || t == "formatOnly" ? i ? r.toLocaleString(e) : r.toLocaleString(e) : i ? r : r }; this.getMinFractionDigit = function () { return r }; this.getMaxFractionDigit = function () { return i }; this.dispose = function () { this.GetFormatedValue = null; this.GetConvertedNumber = null; this.GetConvertedString = null; this.GetFormatAmount = null; u = null } } function r(n) { this.pattern; this.applyPattern(n) } function f(t, i, r, u) { n.dataContext.getDataSetJString(i, r, function (n) { u(n) }) } function a(t, i, r, u) { n.dataContext.executeQuery(i, r, function (n) { u(n) }) } function v(t, i, r, u) { n.dataContext.executeQueries(i, r, function (n) { u(n) }) } function s(n, t) { this.name = n; this.value = t; this.isDate = !1; this.isByteArray = !1 } function e() { this.tables = []; this.total = 0 } function u() { this.count = 0; this.totalPage = 0; this.page = 1; this.columns = []; this.rows = []; this.totalRecord = 0; this.columnsName = [] } function o(n, t) { this.cells = n.cells; this.id = n.id; this.parent = t } function i() { return this.rowIndex = -1, this.tables = [], this.curTable, this } function h() { } function c() { this.List = { sq: { decimalSeparator: !1 }, ar: { decimalSeparator: !0 }, bg: { decimalSeparator: !1 }, be: { decimalSeparator: !1 }, ca: { decimalSeparator: !1 }, zh: { decimalSeparator: !0 }, "zh-HK": { decimalSeparator: !0 }, "zh-CN": { decimalSeparator: !0 }, "zh-TW": { decimalSeparator: !0 }, hr: { decimalSeparator: !0 }, cs: { decimalSeparator: !1 }, da: { decimalSeparator: !1 }, nl: { decimalSeparator: !1 }, en: { decimalSeparator: !0 }, "en-AU": { decimalSeparator: !0 }, "en-CA": { decimalSeparator: !0 }, "en-IN": { decimalSeparator: !0 }, "en-NZ": { decimalSeparator: !0 }, "en-ZA": { decimalSeparator: !0 }, "en-US": { decimalSeparator: !0 }, "en-GB": { decimalSeparator: !0 }, et: { decimalSeparator: !1 }, fi: { decimalSeparator: !1 }, fr: { decimalSeparator: !1 }, "fr-CA": { decimalSeparator: !1 }, "fr-FR": { decimalSeparator: !1 }, "fr-CH": { decimalSeparator: !1 }, de: { decimalSeparator: !1 }, "de-AT": { decimalSeparator: !1 }, "de-DE": { decimalSeparator: !1 }, "de-LI": { decimalSeparator: !1 }, "de-CH": { decimalSeparator: !1 }, el: { decimalSeparator: !1 }, he: { decimalSeparator: !0 }, hi: { decimalSeparator: !0 }, hu: { decimalSeparator: !1 }, is: { decimalSeparator: !1 }, it: { decimalSeparator: !1 }, "it-IT": { decimalSeparator: !1 }, "it-CH": { decimalSeparator: !1 }, ja: { decimalSeparator: !0 }, ko: { decimalSeparator: !0 }, lv: { decimalSeparator: !1 }, lt: { decimalSeparator: !1 }, mk: { decimalSeparator: !1 }, nb: { decimalSeparator: !1 }, nn: { decimalSeparator: !1 }, pl: { decimalSeparator: !1 }, pt: { decimalSeparator: !1 }, "pt-BR": { decimalSeparator: !1 }, "pt-PT": { decimalSeparator: !1 }, ro: { decimalSeparator: !1 }, ru: { decimalSeparator: !1 }, sr: { decimalSeparator: !1 }, sh: { decimalSeparator: !1 }, sk: { decimalSeparator: !1 }, sl: { decimalSeparator: !1 }, es: { decimalSeparator: !1 }, "es-AR": { decimalSeparator: !1 }, "es-CL": { decimalSeparator: !1 }, "es-CO": { decimalSeparator: !1 }, "es-CR": { decimalSeparator: !1 }, "es-HN": { decimalSeparator: !1 }, "es-MX": { decimalSeparator: !1 }, "es-PE": { decimalSeparator: !1 }, "es-ES": { decimalSeparator: !1 }, "es-US": { decimalSeparator: !1 }, "es-UY": { decimalSeparator: !1 }, "es-VE": { decimalSeparator: !1 }, sv: { decimalSeparator: !1 }, th: { decimalSeparator: !0 }, tr: { decimalSeparator: !1 }, uk: { decimalSeparator: !1 }, vi: { decimalSeparator: !1 } } } n.Events = function () { var n = "click", t = "touchstart", i = "click", r; return "onmouseover" in document && "ontouchstart" in document ? (n = "click", t = "click") : "ontouchstart" in document ? (n = "touchstart", t = "touchstart") : (n = "click", t = "click"), i = "ontouchend" in document ? "touchend" : "click", r = "click", { onTouchStartOrClick: n, onTouchEndOrClick: i, onClick: r, onTouchStartAndClick: t } }(); n.Actions = { zoom: "zoom", refresh: "refresh", preference: "preference", add: "add", update: "update", remove: "delete", contact: "contact" }; n.EnvConstants = { WINDOW_FIND: 1110, WINDOW_MLOOKUP: 1111, WINDOW_CUSTOMIZE: 1112, WINDOW_INFO: 1113, TAB_INFO: 1113, WINDOW_ACCOUNT: 1114, WINDOW_TEMP: 111e5, INT32MAXVALUE: 2147483647 }; n.Format = l; n.Utility = { divCoding: t("<div>"), inheritPrototype: function (n, t) { var i = Object.create(t.prototype); i.constructor = n; n.prototype = i; n.prototype.$super = t.prototype }, getBusyPanel: function () { return t("<div>").html(t("<strong>").html("Loading....")) }, getFunctionByName: function (n, t) { for (var f = [].slice.call(arguments).splice(2), r = n.split("."), u = r.pop(), i = 0; i < r.length; i++)t = t[r[i]]; return t[u] }, utf8_to_b64: function (n) { return window.btoa(unescape(encodeURIComponent(n))) }, b64_to_utf8: function (n) { return decodeURIComponent(escape(window.atob(n))) }, decodeText: function (n) { return this.divCoding.html(n).text() }, encodeText: function (n) { return this.divCoding.text(n).html() } }; n.Utility.encode = n.Utility.utf8_to_b64; n.Utility.decode = n.Utility.b64_to_utf8; n.Utility.Util = { getValueOfInt: function (n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : parseInt(n.toString()) }, getValueOfDecimal: function (n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : parseFloat(n.toString()) }, getValueOfDouble: function (n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : parseFloat(n.toString()) }, getValueOfString: function (n) { return n == null || n.toString().trim() == "" ? "" : n == null ? "" : n.toString() }, getValueOfDate: function (n) { return n == null || n.toString().trim() == "" ? 0 : n ? new Date(n) : null }, getValueOfFormattedDateTime: function (n) { if (n == null || n.toString().trim() == "") return 0; if (n) { var t = new Date(n), i, r, u, f, e, o; return i = t.getFullYear(), r = t.getMonth().toString().length === 1 ? "0" + (t.getMonth() + 1).toString() : t.getMonth() + 1, u = t.getDate().toString().length === 1 ? "0" + t.getDate().toString() : t.getDate(), f = t.getHours().toString().length === 1 ? "0" + t.getHours().toString() : t.getHours(), e = t.getMinutes().toString().length === 1 ? "0" + t.getMinutes().toString() : t.getMinutes(), o = t.getSeconds().toString().length === 1 ? "0" + t.getSeconds().toString() : t.getSeconds(), i + "-" + r + "-" + u + "T" + f + ":" + e + ":" + o } return null }, getValueOfBoolean: function (n) { return n == null || n.toString().trim() == "" ? null : n.toString().toLowerCase() == "true" || n.toString() == "Y" ? !0 : !1 }, contains: function (n, t) { return n.indexOf(t) > -1 }, isEmpty: function (n) { return n == null || n.length === 0 ? !0 : !1 }, cleanMnemonic: function (n) { if (n == null || n.length == 0) return n; var t = n.indexOf("&"); return t == -1 ? n : (t + 1 < n.length && n.charAt(t + 1) != " " && (n = n.substring(0, t) + n.substring(t + 1)), n) }, scale: function (n) { var t, i; return isNaN(n) ? 0 : (t = 1.1, t = t.toLocaleString().substring(1, 2), i = n.toString().split(t), i.length > 2 || i.length == 1) ? 0 : i[1].length } }; n.Env = function () { function s() { return i++ } function h() { return n.context } function c(n, t, i, r, u, f) { var l, c, s, a; if (typeof i != "number" && (f = u, u = r, r = i, i = 0), r == null || r.length == 0) return ""; for (var e = "", h = new String(""), o = r.indexOf("@"); o != -1 && o != r.lastIndexOf("@");) { if (l = r.substring(0, o), h += r.substring(0, o), r = r.substring(o + 1, r.length), c = r.indexOf("@"), c < 0) return ""; if (s = "", a = "", e = r.substring(0, c), e.contains(".") && (e = e.substring(0, e.indexOf("."))), s = n.getWindowContext(t, i, e, u), s.length == 0 && (e.startsWith("#") || e.startsWith("$")) && (s = n.getContext(e)), s.length == 0) { if (!f) return ""; h += " NULL " } else h += s; r = r.substring(c + 1, r.length); o = r.indexOf("@") } return h + r } function l() { return r } function a(n) { n && n.toString().length != 0 || (n = 50); r = n } function v() { return u } function y(n) { u = n } function p(n, t, i, r) { if (n == null || i == null) throw new IllegalArgumentException("Require Context"); var u = null; return r ? (u = n.getContext("#" + i), u.length == 0 && (u = n.getContext("$" + i))) : (u = n.getContext("P" + t + "|" + i), u.length == 0 && (u = n.getContext("P|" + i))), u == null ? "" : u } function w(n, t) { var i = ""; return t > 0 && (i += n.getWindowContext(t, "WindowName", !1) + "  "), i } function b(n) { var t, u, r; if (n == null) throw new Error("Require Context"); t = []; for (u in n) u.startsWith(i + "|") && t.push(u); while (t.length > 0) r = t.pop(), n[r] = null, delete n[r], r = null } function k(n, t) { if (isNaN(n) || n === null) return "0"; var i = n.toString(); return i.contains(t) && (i = i.split(t).join("")), i } function f(n, t) { var i = [], r, u; return i = n.split("."), r = Globalize.format(Number(i[0]), "N", Globalize.cultureSelector), u = i[1] === "" ? ".0" : i[1], r.substring(0, r.length - 3) + t + u } function d(t, i, r) { return i = n.Env.removeCultCommaDot(i, t.thousendSeprator), i = i.split(t.decimalSeprator).join("."), i = t.format.GetFormatedValue(i), r === n.DisplayType.Amount ? i = Globalize.format(Number(i), "N", Globalize.cultureSelector) : r === n.DisplayType.Number && (i = f(i.toString(), t.decimalSeprator)), i } function g() { return Date.now } function nt(n) { var i = ""; return i = typeof n != "string" ? e(n) : n, t() == i } function e(n) { if (n != null) { var i = n.getContext("#VAF_Language"); if (i != null && i.length > 0) return i } return t() } function t() { return "en_US" } function tt(n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : n > 0 ? 1 : n < 0 ? -1 : 0 } function it(n) { window.open(n) } function o(n) { return 1.1.toLocaleString(n).substring(1, 2) } function rt(n) { var t = window.navigator.language; return (n && n != "" && (t = n), o(t) != ",") ? !0 : !1 } var i = 1, r = 50, u = 400; return { getWindowNo: s, getCtx: h, parseContext: c, getWINDOW_PAGE_SIZE: l, setWINDOW_PAGE_SIZE: a, setScreenHeight: y, getScreenHeight: v, getPreference: p, getHeader: w, clearWinContext: b, removeCultCommaDot: k, numberCultureValueFormat: f, numberDisplay: d, isBaseLanguage: nt, getVAF_Language: e, getBaseVAF_Language: t, currentTimeMillis: g, signum: tt, startBrowser: it, isDecimalPoint: rt, getDecimalSeparator: o, ZERO: 0, ONE: 1, ONEHUNDRED: 100, NL: "\r\n", SHOW_CLIENT_ORG: 0, SHOW_CLIENT_ONLY: 1, SHOW_ORG_ONLY: 2, HIDE_CLIENT_ORG: 3, NULLString: "NULLValue", approveCol: "IsApproved" } }(); n.AEnv = function () { function s(n, i, r) { var u = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function h(t, i, r) { n.dataContext.getWindowJString({ windowNo: t, VAF_Screen_ID: i }, r) } function c(n) { return t('<button class="vis-controls-txtbtn-table-td2" ' + (n ? "disabled" : "") + ' ><i class="vis vis-find" /><\/button>') } function l(i) { var r = t("<ul class='vis-apanel-rb-ul'>"); return typeof i[n.Actions.zoom] != "undefined" && r.append(t("<li data-action='" + n.Actions.zoom + "' style='opacity:" + (i[n.Actions.zoom] ? .7 : 1) + "'><i data-action='" + n.Actions.zoom + "' class='vis vis-find'><\/i><span data-action='" + n.Actions.zoom + "'>" + n.Msg.getMsg("Zoom") + "<\/span><\/li>")), i[n.Actions.preference] && r.append(t("<li data-action='" + n.Actions.preference + "'><i data-action='" + n.Actions.preference + "' class='fa fa-cog'><\/i><span data-action='" + n.Actions.preference + "'>" + n.Msg.getMsg("Preference") + "<\/span><\/li>")), i[n.Actions.refresh] && r.append(t("<li data-action='" + n.Actions.refresh + "'><i data-action='" + n.Actions.refresh + "' class='vis vis-refresh'><\/i><span data-action='" + n.Actions.refresh + "'>" + n.Msg.getMsg("Requery") + "<\/span><\/li>")), i[n.Actions.add] && r.append(t("<li data-action='" + n.Actions.add + "'><i data-action='" + n.Actions.add + "' class='vis vis-addbp'><\/i><span data-action='" + n.Actions.add + "'>" + n.Msg.getMsg("Add") + "<\/span><\/li>")), i[n.Actions.update] && r.append(t("<li data-action='" + n.Actions.update + "'><i data-action='" + n.Actions.update + "' class='vis vis-updatebp'><\/i><span data-action='" + n.Actions.update + "'>" + n.Msg.getMsg("Update") + "<\/span><\/li>")), i[n.Actions.remove] && r.append(t("<li data-action='" + n.Actions.remove + "'><i data-action='" + n.Actions.remove + "' class='fa fa-arrow-left'><\/i><span data-action='" + n.Actions.remove + "'>" + n.Msg.getMsg("Clear") + "<\/span><\/li>")), i[n.Actions.contact] && r.append(t("<li data-action='" + n.Actions.contact + "'><i data-action='" + n.Actions.contact + "' class='fa fa-user'><\/i><span data-action='" + n.Actions.contact + "'>" + n.Msg.getMsg("Contact") + "<\/span><\/li>")), r } function a() { if (i == null) { i = !1; var u = 645; n.MRole.getIsTableAccess(u, !0) ? i = !0 : (u = 644, n.MRole.getIsTableAccess(u, !0) && (i = !0)); i && t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/GetWorkflowWindowID", data: { VAF_TableView_ID: u }, success: function (n) { var t = JSON.parse(n); t && !isNaN(t) && (r = parseInt(t)); r == 0 && (r = 297) } }) } return i } function v(t, i) { var u = null; t != 0 && i != 0 && (u = new n.Query("VAF_WFlow_Handler"), u.addRestriction("VAF_TableView_ID", n.Query.prototype.EQUAL, t), u.addRestriction("Record_ID", n.Query.prototype.EQUAL, i), n.viewManager.startWindow(r, u)) } function f(i, r) { var f = null, e = 0, o = 0, u = null, s; (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetZoomWindowID", data: { VAF_TableView_ID: i }, success: function (t) { u = (new n.DB.DataReader).toJson(t) } }), u.read() && (f = u.get(0).toString(), e = n.Utility.Util.getValueOfInt(u.getInt(1)), o = n.Utility.Util.getValueOfInt(u.getInt(2))), u.dispose(), f != null && e != 0) && (o == 0 || (s = f + "_ID=" + r, e = n.ZoomTarget.getZoomVAF_Screen_ID(f, 0, s, !0), e != 0)) && n.viewManager.startWindow(e, n.Query.prototype.getEqualQuery(f + "_ID", r)) } function y(t, i, r) { var e = null, h = 0, l = 0, s = 0, c = [], u, v, a; if (c[0] = new n.DB.SqlParam("@VAF_TableView_ID", t), c[1] = new n.DB.SqlParam("@VAF_WFlow_Task_ID", r), u = null, u = o("VIS_146", c), u.read()) e = u.get(0).toString(), h = n.Utility.Util.getValueOfInt(u.getInt(1)), l = n.Utility.Util.getValueOfInt(u.getInt(2)), s = n.Utility.Util.getValueOfInt(u.getInt(3)); else { f(t, i); return } if (u.dispose(), e != null || h != 0 || s == null || s == 0) { if (s != null && s != 0) { v = new n.Query; n.viewManager.startWindow(s, n.Query.prototype.getEqualQuery(e + "_ID", i)); return } (l == 0 || (a = e + "_ID=" + i, h = n.ZoomTarget.getZoomVAF_Screen_ID(e, 0, a, !0), h != 0)) && n.viewManager.startWindow(h, n.Query.prototype.getEqualQuery(e + "_ID", i)) } } var i = null, r = 0, u = n.Application.contextUrl, e = u + "JsonData/JDataSetWithCode", p = u + "JsonData/ExecuteNonQuer", o = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, s(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; return { getGridWindow: h, getContextPopup: l, getZoomButton: c, getIsWorkflowProcess: a, startWorkflowProcess: v, zoom: f, wfzoom: y } }(); r.prototype.typeList = ["", "", "number", "", "date", "", "time", "", "choice"]; r.prototype.modifierList = ["", "", "currency", "", "percent", "", "integer"]; r.prototype.dateModifierList = ["", "", "short", "", "medium", "", "long", "", "full"]; r.prototype.allFormats = { currency: "C", decimal: "D", general: "G", number: "N", percent: "P", shortdate: "d", longdate: "D", shorttime: "t", longtime: "T", fulltime: "T", fulldate: "D", mediumdate: "d", mediumtime: "t", choice: "" }; r.prototype.applyPattern = function (n) { var r, t, u, i; if (!this.cmpreFormat(n)) { this.pattern = n; return } for (r = [], t = new StringBuilder(""), u = 0; u < n.length; ++u)i = n[u], i == "{" ? t.length() == 0 ? t.append(i) : (r.push(t.toString()), t.clear(), t.append(i)) : i == "}" ? (t.append(i), r.push(t.toString()), t.clear()) : u == n.length ? (r.add(t.toString()), t.clear()) : t.append(i); this.pattern = this.parsePattren(r) }; r.prototype.parsePattren = function (n) { for (var r = new StringBuilder(" "), t, i = 0; i < n.length; i++) { if (t = n[i], t.startsWith("{") && this.cmpreFormat(t)) { t = this.getFormat(t.split(",")); r.append(t); continue } r.append(t) } return r.toString() }; r.prototype.getFormat = function (n) { var i = new StringBuilder(n[0]), t = ""; switch (this.findKeyword(n[1], this.typeList)) { case 0: break; case 1: case 2: switch (this.findKeyword(n[2].toString(), this.modifierList)) { case 0: t = this.allFormats.number; break; case 1: case 2: t = this.allFormats.currency; break; case 3: case 4: t = this.allFormats.percent; break; case 5: case 6: t = this.allFormats.decimal; break; default: t = this.allFormats.number }break; case 3: case 4: switch (this.findKeyword(n[2], this.dateModifierList)) { case 0: t = this.allFormats.shortdate; break; case 1: case 2: t = this.allFormats.shortdate; break; case 3: case 4: t = this.allFormats.mediumdate; break; case 5: case 6: t = this.allFormats.longdate; break; case 7: case 8: t = this.allFormats.fulldate; break; default: t = n[3].ToString() }break; case 5: case 6: switch (this.FindKeyword(n[2].ToString(), this.dateModifierList)) { case 0: t = this.allFormats.shorttime; break; case 1: case 2: t = this.allFormats.shorttime; break; case 3: case 4: t = this.allFormats.mediumtime; break; case 5: case 6: t = this.allFormats.mediumtime; break; case 7: case 8: t = this.allFormats.mediumtime; break; default: t = n[2].ToString() }break; case 7: case 8: try { t = n[3]; this.allFormats.choice = n[3].ToString() } catch (r) { throw new ArgumentException("Choice Pattern incorrect"); } break; default: throw new ArgumentException("unknown format type at "); }return n = null, t = "", i.append(t).append("}"), i.toString() }; r.prototype.format = function (n) { var i = this.pattern, t, r; for (this.pattern = null, t = 0; t < n.length; t++)r = new RegExp("\\{" + t + "\\}", "gm"), i = i.replace(r, n[t]); return i }; r.prototype.cmpreFormat = function (n) { return n.contains("number,") || n.contains("date,") || n.contains("time,") || n.contains("custom,") ? !0 : !1 }; r.prototype.findKeyword = function (n, t) { for (var i = 0; i < t.length; i++)if (n.equals(t[i])) return i; return -1 }; n.DB = { QUOTE: "'", getDBDateFormat: function (n, t, i) { var r = "", u; return i || n.setMinutes(-n.getTimezoneOffset()), r = n.toISOString(), u = r.split("T"), r = u[0], t && (r += " " + u[1].substring(0, u[1].length - 5)), r }, to_date: function (n, t) { time = n && n.toString().length > 0 ? n instanceof Date ? n : new Date(n) : null; time.toString() == "Invaild Date" && (time = null); var i = "", r = ""; if (1) { if (time == null) return t ? "TRUNC(SysDate)" : "SysDate"; i += "TO_DATE('"; r = time; t ? (r = this.getDBDateFormat(time, !1, !1), i += r, i += "','YYYY-MM-DD')") : (r = this.getDBDateFormat(time, !0, !0), i += r, i += "','YYYY-MM-DD HH24:MI:SS')") } else if (DatabaseType.IsPostgre) { if (time == null) return t ? "TRUNC(SysDate)" : "SysDate"; i = new StringBuilder("TO_DATE('"); t ? (r = time.Value.ToString("yyyy-MM-dd"), i.Append(r), i.Append("','YYYY-MM-DD')")) : (r = time.Value.ToString("yyyy-MM-dd HH:mm:ss"), i.Append(r), i.Append("','YYYY-MM-DD HH24:MI:SS')")) } else if (DatabaseType.IsMSSql) { if (time == null) return t ? "CAST(STR(YEAR(Getdate()))+'-'+STR(Month(Getdate()))+'-'+STR(Day(Getdate())) AS DATETIME)" : "getdate()"; i = new StringBuilder("CAST('"); r = time.ToString(); t ? (i.Append(r.Substring(0, 10)), i.Append("' AS DATETIME)")) : (i.Append(r.Substring(0, r.IndexOf("."))), i.Append("' AS DATETIME)")) } return i.toString() }, to_char: function (t, i) { var r = "TRIM(TO_CHAR("; return r = r.concat(t), n.DisplayType.IsNumeric(i) ? r = i == n.DisplayType.Amount ? r.concat(",'9G999G999G999G990D00'") : r.concat(",'TM9'") : n.DisplayType.IsDate(i) && (r = r.concat(",'").concat("yyyy-MM-dd").concat("'")), r = r.concat("))"), r.toString() }, to_string: function (n, t) { var i, r, u, f; if (n == null && n.length == 0) return "NULL"; for (t != null && (t = 0), i = n, t != 0 && i.length > t && (i = n.substring(0, t)), r = new StringBuilder, r.append(this.QUOTE), u = 0; u < i.length; u++)f = i.charAt(u), f == this.QUOTE ? r.append("''") : r.append(f); return r.append(this.QUOTE), i = r.toString(), r.clear(), i }, executeDataSet: function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u; return i && (o.param = i), u = null, f(arguments, o, e, function (t) { u = (new n.DB.DataSet).toJson(t); e && r(u) }), u }, executeDataReader: function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u; return i && (o.param = i), u = null, f(arguments, o, e, function (t) { u = (new n.DB.DataReader).toJson(t); e && r(u) }), u }, executeReader: function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u; return i && (o.param = i), u = null, f(arguments, o, e, function (t) { u = (new n.DB.DataReader).toJson(t); e && r(u) }), u }, executeDataReaderPaging: function (t, i, r, u, e) { var s = e ? !0 : !1, h = { sql: t, page: i, pageSize: r }, o; return u && (h.param = u), o = null, f(arguments, h, s, function (t) { o = (new n.DB.DataReader).toJson(t); s && e(o) }), o }, executeDataSetPaging: function (t, i, r, u, e) { var s = e ? !0 : !1, h = { sql: t, page: i, pageSize: r }, o; return u && (h.param = u), o = null, f(arguments, h, s, function (t) { o = (new n.DB.DataSet).toJson(t); s && e(o) }), o }, executeScalar: function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u = null; return f(arguments, o, e, function (t) { var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; e && r(u) }), u }, executeQuery: function (n, t, i) { var u = i ? !0 : !1, r = null, f = { sql: n }; return t && (f.param = t), a(arguments, f, u, function (n) { r = JSON.parse(n); u && i(r) }), r }, executeQueries: function (n, t, i) { var u = i ? !0 : !1, r = null, f = { sql: n.join("/"), param: t }; return v(arguments, f, u, function (n) { r = JSON.parse(n); u && i(r) }), r } }; s.prototype.setIsDate = function (n) { this.isDate = n }; s.prototype.setIsByteArray = function (n) { this.isByteArray = n }; e.prototype.toJson = function (i) { var r = i, u, f; for (typeof i == "string" && (r = JSON.parse(i)), r = t.isArray(r) ? r : [r], u = 0; u < r.length; u++)f = new n.DB.DataTable, f.toJson(r[u]), this.tables.push(f); return r = null, this }; e.prototype.getTable = function (n) { return n > -1 && n < this.tables.length ? this.tables[n] : null }; e.prototype.getTables = function () { return this.tables }; e.prototype.dispose = function () { for (var n = this.tables.length; n > 0; n--)this.tables.pop().dispose(); this.tables.length = 0; this.tables = null }; u.prototype.toJson = function (t) { var i, r; if (t) { if (this.totalRecord = t.records, this.totalPage = t.total, this.page = t.page, t.columns) { for (i = 0; i < t.columns.length; i++)this.columnsName[i] = t.columns[i].name; for (r = 0; r < t.rows.length; r++)this.rows.push(new n.DB.DataRow(t.rows[r], this)); this.columns = t.columns } this.count = this.rows.count } t = null }; u.prototype.getRowCount = function () { return this.rows.length }; u.prototype.getColumnCount = function () { return this.columns.length }; u.prototype.getRow = function (n) { return n > -1 && n < this.rows.length ? this.rows[n] : null }; u.prototype.getRows = function () { return this.rows }; u.prototype.getColumnsName = function () { return this.columnsName }; u.prototype.dispose = function () { for (this.count = 0, this.totalPage = 0, this.page = 1, this.columns.length = 0, this.columns = null; this.rows.length > 0;)this.rows.pop().dispose(); this.rows.length = 0; this.rows = null; this.totalRecord = 0 }; o.prototype.getCell = function (n) { var t = -1, i = ""; isNaN(n) ? (n = n.toLowerCase(), t = this.parent.columnsName.indexOf(n), i = n) : (t = n, i = this.parent.columnsName[t]); var r = this.parent.columns[t], u = r.type, f = this.cells[i]; return u == "system.datetime", f }; o.prototype.getJSCells = function () { return this.cells }; o.prototype.dispose = function () { this.cells.length = 0; this.cells = null; this.id = null; this.parent = null }; i.prototype.toJson = function (i) { for (var r = JSON.parse(i), f, r = t.isArray(r) ? r : [r], u = 0; u < r.length; u++)f = new n.DB.DataTable, f.toJson(r[u]), this.tables.push(f), u === 0 && (this.curTable = this.tables[u]); return r = null, this }; i.prototype.read = function () { return this.curTable ? ++this.rowIndex >= this.curTable.getRowCount() ? !1 : !0 : !1 }; i.prototype.getCell = function (n) { return this.curTable.getRow(this.rowIndex).getCell(n) }; i.prototype.get = function (n) { return this.curTable.getRow(this.rowIndex).getCell(n) }; i.prototype.getString = function (n) { var t = this.curTable.getRow(this.rowIndex).getCell(n); return t == null ? "" : t.toString() }; i.prototype.getInt = function (n) { var t = this.curTable.getRow(this.rowIndex).getCell(n); return t == null ? 0 : parseInt(t) }; i.prototype.getDecimal = function (n) { var t = this.curTable.getRow(this.rowIndex).getCell(n); return t == null ? 0 : parseFloat(t) }; i.prototype.getDateTime = function (n) { return this.curTable.getRow(this.rowIndex).getCell(n) }; i.prototype.setTableIndex = function (n) { this.rowIndex = 0; this.curTable = this.tables[n] }; i.prototype.close = function () { }; i.prototype.dispose = function () { this.curTable = null; for (var n = this.tables.length; n > 0; n--)this.tables.pop().dispose(); this.tables.length = 0; this.tables = null; this.rowIndex = null }; h.prototype.max = function (n, t) { return n == null ? t : t == null ? n : n > t ? n : t }; c.prototype.isDecimalSeparatorDot = function (n) { return n && this.List[n] != undefined ? this.List[n].decimalSeparator : null }; n.DB.DataSet = e; n.DB.DataTable = u; n.DB.DataRow = o; n.DB.SqlParam = s; n.DB.DataReader = i; n.MessageFormat = r; n.TimeUtil = h; n.CultureSeparator = c }(VIS, jQuery); VIS.Logging = VIS.Logging || {}, function (n) { function t(n, t) { this.name = n; this.value = t } function e(n, t) { this._level = n; this._sequenceNumber; this._sourceClassName; this._sourceMethodName; this._message = t; this._lineNumber; this._loggerName } function o() { if (o.prototype.singleInstance) return o.prototype.singleInstance; o.prototype.singleInstance = this } function u() { if (u.prototype.singletonInstance) return u.prototype.singletonInstance; u.prototype.singletonInstance = this } function s() { this.offValue = t.OFF.getIntValue(); this.logLevel = t.ALL; this.formatter; this.filter } function f() { if (f.prototype.singleInstance) return f.prototype.singleInstance; this.setFormatter(u.get()); this.setLevel(t.INFO); this.setFilter(o.get()); this.ERROR_SIZE = 20; this.m_errors = []; this.m_history = []; this.LOG_SIZE = 100; this.m_logs = []; this.m_issueError = !0; f.prototype.singleInstance = this } function i(n) { this.levelValue = t.INFO.getIntValue(); this.name = n; this.levelObject; this.handlers = []; this.kids = []; this.manager = r.getLogManager(); this.parent; this.offValue = t.OFF.getIntValue(); this.filter } function c() { i.call(this, ""); this.setLevel(t.INFO) } function r() { if (r.prototype.singleInstance) return r.prototype.singleInstance; this.emptyHandlers = []; this.loggers = {}; this.defaultLevel = t.INFO; this.rootLogger; r.prototype.singleInstance = this } function h(n) { i.call(this, n) } function l() { var e = null, n = t.INFO, h = [t.OFF, t.SEVERE, t.WARNING, t.INFO, t.CONFIG, t.FINE, t.FINER, t.FINEST, t.ALL], c = function (n) { if (n != null) { var t = i.getLogger(""); t.addHandler(n); e.push(n) } }, d = function () { return t.ALL.getIntValue() == n.getIntValue() }, l = function () { var r, t, n; if (e == null) { e = []; try { for (r = i.getLogger(""), t = r.getHandlers(), n = 0; n < t.length; n++)e.contains(t[n]) || e.Add(t[n]) } catch (s) { } f.get(!1) == null && c(f.get(!0)); v(u.get()); y(o.get()) } }, s = function (t) { var i, r; if (t != null) { for (e == null && l(!0), i = 0; i < e.length; i++)r = e[i], r.setLevel(t); t.getIntValue() != n.getIntValue() && a(t, null); n = t } }, a = function (n, t) { var f, e, o, u, s; if (n != null) { f = r.getLogManager(); e = f.getLoggerNames(); for (o in e) u = o, (t == null || u.indexOf(t) != -1) && (s = i.getLogger(u), s.setLevel(n)) } }, v = function (n) { for (var i, t = 0; t < e.length; t++)i = e[t], i.setFormatter(n) }, y = function (n) { for (var i, t = 0; t < e.length; t++)i = e[t], i.setFilter(n) }, p = function () { return n }, w = function (n) { if (n) for (var t = 0; t < h.length; t++)if (h[t].getName().equals(n)) { s(h[t]); return } }, g = function () { return n.getIntValue() }, b = function () { var n = r.getLogManager(); n.reset() }, k = function (i) { if (i) s(n); else { var r = n; s(t.OFF); n = r } }; return { initialize: l, addHandler: c, setLevel: s, setLevelByString: w, getLevel: p, shutdown: b, enable: k, getIsLevelAll: function () { return t.ALL.getIntValue() == n.getIntValue() }, getIsLevelFinest: function () { return t.FINEST.getIntValue() >= n.getIntValue() }, getIsLevelFiner: function () { return t.FINER.getIntValue() >= n.getIntValue() }, getIsLevelFine: function () { return t.FINE.getIntValue() >= n.getIntValue() }, getIsLevelInfo: function () { return t.INFO.IntValue() >= n.IntValue() } } } t.prototype.getIntValue = function () { return this.value }; t.prototype.getName = function () { return this.name }; t.prototype.getLevel = function (n) { return t.OFF.getIntValue() == n ? t.OFF : t.SEVERE.getIntValue() == n ? t.SEVERE : t.WARNING.getIntValue() == n ? t.WARNING : t.INFO.getIntValue() == n ? t.INFO : t.CONFIG.getIntValue() == n ? t.CONFIG : t.FINE.getIntValue() == n ? t.FINE : t.FINER.getIntValue() == n ? t.FINER : t.FINEST.getIntValue() == n ? t.FINEST : t.ALL.getIntValue() == n ? t.ALL : void 0 }; t.OFF = new t("OFF", 9999); t.SEVERE = new t("SEVERE", 1e3); t.WARNING = new t("WARNING", 900); t.INFO = new t("INFO", 800); t.CONFIG = new t("CONFIG", 700); t.FINE = new t("FINE", 600); t.FINER = new t("FINER", 500); t.FINEST = new t("FINEST", 400); t.ALL = new t("ALL", 0); e.prototype.getMessage = function () { return this._message }; e.prototype.setMessage = function (n) { this._message = n }; e.prototype.getSourceClassName = function () { return this._sourceClassName }; e.prototype.setSourceClassName = function (n) { this._sourceClassName = n }; e.prototype.getSourceMethodName = function () { return this._sourceMethodName }; e.prototype.setSourceMethodName = function (n) { this._sourceMethodName = n }; e.prototype.getLineNumber = function () { return this._lineNumber }; e.prototype.setLineNumber = function (n) { this._lineNumber = n }; e.prototype.getLoggerName = function () { return this._loggerName }; e.prototype.setLoggerName = function (n) { this._loggerName = n }; e.prototype.getLevel = function () { return this._level }; o.prototype.singleInstance = null; o.get = function () { return o.prototype.singleInstance ? o.prototype.singleInstance : new o }; o.prototype.getIsLoggable = function (n) { var i, r; return n.getLevel() === t.SEVERE || n.getLevel() === t.WARNING ? !0 : (i = n.getLoggerName(), i && i.startsWith("System.")) ? !1 : (r = n.sourceClassName, r && r.startsWith("System.")) ? !1 : !0 }; u.prototype.singletonInstance = null; u.prototype.NL = "/n"; u.get = function () { return u.prototype.singletonInstance ? u.prototype.singletonInstance : new u }; u.prototype.format = function (n) { var i = new StringBuilder, r = Date.now.toString("yyyy-MM-dd hh:mm:ss.ms"), u; return r = r + "00", n.getLevel() == t.prototype.SEVERE ? (i.append("===========> "), i.append("    (SEVERE)   ")) : n.getLevel() == t.WARNING ? (i.append("-----------> "), i.append("    (WARNING)  ")) : (i.append(r.Substring(11, 12)), u = 11, n.getLevel() == t.INFO ? i.append("    (INFO)     ") : n.getLevel() == t.CONFIG ? i.append("    (CONFIG)   ") : n.getLevel() == t.FINE ? i.append("    (FINE)     ") : n.getLevel() == t.FINER ? i.append("    (FINER)    ") : n.getLevel() == t.FINEST && i.append("    (FINEST)   ")), i.append(n.message), i.toString() }; u.prototype.getHead = function () { var n = (new StringBuilder).append("*** ").append(DateTime.Now.ToString()).append(" VAdvantage Log ").append(" ***").append("\n").append("ViennaAdvantage"); return n.toString() }; u.prototype.getTail = function () { var n = (new StringBuilder).append("*** ").append(" VAdvantage Log").append(" ***"); return n.toString() }; u.prototype.getClassMethod = function (n) { var i = "", t = n.getLoggerName(), r, u; return ((t == null || t.indexOf("default") != -1 || t.indexOf("global") != -1) && (t = n.getSourceClassName()), t != null ? (r = t.lastIndexOf("."), i += r != -1 ? t.substring(r + 1) : t) : i += n.getLoggerName(), n.getSourceMethodName() != null && (i += "." + n.getSourceMethodName()), u = i, u.equals("Trace.printStack")) ? "" : u }; u.prototype.getParameters = function (n) { var r = "", i = n.getParameters(), t; if (i != null && i.length > 0) for (t = 0; t < i.length; t++)t > 0 && (r += ", "), r += i[t]; return r }; u.prototype.getExceptionTrace = function () { try { } catch (n) { } return "" }; s.prototype.publish = function () { }; s.prototype.close = function () { }; s.prototype.flush = function () { }; s.prototype.setLevel = function (n) { if (n == null) throw new NullReferenceException("No Level"); this.logLevel = n }; s.prototype.getLevel = function () { return this.logLevel }; s.prototype.getFilter = function () { return this.filter }; s.prototype.setFilter = function (n) { this.filter = n }; s.prototype.getIsLoggable = function (n) { var i = this.getLevel().getIntValue(), t; return n.getLevel().getIntValue() < i || i == this.offValue ? !1 : (t = this.getFilter(), t == null) ? !0 : t.getIsLoggable(n) }; s.prototype.getFormatter = function () { return this.formatter }; s.prototype.setFormatter = function (n) { this.formatter = n }; n.Utility.inheritPrototype(f, s); f.prototype.singleInstance = null; f.get = function (n) { return f.prototype.singleInstance ? f.prototype.singleInstance : n ? new f : null }; f.prototype.setLevel = function (n) { n != null && (n == t.OFF ? this.$super.setLevel.call(this, t.SEVERE) : n == t.ALL || n == t.FINEST || n == t.FINER ? this.$super.setLevel.call(this, t.FINE) : this.$super.setLevel.call(this, n)) }; f.prototype.publish = function (n) { var i, r, u, f, e; if (this.getIsLoggable(n) && this.m_logs != null) { if (this.m_logs.length >= this.LOG_SIZE && this.m_logs.shift(), this.m_logs.push(n), n.getLevel() == t.SEVERE) { for (this.m_errors.length >= this.ERROR_SIZE && (this.m_errors.shift(), this.m_history.shift()), this.m_errors.push(n), i = [], r = 0; r < this.m_logs.length; r++)if (u = this.m_logs[r], u.getLevel() == t.SEVERE) if (i.length == 0) i.push(u); else break; else if (i.push(u), i.length > 10) break; this.m_history.push(i); this.m_issueError && (f = n.getLoggerName(), e = n.getSourceMethodName()) } console.log(n) } }; f.prototype.close = function () { this.m_logs != null && (this.m_logs.length = 0, this.m_logs = null); this.m_errors != null && (this.m_errors.length = 0, this.m_errors = null); this.m_history != null && (this.m_history.length = 0, this.m_history = null) }; f.prototype.getColumnNames = function () { var n = [4]; return n[0] = "Time", n[1] = "Level", n[2] = "Class.Method", n[3] = "Message", n }; f.prototype.getRecords = function (n) { return n ? this.m_errors.slice() : this.m_logs.slice() }; f.prototype.getLogData = function (n) { for (var f = this.getRecords(n), e = [], r, t, i = 0, o = f.length; i < o; i++)r = f[i], t = [], t.push((new Date).toString()), t.push(r.getLevel().getName()), t.push(u.get().getClassMethod(r)), t.push(r.getMessage()), e.push(t); return e }; f.prototype.resetBuffer = function (n) { this.m_errors.length = 0; this.m_history.length = 0; n || (this.m_logs.length = 0) }; i.prototype.setFilter = function (n) { this.filter = n }; i.prototype.getFilter = function () { return this.filter }; i.prototype.log = function (n, i, r) { var i = i, f, u, o, s; if ((r && (r.message && (i += " => " + r.message), r.stack && (i += " ===> " + r.stack)), !(n.getIntValue() < this.levelValue) && this.levelValue != t.OFF.getIntValue()) && (f = new e(n, i), f.setLoggerName(this.name), this.filter == null || this.filter.getIsLoggable(f))) for (u = this; u != null;) { if (o = u.getHandlers(), o != null) for (s = 0; s < o.length; s++)o[s].publish(f); u = u.getParent() } }; i.prototype.getParent = function () { return this.parent }; i.prototype.getHandlers = function () { return this.handlers == null ? emptyHandlers : this.handlers }; i.prototype.getName = function () { return this.name }; i.prototype.setLevel = function (n) { this.levelObject = n; this.levelValue = n.getIntValue() }; i.prototype.getLevel = function () { return this.levelObject }; i.prototype.addHandler = function (n) { this.handlers == null && (handlers = []); this.handlers.push(n) }; i.prototype.removeHandler = function (n) { n != null && this.handlers != null && this.handlers.remove(n) }; i.getLogger = function (n) { var u = r.getLogManager(), t = u.getLogger(n); return t == null && (t = new i(n), u.addLogger(t), t = u.getLogger(n)), t }; i.prototype.setParent = function (n) { this.parent = n }; i.prototype.getIsLoggable = function (n) { return n.getIntValue() < levelValue || levelValue == offValue ? !1 : !0 }; i.prototype.fine = function (n) { t.FINE.getIntValue() < this.levelValue || this.log(t.FINE, n) }; i.prototype.info = function (n) { t.INFO.getIntValue() < this.levelValue || this.log(t.INFO, n) }; i.prototype.config = function (n) { t.CONFIG.getIntValue() < this.levelValue || this.log(t.CONFIG, n) }; i.prototype.finer = function (n) { t.FINER.getIntValue() < this.levelValue || this.log(t.FINER, n) }; i.prototype.finest = function (n) { t.FINEST.getIntValue() < this.levelValue || this.log(t.FINEST, n) }; i.prototype.severe = function (n) { t.SEVERE.getIntValue() < this.levelValue || this.log(t.SEVERE, n) }; i.prototype.warning = function (n) { t.WARNING.getIntValue() < this.levelValue || this.log(t.WARNING, n) }; i.prototype.saveError = function (n, t) { return this.saveError(n, t.message, !0) }; i.prototype.saveError = function (n, t, i) { return i && this.warning(n + " " + t.message), !0 }; i.prototype.getIsLevelFinest = function () { return l.getIsLevelFinest() }; n.Utility.inheritPrototype(c, i); r.prototype.singleInstance = null; r.prototype.addLogger = function (n) { var t = n.getName(), i = null; return (t in this.loggers && (i = loggers[t]), i != null) ? !1 : (this.loggers[t] = n, n instanceof c || n.setParent(this.rootLogger), !0) }; r.prototype.reset = function () { for (var n in this.loggers) ResetLogger(n) }; r.prototype.resetLogger = function (n) { var t = this.getLogger(n), r, i, u; if (t != null) { for (r = t.getHandlers(), i = 0; i < r.length; i++) { u = r[i]; t.removeHandler(u); try { u.close() } catch (f) { } } n != null && n.equals("") ? t.setLevel(this.defaultLevel) : t.setLevel(null) } }; r.prototype.getLogger = function (n) { return n in this.loggers ? this.loggers[n] : null }; r.getLogManager = function () { if (!r.prototype.singleInstance) { new r; var n = r.prototype.singleInstance; n.rootLogger = new c; n.addLogger(n.rootLogger) } return r.prototype.singleInstance }; r.prototype.getLoggerNames = function () { return this.loggers }; n.Utility.inheritPrototype(h, i); h.getVLogger = function (t) { var f = r.getLogManager(), i, u; return (t || (t = ""), i = f.getLogger(t), i != null && i instanceof h) ? i : (u = new h(t), u.setLevel(n.Logging.VLogMgt.getLevel()), f.addLogger(u), u) }; n.Logging.Level = t; n.Logging.LogRecord = e; n.Logging.VLogFilter = o; n.Logging.VLogFormatter = u; n.Logging.VLogErrorBuffer = f; n.Logging.Logger = i; n.Logging.VLogger = h; n.Logging.LogManager = r; n.Logging.VLogMgt = l() }(VIS, jQuery); VIS.Controls = {}, function (n, t) { function et(t, i, r) { var u = null; return n.ajax({ url: st, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(t) }).done(function (n) { u = n; r && r(n) }), u } function i(n, r, u, f, e) { if (this instanceof i) this.ctrl = n, this.displayType = r, this.isReadOnly = u, this.colName = f, this.isMandatory = e, this.oldValue = "oldValue", this.visible, this.tag, this.setVisible(!0), this.editingGrid = null; else return new t.controls.IControl(n, r, u, f, e) } function p(r, u, f, e, o, s, h, c, l) { var y = t.DisplayType.String, a = n("<input>", { type: l ? "password" : "text", name: r, maxlength: s }), v; i.call(this, a, y, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); v = this; a.on("change", function (n) { var t, i; n.stopPropagation(); t = a.val(); this.value = t; t !== v.oldValue && (i = { newValue: t, propertyName: v.getName() }, v.fireValueChanged(i), i = null) }); this.disposeComponent = function () { a.off("change"); a = null; v = null } } function ot(r, u, f, e) { var s, o; r = r != null ? r.replace("[&]", "") : ""; s = ' for="' + u + '"'; e && (s = ""); o = n("<label " + s + "><\/label>"); i.call(this, o, t.DisplayType.Label, !0, e ? u : "lbl" + u); f ? o.text(r).append("<sup>*<\/sup>") : o.text(r); this.disposeComponent = function () { o = null; self = null } } function rt(r, u, f, e) { var s, o; r = r != null ? r.replace("[&]", "") : ""; s = ' for="' + u + '"'; e && (s = ""); o = n("<span " + s + "><\/span>"); i.call(this, o, t.DisplayType.Label, !0, e ? u : "lbl" + u); f ? o.text(r).append("<sup>*<\/sup>") : o.text(r); this.disposeComponent = function () { o = null; self = null } } function r(r, u, f, e, o, s, h, c, l, a, v, y, p) { function k(n) { d.addClass(n) } function tt() { var i = n("<ul class='vis-apanel-rb-ul'>"); return i.append(n("<li data-action='C'>").text(t.Msg.getMsg("OpenCSV"))), i.append(n("<li data-action='P'>").text(t.Msg.getMsg("OpenPDF"))), i } var w, g; this.actionListner; this.VAF_Job_ID = c; this.VAF_Page_ID = v; this.description = s; this.help = h; this.text = o; this.isLink = l; this.isRightLink = a; this.actionLink = null; this.isCsv = !1; this.isPdf = !1; this.askUserBGProcess = p; this.isBackgroundProcess = y; this.values = null; var d = n("<i title='" + o + "'>"), nt = n("<span>").text(o), it = t.Application.contextUrl + "Areas/VIS/Images/base/", b = null; l ? (b = n("<li>"), b.append(nt).append(d)) : (b = n("<button>", { type: "button", name: r }), d.css("margin-right", "8px"), b.append(d).append(nt)); r.equals("PaymentRule") ? (this.readReference(195), b.css("color", "blue"), k("vis vis-payment")) : r.equals("DocAction") ? (this.readReference(135), b.css("color", "blue"), k("vis vis-cog")) : r.equals("CreateFrom") ? k("vis vis-copy") : r.equals("Record_ID") ? (k("vis vis-find"), b.text(t.Msg.getMsg("ZoomDocument"))) : r.equals("Posted") ? (this.readReference(234), b.css("color", "magenta"), k("fa fa-line-chart")) : l && k("vis vis-action"); i.call(this, b, t.DisplayType.Button, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); w = this; g = null; g = tt(); b.on(t.Events.onClick, function (n) { var u, r, i, f; n.stopPropagation(); u = null; w.isReadOnly || (r = "VIS_81", i = [], i[0] = new t.DB.SqlParam("@VAF_Job_ID", c), u = ft(r, i), r = "VIS_149", i = [], i[0] = new t.DB.SqlParam("@VAF_Job_ID", c), f = ft(r, i), f == "Y" && t.context.getIsUseCrystalReportViewer() ? w.invokeActionPerformed({ source: w }) : u == "Y" ? d.w2overlay(g.clone(!0)) : w.invokeActionPerformed({ source: w })) }); if (g) g.on("click", "LI", function (t) { var i = n(t.target); i.data("action") == "P" ? (w.isPdf = !0, w.isCsv = !1) : i.data("action") == "C" && (w.isCsv = !0, w.isPdf = !1); w.invokeActionPerformed({ source: w }) }); this.setText = function (n) { var t, i; if (n == null) { nt.text(""); return } t = n.indexOf("&"); t != -1 && (i = n.toUpperCase().charAt(t + 1), i != " " && (n = n.substring(0, t) + n.substring(t + 1))); nt.text(n) }; this.disposeComponent = function () { b.off(t.Events.onClick); b = null; w = null; this.VAF_Job_ID = null; this.description = null; this.help = null; this.setText = null } } function w(r, u, f, e, o) { var s = n("<input>", { type: "checkbox", name: r, value: o }), c = n('<label class="vis-ec-col-lblchkbox" />').html(o).prepend(s), h; i.call(this, c, t.DisplayType.YesNo, f, r, u); this.cBox = s; h = this; this.setReadOnly = function (n) { this.isReadOnly = n; s.prop("disabled", n); c.css("opacity", n ? .7 : 1) }; f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); s.on("change", function (n) { var t, i; n.stopPropagation(); t = s.prop("checked"); t !== h.oldValue && (h.oldValue = t, i = { newValue: t, propertyName: h.getName() }, h.fireValueChanged(i), i = null) }); this.disposeComponent = function () { s.off("change"); s = null; h = null; this.cBox = null } } function l(r, u, e, o, s, h, c, l) { function g() { var i, n, r, e, o, s, u, h; if (a.lookup && !b) { if (i = a.lookup.getZoomQuery(), n = a.getValue(), n == null, n == "" && (n = null), n == null || isNaN(n) || (n = parseInt(n)), i == null || n != null) { if (i = new t.Query, r = null, a.lookup != null && a.lookup instanceof t.MLookup && (e = a.lookup.getVAF_Control_Ref_Value_ID(), e != 0)) { o = "VIS_83"; s = []; s[0] = new t.DB.SqlParam("@VAF_Control_Ref_ID", e); try { u = f(o, s); u.read() && (r = u.getString(0)); u.dispose() } catch (c) { this.log.log(t.Logging.Level.SEVERE, o, c) } } r != null && r.length != 0 ? i.addRestriction(r, t.Query.prototype.EQUAL, n) : i.addRestriction(a.getColumnName(), t.Query.prototype.EQUAL, n); i.setRecordCount(1) } h = 0; h = a.mField.getZoomWindow_ID() > 0 ? a.mField.getZoomWindow_ID() : a.lookup.getZoomWindow(i); (n == null || n == -1) && (i = null); t.viewManager.startWindow(h, i) } } var v, a; c || (c = t.DisplayType.Table); v = n("<select>", { name: r }); i.call(this, v, c, e, r, u); this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.loading = !1; s != null && s.getIsValidated() && (this.loading = !0); v[0].selectedIndex = -1; e || !o ? this.setReadOnly(!0) : this.setReadOnly(!1); var d = !1, y = null, k = 0, p = null, w = {}, b = !1; s != null && ((s.getDisplayType() == t.DisplayType.List && t.context.getVAF_Role_ID() == 0 || s.getDisplayType() != t.DisplayType.List) && (d = !0, s instanceof t.MLookup && s.getZoomWindow() == 0 && l < 1 && (b = !0), w[t.Actions.zoom] = b), (this.lookup && (this.lookup.info.keyColumn.toLowerCase() == "VAF_UserContact.VAF_UserContact_id" || this.lookup.info.keyColumn.toLowerCase() == "VAF_UserContact_id") || r === "VAF_UserContact_ID" || r === "SalesRep_ID") && (w[t.Actions.contact] = !0), y = n('<button tabindex="-1" class="input-group-text"><i tabindex="-1" class="fa fa-ellipsis-v" /><\/button>'), w[t.Actions.refresh] = !0, t.MRole.getIsShowPreference() && (w[t.Actions.preference] = !0), p = t.AEnv.getContextPopup(w), k += 1, w = null); this.getBtnCount = function () { return k }; this.getBtn = function () { return y }; this.setVisible = function (n) { this.visible = n; n ? (y && y.show(), v.show()) : (v.hide(), y && y.hide()) }; a = this; v.on("focus", function () { var n; if (a.lookup != null) { if (n = v.val(), a.lookup.getIsValidated() && !a.lookup.getHasInactive()) { if (a.loading) { if (a.lookup.fillCombobox(u, !1, !1, !1), a.lookup.loading) return; a.refreshOptions(a.lookup.data, n); n != null && v[0].selectedIndex < 0 && (a.oldValue = "old", v.trigger("change")); a.loading = !1 } return } a.getIsReadonly() || (a.settingFocus = !0, n = v.val(), a.lookup.fillCombobox(a.getIsMandatory(), !0, !0, !0), a.refreshOptions(a.lookup.data, n), n && v[0].selectedIndex < 0 && (a.oldValue = "old", v.trigger("change")), a.settingFocus = !1) } }); v.on("change", function (n) { var t = v.val(), i; t !== a.oldValue && ((t == -1 || t == "") && (t = null), i = { newValue: t, propertyName: a.getName() }, a.fireValueChanged(i), i = null); n.stopPropagation() }); if (y) y.on(t.Events.onClick, function (n) { y.w2overlay(p.clone(!0)); n.stopPropagation() }); if (p) p.on("click", "LI", function (i) { var r = n(i.target).data("action"), u, e, f, o; if (r == t.Actions.preference) u = new t.ValuePreference(a.mField, a.getValue(), a.getDisplay()), u != null && u.showDialog(), u = null; else if (r == t.Actions.refresh) { if (s == null) return; a.settingFocus = !0; e = v.val(); a.lookup.refresh(); a.lookup.getIsValidated() ? a.lookup.fillCombobox(a.getIsMandatory(), !1, !1, !1) : a.lookup.fillCombobox(a.getIsMandatory(), !0, !1, !1); a.refreshOptions(a.lookup.data, e); a.settingFocus = !1 } else r == t.Actions.contact ? (f = a.getValue(), f && f.toString().length > 0 && (o = new t.ContactInfo(f, a.mField.getWindowNo()), o.show())) : r == t.Actions.zoom && (b || g()) }); this.disposeComponent = function () { v.off("focus"); v.off("change"); y && (y.off(t.Events.onClick), y.remove()); y = null; p && p.remove(); p = null; this.lookup = null; this.lastDisplay = null; this.settingFocus = null; this.inserting = null; this.settingValue = null; v = null; a = null } } function b(r, u, f, e, o) { var l = "date", c = "9999-12-31", s, h; o == t.DisplayType.Time && (l = "time", c = ""); o == t.DisplayType.DateTime && (l = "datetime-local", c += "T24:00:00"); s = n("<input>", { type: l, name: r }); c != "" && s.attr("max", c); i.call(this, s, o, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); h = this; s.on("focusout", function () { var n, t; this.editingGrid || (n = h.getValue(), h.oldValue = n, t = { newValue: n, propertyName: h.getName() }, h.fireValueChanged(t), t = null) }); this.disposeComponent = function () { s.off("change"); h = null; s = null } } function o(r, u, o, s, h, c, l) { function ot() { var i, r, u, o, s, h, e, c; if (a.lookup && !g) { if (i = a.lookup.getZoomQuery(), r = a.getValue(), r == null, r == "" && (r = null), i == null || n.isEmptyObject(i) || r != null) { if (i = new t.Query, u = null, a.lookup != null && a.lookup instanceof t.MLookup && (o = a.lookup.getVAF_Control_Ref_Value_ID(), o != 0)) { s = "VIS_90"; h = []; h[0] = new t.DB.SqlParam("@VAF_Control_Ref_ID", o); try { e = f(s, h); e.read() && (u = e.getString(0)); e.dispose() } catch (l) { this.log.log(t.Logging.Level.SEVERE, s, l) } } u != null && u.length != 0 ? i.addRestriction(u, t.Query.prototype.EQUAL, r) : i.addRestriction(a.getColumnName(), t.Query.prototype.EQUAL, r); i.setRecordCount(1) } c = 0; c = a.mField != null && a.mField.getZoomWindow_ID() > 0 ? a.mField.getZoomWindow_ID() : a.lookup.getZoomWindow(i); t.viewManager.startWindow(c, i) } } var it, rt, ut, et, a; h || (h = t.DisplayType.Search); this.lookup = c; this.isMultiKeyTextBox = h === t.DisplayType.MultiKey; this.value = null; this.custInfoWin = null; it = null; rt = null; this.infoMultipleIds = null; ut = null; this.log = t.Logging.VLogger.getVLogger("VTextBoxButton"); var nt = 1113, tt = 1113, k = ""; h == t.DisplayType.Location || h == t.DisplayType.MultiKey ? k += this.isMultiKeyTextBox ? "fa fa-caret-down" : "vis vis-card" : h == t.DisplayType.Locator ? k += "vis vis-locator" : h == t.DisplayType.Search && (k += r.equals("VAB_BusinessPartner_ID") || r.equals("VAB_BusinessPartner_To_ID") && c.getColumnName().equals("VAB_BusinessPartner.VAB_BusinessPartner_ID") ? "fa fa-handshake-o" : r.equals("VAM_Product_ID") || r.equals("VAM_Product_To_ID") && c.getColumnName().equals("VAM_Product.VAM_Product_ID") ? "vis vis-product" : "fa fa-caret-down"); var d = 0, v = n("<input >", { type: "text", name: r }), w = n('<button  tabindex="-1" class="input-group-text"><i  tabindex="-1" class="' + k + '"><\/i><\/button>'); d += 1; var y = null, b = null, p = {}, g = !1; c == null || this.isMultiKeyTextBox || (c instanceof t.MLookup && c.getZoomWindow() == 0 && l < 1 && (g = !0), p[t.Actions.zoom] = g, y = n('<button  tabindex="-1" class="input-group-text"><i tabindex="-1" Class="fa fa-ellipsis-v" /><\/button>'), et = !1, r === "VAB_BusinessPartner_ID" && (p[t.Actions.add] = !0, p[t.Actions.update] = !0), (this.lookup && (this.lookup.info.keyColumn.toLowerCase() == "VAF_UserContact.VAF_UserContact_id" || this.lookup.info.keyColumn.toLowerCase() == "VAF_UserContact_id") || r === "VAF_UserContact_ID" || r === "SalesRep_ID") && (p[t.Actions.contact] = !0), t.MRole.getIsShowPreference() && (p[t.Actions.preference] = !0), p[t.Actions.refresh] = !0, p[t.Actions.remove] = !0, b = t.AEnv.getContextPopup(p), d += 1, p = null); this.isMultiKeyTextBox && (y = n('<button  tabindex="-1" class="input-group-text"><i class="fa fa-arrow-left" aria-hidden="true"><\/i><\/button>'), d += 1); a = this; i.call(this, v, h, o, r, u); this.setReadOnly = function (n) { this.isReadOnly = n; v.prop("disabled", n ? !0 : !1); n ? w.css("opacity", .7) : w.css("opacity", 1); this.isMultiKeyTextBox && (n ? y.css("opacity", .7) : y.css("opacity", 1)) }; v.on("keydown", function (n) { n.keyCode != 13 && (n.keyCode != 9 || v.val().trim() == "") || n.shiftKey ? (n.keyCode == 46 || n.keyCode == 8) && v.val().trim() != "" && a.setValue(null, !0, !0) : a.actionText() && (n.stopPropagation(), n.preventDefault()) }); this.actionText = function () { var r = v.val().trim(), u, i; if (t.context.setContext(a.lookup.windowNo, "AttrCode", r), r != null && r.indexOf("(01)") >= 0 && (u = r, u.indexOf("(10)") >= 0 && (u = u.substring(0, u.indexOf("(10)"))), u.indexOf("(17)") >= 0 && (u = u.substring(0, u.indexOf("(17)"))), u = u.replace("(01)", ""), r = u), r == null || r.length == 0 || r.equals("%")) return a.openSearchForm(), !0; r = r.toUpper(); var f = -3, o = null, i = null, s = t.Msg.parseTranslation(t.context, a.getDirectAccessSQL(r)); try { if (i = null, n.ajax({ type: "Post", async: !1, url: t.Application.contextUrl + "Form/GetTextButtonQueryResult", data: { sql: t.secureEngine.encrypt(s) }, success: function (n) { i = (new t.DB.DataReader).toJson(n) } }), i.read()) { try { o = parseInt(i.get(0)) } catch (h) { o = i.get(0) } f = 1; i.read() && (f = -1, o = null) } i.close(); i = null } catch (c) { i != null && i.close(); i = null; this.log.log(t.Logging.Level.SEVERE, e); f = -2 } if (f == -3 && !r.endsWith("%")) { r += "%"; s = t.Msg.parseTranslation(t.context, a.getDirectAccessSQL(r)); try { if (i = null, n.ajax({ type: "Get", async: !1, url: t.Application.contextUrl + "Form/GetTextButtonQueryResult", data: { sql: t.secureEngine.encrypt(s) }, success: function (n) { i = (new t.DB.DataReader).toJson(n) } }), i.read()) { try { o = parseInt(i.get(0)) } catch (l) { o = i.get(0) } f = 1; i.read() && (o = null, f = -1) } i.close() } catch (y) { i != null && i.close(); i = null; this.log.log(t.Logging.Level.SEVERE, e); f = -2 } } return f < 0 && o == null ? (ut = {}, a.openSearchForm(), !0) : (r = "", a.setValue(o, !0, !0), !1) }; this.getDirectAccessSQL = function (n) { var i = a.getDirectAccessSQL1(t.context, r, c, n); return it = i[1], rt = i[2], i[0] }; this.getDirectAccessSQL1 = function (i, r, u, e) { var h = "", s = [], c = r.substring(0, r.length - 3), v = r, p, o, k, g, it, rt, b, l, w, y; if (r.equals("VAM_Product_ID") ? (i.setContext(nt, tt, "VAM_Product_ID", "0"), i.setContext(nt, tt, "VAM_PFeature_SetInstance_ID", "0"), i.setContext(nt, tt, "VAM_Locator_ID", "0")) : r.equals("SalesRep_ID") && (c = "VAF_UserContact", v = "VAF_UserContact_ID"), n.ajax({ url: t.Application.contextUrl + "Form/GetAccessSql", dataType: "json", async: !1, data: { columnName: r, text: e }, success: function (n) { h = n } }), h.length > 0) return p = a.getWhereClause(i, r, u), r.equals("VAM_Product_ID") ? p != null && p.length > 0 && (h += " AND " + p.replace(/VAM_Product\./g, "p.") + " AND p.IsActive='Y'") : p != null && p.length > 0 && (h += " AND " + p + " AND IsActive='Y'"), s.push(t.MRole.getDefault().addAccessSQL(h, c, t.MRole.SQL_FULLYQUALIFIED, t.MRole.SQL_RO)), s.push(c), s.push(v), s; if (o = null, u != null && u instanceof t.MLookup && (k = u.getVAF_Control_Ref_Value_ID(), k != 0)) { g = "VIS_84"; try { for (l = [], l[0] = new t.DB.SqlParam("@refid", k), o = f(g, l); o.read();) { r = o.get(0); v = o.get(0); c = o.get(1); break } o.close(); o = null } catch (d) { o != null && (o.close(), o = null); this.log.log(t.Logging.Level.SEVERE, b, d) } it = "VIS_85"; rt = null; v = r; h = "("; try { for (l = [], l[0] = new t.DB.SqlParam("@refid", k), l[1] = new t.DB.SqlParam("@colname", r), o = f(it, l); o.read();)h.length > 1 && (h += " OR "), c = o.get(0), h += "UPPER(" + o.get(1) + ") LIKE " + t.DB.to_string(e); h += ")"; o.close(); o = null } catch (d) { o != null && (o.close(), o = null); this.log.log(t.Logging.Level.SEVERE, b, d) } return h.length == 0 ? (this.log.log(t.Logging.Level.SEVERE, r + " (TableDir) - no standard/identifier columns"), s.push(""), s.push(c), s.push(v), s) : (w = "SELECT " + r + " FROM " + c + " WHERE " + h + " AND IsActive='Y'", y = a.getWhereClause(i, r, u), y != null && y.length > 0 && (w += " AND " + y), s.push(t.MRole.getDefault().addAccessSQL(w, c, t.MRole.SQL_NOTQUALIFIED, t.MRole.SQL_RO)), s.push(c), s.push(v), s) } b = "VIS_86"; v = r; h = "("; try { for (l = [], l[0] = new t.DB.SqlParam("@colname", v), o = f(b, l); o.read();)h.length > 1 && (h += " OR "), c = o.get(0), h += "UPPER(" + o.get(1) + ") LIKE " + t.DB.to_string(e); h += ")"; o.close(); o = null } catch (d) { o != null && (o.close(), o = null); this.log.log(t.Logging.Level.SEVERE, b, d) } return h.length == 0 ? (this.log.log(t.Logging.Level.SEVERE, r + " (TableDir) - no standard/identifier columns"), s.push(""), s.push(c), s.push(v), s) : (w = "SELECT " + r + " FROM " + c + " WHERE " + h + " AND IsActive='Y'", y = a.getWhereClause(i, r, u), y != null && y.length > 0 && (w += " AND " + y), s.push(t.MRole.getDefault().addAccessSQL(w, c, t.MRole.SQL_NOTQUALIFIED, t.MRole.SQL_RO)), s.push(c), s.push(v), s) }; this.getWhereClause = function (n, i, r) { var u = "", f, e; try { if (r == null) return ""; if (r.getZoomQuery() != null && (u = r.getZoomQuery().getWhereClause()), f = r.getValidation(), f == null && (f = ""), u.length == 0 ? u = f : f.length > 0 && (u += " AND " + f), u.indexOf("@") != -1 && (e = t.Env.parseContext(n, r.getWindowNo(), r.getTabNo(), u, !1, !0), e.length != 0)) return e } catch (o) { } return u }; o || !s ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return d }; this.getBtn = function (n) { return n == 0 ? w : n == 1 && y ? y : void 0 }; this.setVisible = function (n) { this.visible = n; n ? (v.css("visibility", "visible"), y && y.show(), w.show()) : (v.css("visibility", "hidden"), y && y.hide(), w.hide()) }; this.openSearchForm = function () { var s, o, l, u, g, w, e; if (!a.isReadOnly && (s = v.val().trim(), typeof s == "object" && (s = ""), !a.isReadOnly) && a.lookup != null) { if (o = 0, l = a.getWhereClause(t.Env.getCtx(), r, a.lookup), a.custInfoWin != null ? n.ajax({ url: t.Application.contextUrl + "InfoWindow/GetInfoWindowID", dataType: "json", async: !1, data: { InfoSearchKey: a.custInfoWin }, success: function (n) { o = n.result } }) : a.getField() != null & o == 0 && (o = a.getField().getVAF_QuickSearchWindow_ID()), u = null, o != 0) u = new t.InfoWindow(o, s, a.lookup.windowNo, l, a.isMultiKeyTextBox); else { var h = h, y = r, c = null, i = null, b = 0, k = 0, p = 0, d = a.lookup.getVAF_Control_Ref_Value_ID(); if (d > 0) { c = "VIS_87"; g = null; try { for (e = [], e[0] = new t.DB.SqlParam("@VAF_Control_Ref_ID", d), i = f(c, e); i.read();)y = i.getString(0), g = i.getString(1), h = i.getString(2); i.close(); i = null } catch (nt) { i != null && (i.close(), i = null) } } else h = String(r).substr(0, r.length - 3), y = r; if (c = "VIS_88", e = [], e[0] = new t.DB.SqlParam("@VAF_Tab_ID", t.context.getContext(a.lookup.windowNo, "0|VAF_Tab_ID", !0)), p = ft(c, e), y.equals("VAM_Product_ID") && p) b = window.DTD001 && p == 170 ? t.context.getContextAsInt(a.lookup.windowNo, "DTD001_MWarehouseSource_ID") : t.context.getContextAsInt(a.lookup.windowNo, "VAM_Warehouse_ID"), k = t.context.getContextAsInt(a.lookup.windowNo, "VAM_PriceList_ID"), w = !1, a.lookup.windowNo > 0 && (w = t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "VAB_OrderLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "VAB_InvoiceLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "VAM_Inv_InOutLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "VAM_PackagingLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "VAM_InvTrf_Line_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "VAM_InventoryLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "VAM_ProductPrice_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "VAB_ProjectLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "VAM_RequisitionLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 0, "KeyColumnName") == "VAM_PriceList_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "SAP001_StockTransferLine_ID"), u = new t.infoProduct(!0, a.lookup.windowNo, b, k, s, h, y, w, l); else { for (c = "VIS_89", e = [], e[0] = new t.DB.SqlParam("@tableName", h), i = f(c, e); i.read();) { o = i.getString(0); break } i.close(); i = null; u = o > 0 ? new t.InfoWindow(o, s, a.lookup.windowNo, l, a.isMultiKeyTextBox) : new t.infoGeneral(!0, a.lookup.windowNo, s, h, y, a.isMultiKeyTextBox, l) } } u.onClose = function () { var n = u.getSelectedValues(), t, r; if (n && n.length == 0) { v.closest("td").hasClass("vis-gc-vpanel-table-td3") ? window.setTimeout(function () { v.closest("tr").nextAll().children("input,select,textarea,button").focus() }, 200) : v.closest("td").hasClass("vis-gc-vpanel-table-td1") ? (t = v.closest("td").siblings(".vis-gc-vpanel-table-td3"), t && t.length > 0 && (t = t.find("input,select,textarea,button"), t && t.length > 0 ? window.setTimeout(function () { t.focus() }, 200) : window.setTimeout(function () { v.closest("tr").nextAll().children("input,select,textarea,button").focus() }, 200))) : window.setTimeout(function () { v.closest("td").siblings(".vis-gc-vpanel-table-td3").find("input,select,textarea,button").focus() }, 200); v.closest("td").nextAll().children("input,select,textarea,button").focus(); u.constructor.name == "infoProduct" && u.getRefreshStatus() && a.fireRefreshUI(); return } if (a.isMultiKeyTextBox) { for (var f = "", i = 0, e = 0, i = 0, e = n.length; i < e; i++) { if (f.length == 0) { f += n[i]; continue } f += "," + n[i] } a.setValue(f, !1, !0) } else r = null, u.getRefreshStatus && u.getRefreshStatus() ? a.fireRefreshUI() : (n != null && n.length == 1 ? r = n[0] : (InfoMultipleIds = null, n.length > 1 && (r = n[0])), r != null && a.setValue(r, !1, !0)); u = null }; u.show() } }; w.on(t.Events.onClick, a.openSearchForm); if (y) y.on(t.Events.onClick, function (n) { if (a.isMultiKeyTextBox) { if (a.isReadOnly) return; var t = a.getValue(); t && t.toString().length > 0 && a.setValue(null, !1, !0) } else y.w2overlay(b.clone(!0)); n.stopPropagation() }); if (b) b.on("click", "LI", function (i) { var u = n(i.target).data("action"), f, r, e; if (u == t.Actions.zoom) { if (g) return; ot() } else if (u == t.Actions.preference) f = new t.ValuePreference(a.mField, a.getValue(), a.getDisplay()), f != null && f.showDialog(), f = null; else if (u == t.Actions.refresh) { if (!a.lookup || a.isReadOnly) return; a.lookup.refresh() } else if (u == t.Actions.add) r = a.getValue(), t.AddUpdateBPartner(a.mField.getWindowNo(), 0, t.Msg.getMsg("Customer"), null, 0, 0); else if (u == t.Actions.update) r = a.getValue(), r && r.toString().length > 0 && t.AddUpdateBPartner(a.mField.getWindowNo(), r, t.Msg.getMsg("Customer"), null, 0, 0); else if (u == t.Actions.contact) r = a.getValue(), r && r.toString().length > 0 && (e = new t.ContactInfo(r, a.mField.getWindowNo()), e.show()); else if (u == t.Actions.remove) { if (a.isReadOnly) return; a.setValue(null, !1, !0) } }); this.disposeComponent = function () { w.off(t.Events.onClick); y && y.off(t.Events.onClick); b && b.off(t.Events.onTouchStartOrClick); b = null; a = null; v = null; w = null; y = null; this.getBtn = null; this.setVisible = null } } function tt(r, u, f, e, o, s, h) { var l = 6, v = 79, c, a; if (h != t.DisplayType.Memo) h == t.DisplayType.TextLong ? (l = 6, s = 1e5) : (l = s < 300 ? 2 : s < 2e3 ? 4 : 6, v = s < 300 ? 79 : s < 2e3 ? 129 : 129); else try { l = s < 300 ? 2 : s < 2e3 ? 4 : s / 500; v = s < 300 ? 79 : s < 2e3 ? 129 : 129 } catch (y) { l = s < 300 ? 2 : s < 2e3 ? 4 : 6; v = s < 300 ? 79 : s < 2e3 ? 129 : 129 } c = n("<textarea>", { name: r, maxlength: s, rows: l, style: "min-height:" + v + "px" }); i.call(this, c, h, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); a = this; c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.val(); t !== a.oldValue && (i = { newValue: t, propertyName: a.getName() }, a.fireValueChanged(i), i = null) }); this.disposeComponent = function () { c.off("change"); c = null; a = null } } function s(r, u, f, e, o, s, h) { var v = h, a = s, l = n("<input>", { type: "number", step: "any", name: r, maxlength: a }), c; i.call(this, l, v, f, r, u); this.format = t.DisplayType.GetNumberFormat(v); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); c = this; this.dotFormatter = t.Env.isDecimalPoint(); l.on("keydown", function (n) { if (n.keyCode == 189 || n.keyCode == 109 || n.keyCode == 173) { if (n.keyCode == 189 && this.value.length == 0) return !0; var t = c.format.GetConvertedNumber(this.value, c.dotFormatter); return this.value = Number(t) * -1, setTimeout(function () { l.trigger("change") }, 100), !1 } if (n.keyCode >= 37 && n.keyCode <= 40 || n.keyCode == 8 || n.keyCode == 9 || n.keyCode == 16 || n.keyCode == 17 || n.keyCode == 35 || n.keyCode == 36 || n.keyCode == 46) return !0; if (n.keyCode >= 48 && n.keyCode <= 57 && n.shiftKey == !1 || n.keyCode >= 96 && n.keyCode <= 105 && n.shiftKey == !1) return this.value.length >= a ? !1 : !0; if (n.keyCode == 189 || n.keyCode == 109 || n.keyCode == 173) return this.value = this.value * -1, !1; if (c.dotFormatter) { if (n.keyCode == 188) return !1 } else if (n.keyCode == 190 || n.keyCode == 110) return !1; if (n.keyCode == 190 || n.keyCode == 110 || n.keyCode == 188) return (this.value.indexOf(".") > -1 ? this.value = this.value.replace(".", "") : this.value.indexOf(",") > -1 && (this.value = this.value.replace(",", "")), this.value.length >= a) ? !1 : !0; if (n.ctrlKey && n.keyCode == 65) { if (this.value.length > 0) return n.stopPropagation(), l.select(), !0 } else if (n.ctrlKey && n.keyCode == 67) { if (this.value.length > 0) return n.stopPropagation(), !0 } else { if (n.ctrlKey && n.keyCode == 86) return setTimeout(function () { n.stopPropagation(); var t = n.target.value; n.target.value = t ? c.format.GetConvertedString(t, c.dotFormatter) : "" }, 10), !0; if (n.ctrlKey && n.keyCode == 88) return n.stopPropagation(), !0 } return !1 }); l.on("focus", function (n) { n.stopPropagation(); var i = n.target.value; l.attr("type", "text"); n.target.value = i ? c.format.GetConvertedString(i, c.dotFormatter) : ""; t.DisplayType.Amount == v && l.select() }); l.on("change", function (n) { var t, i; n.stopPropagation(); t = c.getValue(); this.value = t; t !== c.oldValue && (i = { newValue: t, propertyName: c.getName() }, c.fireValueChanged(i), i = null) }); l.on("blur", function (n) { n.stopPropagation(); l.attr("type", "text"); var t = c.format.GetConvertedString(l.val(), c.dotFormatter), i = c.format.GetFormatAmount(t, "formatOnly", c.dotFormatter); l.val(i) }); this.disposeComponent = function () { l.off("keydown"); l.off("change"); l = null; c = null; this.format.dispose(); this.format = null; a = null } } function k(r, u, f, e, o, s) { var a = t.DisplayType.Integer, l = s, c = n("<input>", { type: "text", name: r, maxlength: l }), h; i.call(this, c, a, f, r, u); this.format = t.DisplayType.GetNumberFormat(a); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); h = this; c.on("keydown", function (n) { if (n.keyCode == 189 || n.keyCode == 109 || n.keyCode == 173) return n.keyCode == 189 && this.value.length == 0 ? !0 : (this.value = Number(this.value * -1), setTimeout(function () { c.trigger("change") }, 100), !1); if (n.keyCode >= 37 && n.keyCode <= 40 || n.keyCode == 8 || n.keyCode == 9 || n.keyCode == 16 || n.keyCode == 17 || n.keyCode == 35 || n.keyCode == 36 || n.keyCode == 46) return !0; if (this.value < 0) { if (this.value.length > t.DisplayType.INTEGER_DIGITS && n.keyCode != 8 && n.keyCode != 9 && n.keyCode != 46) return !1 } else if (this.value.length >= t.DisplayType.INTEGER_DIGITS && n.keyCode != 8 && n.keyCode != 9 && n.keyCode != 46) return !1; return n.keyCode >= 48 && n.keyCode <= 57 && n.shiftKey == !1 || n.keyCode >= 96 && n.keyCode <= 105 && n.shiftKey == !1 ? this.value.length >= l ? !1 : !0 : !1 }); c.on("change", function (n) { var t, i, r; n.stopPropagation(); t = h.getValue(); t = Globalize.parseInt(t.toString()); i = Number(h.format.GetFormatedValue(t)); t != i && (h.mField.setValue(null), t = i); t !== h.oldValue && (r = { newValue: t, propertyName: h.getName() }, h.fireValueChanged(r), r = null) }); this.disposeComponent = function () { c.off("keydown"); c.off("change"); c = null; h = null; this.format.dispose(); this.format = null; l = null } } function d(r, u, f, e, o, s) { o || (o = t.DisplayType.Location); this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.value = null; var a = n("<input readonly>", { type: "text", name: r }), l = n('<button class="input-group-text"><i class="vis vis-location" aria-hidden="true"><\/i><\/button>'), c = n('<button class="input-group-text"><i class="vis vis-card" aria-hidden="true"><\/i><\/button>'), v = 2, h = this; i.call(this, a, o, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtn = function (n) { return n == 0 ? l : n == 1 ? c : void 0 }; this.getBtnCount = function () { return v }; this.setVisible = function (n) { this.visible = n; n ? (a.show(), l.show(), c.show()) : (a.hide(), l.hide(), c.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; a.prop("disabled", n ? !0 : !1); n ? c.css("opacity", .7) : c.css("opacity", 1); this.setBackground(!1) }; l.on(t.Events.onClick, function (n) { var t = "http://local.google.com/maps?q=" + h.getDisplay(); window.open(t); n.stopPropagation() }); c.on(t.Events.onClick, function (n) { var r, i; (n.stopPropagation(), h.isReadOnly) || (r = null, h.mField && h.mField.vo && (r = h.mField.vo.IsMaintainVersions), i = new t.LocationForm(h.value, r), i.load(), i.showDialog(), i.onClose = function (n, t) { if (t) { h.oldValue = 0; h.lookup.refreshLocation(n); h.setValue(n); var i = { newValue: n, propertyName: h.getColumnName() }; h.fireValueChanged(i); i = null } }, i = null) }); this.disposeComponent = function () { l.off(t.Events.onClick); c.off(t.Events.onClick); h = null; a = null; l = null; c = null; this.setVisible = null } } function h(r, u, e, o, s, h) { var y; this.mandatory = u; this.onlyWarehouseId = 0; this.onlyProductId = 0; this.onlyOutgoing = null; this.windowNum = h.getWindowNo(); this.columnName = r; this.lookup = h; y = "vis vis-locator"; this.value = null; s || (s = t.DisplayType.Locator); var a = n("<input readonly>", { type: "text", name: r }), l = n('<button class="input-group-text"><i class="' + y + '" aria-hidden="true"><\/i><\/button>'), v = n('<button class="input-group-text"><i class="vis vis-find" aria-hidden="true"><\/i><\/button>'), p = 2, c = this; i.call(this, a, s, e, r, u); this.getBtnCount = function () { return p }; this.getBtn = function (n) { return n == 0 ? l : n == 1 ? v : void 0 }; this.setVisible = function (n) { this.visible = n; n ? (a.show(), l.show(), v.show()) : (l.hide(), v.hide(), a.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; a.prop("disabled", n ? !0 : !1); n ? l.css("opacity", .7) : l.css("opacity", 1); this.setBackground(!1) }; l.on(t.Events.onClick, function (n) { if (n.stopPropagation(), !c.isReadOnly) { var t = c.getOnlyWarehouseID(), i = c.getOnlyProductID(); c.showLocatorForm(t, i) } }); v.on(t.Events.onClick, function (n) { var i, r, u, o, s, h, e, l; if (n.stopPropagation(), c.lookup) { if (i = c.lookup.getZoomQuery(), r = c.getValue(), r == null, r == "" && (r = null), i == null || r != null) { if (i = new t.Query, u = null, c.lookup != null && c.lookup instanceof t.MLookup && (o = c.lookup.getVAF_Control_Ref_Value_ID(), o != 0)) { s = "VIS_91"; h = []; h[0] = new t.DB.SqlParam("@VAF_Control_Ref_ID", o); try { e = f(s, h); e.read() && (u = e.getString(0)); e.dispose() } catch (n) { this.log.log(t.Logging.Level.SEVERE, s, n) } } u != null && u.length != 0 ? i.addRestriction(u, t.Query.prototype.EQUAL, r) : i.addRestriction(c.getColumnName(), t.Query.prototype.EQUAL, r); i.setRecordCount(1) } l = 0; l = c.mField.getZoomWindow_ID() > 0 ? c.mField.getZoomWindow_ID() : c.lookup.getZoomWindow(i); t.viewManager.startWindow(l, i) } }); this.disposeComponent = function () { l.off(t.Events.onClick); v.off(t.Events.onClick); c = null; a = null; l = null; this.getBtn = null; this.setVisible = null } } function u(r, u, f, e, o, s, h, c, l, a, v) { function tt(n) { var i = t.Env.getCtx().getContextAsInt(y.windowNo, "VAB_GenFeatureSetInstance_ID"), r; y.isFromActivityForm && (i = y.VAB_GenFeatureSetInstance_ID); i == 0; r = new t.GenralAttributeForm(i, n, y.windowNo, y.isSearch, y.getCanSaveRecord(), y.isFromDMS); r.showDialog(); r.onClose = function (n, i, r) { t.Env.getCtx().setContext(h, "VAB_GenFeatureSetInstance_ID", n); b(n, i); r != null && (y.setInstanceIDs = r); y.getControl().val(i) } } function b(n) { if (y.log.finest("Changed VAM_PFeature_SetInstance_ID=" + n), y.oldValue != n) { n == 0 && y.setValue(null); y.setValue(n); var t = { newValue: n, propertyName: y.colName }; y.fireValueChanged(t); t = null } } function it(i) { var u = i == null ? 0 : i, r = t.Env.getCtx().getContextAsInt(h, "VAM_Product_ID"), e = t.Env.getCtx().getContextAsInt(h, "VAM_ProductBOM_ID"), c = t.Env.getCtx().getContextAsInt(h, "VAM_Locator_ID"), f; y.log.config("VAM_Product_ID=" + r + "/" + e + ",VAM_PFeature_SetInstance_ID=" + u + ", VAF_Column_ID=" + y.VAF_Column_ID); var o = y.VAF_Column_ID == 8418, s = !0, l = !1; e != 0 && (r = e); r != 0 && n.ajax({ url: t.Application.contextUrl + "PAttributes/ExcludeEntry", dataType: "json", async: !1, data: { productId: r, adColumn: y.VAF_Column_ID, windowNo: h }, success: function (n) { s = n.result } }); !o && (r == 0 || s) ? (l = !0, u = 0, b(u), t.ADialog.info("VIS_PAttributeNotFound", null, null, null)) : (f = new t.PAttributesForm(u, r, c, y.VAB_BusinessPartner_ID, o, y.VAF_Column_ID, h), f.hasAttribute && f.showDialog(), f.onClose = function (n, t, i) { this.VAM_Locator_ID = i; b(n, t) }) } var k, g, d; this.NO_INSTANCE = 0; this.VAF_Column_ID = 0; k = "VAM_PFeature_SetInstance_ID"; g = !1; this.VAB_GenFeatureSet_ID = 0; this.VAB_GenFeatureSetInstance_ID = 0; this.VAM_Locator_ID = 0; k = r; this.value = null; this.windowNo = h; this.lookup = s; this.VAB_BusinessPartner_ID = t.Env.getCtx().getContextAsInt(this.windowNo, "VAB_BusinessPartner_ID"); this.log = t.Logging.VLogger.getVLogger("VPAttribute"); d = "vis vis-pattribute"; o || (o = t.DisplayType.PAttribute); this.isFromActivityForm = c; this.isSearch = l; this.isFromDMS = a; this.isPAttribute = v; this.canSaveRecord = !0; var w = n("<input >", { type: "text", name: r }), p = n('<button class="input-group-text"><i class="' + d + '"><\/i><\/button>'), nt = 1, y = this; this.setInstanceIDs = null; i.call(this, w, o, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return nt }; this.getBtn = function (n) { if (n == 0) return p }; this.setVisible = function (n) { this.visible = n; n ? (w.show(), p.show()) : (p.hide(), w.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; w.prop("disabled", n ? !0 : !1); n ? p.css("opacity", .7) : p.css("opacity", 1); this.setBackground(!1) }; p.on(t.Events.onClick, function (n) { var r, i; if (n.stopPropagation(), !y.isReadOnly) { if (r = y.getValue(), !y.isPAttribute) { if (i = 0, i = t.Env.getCtx().getContextAsInt(y.windowNo, "VAB_GenFeatureSet_ID"), i == 0 && (i = y.VAB_GenFeatureSet_ID, i == 0)) { t.ADialog.info("NoAttributeSet", null, null, null); return } tt(i, r); return } it(r) } }); this.SetVAB_GenFeatureSet_ID = function (n) { this.VAB_GenFeatureSet_ID = n }; this.disposeComponent = function () { p.off(t.Events.onClick); y = null; w = null; p = null; this.getBtn = null; this.setVisible = null; this.value = null; this.lookup = null } } function g(r, u, f, e, o, s, h, c) { var y, p; this.value = null; this.windowNo = h; this.lookup = s; this.title = c; y = r; p = "vis vis-account"; o || (o = t.DisplayType.PAttribute); var v = n("<input readonly>", { type: "text", name: r }), a = n('<button class="input-group-text"><i class="' + p + '" ><\/i><\/button>'), w = 1, l = this; i.call(this, v, o, f, r, u); this.getBtnCount = function () { return w }; this.getBtn = function (n) { if (n == 0) return a }; this.setVisible = function (n) { this.visible = n; n ? (v.show(), a.show()) : (v.hide(), a.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; v.prop("disabled", n ? !0 : !1); n ? a.css("opacity", .7) : a.css("opacity", 1); this.setBackground(!1) }; a.on(t.Events.onClick, function (n) { var u, r, i; (n.stopPropagation(), l.isReadOnly) || (u = t.Env.getCtx().getContextAsInt(l.windowNo, "VAB_AccountBook_ID"), r = 0, l != null && l.getField() != null && l.getField().vo != null && l.getField().vo.VAF_TableView_ID != null && (r = l.getField().vo.VAF_TableView_ID), i = new t.AccountForm(l.title, l.lookup, u, r), i.load(), i.showDialog(), i.onClose = function (n) { if (l.oldValue != n) { l.setValue(n); var t = { newValue: n, propertyName: y }; l.fireValueChanged(t); t = null } }, i = null) }); this.disposeComponent = function () { a.off(t.Events.onClick); l = null; v = null; a = null; this.getBtn = null; this.setVisible = null; this.value = null; this.lookup = null; this.value = null; this.windowNo = null; this.title = null } } function c(r, u, f, e) { var h; this.values = null; this.log = t.Logging.VLogger.getVLogger("VImage"); var p = e, l = r, o = n("<img >"), a = n("<i>"), s = n("<span>").text("-"), v = n('<span class="vis vis-edit vis-img-ctrl-icon">'), c = null, y = "Thumb500x375"; c = n("<button >", { type: "button", name: l, "class": "vis-ev-col-img-ctrl", tabIndex: "-1" }); s.css("color", "blue"); c.append(v).append(o).append(a).append(s); i.call(this, c, t.DisplayType.Button, f, l, u); f ? this.setReadOnly(!0) : this.setReadOnly(!1); h = this; v.on(t.Events.onClick, function (n) { if (n.stopPropagation(), !h.isReadOnly) { var i = new t.VImageForm(h.getValue(), s.text().trim().length); i.showDialog(); i.onClose = function (n, t) { if (t) if (h.oldValue = -1, h.oldValue != n) { n = n == "null" ? null : n; h.setValue(n); var i = { newValue: n, propertyName: l }; h.fireValueChanged(i, !0); i = null } else h.refreshImage(n) }; i = null } }); this.setText = function (n) { var t, i; if (n == null) { s.text(""); o.image.src = ""; return } t = n.indexOf("&"); t != -1 && (i = n.toUpperCase().charAt(t + 1), i != " " && (n = n.substring(0, t) + n.substring(t + 1))); s.text(n) }; this.setDimension = function (n, t) { y = "Thumb" + t + "x" + n }; this.setIcon = function (n, i) { i ? (o.attr("src", t.Application.contextUrl + "Images/" + y + "/" + i + "? timestamp =" + (new Date).getTime()), o.show(), a.hide(), s.text(""), this.ctrl.addClass("vis-input-wrap-button-image-add")) : n != null ? (o.attr("src", "data:image/jpg;base64," + n + "? timestamp =" + (new Date).getTime()), o.show(), a.hide(), s.text(""), this.ctrl.addClass("vis-input-wrap-button-image-add")) : (o.attr("src", "data:image/jpg;base64," + n), o.hide(), s.text("-"), this.ctrl.removeClass("vis-input-wrap-button-image-add")) }; this.disposeComponent = function () { c.off(t.Events.onClick); c = null; this.log = null; p = null; o = null; s = null; this.setText = null; this.setIcon = null; h = null } } function a(r, u, f, e, o) { function b() { var i = n("<ul class='vis-apanel-rb-ul'>"); return i.append(n("<a id='link' style='border-bottom: 1px solid #CCDADE;color: #535353;font-size: 12px;display: block;margin-bottom: 8px;'  href='javascript:void(0)'>" + t.Msg.getMsg("SaveTolocalFile") + "<\/a>")), i.append(n("<li data-action='" + y + "'>").text(t.Msg.getMsg("Open/LoadIntoDatabase"))), i } var l, s; this.values = null; var a = n("<span>").text(""), w = o, v = r, h = null, c = null, p = "SaveTolocalFile", y = "LoadIntoDatabase"; if (this.data = null, l = n("<input type='file' class='file' name='file'/>"), h = n("<button>", { type: "button", name: v }), h.append(a), i.call(this, h, t.DisplayType.Button, f, v, u), f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1), s = this, c = b(), c) { c.on("click", "LI", function (t) { var i = n(t.target).data("action"); i == p || i == y && l.trigger("click") }); c.on("click", "a", function () { if (s.getValue() != null) { var t = (new Date).toISOString().slice(0, 19).replace(/-/g, ""), i = "data:;base64," + s.getValue(); n(this).attr("href", i).attr("download", "file-" + t + ".log") } }) } l.change(function () { var t = l[0].files[0], n = new FileReader, i = n.readAsDataURL(t); n.onloadend = function () { var t = n.result.split(",")[1], i; s.oldValue != t && (s.setValue(t), i = { newValue: t, propertyName: v }, s.fireValueChanged(i, !0), i = null) }; return }); h.on(t.Events.onClick, function (n) { s.isReadOnly || h.w2overlay(c.clone(!0)); n.stopPropagation() }); this.setText = function (n) { var t, i; if (n == null) { a.text(""); return } t = n.indexOf("&"); t != -1 && (i = n.toUpperCase().charAt(t + 1), i != " " && (n = n.substring(0, t) + n.substring(t + 1))); a.text(n) }; this.disposeComponent = function () { h.off(t.Events.onClick); h = null; this.setText = null; this.values = null; a = null; w = null; v = null; c = null; p = null; y = null; this.data = null; l = null; s = null } } function it(r, u, f, e, o, s) { var h; this.value = null; var v = "vis vis-url", a = 0, c = n("<input>", { type: "text", name: r, maxlength: s }), l = n('<button class="input-group-text"><i class="' + v + '" ><\/i><\/button>'); a += 1; h = this; i.call(this, c, t.DisplayType.URL, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return a }; this.getBtn = function (n) { if (n == 0) return l }; this.setVisible = function (n) { this.visible = n; n ? (c.show(), l.show()) : (c.hide(), l.hide()) }; l.on(t.Events.onClick, function (n) { if ((n.stopPropagation(), h.value != null) && !h.isReadOnly) { var i = h.value.trim(); if (i.length > 0) { i.contains("http://") || i.contains("https://") || (i = "http://" + i); window.open(i); return } t.ADialog.warn("URLnotValid", !0, null) } }); c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.val(); t !== h.oldValue && (i = { newValue: t, propertyName: h.getName() }, h.fireValueChanged(i), i = null) }); this.disposeComponent = function () { l.off(t.Events.onClick); c.off("change"); h = null; c = null; l = null; this.getBtn = null; this.setVisible = null; this.value = null; v = null; a = null; this.getBtnCount = null; this.getBtn = null } } function v(r, u, f, e, o, s) { var k = !1, w, y, s, b, p, d, l, v, h; s == s.FileName && (k = !0); DialogType = { OpenFile: 0, SaveFile: 1, Custom: 2 }; SelectionType = { FilesOnly: 0, DirectoryOnly: 1 }; w = SelectionType.DirectoryOnly; y = DialogType.Custom; this.log = t.Logging.VLogger.getVLogger("VFile"); s = t.DisplayType.FileName; b = "fa fa-folder-open-o"; k && (w = SelectionType.FilesOnly, b = "fa fa-file-text-o"); p = r.toUpperCase(); p.indexOf("open") != -1 || p.indexOf("load") != -1 ? y = DialogType.OpenFile : p.indexOf("save") != -1 && (y = DialogType.SaveFile); d = o; l = r; this.value = null; var g = 0, c = n("<input>", { type: "text", name: l }), a = n('<button class="input-group-text"><i class="' + b + '" /><\/button>'); g += 1; v = n("<input type='file' class='file' name='file'/>"); c.append(a); i.call(this, c, s, f, l, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return g }; this.getBtn = function (n) { if (n == 0) return a }; this.setVisible = function (n) { this.visible = n; n ? (c.show(), a.show()) : (c.hide(), a.hide()) }; h = this; a.on(t.Events.onClick, function (i) { var u, f, r; h.isReadOnly || (i.stopPropagation(), w == SelectionType.DirectoryOnly ? (r = new t.VisImportFiles(!0), r.onClose = function (n) { h.setValue(n) }, r.show()) : y == DialogType.SaveFile ? h.getValue() != null && (u = (new Date).toISOString().slice(0, 19).replace(/-/g, ""), f = "data:;base64," + h.getValue(), n(this).attr("href", f).attr("download", "file-" + u + ".log")) : (r = new t.VisImportFiles(!1), r.onClose = function () { h.setValue(name) }, r.show())) }); v.on("change", function (t) { var i, r; t.stopPropagation(); i = n(v).val().split("\\").pop(); h.oldValue != i && (h.setValue(i), r = { newValue: i, propertyName: l }, h.fireValueChanged(r), r = null) }); c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.val(); this.value = t; t !== h.oldValue && (i = { newValue: t, propertyName: h.getName() }, h.fireValueChanged(i), i = null, h.setValue(t)) }); this.disposeComponent = function () { c.off(t.Events.onClick); c.off("change"); v.off("change"); c = null; d = null; l = null; v = null; h = null } } function nt(r, u, f, e, o, s, h) { o || (o = t.DisplayType.AmtDimension); this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.value = null; this.defaultValue = ""; var l = n("<input readonly>", { type: "text", name: r }), a = n('<button class="input-group-text"><i class="vis vis-amtdimension" /><\/button>'), v = 1, c = this; i.call(this, l, o, f, r, u); this.format = t.DisplayType.GetNumberFormat(t.DisplayType.Amount); this.dotFormatter = t.Env.isDecimalPoint(); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtn = function (n) { if (n == 0) return a }; this.getBtnCount = function () { return v }; this.hideButton = function (n) { n ? a.show() : a.hide() }; this.setVisible = function (n) { this.visible = n; n ? (l.show(), a.show()) : (l.hide(), a.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; l.css("background-color", "#f8f8f8"); this.setBackground(n) }; this.setReadOnlyTextbox = function (n) { n ? (l.attr("readonly", "readonly"), l.attr("disabled", "disabled")) : (l.removeAttr("readonly"), l.removeAttr("disabled")) }; this.getText = function () { return l.val() }; this.setDefaultValue = function (n) { this.defaultValue = n }; a.on(t.Events.onClick, function (n) { n.stopPropagation(); c.actionText() }); this.actionText = function () { var i, r, n; c.value || (c.value = 0); i = t.Env.getCtx().getContextAsInt(h, "VAF_Org_ID", !1); this.defaultValue && (c.defaultValue = c.defaultValue.replace(/@/g, "").trim().replace(".value", ""), r = t.Env.getCtx().getWindowContext(h, c.defaultValue, !1)); c.oldValue = c.value; n = new t.AmountDivision(c.value, i, r, c.isReadOnly); n.onClosing = function (n) { if (n > 0) { c.oldValue = 0; c.lookup.refreshAmountDivision(n); c.setValue(n); var t = { newValue: n, propertyName: c.getColumnName() }; c.fireValueChanged(t); t = null } }; n.show(); n = null }; this.disposeComponent = function () { a.off(t.Events.onClick); c = null; l = null; a = null; this.setVisible = null } } function y(r, u, f, e, o, s, h) { function k() { var i, n, r; c.lookup && (i = c.lookup.getZoomQuery(), n = c.getValue(), n == null, n == "" && (n = null), n == null || isNaN(n) || (n = parseInt(n)), i = new t.Query, i.addRestriction("VAM_ProductContainer_ID", t.Query.prototype.EQUAL, n), i.setRecordCount(1), r = 0, r = c.mField.getZoomWindow_ID() > 0 ? c.mField.getZoomWindow_ID() : c.lookup.getZoomWindow(i), t.viewManager.startWindow(r, i)) } var y, w, c; o || (o = t.DisplayType.ProductContainer); y = {}; this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.value = null; this.defaultValue = ""; w = !1; y[t.Actions.zoom] = w; t.MRole.getIsShowPreference() && (y[t.Actions.preference] = !0); y[t.Actions.remove] = !0; var p = t.AEnv.getContextPopup(y), v = n("<input>", { type: "text", name: r }), a = n('<button class="input-group-text"><i class="vis vis-pcontainer" /><\/button>'), l = n('<button  tabindex="-1" class="input-group-text"><i tabindex="-1" Class="fa fa-ellipsis-v" /><\/button>'), b = 1; if (b += 1, c = this, i.call(this, v, o, f, r, u), f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1), this.getBtn = function (n) { return n == 0 ? a : n == 1 && l ? l : void 0 }, this.getBtnCount = function () { return b }, this.hideButton = function (n) { n ? (a.show(), this.getBtnCount() > 1 && l && l.show()) : (a.hide(), this.getBtnCount() > 1 && l && l.hide()) }, this.setVisible = function (n) { this.visible = n; n ? (v.show(), a.show(), this.getBtnCount() > 1 && l && l.show()) : (v.hide(), a.hide(), this.getBtnCount() > 1 && l && l.hide()) }, this.setReadOnly = function (n) { this.isReadOnly = n; v.prop("disabled", n ? !0 : !1); n ? a.css("opacity", .7) : a.css("opacity", 1); this.setBackground(!1) }, l) l.on(t.Events.onClick, function (n) { l.w2overlay(p.clone(!0)); n.stopPropagation() }); if (p) p.on("click", "LI", function (i) { var u = n(i.target).data("action"), r; if (u == t.Actions.preference) r = new t.ValuePreference(c.mField, c.getValue(), c.getDisplay()), r != null && r.showDialog(), r = null; else if (u == t.Actions.zoom) k(); else if (u == t.Actions.remove) { if (c.isReadOnly) return; c.setValue(null, !1, !0) } }); this.getText = function () { return v.val() }; this.setDefaultValue = function (n) { this.defaultValue = n }; a.on(t.Events.onClick, function (n) { (n.stopPropagation(), c.isReadOnly) || c.actionText(!0) }); this.actionText = function (i) { c.value || (c.value = 0); var r = v.val().trim(), u = t.Env.parseContext(t.Env.getCtx(), h, c.lookup.getTabNo(), c.lookup.info.validationCode, !1, !0); !r || i ? c.openForm(0, 0, r, u) : n.ajax({ url: ut + "productContainer/GetProductContainer", data: { text: r, validation: u }, success: function (n) { n = JSON.parse(n); n == "null" || n == null || n == "" || n == 0 ? c.openForm(0, 0, r, u) : c.setVal(n) }, error: function () { } }) }; v.on("keydown", function (n) { (n.keyCode == 13 || n.keyCode == 9) && c.actionText(!1) }); this.setVal = function (n) { c.oldValue = 0; c.setValue(n); var t = { newValue: n, propertyName: c.getColumnName() }; c.fireValueChanged(t, !0); t = null }; this.openForm = function (n, i, r, u) { c.oldValue = c.value; var f = new t.productContainerTree(n, i, r, u); f != null && (f.showDialog(), f.onClosing = function (n) { c.setVal(n) }); f = null }; this.disposeComponent = function () { a.off(t.Events.onClick); c = null; v = null; a = null; this.setVisible = null } } var ut = t.Application.contextUrl, st = ut + "JsonData/JDataSetWithCode", ht = ut + "JsonData/ExecuteNonQuer", f = function (n, i, r) { var e = r ? !0 : !1, f = { sql: n, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, et(f, e, function (n) { u = (new t.DB.DataReader).toJson(n); r && r(u) }), u }, ct = function (n, i, r) { var e = r ? !0 : !1, f = { sql: n, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, et(f, e, function (n) { u = (new t.DB.DataSet).toJson(n); r && r(u) }), u }, ft = function (n, i, r) { var f = r ? !0 : !1, e = { sql: n, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, et(e, f, function (n) { i = (new t.DB.DataSet).toJson(n); var i = (new t.DB.DataSet).toJson(n); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, lt = function (t, i, r) { var f = r ? !0 : !1, u = null, e = { sql: t.join("/"), param: i }; return n.ajax({ url: ht + "iesWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }; t.DisplayType = { String: 10, Integer: 11, Amount: 12, ID: 13, Text: 14, Date: 15, DateTime: 16, List: 17, Table: 18, TableDir: 19, YesNo: 20, Location: 21, Number: 22, Binary: 23, Time: 24, Account: 25, RowID: 26, Color: 27, Button: 28, Quantity: 29, Search: 30, Locator: 31, Image: 32, Assignment: 33, Memo: 34, PAttribute: 35, TextLong: 36, CostPrice: 37, FilePath: 38, FileName: 39, URL: 40, PrinterName: 42, Label: 44, MultiKey: 45, GAttribute: 46, AmtDimension: 47, ProductContainer: 48, IsString: function (n) { return t.DisplayType.String == n }, IsText: function (n) { return n == t.DisplayType.String || n == t.DisplayType.Text || n == t.DisplayType.TextLong || n == t.DisplayType.Memo || n == t.DisplayType.FilePath || n == t.DisplayType.FileName || n == t.DisplayType.URL || n == t.DisplayType.PrinterName ? !0 : !1 }, IsLookup: function (n) { return t.DisplayType.List == n || n == t.DisplayType.TableDir || n == t.DisplayType.Table || n == t.DisplayType.Search || n == t.DisplayType.MultiKey || n == t.DisplayType.ProductContainer ? !0 : !1 }, IsInt: function (n) { return n == t.DisplayType.Integer ? !0 : !1 }, IsSearch: function (n) { return n == this.Search ? !0 : !1 }, IsID: function (n) { return n == t.DisplayType.ID || n == t.DisplayType.Table || n == t.DisplayType.TableDir || n == t.DisplayType.Search || n == t.DisplayType.Location || n == t.DisplayType.Locator || n == t.DisplayType.Account || n == t.DisplayType.Assignment || n == t.DisplayType.PAttribute || n == t.DisplayType.Image || n == t.DisplayType.Color || n == t.DisplayType.AmtDimension || n == t.DisplayType.ProductContainer ? !0 : !1 }, IsNumeric: function (n) { return n == t.DisplayType.Amount || n == t.DisplayType.Number || n == t.DisplayType.CostPrice || n == t.DisplayType.Integer || n == t.DisplayType.Quantity ? !0 : !1 }, IsDate: function (n) { return n == t.DisplayType.Date || n == t.DisplayType.DateTime || n == t.DisplayType.Time ? !0 : !1 }, IsLOB: function (n) { return n == t.DisplayType.Binary || n == t.DisplayType.TextLong ? !0 : !1 }, MAX_DIGITS: 28, INTEGER_DIGITS: 10, MAX_FRACTION: 12, AMOUNT_FRACTION: 2, GetNumberFormat: function (n) { return n == this.Integer ? new t.Format(this.INTEGER_DIGITS, 0, 0) : n == this.Quantity ? new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, 0) : n == this.Amount ? new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, this.AMOUNT_FRACTION) : n == this.CostPrice ? new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, this.AMOUNT_FRACTION) : new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, 1) } }; t.VControlFactory = { getControl: function (n, i, f, e) { var ut, et, gt, ti, ni, vt, yt, pt, ii, ri, ui, kt, fi, dt, wt, ei, oi, si, bt, ct, lt; if (!i || (ut = i.getColumnName(), et = i.getIsMandatory(!1), i.getIsHeading())) return null; var li = i.getIsDisplayed(), hi = i.getMinValue(), ci = i.getMaxValue(), ft = null, rt = i.getDisplayType(), st = i.getIsReadOnly(), ht = i.getIsEditable(!1), at = i.getWindowNo(); return rt == t.DisplayType.Button ? (gt = new r(ut, et, st, ht, i.getHeader(), i.getDescription(), i.getHelp(), i.getVAF_Job_ID(), i.getIsLink(), i.getIsRightPaneLink(), i.getVAF_Page_ID(), i.getIsBackgroundProcess(), i.getAskUserBGProcess()), gt.setField(i), gt.setReferenceKey(i.getVAF_Control_Ref_Value_ID()), ft = gt) : rt == t.DisplayType.String ? (lt = new p(ut, et, st, ht, i.getDisplayLength(), i.getFieldLength(), i.getVFormat(), i.getObscureType(), i.getIsEncryptedField()), lt.setField(i), ft = lt) : rt == t.DisplayType.YesNo ? (ti = new w(ut, et, st, ht, i.getHeader(), i.getDescription()), ti.setField(i), ft = ti) : t.DisplayType.IsDate(rt) ? (rt == t.DisplayType.DateTime && (readOnly = !0), ni = new b(ut, et, st, ht, rt, i.getHeader()), ni.setName(ut), ni.setField(i), ft = ni) : t.DisplayType.IsLookup(rt) || t.DisplayType.ID == rt ? (vt = i.getLookup(), e && vt != null && vt.disableValidation(), e ? vt == null || rt != t.DisplayType.Search && vt.getDisplayType() != t.DisplayType.Search ? (yt = new l(ut, et, st, ht, vt, i.getDisplayLength(), rt, i.getZoomWindow_ID()), yt.setDisplayType(rt), yt.setField(i), ft = yt) : (rt = t.DisplayType.Search, pt = new o(ut, et, st, ht, rt, vt, i.getZoomWindow_ID()), pt.setField(i), ft = pt) : rt != t.DisplayType.Search && rt != t.DisplayType.MultiKey && rt != t.DisplayType.ProductContainer ? (yt = new l(ut, et, st, ht, vt, i.getDisplayLength(), rt, i.getZoomWindow_ID()), yt.setField(i), ft = yt) : rt == t.DisplayType.ProductContainer ? (ct = new y(ut, et, st, ht, rt, i.getLookup(), at), ct.setField(i), ft = ct) : (pt = new o(ut, et, st, ht, rt, vt, i.getZoomWindow_ID()), pt.setField(i), ft = pt)) : rt == t.DisplayType.Location ? (ii = new d(ut, et, st, ht, rt, i.getLookup()), ii.setField(i), ft = ii) : rt == t.DisplayType.Locator ? (ri = new h(ut, et, st, ht, rt, i.getLookup()), ri.setField(i), ft = ri) : t.DisplayType.Text == rt || t.DisplayType.TextLong == rt || t.DisplayType.Memo == rt ? (ui = new tt(ut, et, st, ht, i.getDisplayLength(), i.getFieldLength(), rt), ui.setField(i), ft = ui) : t.DisplayType.IsNumeric(rt) ? t.DisplayType.Amount == rt || t.DisplayType.Quantity == rt || t.DisplayType.CostPrice == rt ? (kt = new s(ut, et, st, ht, i.getDisplayLength(), i.getFieldLength(), rt, "FixedHeader"), kt.setMinValue(hi), kt.setMaxValue(ci), kt.setField(i), ft = kt) : t.DisplayType.Integer == rt ? (fi = new k(ut, et, st, ht, i.getDisplayLength(), i.getFieldLength(), "FixedHeader"), fi.setField(i), ft = fi) : t.DisplayType.Number == rt && (dt = new s(ut, et, st, ht, i.getDisplayLength(), i.getFieldLength(), rt, "FixedHeader"), dt.setField(i), dt.setMinValue(hi), dt.setMaxValue(ci), ft = dt) : rt == t.DisplayType.PAttribute ? (wt = new u(ut, et, st, ht, rt, i.getLookup(), at, !1, !1, !1, !0), wt.setField(i), ft = wt) : rt == t.DisplayType.GAttribute ? (wt = new u(ut, et, st, ht, rt, i.getLookup(), at, !1, !1, !1, !1), wt.setField(i), ft = wt) : rt == t.DisplayType.Account ? (ei = new g(ut, et, st, ht, rt, i.getLookup(), at, i.getHeader()), ei.setField(i), ft = ei) : rt == t.DisplayType.Binary ? (oi = new a(ut, et, st, ht, at), oi.setField(i), ft = oi) : rt == t.DisplayType.Image ? (si = new c(ut, et, st, at), si.setField(i), ft = si) : rt == t.DisplayType.URL ? (bt = new it(ut, et, st, ht, i.getDisplayLength(), i.getFieldLength()), bt.setField(i), ft = bt) : rt == t.DisplayType.FileName || rt == t.DisplayType.FilePath ? (bt = new v(ut, et, st, ht, at, rt), bt.setField(i), ft = bt) : rt == t.DisplayType.Label ? (lt = new ot(i.getHelp(), ut, !1, !0), lt.setField(i), ft = lt) : rt == t.DisplayType.AmtDimension ? (ct = new nt(ut, et, st, ht, rt, i.getLookup(), at), ct.setField(i), ct.setDefaultValue(i.vo.DefaultValue), ft = ct) : rt == t.DisplayType.ProductContainer && (ct = new y(ut, et, st, ht, rt, i.getLookup(), at), ct.setField(i), ft = ct), ft == null && (lt = new p(ut, et, st, ht, i.getDisplayLength(), i.getFieldLength(), i.getVFormat(), i.getObscureType(), i.getIsEncryptedField()), lt.setField(i), ft = lt), ft }, getLabel: function (n) { if (n == null) return null; var i = n.getDisplayType(); return n.getIsFieldOnly() || i == t.DisplayType.YesNo || i == t.DisplayType.Button || i == t.DisplayType.Label ? null : new t.Controls.VLabel(n.getHeader(), n.getColumnName(), n.getIsMandatory()) }, getHeaderLabel: function (n) { if (n == null) return null; var i = n.getDisplayType(); return n.getHeaderIconOnly() && n.getHeaderHeadingOnly() || n.getHeaderIconOnly() || i == t.DisplayType.Button || i == t.DisplayType.Label ? null : new t.Controls.VLabel(n.getHeader(), n.getColumnName(), n.getIsMandatory()) }, getReadOnlyControl: function (n, i) { var u, e; if (!i) return null; var f = i.getColumnName(), o = i.getIsMandatory(!1), s = i.getWindowNo(), h = i.getHeaderOverrideReference() || i.getDisplayType(), r = null; return h == t.DisplayType.Image ? (u = new c(f, o, !0, s), u.setDimension(120, 140), r = u) : (e = new rt(i.getHelp(), f, !1, !0), r = e), r }, getIcon: function (n) { return n.getFontClass() ? "<i class='" + n.getFontClass() + "'> <\/i>" : n.getVAF_Image_ID() > 0 ? "<img src='" + t.Application.contextUrl + "Images/Thumb16x16/" + n.getVAF_Image_ID() + ".jpg' > " : void 0 } }; i.prototype.getControl = function () { return this.ctrl }; i.prototype.getRoot = function () { return this.root ? this.root : this.ctrl }; i.prototype.getField = function () { return this.mField }; i.prototype.getName = function () { return this.colName }; i.prototype.getColumnName = function () { return this.colName }; i.prototype.getIsMandatory = function () { return this.isMandatory }; i.prototype.getIsReadonly = function () { return this.readOnly }; i.prototype.getDisplayType = function () { return this.displayType }; i.prototype.getIsVisible = function () { return this.visible }; i.prototype.getValue = function () { return this.ctrl.val() }; i.prototype.getDisplay = function () { return this.ctrl.val() }; i.prototype.getBtnCount = function () { return 0 }; i.prototype.setName = function (n, t) { t ? this.name = t + n : this.colName = n }; i.prototype.setField = function (n) { this.mField = n }; i.prototype.setValue = function () { }; i.prototype.setVisible = function (n) { this.visible = n; n ? this.ctrl.show() : this.ctrl.hide() }; i.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; i.prototype.setDefaultFocus = function (n) { n && this.ctrl.focus() }; i.prototype.setMandatory = function (n) { this.isMandatory = n; this.setBackground(!1) }; i.prototype.setBackground = function (n) { if (!this.colName.startsWith("lbl") && this.displayType != t.DisplayType.Label && this.displayType != t.DisplayType.YesNo && this.displayType != t.DisplayType.Button) if (typeof n == "boolean") if (n) this.setBackground("vis-ev-col-error"); else if (this.isReadOnly) this.setBackground("vis-ev-col-readonly"); else if (this.isMandatory) { var i = this.getValue(); if (i && i.toString().length > 0) { this.setBackground(""); return } this.setBackground("vis-ev-col-mandatory") } else this.setBackground(""); else { if (this.activeClass == n) return; this.ctrl.removeClass(); n.length > 0 && this.ctrl.addClass(n); this.activeClass = n } }; i.prototype.setDisplayType = function (n) { this.displayType = n }; i.prototype.addVetoableChangeListener = function (n) { this.vetoablechangeListner = n }; i.prototype.fireValueChanged = function (n, t) { if (this.isReadOnly) { var i = this.oldValue; this.oldValue = ""; this.setValue(i); return } this.editingGrid && (this.gridPos.dialog || t) ? window.setTimeout(function (t) { t.ctrl.parent().length != 0 && t.ctrl.detach(); t.editingGrid.editChange.call(t.editingGrid, t.ctrl[0], t.gridPos.index, t.gridPos.col, n, n.newValue); t = null; n = null }, 10, this) : this.vetoablechangeListner && !this.editingGrid && window.setTimeout(function (t) { t.vetoablechangeListner.vetoablechange(n); t = null; n = null }, 10, this) }; i.prototype.fireRefreshUI = function (n) { this.vetoablechangeListner && window.setTimeout(function (t) { t.vetoablechangeListner.refreshUI(n); t = null; n = null }, 10, this) }; i.prototype.addActionListner = function (n) { this.actionListner = n }; i.prototype.invokeActionPerformed = function (n) { this.actionListner && this.actionListner.actionPerformed(n) }; i.prototype.dispose = function () { console.log("dispose "); this.ctrl.remove(); this.ctrl = null; this.mField = null; this.displayType = null; this.isReadOnly = null; this.colName = null; this.isMandatory = null; this.oldValue = null; this.vetoablechangeListner = null; this.actionListner = null; this.disposeComponent() }; t.Utility.inheritPrototype(p, i); p.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.ctrl.val(n)) }; p.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(ot, i); t.Utility.inheritPrototype(rt, i); rt.prototype.setValue = function (n, t) { this.oldValue != n && (this.oldValue = n, this.ctrl.text(n), t && this.ctrl.html(n)) }; rt.prototype.getValue = function () { return this.value != null ? this.ctrl.text().toString() : null }; t.Utility.inheritPrototype(r, i); r.prototype.setReferenceKey = function (n) { n && n > 0 && n != 195 && n != 135 && n != 234 && this.readReference(n) }; r.prototype.setValue = function (n) { var i, r; this.value = n; i = this.text; n == null || this.colName.equals("Record_ID") || (this.values != null ? i = this.values[n] : this.lookup != null && (r = this.lookup.get(n), r != null && (i = r.getName()))); i || (i = t.Msg.getMsg("Invalid") + " { '" + n + "' }"); this.setText(i != null ? i : "") }; r.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.css("opacity", n ? .6 : 1); this.isLink || this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; r.prototype.getValue = function () { return this.value != null ? this.value.toString() : null }; r.prototype.getDisplay = function () { return this.value }; r.prototype.readReference = function (n) { var r, u, i; this.values = {}; r = t.Env.isBaseLanguage(t.Env.getCtx(), "") ? "VIS_82" : "VIS_148"; u = []; u[0] = new t.DB.SqlParam("@VAF_Control_Ref_ID", n); try { for (i = f(r, u); i.read();)this.values[i.getString(0)] = i.getString(1); i.close() } catch (e) { t.Logging.VLogger.getVLogger().get().log(t.Logging.Level.SEVERE, r, e) } }; r.prototype.getProcess_ID = function () { return this.VAF_Job_ID }; r.prototype.getVAF_Page_ID = function () { return this.VAF_Page_ID }; r.prototype.getDescription = function () { return this.description }; r.prototype.getHelp = function () { return this.help }; r.prototype.getAskUserBGProcess = function () { return this.askUserBGProcess }; r.prototype.getIsBackgroundProcess = function () { return this.isBackgroundProcess }; t.Utility.inheritPrototype(w, i); w.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.cBox.prop("checked", n)) }; w.prototype.getValue = function () { return this.cBox.prop("checked") }; w.prototype.getDisplay = function () { return this.cBox.prop("checked").toString() }; t.Utility.inheritPrototype(l, i); l.prototype.setValue = function (n, i) { var u, f, r; if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.ctrl.val(n), n == null) { this.lastDisplay = ""; this.settingValue = !1; return } if (this.lookup == null) { this.lastDisplay = n.toString(); this.settingValue = !1; return } if (this.lastDisplay = this.lookup.getDisplay(n, !0), this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null), this.inserting = i, u = this.lastDisplay.startsWith("<") && this.lastDisplay.endsWith(">"), f = this.ctrl.val(), f == null || this.inserting && this.lookup.getDisplayType() != t.DisplayType.Search) { if (u && this.lookup.loading) { window.setTimeout(function (t) { t.setValue(n, i); t = null; return }, 500, this); this.oldValue = "oldValue"; return } u && (this.lastDisplay = this.lookup.getDisplay(n, !1), u = this.lastDisplay.startsWith("<") && this.lastDisplay.endsWith(">")); u ? (this.oldValue = "old", this.ctrl.val(null), this.inserting && this.ctrl.trigger("change")) : this.ctrl.val() == null && (this.inserting && !this.lookup.info.isParent && this.lookup.getIsValidated() && this.lookup.allLoaded ? (this.lookup.fillCombobox(this.getIsMandatory(), !1, !1, !1), this.lookup.loading || this.refreshOptions(this.lookup.data, n)) : (r = null, this.lookup.loading || (r = this.lookup.getFromList(n)), r == null && (r = this.lookup.get(n)), r != null && (this.ctrl.append('<option value="' + r.Key + '">' + r.Name + "<\/option>"), this.ctrl.val(n)))); this.ctrl.val() == null && n != null && (this.oldValue = null) } this.settingValue = !1 } this.inserting = !1 }; l.prototype.getValue = function () { var n = this.ctrl.val(); return n == "-1" ? null : n }; l.prototype.refreshOptions = function (n, t) { for (var r = [], u = -1, i = 0; i < n.length; i++)t && t == n[i].Key && (u = i), r[i] = '<option value="' + n[i].Key + '">' + n[i].Name + "<\/option>"; this.ctrl.empty(); this.ctrl.html(r.join("")); this.ctrl[0].selectedIndex = u }; l.prototype.getDisplay = function () { return this.lookup == null ? this.ctrl.val() : this.lookup.getDisplay(this.ctrl.val()) }; t.Utility.inheritPrototype(b, i); b.prototype.setValue = function (n) { var i, f, e, r, u; if (this.oldValue != n) { if (this.oldValue = n, n == null || n == "") { this.ctrl.val(""); return } i = new Date(n); this.displayType != t.DisplayType.Date && i.setMinutes(-i.getTimezoneOffset() + i.getMinutes()); n = i.toISOString(); f = n.substring(0, n.length - 1); e = n.indexOf("T"); this.displayType == t.DisplayType.DateTime ? this.ctrl.val(f) : this.displayType == t.DisplayType.Date ? this.ctrl.val(f.substring(0, e)) : (r = i.getUTCHours(), u = i.getUTCMinutes(), this.ctrl.val((r < 10 ? "0" + r : r) + ":" + (u < 10 ? "0" + u : u))) } }; b.prototype.getValue = function () { var i = this.ctrl.val(), n; if (i == null || i == "") return null; if (n = null, this.displayType == t.DisplayType.Time) { n = new Date(0); var r = i.match(/(\d+)\:(\d+)/), u = parseInt(r[1], 10), f = parseInt(r[2], 10); n.setHours(u); n.setMinutes(f) } else n = new Date(i + "Z"); try { return this.displayType == t.DisplayType.DateTime && n.setMinutes(n.getTimezoneOffset() + n.getMinutes()), n.toISOString().replace(".000Z", "Z") } catch (e) { return console.log(i), new Date } }; b.prototype.getDisplay = function () { return this.getValue() }; t.Utility.inheritPrototype(o, i); o.prototype.setValue = function (n, i, r) { var s, e, o, h, f, u; if (this.oldValue != n || i) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; r && (u = { newValue: n, propertyName: this.getName() }, this.fireValueChanged(u), u = null); return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } if (this.displayType !== t.DisplayType.MultiKey) this.lastDisplay = this.lookup.getDisplay(n); else { for (s = n.toString().split(","), e = "", o = 0, h = s.length; o < h; o++) { if (f = s[o], isNaN(f) || (f = Number(f)), e.length == 0) { e += this.lookup.getDisplay(f); continue } e += ", " + this.lookup.getDisplay(f) } this.lastDisplay = e } this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = n; this.ctrl.val(t.Utility.decodeText(this.lastDisplay)); this.settingValue = !1; r && ((n == -1 || n == "") && (n = null), u = { newValue: n, propertyName: this.getName() }, this.fireValueChanged(u), u = null) } else n == null && this.ctrl.val("") }; o.prototype.getValue = function () { return this.value }; o.prototype.getMultipleIds = function () { return this.infoMultipleIds }; o.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; o.prototype.setCustomInfo = function (n) { n != null && (this.custInfoWin = n) }; t.Utility.inheritPrototype(tt, i); tt.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.ctrl.val(n)) }; tt.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(s, i); s.prototype.setValue = function (n) { if (this.oldValue != n) { this.oldValue = n; n = this.format.GetFormatedValue(n); this.ctrl.attr("type", "text"); var t = this.format.GetFormatAmount(n, "init", this.dotFormatter); this.ctrl.val(t) } }; s.prototype.getValue = function () { var n = this.$super.getValue.call(this); return (n = this.format.GetConvertedNumber(n, this.dotFormatter), isNaN(n) || n === null) ? null : Number(n) }; s.prototype.getDisplay = function () { return this.ctrl.val() }; s.prototype.setMaxValue = function (t) { n.isNumeric(t) && this.ctrl.attr("max", t) }; s.prototype.setMinValue = function (t) { n.isNumeric(t) && this.ctrl.attr("min", t) }; t.Utility.inheritPrototype(k, i); k.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.ctrl.val(n)) }; k.prototype.getValue = function () { var n = this.$super.getValue.call(this); return n === null ? null : (this.editingGrid && (n = this.format.GetFormatedValue(n)), n) }; k.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(d, i); d.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } this.lastDisplay = this.lookup.getDisplay(n); this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = n; this.ctrl.val(t.Utility.decodeText(this.lastDisplay)); this.settingValue = !0 } }; d.prototype.getValue = function () { return this.value }; d.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(h, i); h.prototype.getOnlyWarehouseID = function () { var r = t.Env.getCtx(), u = r.getContext(this.windowNum, "0|VAF_TableView_ID", !0), n, i; if ("572" == u) return 0; n = r.getContext(this.windowNum, "VAM_Warehouse_ID", !0); i = 0; try { n != null && n.length > 0 && (i = Number(n)) } catch (f) { } return i }; h.prototype.getOnlyProductID = function () { var r = t.Env.getCtx(), u = r.getContext(this.windowNum, "0|VAF_TableView_ID", !0), n, i; if ("572" == u) return 0; n = r.getContext(this.windowNum, "VAM_Product_ID", !0); i = 0; try { n != null && n.length > 0 && (i = Number(n)) } catch (f) { } return i }; h.prototype.showLocatorForm = function (n, i) { var u = 0, r; this.value != null && (u = Number(this.value)); this.lookup.setOnlyWarehouseID(n); this.lookup.setOnlyProductID(i); var f = "Y".equals(t.context.getWindowContext(this.windowNum, "IsReturnTrx")), e = t.Env.getCtx().isSOTrx(this.windowNum), o = (e && !f || !e && f) && this.columnName == "VAM_Locator_ID"; this.lookup.setOnlyOutgoing(o); this.lookup.refresh(); self = this; r = new t.LocatorForm(this.columnName, this.lookup, u, this.mandatory, n, this.windowNum); r.load(); r.showDialog(); r.onClose = function (n) { if (self.oldValue != n) { self.setValue(n); var t = { newValue: n, propertyName: self.columnName }; self.fireValueChanged(t); t = null } } }; h.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } this.lastDisplay = this.lookup.getDisplay(n); this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = n; this.ctrl.val(this.lastDisplay); this.settingValue = !0 } }; h.prototype.getValue = function () { return this.value }; h.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(u, i); u.prototype.setValue = function (n) { (n == null || 0 === n) && (this.ctrl.text(""), this.value = n); this.value = n; this.ctrl.val(this.lookup.getDisplay(n)) }; u.prototype.setField = function (n) { n != null && (this.windowNo = n.getWindowNo(), this.VAF_Column_ID = n.getVAF_Column_ID()); this.mField = n }; u.prototype.getValue = function () { return this.value }; u.prototype.genSetInstanceIDs = function () { return this.setInstanceIDs }; u.prototype.getDisplay = function () { return this.ctrl.val() }; u.prototype.getCanSaveRecord = function () { return this.canSaveRecord }; u.prototype.setCanSaveRecord = function (n) { return this.canSaveRecord = n }; t.Utility.inheritPrototype(g, i); g.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.value = n, this.ctrl.val(this.lookup.getDisplay(n))) }; g.prototype.getValue = function () { return this.value }; g.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(c, i); c.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.oldValue = n, this.value = n, n == null) { this.setIcon(null); this.value = 0; this && this.ctrl.val(null); return } this.refreshImage(n) } }; c.prototype.refreshImage = function (i) { var r = this; n.ajax({ url: t.Application.contextUrl + "VImageForm/GetImageAsByte", dataType: "json", data: { VAF_Image_id: i }, success: function (n) { var n = JSON.parse(n); n ? r.setIcon(n.Bytes, n.Path) : r.setIcon(null, null); r.ctrl.val(i); r = null } }) }; c.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.isLink ? this.ctrl.css("opacity", n ? .6 : 1) : this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; c.prototype.getValue = function () { return this.value }; c.prototype.getDisplay = function () { return this.value }; t.Utility.inheritPrototype(a, i); a.prototype.setValue = function (n) { var t, i; this.oldValue != n && (this.oldValue = n, n == null ? (this.setText("-"), this.value = n, this.ctrl.val(n)) : (t = "?", n.length > 0 ? (i = n, t = "#" + i.length) : t = n.GetType().FullName, this.setText(t != null ? t : ""), this.value = n, this.ctrl.val(n))) }; a.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; a.prototype.getValue = function () { return this.value }; a.prototype.getDisplay = function () { return this.value }; t.Utility.inheritPrototype(it, i); it.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); return } this.value = n; this.ctrl.val(n); this.ctrl.val(n) } }; it.prototype.getValue = function () { return this.value }; it.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(v, i); v.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.value = n, this.ctrl.val(n)) }; v.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; v.prototype.getValue = function () { return this.value }; v.prototype.getDisplay = function () { return this.value }; t.Utility.inheritPrototype(nt, i); nt.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } if (this.lastDisplay = this.lookup.getDisplay(n), this.lastDisplay && this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null), this.value = this.lastDisplay && this.lastDisplay.indexOf("<") > -1 ? this.lastDisplay : n, this.lastDisplay) { var t = this.format.GetFormatedValue(this.lastDisplay); this.ctrl.val(this.format.GetFormatAmount(t, "init", this.dotFormatter)) } this.settingValue = !0 } }; nt.prototype.getValue = function () { return this.value }; nt.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(y, i); y.prototype.setValue = function (n, i, r) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { if (this.lastDisplay = "", this.ctrl.val(""), this.settingValue = !1, r) { var u = { newValue: n, propertyName: this.getName() }; this.fireValueChanged(u); u = null } return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } this.lastDisplay = this.lookup.getDisplay(n); this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = this.lastDisplay.indexOf("<") > -1 ? this.lastDisplay : n; this.ctrl.val(t.Utility.decodeText(this.lastDisplay)); this.settingValue = !0 } }; y.prototype.getValue = function () { return this.value }; y.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Controls.IControl = i; t.Controls.VTextBox = p; t.Controls.VLabel = ot; t.Controls.VButton = r; t.Controls.VCheckBox = w; t.Controls.VComboBox = l; t.Controls.VTextBoxButton = o; t.Controls.VTextArea = tt; t.Controls.VAmountTextBox = s; t.Controls.VNumTextBox = k; t.Controls.VLocation = d; t.Controls.VDate = b; t.Controls.VLocator = h; t.Controls.VAccount = g; t.Controls.VPAttribute = u; t.Controls.VImage = c; t.Controls.VBinary = a; t.Controls.VFile = v; t.Controls.VAmtDimension = nt; t.Controls.VProductContainer = y }(jQuery, VIS), function (n, t) { function h(t, i, r) { var u = null; return n.ajax({ url: s, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(t) }).done(function (n) { u = n; r && r(n) }), u } function i(n) { this.log = t.Logging.VLogger.getVLogger("AccessSqlParser"); this.sqlOriginal; this.sql = []; this.tableInfo = []; this.setSql(n) } function u(n, t) { this.tableName = n; this.synonym = t } function c() { function e(t) { if (t == null) return !1; var i = t.getTableName(); return r.push(i), n.push(t), !0 } function o(t) { var r, i, u; if (t == null) return !1; for (r = !1, i = n.lenght - 1; i >= 0; i--)u = n[i], t === u && (n.splice(1, 1), r = !0); return r } function u() { var r, u, e, t; if (arguments.length == 2) return f(arguments[0], arguments[1]); if (arguments.length == 1) return f(arguments[0]); for (r = 0, u = 0, e = 0; e < n.length; e++)t = n.get(e), t != null && t.lenght > 0 && (i.info(t.toString()), u += t.reset(), r++); return r > 0 && i.info("#" + r + " (" + u + ")"), u } function f(t, f) { var e, o, s, c, h; if (t == null || t.length() == 0) return u(); if (f || (f = 0), r.indexOf(t) < 0) return 0; for (t.equals("VAF_Role"), e = 0, o = 0, s = 0; s < n.length; s++)(c = n[s], c != null) && (h = c.reset(t, f), h >= 0 && e++, h > 0 && (o += h)); return e > 0 && i.fine(t + ": #" + e + " (" + o + ")"), o } var n = [], r = [], i = t.Logging.VLogger.getVLogger("CacheMgt"); return { register: e, reset: u, unregister: o } } function r(n, i, r, u, f, e) { this.m_cacheK = []; this.m_cacheV = []; this.m_tableName = n; this.m_resetAll = u ? u : !1; this.m_tableName2 = e; this.setExpireMinutes(r); t.CacheMgt.register(this) } var e = /(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})/, l = t.Logging.Level, o = t.Application.contextUrl, s = o + "JsonData/JDataSetWithCode", f = function (n, i, r, u) { var o = r ? !0 : !1, e = { sql: n, page: 1, pageSize: 0 }, f; return i && (e.param = i), f = null, h(e, o, function (n) { f = (new t.DB.DataReader).toJson(n); r && r(f) }, u), f }; t.Evaluator = { parseDepends: function (n, t) { var i, r, u; if (t != null && t.length != 0) for (i = t; i.indexOf("@") != -1;)(r = i.indexOf("@"), i = i.substring(r + 1), r = i.indexOf("@"), r != -1) && (u = i.substring(0, r), i = i.substring(r + 1), n.indexOf(u) < 0 && (n[n.length] = u)) }, evaluateLogic: function (n, i) { var u = new t.StringTokenizer(i.trim(), "&|", !0), o = u.countTokens(), r, f, e; if (o / 2 - (o + 1) / 2 == 0) return !1; for (r = this.evaluateLogicDouble(n, u.nextToken()); u.hasMoreTokens();)if (f = u.nextToken().trim(), e = this.evaluateLogicDouble(n, u.nextToken()), f.equals("&")) r = r && e; else if (f.equals("|")) r = r || e; else return !1; return r }, evaluateLogicDouble: function (n, i) { var o = new t.StringTokenizer(i.trim(), "!=^><", !0), e, u; if (o.countTokens() !== 3) return !1; e = o.nextToken().trim(); u = e.trim(); e.indexOf("@") != -1 && (e = e.replaceAll("@", " ").trim(), u = n.getValueAsString(e), u == null && (u = "")); u = u.replaceAll("'", " ").replaceAll('"', " ").trim(); var s = o.nextToken(), f = o.nextToken(), r = f.trim(); return f.indexOf("@") != -1 && f[0] == "@" && f[f.length - 1] == "@" && (f = f.replaceAll("@", " ").trim(), r = n.getValueAsString(f), r == null && (r = "")), r = r.replaceAll("'", " ").replaceAll('"', " ").trim(), e.indexOf("_ID") != -1 && u.length == 0 && (u = "0"), f.indexOf("_ID") != -1 && r.length == 0 && (r = "0"), u == "0" && (r == "" || r == "null") && (r = "0"), u.length == 0 && r == "null" && (r = ""), this.evaluateLogicTuple(u, s, r) }, evaluateLogicTuple: function (n, t, i) { if (n == null || t == null || i == null) return !1; var r = 0, u = 0; try { n.startsWith("'") || isNaN(n) || (r = Number(n)); i.startsWith("'") || isNaN(i) || (u = Number(i)) } catch (f) { r = 0; u = 0 } return t.equals("=") ? r != 0 && u != 0 ? r.compareTo(u) == 0 : n.compareTo(i) == 0 : t.equals("<") ? r != 0 && u != 0 ? r.compareTo(u) < 0 : n.compareTo(i) < 0 : t.equals(">") ? r != 0 && u != 0 ? r.compareTo(u) > 0 : n.compareTo(i) > 0 : r != 0 && u != 0 ? r.compareTo(u) != 0 : n.compareTo(i) != 0 }, getVariables: function (n) { for (var u = [], f = new StringBuilder, r = new t.StringTokenizer(n, "@"), i; r.hasMoreTokens();)f.append(r.nextToken()), r.hasMoreTokens() && (f.append("?"), i = r.nextToken(), i.indexOf("|") != -1 && (i = i.substring(0, i.indexOf("|"))), u.indexOf(i) === -1 && u.push(i)); return u }, replaceVariables: function (n, t, i) { var u = n, h = [], e, f, r, o, s; for (this.parseDepends(h, n), e = 0; e < h.length; e++) { if (f = h[e], f.indexOf("\n") != -1) break; if (r = null, i != null && (r = i.get(f)), r == null && (r = t.getContext(f)), r != null && r.length > 0) { o = null; try { o = new Number(r) } catch (c) { } if (o != null) u = u.replaceAll("@" + f + "@", o.toString()); else { s = null; try { s = new Double(r) } catch (c) { } u = s != null ? u.replaceAll("@" + f + "@", s.toString()) : u.replaceAll("@" + f + "@", r.replaceAll("'", "''")) } } else u = u.replaceAll("@" + f + "@", "NULL") } return u } }; t.Query = function (n, t) { this.tableName = n ? n : ""; this.list = []; this.recordCount = 999999; this.newRecord = !1; this.isORcondition = !1; t && t == !0 && (this.isORcondition = !0) }; t.Query.prototype.addRestriction = function () { var n = null, i; if (arguments.length == 5) n = new t.QueryRestriction(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4]), this.isORcondition && (n.andCondition = !1), arguments[3].toString().startsWith("-") || this.list.push(n); else if (arguments.length == 3) n = new t.QueryRestriction(arguments[0], arguments[1], arguments[2], null, null), this.isORcondition && (n.andCondition = !1), this.list.push(n); else if (arguments.length == 1) if (i = arguments[0], typeof i == "string") { if (i == null || i.trim().length == 0) return; n = new t.QueryRestriction(i); this.isORcondition && (n.andCondition = !1); this.list.push(n); this.newRecord = i.equals(t.Query.NEWRECORD) } else n = i, this.isORcondition && (n.andCondition = !1), this.list.push(n); else throw new Error("invalid arguments Addrestriction"); n = null }; t.Query.prototype.setTableName = function (n) { this.tableName = n }; t.Query.prototype.setRecordCount = function (n) { this.recordCount = n }; t.Query.prototype.setColumnName = function (n, t) { n < 0 || n >= this.list.length || (this.list[n].columnName = t) }; t.Query.prototype.getCode = function (n) { if (n < 0 || n >= this.list.length) return null; this.list[n].code }; t.Query.prototype.getInfo = function () { var i = "", n = null, t; for (this.tableName != null && (i += this.tableName + ": "), t = 0; t < this.list.length; t++)n = this.list[t], t != 0 && (i += n.andCondition ? " AND " : " OR "), i += n.getInfoName() + n.getInfoOperator() + n.getInfoDisplayAll(); return i }; t.Query.prototype.getIsActive = function () { return this.list.length != 0 }; t.Query.prototype.getIsNewRecordQuery = function () { return this.newRecord }; t.Query.prototype.getRecordCount = function () { return this.recordCount }; t.Query.prototype.getWhereClause = function () { var t = arguments.length == 1 ? arguments[0] : !1, n = "", i = null, u, r; if (typeof t == "boolean" || isNaN(t)) { for (u = t, u && (this.tableName == null || this.tableName.length == 0) && (u = !1), r = 0; r < this.list.length; r++)i = this.list[r], r != 0 && (n += i.andCondition ? " AND " : " OR "), n += u ? i.getSQL(this.tableName) : i.getSQL(null); return n.length > 0 ? " ( " + n + " ) " : n } return t >= 0 && t < this.list.Count && (i = this.list[t], n += i.GetSQL(null)), n }; t.Query.prototype.getRestrictionCount = function () { return this.list.length }; t.Query.prototype.clear = function () { this.list = [] }; t.Query.prototype.getRestrictions = function () { return this.list }; t.Query.prototype.copyRestrictions = function (n) { this.list = this.list.concat(n) }; t.Query.prototype.addRangeRestriction = function () { var n = null; n = arguments.length == 3 ? new t.QueryRestriction(arguments[0], arguments[1], arguments[2], null, null, null) : new t.QueryRestriction(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5]); this.list.push(n) }; t.Query.prototype.getColumnName = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].columnName }; t.Query.prototype.getTableName = function () { return this.tableName }; t.Query.prototype.getOperator = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].operator }; t.Query.prototype.getCodeTo = function (n) { return n < 0 || n >= this.list.Count ? null : this.list[n].code_to }; t.Query.prototype.getInfoDisplay = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].infoDisplay }; t.Query.prototype.getInfoDisplay_to = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].infoDisplay_to }; t.Query.prototype.getInfoName = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].infoName }; t.Query.prototype.getInfoOperator = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].getInfoOperator() }; t.Query.prototype.getInfoDisplayAll = function (n) { return n < 0 || n >= _list.Count ? null : this.list[n].getInfoDisplayAll() }; t.Query.prototype.deepCopy = function () { for (var i = new t.Query(this.tableName), n = 0; n < this.list.length; n++)i.addRestriction(this.list[n]); return i }; t.Query.prototype.getNoRecordQuery = function (n, i) { var r = new t.Query(n); return i ? r.AddRestriction(t.Query.NEWRECORD) : r.AddRestriction("1=2"), r.setRecordCount(0), r }; t.Query.prototype.NEWRECORD = "2=3"; t.Query.prototype.EQUAL = "="; t.Query.prototype.EQUAL_INDEX = 0; t.Query.prototype.NOT_EQUAL = "!="; t.Query.prototype.LIKE = " LIKE "; t.Query.prototype.NOT_LIKE = " NOT LIKE "; t.Query.prototype.GREATER = ">"; t.Query.prototype.GREATER_EQUAL = ">="; t.Query.prototype.LESS = "<"; t.Query.prototype.LESS_EQUAL = "<="; t.Query.prototype.BETWEEN = " BETWEEN "; t.Query.prototype.BETWEEN_INDEX = 8; t.Query.prototype.IN = " IN "; t.Query.prototype.NOT_IN = " NOT IN "; t.Query.prototype.OPERATORS = { "=": " = ", "!=": " != ", " LIKE ": " ~ ", " NOT LIKE ": " !~ ", ">": " > ", ">=": " >= ", "<": " < ", "<=": " <= ", " BETWEEN ": " >-< " }; t.Query.prototype.CVOPERATORS = { "=": " = ", "!=": " != ", ">": " > ", "<": " < " }; t.Query.prototype.OPERATORS_ID = { "=": " = ", "!=": " != " }; t.Query.prototype.CVOPERATORS_ID = { "=": " = ", "!": " != " }; t.Query.prototype.OPERATORS_YN = { "=": " = " }; t.Query.prototype.OPERATORS_DATE_DYNAMIC = { "0": "Today", "1": "lastxDays", "2": "lastxMonth", "3": "lastxYears" }; t.Query.prototype.OPERATORS_DYNAMIC_ID = { "@#VAF_UserContact_ID@": "LoginUser" }; t.Query.prototype.getEqualQuery = function (n, i) { var r = new t.Query; return r.addRestriction(n, t.Query.prototype.EQUAL, i), r.setRecordCount(1), r }; t.QueryRestriction = function () { this.directWhereClause = null; this.columnName; this.infoName; this.operator; this.code; this.infoDisplay; this.code_to; this.infoDisplay_to; this.andCondition = !0; switch (arguments.length) { case 5: this.fnArgu5(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4]); break; case 6: this.fnArgu6(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5]); break; case 9: this.fnArgu9(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6], arguments[7], arguments[8]); break; case 1: this.fnArgu1(arguments[0]); break; case 0: break; default: throw new Error("Invalid arguments"); } }; t.QueryRestriction.prototype.fnArgu5 = function (n, t, i, r, u) { var o = n.trim(), s, f, e; s = r != null ? r : o; Operator = t; f = i != null && typeof i == "Boolean" ? new Boolean(i) == !0 ? "Y" : "N" : i; f != null && typeof f == "string" && (f.startsWith("'") && (f = f.substring(1)), f.endsWith("'") && (f = f.substring(0, f.length - 2))); u != null ? e = u.toString().trim() : i != null && (e = i); this.columnName = o; this.infoName = s; this.operator = Operator; this.code = f; this.infoDisplay = e }; t.QueryRestriction.prototype.fnArgu6 = function (n, i, r, u, f, e) { var o, s; this.fnArgu5(n, t.Query.prototype.BETWEEN, i, u, f); o = r; typeof o == "string" && (o.startsWith("'") && (o = o.substring(1)), o.endsWith("'") && (o = o.substring(0, o.length - 2))); e != null ? s = e.trim() : o != null && (s = o.toString()); this.code_to = o; this.infoDisplay_to = s }; t.QueryRestriction.prototype.fnArgu9 = function (n, t, i, r, u, f, e, o, s) { this.columnName = n; this.infoName = r; this.code = t; this.code_to = i; this.infoName = r; this.infoDisplay = u; this.infoDisplay_to = f; this.operator = e; this.directWhereClause = o; this.andCondition = s }; t.QueryRestriction.prototype.fnArgu1 = function (n) { this.directWhereClause = n }; t.QueryRestriction.prototype.getInfoName = function () { return this.infoName }; t.QueryRestriction.prototype.getInfoOperator = function () { return this.operator in t.Query.OPERATORS ? t.Query.OPERATORS[this.operator] : this.operator }; t.QueryRestriction.prototype.getInfoDisplayAll = function () { if (this.infoDisplay_to == null) return this.infoDisplay; var n = this.infoDisplay; return n + (" - " + InfoDisplay_to) }; t.QueryRestriction.prototype.getSQL = function (n) { var i, r, u; return this.directWhereClause != null ? this.directWhereClause : (i = "", typeof this.code == "string" && (i += " UPPER( "), n != null && n.length > 0 ? (r = this.columnName.lastIndexOf("(") + 1, u = this.columnName.indexOf(")"), i += r != -1 && u != -1 ? this.columnName.substring(0, r) + n + "." + this.columnName.substring(r, r + (u - r)) + this.columnName.substring(u) : n + "." + this.columnName) : i += this.columnName, typeof this.code == "string" && (i += " ) "), this.code == null || "NULL".equals(this.code.toString().toUpper()) || "NullValue".toUpper().equals(this.code.toString().toUpper()) ? i += this.operator.equals(t.Query.prototype.EQUAL) ? " IS NULL " : " IS NOT NULL " : (i += this.operator + " ", (t.Query.prototype.IN.equals(this.operator) || t.Query.prototype.NOT_IN.equals(this.operator)) && (i += "("), this.code instanceof Date || this.code && e.test(this.code.toString()) ? i += t.DB.to_date(this.code, !1) : "string" == typeof this.code ? (i += " UPPER( ", i += t.DB.to_string(this.code.toString()), i += " ) ") : i += this.code, t.Query.prototype.BETWEEN.equals(this.operator) ? (i += " AND ", i += this.code_to instanceof Date || this.code_to && e.test(this.code_to.toString()) ? t.DB.to_date(this.code_to, !1) : typeof this.code_to == "string" ? t.DB.to_string(this.code_to.toString()) : this.code_to) : (t.Query.prototype.IN.equals(this.operator) || t.Query.prototype.NOT_IN.equals(this.operator)) && (i += ")")), i) }; i.prototype.FROM = " FROM "; i.prototype.FROM_LENGTH = i.prototype.FROM.length; i.prototype.WHERE = " WHERE "; i.prototype.ON = " ON "; i.prototype.setSql = function (n) { if (n == null) throw new IllegalArgumentException("No SQL"); this.sqlOriginal = n; var t = this.sqlOriginal.indexOf("\nFROM "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replace("\nFROM ", this.FROM)); t = this.sqlOriginal.indexOf("\nWHERE "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replace("\nWHERE ", this.WHERE)); this.parse() }; i.prototype.getSql = function () { return this.sqlOriginal }; i.prototype.setSql = function (n) { if (n == null) throw new IllegalArgumentException("No SQL"); this.sqlOriginal = n; var t = this.sqlOriginal.indexOf("\nFROM "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replaceAll("\nFROM ", this.FROM)); t = this.sqlOriginal.indexOf("\nWHERE "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replaceAll("\nWHERE ", this.WHERE)); this.parse() }; i.prototype.getSql = function () { return this.sqlOriginal }; i.prototype.parse = function () { var n, t; if (this.sqlOriginal == null || this.sqlOriginal.length == 0) throw new IllegalArgumentException("No SQL"); for (this.getSelectStatements(), n = 0; n < this.sql.length; n++)t = this.getTableInfo(this.sql[n].trim()), this.tableInfo.push(t); return this.tableInfo.length > 0 }; i.prototype.getSelectStatements = function () { var i = [this.sqlOriginal], n = null; try { n = this.getSubSQL(i) } catch (r) { this.log.log(t.Logging.Level.SEVERE, this.sqlOriginal, r); throw new IllegalArgumentException(this.sqlOriginal); } while (i.length != n.length) { i = n; try { n = this.getSubSQL(i) } catch (r) { this.log.log(t.Logging.Level.SEVERE, this.sqlOriginal, r); throw new IllegalArgumentException(n.length + ": " + m_sqlOriginal); } } this.sql = n }; i.prototype.getSubSQL = function (n) { for (var e = [], t = "", i, r, f, o, s, u = 0; u < n.length; u++) { for (t = n[u], i = t.indexOf("(SELECT ", 7); i != -1;) { for (r = i + 1, f = 0; r++ < t.length;)if (o = t.charAt(r), o == ")") if (f == 0) break; else f--; else o == "(" && f++; s = t.substring(i, r + 1); e.push(s); t = t.substring(0, i + 1) + "##" + t.substring(r); i = t.indexOf("(SELECT ", 7) } e.push(t) } return e }; i.prototype.getTableInfo = function (n) { var o, f, i, e, s, h, r; if (isNaN(n)) { for (o = [], n.startsWith("(") && n.endsWith(")") && (n = n.substring(1, n.length - 1)), f = n.indexOf(this.FROM), f != n.lastIndexOf(this.FROM) && this.log.log(t.Logging.Level.FINE, "More than one FROM clause - " + n); f != -1;) { for (i = n.substring(f + this.FROM_LENGTH), r = i.indexOf(this.WHERE), r != -1 && (i = i.substring(0, r)), i = i.replaceAll(" AS ", " "), i = i.replaceAll(" as ", " "), i = i.replaceAll(" INNER JOIN ", ", "), i = i.replaceAll(" LEFT OUTER JOIN ", ", "), i = i.replaceAll(" RIGHT OUTER JOIN ", ", "), i = i.replaceAll(" FULL JOIN ", ", "), r = i.indexOf(this.ON); r != -1;) { if (e = i.indexOf(")"), s = i.indexOf(this.ON, r + 4), s != -1 && (e = i.lastIndexOf(")", s)), e != -1) i = i.substring(0, r) + i.substring(e + 1); else { this.log.log(t.Logging.Level.SEVERE, "Could not remove ON " + i); break } r = i.indexOf(this.ON) } for (h = new t.StringTokenizer(i, ","); h.hasMoreTokens();) { var l = h.nextToken().trim(), c = new t.StringTokenizer(l, " "), a = null; a = c.countTokens() > 1 ? new u(c.nextToken(), c.nextToken()) : new u(l); o.push(a) } n = n.substring(0, f); f = n.lastIndexOf(this.FROM) } return o } return (r = n, r < 0 || r > this.tableInfo.length) ? null : this.tableInfo[r] }; i.prototype.getSqlStatement = function (n) { return n < 0 || n > this.sql.length ? null : this.sql[n] }; i.prototype.getNoSqlStatments = function () { return this.sql == null ? 0 : this.sql.length }; i.prototype.getMainSqlIndex = function () { if (this.sql == null) return -1; if (this.sql.length == 1) return 0; for (var n = this.sql.length - 1; n >= 0; n--)if (this.sql[n].charAt(0) != "(") return n; return -1 }; i.prototype.getMainSql = function () { if (this.sql == null) return this.sqlOriginal; if (this.sql.length == 1) return this.sql[0]; for (var n = this.sql.length - 1; n >= 0; n--)if (this.sql[n].charAt(0) != "(") return this.sql[n]; return "" }; i.prototype.size = function () { return this.tableInfo.length }; u.prototype.getSynonym = function () { return this.synonym == null ? "" : this.synonym }; u.prototype.getTableName = function () { return this.tableName }; t.TableInfo = u; t.AccessSqlParser = i; t.ZoomTarget = { log: t.Logging.VLogger.getVLogger("VIS.ZoomTarget"), getZoomVAF_Screen_ID: function (n, i, r, u) { var c = 0, l = 0, v, e, b, s, y, p, o, a, h; n.equals("VAM_Product"); v = "VIS_78"; o = []; o[0] = new t.DB.SqlParam("@targetTableName", n); e = null; try { b = 1; e = f(v, o); e.read() && (c = e.getInt(0), l = e.getInt(1)) } catch (w) { this.log.log(t.Logging.Level.SEVERE, v, w) } finally { e != null && e.dispose(); e = null } if (l == 0) return c; if (l != 0 && c != 0 && r != null && r.length != 0 && (s = null, y = n.indexOf("Line"), y != -1 && (s = n.substring(0, y)), s != null)) { p = "VIS_79"; o = []; o[0] = new t.DB.SqlParam("@ParentTable", s); o[1] = new t.DB.SqlParam("@targetTableName", n); o[2] = new t.DB.SqlParam("@targetWhereClause", r); o[3] = new t.DB.SqlParam("@ParentTable1", s); o[4] = new t.DB.SqlParam("@ParentTable2", s); try { e = f(p, o); e.read() && (u = e.getString(0).equals("Y")) } catch (w) { this.log(t.Logging.Level.SEVERE, p.toString(), w) } finally { e != null && e.dispose(); e = null } } return (a = 0, r != null && r.length != 0 && (h = [], h = this.getZoomTargets(n, i, r), h != null && h.length > 0 && (a = h[0].Key)), a != 0) ? a : u ? c : l }, parseColumns: function (n, t) { var i, e, u, f, r; if (t != null && t.length != 0 && (i = t, !i.contains(" EXISTS ") && !i.contains(" IN ") && !i.contains("(") && !i.contains(")"))) while (i.indexOf("=") != -1) e = i.indexOf("="), u = i.substring(0, e), u = u.trim(), f = u.lastIndexOf(" ", u.length), r = u.substring(f + 1), r.indexOf(".") != -1 && (f = r.indexOf(".") + 1, r = r.substring(f, r.length)), n.indexOf(r) < 0 && n.push(r), i = i.substring(e + 1) }, evaluateWhereClause: function (n, i) { var r, s, o; if (i == null || i.length == 0) return !0; if (r = i, s = !0, r.contains(" EXISTS ") || r.contains(" IN ") || r.contains("(") || r.contains(")")) return !1; while (r.indexOf("=") != -1) { var u = r.indexOf("="), f = r.lastIndexOf(" ", u), e = r.substring(f + 1, u), h = "", c = ""; for (e.indexOf(".") != -1 && (f = e.indexOf(".") + 1, e = e.substring(f, e.length)), o = 0; o < n.length; o++)if (e.equals(n[o].Name)) { h = n[o].Value; break } if (r = r.substring(u + 1), f = 0, u = r.indexOf(" "), c = u == -1 ? r.substring(f) : r.substring(f, u), !t.Evaluator.evaluateLogicTuple(h, "=", c)) { s = !1; break } } return s }, getZoomTargets: function (i, r, u, e) { var it, s, k, p, h, a, d, o, l, y, g, ot, w; if (arguments.length == 4) { if (e.length != 1) return null; it = e[0]; s = u.replace("?", it.toString()); s = s.replace("WHERE ", " "); this.log.fine("WhereClause : " + s); u = s } var b = [], c = [], v = [], nt = 0, rt = 0, ut = "", s = "", ft = !1, st = null, ht = 0, ct = 0, lt = 0, et = "VIS_80", o = null; try { for (o = f(et); o.read();)k = o.getInt(0), p = o.getString(1), p.equals("Work Center") ? ht = k : p.equals("Work Center Costs") ? (ct = k, st = p) : p.equals("Production Resource") && (lt = k) } catch (tt) { this.log.log(t.Logging.Level.SEVERE, et, tt) } finally { o != null && o.dispose(); o = null } try { for (o = null, n.ajax({ type: "Get", async: !1, url: t.Application.contextUrl + "Form/GetZoomTargetClass", data: { targetTableName: i, curWindow_ID: r }, success: function (n) { o = (new t.DB.DataReader).toJson(n) } }); o.read();) { if (ft = !0, nt = o.getInt(6), ut = o.getString(7), rt = o.getInt(4), s = o.getString(2), rt == 0) break; c.push({ VAF_Screen_ID: o.getInt(0), windowName: o.getString(1), whereClause: s }) } } catch (tt) { this.log.log(t.Logging.Level.SEVERE, sql, tt) } finally { o != null && o.dispose() } if (h = "", !ft || c.length <= 1 && nt == 0) return b; if (c.length <= 1) h = "SELECT count(*) FROM " + i + " WHERE " + u, s != null && s.length != 0 && (h += " AND " + t.Evaluator.replaceVariables(s, t.Env.getCtx(), null)); else if (c.length > 1) { for (a = 0; a < c.length; a++)this.parseColumns(v, c[a].whereClause); for (h = "SELECT DISTINCT ", a = 0; a < v.length; a++)a != 0 && (h += ","), h += v[a]; v.length == 0 && (h += "count(*) "); h += " FROM " + i + " WHERE " + u } this.log.fine(h); d = []; try { for (o = null, n.ajax({ type: "Get", async: !1, url: t.Application.contextUrl + "Form/GetZoomWhereClause", data: { sql: t.secureEngine.encrypt(h) }, success: function (n) { o = (new t.DB.DataReader).toJson(n) } }); o.read();)if (v.length > 0) { for (d.length = 0, l = 0; l < v.length; l++)y = v[l], g = "", g = typeof o.get(y) != "string" ? o.get(y).toString() : "'" + o.get(y).toString() + "'", this.log.fine(y + " = " + g), d.push({ Value: g, Name: y }); for (l = 0; l < c.length; l++)if (this.evaluateWhereClause(d, c[l].whereClause)) { w = { Key: c[l].VAF_Screen_ID, Value: c[l].windowName }; b.push(w); break } } else ot = o.getInt(0), ot != 0 && (w = { Key: nt, Value: ut }, b.push(w)) } catch (tt) { this.log.log(t.Logging.Level.SEVERE, h, tt) } finally { o != null && o.dispose() } return b } }; r.prototype.setExpireMinutes = function (n) { if (n > 0) { this.m_expire = n; var i = 6e4 * n; this.m_timeExp = t.Env.currentTimeMillis() + i } else this.m_expire = 0, this.m_timeExp = 0 }; r.prototype.expire = function () { this.m_expire != 0 && this.m_timeExp < t.Env.currentTimeMillis() && this.reset() }; r.prototype.reset = function () { var n, i; return arguments.length == 2 ? this.reset2(arguments[0], arguments[1]) : arguments.length == 1 ? this.reset2(arguments[0]) : (n = this.m_cacheK.length, this.clear(), this.m_expire != 0 && (i = 6e4 * this.m_expire, this.m_timeExp = t.Env.currentTimeMillis() + i), n) }; r.prototype.reset2 = function (n, t) { if (this.tableName == null) return -1; var i = n === this.m_tableName || n === this.m_tableName2; return i || this.m_tableName2.startsWith(n) ? t == 0 || this.m_resetAll ? reset() : this.remove(t) : -1 }; r.prototype.remove = function (n) { var t = this.m_cacheK.indexOf(n); return t > -1 ? (this.m_cacheK.splice(t, 1), this.m_cacheV.splice(t, 1), 1) : 0 }; r.prototype.get = function (n) { this.expire(); var t = this.m_cacheK.indexOf(n); return t > -1 ? this.m_cacheV[t] : null }; r.prototype.contains = function (n) { var t = this.m_cacheK.indexOf(n); return t > -1 ? !0 : !1 }; r.prototype.add = function (t, i) { var u, r; this.expire(); (typeof i == "function" || n.isFunction(i)) && (u = ""); r = this.m_cacheK.indexOf(t); r < 0 ? (this.m_cacheK.push(t), this.m_cacheV.push(i)) : this.m_cacheV[r] = i }; r.prototype.clear = function () { this.m_cacheK.length = 0; this.m_cacheV.length = 0 }; r.prototype.size = function () { return this.expire(), this.m_cacheV.length }; r.prototype.getTableName = function () { return this.m_tableName }; t.CacheMgt = c(); t.CCache = r }(jQuery, VIS), function (n) { var t = function (n, t, i, r) { this.tokenizers = t.splice ? t : t.split(""); r && (this.doBuild = r); this.src = n; this.ended = !1; this.tokens = []; this.returnDelim = i; this.curIndex = 0; this.parse() }; t.prototype = { parse: function () { do this.next(); while (!this.ended); return this.tokens }, build: function (n, t) { if (n) { if (!this.returnDelim && this.tokenizers.indexOf(n) > -1) return; this.tokens.push(this.doBuild ? this.doBuild(n, t, this.tkn) : n) } }, next: function () { var n = this, t; n.findMin(); t = n.src.slice(0, n.min); n.build(t, !1); n.src = n.src.slice(n.min).replace(n.tkn, function (t) { return n.build(t, !0), "" }); n.src || (n.ended = !0) }, findMin: function () { var n = this, r = 0, t, i; for (n.min = -1, n.tkn = ""; (t = n.tokenizers[r++]) !== undefined;)i = n.src[t.test ? "search" : "indexOf"](t), i != -1 && (n.min == -1 || i < n.min) && (n.tkn = t, n.min = i); n.min == -1 && (n.min = n.src.length) }, countTokens: function () { return this.tokens.length }, nextToken: function () { return this.hasMoreTokens() ? this.tokens[this.curIndex++] : null }, hasMoreTokens: function () { return this.curIndex < this.tokens.length ? !0 : !1 }, reset: function () { this.curIndex = -1 } }; n.StringTokenizer = t }(VIS), function (n) { function u() { function et() { return tt } function ot() { function i(i) { if (i.target.nodeName === "LABEL") { if (Date.now() - t < 300) { i.preventDefault(); i.stopPropagation(); t = Date.now(); return } t = Date.now() } if (i.target.nodeName === "A") { var r = $(i.target); if (r.data("isfavbtn") == "yes") { n.FavouriteHelper.showOverlay(r); return } l(r.data("action"), r.data("actionid")); return } } y.on(n.Events.onTouchStartOrClick, function (n) { n.preventDefault(); p() }); var t = Date.now(); k.on("click", function (n) { i(n) }); k.on("keyDown", function (n) { n.which == 13 && i(n) }); h.on(n.Events.onClick, "LI", function (n) { if (n.preventDefault(), n.target.nodeName === "I" || n.target.nodeName === "SPAN") { at($(n.currentTarget)); return } var t = null; n.target.nodeName === "LI" ? t = $(n.target) : n.target.parentNode.nodeName === "LI" && (t = $(n.target.parentNode)); t && (v(t[0].id), a(t)); t = null }); b.on("click", function (t) { n.MRole.getIsDisableMenu() || (t.preventDefault(), window.setTimeout(function () { r.focus(); $("#vis_divTree").on("focus", "li", function (n) { var t = $(n.target); $(t).off("keydown"); $(t).on("keydown", function (n) { n.key == "Enter" && (t.siblings("label").length > 0 && $(t.siblings("label")).trigger("click"), t.siblings("a").length > 0 && $(t.siblings("label")).trigger("a")) }); $(t.siblings("label")).css("border", "1px solid #1aa0ed") }); $("#vis_divTree").on("focusout", "li", function (n) { var t = $(n.target); $(t.siblings("label")).css("border", "1px solid white") }) }, 2), ct()) }); rt.on("click", function (n) { n.preventDefault(); p() }); nt && r.bind("input", function () { vt(r.val(), this.list) }); $(window).resize(ft); window.onbeforeunload = function () { $.ajax({ url: n.Application.contextUrl + "Account/LogOffHandler", type: "POST" }) }; ut(1) } function ut(t) { window.setTimeout(function () { $.ajax({ url: n.Application.contextUrl + "Account/Refresh", complete: function () { ut(180) } }) }, 1e3 * t) } function st() { n.Application.contextFullUrl.toLower().indexOf("softwareonthecloud.com") > -1 ? $.ajax({ url: n.Application.contextUrl + "home/GetSubscriptionDaysLeft/", success: function (t) { var i = JSON.parse(t); i && (i == "True" || i == "" ? c.css("display", "none") : i > 1 ? c.text(n.Msg.getMsg("VIS_TrialPeriod") + ": " + i + " " + n.Msg.getMsg("VIS_TrialDaysLeft")) : i == 1 && c.text(n.Msg.getMsg("VIS_TrialPeriod") + ": " + i + " " + n.Msg.getMsg("VIS_TrialDayLeft"))) }, error: function () { c.css("display", "none") } }) : c.css("display", "none") } function ht() { u && u.id && u.action && (l(u.action, u.id), r.val("")); u = null } function p() { i.closePopup(); it.hide("fast"); y.fadeOut(); r.val(""); r.blur() } function ct() { y.fadeIn(); it.show("fast") } function ft() { var t = 0; t = (n.Application.isMobile || n.Application.isIOS) && document.documentElement ? document.documentElement.clientHeight : window.innerHeight; t = t - 23; n.Utility.Util.getValueOfInt(n.context.ctx["#FRAMEWORK_VERSION"]) < 2 && (t = t - 43); n.Env.setScreenHeight(t); document.documentElement.style.setProperty("--vis-screen-height", t * .01 + "px"); n.viewManager && n.viewManager.sizeChanged(t, window.innerwidth) } function l(t, i) { n.viewManager.startAction(t, i); p() } function a(n) { if (n.length > 0) { if (n[0].id == "vis_lhome") return; g && g.removeClass("vis-app-f-selected"); g = n.addClass("vis-app-f-selected"); n = null } } function lt(n) { var t = n.data("wid"); a(h.find("LI#" + t)) } function at(i) { t[t.length - 1] == i[0].id ? n.viewManager.closeFrame(i[0].id) : (v(i[0].id), a(i)) } function v(i) { s ? s.hide() : tt.children("div").hide(); o[i] && (s = o[i], s.css({ opacity: 0 }), s.show().animate({ opacity: 1 }, 500, "linear", function () { n.viewManager.resize(i) })); t.indexOf(i) != -1 && t.splice(t.indexOf(i), 1); t.push(i); p() } function vt(n, t) { var i, u; if (n !== "" && !(n.length < 1)) for (i = 0; i < t.options.length; i++)if (t.options[i].value === n) { u = $(t.options[i]); l(u.data("action"), u.data("actionid")); r.val(""); break } } function yt() { gt(); i.init(k, $("#vis_filterMenu")); f.init($("#vis_home_ca"), $("#vis_userName")); pt(); historyMgr.restoreHistory(); ii(); window.addEventListener("DOMContentLoaded", e, !1) } function pt() { (!n.MRole.getIsDisableMenu() || n.MRole.getIsDisableMenu() && n.MRole.getHomePage() == 0) && wt(); n.MRole.getIsDisableMenu() && ($(".vis-topMenu").hide(), $(".vis-menuHeaderLogo").show()); var t = n.MRole.getHomePage(); t && parseInt(t) > 0 && l("X", t) } function wt() { $("#vis_lhome").show(); o.vis_lhome = w; s = w.show(); n.HomeMgr.initHome(w) } function bt(n, i) { return o[n] = i, t.push(n), v(n), i } function kt(n) { var r, i; return h.find("LI#" + n).remove(), r = o[n], o[n] = null, delete o[n], t.pop(), r = null, i = "", i = t.length > 0 ? t[t.length - 1] : "vis_lhome", v(i), a(h.find("LI#" + i)), !0 } function dt(n, t, i) { var r = ["<li id=" + n + ">"], u; t && (t.indexOf(".") > -1 ? r.push('<img src= "' + t + '" />') : r.push('<i class= "' + t + '" />')); r.push("<a>" + i + '<\/a><span style="padding:0 7px;"><i class="fa fa-times-circle-o" /><\/span><\/li>'); u = $(r.join(" ")); h.append(u); a(u); u = null } function gt() { var n, i, t = []; nt || (i = r.attr("list"), n = $("#" + i), n.length > 0 && (t = [], n.find("option").each(function () { t.push({ label: this.value, value: this.value, action: $(this).data("action"), id: $(this).data("actionid") }) }), r.autocomplete({ source: t, open: function () { window.setTimeout(function () { $(".ui-autocomplete").css("z-index", 1e3); var n = window.innerHeight * 60 / 100; $(".ui-autocomplete").css("max-height", n) }) }, select: function (n, t) { u = t.item }, close: function () { ht() } })), n.remove()) } function ni() { b.trigger("click") } function ti() { rt.trigger("click") } function ii() { } function ri() { return d || (d = $(".vis-app-action-nav")), d } function ui() { return b } var u = null, s = null, o = {}, t = [], nt = !1, w = $("#vis_home"), fi = $("#vis_mainSection"), tt = $("#vis_mainConatiner"), h = $("#vis_taskbar"), b = $("#vis_appMenu"), it = $("#vis_mainMenu"), rt = $("#vis_closeMenu"), c = $("#vis_cloud_daysleft"), r = $("#vis_menuSearch"), k = $("#vis_divTree"), y = $("#vis_menuOverlay"), d = null, g = null; return ft(), ot(), st(), { startMenuAction: l, getMainConatiner: et, toggleContainer: v, registerView: bt, unRegisterView: kt, addTaskBarItem: dt, start: yt, activateTaskBarItemUsingID: lt, openMenu: ni, closeMenu: ti, getNavSection: ri, getMenuDiv: ui } } n.desktopMgr = u(); var f = function () { function et(s, l) { s.remove(); b = l; o = s; v = s.find("#vis_changeAuthForm"); f = s.find("#vis_home_role"); r = s.find("#vis_home_client"); i = s.find("#vis_home_org"); t = s.find("#vis_home_warehouse"); y = s.find("#vis_home_warehouseId"); e = s.find("#vis-auth-close"); u = s.find("#vis-auth-change"); tt = s.find('label[for="Login2Model_Role"]'); it = s.find('label[for="Login2Model_Client"]'); rt = s.find('label[for="Login2Model_Org"]'); ut = s.find('label[for="Login2Model_Warehouse"]'); k = f.val(); d = r.html(); g = i.html(); nt = t.html(); st(); $("body").append(c); $("body").append(o); h = n.Application.contextUrl; ot(); y.val() == "-1" && t.val(null) } function ot() { tt.text(Globalize.localize("Role")); it.text(Globalize.localize("Client")); rt.text(Globalize.localize("Organization")); ut.text(Globalize.localize("Warehouse")); u.val(n.Msg.getMsg("Change")); e.val(n.Msg.getMsg("Close")) } function st() { b.on("click", ct); c.on("click", ft); e.on("click", ft); f.on("change", l); r.on("change", l); i.on("change", l); t.on("change", l); v.submit(at) } function ht() { f.val(k); r.html(d); i.html(g); t.html(nt); y.val() == "-1" && t.val(null); u.prop("disabled", !0); a(v, []); s = !1 } function ct() { c.show(); o.show("slideDown"); e.prop("disabled", !1); u.prop("disabled", !0) } function ft(n) { return s && ht(), c.hide(), o.hide("slideUp"), n.preventDefault(), !1 } function w(n, t, i) { $.ajax(t, { data: i }).success(function (t) { lt(n, t.data) }).fail(function (n) { alert(n) }) } function l() { if (!p) { s || (s = !0, u.prop("disabled", !1)); combo = this; combo.id === f.attr("id") ? (r.empty(), i.empty(), t.empty(), w(r, h + "Account/GetClients", { Id: combo.value })) : combo.id === r.attr("id") ? (i.empty(), t.empty(), w(i, h + "Account/GetOrgs", { role: f.val(), user: n.context.getVAF_UserContact_ID(), client: combo.value })) : combo.id === i.attr("id") ? (t.empty(), w(t, h + "Account/GetWarehouse", { id: i.val() })) : combo.id === t.attr("id"); var e = $("#" + combo.id + "Name"), o = this.options[this.selectedIndex].innerHTML; e.val(o) } } function lt(n, t) { p = !0; n.empty(); var u = Globalize.localize("SelectWarehouse"); n === f ? u = Globalize.localize("SelectRole") : n === r ? u = Globalize.localize("SelectClient") : n === i && (u = Globalize.localize("SelectOrg")); $("<option />", { val: "-1", text: u }).appendTo(n); $(t).each(function () { $("<option />", { val: this.Key, text: this.Name }).appendTo(n) }); p = !1 } function at(n) { var t = $(this); a(t, []); e.prop("disabled", !0); u.prop("disabled", !0); t.find("#vis_home_langugage").val(localStorage.getItem("vis_login_langCode")); (!t.valid || t.valid()) && $.post(t.attr("action"), t.serializeArray()).done(function (n) { n = n || {}; n.success ? (window.location = n.redirect || location.href, window.location.href.indexOf("#") != -1 && location.reload()) : n.errors && (a(t, n.errors), e.prop("disabled", !1), u.prop("disabled", !1)) }).error(function () { a(t, ["An unknown error happened."]); e.prop("disabled", !1); u.prop("disabled", !1) }); n.preventDefault() } var v, f, r, i, t, b, o, e, u, k, d, g, nt, y, s = !1, p = !1, h = "", tt, it, rt, ut, c = $('<div class="vis-wakeup-main" >').hide(), vt = function (n) { return n.find(".validation-summary-errors, .validation-summary-valid") }, a = function (n, t) { var i = vt(n).removeClass("validation-summary-valid").addClass("validation-summary-errors"), r = $.map(t, function (n) { return "<li>" + Globalize.localize(n) + "<\/li>" }).join(""); i.find("ul").empty().append(r) }; return { init: et } }(), i = function () { function h(r, o) { i.html('<input type="radio" name="filter" id="vis_filter_radio_1" value="A" checked style="margin-bottom:5px;margin:1px;" /><label for="vis_filter_radio_1">' + n.Msg.getMsg("All") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_2" value="W" style="margin-bottom:5px;margin:1px;" /><label for="vis_filter_radio_2">' + n.Msg.getMsg("Window") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_3" value="X" style="margin-bottom:5px;margin:1px;"/><label for="vis_filter_radio_3">' + n.Msg.getMsg("Form") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_4" value="P" style="margin-bottom:5px;margin:1px;"/><label for="vis_filter_radio_4">' + n.Msg.getMsg("Process") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_5" value="R" style="margin-bottom:20px;margin:1px;"/><label for="vis_filter_radio_5">' + n.Msg.getMsg("Report") + '<\/label><br/><input type="button" name="filter" value=' + n.Msg.getMsg("Filter") + "><\/input>"); t = r.find(">ul"); var s = [], h = null; t.find("li").each(function () { h = $(this); h.data("summary") == "N" && s.push(h[0].outerHTML) }); u = t.html(); f = s.join(""); s.length = 0; s = null; e = o; $("body").append(i); c() } function c() { e.on("click", o); i.on("click", "input[type=button]", function (n) { n.stopPropagation(); var t = i.find("input[type=radio]:checked").val(); l(t); s() }) } function l(n) { n === "A" ? (t.empty(), t.html(u)) : (t.empty(), t.html(f), t.find("li").hide(), t.find('li > a[data-action="' + n + '"]').parent().show()) } function o() { r = !r; r ? i.show("slide-down") : i.hide("slide-up") } function s() { r && o() } var t = null, u = "", f = "", e = null, r = !1, i = $('<div class="vis-dialog vis-filter-dialog">'); return { init: h, closePopup: s } }(), r = function () { function r(t) { i.text(t); $("body").append(n) } var n = $('<div class="vis-wakeup-main"><\/div><div class="vis-wakeup-outerwrap"><div class="vis-wakeup-content"><div class="vis-wakeup-headsec"><\/div><div class="vis-wakeup-datawrp"><strong>Oh no! Something went wrong<\/strong><div class="vis-wakeup-text"><\/div><button>Refresh<\/button><\/div><\/div><\/div><\/div>'), t = n.find("button"), u = n.find(".vis-wakeup-sleep"), f = n.find(".vis-wakeup-awake"), i = n.find(".vis-wakeup-text"); t.on("click", function () { t.prop("disabled", !0); window.location.reload() }); return { init: r } }(), e = function () { var n = new EventSource("JsonData/MsgForToastr?varificationToken=" + $("#vis_antiForgeryToken").val()); n.onmessage = function (n) { var t = JSON.parse(n.data); t.message && t.message.length > 0 && toastr.success(t.message, "", { timeOut: 4e3, positionClass: "toast-top-center", closeButton: !0 }) } }, t = !1; $(document).ajaxError(function (i, u) { u.status === 401 ? t || (r.init(n.Msg.getMsg("UnAuthorized")), t = !0) : u.status === 999 ? t || (r.init(n.Msg.getMsg("WakeupText")), t = !0) : console.log(u.responseText) }) }(VIS), function (n) { function u() { function et(n) { return i[n].dispose() } function it(n, t) { v === n ? rt(t) : y === n ? ut(t) : (d === n || g === n) && st(t, n) } function o(i, r, u, f) { if (w) ot(); else { var e = "fa fa-window-maximize"; r && (e = r); t.addTaskBarItem(i, e, u); f && i.slice(i.indexOf("_") + 1) != n.MRole.getHomePage() && (s.push(f), historyMgr.updateHistory(b(s.join(p)))) } } function ot() { if (tt++, tt == Object.keys(i).length) { w = !1; for (var n in i) o(i[n].id, i[n].img, i[n].name, i[n].hid) } } function b(t) { return n.Utility.encode(t) } function a(n, r, u, e) { var o, h; return (t.unRegisterView(n), u && (o = s.indexOf(u), o > -1 && s.splice(o, 1), historyMgr.updateHistory(b(s.join(p)))), h = i[n], i[n] = null, delete i[n], f = null, e && yt(h)) ? !1 : !0 } function rt(t, i) { var f = null, u; return (t.toString().indexOf("&") != -1 && (f = t.split("&")[1], t = t.split("&")[0]), u = pt(t), u) ? (u.refreshData(), u.show(r, o), c(u), u) : (u = new n.AWindow, u.initWindow(t, i, o, v, f) && (u.onClosed = a, u.show(r), c(u)), u) } function ut(t, i) { var u = new n.AWindow; n.MRole.getIsDisableMenu() && u.hideCloseIcon(!0); u.initForm(t, o, y, i) && (u.onClosed = a, u.show(r), c(u)) } function st(t, i) { var u = new n.AWindow; u.initProcess(t, o, i, !0) && (u.onClosed = a, u.show(r), c(u)) } function ht(n) { n.onClosed = a; n.show(r); o(n.getId(), "fa fa-list-alt", n.getName(), null); c(n) } function c(n) { t.registerView(n.getId(), n.getRootLayout()); i[n.getId()] = n } function ct(t) { var i, e, r, o; try { if (historyMgr.updateHistory("#"), i = [], t.indexOf("&") != -1 && (t = t.split("&"), i = t[1].split(","), t = t[0]), t = n.Utility.decode(t), t.length > 0) for (w = !0, e = t.split(p), r = 0, o = e.length; r < o; r++)if (e[r].length > 0) { var s = e[r], u = s.substring(0, 1), f = s.substring(2); if (y === u) { if (!n.MRole.getFormAccess(f)) { console.log("No Form Access"); continue } } else if (d === u || g === u) { if (!n.MRole.getProcessAccess(f)) { console.log("No Process Access"); continue } } else if (v === u) { if (!n.MRole.getWindowAccess(f)) { console.log("No Window Access"); continue } i && i.length > 0 && (f += "&" + i.shift()) } it(u, f) } } catch (h) { historyMgr.updateHistory("#"); console.log(h) } } function lt(n) { i[n] && (f = i[n].refresh()) } function at(n, t) { for (var r in i) i[r].sizeChanged(n, t) } function vt(t, i) { if (t && i) { var r = t + "=" + i; r = b(r); window.open(n.Application.contextUrl + "#" + r); return } alert("improper data") } function yt(t) { var i, r; if (!n.Ini.getIsCacheWindow()) return !1; for (i = 0; i < e.length; i++)if (r = e[i], r.getVAF_Screen_ID() == t.getVAF_Screen_ID()) return !0; if (t.getVAF_Screen_ID() != 0) try { return e.push(t), e.length > 10 && e.splice(0, 1), !0 } catch (u) { return !1 } return !1 } function pt(n) { for (var i, t = 0; t < e.length; t++)if (i = e[t], i.getVAF_Screen_ID() == n) return e.splice(t, 1), i; return } function wt() { nt = t.getMenuDiv(); $(document).on("keydown", bt).on("keyup", kt); l = t.getNavSection(); u = l.find(".vis-app-action-nav-inner"); u.on("click", dt) } function bt(r) { if ($(".ui-widget-overlay.ui-front").length > 0 && (r.altKey && r.ctrlKey || r.altKey)) return !1; if (r.altKey && r.keyCode == 88) f.dispose(); else if (r.altKey && r.keyCode == 77) t.openMenu(); else if (nt.css("display") != "none" && r.keyCode == 27) t.closeMenu(); else if (r.altKey && r.keyCode == 76) n.ADialog.confirm("LogOut?", !0, "", "Confirm", function (n) { n && $("#logoutForm").trigger("submit") }); else if (!r.altKey && (r.ctrlKey || r.ctrlKey && r.shiftKey) && r.keyCode == 32) { if (!i || Object.keys(i).length <= 0) return; r.ctrlKey && r.shiftKey ? k(!0, !1) : k(!0, !0); r.preventDefault(); r.stopPropagation() } else r.altKey && r.ctrlKey && (r.keyCode == 37 || r.keyCode == 39) ? (f.navigateThroghtShortcut(r.keyCode == 39), r.preventDefault(), r.stopPropagation()) : f && typeof f.keyDown == "function" && f.keyDown.call(f, r) } function kt(n) { n.ctrlKey || (k(!1), h = !1) } function k(n, t) { var e, r; if (n) l.css("display", "flex"); else { h && (r = u.find(".vis-current-nav-window"), ft(r)); return } h || (e = [], $.each(i, function (n, t) { t.img && t.img != "" || (t.img = "fa fa-list-alt"); var i = t.img; e.push("<div tabindex=" + n + ' data-wid="' + t.id + '" class="'); f.id == t.id && e.push("vis-current-nav-window "); e.push('vis-nav-window">'); e.push("<span>" + t.name + '<\/span><div class="vis-nav-content-wrap">'); i.indexOf(".") > -1 ? (i = i.replace("Thumb16x16", "Thumb140x120"), e.push('<img data-wid="' + t.id + '" class="vis-nav-window-img" src="' + i + '" alt="' + t.name + '"> <\/img>')) : e.push('<i data-wid="' + t.id + '" class="' + i + '"><\/i>'); e.push("<\/div><\/div>") }), u.append(e.join(" ")), h = !0); t ? (r = u.find(".vis-current-nav-window").next(), (!r || r.length <= 0) && (r = u.children().first())) : (r = u.find(".vis-current-nav-window").prev(), (!r || r.length <= 0) && (r = u.children().last())); u.find(".vis-current-nav-window").removeClass("vis-current-nav-window"); r.addClass("vis-current-nav-window").focus() } function ft(n) { f.id != n.data("wid") && (t.toggleContainer(n.data("wid")), t.activateTaskBarItemUsingID(n)); l.css("display", "none"); u.empty(); h = !1 } function dt(n) { var t = $(n.target); (t.hasClass("vis-nav-window") || t.hasClass("vis-nav-window-img")) && ft(t) } var d = "P", g = "R", v = "W", y = "X", p = "!", s = [], i = {}, e = [], h = !1, l = null, u = null, nt = null, w = !1, tt = 0, f = null; return wt(), { startAction: it, restoreActions: ct, resize: lt, sizeChanged: at, startWindow: rt, startForm: ut, startCFrame: ht, startActionInNewTab: vt, closeFrame: et } } function i(t) { var i, r; this.frame = new n.AWindow; this.frame.setName("Form"); this.onOpened = null; this.onClose = null; i = null; this.contentDispose = null; this.error = !1; this.windowNo = t || n.Env.getWindowNo(); this.hideH = !1; r = this; this.setContent = function (t) { t.getRoot && t.getRoot() || (n.Dialog.error("Error", !0, "class must define root element  and implement getRoot function"), t.dispose(), this.error = !0); t.sizeChanged || (t.sizeChanged = function () { }); t.refresh || (t.refresh = function () { }); t.dispose && (this.contentDispose = t.dispose, t.dispose = function () { r.dispose() }); i = t; this.frame.setCFrameContent(t, this.windowNo); this.hideH && this.frame.hideHeader(this.hideH) }; this.dispose = function () { this.disposing || (this.disposing = !0, this.contentDispose.call(i), this.frame && this.frame.dispose(), this.frame = null, this.onOpened = null, this.onClose = null, i = null, this.contentDispose = null, r = null) } } var t = n.desktopMgr, r = t.getMainConatiner(); i.prototype.setTitle = function (n) { this.frame.setTitle(n) }; i.prototype.getTitle = function () { return this.frame.getTitle() }; i.prototype.setName = function (n) { this.frame.setName(n) }; i.prototype.show = function () { if (this.error) { this.dispose(); return } n.viewManager.startCFrame(this.frame); this.onOpened && this.onOpened() }; i.prototype.hideHeader = function (n) { this.hideH = n; this.frame.cPanel && this.frame.hideHeader(n) }; n.viewManager = u(); n.CFrame = i }(VIS); VIS.context.m_map = {}; VIS.context.getContext = function (n) { if (n == null) throw new ArgumentException("Require Context"); if (arguments.length > 2) return typeof arguments[1] == "number" ? this.getWindowTabContext(arguments[0], arguments[1], arguments[2]) : this.getWindowContext(arguments[0], arguments[1], arguments[2]); if (arguments.length == 2) return this.getWindowContext(arguments[0], arguments[1]); var t = VIS.context.ctx[n]; return t ? t : n == "#VAF_UserContact_ID" ? VIS.context.getContext("#" + n) : n == "#VAF_UserContact_Name" ? VIS.context.getContext("#" + n) : "" }; VIS.context.getWindowContext = function (n, t, i, r) { var u, e, f; if (t == null) throw new ArgumentException("Require Context"); return typeof arguments[1] == "number" && arguments.length > 2 ? VIS.context.getTabRecordContext(arguments[0], arguments[1], arguments[2], r) : (u = "", typeof t == "number" && (u = "-" + t, t = i, i = r), e = n + u + "|" + t, u = "", typeof t == "number" && (u = "-" + t, t = i, i = r), e = n + u + "|" + t, f = "", this.m_map[n] && (f = this.m_map[n][e]), !f || f == "") ? t.startsWith("#") || t.startsWith("$") ? VIS.context.getContext(t) : i ? "" : VIS.context.getContext("#" + t) : f }; VIS.context.getWindowTabContext = function (n, t, i) { if (i == null) throw new ArgumentException("Require Context"); var r = ""; return (this.m_map[n] && (r = this.m_map[n][n + "|" + t + "|" + i]), !r || r == "") ? VIS.context.getWindowContext(n, i, !1) : r }; VIS.context.getTabRecordContext = function (n, t, i, r) { if (i == null) throw new ArgumentException("Require Context"); var u = ""; return (this.m_map[n] && (u = this.m_map[n][n + "-" + t + "|" + i]), !u || u == "") ? VIS.context.getWindowContext(n, i, r) : u }; VIS.context.setTabRecordContext = function (n, t, i, r) { i != null && (this.m_map[n] || (this.m_map[n] = {}), this.m_map[n][n + "-" + t + "|" + i] = r == null || r === "" ? null : r) }; VIS.context.setContext = function (n, t) { return arguments.length == 4 ? this.setWindowTabContext(arguments[0], arguments[1], arguments[2], arguments[3]) : arguments.length == 3 ? this.setWindowContext(arguments[0], arguments[1], arguments[2]) : VIS.context.ctx[n] = t, n }; VIS.context.setWindowContext = function (n, t, i, r) { if (t != null) { this.m_map[n] || (this.m_map[n] = {}); var u = ""; typeof t == "number" && (u = "-" + t, t = i, i = r); this.m_map[n][n + u + "|" + t] = i == null || i === "" ? null : i } }; VIS.context.setWindowTabContext = function (n, t, i, r) { i != null && (this.m_map[n] || (this.m_map[n] = {}), this.m_map[n][n + "|" + t + "|" + i] = r == null || String(r).equals("") ? null : r) }; VIS.context.clearTabContext = function (n, t) { var r = this.m_map[n], i; for (i in r) i.startsWith(n + "-" + t + "|") && delete r[i] }; VIS.context.getVAF_UserContact_ID = function () { return VIS.context.getContext("##VAF_UserContact_ID") }; VIS.context.getVAF_UserContact_Name = function () { return this.getContext("#VAF_UserContact_Name") }; VIS.context.getVAF_Role_ID = function () { return this.getContextAsInt("#VAF_Role_ID") }; VIS.context.getVAF_Role_Name = function () { return this.getContext("#VAF_Role_Name") }; VIS.context.getVAF_Client_ID = function () { return VIS.context.getContext("#VAF_Client_ID") }; VIS.context.getVAF_Client_Name = function () { return this.getContext("#VAF_Client_Name") }; VIS.context.getVAF_Org_ID = function () { return VIS.context.getContext("#VAF_Org_ID") }; VIS.context.getVAF_Language = function () { return VIS.context.getContext("#VAF_Language") }; VIS.context.setAutoCommit = function (n, t) { VIS.context.setWindowContext(n, "AutoCommit", t ? "Y" : "N") }; VIS.context.setAutoNew = function (n, t) { VIS.context.setWindowContext(n, "AutoNew", t ? "Y" : "N") }; VIS.context.isAutoNew = function () { var n = VIS.context.getContext("AutoNew"); return n != null && n === "Y" ? !0 : !1 }; VIS.context.getStdPrecision = function () { return VIS.context.getContext("#StdPrecision") }; VIS.context.setStdPrecision = function () { return VIS.context.getContext("#StdPrecision") }; VIS.context.getIsAutoNew = function (n) { var t = this.getWindowContext(n, "AutoNew", !1); return t != null && t != "" ? t.equals("Y") ? !0 : !1 : this.isAutoNew() }; VIS.context.isAutoCommit = function () { var n = VIS.context.getContext("AutoCommit"); return n != null && n === "Y" ? !0 : !1 }; VIS.context.setContextOfWindow = function (n, t) { if (n && t) { for (prop in n) VIS.context.setWindowContext(t, prop, n[prop]); n = null } }; VIS.context.getContextAsInt = function (n, t, i) { var r = ""; if (r = arguments.length > 1 && typeof arguments[1] == "number" ? this.getWindowTabContext(arguments[0], arguments[1], arguments[2]) : arguments.length > 1 && typeof arguments[0] == "number" ? this.getWindowContext(n, t, i) : this.getContext(arguments[0]), r.length == 0) return 0; try { return parseInt(r) } catch (u) { } return 0 }; VIS.context.getWindowContextAsInt = function (n, t, i) { var r = this.getWindowContext(n, t, i); if (r.length == 0) return 0; try { return parseInt(r) } catch (u) { } return 0 }; VIS.context.getContextAsTime = function (n, t) { var i = this.getContext(n, t, !1); return i == null || i.length == 0 ? Date.now().getTime() : new Date(i).getTime() }; VIS.context.getShowClientOrg = function () { return this.getContextAsInt("#ClientOrgLevel") }; VIS.context.removeWindow = function (n) { this.m_map[n] = null; delete this.m_map[n]; key = null }; VIS.context.getWindowCtx = function (n) { var t = {}; return $.extend(t, this.ctx), n && $.extend(t, this.m_map[n]), t }; VIS.context.getEntireCtx = function () { var n = {}, t; $.extend(n, this.ctx); for (t in this.m_map) this.m_map.hasOwnProperty(t) && $.extend(n, this.m_map[t]); return n }; VIS.context.isSOTrx = function (n) { var t = !1; return (t = n ? this.getWindowContext(n, "IsSOTrx", !0) : this.getContext("IsSOTrx"), t != null && t.equals("Y")) ? !0 : !1 }; VIS.context.setIsSOTrx = function () { arguments.length == 2 ? this.setContext(arguments[0], "IsSOTrx", arguments[1] ? "Y" : "N") : this.setContext("IsSOTrx", arguments[0] ? "Y" : "N") }; VIS.context.getIsUseCrystalReportViewer = function () { return VIS.context.getContext("#USE_CRYSTAL_REPORT_VIEWER") == "Y" }; VIS.Msg = {}; VIS.Msg.elements = {}; VIS.I18N.getLabel = function (n, t, i, r) { var u, f; if (!VIS.I18N.labels[n]) return i && r && VIS.I18N.getLabelFromServer(n, t, i, r), "[" + n + "]"; if (u = VIS.I18N.labels[n], t && t.length && t.length > 0) for (f = 0; f < t.length; f++)u = u.replace("%" + f, t[f]); return i && r && (Object.prototype.toString.call(i[r]) === "[object Function]" ? i[r](u) : i[r] = u), u }; VIS.I18N.getLabelFromServer = function (n) { return "UNDEFINED " + n }; VIS.Msg.getMsg = function (n, t, i) { if (!VIS.I18N.labels[n]) return "[" + n + "]"; label = VIS.Utility.Util.cleanMnemonic(VIS.I18N.labels[n]); var r = label.split("      "); return t || (label = r[0]), i && r.length > 1 && (label = r[1]), label }; VIS.Msg.parseTranslation = function (n, t) { var u; if (t == null || t.length == 0) return t; for (var i = t, e, f = "", r = i.indexOf("@"); r != -1;) { if (f += i.substring(0, r), i = i.substring(r + 1, i.length), u = i.indexOf("@"), u < 0) { i = "@" + i; break } e = i.substring(0, u); f += this.translate(n, e); i = i.substring(u + 1, i.length); r = i.indexOf("@") } return f + i }; VIS.Msg.translate = function (n, t, i) { if (t == null || t.length == 0) return t; if (i) { var r = null; if ($.ajax({ url: VIS.Application.contextUrl + "JsonData/GetTranslatedText", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ Columns: t, VAF_Language: VIS.Env.getVAF_Language(n) }) }).done(function (n) { r = n }), r) return JSON.parse(r); r } else return VIS.Msg.translate3(VIS.Env.getVAF_Language(n), n.isSOTrx(), t) }; VIS.Msg.getElement = function (n, t) { return VIS.Msg.getElement3(VIS.Env.getVAF_Language(n), t, !0) }; VIS.Msg.getElement1 = function (n) { return VIS.Msg.getElement3(VIS.Env.getVAF_Language(VIS.Env.getCtx()), n, !0) }; VIS.Msg.translate3 = function (n, t, i) { var u, r; return i == null || i.equals("") ? "" : (u = n, (u == null || u.length == 0) && (u = VIS.Env.getBaseVAF_Language()), r = VIS.Msg.getElement3(u, i, t), !r.equals("")) ? r.trim() : (r = VIS.Msg.getMsg(i), r && r.length > 0) ? r : i }; VIS.Msg.getElement3 = function (n, t, i) { function a(n, t, i) { var r = null; return $.ajax({ url: l, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: t, data: JSON.stringify(n) }).done(function (n) { r = n; i && i(n) }), r } var c = VIS.Application.contextUrl, l = c + "JsonData/JDataSetWithCode", h = function (n, t, i) { var f = i ? !0 : !1, u = { sql: n, page: 1, pageSize: 0 }, r; return t && (u.param = t), r = null, a(u, f, function (n) { r = (new VIS.DB.DataReader).toJson(n); i && i(r) }), r }, r, u, s; if (t == null || t.equals("")) return ""; if (r = n, (r == null || r.length == 0) && (r = VIS.Env.getBaseVAF_Language()), VIS.Msg.elements[t]) return VIS.Msg.elements[t]; var f = "", o = "", e = null; try { r == null || r.length == 0 || VIS.Env.isBaseLanguage(r, "VAF_ColumnDic") ? (o = "VIS_73", u = [], u[0] = new VIS.DB.SqlParam("@ColumnName", t.toUpper()), e = h(o, u)) : (o = "VIS_74", u = [], u[0] = new VIS.DB.SqlParam("@ColumnName", t.toUpper()), u[1] = new VIS.DB.SqlParam("@VAF_Language", r), e = h(o, u)); e.read() && (f = e.getString(0), i || (s = e.getString(1), s != null && s.length > 0 && (f = s))); e.close() } catch (v) { e.close() } return f != null && (f = f.trim()), VIS.Msg.elements[t] = f, f }; VIS.MRole.getDefault = function () { return VIS.MRole }; VIS.MRole.log = VIS.Logging.VLogger.getVLogger("MRole"); VIS.MRole.canUpdate = function (n, t, i, r, u) { var e = this.vo.UserLevel.trim(), f = !0, o = ""; return n == 0 && t == 0 && e.indexOf("S") == -1 ? (f = !1, o += "S") : n != 0 && t == 0 && e.indexOf("C") == -1 ? e.indexOf("O") == -1 && this.getIsOrgAccess(t, !0) || (f = !1, o += "C") : n != 0 && t != 0 && e.indexOf("O") == -1 && (f = !1, o += "O"), f && (f = this.getIsTableAccess(i, !1)), f && r != 0 && (f = this.getIsRecordAccess(i, r, !1)), !f && u && VIS.MRole.log.warning("AccessTableNoUpdate => VAF_Client_ID=" + n + ", VAF_Org_ID=" + t + ", UserLevel=" + e + " => missing=" + o), f }; VIS.MRole.getIsColumnAccess = function (n, t, i) { var u, f, r; if (!this.getIsTableAccess(n, i)) return !1; for (u = !0, f = this.vo.columnAccess, r = 0; r < f.length; r++)if (f[r].IsExclude) { if (f[r].VAF_TableView_ID == n && f[r].VAF_Column_ID == t && (u = i ? !1 : !f[r].IsReadOnly, !u)) return u } else if (f[r].VAF_TableView_ID == n && f[r].VAF_Column_ID == t && (u = i ? !0 : !f[r].IsReadOnly, !u)) return u; return !u, u }; VIS.MRole.getIsTableAccessLevel = function (n, t) { var i, r; return t ? !0 : (i = this.vo.tableAccessLevel[n], i == null) ? !1 : i.equals(VIS.Consts.ACCESSLEVEL_All) ? !0 : (r = this.vo.UserLevel.trim(), r.indexOf("S") != -1 && (i.equals(VIS.Consts.ACCESSLEVEL_SystemOnly) || i.equals(VIS.Consts.ACCESSLEVEL_SystemPlusClient))) ? !0 : r.indexOf("C") != -1 && (i.equals(VIS.Consts.ACCESSLEVEL_ClientOnly) || i.equals(VIS.Consts.ACCESSLEVEL_SystemPlusClient)) ? !0 : r.indexOf("O") != -1 && (i.equals(VIS.Consts.ACCESSLEVEL_Organization) || i.equals(VIS.Consts.ACCESSLEVEL_ClientPlusOrganization)) ? !0 : !1 }; VIS.MRole.canView = function (n) { var i = this.vo.UserLevel.trim(), t = !0; return (VIS.Consts.ACCESSLEVEL_All.equals(n) ? t = !0 : VIS.Consts.ACCESSLEVEL_SystemOnly.equals(n) && i.indexOf("S") == -1 ? t = !1 : VIS.Consts.ACCESSLEVEL_ClientOnly.equals(n) && i.indexOf("C") == -1 ? t = !1 : VIS.Consts.ACCESSLEVEL_Organization.equals(n) && i.indexOf("O") == -1 ? t = !1 : !VIS.Consts.ACCESSLEVEL_ClientPlusOrganization.equals(n) || i.indexOf("C") != -1 || i.indexOf("O") != -1 ? !VIS.Consts.ACCESSLEVEL_SystemPlusClient.equals(n) || i.indexOf("S") != -1 || i.indexOf("C") != -1 || (t = !1) : t = !1, t) ? t : (VIS.MRole.log.warning("AccessTableNoView", "Required=" + n + "() != UserLevel=" + i), t) }; VIS.MRole.getIsTableAccess = function (n, t) { var u, i, r; if (!this.getIsTableAccessLevel(n, t)) return !1; for (u = !0, i = this.vo.tableAccess, r = 0; r < i.length; r++)if (VIS.Consts.ACCESSTYPERULE_Accessing.equals(i[r].AccessTypeRule)) if (i[r].IsExclude) { if (i[r].VAF_TableView_ID === n) return t ? i[r].IsReadOnly : !1 } else if (u = !1, i[r].VAF_TableView_ID == n) return t ? !0 : !i[r].IsReadOnly; return !u, i = null, u }; VIS.MRole.getIsCanReport = function (n) { var r, t, i; if (!this.vo.IsCanReport || !this.getIsTableAccess(n, !0)) return !1; for (r = !0, t = this.vo.tableAccess, i = 0; i < t.length; i++)if (VIS.Consts.ACCESSTYPERULE_Reporting.equals(t[i].AccessTypeRule)) if (t[i].IsExclude) { if (t[i].VAF_TableView_ID === n) return t[i].IsCanReport } else if (r = !1, t[i].VAF_TableView_ID === n) return t[i].IsCanReport; return t = null, r }; VIS.MRole.getIsCanExport = function (n) { var r, t, i; if (!this.vo.IsCanExport || !this.getIsTableAccess(n, !0) || !this.getIsCanReport(n)) return !1; for (r = !0, t = this.vo.tableAccess, i = 0; i < t.length; i++)if (VIS.Consts.ACCESSTYPERULE_Exporting.equals(t[i].AccessTypeRule)) if (t[i].IsExclude) { if (t[i].VAF_TableView_ID === n) return t[i].IsCanExport } else if (r = !1, t[i].VAF_TableView_ID === n) return t[i].IsCanExport; return t = null, r }; VIS.MRole.getIsOrgAccess = function (n, t) { var i, r; if (this.vo.IsAccessAllOrgs || n == 0 && !t) return !0; for (i = this.vo.orgAccess, r = 0; r < i.length; r++)if (i[r].VAF_Org_ID === n) return t ? i[r].readOnly ? !1 : !0 : !0; return i = null, !1 }; VIS.MRole.getIsRecordAccess = function (n, t, i) { for (var e = !0, u = this.vo.recordAccess, r = null, f = 0; f < u.length; f++)if (r = u[f], r.VAF_TableView_ID === n) if (r.IsExclude) { if (r.Record_ID === t) return u = null, i ? r.IsReadOnly : !1 } else if (e = !1, r.Record_ID === t) return u = null, i ? !0 : !r.IsReadOnly; return e }; VIS.MRole.getClientWhere = function (n) { var t, r, u, i, e, f; if (this.vo.IsAccessAllOrgs) return n || this.vo.VAF_Client_ID == 0 ? "VAF_Client_ID=" + this.vo.VAF_Client_ID : "VAF_Client_ID IN (0," + this.vo.VAF_Client_ID + ")"; for (t = [], n || t.push("0"), r = 0; r < this.vo.orgAccess.length; r++)u = this.vo.orgAccess[r].VAF_Client_ID.toString(), t.indexOf(u) < 0 && t.push(u), u = null; for (i = new StringBuilder, e = !0, f = 0; f < t.length; f++)i.length() > 0 && (i.append(","), e = !1), i.append(t[f]); return (t = null, e) ? i.length() > 0 ? "VAF_Client_ID=" + i.toString() : (this.log.log(VIS.Logging.Level.SEVERE, "No Access Org records"), "VAF_Client_ID=-1") : "VAF_Client_ID IN(" + i.toString() + ")" }; VIS.MRole.getOrgWhere = function (n, t) { var i, f, e, r, s; if (this.vo.IsAccessAllOrgs) return null; for (i = [], t || i.push("0"), f = this.vo.orgAccess, e = 0; e < f.length; e++)r = f[e].VAF_Org_ID.toString(), t ? r.readOnly || i.indexOf(r) < 0 && i.push(r) : i.indexOf(r) < 0 && i.push(r); if (f = null, i.length == 1) return "COALESCE(" + (n == null ? "" : n + ".") + "VAF_Org_ID,0)=" + i[0]; if (i.length == 0) return this.log.log(VIS.Logging.Level.SEVERE, "No Access Org records"), (n == null ? "" : n + ".") + "VAF_Org_ID=-1"; var o = new StringBuilder, u = new StringBuilder, h = 0; for (s = 0; s < i.length; s++)u.length() > 0 && u.append(","), u.append(i[s]), h++, (h % 999 == 0 || h == i.length) && (o.length() > 0 && o.append(" OR "), o.append("COALESCE(" + (n == null ? "" : n + ".") + "VAF_Org_ID,0) IN(").append(u.toString()).append(")"), u = null, u = new StringBuilder); return "(" + o.toString() + ")" }; VIS.MRole.getVAF_TableView_ID = function (n) { var t = this.vo.tableName[n]; return t != null ? t : 0 }; VIS.MRole.getSynonym = function (n) { var t = this.columnSynonym[n]; return t ? t : null }; VIS.MRole.getKeyColumnName = function (n, t) { var u = this.getSynonym(t), i, r; if (u == null) return t; for (i = 0; i < n.length; i++)if (r = n[i], t.equals("VAF_UserContact_ID")) { if (r.getTableName().equals("VAF_UserContact")) return t } else if (t.equals("VAF_ColumnDicValue_ID") && r.getTableName().equals("VAF_ColumnDicValue")) return t; return u }; VIS.MRole.getDependentAccess = function (n, t, i) { var r, u; if (t.length == 0 && i.length == 0) return ""; if (t.length != 0 && i.length != 0 && this.log.warning("Mixing Include and Excluse rules - Will not return values"), r = new StringBuilder(" AND "), t.length == 1) r.append(n).append("=").append(t[0]); else if (t.length > 1) { for (r.append(n).append(" IN ("), u = 0; u < t.length; u++)u > 0 && r.append(","), r.append(t[u]); r.append(")") } else if (i.length == 1) r.append(n).append("<>").append(i[0]); else if (i.length > 1) { for (r.append(n).append(" NOT IN ("), u = 0; u < i.length; u++)u > 0 && r.append(","), r.append(i[u]); r.append(")") } return r.toString() }; VIS.MRole.getDependentRecordWhereColumn = function (n, t) { var f = t, e = n.indexOf(t), u = e - 1, i = n.charAt(u), r; if (i == ".") { for (r = new StringBuilder; i != " " && i != "," && i != "(";)r.insert(0, i), i = n.charAt(--u); return r.append(t), r.toString() } return f }; VIS.MRole.getRecordWhere = function (n, t, i) { for (var e = new StringBuilder, o = new StringBuilder, f = this.vo.recordAccess, r, s, u = 0; u < f.length; u++)f[u].VAF_TableView_ID == n && (f[u].IsExclude ? (o.length() == 0 ? o.append(t).append(" NOT IN (") : o.append(","), o.append(f[u].Record_ID)) : i && f[u].IsReadOnly || (e.length() == 0 ? e.append(t).append(" IN (") : e.append(","), e.append(f[u].Record_ID))); return r = new StringBuilder, o.length() > 0 && r.append(o).append(")"), e.length() > 0 && (r.length() > 0 && r.append(" AND "), r.append(e).append(")")), this.vo.IsPersonalAccess || !this.vo.tableData[n].IsView && this.vo.tableData[n].HasKey && (s = " NOT IN ( SELECT Record_ID FROM VAF_Private_Rights WHERE VAF_TableView_ID = " + n + " AND VAF_UserContact_ID <> " + this.vo.VAF_UserContact_ID + " AND IsActive = 'Y' )", r.length() > 0 && r.append(" AND "), r.append(t).append(s)), f = null, r.toString() }; VIS.MRole.getDocWhere = function (n) { function s(n, t, i) { var r = null; return $.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: t, data: JSON.stringify(n) }).done(function (n) { r = n; i && i(n) }), r } var f = VIS.Application.contextUrl, e = f + "JsonData/JDataSetWithCode", o = function (n, t, i) { var u = i ? !0 : !1, f = { sql: n, page: 1, pageSize: 0 }, r = null; return s(f, u, function (n) { t = (new VIS.DB.DataSet).toJson(n); var t = (new VIS.DB.DataSet).toJson(n); r = t.getTable(0).getRows().length > 0 ? t.getTable(0).getRow(0).getCell(0) : null; t.dispose(); t = null; u && i(r) }), r }, t, u; if (!this.vo.IsUseBPRestrictions) return ""; var i = !1, r = []; return (r[0] = new VIS.DB.SqlParam("@TableName", n), t = o("VIS_101", r), i = (t ? parseInt(t) : 0) != 0, !i) ? "" : (u = VIS.context.getVAF_UserContact_ID(), $.ajax({ type: "Get", async: !1, url: VIS.Application.contextUrl + "Form/GetDocWhere", data: { VAF_UserContact_ID: u, TableName: n }, success: function (n) { docAccess = n }, error: function (n) { console.log(n) } }), docAccess) }; VIS.MRole.addAccessSQL = function (n, t, r, u, f) { var a, h, o, d, ut, s, b, p, k, v, g, w, y, tt, l, st, it; r && VIS.Utility.Util.isEmpty(t) && (r = !1); var e = new StringBuilder, ot = "", rt = n.lastIndexOf(" ORDER BY "); for (rt != -1 ? (ot = n.substring(rt), e.append(n.substring(0, rt))) : e.append(n), a = new VIS.AccessSqlParser(e.toString()), h = a.getTableInfo(a.getMainSqlIndex()), a.getMainSql().indexOf(" WHERE ") == -1 ? e.append(" WHERE ") : e.append(" AND "), o = "", h.length > 0 && (h[0].getTableName().equals(t) || h[0].getSynonym().equals(t)) && (o = h[0].getSynonym(), VIS.Utility.Util.isEmpty(o) && (o = h[0].getTableName())), !VIS.Utility.Util.isEmpty(t) && VIS.Utility.Util.isEmpty(o) && (d = "TableName not correctly parsed - TableNameIn=" + t + " - " + a, h.length > 0 && (d += " - #1 " + h[0]), d += "\n = " + n, this.log.log(VIS.Logging.Level.SEVERE, d), o = t), r && !VIS.Utility.Util.isEmpty(o) && e.append(o).append("."), e.append(this.getClientWhere(u)), this.vo.IsAccessAllOrgs || f || (e.append(" AND "), r && !VIS.Utility.Util.isEmpty(o) ? e.append(this.getOrgWhere(o, u)) : e.append(this.getOrgWhere(null, u))), this.vo.IsUseBPRestrictions && (ut = this.getDocWhere(o), ut.length() > 0 && (e.append(" AND "), e.append(ut))), s = 0, i = 0; i < h.length; i++) { if (b = h[i], p = b.getTableName(), s = this.getVAF_TableView_ID(p), s != 0 && !this.vo.IsAccessAllOrgs && f && (k = b.getSynonym(), (k == null || k.isEmpty()) && (k = p), e.append(" AND "), e.append(this.getOrgWhere(k, u))), s != 0 && !this.getIsTableAccess(s, !u)) { e.append(" AND 1=3"); this.log.fine("No access to VAF_TableView_ID=" + s + " - " + p + " - " + e); break } v = ""; r && (v = b.getSynonym(), v.length == 0 && (v = p), v += "."); v += p + "_ID"; g = this.getRecordWhere(s, v, u); g.length > 0 && (e.append(" AND ").append(g), this.log.finest("Record access - " + g)) } b = null; w = a.getMainSql(); s = 0; var nt = null, ft = [], et = [], c = this.vo.recordDependentAccess; for (i = 0; i < c.length; i++)(y = this.getKeyColumnName(a.getTableInfo(a.getMainSqlIndex()), c[i].KeyColumnName), y != null) && (tt = w.indexOf(y), tt != -1) && (l = w.charAt(tt - 1), l == "," || l == "." || l == " " || l == "(") && (l = w.charAt(tt + y.length), l == "," || l == " " || l == ")") && (s != 0 && s != c[i].VAF_TableView_ID && e.append(this.getDependentAccess(nt, ft, et)), s = c[i].VAF_TableView_ID, c[i].IsExclude ? (et.push(c[i].Record_ID), this.log.fine("Exclude " + y + " - " + c[i])) : u && c[i].IsReadOnly || ft.push(c[i].Record_ID), st = null, st != null ? (it = "", nt = it == null || it.length() == 0 ? this.getDependentRecordWhereColumn(w, y) : it) : nt = this.getDependentRecordWhereColumn(w, y)); return e.append(this.getDependentAccess(nt, ft, et)), e.append(ot), e.toString() }; VIS.MRole.getWindowAccess = function (n) { return this.vo.windowAccess[n] ? !0 : !1 }; VIS.MRole.getFormAccess = function (n) { return this.vo.formAccess[n] ? !0 : !1 }; VIS.MRole.getProcessAccess = function (n) { return this.vo.processAccess[n] ? !0 : !1 }; VIS.MRole.getIsClientAccess = function (n, t) { var r, i; if (n == 0 && !t) return !0; for (r = this.vo.orgAccess, i = 0; i < r.length; i++)if (r[i].VAF_Client_ID == n && (!t || !r[i].readOnly)) return !0; return !1 }; VIS.MRole.getIsShowPreference = function () { return this.vo.IsShowPreference }; VIS.MRole.getName = function () { return this.vo.Name }; VIS.MRole.getPreferenceType = function () { return this.vo.PreferenceType }; VIS.MRole.getIsDisplayClient = function () { return this.vo.IsDisplayClient }; VIS.MRole.getIsDisplayOrg = function () { return this.vo.IsDisplayOrg }; VIS.MRole.getIsPersonalLock = function () { return this.vo.IsPersonalLock }; VIS.MRole.getMaxQueryRecords = function () { return this.vo.MaxQueryRecords }; VIS.MRole.getIsQueryMax = function (n) { var t = this.getMaxQueryRecords(); return t > 0 && n > t }; VIS.MRole.getIsShowAcct = function () { return this.vo.IsShowAcct }; VIS.MRole.getIsOverwritePriceLimit = function () { return this.vo.IsOverwritePriceLimit }; VIS.MRole.getIsOverrideReturnPolicy = function () { return this.vo.IsOverrideReturnPolicy }; VIS.MRole.getIsDisableMenu = function () { return this.vo.IsDisableMenu }; VIS.MRole.getHomePage = function () { return this.vo.HomePage }; VIS.MRole.toStringX = function (n) { var t = new StringBuilder; return t.append(VIS.Msg.translate(n, "VAF_Role_ID")).append("=").append(this.getName()).append(" - ").append(VIS.Msg.translate(n, "IsCanExport")).append("=").append(this.getIsCanExport()).append(" - ").append(VIS.Msg.translate(n, "IsCanReport")).append("=").append(this.getIsCanReport()).append(VIS.Env.NL).append(VIS.Env.NL), t.toString() }, function (n, t) { function r() { function w(n) { if (n) window.setTimeout(function () { c.focus(); u.on("keydown", function (n) { if (n.keyCode == 9) l.is(":focus") ? c.focus() : c.is(":focus") ? l.focus() : c.focus(), n.preventDefault(), n.stopPropagation(); else if (n.keyCode == 27) return n.preventDefault(), n.stopPropagation(), k(n), !1 }) }, 100); else { u.focus(); u.on("keydown", function (n) { return n.preventDefault(), n.stopPropagation(), k(n), !1 }) } } function k(n) { n.stopPropagation(); f && f(); f = null; b() } function b() { a.hide(); u.css({ position: "inherit", display: "none" }); r.find(".vis-Dialog-buttons").css("display", "none"); l && l.off("click"); c && c.off("click"); u.off("keydown") } function g(t, i, c) { f = c; try { } catch (l) { } u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/info-icon.png"); _prodFound = !0; p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Info")); a.show(); r.fadeIn(300); w(!1) } function nt(t, i, v) { f = v; try { } catch (d) { } u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info vis-PopupContent-alert-Confirm"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/confirm-icon.png"); var k = r.find(".vis-Dialog-buttons"); k.css("display", "inherit"); l = k.find(".vis-Dialog-buttons-OK"); c = k.find(".vis-Dialog-buttons-Cancel"); _prodFound = !0; p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Confirm")); a.show(); r.fadeIn(300); l.one("click", function () { b(); k.css("display", "none"); f(!0) }); c.one("click", function () { b(); k.css("display", "none"); f(!1) }); w(!0) } function tt(t, i, k, d) { f = d; try { } catch (nt) { } u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info vis-PopupContent-alert-Confirm"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/confirm-icon.png"); var g = r.find(".vis-Dialog-buttons"); g.css("display", "inherit"); l = g.find(".vis-Dialog-buttons-OK"); c = g.find(".vis-Dialog-buttons-Cancel"); _prodFound = !0; p.text(t); v.empty(); v.css("display", "block"); v.append(k); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Confirm")); a.show(); r.fadeIn(300); l.one("click", function () { b(); g.css("display", "none"); v.css("display", "none"); v.empty(); f(!0) }); c.one("click", function () { b(); g.css("display", "none"); v.css("display", "none"); v.empty(); f(!1) }); w(!0) } function it(t, i, c) { f = c; try { } catch (l) { } _prodFound = !0; u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-warn"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-warn"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-warn"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/warning-icon.png"); p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Warning")); a.show(); w(!1) } function rt(t, i, c) { f = c; try { } catch (l) { } _prodFound = !0; u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-error"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-error"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-error"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/error-icon.png"); p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Error")); a.show(); r.fadeIn(300); w(!1) } var a = t('<div id="overlayMsgDialog" class="web_dialog_overlay"><\/div>'), u = t('<div class="vis-PopupWrap-alertmain" tabIndex=1>'), r = t('<div id="VAPOS_ErrorInfo" class="vis-PopupWrap-alert"><input class="vis-Dialog-buttons-text" type="number"  tabindex="-30" style="z-index:-44;position:absolute"  autofocus="autofocus"  >        <div class="vis-popup-headerContainer">                                                  <div class="vis-PopupHeader-alert">           <h4 id="VAPOS_CLInformation">Information<\/h4>           <span id="btnCloseInfo" class="fa fa-times"><\/span>                            <\/div>  <\/div>                                                                                          <div class="vis-PopupContent-alert">                                                                    <div class="form-group vis-PopupInput-alert" style="width: 100%">                                <img class="vis-alert-img" style="float:left"  />                                                                      <label style="width: 90%;padding-left: 10px;word-break: break-word" id="VAPOS_lblErrorInfo"><\/label>                                   <div class="vis-confirm-customUI" style="display:none"> <\/div>                        <\/div>                                                                                                <div class="vis-Dialog-buttons" style="display:none">                                           <input class="vis-Dialog-buttons-OK " type="button" value="' + n.Msg.getMsg("OK") + '" > <input  class="vis-Dialog-buttons-Cancel"  type="button" value="' + n.Msg.getMsg("Cancel") + '" >                                               <\/div>                                                                                                                                                  <\/div>                                                                                      <\/div>'); u.append(r); i.append(a).append(u); var e = r.find(".vis-PopupHeader-alert"), o = r.find(".vis-popup-headerContainer"), d = r.find("#btnCloseInfo"), s = r.find("#VAPOS_CLInformation"), y = r.find(".vis-alert-img"), h = r.find(".vis-PopupContent-alert"), p = r.find("#VAPOS_lblErrorInfo"), v = r.find(".vis-confirm-customUI"), ut = r.find("#VAPOS_busyInd"), l = null, c = null, f = null; d.on("click", function (n) { k(n) }); return { info: g, ask: nt, error: rt, warn: it, askCustomUI: tt } } var i = t("body"), u = t("#vis_buzzer"); n.ADialog = { info: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); r != null && r.length > 0 && (f += "\n" + r); n.ADialogUI.info(f, u); f = null }, ask: function (t, i, r) { var u = "", f; return t == null || t.equals("") || (u += n.Msg.getMsg(t)), r != null && r.length > 0 && (u += "\n" + r), f = !1, confirm(u) && (f = !0), f }, error: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); r != null && r.length > 0 && (f += "\n" + r); n.ADialogUI.error(f, u); f = null }, warn: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); r != null && r.length > 0 && (f += "\n" + r); n.ADialogUI.warn(f, u); f = null }, confirm: function (t, i, r, u, f) { var e = "", o; return t == null || t.equals("") || (e += n.Msg.getMsg(t)), r != null && r.length > 0 && (e += "\n" + r), o = !1, n.ADialogUI.ask(e, u, f), o }, confirmCustomUI: function (t, i, r, u, f, e) { var o = "", s; return t == null || t.equals("") || (o += n.Msg.getMsg(t)), r != null && r.length > 0 && (o += "\n" + r), s = !1, n.ADialogUI.askCustomUI(o, u, f, e), s } }; n.ADialogUI = r() }(VIS, jQuery), function (n, t) { function k(n, i, r) { var u = null; return t.ajax({ url: d, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function w(i, r, u) { var f = null; return i.sql = n.secureEngine.encrypt(i.sql), t.ajax({ url: g, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: r, data: JSON.stringify(i) }).done(function (n) { f = n; u && u(n) }), f } function i(n, t, i, r, u) { this.info = n; this.lookup = null; this.allLoaded = !1; this.hasInactive = !1; this.displayType = u; this.selectedObject; this.windowNo = r; this.validationDisabled = !1; this.tabNo = 0; this.colName = ""; this.data = []; this.ctx = i; t && (this.lookup = t._lookup, this.allLoaded = t._allLoaded, this.hasInactive = t._hasInactive, this.displayType = t._displayType, this.windowNo = t._WindowNo, this.tabNo = t._TabNo, this.colName = t._columnName, this.info && (this.info.windowNo = t._WindowNo)) } function r(t, r) { i.call(this, t, r); this.lookupDirect = {}; this.directNullKey; this.loading = !1; this.nextRead = 0; this.cLookup = !1; this.lookupDirectAll = {}; this.zomQuery = null; this.prepareZQuery(); this.log = n.Logging.VLogger.getVLogger("MLookup") } function f(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.lookup = {}; this.load() } function u(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.C_Locator_ID = 0; this.onlyWarehouseID = 0; this.onlyProductID = 0; this.onlyOutgoing = !1; this.lookup = {}; this.maxRows = 1e4; this.defaultID = ""; this.log = n.Logging.VLogger.getVLogger("MLocatorLookup"); this.load(!1); this.disposeLocal = function () { this.lookup = null; this.log = null } } function s(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.log = n.Logging.VLogger.getVLogger("MAccountLookup"); this.VAB_Acct_ValidParameter_ID = 0; this.combination; this.description } function a(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.NO_INSTANCE = { Key: 0, Name: "" }; this.log = n.Logging.VLogger.getVLogger("MPAttributeLookup") } function c(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.NO_INSTANCE = { Key: 0, Name: "" }; this.log = n.Logging.VLogger.getVLogger("MGAttributeLookup") } function h(t, r) { i.call(this, null, null, t, r, n.DisplayType.AmtDimension); this.lookup = {} } function l(t, r) { i.call(this, null, null, t, r, n.DisplayType.ProductContainer); this.log = n.Logging.VLogger.getVLogger("MProductContainerLookup"); this.lookup = {} } var v = n.DB, e = n.Logging.Level, y = n.Application.contextUrl, d = y + "JsonData/JDataSetWithCode", g = y + "Form/JDataSet", nt = y + "JsonData/ExecuteNonQuer", o = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, k(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, tt = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, k(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, it = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, w(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, p = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, w(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, b = function (t, i, r, u, f) { var s = f ? !0 : !1, o = { sql: t, page: i, pageSize: r }, e; return u && (o.param = u), e = null, w(o, s, function (t) { e = (new n.DB.DataReader).toJson(t); f && f(e) }), e }; i.prototype.INACTIVE_S = "~"; i.prototype.INACTIVE_E = "~"; i.prototype.MAX_ROWS = 1e4; i.prototype.MINUS_ONE = -1; i.prototype.getValidation = function () { return "" }; i.prototype.getWindowNo = function () { return this.windowNo }; i.prototype.getTabNo = function () { return this.tabNo }; i.prototype.getFieldColName = function () { return this.colName }; i.prototype.getDisplayType = function () { return this.displayType }; i.prototype.setDisplayType = function (n) { this.displayType = n }; i.prototype.disableValidation = function () { this.validationDisabled = !0 }; i.prototype.getIsValidationDisabled = function () { return this.validationDisabled }; i.prototype.getIsValidated = function () { return !0 }; i.prototype.getHasInactive = function () { return this.hasInactive }; i.prototype.getData = function () { return [] }; i.prototype.getDisplay = function () { return "" }; i.prototype.getSelectedItem = function () { return this.selectedObject }; i.prototype.fillCombobox = function (n, t, i, r) { var u = this.selectedObject, f; this.data != null && (this.data.length = 0); this.data = this.getData(n, t, i, r); f = 0; this.data != null && (f = this.data.length); u != this.selectedObject && (u = this.selectedObject); u == null && n && f > 0 && (u = this.data[0], this.selectedObject = u) }; i.prototype.setSelectedItem = function (n) { (this.selectedObject != null && this.selectedObject !== n || this.selectedObject == null && n != null) && this.setSelectedItemAlways(n) }; i.prototype.setSelectedItemAlways = function (n) { this.selectedObject = this.data.indexOf(n) > -1 || n == null ? n : null }; i.prototype.refresh = function () { return 0 }; i.prototype.getZoomQuery = function () { return null }; i.prototype.getColumnName = function () { return this.info.keyColumn }; i.prototype.dispose = function () { this.info = null; this.lookup = null; this.allLoaded = null; this._hasInactive = null; this.selectedObject = null; this.data = null; this.ctx = null }; i.prototype.removeAllElements = function () { this.data.length > 0 && (this.data.length = 0, this.selectedObject = null) }; i.prototype.clear = function () { this.removeAllElements() }; n.Utility.inheritPrototype(r, i); r.prototype.prepareZQuery = function () { var r, f, u, i; if (this.info.zoomQuery != null && !t.isEmptyObject(this.info.zoomQuery)) for (r = this.info.zoomQuery, this.zomQuery = new n.Query(r._tableName), f = null, u = 0; u < r._list.length; u++)i = r._list[u], f = new n.QueryRestriction(i.ColumnName, i.Code, i.Code_to, i.InfoName, r.InfoDisplay, i.InfoDisplay_to, i.Operator, i.DirectWhereClause, i.AndCondition), this.zomQuery.addRestriction(f) }; r.prototype.initialize = function (n) { return n ? this : this.info.isCreadedUpdatedBy ? this : this.info.isParent || this.info.isKey ? (this.hasInactive = !0, this) : (this.info.isValidated ? this.load(!0, !0) : this.fillDirectList(), this) }; r.prototype.getValidation = function () { return this.getIsValidationDisabled() ? "" : this.info.validationCode }; r.prototype.getIsValidated = function () { return this.getIsValidationDisabled() ? !0 : this.info == null ? !1 : this.info.isValidated }; r.prototype.getData = function (n, t, i, r) { var u = this.getData2(t, r), f, o, e, s; if (i && this.hasInactive) for (f = u.length; f > 0; f--)o = u[f - 1], o != null && (e = o.Name, e.startsWith(this.INACTIVE_S) && e.endsWith(this.INACTIVE_E) && (console.log(e), u.splice(f - 1, 1))); return n || (s = null, s = this.info.keyColumn != null && this.info.keyColumn.toUpperCase().endsWith("_ID") ? { Key: -1, Name: "" } : { Key: "", Name: "" }, u.unshift(s)), u }; r.prototype.getData2 = function (n, i) { return ((!this.allLoaded || t.isEmptyObject(this.lookup)) && this.refresh(i), this.info.isValidated) ? this.getObjectArray(this.lookup) : (!this.info.isValidated && n && this.refresh(i), this.getObjectArray(this.lookup)) }; r.prototype.getObjectArray = function (n) { var t = [], r = 0, i; for (i in n) t[r++] = n[i]; return t }; r.prototype.getDisplay = function (n, t) { if (n == null) return ""; var i = t ? this.getFromList(n) : this.get(n); return i == null ? "<" + n.toString() + ">" : i.Name }; r.prototype.get = function (i) { var r, u; return i == null || this.MINUS_ONE === i ? null : (this.info.isParent && this.nextRead < Date.now() && (this.lookup = null, this.lookup = {}, this.lookupDirect && (this.lookupDirect = null, this.lookupDirect = {}), this.nextRead = Date.now() + 500), r = this.lookup[" " + i], r) ? r : (!this.info.isParent && this.info.isValidated && this.allLoaded && this.getDirect(i, !1, !0), !this.allLoaded && t.isEmptyObject(this.lookup) && !this.info.isCreadedUpdatedBy && !this.info.isParent && this.getDisplayType() != n.DisplayType.Search && (this.load(), r = this.lookup[" " + i], r != null)) ? r : (u = this.info.isValidated, this.getDirect(i, !1, u)) }; r.prototype.getFromList = function (i) { var r, u; return i == null || this.MINUS_ONE === i ? null : this.info.isParent && this.nextRead < Date.now() ? (this.lookup = null, this.lookup = {}, this.lookupDirect && (this.lookupDirect = null, this.lookupDirect = {}), this.nextRead = Date.now() + 500, this.get(i)) : (r = this.lookup[" " + i], r != null) ? r : (!this.info.isParent && this.info.isValidated && this.allLoaded && this.getDirectFromList(i, !1, !0), !this.allLoaded && t.isEmptyObject(this.lookup) && !this.info.isCreadedUpdatedBy && !this.info.isParent && this.getDisplayType() != n.DisplayType.Search && (r = this.lookup[" " + i], r != null)) ? r : (u = this.info.isValidated, this.getDirectFromList(i, !1, u)) }; r.prototype.getDirect = function (t, i, r) { var u, s, h, o, f, e, w, c, l, a, y; if (t == null || this.info.queryDirect == null || this.info.queryDirect.length == 0 || t === this.directNullKey) return null; if (u = null, this.lookupDirect != null && (u = this.lookupDirect[t], u)) return u; s = this.info.keyColumn.toUpperCase().endsWith("_ID"); try { h = this.info.queryDirect; o = []; s ? o.push(new v.SqlParam("@key", parseInt(t))) : o.push(new v.SqlParam("@key", t.toString())); f = p(h, o); f.read() ? (e = f.getString(2), w = f.getString(3).equals("Y"), w || (e = this.INACTIVE_S + e + this.INACTIVE_E, this.hasInactive = !0), s ? (c = f.getInt(0), l = { Key: c, Name: n.Utility.encodeText(e) }, i && (this.lookup[" " + c] = l), u = l) : (a = f.getString(1), y = { Key: a, Name: n.Utility.encodeText(e) }, i && (this.lookup[" " + a] = y), u = y), f.read() && this.log.log(n.Logging.Level.SEVERE, this.info.keyColumn + ": Not unique (first returned) for " + t + " SQL=" + h)) : (this.directNullKey = t, u = null) } catch (b) { this.log.log(n.Logging.Level.SEVERE, this.info.keyColumn + ": SQL=" + this.info.queryDirect + "; Key=" + t, b); u = null } finally { f != null && f.dispose(); f = null } return r && !i && u != null && (this.lookupDirect == null && (this.lookupDirect = {}), this.lookupDirect[t] = u), this.hasInactive = !0, u }; r.prototype.getDirectFromList = function (t, i, r) { var u, f, e, s, o; return t == null || this.info.queryDirect == null || this.info.queryDirect.length == 0 ? null : t === this.directNullKey ? null : (u = null, this.lookupDirect != null && (f = null, f = this.lookupDirect[" " + t], f && f != null)) ? f : (this.lookupDirectAll[" " + t] || (s = this.getFieldColName(), o = n.MLookupCache.getRecordLookup(this.getWindowNo(), this.getTabNo(), s, t), o && (retValue = { Key: t, Name: n.Utility.encodeText(o) }, this.lookupDirectAll[" " + t] = retValue)), this.lookupDirectAll[" " + t] ? (e = this.lookupDirectAll[" " + t], i && (this.lookup[" " + t] = e), u = e) : this.loading || (this.addInList(t), u = null), r && !i && u != null && (this.lookupDirect == null && (this.lookupDirect = {}), this.lookupDirect[" " + t] = u), this.hasInactive = !0, u) }; r.prototype.addInList = function (t) { var f, i; if (!(this.info.queryDirect.length <= 0) && t != null) { var u = this.info.keyColumn.toUpperCase().endsWith("_ID"), e = this.info.queryDirect, r = []; u ? r.push(new v.SqlParam("@key", parseInt(t))) : r.push(new v.SqlParam("@key", t.toString())); f = this.info.queryDirect; i = this; p(f, r, function (r) { var f, e, o; try { r.read() ? (f = r.getString(2), u ? (e = n.Utility.Util.getValueOfInt(r.getCell(0)), i.lookupDirectAll[" " + e] = { Key: e, Name: n.Utility.encodeText(f) }) : (o = r.getString(1), i.lookupDirectAll[" " + o] = { Key: o, Name: n.Utility.encodeText(f) })) : i.directNullKey = t } catch (s) { console.log(s) } i = null }) } }; r.prototype.load = function (t, i) { var r = this.info.query, e, s, f, u; if (!this.info.isValidated) { if (e = n.Env.parseContext(n.context, this.getWindowNo(), this.getTabNo(), this.info.validationCode, !1, !0), e.length == 0 && this.info.validationCode.length > 0) { this.log.fine(this.info.keyColumn + ": Loader NOT Validated: " + this.info.validationCode); return } var c = r.lastIndexOf(" FROM "), h = r.indexOf(" WHERE ", c) != -1, o = r.lastIndexOf(" ORDER BY "); o != -1 ? r = r.substring(0, o) + (h ? " AND " : " WHERE ") + e + r.substring(o) : r += (h ? " AND " : " WHERE ") + e; this.log.fine(this.info.keyColumn + ": Validation=" + e) } if (s = this.info.keyColumn.toUpperCase().endsWith("_ID"), this.hasInactive = !1, f = null, this.lookup = {}, i && (this.cLookup = !1, n.MLookupCache.loadFromCache(this.info, this))) return this; if (t) return u = this, u.loading = !0, b(r, 1, 1e3, null, function (t) { u.readData(t, s); i && n.MLookupCache.loadEnd(u.info, u); u.loading = !1; u = null }), 0; try { f = p(r, null); this.readData(f, s); i && n.MLookupCache.loadEnd(this.info, this) } catch (l) { this.log.log(n.Logging.Level.SEVERE, this.info.keyColumn + ": Loader - " + r, l) } finally { f != null && (f.dispose(), f = null) } return 0 }; r.prototype.fillDirectList = function () { var i, t; this.info.queryAll == null || this.info.queryAll.length <= 0 || (i = this.info.queryAll, this.cLookup = !0, n.MLookupCache.loadFromCache(this.info, this)) || (t = this, b(i, 1, 1e3, null, function (i) { var e, r, u, f; try { for (e = t.info.keyColumn.endsWith("_ID"); i.read();)r = i.getString(2), e ? (u = i.getInt(0), t.lookupDirectAll[" " + u] = { Key: u, Name: n.Utility.encodeText(r) }) : (f = i.getString(1), t.lookupDirectAll[" " + f] = { Key: f, Name: n.Utility.encodeText(r) }) } catch (o) { console.log(o) } n.MLookupCache.loadEnd(t.info, t); t.loading = !1; t = null }), this.loading = !0) }; r.prototype.readData = function (t, i) { var u = {}, c = 0, r, o, f, s, e, h; for (this.allLoaded = !0; t.read();) { if (c++ > this.MAX_ROWS) { this.log.fine(this.info.keyColumn + ": Loader - Too many records"); this.allLoaded = !1; break } r = t.getString(2); o = t.getString(3).equals("Y"); o || (r = this.INACTIVE_S + r + this.INACTIVE_E, this.hasInactive = !0); i ? (f = t.getInt(0), s = { Key: f, Name: n.Utility.encodeText(r) }, u[" " + f] = s) : (e = t.getString(1), h = { Key: e, Name: n.Utility.encodeText(r) }, u[" " + e] = h) } this.lookup = null; this.lookup = u; this.loading = !1 }; r.prototype.refresh = function () { if (this.getDisplayType() == n.DisplayType.Search || this.info.IsCreadedUpdatedBy || this.loading) return 0; return this.load() }; r.prototype.clear = function () { this.$super.clear.call(this); this.lookup = {} }; r.prototype.getCLookup = function () { return this.cLookup && this.lookupDirectAll, this.lookup }; r.prototype.setCLookup = function (n) { this.cLookup && (this.lookupDirectAll = n); this.lookup = n }; r.prototype.getIsLoading = function () { return this.loading }; r.prototype.setIsLoading = function (n) { this.loading = n }; r.prototype.getZoomWindow = function () { if (arguments.length == 0) return this.info.zoomWindow; var t = arguments[0]; return n.ZoomTarget.getZoomVAF_Screen_ID(this.info.tableName, this.windowNo, t.getWhereClause(), n.context.isSOTrx(this.windowNo)) }; r.prototype.getZoomQuery = function () { return this.zomQuery }; r.prototype.getVAF_Control_Ref_Value_ID = function () { return this.info.VAF_Control_Ref_Value_ID }; r.prototype.disableValidation = function () { var t = this.info.validationCode; this.$super.disableValidation.call(this); this.info.isValidated = !0; this.info.validationCode = ""; t != null && t.length > 0 && (t.indexOf("@") != -1 && this.getDisplayType() == n.DisplayType.Table || this.getDisplayType() == n.DisplayType.TableDir) && this.setDisplayType(n.DisplayType.Search) }; r.prototype.dispose = function () { this.$super.dispose.call(this); this.lookupDirect = null; this.directNullKey = null; this.log = null }; n.Utility.inheritPrototype(f, i); f.prototype.cacheLookup = null; f.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.getLocation(n, null); return t == null ? "<" + n.toString() + ">" : t.Name }; f.prototype.get = function (n) { if (n == null) return null; var t = this.getLocation(n, null); return t == null ? null : t }; f.prototype.getColumnName = function () { return "VAB_Address_ID" }; f.prototype.getLocation = function (t, i) { if (t == null) return null; if (t in this.lookup) return this.lookup[t]; var r = n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocation", { id: t }); return (this.lookup[t] = r.LocItem, this.lstLatLng[t] = r.LocLatLng, !i) ? r.LocItem : r.LocLatLng }; f.prototype.refreshLocation = function (t) { if (t == null) return null; var i = n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocation", { id: t }); return this.lookup[t] = i.LocItem, this.lstLatLng[t] = i.LocLatLng, i }; f.prototype.load = function () { var t = this; if (t.lstLatLng = {}, f.prototype.cacheLookup != null) { t.lookup = f.prototype.cacheLookup.LocLookup; t.lstLatLng = f.prototype.cacheLookup.LocLatLng; t = null; return } n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocations", "", function (n) { f.prototype.cacheLookup || (f.prototype.cacheLookup = n); t.lookup = n.LocLookup; t.lstLatLng = n.LocLatLng; t = null }) }; f.prototype.getLatLng = function (n) { if (n == null || n.toString().len < 1) return null; if (n in this.lstLatLng) return this.lstLatLng[n]; return this.getLocation(n, !0) }; f.prototype.dispose = function () { this.lstLatLng = null; this.$super.dispose.call(this); this.lookup = null }; n.Utility.inheritPrototype(u, i); u.prototype.getDefault = function () { return this.defaultID }; u.prototype.getOnlyWarehouseID = function () { return this.onlyWarehouseID }; u.prototype.getOnlyProductId = function () { return this.onlyProductID }; u.prototype.getIsOnlyOutgoing = function () { return this.onlyOutgoing }; u.prototype.setOnlyWarehouseID = function (n) { this.onlyWarehouseID = n }; u.prototype.setOnlyProductID = function (n) { this.onlyProductID = n }; u.prototype.setOnlyOutgoing = function (n) { this.onlyOutgoing = n }; u.prototype.getDirect = function (t, i) { var s, u, r, f, e; if (t == null) return null; if (s = "VIS_92", u = [], u[0] = new n.DB.SqlParam("@keyValue", t), r = o(s, u), f = "", r.read()) f = r.getString(0); else return null; return r.dispose(), e = { Key: t, Name: n.Utility.encodeText(f) }, i && (this.lookup[" " + t] = e), e }; u.prototype.getIsValid = function (n) { if (n == null) return !0; var t = this.lookup[n]; return t != null }; u.prototype.load = function (i) { var o = 0, c = this.getOnlyWarehouseID(), l = this.getOnlyProductId(), s = this.getIsOnlyOutgoing(), h = "Value, LocatorCombination, VAM_Warehouse_ID, (SELECT Name FROM VAM_Warehouse WHERE VAM_Warehouse_ID = VAM_Locator.VAM_Warehouse_ID) AS Warehouse", r, f, a, u, v, e; try { } catch (y) { this.log.log(n.Logging.Level.SEVERE, sql, y); h = "Value" } this.lookup = null; this.lookup = {}; s = s != null && s.value ? !1 : !0; try { if (r = null, i) { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetWareProWiseLocator", data: { colName: h, warehouseId: c, productId: l, onlyIsSOTrx: s }, success: function (t) { r = (new n.DB.DataSet).toJson(t) } }), f = r.getTable(0), a = f.getRows().length, u = 0; u < a; u++) { if (o++ > this.maxRows) { this.log.warning("Over Max Rows - " + o); break } v = n.Utility.Util.getValueOfString(f.getRow(u).getCell(4)) + "_" + n.Utility.Util.getValueOfString(f.getRow(u).getCell(1)) + "(" + n.Utility.Util.getValueOfString(f.getRow(u).getCell(2)) + ")"; this.lookup[f.getRow(u).getCell(0)] = { Key: f.getRow(u).getCell(0), Name: v } } r.dispose(); r = null; this.log.fine("Complete #" + o) } else e = this, t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/GetWareProWiseLocator", data: { colName: h, warehouseId: c, productId: l, onlyIsSOTrx: s }, success: function (t) { var u, f, i; r = (new n.DB.DataSet).toJson(t); try { for (u = r.getTable(0), f = u.getRows().length, i = 0; i < f; i++) { if (o++ > e.maxRows) { e.log.warning("Over Max Rows - " + o); break } e.lookup[u.getRow(i).getCell(0)] = { Key: u.getRow(i).getCell(0), Name: n.Utility.Util.getValueOfString(u.getRow(i).getCell(1)) } } r.dispose(); r = null; e.log.fine("Complete #" + o) } catch (s) { e.log(n.Logging.Level.SEVERE, "", s) } e = null } }) } catch (p) { this.log.log(n.Logging.Level.SEVERE, finalSql, p) } i && t.isEmptyObject(this.lookup) && this.log.Finer(finalSql) }; u.prototype.get = function (n) { if (n == null) return null; var i = Number(n), t = this.lookup[i]; return t != null ? t : this.getDirect(n, !0, null) }; u.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; u.prototype.getData = function () { var n = this.lookup; return t.map(this.lookup, function (n) { return n }) }; u.prototype.refresh = function () { this.log.fine("start"); try { this.load(!0) } catch (n) { this.log.severe("#" + this.lookup.Count) } return this.log.info("#" + this.lookup.Count), this.lookup.length }; u.prototype.getColumnName = function () { return "VAM_Locator.VAM_Locator_ID" }; u.prototype.getZoomWindow = function () { if (arguments.length == 0) return this.info.zoomWindow; var t = arguments[0]; return n.ZoomTarget.getZoomVAF_Screen_ID("VAM_Locator", this.windowNo, t.getWhereClause(), n.context.isSOTrx(this.windowNo)) }; u.prototype.dispose = function () { this.disposeLocal(); this.$super.dispose.call(this); this.lookupDirect = null; this.directNullKey = null; this.log = null; this.disposeLocal = null }; n.Utility.inheritPrototype(s, i); s.prototype.getDisplay = function (n) { return this.containsKey(n) ? this.toStringX() : "<" + n.toString() + ">" }; s.prototype.toStringX = function () { return this.VAB_Acct_ValidParameter_ID == 0 ? "" : this.combination }; s.prototype.containsKey = function (n) { var t = 0; return n != null && (t = parseInt(n.toString())), this.load(t) }; s.prototype.load = function (t) { var u, r, i; if (t == 0) return this.VAB_Acct_ValidParameter_ID = 0, this.combination = "", this.description = "", !0; if (t == this.VAB_Acct_ValidParameter_ID) return !0; u = "VIS_94"; r = []; r[0] = new n.DB.SqlParam("@ID", t); i = null; try { if (i = o(u, r), !i.read()) return !1; this.VAB_Acct_ValidParameter_ID = i.getInt(0); this.combination = i.getString(1); this.description = i.getString(2) } catch (f) { return !1 } return !0 }; s.prototype.getColumnName = function () { return "" }; s.prototype.getData = function (i, r, u) { var o = [], f; i || o.push({ Key: -1, Name: "" }); f = null; try { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetValidAccountCombination", data: { VAF_Client_ID: VAF_Client_ID, onlyActive: u }, success: function () { f = (new n.DB.DataReader).toJson(jString) } }); f.read();)o.push({ Key: f.getInt(0), Name: f.getString(1) + " - " + f.getString(2) }) } catch (s) { this.log.log(e.SEVERE, sql, s) } return o }; n.Utility.inheritPrototype(a, i); a.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; a.prototype.get = function (t) { var i, r, f, u; if (t == null) return null; if (i = 0, t instanceof Number) i = t; else try { i = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (i == 0) return this.NO_INSTANCE; r = null; try { f = []; f[0] = new n.DB.SqlParam("@VAM_PFeature_SetInstance_ID", i); u = o("VIS_95", f); u.read() && (r = u.getString(0), (r == null || r.length == 0) && (r = n.Logging.VLogMgt.getIsLevelFine() ? "{" + i + "}" : "")); u.dispose(); u = null } catch (s) { this.log.log(e.SEVERE, "get", s) } return r == null ? null : { Key: i, Name: r } }; a.prototype.getColumnName = function () { return "VAM_PFeature_SetInstance_ID" }; a.prototype.dispose = function () { this.$super.dispose.call(this); this.NO_INSTANCE = null; this.log = null }; n.Utility.inheritPrototype(c, i); c.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; c.prototype.get = function (t) { var i, r, f, u; if (t == null) return null; if (i = 0, t instanceof Number) i = t; else try { i = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (i == 0) return this.NO_INSTANCE; r = null; try { f = []; f[0] = new n.DB.SqlParam("@C_GenttributeSetInstance_ID", i); u = o("VIS_96", f); u.read() && (r = u.getString(0), (r == null || r.length == 0) && (r = n.Logging.VLogMgt.getIsLevelFine() ? "{" + i + "}" : "")); u.dispose(); u = null } catch (s) { this.log.log(e.SEVERE, "get", s) } return r == null ? null : { Key: i, Name: r } }; c.prototype.getColumnName = function () { return "VAB_GenFeatureSetInstance_ID" }; c.prototype.dispose = function () { this.$super.dispose.call(this); this.NO_INSTANCE = null; this.log = null }; c.prototype.getData = function (i, r, u) { var o = [], f; i || o.push({ Key: -1, Name: "" }); f = null; try { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GenAttributeSetInstance", data: { VAB_GenFeatureSet_ID: n.Env.getCtx().getContextAsInt(this.windowNo, "VAB_GenFeatureSet_ID"), onlyActive: u }, success: function () { f = (new n.DB.DataReader).toJson(jString) } }); f.read();)o.push({ Key: f.getInt(0), Name: f.getString(1) + " - " + f.getString(2) }) } catch (s) { this.log.log(e.SEVERE, sql, s) } return o }; n.MLookupFactory = { get: function (t, i, r, u, f, e, o, s) { var c = { ctx: t.getWindowCtx(i), windowNo: i, column_ID: r, VAF_Control_Ref_ID: u, columnName: f, VAF_Control_Ref_Value_ID: e, isParent: o, validationCode: s }, h = n.dataContext.getJSONData(n.Application.contextUrl + "JsonData/GetLookup", c); return new n.MLookup(h._vInfo, h) }, getMLookUp: function (t, i, r, u) { var s = "", h = 0, c = !1, l = "", f = null, e; try { e = []; e[0] = new n.DB.SqlParam("@Column_ID", r); f = o("VIS_97".toString(), e, null); f.read() && (s = f.getString(0), h = f.getInt(1), c = "Y".equals(f.getString(2)), l = f.getString(3)); f.close(); f = null } catch (a) { f != null && (f.close(), f = null) } return n.MLookupFactory.get(t, i, r, u, s, h, c, l) }, GetLookUpInfo: function (n, t, i, r, u, f, e, o) { var s = { WindowNum: t, VAF_Control_Ref_ID: i, Column_ID: r, columnName: u, VAF_Control_Ref_Value_ID: f, IsParent: e, ValidationCode: o } }, getLookup_TableDirEmbed: function (t, i, r, u) { var h = i.substring(0, i.length - 3), l = [], a = [], s, f, c, e; a[0] = new n.DB.SqlParam("@tableName", h); try { for (s = o("VIS_98", a); s.read();)l.push({ ColumnName: s.getString(0), IsTranslated: s.getString(1), DisplayType: s.getInt(2), VAF_Control_Ref_Value_ID: s.getInt(3) }); s.close(); s = null } catch (v) { return "" } if (l.length == 0) return ""; for (f = "SELECT ", c = 0; c < l.length; c++)c > 0 && (f = f.concat("||' - '||")), e = l[c], n.DisplayType.IsDate(e.DisplayType) || n.DisplayType.IsNumeric(e.DisplayType) ? f = f.concat(n.DB.to_char(h + "." + e.ColumnName, e.DisplayType, n.Env.getVAF_Language(n.Env.getCtx()))) : (e.DisplayType == n.DisplayType.TableDir || e.DisplayType == n.DisplayType.Search) && e.ColumnName.endsWith("_ID") ? alert("TableDir") : f = f.concat(h).concat(".").concat(e.ColumnName); return f = f.concat(" FROM ").concat(h), f = f.concat(" WHERE ").concat(r).concat(".").concat(u), f = f.concat("=").concat(h).concat(".").concat(i), f.toString() } }; n.MLookupCache = { s_log: n.Logging.VLogger.getVLogger("MLookupCache"), s_loadedLookups: new n.CCache("MLookupCache"), s_sentLookups: new n.CCache("MLookupCacheSent"), s_windowLookup: {}, s_windowRecordLookup: {}, getKey: function (t) { if (t == null) return n.Env.currentTimeMillis(); var i = t.windowNo + ":"; return i + (":" + t.keyColumn + t.VAF_Control_Ref_Value_ID + t.query + t.validationCode) }, loadFromCache: function (n, i) { var u = this.getKey(n), f = null, r = !0; return this.s_loadedLookups.contains(u) && (f = this.s_loadedLookups.get(u)), f == null && (r = !1), r && t.isEmptyObject(f) && (this.s_loadedLookups.remove(u), r = !1), r && (i.setCLookup(jQuery.extend({}, f)), i.setIsLoading(!1)), r || (r = !0, this.s_sentLookups.contains(u) ? this.s_sentLookups.get(u).indexOf(i) == -1 && (i.setIsLoading(!0), this.s_sentLookups.get(u).push(i)) : (this.s_sentLookups.add(u, []), r = !1)), r }, loadEnd: function (n, i) { var f = this.getKey(n), o, e, r, u; if (i.getCLookup() && !t.isEmptyObject(i.getCLookup())) { if (this.s_loadedLookups.add(f, i.getCLookup()), this.s_sentLookups.contains(f)) { for (r = this.s_sentLookups.get(f), r.length > 0 && (o = ""), u = 0; u < r.length; u++)e = r[u], e.setCLookup(t.extend({}, i.getCLookup())), e.setIsLoading(!1); r.length = 0; this.s_sentLookups.remove(f) } } else if (this.s_sentLookups.contains(f)) { for (r = this.s_sentLookups.get(f), u = 0; u < r.length; u++)r[u].setIsLoading(!1); r.length = 0; this.s_sentLookups.remove(f) } }, cacheReset: function (n) { for (var e = n.toString() + ":", c = this.s_loadedLookups.size(), u = [], i, s, r, h, f, t = 0, o = this.s_loadedLookups.m_cacheK.length; t < o; t++) { i = this.s_loadedLookups.m_cacheK[t]; try { i != null && i.startsWith(e) && u.push(i) } catch (l) { s = "" } } for (r = 0; r < u.length; r++)this.s_loadedLookups.remove(u[r]); h = this.s_loadedLookups.size(); for (f in this.s_windowRecordLookup) f.startsWith(e) && delete this.s_windowRecordLookup[f] }, addWindowLookup: function (n, t) { if (this.s_windowLookup[n]) this.s_windowLookup[n].push(t); else { var i = []; i.push(t); this.s_windowLookup[n] = i } }, initWindowLookup: function (n) { var t, i, r; if (this.s_windowLookup[n]) { for (t = this.s_windowLookup[n], i = 0, r = t.length; i < r; i++)t[i].initialize(); t.length = 0; delete this.s_windowLookup[n] } }, addRecordLookup: function (n, t, i) { var r = n + ":" + t; this.s_windowRecordLookup[r] = i }, getRecordLookup: function (n, t, i, r) { var u = this.s_windowRecordLookup[n + ":" + t]; return u && i in u ? u[i][r] : null } }; n.Utility.inheritPrototype(h, i); h.prototype.cacheLookup = null; h.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t }; h.prototype.get = function (t) { var i, r, f, u; if (t == null) return null; if (i = 0, t instanceof Number) i = t; else try { i = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (i in this.lookup) return this.lookup[i]; if (i == 0) return this.NO_INSTANCE; r = null; try { f = []; f[0] = new n.DB.SqlParam("@VAB_DimAmt_ID", i); u = o("VIS_99", f); u.read() && (r = u.getString(0), (r == null || r.length == 0) && (r = n.Logging.VLogMgt.getIsLevelFine() ? "{" + i + "}" : "")); u.dispose(); u = null; this.lookup[i] = r } catch (s) { this.log.log(e.SEVERE, "get", s) } return r == null ? null : r }; h.prototype.getColumnName = function () { return "VAB_DimAmt_ID" }; h.prototype.refreshAmountDivision = function (t) { var r, i, f, u; if (t == null) return null; if (r = 0, t instanceof Number) r = t; else try { r = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (r == 0) return this.NO_INSTANCE; i = null; try { f = []; f[0] = new n.DB.SqlParam("@VAB_DimAmt_ID", r); u = o("VIS_99", f); u.read() && (i = u.getString(0), (i == null || i.length == 0) && (i = n.Logging.VLogMgt.getIsLevelFine() ? "{" + r + "}" : "")); u.dispose(); u = null; this.lookup[r] = i } catch (s) { this.log.log(e.SEVERE, "get", s) } return i == null ? null : i }; h.prototype.dispose = function () { this.lstLatLng = null; this.$super.dispose.call(this); this.lookup = null }; n.Utility.inheritPrototype(l, i); l.prototype.cacheLookup = null; l.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; l.prototype.get = function (i) { var r, u; if (i == null) return null; if (r = 0, i instanceof Number) r = i; else try { r = parseInt(i.toString()) } catch (f) { this.log.log(e.SEVERE, "Value=" + i, f) } return r in this.lookup ? this.lookup[r] : r == 0 ? this.NO_INSTANCE : (u = null, t.ajax({ url: y + "ProductContainer/GetProductContainerInfo", data: { ID: r }, async: !1, success: function (t) { u = t ? t : n.Logging.VLogMgt.getIsLevelFine() ? "{" + r + "}" : "" }, error: function (n) { this.log.log(e.SEVERE, "get", n) } }), this.lookup[r] = u, u == null) ? null : { Key: r, Name: u } }; l.prototype.getColumnName = function () { return "VAM_ProductContainer_ID" }; l.prototype.dispose = function () { this.lstLatLng = null; this.$super.dispose.call(this); this.lookup = null }; n.MLookup = r; n.MLocationLookup = f; n.MAccountLookup = s; n.MPAttributeLookup = a; n.MGAttributeLookup = c; n.MLocatorLookup = u; n.MAmtDivLookup = h; n.MProductContainerLookup = l }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function ct() { c = t("<table style='width:100%;height:100%'><tr><td style='height:100%'><div class='vis-css-treewindow' ><\/td><\/tr><tr><td style='text-align:center'><div class='vis-tree-search'><div class='input-group'><input type='text' class='form-control ui-autocomplete-input' placeholder='Search'>  <span class='input-group-append'><button class='input-group-text'><a href='#' class='vis vis-search'><\/a><\/button><\/span><\/div><\/div><\/td><\/tr><\/table>"); h = c.find(".vis-css-treewindow"); h.css({ "max-width": "290px" }); ot = c.find(".vis-tree-search"); tt = c.find(".input-group-addon"); it = c.find("input"); a = t("<ul class='vis-apanel-rb-ul'>"); w = t("<li data-action='Copy'>").text(n.Msg.getMsg("Copy")); b = t("<li data-action='Move'>").text(n.Msg.getMsg("Move")); k = t("<li data-action='Cancel'>").text(n.Msg.getMsg("Cancel")); a.append(w); o.onDemandTree && (d = t("<li data-action='MoveHere'>").text(n.Msg.getMsg("MoveHere")), a.append(d)); a.append(b).append(k) } function lt() { var h, u, i, e; if (s != null && l != null && s.data("value") != l.data("value")) { h = s.parent(); s.remove(); var a = h.parent().data("value"), o = null, r = l, c = 0; l.data("summary") != "Y" ? (r = l.parent(), c = l.index(), s.insertAfter(r.children()[c]), o = r.parent().data("value")) : (u = r.find(">ul"), u.children().length > 0 ? s.insertBefore(u.children()[c]) : s.appendTo(u), o = r.data("value"), r = u); for (var f = h.children(), i = 0, v = [], p = [], i = 0; i < f.length; i++)e = t(f[i]), v.push(e.data("value")); if (a != o) for (f = r.children(), i = 0; i < f.length; i++)e = t(f[i]), p.push(e.data("value")); t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/UpdateTree", data: { oldParentChildren: JSON.stringify(v), newParentChildren: JSON.stringify(p), oldId: a, newId: o, VAF_TreeInfo_ID: y, tableName: rt }, success: function (n) { console.log(n) }, error: function () { } }) } } function at() { g.length = 0; nt.length = 0; h.find("LI").each(function (n, i) { var r = t(i), u = r.find(">label"); u.length < 1 && (u = r.find(">A")); g.push(r.data("value")); nt.push(u.text()) }) } function et() { var i = it.val(), n, t; if (i == null || i.length < 2) { o.searchNode = !1; return } n = o.containsTextInArray(nt, i, ut); n > -1 ? (t = g[n], o.currentNode = t, ut = n, o.setSelectedNode(t), o.selectionChangeListner ? o.selectionChangeListner.nodeSelectionChanged({ newValue: t, propertyName: "" }) : o.searchNode = !1) : o.searchNode = !1 } var o; this.selectionChangeListner = null; this.windowNo = i; var rt = "", p = null, g = [], nt = [], ut = -1, v = null, s = null, l = null, y = 0, ft = 0; this.onDemandTree = f; this.currentNode = 0; this.searchNode = !1; this.gc = e; var o = this, c = null, h = null, ot = null, tt = null, it = null, a = null, w, b, k, d, st = n.Application.contextUrl, ht = st + "JsonData/ExecuteNonQuer", vt = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n.join("/"), param: i }; return t.ajax({ url: ht + "ies", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }; ct(); o = this; this.setSize = function (n) { h.height(n - 40) }; this.setTabID = function (n) { ft = n }; this.initTree = function (r) { y = r; (this.onDemandTree == "undefined" || this.onDemandTree == null) && (this.onDemandTree = !1); var f = { VAF_TreeInfo_ID: y, editable: u, windowNo: i, onDemandTree: this.onDemandTree, VAF_Tab_ID: ft }; y = y; n.dataContext.getTreeAsString(f, function (n) { var i, r; h.html(n); at(); p = h.find(">ul"); rt = p.data("tablename"); p = p.find(">li>ul"); o.onDemandTree && h && (i = h.find("ul"), i && i.length > 1 && (r = t(i.find("ul")[0]).children(), r && r.length > 0 && !o.gc.isZoomAction ? t(r[0]).trigger("click") : o.gc.isZoomAction || (o.gc.query(o.selectionChangeListner.aPanel.curTab.getOnlyCurrentDays(), 0, !1), o.selectionChangeListner.aPanel.setBusy(!1)))) }) }; this.getRoot = function () { return c }; h.on(n.Events.onClick, function (n) { var r, u, i, f; n.target.nodeName === "INPUT" || n.target.nodeName === "LI" || n.target.nodeName === "A" ? (r = t(n.target), n.target.nodeName === "INPUT" && (r = t(n.target.parentNode)), o.selectionChangeListner && (o.onDemandTree && (u = c.find("*.vis-css-treewindow-selected"), u.length > 0 && u.removeClass("vis-css-treewindow-selected"), i = t(t(n.target).parent()), i.find(">label").length > 0 ? i.find(">label").addClass("vis-css-treewindow-selected") : (i.find(">a").addClass("vis-css-treewindow-selected"), t(i.find("label")[0]).addClass("vis-css-treewindow-selected"))), o.selectionChangeListner.nodeSelectionChanged({ newValue: r.data("value"), propertyName: "" })), n.stopPropagation()) : n.target.nodeName === "SPAN" && (n.target.parentNode.nodeName == "SPAN" || n.target.parentNode.nodeName == "LI") && (f = t(n.target.parentNode), n.target.parentNode.nodeName === "SPAN" && (f = t(n.target.parentNode.parentNode)), v = f, w.hide(), k.hide(), b.hide(), o.onDemandTree && d.hide(), s != null ? (b.show(), k.show()) : (w.show(), o.onDemandTree && d.show()), t(n.target).w2overlay(a.clone(!0))) }); tt.on(n.Events.onTouchStartOrClick, function (n) { o.searchNode = !0; et(n) }); it.on("keydown", function (n) { n.keyCode == 13 && (o.searchNode = !0, et(n)) }); a.on(n.Events.onTouchStartOrClick, "LI", function (i) { var f = t(i.target).data("action"), r, e, h, c, u, a; if (f == "Copy") s = v; else if (f == "Move") l = v, lt(), s = null, l = null, v = null; else if (f == "MoveHere") { if (r = o.selectionChangeListner.vTable.getSelection(!0), e = "", o.selectionChangeListner.aPanel.setBusy(!0), r && r.length > 0) for (h = o.selectionChangeListner.vTable.grid, c = o.selectionChangeListner.getMTab().gridTable.keyColumnName.toLower(), u = 0; u < r.length; u++)e += u == 0 ? h.get(r[u] + 1)[c] : "," + h.get(r[u] + 1)[c]; a = { nodeID: e, oldParentID: 0, newParentID: v.data("value"), VAF_TreeInfo_ID: y }; t.ajax({ url: n.Application.contextUrl + "Tree/UpdateTree", dataType: "json", data: a, success: function (n) { var t = n; t > 0 && o.selectionChangeListner.removeRecord() }, error: function () { o.selectionChangeListner.aPanel.setBusy(!1) } }); v = null; s = null } else f == "Cancel" && (s = null, v = null) }); this.getRootNode = function () { return p }; this.disposeLocal = function () { h.off(n.Events.onClick); tt.off(n.Events.onTouchStartOrClick); a.off(n.Events.onTouchStartOrClick); a = null; h = null; c.remove(); c = null; o = null } } i.prototype.containsTextInArray = function (n, t, i) { for (var r = i + 1; r < n.length; r++)if (r != -1 && n[r].trim().toLowerCase().contains(t.trim().toLowerCase())) return r; return i > -1 ? (i = -1, this.containsTextInArray(n, t, i)) : -1 }; i.prototype.addSelectionChangeListner = function (n) { this.selectionChangeListner = n }; i.prototype.setSelectedNode = function (n) { return n != -1 ? this.selectID(n, !0) : (this.currentNode = 0, !1) }; i.prototype.selectID = function (n) { var r, t, u, f, i; if (!this.onDemandTree || this.searchNode) { if (this.currentNode = n, this.searchNode = !1, r = this.getRoot(), t = r.find("li[data-value='" + n + "']"), t != null && t.length > 0) { for (u = r.find("*.vis-css-treewindow-selected"), u.length > 0 && u.removeClass("vis-css-treewindow-selected"), t.find(">label").length > 0 ? t.find(">label").addClass("vis-css-treewindow-selected") : t.find(">a").addClass("vis-css-treewindow-selected"), f = t; t != null;)i = t.find("input"), i.length > 0 && (i.prop("checked") || i.prop("checked", !0)), t = t.parent(), t[0].nodeName == "UL" && (t = t.parent()), t[0].nodeName == "LI" || (t = null); return f[0].scrollIntoView(), !0 } return !1 } }; i.prototype.nodeChanged = function (n, i, r, u, f, e) { var c, l, y, s, a; if (console.log("Save=" + n + ", KeyID=" + i + ", Name=" + r + ", Description=" + u + ", IsSummary=" + f + ", ImageInd=" + e), i != 0) { var v = this.getRoot(), h = !1, o = v.find("li[data-value='" + i + "']"); o != null && o.length > 0 && (h = !0); !h && n ? this.onDemandTree ? (c = v.find("*.vis-css-treewindow-selected"), c && f && (l = t(c.parent()).find("ul"), l && l.length > 0 ? t(l[0]).append(this.getNode(i, r, u, f, e, this.windowNo)) : t(c.parent()).append(t("<ul>").append(this.getNode(i, r, u, f, e, this.windowNo))))) : (y = this.getRootNode(), y.append(this.getNode(i, r, u, f, e, this.windowNo))) : h && n ? (this.toggleTypeOfNode(o, f, i, this.windowNo, e), f && o.find(">ul").length == 0 && o.append(t("<ul>")), s = o.find(">label"), s && s.length != 0 || (s = o.find(">a")), s.length > 0 && s.text(r)) : h && !n ? (a = o.find(">ul"), a.length > 0 && (a.remove(), this.getRootNode().append(a.children())), o.remove()) : o = null; o == null } }; i.prototype.getNode = function (i, r, u, f, e, o) { r = n.Utility.encodeText(r); var s = '<li data-value="' + i + '"'; return s += f ? 'data-summary="Y" class="vis-hasSubMenu"> <input type="checkbox" id="' + o + i + '"><label for="' + o + i + '">' + r + '<\/label><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span><ul><ul>' : 'data-summary="N">  <img src="' + n.Application.contextUrl + "Areas/VIS/Images/login/" + this.getIcon(e) + '">  <a href="javascript:void(0)" data-value="' + i + '" data-action="' + e + '" data-actionid="' + i + '"> ' + r + '<\/a><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"> <\/span><\/span><\/li>', t(s) }; i.prototype.getIcon = function (n) { switch (n) { case "W": return "mWindow.png"; case "R": return "mReport.png"; case "P": return "mProcess.png"; case "F": return "mWorkflow.png"; case "B": return "mWorkbench.png"; case "X": return "mWindow.png"; case "V": return "mWindow.png"; case "D": return "mDocAction.png"; default: return "mWindow.png" } }; i.prototype.toggleTypeOfNode = function (t, i, r, u, f) { var h = t.data("summary") == "Y", o, e, s; i !== h ? (o = t.find(">ul"), o.remove(), t.data("summary", i ? "Y" : "N"), t.toggleClass("vis-hasSubMenu"), i ? t.html('<input type="checkbox" id="' + u + r + '"><label for="' + u + r + '">' + name + '<\/label><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span>') : t.html('<img src="' + n.Application.contextUrl + "Areas/VIS/Images/login/" + this.getIcon(f) + '">  <a href="javascript:void(0)" data-value="' + r + '" data-action="' + f + '" data-actionid="' + r + '"> ' + name + '<\/a><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"> <\/span><\/span>'), o.length > 0 && t.append(o)) : i || (e = t.find(">a"), e.length > 0 && (s = e.data("action"), e != f && (t.find(">img").attr("src", n.Application.contextUrl + "Areas/VIS/Images/login/" + this.getIcon(f)), e.data("action", f)), e = s = null)) }; i.prototype.dispose = function () { this.disposeLocal(); this.addPropertyChangeListner = null }; n.TreePanel = i }(VIS, jQuery), function (n, t) { function l(n, i, r) { var u = null; return t.ajax({ url: y, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function v(i, r, u) { var f = null; return i.sql = n.secureEngine.encrypt(i.sql), t.ajax({ url: w, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: r, data: JSON.stringify(i) }).done(function (n) { f = n; u && u(n) }), f } function f(t) { var i, r; for (this.vo = t._vo, this.tabs = [], i = 0; i < t._tabs.length; i++)r = new n.GridTab(t._tabs[i], this.vo), r.setGridWindow(this), this.tabs.push(r); t = null } function i(t, i) { this.gTab = t; this.vo = t._vo; this.gridTable = new n.GridTable(t._gridTable); this.gridTable.onlyCurrentDays = this.vo.onlyCurrentDays; this.gridTable.MaintainVerOnApproval = this.vo.MaintainVerOnApproval; this.gridTable.IsMaintainVersions = this.vo.IsMaintainVersions; this.parents = []; this.orderBys = []; this.depOnFieldColumn = []; this.depOnField = []; this.tabPanels = []; this.linkColumnName = t._linkColumnName; this.extendendWhere = t._extendedWhere; this.keyColumnName = ""; this.isThroughRoleCenter = !1; this.query = new n.Query; this.oldQuery = "0=9"; this.linkValue = "999999"; this.currentRow = -1; this.hasPanel = !1; this.isHeaderPanel = !1; this.headerPanel = null; this.mDataStatusEvent; this.mDataListenerList = []; this.loadFields(); this.loadTabPanels(); this.loadHeaderPanelItems(); this.gridTable.addDataStatusListener(this); this.gridTable.setVAF_Tab_ID(this.vo.VAF_Tab_ID); this.log = n.Logging.VLogger.getVLogger("VIS.GridTab"); this.loadData(i); i = null; this.gridWindow = null } function u(t) { this.gTable = t; this.readOnly = this.gTable._readOnly; this.VAF_TableView_ID = t._VAF_TableView_ID; this.deleteable = this.gTable._deleteable; this.gridFields = []; this.keyColumnName = ""; this.isOpen = !1; this.inserting = !1; this.SQL_Select = ""; this.SQL_Count = ""; this.SQL = ""; this.bufferList = []; this.defaultModel = {}; this.pazeSize = n.Env.getWINDOW_PAGE_SIZE(); this.newRow = -1; this.compareDB = !0; this.treeNode_ID = 0; this.treeTable_ID = 0; this.treeID = 0; this.selectedTreeNode = 0; this.ShowSummaryNodes = !1; this.isZoomAction = !1; this.currentPage; this.dopaging; t = null; this.mSortList; this.VAF_Tab_ID = 0; this.log = n.Logging.VLogger.getVLogger("VIS.GridTable") } function r(t) { this.gfield = t; this.vo = t._vo; this.oldValue; this.value; this.inserting; this.error; this.valueNoFire = !0; this.gridTab = null; var i = null; this.vo.IsDisplayedf && (t._vo.lookupInfo != null && n.DisplayType.IsLookup(t._vo.displayType) ? n.DisplayType.IsLookup(t._vo.displayType) && (i = new n.MLookup(t._vo.lookupInfo, t._lookup), this.vo.tabNo > 0 ? (i.initialize(!0), n.MLookupCache.addWindowLookup(this.vo.windowNo, i)) : i.initialize()) : t._vo.displayType == n.DisplayType.Location ? i = new n.MLocationLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.Locator ? i = new n.MLocatorLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.Account ? i = new n.MAccountLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.PAttribute ? i = new n.MPAttributeLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.GAttribute ? i = new n.MGAttributeLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.AmtDimension ? i = new n.MAmtDivLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.ProductContainer && (i = new n.MProductContainerLookup(n.context, t._vo.windowNo))); this.lookup = i; this.propertyChangeListner; this.log = n.Logging.VLogger.getVLogger("VIS.GridField"); t = null } function s(n) { this.tPanel = n; this.vo = n._vo } function e(t, i, r, u, f) { this.mTotalPage = 1; this.mCurrentPage = 1; this.mPageSize = n.Env.getWINDOW_PAGE_SIZE(); this.totalRecords = 1; this.m_totalRows = i; this.m_changed = r; this.m_autoSave = u; this.m_inserting = f; this.m_VAF_Msg_Lable; this.m_info = null; this.m_isError = !1; this.m_isWarning = !1; this.m_confirmed = !1; this.m_allLoaded = !0; this.m_loadedRows = -1; this.m_currentRow = -1; this.m_changedColumn = -1; this.m_columnName = null; this.Created; this.CreatedBy; this.Updated; this.UpdatedBy; this.Info; this.VAF_TableView_ID; this.Record_ID; this.source = t } var o = n.Logging.Level, c = n.Application.contextUrl, y = c + "JsonData/JDataSetWithCode", p = c + "JsonData/ExecuteNonQuer", w = c + "Form/JDataSet", h = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, l(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, b = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, l(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, k = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, l(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, d = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, v(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, a = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, v(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, g = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n.join("/"), param: i }; return t.ajax({ url: p + "ies", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }; f.prototype.getTabs = function () { return this.tabs }; f.prototype.getTab = function (n) { return n < 0 || n + 1 > this.tabs.length ? null : this.tabs[n] }; f.prototype.getIsAppointment = function () { return this.vo.IsAppointment }; f.prototype.getIsTask = function () { return this.vo.IsTask }; f.prototype.getIsEmail = function () { return this.vo.IsEmail }; f.prototype.getIsLetter = function () { return this.vo.IsLetter }; f.prototype.getIsSms = function () { return this.vo.IsSms }; f.prototype.getIsChat = function () { return this.vo.IsChat }; f.prototype.getIsAttachment = function () { return this.vo.IsAttachment }; f.prototype.getIsHistory = function () { return this.vo.IsHistory }; f.prototype.getIsCheckRequest = function () { return this.vo.IsCheckRequest }; f.prototype.getIsCopyReocrd = function () { return this.vo.IsCopyReocrd }; f.prototype.getIsSubscribedRecord = function () { return this.vo.IsSubscribedRecord }; f.prototype.getIsZoomAcross = function () { return this.vo.IsZoomAcross }; f.prototype.getIsCreatedDocument = function () { return this.vo.IsCreatedDocument }; f.prototype.getIsUploadedDocument = function () { return this.vo.IsUploadedDocument }; f.prototype.getIsViewDocument = function () { return this.vo.IsViewDocument }; f.prototype.getIsAttachDocumentFrom = function () { return this.vo.IsAttachDocumentFrom }; f.prototype.getIsFaxEmail = function () { return this.vo.IsFaxEmail }; f.prototype.getIsMarkToExport = function () { return this.vo.IsMarkToExport }; f.prototype.getIsArchive = function () { return this.vo.IsArchive }; f.prototype.getIsImportMap = function () { return this.vo.IsImportMap }; f.prototype.getIsAttachmail = function () { return this.vo.IsAttachmail }; f.prototype.getIsRoleCenterView = function () { return this.vo.IsRoleCenterView }; f.prototype.getIsSOTrx = function () { return this.vo.IsSOTrx }; f.prototype.getIsTransaction = function () { return this.vo.IsTransaction }; f.prototype.getName = function () { return this.vo.Name }; f.prototype.getWindowWidth = function () { return this.vo.WinWidth }; f.prototype.getHasPanel = function () { return this.vo.hasPanel }; f.prototype.getFontName = function () { return this.vo.FontName }; f.prototype.getVAF_Image_ID = function () { return this.vo.VAF_Image_ID }; f.prototype.getImageUrl = function () { return this.vo.ImageUrl }; f.prototype.getIsCompositeView = function () { return this.vo.IsCompositeView }; f.prototype.dispose = function () { var n; for (originalLength = this.tabs.length, n = originalLength; n > 0; n--)gtab = this.tabs.pop(), gtab.dispose(), gtab = null; this.tabs.length = 0; this.vo = null; this.tabs = null }; i.prototype.setGridWindow = function (n) { this.gridWindow = n }; i.prototype.getParentTab = function () { var n = this.getParentTabNo(); return n < 0 || n == this.vo.tabNo ? null : this.gridWindow.getTab(n) }; i.prototype.getParentTabNo = function () { var t = this.vo.tabNo, i = this.vo.TabLevel, r = i - 1; if (r < 0) return t; while (r < i && t > 0) t--, i = n.context.getContextAsInt(this.vo.windowNo, t, "TabLevel"); return t }; i.prototype.getVAF_Tab_ID = function () { return this.vo.VAF_Tab_ID }; i.prototype.getVAF_Screen_ID = function () { return this.vo.VAF_Screen_ID }; i.prototype.getVAF_TableView_ID = function () { return this.vo.VAF_TableView_ID }; i.prototype.getTableName = function () { return this.vo.TableName }; i.prototype.getName = function () { return this.vo.Name }; i.prototype.getDescription = function () { return this.vo.Description }; i.prototype.getIsSortTab = function () { return this.vo.IsSortTab }; i.prototype.getDependentOn = function () { var t = []; return n.Evaluator.parseDepends(t, this.vo.DisplayLogic), t }; i.prototype.getTabLevel = function () { return this.vo.TabLevel }; i.prototype.getWindowNo = function () { return this.vo.windowNo }; i.prototype.getTabNo = function () { return this.vo.tabNo }; i.prototype.getIsSingleRow = function () { return this.vo.IsSingleRow }; i.prototype.getIsDisplayed = function (t) { var i = this.vo.DisplayLogic, r; return i == null || i.equals("") ? !0 : t ? i.indexOf("@#") != -1 && (r = n.Env.parseContext(n.context, 0, i, !1, !0).trim(), r.Length != 0) ? n.Evaluator.evaluateLogic(this, i) : !0 : n.Evaluator.evaluateLogic(this, i) }; i.prototype.getValueAsString = function (t) { return n.context.getWindowContext(this.vo.windowNo, this.vo.windowNo, t, !0) }; i.prototype.getIsCurrent = function () { if (!this.gridTable.getIsOpen() || !this.oldQuery.equals(this.query.getWhereClause())) return !1; if (!this.getIsDetail()) return !0; var t = n.context.getWindowContext(this.vo.windowNo, this.getLinkColumnName()); return this.linkValue.equals(t) }; i.prototype.getIsDetail = function () { return this.parents.length > 0 || this.vo.VAF_Column_ID != 0 ? !0 : !1 }; i.prototype.getField = function (n) { return this.gridTable.getField(n) }; i.prototype.getFieldById = function (n) { return this.gridTable.getFieldById(n) }; i.prototype.getFields = function () { return this.gridTable.getFields() }; i.prototype.getLinkColumnName = function () { return this.linkColumnName ? this.linkColumnName : "" }; i.prototype.getOnlyCurrentDays = function () { return this.getIsZoomAction() ? 0 : this.vo.onlyCurrentDays }; i.prototype.getShowSummaryLevel = function () { return this.vo.ShowSummaryLevel }; i.prototype.getIsTPBottomAligned = function () { return this.vo.TabPanelAlignment == "H" }; i.prototype.getIsTreeTab = function () { return this.vo.HasTree }; i.prototype.getRowCount = function () { return this.gridTable.getRowCount() }; i.prototype.getRecords = function () { return this.gridTable.getDataTable() }; i.prototype.getCurrentRow = function () { return this.currentRow }; i.prototype.getOrderByClause = function (n) { var i, t; if (this.vo.orderByClause.length > 0) return this.vo.OrderByClause; for (this.vo.orderByClause = "", i = 0; i < 3; i++)t = this.orderBys[i], t && t != null && t != "" && t.length > 0 && (this.vo.orderByClause.length > 0 && (this.vo.OrderByClause += ","), this.vo.orderByClause += t); return this.vo.orderByClause.Length > 0 ? this.vo.orderByClause : (this.vo.orderByClause = "Created", n > 0 && (this.vo.orderByClause += " DESC"), this.vo.orderByClause) }; i.prototype.getTableModel = function () { return this.gridTable }; i.prototype.getIsOpen = function () { return this.gridTable != null ? this.gridTable.getIsOpen() : !1 }; i.prototype.getIsQueryActive = function () { return this.query != null ? this.query.getIsActive() : !1 }; i.prototype.getDependantFields = function (n) { var i = [], r, t; if (this.depOnFieldColumn.indexOf(n) != -1) for (r = this.depOnFieldColumn.length, t = 0; t < r; t++)this.depOnFieldColumn[t].equals(n) && i.indexOf(this.depOnField[t]) < 0 && i.push(this.depOnField[t]); return i }; i.prototype.getIsReadOnly = function () { if (this.vo.IsReadOnly) return !0; if (this.vo.ReadOnlyLogic == null || this.vo.ReadOnlyLogic.equals("")) return this.vo.IsReadOnly; return n.Evaluator.evaluateLogic(this, this.vo.ReadOnlyLogic) }; i.prototype.getIsQueryNewRecord = function () { return this.query != null ? this.query.getIsNewRecordQuery() : !1 }; i.prototype.getIsInsertRecord = function () { return this.getIsReadOnly() ? !1 : this.vo.IsInsertRecord }; i.prototype.getIncluded_Tab_ID = function () { return this.vo.Included_Tab_ID }; i.prototype.getIsAlwaysUpdateField = function () { for (var t, n = 0; n < this.gridTable.getColumnCount(); n++)if (t = this.gridTable.getField(n), t.getIsAlwaysUpdateable()) return !0; return !1 }; i.prototype.getValue = function (n) { if (n == null) return null; var t = this.gridTable.getField(n); return this.getValueOfField(t) }; i.prototype.getValueOfField = function (n) { return n == null ? null : n.getValue() }; i.prototype.getVAF_Job_ID = function () { return this.vo.VAF_Job_ID }; i.prototype.getRecord_ID = function () { return this.gridTable.getKeyID(this.currentRow) }; i.prototype.getKeyID = function (n) { return this.gridTable.getKeyID(n) }; i.prototype.getFooterInfo = function (i, r, u, f, e) { return new Promise(function (f, o) { var s; if (i.startsWith("VAB_Order") || i.startsWith("VAB_Invoice")) { var s, l = i.startsWith("VAB_Order"), h = null, c = null; try { h = new n.MessageFormat(n.Msg.getMsg("OrderSummary")); c = new n.MessageFormat(n.Msg.getMsg("OrderSummaryMC")) } catch (a) { o(""); return } if (h == null || c == null) { f(""); return } s = 0; s = l ? r.getContextAsInt(u, "VAB_Order_ID") : r.getContextAsInt(u, "VAB_Invoice_ID"); s < 1 && e > 0 && (s = e); t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/GetTrxInfo", data: { Record_ID: s, isOrder: l }, success: function (t) { var e, s, l, a, v; try { var arguments = [], u = !1, i = (new n.DB.DataReader).toJson(t); i.read() && (e = i.getInt(0), arguments[0] = e, s = i.getDecimal(2).toLocaleString(), arguments[1] = s, l = i.getDecimal(3).toLocaleString(), arguments[2] = l, a = i.getString(1), arguments[3] = a, v = i.getDecimal(4).toLocaleString(), arguments[4] = v, arguments[5] = r.getContext("$CurrencyISO"), u = !0) } catch (y) { o("") } u ? arguments[2] === arguments[4] ? f(h.format(arguments)) : f(c.format(arguments)) : f(" ") }, error: function () { o("") } }) } }) }; i.prototype.getTrxInfo = function (i, r, u) { var e, f, l, a, v, y, p; if (i.startsWith("VAB_Order") || i.startsWith("VAB_Invoice")) { var e, h = i.startsWith("VAB_Order"), o = null, s = null; try { o = new n.MessageFormat(n.Msg.getMsg("OrderSummary")); s = new n.MessageFormat(n.Msg.getMsg("OrderSummaryMC")) } catch (w) { } if (o == null || s == null) return " "; var arguments = [], c = !1, f = null; try { e = 0; e = h ? r.getContextAsInt(u, "VAB_Order_ID") : r.getContextAsInt(u, "VAB_Invoice_ID"); f = null; t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetTrxInfo", data: { Record_ID: e, isOrder: h }, success: function (t) { f = (new n.DB.DataReader).toJson(t) } }); f.read() && (l = f.getInt(0), arguments[0] = l, a = f.getDecimal(2).toLocaleString(), arguments[1] = a, v = f.getDecimal(3).toLocaleString(), arguments[2] = v, y = f.getString(1), arguments[3] = y, p = f.getDecimal(4).toLocaleString(), arguments[4] = p, arguments[5] = r.getContext("$CurrencyISO"), c = !0) } catch (w) { } finally { f != null && f.dispose() } return c ? arguments[2] === arguments[4] ? o.format(arguments) : s.format(arguments) : " " } }; i.prototype.getIsProcessed = function () { var i = this.gridTable.findColumn("Processed"), t; if (i != -1) { if (t = this.gridTable.getValueAt(this.currentRow, i), typeof t == "string") return "Y".equals(t); if (typeof t == "boolean") return t } return "Y".equals(n.context.getWindowContext(this.vo.windowNo, this.vo.tabNo, "Processed")) }; i.prototype.getKeyColumnName = function () { return this.keyColumnName }; i.prototype.getVAF_ColumnSortOrder_ID = function () { return this.vo.VAF_ColumnSortOrder_ID }; i.prototype.getIsMapView = function () { return this.vo.locationCols && this.vo.locationCols.length > 0 ? !0 : !1 }; i.prototype.getMapColumns = function () { return this.vo.locationCols }; i.prototype.getVAF_ColumnSortYesNo_ID = function () { return this.vo.VAF_ColumnSortYesNo_ID }; i.prototype.getWhereClause = function () { return this.vo.WhereClause }; i.prototype.getSearchQuery = function (t) { for (var r = null, f = this.getFields(), i = null, u = 0; u < f.length; u++)(i = f[u], i.getIsVirtualColumn()) || i.getColumnName().toLowerCase() != "export_id" && n.DisplayType.IsText(i.getDisplayType()) && (r || (r = new n.Query(this.getTableName(), !0)), r.addRestriction(i.getColumnName(), n.Query.prototype.LIKE, t, i.getColumnName(), t)); return f = null, i = null, r }; i.prototype.getParentColumnNames = function () { return this.parents }; i.prototype.clearSelectedRow = function () { for (var i = this.gridTable.getFields().length, t, n = 0; n < i; n++)t = this.gridTable.getField(n), t.getIsKey() ? t.setValue(null, !1) : t.setNullValue() }; i.prototype.setCurrentRow = function (n, t) { var f = -1, c = this.verifyRow(n), r, s, u, i, h, o; for (this.currentRow = c, r = this.gridTable.getRow(this.currentRow), r && (f = r.recid), s = this.gridTable.getFields().length, u = 0; u < s; u++)i = this.gridTable.getField(u), r ? (h = r[i.getColumnName().toLowerCase()], i.setValue(h, this.gridTable.getIsInserting())) : i.getIsKey() ? i.setValue(null, !1) : i.setNullValue(); return t ? (this.mDataStatusEvent == null && (this.mDataStatusEvent = new e(null, this.getRowCount(), this.gridTable.getIsInserting(), !1, this.gridTable.getIsInserting()), this.mDataStatusEvent.setPageInfo(this.gridTable.currentPage, this.gridTable.rowCount, this.gridTable.pazeSize)), this.mDataStatusEvent.setCurrentRow(this.currentRow), o = this.mDataStatusEvent.getVAF_Msg_Lable(), (o == null || o.length == 0) && this.mDataStatusEvent.setInfo("NavigateOrUpdate", null, !1, !1), this.fireDataStatusChanged(this.mDataStatusEvent), f) : f }; i.prototype.fireDataStatusEventOnly = function () { this.mDataStatusEvent == null && (this.mDataStatusEvent = new e(null, this.getRowCount(), this.gridTable.getIsInserting(), !1, this.gridTable.getIsInserting()), this.mDataStatusEvent.setPageInfo(this.gridTable.currentPage, this.gridTable.rowCount, this.gridTable.pazeSize)); this.mDataStatusEvent.setCurrentRow(this.currentRow); var n = this.mDataStatusEvent.getVAF_Msg_Lable(); (n == null || n.length == 0) && this.mDataStatusEvent.setInfo("NavigateOrUpdate", null, !1, !1); this.fireDataStatusChanged(this.mDataStatusEvent) }; i.prototype.setQuery = function (t) { t == null ? this.query = new n.Query : (this.query = t, this.vo.onlyCurrentDays = 0) }; i.prototype.setValue = function (t, i) { var r, u; if (!(t instanceof n.GridField)) { if (t == null) return "NoColumn"; t = this.gridTable.getField(t) } return t == null ? "NoField" : (r = t.getDisplayType(), i == null || i.toString() == "" ? i = null : i === 0 && (n.DisplayType.IsID(r) || r == n.DisplayType.List) && !this.getIsStdColumn(t.getColumnName().toUpper()) && (i = null), u = this.gridTable.findColumn(t.getColumnName()), this.gridTable.setValueAt(i, this.currentRow, u, !1), this.processFieldChange(t)) }; i.prototype.getIsStdColumn = function (n) { return n == "VAF_USERCONTACT_ID" || n == "VAF_ROLE_ID" || n == "VAF_CLIENT_ID" || n == "VAF_ORG_ID" ? !0 : !1 }; i.prototype.addDataStatusListener = function (n) { this.mDataListenerList.push(n) }; i.prototype.removeDataStatusListener = function (n) { for (var t = this.mDataListenerList.length - 1; t >= 0; t--)this.mDataListenerList[t] === n && (this.mDataListenerList[t] = null, this.mDataListenerList.splice(t, 1)) }; i.prototype.needSave = function (n, t) { return n ? this.gridTable.needSave(-2, t) : t ? this.gridTable.needSave() : this.gridTable.needSave(t) }; i.prototype.loadFields = function () { for (var t, n, i, e, f, u = 0; u < this.gTab._gridTable.m_fields.length; u++) { for (t = new r(this.gTab._gridTable.m_fields[u]), t.setGridTab(this), this.gridTable.gridFields.push(t), n = t.getColumnName(), t.getIsKey() && (this.keyColumnName = n, this.gridTable.setKeyColumnName(n)), t.getIsParentColumn() && this.parents.push(n), i = t.getSortNo(), i == 0 || (Math.abs(i) == 1 ? (this.orderBys[0] = n, i < 0 && (this.orderBys[0] += " DESC")) : Math.abs(i) == 2 ? (this.orderBys[1] = n, i < 0 && (this.orderBys[1] += " DESC")) : Math.abs(i) == 3 && (this.orderBys[2] = n, i < 0 && (this.orderBys[2] += " DESC"))), e = t.getDependentOn(), f = 0; f < e.length; f++)this.depOnFieldColumn.push(e[f]), this.depOnField.push(t); (n.equals("IsActive") || n.equals("Processed") || n.equals("Processing")) && (this.depOnFieldColumn.push(n), this.depOnField.push(null)); t = null } }; i.prototype.loadTabPanels = function () { var n, t; if (this.gTab._panels && this.gTab._panels.length > 0) for (this.hasPanel = !0, n = 0; n < this.gTab._panels.length; n++)t = new s(this.gTab._panels[n]), this.tabPanels.push(t); else this.hasPanel = !1 }; i.prototype.loadHeaderPanelItems = function () { this.vo.HeaderItems && (this.isHeaderPanel = !0, headerPanel = this.vo.HeaderItems) }; i.prototype.getIsHeaderPanel = function () { return this.isHeaderPanel }; i.prototype.getHeaderPanelItems = function () { return headerPanel }; i.prototype.getHeaderHeight = function () { return this.vo.HeaderHeight && this.vo.HeaderHeight > 0 ? this.vo.HeaderHeight + "px" : "200px" }; i.prototype.getHeaderWidth = function () { return this.vo.HeaderWidth && this.vo.HeaderWidth > 0 ? this.vo.HeaderWidth + "px" : "250px" }; i.prototype.getHeaderBackColor = function () { return this.vo.HeaderBackColor }; i.prototype.getHeaderPadding = function () { return this.vo.HeaderPadding }; i.prototype.getHeaderHorizontal = function () { return this.vo.HeaderAlignment.equals("H") ? !0 : !1 }; i.prototype.getHasPanel = function () { return this.hasPanel }; i.prototype.getTabPanels = function () { return this.tabPanels }; i.prototype.validateQuery = function (t) { var i, r, s, f, c, e, u, v, l; if (t == null || t.getRestrictionCount() == 0) return null; if (t.getRestrictionCount() != 1 || (i = t.getColumnName(0), i == null) || i.indexOf("(") != -1) return t.getWhereClause(); if (r = null, i.equals("VAR_RequestRelated_ID") ? r = "VAR_Request_ID" : i.startsWith("VAB_DocTypes") ? r = "VAB_DocTypes_ID" : i.equals("CreatedBy") || i.equals("UpdatedBy") ? r = "VAF_UserContact_ID" : i.equals("Orig_Order_ID") ? r = "VAB_Order_ID" : i.equals("Orig_InOut_ID") && (r = "VAM_Inv_InOut_ID"), r != null) { if (this.getField(r) != null) return t.setColumnName(0, r), t.getWhereClause(); r = null } if (this.getField(i) != null) return t.getWhereClause(); s = "VIS_104"; u = []; u[0] = new n.DB.SqlParam("@colName", i); f = null; try { f = h(s, u); f.read() && (r = f.getString(0)) } catch (a) { return this.log.log(o.SEVERE, "(ref) - Column=" + i, a), t.getWhereClause() } finally { f != null && f.dispose() } if (r != null) { if (t.setColumnName(0, r), this.getField(r) != null) return this.log.fine("Column " + i + " replaced with " + r), t.getWhereClause(); i = r } c = null; e = this.getKeyColumnName(); s = "VIS_105"; u = []; u[0] = new n.DB.SqlParam("@colName", i); u[1] = new n.DB.SqlParam("@tabKeyColumn", e); try { f = h(s, u); f.read() && (c = f.getString(0)) } catch (a) { return this.log.log(o.SEVERE, "Column=" + i + ", Key=" + e, a), null } finally { f != null && f.dispose() } return e.equals("VAF_Control_Ref_ID") ? (s = "VIS_106", u = [], u[0] = new n.DB.SqlParam("@colName", i), v = k(s, u), "VAF_Control_Ref_ID=" + v) : c == null ? (this.log.info("Not successfull - Column=" + i + ", Key=" + e + ", Query=" + t), t.getWhereClause()) : (t.setTableName("xx"), l = "EXISTS (SELECT * FROM " + c + " xx WHERE " + t.getWhereClause(!0) + " AND xx." + e + "=" + this.getTableName() + "." + e + ")", this.log.fine(l), l) }; i.prototype.setTreeNodeID = function (n) { this.treeNode_ID = n; this.gridTable.treeNode_ID = n }; i.prototype.setTreeID = function (n) { this.treeID = n; this.gridTable.treeID = n }; i.prototype.setTreeTable = function (n) { this.treeTable_ID = n; this.gridTable.treeTable_ID = n }; i.prototype.setShowSummaryNodes = function (n) { this.ShowSummaryNodes = n; this.gridTable.ShowSummaryNodes = n }; i.prototype.setIsZoomAction = function (n) { this.isZoomAction = n; this.gridTable.isZoomAction = n }; i.prototype.getIsZoomAction = function () { return this.isZoomAction }; i.prototype.prepareQuery = function (t, i, r, u) { var v = !0, w = !1, h, f, y, s, e, p, k, c, a, o, l; if (n.context.clearTabContext(this.vo.windowNo, this.vo.tabNo), h = this.oldQuery.equals(this.query.getWhereClause()) && this.vo.onlyCurrentDays == t, this.getIsTreeTab() && (this.getShowSummaryLevel() || this.gridTable.setDoPaging(!1), this.getShowSummaryLevel() && (this.gridTable.setDoPaging(!0), h = !1)), this.oldQuery = this.query.getWhereClause(), this.vo.onlyCurrentDays = t, f = "", u || (f += this.vo.WhereClause), !this.ShowSummaryNodes && this.getShowSummaryLevel() && (f += f.length > 0 ? " AND IsSummary='N'" : " IsSummary='N'"), this.getOnlyCurrentDays() > 0 && (f.length > 0 && (f += " AND "), y = this.findColumn("Processed") != -1, y && (f += "(Processed='N' OR "), f += r ? "Created>=" : "Updated>=", f += "addDays(SysDate, -" + this.vo.onlyCurrentDays + ")", y && (f += ")")), this.isThroughRoleCenter || this.getIsDetail() && (s = this.getLinkColumnName(), s.equals("") ? (f.length > 0 && (f += " AND "), f += " 2=3", v = !1) : (e = "", e = this.vo.tabNo > 0 ? n.context.getTabRecordContext(this.vo.windowNo, this.getParentTabNo(), s, !0) : n.context.getTabRecordContext(this.vo.windowNo, this.getParentTabNo(), s), h && (h = this.linkValue.equals(e), w = !h), this.linkValue = e, e.length == 0 ? (f.length > 0 && (f += " AND "), f += " 2=4", v = !1) : (f.length > 0 && (f += " AND "), "NULL".equals(e.toUpper()) ? f += s + " IS NULL " : (f += s + "=", f += s.endsWith("_ID") ? e : "'" + e + "'")))), this.extendedWhere = f.toString(), this.query.getIsActive() && (p = this.validateQuery(this.query), p == null || w || (f.length > 0 && (f += " AND "), f += p)), this.mDataStatusEvent = null, this.gridTable.getIsOpen()) h ? this.gridTable.dataRefreshAll() : this.gridTable.dataRequery(f.toString()); else { if (!this.isZoomAction && (k = "VIS_107", c = [], c[0] = new n.DB.SqlParam("@VAF_UserContact_ID", n.Env.getCtx().getVAF_UserContact_ID()), c[1] = new n.DB.SqlParam("@VAF_Client_ID", n.Env.getCtx().getVAF_Client_ID()), c[2] = new n.DB.SqlParam("@VAF_Tab_ID", this.gridTable.VAF_Tab_ID), c[3] = new n.DB.SqlParam("@VAF_TableView_ID", this.gridTable.VAF_TableView_ID), a = "", o = b(k, c), o && o.tables[0].rows && o.tables[0].rows.length > 0)) { for (l = 0; l < o.tables[0].rows.length; l++)n.Env.getCtx().getVAF_UserContact_ID() == o.tables[0].rows[l].cells.VAF_UserContact_id && this.gridTable.VAF_Tab_ID == o.tables[0].rows[l].cells.vaf_tab_id && (a = o.tables[0].rows[l].cells.code); a && (f = f.length > 0 ? f + " AND " + a : a) } this.gridTable.setSelectWhereClause(f.toString()); this.gridTable.open(i) } return v }; i.prototype.dataRefresh = function () { var n = this.currentRow, t = this.gridTable.dataRefresh(n); return this.setCurrentRow(n, !0), t }; i.prototype.dataRefreshAll = function () { this.mDataStatusEvent = null; this.getTableModel().dataRefreshAll() }; i.prototype.dataIgnore = function () { this.gridTable.dataIgnore(!0) && (this.setCurrentRow(this.currentRow, !1), this.currentRow < 0 && (this.currentRow = 0), this.gridTable.fireDataStatusIEvent("Ignored", "")) }; i.prototype.getLinkWhereClause = function () { var t = "", i, r; return this.getIsDetail() && (i = this.getLinkColumnName(), i.equals("") ? (t.length > 0 && (t += " AND "), t += " 2=3") : (r = n.context.getTabRecordContext(this.vo.windowNo, this.getParentTabNo(), i, !0), i = this.getTableName() + "." + i, r.length == 0 ? (t.length > 0 && (t += " AND "), t += " 2=4") : (t.length > 0 && (t += " AND "), "NULL".equals(r.toUpper()) ? t += i + " IS NULL " : (t += i + "=", t += i.endsWith("_ID") ? r : "'" + r + "'")))), t }; i.prototype.SetSelectedNode = function (n) { this.gridTable.selectedTreeNode = n }; i.prototype.dataSave = function (t) { try { var i = this.gridTable.dataSave(t) == n.GridTable.prototype.SAVE_OK; return t && this.setCurrentRow(this.currentRow, !1), i, i } catch (r) { this.log.log(n.Logging.Level.SEVERE, "#" + this.vo.tabNo + " - row=" + this.currentRow, r) } return !1 }; i.prototype.dataNew = function (t) { var r, u, f, i; if (!this.getIsInsertRecord()) return this.log.warning("Insert Not allowed in TabNo=" + this.vo.tabNo), null; if (this.vo.tabNo > 0) { if (r = "Y".equals(n.context.getWindowContext(this.vo.windowNo, "Processed")), r) return this.log.warning("Not allowed in TabNo=" + this.vo.tabNo + " -> Processed=" + r), null; this.log.finest("Processed=" + r) } if (u = this.gridTable.dataNew(this.currentRow, t), !u) return u; for (this.setCurrentRow(this.currentRow + 1, !0), f = this.getFieldCount(), this.gridTable.setDisableNotification(!0), i = 0; i < f; i++)this.processCallout(this.getField(i)); for (i = 0; i < f; i++)this.getField(i).setError(!1); return this.gridTable.setDisableNotification(!1), this.gridTable.fireDataStatusIEvent(t ? "UpdateCopied" : "Insertdata", ""), u }; i.prototype.dataDelete = function (n) { var t = this.gridTable.dataDelete(n, this.currentRow); return this.setCurrentRow(this.currentRow, !0), t }; i.prototype.findColumn = function (n) { return this.gridTable.findColumn(n) }; i.prototype.navigate = function (n, t, i) { var u = -1, r = null; return !i && (n === this.currentRow || (r = this.verifyRow(n), r === this.currentRow)) ? u : (r = r != null ? r : this.currentRow, this.gridTable.dataSave(r, !1) && (u = this.setCurrentRow(r, t)), u) }; i.prototype.verifyRow = function (n) { var t = n, i; return this.gridTable.getIsOpen() ? (i = this.getRowCount(), i == 0) ? -1 : (t >= i ? t = i - 1 : t < 0 && (t = 0), t) : -1 }; i.prototype.navigateRelative = function (n) { return this.navigate(this.currentRow + n) }; i.prototype.hasDependants = function (n) { return this.depOnFieldColumn.indexOf(n) !== -1 }; i.prototype.dataStatusChanged = function (n) { var i = n.getCurrentRow(), r = n.getVAF_Msg_Lable(), t; n.setCurrentRow(this.currentRow); this.mDataStatusEvent = n; i == this.currentRow ? (t = this.gridTable.getField(n.getChangedColumn()), t != null) : this.fireDataStatusChanged(this.mDataStatusEvent) }; i.prototype.fireDataStatusChanged = function (n) { var u = this.mDataListenerList, t, i, f, r; if (u.length != 0) { if (n.getCurrentRow() >= 0) { if (n.Created = this.getValue("Created"), n.CreatedBy = this.getValue("CreatedBy"), n.Updated = this.getValue("Updated"), n.UpdatedBy = this.getValue("UpdatedBy"), n.Record_ID = this.getKeyID(n.getCurrentRow()), t = new StringBuilder(this.getTableName()), this.keyColumnName != null && this.keyColumnName.length > 0) t.append(" - ").append(this.keyColumnName).append("=").append(n.Record_ID); else for (i = 0; i < this.parents.length; i++)f = this.parents[i], t.append(" - ").append(f).append("=").append(this.getValue(f)); n.Info = t.toString() } for (n.setInserting(this.gridTable.getIsInserting()), r = 0; r < u.length; r++)u[r].dataStatusChanged(n) } }; i.prototype.processFieldChange = function (n) { return this.processDependencies(n), this.processCallout(n) }; i.prototype.processDependencies = function (t) { var r = t.getColumnName(), f, u, i, e; if (this.hasDependants(r)) for (f = this.getDependantFields(r), u = 0; u < f.length; u++) { if (i = f[u], i != null && i.getLookup() instanceof n.MLookup && (e = i.getLookup(), e.getValidation().indexOf("@" + r + "@") != -1)) if (r == "VAB_BusinessPartner_ID" && i.getColumnName() == "VAB_BPart_Location_ID") continue; else this.log.fine(r + " changed - " + i.getColumnName() + " set to null"), this.setValue(i, null); i != null && i.getLookup() instanceof n.MLocatorLookup } }; i.prototype.processCallout = function (t) { var l = t.getCallout(), e, i; if (l.length == 0 || this.getIsProcessed()) return ""; for (var v = t.getValue(), y = t.getOldValue(), a = new n.StringTokenizer(l, ";,", !1); a.hasMoreTokens();) { var u = a.nextToken().trim(), h = null, f = null, r = u, c = u.lastIndexOf("."); try { c != -1 && (r = u.substring(0, c).replace("ViennaAdvantage", "VIS").replace("VAdvantage", "VIS"), e = n.Utility.getFunctionByName(r, window), e || r.startsWith("VIS") || (r = "VIS" + r.substring(r.indexOf(".")), e = n.Utility.getFunctionByName(r, window)), h = new e, f = u.substring(c + 1)) } catch (s) { return this.log.log(o.SEVERE, r, s), "Callout Invalid: " + r + " (" + s.toString() + ")" } if (h == null || f == null || f.length == 0) return "Callout Invalid: " + f; i = ""; try { i = h.start(n.context, f, this.vo.windowNo, this, t, v, y) } catch (s) { return this.log.log(n.Logging.Level.SEVERE, "start", s), i = "Callout Invalid: " + s.toString() } if (i && !i.toString().equals("")) return i instanceof Error && (i = i.toString() + "-> " + u), this.log.warning(i), i } return "" }; i.prototype.getFieldCount = function () { return this.gridTable.getColumnCount() }; i.prototype.getCM_ChatID = function () { var t; return ((this.chats == null || this.chats.length == 0) && this.loadChats(), this.chats == null) ? 0 : (t = this.getRecord_ID(), this.hasKey(this.chats, t)) ? n.Utility.Util.getValueOfInt(this.getKeyValue(this.chats, t)) : 0 }; i.prototype.getVACM_SubscribedID = function () { var t; return ((this._subscribe == null || this._subscribe.length == 0) && this.loadSubscribe(), this._subscribe == null) ? 0 : (t = this.getRecord_ID(), this.hasKey(this._subscribe, t)) ? n.Utility.Util.getValueOfInt(this.getKeyValue(this._subscribe, t)) : 0 }; i.prototype.hasKey = function (n, t) { for (var i = 0; i < n.length; i++)if (n[i].ID === t) return !0; return !1 }; i.prototype.getKeyValue = function (n, t) { for (var i = 0; i < n.length; i++)if (n[i].ID === t) return n[i].value; return 0 }; i.prototype.getCommitWarning = function () { return this.vo.CommitWarning }; i.prototype.getField = function (n) { return this.gridTable.getField(n) }; i.prototype.dispose = function () { if (this.gTab = null, this.vo = null, this.gridTable.removeDataStatusListener(this), this.gridTable.dispose(), this.gridTable = null, this.mDataListenerList != null) for (var n = this.mDataListenerList.length - 1; n >= 0; n--)this.mDataListenerList[n] = null, this.mDataListenerList.splice(n, 1) }; i.prototype.getIsLocked = function () { if (!n.MRole.getIsPersonalLock() || this.isDataLoading || (this._Lock == null && this.loadLocks(), this._Lock == null || this._Lock.length == 0)) return !1; var t = this.getRecord_ID(); return this._Lock.indexOf(t) > -1 }; i.prototype.loadLocks = function () { var f = n.context.getVAF_UserContact_ID(), r, i, t, u; if (this.canHaveAttachment()) { r = "VIS_108"; i = []; i[0] = new n.DB.SqlParam("@VAF_UserContact_ID", f.toString()); i[1] = new n.DB.SqlParam("@VAF_TableView_ID", this.vo.VAF_TableView_ID.toString()); t = null; try { for (this._Lock == null ? this._Lock = [] : this._Lock.length = 0, t = h(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.get("Record_ID")), this._Lock.push(u); t.close(); t = null } catch (e) { this.log.log(o.SEVERE, r, e) } this.log.fine("#" + this._Lock.length) } }; i.prototype.loadSubscribe = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_109"; i = []; i[0] = new n.DB.SqlParam("@VAF_UserContact_ID", n.context.getVAF_UserContact_ID()); i[1] = new n.DB.SqlParam("@VAF_TableView_ID", this.getVAF_TableView_ID()); t = null; try { for (this._subscribe = [], this._subscribe == null ? this._subscribe = {} : this._subscribe.length = 0, t = h(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this._subscribe.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.loadDocuments = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_110"; i = []; i[0] = new n.DB.SqlParam("@vaf_tableview_id", this.getVAF_TableView_ID()); t = null; try { for (this.viewDocument = [], this.viewDocument == null ? this.viewDocument = {} : this.viewDocument.length = 0, t = h(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this.viewDocument.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.loadChats = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_111"; i = []; i[0] = new n.DB.SqlParam("@VAF_TableView_ID", this.getVAF_TableView_ID()); t = null; try { for (this.chats = [], this.chats == null ? this.chats = {} : this.chats.length = 0, t = h(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this.chats.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.canHaveAttachment = function () { return this.keyColumnName.endsWith("_ID") ? !0 : !1 }; i.prototype.hasChat = function () { if (this.isDataLoading || (this.chats == null && this.loadChats(), this.chats == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this.chats, n) }; i.prototype.hasDocument = function () { if (this.isDataLoading || (this.viewDocument == null && this.loadDocuments(), this.viewDocument == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this.viewDocument, n) }; i.prototype.HasSubscribed = function () { if (this.isDataLoading || (this._subscribe == null && this.loadSubscribe(), this._subscribe == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this._subscribe, n) }; i.prototype.loadAttachments = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_112"; i = []; i[0] = new n.DB.SqlParam("@VAF_TableView_ID", this.getVAF_TableView_ID()); t = null; try { for (this._attachments = [], t = h(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this._attachments.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.loadMarking = function () { var i = [], t, r, u; i[0] = new n.DB.SqlParam("@VAF_TableView_ID", this.getVAF_TableView_ID()); t = null; try { for (this._marking = [], t = h("VIS_113", i); t.read();)r = n.Utility.Util.getValueOfInt(t.getString(1)), u = n.Utility.Util.getValueOfInt(t.getString(0)), this._marking.push({ ID: r, value: u }); t = null } catch (f) { } }; i.prototype.hasAttachment = function () { if (this.isDataLoading || (this._attachments == null && this.loadAttachments(), this._attachments == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this._attachments, n) }; i.prototype.hasMarked = function () { if (this.isDataLoading || (this._marking == null && this.loadMarking(), this._marking == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this._marking, n) }; i.prototype.loadData = function () { this.isDataLoading = !1; this.isExportLoading = !1; this._attachments = this.gTab._attachments; this.chats = this.gTab._chats; this._lock = this.gTab._pAccess; this._subscribe = this.gTab._subscribe; this.viewDocument = this.gTab._documents }; i.prototype.locks = function (t, i, r) { var u = t.getVAF_UserContact_ID(); n.dataContext.updateInsertLocks(u, this.vo.VAF_TableView_ID, i, r); this.loadLocks() }; i.prototype.setRecordStatus = function (n) { var t = n }; u.prototype.ctx = n.context; u.prototype.SAVE_OK = "O"; u.prototype.SAVE_ERROR = "E"; u.prototype.SAVE_ACCESS = "A"; u.prototype.SAVE_MANDATORY = "M"; u.prototype.SAVE_ABORT = "U"; u.prototype.SAVE_REGEX_ERROR = "R"; u.prototype.getReadOnly = function () { return !1 }; u.prototype.setVAF_Tab_ID = function (n) { this.VAF_Tab_ID = n }; u.prototype.getField = function (n) { var r, t, i; if (isNaN(n)) { if (n == null || n.length == 0) return null; for (r = this.gridFields.length, t = 0; t < r; t++)if (i = this.gridFields[t], n.equals(i.getColumnName(), !0)) return i; return null } return n < 0 || n >= this.gridFields.length ? null : this.gridFields[n] }; u.prototype.getFieldById = function (n) { var r, t, i; if (n < 1) return null; for (r = this.gridFields.length, t = 0; t < r; t++)if (i = this.gridFields[t], n === i.getVAF_Field_ID()) return i; return null }; u.prototype.getIsInserting = function () { return this.inserting }; u.prototype.getColumnCount = function () { return this.gridFields.length }; u.prototype.getFields = function () { return this.gridFields }; u.prototype.getWhereClause = function (t) { for (var h = this.gridFields.length, s = null, u = null, f, i, r, e = 0; e < h; e++)if (f = this.gridFields[e], f.getIsKey()) { if (i = f.getColumnName().toLowerCase(), r = t[i], r == null) return this.log.log(n.Logging.Level.WARNING, "PK data is null - " + i), null; s = i.toUpperCase().endsWith("_ID") ? new StringBuilder(i).append("=").append(r) : new StringBuilder(i).append("=").append(n.DB.to_string(r.toString())) } else if (f.getIsParentColumn()) { if (i = f.getColumnName().toLowerCase(), r = t[i], r == null) { this.log.log(o.INFO, "FK data is null - " + i); continue } u == null ? u = new StringBuilder : u.append(" AND "); i.toUpperCase().endsWith("_ID") ? u.append(i).append("=").append(r) : u.append(i).append("=").append(n.DB.to_string(r.toString())) } return s != null ? s.toString() : u != null ? u.toString() : (this.log.log(o.WARNING, "No key Found"), null) }; u.prototype.getIsOpen = function () { return this.isOpen }; u.prototype.getTableID = function () { return this.gTable._VAF_TableView_ID }; u.prototype.getDataTable = function () { return this.bufferList }; u.prototype.getSortModel = function () { return this.mSortList }; u.prototype.getRow = function (n) { return this.mSortList[n] }; u.prototype.getRowCount = function () { return this.mSortList ? this.mSortList.length : this.bufferList ? this.bufferList.length : 0 }; u.prototype.getTotalRowCount = function () { return this.rowCount }; u.prototype.getValueAt = function (n, t) { var i = this.getRow(n); return i && t in i ? i[t] : null }; u.prototype.checkMaxMin = function () { for (var o = new StringBuilder, e = this.gridFields.length, r = "", u = "", i, f = 0; f < e; f++)if (i = this.gridFields[f], n.DisplayType.IsNumeric(i.getDisplayType())) if (r = i.getMaxValue(), u = i.getMinValue(), t.isNumeric(r) && t.isNumeric(u)) { if (i.getValue() > i.getMaxValue() || i.getValue() < i.getMinValue()) return n.ADialog.error("ValidationError", !0, ": " + n.Msg.getMsg("VIS_ValueOf") + " " + i.getHeader() + " " + n.Msg.getMsg("VIS_MustBetween") + " " + i.getMinValue() + " " + n.Msg.getMsg("VIS_And") + " " + i.getMaxValue()), !1 } else if (t.isNumeric(r)) { if (i.getValue() > r) return n.ADialog.error("ValidationError", !0, ": " + n.Msg.getMsg("VIS_ValueOf") + " " + i.getHeader() + " " + n.Msg.getMsg("VIS_Lessthan") + " " + r), !1 } else if (t.isNumeric(u) && i.getValue() < u) return n.ADialog.error("ValidationError", !0, ": " + n.Msg.getMsg("VIS_ValueOf") + " " + i.getHeader() + " " + n.Msg.getMsg("VIS_Greaterthan") + " " + u), !1; return !0 }; u.prototype.getMandatory = function (n) { for (var i = new StringBuilder, f = this.gridFields.length, t, u, r = 0; r < f; r++)t = this.gridFields[r], t.getIsMandatory(!0) && (u = t.getColumnName().toLowerCase(), (n[u] == null || n[u].toString().length == 0) && (t.setInserting(!0), t.setError(!0), i.length() > 0 && i.append(", "), i.append(t.getHeader()))); return i.length() == 0 ? "" : i.toString() }; u.prototype.getErrorColumns = function () { for (var n = new StringBuilder, r = this.gridFields.length, i, t = 0; t < r; t++)i = this.gridFields[t], i.getIsError() && (n.length() > 0 && n.append(", "), n.append(i.getHeader())); return n.length() == 0 ? "" : n.toString() }; u.prototype.getClientOrg = function (n) { var u = -1, t, i, r; return this.gTable._indexClientColumn != -1 && (t = this.getValueAt(n, "vaf_client_id"), t != null && (u = t)), i = 0, this.gTable._indexOrgColumn != -1 && (r = this.getValueAt(n, "vaf_org_id"), r != null && (i = r)), [u, i] }; u.prototype.getKeyID = function (n) { if (this.gTable._indexKeyColumn != -1) try { var t = this.getValueAt(n, this.keyColumnName.toLowerCase()); return t == null || isNaN(t) ? -1 : t } catch (i) { return -1 } return -1 }; u.prototype.setKeyColumnName = function (n) { this.keyColumnName = n }; u.prototype.setTableName = function (n) { this.isOpen || n != null && n.length != 0 && (this.gTable._tableName = n) }; u.prototype.setReadOnly = function (n) { this.readOnly = n }; u.prototype.setDeleteable = function (n) { this.gTable._deleteable = n }; u.prototype.setOrderClause = function (n) { this.gTable._orderClause = n; this.gTable._orderClause == null && (this.gTable._orderClause = "") }; u.prototype.setSelectWhereClause = function (n) { return this.isOpen ? !1 : (this.gTable._whereClause = n, this.gTable._whereClause == null && (this.gTable._whereClause = ""), !0) }; u.prototype.setDoPaging = function (n) { this.dopaging = n }; u.prototype.setCurrentPage = function (n) { this.currentPage = n }; u.prototype.setCurrentPageRelative = function (n) { var t = this.currentPage; isNaN(n) ? t = Math.ceil(this.rowCount / this.pazeSize) : n !== 0 ? t += n : t = 1; this.currentPage = t }; u.prototype.setSortModel = function (n) { this.mSortList = null; this.mSortList = n }; u.prototype.setValueAt = function (n, i, r, u) { var f, e, o, s; !this.isOpen || i < 0 || r < 0 || this.rowCount == 0 || (f = this.getField(r), e = this.getValueAt(i, f.getColumnName().toLowerCase()), u || (e != null || n != null) && e !== n) && (o = this.getRow(i), this.rowChanged = i, this.rowData == null && (this.rowData = {}, t.extend(this.rowData, o)), f.setValue(n, this.inserting), o[f.getColumnName().toLowerCase()] = n, this.disableNotification || (s = this.createDSE(), s.setChangedColumn(r, f.getColumnName()), this.fireDataStatusChanged(s))) }; u.prototype.setDisableNotification = function (n) { this.disableNotification = n }; u.prototype.needSave = function (n, t) { var i = n, r = t; return (arguments.length == 0 ? (i = this.rowChanged, r = !1) : arguments.length == 1 ? (i = arguments[0], r = !1) : (i = arguments[0], r = arguments[1]), typeof this.changed == "undefined" || !this.changed && (this.rowChanged == -1 || typeof this.rowChanged == "undefined")) ? !1 : this.changed && (typeof this.rowChanged == "undefined" || this.rowChanged == -1) && r ? !1 : i == this.rowChanged ? !1 : !0 }; u.prototype.findColumn = function (n) { for (var i = this.gridFields, r, t = 0; t < i.length; t++)if (r = i[t], n.equals(r.getColumnName(), !0)) return t; return -1 }; u.prototype.createSelectSql = function () { var t = this.gTable, h, i, r, c, e, u; if (this.gridFields.length == 0 || t._tableName == null || t._tableName.equals("")) return ""; var o = new StringBuilder("SELECT "), f = null, s = null; for (h = 0; h < this.gridFields.length; h++)h > 0 && o.append(", "), i = this.gridFields[h], s = i.getColumnSQL(!0), s.indexOf("@") == -1 ? o.append(s) : o.append(n.Env.parseContext(this.ctx, t._windowNo, s, !1)), i.getLookup() != null && i.getLookup() instanceof n.MLookup && (r = i.getLookup().info, r.displayColSubQ && r.displayColSubQ != "" && (f == null ? f = new StringBuilder("SELECT ") : f.append(","), c = r.queryDirect.substring(r.queryDirect.lastIndexOf(" FROM " + r.tableName + " ")), c = i.getIsVirtualColumn() ? c.replace("@key", i.getColumnSQL(!1)) : c.replace("@key", t._tableName + "." + i.getColumnSQL()), f.append("( SELECT (").append(r.displayColSubQ).append(") ").append(c).append(" ) AS ").append(i.getColumnSQL() + "_T").append(",").append(i.getColumnSQL(!0)))); return s = null, o.append(" FROM ").append(t._tableName), this.SQL_Select = o.toString(), this.SQL_Count = "SELECT COUNT(*) FROM " + t._tableName, e = new StringBuilder(""), u = t._whereClause, u.length > 0 && (e.append(" WHERE "), u.indexOf("@") == -1 ? e.append(u) : e.append(n.Env.parseContext(this.ctx, t._windowNo, u, !1)), u.toUpperCase().indexOf("=NULL") > 0 && this.log.Severe("Invalid NULL - " + _tableName + "=" + u)), this.SQL = this.SQL_Select + e.toString(), this.SQL_Count += e.toString(), t._withAccessControl && (this.SQL = n.MRole.addAccessSQL(this.SQL, t._tableName, n.MRole.SQL_FULLYQUALIFIED, n.MRole.SQL_RO), this.SQL_Count = n.MRole.addAccessSQL(this.SQL_Count, t._tableName, n.MRole.SQL_FULLYQUALIFIED, n.MRole.SQL_RO)), this.SQL_Direct = f != null ? f.toString() + " " + this.SQL_Count.substring(this.SQL_Count.indexOf(" COUNT(*) FROM") + 9) : "", t._orderClause.equals("") || (this.SQL += " ORDER BY " + t._orderClause, this.SQL_Direct += " ORDER BY " + t._orderClause), this.ctx.setWindowTabContext(t._windowNo, t._tabNo, "SQL", this.SQL), this.SQL }; u.prototype.open = function (i) { if (this.maxRows = i, this.isOpen) return this.dataRefreshAll(), !0; if (this.createSelectSql(), this.SQL == null || this.SQL.equals("")) return !1; this.rowCount = 0; var r = 0; return this.treeNode_ID > 0 ? t.ajax({ url: n.Application.contextUrl + "jsonData/GetRecordCountForTreeNode", data: { sqlIn: this.gTable._whereClause, VAF_TableView_ID: this.VAF_TableView_ID, treeID: this.treeID, treeNodeID: this.treeNode_ID, windowNo: this.gTable._windowNo, summaryOnly: this.ShowSummaryNodes }, type: "POST", async: !1, success: function (n) { r = JSON.parse(n) }, error: function () { } }) : r = d(this.SQL_Count, null), this.rowCount = r, this.rowCount > 0 ? (this.fillData(), this.isOpen = !0, this.changed = !1, this.rowChanged = -1) : (this.bufferList != null && (this.bufferList.length = 0), this.mSortList != null && (this.mSortList = null), this.currentPage = 1, this.isOpen = !0, this.changed = !1, this.rowChanged = -1, window.setTimeout(function (n) { n.fireQueryCompleted(!0) }, 300, this)), !0 }; u.prototype.fillData = function () { var t, r, i; this.pazeSize = n.Env.getWINDOW_PAGE_SIZE(); this.maxRows > 0 && this.rowCount > this.maxRows ? (this.pazeSize = this.maxRows, this.rowChanged = this.maxRows) : (!this.dopaging || this.pazeSize > this.rowCount) && (this.pazeSize = this.rowCount); this.dopaging && this.rowCount + this.pazeSize <= this.currentPage * this.pazeSize && --this.currentPage; this.bufferList.length = 0; t = this; this.SQL_Count = n.secureEngine.encrypt(this.SQL_Count); r = this.createGridFieldArr(this.gridFields, !0); i = { sql: this.SQL, page: this.dopaging ? this.currentPage : 0, pageSize: this.dopaging ? this.pazeSize : 0, treeID: 0, treeNode_ID: 0 }; i.sqlDirect = n.secureEngine.encrypt(this.SQL_Direct); i.sql = n.secureEngine.encrypt(i.sql); this.treeNode_ID > 0 && (i.treeID = this.treeID, i.treeNode_ID = this.treeNode_ID); n.dataContext.getWindowRecords(i, r, this.rowCount, this.SQL_Count, this.VAF_TableView_ID, function (i, r) { var c, h, f, e, s, u; try { if (i != null) { if (c = 0, i.getTables().length != 0) { for (h = i.getTable(0).getRows(), f = i.getTable(0).getColumnsName(), e = 0; e < h.length; e++) { for (s = h[e].getJSCells(), u = 0; u < f.length; u++)s[f[u]] = t.readDataOfColumn(f[u], s[f[u]]); t.bufferList[e] = s; c++ } console.log(i.getTable(0).lookupDirect) } i.dispose(); i = null } r && n.MLookupCache.addRecordLookup(t.gTable._windowNo, t.gTable._tabNo, r) } catch (l) { this.log.Log(o.SEVERE, t.SQL, l) } t.fireQueryCompleted(!0); t = null }) }; u.prototype.readDataOfColumn = function (t, i) { var f, u, r, o, e; if (i == null) return i; try { if (f = this.getField(t), f == null) return i; u = f.getColumnName(); r = f.getDisplayType(); n.DisplayType.IsID(r) && (u.endsWith("_ID") || u.endsWith("_Acct")) || u.endsWith("atedBy") || u.endsWith("_ID_1") || u.endsWith("_ID_2") || u.endsWith("_ID_3") || r == n.DisplayType.Integer ? i = n.Utility.Util.getValueOfInt(i) : n.DisplayType.IsNumeric(r) ? i = n.Utility.Util.getValueOfDecimal(i) : n.DisplayType.IsDate(r) ? dte = null : r == n.DisplayType.RowID ? i = null : r == n.DisplayType.YesNo ? (o = i.toString(), f.getIsEncryptedColumn() && (o = this.decrypt(o)), i = o.equals("Y")) : n.DisplayType.IsLOB(r) ? (e = i, e == null && (i = null), i = typeof e == typeof string ? e.toString() : e) : i = i.toString(); f.getIsEncryptedColumn() && r != n.DisplayType.YesNo && (i = this.decrypt(i)) } catch (s) { console.log(s) } return i }; u.prototype.encrypt = function (t) { return t == null || t.length < 1 ? t : n.secureEngine.encrypt(t) }; u.prototype.decrypt = function (t) { return t == null || t.length < 1 ? t : n.secureEngine.isEncrypted(t) ? n.secureEngine.decrypt(t) : t }; u.prototype.dataSave = function (n, t) { return arguments.length == 2 ? !this.changed && (typeof this.rowChanged == "undefined" || this.rowChanged == -1) ? !0 : n == this.rowChanged ? !0 : this.dataSaveL(t) == u.prototype.SAVE_OK : this.dataSaveL(t) }; u.prototype.dataSaveL = function (i) { var o, e, y, p, a, g, r, u, c, nt, f; if (!this.isOpen) return this.log.warning("Error - Open=" + this.isOpen), this.SAVE_ERROR; if (this.rowChanged == -1 && (this.log.config("NoNeed - Changed=" + this.changed + ", Row=" + this.rowChanged), !i)) return this.SAVE_OK; if (this.rowData == null) return this.log.fine("No Changes"), this.SAVE_ERROR; if (this.readOnly) return log.warning("IsReadOnly - ignored"), this.dataIgnore(), this.SAVE_ACCESS; if (this.rowChanged == -1) if (this.newRow != -1) this.rowChanged = this.newRow; else return this.fireDataStatusEEvent("SaveErrorNoChange", "", !1), this.SAVE_ERROR; var w = this.getClientOrg(this.rowChanged), b = w[0], k = w[1]; if (!n.MRole.canUpdate(b, k, this.VAF_TableView_ID, 0, !0)) return this.fireDataStatusEEvent("AccessTableNoUpdate", "", !0), this.dataIgnore(), this.SAVE_ACCESS; for (o = this.getRow(this.rowChanged), r = 0; r < this.gridFields.length; r++)if (e = this.gridFields[r], n.DisplayType.IsString(e.getDisplayType()) && e.value != null && e.value.toString().trim().length > 0 && !new RegExp(e.getVFormat()).test(e.value)) return this.fireDataStatusEEvent("RegexFailed", (e.getHeader() == "" ? e.getColumnName() : e.getHeader()) + "\n", !0), e.propertyChangeListner.ctrl.focus(), this.SAVE_ERROR; if (y = this.getMandatory(o), y.length != 0) return this.fireDataStatusEEvent("FillMandatory", y + "\n", !0), this.SAVE_MANDATORY; if (this.checkMaxMin()) { if (p = this.getErrorColumns(), p.length != 0) return this.fireDataStatusEEvent("Error", p + "\n", !0), this.SAVE_ERROR; a = 0; this.inserting || (a = this.getKeyID(this.rowChanged)); var d = [], v = this.gridFields, tt = v.length; d = this.createGridFieldArr(v); var s = this.createGridFieldArr(v, !0), l = {}, h = {}; if (t.extend(!0, l, o), t.extend(!0, h, this.rowData), s && s.length > 0) for (g = s.length, r = 0; r < g; r++)l[s[r]] && (l[s[r]] = this.encrypt(l[s[r]])), h[s[r]] && (h[s[r]] = this.encrypt(h[s[r]])); if (u = { Record_ID: a, VAF_TableView_ID: this.VAF_TableView_ID, TableName: this.gTable._tableName, Inserting: this.inserting, CompareDB: this.compareDB, RowData: l, OldRowData: h, ManualCmd: i, WhereClause: this.getWhereClause(o), Fields: d, VAF_Client_ID: b, VAF_Org_ID: k, SelectSQL: n.secureEngine.encrypt(this.SQL_Select), AD_WIndow_ID: v[0].getVAF_Screen_ID(), MaintainVersions: !1, UnqFields: this.gFieldUnique }, this.selectedTreeNode > 0 && (u.SelectedTreeNodeID = this.selectedTreeNode), this.treeNode_ID > 0 && (u.ParentNodeID = this.treeNode_ID, u.TreeID = this.treeID, u.TreeTableID = this.treeTable_ID), this.onlyCurrentDays == 0 && (this.IsMaintainVersions || this.maintainVersionFieldChanged(l, h))) { if (c = this, h.updatedby == null) return (!this.MaintainVerOnApproval || this.MaintainVerOnApproval && n.context.getWindowContext(this.gTable._windowNo, n.Env.approveCol) == "Y") && (u.MaintainVersions = !0, u.ImmediateSave = !0, u.ValidFrom = (new Date).toISOString()), f = c.dataSaveDB(u, o), f.Status == "E" ? f.FireEEvent || f.FireIEvent || n.ADialog.info(f.ErrorMsg) : f.Status == "W" && (n.ADialog.info("SentForApproval"), c.dataRefreshAll()), f.Status; if (this.MaintainVerOnApproval && n.context.getWindowContext(this.gTable._windowNo, n.Env.approveCol) != "Y") return f = this.dataSaveDB(u, o), f.Status; nt = n.dataContext.getJSONData(n.Application.contextUrl + "Common/CheckVersions", { RowData: u }); nt.result ? n.ADialog.confirm("FoundVersions", !0, "", "Confirm", function (n) { n && c.showVersions(c, a, u, o) }) : c.showVersions(c, a, u, o) } else return f = this.dataSaveDB(u, o), f.Status } }; u.prototype.showVersions = function (t, i, r, u) { var f = new n.MasterDataVersion(t.gTable._tableName, t.gridFields, i, r.WhereClause, t.IsMaintainVersions, function (i, f, e) { r.MaintainVersions = !0; r.ImmediateSave = i; r.ValidFrom = new Date(f).toISOString(); r.VerRecID = e; var o = t.dataSaveDB(r, u); return o.Status != "O" && (o.Status == "E" ? o.FireEEvent || o.FireIEvent || n.ADialog.info(o.ErrorMsg) : (t.dataRefreshAll(), o.Status == "W" ? n.ADialog.info("SentForApproval") : o.Status == "F" && n.ADialog.info("SavedForFuture"))), o.Status }); f.show() }; u.prototype.dataSaveDB = function (i, r) { var u = n.dataContext.insertOrUpdateWRecord(i); return u = JSON.parse(u), u.IsError || (u.RowData && t.extend(!0, r, this.readDataOfObject(u.RowData)), this.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH, r, this.rowChanged), this.fireRowChanged(!0, this.getKeyID(this.rowChanged)), this.rowData = null, this.changed = !1, this.compareDB = !0, this.rowChanged = -1, this.newRow = -1, this.inserting = !1), u.ErrorMsg != null && this.log.log(n.Logging.Level.SEVERE, u.ErrorMsg), u.FireEEvent ? this.fireDataStatusEEvent(u.EventParam.Msg, u.EventParam.Info, u.EventParam.IsError) : u.FireIEvent && this.fireDataStatusIEvent(u.EventParam.Msg, u.EventParam.Info, u.EventParam.IsError), u }; u.prototype.createGridFieldArr = function (n, t) { var u = n.length, f, r, i; if (t) { if (this.gFieldLessData) return this.gFieldLessData; for (this.gFieldLessData = [], r = 0; r < u; r++)i = n[r], f = i.getColumnName().toLowerCase(), i.getIsEncryptedColumn() && this.gFieldLessData.push(f); return this.gFieldLessData } if (this.gFieldData) return this.gFieldData; for (this.gFieldData = [], this.gFieldUnique = [], r = 0; r < u; r++)i = n[r], this.gFieldData.push({ IsVirtualColumn: i.getIsVirtualColumn(), DisplayType: i.getDisplayType(), ColumnName: i.getColumnName(), IsKey: i.getIsKey(), ColumnSQL: i.getColumnSQL(!0), IsEncryptedColumn: i.getIsEncryptedColumn(), IsParentColumn: i.getIsParentColumn(), Name: i.getHeader(), IsUnique: i.getIsUnique() }), i.getIsUnique() && !i.getIsVirtualColumn() && this.gFieldUnique.push(i.getColumnName()); return this.gFieldData }; u.prototype.dataRefreshAll = function () { this.inserting = !1; this.dataIgnore(); this.close(!1); this.open(this.maxRows); this.dseEvent = "Refreshed" }; u.prototype.dataRequery = function (n) { return this.close(!1), this.setSelectWhereClause(n), this.rowData = null, this.changed = !1, this.rowChanged = -1, this.inserting = !1, this.open(this.maxRows), this.dseEvent = "Refreshed", !0 }; u.prototype.dataRefresh = function (t) { var e, r; if (t < 0 || this.getRowCount() == 0 || this.inserting) return null; e = this.getRow(t); this.dataIgnore(); r = this.getWhereClause(e); (r == null || r.length == 0) && (r = "1=2"); var i = this.SQL_Select + " WHERE " + r, f = null, u = null; try { i = n.secureEngine.encrypt(i); u = n.dataContext.getWindowRecord(i, this.createGridFieldArr(this.gridFields, !0)); u.read() && (f = this.readData(u)); f.recid = e.recid } catch (s) { return i = n.secureEngine.decrypt(i), this.log.log(o.SEVERE, i, s), this.fireDataStatusEEvent("RefreshError", i, !0), null } finally { u != null && u.dispose() } return this.rowData = null, this.changed = !1, this.rowChanged = -1, this.inserting = !1, this.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH, f), this.fireDataStatusIEvent("Refreshed", ""), f }; u.prototype.dataNew = function (t, i) { var c, s, e, a, h, o, u, f; if (this.log.info("Current=" + t + ", Copy=" + i), this.readOnly) return this.fireDataStatusEEvent("AccessCannotInsert", "", !0), !1; if (this.inserting = !0, c = this.gridFields.length, this.rowData = {}, s = {}, e = this.gTable._windowNo + n.EnvConstants.WINDOW_TEMP, i) for (a = this.getRow(t), o = 0; o < c; o++) { var u = this.gridFields[o], r = u.getColumnName(), l = r.toLowerCase(); u.getIsVirtualColumn() || (u.getIsKey() || r.equals("VAF_Client_ID") || r.equals("IsActive") || r.startsWith("Created") || r.startsWith("Updated") || r.equals("EntityType") || r.equals("DocumentNo") || r.equals("Processed") || r.equals("IsSelfService") || r.equals("DocAction") || r.equals("DocStatus") || r.startsWith("Ref_") || r.equals("Posted") || r.equals("GrandTotal") || r.equals("TotalLines") || r.equals("VAB_CashJRNLLine_ID") || r.equals("VAB_Payment_ID") || r.equals("IsPaid") || r.equals("IsAllocated") || r.equalsIgnoreCase("VAB_Address_ID") || r.equals("IsApproved") || r.equals("IsDelivered") || r.equals("IsInvoiced") || r.equals("TotalDr") || r.equals("TotalCr") || r.equalsIgnoreCase("I_IsImported") ? (f = u.getDefault(this.ctx, e), s[l] = f, f != null && this.ctx.setWindowContext(e, u.getColumnName(), f.toString())) : u.getIsCopy() ? (h = a[r.toLowerCase()], s[l] = h, h != null && this.ctx.setWindowContext(e, u.getColumnName(), h.toString())) : (f = u.getDefault(this.ctx, e), s[l] = f, f != null && this.ctx.setWindowContext(e, u.getColumnName(), f.toString()))) } else for (o = 0; o < c; o++)u = this.gridFields[o], f = u.getDefault(this.ctx, e), s[u.getColumnName().toLowerCase()] = f, f != null && this.ctx.setWindowContext(e, u.getColumnName(), f.toString()); return this.ctx.removeWindow(e), this.changed = !0, this.compareDB = !0, this.newRow = t + 1, this.getRowCount() < this.newRow && (this.newRow = this.getRowCount()), this.rowChanged = this.newRow, this.rowCount++, s.recid = this.rowCount, this.pazeSize++, this.fireTableModelChanged(n.VTable.prototype.ROW_ADD, s, this.newRow), this.log.fine("Current=" + this.currentRow + ", New=" + this.newRow + " - complete"), !0 }; u.prototype.dataDelete = function (t, i) { var f, l, r, s, w; if (!t || t.length < 0) return !1; if (this.readOnly) return this.fireDataStatusEEvent("AccessCannotDelete", "", !0), !1; if (!this.deleteable) return this.fireDataStatusEEvent("AccessNotDeleteable", "", !0), !1; var h = this.gTable._indexKeyColumn != -1, y = this.gTable._indexProcessedColumn > 0 && !this.gTable._tableName.startsWith("I_"), e = [], c = [], a = [], v = [], p = this.VAF_TableView_ID, u = null; for (f = 0; f < t.length; f++) { if (u = this.mSortList[t[f]], y && (l = this.getValueAt(t[f], "processed"), l != null && l)) { e.push(u.recid); continue } c.push(u.recid); h ? a.push(u[this.keyColumnName.toLowerCase()]) : v.push(this.getWhereClause(u)) } if (r = null, c.length > 0) s = { RecIds: c, HasKeyColumn: h, TableName: this.gTable._tableName, VAF_TableView_ID: p }, h ? s.SingleKeyWhere = a : s.MultiKeyWhere = v, r = n.dataContext.deleteWRecords(s), r = JSON.parse(r); else if (e.length > 0) return this.fireDataStatusEEvent("CannotDeleteTrx", "", !0), !1; if (r) { if (w = null, selIndexOrId = r.UnDeletedRecIds && r.UnDeletedRecIds.length > 0 ? r.UnDeletedRecIds : e.length > 0 ? e : i, r.DeletedRecIds && r.DeletedRecIds.length > 0 && (this.rowCount -= r.DeletedRecIds.length, this.fireTableModelChanged(n.VTable.prototype.ROW_DELETE, r.DeletedRecIds, selIndexOrId), r.RecIds && r.RecIds.length > 0 && this.fireRowChanged(!1, r.RecIds)), r.ErrorMsg && this.log.log(o.SEVERE, r.ErrorMsg), r.InfoMsg && this.log.log(o.Info, r.InfoMsg), r.IsError) return r.FireEEvent && this.fireDataStatusEEvent(r.EventParam.Msg, r.EventParam.Info, r.EventParam.IsError), !1; this.changed = !1; this.rowChanged = -1; this.fireDataStatusIEvent("Deleted", "") } return !0 }; u.prototype.dataDeleteAsync = function (t, i) { var r = this; return new Promise(function (u) { var e, a, p, h; if (!t || t.length < 0) { u(!1); return } if (r.readOnly) { r.fireDataStatusEEvent("AccessCannotDelete", "", !0); u(!1); return } if (!r.deleteable) { r.fireDataStatusEEvent("AccessNotDeleteable", "", !0); u(!1); return } var c = r.gTable._indexKeyColumn != -1, w = r.gTable._indexProcessedColumn > 0 && !r.gTable._tableName.startsWith("I_"), s = [], l = [], v = [], y = [], b = r.VAF_TableView_ID, f = null; for (e = 0; e < t.length; e++) { if (f = r.mSortList[t[e]], w && (a = r.getValueAt(t[e], "processed"), a != null && a)) { s.push(f.recid); continue } l.push(f.recid); c ? v.push(f[r.keyColumnName.toLowerCase()]) : y.push(r.getWhereClause(f)) } if (p = null, l.length > 0) h = { RecIds: l, HasKeyColumn: c, TableName: r.gTable._tableName, VAF_TableView_ID: b }, c ? h.SingleKeyWhere = v : h.MultiKeyWhere = y, p = n.dataContext.deleteWRecords(h).then(function (t) { if (t = JSON.parse(t), t) { if (selIndexOrId = t.UnDeletedRecIds && t.UnDeletedRecIds.length > 0 ? t.UnDeletedRecIds : s.length > 0 ? s : i, t.DeletedRecIds && t.DeletedRecIds.length > 0 && (r.rowCount -= t.DeletedRecIds.length, r.fireTableModelChanged(n.VTable.prototype.ROW_DELETE, t.DeletedRecIds, selIndexOrId), t.RecIds && t.RecIds.length > 0 && r.fireRowChanged(!1, t.RecIds)), t.ErrorMsg && r.log.log(o.SEVERE, t.ErrorMsg), t.InfoMsg && r.log.log(o.Info, t.InfoMsg), t.IsError) { t.FireEEvent && r.fireDataStatusEEvent(t.EventParam.Msg, t.EventParam.Info, t.EventParam.IsError); u(!1); return } r.changed = !1; r.rowChanged = -1; r.fireDataStatusIEvent("Deleted", ""); u(!0); return } }); else if (s.length > 0) { r.fireDataStatusEEvent("CannotDeleteTrx", "", !0); u(!1); return } }) }; u.prototype.readData = function (n) { var r = {}, u = this.gridFields.length, t = null, i; try { for (i = 0; i < u; i++)t = this.gridFields[i].getColumnName().toLowerCase(), r[t] = this.readDataOfColumn(t, n.getCell(t)), t = null; return r } catch (f) { throw f; } }; u.prototype.readDataOfObject = function (n) { var r = {}, u = this.gridFields.length, t = null, i; try { for (i = 0; i < u; i++)t = this.gridFields[i].getColumnName().toLowerCase(), r[t] = this.readDataOfColumn(t, n[t]), t = null; return r } catch (f) { throw f; } }; u.prototype.close = function (n) { this.isOpen && (n, !this.inserting, this.bufferList != null && (this.bufferList.length = 0, this.bufferList = null, this.bufferList = [], this.mSortList = null), this.mSortList != null && (this.mSortList = null), n && this.dispose(), this.isOpen = !1) }; u.prototype.dataIgnore = function (i) { if (this.inserting || this.changed || !(this.rowChanged < 0)) { if (this.inserting) this.rowCount--, this.pazeSize--, this.changed = !1, this.rowChanged = -1, this.inserting = !1, this.fireTableModelChanged(n.VTable.prototype.ROW_UNDO, this.mSortList[this.newRow].recid, this.newRow); else if (this.rowData != null) { var r = this.getRow(this.rowChanged); t.extend(r, this.rowData) } return this.changed = !1, this.rowChanged = -1, this.rowData = null, this.inserting = !1, this.newRow = -1, i || this.fireDataStatusIEvent("Ignored", ""), !0 } }; u.prototype.createDSE = function () { var t = this.changed, n; return this.rowChanged != -1 && (t = !0), n = new e(null, this.getRowCount(), t, !1, this.inserting), n.setPageInfo(this.currentPage, this.rowCount, this.pazeSize), n.VAF_TableView_ID = this.gTable._VAF_TableView_ID, n.Record_ID = null, n }; u.prototype.fireDataStatusChanged = function (n) { this.mDataListener && this.mDataListener.dataStatusChanged(n); n = null }; u.prototype.fireTableModelChanged = function (n, t, i, r) { this.mCardModelListener && this.mCardModelListener.tableModelChanged(n, t, i, r); this.mTableModelListener && this.mTableModelListener.tableModelChanged(n, t, i, r) }; u.prototype.fireRowChanged = function (n, t) { this.mRowChangedListener && this.mRowChangedListener.rowChanged(n, t) }; u.prototype.fireDataStatusIEvent = function (n, t) { var i = this.createDSE(); i.setInfo(n, t, !1, !1); this.fireDataStatusChanged(i) }; u.prototype.fireQueryCompleted = function (n) { this.mQueryCompletedListener && this.mQueryCompletedListener.queryCompleted(n); n = null }; u.prototype.fireDataStatusEEvent = function (n, t, i) { if (arguments.length === 1) this.fireDataStatusEEvent(arguments[0].value, arguments[0].name, !0); else { var r = this.createDSE(); r.setInfo(n, t, i, !i); this.fireDataStatusChanged(r) } }; u.prototype.addDataStatusListener = function (n) { this.mDataListener = n }; u.prototype.removeDataStatusListener = function () { this.mDataListener = null }; u.prototype.addQueryCompleteListner = function (n) { this.mQueryCompletedListener = n }; u.prototype.removeQueryCompleteListner = function () { this.mQueryCompletedListener = null }; u.prototype.addTableModelListener = function (n) { this.mTableModelListener = n }; u.prototype.removeTableModelListener = function (n) { this.mTableModelListener = null; n = null }; u.prototype.addCardModelListener = function (n) { this.mCardModelListener = n }; u.prototype.removeCardModelListener = function (n) { this.mCardModelListener = null; n = null }; u.prototype.addRowChangedListener = function (n) { this.mRowChangedListener = n }; u.prototype.removeRowChangedListener = function (n) { this.mRowChangedListener = null; n = null }; u.prototype.updateTableModel = function (t) { var i = t.getColumnName(), r = t.getDisplayType(); r == n.DisplayType.Integer || n.DisplayType.IsID(r) && (i.endsWith("_ID") || i.endsWith("_Acct") || i.endsWith("_ID_1") || i.endsWith("_ID_2") || i.endsWith("_ID_3")) || i.endsWith("atedBy") ? this.defaultModel[i.toLowerCase()] = new Number : n.DisplayType.IsNumeric(r) ? this.defaultModel[i.toLowerCase()] = new Number : n.DisplayType.IsDate(r) ? this.defaultModel[i.toLowerCase()] = new Date : r == n.DisplayType.RowID ? (dc = new DataColumn(i, typeof Object), this.defaultModel[i.toLowerCase()] = {}) : this.defaultModel[i.toLowerCase()] = r == n.DisplayType.YesNo ? new Boolean : n.DisplayType.IsLOB(r) ? new String : new String }; u.prototype.dispose = function () { var n, t; for (originalLength = this.gridFields.length, t = originalLength; t > 0; t--)n = this.gridFields.pop(), n.dispose(), n = null; this.gridFields.length = 0; this.gTable = null; this.gridFields = null; this.gFieldLessData = null; this.gFieldData = null; this.gFieldUnique = null }; u.prototype.maintainVersionFieldChanged = function (n, t) { var i, r; if (this.gridFields && this.gridFields.length > 0) for (i = 0; i < this.gridFields.length; i++)if (this.gridFields[i].vo.IsMaintainVersions && (r = this.gridFields[i].vo.ColumnName.toLowerCase(), n[r] != t[r])) return !0; return !1 }; r.prototype.PROPERTY = "FieldValue"; r.prototype.INSERTING = "FieldValueInserting"; r.prototype.setGridTab = function (n) { this.gridTab = n }; r.prototype.getIsDisplayed = function (t) { var u; if (arguments.length == 0) return this.vo.IsDisplayedf; if (!this.vo.IsDisplayedf) return !1; if (this.vo.DisplayLogic == null || this.vo.DisplayLogic.equals("")) return !0; if (t) { for (var i = !1, r = [], f = [], e = new n.StringTokenizer(this.vo.DisplayLogic, "[]"); e.hasMoreTokens();)u = e.nextToken(), u.trim() != " & ".trim() ? (i = n.Evaluator.evaluateLogic(this, u), r.push(i)) : f.push(u); return r.length > 1 && (f[0].trim().equals("&") ? i = r.indexOf(!1) > -1 ? !1 : !0 : f[0].trim().equals("|") && r.indexOf(!0) > -1 && (i = !0)), i } return !0 }; r.prototype.getIsDisplayedMR = function (t) { var u; if (arguments.length == 0) return this.vo.IsDisplayedMR; if (!this.vo.IsDisplayedMR) return !1; if (this.vo.DisplayLogic == null || this.vo.DisplayLogic.equals("")) return !0; if (t) { for (var i = !1, r = [], f = [], e = new n.StringTokenizer(this.vo.DisplayLogic, "[]"); e.hasMoreTokens();)u = e.nextToken(), u.trim() != " & ".trim() ? (i = n.Evaluator.evaluateLogic(this, u), r.push(i)) : f.push(u); return r.length > 1 && (f[0].trim().equals("&") ? i = r.indexOf(!1) > -1 ? !1 : !0 : f[0].trim().equals("|") && r.indexOf(!0) > -1 && (i = !0)), i } return !0 }; r.prototype.getColumnName = function () { return this.vo.ColumnName }; r.prototype.getIsLongField = function () { return this.vo.DisplayLength >= 30 }; r.prototype.getFieldColSpan = function () { return this.vo.DisplayLength <= 9 ? 1 : this.vo.DisplayLength <= 19 ? 2 : this.vo.DisplayLength <= 29 ? 3 : 4 }; r.prototype.getIsMandatory = function (t) { var r, i; return t && this.vo.mandatoryLogic != null && this.vo.mandatoryLogic.length > 0 && (r = n.Evaluator.evaluateLogic(this, this.vo.mandatoryLogic), r) ? !0 : !this.vo.IsMandatoryUI || this.getIsVirtualColumn() ? !1 : (i = this.vo, i.IsKey && i.ColumnName.endsWith("_ID") || i.ColumnName.startsWith("Created") || i.ColumnName.startsWith("Updated") || i.ColumnName.equals("Value") || i.ColumnName.equals("DocumentNo") || i.ColumnName.equals("VAM_PFeature_SetInstance_ID")) ? !1 : this.getIsDisplayed(t) }; r.prototype.getDisplayType = function () { return this.vo.displayType }; r.prototype.getIsVirtualColumn = function () { return this.vo.ColumnSQL && this.vo.ColumnSQL.length > 0 ? !0 : !1 }; r.prototype.getIsReadOnly = function () { return this.getIsVirtualColumn() ? !0 : this.vo.IsReadOnly }; r.prototype.setReadOnly = function (n) { this.vo.IsReadOnly = n }; r.prototype.getIsEditable = function (t, i) { var r = this.vo, o, u, h, e, s, c; if (this.getIsVirtualColumn()) return !1; if (r.ColumnName.equals("Posted") || r.ColumnName.equals("Record_ID") && r.displayType == n.DisplayType.Button || (o = i && !(this.vo.DisplayLogic == null || this.vo.DisplayLogic.equals("")), r.IsAlwaysUpdateable && !r.tabReadOnly && !o)) return !0; if (r.tabReadOnly || r.IsReadOnly || !r.IsUpdateable && !this.inserting || r.ColumnName.equals(n.context.getWindowTabContext(r.windowNo, r.tabNo, "LinkColumnName"))) return !1; if (u = n.context, t) { h = parseInt(u.getTabRecordContext(r.windowNo, r.tabNo, "VAF_Client_ID")); r.ColumnName.equals("VAF_Org_ID") && (u.getWindowContext(r.windowNo, "VAF_Org_ID") == null || u.getWindowContext(r.windowNo, "VAF_Org_ID").length == 0) && u.setWindowContext(r.windowNo, "VAF_Org_ID", u.getContext("#VAF_Org_ID")); var l = parseInt(u.getTabRecordContext(r.windowNo, r.tabNo, "VAF_Org_ID")), f = u.getWindowTabContext(r.windowNo, r.tabNo, "KeyColumnName"), a = r.VAF_Screen_ID; if (("EntityType".equals(f) && (f = "VAF_RecrodType_ID"), f.toUpperCase().endsWith("_ID") || (f += "_ID"), e = u.getWindowTabContext(r.windowNo, r.tabNo, f), e == "" && (e = 0), s = r.VAF_TableView_ID, !n.MRole.canUpdate(h, l, s, e, !1) || !n.MRole.getWindowAccess(a)) || !n.MRole.getIsColumnAccess(s, this.vo.VAF_Column_ID, !1)) return !1 } return t && r.ReadOnlyLogic.length > 0 && (c = !n.Evaluator.evaluateLogic(this, r.ReadOnlyLogic), !c) ? !1 : r.ColumnName.equals("Processing") || r.ColumnName.equals("DocAction") || r.ColumnName.equals("GenerateTo") ? !0 : t && (u.getWindowContext(r.windowNo, r.tabNo, "Processed").equals("Y") || u.getWindowContext(r.windowNo, r.tabNo, "Processing").equals("Y")) && !o ? !1 : r.ColumnName.equals("IsActive") ? !0 : t && !u.getWindowContext(r.windowNo, r.tabNo, "IsActive").equals("Y") ? !1 : i ? this.getIsDisplayedMR(t) : this.getIsDisplayed(t) }; r.prototype.getWindowNo = function () { return this.vo.windowNo }; r.prototype.getIsHeading = function () { return this.vo.IsHeading }; r.prototype.getIsSameLine = function () { return this.vo.IsSameLine }; r.prototype.getHeader = function () { return this.vo.Header }; r.prototype.getDescription = function () { return this.vo.Description }; r.prototype.getHelp = function () { return this.vo.Help }; r.prototype.getVAF_Job_ID = function () { return this.vo.VAF_Job_ID }; r.prototype.getVAF_Page_ID = function () { return this.vo.VAF_Page_ID }; r.prototype.getVAF_Column_ID = function () { return this.vo.VAF_Column_ID }; r.prototype.getVAF_Field_ID = function () { return this.vo.VAF_Field_ID }; r.prototype.getFieldGroup = function () { return this.vo.FieldGroup }; r.prototype.getIsFieldOnly = function () { return this.vo.IsFieldOnly }; r.prototype.getShowLabel = function () { return !0 }; r.prototype.getIsKey = function () { return this.vo.IsKey }; r.prototype.getIsParentColumn = function () { return this.vo.IsParent }; r.prototype.getSortNo = function () { return this.vo.SortNo }; r.prototype.getMRSeqNo = function () { return this.vo.mrSeqNo }; r.prototype.getIsSelectionColumn = function () { return this.vo.IsSelectionColumn }; r.prototype.getSelectionSeqNo = function () { return this.vo.SelectionSeqNo }; r.prototype.getIsIncludedColumn = function () { return this.vo.IsIncludedColumn }; r.prototype.getDependentOn = function () { var t = [], i = this.getColumnName(); return i.equals("VAM_PFeature_SetInstance_ID") ? t.push("VAM_Product_ID") : (i.equals("VAM_Locator_ID") || i.equals("VAM_LocatorTo_ID")) && (t.push("VAM_Product_ID"), t.push("VAM_Warehouse_ID")), n.Evaluator.parseDepends(t, this.vo.DisplayLogic), n.Evaluator.parseDepends(t, this.vo.ReadOnlyLogic), this.lookup != null && n.Evaluator.parseDepends(t, this.lookup.getValidation()), t }; r.prototype.getVAF_Screen_ID = function () { return this.vo.VAF_Screen_ID }; r.prototype.getVAF_QuickSearchWindow_ID = function () { return this.vo.VAF_QuickSearchWindow_ID }; r.prototype.getValueAsString = function (t) { return n.context.getWindowContext(this.vo.windowNo, this.vo.tabNo, t, !0) }; r.prototype.getColumnSQL = function (t) { return arguments.length == 0 ? this.vo.ColumnName : this.vo.ColumnSQL != null && this.vo.ColumnSQL.length > 0 ? t ? (this.vo.displayType == n.DisplayType.YesNo, this.vo.ColumnSQL + " AS " + this.vo.ColumnName) : (this.vo.displayType == n.DisplayType.YesNo, this.vo.ColumnSQL) : (this.vo.displayType == n.DisplayType.YesNo, this.vo.ColumnName) }; r.prototype.getIsLink = function () { return this.vo.isLink }; r.prototype.getIsRightPaneLink = function () { return this.vo.isRightPaneLink }; r.prototype.getColumnWidth = function () { return this.vo.ColumnWidth }; r.prototype.getIsAlwaysUpdateable = function () { return this.getIsVirtualColumn() || !this.vo.IsUpdateable ? !1 : this.vo.IsAlwaysUpdateable }; r.prototype.getIsEncryptedField = function () { return this.vo.IsEncryptedField }; r.prototype.getIsEncrypted = function () { if (this.vo.IsEncryptedField) return !0; var n = this.getObscureType(); return n != null && n.length > 0 ? !0 : this.vo.ColumnName.equals("Password") }; r.prototype.getObscureType = function () { return this.vo.ObscureType }; r.prototype.getDisplayLength = function () { return this.vo.DisplayLength }; r.prototype.getFieldLength = function () { return this.vo.FieldLength }; r.prototype.getMinValue = function () { return this.vo.ValueMin }; r.prototype.getMaxValue = function () { return this.vo.ValueMax }; r.prototype.getVFormat = function () { return this.vo.VFormat }; r.prototype.getLookup = function () { return this.lookup }; r.prototype.getIsError = function () { return this.error }; r.prototype.getIsCopy = function () { return this.vo.IsCopy }; r.prototype.getCallout = function () { return this.vo.Callout }; r.prototype.getValue = function () { return this.value }; r.prototype.getOldValue = function () { return this.oldValue }; r.prototype.getIsRange = function () { return this.vo.isRange }; r.prototype.getIsRange = function () { return this.vo.isRange }; r.prototype.getIsParentValue = function () { var i = n.context, t; return this.parentValue != null ? this.parentValue : (n.DisplayType.IsID(this.vo.displayType) && this.vo.tabNo != 0 ? (t = i.getWindowTabContext(this.vo.windowNo, this.vo.tabNo, "LinkColumnName"), this.parentValue = t.length == 0 ? !1 : this.vo.ColumnName.equals(t), this.parentValue && this.log.config(this.parentValue + " - Link(" + t + ", W=" + this.vo.windowNo + ",T=" + this.vo.tabNo + ") = " + this.vo.ColumnName)) : this.parentValue = !1, this.parentValue) }; r.prototype.getDefault = function (t, i) { var r = this.vo, c, u, s, p, f, k, d, l, h, nt; if (r.IsKey || r.displayType == n.DisplayType.RowID || n.DisplayType.IsLOB(r.displayType)) return null; if (this.getIsParentValue() && n.Utility.Util.isEmpty(r.DefaultValue)) return c = t.getWindowContext(r.windowNo, r.ColumnName), this.gridTab && (c = t.getWindowContext(r.windowNo, this.gridTab.getParentTabNo(), r.ColumnName)), this.log.fine("[Parent] " + r.ColumnName + "=" + c), this.createDefault(r.ColumnName, c); if (r.ColumnName.equals("IsActive")) return this.log.fine("[IsActive] " + r.ColumnName + "=Y"), !0; if (n.Consts.ACCESSLEVEL_SystemOnly.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && (r.ColumnName.equals("VAF_Client_ID") || r.ColumnName.equals("VAF_Org_ID"))) return this.log.fine("[SystemAccess] " + r.ColumnName + "=0"), 0; if (n.Consts.ACCESSLEVEL_SystemPlusClient.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && r.ColumnName.equals("VAF_Org_ID")) return this.log.fine("[ClientAccess] " + r.ColumnName + "=0"), 0; if (u = "", r.DefaultValue.startsWith("@SQL=")) { var v = r.DefaultValue.substring(5), e = n.Env.parseContext(t, r.windowNo, v, !1, !0), y = e.toUpperCase(); if (y.indexOf("DELETE ") != -1 && y.indexOf("UPDATE ") != -1 && y.indexOf("DROP ") != -1 && (e = ""), e.equals("")) this.log.log(o.WARNING, "(" + r.ColumnName + ") - Default SQL variable parse failed: " + v); else { s = null; try { s = a(e); s.read() ? u = s.getString(0) : this.log.log(o.WARNING, "(" + r.ColumnName + ") - no Result: " + e); s.close() } catch (b) { e.endsWith("=") ? this.log.log(o.SEVERE, "(" + r.ColumnName + ") " + v, b) : this.log.log(o.WARNING, "(" + r.ColumnName + ") " + e, b) } finally { s != null && s.dispose() } } if (u != null && u.length > 0) return this.log.fine("[SQL] " + r.ColumnName + "=" + u), this.createDefault("", u) } if (!r.DefaultValue.equals("") && !r.DefaultValue.startsWith("@SQL=")) for (u = "", p = new n.StringTokenizer(r.DefaultValue, ",;", !1); p.hasMoreTokens();) { if (f = p.nextToken().trim(), f.equals("@SysDate@") || f.equals("@Now@")) return k = new Date, d = k.toISOString(), d; if (u = f.indexOf("@") != -1 ? t.getWindowContext(r.windowNo, f.replaceAll("@", " ").trim()) : f.startsWith("'") && f.endsWith("'") ? f.length - 2 > 0 ? f.substring(1, f.length - 1) : f.replaceAll("'", "") : f, u.length > 0) return this.log.fine("[DefaultValue] " + r.ColumnName + "=" + u), this.createDefault(f, u) } if (this.lookup != null && !n.Utility.Util.isEmpty(this.lookup.getValidation())) { var tt = this.lookup.getValidation(), g = n.Evaluator.getVariables(tt), w = !1; for (l = 0; l < g.length; l++)if (h = g[l], !h.startsWith("#") && h.toUpperCase().endsWith("_ID") && !h.equals(r.ColumnName) && (nt = t.getWindowContext(i, h), w = n.Utility.Util.isEmpty(nt), w)) break; if (w) return this.lookup.clear(), null } return (u = n.Env.getPreference(t, r.VAF_Screen_ID, r.ColumnName, !1), u !== "") ? (this.log.fine("[UserPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : (u = n.Env.getPreference(t, r.VAF_Screen_ID, r.ColumnName, !0), u !== "") ? (this.log.fine("[SystemPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : r.displayType == n.DisplayType.Button && !r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[Button=N] " + r.ColumnName), "N") : this.vo.displayType == n.DisplayType.YesNo ? (this.log.fine("[YesNo=N] " + r.ColumnName), !1) : r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[ID=null] " + r.ColumnName), null) : n.DisplayType.IsNumeric(r.displayType) ? (this.log.fine("[Number=0] " + r.ColumnName), this.createDefault("", "0")) : (this.log.fine("[NONE] " + r.ColumnName), null) }; r.prototype.getDefault2 = function (t, i) { var r = this.vo, l, u, s, p, f, k, d, c, h, nt; if (r.IsKey || r.displayType == n.DisplayType.RowID || n.DisplayType.IsLOB(r.displayType)) return null; if (this.getIsParentValue() && n.Utility.Util.isEmpty(r.DefaultValue2)) return l = t.getWindowContext(r.windowNo, r.ColumnName), this.log.fine("[Parent] " + r.ColumnName + "=" + l), this.createDefault(r.ColumnName, l); if (r.ColumnName.equals("IsActive")) return this.log.fine("[IsActive] " + r.ColumnName + "=Y"), !0; if (n.Consts.ACCESSLEVEL_SystemOnly.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && (r.ColumnName.equals("VAF_Client_ID") || r.ColumnName.equals("VAF_Org_ID"))) return this.log.fine("[SystemAccess] " + r.ColumnName + "=0"), 0; if (n.Consts.ACCESSLEVEL_SystemPlusClient.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && r.ColumnName.equals("VAF_Org_ID")) return this.log.fine("[ClientAccess] " + r.ColumnName + "=0"), 0; if (u = "", r.DefaultValue2.startsWith("@SQL=")) { var v = r.DefaultValue2.substring(5), e = n.Env.parseContext(t, r.windowNo, v, !1, !0), y = e.toUpperCase(); if (y.indexOf("DELETE ") != -1 && y.indexOf("UPDATE ") != -1 && y.indexOf("DROP ") != -1 && (e = ""), e.equals("")) this.log.log(o.WARNING, "(" + r.ColumnName + ") - Default SQL variable parse failed: " + v); else { s = null; try { s = a(e); s.read() ? u = s.getString(0) : this.log.log(o.WARNING, "(" + r.ColumnName + ") - no Result: " + e); s.close() } catch (b) { e.endsWith("=") ? this.log.log(o.SEVERE, "(" + r.ColumnName + ") " + v, b) : this.log.log(o.WARNING, "(" + r.ColumnName + ") " + e, b) } finally { s != null && s.dispose() } } if (u != null && u.length > 0) return this.log.fine("[SQL] " + r.ColumnName + "=" + u), this.createDefault("", u) } if (!r.DefaultValue2.equals("") && !r.DefaultValue2.startsWith("@SQL=")) for (u = "", p = new n.StringTokenizer(r.DefaultValue2, ",;", !1); p.hasMoreTokens();) { if (f = p.nextToken().trim(), f.equals("@SysDate@") || f.equals("@Now@")) return k = new Date, d = k.toISOString(), d; if (u = f.indexOf("@") != -1 ? t.getWindowContext(r.windowNo, f.replaceAll("@", " ").trim()) : f.startsWith("'") && f.endsWith("'") ? f.length - 2 > 0 ? f.substring(1, f.length - 1) : f.replaceAll("'", "") : f, u.length > 0) return this.log.fine("[DefaultValue2] " + r.ColumnName + "=" + u), this.createDefault(f, u) } if (this.lookup != null && !n.Utility.Util.isEmpty(this.lookup.getValidation())) { var tt = this.lookup.getValidation(), g = n.Evaluator.getVariables(tt), w = !1; for (c = 0; c < g.length; c++)if (h = g[c], !h.startsWith("#") && h.toUpperCase().endsWith("_ID") && !h.equals(r.ColumnName) && (nt = t.getWindowContext(i, h), w = n.Utility.Util.isEmpty(nt), w)) break; if (w) return this.lookup.clear(), null } return (u = n.Env.getPreference(t, r.VAF_Screen_ID, r.ColumnName, !1), u !== "") ? (this.log.fine("[UserPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : (u = n.Env.getPreference(t, r.VAF_Screen_ID, r.ColumnName, !0), u !== "") ? (this.log.fine("[SystemPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : r.displayType == n.DisplayType.Button && !r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[Button=N] " + r.ColumnName), "N") : this.vo.displayType == n.DisplayType.YesNo ? (this.log.fine("[YesNo=N] " + r.ColumnName), !1) : r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[ID=null] " + r.ColumnName), null) : n.DisplayType.IsNumeric(r.displayType) ? (this.log.fine("[Number=0] " + r.ColumnName), this.createDefault("", "0")) : (this.log.fine("[NONE] " + r.ColumnName), null) }; r.prototype.getIsEncryptedColumn = function () { return this.vo.IsEncryptedColumn }; r.prototype.getZoomWindow_ID = function () { return this.vo.ZoomWindow_ID }; r.prototype.getIsDefaultFocus = function () { return this.vo.IsDefaultFocus }; r.prototype.createDefault = function (t, i) { var u, r, f, e; if (i == null || i.length == 0) return null; try { if (this.vo.ColumnName.endsWith("atedBy") || this.vo.ColumnName.toUpperCase().endsWith("_ID")) { try { return (u = parseInt(i), u < 0) ? null : u } catch (s) { this.log.warning("Cannot parse: " + i + " - " + s.message) } return 0 } if (this.vo.displayType == n.DisplayType.Integer) return parseInt(i); if (n.DisplayType.IsNumeric(this.vo.displayType)) return parseFloat(i); if (n.DisplayType.IsDate(this.vo.displayType)) { try { return r = null, isNaN(Number(i)) ? r = new Date(i) : (r = new Date, console.log(this.vo.ColumnName + "==>[1n] " + r), r.setMinutes(-r.getTimezoneOffset() + r.getMinutes()), console.log(this.vo.ColumnName + "==>[3n] " + r.toISOString())), r.toISOString() } catch (c) { } f = i + "2014-01-01T01:00:05Z".substring(i.length); try { new Date(f).toISOString() } catch (l) { this.log.warning("Cannot convert to Timestamp: " + f) } return (new Date).toISOString() } if (this.vo.displayType == n.DisplayType.YesNo) return "Y".equals(i); if (t.equals("@#Date@")) try { e = new Date(parseInt(i)); i = e.toLocaleDateString() } catch (a) { } return i } catch (h) { this.log.log(o.SEVERE, this.vo.ColumnName + " - " + h.message) } return null }; r.prototype.setValue = function (t, i) { this.inserting || (this.oldValue = this.value); this.value = t; this.inserting = i; this.error = !1; this.updateContext(); var r = this.oldValue; i && (r = this.INSERTING); (r !== t || this.forcefirepropchange) && this.propertyChangeListner && this.propertyChangeListner.setValue(t, i); this.forcefirepropchange = this.inserting || this.vo.displayType == n.DisplayType.YesNo }; r.prototype.updateContext = function () { var t = this.vo, u = n.DisplayType, r = n.context, i = this.value, f; t.displayType == u.Text || t.displayType == u.Memo || t.displayType == u.TextLong || t.displayType == u.Binary || t.displayType == u.RowID || this.getIsEncrypted() || (i == "undefined" || i == null ? this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, null) : r.setWindowContext(t.windowNo, t.ColumnName, null) : typeof i == typeof Boolean || t.displayType == u.YesNo ? (f = i.toString().toLowerCase() == "true" || i.toString() == "Y" ? "Y" : "N", this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, f) : r.setWindowContext(t.windowNo, t.ColumnName, f)) : typeof i == typeof date || u.IsDate(t.displayType) ? this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, i) : r.setWindowContext(t.windowNo, t.ColumnName, i) : this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, i.toString()) : r.setWindowContext(t.windowNo, t.ColumnName, i == null ? null : i.toString())) }; r.prototype.getIsParentTabField = function (n) { if (!this.gridTab) return !1; n || (n = this.vo.ColumnName); var t = this.gridTab.getParentTab(); return t == null ? !1 : t.getField(n) != null }; r.prototype.setNullValue = function () { this.valueNoFire && (this.oldValue = this.value); this.value = null; this.inserting = !1; this.error = !1; this.oldValue !== this.value && this.propertyChangeListner && this.propertyChangeListner.setValue(this.value) }; r.prototype.setPropertyChangeListener = function (n) { this.propertyChangeListner = n }; r.prototype.setError = function (n) { this.error = n }; r.prototype.setInserting = function (n) { this.inserting = n }; r.prototype.getVAF_Control_Ref_Value_ID = function () { return this.vo.VAF_Control_Ref_Value_ID }; r.prototype.setDisplayType = function (n) { this.vo.displayType = n }; r.prototype.setDisplayLength = function (n) { this.vo.DisplayLength = n }; r.prototype.setDisplayed = function (n) { this.vo.IsDisplayedf = n }; r.prototype.setValueNoFire = function (n) { this.valueNoFire = n }; r.prototype.getLoadRecursiveData = function () { return this.vo.LoadRecursiveData }; r.prototype.getShowChildOfSelected = function () { return this.vo.ShowChildOfSelected }; r.prototype.getIsBackgroundProcess = function () { return this.vo.IsBackgroundProcess }; r.prototype.getAskUserBGProcess = function () { return this.vo.AskUserBGProcess }; r.prototype.getIsHeaderPanelitem = function () { return this.vo.IsHeaderPanelitem }; r.prototype.getHeaderOverrideReference = function () { return this.vo.HeaderOverrideReference }; r.prototype.getHeaderStyle = function () { return this.vo.HeaderStyle }; r.prototype.getHeaderHeadingOnly = function () { return this.vo.HeaderHeadingOnly }; r.prototype.getHeaderSeqno = function () { return this.vo.HeaderSeqno }; r.prototype.getHeaderIconOnly = function () { return this.vo.HeaderIconOnly }; r.prototype.getHtmlStyle = function () { return this.vo.HtmlStyle }; r.prototype.getShowIcon = function () { return this.vo.ShowIcon }; r.prototype.getVAF_Image_ID = function () { return this.vo.VAF_Image_ID }; r.prototype.getFontClass = function () { return this.vo.FontClass }; r.prototype.getPlaceHolder = function () { return this.vo.PlaceHolder }; r.prototype.getImageName = function () { return this.vo.ImageName }; r.prototype.getCellSpace = function () { return this.vo.CellSpace }; r.prototype.getFieldBreadth = function () { return this.vo.FieldBreadth }; r.prototype.getIsLineBreak = function () { return this.vo.LineBreak }; r.prototype.getIsFieldgroupDefault = function () { return this.vo.FieldGroupDefault }; r.prototype.getShowFilterOption = function () { return this.vo.ShowFilterOption }; r.prototype.getIsUnique = function () { return this.vo.IsUnique }; r.prototype.refreshLookup = function () { return !this.lookup || this.lookup.getValidation().length == 0 ? !0 : (this.lookup.refresh(), this.lookup.getIsValidated()) }; r.prototype.dispose = function () { this.lookup != null && (this.lookup.dispose(), this.lookup = null); this.gfield = null; this.vo = null; this.propertyChangeListner = null }; s.prototype.getName = function () { return this.vo.Name }; s.prototype.getVAF_Tab_ID = function () { return this.vo.VAF_Tab_ID }; s.prototype.getIconPath = function () { return this.vo.IconPath }; s.prototype.getIsDefault = function () { return this.vo.IsDefault }; s.prototype.getClassName = function () { return this.vo.Classname }; s.prototype.getVAF_TabPanel_ID = function () { return this.vo.VAF_TabPanel_ID }; s.prototype.getSeqNo = function () { return this.vo.SeqNo }; s.prototype.getExtraInfo = function () { return this.vo.ExtraInfo }; e.prototype.getRecord_ID = function () { return this.Record_ID }; e.prototype.setLoading = function (n) { this.m_allLoaded = !1; this.m_loadedRows = n }; e.prototype.getIsLoading = function () { return !this.m_allLoaded }; e.prototype.getLoadedRows = function () { return this.m_loadedRows }; e.prototype.setCurrentRow = function (n) { this.m_currentRow = n }; e.prototype.setCurrentPage = function (n) { this.mCurrentPage = n }; e.prototype.getCurrentRow = function () { return this.m_currentRow }; e.prototype.getTotalRows = function () { return this.m_totalRows }; e.prototype.getTotalRecords = function () { return this.totalRecords }; e.prototype.getCurrentPage = function () { return this.mCurrentPage }; e.prototype.getTotalPage = function () { return this.mTotalPage }; e.prototype.getPageSize = function () { return this.mPageSize }; e.prototype.setInfo = function (n, t, i, r) { this.m_VAF_Msg_Lable = n; this.m_info = t; this.m_isError = i; this.m_isWarning = r }; e.prototype.setPageInfo = function (n, t, i) { this.mCurrentPage = n; this.mPageSize = i; t < 1 || t < i ? (this.mcurrentPage = 1, this.mTotalPage = 1) : this.mTotalPage = i == 0 ? 1 : Math.ceil(t / i); this.totalRecords = t }; e.prototype.setInserting = function (n) { this.m_inserting = n }; e.prototype.getIsInserting = function () { return this.m_inserting }; e.prototype.getVAF_Msg_Lable = function () { return this.m_VAF_Msg_Lable }; e.prototype.getInfo = function () { return this.m_info }; e.prototype.getIsError = function () { return this.m_isError }; e.prototype.getIsWarning = function () { return this.m_isWarning }; e.prototype.getMessage = function () { var n = new StringBuilder; return this.m_inserting && n.append("+"), n.append(this.m_changed ? this.m_autoSave ? "*" : "?" : " "), this.m_totalRows == 0 ? n.append(this.m_currentRow) : n.append(this.m_currentRow + 1), n.append("/"), this.m_allLoaded ? n.append(this.m_totalRows) : n.append(this.m_loadedRows).append("->").append(this.m_totalRows), n.toString() }; e.prototype.getIsChanged = function () { return this.m_changed }; e.prototype.getIsFirstRow = function () { return this.m_totalRows == 0 ? !0 : this.m_currentRow == 0 }; e.prototype.getIsLastRow = function () { return this.m_totalRows == 0 ? !0 : this.m_currentRow == this.m_totalRows - 1 }; e.prototype.getIsFirstPage = function () { return this.mTotalPage < 2 ? !0 : this.mCurrentPage < 2 }; e.prototype.getIsLastPage = function () { return this.mTotalPage < 2 ? !0 : this.mCurrentPage >= this.mTotalPage }; e.prototype.setChangedColumn = function (n, t) { this.m_changedColumn = n; this.m_columnName = t }; e.prototype.getChangedColumn = function () { return this.m_changedColumn }; e.prototype.getColumnName = function () { return this.m_columnName }; e.prototype.setConfirmed = function (n) { this.m_confirmed = n }; e.prototype.getIsConfirmed = function () { return this.m_confirmed }; n.GridWindow = f; n.GridTab = i; n.GridTable = u; n.GridField = r }(VIS, jQuery), function (n, t) { function i(i) { function e() { r = t("<div class='vis-height-full vis-app-aform-root' >"); u = t("<div class='vis-apanel-busy'>"); f = t("<div class='vis-height-full'>"); r.append(f).append(u) } this.$parent; this.mPanel; this.ctx = n.Env.getCtx(); this.log = n.Logging.VLogger.getVLogger("VIS.AForm"); var r, u, f; e(); this.setSize = function (n) { r.height(n); f.height(n) }; this.setSize(i); this.getRoot = function () { return r }; this.getContentGrid = function () { return f }; this.setBusy = function (n, t) { isLocked = n; n ? u[0].style.visibility = "visible" : (u[0].style.visibility = "hidden", t) }; this.disposeComponent = function () { r.remove(); r = null; f.remove(); f = null; u.remove(); u = null; this.$parentWindow = null; this.ctx = null; this.getRoot = null; this.getContentGrid = null; this.setBusy = null; this.setSize = null } } i.prototype.openForm = function (t, i, r, u) { var f, o, e; if (t.IsReport) return n.ADialog.info("Form Report is not supported"), !1; this.parent = i; f = ""; f = t.Prefix + t.ClassName; console.log(f); this.log.info("Form Name= " + t.Name + ", Class=" + f); this.ctx.setWindowContext(r, "WindowName", t.DisplayName); try { o = n.Utility.getFunctionByName(f, window); e = new o(r); e.init(r, this, u); this.mPanel = e; e = null } catch (s) { return this.log.log(n.Logging.Level.WARNING, "Class=" + f + ", VAF_Page Name=" + t.Name, s), !1 } return this.setBusy(!1), this.windowNo = r, this.setTitle(n.Env.getHeader(this.ctx, r)), this.parent.setName(t.DisplayName), i = null, !0 }; i.prototype.setTitle = function (t) { this.parent && this.parent.setTitle(n.Utility.Util.cleanMnemonic(t)) }; i.prototype.hideHeader = function (n) { this.parent && this.parent.hideHeader(n) }; i.prototype.hideCloseIcon = function (n) { this.parent && this.parent.hideCloseIcon(n) }; i.prototype.sizeChanged = function (n, t) { this.setSize(n); this.mPanel && this.mPanel.sizeChanged && this.mPanel.sizeChanged(n, t) }; i.prototype.refresh = function () { this.mPanel && this.mPanel.refresh && this.mPanel.refresh() }; i.prototype.dispose = function () { this.disposed || (this.disposed = !0, this.mPanel && (this.mPanel.disposeComponent && this.mPanel.dispose(), this.mPanel = null), this.parent && (this.parent.dispose(), this.parent = null), n.Env.clearWinContext(this.ctx, this.windowNo), this.disposeComponent()) }; n.AForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function d() { var i, u, f; k = t("<div style='position:relative;width:100%'>"); s = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); p = t("<table  class='vis-process-table'>"); h = t("<button class='vis-button-ok' tabindex=0>").text(n.Msg.getMsg("OK")); v = t("<button class='vis-button-close'>").text(n.Msg.getMsg("Close")); s.css("top", "0px"); h.hide(); v.hide(); p.height(r); s.height(r); c = t("<div>"); k.append(p).append(s); y.append(s); a = t('<select style="display:none;width:100%">'); l = t('<label  class="vis-ec-col-lblchkbox" style="display: none;"><input type="checkbox">' + n.Msg.translate(n.context, "IsBackgroundProcess") + "<\/label>"); o = t("<span class='vis-process-description-Span' style='height: 40px;'>").val("asassasasasasaasa"); c.append(o); i = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); w = t('<label style="display:none;">' + n.Msg.getMsg("ChooseReportType") + "<\/label>"); f = t('<div style="display:inherit"><\/div>'); e.parameterFixedArea.append(i); i.append(u); u.append(l).append(a).append(w); c.append(f); c.append(h).append(v); e.$divDesc.append(c) } var e = null, y, b, k, s, c, p, h, v, o, a, w, l; this.parent; this.mPanel; this.ctx = n.Env.getCtx(); this.isLocked = !1; this.log = n.Logging.VLogger.getVLogger("VIS.AProcess"); this.isComplete = !1; this.jpObj = null; this.splitUI = u; this.extrnalForm = f; this.partitionContainer = null; this.parameterContainer = null; this.reportContainer = null; this.reportToolbar = null; this.isReport = !1; this.calculateWidth = !0; this.hideclose = !1; this.showParameterClose = !0; this.cssForAll = null; this.visRepformatIcons = null; this.visSaveCsvIcons = null; this.visSavePdfIcons = null; this.visArchiveIcons = null; this.visRequeryIcons = null; this.visCustomizeIcons = null; this.visPrintIcons = null; this.toolbarColor = null; y = null; b = t('<i class="fa fa-bars vis-apanel-lb-img" title="Actions"><\/i>'); this.splitUI && (this.partitionContainer = t('<div class="vis-process-outer-wrap">'), this.parameterContainer = t('<div class="vis-process-left-sidebar vis-leftsidebarouterwrap">'), this.reportAreaContainer = t('<div class="vis-process-main-wrap">'), this.reportToolbar = t('<div class="vis-process-toolbar vis-processtoolpadd">'), this.parameterFixedArea = t('<div class="vis-process-parm-top">'), this.parameterContainer.append(t('<div class="vis-apanel-lb-toggle"><\/div>').append(b)).append(this.parameterFixedArea), y = t('<div class="vis-process-outer-main-wrap">'), this.$divDesc = t('<div class="vis-process-description">'), this.reportContainer = t('<div class="vis-process-result">'), this.reportAreaContainer.append(this.reportToolbar).append(this.$divDesc).append(this.reportContainer), y.append(this.parameterContainer).append(this.reportAreaContainer), this.partitionContainer.append(y), this.showParameterClose = !1); e = this; this.loadFileTypes = function () { var i = this; t.ajax({ url: n.Application.contextUrl + "JsonData/GetReportFileTypes/", dataType: "json", data: { VAF_Job_ID: e.jpObj.VAF_Job_ID }, success: function (r) { var u, f, e; if (r != null) { if (u = jQuery.parseJSON(r), u.length == 0) { i.showReportTypes(!1); return } for (a.append("<option value='S'>" + n.Msg.getMsg("Select") + "<\/option>"), f = 0; f < u.length; f++)e = t("<option value=" + u[f].Key + ">" + u[f].Name + "<\/li>"), a.append(e), e = null } } }) }; d(); this.setSize = function (n) { s.height(n); this.setMsg && this.setMsg("") }; this.setSize(r); this.isBackground = function () { return l.is(":checked") }; this.getRoot = function () { return k }; this.getContentGrid = function () { return c }; this.setBusy = function (n) { isLocked = n; n ? (s[0].style.visibility = "visible", s.css("display", "")) : (s[0].style.visibility = "hidden", s.css("display", "none")) }; this.setMsg = function (n) { var r = o.find("b"), u, i, f, s; if (o.text().length > 0 && n && n.length > 0 ? (u = t("<span>" + n + "<\/span>"), this.reportContainer.removeClass("vis-process-result"), this.reportContainer.addClass("vis-process-detail-result"), this.reportContainer.empty(), this.reportContainer.append(u)) : o.append(n), i = "", this.isReport && (!r || r.length <= 0) && (i = t('<strong class="vis-process-papapa vis-procss-more"    style="position: fixed;right: 29px;top:96px"><i class="glyphicon glyphicon-chevron-down"><\/i><\/strong>'), o.append(i)), f = t(o.find("p")[0]), i = o.find(".vis-process-papapa"), this.isReport && (s = f.width(), s + 45 > o.width() ? i.show() : i.hide()), this.isReport && (!r || r.length <= 0)) i.on("click", function () { var t = e.reportAreaContainer.height(), n = i.find("i"); n.hasClass("glyphicon-chevron-up") ? (n.addClass("glyphicon-chevron-down"), n.removeClass("glyphicon-chevron-up"), o.css({ height: "40px" })) : (n.addClass("glyphicon-chevron-up"), n.removeClass("glyphicon-chevron-down"), o.css({ height: "" })); e.reportContainer.height(t - (e.$divDesc.height() + 20)) }); this.setMsgHeight(this.isReport) }; this.setMsgHeight = function (n) { n ? (o.css("height", "40px"), o.css("max-height", "")) : (o.css("height", ""), e.parent && o.css("max-height", e.parent.getContentGrid().height() - 100 + "px")); this.reportContainer.height(this.reportAreaContainer.height() - (this.$divDesc.height() + 20)); this.reportAreaContainer.width(this.partitionContainer.width() - this.parameterContainer.width()) }; this.setParameterHeights = function (n) { var i = this, r = t(i.partitionContainer.find(".vis-process-outer-main-wrap")[0]), u, f; n && (i.partitionContainer.height(n), r.height(n)); u = r.height(); f = t(i.partitionContainer.find(".vis-pro-para-root")[0]); f.height(u - 114 + "px") }; this.getParametersContainer = function () { return this.parameterContainer }; this.getReportAreaContainer = function () { return this.reportContainer }; this.getContentTable = function () { return p }; this.getBusyIndicator = function () { return s }; this.getToolbar = function () { return this.reportToolbar }; this.additemtoToolbar = function () { var n = t('<div class="vis-ad-w-p-t-close vis-ad-process-close"><i class="vis vis-cross"><\/i><\/div>'); e.reportToolbar.append(n).append(t('<div class="vis-ad-w-p-t-name vis-ad-process-header"><h5>' + e.parent.getName() + "<\/h5><\/div >")); n.on("click", function () { e.parent.dispose() }) }; this.showCloseIcon = function (n) { this.hideclose = n ? !1 : !0 }; this.showOkIcon = function (n) { n ? (this.parameterContainer.append(t('<div style="overflow:auto;padding:0 10px">').append(h)), h.removeClass(""), h.addClass("vis-process-ok-btn VIS_Pref_btn-2"), h.show(), window.setTimeout(function () { h.focus() }, 100)) : h.hide() }; this.showParameterCloseIcon = function (n) { this.showParameterClose = n ? !0 : !1 }; this.getShowParameterCloseIcon = function () { return this.showParameterClose }; this.setCssForToolbarIcons = function (n) { this.cssForAll = n }; this.setReportFormatIcons = function (n) { this.visRepformatIcons = n }; this.setSaveCsvIcons = function (n) { this.visSaveCsvIcons = n }; this.setSavePdfIcons = function (n) { this.visSavePdfIcons = n }; this.setArchiveIcons = function (n) { this.visArchiveIcons = n }; this.setRequeryIcons = function (n) { this.visRequeryIcons = n }; this.setCustomizeIcons = function (n) { this.visCustomizeIcons = n }; this.setPrintIcons = function (n) { this.visPrintIcons = n }; this.setToolbarColor = function (n) { this.toolbarColor = n }; this.getFileType = function () { return a.val() }; this.reportBytes = null; this.reportPath = null; this.showReportTypes = function (n) { n ? (a.css("display", "block"), w.css("display", "block")) : (a.css("display", "none"), w.css("display", "none")) }; this.showBackgroundProcess = function (n) { n ? (e.parameterFixedArea.addClass("vis-process-pram-checkbox-text"), l.css("display", "flex")) : (e.parameterFixedArea.removeClass("vis-process-pram-checkbox-text"), l.css("display", "none")) }; this.enableBackgroundSetting = function (n) { l.prop("checked", n); n == !0 ? l.prop("disabled", "disabled") : l.prop("disabled", "") }; this.archiveDocument = function (i, r) { i.setBusy(!0); t.ajax({ url: n.Application.contextUrl + "JsonData/ArchiveDoc/", dataType: "json", type: "post", data: { VAF_Job_ID: r.pi.getVAF_Job_ID(), Name: r.pi.getTitle(), VAF_TableView_ID: r.pi.getTable_ID(), Record_ID: r.pi.getRecord_ID(), VAB_BusinessPartner_ID: 0, isReport: !0, binaryData: e.reportBytes, reportPath: e.reportPath }, success: function () { n.ADialog.info("Archived", !0, "", ""); i.setBusy(!1) } }) }; h.on("click", function () { e.onclickTrigger(e) }); this.onclickTrigger = function (t) { var i, r; if (t.isComplete) { t.dispose(); return } i = null; i = new n.ProcessInfo(t.jpObj.Name, t.jpObj.VAF_Job_ID, 0, 0); i.setVAF_UserContact_ID(t.ctx.getVAF_UserContact_ID()); i.setVAF_Client_ID(t.ctx.getVAF_Client_ID()); i.setUseCrystalReportViewer(n.context.getIsUseCrystalReportViewer()); i.setIsBackground(l.is(":checked")); i.setIsReport(t.isReport); r = new n.ProcessCtl(t, i, null); i.setFileType(a.val()); t.windowNo ? r.process(t.windowNo) : r.process(n.Env.getWindowNo()); r = null }; v.on("click", function () { e.parent.dispose() }); b.on("click", function (n) { n.stopPropagation(); n.preventDefault(); e.parameterContainer.width() > 40 ? (e.parameterContainer.css("flex-basis", "40px"), e.parameterFixedArea.hide(), e.getParametersContainer().find(".vis-pro-para-root").hide(), e.getParametersContainer().find(".vis-process-ok-btn").hide()) : (e.parameterContainer.css("flex-basis", "280px"), e.parameterFixedArea.show(), e.getParametersContainer().find(".vis-pro-para-root").show(), e.getParametersContainer().find(".vis-process-ok-btn").show()) }); this.disposeComponent = function () { h && h.off("click"); v && v.off("click"); c && c.remove(); c = null; this.reportContainer && this.reportContainer.remove(); this.parameterContainer && this.parameterContainer.remove(); this.reportToolbar && this.reportToolbar.remove(); this.partitionContainer && this.partitionContainer.remove(); s && s.remove(); s = null; h = v = o = null; this.$parentWindow = null; this.isComplete = !1; this.jpObj = null; e = null } } function e(n, i, r) { var u = null; return t.ajax({ url: o, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } var r = n.Application.contextUrl, u = r + "JsonData/ExecuteNonQuer", f = function (n, i, r) { var e = r ? !0 : !1, f = null, o = { sql: n.join("/"), param: i }; return t.ajax({ url: u + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: e, data: JSON.stringify(o) }).done(function (n) { f = n; r && r(n) }), f }; i.prototype.init = function (t, i, r) { if (t.Name == null || t.Name == "") return n.ADialog.info("Process Name is empty"), fasle; if (this.ctx.setWindowContext(r, "IsSOTrx", t.IsSOTrx), i.getContentGrid().append(this.getRoot()), this.isReport = t.IsReport, this.setMsg(t.MessageText), this.setBusy(!1), this.parent = i, this.jpObj = t, this.additemtoToolbar(), t.IsReport ? (this.showReportTypes(!0), this.loadFileTypes(), t.IsCrystal && n.context.getIsUseCrystalReportViewer() && this.parameterFixedArea.hide()) : (this.showBackgroundProcess(!0), this.enableBackgroundSetting(t.IsBackground)), this.setMsgHeight(t.IsReport), t.HasPara || this.showOkIcon(!0), this.splitUI && t.HasPara) this.onclickTrigger(this); return this.splitUI && (this.parent.getContentGrid().empty(), this.parent.getContentGrid().append(this.partitionContainer)), this.windowNo = r, !0 }; i.prototype.setTitle = function (t) { this.parent && this.parent.setTitle(n.Utility.Util.cleanMnemonic(t)) }; i.prototype.lockUI = function () { this.isLocked = !0; this.setBusy(!0) }; i.prototype.unlockUI = function (t) { t.logs && t.logs.length > 0 && (t.logs = null); n.ProcessInfoUtil.setLogFromDB(t); var i = ""; t && t.getSummary() ? i = "<p style='float: left;width: 100%;'><font color=\"" + (t.getIsError() ? "#FF0000" : "#0000FF") + '">** ' + t.getSummary() + "<\/font><\/p>" : this.jpObj.IsReport || (i = "<p style='float: left;width: 100%;'><font color=\"" + (t.getIsError() ? "#FF0000" : "#0000FF") + '">** <\/font><\/p>'); i += t.customHTML && t.customHTML != "" ? t.customHTML : t.getLogInfo(!0); this.setMsg(i); this.setBusy(!1); t.setSummary(""); this.isLocked = !1 }; i.prototype.getIsUILocked = function () { return this.isLocked }; i.prototype.dispose = function () { this.disposed || (this.disposed = !0, this.mPanel && (this.mPanel.dispose(), this.mPanel = null), this.parent && (this.parent.dispose(), this.parent = null), n.Env.clearWinContext(this.ctx, this.windowNo), this.disposeComponent()) }; var r = n.Application.contextUrl, o = r + "JsonData/JDataSetWithCode", u = r + "JsonData/ExecuteNonQuer", s = function (t, i, r) { var o = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, e(f, o, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, h = function (t, i, r) { var f = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u = null; return e(o, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, f = function (n, i, r) { var e = r ? !0 : !1, f = null, o = { sql: n, param: i }; return t.ajax({ url: u + "iesWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: e, data: JSON.stringify(data) }).done(function (n) { f = n; r && r(n) }), f }; i.prototype.createUI = function (i, r, u) { function ft(i, u) { var st = r.pi.get_VAF_Print_Rpt_Layout_Table_ID(), ot, ft, f, ut; if (w = n.MRole.getDefault().getIsCanExport(st), ot = [], ft = -1, s = [], f = null, t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetPrintFormatDetails", data: { VAF_TableView_ID: st }, success: function (t) { var i, r; f = (new n.DB.DataReader).toJson(t); try { while (f.read()) ft = parseInt(ft) + 1, i = f.getString(1), ot.indexOf(i) > -1 && (i = i + "_" + (parseInt(ft) + 1)), r = {}, r.ID = n.Utility.Util.getValueOfInt(f.get(0)), r.Name = i, r.IsDefault = f.getString(3), ot.push(f.getString(1)), s.push(r); f.close() } catch (u) { f.close() } f = null } }), et(), rt = t("<div>"), h = t('<select class="vis-selectcsview-page">'), c = t("<ul class='vis-apanel-rb-ul'>"), e.cssForAll ? (b = t("<li><a  title='" + n.Msg.getMsg("SaveAllRecordCsv") + "' class='vis vis-csv-all'><\/a><\/li>"), k = t("<li><a  title='" + n.Msg.getMsg("SaveAllPagePdf") + "' class='vis vis-pdf-all'><\/a><\/li>")) : (b = t("<li><a  title='" + n.Msg.getMsg("SaveAllRecordCsv") + "' class='vis vis-csv-all'><\/a><\/li>"), k = t("<li><a  title='" + n.Msg.getMsg("SaveAllPagePdf") + "' class='vis vis-pdf-all'><\/a><\/li>")), d = t("<div class='vis-report-header vis-ad-print-process'>"), d.append(t('<div class="vis-ad-w-p-t-name vis-ad-process-header"><h5>' + e.parent.getName() + "<\/h5><\/div >")), v = t('<div class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/div >'), g = t('<div class="vis-report-top-icons">'), o = t('<ul  class="vis-reporticonsulprint">'), p = t("<li><a class='" + e.visRepformatIcons + "'><\/a><\/li>"), c.append(t('<li data-id="-1">').append(n.Msg.getMsg("NewReport"))), rt.append(c), o.append(p), w && (tt = t("<li><a title='" + n.Msg.getMsg("SaveCSVPage") + "' class='vis vis-save-csv'><\/a><\/li>"), o.append(tt)), r.pi.getSupportPaging() && w) { for (o.append(b), ut = 1; ut < r.pi.getTotalPages() + 1; ut++)h.append(t("<option value=" + ut + ">" + ut + "<\/option>")); g.append(h) } w && (it = t("<li><a title='" + n.Msg.getMsg("SavePDFDocumentPage") + "' class='vis vis-save-pdf'><\/a><\/li>"), o.append(it)); r.pi.getSupportPaging() && w ? o.append(k) : (tt.find("a").attr("title", n.Msg.getMsg("SaveCSV")), it.find("a").attr("title", n.Msg.getMsg("SavePdf"))); n.context.ctx["#BULK_REPORT_DOWNLOAD"] == "Y" ? (b.css("display", ""), k.css("display", "")) : (b.css("display", "none"), k.css("display", "none")); nt = t("<li><a title='" + n.Msg.getMsg("Archive") + "'  class='vis vis-archive'><\/a><\/li>"); o.append(nt); y = t("<li><a title='" + n.Msg.getMsg("Requery") + "'  class='vis vis-refresh'><\/a><\/li>"); o.append(y); l = t("<li><a style='cursor:pointer;' class='vis vis-customize'><\/a><\/li>"); o.append(l); a = t("<li><a style='cursor:pointer;' class='vis vis-print'><\/a><\/li>"); o.append(a); u.HTML || (a.css("display", "none"), l.css("display", "none"), p.css("display", "none")); g.append(o); d.append(g); e.hideclose || d.append(v); e.splitUI ? (e.reportToolbar.removeClass("vis-processtoolpadd"), e.reportToolbar.empty().append(d), e.reportContainer.empty().append(i.getRoot()), e.extrnalForm && e.getContentTable().empty().append(e.reportContainer)) : (e.parent.getContentGrid().append(d).append(i.getRoot()), i.getRoot().css("width", t(window).width())) } function ut(i) { function lt(n) { r.pi.setFileType(n); return { processInfo: r.pi.toJson(), parameterList: r.paraList } } function wt(n, t) { return { VAF_Job_ID: r.pi.getVAF_Job_ID(), Name: r.pi.getTitle(), VAF_JInstance_ID: r.pi.getVAF_JInstance_ID(), VAF_TableView_ID: r.pi.getTable_ID(), Record_ID: r.pi.getRecord_ID(), pageNumber: n, page_Size: t, saveAll: !1 } } function ot(n, t, i, u, f, e) { return { processInfo: r.pi.toJson(), queryInfo: JSON.stringify(n), code: t, isCreateNew: i, treeID: f, node_ID: u, IsSummary: e } } function bt(n, t, i, r, u, f, e, o) { return { VAF_Job_ID: n, Name: t, VAF_JInstance_ID: i, VAF_TableView_ID: r, Record_ID: u, pageNumber: f, page_Size: e, printAllPages: o } } function at(t, i) { n.dataContext.executeProcess(t, function (n) { if (n.error != null) { r.pi.setSummary(n.error, !0); r.unlock(); r = null; return } var t = JSON.parse(n.result); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } i(t) }) } function d(i, r) { var f, u, o, s, c, h; try { if (i.HTML) { if (r.getRightInnerDiv().html(i.HTML), f = document.getElementsByClassName("vis-reptabledetect"), f.length > 0) { for (u = 0, o = 0, s = 0, c = f.length; s < c; s++)o = t(f[s]).width(), o > u && (u = o); r.getRightDiv().width(t(window).width() - 10); r.getRightDiv().css("min-width", t(window).width() + "px"); r.getRightInnerDiv().width(u + 50) } r.getRightInnerDiv().width(u) } else i.ReportFilePath && (h = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), h.attr("src", n.Application.contextUrl + i.ReportFilePath), r.getRightDiv().empty().append(h), e.reportPath = i.ReportFilePath) } catch (l) { } r.setBusy(!1) } function kt(t, i, r, u, f) { t.HTML && t.HTML.length > 0 ? d(t, i) : u == 0 ? (window.open(n.Application.contextUrl + t.ReportFilePath), i.setBusy(!1)) : ft(u, t.ReportFilePath, f, t) } function ft(i, r, f, e) { f.setBulkBusy(!1); t("#forreportdownload").addClass("hide"); et += '<input type="checkbox" data-num="' + e + '"  data-url="' + n.Application.contextUrl + r + '" checked />'; u += 1; updateCreateBar(u / i * 100); u == i && setTimeout(function () { updateCreateBar(100); showCreateMessage(n.Msg.getMsg("Generated")); t("<form>", { id: "download_form", html: et, action: "#", Class: "hide" }).appendTo(document.body).submit() }, 1e3) } function st(u) { var f = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + r.pi.dynamicAction, type: "Post", data: f, success: function (f) { var o = JSON.parse(f), s; return ct || u != r.REPORT_TYPE_PDF ? window.open(n.Application.contextUrl + o) : (s = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), s.attr("src", n.Application.contextUrl + o), i.getRightDiv().empty().append(s), e.reportPath = o.ReportFilePath), i.setBusy(!1), o.ReportFilePath } }) } function vt(u, f, e) { r.pi.setPageNo(u); var o = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + r.pi.dynamicAction, type: "Post", data: o, success: function (n) { n = JSON.parse(n); ft(e, n, f, u); i.setBusy(!1) } }) } var ht = e.parent, ct = /ipad|iphone|ipod|mobile|android|blackberry|webos|windows phone/i.test(navigator.userAgent.toLowerCase()), yt, pt, u, ri, et; v.off("click"); y.off("click"); l.off("click"); a.off("click"); p.off("click"); c.off("click"); nt.off("click"); v.on("click", function () { i && (i.dispose(), i = null); ht && (ht.dispose(), ht = null); r.pi && r.pi.dispose(); r.pi = null; o.empty(); v.off("click"); y.off("click"); l.off("click"); a.off("click"); p.off("click"); c.off("click"); v = null; g = null; o = null; nt = null; y = null; l = null; a = null; tt = null; it = null; ut = null }); y.on("click", function () { i.setBusy(!0); i.getRightInnerDiv().html(""); i.getRightInnerDiv().width(0); r.pi.dynamicAction && r.pi.dynamicAction.length > 0 ? st(r.REPORT_TYPE_PDF, h.val()) : loadReportData() }); l.on("click", function () { var t = new n.Query; t.addRestriction("VAF_Print_Rpt_Layout_ID", n.Query.prototype.EQUAL, r.pi.VAF_Print_Rpt_Layout_ID); n.viewManager.startWindow(240, t) }); a.on("click", function () { if (i.getIsHtmlReport()) { var n = window.open(); n.document.write("<html><head>"); n.document.write("<\/head><body >"); n.document.write(i.getHtml()); n.document.write("<\/body><\/html>"); n.print(); n.close() } }); if (w) { tt.on("click", function () { r.pi.setFileType("C"); r.pi.getPageNo() == 1 ? (i.setBusy(!0), at(lt(r.REPORT_TYPE_CSV), function (t) { window.open(n.Application.contextUrl + t.ReportFilePath); i.setBusy(!1) })) : (i.setBusy(!0), window.setTimeout(function () { if (r.pi.dynamicAction && r.pi.dynamicAction.length > 0) st(r.REPORT_TYPE_CSV, r.pi.getPageNo()); else if (r.pi.GetVAF_ReportView_ID() > 0) pt(h.val(), 0, null); else if (r.pi.getIsJasperReport()) dt("C", r.pi.getPageNo()); else { pageNo = h.val(); var u = wt(pageNo, r.pi.getPageSize()); t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReportforCsv", type: "Post", data: u, success: function (t) { var r = JSON.parse(t); window.open(n.Application.contextUrl + "TempDownload/" + r); i.setBusy(!1) } }) } }, 100)) }); it.on("click", function () { r.pi.setFileType(r.REPORT_TYPE_PDF); r.pi.getPageNo() == 1 ? (i.setBusy(!0), at(lt(r.REPORT_TYPE_PDF), function (n) { d(n, i) })) : loadReportData() }); function loadReportData() { i.setBusy(!0); window.setTimeout(function () { if (r.pi.dynamicAction && r.pi.dynamicAction.length > 0) st(r.REPORT_TYPE_PDF, r.pi.getPageNo()); else if (r.pi.GetVAF_ReportView_ID() > 0) yt(r.pi.getPageNo(), 0, null); else if (r.pi.getIsJasperReport()) dt(r.REPORT_TYPE_PDF, r.pi.getPageNo()); else if (r.pi.getIsReportFormat()) { var u = bt(r.pi.getVAF_Job_ID(), r.pi.getTitle(), r.pi.getVAF_JInstance_ID(), r.pi.getTable_ID(), r.pi.getRecord_ID(), r.pi.getPageNo(), r.pi.getPageSize(), !1); t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReport", type: "Post", data: u, success: function (r) { var u = JSON.parse(r), f; ct ? window.open(n.Application.contextUrl + u) : (f = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), f.attr("src", n.Application.contextUrl + u), i.getRightDiv().empty().append(f)); e.reportPath = u; i.setBusy(!1) } }) } else at(lt(r.REPORT_TYPE_PDF), function (n) { d(n, i) }) }, 200) } h.on("change", function () { var u, f, o; pageNo = h.val(); r.pi.GetVAF_ReportView_ID() > 0 ? (i.setBusy(!0), u = [], r.pi.setPageNo(pageNo), f = new n.Query(r.pi.getPrintFormatTableName()), r.pi.getPrintFormatTableName() && (u.push(f.getTableName()), u.push(f.getWhereClause(!0))), o = ot(u, "", !1, 0, 0, !1), t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", type: "POST", data: o, success: function (n) { var t = jQuery.parseJSON(n); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } d(t.repInfo, i); e.reportPath = t.repInfo.ReportFilePath } })) : r.pi.setPageNo(pageNo) }); function dt(u) { r.pi.setFileType(u); var f = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + "JasperReport/ExecuteReport", type: "Post", data: f, success: function (f) { var o = JSON.parse(f), s; ct ? window.open(n.Application.contextUrl + o) : (u == r.REPORT_TYPE_PDF ? (s = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), s.attr("src", n.Application.contextUrl + o), i.getRightDiv().empty().append(s)) : window.open(n.Application.contextUrl + o), e.reportPath = o); i.setBusy(!1) } }) } function gt(u, f, e) { var o; r.pi.setPageNo(u); o = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + "JasperReport/ExecuteReport", type: "Post", data: o, success: function (n) { n = JSON.parse(n); ft(f, n, e, u); i.setBusy(!1) } }) } b.on("click", function () { i.setBusy(!0); u = 0; et = ""; r.pi.setFileType("C"); window.setTimeout(function () { var i = new n.BulkDownload(e.windowNo, "CSV"), t; if (i.onClose = function () { }, i.show(), r.pi.dynamicAction && r.pi.dynamicAction.length > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)vt(t, i, r.pi.getTotalPages()); else if (r.pi.GetVAF_ReportView_ID() > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)pt(t, r.pi.getTotalPages(), i); else if (r.pi.getIsJasperReport()) for (t = 1; t <= r.pi.getTotalPages(); t++)gt(t, r.pi.getTotalPages(), i); else for (t = 1; t <= r.pi.getTotalPages(); t++)ti(t, i, r.pi.getTotalPages()); r.pi.setPageNo(h.val()) }, 100) }); function ti(u, f, e) { var s = "", o; r.pi.dynamicAction && r.pi.dynamicAction.length > 0 ? s = st(r.REPORT_TYPE_CSV, u) : (o = wt(u, r.pi.getPageSize()), t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReportforCsv", type: "Post", data: o, success: function (n) { var t = JSON.parse(n); t = "TempDownload/" + t; ft(e, t, f, u); i.setBusy(!1) } })) } yt = function (u, f, o) { var s = [], h = new n.Query(r.pi.getPrintFormatTableName()), c; s.push(h.getTableName()); s.push(h.getWhereClause(!0)); c = ot(s, "", !1, 0, 0, !1); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: c, type: "POST", success: function (t) { t == null && n.ADialog.error("ERRORGettingRepData"); var s = jQuery.parseJSON(t), r = s.repInfo; if (r.ErrorText) { n.ADialog.error(r.ErrorText); i.setBusy(!0); return } kt(r, i, u, f, o); i.setBusy(!1); e.reportPath = r.ReportFilePath } }) }; pt = function (u, f, o) { var s = [], h = new n.Query(r.pi.getPrintFormatTableName()), c; s.push(h.getTableName()); s.push(h.getWhereClause(!0)); c = ot(s, "", !1, 0, 0, !1); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: c, type: "POST", success: function (t) { t == null && n.ADialog.error("ERRORGettingRepData"); var s = jQuery.parseJSON(t), r = s.repInfo; if (r.ErrorText) { n.ADialog.error(r.ErrorText); setBusy(!1); return } kt(r, i, u, f, o); e.reportPath = r.ReportFilePath; i.setBusy(!1) } }) }; k.on("click", function () { i.setBusy(!0); u = 0; et = ""; r.pi.setFileType(r.REPORT_TYPE_PDF); window.setTimeout(function () { var i = new n.BulkDownload(e.windowNo, "PDF"), t; if (i.onClose = function () { }, i.show(), r.pi.dynamicAction && r.pi.dynamicAction.length > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)vt(t, i, r.pi.getTotalPages()); else if (r.pi.GetVAF_ReportView_ID() > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)yt(t, r.pi.getTotalPages(), i); else if (r.pi.getIsJasperReport()) for (t = 1; t <= r.pi.getTotalPages(); t++)gt(t, r.pi.getTotalPages(), i); else for (t = 1; t <= r.pi.getTotalPages(); t++)ii(t, i, r.pi.getTotalPages()); r.pi.setPageNo(h.val()) }, 100) }); u = 0; function ii(u, f, o) { var h = "", s; r.pi.dynamicAction && r.pi.dynamicAction.length > 0 ? h = vt(r.REPORT_TYPE_CSV, u) : (s = bt(r.pi.getVAF_Job_ID(), r.pi.getTitle(), r.pi.getVAF_JInstance_ID(), r.pi.getTable_ID(), r.pi.getRecord_ID(), u, r.pi.getPageSize(), !1), t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReport", type: "Post", data: s, success: function (n) { var t = JSON.parse(n); ft(o, t, f, u); e.reportPath = t; i.setBusy(!1) } })) } ri = function () { for (var i, r, u, n = 0; n < arguments.length; n++)i = t('<iframe style="visibility: collapse;"><\/iframe>'), t("body").append(i), r = i[0].contentDocument, u = '<form action="' + arguments[n] + '" method="GET"><\/form>', r.write(u), t("form", r).submit(), setTimeout(function (n) { return function () { n.remove() } }(i), 2e3) }; et = ""; function updateCreateBar(n) { var i = t("#reportcreate").find(".progress-bar").width() * 100 / t("#reportcreate").width(); isNaN(i) && (i = 0); i <= n && t("#reportcreate").removeClass("hide").find(".progress-bar").attr("aria-valuenow", n).css({ width: n + "%" }).text(n.toFixed(0) + "%") } function ni() { t("#reportcreateresult").removeClass().text("") } function showCreateMessage(n) { ni(); t("#reportcreateresult").addClass("alert alert-success").text(n); t("#forreportdownload").removeClass("hide") } function ui(n) { ni(); t("#reportcreateresult").addClass("alert alert-danger").text(n) } } p.on("click", function () { var i, u, r; for (c.empty(), i = 0; i < s.length; i++)u = s[i].IsDefault == "Y" ? "vis-mainfavitem" : "vis-mainnonfavitem", r = t('<li><a data-isdefbtn="no" data-id="' + s[i].ID + '">' + s[i].Name + "<\/a><\/li>"), c.append(r); c.append(t('<li><a data-id="-1">' + n.Msg.getMsg("NewReport") + "<\/a>")); t(this).w2overlay(rt.clone(!0), { css: { height: "300px" } }) }); c.on("click", "LI", function (u) { var v, h, y, o, c, p, l, a, w; if (i.setBusy(!0), v = t(u.target), h = v.data("id"), v.data("isdefbtn") == "yes") { for (y = "VIS_76", o = [], o[0] = new n.DB.SqlParam("@tableID", r.pi.vaf_tableview_ID), o[1] = new n.DB.SqlParam("@tabID", curTab.getVAF_Tab_ID()), f(sql, o), y = "VIS_77", o = [], o[0] = new n.DB.SqlParam("@printForamt", h), f(sql, o), c = 0; c < s.length; c++)s[c].IsDefault = s[c].ID == h ? "Y" : "N"; return } VAF_Print_Rpt_Layout_ID = h; p = !1; h == -1 && (h = r.pi.get_VAF_Print_Rpt_Layout_Table_ID, p = !0); l = []; a = new n.Query(r.pi.getPrintFormatTableName()); l.push(a.getTableName()); l.push(a.getWhereClause(!0)); w = ot(l, a.getCode(0), false0, 0, !1); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: w, type: "POST", success: function (n) { var t = jQuery.parseJSON(n); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } d(t.repInfo, i); e.reportPath = t.repInfo.ReportFilePath } }) }); nt.on("click", function () { e.archiveDocument(i, r) }) } function et() { e.visRepformatIcons && e.visRepformatIcons.length != 0 || (e.visRepformatIcons = e.cssForAll ? e.cssForAll + "vis vis-format" : "vis vis-format"); e.visSaveCsvIcons = e.visSaveCsvIcons && e.visSaveCsvIcons.length != 0 ? e.visSaveCsvIcons + " vis-report-icon " : " vis vis-save-csv"; e.visSavePdfIcons = e.visSavePdfIcons && e.visSavePdfIcons.length != 0 ? e.visSavePdfIcons + " vis-report-icon " : " vis vis-save-pdf"; e.visArchiveIcons = e.visArchiveIcons && e.visArchiveIcons.length != 0 ? e.visArchiveIcons + " vis-report-icon " : " vis vis-archive"; e.visRequeryIcons = e.visRequeryIcons && e.visRequeryIcons.length != 0 ? e.visRequeryIcons + " vis-report-icon " : " vis vis-refresh"; e.visCustomizeIcons = e.visCustomizeIcons && e.visCustomizeIcons.length != 0 ? e.visCustomizeIcons + " vis-report-icon " : " vis vis-customize"; e.visPrintIcons = e.visPrintIcons && e.visPrintIcons.length != 0 ? e.visPrintIcons + " vis-report-icon " : " vis vis-print " } var v = null, g = null, o = null, nt = null, y = null, l = null, a = null, tt = null, it = null, p = null, w = !1, s = [], rt = null, h = null, c = null, b = null, k = null, e = this, d = null; ft(i, u); ut(i, u) }; i.prototype.showReport = function (t, i, r) { var u = this; this.splitUI || (this.mPanel && (this.mPanel.dispose(), this.mPanel = null), this.disposeComponent()); this.mPanel = t; this.pCtl = r; this.createUI(t, r, i); this.parent.hideHeader(!0); t.setBusy(!1); (n.context.ctx.$AutoArchive == "1" || n.context.ctx.$AutoArchive == "2") && u.archiveDocument(t, r) }; i.prototype.showTelerikReport = function (n, t) { var i = new KJS.TelerikContainer(n, t); i.getRoot().height(this.parent.getContentGrid().height()); this.parent.getContentGrid().empty(); this.parent.getContentGrid().append(i.getRoot()); i.init() }; i.prototype.setReportBytes = function (n) { this.reportBytes = n }; i.prototype.setReportPath = function (n) { this.reportPath = n }; i.prototype.sizeChanged = function (n, t) { this.setSize(n, t); this.mPanel && this.mPanel.sizeChanged && !this.splitUI && this.mPanel.sizeChanged(n, t); this.setParameterHeights && this.setParameterHeights(n, t) }; i.prototype.refresh = function () { this.setParameterHeights && this.setParameterHeights(); this.mPanel && this.mPanel.refresh && this.mPanel.refresh(); this.setMsg && this.setMsg("") }; n.AProcess = i }(VIS, jQuery), function (n, t) { function i(n, t) { this.parent = n; this.pi = t; this.windowNo; this.paraList = null; this.splitUI = n.splitUI; this.parameters = null; this.cansplitUI = function (n) { splitUI = n }; this.getFileType = function () { return n.getFileType() }; this.setBusy = function (t) { n.setBusy(t) }; this.isBackground = function () { return n.isBackground() } } function r(i, r, u) { function h() { e = t("<div class='vis-height-full'>"); f = t("<div class='vis-height-full'>"); f.css("background-color", "rgba(var(--v-c-primary), .3)"); $innerRightDiv = t("<div class='vis-height-full' style='padding:5px;'>"); e.append(f); e.append(s); u ? (f.append($innerRightDiv), $innerRightDiv.html(i)) : (o = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), o.attr("src", n.Application.contextUrl + i), f.css("height", "100%"), f.css("width", "100%"), f.append(o)) } this.bytes = null; this.RptFileName = i; this.Pi = r; var e = null, f = null; $innerRightDiv = null; var o = null, s = t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"); h(); this.getRoot = function () { return e }; this.getRightDiv = function () { return f }; this.getRightInnerDiv = function () { return $innerRightDiv }; this.getIsHtmlReport = function () { return u }; this.getHtml = function () { return i }; this.disposeComponent = function () { e != null && (e.remove(), e = null) }; this.setBusy = function (n) { s.css("display", n ? "block" : "none") }; this.sizeChanged = function () { }; this.refresh = function () { } } i.prototype.REPORT_TYPE_CSV = "C"; i.prototype.REPORT_TYPE_PDF = "P"; i.prototype.REPORT_TYPE_RTF = "R"; i.prototype.process = function (t) { var i, r; this.lock(); this.windowNo = t; this.pi.setWindowNo(t); i = this; this.jObjectFromServer = null; r = { processInfo: this.pi.toJson() }; n.dataContext.process(r, function (n) { if (n.error != null) { i.pi.setSummary(n.error, !0); i.unlock(); i = null; return } var t = JSON.parse(n.result); if (t.IsError) { i.pi.setSummary(t.Message, !0); i.unlock(); i = null; return } i.complete(t); i = null }) }; i.prototype.complete = function (t) { var i, u, r, f, e; if (this.jObjectFromServer = t, this.pi.setVAF_JInstance_ID(t.VAF_JInstance_ID), this.pi.setCustomHTML(t.CustomHTML), t && t.ReportProcessInfo && (this.pi.setTotalPages(t.ReportProcessInfo.TotalPage), this.pi.setSupportPaging(t.ReportProcessInfo.SupportPaging), this.pi.setPageSize(t.ReportProcessInfo.PageSize)), t.ShowParameter) { this.pi.setVAF_JInstance_ID(t.VAF_JInstance_ID); try { i = new n.ProcessParameter(this.pi, this, this.windowNo); this.splitUI && (this.parent.parameterContainer.append(i.getRoot()), this.parent.setParameterHeights()); i.initDialog(t.ProcessFields); this.splitUI ? i.showCloseIcon(this.parent.getShowParameterCloseIcon()) : (i.showDialog(), i = null) } catch (o) { this.pi.setSummary(o.message, !0) } this.unlock() } else t.IsTelerikReport ? window.KJS && this.parent && this.parent.showTelerikReport(this.pi.VAF_JInstance_ID, this.pi.getTable_ID()) : (this.unlock(), this.parent && (t.AskForNewTab && t.HTML && t.HTML.length > 0 ? n.ADialog.confirm("VIS_OpenNewTab", !0, "", "Confirm", function (i) { i && window.open(n.Application.contextUrl + t.ReportFilePath) }) : t.ReportFilePath ? (u = /ipad|iphone|ipod|mobile|android|blackberry|webos|windows phone/i.test(navigator.userAgent.toLowerCase()), u ? window.open(n.Application.contextUrl + t.ReportFilePath) : this.parent.setReportBytes ? (this.parent.setReportBytes(t.Report), this.parent.setReportPath(t.ReportFilePath), r = null, f = !1, t.HTML && t.HTML.length > 0 ? (r = new n.PdfViewer(t.HTML, null, !0), this.parent.showReport(r, t, this)) : t.ReportFilePath && t.ReportFilePath.length > 0 && (r = new n.PdfViewer(t.ReportFilePath), f = !0, this.parent.showReport(r, t, this))) : window.open(n.Application.contextUrl + t.ReportFilePath)) : this.pi.getUseCrystalReportViewer() && this.pi.getIsReport() && (e = new n.ReportViewerContainer(this), e.show()))), this.setBusy(!1), this.dispose() }; i.prototype.onProcessDialogClosed = function (t, i) { var r, u; t && (r = this, this.paraList = i, this.lock(), u = { processInfo: r.pi.toJson(), parameterList: i }, n.dataContext.executeProcess(u, function (n) { if (n.error != null) { r.pi.setSummary(n.error, !0); r.unlock(); r = null; return } var t = JSON.parse(n.result); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } r.complete(t); this.splitUI || (r = null) })) }; i.prototype.unlock = function () { var t = this.jObjectFromServer ? this.jObjectFromServer.Result : null; t != null && t.indexOf("@") != -1 ? this.pi.setSummary(n.Msg.parseTranslation(n.Env.getCtx(), t)) : t && this.pi.setSummary(t); this.jObjectFromServer && this.pi.setError(this.jObjectFromServer.IsError); this.parent && this.parent.unlockUI(this.pi) }; i.prototype.lock = function () { this.parent && this.parent.lockUI(this.pi) }; i.prototype.dispose = function () { this.splitUI || (this.parent = null) }; r.prototype.dispose = function () { this.disposeComponent() }; n.PdfViewer = r; n.ProcessCtl = i }(VIS, jQuery), function (n, t) { function i(t, i, r, u) { this.title = t; this.VAF_Job_ID = i; this.table_ID = r; this.tableName = ""; this.record_ID = u; this.VAF_UserContact_ID = 0; this.VAF_Client_ID = 0; this.className = null; this.VAF_JInstance_ID = 0; this.summary = ""; this.error = !1; this.batch = !1; this.timeout = !1; this.parameter = null; this.VAF_Print_Rpt_Layout_Table_ID = 0; this.VAF_Print_Rpt_Layout_ID = 0; this.isReportFormat = !1; this.isCrystal = !1; this.totalrecords = 0; this.isTelerikReport = !1; this.supportPaging = !1; this.dynamicAction = ""; this.pageSize = n.context.ctx["#REPORT_PAGE_SIZE"]; this.totalPage = 1; this.pageNo = 1; this.fileType = n.ProcessCtl.prototype.REPORT_TYPE_PDF; this.windowNo = 0; this.tableName = ""; this.VAF_Screen_ID = 0; this.VAF_ReportView_ID = 0; this.printFormatTableName = ""; this.useCrystalReportViewer = !1; this.isReport = !1; this.isBackground = !1 } function u(n, t) { n.className = t.ClassName; n.record_ID = t.Record_ID; n.error = t.Error; n.VAF_JInstance_ID = t.VAF_JInstance_ID; n.summary = t.Summary; n.table_ID = t.VAF_TableView_ID; n.tableName = t.VAF_TableViewName; n.VAF_UserContact_ID = t.VAF_UserContact_ID; n.VAF_Client_ID = t.VAF_Client_ID; n.batch = t.Batch; n.timeout = t.TimeOut; n.VAF_Print_Rpt_Layout_Table_ID = t.VAF_Print_Rpt_Layout_Table_ID; n.printFormatTableName = t.PrintFormatTableName; n.VAF_Print_Rpt_Layout_ID = t.VAF_Print_Rpt_Layout_ID; n.isCrystal = t.IsCrystal; n.isReportFormat = t.IsReportFormat; n.totalrecords = parseInt(t.TotalRecords); n.isTelerikReport = t.IsTelerikReport; n.supportPaging = t.SupportPaging; n.dynamicAction = t.DynamicAction; n.pageSize = t.PageSize; n.title = t.Title; n.VAF_Job_ID = t.Process_ID; n.totalPage = t.TotalPage; n.pageNo = t.PageNo; n.windowNo = t.WindowNo; n.VAF_ReportView_ID = t.VAF_ReportView_ID; n.isJasperReport = t.IsJasperReport; n.useCrystalReportViewer = t.UseCrystalReportViewer; n.isReport = t.IsReport; n.isBackground = t.IsBackground } function s(n, i, r) { var u = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function r(n, t, i, r, u) { this.P_ID; this.P_Date; this.P_Number; this.P_Msg; n ? this.setLog_ID(n) : this.setLog_ID(this.Log_ID++); this.setP_ID(t); this.setP_Date(i); this.setP_Number(r); this.setP_Msg(u) } i.prototype.toJson = function () { return { Title: this.title, Process_ID: this.VAF_Job_ID, VAF_JInstance_ID: this.VAF_JInstance_ID, Record_ID: this.record_ID, Error: this.error, Summary: this.getSummary(), ClassName: this.className, VAF_TableView_ID: this.table_ID, VAF_TableViewName: this.tableName, VAF_UserContact_ID: this.VAF_UserContact_ID, VAF_Client_ID: this.VAF_Client_ID, Batch: this.batch, TimeOut: this.timeout, VAF_Print_Rpt_Layout_Table_ID: this.VAF_Print_Rpt_Layout_Table_ID, PrintFormatTableName: this.printFormatTableName, VAF_Print_Rpt_Layout_ID: this.VAF_Print_Rpt_Layout_ID, SupportPaging: this.supportPaging, DynamicAction: this.dynamicAction, PageSize: this.pageSize, TotalPage: this.totalPage, PageNo: this.pageNo, FileType: this.fileType, VAF_Screen_ID: this.VAF_Screen_ID, WindowNo: this.windowNo, VAF_ReportView_ID: this.VAF_ReportView_ID, UseCrystalReportViewer: this.useCrystalReportViewer, IsReport: this.isReport, IsBackground: this.isBackground } }; i.prototype.fromJson = function (n) { var t = null; return t = this instanceof i ? this : new i(n.Title, n.Process_ID), n && n.length > 0 && u(t, n), t }; i.prototype.setPrintFormatTableName = function (n) { this.printFormatTableName = n }; i.prototype.getPrintFormatTableName = function () { return this.printFormatTableName }; i.prototype.setSupportPaging = function (n) { this.supportPaging = n }; i.prototype.getSupportPaging = function () { return this.supportPaging }; i.prototype.setTotalPages = function (n) { this.totalPage = n }; i.prototype.getTotalPages = function () { return this.totalPage }; i.prototype.setPageNo = function (n) { this.pageNo = n }; i.prototype.getPageNo = function () { return this.pageNo }; i.prototype.setPageSize = function (n) { this.pageSize = n }; i.prototype.getPageSize = function () { return this.pageSize }; i.prototype.setError = function (n) { this.error = n }; i.prototype.getIsError = function () { return this.error }; i.prototype.getIsBatch = function () { return this.batch }; i.prototype.setIsBatch = function (n) { this.batch = n }; i.prototype.getVAF_JInstance_ID = function () { return this.VAF_JInstance_ID }; i.prototype.setVAF_JInstance_ID = function (n) { this.VAF_JInstance_ID = n }; i.prototype.getVAF_Job_ID = function () { return this.VAF_Job_ID }; i.prototype.setVAF_Job_ID = function (n) { this.VAF_Job_ID = n }; i.prototype.getClassName = function () { return this.className }; i.prototype.setClassName = function (n) { this.className = n; n != null && n.length == 0 && (this.className = null) }; i.prototype.getTable_ID = function () { return this.table_ID }; i.prototype.setTable_ID = function (n) { this.table_ID = n }; i.prototype.setTable_Name = function (n) { this.tableName = n }; i.prototype.getTable_Name = function () { return this.tableName }; i.prototype.setPrintFormatTableName = function (n) { this.printFormatTableName = n }; i.prototype.getPrintFormatTableName = function () { return this.printFormatTableName }; i.prototype.getRecord_ID = function () { return this.record_ID }; i.prototype.setRecord_ID = function (n) { this.record_ID = n }; i.prototype.getTitle = function () { return this.title }; i.prototype.setTitle = function (n) { this.title = n }; i.prototype.setVAF_Client_ID = function (n) { this.VAF_Client_ID = n }; i.prototype.getVAF_Client_ID = function () { return this.VAF_Client_ID }; i.prototype.setVAF_UserContact_ID = function (n) { this.VAF_UserContact_ID = n }; i.prototype.getVAF_UserContact_ID = function () { return this.VAF_UserContact_ID }; i.prototype.getParameter = function () { return this.parameter }; i.prototype.setParameter = function (n) { this.parameter = n }; i.prototype.setIsTimeout = function (n) { this.timeout = n }; i.prototype.getIsTimeout = function () { return this.timeout }; i.prototype.set_VAF_Print_Rpt_Layout_Table_ID = function (n) { this.VAF_Print_Rpt_Layout_Table_ID = n }; i.prototype.get_VAF_Print_Rpt_Layout_Table_ID = function () { return this.VAF_Print_Rpt_Layout_Table_ID }; i.prototype.set_VAF_Print_Rpt_Layout_ID = function (n) { this.VAF_Print_Rpt_Layout_ID = n }; i.prototype.Get_VAF_Print_Rpt_Layout_ID = function () { return this.VAF_Print_Rpt_Layout_ID }; i.prototype.setIsCrystal = function (n) { this.isCrystal = n }; i.prototype.getIsCrystal = function () { return this.isCrystal }; i.prototype.setIsTelerikReport = function (n) { this.isTelerikReport = n }; i.prototype.getIsTelerikReport = function () { return this.isTelerikReport }; i.prototype.setIsReportFormat = function (n) { this.isReportFormat = n }; i.prototype.getIsReportFormat = function () { return this.isReportFormat }; i.prototype.getTotalRecord = function () { return this.totalrecords }; i.prototype.getFileType = function () { return this.fileType }; i.prototype.setFileType = function (n) { this.fileType = n }; i.prototype.setWindowNo = function (n) { this.windowNo = n }; i.prototype.getWindowNo = function () { return this.windowNo }; i.prototype.setUseCrystalReportViewer = function (n) { this.useCrystalReportViewer = n }; i.prototype.getUseCrystalReportViewer = function () { return this.useCrystalReportViewer }; i.prototype.setIsReport = function (n) { this.isReport = n }; i.prototype.getIsReport = function () { return this.isReport }; i.prototype.GetVAF_ReportView_ID = function () { return this.VAF_ReportView_ID }; i.prototype.SetVAF_ReportView_ID = function (n) { this.VAF_ReportView_ID = n }; i.prototype.setIsJasperReport = function (n) { this.isJasperReport = n }; i.prototype.getIsJasperReport = function () { return this.isJasperReport }; i.prototype.setVAF_Screen_ID = function (n) { this.VAF_Screen_ID = n }; i.prototype.getVAF_Screen_ID = function () { return this.VAF_Screen_ID }; i.prototype.setIsBackground = function (n) { this.isBackground = n }; i.prototype.getIsBackground = function () { return this.isBackground }; i.prototype.setSummary = function (n, t) { arguments.length == 2 && this.setError(t); this.summary = n }; i.prototype.getSummary = function () { return this.summary }; i.prototype.setCustomHTML = function (n) { this.customHTML = n }; i.prototype.getCustomHTML = function () { return this.customHTML }; i.prototype.addLog = function (n, t, i, u, f) { return this.addLogEntry(new r(n, t, i, u, f)) }; i.prototype.addLogEntry = function (n) { var r, t, i, u; if (n == null) return null; for (this.logs == null && (this.logs = []), r = n.getLog_ID(), t = 0; t < this.logs.length; t++)if (i = this.logs[t], u = i.getLog_ID(), r == u) return i; return this.logs.push(n), n }; i.prototype.getLogInfo = function (t) { var i, u, r, s; if (this.logs == null) return ""; i = new StringBuilder; t && i.append('<div class=\'vis-process-result-table\'><table width="100%" border="0" cellspacing="0" cellpadding="2">'); var f = !1, e = !1, o = !1; for (u = 0; u < this.logs.length; u++)r = this.logs[u], r.getP_Date() != null && (f = !0), r.getP_Number() != null && (e = !0), r.getP_Msg() != null && (o = !0); for (u = 0; u < this.logs.length; u++)t ? i.append("<tr>") : u > 0 && i.append("\n"), r = this.logs[u], r.getP_Date() != null ? (i.append(t ? "<td>" : ""), s = r.getP_Date(), i.append(t ? "<\/td>" : " \t")) : f && i.append(t ? "<td>&nbsp;<\/td>" : " \t"), r.getP_Number() != null ? i.append(t ? "<td>" : "").append(r.getP_Number()).append(t ? "<\/td>" : " \t") : e && i.append(t ? "<td>&nbsp;<\/td>" : " \t"), r.getP_Msg() != null ? i.append(t ? "<td>" : "").append(n.Msg.parseTranslation(n.Env.getCtx(), r.getP_Msg())).append(t ? "<\/td>" : "") : o && i.append(t ? "<td>&nbsp;<\/td>" : ""), t && i.append("<\/tr>"); return t && i.append("<\/table><\/div>"), i.toString() }; i.prototype.dispose = function () { this.title = null; this.VAF_Job_ID = null; this.table_ID = null; this.tableName = null; this.record_ID = null; this.VAF_UserContact_ID = null; this.VAF_Client_ID == null; this.className = null; this.VAF_JInstance_ID = null; this.summary = null; this.error = null; this.batch = null; this.timeout = null; this.parameter = null; this.VAF_Print_Rpt_Layout_Table_ID = null; this.VAF_Print_Rpt_Layout_ID = null; this.isReportFormat = null; this.isCrystal = null; this.totalrecords = null; this.isJasperReport = null; this.customHTML = null }; var f = n.Application.contextUrl, e = f + "JsonData/JDataSetWithCode", o = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, s(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; n.ProcessInfoUtil = { setLogFromDB: function (t) { var r = [], i; r[0] = new n.DB.SqlParam("@VAF_JInstance_ID", t.getVAF_JInstance_ID()); i = null; try { for (i = o("VIS_144", r); i.read();)t.addLog(i.getInt(0), i.getInt(1), i.getDateTime(2), i.getDecimal(3), i.getString(4)) } catch (u) { console.log(u) } finally { i && i.dispose() } } }; r.prototype.Log_ID = 0; r.prototype.getLog_ID = function () { return this.Log_ID }; r.prototype.setLog_ID = function (n) { this.Log_ID = n }; r.prototype.getP_ID = function () { return this.P_ID }; r.prototype.setP_ID = function (n) { this.P_ID = n }; r.prototype.getP_Date = function () { return this.P_Date }; r.prototype.setP_Date = function (n) { this.P_Date = n }; r.prototype.getP_Number = function () { return this.P_Number }; r.prototype.setP_Number = function (n) { this.P_Number = n }; r.prototype.getP_Msg = function () { return this.P_Msg }; r.prototype.setP_Msg = function (n) { this.P_Msg = n }; n.ProcessInfo = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { function b() { e = t("<div class='vis-pro-para-root'>"); l = t("<table class='vis-processpara-table vis-formouterwrpdiv'>"); p = t('<div class="vis-processbtnwrap">'); v = t('<div class="vis-para-maxheight">'); v.append(l); e.append(v).append(p); h = t('<input type="button" class="vis-process-ok-btn" >').val(n.Msg.getMsg("OK")); h.addClass("VIS_Pref_btn-2"); o = t("<input type='button'>").val(n.Msg.getMsg("Close")); o.addClass("VIS_Pref_btn-2"); c || v.css("height", "auto") } var c, e, l, a, y, w, s, h, o, p, v, f; this.pi = i; this.parent = r; this.windowNo = u; this.gridFields = []; this.depOnFieldColumn = []; this.depOnField = []; this.vEditors = []; this.vEditors2 = []; this.mFields = []; this.mFields2 = []; this.isOkClicked = !1; c = r.splitUI; this.onClosed; b(); f = this; this.addLine = function () { a = y = w = s = null; a = t("<tr>"); y = t("<td class=''>"); s = t("<td class='vis-processpara-table-td3'>"); l.append(a.append(s)); c && (l.width("100%"), a.addClass("vis-processpara-table-SplitUI"), s.addClass("vis-processpara-table-SplitUI")) }; this.addFields = function (n, i) { var r, u, f, e, c, o, h; n; i && (r = null, n && (r = n.getControl()), u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), s.append(u), u.append(f), e = i.getControl().attr("placeholder", " ").attr("data-placeholder", ""), f.append(e), r && f.append(r), i.getBtnCount() > 0 ? (i.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "), e.attr("type") == "date", c = i.getBtn(0), o = t('<div class="input-group-append">'), o.append(c), u.append(o), h = i.getBtn(1), h && o.append(h)) : e.attr("type") == "date") }; this.addButtons = function () { this.addLine(); p.append(o).append(h) }; this.canOpenDialog = function (n) { c = n }; this.showCloseIcon = function (n) { n || o.hide() }; this.showDialog = function () { e.dialog({ modal: !0, width: "auto", closeText: n.Msg.getMsg("close"), close: function () { if (f.parent) f.parent.onProcessDialogClosed(f.isOkClicked, f.parameterList); f.dispose(); f = null } }); window.setTimeout(function () { o.focus() }, 200) }; this.getRoot = function () { var n = this; return e }; this.onClose = function (n) { f.isOkClicked = n; e.dialog("close") }; o.on(n.Events.onTouchStartAndClick, function (n) { n.stopPropagation(); n.preventDefault(); f.onClose(!1) }); h.on(n.Events.onTouchStartAndClick, function (t) { var i; if (c) { if (f.isOkClicked = !0, r.setBusy(!0), i = f.saveParameters(), !i) { r.setBusy(!1); return } f.pi.setVAF_JInstance_ID(0); f.pi.setPageNo(1); f.parent.getFileType() ? f.pi.setFileType(f.parent.getFileType()) : f.pi.setFileType(n.ProcessCtl.prototype.REPORT_TYPE_PDF); f.pi.setIsBackground(f.parent.isBackground()); f.parameterList = i; f.parent.onProcessDialogClosed(f.isOkClicked, f.parameterList) } else { if (t.stopPropagation(), t.preventDefault(), i = f.saveParameters(), !i) return; f.parameterList = i; f.onClose(!0, i) } }); this.setHeights = function () { }; this.disposeComponent = function () { o.off(n.Events.onTouchStartOrClick); h.off(n.Events.onTouchStartOrClick); e.dialog("destroy"); e.remove(); f = null; this.gridFields.length = 0; this.gridFields = null; this.depOnFieldColumn.length = 0; this.depOnFieldColumn - null; this.depOnField.length = 0; this.depOnField = null; this.vEditors.length = 0; this.vEditors2.length = 0; this.mFields.length = 0; this.mFields2.length = 0; this.parent = null; this.parameterList = null; this.pi = null; this.addLine = null; this.addFields = null; this.addButtons = null; this.showDialog = null; this.onClose = null; this.isOkClicked = null; e = l = a = y = w = s = h = o = null } } i.prototype.initDialog = function (i) { for (var u = null, c, s, v, r, l, h, f, o, e = 0, a = i.length; e < a; e++) { for (u = new n.GridField(i[e]), this.addLine(), this.mFields.push(u), c = u.getDependentOn(!1), s = 0; s < c.length; s++)this.depOnField.push(u), this.depOnFieldColumn.push(c[s]); v = n.VControlFactory.getLabel(u); r = n.VControlFactory.getControl(null, u, !1); r && (o = u.getDefault(n.context, this.windowNo), r.setValue(o), r.addVetoableChangeListener(this), u.getDisplayType() == n.DisplayType.AmtDimension && (r.hideButton(!1), r.setReadOnlyTextbox(!1), r.getControl().css("width", "100%"))); u.setPropertyChangeListener(r); this.vEditors.push(r); this.addFields(v, r); e == 0 && r && r.setDefaultFocus(!0); u.getIsRange() ? (this.addLine(), l = {}, t.extend(!0, l, i[e]), h = new n.GridField(l), this.mFields2.push(h), f = n.VControlFactory.getControl(null, h, !1), f && (o = h.getDefault2(n.context, this.windowNo), f.setValue(o), f.addVetoableChangeListener(this), u.getDisplayType() == n.DisplayType.AmtDimension && (f.hideButton(!1), f.setReadOnlyTextbox(!1), f.getControl().css("width", "100%"))), this.vEditors2.push(f), this.addFields(null, f)) : (this.mFields2.push(null), this.vEditors2.push(null)) } return this.addButtons(), !0 }; i.prototype.vetoablechange = function (t) { var f, r, e, i, o, u; for (console.log(t), f = t.newValue == null ? "" : t.newValue.toString(), r = t.propertyName, i = 0; i < this.mFields.length; i++)if (this.mFields[i].getColumnName().toLower() == r.toLower()) if (this.mFields[i].getDisplayType() == n.DisplayType.YesNo) { f.toString() == "Y" || f.toString() == "N" ? n.Env.getCtx().setWindowContext(this.windowNo, r, f.toString()) : n.Env.getCtx().setWindowContext(this.windowNo, r, f.toString().toLowerCase() == "true" ? "Y" : "N"); break } else { n.Env.getCtx().setWindowContext(this.windowNo, r, f); break } if (this.depOnFieldColumn.indexOf(r) !== -1) for (e = this.getDependantFields(r), i = 0, o = e.length; i < o; i++)if (u = e[i], u != null) if (r == "VAM_Product_ID" && (u.getColumnName() == "VAM_Locator_ID" || u.getColumnName() == "VAM_LocatorTo_ID")) continue; else u.refreshLookup(), u.setValue(u.getDefault(n.Env.getCtx(), this.windowNo), !0) }; i.prototype.getDependantFields = function (n) { var i = [], r, t; if (this.depOnFieldColumn.indexOf(n) != -1) for (r = this.depOnFieldColumn.length, t = 0; t < r; t++)this.depOnFieldColumn[t].equals(n) && i.indexOf(this.depOnField[t]) < 0 && i.push(this.depOnField[t]); return i }; i.prototype.saveParameters = function () { for (var r = new StringBuilder, p = this.mFields.length, t = 0, u, w, c, l, a, v, y, i, h, o, t = 0; t < p; t++)u = this.mFields[t], u.getIsMandatory(!0) && (w = this.vEditors[t], c = w.getValue(), c == null || c.toString().length == 0 ? (u.setInserting(!0), u.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : u.setError(!1), l = this.vEditors2[t], l != null && (a = l.getValue(), v = this.mFields2[t], a == null || a.toString().length == 0 ? (u.setInserting(!0), v.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : v.setError(!1))); if (r.length() != 0) return n.ADialog.error("FillMandatory", !0, r.toString()), !1; for (y = [], i = {}, t = 0; t < p; t++) { var f = this.vEditors[t], e = this.vEditors2[t], s = f.getValue(); (f.getDisplayType() == n.DisplayType.AmtDimension && (s = f.getText()), h = null, e != null && (h = e.getValue(), e.getDisplayType() == n.DisplayType.AmtDimension && (s = e.getText())), s != null || h != null) && (i = {}, o = this.mFields[t], i.Name = o.getColumnName(), i.DisplayType = o.getDisplayType(), i.Result = s, i.Result2 = h, i.LoadRecursiveData = o.getLoadRecursiveData(), i.ShowChildOfSelected = o.getShowChildOfSelected(), i.VAF_Column_ID = o.getVAF_Column_ID(), i.Info = f.getDisplay(), f.getDisplayType() == n.DisplayType.MultiKey && (i.Info = f.lastDisplay), e != null && (i.Info_To = e.getDisplay()), y.push(i)) } return y }; i.prototype.dispose = function () { this.disposeComponent() }; n.ProcessParameter = i }(VIS, jQuery), function (n, t) { n.Apps = n.Apps || {}; n.Apps.TestForm = function () { function y() { r = t("<div class='vis-height-full'>"); s = t("<input type='text'>"); f = t("<input type='button'>").val(n.Msg.getMsg("OK")); e = t("<input type='button'>").val(n.Msg.getMsg("Close")); o = t('<select style="width:300px;height:30px">'); h = t('<div style="width:300px;height:100%;float:left;background-color:gray">'); c = t('<div style="width:calc(100% - 400px);height:calc(100% - 35px);float:right;background-color:yellow">'); l = t('<div style="width:calc(100% - 300px);height:35px;float:right;background-color:brown">'); v = t('<div style="width:calc(100% - 400px);height:calc(100%);position:absolute">'); r.append(o).append(l).append(h).append(c); t.ajax({ url: n.Application.contextUrl + "home/GetReports", success: function (n) { if (n = JSON.parse(n), n) for (var t = 0; t < n.length; t++)o.append('<option value="' + n[t].Key + '">' + n[t].Name + "<\/option>") } }); o.on("change", function () { a || (a = new n.AWindow); i = a.refreshProcess(o.val(), null, "P", !0, u); i.showCloseIcon(!1); i.setSaveCsvIcons("vis-savecsv-ico-pos"); i.setReportFormatIcons("vis-repformat-ico-pos"); i.setSavePdfIcons("vis-savepdf-ico-pos"); i.setArchiveIcons("vis-archive-ico-pos"); i.setRequeryIcons("vis-requery-ico-pos"); i.setCustomizeIcons("vis-customize-ico-pos"); i.setPrintIcons("vis-print-ico-pos"); i.setToolbarColor("white"); i.showParameterCloseIcon(!1) }) } var r, s, f, e, h, c, l, v, o, a, i, u; this.frame; this.windowNo; i = null; u = this; y(); u = this; f.on(n.Events.onTouchStartOrClick, function () { alert("Test From has value :==> " + s.val()) }); e.on(n.Events.onTouchStartOrClick, function () { confirm("wanna close this form???") && u.dispose() }); this.getRoot = function () { return r }; this.getParameterContainer = function () { return h }; this.getContentContainer = function () { return c }; this.getToolbarContainer = function () { return l }; this.getBusyIndicatorContainer = function () { return v }; this.disposeComponent = function () { u = null; r && r.remove(); r = null; f && f.off(n.Events.onTouchStartOrClick); e && e.off(n.Events.onTouchStartOrClick); s = f = e = null; this.getRoot = null; this.disposeComponent = null } }; n.Apps.TestForm.prototype.init = function (n, t) { this.frame = t; this.frame.getContentGrid().append(this.getRoot()) }; n.Apps.TestForm.prototype.sizeChanged = function () { }; n.Apps.TestForm.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.TestForm.prototype.show = function () { var t = new n.CFrame; t.setName(n.Msg.getMsg("Tect")); t.setTitle(n.Msg.getMsg("Test")); t.hideHeader(!0); t.setContent(this); t.show() } }(VIS, jQuery), function (n, t) { var i = n.Application.contextUrl, f = i + "JsonData/GetGridWindow", e = i + "JsonData/InsertOrUpdateWRecords", o = i + "JsonData/DeleteWRecords", s = i + "JsonData/GetWindowRecords", h = i + "JsonData/GetWindowRecordsForTreeNode", c = i + "JsonData/GetFormInfo", l = i + "JsonData/GetProcessInfo", r = i + "JsonData/Process", a = i + "JsonData/ExecuteProcess", v = i + "JsonData/UpdateOrInsertPersonalLock", y = i + "JsonData/JDataSet", u = i + "JsonData/ExecuteNonQuer", p = i + "JsonData/GetCardViewDetail", w = i + "JsonData/GetLocLatLng", b = function () { function b(n, r) { t.ajax({ url: i + "JsonData/UpdateCtx", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify({ dCtx: n }) }).done(function (n) { r && r(n) }) } function k(n, i, r) { var u = { VAF_Screen_ID: n, VAF_Tab_ID: i }; t.ajax({ url: p, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(u) }).done(function (n) { if (r) { var t = null; n && (t = n, typeof n == "string" && (t = JSON.parse(n))); r(t) } }) } function d(n, i) { t.ajax({ url: f, type: "GET", datatype: "json", async: !0, data: n }).done(function (n) { i && i(n) }) } function g(n) { var i = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify(n) }).done(function (n) { i = n }), i } function nt(n) { return new Promise(function (i) { var r = null; return t.ajax({ url: o, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify(n) }).done(function (n) { r = n; i(r) }), r }) } function tt(i, r, u, f, e, o) { var h = { fields: r, sqlIn: i, rowCount: u, sqlCount: f, VAF_TableView_ID: e }; t.ajax({ url: s, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(h) }).done(function (t) { if (o) { var i = JSON.parse(t), r = null, u = null; i && (r = (new n.DB.DataSet).toJson(i.Tables), u = i.LookupDirect); o(r, u) } }) } function it(i, r, u, f, e, o, s, c) { var l = { fields: r, sqlIn: i, rowCount: u, sqlCount: f, VAF_TableView_ID: e, treeID: o, treeNodeID: s }; t.ajax({ url: h, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(l) }).done(function (t) { if (c) { var i = null; t && (i = (new n.DB.DataSet).toJson(t)); c(i) } }) } function rt(r, u) { var f = null; return t.ajax({ url: i + "JsonData/GetWindowRecord", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ sql: r, fields: u }) }).done(function (t) { t && (f = (new n.DB.DataReader).toJson(t)) }), f } function ut(n, i, r, u) { var f = null, e = { VAF_UserContact_ID: n, VAF_TableView_ID: i, Record_ID: r, locked: u }; return t.ajax({ url: v, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify(e) }).done(function (n) { f = n }), f } function ft(i, r) { var u = null; return i.indexOf(n.Application.contextUrl) == -1 && (i = n.Application.contextUrl + i), t.ajax({ url: i, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ fields: r }) }).done(function (n) { n && (u = JSON.parse(n)) }).fail(function (n, t, i) { alert(i) }), u } function et(n, i) { t.ajax({ url: c, type: "GET", datatype: "json", async: !0, data: n }).done(function (n) { i && i(n) }) } function ot(n, i) { t.ajax({ url: l, type: "GET", datatype: "json", async: !0, data: n }).done(function (n) { i && i(n) }) } function st(n, i) { var f = i ? !0 : !1, u = null; return t.ajax({ url: r, type: "POST", datatype: "json", async: f, data: n }).done(function (n) { u = n; i && i(n) }), u } function ht(n, i) { t.ajax({ url: r, type: "GET", datatype: "json", async: !1, data: n }).done(function (n) { i && i(n) }) } function ct(n, i) { var u = i ? !0 : !1, r = null; return t.ajax({ url: a, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: u, data: JSON.stringify(n) }).done(function (n) { r = n; i && i(n) }), r } function lt(n, i, r) { var u = null; return t.ajax({ url: y, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function at(n, i, r) { var f = null; return t.ajax({ url: u + "y", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; r && r(n) }), f } function vt(n, i, r) { var f = null; return t.ajax({ url: u + "ies", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; r && r(n) }), f } function yt(n, i, r) { var f = r ? !0 : !1, u = null; return t.ajax({ url: n, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(i) }).done(function (n) { n && (u = n, typeof n == "string" && (u = JSON.parse(n))); f && r(u) }), u } function pt(n, i, r) { var f = r ? !0 : !1, u = null; return t.ajax({ url: n, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(i) }).done(function (n) { n && (u = n, typeof n == "string" && (u = JSON.parse(n))); f && r(u) }), u } function wt(i, r) { t.ajax({ url: n.Application.contextUrl + "Chat/LoadChat", data: i, type: "GET", cache: !1, datatype: "Json", success: function (n) { r && r(n) } }) } function bt(i) { t.ajax({ url: n.Application.contextUrl + "Chat/SaveChat", type: "POST", dataType: "Json", data: i, success: function (n) { n ? console.log("Chat Saved") : console.log("Chat Not Saved") }, error: function () { console.log("Chat Not Saved") } }) } function kt(n, r) { var u = null, f = r ? !0 : !1; return t.ajax({ url: i + "Tree/GetTreeAsString", async: f, data: n }).done(function (n) { u = n; r && r(n) }), u } function dt(i, r, u, f, e) { var o, s; i == 0 ? (o = n.Application.contextUrl + "Subscribe/Subscribe", s = { VAF_Screen_ID: r, Record_ID: u, VAF_TableView_ID: f }) : (o = n.Application.contextUrl + "Subscribe/UnSubscribe", s = { VAF_Screen_ID: r, Record_ID: u, VAF_TableView_ID: f }); t.ajax({ url: o, type: "GET", dataType: "Json", data: s, success: function (t) { t == 0 ? i == 0 ? n.ADialog.error("SubscriptionFailed") : n.ADialog.error("UnSubscriptionFailed") : t == 2 && n.ADialog.info("AlreadyUnsubscribed"); e() }, error: function (t) { n.ADialog.error(n.Msg.getMsg("Error") + t.statusText) } }) } return { insertOrUpdateWRecord: g, getWindowJString: d, deleteWRecords: nt, getWindowRecords: tt, getWindowRecordsForTreeNode: it, getWindowRecord: rt, updateInsertLocks: ut, getDataSetJString: lt, getFormDataString: et, getProcessDataString: ot, process: st, processAsyncFalse: ht, executeProcess: ct, updateClientCtx: b, executeQueries: vt, executeQuery: at, getJSONRecord: ft, getJSONData: yt, subscribeUnsubscribeRecords: dt, getChatRecords: wt, saveChat: bt, getTreeAsString: kt, getCardViewInfo: k, postJSONData: pt } }(); n.dataContext = b }(VIS, jQuery); VIS.Model = VIS.Model || {}, function (n) { function t(t) { t || (t = "CalloutEngine"); this.log = n.Logging.VLogger.getVLogger(t) } var i = !1; t.prototype.isCalloutActive = function () { return i }; t.prototype.setCalloutActive = function (n) { i = n }; t.prototype.start = function (t, i, r, u, f, e, o) { var c, l, s, h; if (i == null || i.length == 0) throw new Error("No Method Name"); if (c = "", l = i + " - " + f.getColumnName() + "=" + e + " (old=" + o + ") {active=" + this.isCalloutActive() + "}", this.isCalloutActive() || this.log.info(l.toString()), s = this[i], s == null && (i = i.charAt(0).toUpperCase() + i.substr(1), s = this[i], !s)) throw new Error("Method not found: " + i); if (h = s.length, !(h == 5 || h == 6)) throw new Error("Method " + i + " has invalid no of arguments: " + h); try { c = h == 6 ? this[i](t, r, u, f, e, o) : this[i](t, r, u, f, e) } catch (a) { this.setCalloutActive(!1); this.log.log(n.Logging.Level.SEVERE, "start: " + i, a); c = a.toString() } return c }; t.prototype.DateAcct = function (n, t, i, r, u, f) { return this.isCalloutActive() ? "" : u ? (i.setValue("DateAcct", u), i.getTableName() == "VAB_BankingJRNLLine" && i.setValue("ValutaDate", u), this.setCalloutActive(!1), n = t = i = r = u = f = null, "") : "" }; t.prototype.Rate = function (t, i, r, u, f, e) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var s = f, o = n.Env.ZERO; return n.Utility.Util.getValueOfDouble(s) != 0 && (o = (1 / s).toFixed(12)), u.getColumnName().toString() == "MultiplyRate" ? r.setValue("DivideRate", o) : r.setValue("MultiplyRate", o), this.log.info(u.getColumnName() + "=" + s + " => " + o), this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutEngine = t; n.CalloutEngine = t }(VIS, jQuery), function (n, t) { function i() { function di(n, i, r) { var u = null; return t.ajax({ url: bi, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function gi(n) { ei = n; tr() } function y() { var u = t(window).width(), e = t(".row.scrollerHorizontal > div").length, h; e = e - 1; t(".scrollerHorizontal").width(u); var l = u / e - 20, i = parseInt(l), o = {}; if (n.Application.isRTL && (t("#welcomeScreen").css({ right: "0", left: "auto" }), t(".vis-welcomeScreenFeeds > .row").css("margin-right", "0px")), u >= 1366 && (t("#workflowActivity").css("display") == "none" ? (t("#welcomeScreen").width(i), o = n.Application.isRTL ? { width: i, right: i + 20 } : { width: i, left: i + 20 }, t("#fllupsScreen").animate(o, 200, function () { }), o = n.Application.isRTL ? { width: i, right: i * 2 + 40 } : { width: i, left: i * 2 + 40 }, t("#favLinks").animate(o, 200, function () { })) : t("#workflowActivity").css("display") == "block" && (h = u + i + 20, t(".scrollerHorizontal").width(h), ot.scroll(), t("#welcomeScreen").width(i), o = n.Application.isRTL ? { width: i, right: i + 20 } : { width: i, left: i + 20 }, t("#workflowActivity").animate(o, 200, function () { pt.scroll() }), o = n.Application.isRTL ? { width: i, right: i * 2 + 40 } : { width: i, left: i * 2 + 40 }, t("#fllupsScreen").animate(o, 200, function () { }), o = n.Application.isRTL ? { width: i, right: i * 3 + 60 } : { width: i, left: i * 3 + 60 }, t("#favLinks").animate(o, 200, function () { })), t("#vis_userDate").show()), u > 1024 && u < 1366) t("#workflowActivity").css("display") == "none" ? (n.Application.isRTL ? (t("#fllupsScreen").css("right", i + 20), t("#favLinks").css("right", i * 2 + 40)) : (t("#fllupsScreen").css("left", i + 20), t("#favLinks").css("left", i * 2 + 40)), t("#welcomeScreen,#fllupsScreen,#favLinks").width(i)) : t("#workflowActivity").css("display") == "block" && (h = u + i + 20, t(".scrollerHorizontal").width(h), ot.scroll(), t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(i), n.Application.isRTL ? (t("#workflowActivity").css("right", i + 20), t("#fllupsScreen").css("right", i * 2 + 40), t("#favLinks").css("right", i * 3 + 60)) : (t("#workflowActivity").css("left", i + 20), t("#fllupsScreen").css("left", i * 2 + 40), t("#favLinks").css("left", i * 3 + 60))), t("#vis_userDate").show(); else if (u >= 1e3 && u <= 1024) { if (t("#workflowActivity").css("display") == "none") { var s = u / 2, r = parseInt(s), c = r * e; t(".scrollerHorizontal").width(c); n.Application.isRTL ? (t("#fllupsScreen").css("right", r), t("#favLinks").css("right", r * 2)) : (t("#fllupsScreen").css("left", r), t("#favLinks").css("left", r * 2)); t("#welcomeScreen,#fllupsScreen,#favLinks").width(r - 20) } else if (t("#workflowActivity").css("display") == "block") { e = e + 1; var s = u / 2, r = parseInt(s), c = r * e; t(".scrollerHorizontal").width(c); ot.scroll(); t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(r - 20); n.Application.isRTL ? (t("#workflowActivity").css("right", r), t("#fllupsScreen").css("right", r * 2), t("#favLinks").css("right", r * 3)) : (t("#workflowActivity").css("left", r), t("#fllupsScreen").css("left", r * 2), t("#favLinks").css("left", r * 3)) } t("#vis_userDate").show() } else if (u < 1e3) { if (t("#workflowActivity").css("display") == "none") { var s = u * e, r = parseInt(s), f = u; t(".scrollerHorizontal").width(r); n.Application.isRTL ? (t("#fllupsScreen").css("right", f), t("#favLinks").css("right", f * 2)) : (t("#fllupsScreen").css("left", f), t("#favLinks").css("left", f * 2)); t("#welcomeScreen,#fllupsScreen,#favLinks").width(f - 20) } else if (t("#workflowActivity").css("display") == "block") { e = e + 1; var s = u * e, r = parseInt(s), f = u; t(".scrollerHorizontal").width(r); ot.scroll(); t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(f - 20); n.Application.isRTL ? (t("#workflowActivity").css("right", f), t("#fllupsScreen").css("right", f * 2), t("#favLinks").css("right", f * 3)) : (t("#workflowActivity").css("left", f), t("#fllupsScreen").css("left", f * 2), t("#favLinks").css("left", f * 3)) } t("#vis_userDate").hide() } } function nr() { var i = new Date, t = i.getHours(); return t < 12 ? n.Msg.getMsg("GoodMorning") : t < 17 ? n.Msg.getMsg("GoodAfternoon") : n.Msg.getMsg("GoodEvening") } function tr() { ei.load(n.Application.contextUrl + "Home/Home", function () { function sr(i, r, u) { er.show(); ur = !0; var f = n.Application.contextUrl + "Home/GetJSONFllups"; t.ajax({ url: f, data: { fllPageSize: i, fllPage: r, isRef: u }, type: "GET", cache: !1, datatype: "json", success: function (i) { var r = JSON.parse(i), f = 0, o = "", s = "", h = "", a, c, l, e; if (r.lstFollowups.length > 0) { u && ki.text(r.FllCnt); for (a in r.lstFollowups) { if (c = r.lstFollowups[f].ChatID + "-" + r.lstFollowups[f].RecordID + "-" + r.lstFollowups[f].SubscriberID + "-" + r.lstFollowups[f].TableID + "-" + r.lstFollowups[f].WinID + "-" + r.lstFollowups[f].TableName, r.lstFollowups[f].Cdate != null && r.lstFollowups[f].Cdate != "" && (l = new Date(r.lstFollowups[f].Cdate), h = Globalize.format(l, "F", Globalize.cultureSelector)), r.lstFollowups[f].VAF_Image_ID == 0) s = "<i data-fll='UID' data-UID='" + r.lstFollowups[f].VAF_UserContact_ID + "' class='fa fa-user'><\/i>"; else for (e in r.lstUserImg) if (r.lstUserImg[e].VAF_Image_ID == r.lstFollowups[f].VAF_Image_ID) { s = r.lstUserImg[e].UserImg != "NoRecordFound" && r.lstUserImg[e].UserImg != "FileDoesn'tExist" && r.lstUserImg[e].UserImg != null ? "<div class='vis-feedimgwrap'  data-fll='UID' data-UID='" + r.lstFollowups[f].VAF_UserContact_ID + "'><img data-fll='UID' data-UID='" + r.lstFollowups[f].VAF_UserContact_ID + "' alt='" + n.Msg.getMsg("UserImage") + "' title='" + n.Msg.getMsg("UserImage") + "' class='userAvatar-Feeds' src='" + n.Application.contextUrl + r.lstUserImg[e].UserImg + "?" + new Date(t.now()).getSeconds() + "'/><\/div>" : "<i data-fll='UID' data-UID='" + r.lstFollowups[f].VAF_UserContact_ID + "' class='fa fa-user'><\/i>"; break } o += "<div id=" + c + " data-fll='divfllups' class='vis-feedContainer'><div class='vis-feedTitleBar'><h3> " + r.lstFollowups[f].WinName + " : " + r.lstFollowups[f].Identifier + " <\/h3><div class='vis-feedTitleBar-buttons'><ul><li> <a href='javascript:void(0)'  data-fll='azoomfllups'  title='" + n.Msg.getMsg("ViewFollowups") + "'  class='vis vis-find'><\/a><\/li><li> <a href='javascript:void(0)'  data-fll='asubscribefllups'  title='" + n.Msg.getMsg("UnsubscribeFollowups") + "' class='fa fa-rss'><\/a><\/li><\/ul> <\/div><\/div><div id='divfllcmntdata" + r.lstFollowups[f].ChatID + "' data-fll='fll-cmnt' class='vis-feedDetails'><div class='vis-feedDetails-cmnt' data-fll='fll-cmnt'>" + s + "<p> <strong data-fll='UID' data-UID='" + r.lstFollowups[f].VAF_UserContact_ID + "'>"; o += r.lstFollowups[f].VAF_UserContact_ID == n.Env.getCtx().getVAF_UserContact_ID() ? n.Msg.getMsg("Me") + " <\/strong> <br />" : r.lstFollowups[f].Name + "<\/strong> <br />"; o += n.Utility.encodeText(r.lstFollowups[f].ChatData) + "<\/p><p class='vis-feedDateTime'>" + h + "<\/p><\/div><\/div><a id='divfllvm_" + r.lstFollowups[f].ChatID + "'  data-fll='viewmorefllupscmnt' href='javascript:void(0)' class='vis-viewMoreComments'><span class='vis-feedIcons vis-icon-viewMoreComments'><\/span>" + n.Msg.getMsg("ViewMoreComments") + "...<\/a><a id='divfllvl_" + r.lstFollowups[f].ChatID + "' style='display:none;'  data-fll='viewlessfllupscmnt' href='javascript:void(0)' class='vis-viewMoreComments'><span class='vis-feedIcons vis-icon-viewMoreComments'><\/span>" + n.Msg.getMsg("ViewLessComments") + "...<\/a> <div class='clearfix'><\/div> <div id=" + r.lstFollowups[f].ChatID + " class='vis-feedMessage'> <input id='txtFllCmnt" + r.lstFollowups[f].ChatID + "' data-fll='txtcmntfll' placeholder='" + n.Msg.getMsg("TypeMessage") + "' type='text' value='' /> <span  id='btnFllCmnt" + r.lstFollowups[f].ChatID + "' data-fll='btncmntfll' title='" + n.Msg.getMsg("PostMessage") + "'  class='vis vis-sms' ><\/span> <div class='clearfix'><\/div> <\/div><\/div> "; f++ } ut.append(o) } else pr == !1 && (n.Application.isRTL ? ut.append("<p style='margin-top: 200px;text-align: center '>" + n.Msg.getMsg("NoRecordFound") + "!!!<\/p>") : ut.append("<p style='margin-top: 200px;text-align: center '>" + n.Msg.getMsg("NoRecordFound") + "!!!<\/p>")); ur = !1; er.hide() }, error: function () { } }) } function wr(i, r, u) { var f = n.Application.contextUrl + "Home/GetJSONFllupsCmnt/"; t.ajax({ url: f, data: { FllupsID: i, fllCmntPageSize: r, fllCmntPage: u }, type: "GET", cache: !1, datatype: "json", success: function (i) { var r = JSON.parse(i), u = 0, e = "", c = "", a = r.lstFollowups[u].ChatID, s = "", o, l, f, h; for (o in r.lstFollowups) { if (r.lstFollowups[o].Cdate != null && r.lstFollowups[o].Cdate != "" && (l = new Date(r.lstFollowups[o].Cdate), c = Globalize.format(l, "F", Globalize.cultureSelector)), r.lstFollowups[u].VAF_Image_ID == 0) s = "<i data-fll='UID' data-UID='" + r.lstFollowups[u].VAF_UserContact_ID + "' class='fa fa-user'><\/i>"; else for (f in r.lstUserImg) if (r.lstUserImg[f].VAF_Image_ID == r.lstFollowups[u].VAF_Image_ID) { s = r.lstUserImg[f].UserImg != "NoRecordFound" && r.lstUserImg[f].UserImg != "FileDoesn'tExist" && r.lstUserImg[f].UserImg != null ? "<div class='vis-feedimgwrap' data-fll='UID' data-UID='" + r.lstFollowups[u].VAF_UserContact_ID + "'><img  alt='" + n.Msg.getMsg("UserImage") + "'  title='" + n.Msg.getMsg("UserImage") + "'  class='userAvatar-Feeds' src='" + r.lstUserImg[f].UserImg + "?" + new Date(t.now()).getSeconds() + "'/><\/div>" : "<i  data-fll='UID' data-UID='" + r.lstFollowups[u].VAF_UserContact_ID + "'    class='fa fa-user'><\/i>"; break } e += "<div class='vis-feedDetails-cmnt'  data-fll='fll-cmnt'>" + s + "<p> <strong  data-fll='UID' data-UID='" + r.lstFollowups[u].VAF_UserContact_ID + "'>"; e += r.lstFollowups[u].VAF_UserContact_ID == n.Env.getCtx().getVAF_UserContact_ID() ? n.Msg.getMsg("Me") + " <\/strong> <br />" : r.lstFollowups[u].Name + "<\/strong> <br />"; e += n.Utility.encodeText(r.lstFollowups[u].ChatData) + "<\/p><p class='vis-feedDateTime'>" + c + "<\/p><\/div>"; u++ } h = t("#divfllcmntdata" + a); h.html(""); h.append(e) }, error: function () { console.log("Error") } }) } function hr(i, r) { var u = n.Application.contextUrl + "Home/PostFllupsCmnt/"; t.ajax({ url: u, data: { fllChatID: wi, fllSubscriberID: rr, cmntTxt: i }, type: "POST", cache: !1, datatype: "json", success: function (u) { var s = new Date, h = Globalize.format(s, "F", Globalize.cultureSelector), f = u, c = n.context.getContext("##VAF_UserContact_Name"), e = "", o; e = f !== null ? f != "NoRecordFound" && f != "FileDoesn'tExist" ? "<div class='vis-feedimgwrap'  data-fll='UID' data-UID='" + n.Env.getCtx().getVAF_UserContact_ID() + "' ><img data-fll='UID' data-UID='" + n.Env.getCtx().getVAF_UserContact_ID() + "'  alt='" + n.Msg.getMsg("UserImage") + "'  class='userAvatar-Feeds' src='" + f + "?" + new Date(t.now()).getSeconds() + "' /><\/div>" : "<i data-fll='UID' data-UID='" + n.Env.getCtx().getVAF_UserContact_ID() + "' class='fa fa-user'><\/i>" : "<i data-fll='UID' data-UID='" + n.Env.getCtx().getVAF_UserContact_ID() + "' class='fa fa-user'><\/i>"; o = "<div class='vis-feedDetails-cmnt' data-fll='fll-cmnt'>" + e + "<p> <strong  data-fll='UID' data-UID='" + n.Env.getCtx().getVAF_UserContact_ID() + "'>" + n.Msg.getMsg("Me") + "<\/strong><br />" + n.Utility.encodeText(i) + "<\/p><p class='vis-feedDateTime'>" + h + "<\/p><\/div>"; r.append(o) }, error: function () { console.log("Error") } }) } var fr; et = !1; ct = !1; k = !1; f = !1; l = t("#sAlrtTxtType"); h = t("#hAlrtTxtTypeCount"); b = t("#ulHomeTabMenu"); wt = t("#divTabMenuDataLoder"); c = t("#spanWelcomeTabtopHdr"); yi = t("#searchData"); ot = t("#dataContainer"); ut = t("#fllupsList"); pt = t("#workflowActivityData"); li = t("#userLinks-List"); ai = t("#userFavs-List"); a = t("#hlnkTabDataRef"); i = t("#welcomeScreenFeedsList"); vi = t("#favLinks"); r = 1; w = t("#workflowActivity"); bt = t("#divTabMenuDataLoder"); lt = t("#workflowActivityDetails"); ft = t("#hWelcomeScreenSwapHdr"); v = t("#sNewNts"); p = t("#WFSearchshow"); tt = t("#divNoticeCount"); rt = t("#divRequestCount"); kt = t("#divNotesCount"); dt = t("#divAptCount"); ii = t("#divKPI"); e = 10; u = 0; o = 0; s = 0; y(); t(window).resize(y); t("div.vis-workflowActivityTitleBar-buttons ul li .vis-icon-check").on(n.Events.onTouchStartOrClick, function () { t("#workflowActivity").hide(); t(".vis-activityContainer").removeClass("vis-activeFeed"); y(); ot.scroll() }); t("#btnWFAClose").on(n.Events.onTouchStartOrClick, function () { t("#workflowActivity").hide(); t(".vis-activityContainer").removeClass("vis-activeFeed"); y(); ot.scroll() }); n.changeUserImage(); t("#userFav-Tab").click(function () { t("#userLinks div").removeClass("row userLinks_activeTab"); t("#userLinks div").addClass("row userLinks_inactiveTab"); t("#userFavs div").removeClass("row userFavs_inactiveTab"); t("#userFavs div").addClass("row userFavs_activeTab"); t("#userLinks-List").hide("fast"); t("#userFavs-List").show("fast", function () { setTimeout(function () { }, 0) }) }); t("#userLinks-Tab").click(function () { t("#userFavs div").removeClass("row userFavs_activeTab"); t("#userFavs div").addClass("row userFavs_inactiveTab"); t("#userLinks div").removeClass("row userLinks_inactiveTab"); t("#userLinks div").addClass("row userLinks_activeTab"); t("#userFavs-List").hide("fast"); t("#userLinks-List").show("fast", function () { setTimeout(function () { }, 0) }) }); n.shortcutMgr.init(t("#userLinks-List"), t("#userFavs-List")); t(".vis-welcomeScreenFeeds").hide(); t(".vis-icon-userfeeds").off("click"); t(".vis-icon-userfeeds").on("click", function () { t(".vis-welcomeScreen-Data").hide("slow"); t(".vis-welcomeScreenFeeds").show("fast") }); t(".vis-welcomeScreenTab-notificationBubbles").on("click", function () { return !1 }); fr = nr(); t("#vis-userGreeting").text(fr); a.on("click", function () { if (f = !0, et == !1 && r != oi) if (r == at) d = 0, e = g, u = nt, s = 0, it(), ui(); else if (r == ri) y(), v.hide(), p.show(), l.empty(), l.append(n.Msg.getMsg("WorkflowActivities")), h.empty(), h.append(t("#divfActivity").html()), ft.empty(), ft.append(n.Msg.getMsg("Activity")), d = 0, e = g, u = nt, s = 0, st == null && (st = new n.wfActivity(i, lt, pt, i, p)), st.Load(!0); else if (r == ht) d = 0, e = g, u = nt, s = 0, it(), fi(); else if (r == gt) d = 0, e = g, u = nt, s = 0, WSP.wspHomeMgr.viewWSPHome(gt, f); else if (r == ni) d = 0, e = g, u = nt, s = 0, WSP.wspHomeMgr.viewWSPHome(ni, f); else { if (r == si) return; r == vt ? (d = 0, e = g, u = nt, s = 0, it(), WSP.wspHomeMgr.viewWSPHome(vt, f)) : r == yt ? (d = 0, e = g, u = nt, s = 0, it(), WSP.wspHomeMgr.viewWSPHome(yt, f)) : r == hi && (w.hide(), y(), d = 0, e = g, u = nt, s = 0, it(), p.hide(), VADB.Apps.KpiHomeScreen(i, bt, v, w, lt, ft, ii)) } }); i.on("click", function (i) { var o = t(i.target).data("vishomercrd"), f; if (r == ht) { if (i.target.tagName === "SPAN" && o === "more") { if (t(i.target.parentNode.parentNode).data("vishomercrd") == "more-details") { var s = i.target.parentNode.parentNode.id, h = t("#snoticetitle_" + s), c = t("#snoticedesc_" + s), l = t("#snoticemore_" + s); l.hide(); h.hide(); c.show(); t("#snoticeless_" + s).show() } } else if (t(i.target.parentNode.parentNode).data("vishomercrd") == "more-details") { var s = i.target.parentNode.parentNode.id, h = t("#snoticetitle_" + s), c = t("#snoticedesc_" + s), l = t("#snoticemore_" + s); l.show(); h.show(); c.hide(); t("#snoticeless_" + s).hide() } if (o === "view") { var f = i.target.id, u = f.toString().split("|"), a = u[0], v = u[1], y = u[2], nt = u[3], e = new n.Query; e.addRestriction(v + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(a)); n.viewManager.startWindow(y, e) } else if (o === "liview") { var f = i.target.firstChild.id, u = f.toString().split("|"), a = u[0], v = u[1], y = u[2], nt = u[3], e = new n.Query; e.addRestriction(v + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(a)); n.viewManager.startWindow(y, e) } else if (o === "approve") f = i.target.id, ci(f, !0); else if (o === "liapprove") f = i.target.firstChild.id, ci(f, !0); else if (o === "lispecial") { var f = i.target.firstChild.id, u = f.toString().split("|"), p = u[0], w = u[1], b = u[2], e = new n.Query; e.addRestriction(w + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(p)); n.viewManager.startWindow(b, e) } else if (o === "lispecial1") { var f = i.target.id, u = f.toString().split("|"), p = u[0], w = u[1], b = u[2], e = new n.Query; e.addRestriction(w + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(p)); n.viewManager.startWindow(b, e) } } else if (r == at) if (o === "view") { var f = i.target.id, u = f.toString().split("|"), k = u[0], d = u[1], g = u[2], e = new n.Query; e.addRestriction(d + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(k)); n.viewManager.startWindow(g, e) } else if (o === "liview") { var f = i.target.firstChild.id, u = f.toString().split("|"), k = u[0], d = u[1], g = u[2], e = new n.Query; e.addRestriction(d + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(k)); n.viewManager.startWindow(g, e) } }); i.bind("scroll", function () { if (t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight) if (k = !0, f = !1, r == ri) if (o = parseInt(t("#divfActivity").html()), s = u * e, s <= o && st != null) u += 1, st.AppendRecord(u, e); else return; else if (r == ht) if (o = parseInt(tt.text()), s = u * e, u += 1, s <= o) fi(); else return; else if (r == at) if (o = parseInt(rt.text()), s = u * e, u += 1, s <= o) ui(); else return; else if (r == vt) if (o = parseInt(dt.text()), s = u * e, u += 1, s <= o) WSP.wspHomeMgr.doScrollWSPHome(vt, u, e); else return; else if (r == yt) if (o = parseInt(kt.text()), s = u * e, s <= o) u += 1, WSP.wspHomeMgr.doScrollWSPHome(yt, u, e); else return }); var cr = t("#hlnkFllupsRef"), ki = t("#follupsCount"), er = t("#divFllMainLoder"), bi = "", lr = "", ei = "", ar = 0, di = 10, gi = 1, ir = 0, or = 0, vr = 10, yr = 0, wi = 0, rr = 0, pr = !1, tr = !1, ur = !1; ut.on("click", function (i) { var f = t(i.target).data("fll"), u, e, o, c, s, r, h, l, a; if (f === "viewmorefllupscmnt") ei = i.target.parentNode.id, wi = 0, rr = 0, wi = i.target.parentNode.children[3].id, wr(ei, vr, yr), u = i.target.id, e = u.split("_"), t("#divfllvl_" + e[1]).show(), t("#" + u).hide(); else if (f === "viewlessfllupscmnt") ei = i.target.parentNode.id, wi = 0, rr = 0, wi = i.target.parentNode.children[3].id, u = i.target.id, e = u.split("_"), t("#divfllvm_" + e[1]).show(), o = t("#divfllcmntdata" + e[1]), c = o.find("div:last-child"), o.empty(), o.html(c), t("#" + u).hide(); else if (f === "azoomfllups") ei = i.target.parentNode.parentNode.parentNode.parentNode.parentNode.id, r = ei.toString().split("-"), s = new n.Query, s.addRestriction(r[5] + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(r[1])), n.viewManager.startWindow(r[4], s); else if (f === "asubscribefllups") ei = i.target.parentNode.parentNode.parentNode.parentNode.parentNode.id, r = ei.toString().split("-"), t.ajax({ url: n.Application.contextUrl + "Subscribe/UnSubscribe", type: "GET", dataType: "Json", data: { VAF_Screen_ID: r[4], Record_ID: r[1], VAF_TableView_ID: r[3] }, success: function (i) { if (i == !1) alert(n.Msg.getMsg("UnSubscription Failed")); else { t("#" + ei).animate({ width: "100%", height: "132px", "margin-top": "-132px" }, 700, function () { t("#" + ei).remove() }); var r = ki.text(); ki.text(r - 1) } } }); else if (f === "btncmntfll") wi = i.target.parentNode.id, FllupsData = t("#" + i.target.parentNode.parentNode.children[1].id), bi = t("#" + i.target.previousElementSibling.id), lr = t("#" + i.target.id), h = t(bi).val(), h !== "" && (l = new Date, a = Globalize.format(l, "F", Globalize.cultureSelector), hr(h, FllupsData), t(bi).val("")); else if (f == "UID") { var v = t(i.target).data("uid"), y = n.Env.getWindowNo(), p = new n.ContactInfo(v, y); p.show() } }); ut.on("keydown", function (n) { var u = t(n.target).data("fll"), i, r; u === "txtcmntfll" && (ei = n.target.parentNode.parentNode.id, wi = n.target.parentNode.id, FllupsData = t("#" + n.target.parentNode.parentNode.children[1].id), bi = t("#" + n.target.id), i = t(bi).val(), i !== "" && i !== null && (r = n.charCode || n.keyCode, r === pi && (hr(i, FllupsData), t(bi).val("")))) }); ut.bind("scroll", function () { if (t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && (tr = !1, ir = ki.text(), ir > di)) if (or = gi * di, gi += 1, or <= ir) sr(di, gi, tr); else return }); cr.on("click", function () { ur == !1 && (di = 10, gi = 1, ar = ki.text(), tr = !0, ut.empty(), sr(di, gi, tr)) }); b.off("click"); ti(); window.WSP ? (ct = !0, p.hide(), WSP.wspHomeMgr.initWSPHome(i, b, lt, pt, w, bt, ft, v, l, h, dt, kt)) : console.log("PleaseInstallWSPModule") }) } function ir() { return { activeTabType: r } } function ui() { wt.show(); et = !0; t.ajax({ url: n.Application.contextUrl + "Home/GetJSONHomeRequest", data: { pagesize: e, page: u, isTabDataRef: f }, type: "GET", datatype: "json", cache: !1, success: function (t) { var u = JSON.parse(t.data), c = "", e, p, v, y, s, l, a; if (u.length > 0) { r == at && f && (o = parseInt(t.count), rt.empty(), rt.show(), h.empty(), rt.text(t.count), h.text(t.count)); for (e in u) p = "", (u[e].StartDate != null || u[e].StartDate != "") && (s = new Date(u[e].StartDate), p = Globalize.format(s, "d", Globalize.cultureSelector)), v = "", u[e].NextActionDate != null ? (s = new Date(u[e].NextActionDate), v = Globalize.format(s, "d", Globalize.cultureSelector)) : v = "&nbsp;-----------", y = "", (u[e].CreatedDate != null || u[e].CreatedDate != "") && (s = new Date(u[e].CreatedDate), y = Globalize.format(s, "F", Globalize.cultureSelector)), l = u[e].Summary, l.length > 80 && (l = l.substr(0, 80) + "..."), a = u[e].CaseType, a.length > 30 && (a = a.substr(0, 30) + "..."), c += "<div class='vis-activityContainer'><div class='vis-feedTitleBar'><h3>#" + u[e].DocumentNo + "<\/h3><div class='vis-feedTitleBar-buttons'><ul>", u[e].Name && u[e].Name.length > 0 && (c += "<li class='vis-home-request-BP'>" + u[e].Name + "<\/li>"), + "<li class='vis-home-request-BP'>" + u[e].Name + "<\/li>", c += "<li data-vishomercrd='liview'><a href='javascript:void(0)' data-vishomercrd='view' id=" + u[e].VAR_Request_ID + "|" + u[e].TableName + "|" + u[e].VAF_Screen_ID + "  title='" + n.Msg.getMsg("View") + "'  class='vis vis-find'><\/a><\/li><\/ul><\/div><\/div><div  class='vis-feedDetails vis-pt-0 vis-pl-0'><div class='vis-table-request'><ul><li><span>" + n.Msg.getMsg("Priority") + ":<\/span><br>" + u[e].Priority + "<\/li><li><span>" + n.Msg.getMsg("Status") + ":<\/span><br>" + u[e].Status + "<\/li><li><span>" + n.Msg.getMsg("NextActionDate") + ":<\/span><br>" + v + "<\/li><\/ul><\/div><p class='vis-maintain-customer-p'><strong>" + n.Utility.encodeText(a) + " <\/strong><br /><span>" + n.Msg.getMsg("Message") + ":<\/span><br>" + n.Utility.encodeText(l) + "<\/p><p class='vis-feedDateTime'  style=' width: 69%; margin-right: 10px;'>" + y + "<\/p><\/div><\/div>" } else i.find(".vis-table-request").length == 0 && k == !1 && (c = n.Application.isRTL ? "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>" : "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>", rt.empty(), h.empty(), rt.text(0), rt.hide(), h.text(0)); et = !1; ti(); r == at && i.append(c); wt.hide() } }) } function fi() { et = !0; wt.show(); t.ajax({ url: n.Application.contextUrl + "Home/GetJSONHomeNotice", data: { pagesize: e, page: u, isTabDataRef: f }, type: "GET", datatype: "json", success: function (t) { var u = JSON.parse(t.data), s = "", l = null, e, a, c, v; if (u.length > 0) { r == ht && f && (o = parseInt(t.count), tt.empty(), tt.show(), h.empty(), tt.text(t.count), h.text(t.count)); for (e in u) u[e].CDate != null && u[e].CDate != "" && (a = new Date(u[e].CDate), l = Globalize.format(a, "F", Globalize.cultureSelector)), c = "", v = u[e].Description, c = v.length <= 100 ? "<pre><strong style='color:#666666' data-vishomercrd='title' id='" + u[e].VAF_Notice_ID + "'>" + n.Utility.encodeText(u[e].Title) + "<\/strong><\/pre>" : "<pre><strong  id='snoticetitle_" + u[e].VAF_Notice_ID + "'  style='color:#666666;' >" + n.Utility.encodeText(u[e].Title) + "...<\/strong><strong id='snoticedesc_" + u[e].VAF_Notice_ID + "' style='display:none; color:#666666;'>" + n.Utility.encodeText(u[e].Description) + "...<\/strong> <span id='snoticemore_" + u[e].VAF_Notice_ID + "' data-vishomercrd='more' style='color:rgba(var(--v-c-primary), 1); float:right;height:20px'>" + n.Msg.getMsg("more") + "<\/span><span id='snoticeless_" + u[e].VAF_Notice_ID + "' data-vishomercrd='less' style='display:none; color:rgba(var(--v-c-primary), 1); float:right;height:20pxvis-feedTitleBar'>" + n.Msg.getMsg("less") + "<\/span><\/pre>", s += "<div data-vishomercrd='view-recrd-cntainer' id='divrecdcntnr_" + u[e].VAF_Notice_ID + "' class='vis-activityContainer'> <div class='vis-feedTitleBar'>", s += u[e].SpecialTable ? "<h3>" + n.Utility.encodeText(u[e].MsgType) + "<\/h3>" : "<h3>" + n.Utility.encodeText(u[e].MsgType) + "<\/h3>", s += " <div class='vis-feedTitleBar-buttons'>  <ul>", s += "<li data-vishomercrd='liapprove'><a href='javascript:void(0)' data-vishomercrd='approve'  id=" + u[e].VAF_Notice_ID + "  title='" + n.Msg.getMsg("Acknowledge") + "' class='vis vis-markx'><\/a><\/li><li data-vishomercrd='liview'><a href='javascript:void(0)' data-vishomercrd='view' id=" + u[e].VAF_Notice_ID + "|" + u[e].TableName + "|" + u[e].VAF_Screen_ID + "|" + u[e].Record_ID + " title='" + n.Msg.getMsg("View") + "' class='vis vis-find'><\/a><\/li><\/ul>  <\/div><\/div><div data-vishomercrd='more-details' id=" + u[e].VAF_Notice_ID + " class='vis-feedDetails'>" + c + " <p class='vis-feedDateTime'>" + n.Utility.encodeText(l) + "<\/p> <\/div> <\/div>" } else i.find(".vis-feedTitleBar").length == 0 && (s = n.Application.isRTL ? "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>" : "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>", r == ht && (tt.empty(), h.empty(), tt.hide(), tt.text(t.count), h.text(t.count))); et = !1; ti(); wt.hide(); r == ht && i.append(s) } }) } function ci(i, r) { t.ajax({ url: n.Application.contextUrl + "Home/ApproveNotice", data: { VAF_Notice_ID: i, isAcknowldge: r }, type: "POST", datatype: "json", success: function (n) { var r = JSON.parse(n); t("#divrecdcntnr_" + i).animate({ width: "0px", height: "132px", "margin-left": "800px" }, 700, "", function () { t("#divrecdcntnr_" + i).remove() }) } }) } function ti() { b.off("click"); b.on("click", function (ut) { var ot, wt; if (a.show(), i.css({ "margin-left": "auto", "margin-top": "auto" }), i.css({ "text-align": "", "margin-top": "" }), t(".vis-welcomeScreenTabMenu li").removeClass("vis-activeTab"), ut.target.nodeName == "LI" ? t(ut.target).addClass("vis-activeTab") : ut.target.nodeName == "A" && t(ut.target.parentNode).addClass("vis-activeTab"), ot = t(ut.target).data("vishome"), ot === "userprofile") c.show(), r = oi, k = !1, f = !0, t("li .vis-welcomeScreenTab-notificationBubbles").removeClass("blank").addClass("vis-feedsAlert"), t("li:first-child .vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t("li:last-child .vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreenContainer > div").fadeOut("fast"), t(".vis-welcomeScreen-Data").fadeIn("fast"), v.hide(), p.hide(), w.hide(), y(); else if (ot === "KPI") t(".vis-welcomeScreen-Data").hide("fast"), t(".vis-welcomeScreenFeeds").fadeIn("fast", function () { setTimeout(function () { }, 0) }), l.html(""), c.show(), l.html(n.Msg.getMsg("KPI")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-kpi"), i.css({ "text-align": "", "margin-top": "" }), window.VADB && window.VADB != null && VADB.Apps.KpiHomeScreen != undefined ? (i.css({ "text-align": "auto" }), r = hi, k = !1, f = !0, t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), a.css("margin-right", "17px"), b.off("click"), VADB.Apps.KpiHomeScreen(i, bt, v, w, lt, ft, ii), w.hide(), y(), v.show(), p.hide()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallVADashboard")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" })); else if (ot === "workflow") c.show(), b.off("click"), i.css("overflow-y", "auto"), i.css({ "text-align": "auto" }), r = ri, k = !1, f = !0, a.css("margin-right", "17px"), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-userfeed"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast", function () { setTimeout(function () { }, 0) }), w.hide(), y(), v.hide(), p.show(), l.empty(), l.append(n.Msg.getMsg("WorkflowActivities")), h.empty(), h.append(t("#divfActivity").html()), ft.empty(), ft.append(n.Msg.getMsg("Activity")), it(), d = 0, e = g, u = nt, s = 0, st = new n.wfActivity(i, lt, pt, i, p), st.Load(!1); else if (ot === "notice") c.show(), b.off("click"), r = ht, k = !1, f = !0, a.css("margin-right", "17px"), i.css("overflow-y", "auto"), i.css({ "text-align": "auto" }), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-notice"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast", function () { setTimeout(function () { }, 0) }), l.html(n.Msg.getMsg("Notice")), v.hide(), p.hide(), o = parseInt(tt.text()), tt.text(o), h.text(o), et == !1 && (d = 0, e = 10, u = 1, s = 0, it(), fi()), w.hide(), y(); else if (ot === "mytask") t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast", function () { setTimeout(function () { }, 0) }), l.html(""), l.html(n.Msg.getMsg("MyTask")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-mytasks"), i.css({ "text-align": "", "margin-top": "" }), ct ? (i.css({ "text-align": "auto" }), b.off("click"), c.show(), r = gt, k = !1, f = !1, i.css("overflow-y", "hidden"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.show(), p.hide(), h.html(t("#divMyTaskCount").html()), a.css("margin-right", "17px"), WSP.wspHomeMgr.viewWSPHome(gt, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" })); else if (ot === "taskassignbyme") t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast", function () { setTimeout(function () { }, 0) }), l.html(""), l.html(n.Msg.getMsg("TaskAssignByMe")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-taskassigned"), i.css({ "text-align": "", "margin-top": "" }), ct ? (i.css({ "text-align": "auto" }), c.show(), b.off("click"), k = !1, f = !1, r = ni, i.css("overflow-y", "hidden"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.show(), p.hide(), h.html(parseInt(t("#divTaskAssignBymeCount").html())), a.css("margin-right", "17px"), WSP.wspHomeMgr.viewWSPHome(ni, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" })); else if (ot === "documentrecive") c.show(), a.css("margin-right", "17px"), a.hide(), r = si, k = !1, f = !0, w.hide(), y(), i.css("overflow-y", "auto"), i.css({ "text-align": "auto" }), l.html(n.Msg.getMsg("Documents")), o = 0, h.html(o), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-document"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast", function () { setTimeout(function () { }, 0) }), it(), wt = "<p style=' margin-top:200px;text-align:center'>" + n.Msg.getMsg("PleaseInstallDMSModule") + "<\/p>", i.html(wt), v.hide(), p.hide(); else if (ot === "request") { c.show(); b.off("click"); r = at; k = !1; f = !0; i.css("overflow-y", "auto"); i.css({ "text-align": "auto" }); c.removeClass().addClass("vis-welcomeScreenContentTittle-icon fa fa-bell-o"); t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"); t(".vis-welcomeScreen-Data").hide("slow"); t(".vis-welcomeScreenFeeds").fadeIn("fast", function () { setTimeout(function () { }, 0) }); v.show(); p.hide(); a.css("margin-right", "17px"); l.html(n.Msg.getMsg("Requests")); o = parseInt(rt.text()); h.html(o); et == !1 && (d = 0, e = g, u = nt, s = 0, it(), ui()); w.hide(); y(); v.off("click"); v.on("click", function () { var i = ki("VIS_129"), t = new n.Query; t.addRestriction("VAR_Request_ID", n.Query.prototype.EQUAL, 0); n.viewManager.startWindow(i, t) }) } else ot === "appointments" ? (t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast", function () { setTimeout(function () { }, 0) }), l.html(""), l.html(n.Msg.getMsg("Appointment")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-appointment"), i.css({ "text-align": "", "margin-top": "" }), ct ? (i.css({ "text-align": "auto" }), b.off("click"), c.show(), r = vt, k = !1, f = !0, a.css("margin-right", "17px"), i.css("overflow-y", "auto"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.hide(), p.hide(), o = parseInt(dt.text()), h.html(o), d = 0, e = g, u = nt, s = 0, WSP.wspHomeMgr.viewWSPHome(vt, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" }))) : ot === "notes" && (t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast", function () { setTimeout(function () { }, 0) }), l.html(""), l.html(n.Msg.getMsg("MyNotes")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-contacts"), i.css({ "text-align": "", "margin-top": "" }), ct ? (i.css({ "text-align": "auto" }), b.off("click"), r = yt, c.show(), k = !1, f = !0, a.css("margin-right", "17px"), i.css("overflow-y", "auto"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.show(), p.hide(), o = parseInt(kt.text()), h.html(o), d = 0, e = g, u = nt, s = 0, it(), WSP.wspHomeMgr.viewWSPHome(yt, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" }))) }) } function it() { i.children().length > 0 && i.children().remove(); i.empty() } var ei = null, ot = null, ut = null, pt = null, li = null, ai = null, i = null, a = null, vi = null, r = null, w = null, ct = null, bt = null, lt = null, ft = null, st = null, et = null, f = null, b = null, wt = null, tt = null, rt = null, kt = null, dt = null, ii = null, l = null, h = null, c = null, yi = null, pi = 13, oi = 1, at = 2, ri = 3, vt = 4, gt = 5, ni = 6, si = 7, ht = 8, yt = 9, hi = 10, g = 10, nt = 1, k = null, d = null, e = null, u = null, o = null, s = null, v = null, p = null, wi = n.Application.contextUrl, bi = wi + "JsonData/JDataSetWithCode", ki = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return di(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; return t("#vis_appInfoWindow").click(function () { n.InfoMenu.show(t(this)) }), { initHome: gi, adjustDivSize: y, BindMenuClick: ti, getActiveTab: ir } } n.HomeMgr = i() }(VIS, jQuery), function (n, t) { function i() { function e() { i = t("#vis-textStatus"); t.ajax({ url: n.Application.contextUrl + "Home/SaveStatus", dataType: "json", type: "POST", async: !1, data: { status: i.val() }, success: function (n) { JSON.parse(n).length > 0 ? (i.css("visibility", "hidden"), f.css("visibility", "hidden"), u.css("visibility", "hidden"), r.css("visibility", "visible"), r.text(JSON.parse(n))) : (i.css("visibility", "visible"), f.css("visibility", "hidden"), u.css("visibility", "hidden"), r.css("visibility", "visible"), r.text(JSON.parse(n))) } }) } var i = t("#vis-textStatus"), u = t("#vis-img-OKStatus"), f = t("#vis-img-CancelStatus"), r = t("#vis-labelStatus"); t("#vis-file-input").change(function () { if (document.getElementById("vis-file-input").files[0] != null) { var i = new XMLHttpRequest, r = new FormData; r.append("file", document.getElementById("vis-file-input").files[0]); i.open("POST", n.Application.contextUrl + "Home/SaveImageAsByte", !0); i.send(r); i.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i), u = JSON.parse(r); t("#imgUsrImage").attr("src", "data:image/jpg;base64," + u) }, !1) } }); u.on("click", function () { e() }); f.on("click", function () { i.css("visibility", "hidden"); f.css("visibility", "hidden"); u.css("visibility", "hidden"); r.css("visibility", "visible") }); i.on("focus", function () { f.css("visibility", "visible"); u.css("visibility", "visible") }); i.on("keypress", function (n) { var t = n.keyCode || n.which; t == 13 && e() }); i.on("blur", function () { }); r.on("click", function () { r.css("visibility", "hidden"); i.css("visibility", "visible"); i.val(r.text()); i.focus() }) } n.changeUserImage = i }(VIS, jQuery), function (n, t) { function r() { function s(t, i) { e = t; r = e.find("#vis_linkScroll"); n.favMgr.init(i); h(); c() } function h() { n.dataContext.getJSONData(n.Application.contextUrl + "Home/GetShortcutItems", null, function (t) { var u, i, e; if (f = t, u = null, i = ['<ul class="vis-userLinks-ListMenu">'], t) for (e = 0; e < t.length; e++)u = t[e], i.push('<li data-index="' + e + '" ><a data-index="' + e + '" href="javascript:void(0)">'), u.HasImage ? !u.IsImageByteArray && u.IconUrl.indexOf(".") < 0 ? i.push('<i data-index="' + e + '" class="' + u.IconUrl + '"') : (i.push('<img data-index="' + e + '"  src="'), u.IsImageByteArray ? i.push("data:image/*;base64," + u.IconBytes) : i.push(n.Application.contextUrl + u.IconUrl)) : i.push('<i data-index="' + e + '" class="vis vis-shortcut"'), i.push('" />'), i.push(u.ShortcutName + "<\/a><\/li>"); i.push("<\/ul>"); r.empty(); r.html(i.join(" ")); i = []; l(t.length) }) } function c() { r.on("click", function (r) { var e = t(r.target).data("index"), u, h, s, a, l, c; if ((e || e == "0") && e < f.length) if (u = f[e], u.HasChild) h = new i(u.KeyID), h.show(), h = null; else if (u.Url || u.Url.length > 0) n.Env.startBrowser(u.Url); else if (u.SpecialAction && u.SpecialAction.length > 0) { s = u.SpecialAction; a = u.ActionName; try { l = n.Utility.getFunctionByName(s, window); c = new l; c.show(); c = null } catch (r) { return o.log(n.Logging.Level.WARNING, "Class=" + s + ", Action Class Name=" + s, r), !1 } } else { if (u.Action == null || u.Action.length <= 0 || u.ActionID < 1) return; n.viewManager.startAction(u.Action, u.ActionID) } }) } function l(i) { u.empty(); u.append(t("<span><i class='fa fa-link' aria-hidden='true' style='transform: rotate(90deg);'><\/i><\/span>")); u.append(n.Msg.getMsg("Links") + " - "); u.append(t("<strong>").append(i)) } var e, r, f = null, o = n.Logging.VLogger.getVLogger("ShortCut"), u = t("#userLinks-Tab"); return { init: s } } function i(i) { function s() { n.dataContext.getJSONData(n.Application.contextUrl + "Home/GetSettingItems", { VAF_Shortcut_ID: i }, function (t) { var r, i, e; if (u = t, r = null, i = ['<ul class="vis-userLinks-ListMenu">'], t) for (e = 0; e < t.length; e++)r = t[e], i.push('<li data-index="' + e + '" ><a data-index="' + e + '" href="javascript:void(0)">'), r.HasImage ? !r.IsImageByteArray && r.IconUrl.indexOf(".") < 0 ? i.push('<i data-index="' + e + '" class="' + r.IconUrl + '"') : (i.push('<img data-index="' + e + '"  src="'), r.IsImageByteArray ? i.push("data:image/*;base64," + r.IconBytes) : i.push(n.Application.contextUrl + r.IconUrl)) : i.push('<i data-index="' + e + '" class="vis vis-shortcut"'), i.push('" />'), i.push(r.ShortcutName + "<\/a><\/li>"); i.push("<\/ul>"); f.empty(); f.html(i.join(" ")); h() }) } function h() { f.on("click", function (i) { var e = t(i.target).data("index"), f, s, l, c, h; if ((e || e == "0") && e < u.length) { if (f = u[e], f.HasChild) n.Msg.getMsg("settingDialog"); else if (f.Url || f.Url.length > 0) n.Env.startBrowser(f.Url); else if (f.SpecialAction && f.SpecialAction.length > 0) { s = f.SpecialAction; l = f.ActionName; try { c = n.Utility.getFunctionByName(s, window); h = new c; h.show(); h = null } catch (i) { return o.log(n.Logging.Level.WARNING, "Class=" + s + ", Action Class Name=" + s, i), !1 } } else { if (f.Action == null || f.Action.length <= 0 || f.ActionID < 1) return; n.viewManager.startAction(f.Action, f.ActionID) } r.close() } }) } var e = t("<div>"), f = t('<div style="width:auto;z-index:1">').html('<div class="vis-apanel-busy" style="height:280px;position:static"> <\/div>'), o = n.Logging.VLogger.getVLogger("SettingDialog"), r, u; e.append(f); r = null; u = null; this.show = function () { r = new n.ChildDialog; r.setWidth(540); r.setHeight(400); r.setTitle(n.Msg.getMsg("Setting")); r.setContent(e); r.show() }; this.disposeComponent = function () { f.off("click"); f.remove(); u && (u.length = 0); u = null; this.show = null; e = null; r && r.dispose() }; s() } i.prototype.dispose = function () { this.disposeComponent() }; n.shortcutMgr = r() }(VIS, jQuery), function (n, t) { var i = n.historyMgr || {}, r; "replaceState" in history ? i.replaceHash = function (n) { ("" + n).charAt(0) !== "#" && (n = "#" + n); history.replaceState("", "", n) } : (r = location.hash, i.replaceHash = function (n) { location.hash !== r && history.back(); location.hash = n }); i.updateHistory = function (n) { i.replaceHash(n) }; i.restoreHistory = function () { var n = i.geHashtLocation(); t.viewManager.restoreActions(n) }; i.geHashtLocation = function () { var n = location.hash; return n.length > 1 ? n.substring(1) : "" }; n.historyMgr = i }(window, VIS); var CryptoJS = CryptoJS || function (n, t) { var u = {}, f = u.lib = {}, o = function () { }, i = f.Base = { extend: function (n) { o.prototype = this; var t = new o; return n && t.mixIn(n), t.hasOwnProperty("init") || (t.init = function () { t.$super.init.apply(this, arguments) }), t.init.prototype = t, t.$super = this, t }, create: function () { var n = this.extend(); return n.init.apply(n, arguments), n }, init: function () { }, mixIn: function (n) { for (var t in n) n.hasOwnProperty(t) && (this[t] = n[t]); n.hasOwnProperty("toString") && (this.toString = n.toString) }, clone: function () { return this.init.prototype.extend(this) } }, r = f.WordArray = i.extend({ init: function (n, i) { n = this.words = n || []; this.sigBytes = i != t ? i : 4 * n.length }, toString: function (n) { return (n || l).stringify(this) }, concat: function (n) { var i = this.words, r = n.words, u = this.sigBytes, t; if (n = n.sigBytes, this.clamp(), u % 4) for (t = 0; t < n; t++)i[u + t >>> 2] |= (r[t >>> 2] >>> 24 - 8 * (t % 4) & 255) << 24 - 8 * ((u + t) % 4); else if (65535 < r.length) for (t = 0; t < n; t += 4)i[u + t >>> 2] = r[t >>> 2]; else i.push.apply(i, r); return this.sigBytes += n, this }, clamp: function () { var i = this.words, t = this.sigBytes; i[t >>> 2] &= 4294967295 << 32 - 8 * (t % 4); i.length = n.ceil(t / 4) }, clone: function () { var n = i.clone.call(this); return n.words = this.words.slice(0), n }, random: function (t) { for (var i = [], u = 0; u < t; u += 4)i.push(4294967296 * n.random() | 0); return new r.init(i, t) } }), e = u.enc = {}, l = e.Hex = { stringify: function (n) { var u = n.words, i, t, r; for (n = n.sigBytes, i = [], t = 0; t < n; t++)r = u[t >>> 2] >>> 24 - 8 * (t % 4) & 255, i.push((r >>> 4).toString(16)), i.push((r & 15).toString(16)); return i.join("") }, parse: function (n) { for (var i = n.length, u = [], t = 0; t < i; t += 2)u[t >>> 3] |= parseInt(n.substr(t, 2), 16) << 24 - 4 * (t % 8); return new r.init(u, i / 2) } }, s = e.Latin1 = { stringify: function (n) { var r = n.words, i, t; for (n = n.sigBytes, i = [], t = 0; t < n; t++)i.push(String.fromCharCode(r[t >>> 2] >>> 24 - 8 * (t % 4) & 255)); return i.join("") }, parse: function (n) { for (var i = n.length, u = [], t = 0; t < i; t++)u[t >>> 2] |= (n.charCodeAt(t) & 255) << 24 - 8 * (t % 4); return new r.init(u, i) } }, a = e.Utf8 = { stringify: function (n) { try { return decodeURIComponent(escape(s.stringify(n))) } catch (t) { throw Error("Malformed UTF-8 data"); } }, parse: function (n) { return s.parse(unescape(encodeURIComponent(n))) } }, h = f.BufferedBlockAlgorithm = i.extend({ reset: function () { this._data = new r.init; this._nDataBytes = 0 }, _append: function (n) { "string" == typeof n && (n = a.parse(n)); this._data.concat(n); this._nDataBytes += n.sigBytes }, _process: function (t) { var e = this._data, s = e.words, u = e.sigBytes, o = this.blockSize, f = u / (4 * o), f = t ? n.ceil(f) : n.max((f | 0) - this._minBufferSize, 0), i; if (t = f * o, u = n.min(4 * t, u), t) { for (i = 0; i < t; i += o)this._doProcessBlock(s, i); i = s.splice(0, t); e.sigBytes -= u } return new r.init(i, u) }, clone: function () { var n = i.clone.call(this); return n._data = this._data.clone(), n }, _minBufferSize: 0 }), c; return f.Hasher = h.extend({ cfg: i.extend(), init: function (n) { this.cfg = this.cfg.extend(n); this.reset() }, reset: function () { h.reset.call(this); this._doReset() }, update: function (n) { return this._append(n), this._process(), this }, finalize: function (n) { return n && this._append(n), this._doFinalize() }, blockSize: 16, _createHelper: function (n) { return function (t, i) { return new n.init(i).finalize(t) } }, _createHmacHelper: function (n) { return function (t, i) { return new c.HMAC.init(n, i).finalize(t) } } }), c = u.algo = {}, u }(Math); (function () { var n = CryptoJS, t = n.lib.WordArray; n.enc.Base64 = { stringify: function (n) { var i = n.words, u = n.sigBytes, f = this._map, t, e, r; for (n.clamp(), n = [], t = 0; t < u; t += 3)for (e = (i[t >>> 2] >>> 24 - 8 * (t % 4) & 255) << 16 | (i[t + 1 >>> 2] >>> 24 - 8 * ((t + 1) % 4) & 255) << 8 | i[t + 2 >>> 2] >>> 24 - 8 * ((t + 2) % 4) & 255, r = 0; 4 > r && t + .75 * r < u; r++)n.push(f.charAt(e >>> 6 * (3 - r) & 63)); if (i = f.charAt(64)) for (; n.length % 4;)n.push(i); return n.join("") }, parse: function (n) { var e = n.length, f = this._map, i = f.charAt(64), o, s; i && (i = n.indexOf(i), -1 != i && (e = i)); for (var i = [], u = 0, r = 0; r < e; r++)r % 4 && (o = f.indexOf(n.charAt(r - 1)) << 2 * (r % 4), s = f.indexOf(n.charAt(r)) >>> 6 - 2 * (r % 4), i[u >>> 2] |= (o | s) << 24 - 8 * (u % 4), u++); return t.create(i, u) }, _map: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=" } })(), function (n) { function i(n, t, i, r, u, f, e) { return n = n + (t & i | ~t & r) + u + e, (n << f | n >>> 32 - f) + t } function r(n, t, i, r, u, f, e) { return n = n + (t & r | i & ~r) + u + e, (n << f | n >>> 32 - f) + t } function u(n, t, i, r, u, f, e) { return n = n + (t ^ i ^ r) + u + e, (n << f | n >>> 32 - f) + t } function f(n, t, i, r, u, f, e) { return n = n + (i ^ (t | ~r)) + u + e, (n << f | n >>> 32 - f) + t } for (var o = CryptoJS, e = o.lib, c = e.WordArray, s = e.Hasher, e = o.algo, t = [], h = 0; 64 > h; h++)t[h] = 4294967296 * n.abs(n.sin(h + 1)) | 0; e = e.MD5 = s.extend({ _doReset: function () { this._hash = new c.init([1732584193, 4023233417, 2562383102, 271733878]) }, _doProcessBlock: function (n, e) { for (var v, a, l = 0; 16 > l; l++)v = e + l, a = n[v], n[v] = (a << 8 | a >>> 24) & 16711935 | (a << 24 | a >>> 8) & 4278255360; var l = this._hash.words, v = n[e + 0], a = n[e + 1], y = n[e + 2], p = n[e + 3], w = n[e + 4], b = n[e + 5], k = n[e + 6], d = n[e + 7], g = n[e + 8], nt = n[e + 9], tt = n[e + 10], it = n[e + 11], rt = n[e + 12], ut = n[e + 13], ft = n[e + 14], et = n[e + 15], o = l[0], s = l[1], h = l[2], c = l[3], o = i(o, s, h, c, v, 7, t[0]), c = i(c, o, s, h, a, 12, t[1]), h = i(h, c, o, s, y, 17, t[2]), s = i(s, h, c, o, p, 22, t[3]), o = i(o, s, h, c, w, 7, t[4]), c = i(c, o, s, h, b, 12, t[5]), h = i(h, c, o, s, k, 17, t[6]), s = i(s, h, c, o, d, 22, t[7]), o = i(o, s, h, c, g, 7, t[8]), c = i(c, o, s, h, nt, 12, t[9]), h = i(h, c, o, s, tt, 17, t[10]), s = i(s, h, c, o, it, 22, t[11]), o = i(o, s, h, c, rt, 7, t[12]), c = i(c, o, s, h, ut, 12, t[13]), h = i(h, c, o, s, ft, 17, t[14]), s = i(s, h, c, o, et, 22, t[15]), o = r(o, s, h, c, a, 5, t[16]), c = r(c, o, s, h, k, 9, t[17]), h = r(h, c, o, s, it, 14, t[18]), s = r(s, h, c, o, v, 20, t[19]), o = r(o, s, h, c, b, 5, t[20]), c = r(c, o, s, h, tt, 9, t[21]), h = r(h, c, o, s, et, 14, t[22]), s = r(s, h, c, o, w, 20, t[23]), o = r(o, s, h, c, nt, 5, t[24]), c = r(c, o, s, h, ft, 9, t[25]), h = r(h, c, o, s, p, 14, t[26]), s = r(s, h, c, o, g, 20, t[27]), o = r(o, s, h, c, ut, 5, t[28]), c = r(c, o, s, h, y, 9, t[29]), h = r(h, c, o, s, d, 14, t[30]), s = r(s, h, c, o, rt, 20, t[31]), o = u(o, s, h, c, b, 4, t[32]), c = u(c, o, s, h, g, 11, t[33]), h = u(h, c, o, s, it, 16, t[34]), s = u(s, h, c, o, ft, 23, t[35]), o = u(o, s, h, c, a, 4, t[36]), c = u(c, o, s, h, w, 11, t[37]), h = u(h, c, o, s, d, 16, t[38]), s = u(s, h, c, o, tt, 23, t[39]), o = u(o, s, h, c, ut, 4, t[40]), c = u(c, o, s, h, v, 11, t[41]), h = u(h, c, o, s, p, 16, t[42]), s = u(s, h, c, o, k, 23, t[43]), o = u(o, s, h, c, nt, 4, t[44]), c = u(c, o, s, h, rt, 11, t[45]), h = u(h, c, o, s, et, 16, t[46]), s = u(s, h, c, o, y, 23, t[47]), o = f(o, s, h, c, v, 6, t[48]), c = f(c, o, s, h, d, 10, t[49]), h = f(h, c, o, s, ft, 15, t[50]), s = f(s, h, c, o, b, 21, t[51]), o = f(o, s, h, c, rt, 6, t[52]), c = f(c, o, s, h, p, 10, t[53]), h = f(h, c, o, s, tt, 15, t[54]), s = f(s, h, c, o, a, 21, t[55]), o = f(o, s, h, c, g, 6, t[56]), c = f(c, o, s, h, et, 10, t[57]), h = f(h, c, o, s, k, 15, t[58]), s = f(s, h, c, o, ut, 21, t[59]), o = f(o, s, h, c, w, 6, t[60]), c = f(c, o, s, h, it, 10, t[61]), h = f(h, c, o, s, y, 15, t[62]), s = f(s, h, c, o, nt, 21, t[63]); l[0] = l[0] + o | 0; l[1] = l[1] + s | 0; l[2] = l[2] + h | 0; l[3] = l[3] + c | 0 }, _doFinalize: function () { var u = this._data, r = u.words, t = 8 * this._nDataBytes, i = 8 * u.sigBytes, f; for (r[i >>> 5] |= 128 << 24 - i % 32, f = n.floor(t / 4294967296), r[(i + 64 >>> 9 << 4) + 15] = (f << 8 | f >>> 24) & 16711935 | (f << 24 | f >>> 8) & 4278255360, r[(i + 64 >>> 9 << 4) + 14] = (t << 8 | t >>> 24) & 16711935 | (t << 24 | t >>> 8) & 4278255360, u.sigBytes = 4 * (r.length + 1), this._process(), u = this._hash, r = u.words, t = 0; 4 > t; t++)i = r[t], r[t] = (i << 8 | i >>> 24) & 16711935 | (i << 24 | i >>> 8) & 4278255360; return u }, clone: function () { var n = s.clone.call(this); return n._hash = this._hash.clone(), n } }); o.MD5 = s._createHelper(e); o.HmacMD5 = s._createHmacHelper(e) }(Math), function () { var t = CryptoJS, n = t.lib, i = n.Base, r = n.WordArray, n = t.algo, u = n.EvpKDF = i.extend({ cfg: i.extend({ keySize: 4, hasher: n.MD5, iterations: 1 }), init: function (n) { this.cfg = this.cfg.extend(n) }, compute: function (n, t) { for (var i, o, u = this.cfg, f = u.hasher.create(), e = r.create(), h = e.words, s = u.keySize, u = u.iterations; h.length < s;) { for (i && f.update(i), i = f.update(n).finalize(t), f.reset(), o = 1; o < u; o++)i = f.finalize(i), f.reset(); e.concat(i) } return e.sigBytes = 4 * s, e } }); t.EvpKDF = function (n, t, i) { return u.create(i).compute(n, t) } }(); CryptoJS.lib.Cipher || function (n) { var i = CryptoJS, t = i.lib, f = t.Base, e = t.WordArray, c = t.BufferedBlockAlgorithm, l = i.enc.Base64, y = i.algo.EvpKDF, s = t.Cipher = c.extend({ cfg: f.extend(), createEncryptor: function (n, t) { return this.create(this._ENC_XFORM_MODE, n, t) }, createDecryptor: function (n, t) { return this.create(this._DEC_XFORM_MODE, n, t) }, init: function (n, t, i) { this.cfg = this.cfg.extend(i); this._xformMode = n; this._key = t; this.reset() }, reset: function () { c.reset.call(this); this._doReset() }, process: function (n) { return this._append(n), this._process() }, finalize: function (n) { return n && this._append(n), this._doFinalize() }, keySize: 4, ivSize: 4, _ENC_XFORM_MODE: 1, _DEC_XFORM_MODE: 2, _createHelper: function (n) { return { encrypt: function (t, i, r) { return ("string" == typeof i ? v : u).encrypt(n, t, i, r) }, decrypt: function (t, i, r) { return ("string" == typeof i ? v : u).decrypt(n, t, i, r) } } } }); t.StreamCipher = s.extend({ _doFinalize: function () { return this._process(!0) }, blockSize: 1 }); var o = i.mode = {}, a = function (t, i, r) { var f = this._iv, u; for (f ? this._iv = n : f = this._prevBlock, u = 0; u < r; u++)t[i + u] ^= f[u] }, r = (t.BlockCipherMode = f.extend({ createEncryptor: function (n, t) { return this.Encryptor.create(n, t) }, createDecryptor: function (n, t) { return this.Decryptor.create(n, t) }, init: function (n, t) { this._cipher = n; this._iv = t } })).extend(); r.Encryptor = r.extend({ processBlock: function (n, t) { var i = this._cipher, r = i.blockSize; a.call(this, n, t, r); i.encryptBlock(n, t); this._prevBlock = n.slice(t, t + r) } }); r.Decryptor = r.extend({ processBlock: function (n, t) { var i = this._cipher, r = i.blockSize, u = n.slice(t, t + r); i.decryptBlock(n, t); a.call(this, n, t, r); this._prevBlock = u } }); o = o.CBC = r; r = (i.pad = {}).Pkcs7 = { pad: function (n, t) { for (var i = 4 * t, i = i - n.sigBytes % i, f = i << 24 | i << 16 | i << 8 | i, r = [], u = 0; u < i; u += 4)r.push(f); i = e.create(r, i); n.concat(i) }, unpad: function (n) { n.sigBytes -= n.words[n.sigBytes - 1 >>> 2] & 255 } }; t.BlockCipher = s.extend({ cfg: s.cfg.extend({ mode: o, padding: r }), reset: function () { var t; s.reset.call(this); var n = this.cfg, i = n.iv, n = n.mode; this._xformMode == this._ENC_XFORM_MODE ? t = n.createEncryptor : (t = n.createDecryptor, this._minBufferSize = 1); this._mode = t.call(n, this, i && i.words) }, _doProcessBlock: function (n, t) { this._mode.processBlock(n, t) }, _doFinalize: function () { var t = this.cfg.padding, n; return this._xformMode == this._ENC_XFORM_MODE ? (t.pad(this._data, this.blockSize), n = this._process(!0)) : (n = this._process(!0), t.unpad(n)), n }, blockSize: 4 }); var h = t.CipherParams = f.extend({ init: function (n) { this.mixIn(n) }, toString: function (n) { return (n || this.formatter).stringify(this) } }), o = (i.format = {}).OpenSSL = { stringify: function (n) { var t = n.ciphertext; return n = n.salt, (n ? e.create([1398893684, 1701076831]).concat(n).concat(t) : t).toString(l) }, parse: function (n) { var t, i; return n = l.parse(n), t = n.words, 1398893684 == t[0] && 1701076831 == t[1] && (i = e.create(t.slice(2, 4)), t.splice(0, 4), n.sigBytes -= 16), h.create({ ciphertext: n, salt: i }) } }, u = t.SerializableCipher = f.extend({ cfg: f.extend({ format: o }), encrypt: function (n, t, i, r) { r = this.cfg.extend(r); var u = n.createEncryptor(i, r); return t = u.finalize(t), u = u.cfg, h.create({ ciphertext: t, key: i, iv: u.iv, algorithm: n, mode: u.mode, padding: u.padding, blockSize: n.blockSize, formatter: r.format }) }, decrypt: function (n, t, i, r) { return r = this.cfg.extend(r), t = this._parse(t, r.format), n.createDecryptor(i, r).finalize(t.ciphertext) }, _parse: function (n, t) { return "string" == typeof n ? t.parse(n, this) : n } }), i = (i.kdf = {}).OpenSSL = { execute: function (n, t, i, r) { return r || (r = e.random(8)), n = y.create({ keySize: t + i }).compute(n, r), i = e.create(n.words.slice(t), 4 * i), n.sigBytes = 4 * t, h.create({ key: n, iv: i, salt: r }) } }, v = t.PasswordBasedCipher = u.extend({ cfg: u.cfg.extend({ kdf: i }), encrypt: function (n, t, i, r) { return r = this.cfg.extend(r), i = r.kdf.execute(i, n.keySize, n.ivSize), r.iv = i.iv, n = u.encrypt.call(this, n, t, i.key, r), n.mixIn(i), n }, decrypt: function (n, t, i, r) { return r = this.cfg.extend(r), t = this._parse(t, r.format), i = r.kdf.execute(i, n.keySize, n.ivSize, t.salt), r.iv = i.iv, u.decrypt.call(this, n, t, i.key, r) } }) }(), function () { for (var i, tt, h = CryptoJS, y = h.lib.BlockCipher, o = h.algo, t = [], p = [], w = [], b = [], k = [], d = [], c = [], l = [], a = [], v = [], u = [], f = 0; 256 > f; f++)u[f] = 128 > f ? f << 1 : f << 1 ^ 283; for (var r = 0, e = 0, f = 0; 256 > f; f++) { i = e ^ e << 1 ^ e << 2 ^ e << 3 ^ e << 4; i = i >>> 8 ^ i & 255 ^ 99; t[r] = i; p[i] = r; var s = u[r], g = u[s], nt = u[g], n = 257 * u[i] ^ 16843008 * i; w[r] = n << 24 | n >>> 8; b[r] = n << 16 | n >>> 16; k[r] = n << 8 | n >>> 24; d[r] = n; n = 16843009 * nt ^ 65537 * g ^ 257 * s ^ 16843008 * r; c[i] = n << 24 | n >>> 8; l[i] = n << 16 | n >>> 16; a[i] = n << 8 | n >>> 24; v[i] = n; r ? (r = s ^ u[u[u[nt ^ s]]], e ^= u[u[e]]) : r = e = 1 } tt = [0, 1, 2, 4, 8, 16, 32, 64, 128, 27, 54]; o = o.AES = y.extend({ _doReset: function () { for (var n, u = this._key, e = u.words, r = u.sigBytes / 4, u = 4 * ((this._nRounds = r + 6) + 1), f = this._keySchedule = [], i = 0; i < u; i++)i < r ? f[i] = e[i] : (n = f[i - 1], i % r ? 6 < r && 4 == i % r && (n = t[n >>> 24] << 24 | t[n >>> 16 & 255] << 16 | t[n >>> 8 & 255] << 8 | t[n & 255]) : (n = n << 8 | n >>> 24, n = t[n >>> 24] << 24 | t[n >>> 16 & 255] << 16 | t[n >>> 8 & 255] << 8 | t[n & 255], n ^= tt[i / r | 0] << 24), f[i] = f[i - r] ^ n); for (e = this._invKeySchedule = [], r = 0; r < u; r++)i = u - r, n = r % 4 ? f[i] : f[i - 4], e[r] = 4 > r || 4 >= i ? n : c[t[n >>> 24]] ^ l[t[n >>> 16 & 255]] ^ a[t[n >>> 8 & 255]] ^ v[t[n & 255]] }, encryptBlock: function (n, i) { this._doCryptBlock(n, i, this._keySchedule, w, b, k, d, t) }, decryptBlock: function (n, t) { var i = n[t + 1]; n[t + 1] = n[t + 3]; n[t + 3] = i; this._doCryptBlock(n, t, this._invKeySchedule, c, l, a, v, p); i = n[t + 1]; n[t + 1] = n[t + 3]; n[t + 3] = i }, _doCryptBlock: function (n, t, i, r, u, f, e, o) { for (var b = this._nRounds, h = n[t] ^ i[0], c = n[t + 1] ^ i[1], l = n[t + 2] ^ i[2], s = n[t + 3] ^ i[3], a = 4, w = 1; w < b; w++)var v = r[h >>> 24] ^ u[c >>> 16 & 255] ^ f[l >>> 8 & 255] ^ e[s & 255] ^ i[a++], y = r[c >>> 24] ^ u[l >>> 16 & 255] ^ f[s >>> 8 & 255] ^ e[h & 255] ^ i[a++], p = r[l >>> 24] ^ u[s >>> 16 & 255] ^ f[h >>> 8 & 255] ^ e[c & 255] ^ i[a++], s = r[s >>> 24] ^ u[h >>> 16 & 255] ^ f[c >>> 8 & 255] ^ e[l & 255] ^ i[a++], h = v, c = y, l = p; v = (o[h >>> 24] << 24 | o[c >>> 16 & 255] << 16 | o[l >>> 8 & 255] << 8 | o[s & 255]) ^ i[a++]; y = (o[c >>> 24] << 24 | o[l >>> 16 & 255] << 16 | o[s >>> 8 & 255] << 8 | o[h & 255]) ^ i[a++]; p = (o[l >>> 24] << 24 | o[s >>> 16 & 255] << 16 | o[h >>> 8 & 255] << 8 | o[c & 255]) ^ i[a++]; s = (o[s >>> 24] << 24 | o[h >>> 16 & 255] << 16 | o[c >>> 8 & 255] << 8 | o[l & 255]) ^ i[a++]; n[t] = v; n[t + 1] = y; n[t + 2] = p; n[t + 3] = s }, keySize: 8 }); h.AES = y._createHelper(o) }(), function (n, t) { var i = t.enc.Utf8.parse(n.context.getContext("#key")), r = t.enc.Utf8.parse(n.context.getContext("#key")); n.secureEngine = { encrypt: function (n) { var u = ""; return (n || n === 0) && (u = t.AES.encrypt(t.enc.Utf8.parse(n.toString()), i, { keySize: 16, iv: r, mode: t.mode.CBC, padding: t.pad.Pkcs7 })), u.toString() }, decrypt: function (n) { var u = ""; return (n || n.length > 12) && (u = t.AES.decrypt(n, i, { keySize: 16, iv: r, mode: t.mode.CBC, padding: t.pad.Pkcs7 })), u.toString(t.enc.Utf8) }, isEncrypted: function (n) { if (n || n.length > 12) return !0 } } }(VIS, CryptoJS), function (n, t) { function i(i) { this.frame; this.windowNo; var ci = null, ir = null, li = null, it = null, ht = null, ct = null, lt = null, rr = null, w = null, at = null, ai = null, br = null, rt = null, vt = null, b = null, yt = null, ut = null, ur = null, fr = null, k = null, pt = null, wt = null, vi = null, yi = null, ft = null, et = null, ot = null, er = null, pi = null, wi = this, kr = null, bi = null, bt = null, kt = null, or = null, sr = null, hr = null, cr = null, ki = null, di = null, lr = null, ar = null, vr = null, dr = null, c = null, f = null, gr = null, nu = null, dt = null, tu = null, gt = null, d = null, ni = null, e = null, gi = null, ti = !1, iu = null, ii = null, y = null, g = null, o = null, st = null, ri = !1, ru = null, ui = null, nt = null, u = null, fi = !1, ei = null, oi = null, si = null, nr = null, tr = null, u = null, uu = null, l = null, a = null, h = null, p = null, v = null, hi = null, fu = null, s = t("<div class='vis-forms-container'>"), tt = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), r = n.Env.getWindowNo(); this.log = n.Logging.VLogger.getVLogger("UserPreference"); this.load = function () { tt[0].style.visibility = "visible"; s.load(n.Application.contextUrl + "UserPreference/Index/?windowno=" + r + "&adUserId=" + n.context.getVAF_UserContact_ID(), function () { wi.init(s); var n = s.find("#content_" + r); n != null; tt[0].style.visibility = "hidden" }) }; this.init = function (wi) { function du(n) { tt[0].style.visibility = n ? "visible" : "hidden" } function no(n) { var t = new Date, i = ("0" + t.getDate()).slice(-2), r = ("0" + (t.getMonth() + 1)).slice(-2), u = t.getFullYear() + "-" + r + "-" + i; n.val(u) } function so() { t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/GetSavedDetail", dataType: "json", data: { isTask: !0 }, success: function (t) { ri = !1; ti = !1; fi = !1; var i = JSON.parse(t); i.IsSyncInBackground == "false" ? (ni.prop("checked", !1), gi = !1) : (ni.prop("checked", !0), gi = !0); i.IsCalSyncInBackground == "false" ? (g.prop("checked", !1), st = !1) : (g.prop("checked", !0), st = !0); d.val(i.TaskAuthCode); d.val().length > 0 && (gt.html(n.Msg.getMsg("RemoveLink")), ti = !0); y.val(i.CalendarAuthCode); y.val().length > 0 && (ii.html(n.Msg.getMsg("RemoveLink")), ri = !0); nt.val(i.ContactAuthCode); nt.val().length > 0 && (ui.html(n.Msg.getMsg("RemoveLink")), fi = !0) } }) } function ho() { var t = n.Application.contextUrl + "JsonData/GetThemes"; n.dataContext.getJSONData(t, null, co) } function co(n) { var t = [], r, u, i; if (n) { for (r = 0, u = n.length; r < u; r++)i = n[r], t.push("<li>"), t.push('<div class="vis-theme-rec" data-color="'), t.push(i.PColor), t.push("|"), t.push(i.OnPColor), t.push("|"), t.push(i.SColor), t.push("|"), t.push(i.OnSColor), t.push('" data-id="' + i.Id + '" >'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.PColor + ',1)"><\/span>'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.OnPColor + ',1)"><\/span>'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.SColor + ',1)"><\/span>'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.OnSColor + ',1)"><\/span>'), t.push("<\/div>"), t.push("<\/li>"); fu.append(t.join("")) } } function gu(i, r) { t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/GetGmailAuthorizationCode", dataType: "json", data: { isTask: i, isContact: r }, success: function (n) { var t = JSON.parse(n); t != null && t.length > 0 && window.open(t) } }) } function nf(i, r, f, s, h) { t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/SaveGmailAccountSettings", dataType: "json", data: { authCodes: f, isTask: i, isSyncInBackground: r, isRemoveLink: s, isContact: h }, success: function (t) { var r = JSON.parse(t); i ? r.toString() == "false" ? (e.css("color", "red"), e.text(n.Msg.getMsg("RecordNotSaved")), e.show()) : r.toString() == "true" ? (e.css("color", "green"), e.text(n.Msg.getMsg("RecordSaved")), s ? (d.val(""), gt.html(n.Msg.getMsg("Save")), ni.prop("checked", !1), ti = !1, d.removeAttr("disabled"), e.text(n.Msg.getMsg("LinkRemoved"))) : (gt.html(n.Msg.getMsg("RemoveLink")), d.attr("disabled", !0), ti = !0), e.show()) : window.open(r) : h ? r.toString() == "false" ? (u.css("color", "red"), u.text(n.Msg.getMsg("RecordNotSaved")), u.show()) : r.toString() == "true" ? (u.css("color", "green"), u.text(n.Msg.getMsg("RecordSaved")), s ? (nt.val(""), ui.html(n.Msg.getMsg("Save")), fi = !1, nt.removeAttr("disabled"), u.text(n.Msg.getMsg("LinkRemoved"))) : (ui.html(n.Msg.getMsg("RemoveLink")), nt.attr("disabled", !0), fi = !0), u.show()) : window.open(r) : r.toString() == "false" ? (o.css("color", "red"), o.text(n.Msg.getMsg("RecordNotSaved")), o.show()) : r.toString() == "true" ? (o.css("color", "green"), o.text(n.Msg.getMsg("RecordSaved")), s ? (y.val(""), ii.html(n.Msg.getMsg("Save")), g.prop("checked", !1), ri = !1, y.removeAttr("disabled"), o.text(n.Msg.getMsg("LinkRemoved"))) : (ii.html(n.Msg.getMsg("RemoveLink")), y.attr("disabled", !0), ri = !0), o.show()) : window.open(r) } }) } function lo() { vo(); si != null && si.append(pu); ao() } function ao() { if (window.WSP) { var i = n.Application.contextUrl + "WSP/ContactSettings/GetSavedDetail"; t.ajax({ type: "GET", async: !0, url: i, dataType: "json", success: function (n) { var t = JSON.parse(n), i; ei.val(t.Username); oi.val(t.Password); t.Role != "" && si.val(t.Role); i = t.IsUpdate; i.toString().toLowerCase() == "false" ? (nr.prop("checked", !1), tr = !1) : (nr.prop("checked", !0), tr = !0) } }) } } function vo() { if (window.WSP) { var i = n.Application.contextUrl + "WSP/ContactSettings/GetRole"; t.ajax({ type: "GET", async: !0, url: i, dataType: "json", success: function (t) { var r = JSON.parse(t), i; for (pu += "<option value='-1'  selected='selected'>" + n.Msg.getMsg("SelectRole") + "<\/option>", i = 0; i < r.length; i++)pu += "<option value='" + r[i].RoleID + "'>" + r[i].RoleName + "<\/option>" } }) } } function yo(i, r, f, e) { var o = n.Application.contextUrl + "WSP/ContactSettings/SaveGmailContactSettings"; t.ajax({ type: "POST", async: !1, url: o, dataType: "json", data: { username: i, password: r, role_ID: f, isUpdateExisting: e }, success: function (t) { var i = JSON.parse(t); i.toString() == "false" ? (u.css("color", "red"), u.text(n.Msg.getMsg("RecordNotSaved")), u.show()) : (u.css("color", "green"), u.text(n.Msg.getMsg("RecordSaved")), u.show()) } }) } function to() { var r, u, t, i, f; n.Env.getCtx().setContext("AutoCommit", ci.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_A_NEW, ct.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("AutoNew", ct.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACEFILE, at.prop("checked") ? "Y" : "N"); r = w.find("option:selected").val(); u = n.Logging.Level.prototype.getLevel(r); n.Logging.VLogMgt.setLevel(u); n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACELEVEL, w.find("option:selected").val()); t = rt[0].selectedIndex; n.Ini.setValueToLocalStorage(n.IniConstants.CO_SHOWLEVEL, t < 0 ? 0 : t); n.Env.getCtx().setContext("#ClientOrgLevel", t < 0 ? 0 : t); n.Ini.setValueToLocalStorage(n.IniConstants.W_PAGESIZE, b.find("option:selected").val()); n.Env.getCtx().setContext("#ShowWorkSpacePageSize", b.find("option:selected").val()); i = ut.find("option:selected").val(); n.Ini.setValueToLocalStorage(n.IniConstants.WIN_PAGESIZE, i); n.Env.setWINDOW_PAGE_SIZE(i); n.Ini.setValueToLocalStorage(n.IniConstants.P_Show_Mini_Grid, vt.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowMiniGrid", vt.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_Print_Native_Digits, yt.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#PrintNativeDigits", yt.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_A_LOGIN, li.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_STORE_PWD, ir.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowAcct", ht.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowTrl", it.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowAdvanced", lt.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_CACHE_WINDOW, rr.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACEFILE, at.prop("checked") ? "Y" : "N"); f = wo({ IsAutoCommit: ci.prop("checked") ? "Y" : "N", IsShowAcct: ht.prop("checked") ? "Y" : "N", IsShowTrl: it.prop("checked") ? "Y" : "N", IsShowAdvanced: lt.prop("checked") ? "Y" : "N" }) } function tf(n) { for (var e = n.length, f = "", u, r, i = 0; i < e; i += 1) { for (f += "<tr class='VIS_Pref-tbl-Row'>", u = 0; u < n[i].length; u += 1)r = n[i][u], f += u == 0 ? i % 2 ? "<td class='VIS_Pref_table-row2'>" + r + "<\/td>" : "<td class='VIS_Pref_table-row1'>" + r + "<\/td>" : u == n[i].length - 1 ? i % 2 ? "<td class='VIS_Pref_table-row2'>" + r + "<\/td>" : "<td class='VIS_Pref_table-row1'>" + r + "<\/td>" : i % 2 ? "<td class='VIS_Pref_table-row2'>" + r + "<\/td>" : "<td class='VIS_Pref_table-row1'>" + r + "<\/td>"; f += " <\/tr>" } ft.find("tbody > tr").eq(0).after(t.parseHTML(f)); lu = null; f = null } function po() { ht.prop("checked", n.Env.getCtx().ctx["#ShowAcct"] == "Y" ? !0 : !1); it.prop("checked", n.Env.getCtx().ctx["#ShowTrl"] == "Y" ? !0 : !1); lt.prop("checked", n.Env.getCtx().ctx["#ShowAdvanced"] == "Y" ? !0 : !1) } function wo(i) { var r = null; t.ajax({ url: n.Application.contextUrl + "UserPreference/SavePrefrence", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ pref: i }) }).done(function (n) { r = n; s.dialog("close") }) } var rf, uf, ff, ef, of, sf, hf, cf, lf, af, vf, yf, pf, wf, bf, kf, df, gf, ne, te, ie, re, ue, fe, ee, oe, se, he, ce, le, ae, ve, au, ye, pe, we, be, ke, de, ge, bu, hu, su, eu, yu, cu, ku, pu; ci = wi.find("#chkAutoCommit_" + r); ir = wi.find("#chkStorePassword_" + r); li = wi.find("#chkAutoLogin_" + r); it = wi.find("#chkShowTranslationTab_" + r); ht = wi.find("#chkShowAccountingTab_" + r); ct = wi.find("#chkAutoNewRecord_" + r); lt = wi.find("#chkShowAdvancedTab_" + r); rr = wi.find("#chkCacheWindows_" + r); w = wi.find("#cmbTraceLevel_" + r); at = wi.find("#chkTraceFile_" + r); ai = wi.find("#dt_Date_" + r); br = wi.find("#chkDictionaryMaintain_" + r); rt = wi.find("#cmbClientOrg_" + r); vt = wi.find("#chkShowMiniGrid_" + r); b = wi.find("#cmbPageSize_" + r); yt = wi.find("#chkNativeDigit_" + r); ut = wi.find("#cmbWindowPageSize_" + r); ur = wi.find("#lblVariableName_" + r); fr = wi.find("#lblVariableValue_" + r); et = wi.find("#btnOk_" + r); ot = wi.find("#btnCancel_" + r); er = wi.find("#btnRole_" + r); pi = wi.find("#contextlst_" + r); ft = wi.find("#prefErrortbl_" + r); et.hide(); ot.hide(); kr = wi.find("#btnChangePws_" + r); bi = wi.find("#txtCurrentPws_" + r); bt = wi.find("#txtNewPws_" + r); kt = wi.find("#txtConformPws_" + r); or = wi.find("#chkIsEmail_" + r); sr = wi.find("#chkIsNotice_" + r); hr = wi.find("#chkIsSMS_" + r); cr = wi.find("#chkIsFax_" + r); ki = wi.find("#txtUserName_" + r); di = wi.find("#txtPws_" + r); lr = wi.find("#btnEmailConfig_" + r); ar = wi.find("#btnSubstitute_" + r); vr = wi.find("#btnSaveChanges_" + r); dr = wi.find("#btnSaveChangePassword_" + r); nu = wi.find("#lblPrefSave_" + r); gr = wi.find("#btnSave_" + r); tu = wi.find("#vbtnGmailAuth_" + r); gt = wi.find("#vbtnSyncGmailTask_" + r); d = wi.find("#txtAuthCode_" + r); ni = wi.find("#chkIsSyncBackground_" + r); e = wi.find("#lblTaskSettingMessage_" + r); e.hide(); iu = wi.find("#vbtnGmailCalAuth_" + r); ii = wi.find("#vbtnSyncGmailCalendar_" + r); y = wi.find("#txtCalAuthCode_" + r); g = wi.find("#chkCalIsSyncBackground_" + r); o = wi.find("#lblCalendarSettingMessage_" + r); o.hide(); ru = wi.find("#vbtnGmailContactAuth_" + r); ui = wi.find("#vbtnSyncGmailContact_" + r); nt = wi.find("#txtContactAuthCode_" + r); u = wi.find("#lblContactSettingMessage_" + r); u.hide(); so(); ei = wi.find("#txtGmailUserName_" + r); oi = wi.find("#txtGmailPassword_" + r); si = wi.find("#cmbSettingRole_" + r); nr = wi.find("#chkbxUpdateExisting_" + r); uu = wi.find("#vbtnSyncGmailContact_" + r); u = wi.find("#lblContactSettingMessage_" + r); u.hide(); lo(); l = wi.find("#cmbRole_" + r); l.on("change", function () { yr() }); a = wi.find("#cmbClient_" + r); a.on("change", function () { pr() }); h = wi.find("#cmbOrg_" + r); h.on("change", function () { wr() }); p = wi.find("#cmbWareHouse_" + r); $btnTheme = wi.find("#btnTheme_" + r); v = {}; ou(); ho(); var io = wi.find("#lblUserSetMenu_" + r), ro = wi.find("#lblPreferenceMenu_" + r), uo = wi.find("#lblContextMenu_" + r), fo = wi.find("#lblErrorMenu_" + r); if (io.text(n.Msg.getMsg("UserSetting")), ro.text(n.Msg.getMsg("Preference")), uo.text(n.Msg.getMsg("Context")), fo.text(n.Msg.getMsg("PreferenceError")), rf = wi.find("#lblchangePwsHeader_" + r), rf.text(n.Msg.getMsg("ChangePassword")), uf = wi.find("#lblAutoMatic_" + r), uf.text(n.Msg.getMsg("AutoCommit")), ff = wi.find("#imgAutoMatic_" + r), ff.text(n.Msg.getMsg("AutoCommit", !0)), ef = wi.find("#lblTranslation_" + r), ef.text(n.Msg.getMsg("ShowTranslationTab")), of = wi.find("#imgTranslation_" + r), of.text(n.Msg.getMsg("ShowTranslationTab")), sf = wi.find("#lblShowAccounting_" + r), sf.text(n.Msg.getMsg("ShowAcctTab")), hf = wi.find("#imgShowAccounting_" + r), hf.text(n.Msg.getMsg("ShowAcctTab")), cf = wi.find("#lblAutoNewRecord_" + r), cf.text(n.Msg.getMsg("AutoNew")), lf = wi.find("#imgAutoNewRecord_" + r), lf.text(n.Msg.getMsg("AutoNew")), af = wi.find("#lblShowAdvanced_" + r), af.text(n.Msg.getMsg("ShowAdvancedTab")), vf = wi.find("#imgShowAdvanced_" + r), vf.text(n.Msg.getMsg("ShowAdvancedTab")), yf = wi.find("#lblCacheWindows_" + r), yf.text(n.Msg.getMsg("CacheWindow")), pf = wi.find("#imgCacheWindows_" + r), pf.text(n.Msg.getMsg("CacheWindow")), wf = wi.find("#vlblClientOrg_" + r), wf.text(n.Msg.getMsg("Show")), bf = wi.find("#imgClientOrg_" + r), bf.text(n.Msg.getMsg("ClientOrg")), kf = wi.find("#lblWindowPageSize_" + r), kf.text(n.Msg.getMsg("WindowPageSize")), df = wi.find("#imgWindowPageSize_" + r), df.text(n.Msg.getMsg("WindowPageSize")), gf = wi.find("#lblAutoLogin_" + r), gf.text(n.Msg.getMsg("AutoLogin")), ne = wi.find("#imgAutoLogin_" + r), ne.text(n.Msg.getMsg("AutoLogin")), te = wi.find("#lblStorePassword_" + r), te.text(n.Msg.getMsg("StorePassword")), ie = wi.find("#imgStorePassword_" + r), ie.text(n.Msg.getMsg("StorePassword")), re = wi.find("#lblTraceLevel_" + r), re.text(n.Msg.getMsg("TraceLevel")), ue = wi.find("#imgTraceLevel_" + r), ue.text(n.Msg.getMsg("TraceLevel")), fe = wi.find("#lblTraceFile_" + r), fe.text(n.Msg.getMsg("TraceFile")), ee = wi.find("#imgTraceFile_" + r), ee.text(n.Msg.getMsg("TraceFile")), oe = wi.find("#lblNativeDigit_" + r), oe.text(n.Msg.getMsg("PrintNativeDigits")), se = wi.find("#imgNativeDigit_" + r), se.text(n.Msg.getMsg("PrintNativeDigits")), he = wi.find("#vlblDateText_" + r), he.text(n.Msg.getMsg("Date")), ce = wi.find("#imgDateText_" + r), ce.text(n.Msg.getMsg("Date")), le = wi.find("#vlblthemeText_" + r), le.text(n.Msg.getMsg("SelectTheme")), ae = wi.find("#imgThemetext" + r), ae.text(n.Msg.getMsg("SelectTheme")), hi = wi.find("#vis_pref_theme" + r), fu = hi.find("ul"), au = wi.find("#vlblPageSize_" + r), au.text(n.Msg.getMsg("Pagesize")), ve = wi.find("#imgPageSize_" + r), ve.text(n.Msg.getMsg("Pagesize")), au = wi.find("#vlblPageSize_" + r), au.text(n.Msg.getMsg("Pagesize")), ye = wi.find("#lblContext_" + r), ye.text(n.Msg.getMsg("Context")), c = wi.find("#lblRecordSave_" + r), f = wi.find("#lblChangePasswordMessage_" + r), c.hide(), nu.hide(), f.hide(), pe = wi.find("#pchangePws_" + r), pe.text(n.Msg.getMsg("PPasswordInfo")), we = wi.find("#pNotification_" + r), we.text(n.Msg.getMsg("PNotificationInfo")), be = wi.find("#pEmailConfig_" + r), be.text(n.Msg.getMsg("PEmailConfigInfo")), ke = wi.find("#pSubstitute_" + r), ke.text(n.Msg.getMsg("PSubstituteInfo")), de = wi.find("#pContext_" + r), de.text(n.Msg.getMsg("PContextInfo")), ge = wi.find("#pError_" + r), ge.text(n.Msg.getMsg("PErrorInfo")), w != null) { var wu = [n.Logging.Level.OFF.getIntValue(), n.Logging.Level.SEVERE.getIntValue(), n.Logging.Level.WARNING.getIntValue(), n.Logging.Level.INFO.getIntValue(), n.Logging.Level.CONFIG.getIntValue(), n.Logging.Level.FINE.getIntValue(), n.Logging.Level.FINER.getIntValue(), n.Logging.Level.FINEST.getIntValue(), n.Logging.Level.ALL.getIntValue()], eo = [n.Logging.Level.OFF.getName(), n.Logging.Level.SEVERE.getName(), n.Logging.Level.WARNING.getName(), n.Logging.Level.INFO.getName(), n.Logging.Level.CONFIG.getName(), n.Logging.Level.FINE.getName(), n.Logging.Level.FINER.getName(), n.Logging.Level.FINEST.getName(), n.Logging.Level.ALL.getName()], su = 0; for (eu = 0; eu < wu.length; eu++)w.append(" <option value=" + wu[eu] + ">" + eo[eu] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.P_TRACELEVEL) == wu[eu] && (su = eu); w.prop("selectedIndex", su) } if (rt != null) { for (bu = [n.Msg.getMsg("Client+Org"), n.Msg.getMsg("Client"), n.Msg.getMsg("Org"), n.Msg.getMsg("None")], su = 0, eu = 0; eu < bu.length; eu++)rt.append("<option>" + bu[eu] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.CO_SHOWLEVEL) == eu && (su = eu); rt.prop("selectedIndex", su) } if (b != null) { for (hu = [5, 6, 7, 8, 9, 10], su = 0, eu = 0; eu < hu.length; eu++)b.append("<option>" + hu[eu] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.W_PAGESIZE) == hu[eu] && (su = eu); b.prop("selectedIndex", su) } if (ut != null) { for (hu = [50, 100, 500], su = 0, eu = 0; eu < hu.length; eu++)ut.append("<option>" + hu[eu] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.WIN_PAGESIZE) == hu[eu] && (su = eu); ut.prop("selectedIndex", su) } if (pi != null) { var lu = n.context.getEntireCtx(), vu = [], eu = 0, oo = Object.keys(lu).length; for (yu = 0; yu < oo; yu += 1)vu[eu++] = ' <li class="VIS_Pref_li-err" ><span >', vu[eu++] = Object.keys(lu)[yu] + " == " + lu[Object.keys(lu)[yu]], vu[eu++] = "<\/span><\/li>"; pi.append(vu.join("")); lu = null; vu = null } k = wi.find("#vchkErrorOnly_" + r); pt = wi.find("#vbtnReset_" + r); wt = wi.find("#vbtnSaveToFile_" + r); n.context && !n.context.getVAF_Role_ID() == 0 && wi.find(".VIS_Pref_err_btnLeft").hide(); vi = wi.find("#vbtnLogDate_" + r); yi = wi.find("#vbtnDownLog_" + r); no(vi); yi.on("click", function () { var i = vi.val(); i = i ? new Date(i).toISOString() : (new Date).toISOString(); du(!0); t.ajax({ type: "POST", url: n.Application.contextUrl + "UserPreference/DownloadServerLog", dataType: "json", data: { logDate: i }, success: function (t) { if (t) { var i = "TempDownload/" + t; window.open(n.Application.contextUrl + i); no(vi) } else n.ADialog.info("VIS_NoLogFound", null, null); du(!1) }, error: function () { du(!1) } }) }); k.prop("checked", !0); ft != null && (cu = n.Logging.VLogErrorBuffer.get(!0).getLogData(k.prop("checked")), dt = cu, tf(cu)); hi.on("click", "div.vis-theme-rec", function (i) { var r = t(i.currentTarget), u = r.data("color"), f = Number(r.data("id")); n.themeMgr && n.themeMgr.applyTheme(u); n.dataContext.postJSONData(n.Application.contextUrl + "Theme/SaveForUser", { id: f, uid: n.context.getVAF_UserContact_ID() }, function () { }) }); $btnTheme.on("click", function () { var t = new n.ThemeCnfgtor; t.show() }); wt.on("click", function () { var i, n, r, u; if (cu = dt, cu.length > 0) { for (i = "", n = 0; n < cu.length; n++)i += cu[n] + "\n"; r = (new Date).toISOString().slice(0, 19).replace(/-/g, ""); u = "data:text/csv;base64," + window.btoa(i); t(this).attr("href", u).attr("download", "file-" + r + ".csv") } }); po(); ci.prop("checked", n.Env.getCtx().isAutoCommit()); ct.prop("checked", n.Env.getCtx().isAutoNew()); li.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_A_LOGIN) == "N" ? !1 : !0); ir.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_STORE_PWD) == "N" ? !1 : !0); vt.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_Show_Mini_Grid) == "N" ? !1 : !0); yt.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_Print_Native_Digits) == "Y" ? !0 : !1); rr.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_CACHE_WINDOW) == "Y" ? !0 : !1); at.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_TRACEFILE) == "Y" ? !0 : !1); ku = new Date(Number(n.Env.getCtx().ctx["#Date"])); ku != null && ai.val(Globalize.format(ku, "yyyy-MM-dd")); pi.on("click", "li", function () { var n = t(this).text().split("==")[0], i = t(this).text().split("==")[1]; ur.text(n.toString()); fr.text(i.toString()) }); t(".VIS_Pref_meni li").on("click", function () { t(".VIS_Pref_menu li").removeClass("active"); t(this).addClass("active") }); pt.on("click", function () { var t = n.Logging.VLogErrorBuffer.get(!0).resetBuffer(k.prop("checked")); dt = t; t != null ? tf(t) : ft.find("tr:gt(0)").remove() }); t(".VIS_Pref_btn-pass-click").on("click", function () { t(".VIS_Pref_new-password").css("display", "block"); t(".VIS_Pref_Save").css("display", "block") }); t(".VIS_Pref_close-btn").click(function () { t(".VIS_Pref_new-password").css("display", "none"); t(".VIS_Pref_Save").css("display", "none") }); t(".VIS_Pref_link-1").click(function () { t(".VIS_Pref_content-right").css("display", "block"); t(".VIS_Pref_content-right-2").css("display", "none"); t(".VIS_Pref_content-right-3").css("display", "none"); t(".VIS_Pref_content-right-4").css("display", "none"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-2").click(function () { t(".VIS_Pref_content-right").css("display", "none"); t(".VIS_Pref_content-right-2").css("display", "block"); t(".VIS_Pref_content-right-3").css("display", "none"); t(".VIS_Pref_content-right-4").css("display", "none"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-3").click(function () { t(".VIS_Pref_content-right").css("display", "none"); t(".VIS_Pref_content-right-2").css("display", "none"); t(".VIS_Pref_content-right-3").css("display", "block"); t(".VIS_Pref_content-right-4").css("display", "none"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-4").click(function () { t(".VIS_Pref_content-right").css("display", "none"); t(".VIS_Pref_content-right-2").css("display", "none"); t(".VIS_Pref_content-right-3").css("display", "none"); t(".VIS_Pref_content-right-4").css("display", "flex"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-5").click(function () { window.WSP ? (t(".VIS_Pref_content-right").css("display", "none"), t(".VIS_Pref_content-right-2").css("display", "none"), t(".VIS_Pref_content-right-3").css("display", "none"), t(".VIS_Pref_content-right-4").css("display", "none"), t(".VIS_Pref_content-right-5").css("display", "block")) : alert("please download WSP !!!") }); i && t(".VIS_Pref_link-5").trigger("click"); gr.on("click", function () { to() }); et.on("click", function () { to() }); ot.on("click", function () { s.dialog("close") }); k.on("click", function () { var t = null; ft.find("tr").slice(1, -1).remove(); t = n.Logging.VLogErrorBuffer.get(!0).getLogData(k.prop("checked")); dt = t; t != null && tf(t) }); er.on("click", function () { var t = n.MRole.toStringX(n.Env.getCtx()) }); dr.on("click", function () { var r = bi.val(), i = bt.val(), u = kt.val(), e = ki.val(), o = di.val(); if (r.length <= 0 || i.length <= 0 || u.length <= 0) { f.css("color", "red"); f.text(n.Msg.getMsg("FillMandatory")); f.show(); return } if (i != u) { f.css("color", "red"); f.text(n.Msg.getMsg("samePassword")); f.show(); return } t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/SaveChangePassword", dataType: "json", data: { VAF_UserContact_ID: n.context.getVAF_UserContact_ID(), currentPws: r, newPws: i }, success: function (t) { returnValue = t.result; f.show(); returnValue == "OK" ? (f.css("color", "green"), f.text(n.Msg.getMsg("Passwordchanged"))) : (f.css("color", "red"), f.text(returnValue)) } }) }); vr.on("click", function () { var i = bi.val(), r = bt.val(), u = kt.val(), v = ki.val(), y = di.val(); if ((!(i.length <= 0) || !(r.length <= 0) || !(u.length <= 0)) && (!(i.length > 0) || !(r.length > 0) || !(u.length > 0))) { c.text(n.Msg.getMsg("mandatoryFields")); return } if (bt.text().localeCompare(kt.text()) == -1) { c.text(n.Msg.getMsg("samePassword")); return } var e = l.val(), o = a.val(), s = h.val(), f = p.val(); if (e == undefined || o == undefined || s == undefined) { c.text(n.Msg.getMsg("VIS_FillLogin")); return } f == undefined && (f = 0); t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/SaveUserSettings", dataType: "json", data: { VAF_UserContact_ID: n.context.getVAF_UserContact_ID(), currentPws: i, newPws: r, conformPws: u, chkEmail: or.prop("checked"), chkNotice: sr.prop("checked"), chkSMS: hr.prop("checked"), chkFax: cr.prop("checked"), emailUserName: v, emailPws: y, VAF_Role_ID: e, VAF_Client_ID: o, VAF_Org_ID: s, VAM_Warehouse_ID: f }, success: function (n) { returnValue = n.result; c.show(); c.css("color", "green"); c.text(returnValue.Msg); returnValue.IsSaved || c.css("color", "red") } }) }); lr.on("click", function () { var t = 0, i; try { t = n.dataContext.getJSONData(n.Application.contextUrl + "UserPreference/GetWindowID", { WindowName: "Mail Configuration" }, null); t > 0 && (i = new n.Query, i.addRestriction("VAF_UserContact_ID", n.Query.prototype.EQUAL, n.context.getVAF_UserContact_ID()), n.viewManager.startWindow(t, i)) } catch (r) { this.log.log(n.Logging.Level.SEVERE, sql, r) } s.dialog("close") }); ar.on("click", function () { var t = 0, i; try { t = n.dataContext.getJSONData(n.Application.contextUrl + "UserPreference/GetWindowID", { WindowName: "User Substitute" }, null); t > 0 && (i = new n.Query, i.addRestriction("VAF_UserContact_ID", n.Query.prototype.EQUAL, n.context.getVAF_UserContact_ID()), n.viewManager.startWindow(t, i)) } catch (r) { this.log.log(n.Logging.Level.SEVERE, sql, r) } s.dialog("close") }); tu.on("click", function () { gu(!0, !1) }); gt.on("click", function () { e.css("color", "gray"); e.text(n.Msg.getMsg("PleaseWait")); e.show(); window.setTimeout(function () { nf(!0, gi, d.val(), ti, !1) }, 500) }); ni.on("click", function (n) { gi = n.originalEvent.target.checked }); ru.on("click", function () { gu(!1, !0) }); ui.on("click", function () { u.css("color", "gray"); u.text(n.Msg.getMsg("PleaseWait")); u.show(); window.setTimeout(function () { nf(!1, !1, nt.val(), fi, !0) }, 500) }); iu.on("click", function () { gu(!1, !1) }); ii.on("click", function () { o.css("color", "gray"); o.text(n.Msg.getMsg("PleaseWait")); o.show(); window.setTimeout(function () { nf(!1, st, y.val(), ri, !1) }, 500) }); g.on("click", function (n) { st = n.originalEvent.target.checked }); nr.on("click", function (n) { tr = n.originalEvent.target.checked }); uu.on("click", function () { ei.val() != "" && ei.val().length != 0 && oi.val() != "" && oi.val().length != 0 && (u.css("color", "gray"), u.text(n.Msg.getMsg("PleaseWait")), u.show(), window.setTimeout(function () { yo(ei.val(), oi.val(), si.val(), tr) }, 500)) }); pu = null }; var ou = function () { t.ajax({ url: n.Application.contextUrl + "UserPreference/GetDefaultLogin", dataType: "json", data: { VAF_UserContact_ID: n.context.getVAF_UserContact_ID() }, success: function (n) { var t = JSON.parse(n); v.VAF_Role_ID = t.VAF_Role_ID; v.VAF_Client_ID = t.VAF_Client_ID; v.VAF_Org_ID = t.VAF_Org_ID; v.VAM_Warehouse_ID = t.VAM_Warehouse_ID; eu() } }) }, eu = function () { var i = "SELECT  r.Name,r.VAF_Role_ID FROM VAF_UserContact u INNER JOIN VAF_UserContact_Roles ur ON (u.VAF_UserContact_ID=ur.VAF_UserContact_ID AND ur.IsActive='Y') INNER JOIN VAF_Role r ON (ur.VAF_Role_ID=r.VAF_Role_ID AND r.IsActive='Y')  WHERE  u.VAF_UserContact_ID=" + n.context.getVAF_UserContact_ID() + " AND u.IsActive='Y'  AND u.IsLoginUser='Y'  AND EXISTS (SELECT * FROM VAF_Client c WHERE u.VAF_Client_ID=c.VAF_Client_ID AND c.IsActive='Y') AND EXISTS (SELECT * FROM VAF_Client c WHERE r.VAF_Client_ID=c.VAF_Client_ID AND c.IsActive='Y') ORDER BY r.Name"; t.ajax({ url: n.Application.contextUrl + "UserPreference/GetLoginData", dataType: "json", data: { sql: i }, success: function (n) { var t = JSON.parse(n), i = "", r; for (r in t) i += "<option value=" + t[r].RecKey + ">" + t[r].Name + "<\/option>"; l.append(i); l.val(v.VAF_Role_ID); i = null; t = null; yr() } }) }, yr = function () { var i = l.val(), r; (a.empty(), h.empty(), p.empty(), i != undefined) && (r = "SELECT c.Name,r.VAF_Client_ID FROM VAF_Role r INNER JOIN VAF_Client c ON (c.VAF_Client_ID=r.VAF_Client_ID) WHERE r.VAF_Role_ID=" + i, i = null, t.ajax({ url: n.Application.contextUrl + "UserPreference/GetLoginData", dataType: "json", data: { sql: r }, success: function (n) { var t = JSON.parse(n), i = "", u; for (u in t) i += "<option value=" + t[u].RecKey + ">" + t[u].Name + "<\/option>"; a.append(i); a.val(v.VAF_Client_ID); i = null; t = null; r = null; pr() } })) }, pr = function () { var i = l.val(), r = a.val(), u; (h.empty(), p.empty(), i != undefined && r != undefined) && (u = "SELECT o.Name,o.VAF_Org_ID FROM VAF_Role r, VAF_Client c INNER JOIN VAF_Org o ON (c.VAF_Client_ID=o.VAF_Client_ID OR o.VAF_Org_ID=0) WHERE r.VAF_Role_ID='" + i + "' AND c.VAF_Client_ID='" + r + "' AND o.IsActive='Y' AND o.IsSummary='N'  AND o.IsCostCenter='N' AND o.IsProfitCenter='N'  AND (r.IsAccessAllOrgs='Y' OR (r.IsUseUserOrgAccess='N' AND o.VAF_Org_ID IN (SELECT VAF_Org_ID FROM VAF_Role_OrgRights ra WHERE ra.VAF_Role_ID=r.VAF_Role_ID AND ra.IsActive='Y')) OR (r.IsUseUserOrgAccess='Y' AND o.VAF_Org_ID IN (SELECT VAF_Org_ID FROM VAF_UserContact_OrgRights ua WHERE ua.VAF_UserContact_ID='" + n.context.getVAF_UserContact_ID() + "' AND ua.IsActive='Y'))) ORDER BY o.Name", i = null, r = null, t.ajax({ url: n.Application.contextUrl + "UserPreference/GetLoginData", dataType: "json", data: { sql: u }, success: function (n) { var t = JSON.parse(n), i = "", r; for (r in t) i += "<option value=" + t[r].RecKey + ">" + t[r].Name + "<\/option>"; h.append(i); h.val(v.VAF_Org_ID); i = null; t = null; u = null; wr() } })) }, wr = function () { var i = h.val(), r; (p.empty(), i != undefined) && (r = "SELECT Name,VAM_Warehouse_ID  FROM VAM_Warehouse WHERE VAF_Org_ID=" + i + " AND IsActive='Y' ORDER BY Name", i = null, t.ajax({ url: n.Application.contextUrl + "UserPreference/GetLoginData", dataType: "json", data: { sql: r }, success: function (n) { var t = JSON.parse(n), i = "", u; for (u in t) i += "<option value=" + t[u].RecKey + ">" + t[u].Name + "<\/option>"; p.append(i); p.val(v.VAM_Warehouse_ID); i = null; t = null; r = null } })) }; this.showDialog = function () { var i = t(window).width() - 150, r = t(window).height() - 40; tt.height(r); tt.width(i); s.append(tt); s.dialog({ modal: !1, title: n.Msg.getMsg("Preference"), width: i, height: r, position: { at: "center top", of: window }, close: function () { wi.dispose(); s.dialog("destroy"); t("#ui-datepicker-div").remove(); s = null; wi = null } }) }; this.show = function () { this.load(); this.showDialog() }; this.disposeComponent = function () { wi = null; hi && hi.off("click"); et && et.off("click"); ot && ot.off("click"); pt && pt.off("click"); wt && wt.off("click"); yi && yi.off("click"); li = null; it = null; ht = null; ct = null; lt = null; at = null; w = null; dt = null; br = null; rt = null; vt = null; b = null; yt = null; ut = null; ur = null; fr = null; it = null; k = null; pt = null; wt = null; ft = null; er = null; et = null; ot = null; kr = null; bi = null; bt = null; kt = null; or = null; sr = null; hr = null; cr = null; ki = null; di = null; lr = null; ar = null; vr = null; lblUserSetMenu = null; lblPreferenceMenu = null; lblContextMenu = null; lblErrorMenu = null; lblchangePwsHeader = null; lblAutoMatic = null; imgAutoMatic = null; lblTranslation = null; imgTranslation = null; lblShowAccounting = null; imgShowAccounting = null; lblAutoNewRecord = null; imgAutoNewRecord = null; lblShowAdvanced = null; imgShowAdvanced = null; lblCacheWindows = null; imgCacheWindows = null; vlblClientOrg = null; imgClientOrg = null; lblWindowPageSize = null; imgWindowPageSize = null; lblAutoLogin = null; imgAutoLogin = null; lblStorePassword = null; imgStorePassword = null; lblTraceLevel = null; imgTraceLevel = null; lblTraceFile = null; imgTraceFile = null; lblNativeDigit = null; imgNativeDigit = null; vlblDateText = null; imgDateText = null; vlblPageSize = null; imgPageSize = null; vlblPageSize = null; lblContext = null; ai.datepicker("destroy"); ai = null; l.off("change"); a.off("change"); h.off("change"); l = null; a = null; h = null; p = null; eu = null; pr = null; yr = null; wr = null; this.disposeComponent = null } } n.Framework = n.Framework || {}; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Framework.UserPreference = i }(VIS, jQuery), function (n, t) { function i(i, r) { var e = this, u = t("<div>"), h = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), f = n.Env.getWindowNo(), c = null, l = null, o = null, d, g; this.onClose = null; var nt = null, p = null, a = null, v = null, k = null, b = null, s = !1, w = null, y = null; (i == null || i == "null") && (i = 0); d = function () { u.load(n.Application.contextUrl + "VImageForm/Index/?windowno=" + f + "&VAF_Image_id=" + i, function () { h[0].style.visibility = "visible"; g(u); h[0].style.visibility = "hidden" }) }; g = function (t) { c = u.find("#btnOk_" + f); l = u.find("#btnCancel_" + f); o = u.find("#btnImgDelete_" + f); n.Application.isRTL && (c.css("margin-right", "-128px"), l.css("margin-right", "110px"), o.css("margin-right", "55px")); i > 0 ? o.css("display", "inline-block") : o.css("display", "none"); p = t.find("#fileUpload_" + f); a = t.find("#holderDiv_" + f); v = t.find("#imgUsrImage_" + f); a.css("width", w - 48); y > 180 && a.css("height", y - 180); r > 0 ? v.hide() : v[0].width > 300 && a.css("overflow", "auto"); k = t.find("#lblfileUpload_" + f); b = t.find("#chkDataBaseSave_" + f); p.on("change", function () { v.show(); var t = p[0].files[0], n = new FileReader; return n.onload = function (n) { v.removeAttr("src").attr("src", n.target.result); a.css("overflow", "auto") }, n.readAsDataURL(t), s = !0, n = null, t = null, !1 }); b.on("change", function () { return s = !0, !1 }); c.on("click", function () { if (s) { var r = new XMLHttpRequest, t = new FormData; t.append("file", p[0].files[0]); t.append("isDatabaseSave", b.prop("checked")); t.append("VAF_Image_id", i); r.open("POST", n.Application.contextUrl + "VImageForm/SaveImage", !0); r.send(t); r.addEventListener("load", function (n) { var i = n.target.response, f; if (i = JSON.parse(i), f = i.result, e.onClose) e.onClose(f, s); r = null; t = null; u.dialog("close") }, !1) } else { if (e.onClose) e.onClose(i, s); u.dialog("close") } }); l.on("click", function () { u.dialog("close") }); o.on("click", function () { s = !0; var t = new XMLHttpRequest, r = new FormData; r.append("VAF_Image_id", i); t.open("POST", n.Application.contextUrl + "VImageForm/DeleteImage", !0); t.send(r); t.addEventListener("load", function (n) { var i = n.target.response, f; if (i = JSON.parse(i), f = i.result, e.onClose) e.onClose(f, s); t = null; r = null; u.dialog("close") }, !1) }) }; this.showDialog = function () { d(); w = t(window).width() - 150; y = t(window).height() - 40; h.height(y); h.width(w); u.append(h); u.dialog({ modal: !0, title: n.Msg.getMsg("ImageDialog"), width: w, height: y, position: { at: "center top", of: window }, close: function () { e.dispose(); e = null; u.dialog("destroy"); u = null } }) }; this.disposeComponent = function () { e = null; c && c.off("click"); l && l.off("click"); o && o.off("click"); h = null; f = null; c = null; l = null; o = null; nt = null; p = null; a = null; v = null; k = null; b = null; s = !1; w = null; y = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.VImageForm = i }(VIS, jQuery), function (n, t) { function i(i) { function f() { var e, s, f, h, o; for (r = t("<div><\/div>"), e = "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>", e += n.Application.isRTL ? "<html dir='rtl' xmlns='http://www.w3.org/1999/xhtml'>" : "<html xmlns='http://www.w3.org/1999/xhtml'>", e += "<head><script type='text/javascript' language='javascript'> document.onkeydown = function(){ if((window.event && window.event .keyCode == 116)||(window.event && window.event .keyCode == 78)) { window.event.keyCode = 505; }if(window.event && window.event .keyCode == 505){ return false; } }<\/script> <meta http-equiv='Content-Type' content='text/html; charset=utf-8' /><title>Help &amp; Support " + i.vo.Name + "<\/title><style type='text/css'><!--body {margin-left: 0px;margin-top: 0px;margin-right: 0px;margin-bottom: 0px;font-family:verdana;font-size:12px;color:#000000;}.hed1{font-family:verdana;font-weight:bold;font-size:12px;color:#000000;}.border{border:1px solid #c6daf3;}.border-1{border:1px solid #aac7e7;background-color:#e9e8e8;}.border-2{border:1px solid #aac7e7;}.border-bottom{border-bottom:1px solid #c6daf3;}.border-top-none{border-bottom:1px solid #c6daf3;border-right:1px solid #c6daf3;border-left:1px solid #c6daf3;}.red{font-size:12px;color:#FF0000;font-weight:bold;}.white{font-size:16px;color:#FFffff;font-weight:bold;}.black{font-size:16px;color:#000000;font-weight:bold;}.blue{color:#5490fa;font-weight:bold;}.orange{color:#f2b227;font-weight:bold;}.pad{padding:5px;}a{color:#5490fa;\t}a:hover{color:#000000;\ttext-decoration:none;}--><\/style><\/head><body oncontextmenu='return false;'>", e = e + "<table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'><tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' bgcolor='#c6daf3' class='border-bottom'><tr><td width='100%' class='hed1' height='29'>Vienna Solutions<\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td>", e = e + "<\/tr><tr><td><table width='98%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'><tr><td><table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td class='red'>&nbsp;<\/td><\/tr><tr><td class='red'>Window: " + i.vo.Name + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>" + i.vo.Description + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>" + i.vo.Help + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>", s = "", f = 0; f < i.tabs.length; f++)s == "" ? s = "<a href='#" + i.tabs[f].vo.Name + "" + f + "'>" + i.tabs[f].vo.Name + "<\/a>" : s += " -&gt; <a href='#" + i.tabs[f].vo.Name + "" + f + "'>" + i.tabs[f].vo.Name + "<\/a> "; for (e = e + s, e = e + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><\/table><\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>", e = e + "<tr><td><table width='98%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'>", f = 0; f < i.tabs.length; f++) { for (e = e + "<tr><td><table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td class='black' style='padding-top:5px;' ><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td width='340' height='5' bgcolor='#f9b31c'><\/td><td width='4'><\/td><td width='624' bgcolor='#f9b31c'><\/td><\/tr><tr><td height='35' bgcolor='#FFFFFF' class='border-top-none' style='padding-left:10px;'>Tab:" + i.tabs[f].vo.Name + "<a name='" + i.tabs[f].vo.Name + "" + f + "'><\/a> <\/td><td ><\/td><td bgcolor='#FFFFFF' class='border-top-none' style='padding-left:10px;'>" + i.tabs[f].vo.Description, "NaN<\/tr><\/table><\/td><\/tr><tr><td >&nbsp;<\/td><\/tr><tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border-2'><tr><td style='padding:10px; text-align:justify'><span class='red'>" + i.tabs[f].vo.Help, "NaN<br />", h = "", o = 0; o < i.tabs[f].gTab._gridTable.m_fields.length; o++)h == "" && (i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR || i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf) ? h = "<a href='#" + i.tabs[f].vo.Name + "" + f + "" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "" + o + "'>" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "<\/a>" : (i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR || i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf) && (h += " | <a href='#" + i.tabs[f].vo.Name + "" + f + "" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "" + o + "'>" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "<\/a>"); for (e = e + h, e = e + " <\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>", o = 0; o < i.tabs[f].gTab._gridTable.m_fields.length; o++)i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header != "" && (i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR || i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf) && (e = e + "<tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border-1'><tr><td style='padding:10px; text-align:justify'><span class='blue'>Field: " + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "<\/span><a name='" + i.tabs[f].vo.Name + "" + f + "" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "" + o + "'><\/a><br /><br />" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Description + "<br /><br />" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Help + " <\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>"); e = e + "<\/table><\/td><\/tr>" } e = e + "<\/table><\/td><\/tr><\/table><\/body><\/html>"; r.append(jQuery.parseHTML(e)); u = e } function e() { var n = window.open(); n.document.open(); n.document.write(u) } var r, u = ""; f(); e() } n.Apps.help = i }(VIS, jQuery), function (n, t) { t.IniConstants = { log: t.Logging.VLogger.getVLogger(" VIS.Ini"), ENV_PREFIX: "env.", VIENNA_HOME: "VIENNA_HOME", VIENNA_PROPERTY_FILE: "vienna.properties", VIENNA_ENV_FILE: "viennaEnv.properties", P_UID: "ApplicationUserID", DEFAULT_UID: "UserPwd", P_PWD: "ApplicationPassword", DEFAULT_PWD: "UserPwd", P_STORE_PWD: "StorePassword", DEFAULT_STORE_PWD: !0, P_TRACELEVEL: "TraceLevel", DEFAULT_TRACELEVEL: "WARNING", P_TRACEFILE: "TraceFile", DEFAULT_TRACEFILE: !1, P_INI: "FileNameINI", DEFAULT_INI: "", P_CONNECTION: "Connection", DEFAULT_CONNECTION: "", P_A_LOGIN: "AutoLogin", DEFAULT_A_LOGIN: !1, P_A_NEW: "AutoNew", DEFAULT_A_NEW: !0, P_VIENNASYS: "ViennaSys", DEFAULT_VIENNASYS: !1, P_CACHE_WINDOW: "CacheWindow", DEFAULT_CACHE_WINDOW: !1, P_TEMP_DIR: "TempDir", DEFAULT_TEMP_DIR: "", P_ROLE: "Role", DEFAULT_ROLE: "", P_CLIENT: "Client", DEFAULT_CLIENT: "", P_ORG: "Organization", DEFAULT_ORG: "", P_WAREHOUSE: "Warehouse", DEFAULT_WAREHOUSE: "", P_TODAY: "CDate264", DEFAULT_TODAY: Date.now, P_PRINTPREVIEW: "PrintPreview", DEFAULT_PRINTPREVIEW: !0, P_WARNING: "Warning", DEFAULT_WARNING: "Do_not_change_any_of_the_data_as_they_will_have_undocumented_side_effects.", P_PRINTER: "Printer", DEFAULT_PRINTER: "", P_DBUSED: "dbused", DEFAULT_DBUSED: "", P_DB_NAME: "dbname", DEFAULT_DB_NAME: "", P_DBUSER_ID: "dbuserid", DEFAULT_DBUSER_ID: "", P_DBPWD: "dbpwd", DEFAULT_DB_PWD: "", P_DB_PORT: "dbport", DEFAULT_DB_PORT: "", P_DB_HOST: "dbhost", DEFAULT_DB_HOST: "", CO_SHOWLEVEL: "ClientOrgLevel", DEFAULT_CO_SHOWLEVEL: "2", W_PAGESIZE: "WorkSpacePageSize", DEFAULT_W_PAGESIZE: "5", WIN_PAGESIZE: "WindowPageSize", DEFAULT_WIN_PAGESIZE: "50", P_Show_Mini_Grid: "ShowMiniGrid", DEFAULT_MiniGrid_Status: !1, P_Print_Native_Digits: "PrintNativeDigits", DEFAULT_Native_Digits_Status: !0, P_WELCOME_SCREEN: "HideWelcomeScreen", DEFAULT_SCREEN_STATUS: !1, P_APP_TYPE: "AppType", DEFAULT_APP_TYPE: "VServer", P_APP_HOST: "AppHost", DEFAULT_APP_HOST: "localhost", P_APP_PORT: "AppPort", DEFAULT_APP_PORT: "2090", _VIENNASYS: "VFramworkSys", _XML_DOC_PATH: "appconn.xml", _XML_ROOT: "//connectionvar" }; t.Ini = function () { function n(n, t) { localStorage.setItem(n, t) } function i(n) { return localStorage.getItem(n) } function r() { localStorage.clear() } function u(n) { localStorage.removeItem(n) } function f() { return localStorage.getItem(t.IniConstants.P_CACHE_WINDOW) == "Y" } function e() { return t.Ini.getLocalStorage(t.IniConstants.P_TRACELEVEL) != null ? t.Logging.Level.prototype.getLevel(t.Ini.getLocalStorage(t.IniConstants.P_TRACELEVEL)) : t.Logging.Level.INFO } function o() { for (var i = [t.IniConstants.P_A_NEW, t.IniConstants.P_TRACEFILE, t.IniConstants.P_TRACELEVEL, t.IniConstants.CO_SHOWLEVEL, t.IniConstants.W_PAGESIZE, t.IniConstants.WIN_PAGESIZE, t.IniConstants.P_Show_Mini_Grid, t.IniConstants.P_Print_Native_Digits, t.IniConstants.P_A_LOGIN, t.IniConstants.P_STORE_PWD, t.IniConstants.P_CACHE_WINDOW, t.IniConstants.P_PRINTPREVIEW, t.IniConstants.P_TRACEFILE], r = {}, n = 0; n < i.length; n++)i[n] == "AutoNew" ? t.context.setContext(i[n], t.Ini.getLocalStorage(i[n]) == null ? "N" : t.Ini.getLocalStorage(i[n])) : t.context.setContext("#" + i[n], t.Ini.getLocalStorage(i[n])), r[i[n]] = t.Ini.getLocalStorage(i[n]); r["#TimezoneOffset"] = (new Date).getTimezoneOffset().toString(); r["#ClientLanguage"] = window.navigator.language; t.dataContext.updateClientCtx(r) } return { setValueToLocalStorage: n, getLocalStorage: i, clearLocalStorage: r, removeLocalStorageItem: u, updateLocalContextFromIni: o, getIsCacheWindow: f, getTraceLevel: e } }() }(jQuery, VIS), function (n, t) { function i(i, r) { function nt(n) { tt.css("display", n ? "block" : "none") } this.onClose = null; var o = i, w = this, u = t("<div style='position:relative;'>"), tt = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), f = n.Env.getWindowNo(), it = null, b = null, s = null, h = null, c = null, l = null, a = null, k = null, v = null, y = null, d = null, rt = null, p = null, g = null, ft = null, ut = null, e = !1, et = r; this.load = function () { u.load(n.Application.contextUrl + "Location/Locations/?windowno=" + f + "&locationId=" + o + "&VAF_Language=" + n.context.getContext("#VAF_Language"), function () { u.append(tt); nt(!0); w.init(); nt(!1) }) }; this.init = function () { function tt(i) { var r = null; t.ajax({ url: n.Application.contextUrl + "Location/SaveLocation", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ pref: i }) }).done(function (n) { if (r = n, o = r.locationid, ut = r.locaddress, this.location = o, nt(!1), w.onClose) w.onClose(o, e); u.dialog("close"); e = null }) } var r, i; p = u.find("#btnOk_" + f); g = u.find("#btnCancel_" + f); it = u.find("#lstLocation_" + f); b = u.find("#txtCountry_" + f); s = u.find("#txtAddress1_" + f); h = u.find("#txtAddress2_" + f); c = u.find("#txtAddress3_" + f); l = u.find("#txtAddress4_" + f); n.Application.isRTL && (p.removeClass("pull-left"), p.addClass("pull-right"), u.find("Sup").css("float", "right"), t(u.find(".cat2 a")[0]).removeClass("pull-right"), t(u.find(".cat2 a")[0]).addClass("pull-left"), t(u.find(".cat3 a")[0]).removeClass("pull-right"), t(u.find(".cat3 a")[0]).addClass("pull-left"), t(u.find(".cat2 a")[0]).css("margin-left", "10px"), t(u.find(".cat3 a")[0]).css("margin-left", "10px")); s.val() && s.val(s.val()); h.val() && h.val(h.val()); c.val() && (r = u.find("#aCollection"), i = u.find(".cat" + t(r).attr("data-prod-cat")), i ? i.length > 0 && i.toggle() : u.find(".cat" + t(r).attr("data-prod-close")).hide(), c.val(c.val())); l.val() && (r = u.find(".cat3").find("a")[0], i = u.find(".cat" + t(r).attr("data-prod-cat")), i ? i.length > 0 && i.toggle() : u.find(".cat" + t(r).attr("data-prod-close")).hide(), l.val(l.val())); a = u.find("#txtCity_" + f); a.val() && a.val(a.val()); k = u.find("#txtState_" + f); v = u.find("#txtZipCode_" + f); v.val() && v.val(v.val()); y = u.find("#countryhdn_" + f).val(); d = u.find("#Statehdn_" + f).val(); b.autocomplete({ source: function (i, r) { i.term.trim().length != 0 && t.ajax({ url: n.Application.contextUrl + "Location/GetCountry", dataType: "json", data: { style: "full", name_startsWith: i.term }, success: function (n) { r(t.map(n.result, function (n) { return { label: n.Name, value: n.Name, id: n.Key } })) } }) }, minLength: 1, select: function (n, t) { y = t.item.id }, open: function () { u.find(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { u.find(this).removeClass("ui-corner-top").addClass("ui-corner-all"); Number(y) > 0 && (e = !0) } }); k.autocomplete({ source: function (i, r) { i.term.trim().length != 0 && t.ajax({ url: n.Application.contextUrl + "Location/GetStates", dataType: "json", data: { style: "full", name_startsWith: i.term, countryId: y }, success: function (n) { r(t.map(n.result, function (n) { return { label: n.Name, value: n.Name, id: n.Key } })) } }) }, minLength: 1, select: function (n, t) { d = t.item.id }, open: function () { u.find(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { u.find(this).removeClass("ui-corner-top").addClass("ui-corner-all") } }); it.autocomplete({ source: function (i, r) { i.term.trim().length != 0 && t.ajax({ url: n.Application.contextUrl + "Location/GetAddresses", dataType: "json", data: { style: "full", name_startsWith: i.term }, success: function (n) { r(t.map(n.result, function (n) { return { label: n.ADDRESS, value: n.ADDRESS, VAB_COUNTRY_ID: n.VAB_COUNTRY_ID, VAB_ADDRESS_ID: n.VAB_ADDRESS_ID, VAB_REGIONSTATE_ID: n.VAB_REGIONSTATE_ID, COUNTRYNAME: n.COUNTRYNAME, ADDRESS1: n.ADDRESS1, ADDRESS2: n.ADDRESS2, ADDRESS3: n.ADDRESS3, ADDRESS4: n.ADDRESS4, CITYNAME: n.CITYNAME, STATENAME: n.STATENAME, ZIPCODE: n.ZIPCODE } })) } }) }, minLength: 1, select: function (n, t) { b.val(t.item.COUNTRYNAME); s.val(t.item.ADDRESS1); h.val(t.item.ADDRESS2); c.val(t.item.ADDRESS3); l.val(t.item.ADDRESS4); a.val(t.item.CITYNAME); k.val(t.item.STATENAME); v.val(t.item.ZIPCODE); e = !0; d = t.item.VAB_REGIONSTATE_ID; o = 0; rt = 0; y = t.item.VAB_COUNTRY_ID }, open: function () { u.find(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { u.find(this).removeClass("ui-corner-top").addClass("ui-corner-all") } }); p.on("click", function () { if (nt(!0), Number(y) <= 0) { n.ADialog.warn("SelectCountry", !0, null); nt(!1); return } et && e && (o = 0); var t = { countryName: b.val(), addvalue1: s.val(), addvalue2: h.val(), addvalue3: c.val(), addvalue4: l.val(), cityValue: a.val(), stateValue: k.val(), zipValue: v.val(), clocationId: o, countryId: y, stateId: d, cityId: rt }, i = tt(t) }); g.on("click", function () { u.dialog("close") }); u.find(".VIS-Location-toggler").click(function (n) { n.preventDefault(); var t = u.find(".cat" + u.find(this).attr("data-prod-cat")); t && t.length > 0 ? t.toggle() : u.find(".cat" + u.find(this).attr("data-prod-close")).hide() }); b.bind("change", function () { e = !0 }); s.bind("change", function () { e = !0 }); h.bind("change", function () { e = !0 }); c.bind("change", function () { e = !0 }); l.bind("change", function () { e = !0 }); a.bind("change", function () { e = !0 }); k.bind("change", function () { e = !0 }); v.bind("change", function () { e = !0 }) }; this.showDialog = function () { u.append(tt); u.dialog({ modal: !0, resizable: !1, title: n.Msg.getMsg("Location"), closeText: n.Msg.getMsg("close"), width: 620, position: { at: "center top", of: window }, close: function () { w.dispose(); w = null; u.dialog("destroy"); u = null } }) }; this.disposeComponent = function () { w = null; p && p.off("click"); g && g.off("click"); o = 0; it = null; b = null; s = null; h = null; c = null; l = null; a = null; k = null; v = null; y = null; d = null; rt = null; p = null; g = null; ft = null; ut = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.LocationForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o) { function pt() { function o() { var n = nt.prop("checked"); n ? (it.hide(), rt.show(), a.removeClass("vis-gc-vpanel-table-readOnly"), v.removeClass("vis-gc-vpanel-table-readOnly"), y.removeClass("vis-gc-vpanel-table-readOnly"), w.removeClass("vis-gc-vpanel-table-readOnly"), c.removeClass("vis-gc-vpanel-table-readOnly"), c.removeAttr("disabled")) : (rt.hide(), it.show(), a.addClass("vis-gc-vpanel-table-readOnly"), v.addClass("vis-gc-vpanel-table-readOnly"), y.addClass("vis-gc-vpanel-table-readOnly"), w.addClass("vis-gc-vpanel-table-readOnly"), c.addClass("vis-gc-vpanel-table-readOnly"), c.attr("disabled", !0)); a.attr("readonly", !n); v.attr("readonly", !n); y.attr("readonly", !n); w.attr("readonly", !n) } function r() { var n = c.find("option:selected").text() + " " + g + " " + a.val() + " " + g + " " + v.val() + " " + g + " " + y.val(); w.val(n) } function lt() { b.on("click", function () { if (wt(), d.onClose) d.onClose(u); s.dialog("close") }); k.on("click", function () { s.dialog("close") }); nt.change(function () { o() }); ut.change(function () { }); a.change(function () { r() }); v.change(function () { r() }); y.change(function () { r() }); c.change(function () { r() }); ft.on("click", function () { l.val() == "" ? (l.autocomplete({ source: t.map(p.data, function (n) { return { label: n.Name, value: n.Name, locatorID: n.Key } }), minLength: 0 }).bind("focus", function () { l.val().length == 0 && l.autocomplete("search", "") }), l.trigger("focus")) : l.autocomplete("search") }) } var i, e; if (b = s.find("#btnOk_" + h), k = s.find("#btnCancel_" + h), vt = s.find("#cmbLocator_" + h), l = s.find("#lstLocator_" + h), ft = s.find("#locatorSearch_" + h), nt = s.find("#chkCreateNew_" + h), ut = s.find("#txtWarehouseInfo_" + h), c = s.find("#cmbWarehouse_" + h), a = s.find("#txtX_" + h), v = s.find("#txtY_" + h), y = s.find("#txtZ_" + h), w = s.find("#txtValue_" + h), tt = s.find("#divchkCreateNew_" + h), it = s.find("#divWarehouseInfo_" + h), rt = s.find("#divWarehouse_" + h), et = s.find("#lblX_" + h), ot = s.find("#lblY_" + h), st = s.find("#lblZ_" + h), ht = s.find("#lblValue_" + h), ct = s.find("#lblWarehouse_" + h), n.Application.isRTL && (b.css("margin-right", "-132px"), k.css("margin-right", "55px"), tt.children(0).css("float", "left")), p.refresh(), p.fillCombobox(f, !0, !0, !1), i = n.dataContext.getJSONData(n.Application.contextUrl + "Locator/GetWarehouse", { Warehouse_ID: at }, null), i != null) for (e in i) c.append(" <option value=" + i[e].VAM_Warehouse_ID + ">" + i[e].Name + "<\/option>"); c.prop("selectedIndex", 0); p.data.length > 0 && u == 0 && (u = p.data[0].Key); yt(i); l.autocomplete({ source: function (n, i) { (n == null || n.term == null || n.term.trim().length != 0) && p.data.length > 0 && i(t.map(p.data, function (t) { if (t.Name.toUpperCase().contains(n.term.trim().toUpperCase())) return { label: t.Name, value: t.Name, locatorID: t.Key } })) }, minLength: 1, select: function (n, t) { u = t.item.locatorID; yt(i) }, open: function () { t(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { t(this).removeClass("ui-corner-top").addClass("ui-corner-all") } }); p.getIsOnlyOutgoing() && tt.hide(); o(); lt() } function wt() { var i; if (nt.prop("checked")) { i = ""; w.val().trim().length == 0 && (i += ht.val() + " - "); a.val().trim().length == 0 && (i += et.val() + " - "); v.val().trim().length == 0 && (i += ot.val() + " - "); y.val().trim().length == 0 && (i += st.val() + " - "); var f = ct.val(), o = w.val(), s = a.val(), h = v.val(), l = y.val(), r = c.find("option:selected").val(); r != 0 && e != r && (e = r); e == 0 && (i += f + " - "); i.length != 0 ? n.ADialog.error("FillMandatory", !0, i.substring(0, i.length - 3)) : t.ajax({ url: n.Application.contextUrl + "Locator/Save", dataType: "json", async: !1, data: { warehouseId: e, tValue: o, tX: s, tY: h, tZ: l }, success: function (n) { returnValue = n.locatorId; u = returnValue; p.refresh() } }) } else d.change = !0 } function yt(t) { var r = "", o = "", i = n.dataContext.getJSONData(n.Application.contextUrl + "Locator/GetWarehouseData", { Locator_ID: u }, null), s, f; if (t != null && i != null && (ut.val(i.Name), a.val(i.x), v.val(i.y), y.val(i.z), w.val(i.Value), e = i.VAM_Warehouse_ID, o = i.wValue, r = i.Separator, l.length > 0 && (l[0].value = i.Name + "_" + i.Value + "(" + i.x + i.Separator + i.y + i.Separator + i.z + ")")), g = r, s = o + " " + r + " " + a.val() + " " + r + " " + v.val() + " " + r + " " + y.val(), w.val(s), t != null) for (f in t) if (e == t[f].VAM_Warehouse_ID) { c.prop("selectedIndex", f); break } } this.onClose = null; this.change = !1; var s = t("<div style='position:relative;'>"), lt = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), b = null, k = null, d = this, g = null, i = i, u = u, f = f, at = e, e = 0, h = o, p = r, l = null, ft = null, vt = null, nt = null, tt = null, it = null, rt = null, ut = null, c = null, a = null, v = null, y = null, w = null, et = null, ot = null, st = null, ht = null, ct = null; setBusy = function (n) { lt.css("display", n ? "block" : "none") }; this.load = function () { s.load(n.Application.contextUrl + "Locator/Index/?windowno=" + h + "&locatorId=" + u, function () { setBusy(!0); pt(); setBusy(!1) }) }; this.showDialog = function () { s.append(lt); s.dialog({ modal: !0, resizable: !1, title: n.Msg.translate(n.Env.getCtx(), "Locator"), width: 510, position: { at: "center top", of: window }, close: function () { d.dispose(); d = null; s.dialog("destroy"); s = null } }) }; this.disposeComponent = function () { b && b.off("click"); k && k.off("click"); b = null; k = null; d = null; l = null; ft = null; i = null; u = null; f = null; at = null; e = null; h = null; p = null; tt = null; it = null; rt = null; vt = null; nt = null; ut = null; c = null; a = null; v = null; y = null; w = null; et = null; ot = null; st = null; ht = null; ct = null; this.disposeComponent = null; this.load = null; g = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.LocatorForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { function o(n) { s.css("display", n ? "block" : "none") } function h(n) { var t = '<div class="vis-valpreferencedatawrp" id="fisrt_' + n.windowNum + '"><div class="input-group vis-input-wrap" style="flex: 1;"><div class="vis-control-wrap"><input class="VIS_Pref_pass vis-gc-vpanel-table-readOnly" data-placeholder="" placeholder=" " style="margin-bottom: 0;" type="text" readonly="true" id="vtxtAttribute_' + n.windowNum + '" /><label class=" VIS_Pref_Label_Font" id="vlblAttributeText_' + n.windowNum + '">test<\/label><\/div><\/div><label class="VIS_Pref_Label_Font" id="vlblAttribute_' + n.windowNum + '">test<\/label><\/div><div class="vis-valpreferencedatawrp" id="second_' + n.windowNum + '"><div class="input-group vis-input-wrap" style="flex: 1;"><div class="vis-control-wrap"><input class="VIS_Pref_pass vis-gc-vpanel-table-readOnly" data-placeholder="" placeholder=" " style="margin-bottom: 0;" type="text" readonly="true" id="vtxtSearchKey_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font" id="vlblValueText_' + n.windowNum + '">test<\/label><\/div><\/div><label class="VIS_Pref_Label_Font" id="vlblValue_' + n.windowNum + '">test<\/label><\/div><\/div><\/div><div style="width: 100%; float: left">    <div> <div class="VIS_Pref_col-50"><input  type="checkbox" id="vchkTenant_' + n.windowNum + '" ><label class="VIS_Pref_Label_Font">test<\/label><\/div>   <div class="VIS_Pref_col-50"> <input  type="checkbox" id="vchkOrg_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font">test<\/label><\/div> <div class="VIS_Pref_col-50"><input  type="checkbox" id="vchkUser_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font">test<\/label><\/div>  <div class="VIS_Pref_col-50"> <input  type="checkbox" id="vchkWindow_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font">test<\/label><\/div> <\/div><div id="divMsg_' + n.windowNum + '" style="width: 100%; float: left; margin-bottom: 5px; margin-top: 5px; text-align: left"><label class="VIS_Pref_Label_Font" id="vlblMsg_' + n.windowNum + '">test<\/label><\/div><div style="height: 10%; width: 100%; float: left"> <button type="button" id="btnDelete_' + n.windowNum + '"  class="VIS_Pref_btn-2"  style="float: left" value="Ok" role="button" aria-disabled="false"><i class="vis vis-delete"><\/i><\/button> <input id= "btnCancel_' + n.windowNum + '" class="VIS_Pref_btn-2" style="float:right" type="button" value="Cancel" /><input id="btnOK_' + n.windowNum + '"  class="VIS_Pref_btn-2" style="float:right; margin-right:10px" type="button" value="Ok" /><\/div>'; f.append(t) } if (i == null) return null; var e = this, f = t("<div class='vis-forms-container' style='position:relative;'>"), s = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); if (this.Okbtn = null, this.cancelbtn = null, this.deletebtn = null, this.txtAttribute = null, this.lblAttribute = null, this.txtSearchKey = null, this.lblValue = null, this.lblAttribute = null, this.lblValueText = null, this.lblLevelText = null, this.chkTenant = null, this.chkOrg = null, this.chkUser = null, this.chkWindow = null, this.lblMsg = null, this.userchk = null, this.tenantchk = null, this.windowchk = null, this.orgchk = null, this.aValue = null, this.aDisplayValue = null, r != null && (this.aValue = r, typeof r == Boolean && (this.aValue = r ? "Y" : "N"), this.aDisplayValue = u == null ? this.aValue : u), this.VAF_Screen_ID = i.getVAF_Screen_ID(), this.aAttribute = i.getColumnName(), this.aDisplayAttribute = i.getHeader(), this.aDisplayType = i.getDisplayType(), this.VAF_Control_Ref_ID = 0, this.windowNum = i.getWindowNo(), "Value".equals(this.aAttribute) || "DocumentNo".equals(this.aAttribute)) return null; this.VAF_Client_ID = n.context.getVAF_Client_ID(); this.VAF_Org_ID = n.context.getWindowContext(this.windowNum, "VAF_Org_ID", !0); this.VAF_UserContact_ID = n.context.getVAF_UserContact_ID(); this.role = n.MRole.getDefault(); this.load = function () { h(e); f.append(s); o(!0); e.init(f); o(!1) }; this.init = function () { this.lblAttributeText = f.find("#vlblAttributeText_" + this.windowNum); this.lblValueText = f.find("#vlblValueText_" + this.windowNum); this.lblLevelText = f.find("#vlblLevelText_" + this.windowNum); this.deletebtn = f.find("#btnDelete_" + this.windowNum); this.txtAttribute = f.find("#vtxtAttribute_" + this.windowNum); this.txtSearchKey = f.find("#vtxtSearchKey_" + this.windowNum); this.chkTenant = f.find("#vchkTenant_" + this.windowNum); this.chkOrg = f.find("#vchkOrg_" + this.windowNum); this.chkUser = f.find("#vchkUser_" + this.windowNum); this.chkWindow = f.find("#vchkWindow_" + this.windowNum); this.lblMsg = f.find("#vlblMsg_" + this.windowNum); this.lblAttribute = f.find("#vlblAttribute_" + this.windowNum); this.lblValue = f.find("#vlblValue_" + this.windowNum); this.Okbtn = f.find("#btnOK_" + this.windowNum); this.cancelbtn = f.find("#btnCancel_" + this.windowNum); n.Application.isRTL && (this.Okbtn.css("margin-right", "-128px"), this.cancelbtn.css("margin-right", "55px"), this.lblAttributeText.css("text-align", "right"), this.lblValueText.css("text-align", "right"), this.lblLevelText.css("text-align", "right"), this.chkOrg.css("margin-right", "0px"), this.chkTenant.css("margin-right", "37px"), f.find("#divMsg_" + this.windowNum).css("text-align", "right")); this.txtAttribute.val(this.aDisplayAttribute == null ? "" : this.aDisplayAttribute); this.lblAttribute.text(this.aAttribute == null ? "" : this.aAttribute); this.txtSearchKey.val(this.aDisplayValue == null ? "" : n.Utility.decodeText(this.aDisplayValue)); this.lblValue.text(this.aValue); this.lblAttributeText.text(n.Msg.getMsg("Attribute")); this.lblValueText.text(n.Msg.getMsg("SearchKey")); this.lblLevelText.text(n.Msg.getMsg("ValuePreferenceSetFor")); this.chkTenant.next("label").text(n.Msg.getMsg("Tenant")); this.chkOrg.next("label").text(n.Msg.getMsg("Org")); this.chkUser.next("label").text(n.Msg.getMsg("UserContact")); this.chkWindow.next("label").text(n.Msg.getMsg("Window")); this.chkTenant.prop("disabled", !0); this.chkTenant.prop("checked", !0); this.chkUser.prop("checked", !0); this.chkWindow.prop("checked", !0); n.MRole.PREFERENCETYPE_Client.equals(n.MRole.getPreferenceType()) || (this.chkOrg.prop("disabled", !0), this.chkOrg.prop("checked", !0)); n.MRole.PREFERENCETYPE_Client.equals(n.MRole.getPreferenceType()) || n.MRole.PREFERENCETYPE_Organization.equals(n.MRole.getPreferenceType()) || (this.chkUser.prop("disabled", !0), this.chkUser.prop("checked", !0)); this.setExplanation(); this.Okbtn.on("click", function () { o(!0); e.save(); o(!1); f.dialog("close") }); this.cancelbtn.on("click", function () { f.dialog("close") }); this.deletebtn.on("click", function () { e.delete(); f.dialog("close") }); t("[id^=vch]").click(function () { e.setExplanation() }) }; this.showDialog = function () { f.append(s); o(!0); setTimeout(this.load(), 5); f.dialog({ modal: !0, title: n.Msg.getMsg("ValuePreference"), width: 530, position: { at: "center top", of: window }, close: function () { e.dispose(); f.dialog("destroy"); f = null } }) }; this.disposeComponent = function () { this.Okbtn && this.Okbtn.off("click"); this.cancelbtn && this.cancelbtn.off("click"); this.deletebtn && this.deletebtn.off("click"); t("[id^=vch]") && t("[id^=vch]").off("click"); this.Okbtn = null; this.cancelbtn = null; this.deletebtn = null; s = null; e = null; this.disposeComponent = null } } i.prototype.setExplanation = function () { var t = "For "; this.chkTenant.prop("checked") && this.chkOrg.prop("checked") ? t += "this Client and Organization" : this.chkTenant.prop("checked") && !this.chkOrg.prop("checked") ? t += "all Organizations of this Client" : !this.chkTenant.prop("checked") && this.chkOrg.prop("checked") ? (this.chkOrg.prop("checked", !1), t += "entire System") : t += "entire System"; t += this.chkUser.prop("checked") ? ", this User" : ", all Users"; t += this.chkWindow.prop("checked") ? " and this Window" : " and all Windows"; n.Env.isBaseLanguage() && this.lblMsg.text(t.toString()); this.orgchk = this.chkOrg.prop("checked"); this.userchk = this.chkUser.prop("checked"); this.windowchk = this.chkWindow.prop("checked"); this.tenantchk = this.chkTenant.prop("checked") }; i.prototype.getADPreferenceID = function () { var t = "SELECT VAF_ValuePreference_ID FROM VAF_ValuePreference WHERE ", u = this.tenantchk ? this.VAF_Client_ID : 0, i, r; return t += "VAF_Client_ID=" + u, u = this.orgchk ? this.VAF_Org_ID : 0, t += " AND VAF_Org_ID=" + u, t += this.userchk ? " AND VAF_UserContact_ID=" + this.VAF_UserContact_ID : " AND VAF_UserContact_ID IS NULL", t += this.windowchk ? " AND VAF_Screen_ID=" + this.VAF_Screen_ID : " AND VAF_Screen_ID IS NULL", t += " AND Attribute='" + this.aAttribute + "'", i = 0, r = n.DB.executeDataSet(t.toString()), r != null && r.tables[0].rows.length > 0 && (i = r.tables[0].rows[0].getCell("vaf_valuepreference_id")), i < 0 && (i = 0), i }; i.prototype.delete = function () { var i = !1, r = this.getADPreferenceID(), u = this; return r > 0 ? t.ajax({ url: n.Application.contextUrl + "ValuePreference/Delete", dataType: "json", data: { preferenceId: r }, success: function (t) { i = t.result; i && (n.Env.getCtx().setContext(u.getContextKey(), null), n.ADialog.info("ValuePreferenceDeleted", !0, "", null)) } }) : n.ADialog.warn("ValuePreferenceNotFound", !0, "", null), i }; i.prototype.save = function () { var i, r, u; if (this.aValue == null) if (n.DisplayType.IsLookup(this.displayType)) this.aValue = "-1"; else if (n.DisplayType.IsDate(this.displayType)) this.aValue = " "; else return n.ADialog.warn("ValuePreferenceNotInserted", !0, "", null), !1; else if (this.aValue.toString().indexOf("@") != -1) return !1; return i = !1, this.orgchk = this.chkOrg.prop("checked"), this.userchk = this.chkUser.prop("checked"), this.windowchk = this.chkWindow.prop("checked"), this.tenantchk = this.chkTenant.prop("checked"), r = this, u = this.getADPreferenceID(), t.ajax({ url: n.Application.contextUrl + "ValuePreference/Save", dataType: "json", data: { preferenceId: u, clientId: this.tenantchk ? this.VAF_Client_ID : 0, orgId: this.orgchk ? this.VAF_Org_ID : 0, chkWindow: this.windowchk, VAF_Screen_ID: this.VAF_Screen_ID, chkUser: this.userchk, attribute: this.aAttribute, userId: this.VAF_UserContact_ID, value: this.aValue }, success: function (t) { i = t.result; i ? (n.Env.getCtx().setContext(r.getContextKey(), r.aValue), n.ADialog.info("ValuePreferenceInserted", !0, "", null)) : n.ADialog.warn("ValuePreferenceNotInserted", !0, "", null) } }), i }; i.prototype.getContextKey = function () { return this.windowchk ? "P" + this.VAF_Screen_ID + "|" + this.aAttribute : "P|" + this.aAttribute }; i.prototype.dispose = function () { this.disposeComponent() }; n.ValuePreference = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s) { function ai() { t.ajax({ url: n.Application.contextUrl + "PAttributes/Load", dataType: "json", async: !1, data: { mAttributeSetInstanceId: b, mProductId: nt, productWindow: ft, windowNo: y, VAF_Column_ID: o, window_ID: et, IsSOTrx: wt, IsInternalUse: ti }, success: function (t) { if (returnValue = t.result, returnValue.Error != null) { n.ADialog.error(returnValue.Error, null, null, null); it.hasAttribute = !1; return } h.html(returnValue.tableStucture); h.append(kt); returnValue.ControlList && (c = returnValue.ControlList.split(",")); li = returnValue.MAttributeSetID } }) } function vi(t) { var i, r; if (l.val(""), p.val(""), a.val(Globalize.format(new Date, "yyyy-MM-dd")), t = jQuery.parseJSON(t), t.result != null) for (i in t.result) if (c) { r = h.find("[attribute_id=" + i + "]"); r.attr("id").contains("cmb") ? r.val(n.Utility.Util.getValueOfInt(t.result[i])) : r.val(t.result[i]); continue } l != null && t.lot != "" ? l.val(t.lot) : p != null && t.serial != "" && p.val(t.serial); a != null && t.gdate != "" && a.val(Globalize.format(new Date(t.gdate), "yyyy-MM-dd")) } function yi() { var t = !0, f = !1, i, r, u; if (tt.prop("checked")) f = bt.val().length > 0 ? !0 : !1; else if (rt.prop("checked")) { if (i = l.val(), t = !1, r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/CheckUniqueLot", null, null), r > 0 && (u = wi(i), u)) return t = !0, n.ADialog.Info("LotNoExists", null, null, null), !1; t || ui() } else { if (t = !1, n.Env.getCtx().setContext(w, "AttrCode", ht), it.onClose) it.onClose(b, yt, ut); k(!1); h.dialog("close") } t && ui() } function ui() { var f = [], u, i; if (c) for (u = 0; u < c.length; u++)if (i = h.find("#" + c[u]), c[u].toString().contains("cmb")) i.find("option:selected").length > 0 ? f.push({ Key: Number(i.find("option:selected").val()), Name: i.find("option:selected").text() }) : f.push({ Key: 0, Name: i.val() }); else { if (i.attr("class").contains("vis-gc-vpanel-table-mandatory") && i.val().trim().length == 0) return n.ADialog.warn("FillMandatoryFields", !0, null), !1; i.attr("type") == "number" && (i.val().contains(".") || i.val(i.val().concat(".0"))); f.push({ Key: 0, Name: i.val() }) } t.ajax({ url: n.Application.contextUrl + "PAttributes/Save", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ windowNoParent: w, strLotString: l.val(), strSerNo: p.val(), dtGuaranteeDate: a.val(), strAttrCode: lt.val(), productWindow: ft, mAttributeSetInstanceId: b, mProductId: r, windowNo: y, description: bt.val(), isEdited: tt.prop("checked"), lst: f }), success: function (t) { if (returnValue = t.result, returnValue) if (returnValue.Error != null) n.ADialog.info("", null, returnValue.Error, null), k(!1); else { if (n.Env.getCtx().setContext(w, "AttrCode", returnValue.attrCode), it.onClose) it.onClose(returnValue.VAM_PFeature_SetInstance_ID, returnValue.VAM_PFeature_SetInstanceName, ut); k(!1); h.dialog("close") } }, error: function (n, t) { console.log(t); k(!1) } }) } function pi() { var t, r, f, i; it.log.config(""); t = 0; w != -1 && (window.DTD001 && et == 170 ? t = n.Env.getCtx().getContextAsInt(w, "DTD001_MWarehouseSource_ID") : (et == 143 || ni == "Blanket Sales Order" || et == 169 || et == 168 || et == 341) && (t = n.Env.getCtx().getContextAsInt(w, "VAM_Warehouse_ID"))); r = ""; try { r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/GetTitle", { Warehouse_ID: t, Product_ID: nt }, null) } catch (u) { console.log(u) } f = -1; i = new n.PAttributeInstance(r, t, ut, nt, pt, p.val(), l.val(), a.val(), wt); i.showDialog(); i.onClose = function (n, t, i, r) { n != -1 && (b = n, yt = t, ut = i, ht = r, gt = !0, k(!0), oi(), rt.prop("checked") && (rt.prop("checked", !1), fi()), tt.prop("checked") && (tt.prop("checked", !1), ei()), ri.show(), tt.show()) }; i = null } function fi() { var n = rt.prop("checked"), i, t; if (tt.attr("disabled", n), l && (l.attr("readOnly", !n), n ? l.removeClass("vis-gc-vpanel-table-readOnly") : l.addClass("vis-gc-vpanel-table-readOnly")), v && (n ? (v.removeClass("vis-gc-vpanel-table-readOnly"), v.removeAttr("disabled")) : (v.attr("disabled", !0), v.addClass("vis-gc-vpanel-table-readOnly"))), d && (n ? d.removeAttr("disabled") : d.attr("disabled", !0)), p && (p.attr("readOnly", !n), n ? p.removeClass("vis-gc-vpanel-table-readOnly") : p.addClass("vis-gc-vpanel-table-readOnly")), g && (n ? g.removeAttr("disabled") : g.attr("disabled", !0)), a && (a.prop("disable", n), n ? (a.removeClass("vis-gc-vpanel-table-readOnly"), a.removeAttr("disabled")) : (a.addClass("vis-gc-vpanel-table-readOnly"), a.attr("disabled", !0))), c) for (i = 0; i < c.length; i++)t = h.find("#" + c[i]), t.attr("readOnly", !n), n ? (t.removeClass("vis-gc-vpanel-table-readOnly"), t.removeAttr("disabled")) : (t.addClass("vis-gc-vpanel-table-readOnly"), t.attr("disabled", !0)) } function ei() { var n = tt.prop("checked"), i, t; if (rt.attr("disabled", n), l && (l.attr("readOnly", !n), n ? l.removeClass("vis-gc-vpanel-table-readOnly") : l.addClass("vis-gc-vpanel-table-readOnly")), v && (n ? (v.removeClass("vis-gc-vpanel-table-readOnly"), v.removeAttr("disabled")) : (v.attr("disabled", !0), v.addClass("vis-gc-vpanel-table-readOnly"))), d && (n ? d.removeAttr("disabled") : d.attr("disabled", !0)), p && (p.attr("readOnly", !n), n ? p.removeClass("vis-gc-vpanel-table-readOnly") : p.addClass("vis-gc-vpanel-table-readOnly")), g && (n ? g.removeAttr("disabled") : g.attr("disabled", !0)), a && (a.prop("disable", n), n ? (a.removeClass("vis-gc-vpanel-table-readOnly"), a.removeAttr("disabled")) : (a.addClass("vis-gc-vpanel-table-readOnly"), a.attr("disabled", !0))), c) for (i = 0; i < c.length; i++)t = h.find("#" + c[i]), t.attr("readOnly", !n), n ? (t.removeClass("vis-gc-vpanel-table-readOnly"), t.removeAttr("disabled")) : (t.addClass("vis-gc-vpanel-table-readOnly"), t.attr("disabled", !0)) } function wi(t) { var i = !1, r; try { r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/CheckAttribute", { Window_No: w, Product_ID: nt, LotNumber: t }, null); r > 0 && (i = !0) } catch (u) { console.log(u) } return i } function bi(n) { v.append(new Option(n.Name, n.Key, !0, !0)); v.change() } function oi() { if (c) for (var i = 0; i < c.length; i++)c[i].toString().contains("cmb") ? h.find("#" + c[i]).prop("selectedIndex", -1) : h.find("#" + c[i]).val(""); t.ajax({ url: n.Application.contextUrl + "PAttributes/GetAttribute", dataType: "json", data: { mAttributeSetInstanceId: b, mProductId: nt, productWindow: ft, windowNo: y, VAF_Column_ID: o, attrcode: ht }, success: function (n) { returnValue = n; returnValue != null && vi(returnValue); k(!1) }, error: function (n, t) { console.log(t); k(!1) } }) } function ki() { if (v != null && v.change(function () { var n = v.find("option:selected").val(), t = v.find("option:selected").text(); n != null && n != -1 ? (l.val(t), l.attr("readOnly", !0), l.addClass("vis-gc-vpanel-table-readOnly"), si = n) : (l.attr("readOnly", !1), l.removeClass("vis-gc-vpanel-table-readOnly")) }), rt != null && rt.change(function () { fi() }), tt != null && tt.change(function () { ei() }), lt != null) lt.on("keydown", function (n) { (n.keyCode == 13 || n.keyCode == 9) && (k(!0), ht = lt.val(), oi()) }); if (ot != null) ot.on("click", function () { k(!0); yi() }); if (st != null) st.on("click", function () { h.dialog("close") }); if (ct != null) { k(!0); ct.on("click", function () { pi() }); k(!1) } if (d != null) d.on("click", function () { t.ajax({ url: n.Application.contextUrl + "PAttributes/CreateLot", dataType: "json", async: !1, data: { mAttributeSetInstanceId: b, mProductId: nt }, success: function (n) { returnValue = n.result; bi(returnValue) } }) }); if (g != null) g.on("click", function () { t.ajax({ url: n.Application.contextUrl + "PAttributes/GetSerNo", dataType: "json", async: !1, data: { mAttributeSetInstanceId: b, mProductId: nt }, success: function (n) { returnValue = n.result; p.val(returnValue) } }) }); c } function k(n) { kt.css("display", n ? "block" : "none") } var ii, at, vt; this.onClose = null; var it = this, h = t("<div style='position:relative'>"), kt = t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"), y = n.Env.getWindowNo(), b = null, ut = null, yt = null, nt = null, pt = null, dt = null, w = null, si = null, ht = "", ft = !1, gt = !1, hi = 40, ci = {}, c = null, li = null, et = 0, ni = "", wt = !1, ti = !1; if (this.log = n.Logging.VLogger.getVLogger("PAttributesForm"), this.log.config("VAM_PFeature_SetInstance_ID=" + i + ", VAM_Product_ID=" + r + ", VAB_BusinessPartner_ID=" + f + ", ProductW=" + ft + ", Column=" + o), b = i, nt = r, pt = f, ft = e, dt = o, w = s, ut = u, w != -1 && (ii = n.context.getWindowTabContext(w, 0, "VAF_Tab_ID"), et = n.dataContext.getJSONRecord("InfoProduct/GetWindowID", ii.toString()), ni = n.context.getContext(w, "WindowName"), wt = n.context.isSOTrx(w), ti = n.context.getWindowTabContext(w, 0, "IsInternalUse")), nt != 0) { this.hasAttribute = !0; ai(); var ot = h.find("#btnOk_" + y), st = h.find("#btnCancel_" + y), ct = h.find("#btnSelect_" + y), d = h.find("#btnLot_" + y), g = h.find("#btnSerNo_" + y), v = h.find("#cmbLot_" + y), rt = h.find("#chkNewEdit_" + y), ri = h.find("#lblEdit_" + y), tt = h.find("#chkEdit_" + y), bt = h.find("#txtDescription_" + y), l = h.find("#txtLotString_" + y), p = h.find("#txtSerNo_" + y), a = h.find("#dtpicGuaranteeDate_" + y), lt = h.find("#txtAttrCode_" + y); if (ct.children(0).attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/Locator10.png"), n.Application.isRTL && (ot.css("margin-right", "-138px"), st.css("margin-right", "55px")), !ft) if (rt.prop("checked", b == 0), b > 0) { if (l && (l.attr("readOnly", !0), l.addClass("vis-gc-vpanel-table-readOnly")), v && (v.attr("disabled", !0), v.addClass("vis-gc-vpanel-table-readOnly")), d && d.attr("disabled", !0), p && (p.attr("readOnly", !0), p.addClass("vis-gc-vpanel-table-readOnly")), g && g.attr("disabled", !0), a && (a.prop("disable", !0), a.addClass("vis-gc-vpanel-table-readOnly"), a.attr("disabled", !0)), c) for (at = 0; at < c.length; at++)vt = h.find("#" + c[at]), vt.attr("readOnly", !0), vt.addClass("vis-gc-vpanel-table-readOnly"), vt.attr("disabled", !0) } else ri.hide(), tt.hide(); ki(); this.showDialog = function () { if (h.dialog({ modal: !0, title: n.Msg.translate(n.Env.getCtx(), "VAM_PFeature_SetInstance_ID"), width: 490, close: function () { it.dispose(); it = null; h.dialog("destroy"); h = null } }), c && i == 0) for (var t = 0; t < c.length; t++)c[t].toString().contains("cmb") && h.find("#" + c[t]).prop("selectedIndex", -1); k(!1) }; this.disposeComponent = function () { ot && ot.off("click"); st && st.off("click"); n.Env.clearWinContext(n.Env.getCtx(), y); n.Env.getCtx().setContext(n.Env.WINDOW_INFO, n.Env.TAB_INFO, "VAM_PFeature_SetInstance_ID", b); n.Env.getCtx().setContext(n.Env.WINDOW_INFO, n.Env.TAB_INFO, "VAM_Locator_ID", ut); ut = null; yt = null; nt = null; pt = null; dt = null; w = null; ft = null; gt = null; hi = 0; ci = null; ot = null; st = null; ct = null; d = null; g = null; v = null; rt = null; bt = null; l = null; p = null; a = null; it = null; y = null; b = null; this.disposeComponent = null } } } i.prototype.dispose = function () { this.disposeComponent() }; n.PAttributesForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h, c) { function bt(t) { var f; if (l.log.config("VAB_BusinessPartner_ID=" + t), t != 0) { var u = 0, i = 0, r = null; try { r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/GetBPData", { Product_ID: rt, BPartner_ID: t }, null); r != null && (u = r.ShelfLifeMinPct, f = r.PCT, f > 0 && (i = f), i = r.ShelfLifeMinDays) } catch (e) { console.log(e) } u > 0 && (k = " AND COALESCE(TRUNC((daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD'))/p.GuaranteeDays)*100),0)>=" + u, l.log.config("PAttributeInstance.dynInit - ShelfLifeMinPct=" + u)); i > 0 && (k += " AND COALESCE(daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD')),0)>=" + i, l.log.config("PAttributeInstance.dynInit - ShelfLifeMinDays=" + i)) } y = kt(vt, yt, !1, "patr") + " ORDER BY asi.GuaranteeDate, QtyOnHand DESC"; ot(); tt.append(p); et.append(w).append(a); b.append(st).append(tt).append(ft).append(et); lt ? p.prop("checked", !1) : p.prop("checked", !0); gt() } function kt(t, i, r, u) { var f = "SELECT DISTINCT patr.VAM_PFeature_SetInstance_ID, asi.Description, asi.Lot, asi.SerNo, asi.GuaranteeDate, asi.Value AS AttrCode, l.Value, NVL(s.VAM_Locator_ID,0) AS VAM_Locator_ID, NVL(s.QtyOnHand,0) AS QtyOnHand, NVL(s.QtyReserved,0) AS QtyReserved, NVL(s.QtyOrdered,0) AS QtyOrdered, (daysBetween(TRUNC(asi.GuaranteeDate,'DD'), TRUNC(SysDate,'DD'))-p.GuaranteeDaysMin) as ShelfLifeDays, daysBetween(TRUNC(asi.GuaranteeDate,'DD'), TRUNC(SysDate,'DD')) as GoodForDays, CASE WHEN p.GuaranteeDays > 0 THEN  ROUND(daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD'))/p.GuaranteeDays*100,12) ELSE 0 END as ShelfLifeRemainingPct", e; return (f = f.concat(" FROM ").concat(t), f = f.concat(" WHERE ").concat(i), it != 0 && (f = f.concat(" AND NVL(l.VAM_Warehouse_ID,0) IN (0," + it + ")")), t.length == 0) ? f.toString() : (l.log.finest(e), n.MRole.getDefault().addAccessSQL(f, u, n.MRole.SQL_FULLYQUALIFIED, n.MRole.SQL_RO)) } function ot() { var o, u, i, t; y == null && (y = ""); var f = [], r = y, e = y.lastIndexOf(" ORDER BY "); p.prop("checked") || (r = y.substring(0, e) + ut, k.length > 0 && (r += k), r += y.substring(e)); l.log.finest(r); try { if (o = n.secureEngine.encrypt(r), dr = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/GetAttributeData", { Sq1Atribute: o, Product_ID: rt }, null), dr.length > 0) { u = 1; for (i in dr) t = {}, t.VAM_PFeature_SetInstance_ID = dr[i].VAM_PFeature_SetInstance_ID, t.Description = dr[i].Description, t.Lot = dr[i].Lot, t.SerNo = dr[i].SerNo, t.GuaranteeDate = dr[i].GuaranteeDate, t.Value = dr[i].Value, t.QtyReserved = dr[i].QtyReserved, t.QtyOrdered = dr[i].QtyOrdered, t.QtyOnHand = dr[i].QtyOnHand, t.GoodForDays = dr[i].GoodForDays, t.ShelfLifeDays = dr[i].ShelfLifeDays, t.ShelfLifeRemainingPct = dr[i].ShelfLifeRemainingPct, t.VAM_Locator_ID = dr[i].VAM_Locator_ID, t.AttrCode = dr[i].AttrCode, t.recid = u, u++, f.push(t) } wt() } catch (s) { console.log(s) } dt(f) } function dt(i) { l.dGrid != null && (l.dGrid.destroy(), l.dGrid = null); l.arrListColumns.length == 0 && (l.arrListColumns.push({ field: "Description", caption: n.Msg.translate(n.Env.getCtx(), "Description"), sortable: !0, size: "16%", min: 150, hidden: !1 }), l.arrListColumns.push({ field: "Lot", caption: n.Msg.translate(n.Env.getCtx(), "Lot"), sortable: !0, size: "10%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "SerNo", caption: n.Msg.getElement(n.Env.getCtx(), "SerNo"), sortable: !0, size: "10%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "GuaranteeDate", caption: n.Msg.getElement(n.Env.getCtx(), "GuaranteeDate"), sortable: !0, size: "10%", min: 100, hidden: !1, render: "date", options: { format: "yyyy-mm-dd" } }), l.arrListColumns.push({ field: "Value", caption: n.Msg.getElement(n.Env.getCtx(), "VAM_Locator_ID"), sortable: !0, size: "10%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "QtyReserved", caption: n.Msg.getElement(n.Env.getCtx(), "QtyReserved"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "QtyOrdered", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOrdered"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "QtyOnHand", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOnHand"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "GoodForDays", caption: n.Msg.getElement(n.Env.getCtx(), "GoodForDays"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "ShelfLifeDays", caption: n.Msg.getElement(n.Env.getCtx(), "ShelfLifeDays"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "ShelfLifeRemainingPct", caption: n.Msg.getElement(n.Env.getCtx(), "ShelfLifeRemainingPct"), sortable: !0, size: "20%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "VAM_Locator_ID", caption: n.Msg.getElement(n.Env.getCtx(), "VAM_Locator_ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }), l.arrListColumns.push({ field: "VAM_PFeature_SetInstance_ID", caption: n.Msg.translate(n.Env.getCtx(), "ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }), l.arrListColumns.push({ field: "AttrCode", caption: n.Msg.getElement(n.Env.getCtx(), "AttrCode"), sortable: !0, size: "16%", min: 150, hidden: !0 })); setTimeout(10); w2utils.encodeTags(i); l.dGrid = t(ft).w2grid({ name: "gridPinstance" + v, show: { toolbar: !0, footer: !0 }, recordHeight: 30, columns: l.arrListColumns, records: i, multiSearch: !0, searches: [{ field: "Description", caption: "Description", type: "text" }, { field: "Lot", caption: "Lot", type: "text" }, { field: "SerNo", caption: "SerNo", type: "text" }, { field: "GuaranteeDate", caption: "GuaranteeDate", type: "date", options: { format: "yyyy-mm-dd" } }], onClick: function () { l.dGrid.records.length > 0 && a.removeAttr("disabled") } }); pt || (o ? l.dGrid.search("all", o) : s && l.dGrid.search("all", s)) } function wt() { var n = -1, t = n != -1, i; l.dGrid != null && (n = Number(l.dGrid.getSelection().toString()), g = -1, nt = null, d = 0, t = n != -1, t && n > 0 && (i = l.dGrid.get(n).VAM_PFeature_SetInstance_ID, i > 0 && (g = i, nt = l.dGrid.get(n).Description, d = l.dGrid.get(n).VAM_Locator_ID, at = l.dGrid.get(n).AttrCode))); a.attr("disabled", !0); t && a.removeAttr("disabled"); l.log.fine("VAM_PFeature_SetInstance_ID=" + g + " - " + nt + "; VAM_Locator_ID=" + d) } function gt() { if (a != null) a.on(n.Events.onTouchStartOrClick, function () { if (wt(), l.onClose) l.onClose(g, nt, d, at); b.dialog("close") }); if (w != null) w.on(n.Events.onTouchStartOrClick, function () { b.dialog("close") }); p != null && p.change(function () { pt = !0; ot() }) } var l = this, k; this.onClose = null; var b = t("<div>"), st = t("<div class='vis-apanel-busy'>"), it = r, d = u, rt = f, ht = e, ct = i, lt = c; this.arrListColumns = []; this.dGrid = null; var g = -1, nt = null, at = "", y = "", ut = "", vt = "VAM_ProductFeatures patr LEFT JOIN VAM_Storage s ON (patr.VAM_PFeature_SetInstance_ID = s.VAM_PFeature_SetInstance_ID AND patr.VAM_Product_ID = s.VAM_Product_ID) LEFT JOIN VAM_Locator l ON (s.VAM_Locator_ID=l.VAM_Locator_ID) LEFT JOIN VAM_Warehouse w ON (l.VAM_Warehouse_ID=w.VAM_Warehouse_ID) INNER JOIN VAM_Product p ON (patr.VAM_Product_ID=p.VAM_Product_ID) INNER JOIN VAM_PFeature_SetInstance asi ON (patr.VAM_PFeature_SetInstance_ID=asi.VAM_PFeature_SetInstance_ID)", yt = " patr.VAM_Product_ID=@VAM_Product_ID AND patr.VAM_PFeature_SetInstance_ID != 0"; ut = " AND s.QtyOnHand>0"; k = ""; this.log = n.Logging.VLogger.getVLogger("PAttributeInstance"); var v = n.Env.getWindowNo(), p = t("<input id='chkShowAll_" + v + "' type='checkbox' ><span><label id='lblShowAll_" + v + "' class='VIS_Pref_Label_Font'>" + n.Msg.getMsg("VIS_ShowAll") + "<\/label><\/span>"), a = t("<input id='btnOk_" + v + "' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 5px; float: right; margin-right: 15px ;' type='button' value='" + n.Msg.getMsg("OK") + "'>"), w = t("<input id='btnCancel_" + v + "' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 5px; float: right;margin-right: 0px;' type='button' value='" + n.Msg.getMsg("Cancel") + "'>"), tt = t("<div id='topdiv_" + v + "' style='float: left; width: 100%; height: 7%; text-align: right;'>"), ft = t("<div id='middeldiv_" + v + "' style='float: left; width: 100%; height: 79%;'>"), et = t("<div id='bottomdiv_" + v + "' style='float: left; width: 100%; height: 14%;'>"), pt = !1; n.Application.isRTL && (tt.css("text-align", "left"), a.css("margin-right", "-130px"), w.css("margin-right", "55px")); this.showDialog = function () { b.dialog({ modal: !0, title: ct, width: 600, height: 450, resizable: !1, close: function () { l.dispose(); l = null; b.dialog("destroy"); b = null } }); ot() }; this.disposeComponent = function () { a && a.off("click"); w && w.off("click"); a = null; w = null; v = null; this.onClose = null; st = null; it = null; d = null; rt = null; ht = null; ct = null; lt = null; this.arrListColumns = null; this.dGrid = null; vt = null; yt = null; ut = null; k = null; this.log = null; p = null; tt = null; ft = null; et = null; g = null; nt = null; y = null; this.disposeComponent = null }; bt(ht) } i.prototype.dispose = function () { this.disposeComponent() }; n.PAttributeInstance = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o) { function rt() { t.ajax({ url: n.Application.contextUrl + "GenralAttribute/Load", dataType: "json", async: !1, data: { mAttributeSetInstanceId: v, vadms_AttributeSet_ID: p, windowNo: h }, success: function (t) { if (returnValue = t.result, n.Env.getCtx().setContext(h, "VAB_GenFeatureSet_ID", p), returnValue.Error != null) { n.ADialog.error(returnValue.Error, null, null, null); return } s.html(returnValue.tableStucture); a = returnValue.ControlList.split(",") } }) } function ut() { for (var u = [], r, i = 0; i < a.length; i++)r = s.find("#" + a[i]), a[i].toString().contains("cmb") ? u.push({ Key: Number(r.find("option:selected").val()), Name: r.find("option:selected").text() }) : u.push({ Key: 0, Name: n.Utility.decodeText(r.val()) }); t.ajax({ url: n.Application.contextUrl + "GenralAttribute/Save", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ windowNoParent: w, mAttributeSetInstanceId: v, vadms_AttributeSet_ID: p, windowNo: h, lst: u }), success: function (n) { if (returnValue = n.result, l.onClose) l.onClose(returnValue.VAM_PFeature_SetInstance_ID, returnValue.VAM_PFeature_SetInstanceName) } }) } function ft() { for (var u = [], r, i = 0; i < a.length; i++)r = s.find("#" + a[i]), a[i].toString().contains("cmb") ? u.push({ Key: Number(r.find("option:selected").val()), Name: r.find("option:selected").text() }) : u.push({ Key: 0, Name: r.val() }); t.ajax({ url: n.Application.contextUrl + "GenralAttribute/SearchValues", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ windowNoParent: Number(w), mAttributeSetInstanceId: v, vadms_AttributeSet_ID: p, windowNo: h, lst: u }), success: function (n) { if (returnValue = n.result, l.onClose) { returnValue.VAM_PFeature_SetInstanceName == null && (returnValue.VAM_PFeature_SetInstanceName = returnValue.Description); l.onClose(returnValue.VAM_PFeature_SetInstance_ID, returnValue.VAM_PFeature_SetInstanceName, returnValue.GenSetInstance) } } }) } var l, s; this.onClose = null; l = this; s = t("<div>"); this.log = n.Logging.VLogger.getVLogger("GenralAttributeForm"); var h = n.Env.getWindowNo(), v = null, k = null, d = null, w = u, p = 0, g = !1, nt = 40, tt = o, it = {}, b = !1, c = null, y = null, a = null; this.log.config("VAB_GenFeatureSetInstance_ID=" + i); v = i; p = r; tt = o; b = f; rt(); c = s.find("#btnOk_" + h); y = s.find("#btnCancel_" + h); e ? (c.attr("disabled", !1), c.css("opacity", "1")) : (c.attr("disabled", !0), c.css("opacity", "0.6")); n.Application.isRTL && (c.css("margin-right", "-132px"), y.css("margin-right", "55px")); this.btnSelect = s.find("#btnSelect_" + h); this.txtDescription = s.find("#txtDescription_" + h); c.on("click", function () { b ? ft() : ut(); s.dialog("close") }); y.on("click", function () { s.dialog("close") }); this.showDialog = function () { s.dialog({ modal: !0, title: n.Msg.translate(n.Env.getCtx(), "VAB_GenFeatureSetInstance_ID"), width: 400, close: function () { l.dispose(); l = null; s.dialog("destroy"); s = null } }) }; this.disposeComponent = function () { c && c.off("click"); y && y.off("click"); n.Env.clearWinContext(n.Env.getCtx(), h); n.Env.getCtx().setContext(n.Env.WINDOW_INFO, n.Env.TAB_INFO, "VAM_PFeature_SetInstance_ID", v); c = null; y = null; mLocatorId = null; k = null; mProductId = null; d = null; adColumnId = null; w = null; productWindow = null; g = null; nt = 0; it = null; l = null; h = null; v = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.GenralAttributeForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function of(i, r, u) { var f = null; return i.sql = n.secureEngine.encrypt(i.sql), t.ajax({ url: rf, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: r, data: JSON.stringify(i) }).done(function (n) { f = n; u && u(n) }), f } function bu(n, i, r) { var u = null; return t.ajax({ url: nf, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } this.onClose = null; var ti = t("<div style='position:relative;'>"), ei = t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"), s = this, pu = i, oi = r, at = u, o = n.Env.getWindowNo(), wu = null, di = new n.Controls.VLabel, k = null, wt = null, d = null, nt = null, tt = null, g = null, it = null, rt = null, ut = null, ft = null, et = null, ot = null, st = null, ht = null, ct = null, lt = null, h = null, c = null, l = null, a = null, v = null, y = null, p = null, w = null, b = null, gi = null, nr = null, tr = null, ir = null, rr = null, ur = null, fr = null, er = null, or = null, sr = !1, hr = !1, cr = !1, lr = !1, ar = !1, vr = !1, yr = !1, pr = !1, wr = !1, br = n.Application.contextUrl, nf = br + "JsonData/JDataSetWithCode", tf = br + "JsonData/ExecuteNonQuer", rf = br + "Form/JDataSet", uf = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, bu(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, vt = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, bu(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, ff = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n, param: i }; return t.ajax({ url: tf + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }, ef = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, of(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; this.log = n.Logging.VLogger.getVLogger("AccountForm"); this.log.config("VAB_AccountBook_ID=" + at + ", VAB_Acct_ValidParameter_ID=" + oi.VAB_Acct_ValidParameter_ID); var sf = 181, kr = "AC", dr = "AY", gr = "BP", nu = "LF", tu = "LT", iu = "MC", ru = "OO", uu = "OT", fu = "PJ", eu = "PR", ou = "SA", su = "SR", hu = "U1", cu = "U2", si = "X1", hi = "X2", ci = "X3", li = "X4", ai = "X5", vi = "X6", yi = "X7", pi = "X8", wi = "X9", dt = t("<table>"); dt.css("width", "100%"); var bt = t("<tr>"), gt = null, ni = null, ri = null, ui = null, fi = null, lu = null, bi = null, ku = null, du = null, ki = null, gu = null, yt = null, hf = !1, au = null, ii = null, e = null, vu = null, yu = null, pt = null, kt = null; this.load = function () { ti.load(n.Application.contextUrl + "AccountForm/Index/?windowno=" + o, function () { s.setBusy(!0); s.init(ti); s.setBusy(!1) }) }; this.setBusy = function (n) { ei.css("display", n ? "block" : "none") }; this.init = function (i) { function br() { n.Env.getCtx().setContext(o, "VAB_AccountBook_ID", at); t.ajax({ url: n.Application.contextUrl + "AccountForm/LoadControls", dataType: "json", data: { windowNo: o, VAB_AccountBook_ID: at }, success: function (n) { returnValue = n.result; pu(returnValue); kt = returnValue } }) } function pu(i) { n.AEnv.getGridWindow(o, 153, function (r) { var ku, pu, du, wu, bu, kt, bt, ti, fi, ei, ui, ni, gu, au, yu; if (r.error != null) { n.ADialog.error(r.error); self.dispose(); self = null; return } if (ku = t.parseJSON(r.result), n.context.setContextOfWindow(t.parseJSON(r.wCtx), o), pu = new n.GridWindow(ku), pu != null) { for (e = pu.getTabs()[0], e.getField("Alias").setDisplayLength(15), e.getField("Combination").setDisplayLength(15), e.getField("VAF_Client_ID").setDisplayed(!1), e.getField("VAB_AccountBook_ID").setDisplayed(!1), e.getField("IsActive").setDisplayed(!1), e.getField("IsFullyQualified").setDisplayed(!1), kt = 0; kt < e.getFieldCount(); kt++)bt = e.getField(kt), bt.getIsDisplayed(!0) || bt.setDisplayed(!1); for (du = o + "_" + at, yt = new n.GridController(!1, !1, du), yt.initGrid(!0, o, s, e), yt.setVisible(!0), window.innerHeight > 700 ? yt.sizeChanged(window.innerHeight - 230, window.innerWidth) : yt.sizeChanged(window.innerHeight - 215, window.innerWidth), ki.append(yt.getRoot()), yt.activate(), i.IsHasAlies && (wu = e.getField("Alias"), k = n.VControlFactory.getControl(e, wu, !1), u(wu, k, !1)), bu = e.getField("Combination"), wt = n.VControlFactory.getControl(e, bu, !1), u(bu, wt, !1), kt = 0; kt < i.Elements.length; kt++) { var di = returnValue.Elements[kt].Type, gt = returnValue.Elements[kt].IsMandatory, br = returnValue.Elements[kt].IsHeavyData, ri = returnValue.Elements[kt].Name; if (di.equals(ru)) { bt = e.getField("VAF_Org_ID"); d = n.VControlFactory.getControl(e, bt, !1); u(bt, d, gt, ri, ru); d.fireValueChanged = nf; function nf() { var t = d.getValue(); n.Env.getCtx().setContext(o, "AcctOrg_ID", t) } } else if (di.equals(kr)) bt = e.getField("Account_ID"), nt = n.VControlFactory.getControl(e, bt, !1), nt.setValue(at), u(bt, nt, gt, ri, kr); else if (di.equals(ou)) bt = e.getField("VAB_SubAcct_ID"), tt = n.VControlFactory.getControl(e, bt, !1), u(bt, tt, gt, ri, ou); else if (di.equals(eu)) bt = e.getField("VAM_Product_ID"), g = n.VControlFactory.getControl(e, bt, !1), g.getBtn(), u(bt, g, gt, ri, eu); else if (di.equals(gr)) bt = e.getField("VAB_BusinessPartner_ID"), it = n.VControlFactory.getControl(e, bt, !1), u(bt, it, gt, ri, gr); else if (di.equals(iu)) bt = e.getField("VAB_Promotion_ID"), rt = n.VControlFactory.getControl(e, bt, !1), u(bt, rt, gt, ri, iu); else if (di.equals(nu)) bt = e.getField("C_LocFrom_ID"), ut = n.VControlFactory.getControl(e, bt, !1), u(bt, ut, gt, ri, nu); else if (di.equals(tu)) bt = e.getField("C_LocTo_ID"), ft = n.VControlFactory.getControl(e, bt, !1), u(bt, ft, gt, ri, tu); else if (di.equals(fu)) bt = e.getField("VAB_Project_ID"), et = n.VControlFactory.getControl(e, bt, !1), u(bt, et, gt, ri, fu); else if (di.equals(su)) bt = e.getField("VAB_SalesRegionState_ID"), ot = n.VControlFactory.getControl(e, bt, !1), u(bt, ot, gt, ri, su); else if (di.equals(uu)) bt = e.getField("VAF_OrgTrx_ID"), st = n.VControlFactory.getControl(e, bt, !1), u(bt, st, gt, ri, uu); else if (di.equals(dr)) bt = e.getField("VAB_BillingCode_ID"), ht = n.VControlFactory.getControl(e, bt, !1), u(bt, ht, gt, ri, dr); else if (di.equals(hu)) bt = e.getField("User1_ID"), ct = n.VControlFactory.getControl(e, bt, !1), u(bt, ct, gt, ri, hu); else if (di.equals(cu)) bt = e.getField("User2_ID"), lt = n.VControlFactory.getControl(e, bt, !1), u(bt, lt, gt, ri, cu); else if (di.equals(si)) if (bt = e.getField("UserElement1_ID"), i.Elements[kt].VAF_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@VAF_Column_ID", i.Elements[kt].VAF_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.Search); h = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, h, gt, ri, si); h.fireValueChanged = lu; function lu() { gi = h.getValue(); sr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.TableDir), h = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, h, gt, ri, si), sr = !1; else continue; else if (di.equals(hi)) if (bt = e.getField("UserElement2_ID"), i.Elements[kt].VAF_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@VAF_Column_ID", i.Elements[kt].VAF_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.Search); c = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, c, gt, ri, hi); c.fireValueChanged = lu; function lu() { nr = c.getValue(); hr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.TableDir), c = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, c, gt, ri, hi), hr = !1; else continue; else if (di.equals(ci)) if (bt = e.getField("UserElement3_ID"), i.Elements[kt].VAF_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@VAF_Column_ID", i.Elements[kt].VAF_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.Search); l = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, l, gt, ri, ci); l.fireValueChanged = lu; function lu() { tr = l.getValue(); cr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.TableDir), l = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, l, gt, ri, ci), cr = !1; else continue; else if (di.equals(li)) if (bt = e.getField("UserElement4_ID"), i.Elements[kt].VAF_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@VAF_Column_ID", i.Elements[kt].VAF_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.Search); a = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, a, gt, ri, li); a.fireValueChanged = lu; function lu() { ir = a.getValue(); lr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.TableDir), a = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, a, gt, ri, li), lr = !1; else continue; else if (di.equals(ai)) if (bt = e.getField("UserElement5_ID"), i.Elements[kt].VAF_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@VAF_Column_ID", i.Elements[kt].VAF_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.Search); v = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, v, gt, ri, ai); v.fireValueChanged = lu; function lu() { rr = v.getValue(); ar = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.TableDir), v = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, v, gt, ri, ai), ar = !1; else continue; else if (di.equals(vi)) if (bt = e.getField("UserElement6_ID"), i.Elements[kt].VAF_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@VAF_Column_ID", i.Elements[kt].VAF_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.Search); y = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, y, gt, ri, vi); y.fireValueChanged = lu; function lu() { ur = y.getValue(); vr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.TableDir), y = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, y, gt, ri, vi), vr = !1; else continue; else if (di.equals(yi)) if (bt = e.getField("UserElement7_ID"), i.Elements[kt].VAF_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@VAF_Column_ID", i.Elements[kt].VAF_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.Search); p = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, p, gt, ri, yi); p.fireValueChanged = lu; function lu() { fr = p.getValue(); yr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.TableDir), p = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, p, gt, ri, yi), yr = !1; else continue; else if (di.equals(pi)) if (bt = e.getField("UserElement8_ID"), i.Elements[kt].VAF_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@VAF_Column_ID", i.Elements[kt].VAF_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.Search); w = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, w, gt, ri, pi); w.fireValueChanged = lu; function lu() { er = w.getValue(); pr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.TableDir), w = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, w, gt, ri, pi), pr = !1; else continue; else if (di.equals(wi)) if (bt = e.getField("UserElement9_ID"), i.Elements[kt].VAF_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@VAF_Column_ID", i.Elements[kt].VAF_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.Search); b = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, b, gt, ri, wi); b.fireValueChanged = lu; function lu() { or = b.getValue(); wr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].VAF_Column_ID, n.DisplayType.TableDir), b = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, b, gt, ri, wi), wr = !1; else continue } pt.css("display", "none"); bi.html(dt); ii = new n.Query; ii.addRestriction("VAB_AccountBook_ID", n.Query.prototype.EQUAL, at); ui = "VIS_126"; ni = []; ni[0] = new n.DB.SqlParam("@tblID_s", f); gu = vt(ui, ni); gu == "VAGL_JRNLLine" && ii.addRestriction("IsFullyQualified", n.Query.prototype.EQUAL, "Y"); oi.VAB_Acct_ValidParameter_ID == 0 ? e.setQuery(n.Query.prototype.getEqualQuery("1", "2")) : (au = new n.Query, au.addRestriction("VAB_AccountBook_ID", n.Query.prototype.EQUAL, at), au.addRestriction("VAB_Acct_ValidParameter_ID", n.Query.prototype.EQUAL, oi.VAB_Acct_ValidParameter_ID), e.setQuery(au)); yt.query(0, 0, !1); vu.text(i.Description); yu = dt.find('[name="VAF_Org_ID"]'); window.setTimeout(function () { var r; ki.css("width", "73%"); bi.parent().css({ width: "27%", padding: "0 10px 0 0" }); var u = t(dt.find("button").parent().find("input")[0]).width(), i = []; if (i[0] = new n.DB.SqlParam("@tblID_s", f), r = vt("VIS_126", i), r == "VAGL_JRNLLine") yu.on("click", function () { yu.find("option[value=0]").length != 0 && yu.find("option[value=0]").remove() }) }, 200) } }) } function u(i, r, u, f, e) { var l, c, h, o; s.log.fine("Field=" + i); bt = t("<tr>"); dt.append(bt); l = n.VControlFactory.getLabel(i); r.setReadOnly(!1); r.setMandatory(u); i.setPropertyChangeListener(r); c = t("<td>"); bt.append(c.css("padding", "4px 0px 2px 0px")); c.append(l.getControl().addClass("VIS_Pref_Label_Font")); e != undefined && (e == "X1" || e == "X2" || e == "X3" || e == "X4" || e == "X5" || e == "X6" || e == "X7" || e == "X8" || e == "X9") && c.find("label").text(f); bt = t("<tr>"); dt.append(bt); h = t("<td>"); r.getBtnCount() >= 2 ? (bt.append(h), o = t("<Div class='vis-act-frm-parm'>"), h.append(o), window.innerHeight > 700 ? (o.append(r.getControl().css("width", "85%")), o.append(r.getBtn(0))) : (o.append(r.getControl().css("width", "85%")), o.append(r.getBtn(0).css("width", "30px").css("-webkit-appearance", "none").css("height", "30px").css("padding", "0px").css("border-color", "#BBBBBB")))) : (bt.append(h), h.append(r.getControl().css("width", "100%"))) } function r(n) { return n == null || n == 0 ? !0 : !1 } function wu() { if (au = e.getValue("VAB_Acct_ValidParameter_ID"), s.onClose) s.onClose(au); i.dialog("close") } function ti(t) { var i = null, u; i = ii != null ? jQuery.extend(!0, {}, ii) : new n.Query; t && k != null && k.getValue().toString().length > 0 && (u = k.getValue().toString().toUpperCase(), u.endsWith("%") || (u += "%"), i.addRestriction("UPPER(Alias)", i.LIKE, u)); t && wt.getValue().toString().length > 0 && (u = wt.getValue().toString().toUpperCase(), u.endsWith("%") || (u += "%"), i.addRestriction("UPPER(Combination)", i.LIKE, u)); d != null && d.getValue() != null && i.addRestriction("VAF_Org_ID", i.EQUAL, n.Utility.Util.getValueOfInt(d.getValue())); nt == null || r(nt.getValue()) || i.addRestriction("Account_ID", i.EQUAL, n.Utility.Util.getValueOfInt(nt.getValue())); tt == null || r(tt.getValue()) || i.addRestriction("VAB_SubAcct_ID", i.EQUAL, n.Utility.Util.getValueOfInt(tt.getValue())); g == null || r(g.getValue()) || i.addRestriction("VAM_Product_ID", i.EQUAL, n.Utility.Util.getValueOfInt(g.getValue())); it == null || r(it.getValue()) || i.addRestriction("VAB_BusinessPartner_ID", i.EQUAL, n.Utility.Util.getValueOfInt(it.getValue())); rt == null || r(rt.getValue()) || i.addRestriction("VAB_Promotion_ID", i.EQUAL, n.Utility.Util.getValueOfInt(rt.getValue())); ut == null || r(ut.getValue()) || i.addRestriction("C_LocFrom_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ut.getValue())); ft == null || r(ft.getValue()) || i.addRestriction("C_LocTo_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ft.getValue())); et == null || r(et.getValue()) || i.addRestriction("VAB_Project_ID", i.EQUAL, n.Utility.Util.getValueOfInt(et.getValue())); ot == null || r(ot.getValue()) || i.addRestriction("VAB_SalesRegionState_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ot.getValue())); st == null || r(st.getValue()) || i.addRestriction("VAF_OrgTrx_ID", i.EQUAL, n.Utility.Util.getValueOfInt(st.getValue())); ht == null || r(ht.getValue()) || i.addRestriction("VAB_BillingCode_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ht.getValue())); ct == null || r(ct.getValue()) || i.addRestriction("User1_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ct.getValue())); lt == null || r(lt.getValue()) || i.addRestriction("User2_ID", i.EQUAL, n.Utility.Util.getValueOfInt(lt.getValue())); h == null || r(h.getValue()) || i.addRestriction("UserElement1_ID", i.EQUAL, n.Utility.Util.getValueOfInt(h.getValue())); c == null || r(c.getValue()) || i.addRestriction("UserElement2_ID", i.EQUAL, n.Utility.Util.getValueOfInt(c.getValue())); l == null || r(l.getValue()) || i.addRestriction("UserElement3_ID", i.EQUAL, n.Utility.Util.getValueOfInt(l.getValue())); a == null || r(a.getValue()) || i.addRestriction("UserElement4_ID", i.EQUAL, n.Utility.Util.getValueOfInt(a.getValue())); v == null || r(v.getValue()) || i.addRestriction("UserElement5_ID", i.EQUAL, n.Utility.Util.getValueOfInt(v.getValue())); y == null || r(y.getValue()) || i.addRestriction("UserElement6_ID", i.EQUAL, n.Utility.Util.getValueOfInt(y.getValue())); p == null || r(p.getValue()) || i.addRestriction("UserElement7_ID", i.EQUAL, n.Utility.Util.getValueOfInt(p.getValue())); w == null || r(w.getValue()) || i.addRestriction("UserElement8_ID", i.EQUAL, n.Utility.Util.getValueOfInt(w.getValue())); b == null || r(b.getValue()) || i.addRestriction("UserElement9_ID", i.EQUAL, n.Utility.Util.getValueOfInt(b.getValue())); e.setQuery(i); yt.query(0, 0, !1) } function bu() { k != null && k.setValue(""); wt.setValue(""); di.Content = ""; di.Visible = !1; pt.val(""); d.setValue(null); nt.setValue(null); tt != null && tt.setValue(null); g != null && g.setValue(null); it != null && it.setValue(null); rt != null && rt.setValue(null); ut != null && ut.setValue(null); ft != null && ft.setValue(null); et != null && et.setValue(null); ot != null && ot.setValue(null); st != null && st.setValue(null); ht != null && ht.setValue(null); ct != null && ct.setValue(null); lt != null && lt.setValue(null); h != null && h.setValue(null); c != null && c.setValue(null); l != null && l.setValue(null); a != null && a.setValue(null); v != null && v.setValue(null); y != null && y.setValue(null); p != null && p.setValue(null); w != null && w.setValue(null); b != null && b.setValue(null) } function nf() { var o = null, u = "", ui = null, fi, br, yt, vt, si, hi, ci, li, ai, vi, yi, pi, wi, bi, ki, di, pt, wt, bt, dt, gt, ni, ti, ii, ri, kr, dr; for (kt.IsHasAlies && (ui = k.getValue(), ui == null && o != null && (o = o.concat(n.Msg.translate(n.Env.getCtx(), "Alias")).concat(", "))), fi = [], vt = 0; vt < kt.Elements.length; vt++)br = kt.Elements[vt], fi.push(br.Name); if (t.ajax({ url: n.Application.contextUrl + "Form/GetValidCombination", dataType: "json", type: "POST", async: !1, data: { accountSchemaElements: JSON.stringify(kt), Elements: JSON.stringify(kt.Elements), aseList: JSON.stringify(fi), value: ui, strinB: o }, success: function (n) { u = n }, error: function (n) { console.log(n) } }), o != null) { n.ADialog.info("FillMandatory", !0, o.ToString().Substring(0, o.Length - 2), null); return } if (d == null || d.getValue() == null) { n.ADialog.info("FillMandatory", !0, n.Msg.getElement(n.Env.getCtx(), "VAF_Org_ID"), null); return } if (nt == null || r(nt.getValue())) { n.ADialog.info("FillMandatory", !0, n.Msg.getElement(n.Env.getCtx(), "Account_ID"), null); s.setBusy(!1); return } u = u.concat("VAF_Client_ID=" + n.Env.getCtx().getVAF_Client_ID() + " AND VAB_AccountBook_ID=" + at); s.log.fine("Check = " + u.toString()); var gr = k.getValue().toString(), f = 0, e = null, oi = k.getValue().toString(), i = null; try { i = ef(u, null); i.read() && (f = i.tables[0].rows[0].cells.VAB_Acct_ValidParameter_id, e = i.tables[0].rows[0].cells.alias); i.close(); i = null } catch (nu) { f = 0; i != null && (i.close(), i = null) } if (s.log.fine("ID=" + f + ", Alias=" + e), e == null && (e = ""), f != 0 && kt.IsHasAlies && oi.equals(e)) { yt = []; oi.toString().length == 0 ? (u = "VIS_127", yt[0] = new n.DB.SqlParam("@IDvalue", f)) : (u = "VIS_128", yt[0] = new n.DB.SqlParam("@f_alies", oi), yt[1] = new n.DB.SqlParam("@IDvalue", f)); vt = 0; try { ff(u, yt) } catch (nu) { } } if (f != 0) { ei(f, at); return } s.log.config("New"); e = null; k != null && (e = k.getValue().toString()); si = 0; tt != null && tt.getValue() != null && (si = tt.getValue()); hi = 0; g == null || r(g.getValue()) || (hi = g.getValue()); ci = 0; it == null || r(it.getValue()) || (ci = it.getValue()); li = 0; st == null || r(st.getValue()) || (li = st.getValue()); ai = 0; ut == null || r(ut.getValue()) || (ai = ut.getValue()); vi = 0; ft == null || r(ft.getValue()) || (vi = ft.getValue()); yi = 0; ot == null || r(ot.getValue()) || (yi = ot.getValue()); pi = 0; et == null || r(et.getValue()) || (pi = et.getValue()); wi = 0; rt == null || r(rt.getValue()) || (wi = rt.getValue()); bi = 0; ht == null || r(ht.getValue()) || (bi = ht.getValue()); ki = 0; ct == null || r(ct.getValue()) || (ki = ct.getValue()); di = 0; lt == null || r(lt.getValue()) || (di = lt.getValue()); pt = 0; h == null || r(h.getValue()) || (pt = h.getValue()); wt = 0; c == null || r(c.getValue()) || (wt = c.getValue()); bt = 0; l == null || r(l.getValue()) || (bt = l.getValue()); dt = 0; a == null || r(a.getValue()) || (dt = a.getValue()); gt = 0; v == null || r(v.getValue()) || (gt = v.getValue()); ni = 0; y == null || r(y.getValue()) || (ni = y.getValue()); ti = 0; p == null || r(p.getValue()) || (ti = p.getValue()); ii = 0; w == null || r(w.getValue()) || (ii = w.getValue()); ri = 0; b == null || r(b.getValue()) || (ri = b.getValue()); kr = d.getValue(); dr = nt.getValue(); sr && gi != null && (pt = gi); hr && nr != null && (wt = nr); cr && tr != null && (bt = tr); lr && ir != null && (dt = ir); ar && rr != null && (gt = rr); vr && ur != null && (ni = ur); yr && fr != null && (ti = fr); pr && er != null && (ii = er); wr && or != null && (ri = or); t.ajax({ url: n.Application.contextUrl + "AccountForm/Save", dataType: "json", data: { VAF_Client_ID: n.Env.getCtx().getVAF_Client_ID(), VAF_Org_ID: kr, VAB_AccountBook_ID: at, AD_Account_ID: dr, VAB_SubAcct_ID: si, VAM_Product_ID: hi, VAB_BusinessPartner_ID: ci, VAF_OrgTrx_ID: li, C_LocFrom_ID: ai, C_LocTo_ID: vi, C_SRegion_ID: yi, VAB_Project_ID: pi, VAB_Promotion_ID: wi, VAB_BillingCode_ID: bi, User1_ID: ki, User2_ID: di, UserElement1_ID: pt, UserElement2_ID: wt, UserElement3_ID: bt, UserElement4_ID: dt, UserElement5_ID: gt, UserElement6_ID: ni, UserElement7_ID: ti, UserElement8_ID: ii, UserElement9_ID: ri, Alias: e }, success: function (n) { returnValue = n.result; ei(returnValue.VAB_Acct_ValidParameter_ID, returnValue.VAB_AccountBook_ID) } }) } function ei(t, i) { var r = null, u; try { u = []; u[0] = new n.DB.SqlParam("@VAB_Acct_ValidParameter_ID", t); u[1] = new n.DB.SqlParam("@VAB_AccountBook_ID", i); r = uf("VIS_124", u); r.read() && (k != null && k.setValue(r.getString("Alias")), wt != null && wt.setValue(r.getString("Combination")), d != null && d.setValue(r.getInt("VAF_Org_ID")), nt != null && nt.setValue(r.getInt("Account_ID")), tt != null && tt.setValue(r.getInt("VAB_SubAcct_ID")), g != null && r.getInt("VAM_Product_ID") != 0 && g.setValue(r.getInt("VAM_Product_ID")), it != null && r.getInt("VAB_BusinessPartner_ID") != 0 && it.setValue(r.getInt("VAB_BusinessPartner_ID")), rt != null && rt.setValue(r.getInt("VAB_Promotion_ID")), ut != null && ut.setValue(r.getInt("C_LocFrom_ID")), ft != null && ft.setValue(r.getInt("C_LocTo_ID")), et != null && et.setValue(r.getInt("VAB_Project_ID")), ot != null && ot.setValue(r.getInt("VAB_SalesRegionState_ID")), st != null && st.setValue(r.getInt("VAF_OrgTrx_ID")), ht != null && ht.setValue(r.getInt("VAB_BillingCode_ID")), ct != null && ct.setValue(r.getInt("User1_ID")), lt != null && lt.setValue(r.getInt("User2_ID")), h != null && r.getInt("UserElement1_ID") != 0 && h.setValue(r.getInt("UserElement1_ID")), c != null && r.getInt("UserElement2_ID") != 0 && c.setValue(r.getInt("UserElement2_ID")), l != null && r.getInt("UserElement3_ID") != 0 && l.setValue(r.getInt("UserElement3_ID")), a != null && r.getInt("UserElement4_ID") != 0 && a.setValue(r.getInt("UserElement4_ID")), v != null && r.getInt("UserElement5_ID") != 0 && v.setValue(r.getInt("UserElement5_ID")), y != null && r.getInt("UserElement6_ID") != 0 && y.setValue(r.getInt("UserElement6_ID")), p != null && r.getInt("UserElement7_ID") != 0 && p.setValue(r.getInt("UserElement7_ID")), w != null && r.getInt("UserElement8_ID") != 0 && w.setValue(r.getInt("UserElement8_ID")), b != null && r.getInt("UserElement9_ID") != 0 && b.setValue(r.getInt("UserElement9_ID")), pt != null && pt.text(r.getString("Description"))); r.close(); r = null } catch (f) { r != null && (r.close(), r = null) } ti(!1) } gt = i.find("#btnOk_" + o); ni = i.find("#btnCancel_" + o); ri = i.find("#btnRefresh_" + o); ui = i.find("#btnUndo_" + o); fi = i.find("#btnSave_" + o); lu = i.find("#lblParameter_" + o); bi = i.find("#parameterDiv_" + o); ku = i.find("#bottumDiv_" + o); du = i.find("#discriptionDiv_" + o); ki = i.find("#accDiv_" + o); gu = i.find("#acctbl_" + o); vu = i.find("#lblbottumMsg_" + o); yu = i.find("#lblCount_" + o); pt = i.find("#lblbottumMsg2_" + o); n.Application.isRTL && (gt.css("margin-right", "-128px"), ni.css("margin-right", "55px")); gt.val(n.Msg.getMsg("OK")); ni.val(n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Cancel"))); lu.val(n.Msg.getMsg("Parameter")); br(); gt.on("click", function () { s.setBusy(!0); wu(); s.setBusy(!1) }); ni.on("click", function () { i.dialog("close") }); ri.on("click", function () { s.setBusy(!0); ti(!0); s.setBusy(!1) }); ui.on("click", function () { bu() }); fi.on("click", function () { s.setBusy(!0); nf(); s.setBusy(!1) }) }; this.showDialog = function () { var n = t(window).width() - 50, i = t(window).height() - 60; ei.height(i); ei.width(n); ti.append(ei); ti.dialog({ modal: !1, resizable: !1, title: pu, width: n, height: i, position: { at: "center top", of: window }, close: function () { s.dispose(); ti.dialog("destroy"); ti = null; s = null } }) }; this.dataStatusChanged = function (n) { var t = e.getValue("Description"); wu = e.getValue("COMBINATION"); t != null && t.length > 0 ? pt.css("display", "inline-block") : pt.css("display", "none"); pt.text(t); yu.text(n.totalRecords) }; this.disposeComponent = function () { gt && gt.off("click"); ni && ni.off("click"); ri && ri.off("click"); ui && ui.off("click"); fi && fi.off("click"); pu = null; oi = null; at = null; o = null; wu = null; di = null; k = null; wt = null; d = null; nt = null; tt = null; g = null; it = null; rt = null; ut = null; ft = null; et = null; ot = null; st = null; ht = null; ct = null; lt = null; this.log = null; sf = null; kr = null; dr = null; gr = null; nu = null; tu = null; iu = null; ru = null; uu = null; fu = null; eu = null; ou = null; su = null; hu = null; cu = null; si = null; hi = null; ci = null; li = null; ai = null; vi = null; yi = null; pi = null; wi = null; dt = null; bt = null; gt = null; ni = null; ri = null; ui = null; fi = null; lu = null; bi = null; ku = null; du = null; ki = null; gu = null; yt = null; hf = !1; au = null; ii = null; e = null; vu = null; yu = null; pt = null; kt = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.AccountForm = i }(VIS, jQuery), function (n, t) { function i() { function di() { var d, wt, e, r; h = t("<label id='lblReportQ_" + i.windowNo + "' class='vis-ec-col-lblchkbox'><input id='chkReportQ_" + i.windowNo + "' type='checkbox' style='margin-left: 0px;' class='VIS_Pref_automatic'>" + n.Msg.translate(n.Env.getCtx(), "IsReport") + "<\/label>"); bt = new n.Controls.VLabel; y = new n.Controls.VLabel; kt = new n.Controls.VLabel; dt = new n.Controls.VLabel; gt = new n.Controls.VLabel; ni = new n.Controls.VLabel; ti = new n.Controls.VLabel; ii = new n.Controls.VLabel; d = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 0, n.DisplayType.Search, "VAB_BusinessPartner_ID", 0, !1, null); ft = new n.Controls.VTextBoxButton("VAB_BusinessPartner_ID", !1, !1, !0, n.DisplayType.Search, d); p = new n.Controls.VComboBox("", !1, !1, !0); o = new n.Controls.VComboBox("", !1, !1, !0); et = new n.Controls.VTextBox("NameQ", !1, !1, !0, 50, 50, "NameQ"); ot = new n.Controls.VTextBox("DescriptionQ", !1, !1, !0, 50, 50, "DescriptionQ"); st = new n.Controls.VTextBox("CommentQ", !1, !1, !0, 50, 50, "CommentQ"); et.getControl().val("%%"); ot.getControl().val("%%"); st.getControl().val("%%"); w = new n.Controls.VComboBox("", !1, !1, !0); ri = t("<input id='dtpCreatedFromQ_" + i.windowNo + "' type='date'>"); ui = t("<input id='dtpCreatedToQ_" + i.windowNo + "' type='date'>"); fi = new n.Controls.VLabel; ei = new n.Controls.VLabel; oi = new n.Controls.VLabel; si = new n.Controls.VLabel; hi = new n.Controls.VLabel; ht = new n.Controls.VTextBox("CreatedBy", !1, !0, !0, 50, 50, "CreatedBy"); g = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 50, "Name"); nt = new n.Controls.VTextBox("Description", !1, !1, !0, 50, 50, "Description"); tt = new n.Controls.VTextArea("Comment", !1, !1, !0, 200, 200); ct = t("<input id='dtpCreatedOn_" + i.windowNo + "' readonly class='vis-gc-vpanel-table-readOnly'>"); lt = new n.Controls.VLabel; s = t("<input id='btnOk_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' style=' margin-top: 0px; margin-right: 0px;' type='button' value='Ok'>"); it = t("<input id='btnSave_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin-top: 0px;float: right;' type='button' value='Save'>"); at = t("<input id='btnNext_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin: 10px; display: none;'  type='button' value='>>'>"); vt = t("<input id='btnPre_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin: 10px; display: none;' type='button' value='<<'>"); it.val(n.Msg.getMsg("Save")); s.val(n.Msg.getMsg("OK")); wt = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; f = t("<div class='vis-archive-left-sidebar' id='topLeftDiv_" + i.windowNo + "'><div id='topToggalDiv_" + i.windowNo + "' class='vis-archive-l-s-head'><button id='btnToggal_" + i.windowNo + "' class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>"); this.btnToggal = f.find("#btnToggal_" + i.windowNo); u = t("<div class='vis-archive-l-s-content vis-leftsidebarouterwrap' id='topleftparaDiv_" + i.windowNo + "'>"); ci = t("<div  class='vis-archive-l-s-content-inner' id='topleftInnerParaDiv_" + i.windowNo + "'>"); u.append(ci); f.append(u); f.css("width", l); var b = t("<table style='width: 100%' class='vis-formouterwrpdiv'>"), v = t("<tr>"), a = t("<td style='padding: 0px 10px 0px;'>"), e = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); ci.append(b); b.append(v); v.append(a); a.append(e); e.append(r); r.append(h); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); var e = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'), rt = t('<div class="input-group-append">'); b.append(v); v.append(a); a.append(e); e.append(r); e.append(rt); r.append(ft.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ").addClass("VIS-Search-hide")); rt.append(ft.getBtn(0).addClass("VIS-Search-hide")); r.append(bt.getControl().addClass("VIS-Search-hide").addClass("VIS_Pref_Label_Font")); r.append(o.getControl()); r.append(y.getControl().addClass("VIS_Pref_Label_Font")); y.getControl().hide(); o.getControl().hide(); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(p.getControl()); r.append(kt.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(et.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(dt.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(ot.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(gt.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(st.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(ni.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(w.getControl()); r.append(ti.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(ri); r.append(ii.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(ui); li = t("<div class='vis-frm-bot-btn-wrp' id='leftBottomDiv_" + i.windowNo + "'>"); f.append(li); li.append(s); c = t("<div id='topRightDiv_" + i.windowNo + "' class='vis-frm-grid-wrap'>"); yt = t("<div id='rightTopDiv_" + i.windowNo + "' style='float: left; width: 100%; height: 55%;'>"); pt = t("<div id='rightBottomDiv_" + i.windowNo + "' style='float: left; width: 100%;margin-top: 5px; margin-bottom: 10px; '>"); yt.css("height", "calc(100% - 274px)"); pt.css("height", ki); b = t("<table style='width: 100%; ' class='vis-formouterwrpdiv'>"); v = t("<tr>"); a = t("<td colspan='4' style='text-align: right; height: 10px;'>"); pt.append(b); b.append(v); v.append(a); a.append(vt).append(lt.getControl().css("display", "inline-block").css("margin-top", "20px").css("margin-right", "10px").css("margin-left", "10px").addClass("VIS_Pref_Label_Font")).append(at); lt.getControl().css("display", "none"); v = t("<tr>"); a = t("<td colspan='2' class='VIS-archive-table-padding'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(ht.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(fi.getControl().addClass("VIS_Pref_Label_Font")); a = t("<td colspan='2' class='VIS-archive-table-padding'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(ct.addClass("VIS_Pref_Label_Font")); r.append(ei.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td colspan='2' class='VIS-archive-table-padding'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(g.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(oi.getControl().addClass("VIS_Pref_Label_Font")); a = t("<td colspan='2' class='VIS-archive-table-padding'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(nt.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(si.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td colspan='4' class='VIS-archive-table-padding'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(tt.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(hi.getControl().addClass("VIS_Pref_Label_Font")); ai = t("<div style='float: left; width: 100%;height: 40px;position: relative;' id='rightBottomSaveDiv_" + i.windowNo + "'>"); ai.append(it); c.append(yt).append(pt).append(ai); ut.append(k); ut.append(f).append(c) } function gi() { y.getControl().text(n.Msg.translate(n.Env.getCtx(), "VAF_Job_ID")); kt.getControl().text(n.Msg.translate(n.Env.getCtx(), "VAF_TableView_ID")); bt.getControl().text(n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID")); dt.getControl().text(n.Msg.translate(n.Env.getCtx(), "Name")); gt.getControl().text(n.Msg.translate(n.Env.getCtx(), "Description")); ni.getControl().text(n.Msg.translate(n.Env.getCtx(), "Help")); ti.getControl().text(n.Msg.translate(n.Env.getCtx(), "CreatedBy")); ii.getControl().text(n.Msg.translate(n.Env.getCtx(), "Created")); fi.getControl().text(n.Msg.translate(n.Env.getCtx(), "CreatedBy")); ei.getControl().text(n.Msg.translate(n.Env.getCtx(), "Created")); oi.getControl().text(n.Msg.translate(n.Env.getCtx(), "Name")); si.getControl().text(n.Msg.translate(n.Env.getCtx(), "Description")); hi.getControl().text(n.Msg.translate(n.Env.getCtx(), "Help")); lt.getControl().text(n.Msg.translate(n.Env.getCtx(), "NoRecordFound")) } function nr() { for (var e = n.context.getVAF_Role_ID(), i = !0, r = "SELECT DISTINCT p.VAF_Job_ID, p.Name FROM VAF_Job p INNER JOIN VAF_Job_Rights pa ON (p.VAF_Job_ID=pa.VAF_Job_ID) WHERE pa.VAF_Role_ID=" + e + " AND p.IsReport='Y' AND p.IsActive='Y' AND pa.IsActive='Y' ORDER BY 2", t = n.DB.executeReader(r.toString(), null), u, f; t.read();)u = n.Utility.Util.getValueOfInt(t.getString(0)), f = n.Utility.encodeText(t.getString(1)), i && (o.getControl().append(" <option><\/option>"), i = !1), o.getControl().append(" <option value=" + u + ">" + f + "<\/option>"); for (t.close(), i = !0, o.getControl().prop("selectedIndex", 0), r = "SELECT DISTINCT t.VAF_TableView_ID, t.Name FROM VAF_TableView t INNER JOIN VAF_Tab tab ON (tab.VAF_TableView_ID=t.VAF_TableView_ID) INNER JOIN VAF_Screen_Rights wa ON (tab.VAF_Screen_ID=wa.VAF_Screen_ID) WHERE wa.VAF_Role_ID=" + e + " AND t.IsActive='Y' AND tab.IsActive='Y' ORDER BY 2", t = n.DB.executeReader(r.toString(), null); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(0)), f = n.Utility.encodeText(t.getString(1)), i && (p.getControl().append(" <option><\/option>"), i = !1), p.getControl().append(" <option value=" + u + ">" + f + "<\/option>"); for (t.close(), i = !0, p.getControl().prop("selectedIndex", 0), r = "SELECT VAF_UserContact_ID, Name FROM VAF_UserContact u WHERE EXISTS (SELECT * FROM VAF_UserContact_Roles ur WHERE u.VAF_UserContact_ID=ur.VAF_UserContact_ID) ORDER BY 2", r = n.MRole.getDefault().addAccessSQL(r, "VAF_UserContact", n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RW), t = n.DB.executeReader(r.toString(), null); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(0)), f = n.Utility.encodeText(t.getString(1)), i && (w.getControl().append(" <option><\/option>"), i = !1), w.getControl().append(" <option value=" + u + ">" + f + "<\/option>"); t.close(); i = !0; w.getControl().prop("selectedIndex", 0); a > 0 && (h.find("input").prop("checked", !0), wt()) } function wt() { var t = "", l = h.find("input").prop("checked"), b = null, u, y, r, e, f, s, c; b = n.MRole.getDefault(); try { if (!b.getIsCanReport()) { i.log.warning("User/Role cannot Report VAF_UserContact_ID=" + n.context.getVAF_UserContact_ID()); return } t = t.concat(" AND IsReport=").concat(l ? "'Y'" : "'N'"); l && (u = o.getControl().find("option:selected").val(), u != "" && u != null && (t = t.concat(" AND VAF_Job_ID=").concat(u))); a > 0 ? (t = t.concat(" AND ((VAF_TableView_ID=").concat(a), v > 0 && (t = t.concat(" AND Record_ID=").concat(v)), t = t.concat(")"), a == X_VAB_BusinessPartner.Table_ID && v > 0 && (t = t.concat(" OR VAB_BusinessPartner_ID=").concat(v)), t = t.concat(")"), a = 0, v = 0) : (u = p.getControl().find("option:selected").val(), u != "" && u != null && (t = t.concat(" AND VAF_TableView_ID=").concat(u))); l || (y = ft.getValue(), t = y != null ? t.concat(" AND VAB_BusinessPartner_ID=").concat(y) : t.concat(" AND VAB_BusinessPartner_ID IS NOT NULL")); r = et.getControl().val(); r != null && r != "%%" && r.length > 0 && (t = r.indexOf("%") != -1 || r.indexOf("_") != -1 ? t.concat(" AND LOWER(Name) LIKE LOWER( ").concat("'").concat(r).concat("')") : t.concat(" AND LOWER(Name)= LOWER(").concat("'").concat(r).concat("')")); r = ot.getControl().val(); r != null && r != "%%" && r.length > 0 && (t = r.indexOf("%") != -1 || r.indexOf("_") != -1 ? t.concat(" AND LOWER(Description) LIKE LOWER( ").concat("'").concat(r).concat("')") : t.concat(" AND LOWER(Description)= LOWER(").concat("'").concat(r).concat("')")); r = st.getControl().val(); r != null && r != "%%" && r.length > 0 && (t = r.indexOf("%") != -1 || r.indexOf("_") != -1 ? t.concat(" AND LOWER(Help) LIKE LOWER( ").concat("'").concat(r).concat("')") : t.concat(" AND LOWER(Help)= LOWER(").concat("'").concat(r).concat("')")); e = w.getControl().find("option:selected").val(); e != null && e > 0 && (t = t.concat(" AND CreatedBy=").concat(e)); f = ri.val(); f != "" && (t = t.concat(" AND Created>=").concat(n.DB.to_date(f))); f = ui.val(); f != "" && (t = t.concat(" AND Created<").concat(n.DB.to_date(f))); i.log.fine(t.toString()); t = t.concat(" AND (VAF_Job_ID IS NULL OR VAF_Job_ID IN (SELECT VAF_Job_ID FROM VAF_Job_Rights WHERE VAF_Role_ID=").concat(n.context.getVAF_Role_ID()).concat("))"); t = t.concat(" AND (VAF_TableView_ID IS NULL OR (VAF_TableView_ID IS NOT NULL AND VAF_Job_ID IS NOT NULL) OR VAF_TableView_ID IN (SELECT t.VAF_TableView_ID FROM VAF_Tab t INNER JOIN VAF_Screen_Rights wa ON (t.VAF_Screen_ID=wa.VAF_Screen_ID) WHERE wa.VAF_Role_ID=").concat(n.context.getVAF_Role_ID()).concat("))"); i.log.finest(t.toString()) } catch (k) { } s = t; c = "SELECT VAF_ARCHIVE_ID,VAF_CLIENT_ID,VAF_ORG_ID,VAF_JOB_ID,VAF_TABLEVIEW_ID,VAB_BUSINESSPARTNER_ID,CREATED,CREATEDBY,DESCRIPTION,HELP, ISACTIVE,ISREPORT,NAME,RECORD_ID,UPDATED,UPDATEDBY,EXPORT_ID FROM VAF_Archive WHERE VAF_Client_ID=" + n.Env.getCtx().getVAF_Client_ID(); s != null && s.length > 0 && (c += s); c += " ORDER BY Created desc"; fr(c) } function pi(n, t) { return n == null ? t == null : t == null ? !1 : n.equals(t) } function tr() { var u; if (!(r.getSelection().length < 0)) { var f = g.getControl().val(), e = nt.getControl().val(), o = tt.getControl().val(), i = Number(r.getSelection().toString()); r.get(i) != null && (u = !1, pi(f, r.get(i).NAME) || f != null && f.length > 0 && (u = !0), pi(e, r.get(i).DESCRIPTION) || (u = !0), pi(o, r.get(i).HELP) || (u = !0), d = r.get(i).VAF_ARCHIVE_ID, u && t.ajax({ url: n.Application.contextUrl + "Common/UpdateArchive", dataType: "json", data: { name: f, des: e, help: o, archiveId: d }, success: function (n) { n.result && wt() } })) } } function wi(u) { r != null && (r.destroy(), r = null); e.length == 0 && (e.push({ field: "NAME", caption: n.Msg.translate(n.Env.getCtx(), "NAME"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "DESCRIPTION", caption: n.Msg.translate(n.Env.getCtx(), "DESCRIPTION"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "HELP", caption: n.Msg.getElement(n.Env.getCtx(), "HELP"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "CREATEDBY", caption: n.Msg.getElement(n.Env.getCtx(), "CREATEDBY"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "CREATED", caption: n.Msg.getElement(n.Env.getCtx(), "CREATED"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "View", caption: n.Msg.translate(n.Env.getCtx(), "View"), sortable: !0, size: "80px", min: 150, hidden: !1, render: function () { return '<div><i class="vis vis-download" title="View record" style="opacity: 1; font-size: 1rem"><\/i><\/div>' } }), e.push({ field: "VAF_ARCHIVE_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAF_ARCHIVE_ID"), hidden: !0 })); setTimeout(10); w2utils.encodeTags(u); r = t(yt).w2grid({ name: "gridArchive" + i.windowNo, recordHeight: 40, columns: e, records: u, onClick: function (n) { n.column == 5 && r.records.length > 0 && ir(n.recid); rr(n.recid) } }) } function ir(i) { d = r.get(i).VAF_ARCHIVE_ID; t.ajax({ url: n.Application.contextUrl + "Common/DownloadPdf", dataType: "json", data: { archiveId: d }, success: function (t) { t.result != null && (t.result.indexOf("TempDownload") > -1 ? window.open(n.Application.contextUrl + t.result) : window.open("data:application/pdf;base64, " + t.result)) } }) } function rr(n) { g.getControl().val(r.get(n).NAME); nt.getControl().val(r.get(n).DESCRIPTION); tt.getControl().val(r.get(n).HELP); ht.getControl().val(r.get(n).CREATEDBY); r.get(n).CREATED != null && ct.val(r.get(n).CREATED); d = r.get(n).VAF_ARCHIVE_ID } function ur(t) { var r = "", u = "SELECT Name FROM VAF_UserContact WHERE VAF_UserContact_ID=" + t, i; try { i = n.DB.executeReader(u.toString(), null, null); i.read() && (r = i.getString("Name")); i.close() } catch (f) { } return r } function fr(t) { var u = [], i, f, r, e, o; try { for (i = n.DB.executeReader(t.toString(), null, null), f = 1; i.read();)r = {}, r.NAME = i.getString("NAME"), r.DESCRIPTION = i.getString("DESCRIPTION"), r.HELP = i.getString("HELP"), r.CREATEDBY = ur(i.getString("CREATEDBY")), e = i.getString("CREATED"), o = new Date(e), CreatedOn = o.toLocaleDateString(), r.CREATED = CreatedOn, r.VAF_ARCHIVE_ID = i.getInt("VAF_ARCHIVE_ID"), r.recid = f, f++, u.push(r); i.close() } catch (s) { } return wi(u), u } function er() { g.getControl().val(""); nt.getControl().val(""); tt.getControl().val(""); ht.getControl().val(""); ct.val(null) } function or() { if (s != null) s.on(n.Events.onTouchStartOrClick, function () { k[0].style.visibility = "visible"; wt(); er(); k[0].style.visibility = "hidden" }); if (it != null) it.on(n.Events.onTouchStartOrClick, function () { k[0].style.visibility = "visible"; tr(); k[0].style.visibility = "hidden" }); if (at != null) at.on(n.Events.onTouchStartOrClick, function () { alert("btnNext") }); if (vt != null) vt.on(n.Events.onTouchStartOrClick, function () { alert("btnPre") }); if (this.btnToggal != null) this.btnToggal.on(n.Events.onTouchStartOrClick, function () { rt ? (btnToggal.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), rt = !1, f.animate({ width: l }, "slow"), u.animate({ width: l }, "slow"), u.find("table").css("display", "block"), s.css("display", "block"), c.animate({ width: vi }, "slow", null, function () { r.resize() })) : (btnToggal.animate({ borderSpacing: 180 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), rt = !0, f.animate({ width: b }, "slow"), u.animate({ width: b }, "slow"), u.find("table").css("display", "none"), s.css("display", "none"), c.animate({ width: yi }, "slow", null, function () { r.resize() })) }); h.change(function () { o.getControl().hide(); y.getControl().hide(); t(".VIS-Search-hide").show(); h.find("input").prop("checked") && (o.getControl().show(), y.getControl().show(), t(".VIS-Search-hide").hide()) }) } this.log = n.Logging.VLogger.getVLogger("VIS.ArchiveViewer"); this.frame; this.windowNo; var a = 0, v = 0, i = this, rt = !1, ut = t("<div class='vis-forms-container' style='width: 100%; height: 100%; background-color: white;'>"), k = t('<div class="vis-busyindicatorouterwrap" style="visibility: hidden"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), e = [], r = null, d = 0, h = null, bt = null, y = null, kt = null, dt = null, gt = null, ni = null, ti = null, ii = null, ft = null, p = null, et = null, ot = null, st = null, w = null, o = null, ri = null, ui = null, fi = null, ei = null, oi = null, si = null, hi = null, g = null, nt = null, tt = null, ht = null, ct = null, lt = null, s = null, it = null, at = null, vt = null; this.btnToggal = null; var f = null, c = null, u = null, ci = null, li = null, yt = null, pt = null, ai = null, l = 260, b = 50, vi = t(window).width() - l, yi = t(window).width() - b, sr = t(window).height() - 193, bi = t(window).height() - 382, ki = t(window).height() - (bi + 55 + 118); this.sizeChanged = function (n, t) { vi = t - (l + 1); yi = t - (b + 1); rt == !0 ? (f.animate({ width: b }, "slow"), u.animate({ width: b }, "slow"), u.find("table").css("display", "none"), s.css("display", "none"), c.animate({ width: yi }, "slow", null, function () { r.resize() })) : (f.animate({ width: l }, "slow"), u.animate({ width: l }, "slow"), u.find("table").css("display", "block"), s.css("display", "block"), c.animate({ width: vi }, "slow", null, function () { r.resize() })) }; this.display = function () { wi() }; this.load = function () { di(); gi(); nr(); or() }; this.getRoot = function () { return ut }; this.disposeComponent = function () { ut = null } } n.Apps = n.Apps || {}; n.Apps.AForms = n.Apps.AForms || {}; i.prototype.sizeChanged = function () { }; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.load(); this.frame.getContentGrid().append(this.getRoot()); this.display() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.ArchiveViewer = i }(VIS, jQuery), function (n, t) { function i() { function l() { r.onClose && r.onClose(); r.dispose(); r = null } var i = t("<div><\/div>"), u = "Dialog", f = "auto", e = "auto", o = !0, s = !1, h = !0, c = { at: "center center", of: window }, r; this.onOkClick = null; this.onCancelClick = null; this.onClose = null; this.setTitle = function (n) { u = n }; this.setModal = function (n) { o = n }; this.changeTitle = function (n) { i.dialog("widget").find(".ui-dialog-title").text(n) }; this.setHeight = function (n) { f = n }; this.setWidth = function (n) { e = n }; this.setPosition = function (n) { c = n }; this.setEnableResize = function (n) { h = n }; r = this; this.setContent = function (n) { i.empty(); i.append(n) }; this.getRoot = function () { return i }; this.hidebuttons = function () { i.dialog("widget").find(".ui-dialog-buttonpane .ui-button").hide(); i.dialog("widget").find(".ui-widget-content").css("border", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("padding", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top", "0px"); i.dialog("widget").find(".ui-dialog .ui-dialog-buttonpane").hide() }; this.hideButtons = function () { i.dialog("widget").find(".ui-dialog-buttonpane .ui-button").hide(); i.dialog("widget").find(".ui-widget-content").css("border", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("padding", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top", "0px"); i.dialog("widget").find(".ui-dialog .ui-dialog-buttonpane").hide() }; this.close = function () { i.dialog("close"); this.dispose() }; this.show = function () { var a = "", v = "margin-right:12px"; n.Application.isRTL && (a = "margin-right:7px;", v = ""); i.dialog({ height: f, width: e, title: u, modal: o, resizable: h, closeOnEscape: !s, closeText: n.Msg.getMsg("close"), position: c, buttons: [{ text: n.Msg.getMsg("Ok"), click: function (n) { var f = n.target, u; t(f).attr("disabled", !0); u = !0; r.onOkClick && (u = r.onOkClick(n)); u == !0 || u == undefined ? i != null && i.dialog("close") : t(f).attr("disabled", !1) }, style: v }, { text: n.Msg.getMsg("Cancel"), click: function () { r.onCancelClick && r.onCancelClick(); i && i.dialog("close") }, style: a }], close: l }); t(document).on("keydown", function (n) { if (event.altKey && event.keyCode == 37) return n.preventDefault(), !1; n.stopPropagation() }); return t(".ui-dialog .ui-dialog-buttonpane").css("border-width", "0 0 0"), s && t(".ui-dialog-titlebar-close").remove(), i }; this.dispose = function () { i != null && (i.dialog("destroy"), i.remove()); i = null; this.Show = null; this.setContent = null; this.setTitle = null } } n.ChildDialog = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function a() { } function v() { o.onOkClick = function (i) { var r = l.val(); if (t.trim(r) == "" || r == "" || r == null) return n.ADialog.info("EnterData"), i != undefined && i.preventDefault(), !1; s.prop.ChatText = r; n.dataContext.saveChat(s.prop) }; o.onCancelClick = function () { } } function y(i, r, u) { n.dataContext.getChatRecords(u, function (t) { var r = JSON.parse(t), s = "", u, o, e; for (u in r.subChat) { var c = new Date(r.subChat[u].ChatDate), h = c.toLocaleString(), f = '   <div class="vis-chatboxwrap">'; if (f += n.Application.isRTL ? '<div class="vis-chatimgwrap">' : '<div class="vis-chatimgwrap">', o = !1, r.subChat[u].VAF_Image_ID == 0) f += "<i class='fa fa-user' data-uID='" + r.subChat[u].VAF_UserContact_ID + "'><\/i>", o = !0; else for (e in r.userimages) if (r.userimages[e].VAF_Image_ID == r.subChat[u].VAF_Image_ID && r.userimages[e].UserImg != "NoRecordFound" && r.userimages[e].UserImg != "FileDoesn'tExist") { f += '<img  data-uID="' + r.subChat[u].VAF_UserContact_ID + '" src="' + n.Application.contextUrl + r.userimages[e].UserImg + '" />'; o = !0; break } o == !1 && (f += "<i class='fa fa-user' data-uID='" + r.subChat[u].VAF_UserContact_ID + "'><\/i>"); f += '<\/div><div class="vis-chatdetailwrap"><div style="display: flex;">'; f += n.Application.isRTL ? '<span data-uID="' + r.subChat[u].VAF_UserContact_ID + '" class="vis-chatusername">' : '<span data-uID="' + r.subChat[u].VAF_UserContact_ID + '" class="vis-chatusername">'; f += n.Env.getCtx().getVAF_UserContact_ID() == r.subChat[u].VAF_UserContact_ID ? "Me" : r.subChat[u].UserName; f += n.Application.isRTL ? '<\/span><span style="font-size: .75rem; padding-right: 5px;">' + h + '<\/span><\/div><div  style="overflow:auto">' : '<\/span><span style="font-size: .75rem; padding-right: 5px;">' + h + "<\/span><\/div><div>"; f += n.Application.isRTL ? '<span style="font-size: .75rem;padding-right:5px">' + n.Utility.encodeText(r.subChat[u].ChatData) + "<\/span><\/div>" : '<span style="font-size: .75rem;padding-right:5px">' + n.Utility.encodeText(r.subChat[u].ChatData) + "<\/span><\/div>"; f += "<\/div>"; f += "            <\/div>  "; s += f } i.html(s) }); i.on("click", function (i) { var u, f; (t(i.target).is("span") || t(i.target).is("img")) && (u = t(i.target).data("uid"), u != undefined && u != null && u > 0 && (f = new n.ContactInfo(u, r), f.show(), o.close())) }) } var o, s; this.onClose = null; var h = t('<div class="vis-forms-container"><\/div>'), c = t('<div class="vis-chatdetailouterwrap"><\/div>'), l = t('<textarea  id="input-chat-new" class="vis-chat-msgbox"  maxlength="500" />'); h.append(c).append(l); this.winNo = e; o = null; this.prop = { WindowNo: e, ChatID: r, VAF_TableView_ID: u, Record_ID: i, Description: f, TrxName: null, ChatText: "", page: 0, pageSize: 10 }; y(c, e, this.prop); s = this; a(); this.show = function () { o = new n.ChildDialog; o.setContent(h); o.setHeight(450); o.setWidth(655); o.setTitle(n.Msg.getMsg("Chat")); o.setModal(!0); o.onClose = function () { s.onClose && s.onClose(); s.dispose() }; o.show(); v() }; this.dispose = function () { this.prop = null; c = null; h.remove(); h = null; o = null; s = null } } n.Chat = i }(VIS, jQuery), function (n, t) { function u() { t.ajax({ url: n.Application.contextUrl + "InfoMenu/LoadMenu", dataType: "json", error: function () { alert("No DATA") }, success: function (n) { var r = n.result, u, f; for (u in r) f = t("<li data-id='" + r[u].VAF_QuickSearchWindow_ID + "' >"), f.append(r[u].Name), i.append(f) } }) } var r = t("<div/>"), i; r.css("width", "100%"); r.css("height", "100%"); i = t("<ul class='vis-apanel-rb-ul'>"); i.css("width", "100%"); i.css("height", "100%"); r.append(i); i.on("click", "LI", function (i) { var r = t(i.target).data("id"), u = new n.InfoWindow(r, null, 0, null, null); u.show() }); u(); n.InfoMenu = { show: function (n) { n.w2overlay(r.clone(!0), { css: { height: "300px" } }) } } }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function ti() { var u, i, r, f; v.css("width", "100%"); v.css("height", "100%"); v.css("position", "relative"); ht = t("<div class='vis-info-l-s-wrap vis-leftsidebarouterwrap'>"); rt = t("<div>"); ht.append(rt); ut = t("<div class='vis-info-datasec'>"); tt = t("<div class='vis-info-btnsec'>"); it.append(ht); it.append(ut); it.append(tt); u = n.Msg.getMsg("Refresh"); u.indexOf("&") > -1 && (u = u.replace("&", "")); i = n.Msg.getMsg("Cancel"); i.indexOf("&") > -1 && (i = i.replace("&", "")); r = n.Msg.getMsg("Ok"); r.indexOf("&") > -1 && (r = r.replace("&", "")); ft = t("<div class='vis-info-btnswrap'>"); et = t("<button class='VIS_Pref_btn-2'>").append(i); ot = t("<button class='VIS_Pref_btn-2'>").append(r); f = t("<div class='vis-info-btnleft'>"); st = t("<button class='VIS_Pref_btn-2' style='margin-top: 10px;'>").append(t("<i class='vis vis-refresh'><\/i>")); lt = t('<div class="vis-info-pagingwrp">'); oi(); lt.append(at); ft.append(et); ft.append(ot); f.append(st); tt.append(f); tt.append(lt); tt.append(ft); y = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); v.append(it); v.append(y) } function ii() { ot.on("click", function () { bt() }); st.on("click", function () { y[0].style.visibility = "visible"; f != null && f != undefined && f.length > 0 && (f = n.Env.parseContext(n.Env.getCtx(), u, f, !1, !1)); nt(!0, l.val()) }); et.on("click", function () { g.onClose != null && g.onClose(); ct() }); if (!n.Application.isMobile) v.on("keyup", function (t) { t.keyCode === 13 && (y[0].style.visibility = "visible", f != null && f != undefined && f.length > 0 && (f = n.Env.parseContext(n.Env.getCtx(), u, f, !1, !1)), nt(!0, l.val())) }) } function ri() { g.onClose != null && g.onClose(); ct() } function ei(n) { var i, t; if (e) if (n.index) t = w2ui[n.target].records[n.index][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1); else for (i = 0; i < w2ui[n.target].records.length; i++)t = w2ui[n.target].records[i][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1) } function oi() { at = t('<ul class="vis-statusbar-ul">'); p = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="' + n.Msg.getMsg("FirstPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); w = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.getMsg("PageUp") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); l = t("<select>"); yt = t("<li>").append(l); b = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.getMsg("PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); k = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="' + n.Msg.getMsg("LastPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); at.append(p).append(w).append(yt).append(b).append(k); si() } function si() { p.on("click", function () { t(this).css("opacity") == "1" && nt(!0, 1) }); w.on("click", function () { t(this).css("opacity") == "1" && nt(!0, parseInt(l.val()) - 1) }); b.on("click", function () { t(this).css("opacity") == "1" && nt(!0, parseInt(l.val()) + 1) }); k.on("click", function () { t(this).css("opacity") == "1" && nt(!0, parseInt(l.find("Option:last").val())) }); l.on("change", function () { nt(!0, l.val()) }) } function hi(n) { if (l.empty(), n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)l.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); l.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (b.css("opacity", "1"), k.css("opacity", "1")) : (b.css("opacity", "0.6"), k.css("opacity", "0.6")); n.CurrentPage > 1 ? (p.css("opacity", "1"), w.css("opacity", "1")) : (p.css("opacity", "0.6"), w.css("opacity", "0.6")); n.TotalPage == 1 && (p.css("opacity", "0.6"), w.css("opacity", "0.6"), b.css("opacity", "0.6"), k.css("opacity", "0.6")) } else p.css("opacity", "0.6"), w.css("opacity", "0.6"), b.css("opacity", "0.6"), k.css("opacity", "0.6") } var wt, bt, ct; this.onClose = null; var v = t("<div class='vis-forms-container'>"), it = t("<div class='vis-info-subroot'>"), kt = !0, dt, gt, ni, ht, rt, ut, tt, y, ft, et, ot, st, d = null, h = null, o = null, vt = !1, s = []; this.keyCol = ""; this.windowNo = u; var g = this, c = [], a = null, lt, at, p, w, yt, b, k, l; ti(); ii(); this.show = function () { var r = g; t.ajax({ url: n.Application.contextUrl + "InfoWindow/GetSearchColumn/?VAF_QuickSearchWindow_ID=" + i, dataType: "json", error: function () { alert(n.Msg.getMsg("ERRORGettingSchema")); y[0].style.visibility = "hidden" }, success: function (t) { if (t.result == null || t.result.Schema == null) { alert(n.Msg.getMsg("ERRORGettingSchema")); return } if (h = t.result, o = h.Schema, o == null) { alert(n.Msg.getMsg("ERRORGettingSchema")); return } ui(r) } }) }; var ui = function (i) { var wt = null, e = null, it = t("<table>"), c, y, w, ft, ii, yt, p, a, ti, ot, st, ht; it.css("width", "100%"); var k = null, bt = 0, b = !1, kt = null, dt = null, ct = null; for (c in o) if (o[c].IsQueryCriteria) { b = !1; var gt = t("<td class='vis-gc-vpanel-table-td1'>"), ut = t('<div class="input-group vis-input-wrap">'), g = t('<div class="vis-control-wrap">'), tt = t('<div class="input-group-append">'); if (k = t("<tr>"), it.append(k), k.append(gt), gt.append(ut), ut.append(g), y = {}, kt = o[c].VAF_Control_Ref_ID, e = pt(o[c].VAF_Control_Ref_ID, o[c].ColumnName, o[c].Name, o[c].VAF_Control_Ref_Value_ID, o[c].lookup), y.Ctrl = e, o[c].SetValue != null) { if (w = !1, o[c].Condition != null) { for (var d = [], lt = [], ni = new n.StringTokenizer(o[c].Condition, "[]"); ni.hasMoreTokens();)ft = ni.nextToken(), ft.trim() != " & ".trim() ? (w = n.Evaluator.evaluateLogic(i, ft), d.push(w)) : lt.push(ft); d.length > 1 ? lt[0].trim().equals("&") ? w = d.indexOf(!1) > -1 ? !1 : !0 : lt[0].trim().equals("|") && d.indexOf(!0) > -1 && (w = !0) : d.length == 1 && d[0] == !0 && (w = !0) } else w = !0; w && (kt == n.DisplayType.YesNo ? o[c].SetValue.toUpperCase() == "Y" ? e.getControl().find("input").prop("checked", !0) : o[c].SetValue.toUpperCase() == "N" && e.getControl().find("input").prop("checked", !1) : o[c].SetValue.contains("@") ? (dt = o[c].SetValue.substring(1, o[c].SetValue.lastIndexOf("@")), ct = n.context.getWindowContext(u, dt, !1), ct.equals("") ? e.setValue(null) : e.setValue(ct)) : e.setValue(o[c].SetValue)) } if (y.VAF_Control_Ref_ID = o[c].VAF_Control_Ref_ID, y.ColumnName = o[c].SelectClause, y.SearchColumnName = y.ColumnName.toUpperCase().indexOf(" AS ") > -1 ? y.ColumnName.substring(0, y.ColumnName.toUpperCase().indexOf(" AS ")) : y.ColumnName, o[c].ISIDENTIFIER && r != null && e.setValue(r), ii = t("<td>"), p = e.getBtnCount(), p == 2 ? (b, g.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " ")), a = e.getBtn(0), a != null && (tt.append(a.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), a = e.getBtn(1), a != null && (tt.append(a.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), p = -1, e = null, ut.append(tt)) : p == 1 ? (b, g.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " ")), a = e.getBtn(0), a != null && (tt.append(a.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), p = -1, e = null, ut.append(tt)) : (b && e.getControl(), o[c].VAF_Control_Ref_ID == n.DisplayType.YesNo && e.getControl(), g.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " "))), o[c].IsRange) { y.IsRange = !0; var at = t('<div class="input-group vis-input-wrap">'), et = t('<div class="vis-control-wrap">'), vt = t('<div class="input-group-append">'); k = t("<tr>"); it.append(k); e = pt(o[c].VAF_Control_Ref_ID, o[c].ColumnName, o[c].Name); y.CtrlTo = e; yt = t("<td>"); k.append(yt); yt.append(at); at.append(et); p = e.getBtnCount(); p == 2 ? (b && e.getControl(), et.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " ")), a = e.getBtn(0), a != null && (vt.append(a.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), a = e.getBtn(1), a != null && (vt.append(a.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), p = -1, e = null, at.append(vt)) : (b && e.getControl(), o[c].VAF_Control_Ref_ID == n.DisplayType.YesNo ? e.getControl() : e.getControl(), et.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " "))); et.append(new n.Controls.VLabel(n.Msg.getMsg("To"), o[c].ColumnName).getControl()) } else y.IsRange = !1; bt = bt + 1; s.push(y); o[c].VAF_Control_Ref_ID == n.DisplayType.YesNo || o[c].VAF_Control_Ref_ID == n.DisplayType.Button || o[c].VAF_Control_Ref_ID == n.DisplayType.Label ? b = !0 : (wt = new n.Controls.VLabel(o[c].Name, o[c].ColumnName), ti = wt.getControl(), g.append(ti)) } rt.append(it); ot = n.Msg.getMsg("Refresh"); ot.indexOf("&") > -1 && (ot = ot.replace("&", "")); st = n.Msg.getMsg("Cancel"); st.indexOf("&") > -1 && (st = st.replace("&", "")); ht = n.Msg.getMsg("Ok"); ht.indexOf("&") > -1 && (ht = ht.replace("&", "")); v.dialog({ width: 1020, height: 487, resizable: !1, title: h.WindowName, modal: !0, closeText: n.Msg.getMsg("close"), close: ri }); f != null && f != undefined && f.length > 0 && (f = n.Env.parseContext(n.Env.getCtx(), u, f, !1, !1)); nt(!0, l.val()) }, pt = function (t, i, r, f, e) { var o = null, y, c, p, l, e, w, a, b, k, d, g, nt, tt, s, v, it, rt, h; return t == n.DisplayType.Button ? (y = new n.Controls.VButton(i, !1, !1, !0, r, null, null, 0), o = y) : t == n.DisplayType.String ? (c = new n.Controls.VTextBox(i, !1, !1, !0, 50, 100, null, null, !1), o = c, c.click = function () { vt = !0 }) : t == n.DisplayType.YesNo ? (p = new n.Controls.VCheckBox(i, !1, !1, !0, r, null), o = p) : n.DisplayType.IsDate(t) ? (t == n.DisplayType.DateTime && (readOnly = !0), l = new n.Controls.VDate(i, !1, !1, !0, t, r), l.setName(i), o = l) : n.DisplayType.IsLookup(t) || n.DisplayType.ID == t ? (e = n.MLookupFactory.get(n.Env.getCtx(), u, 0, t, i, f, !1, null), t != n.DisplayType.Search && t != n.DisplayType.MultiKey ? (w = new n.Controls.VComboBox(i, !1, !1, !0, e, 50), o = w) : (t = n.DisplayType.Search, a = new n.Controls.VTextBoxButton(i, !1, !1, !0, t, e), a.getBtn(), o = a)) : t == n.DisplayType.Location ? (b = new n.Controls.VLocation(i, !1, !1, !0, t, null), o = b) : t == n.DisplayType.Locator ? (k = new n.Controls.VLocator(i, !1, !1, !0, t, e), o = k) : n.DisplayType.Text == t || n.DisplayType.TextLong == t ? (d = new n.Controls.VTextArea(i, !1, !1, !0, 50, 100, t), o = d) : n.DisplayType.IsNumeric(t) ? n.DisplayType.Amount == t ? (g = new n.Controls.VAmountTextBox(i, !1, !1, !0, 50, 100, t, r), o = g) : n.DisplayType.Integer == t ? (nt = new n.Controls.VNumTextBox(i, !1, !1, !0, 50, 100, r), o = nt) : n.DisplayType.Number == t && (tt = new n.Controls.VAmountTextBox(i, !1, !1, !0, 50, 100, t, r), o = tt) : t == n.DisplayType.PAttribute ? (s = new n.Controls.VPAttribute(i, !1, !1, !0, t, e, u, !1, !1, !1, !0), s.getBtn(0), o = s) : t == n.DisplayType.GAttribute ? (s = new n.Controls.VPAttribute(i, !1, !1, !0, t, e, u, !1, !1, !1, !1), s.getBtn(0), o = s) : t == n.DisplayType.Account ? (v = new n.Controls.VAccount(i, !1, !1, !0, t, e, u, r), v.getBtn(0), o = v) : t == n.DisplayType.Binary ? (it = new n.Controls.VBinary(i, !1, !1, !0, u), o = it) : t == n.DisplayType.Image ? (rt = new n.Controls.VImage(i, !1, !1, u), o = rt) : t == n.DisplayType.URL ? (h = new n.Controls.VURL(i, !1, !1, !0, 50, 100), o = h) : (t == n.DisplayType.FileName || t == n.DisplayType.FilePath) && (h = new n.Controls.VFile(i, !1, !1, !0, u, t), o = h), o }, nt = function (i, r) { var nt, d, it, ut, u, b, g; if (e && w2ui[a]) { nt = w2ui[a].getSelection(); for (d in nt) c.indexOf(w2ui[a].get(nt[d])[keyCol]) == -1 && c.push(w2ui[a].get(nt[d])[keyCol]) } wt(); var p = "SELECT ", k = null, tt = null, rt = 0, et = t.makeArray(o).length; for (d in o) { if (k = o[d].SelectClause, tt = String(k).indexOf(".") > -1 ? String(k).substring(String(k).lastIndexOf(".") + 1, String(k).length) : k, o[d].IsKey && (keyCol = tt.toUpperCase()), rt = o[d].VAF_Control_Ref_ID, rt == n.DisplayType.YesNo) p += " ( CASE " + k + " WHEN 'Y' THEN  'True' ELSE 'False'  END ) AS " + tt; else if (rt == n.DisplayType.List) { it = o[d].RefList; p += " CASE "; for (ut in it) p += " WHEN " + k + "='" + it[ut].Key + "' THEN '" + it[ut].Value + "'"; p += " END AS " + tt } else p += k + " "; et - 1 == d || (p += ", ") } if (p += " FROM " + h.FromClause, i == !0) { var w = " ", l = null, ft = !1; for (u = 0; u < s.length; u++)if (l = s[u].Ctrl.getValue(), s[u].VAF_Control_Ref_ID == n.DisplayType.Date && s[u].IsRange && l == null && (l = s[u].CtrlTo.getValue()), l != null && l.length != 0 && (l != 0 || s[u].VAF_Control_Ref_ID == n.DisplayType.YesNo) && l != -1 && l) { if (ft == !0 && (w += " AND "), s[u].VAF_Control_Ref_ID == n.DisplayType.String || s[u].VAF_Control_Ref_ID == n.DisplayType.Text || s[u].VAF_Control_Ref_ID == n.DisplayType.TextLong) l = String(l).indexOf("%") == 0 ? String(l).replace("%", "●") : "●" + l, String(l).lastIndexOf("●") == String(l).length || (l = l + "●"), w += "  UPPER(" + s[u].SearchColumnName + ") LIKE '" + l.toUpperCase() + "' "; else if (s[u].VAF_Control_Ref_ID == n.DisplayType.Date) { var b = null, g = null, v = new Date(s[u].Ctrl.getValue()); b = "TO_DATE( '" + (Number(v.getMonth()) + 1) + "-" + v.getDate() + "-" + v.getFullYear() + "', 'MM-DD-YYYY')"; s[u].IsRange ? (v = s[u].CtrlTo.getValue() == null ? new Date : new Date(s[u].CtrlTo.getValue()), g = "TO_DATE( '" + (Number(v.getMonth()) + 1) + "-" + v.getDate() + "-" + v.getFullYear() + "', 'MM-DD-YYYY')", w += " ( " + s[u].SearchColumnName + " BETWEEN " + b + " AND " + g + ")") : w += s[u].SearchColumnName + " =" + b } else if (s[u].VAF_Control_Ref_ID == n.DisplayType.DateTime) { var b = null, g = null, v = new Date(s[u].Ctrl.getValue()); b = "TO_DATE( '" + (Number(v.getMonth()) + 1) + "-" + v.getDate() + "-" + v.getFullYear() + " " + v.getHours() + ":" + v.getMinutes() + ":" + v.getSeconds() + "', 'MM-DD-YYYY HH24:MI:SS')"; s[u].IsRange ? (v = new Date(s[u].CtrlTo.getValue()), g = "TO_DATE( '" + (Number(v.getMonth()) + 1) + "-" + v.getDate() + "-" + v.getFullYear() + " " + v.getHours() + ":" + v.getMinutes() + ":" + v.getSeconds() + "', 'MM-DD-YYYY HH24:MI:SS')", w += " ( " + s[u].SearchColumnName + " BETWEEN " + b + " AND " + g + ")") : w += s[u].SearchColumnName + " =" + b } else s[u].VAF_Control_Ref_ID == n.DisplayType.YesNo ? (l = s[u].Ctrl.getValue() == !0 ? "Y" : "N", w += s[u].SearchColumnName + " = '" + l + "'") : (b = null, g = null, b = s[u].Ctrl.getValue(), s[u].IsRange ? s[u].Ctrl.getValue() && (l = s[u].Ctrl.getValue() == !0 ? "Y" : "", w += s[u].SearchColumnName + " = '" + l + "'") : w += " " + s[u].SearchColumnName + " ='" + b + "'"); ft = !0 } w.length > 1 ? (p += h.FromClause.toUpperCase().indexOf("WHERE") > -1 ? " AND " + w : " WHERE " + w, f != null && f.length > 0 && (p += " AND " + f)) : f != null && f.length > 0 && (p += h.FromClause.toUpperCase().indexOf("WHERE") > -1 ? " AND " + f : " WHERE " + f); h.OTHERCLAUSE != null && (String(h.OTHERCLAUSE).toUpperCase().indexOf("WHERE") > -1 && (h.FromClause.toUpperCase().indexOf("WHERE") > -1 || w.length > 1 || f != null && f.length > 1) && (h.OTHERCLAUSE = String(h.OTHERCLAUSE).replace("WHERE", "AND")), p += " " + h.OTHERCLAUSE) } else p += h.FromClause.toUpperCase().indexOf("WHERE") > -1 ? " AND rownum=-1" : " WHERE rownum=-1"; r || (r = 1); t.ajax({ url: n.Application.contextUrl + "InfoWindow/GetData", dataType: "json", type: "POST", data: { sql: p, tableName: h.TableName, pageNo: r }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); y[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { y[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); y[0].style.visibility = "hidden"; return } hi(i.pSetting); fi(i.data) } }) }, fi = function (i) { var r, s, h, u; if (i == null) { alert(n.Msg.getMsg("NoDataFound")); y[0].style.visibility = "hidden"; return } var l = [], v = [], f = null; for (u in i) r = { resizable: !0 }, f = o[u].VAF_Control_Ref_ID, r.caption = o[u].Name, r.field = i[u].ColumnName.toUpperCase(), r.columnName = i[u].ColumnName.toUpperCase(), r.sortable = !0, r.hidden = !o[u].IsDisplayed, r.size = "100px", n.DisplayType.IsNumeric(f) ? r.render = f == n.DisplayType.Integer ? "int" : f == n.DisplayType.Amount ? "number:2" : "number:1" : n.DisplayType.IsDate(f) ? r.render = function (n, t, i) { var r = n[l[i].field]; return r ? Globalize.format(new Date(r), "d") : "" } : f == n.DisplayType.Location || f == n.DisplayType.Locator ? r.render = "int" : f == n.DisplayType.Account ? r.render = "int" : f == n.DisplayType.PAttribute ? r.render = "int" : f == n.DisplayType.Button ? r.render = function () { return "<div>button<\/div>" } : f == n.DisplayType.Image ? r.render = function () { return "<div>Image<\/div>" } : n.DisplayType.IsLOB(f) && (r.render = function () { return "<div>[Lob-blob]<\/div>" }), l[u] = r; for (s = 0; s < i[0].RowCount; s++) { h = {}; for (u in i) h[i[u].ColumnName.toUpperCase()] = i[u].Values[s]; h.recid = s + 1; v[s] = h } if (a = "gridInfodata" + Math.random(), a = a.replace(".", ""), w2utils.encodeTags(v), d = t(ut).w2grid({ name: a, recordHeight: 40, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !0, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: l, records: v, multiSelect: e, onUnselect: ei }), e) for (itm in c) for (u in w2ui[a].records) w2ui[a].records[u][keyCol] == c[itm] && w2ui[a].select(parseInt(u) + 1); y[0].style.visibility = "hidden" }; wt = function () { d != null && d.destroy(); d = null }; bt = function () { var n = w2ui[a].getSelection(); for (item in n) c.indexOf(w2ui[a].get(n[item])[keyCol]) == -1 && c.push(w2ui[a].get(n[item])[keyCol]); g.onClose != null && c.length > 0 && g.onClose(); ct() }; this.getSelectedValues = function () { return c }; ct = function () { ot.off("click"); st.off("click"); et.off("click"); v.off("keyup"); p.off("click"); w.off("click"); b.off("click"); k.off("click"); l.off("change"); ut = null; rt = null; d != null && d.destroy(); d = null; it = null; kt = null; dt = gt = ni = ht = rt = ut = tt = null; y = ft = et = ot = st = null; p = w = b = k = l = null; d = null; h = null; o = null; vt = null; s = null; keyCol = null; g = null; c = null; v != null && (v.dialog("destroy"), v.remove()); v = null; this.disposeComponent = null; this.displaySchema = null; this.getControl = null; this.displayData = null; this.loadData = null; this.disposeDataSec = null; this.btnOKClick = null; this.getSelectedValues = null; this.disposeComponent = null } } i.prototype.getValueAsString = function (t) { return n.context.getWindowContext(this.windowNo, t, !0) }; n.InfoWindow = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function cs() { function vr(t) { t && (wr = s.find("option:selected").val()); it = 1; v = []; s.val() != 0 ? v[0] = s.val() : v = ot; hi(v, null, function (t) { bi(t); vo(s.val(), function () { t.length != 0 ? (e.val(t[0].DimensionTypeVal), ru(e.val()), c.setValue(0), ft = !1, tt.empty().append(n.Msg.getMsg("Add")), s.val() != -1 && e.val() != 0 ? (y.css("display", "block"), tt.css("display", "block"), ii.html() == "" ? w.getRoot().parent().css("height", "448px") : w.getRoot().parent().css("height", "469px")) : (y.css("display", "none"), tt.css("display", "none"), ii.html() == "" ? w.getRoot().parent().css("height", "390px") : w.getRoot().parent().css("height", "410px"))) : (ru(e.val()), s.val() != -1 && e.val() != 0 ? (y.css("display", "block"), tt.css("display", "block"), ii.html() == "" ? w.getRoot().parent().css("height", "448px") : w.getRoot().parent().css("height", "469px")) : (y.css("display", "none"), tt.css("display", "none"), ii.html() == "" ? w.getRoot().parent().css("height", "390px") : w.getRoot().parent().css("height", "410px"))) }) }) } var r, u, b, nt, yi, pi, lr; of = t("<label>"); sf = t("<label>"); hf = t("<label>"); cf = t("<label>"); io = t("<label>"); lf = t("<label>"); ii = t("<label>"); s = t("<select tabindex='2'>"); e = t("<select tabindex='3'>"); fi = t("<select>"); c = new n.Controls.VAmountTextBox("Amount", !1, !1, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); a = new n.Controls.VAmountTextBox("ModalAmount", !1, !1, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); p = new n.Controls.VAmountTextBox("TotalAmount", !1, !0, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); ut = new n.Controls.VAmountTextBox("Total", !1, !0, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); tt = t("<a style='cursor:pointer;' tabindex='7'>"); ir = t("<a>"); tf = t("<a style='cursor:pointer;' tabindex='12'>"); rf = t("<a style='cursor:pointer;' tabindex='13'>"); fe = t("<div class='VIS-AMTD-Grid'>"); gf = t("<div class='VIS-AMTD-SubGrid'>"); g = t("<div class='VIS-AMTD-formDynmicInput'>"); d = t("<div class='VIS-AMTD-formDynmicInput'>"); bo = t("<button>"); ko = t("<button>"); hr = t("<div class='VIS-AMTD-Modal' id='updateModal'>"); ue = t("<div class='VIS-AMTD-Modal-Content'>"); to = t("<span class='VIS-AMTD-Close'>"); statusSpanShowRecordNo = t("<label>"); statusSpanShowRecordNo.addClass("vis-statusbar-pageMsg"); to.append("X"); sr = t('<ul class="vis-statusbar-ul"><\/ul>'); pe = t('<div class="VIS-AMTD-StatusContainer"><\/div>'); uo = t('<li  style="opacity: 0.6;"><div><i class="vis vis-shiftleft" style="opacity: 1;" action="first" title="First Page" ><\/i><\/div><\/li>'); sr.append(uo); fo = t('<li style="opacity: 0.6;"><div><i class="vis vis-pageup" style="opacity: 1;" action="prev" title="Page Down" ><\/i><\/div><\/li>'); sr.append(fo); ti = t('<select class="vis-statusbar-combo" style="width:50px;"><\/select>'); r = t("<li><\/li>"); r.append(ti); sr.append(r); eo = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" style="opacity: 1;" action="next" title="Page Up" alt="Page Down" src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/PageDown16.png"><\/div><\/li>'); sr.append(eo); oo = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" style="opacity: 1;" action="last" title="Last Page" ><\/i><\/div><\/li>'); sr.append(oo); pe.append(sr); yo = []; h = 0; ft = !1; po = 0; wo = 0; ne = ""; bt = ""; ur = ""; fr = ""; er = ""; rt = ""; li = ""; ai = ""; vi = ""; ot = ""; oi = ""; go = 0; ot = []; v = []; we = 0; uf = !0; k = 0; ar = 30; it = 1; hs = 0; cr = 0; wr = -1; so = 0; wi = n.DisplayType.GetNumberFormat(n.DisplayType.Amount); te = t("<div class='VIS-AMTD-formWrap'>"); uu = t("<input type='button' class='VIS_Pref_btn-2 pull-left' tabindex='16' >"); tt.append(n.Msg.getMsg("Add")); ir.append(n.Msg.getMsg("Cancel")); tf.append(n.Msg.getMsg("Update")); rf.append(n.Msg.getMsg("Cancel")); uu.val(n.Msg.getMsg("OK")); of.append(n.Msg.translate(n.Env.getCtx(), "VAB_AccountBook_ID")); sf.append(n.Msg.translate(n.Env.getCtx(), "ElementType")); hf.append(n.Msg.getMsg("TotalAmount")); cf.append(n.Msg.getMsg("Amount")); io.append(n.Msg.getMsg("Amount")); ir.css("display", "none"); lf.append(n.Msg.getMsg("Total")); u = t("<div class='VIS-AMTD-formData'>"); u.append(of).append(s); b = t("<div class='VIS-AMTD-formData'>"); b.append(sf).append(e); nt = t("<div class='VIS-AMTD-formData'>"); nt.append(hf).append(p.getControl()); y = t("<div class='VIS-AMTD-formData VIS-AMTD-amountTxt'>"); y.append(cf).append(c.getControl()); gi = t("<div class='VIS-AMTD-formData VIS-AMTD-amountTxt'>"); gi.append(io).append(a.getControl()); ie = t("<div class='VIS-AMTD-formBtns'>"); yi = t("<div>"); yi.append(tt); ie.append(yi); re = t("<div class='VIS-AMTD-ModalformBtns'>"); pi = t("<div>"); pi.append(tf).append(rf); re.append(pi); lr = t("<div class='VIS-AMTD-formData'>"); ue.append(d).append(gi).append(re); hr.append(ue); fe.append(gf).append(hr).append(pe); lr.append(lf).append(ut.getControl()); tu = t("<div style='color:green;font-size:small'>"); tu.append(ii); te.append(tu).append(nt).append(u).append(b).append(g).append(y).append(ie); ef.append(te).append(fe).append(lr).append(uu); br.append(ef).append(ge); f && ef.addClass("VIS-AMTD-ReadOnly"); s.on("change", function () { o("visible"); var t = !0; s.val() == 0 && (t = !1, hi(ot, null, function (t) { t.length != 0 && n.ADialog.confirm("ConfirmSelectAllAcctSchema", !0, "", "Confirm", function (t) { if (t) { o("visible"); for (var r = 0; r < ot.length; r++)n.DB.executeQuery("delete from VAB_DimAmtaccttype where VAB_AccountBook_id=" + ot[r] + " and VAB_DimAmt_id=" + i + ""); ff(); hi(ot, null, function (t) { o("visible"); bi(t); wr = s.find("option:selected").val(); h = 0; c.setValue(0); ft = !1; ir.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? y.css("width", "25%") : y.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")); ut.setValue(0); vr(!1) }) } else s.val(wr), e.val(cr), vr(!1) }) })); hi(ot, null, function () { vr(t); o("hidden") }); iu = s.find("option:selected").attr("precision") }); e.on("change", function () { o("visible"); hi(v, null, function (t) { if (t.length != 0) n.ADialog.confirm("ConfirmChangeDimensionType", !0, "", "Confirm", function (t) { if (t) { o("visible"); ru(e.val()); cr = e.find("option:selected").val(); c.setValue(0); ft = !1; ir.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? y.css("width", "25%") : y.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")); for (var r = 0; r < v.length; r++)n.DB.executeQuery("delete from VAB_DimAmtaccttype where VAB_AccountBook_id=" + v[r] + " and VAB_DimAmt_id=" + i + ""); hi(v, null, function (n) { bi(n); ff(); ut.setValue(0) }); o("hidden") } else return e.val(cr), co(), o("hidden"), !1; co() }); else { if (ru(e.val()), !ho) return o("hidden"), n.ADialog.warn("VIS_ElementDifferent"), !1; cr = e.find("option:selected").val(); e.val() == "AC" ? ei.showColumn("VAB_BusinessPartner") : ei.hideColumn("VAB_BusinessPartner") } co(); e.focus(); o("hidden") }) }); tt.on("keydown", function (n) { if (n.keyCode == 13 && (o("visible"), ke())) { ft || h++; var t = e.find("option:selected").val(); t == "AC" ? (l(e.find("option:selected").text(), wt.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ci.getValue(), si, 0, bt.getValue(), lt.val()), fi.val("-1"), ci.setValue("-1")) : t == "AY" ? (l(e.find("option:selected").text(), ri.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ri.find("option:selected").val(), -1, 0, 0, ""), ri.val(-1)) : t == "BP" ? (l(e.find("option:selected").text(), lt.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), bt.getValue(), -1, 0, 0, ""), lt.val(""), bt.setValue("-1")) : t == "LF" || t == "LT" ? (l(e.find("option:selected").text(), rr.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ur.getValue(), -1, 0, 0, ""), rr.val(""), ur.setValue("-1")) : t == "MC" ? (l(e.find("option:selected").text(), pt.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), pt.find("option:selected").val(), -1, 0, 0, ""), pt.val(-1)) : t == "OO" || t == "OT" ? (l(e.find("option:selected").text(), ht.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ht.find("option:selected").val(), -1, 0, 0, ""), ht.val("-1")) : t == "PJ" ? (l(e.find("option:selected").text(), ki.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), fr.getValue(), -1, 0, 0, ""), ki.val(""), fr.setValue("-1")) : t == "PR" ? (l(e.find("option:selected").text(), di.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), er.getValue(), -1, 0, 0, ""), di.val(""), er.setValue("-1")) : t == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, 0, 0, "") : t == "SR" ? (l(e.find("option:selected").text(), ui.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ui.find("option:selected").val(), -1, 0, 0, ""), ui.val("-1")) : t == "U1" || t == "U2" ? (l(e.find("option:selected").text(), wt.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ci.getValue(), si, 0, 0, ""), fi.val("-1"), wt.val(""), ci.setValue("-1")) : (t == "X1" || t == "X2" || t == "X3" || t == "X4" || t == "X5" || t == "X6" || t == "X7" || t == "X8" || t == "X9") && (l(e.find("option:selected").text(), ct.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ct.find("option:selected").val(), -1, 0, 0, ""), ct.val(-1)) } }); tt.on("click", function () { if (o("visible"), ke()) { ft || h++; var n = e.find("option:selected").val(); n == "AC" ? (l(e.find("option:selected").text(), wt.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ci.getValue(), si, 0, bt.getValue(), lt.val()), fi.val("-1"), ci.setValue("-1"), lt.val(""), bt.setValue("-1")) : n == "AY" ? (l(e.find("option:selected").text(), ri.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ri.find("option:selected").val(), -1, 0, 0, ""), ri.val(-1)) : n == "BP" ? (l(e.find("option:selected").text(), lt.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), bt.getValue(), -1, 0, 0, ""), lt.val(""), bt.setValue("-1")) : n == "LF" || n == "LT" ? (l(e.find("option:selected").text(), rr.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ur.getValue(), -1, 0, 0, ""), rr.val(""), ur.setValue("-1")) : n == "MC" ? (l(e.find("option:selected").text(), pt.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), pt.find("option:selected").val(), -1, 0, 0, ""), pt.val(-1)) : n == "OO" || n == "OT" ? (l(e.find("option:selected").text(), ht.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ht.find("option:selected").val(), -1, 0, 0, ""), ht.val("-1")) : n == "PJ" ? (l(e.find("option:selected").text(), ki.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), fr.getValue(), -1, 0, 0, ""), ki.val(""), fr.setValue("-1")) : n == "PR" ? (l(e.find("option:selected").text(), di.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), er.getValue(), -1, 0, 0, ""), di.val(""), er.setValue("-1")) : n == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, 0, 0, "") : n == "SR" ? (l(e.find("option:selected").text(), ui.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ui.find("option:selected").val(), -1, 0, 0, ""), ui.val("-1")) : n == "U1" || n == "U2" ? (l(e.find("option:selected").text(), wt.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ci.getValue(), si, 0, 0, ""), fi.val("-1"), wt.val(""), ci.setValue("-1")) : (n == "X1" || n == "X2" || n == "X3" || n == "X4" || n == "X5" || n == "X6" || n == "X7" || n == "X8" || n == "X9") && (l(e.find("option:selected").text(), ct.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ct.find("option:selected").val(), -1, 0, 0, ""), ct.val(-1)) } }); ir.on("click", function () { o("visible"); ru(e.val()); c.setValue(0); ft = !1; ir.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? y.css("width", "25%") : y.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")); o("hidden") }); tf.on("keydown", function (n) { if (n.keyCode == 13 && (o("visible"), ke())) { var t = e.find("option:selected").val(); t == "AC" ? (l(e.find("option:selected").text(), gt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ni.getValue(), si, k, rt.getValue(), st.val()), dt.val("-1"), ni.setValue("-1"), st.val(""), rt.setValue("-1")) : t == "AY" ? (l(e.find("option:selected").text(), vt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vt.find("option:selected").val(), -1, k, 0, ""), vt.val(-1)) : t == "BP" ? (l(e.find("option:selected").text(), st.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), rt.getValue(), -1, k, 0, ""), st.val(""), rt.setValue("-1")) : t == "LF" || t == "LT" ? (l(e.find("option:selected").text(), or.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), li.getValue(), -1, k, 0, ""), or.val(""), li.setValue("-1")) : t == "MC" ? (l(e.find("option:selected").text(), kt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), kt.find("option:selected").val(), -1, k, 0, ""), kt.val(-1)) : t == "OO" || t == "OT" ? (l(e.find("option:selected").text(), at.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), at.find("option:selected").val(), -1, k, 0, ""), at.val("-1")) : t == "PJ" ? (l(e.find("option:selected").text(), nr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ai.getValue(), -1, k, 0, ""), nr.val(""), ai.setValue("-1")) : t == "PR" ? (l(e.find("option:selected").text(), tr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vi.getValue(), -1, k, 0, ""), tr.val(""), vi.setValue("-1")) : t == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, k, 0, "") : t == "SR" ? (l(e.find("option:selected").text(), yt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), yt.find("option:selected").val(), -1, k, 0, ""), yt.val("-1")) : t == "U1" || t == "U2" ? (l(e.find("option:selected").text(), gt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ni.getValue(), si, k, 0, ""), dt.val("-1"), gt.val(""), ni.setValue("-1")) : (t == "X1" || t == "X2" || t == "X3" || t == "X4" || t == "X5" || t == "X6" || t == "X7" || t == "X8" || t == "X9") && (l(e.find("option:selected").text(), et.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), et.find("option:selected").val(), -1, k, 0, ""), et.val(-1)) } }); tf.on("click", function () { if (o("visible"), ke()) { var n = e.find("option:selected").val(); n == "AC" ? (l(e.find("option:selected").text(), gt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ni.getValue(), si, k, rt.getValue(), st.val()), dt.val("-1"), ni.setValue("-1"), st.val(""), rt.setValue("-1")) : n == "AY" ? (l(e.find("option:selected").text(), vt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vt.find("option:selected").val(), -1, k, 0, ""), vt.val(-1)) : n == "BP" ? (l(e.find("option:selected").text(), st.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), rt.getValue(), -1, k, 0, ""), st.val(""), rt.setValue("-1")) : n == "LF" || n == "LT" ? (l(e.find("option:selected").text(), or.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), li.getValue(), -1, k, 0, ""), or.val(""), li.setValue("-1")) : n == "MC" ? (l(e.find("option:selected").text(), kt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), kt.find("option:selected").val(), -1, k, 0, ""), kt.val(-1)) : n == "OO" || n == "OT" ? (l(e.find("option:selected").text(), at.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), at.find("option:selected").val(), -1, k, 0, ""), at.val("-1")) : n == "PJ" ? (l(e.find("option:selected").text(), nr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ai.getValue(), -1, k, 0, ""), nr.val(""), ai.setValue("-1")) : n == "PR" ? (l(e.find("option:selected").text(), tr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vi.getValue(), -1, k, 0, ""), tr.val(""), vi.setValue("-1")) : n == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, k, 0, "") : n == "SR" ? (l(e.find("option:selected").text(), yt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), yt.find("option:selected").val(), -1, k, 0, ""), yt.val("-1")) : n == "U1" || n == "U2" ? (l(e.find("option:selected").text(), gt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ni.getValue(), si, k, 0, ""), dt.val("-1"), gt.val(""), ni.setValue("-1")) : (n == "X1" || n == "X2" || n == "X3" || n == "X4" || n == "X5" || n == "X6" || n == "X7" || n == "X8" || n == "X9") && (l(e.find("option:selected").text(), et.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), et.find("option:selected").val(), -1, k, 0, ""), et.val(-1)) } }); rf.on("click", function () { ft = !1; hr.css("display", "none") }); rf.on("keydown", function (n) { n.keyCode == 13 && (ft = !1, hr.css("display", "none")) }); sr.on(n.Events.onTouchStartOrClick, "LI", function (n) { var i; if (o("visible"), t(n.target).attr("action") == "first") it != 1 && (it = 1, hi(v, null, function (n) { bi(n); ti.val(it) })); else if (t(n.target).attr("action") == "prev") it != 1 && (it--, hi(v, null, function (n) { bi(n); ti.val(it) })); else if (t(n.target).attr("action") == "next") { if (i = lo(), it >= i) { o("hidden"); return } it++; hi(v, null, function (n) { bi(n); ti.val(it) }) } else if (t(n.target).attr("action") == "last") { if (i = lo(), it >= i) { o("hidden"); return } it = i; hi(v, null, function (n) { bi(n); ti.val(it) }) } o("hidden") }); ti.on("change", function () { o("visible"); it != ti.val() && (it = ti.val(), hi(v, null, function (n) { bi(n); ti.val(it) })); o("hidden") }); uu.on("click", function () { if (o("visible"), Math.abs(parseFloat(ut.getValue())) > Math.abs(parseFloat(p.getValue()))) n.ADialog.warn("LineTotalNotGrater"), p.getControl().focus(), o("hidden"); else if (p.getValue() != "" && p.getValue() != 0) v = [], s.val() == 0 ? v = ot : v[0] = s.val(), ao(i, p.getValue(), -1, v, "", "", "", -1, -1, -1, 0, "", 0, function () { gr.onClosing(i); w.close() }); else { gr.onClosing(i); w.close() } }) } function co() { e.val() == "" || e.val() == 0 ? (y.css("display", "none"), tt.css("display", "none"), ii.html() == "" ? w.getRoot().parent().css("height", "390px") : w.getRoot().parent().css("height", "410px")) : (y.css("display", "block"), tt.css("display", "block"), ii.html() == "" ? w.getRoot().parent().css("height", "448px") : w.getRoot().parent().css("height", "469px")) } function ff() { var f = !1, t = "", e = "", o, r, s; for (ii.empty(), ii.append(""), o = " select distinct ct.totaldimlineamout as amount,ac.name from VAB_DimAmtaccttype ct  inner join VAB_DimAmtline cl on ct.VAB_DimAmt_id=cl.VAB_DimAmt_id and ct.VAB_DimAmtaccttype_id=cl.VAB_DimAmtaccttype_id  inner join VAB_AccountBook ac on ac.VAB_AccountBook_id=ct.VAB_AccountBook_id   where ct.totaldimlineamout in (Select max(totaldimlineamout) from VAB_DimAmtaccttype    where VAB_DimAmt_id=" + i + ") and ct.VAB_DimAmt_id=" + i + "", r = n.DB.executeReader(o); r.read();)r.getInt(0) != null ? (tu.css("display", "block"), f = !0, e = wi.GetFormatedValue(r.getString(0)), t += t == "" ? r.getString(1) : "," + r.getString(1)) : (ii.append(""), f = !1, window.setTimeout(function () { w.getRoot().parent().css("height", "448px") }, 200)); f && (t.length > 55 && (t = t.substring(0, 55) + "..."), ii.append(n.Msg.getMsg("MaxDimensionAmount") + " : " + e + " " + n.Msg.getMsg("ForAcctSchema") + " : " + t), window.setTimeout(function () { w.getRoot().parent().css("height", "470px") }, 200)); i != 0 ? (s = n.DB.executeScalar("select amount from VAB_DimAmt where VAB_DimAmt_id=" + i + ""), Math.abs(parseFloat(u)) > 0 ? p.setValue(u) : p.setValue(s)) : u ? p.setValue(u) : p.setValue(0); ii.html() == "" && (tu.css("display", "none"), w.getRoot().parent().css("height", "448px")) } function ke() { return p.getValue() == "" && p.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateTotalAmount"), p.getControl().focus(), o("hidden"), !1) : s.val() == "" || s.val() == -1 ? (n.ADialog.warn("ValidateAcctSchema"), s.focus(), o("hidden"), !1) : e.val() == "" || e.val() == 0 ? (n.ADialog.warn("ValidateDimType"), e.focus(), o("hidden"), !1) : p.getValue() == "" && p.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateTotalAmount"), p.getControl().focus(), o("hidden"), !1) : ft ? ft ? a.getValue() == "" && a.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateAmount"), a.getControl().focus(), o("hidden"), !1) : Math.abs(parseFloat(a.getValue())) > Math.abs(parseFloat(p.getValue())) ? (n.ADialog.warn("LineTotalNotGrater"), a.getControl().focus(), o("hidden"), !1) : parseFloat(a.getValue()) > 0 && parseFloat(p.getValue()) < 0 ? (n.ADialog.warn("VIS_NegativeAmount"), c.getControl().focus(), o("hidden"), !1) : parseFloat(a.getValue()) < 0 && parseFloat(p.getValue()) > 0 ? (n.ADialog.warn("VIS_PositiveAmount"), c.getControl().focus(), o("hidden"), !1) : ts() ? (o("hidden"), !0) : (o("hidden"), !1) : (o("hidden"), !0) : c.getValue() == "" && c.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateAmount"), c.getControl().focus(), o("hidden"), !1) : Math.abs(parseFloat(c.getValue())) > Math.abs(parseFloat(p.getValue())) ? (n.ADialog.warn("LineTotalNotGrater"), c.getControl().focus(), o("hidden"), !1) : parseFloat(c.getValue()) > 0 && parseFloat(p.getValue()) < 0 ? (n.ADialog.warn("VIS_NegativeAmount"), c.getControl().focus(), o("hidden"), !1) : parseFloat(c.getValue()) < 0 && parseFloat(p.getValue()) > 0 ? (n.ADialog.warn("VIS_PositiveAmount"), c.getControl().focus(), o("hidden"), !1) : ts() ? (o("hidden"), !0) : (o("hidden"), !1) } function ts() { if (e.val() != 0) if (ft) { if (e.val() == "AC") return gt.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), gt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "AY") return vt.val() == -1 || vt.val() == null ? (n.ADialog.warn("ValidateActivity"), vt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "BP") return st.val() == "" ? (n.ADialog.warn("ValidateBPartner"), st.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "LF" || e.val() == "LT") return or.val() == "" ? (n.ADialog.warn("ValidateLocation"), or.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "MC") return kt.val() == -1 || kt.val() == null ? (n.ADialog.warn("ValidateCamp"), pt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "OO" || e.val() == "OT") return at.val() == -1 || at.val() == null ? (n.ADialog.warn("ValidateOrg"), at.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PJ") return nr.val() == "" ? (n.ADialog.warn("ValidateProject"), nr.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PR") return tr.val() == "" ? (n.ADialog.warn("ValidateProduct"), tr.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "SA") return !0; if (e.val() == "SR") return yt.val() == -1 || yt.val() == null ? (n.ADialog.warn("ValidateSales"), yt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "U1" || e.val() == "U2") return dt.val() == -1 || dt.val() == null ? (n.ADialog.warn("ValidateElement"), dt.focus(), o("hidden"), !1) : gt.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), gt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "X1" || e.val() == "X2" || e.val() == "X3" || e.val() == "X4" || e.val() == "X5" || e.val() == "X6" || e.val() == "X7" || e.val() == "X8" || e.val() == "X9") return et.val() == -1 || et.val() == null ? (n.ADialog.warn("ValidateUElement"), et.focus(), o("hidden"), !1) : (o("hidden"), !0) } else { if (e.val() == "AC") return wt.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), wt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "AY") return ri.val() == -1 || ri.val() == null ? (n.ADialog.warn("ValidateActivity"), ri.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "BP") return lt.val() == "" ? (n.ADialog.warn("ValidateBPartner"), lt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "LF" || e.val() == "LT") return rr.val() == "" ? (n.ADialog.warn("ValidateLocation"), rr.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "MC") return pt.val() == -1 || pt.val() == null ? (n.ADialog.warn("ValidateCamp"), pt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "OO" || e.val() == "OT") return ht.val() == -1 || ht.val() == null ? (n.ADialog.warn("ValidateOrg"), ht.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PJ") return ki.val() == "" ? (n.ADialog.warn("ValidateProject"), ki.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PR") return di.val() == "" ? (n.ADialog.warn("ValidateProduct"), di.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "SA") return !0; if (e.val() == "SR") return ui.val() == -1 || ui.val() == null ? (n.ADialog.warn("ValidateSales"), ui.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "U1" || e.val() == "U2") return fi.val() == -1 || fi.val() == null ? (n.ADialog.warn("ValidateElement"), fi.focus(), o("hidden"), !1) : wt.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), wt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "X1" || e.val() == "X2" || e.val() == "X3" || e.val() == "X4" || e.val() == "X5" || e.val() == "X6" || e.val() == "X7" || e.val() == "X8" || e.val() == "X9") return ct.val() == -1 || ct.val() == null ? (n.ADialog.warn("ValidateUElement"), ct.focus(), o("hidden"), !1) : (o("hidden"), !0) } } function hi(r, u, f) { var l = []; return t.ajax({ dataType: "json", type: "POST", url: n.Application.contextUrl + "AmountDivision/GetDiminsionLine", data: { accountingSchema: JSON.stringify(r), dimensionID: i, DimensionLineID: 0, pageNo: it, pSize: ar }, success: function (t) { var i, r; if (t) { if (t = JSON.parse(t), uf = !0, t.length > 0) { for (i = 0; i < t.length; i++)if (i == 0 && uf) { for (be = t[i].TotalRecord, r = lo(), ti.empty(), b = 1; b < r + 1; b++)ti.empty().append("<option value=" + b + ">" + b + "<\/option>"); ti.val(1); uf = !1 } u && (s.val(t[0].AcctSchema), vo(s.val(), function () { e.val(t[0].DimensionTypeVal); ru(e.val()); cr = t[0].DimensionTypeVal; wr = t[0].AcctSchema; ut.setValue(wi.GetFormatedValue(t[0].TotalLineAmount)) })); u || (cr = t[0].DimensionTypeVal, wr = t[0].AcctSchema, ut.setValue(wi.GetFormatedValue(t[0].TotalLineAmount))) } else ti.empty().append('<option value="1">1<\/option>'), ut.setValue(wi.GetFormatedValue(0)); h = t.length; c.setValue(0); ft = !1; tt.empty().append(n.Msg.getMsg("Add")); l = t; f && f(t) } else n.ADialog.error("ErrorGettingData"), o("hidden") }, error: function () { o("hidden"); n.ADialog.error("ErrorGettingData"); return } }), l } function o(n) { ge[0].style.visibility = n } function lo() { var n = be % ar; return n != 0 ? parseInt(be / ar) + 1 : parseInt(be / ar) } function ao(r, u, f, e, s, c, l, a, v, y, p, w, b, k) { o("visible"); u = wi.GetFormatedValue(u); f = wi.GetFormatedValue(f); t.ajax({ dataType: "json", type: "POST", url: n.Application.contextUrl + "AmountDivision/InsertDimensionLine", data: { recordId: r, totalAmount: u, lineAmount: f, acctSchemaID: JSON.stringify(e), elementTypeID: c, dimensionValue: a, elementID: v, oldDimensionName: y, bpartner_ID: n.Utility.Util.getValueOfInt(p), oldBPartner_ID: b }, success: function (t) { var u, r; t = JSON.parse(t); t[0] != "" ? (i = t[0], ff(), ft ? (n.ADialog.info("UpdatedDimLine"), w2ui[oi].set(h, { DimensionName: l }), w2ui[oi].set(h, { DimensionValueAmount: f }), w2ui[oi].set(h, { CalculateDimValAmt: f }), c == "AC" && (w2ui[oi].set(h, { VAB_BusinessPartner: w }), w2ui[oi].set(h, { VAB_BusinessPartner_ID: p })), r = wi.GetFormatedValue((parseFloat(parseFloat(ut.getValue()) - parseFloat(we)) + parseFloat(f)).toFixed(iu)), ut.setValue(r)) : (u = w2ui[oi].records.length, c == "AC" ? w2ui[oi].add({ recid: u + 1, DimensionType: s, DimensionName: l, VAB_BusinessPartner: w, DimensionValueAmount: f, lineAmountID: t[1], CalculateDimValAmt: f, VAB_BusinessPartner_ID: p }) : w2ui[oi].add({ recid: u + 1, DimensionType: s, DimensionName: l, DimensionValueAmount: f, lineAmountID: t[1], CalculateDimValAmt: f }), r = wi.GetFormatedValue((parseFloat(ut.getValue()) + parseFloat(f)).toFixed(iu)), ut.setValue(r)), o("hidden")) : (n.ADialog.error("ErrorGettingData"), o("hidden")); k && k() }, error: function () { o("hidden"); n.ADialog.error("ErrorGettingData"); retval = !1; loading = !1 } }) } function l(t, r, u, f, e, s, h, l, y, w, b) { var d, g, k; if (u = wi.GetFormatedValue(u.toFixed(iu)), d = "", v = [], e == 0 ? v = ot : v[0] = e, ft) if (k = "select nvl(cline.VAB_DimAmtline_id,0) as DimLineID from VAB_DimAmt cd inner join VAB_DimAmtaccttype cact on cd.VAB_DimAmt_id=cact.VAB_DimAmt_id  inner join VAB_DimAmtline cline on cd.VAB_DimAmt_id=cline.VAB_DimAmt_id and cact.VAB_DimAmtaccttype_id=cline.VAB_DimAmtaccttype_id  where cd.VAB_DimAmt_id=" + i + " and cact.elementtype='" + s + "' and cact.VAB_AccountBook_id in(" + v.toString() + ") and cline.VAB_DimAmtline_id not in (" + y + ") ", s == "AC" ? k += " and VAB_Acct_Element_ID=" + h + " AND NVL(VAB_BusinessPartner_ID,0)=" + w : s == "AY" ? k += " and VAB_BillingCode_ID =" + h : s == "BP" ? k += " and VAB_BusinessPartner_ID=" + h : s == "LF" || s == "LT" ? k += " and VAB_Address_ID=" + h : s == "MC" ? k += " and VAB_Promotion_ID=" + h : s == "OO" || s == "OT" ? k += " and Org_ID=" + h : s == "PJ" ? k += " and VAB_Project_ID=" + h : s == "PR" ? k += " and VAM_Product_ID=" + h : s == "SA" || (s == "SR" ? k += " and VAB_SalesRegionState_ID=" + h : s == "U1" || s == "U2" ? k += " and VAB_Acct_Element_ID=" + h : (s == "X1" || s == "X2" || s == "X3" || s == "X4" || s == "X5" || s == "X6" || s == "X7" || s == "X8" || s == "X9") && (k += " and VAF_Column_ID=" + h)), d = n.DB.executeScalar(k), d == null) g = n.DB.executeScalar("select amount from VAB_DimAmtline where VAB_DimAmtline_id in (" + y + ") and rownum=1"), Math.abs(parseFloat(ut.getValue()) + parseFloat(u) - parseFloat(g)) <= Math.abs(parseFloat(p.getValue())) ? ao(i, p.getValue(), u, v, t, s, r, h, l, so, w, b, ns, function () { de() }) : (n.ADialog.warn("LineTotalNotGrater"), a.setValue(0), a.getControl().focus(), de()); else return n.ADialog.warn("NameExists"), a.setValue(0), o("hidden"), !1; else if (Math.abs(parseFloat(ut.getValue()) + parseFloat(u)) <= Math.abs(parseFloat(p.getValue()))) if (k = "select nvl(cline.VAB_DimAmtline_id,0) as DimLineID from VAB_DimAmt cd inner join VAB_DimAmtaccttype cact on cd.VAB_DimAmt_id=cact.VAB_DimAmt_id  inner join VAB_DimAmtline cline on cd.VAB_DimAmt_id=cline.VAB_DimAmt_id and cact.VAB_DimAmtaccttype_id=cline.VAB_DimAmtaccttype_id  where cd.VAB_DimAmt_id=" + i + " and cact.elementtype='" + s + "' and cact.VAB_AccountBook_id in(" + v.toString() + ")", s == "AC" ? k += " and VAB_Acct_Element_ID=" + h + " AND VAB_BusinessPartner_ID=" + w : s == "AY" ? k += " and VAB_BillingCode_ID =" + h : s == "BP" ? k += " and VAB_BusinessPartner_ID=" + h : s == "LF" || s == "LT" ? k += " and VAB_Address_ID=" + h : s == "MC" ? k += " and VAB_Promotion_ID=" + h : s == "OO" || s == "OT" ? k += " and Org_ID=" + h : s == "PJ" ? k += " and VAB_Project_ID=" + h : s == "PR" ? k += " and VAM_Product_ID=" + h : s == "SA" || (s == "SR" ? k += " and VAB_SalesRegionState_ID=" + h : s == "U1" || s == "U2" ? k += " and VAB_Acct_Element_ID=" + h : (s == "X1" || s == "X2" || s == "X3" || s == "X4" || s == "X5" || s == "X6" || s == "X7" || s == "X8" || s == "X9") && (k += " and VAF_Column_ID=" + h)), d = n.DB.executeScalar(k), d == null) ao(i, p.getValue(), u, v, t, s, r, h, l, 0, w, b, 0, function () { de() }); else return n.ADialog.warn("NameExists"), f = f - 1, c.setValue(0), o("hidden"), !1; else n.ADialog.warn("LineTotalNotGrater"), c.setValue(0), c.getControl().focus(), f = f - 1, de() } function de() { c.setValue(0); ft = !1; ir.css("display", "none"); hr.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? y.css("width", "25%") : y.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")) } function is() { fu = null; ht = null; af = null; ri = null; vf = null; pt = null; yf = null; ui = null; pf = null; ct = null; lr = null; lt = null; wf = null; ki = null; bf = null; di = null; kf = null; df = null; fi = null; ee = null; at = null; oe = null; vt = null; se = null; kt = null; he = null; yt = null; ce = null; et = null; pr = null; st = null; le = null; nr = null; ae = null; tr = null; ve = null; ye = null; dt = null; g.empty(); d.empty(); si = 0; ho = !0 } function ru(n) { is(); n == "AC" ? fs() : n == "AY" ? as() : n == "BP" ? ws() : n == "LF" ? us() : n == "LT" ? us() : n == "MC" ? vs() : n == "OO" ? rs(n) : n == "OT" ? rs(n) : n == "PJ" ? bs() : n == "PR" ? ks() : n == "SA" || (n == "SR" ? ys() : n == "U1" || n == "U2" ? fs() : (n == "X1" || n == "X2" || n == "X3" || n == "X4" || n == "X5" || n == "X6" || n == "X7" || n == "X8" || n == "X9") && ps()) } function ls(r, u) { t.ajax({ url: n.Application.contextUrl + "AmountDivision/GetAccountingSchema", dataType: "json", data: { OrgID: r }, type: "POST", error: function () { o("hidden"); alert(n.Msg.getMsg("ErrorWhileGettingData")); return }, success: function (r) { var h = n.DB.executeScalar("select VAB_AccountBook1_id from VAF_ClientDetail where vaf_client_ID=" + n.Env.getCtx().getVAF_Client_ID() + ""), l = !1, e = JSON.parse(r), f, c; if (e.Error) { n.ADialog.error(e.Error); o("hidden"); return } for (s.empty().append('<option selected="selected" value="-1">Please select<\/option>'), f = 0; f < e.length; f++)f == 0 && s.append('<option precision="' + iu + '" value="0">ALL<\/option>'), h == e[f].Key && (l = !0), s.append(t('<option precision="' + e[f].Precision + '"><\/option>').val(e[f].Key).html(e[f].Value)), ot.push(e[f].Key); l && (c = n.DB.executeScalar("select cd.VAB_AccountBook_id from VAB_DimAmtaccttype cd inner join VAB_DimAmtline cl on cd.VAB_DimAmtaccttype_id=cl.VAB_DimAmtaccttype_id where cd.VAB_DimAmt_id=" + i + ""), (c == "" || c == null) && (s.val(h), vo(h))); u && (o("visible"), u(), o("hidden")) } }) } function vo(i, r) { o("visible"); t.ajax({ url: n.Application.contextUrl + "AmountDivision/GetDiminsionType", dataType: "json", data: "{}", type: "POST", error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); o("hidden"); return }, success: function (u) { var s = "", h = JSON.parse(u), c, f; if (h.Error) { n.ADialog.error(h.Error); o("hidden"); return } if (i == 0) { for (f = 0; f < ot.length; f++)f == 0 ? s = "SELECT Distinct ElementType, Name FROM VAB_AccountBook_Element WHERE  VAB_AccountBook_id =" + ot[f] + " AND ElementType NOT IN('SA','X1','X2','X3','X4','X5','X6','X7','X8','X9') " : s += " AND ElementType IN(SELECT ElementType FROM VAB_AccountBook_Element WHERE  VAB_AccountBook_id =" + ot[f] + " AND ElementType NOT IN('SA','X1','X2','X3','X4','X5','X6','X7','X8','X9')) "; s += " ORDER BY ElementType" } else s = "SELECT Distinct ElementType, Name FROM VAB_AccountBook_Element WHERE  VAB_AccountBook_id =" + i + " AND ElementType<>'SA' ORDER BY ElementType"; for (s = n.MRole.addAccessSQL(s, "VAB_AccountBook_Element", n.MRole.SQL_FULLYQUALIFIED, n.MRole.SQL_RW), c = n.DB.executeReader(s), e.empty().append('<option selected="selected" value="0">Please select<\/option>'); c.read();)for (f = 0; f < h.length; f++)if (h[f].Key == c.getString(0)) { e.append(t("<option><\/option>").val(h[f].Key).html(c.getString(1))); break } r && r(); o("hidden") } }) } function ds(t, r, u) { n.ADialog.confirm("DeleteConfirm", !0, "", "Confirm", function (f) { var e, s, h; f && (o("visible"), n.DB.executeQuery("delete from VAB_DimAmtline where VAB_DimAmtline_id in(" + t + ")"), e = "select nvl((sum(cd.amount)),0) as Amount from VAB_DimAmtline cd inner join VAB_DimAmtaccttype ct on cd.VAB_DimAmt_id=ct.VAB_DimAmt_id  and cd.VAB_DimAmtaccttype_id=ct.VAB_DimAmtaccttype_id  where cd.VAB_DimAmt_id=" + i + " and ct.VAB_AccountBook_id=" + v[0] + "", s = n.DB.executeScalar(e), n.DB.executeQuery("update VAB_DimAmtaccttype set totaldimlineamout=" + s + " where VAB_DimAmt_id=" + i + " and VAB_AccountBook_id=" + v[0] + ""), w2ui[oi].select(u), console.log("selected Rows : " + w2ui[oi].getSelection().length), w2ui[oi].delete(!0), h = parseFloat((ut.getValue() - parseFloat(r)).toFixed(iu)), ut.setValue(h), ff(), o("hidden")) }) } function gs(r, u, f) { o("visible"); var c = []; hr.css("display", "table"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? gi.css({ width: "11%", "padding-right": "0" }) : y.css("width", "33.3%"); ft = !0; v = []; s.val() == 0 ? v = ot : v[0] = s.val(); t.ajax({ dataType: "json", type: "POST", url: n.Application.contextUrl + "AmountDivision/GetDiminsionLine", data: { accountingSchema: JSON.stringify(v), dimensionID: i, DimensionLineID: r[0], pageNo: it, pSize: ar }, success: function (n) { if (n) { c = JSON.parse(n); h = f; k = r.toString(); var t = e.val(); DimensionNameVal = c[0].DimensionNameVal; so = c[0].DimensionNameVal; a.setValue(c[0].CalculateDimValAmt); we = c[0].CalculateDimValAmt; ns = c[0].VAB_BusinessPartner_ID; e.val() == "AC" ? (si = c[0].ElementID, ni.setValue(DimensionNameVal), rt.setValue(c[0].VAB_BusinessPartner_ID > 0 ? c[0].VAB_BusinessPartner_ID : -1)) : t == "AY" ? (vt.focus(), vt.val(DimensionNameVal)) : t == "BP" ? (rt.getControl(0).val(rt.getDisplay()), rt.setValue(DimensionNameVal)) : t == "LF" || t == "LT" ? (li.getControl(0).val(li.getDisplay()), li.setValue(DimensionNameVal)) : t == "MC" ? (kt.focus(), kt.val(DimensionNameVal)) : t == "OO" || t == "OT" ? (at.focus(), at.val(DimensionNameVal)) : t == "PJ" ? (ai.getControl(0).val(ai.getDisplay()), ai.setValue(DimensionNameVal)) : t == "PR" ? (vi.getControl(0).val(vi.getDisplay()), vi.setValue(DimensionNameVal)) : t == "SA" || (t == "SR" ? (yt.focus(), yt.val(DimensionNameVal)) : t == "U1" || t == "U2" ? (dt.focus(), dt.val(editArrayData[0].ElementID), ni.getControl(0).val(ni.getDisplay()), ni.setValue(DimensionNameVal)) : (t == "X1" || t == "X2" || t == "X3" || t == "X4" || t == "X5" || t == "X6" || t == "X7" || t == "X8" || t == "X9") && (et.focus(), et.val(DimensionNameVal))); o("hidden") } } }) } var bi, es; i && i.toString().indexOf("<") > -1 && (i = 0); this.onClose = null; this.onClosing = null; var br = t("<div style='width:100%;height:100%;position:relative'>"), ef = t("<div class='VIS-AMTD-MainContent'>"), ge = t("<div class='vis-apanel-busy' style='height:100%;position:absolute;z-index: 2'>"), nh = t("<table>"), s, e, p, ht, c, tt, uu, ir, os, of, sf, hf, fu, cf, ut, lf, af, ri, vf, pt, yf, ui, pf, ct, lr, lt, no, rr, wf, ki, bf, di, kf, df, fi, wt, ci, ar = null, it = null, kr = null, ei = null, gf = null, g = null, yo = null, nt = n.Env.getWindowNo(), h = null, ft = null, po = null, wo = null, ne = null, bt = null, ur = null, fr = null, er = "", rt = null, li = null, ai = null, vi = null, v = null, ss = null, w = new n.ChildDialog, te = null, eu = null, dr = null, vr = null, ou = null, yi = null, su = null, hu = null, cu = null, lu = null, au = null, vu = null, y = null, bo = null, ko = null, go = null, ot = null, gr = this, ie = null, re = null, hr = null, ue = null, to = null, fe = null, yu = null, nu = null, yr = null, pu = null, pi = null, wu = null, bu = null, ku = null, du = null, gu = null, nf = null, gi = null, d = null, at, a, tf, rf, ee, io, oe, vt, se, kt, he, yt, ce, et, pr, st, ro, or, le, nr, ae, tr, ve, ye, dt, gt, ni, pe = null, sr = null, uo = null, fo = null, ti = null, eo = null, oo = null, uf = null, oi = null, k = null, we = null, ii = null, tu = null, wi = null; this.dotFormatter = n.Env.isDecimalPoint(); var iu = n.Env.getCtx().getContextAsInt("#StdPrecision"), hs = null, cr = null, wr = null, so = null, be = 0, si = 0, ho = !0, ns = 0; this.vetoablechange = function (n) { n.propertyName == "Amount" ? c.setValue(n.newValue) : n.propertyName == "ModalAmount" && a.setValue(n.newValue) }; var rs = function (i) { var r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); y.css("width", "33.3%"); fu = t("<label>"); ee = t("<label>"); r = ""; r = i == "OO" ? " AND IsSummary='N' AND IsCostCenter='N' AND IsProfitCenter='N'" : " AND IsSummary='N' AND (IsCostCenter='Y' OR IsProfitCenter='Y')"; var u = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAF_Org_ID", 0, !1, "VAF_Org_ID<>0" + r), f = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAF_Org_ID", 0, !1, "VAF_Org_ID<>0" + r), e = new n.Controls.VComboBox("Org_ID", !1, !1, !0, u, 50), o = new n.Controls.VComboBox("Org_ID", !1, !1, !0, f, 50); ht = e.getControl(); ht.find("option[value=0]").remove(); ht.attr("tabindex", "4"); at = o.getControl(); at.attr("tabindex", "9"); fu.append(n.Msg.translate(n.Env.getCtx(), "Org_ID")); ee.append(n.Msg.translate(n.Env.getCtx(), "Org_ID")); eu = t("<div class='VIS-AMTD-formData'>"); eu.css("width", "100%"); yu = t("<div class='VIS-AMTD-formData'>"); yu.css("width", "100%"); eu.append(fu).append(ht); g.append(eu); yu.append(ee).append(at); d.append(yu); ht.focus(); at.focus() }, as = function () { g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); y.css("width", "33.3%"); af = t("<label>"); oe = t("<label>"); var i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_BillingCode_ID", 0, !1, null), r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_BillingCode_ID", 0, !1, null), u = new n.Controls.VComboBox("VAB_BillingCode_ID", !1, !1, !0, i, 50), f = new n.Controls.VComboBox("VAB_BillingCode_ID", !1, !1, !0, r, 50); ri = u.getControl(); ri.attr("tabindex", "4"); vt = f.getControl(); vt.attr("tabindex", "9"); af.append(n.Msg.translate(n.Env.getCtx(), "VAB_BillingCode_ID")); ou = t("<div class='VIS-AMTD-formData'>"); ou.css("width", "100%"); ou.append(af).append(ri); g.append(ou); ri.focus(); oe.append(n.Msg.translate(n.Env.getCtx(), "VAB_BillingCode_ID")); pu = t("<div class='VIS-AMTD-formData'>"); pu.css("width", "100%"); pu.append(oe).append(vt); d.append(pu); vt.focus() }, vs = function () { g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); y.css("width", "33.3%"); vf = t("<label>"); se = t("<label>"); var i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_Promotion_ID", 0, !1, null), r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_Promotion_ID", 0, !1, null), u = new n.Controls.VComboBox("VAB_Promotion_ID", !1, !1, !0, i, 50), f = new n.Controls.VComboBox("VAB_Promotion_ID", !1, !1, !0, r, 50); pt = u.getControl(); pt.attr("tabindex", "4"); kt = f.getControl(); kt.attr("tabindex", "9"); vf.append(n.Msg.translate(n.Env.getCtx(), "VAB_Promotion_ID")); hu = t("<div class='VIS-AMTD-formData'>"); hu.css("width", "100%"); hu.append(vf).append(pt); g.append(hu); pt.focus(); se.append(n.Msg.translate(n.Env.getCtx(), "VAB_Promotion_ID")); bu = t("<div class='VIS-AMTD-formData'>"); bu.css("width", "100%"); bu.append(se).append(kt); d.append(bu); kt.focus() }, ys = function () { var i, r, u, f; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); y.css("width", "33.3%"); yf = t("<label>"); he = t("<label>"); i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_SalesRegionState_ID", 0, !1, null); r = new n.Controls.VComboBox("VAB_SalesRegionState_ID", !1, !1, !0, i, 50); ui = r.getControl(); ui.attr("tabindex", "4"); yf.append(n.Msg.translate(n.Env.getCtx(), "VAB_SalesRegionState_ID")); au = t("<div class='VIS-AMTD-formData'>"); au.css("width", "100%"); au.append(yf).append(ui); g.append(au); ui.focus(); u = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_SalesRegionState_ID", 0, !1, null); f = new n.Controls.VComboBox("VAB_SalesRegionState_ID", !1, !1, !0, u, 50); yt = f.getControl(); yt.attr("tabindex", "9"); he.append(n.Msg.translate(n.Env.getCtx(), "VAB_SalesRegionState_ID")); gu = t("<div class='VIS-AMTD-formData'>"); gu.css("width", "100%"); gu.append(he).append(yt); d.append(gu); yt.focus() }, ps = function () { var i, r; ct = t("<select>"); et = t("<select>"); for (var i = "select adt.vaf_column_id,adt.columnname,adtab.TableName from VAB_AccountBook_element ac inner join vaf_column ad on ac.vaf_column_id=ad.vaf_column_id  inner join vaf_column adt on ad.vaf_tableview_ID=adt.vaf_tableview_ID and adt.isactive='Y'   inner join vaf_tableview adtab on adtab.vaf_tableview_id=ad.vaf_tableview_ID  where ac.VAB_AccountBook_id=" + v[0] + " and ac.elementtype='" + e.find("option:selected").val() + "' and adt.isidentifier='Y' order by adt.vaf_column_ID", f = n.DB.executeReader(i), u = "", o = ""; f.read();)u = f.getString(2), o += o == "" ? f.getString(1) : " ||'_'|| " + f.getString(1); if (g.css({ width: "33.3%" }), d.css({ width: "33.3%" }), y.css("width", "33.3%"), pf = t("<label>"), ct.empty().append("<option value=-1><\/option>"), et.empty().append("<option value=-1><\/option>"), u != "") for (i = "SELECT " + u + "_ID ,(" + o + ") as Name FROM " + u + " WHERE isactive='Y' ORDER BY " + o, i = n.MRole.addAccessSQL(i, u, n.MRole.SQL_FULLYQUALIFIED, n.MRole.SQL_RW), r = n.DB.executeReader(i); r.read();)ct.append("<option value=" + r.getInt(0) + ">" + r.getString(1) + "<\/option>"), et.append("<option value=" + r.getInt(0) + ">" + r.getString(1) + "<\/option>"); ct.attr("tabindex", "4"); pf.append(n.Msg.translate(n.Env.getCtx(), "VAF_Column_ID")); vu = t("<div class='VIS-AMTD-formData'>"); vu.css("width", "100%"); vu.append(pf).append(ct); g.append(vu); ct.focus(); ce = t("<label>"); et.attr("tabindex", "9"); ce.append(n.Msg.translate(n.Env.getCtx(), "VAF_Column_ID")); nf = t("<div class='VIS-AMTD-formData'>"); nf.css("width", "100%"); nf.append(ce).append(et); d.append(nf); et.focus() }, ws = function () { var i, r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); y.css("width", "33.3%"); lr = t("<label>"); i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_BusinessPartner_ID", 0, !1, null); bt = new n.Controls.VTextBoxButton("VAB_BusinessPartner_ID", !1, !1, !0, n.DisplayType.Search, i); lt = bt.getControl(); lt.attr("tabindex", "4"); lr.append(n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID")); yi = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); yi.css("width", "100%"); yi.append(lr).append(lt).append(bt.getBtn(0)); g.append(yi); pr = t("<label>"); r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_BusinessPartner_ID", 0, !1, null); rt = new n.Controls.VTextBoxButton("VAB_BusinessPartner_ID", !1, !1, !0, n.DisplayType.Search, r); st = rt.getControl(); st.attr("tabindex", "9"); pr.append(n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID")); pi = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); pi.css("width", "100%"); pi.append(pr).append(st).append(rt.getBtn(0)); d.append(pi) }, us = function () { var i, r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); y.css("width", "33.3%"); no = t("<label>"); i = new n.MLocationLookup(n.Env.getCtx(), nt); ur = new n.Controls.VLocation("VAB_Address_ID", !1, !1, !0, n.DisplayType.Location, i); rr = ur.getControl(); rr.attr("tabindex", "4"); no.append(n.Msg.translate(n.Env.getCtx(), "VAB_Address_ID")); su = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); su.css("width", "100%"); su.append(no).append(rr).append(ur.getBtn(1)); g.append(su); ro = t("<label>"); r = new n.MLocationLookup(n.Env.getCtx(), nt); li = new n.Controls.VLocation("VAB_Address_ID", !1, !1, !0, n.DisplayType.Location, r); or = li.getControl(); or.attr("tabindex", "9"); ro.append(n.Msg.translate(n.Env.getCtx(), "VAB_Address_ID")); wu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); wu.css("width", "100%"); wu.append(ro).append(or).append(li.getBtn(1)); d.append(wu) }, bs = function () { var i, r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); y.css("width", "33.3%"); wf = t("<label>"); i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_Project_ID", 0, !1, null); fr = new n.Controls.VTextBoxButton("VAB_Project_ID", !1, !1, !0, n.DisplayType.Search, i); ki = fr.getControl(); ki.attr("tabindex", "4"); wf.append(n.Msg.translate(n.Env.getCtx(), "VAB_Project_ID")); lu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); lu.css("width", "100%"); lu.append(wf).append(ki).append(fr.getBtn(0)); g.append(lu); le = t("<label>"); r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_Project_ID", 0, !1, null); ai = new n.Controls.VTextBoxButton("VAB_Project_ID", !1, !1, !0, n.DisplayType.Search, r); nr = ai.getControl(); nr.attr("tabindex", "9"); le.append(n.Msg.translate(n.Env.getCtx(), "VAB_Project_ID")); du = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); du.css("width", "100%"); du.append(le).append(nr).append(ai.getBtn(0)); d.append(du) }, ks = function () { var i, r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); y.css("width", "33.3%"); bf = t("<label>"); i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAM_Product_ID", 0, !1, null); er = new n.Controls.VTextBoxButton("VAM_Product_ID", !1, !1, !0, n.DisplayType.Search, i); di = er.getControl(); di.attr("tabindex", "4"); bf.append(n.Msg.translate(n.Env.getCtx(), "VAM_Product_ID")); cu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); cu.css("width", "100%"); cu.append(bf).append(di).append(er.getBtn(0)); g.append(cu); ae = t("<label>"); r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAM_Product_ID", 0, !1, null); vi = new n.Controls.VTextBoxButton("VAM_Product_ID", !1, !1, !0, n.DisplayType.Search, r); tr = vi.getControl(); tr.attr("tabindex", "9"); ae.append(n.Msg.translate(n.Env.getCtx(), "VAM_Product_ID")); ku = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); ku.css("width", "100%"); ku.append(ae).append(tr).append(vi.getBtn(0)); d.append(ku) }, fs = function () { var u, f, i, o, s, r; if (si = n.dataContext.getJSONData(n.Application.contextUrl + "AmountDivision/GetElementID", { accountingSchema: JSON.stringify(v) }, null), si == 0) return ho = !1, !1; g.css({ width: "67.1%" }); d.css({ width: "67.1%", "margin-right": "9px" }); y.css("width", "26.5%"); gi.css("width", "26.5%"); kf = t("<label>"); df = t("<label>"); kf.append(n.Msg.translate(n.Env.getCtx(), "VAB_Element_ID")); df.append(n.Msg.translate(n.Env.getCtx(), "VAB_Acct_Element_ID")); i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_Element_ID", 0, !1, null); u = new n.Controls.VComboBox("VAB_Element_ID", !1, !1, !0, i, 50); fi = u.getControl(); fi.attr("tabindex", "4"); dr = t("<div class='VIS-AMTD-formData'>"); dr.css("width", "51%"); dr.append(kf).append(fi); g.append(dr); dr.hide(); f = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_Acct_Element_ID", 0, !1, "VAB_Element_ID=" + si); ci = new n.Controls.VTextBoxButton("VAB_Acct_Element_ID", !1, !1, !0, n.DisplayType.Search, f); wt = ci.getControl(); wt.attr("tabindex", "4"); vr = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); vr.css("width", "51%"); vr.append(df).append(wt).append(ci.getBtn(0)); g.append(vr); fi.on("change", function () { var t = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_Acct_Element_ID", 0, !1, "VAB_Element_ID=" + fi.val()); wt.lookup = t }); wt.focus(); lr = t("<label>"); i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_BusinessPartner_ID", 0, !1, null); bt = new n.Controls.VTextBoxButton("VAB_BusinessPartner_ID", !1, !1, !0, n.DisplayType.Search, i); lt = bt.getControl(); lt.attr("tabindex", "5"); lr.append(n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID")); yi = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); yi.css("width", "49%"); yi.append(lr).append(lt).append(bt.getBtn(0)); g.append(yi); e.val() == "AC" ? (ei.showColumn("VAB_BusinessPartner"), vr.css("width", "49%"), yi.css("width", "48%").css("margin-left", "9px"), y.css("width", "25%"), gi.css("width", "25%")) : (vr.css("width", "51%"), yi.css("width", "49%").css("margin-left", ""), y.css("width", "26.5%"), gi.css("width", "26.5%")); ve = t("<label>"); ye = t("<label>"); ve.append(n.Msg.translate(n.Env.getCtx(), "VAB_Element_ID")); ye.append(n.Msg.translate(n.Env.getCtx(), "VAB_Acct_Element_ID")); r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_Element_ID", 0, !1, null); o = new n.Controls.VComboBox("VAB_Element_ID", !1, !1, !0, r, 50); dt = o.getControl(); dt.attr("tabindex", "9"); nu = t("<div class='VIS-AMTD-formData'>"); nu.css("width", "51%"); nu.append(ve).append(dt); d.append(nu); nu.hide(); s = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_Acct_Element_ID", 0, !1, "VAB_Element_ID=" + si); ni = new n.Controls.VTextBoxButton("VAB_Acct_Element_ID", !1, !1, !0, n.DisplayType.Search, s); gt = ni.getControl(); gt.attr("tabindex", "9"); yr = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); yr.css("width", "51%"); yr.append(ye).append(gt).append(ni.getBtn(0)); d.append(yr); dt.on("change", function () { var t = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_Acct_Element_ID", 0, !1, "VAB_Element_ID=" + dt.val()); gt.lookup = t }); gt.focus(); pr = t("<label>"); r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "VAB_BusinessPartner_ID", 0, !1, null); rt = new n.Controls.VTextBoxButton("VAB_BusinessPartner_ID", !1, !1, !0, n.DisplayType.Search, r); st = rt.getControl(); st.attr("tabindex", "10"); pr.append(n.Msg.translate(n.Env.getCtx(), "VAB_BusinessPartner_ID")); pi = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>"); pi.css("width", "49%"); e.val() == "AC" ? (yr.css("width", "49%"), pi.css("width", "48%").css("margin-left", "9px"), gi.css("width", "25%")) : (yr.css("width", "51%"), pi.css("width", "49%"), gi.css("width", "26.5%")); pi.append(pr).append(st).append(rt.getBtn(0)); d.append(pi) }; bi = function (i) { var r = []; r.push({ field: "DimensionType", caption: "Dimension Type", size: "30%", min: 217 }); r.push({ field: "DimensionName", caption: "Dimension Name", size: "30%", min: 217 }); r.push({ field: "VAB_BusinessPartner", caption: "Business Partner", size: "30%", min: 217, hidden: !0 }); r.push({ field: "DimensionValueAmount", caption: "Dimension Value Amount", size: "30%", min: 216, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.DimensionValueAmount); return i.toLocaleString() } }); r.push({ field: "Edit", caption: "", size: "5%", resizable: !1, render: function () { return '<a  tabindex="8"><div><img src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/Edit_sub16.png" alt="Edit record" title="Edit record" style="opacity: 1;cursor:pointer"><\/div><\/a>' } }); r.push({ field: "Delete", caption: "", size: "5%", resizable: !1, render: function () { return '<a id="a1" tabindex="14"><div><img src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/delete10.png" alt="Delete record" title="Delete record" style="opacity: 1;cursor:pointer"><\/div><\/a>' } }); r.push({ field: "lineAmountID", caption: "lineAmountID", hidden: !0, resizable: !1, min: 0, max: 0 }); r.push({ field: "CalculateDimValAmt", caption: "CalculateDimValAmt", hidden: !0, resizable: !1, min: 0, max: 0 }); r.push({ field: "VAB_BusinessPartner_ID", caption: "VAB_BusinessPartner", hidden: !0, resizable: !1, min: 0, max: 0 }); kr = "gridAmountDivision" + Math.random(); kr = kr.replace(".", ""); oi = kr; w2utils.encodeTags([]); ei = t(gf).w2grid({ name: kr, recordHeight: 20, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !1, selectColumn: !1, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: r, records: i, onClick: function (t) { if (t.column == 4 && ei.records.length > 0) { ne = t.recid; var i = ei.get(t.recid).lineAmountID, r = []; i.search(",") == -1 ? r[0] = i : r = i.split(","); gs(r, ei.get(t.recid).CalculateDimValAmt, t.recid) } t.column == 5 && ei.records.length > 0 && (tt.html() == n.Msg.getMsg("Update") && ne == t.recid ? n.ADialog.warn("PleaseFirstUpdateThisRecord") : ds(ei.get(t.recid).lineAmountID, ei.get(t.recid).CalculateDimValAmt, t.recid)) } }); e.val() == "AC" && ei.showColumn("VAB_BusinessPartner") }; this.show = function () { es(); w.getRoot(); o("visible"); c.addVetoableChangeListener(this); a.addVetoableChangeListener(this); ls(r, function () { hi(ot, !0, function (n) { bi(n); v[0] = s.val(); ff(); i == 0 || n.length == 0 ? (y.css("display", "none"), tt.css("display", "none"), w.getRoot().parent().css("height", "390px")) : (y.css("display", "block"), tt.css("display", "block"), ii.html() == "" ? w.getRoot().parent().css("height", "448px") : w.getRoot().parent().css("height", "469px")); o("hidden") }) }) }; cs(); es = function () { w.setContent(br); w.setWidth(750); w.setTitle(n.Msg.getMsg("AmountDimension")); w.setModal(!0); w.setEnableResize(!1); w.show(); w.hideButtons(); w.onClose = function () { gr.onClosing(i); gr.onClose && gr.onClose() } } } n.AmountDivision = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s) { function ei() { y.css("width", "100%"); y.css("height", "100%"); y.css("position", "relative"); yt = t("<div class='vis-info-l-s-wrap vis-leftsidebarouterwrap'>"); ct = t("<div>"); yt.append(ct); lt = t("<div class='vis-info-datasec'>"); rt = t("<div class='vis-info-btnsec'>"); ht.append(yt); ht.append(lt); ht.append(rt); at = n.Msg.getMsg("Refresh"); at.indexOf("&") > -1 && (at = at.replace("&", "")); ft = n.Msg.getMsg("Cancel"); ft.indexOf("&") > -1 && (ft = ft.replace("&", "")); et = n.Msg.getMsg("Ok"); et.indexOf("&") > -1 && (et = et.replace("&", "")); nt = t("<div class='vis-info-btnswrap'>"); ot = t("<button class='VIS_Pref_btn-2'>").append(ft); st = t("<button class='VIS_Pref_btn-2'>").append(et); nt.append(ot); nt.append(st); rt.append(nt); pt = t("<div class='vis-info-btnleft'>"); vt = t("<button class='VIS_Pref_btn-2' style='margin-top: 10px;'>").append(t("<i class='vis vis-refresh'><\/i>")); bt = t('<div class="vis-info-pagingwrp">'); ai(); bt.append(kt); nt.append(ot); nt.append(st); pt.append(vt); rt.append(pt); rt.append(bt); rt.append(nt); a = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); a[0].style.visibility = "visible"; y.append(ht); y.append(a) } function oi() { if (!n.Application.isMobile) y.on("keyup", function (t) { t.keyCode === 13 && (a[0].style.visibility = "visible", s != null && s.length > 0 && (s = n.Env.parseContext(n.Env.getCtx(), r, s, !1, !1)), it(!0, l.val())) }); ot.on("click", function () { ut.onClose != null && ut.onClose(); wt() }); st.on("click", function () { gt() }); vt.on("click", function () { a[0].style.visibility = "visible"; s != null && s != undefined && s.length > 0 && (s = n.Env.parseContext(n.Env.getCtx(), r, s, !1, !1)); it(!0, l.val()) }) } function si() { ut.onClose != null && ut.onClose(); wt() } function li(n) { var i, t; if (o) if (n.index) t = w2ui[n.target].records[n.index][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1); else for (i = 0; i < w2ui[n.target].records.length; i++)t = w2ui[n.target].records[i][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1) } function ai() { kt = t('<ul class="vis-statusbar-ul">'); b = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="' + n.Msg.getMsg("FirstPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); k = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.getMsg("PageUp") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); l = t("<select>"); dt = t("<li>").append(l); d = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.getMsg("PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); g = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="' + n.Msg.getMsg("LastPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); kt.append(b).append(k).append(dt).append(d).append(g); vi() } function vi() { b.on("click", function () { t(this).css("opacity") == "1" && it(!0, 1) }); k.on("click", function () { t(this).css("opacity") == "1" && it(!0, parseInt(l.val()) - 1) }); d.on("click", function () { t(this).css("opacity") == "1" && it(!0, parseInt(l.val()) + 1) }); g.on("click", function () { t(this).css("opacity") == "1" && it(!0, parseInt(l.find("Option:last").val())) }); l.on("change", function () { it(!0, l.val()) }) } function yi(n) { if (l.empty(), n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)l.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); l.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (d.css("opacity", "1"), g.css("opacity", "1")) : (d.css("opacity", "0.6"), g.css("opacity", "0.6")); n.CurrentPage > 1 ? (b.css("opacity", "1"), k.css("opacity", "1")) : (b.css("opacity", "0.6"), k.css("opacity", "0.6")); n.TotalPage == 1 && (b.css("opacity", "0.6"), k.css("opacity", "0.6"), d.css("opacity", "0.6"), g.css("opacity", "0.6")) } else b.css("opacity", "0.6"), k.css("opacity", "0.6"), d.css("opacity", "0.6"), g.css("opacity", "0.6") } var gt, ni, wt; this.onClose = null; var y = t("<div class='vis-forms-container'>"), ti = !0, ht = t("<div class='vis-info-subroot'>"), ii = null, ri = null, ui = null, yt = null, ct = null, lt = null, rt = null, at = null, ft = null, et = null, nt = null, ot = null, st = null, pt = null, vt = null, a = null, p = null, w = [], h = null, tt = null, ut = this; this.keyCol = ""; var c = [], fi = null, v = null, bt, kt, b, k, dt, d, g, l; ei(); oi(); gt = function () { var n = w2ui[v].getSelection(); for (item in n) c.indexOf(w2ui[v].get(n[item])[keyCol]) == -1 && c.push(w2ui[v].get(n[item])[keyCol]); ut.onClose != null && c.length > 0 && ut.onClose(); wt() }; this.show = function () { t.ajax({ url: n.Application.contextUrl + "InfoGeneral/GetSearchColumns", dataType: "json", data: { tableName: f, VAF_Language: n.context.getVAF_Language(), isBaseLangage: n.Env.isBaseLanguage(n.context) }, error: function () { n.ADialog.error("ERRORGettingSearchCols"); a[0].style.visibility = "hidden" }, success: function (t) { if (p = t.result, p == null) { n.ADialog.error("ERRORGettingSearchCols"); a[0].style.visibility = "hidden"; return } hi() } }) }; var hi = function () { var c, i, e, ut, v, b, k; if (h = n.dataContext.getJSONData(n.Application.contextUrl + "InfoGeneral/GetDispalyColumns", { VAF_TableView_ID: p[0].VAF_TableView_ID, VAF_Language: n.context.getVAF_Language(), IsBaseLangage: n.Env.isBaseLanguage(n.context), TableName: f }).result, h == null) { alert(n.Msg.getMsg("ERRORGettingDisplayCols")); a[0].style.visibility = "hidden"; return } var nt = null, o = null, d = t("<table>"); d.css("width", "100%"); c = null; for (i in p) { var tt = t("<td>"), rt = t('<div class="input-group vis-input-wrap">'), g = t('<div class="vis-control-wrap">'); c = t("<tr>"); d.append(c); c.append(tt); tt.append(rt); rt.append(g); e = {}; o = new n.Controls.VTextBox(p[i].ColumnName, !1, !1, !0, 50, 100, null, null, !1); e.Ctrl = o; e.VAF_Control_Ref_ID = 10; e.ColumnName = p[i].ColumnName; e.IsTranslated = p[i].IsTranslated; p[i].IsIdentifier && o.setValue(u); ut = t("<td>"); g.append(o.getControl().attr("data-placeholder", "").attr("placeholder", " ")); nt = new n.Controls.VLabel(p[i].Name, p[i].ColumnName); g.append(nt.getControl()); w.push(e) } ct.append(d); v = n.Msg.getMsg("Refresh"); v.indexOf("&") > -1 && (v = v.replace("&", "")); b = n.Msg.getMsg("Cancel"); b.indexOf("&") > -1 && (b = b.replace("&", "")); k = n.Msg.getMsg("Ok"); k.indexOf("&") > -1 && (k = k.replace("&", "")); y.dialog({ width: 1020, height: 500, resizable: !1, modal: !0, close: si, closeText: n.Msg.getMsg("close") }); s != null && s != undefined && s.length > 0 && (s = n.Env.parseContext(n.Env.getCtx(), r, s, !1, !1)); it(!0, l.val()) }, it = function (i, r) { var b, u, d, nt, y; if (o && w2ui[v]) { b = w2ui[v].getSelection(); for (u in b) c.indexOf(w2ui[v].get(b[u])[keyCol]) == -1 && c.push(w2ui[v].get(b[u])[keyCol]) } ni(); var e = "SELECT ", g = 0, it = t.makeArray(h).length, k = !1; for (u in h) { if (g = h[u].VAF_Control_Ref_ID, g == n.DisplayType.YesNo) e += " ( CASE " + f + "." + h[u].ColumnName + " WHEN 'Y' THEN  'True' ELSE 'False'  END ) AS " + h[u].ColumnName; else if (g == n.DisplayType.List) { d = h[u].RefList; e += " CASE "; for (nt in d) e += " WHEN " + f + "." + h[u].ColumnName + "='" + d[nt].Key + "' THEN '" + d[nt].Value.replace("'", "''") + "'"; e += " END AS " + h[u].ColumnName } else n.Env.isBaseLanguage(n.context) ? e += f + "." + h[u].ColumnName + " " : h[u].trlTableExist ? h[u].IsTranslated ? (e += "trlTable." + h[u].ColumnName + " ", k = !0) : e += f + "." + h[u].ColumnName + " " : e += f + "." + h[u].ColumnName + " "; h[u].IsKey && (keyCol = h[u].ColumnName.toUpperCase()); it - 1 == u || (e += ", ") } if (e += " FROM " + f + " " + f, k && (e += " Inner join " + f + "_Trl trlTable on (" + f + "." + f + "_ID=trlTable." + f + "_ID  AND trlTable.VAF_Language='" + n.context.getVAF_Language() + "')"), i == !0) { var p = " ", l = null, tt = !1; for (y = 0; y < w.length; y++)(l = w[y].Ctrl.getValue(), l != null && l.length != 0 && l != 0) && (tt == !0 && (p += " AND "), l = String(l).indexOf("%") == 0 ? String(l).replace("%", "●") : "●" + l, String(l).lastIndexOf("●") == String(l).length || (l = l + "●"), n.Env.isBaseLanguage(n.context) ? p += "  UPPER(" + f + "." + w[y].ColumnName + ") LIKE '" + l.toUpperCase() + "' " : k ? w[y].IsTranslated ? (p += "  UPPER(trlTable." + w[y].ColumnName + ") LIKE '" + l.toUpperCase() + "' ", k = !0) : p += "  UPPER(" + f + "." + w[y].ColumnName + ") LIKE '" + l.toUpperCase() + "' " : p += "  UPPER(" + f + "." + w[y].ColumnName + ") LIKE '" + l.toUpperCase() + "' ", tt = !0); p.length > 1 ? (e += " WHERE " + p, s != null && s.length > 0 && (e += " AND " + s)) : s != null && s.length > 0 && (e += " WHERE " + s) } else e += s.length > 0 && s.trim().toUpperCase().startsWith("WHERE") ? " " + s + " AND " + f + "_ID=-1" : s.length > 0 ? " WHERE " + f + "." + f + "_ID=-1 AND " + s : " WHERE " + f + "." + f + "_ID=-1"; r || (r = 1); t.ajax({ url: n.Application.contextUrl + "InfoGeneral/GetData", dataType: "json", type: "POST", data: { sql: e, tableName: f, pageNo: r }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); a[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { a[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); a[0].style.visibility = "hidden"; return } yi(i.pSetting); ci(i.data) } }) }, ci = function (i) { var r, e, s, u; if (i == null) { alert(n.Msg.getMsg("NoDataFound")); a[0].style.visibility = "hidden"; return } var l = [], y = [], f = null; for (u in i) r = { resizable: !0 }, f = h[u].VAF_Control_Ref_ID, r.caption = h[u].Name, r.field = h[u].ColumnName.toUpperCase(), r.columnName = h[u].ColumnName.toUpperCase(), r.sortable = !0, r.hidden = !h[u].IsDisplayed, r.size = "100px", n.DisplayType.IsNumeric(f) ? r.render = f == n.DisplayType.Integer ? "int" : f == n.DisplayType.Amount ? "number:2" : "number:1" : n.DisplayType.IsDate(f) ? r.render = function (n, t, i) { var r = n[l[i].field]; return r ? Globalize.format(new Date(r), "d") : "" } : f == n.DisplayType.Location || f == n.DisplayType.Locator ? r.render = "int" : f == n.DisplayType.Account ? r.render = "int" : f == n.DisplayType.PAttribute ? r.render = "int" : f == n.DisplayType.Button ? r.render = function () { return "<div>button<\/div>" } : f == n.DisplayType.Image ? r.render = function () { return "<div>Image<\/div>" } : n.DisplayType.IsLOB(f) && (r.render = function () { return "<div>[Lob-blob]<\/div>" }), l[u] = r; for (e = 0; e < i[0].RowCount; e++) { s = {}; for (u in i) s[i[u].ColumnName.toUpperCase()] = i[u].Values[e]; s.recid = e + 1; y[e] = s } if (v = "gridGenInfodata" + Math.random(), v = v.replace(".", ""), w2utils.encodeTags(y), tt = t(lt).w2grid({ name: v, recordHeight: 40, show: { toolbar: !0, columnHeaders: !0, lineNumbers: !0, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: l, records: y, multiSelect: o, onUnselect: li }), o) for (itm in c) for (u in w2ui[v].records) w2ui[v].records[u][keyCol] == c[itm] && w2ui[v].select(parseInt(u) + 1); a[0].style.visibility = "hidden" }; ni = function () { tt != null && tt.destroy(); tt = null }; this.getSelectedValues = function () { return c }; wt = function () { y.off("keyup"); ot.off("click"); st.off("click"); vt.off("click"); b.off("click"); k.off("click"); d.off("click"); g.off("click"); l.off("change"); lt = null; ct = null; tt != null && tt.destroy(); tt = null; ti = null; ht = null; ii = null; ri = null; ui = null; yt = null; ct = null; lt = null; rt = null; at = null; ft = null; et = null; nt = null; ot = null; st = null; pt = null; vt = null; a = null; p = null; w = null; h = null; tt = null; ut = null; keyCol = null; c = null; fi = null; b = k = d = g = l = null; y != null && (y.dialog("destroy"), y.remove()); y = null; this.btnOKClick = null; this.displaySearchCol = null; this.displayData = null; this.loadData = null; this.disposeComponent = null; this.disposeDataSec = null; this.getSelectedValues = null } } n.infoGeneral = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h, c) { function af() { var o, i; uu = []; uu.push({ field: "WareHouse", caption: n.Msg.getMsg("Warehouse"), size: "150px" }, { field: "Variant", caption: n.Msg.getMsg("Variant"), size: "150px" }, { field: "Quantity", caption: n.Msg.getMsg("Quantity"), size: "100px", editable: { type: "float" }, render: "number:1" }, { field: "Available", caption: n.Msg.getElement(n.Env.getCtx(), "QtyAvailable"), size: "100px" }, { field: "OnHand", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOnHand"), size: "100px" }, { field: "Reserved", caption: n.Msg.getElement(n.Env.getCtx(), "QtyReserved"), size: "100px" }, { field: "Ordered", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOrdered"), size: "100px" }, { field: "VAM_Warehouse_ID", caption: "WareHouse ID", size: "150px", hidden: !0 }, { field: "VAM_PFeature_SetInstance_ID", caption: "VAM_PFeature_SetInstance_ID", size: "150px", hidden: !0 }, { field: "VAM_Product_ID", caption: "VAM_Product_ID", size: "150px", hidden: !0 }, { field: "ParentRec_ID", caption: "Parent recid", size: "150px", hidden: !0 }); ut.css("width", "100%"); ut.css("height", "100%"); ut.css("position", "relative"); ot.css("width", "100%"); vi = t("<div class='vis-info-l-s-wrap vis-pad-0 vis-leftsidebarouterwrap'>"); yi = t("<div class='vis-info-l-s-content'>"); vi.append(yi); ii = t("<div class='vis-info-datasec'>"); ri = t("<div class='vis-info-btnsec'>"); ai.append(vi); ai.append(ii); ai.append(ri); nr = n.Msg.getMsg("Value"); nr.indexOf("&") > -1 && (nr = nr.replace("&", "")); tr = n.Msg.getMsg("Name"); tr.indexOf("&") > -1 && (tr = tr.replace("&", "")); ir = n.Msg.getMsg("UPC"); ir.indexOf("&") > -1 && (ir = ir.replace("&", "")); rr = n.Msg.getMsg("SKU"); rr.indexOf("&") > -1 && (rr = rr.replace("&", "")); ur = n.Msg.getMsg("Warehouse"); ur.indexOf("&") > -1 && (ur = ur.replace("&", "")); fr = n.Msg.getMsg("PriceListVersion"); fr.indexOf("&") > -1 && (fr = fr.replace("&", "")); pi = n.Msg.getMsg("Refresh"); pi.indexOf("&") > -1 && (pi = pi.replace("&", "")); ar = n.Msg.getMsg("AddCatalog"); ar.indexOf("&") > -1 && (ar = ar.replace("&", "")); vr = n.Msg.getMsg("ShowSaved"); vr.indexOf("&") > -1 && (vr = vr.replace("&", "")); pr = n.Msg.getMsg("ShowCart"); pr.indexOf("&") > -1 && (pr = pr.replace("&", "")); yr = n.Msg.getMsg("ShowScan"); yr.indexOf("&") > -1 && (yr = yr.replace("&", "")); ui = n.Msg.getMsg("Cancel"); ui.indexOf("&") > -1 && (ui = ui.replace("&", "")); fi = n.Msg.getMsg("Ok"); fi.indexOf("&") > -1 && (fi = fi.replace("&", "")); er = n.Msg.getElement(n.Env.getCtx(), "VAM_PFeature_Set_ID"); er.indexOf("&") > -1 && (er = er.replace("&", "")); or = n.Msg.getElement(n.Env.getCtx(), "VAM_PFeature_SetInstance_ID"); or.indexOf("&") > -1 && (or = or.replace("&", "")); sr = n.Msg.getMsg("AttrCode"); sr.indexOf("&") > -1 && (sr = sr.replace("&", "")); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(nr); k.append(u); u.append(f); f.append(r); i = {}; it = new n.Controls.VTextBox("Value", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = it; i.VAF_Control_Ref_ID = 10; i.ColumnName = "Value"; o = t("<td>"); r.append(it.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(nt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(tr); k.append(u); u.append(f); f.append(r); i = {}; it = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = it; i.VAF_Control_Ref_ID = 10; i.ColumnName = "Name"; it.setValue(e); o = t("<td>"); r.append(it.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(nt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(ir); k.append(u); u.append(f); f.append(r); i = {}; it = new n.Controls.VTextBox("UPC", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = it; i.VAF_Control_Ref_ID = 10; i.ColumnName = "UPC"; r.append(it.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(nt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(rr); k.append(u); u.append(f); f.append(r); i = {}; it = new n.Controls.VTextBox("SKU", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = it; i.VAF_Control_Ref_ID = 10; i.ColumnName = "SKU"; o = t("<td>"); r.append(it.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(nt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(ur); k.append(u); u.append(f); f.append(r); i = {}; ei = new n.Controls.VComboBox("VAM_Warehouse_ID", !1, !1, !0, null, 50); i.Ctrl = ei; i.VAF_Control_Ref_ID = n.DisplayType.tableDir; i.ColumnName = "VAM_Warehouse_ID"; o = t("<td>"); k.append(o); r.append(ei.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(nt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(fr); k.append(u); u.append(f); f.append(r); i = {}; oi = new n.Controls.VComboBox("VAM_PriceListVersion_ID", !1, !1, !0, null, 50); i.Ctrl = oi; i.VAF_Control_Ref_ID = n.DisplayType.tableDir; i.ColumnName = "VAM_PriceListVersion_ID"; o = t("<td>"); r.append(oi.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(nt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(sr); k.append(u); u.append(f); f.append(r); i = {}; it = new n.Controls.VTextBox("AttributeCode", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = it; i.VAF_Control_Ref_ID = 10; i.ColumnName = "AttributeCode"; o = t("<td>"); r.append(it.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(nt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(er); k.append(u); u.append(f); f.append(r); i = {}; gt = new n.Controls.VComboBox("VAM_PFeature_Set_ID", !1, !1, !0, null, 50); i.Ctrl = gt; i.VAF_Control_Ref_ID = n.DisplayType.tableDir; i.ColumnName = "VAM_PFeature_Set_ID"; o = t("<td>"); r.append(gt.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(nt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); k.append(u); u.append(f); f.append(r); i = {}; ku(); yi.append(ot); bt = t("<div class='vis-info-btnswrap'>"); wr = t("<div class='vis-info-ls-btnswrap'>"); bi = t("<button class='VIS_Pref_btn-2'>").append(ui); ki = t("<button class='VIS_Pref_btn-2'>").append(fi); rt = t("<button class='VIS_Pref_btn-2'>").append(t("<i class='fa fa-cart-plus'><\/i>")); kt = t("<button class='VIS_Pref_btn-2' disabled>").append(t("<i class='fa fa-list-ul'><\/i>")); br = t("<button class='VIS_Pref_btn-2'>").append(t("<i class='vis vis-scanner'>")); wi = t("<button class='VIS_Pref_btn-2'>").append(t("<i class='fa fa-shopping-cart'><\/i>")); kr = t("<div class='vis-info-btnleft'>"); di = t("<button class='VIS_Pref_btn-2' style='margin-top: 10px;'>").append(t("<i class='vis vis-refresh'><\/i>")); su = t('<div class="vis-info-pagingwrp">'); le(); su.append(hu); bt.append(bi); bt.append(ki); bt.append(kt); bt.append(rt); wr.append(br); wr.append(wi); vi.append(wr); kr.append(di); ri.append(kr); ri.append(su); ri.append(bt); y = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); y[0].style.visibility = "visible"; ut.append(ai); ut.append(y) } function ku() { var i = {}, o; k.empty(); o = " VAM_PFeature_SetInstance_ID IN (SELECT  asi.VAM_PFeature_SetInstance_ID as VAM_PFeature_SetInstance_ID   FROM VAM_PFeature_SetInstance asi   WHERE asi.IsActive='Y' AND asi.VAM_PFeature_Set_ID=" + gt.ctrl.val() + ")"; ru = n.MLookupFactory.get(n.Env.getCtx(), r, 8472, n.DisplayType.Search, "VAM_PFeature_SetInstance_ID", 0, !1, o); ni = new n.Controls.VTextBoxButton("VAM_PFeature_SetInstance_ID", !1, !1, !0, n.DisplayType.Search, ru); ni.getControl(); i.Ctrl = ni; i.VAF_Control_Ref_ID = n.DisplayType.Search; i.ColumnName = "VAM_PFeature_SetInstance_ID"; var s = t("<td>"), u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), e = t('<div class="input-group-append">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(or); s.append(u); u.append(f); u.append(e); f.append(ni.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); e.append(ni.getBtn(0)); e.append(ni.getBtn(1)); f.append(nt); b.push(i) } function vf() { if (!n.Application.isMobile) ut.on("keyup", function (t) { if (t.keyCode === 13 && (y[0].style.visibility = "visible", c != null && c.length > 0 && (d = n.Env.parseContext(n.Env.getCtx(), r, c, !1, !1)), ct(!0, g.val()), p.length > 0)) { for (var i = 0; i < p.length; i++)w2ui["subgrid-" + p[i]].destroy(); p = [] } }); br.on("click", function () { re() }); wi.on("click", function () { ie() }); rt.on("click", function () { ue() }); kt.on("click", function () { y[0].style.visibility = "visible"; cu() }); bi.on("click", function () { lt.onClose != null && lt.onClose(); iu() }); ki.on("click", function () { gu() }); di.on("click", function () { if (d = null, h && !st && rt.show(), v.length == 0 && kt.prop("disabled", !0), a = [], y[0].style.visibility = "visible", c != null && c != undefined && c.length > 0 && (d = n.Env.parseContext(n.Env.getCtx(), r, c, !1, !1)), ct(!0, 1), p.length > 0) { for (var t = 0; t < p.length; t++)w2ui["subgrid-" + p[t]].destroy(); p = [] } }); gt.ctrl.change(function () { ni = null; ru = null; for (var n = 0; n < b.length; n++)b[n].Ctrl.colName == "VAM_PFeature_SetInstance_ID" && b.splice(n); ku() }) } function yf(i, u) { ou = new n.MPAttributeLookup(n.context, r); wu = new n.Controls.VPAttribute("VAM_PFeature_SetInstance_ID", !1, !1, !0, n.DisplayType.PAttribute, ou, r, !1, !1, !1, !0); ei.ctrl.append(t('<Option value="0"><\/option>')); oi.ctrl.append(t('<Option value="0"><\/option>')); gt.ctrl.append(t('<Option value="0"><\/option>')); vu = jQuery.parseJSON(vu); yu = jQuery.parseJSON(yu); u == 0 && (u = bf()); fu = te(n.Env.getCtx(), r, u); pf() } function pf() { try { var t = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetWarehouse", null, null); wf(t) } catch (i) { console.log(i); y[0].style.visibility = "hidden" } } function wf(t) { var i, e, r; if (t.length > 0) for (r in t) i = n.Utility.Util.getValueOfInt(t[r].VAM_Warehouse_ID), e = n.Utility.Util.getValueOfString(t[r].Name), ei.getControl().append(" <option value=" + i + ">" + e + "<\/option>"), i == u && ei.ctrl.val(u); kf(f) } function bf() { var i = 0, t; try { t = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetDefaultPriceList", null, null); t != null && (i = t) } catch (r) { console.log(r); y[0].style.visibility = "hidden" } return i } function kf(t) { try { var i = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetPriceList", { PriceList: t }, null); df(i) } catch (r) { console.log(r); y[0].style.visibility = "hidden" } } function df(t) { var i, u, r; if (t.length > 0) for (r in t) i = n.Utility.Util.getValueOfInt(t[r].VAM_PriceListVersion_ID), u = n.Utility.Util.getValueOfString(t[r].Name), oi.getControl().append(" <option value=" + i + ">" + u + "<\/option>"), i == fu && oi.ctrl.val(fu); gf() } function gf() { try { n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetAttributeSet", null, ne) } catch (t) { console.log(t); y[0].style.visibility = "hidden" } } function ne(t) { var r, u, i; if (t.length > 0) for (i in t) r = n.Utility.Util.getValueOfInt(t[i].VAM_PFeature_Set_ID), u = n.Utility.Util.getValueOfString(t[i].Name), gt.getControl().append(" <option value=" + r + ">" + u + "<\/option>") } function te(t, i, u) { var e = null, s = 0, o = t.getContext(i, "DateOrdered"), c, f, h, l, a; o != null && o.Length > 0 ? e = System.Convert.ToDateTime(n.Env.parseContext(n.Env.getCtx(), r, "DateOrdered", !1, !1)) : (o = t.getContext(i, "DateInvoiced"), o != null && o.Length > 0 && (e = System.Convert.ToDateTime(n.Env.parseContext(n.Env.getCtx(), r, "DateInvoiced", !1, !1)))); e == null && (c = new Date, e = n.Utility.Util.getValueOfDate(c)); try { if (f = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetPriceListVersion", { PriceList: u }, null), f.length > 0) { for (h in f) l = n.Utility.Util.getValueOfInt(f[h].VAM_PriceListVersion_ID), a = n.Utility.Util.getValueOfString(f[h].ValidFrom), e > a && (s = l); s == 0 && (s = n.Utility.Util.getValueOfInt(f[0].VAM_PriceListVersion_ID)) } } catch (v) { console.log(v); y[0].style.visibility = "hidden" } return s } function ie() { ti = !1; si = 0; var t = new n.InfoScanForm(r, !0); t.showDialog(); t.onClose = function (t, i, u) { y[0].style.visibility = "visible"; window.setTimeout(function () { var l, f, h, w, c, b; if (ti = i, si = u, l = n.Env.getCtx().getContext("#VAF_Session_ID"), t && t.length > 0) for (f in t) { var a = "", y = "", e = 0, o = 0, s = t[f].VAICNT_Quantity, p = t[f].VAM_Product_ID, k = t[f].Value; e = t[f].VAM_PFeature_SetInstance_ID; h = t[f].Description; w = t[f].VAICNT_InventoryCountLine_ID; a = t[f].Name; y = t[f].UOM; o = t[f].VAB_UOM_ID; c = t[f].LineID; s > 0 && (v.length > 0 ? (b = v.map(function (n) { return n._prdID == p && n._Attribute == e && n._uom == o && n._refLineID == c }).indexOf(!0), b > -1 ? v[b]._prodQty += s : v.push({ _prodQty: s, _prdID: p, _prdName: a, _value: k, _uom: o, _uomName: y, _VAF_Session_ID: l, _windowNo: r, _RefNo: "", _Attribute: e, _AttributeName: h, _Locator_ID: 0, _IsLotSerial: "N", _countID: w, _refLineID: c })) : v.push({ _prodQty: s, _prdID: p, _prdName: a, _value: k, _uom: o, _uomName: y, _VAF_Session_ID: l, _windowNo: r, _RefNo: "", _Attribute: e, _AttributeName: h, _Locator_ID: 0, _IsLotSerial: "N", _countID: w, _refLineID: c }), dr[e] = h) } cu() }, 200) } } function lu() { var f, i, u; for (et = null, f = [], i = 0; i < w.length; i++)u = {}, u.Product = w[i].Product, u.Value = w[i].Value, u.QtyEntered = w[i].QtyEntered, u.UOM = w[i].UOM, u.Attribute = w[i].Attribute, u.ProdID = w[i].VAM_Product_ID1, u.recid = i + 1, f[i] = u; l = "gridsavedprd" + Math.random(); l = l.replace(".", ""); w2utils.encodeTags(f); et = t(ii).w2grid({ name: l, recordHeight: 40, show: { toolbar: !0, columnHeaders: !0, lineNumbers: !0, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: [{ field: "Value", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "Value") + "<\/span><\/div>", sortable: !1, size: "120px", min: 100, hidden: !1 }, { field: "Product", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "Product") + "<\/span><\/div>", sortable: !1, size: "20%", min: 150, hidden: !1 }, { field: "QtyEntered", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "QtyEntered") + "<\/span><\/div>", sortable: !1, size: "70px", min: 60, hidden: !1, editable: { type: "float" }, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.QtyEntered); return i.toLocaleString() } }, { field: "UOM", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "UOM") + "<\/span><\/div>", sortable: !1, size: "70px", min: 60, hidden: !1 }, { field: "Attribute", caption: n.Msg.translate(n.Env.getCtx(), "Attribute"), sortable: !1, size: "20%", min: 150, hidden: !1, editable: { type: "custom", ctrl: wu, showAll: !0 }, render: function (n) { var r = ou, t = n.Attribute, i = dr[t]; return !i && t > 0 && (i = r.getDisplay(t, !0), dr[t] = i), i } }, { field: "Delete", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "DeleteActivity") + "<\/span><\/div>", sortable: !1, size: "60px", min: 40, hidden: !1, render: function () { return '<div class="vis-info-grid-icowrap"><i class="vis vis-delete title="Delete record" style="opacity: 1;"><\/i><\/div>' } }, { field: "Copy", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "Copy") + "<\/span><\/div>", sortable: !1, size: "60px", min: 40, hidden: !1, render: function () { return '<div class="vis-info-grid-icowrap"><i class="vis vis-new title="Copy record" style="opacity: 1;"><\/i><\/div>' } }, { field: "ProdID", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "ProdID") + "<\/span><\/div>", sortable: !1, size: "20%", min: 150, hidden: !0 }], records: f, onChange: function (n) { n.column == 2 ? (w2ui[l].records[n.index].QtyEntered = n.value_new, v[n.index]._prodQty = n.value_new, w[n.index].QtyEntered = n.value_new) : n.column == 4 && (w2ui[l].records[n.index].Attribute = n.value_new, v[n.index]._Attribute = n.value_new, w[n.index].Attribute = n.value_new) }, onClick: function (t) { t.column == 5 && et.records.length > 0 ? (y[0].style.visibility = "visible", v.splice(t.recid - 1, 1), w.splice(t.recid - 1, 1), lu()) : t.column == 6 && et.records.length > 0 ? (y[0].style.visibility = "visible", w.push({ SrNo: w.length, Product: w[t.recid - 1].Product, Value: w[t.recid - 1].Value, QtyEntered: w[t.recid - 1].QtyEntered, UOM_ID: w[t.recid - 1].UOM_ID, UOM: w[t.recid - 1].UOM, VAM_Product_ID1: w[t.recid - 1].VAM_Product_ID1, Attribute: "", AttributeName: "", RefNo: w[t.recid - 1].RefNo }), v[v.length] = { _prodQty: w[w.length - 1].QtyEntered, _prdID: w[w.length - 1].VAM_Product_ID1, _prdName: w[w.length - 1].Product, _value: w[w.length - 1].Value, _uom: w[w.length - 1].UOM_ID, _uomName: w[w.length - 1].UOM, _VAF_Session_ID: n.Env.getCtx().getContext("#VAF_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: 0, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 }, lu()) : t.column == 4 && et.records.length > 0 && n.Env.getCtx().setContext(r, "VAM_Product_ID", n.Utility.Util.getValueOfInt(w[t.recid - 1].VAM_Product_ID1)) } }); y[0].style.visibility = "hidden" } function li(t, i, r) { y[0].style.visibility = "hidden"; t && (eu = !0); lt.onClose != null && lt.onClose(); iu(); var u = n.Msg.getMsg("RecSaved"); t || (u = r > 0 ? r + " " + n.Msg.getMsg("RecordsNotSaved") : n.Msg.getMsg("ErrorInSaving")); i && i != "" && (u += ", " + i); n.ADialog.info("", !0, u) } function tf() { var b = 0, f = "", k = 0, nt = "", d = 0, c = 0, l = 0, u = 0, a = 0, g = 0, i; d = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "VAM_Locator_ID", !0)); b = n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 0, "KeyColumnName")); f = n.context.getWindowTabContext(r, 0, "KeyColumnName"); k = n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 1, "KeyColumnName")); nt = n.context.getWindowTabContext(r, 1, "KeyColumnName"); a = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "VAM_ProductContainer_ID", !0)); dt == 170 && (c = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "VAM_LocatorTo_ID", !0)), g = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "Ref_VAM_ProductContainerTo_ID", !0))); dt == 146 && (b = n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 1, "KeyColumnName")), k = 0); l = n.Utility.Util.getValueOfInt(b); u = n.Utility.Util.getValueOfInt(k); var e = [], o = [], s = [], p = [], h = [], w = []; if (v.length > 0 && rt.css("display") == "none") { for (i in v) if (e.push(v[i]._prdID), o.push(v[i]._prodQty), p.push(v[i]._RefNo), h.push(v[i]._Attribute), s.push(v[i]._uom), w.push(v[i]._countID), u != 0) break; hi = v.length } else { for (i in ht) if (e.push(ht[i]._prdID), o.push(ht[i]._prodQty), p.push(ht[i]._RefNo), h.push(ht[i]._Attribute), s.push(ht[i]._uom), w.push(ht[i]._countID), u != 0) break; hi = ht.length } tu = hi % ft == 0 ? hi / ft : Math.ceil(hi / ft); tu == 1 ? f == "SAP001_StockTransfer_ID" ? t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/SaveStockTfr", dataType: "json", data: { id: l, keyColumn: f, VAF_TableView_ID: n.context.getWindowTabContext(r, 1, "VAF_TableView_ID"), prod: JSON.stringify(e), VAB_UOM_ID: JSON.stringify(s), listAst: JSON.stringify(h), qty: JSON.stringify(o), locatorTo: c, lineID: u, ContainerID: a }, success: function (n) { var t = n.result; t }, error: function (n, t) { y[0].style.visibility = "hidden"; console.log(t); returnValue } }) : t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/Save", dataType: "json", data: { id: l, keyColumn: f, prod: JSON.stringify(e), VAB_UOM_ID: JSON.stringify(s), listAst: JSON.stringify(h), qty: JSON.stringify(o), locatorTo: c, lineID: u, InvCountID: JSON.stringify(w), ReferenceNo: JSON.stringify(p), Locator_ID: d, WindowID: dt, ContainerID: a, ContainerToID: g }, success: function (t) { var i = JSON.parse(t); if (i.count == 0) { if (ti) try { n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/DeleteCart", { invCount_ID: si }, null) } catch (r) { console.log(r); li(!0, r.message) } li(!0); return } au(i); li(!1, uf(), i.count); return }, error: function (n, t) { y[0].style.visibility = "hidden"; console.log(t) } }) : rf(l, f, u, e, o, [], s, p, h, d, c, [], w, a, g) } function rf(i, u, f, e, o, s, h, c, l, a, v, p, w, b, k) { var d = ut.find(".filestatuscounter"); d.text() != "" ? tu == hr ? d.text(hi + " Records Inserted..Please Wait..!!") : d.text(hr * ft - cr + " Records Inserted..Please Wait..!!") : ce(hr * ft); u == "SAP001_StockTransfer_ID" ? t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/SaveStockTfr", dataType: "json", data: { id: i, keyColumn: u, VAF_TableView_ID: n.context.getWindowTabContext(r, 1, "VAF_TableView_ID"), prod: JSON.stringify(e.splice(0, ft)), VAB_UOM_ID: JSON.stringify(h.splice(0, ft)), listAst: JSON.stringify(l.splice(0, ft)), qty: JSON.stringify(o.splice(0, ft)), locatorTo: v, lineID: f, ContainerID: b }, success: function (n) { var t = n.result; t }, error: function (n, t) { y[0].style.visibility = "hidden"; console.log(t); returnValue } }) : t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/Save", dataType: "json", data: { id: i, keyColumn: u, prod: JSON.stringify(e.splice(0, ft)), VAB_UOM_ID: JSON.stringify(h.splice(0, ft)), listAst: JSON.stringify(l.splice(0, ft)), qty: JSON.stringify(o.splice(0, ft)), locatorTo: v, lineID: f, InvCountID: JSON.stringify(w.splice(0, ft)), ReferenceNo: c, Locator_ID: a, WindowID: dt, ContainerID: b, ContainerToID: k }, success: function (t) { var r = JSON.parse(t); if (hr++, tu == hr) { if (cr == 0) { if (ti) try { n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/DeleteCart", { invCount_ID: si }, null) } catch (y) { console.log(y); li(!0, y.message) } li(!0); return } au(r); cr += r.count; li(!1, uf(), cr); return } r.count == 0 || (au(r), cr += r.count); rf(i, u, f, e, o, s, h, c, l, a, v, p, w, b, k) }, error: function (n, t) { y[0].style.visibility = "hidden"; console.log(t) } }) } function uf() { var t = "", n; if (wt.length > 0) for (n = 0; n < wt.length; n++)n != 0 && (t += " ::: "), t += wt[n] + " --> " + ci[n]; return wt = [], ci = [], t } function au(n) { var t, i; if (n.errorKeys.length > 0) if (wt.length > 0) for (t = 0; t < n.errorKeys.length; t++)i = wt.indexOf(n.errorKeys[t]), i >= 0 ? ci[i] = ci[i] + ", " + n.errorProds[t] : (wt.push(n.errorKeys[t]), ci.push(n.errorProds[t])); else wt = n.errorKeys, ci = n.errorProds; else wt.push(n.error) } function fe() { lt.onClose != null && lt.onClose(); iu() } function ce(n) { nu = t("<div class='filestatus'> <label class='filestatuscounter'>" + n + " Records Inserted..Please Wait..!!<\/lable><\/div>"); nu.css({ position: "absolute", width: "98%", height: "97%", "text-align": "center", "z-index": "999" }); nu[0].style.visibility = "visible"; ut.append(nu) } function le() { hu = t('<ul class="vis-statusbar-ul">'); at = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="' + n.Msg.getMsg("FirstPage") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); vt = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.getMsg("PageUp") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); g = t("<select>"); gr = t("<li>").append(g); yt = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.getMsg("PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); pt = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="' + n.Msg.getMsg("LastPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); hu.append(at).append(vt).append(gr).append(yt).append(pt); ae() } function ae() { at.on("click", function () { if (t(this).css("opacity") == "1" && (y[0].style.visibility = "visible", h && !st && rt.show(), ct(!0, 1), p.length > 0)) { for (var n = 0; n < p.length; n++)w2ui["subgrid-" + p[n]].destroy(); p = [] } }); vt.on("click", function () { if (t(this).css("opacity") == "1" && (y[0].style.visibility = "visible", h && !st && rt.show(), ct(!0, parseInt(g.val()) - 1), p.length > 0)) { for (var n = 0; n < p.length; n++)w2ui["subgrid-" + p[n]].destroy(); p = [] } }); yt.on("click", function () { if (t(this).css("opacity") == "1" && (y[0].style.visibility = "visible", h && !st && rt.show(), ct(!0, parseInt(g.val()) + 1), p.length > 0)) { for (var n = 0; n < p.length; n++)w2ui["subgrid-" + p[n]].destroy(); p = [] } }); pt.on("click", function () { if (t(this).css("opacity") == "1" && (y[0].style.visibility = "visible", h && !st && rt.show(), ct(!0, parseInt(g.find("Option:last").val())), p.length > 0)) { for (var n = 0; n < p.length; n++)w2ui["subgrid-" + p[n]].destroy(); p = [] } }); g.on("change", function () { if (y[0].style.visibility = "visible", h && !st && rt.show(), ct(!0, g.val()), p.length > 0) { for (var n = 0; n < p.length; n++)w2ui["subgrid-" + p[n]].destroy(); p = [] } }) } function ve(n) { g = null; gr.find("select").remove(); g = t("<select>"); gr.append(g); g.on("change", function () { y[0].style.visibility = "visible"; h && !st && rt.show(); ct(!0, g.val()) }); if (n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)g.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); g.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (yt.css("opacity", "1"), pt.css("opacity", "1")) : (yt.css("opacity", "0.6"), pt.css("opacity", "0.6")); n.CurrentPage > 1 ? (at.css("opacity", "1"), vt.css("opacity", "1")) : (at.css("opacity", "0.6"), vt.css("opacity", "0.6")); n.TotalPage == 1 && (at.css("opacity", "0.6"), vt.css("opacity", "0.6"), yt.css("opacity", "0.6"), pt.css("opacity", "0.6")) } else at.css("opacity", "0.6"), vt.css("opacity", "0.6"), yt.css("opacity", "0.6"), pt.css("opacity", "0.6") } function ye(i) { var r; if (i != null) { var u = 0, f = n.Utility.Util.getValueOfInt(w2ui[l].records[i.recid - 1].VAM_Product_ID), e = n.Utility.Util.getValueOfInt(w2ui[l].records[i.recid - 1].VAM_Warehouse_ID), o = ""; for (r = 0; r < b.length; r++)b[r].Ctrl.colName == "VAM_PFeature_SetInstance_ID" && (u = n.Utility.Util.getValueOfInt(b[r].Ctrl.value)); for (r = 0; r < b.length; r++)b[r].Ctrl.colName == "AttributeCode" && (o = b[r].Ctrl.getValue()); f > 0 && e > 0 && t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetVariants", dataType: "json", type: "POST", async: !1, data: { VAM_Product_ID: f, VAM_Warehouse_ID: e, ParentRec_ID: i.recid, VAM_PFeature_SetInstance_ID: u, AttributeCode: o }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); y[0].style.visibility = "hidden"; return }, success: function (n) { var t = JSON.parse(n); pe(t) } }) } } function pe(n) { n != null && (bu = n) } var du, lr, gu, nf; this.onClose = null; var ut = t("<div>"), ff = !0, ai = t("<div class='vis-info-subroot'>"), ef = null, of = null, sf = null, vi = null, yi = null, ii = null, ri = null, pi = null, ar = null, vr = null, yr = null, pr = null, ui = null, fi = null, bt = null, wr = null, br = null, kt = null, wi = null, rt = null, bi = null, ki = null, kr = null, di = null, y = null, hf = null, b = [], tt = null, et = null, lt = this, gi = "", dt = 0, a = [], dr = [], cf = null, l = null, nr = null, tr = null, ir = null, rr = null, ur = null, fr = null, er = null, or = null, sr = null, gt = null, ni = null, ru = null, uu = [], p = [], nt = null, it = null, ei = null, oi = null, ot = t("<table>"), k = null, vu = null, yu = null, fu = null, v = [], w = [], eu = !1, st = !1, pu = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()), ti = !1, si = 0, d = null, wu = null, ou = null, su, hu, at, vt, gr, yt, pt, g, nu, hi = 0, tu = 0, hr = 0, cr = 0, ft = 500, wt = [], ci = [], bu = [], lf = [], ht = []; af(); yf(u, f); du = n.context.getWindowTabContext(r, 0, "VAF_Tab_ID"); dt = n.dataContext.getJSONRecord("InfoProduct/GetWindowID", du.toString()); dt == 146 || n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 1, "KeyColumnName")) != 0 && (st = !0); (!h || st) && (rt.hide(), kt.hide(), br.hide(), wi.hide()); lr = "VAM_Product p LEFT OUTER JOIN VAM_ProductPrice pr ON (p.VAM_Product_ID=pr.VAM_Product_ID AND pr.IsActive='Y') LEFT OUTER JOIN VAM_PriceListVersion plv ON (pr.VAM_PriceListVersion_ID=plv.VAM_PriceListVersion_ID) LEFT OUTER JOIN VAM_PFeature_Set pa ON (p.VAM_PFeature_Set_ID=pa.VAM_PFeature_Set_ID) LEFT OUTER JOIN VAB_UOM c ON (p.VAB_UOM_ID=c.VAB_UOM_ID)"; vf(); var re = function () { ti = !1; si = 0; var t = new n.InfoScanForm(r, !1); t.showDialog(); t.onClose = function (t, i, u) { var l, f, e, c, k; if (y[0].style.visibility = "visible", ti = i, si = u, l = n.Env.getCtx().getContext("#VAF_Session_ID"), t && t.length > 0) for (f in t) { var a = "", p = "", o = 0, s = t[f].VAM_PFeature_SetInstance_ID, w = t[f].Description, d = t[f].VAICNT_InventoryCountLine_ID, h = t[f].VAICNT_Quantity, b = t[f].VAM_Product_ID, g = t[f].Value; a = t[f].Name; p = t[f].UOM; o = t[f].VAB_UOM_ID; e = t[f].VAICNT_ReferenceNo; e == "" && (e = "null"); c = t[f].LineID; h > 0 && (v.length > 0 ? (k = v.map(function (n) { return n._prdID == b && n._Attribute == s && n._uom == o && n._refLineID == c }).indexOf(!0), k > -1 ? v[k]._prodQty += h : v.push({ _prodQty: h, _prdID: b, _prdName: a, _value: g, _uom: o, _uomName: p, _VAF_Session_ID: l, _windowNo: r, _RefNo: e, _Attribute: s, _AttributeName: w, _Locator_ID: 0, _IsLotSerial: "N", _countID: d, _refLineID: c })) : v.push({ _prodQty: h, _prdID: b, _prdName: a, _value: g, _uom: o, _uomName: p, _VAF_Session_ID: l, _windowNo: r, _RefNo: e, _Attribute: s, _AttributeName: w, _Locator_ID: 0, _IsLotSerial: "N", _countID: d, _refLineID: c }), dr[s] = w) } cu() } }, ue = function () { if (y[0].style.visibility = "visible", se(), ct(!0, g.val()), p.length > 0) { for (var n = 0; n < p.length; n++)w2ui["subgrid-" + p[n]].destroy(); p = [] } v.length > 0 ? kt.prop("disabled", !1) : kt.prop("disabled", !0); a = [] }, cu = function () { var i = [], r = [], u = [], f = [], e = [], o = [], s = [], h = [], c = [], t, n; w = []; rt.hide(); for (t in v) i.push(v[t]._prdID), f.push(v[t]._prdName), r.push(v[t]._value), u.push(v[t]._prodQty), c.push(v[t]._RefNo), s.push(v[t]._Attribute), h.push(v[t]._AttributeName), e.push(v[t]._uom), o.push(v[t]._uomName); if (i.length > 0) { for (n = 0; n < i.length; n++)w.push({ SrNo: n, Product: f[n], Value: r[n], QtyEntered: u[n], UOM_ID: e[n], UOM: o[n], VAM_Product_ID1: i[n], Attribute: s[n], AttributeName: h[n], RefNo: c[n] }); lu() } y[0].style.visibility = "hidden" }; gu = function () { var n, r, i, f, e, u; if (y[0].style.visibility = "visible", h && v.length > 0 && rt.css("display") == "none") { if (a = [], n = w2ui[l].getSelection(), r = v, n.length > 0) { for (r = [], i = 0; i < n.length; i++)f = w2ui[l].records[n[i] - 1].ProdID, e = w2ui[l].records[n[i] - 1].Attribute, r.push(t.grep(v, function (n) { return n._prdID == f && n._Attribute == e })[0]); v = r } tf(v) } else if (h && w2ui[l].getSelection().length > 1 && rt.css("display") == "block") ht = nf(), tf(ht); else { a = []; u = w2ui[l].getSelection(); for (item in u) a.indexOf(w2ui[l].get(u[item])[gi]) == -1 && a.push(w2ui[l].get(u[item])[gi]); y[0].style.visibility = "hidden"; lt.onClose != null && lt.onClose(); iu() } }; nf = function () { var i = w2ui[l].getSelection(), u, t, e, o, f; if (i.length > 0) for (u = [], t = 0; t < i.length; t++)w2ui[l].records[i[t] - 1].QTYENTERED > 0 && (e = w2ui[l].records[i[t] - 1].VAM_Product_ID, o = w2ui[l].records[i[t] - 1].VAM_PFeature_SetInstance_ID, u.length > 0 ? (f = u.map(function (n) { return n._prdID == e && n._Attribute == o }).indexOf(!0), f > -1 ? u[f]._prodQty += qty : u.push({ _prodQty: w2ui[l].records[i[t] - 1].QTYENTERED, _prdID: w2ui[l].records[i[t] - 1].VAM_Product_ID, _prdName: w2ui[l].records[i[t] - 1].NAME, _value: w2ui[l].records[i[t] - 1].NAME, _uom: w2ui[l].records[i[t] - 1].VAB_UOM_ID, _uomName: w2ui[l].records[i[t] - 1].UOM, _VAF_Session_ID: n.Env.getCtx().getContext("#VAF_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: w2ui[l].records[i[t] - 1].VAM_PFeature_SetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })) : u.push({ _prodQty: w2ui[l].records[i[t] - 1].QTYENTERED, _prdID: w2ui[l].records[i[t] - 1].VAM_Product_ID, _prdName: w2ui[l].records[i[t] - 1].NAME, _value: w2ui[l].records[i[t] - 1].NAME, _uom: w2ui[l].records[i[t] - 1].VAB_UOM_ID, _uomName: w2ui[l].records[i[t] - 1].UOM, _VAF_Session_ID: n.Env.getCtx().getContext("#VAF_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: w2ui[l].records[i[t] - 1].VAM_PFeature_SetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })); return u }; this.show = function () { t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetInfoColumns", dataType: "json", error: function () { alert(n.Msg.getMsg("ERRORGettingSearchCols")); y[0].style.visibility = "hidden" }, success: function (t) { if (tt = jQuery.parseJSON(t), tt == null) { alert(n.Msg.getMsg("ERRORGettingSearchCols")); y[0].style.visibility = "hidden"; return } ut.dialog({ width: 1020, height: 500, title: n.Msg.translate(n.Env.getCtx(), "InfoProduct"), resizable: !1, modal: !0, closeText: n.Msg.getMsg("close"), close: fe }); c != null && c.length > 0 && (d = n.Env.parseContext(n.Env.getCtx(), r, c, !1, !1)); ct(!0, g.val()) } }) }; var ct = function (i, r) { var p, e, f, g, nt; if (h && w2ui[l]) { p = w2ui[l].getSelection(); for (e in p) a.indexOf(w2ui[l].get(p[e])[gi]) == -1 && a.push(w2ui[l].get(p[e])) } oe(); var c = "SELECT ", v = "", w = 0, it = t.makeArray(tt).length; for (e in tt) w = tt[e].VAF_Control_Ref_ID, c += w == n.DisplayType.YesNo ? " ( CASE " + tt[e].ColumnSQL + " WHEN 'Y' THEN  'True' ELSE 'False'  END ) " + tt[e].ColumnName : tt[e].ColumnSQL + " ", w == n.DisplayType.ID && tt[e].ColumnName.toUpperCase() == "VAM_Product_ID" && (gi = tt[e].ColumnName.toUpperCase()), it - 1 == e || (c += ", "); if (i == !0) { var s = " w.VAF_Client_ID = " + n.context.getVAF_Client_ID(), u = null, k = !1; for (lr = "VAM_Product p LEFT OUTER JOIN VAM_ProductPrice pr ON (p.VAM_Product_ID=pr.VAM_Product_ID AND pr.IsActive='Y') LEFT OUTER JOIN VAM_PriceListVersion plv ON (pr.VAM_PriceListVersion_ID=plv.VAM_PriceListVersion_ID) LEFT OUTER JOIN VAM_PFeature_Set pa ON (p.VAM_PFeature_Set_ID=pa.VAM_PFeature_Set_ID) LEFT OUTER JOIN VAB_UOM c ON (p.VAB_UOM_ID=c.VAB_UOM_ID)", f = 0; f < b.length; f++)(u = b[f].Ctrl.getValue(), u != null && u.length != 0 && u != 0) && (b[f].Ctrl.displayType == 10 && (u = String(u).indexOf("%") == 0 ? String(u).replace("%", "●") : "●" + u, String(u).lastIndexOf("●") == String(u).length || (u = u + "●")), b[f].Ctrl.colName == "Value" ? s += " AND UPPER(p." + b[f].ColumnName + ") LIKE '" + u.toUpperCase() + "' " : b[f].Ctrl.colName == "Name" ? s += " AND UPPER(p." + b[f].ColumnName + ") LIKE '" + u.toUpperCase() + "' " : b[f].Ctrl.colName == "UPC" ? (k = !0, s += " AND (UPPER(patr.UPC) LIKE '" + u.toUpperCase() + "' OR UPPER(p.UPC) LIKE '" + u.toUpperCase() + "' OR UPPER(mr.UPC) LIKE '" + u.toUpperCase() + "')") : b[f].Ctrl.colName == "SKU" ? s += " AND UPPER(p." + b[f].ColumnName + ") LIKE '" + u.toUpperCase() + "' " : b[f].Ctrl.colName == "VAM_Warehouse_ID" ? n.Utility.Util.getValueOfInt(u) != 0 && (s += " AND w.VAM_Warehouse_ID=" + n.Utility.Util.getValueOfInt(u)) : b[f].Ctrl.colName == "VAM_PriceListVersion_ID" ? n.Utility.Util.getValueOfInt(u) != 0 && (s += " AND pr.VAM_PriceListVersion_ID=" + n.Utility.Util.getValueOfInt(u)) : b[f].Ctrl.colName == "VAM_PFeature_Set_ID" ? n.Utility.Util.getValueOfInt(u) != 0 && (s += " AND p.VAM_PFeature_Set_ID=" + n.Utility.Util.getValueOfInt(u)) : b[f].Ctrl.colName == "AttributeCode" && (s += " AND p.VAM_Product_ID in (SELECT distinct VAM_Product_ID from VAM_ProductFeatures WHERE UPPER(UPC) LIKE '" + u.toUpperCase() + "')")); k && (lr += " LEFT OUTER JOIN VAM_Manufacturer mr ON (p.VAM_Product_ID=mr.VAM_Product_ID) LEFT OUTER JOIN VAM_ProductFeatures patr ON (p.VAM_Product_ID=patr.VAM_Product_ID)"); c += " FROM " + lr + " JOIN VAM_Warehouse w ON (1=1)"; dt == 181 && d != null && d.length > 0 && (d += " AND (p.Discontinued = 'N' OR p.DiscontinuedBy > sysdate )"); s.length > 1 ? (v += " WHERE " + s, d != null && d.length > 0 && (v += " AND " + d.replace(/VAM_Product\./g, "p."))) : d != null && d.length > 0 && (v += " WHERE " + d.replace(/VAM_Product\./g, "p.")) } else c += " FROM " + lr + " JOIN VAM_Warehouse w ON (1=1)", v += d != null && d.length > 0 && d.trim().toUpperCase().startsWith("WHERE") ? " " + d.replace(/VAM_Product\./g, "p.") + " AND " + o + "_ID=-1" : d != null && d.length > 0 ? " WHERE p." + o + "_ID=-1 AND " + d.replace(/VAM_Product\./g, "p.") : " WHERE p." + o + "_ID=-1"; r || (r = 1); g = n.secureEngine.encrypt(c); nt = n.secureEngine.encrypt(v); t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetData", dataType: "json", type: "POST", data: { sql: g, where: nt, tableName: o, pageNo: r, ForMobile: pu }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); y[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { y[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); y[0].style.visibility = "hidden"; return } ve(i.pSetting); ee(i.data) } }) }, ee = function (i) { var r, o, s, f; if (i == null) { alert(n.Msg.getMsg("NoDataFound")); y[0].style.visibility = "hidden"; return } var e = [], c = [], u = null; for (f in i) r = { resizable: !0 }, u = tt[f].VAF_Control_Ref_ID, r.caption = tt[f].Name, r.field = tt[f].ColumnName.toUpperCase(), r.columnName = tt[f].ColumnName.toUpperCase(), r.sortable = !0, r.hidden = !1, r.size = "100px", n.DisplayType.IsNumeric(u) ? (r.render = u == n.DisplayType.Integer ? "int" : function (t, i, r) { var u = n.Utility.Util.getValueOfDecimal(t[e[r].field]); return u.toLocaleString() }, tt[f].ColumnName.toUpperCase() == "QTYENTERED" && h && !st && (r.editable = { type: "float" })) : n.DisplayType.IsDate(u) ? r.render = function (n, t, i) { var r = n[e[i].field]; return r ? new Date(r).toLocaleDateString() : "" } : u == n.DisplayType.Location || u == n.DisplayType.Locator ? r.render = "int" : u == n.DisplayType.Account ? r.render = "int" : u == n.DisplayType.PAttribute ? r.render = "int" : u == n.DisplayType.Button ? r.render = function () { return "<div>button<\/div>" } : u == n.DisplayType.Image ? r.render = function () { return "<div>Image<\/div>" } : n.DisplayType.IsLOB(u) && (r.render = function () { return "<div>[Lob-blob]<\/div>" }), e[f] = r; for (e[e.length] = { field: "VAM_PFeature_SetInstance_ID", caption: "VAM_PFeature_SetInstance_ID", size: "150px", hidden: !0 }, o = 0; o < i[0].RowCount; o++) { s = {}; for (f in i) s[i[f].ColumnName.toUpperCase()] = i[f].Values[o]; s.VAM_PFeature_SetInstance_ID = 0; s.recid = o + 1; c[o] = s } l = "gridPrdInfodata" + Math.random(); l = l.replace(".", ""); w2utils.encodeTags(c); et = t(ii).w2grid({ name: l, recordHeight: 40, show: { toolbar: !0, columnHeaders: !0, lineNumbers: !0, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: e, records: c, onExpand: function (n) { y[0].style.visibility = "visible"; ye(n); w2ui.hasOwnProperty("subgrid-" + n.recid) && w2ui["subgrid-" + n.recid].destroy(); p.indexOf(n.recid) == -1 && p.push(n.recid); t("#" + n.box_id).css({ margin: "0px", padding: "0px", width: "100%", height: "105px" }); setTimeout(function () { t("#" + n.box_id).w2grid({ name: "subgrid-" + n.recid, show: { columnHeaders: !0, selectColumn: !0 }, fixedBody: !0, columns: uu, records: bu, onChange: function (n) { var u = -1, f = w2ui[n.target].records[n.index].ParentRec_ID, r, i, t; if (a.length > 0) { for (r in a) if (a[r].VAM_Product_ID == w2ui[l].records[f - 1].VAM_Product_ID && a[r].VAM_PFeature_SetInstance_ID == w2ui[n.target].records[n.index].VAM_PFeature_SetInstance_ID) { u = r; break } u > -1 ? a[u].QTYENTERED = n.value_new : (i = w2ui[l].records[f - 1], t = JSON.parse(JSON.stringify(i)), t.VAM_PFeature_SetInstance_ID = w2ui[n.target].records[n.index].VAM_PFeature_SetInstance_ID, t.QTYENTERED = n.value_new, a.push(t)) } else i = w2ui[l].records[f - 1], t = JSON.parse(JSON.stringify(i)), t.VAM_PFeature_SetInstance_ID = w2ui[n.target].records[n.index].VAM_PFeature_SetInstance_ID, t.QTYENTERED = n.value_new, a.push(t) } }); w2ui["subgrid-" + n.recid].resize(); y[0].style.visibility = "hidden" }, 500) }, onChange: function (n) { var i = -1, t; if (w2ui[l].records[n.index].QTYENTERED = n.value_new, a.length > 0) { for (t in a) if (a[t].VAM_Product_ID == w2ui[l].records[n.index].VAM_Product_ID && a[t].VAM_PFeature_SetInstance_ID == 0) { i = t; break } i > -1 ? a[i].QTYENTERED = n.value_new : a.push(w2ui[l].records[n.index]) } else a.push(w2ui[l].records[n.index]) } }); w2ui[l].hideColumn("VAM_Product_ID"); w2ui[l].hideColumn("VAB_UOM_ID"); w2ui[l].hideColumn("UOM"); w2ui[l].hideColumn("VAM_Warehouse_ID"); w2ui[l].hideColumn("VAM_PriceListVersion_ID"); (!h || st) && w2ui[l].hideColumn("QTYENTERED"); y[0].style.visibility = "hidden" }, oe = function () { et != null && et.destroy(); et = null }; this.getSelectedValues = function () { return a }; this.getRefreshStatus = function () { return eu }; var se = function () { if (h && (a.length > 0 || w2ui[l].getSelection().length > 0)) he(); else return }, he = function () { var u, y, f, o, s, h, e, t, c, i; if (w2ui[l].getSelection().length > 0) { u = w2ui[l].getSelection(); for (t in u) if (y = w2ui[l].get(u[t]).VAM_Product_ID, f = "subgrid-" + w2ui[l].get(u[t]).recid, w2ui[f] != undefined) if (w2ui[f].getSelection().length > 0) { o = w2ui[f].getSelection(); for (s in o) if (a.length > 0) if (i = a.map(function (n) { return n.VAM_Product_ID == y && n.VAM_PFeature_SetInstance_ID == w2ui[f].records[o[s] - 1].VAM_PFeature_SetInstance_ID }).indexOf(!0), i > -1) continue; else h = w2ui[l].get(u[t]), e = JSON.parse(JSON.stringify(h)), e.VAM_PFeature_SetInstance_ID = w2ui[f].records[o[s] - 1].VAM_PFeature_SetInstance_ID, e.QTYENTERED = w2ui[f].records[o[s] - 1].Quantity, a.push(e); else h = w2ui[l].get(u[t]), e = JSON.parse(JSON.stringify(h)), e.VAM_PFeature_SetInstance_ID = w2ui[f].records[o[s] - 1].VAM_PFeature_SetInstance_ID, e.QTYENTERED = w2ui[f].records[o[s] - 1].Quantity, a.push(e) } else if (a.length > 0) if (i = a.map(function (n) { return n.VAM_Product_ID == y && n.VAM_PFeature_SetInstance_ID == 0 }).indexOf(!0), i > -1) continue; else a.push(w2ui[l].get(u[t])); else a.push(w2ui[l].get(u[t])); else if (a.length > 0) if (i = a.map(function (n) { return n.VAM_Product_ID == y && n.VAM_PFeature_SetInstance_ID == 0 }).indexOf(!0), i > -1) continue; else a.push(w2ui[l].get(u[t])); else a.push(w2ui[l].get(u[t])) } if (a.length > 0) for (t in a) c = a[t].QTYENTERED, c > 0 && (v.length > 0 ? (i = v.map(function (n) { return n._prdID == a[t].VAM_Product_ID && n._Attribute == a[t].VAM_PFeature_SetInstance_ID }).indexOf(!0), i > -1 ? v[i]._prodQty += c : v.push({ _prodQty: c, _prdID: a[t].VAM_Product_ID, _prdName: a[t].NAME, _value: a[t].VALUE, _uom: a[t].VAB_UOM_ID, _uomName: a[t].UOM, _VAF_Session_ID: n.Env.getCtx().getContext("#VAF_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: a[t].VAM_PFeature_SetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })) : v.push({ _prodQty: c, _prdID: a[t].VAM_Product_ID, _prdName: a[t].NAME, _value: a[t].VALUE, _uom: a[t].VAB_UOM_ID, _uomName: a[t].UOM, _VAF_Session_ID: n.Env.getCtx().getContext("#VAF_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: a[t].VAM_PFeature_SetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })) }, iu = function () { if (ut.off("keyup"), bi.off("click"), ki.off("click"), di.off("click"), at.off("click"), vt.off("click"), yt.off("click"), pt.off("click"), g.off("change"), at = vt = yt = pt = g = null, ii = null, yi = null, et != null && et.destroy(), et = null, ff = null, ai = null, ef = null, of = null, sf = null, vi = null, yi = null, ii = null, ri = null, pi = null, ui = null, fi = null, bt = null, bi = null, ki = null, kr = null, di = null, wi = null, y = null, hf = null, b = null, tt = null, et = null, lt = null, gi = null, a = null, cf = null, v = null, w = null, eu = !1, pu = null, ti = null, ut != null && (ut.dialog("destroy"), ut.remove()), ut = null, this.btnOKClick = null, this.displaySearchCol = null, this.displayData = null, this.loadData = null, this.disposeComponent = null, this.disposeDataSec = null, this.getSelectedValues = null, this.refreshUI = null, p.length > 0) { for (var n = 0; n < p.length; n++)w2ui["subgrid-" + p[n]].destroy(); p = [] } } } n.infoProduct = i }(VIS, jQuery), function (n, t) { function i(i, r) { function ui() { var r, l; s.css("width", "100%"); s.css("height", "100%"); s.css("position", "relative"); ot.css("width", "100%"); it = t("<div class='vis-info-l-s-wrap vis-pad-0 vis-leftsidebarouterwrap'>"); yt = t("<div class='vis-info-l-s-content'>"); it.append(yt); pt = t("<div class='vis-info-datasec'>"); g = t("<div class='vis-info-btnsec vis-just-cont-end'>"); st.append(it); st.append(pt); st.append(g); lt = n.Msg.translate(n.Env.getCtx(), "Name"); lt.indexOf("&") > -1 && (lt = lt.replace("&", "")); wt = n.Msg.translate(n.Env.getCtx(), "ReferenceNo"); wt.indexOf("&") > -1 && (wt = lblUPCtxt.replace("&", "")); at = n.Msg.translate(n.Env.getCtx(), "FromDate"); at.indexOf("&") > -1 && (at = at.replace("&", "")); vt = n.Msg.translate(n.Env.getCtx(), "ToDate"); vt.indexOf("&") > -1 && (vt = vt.replace("&", "")); ut = n.Msg.getMsg("Cancel"); ut.indexOf("&") > -1 && (ut = ut.replace("&", "")); rt = n.Msg.getMsg("Search"); rt.indexOf("&") > -1 && (rt = rt.replace("&", "")); ft = n.Msg.getMsg("Ok"); ft.indexOf("&") > -1 && (ft = ft.replace("&", "")); v = t("<div class='vis-info-btnswrap'>"); ht = t("<div class='vis-info-ls-btnswrap'>"); c = t("<tr>"); ot.append(c); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(lt); c.append(f); f.append(o); o.append(u); r = {}; h = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 100, null, null, !1); r.Ctrl = h; r.VAF_Control_Ref_ID = 10; r.ColumnName = "Name"; l = t("<td>"); u.append(h.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); a.push(r); c = t("<tr>"); ot.append(c); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(wt); c.append(f); f.append(o); o.append(u); r = {}; h = new n.Controls.VTextBox("Reference", !1, !1, !0, 50, 100, null, null, !1); r.Ctrl = h; r.VAF_Control_Ref_ID = 10; r.ColumnName = "Reference"; l = t("<td>"); u.append(h.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); a.push(r); c = t("<tr>"); ot.append(c); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(at); c.append(f); f.append(o); o.append(u); r = {}; h = new n.Controls.VDate("TrxFromDate", !1, !1, !0, n.DisplayType.Date, n.Msg.translate("FromDate")); r.Ctrl = h; r.VAF_Control_Ref_ID = 10; r.ColumnName = "TrxFromDate"; l = t("<td>"); u.append(h.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); a.push(r); c = t("<tr>"); ot.append(c); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(vt); c.append(f); f.append(o); o.append(u); r = {}; h = new n.Controls.VDate("TrxToDate", !1, !1, !0, n.DisplayType.Date, n.Msg.translate("ToDate")); r.Ctrl = h; r.VAF_Control_Ref_ID = 10; r.ColumnName = "TrxToDate"; l = t("<td>"); u.append(h.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); a.push(r); yt.append(ot); et = t("<button class='VIS_Pref_btn-2'>").append(ut); tt = t("<button class='VIS_Pref_btn-2'>").append(ft); ct = t("<button class='VIS_Pref_btn-2'>").append(rt); v.append(et); v.append(tt); v.append(t('<div><input type="checkbox" id="chkDelCart_' + i + '" ><span>' + n.Msg.getMsg("DeleteCart") + "<\/span>")); ht.append(ct); it.append(ht); g.append(v); dt = t('<div class="vis-info-pagingwrp">'); si(); dt.append(gt); v.append(et); v.append(tt); ht.append(ct); it.append(ht); g.append(ni); g.append(dt); g.append(v); e = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); e[0].style.visibility = "visible"; kt = g.find("#chkDelCart_" + i); s.append(st); s.append(e) } function fi() { if (!n.Application.isMobile) s.on("keyup", function (n) { n.keyCode === 13 && (e[0].style.visibility = "visible", o = [], u.selectNone(), d(!0, f.val())) }); et.on("click", function () { l.dispose() }); tt.on("click", function () { oi() }); ct.on("click", function () { e[0].style.visibility = "visible"; o = []; u.selectNone(); d(!0, 1) }) } function si() { gt = t('<ul class="vis-statusbar-ul">'); p = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="First Page" style="opacity: 0.6;"><\/i><\/div><\/li>'); w = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="Page Up" style="opacity: 0.6;"><\/i><\/div><\/li>'); f = t("<select>"); bt = t("<li>").append(f); b = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="Page Down" style="opacity: 0.6;"><\/i><\/div><\/li>'); k = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="Last Page" style="opacity: 0.6;"><\/i><\/div><\/li>'); gt.append(p).append(w).append(bt).append(b).append(k); hi() } function hi() { p.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, 1)) }); w.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, parseInt(f.val()) - 1)) }); b.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, parseInt(f.val()) + 1)) }); k.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, parseInt(f.find("Option:last").val()))) }); f.on("change", function () { e[0].style.visibility = "visible"; d(!0, f.val()) }) } function ci(n) { f = null; bt.find("select").remove(); f = t("<select>"); bt.append(f); f.on("change", function () { e[0].style.visibility = "visible"; d(!0, f.val()) }); if (n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)f.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); f.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (b.css("opacity", "1"), k.css("opacity", "1")) : (b.css("opacity", "0.6"), k.css("opacity", "0.6")); n.CurrentPage > 1 ? (p.css("opacity", "1"), w.css("opacity", "1")) : (p.css("opacity", "0.6"), w.css("opacity", "0.6")); n.TotalPage == 1 && (p.css("opacity", "0.6"), w.css("opacity", "0.6"), b.css("opacity", "0.6"), k.css("opacity", "0.6")) } else p.css("opacity", "0.6"), w.css("opacity", "0.6"), b.css("opacity", "0.6"), k.css("opacity", "0.6") } this.onClose = null; this.arrListColumns = []; var s = t("<div>"), ti = !0, st = t("<div class='vis-info-subroot'>"), it = null, yt = null, pt = null, g = null, rt = null, ut = null, ft = null, v = null, ht = null, et = null, tt = null, ct = null, kt = null, ni = null, e = null, u = null, l = this, y = 0, lt = null, wt = null, at = null, vt = null, nt = null, h = null, ot = t("<table>"), c = null, ii = !1, a = [], dt, gt, p, w, bt, b, k, f, o = [], li = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()), ri = n.context.getWindowTabContext(i, 0, "VAF_Tab_ID"); y = n.dataContext.getJSONRecord("InfoProduct/GetWindowID", ri.toString()); ui(); fi(); var d = function (f, s) { var p, c, l, v, g; if (u) { p = u.getSelection(); for (item in p) o.indexOf(u.get(p[item]).count_ID) == -1 && o.push(u.get(p[item]).count_ID) } var h = "", b = 0, k = 0, w = 0, d = 0; if (f == !0) { for (c = null, l = 0; l < a.length; l++)(c = a[l].Ctrl.getValue(), c != null && c.length != 0 && c != 0) && (a[l].Ctrl.colName == "Name" ? h += " AND upper(VAICNT_ScanName) LIKE '%" + c.toUpperCase() + "%' " : a[l].Ctrl.colName == "Reference" ? h += " AND upper(VAICNT_ReferenceNo) LIKE '%" + c.toUpperCase() + "%' " : a[l].Ctrl.colName == "TrxFromDate" ? (v = n.DB.to_date(c, !0), h += " AND DateTrx >= " + v) : a[l].Ctrl.colName == "TrxToDate" && (v = n.DB.to_date(c, !0), h += " AND DateTrx <= " + v)); r ? h += " AND VAICNVAT_TransactionType = 'OT' " : y == 184 ? h += " AND VAICNVAT_TransactionType = 'MR' and VAICNT_ReferenceNo in (SELECT DocumentNo from VAB_Order WHERE VAB_BusinessPartner_ID = " + n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(i, 0, "VAB_BusinessPartner_ID")) + " AND DocStatus IN ('CO', 'CL'))" : y == 319 || y == 170 ? (h += " AND VAICNVAT_TransactionType = 'IM' ", b = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "VAM_Locator_ID", !0)), k = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "VAM_LocatorTo_ID", !0)), w = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "DTD001_MWarehouseSource_ID", !0)), d = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "VAM_Warehouse_ID", !0))) : y == 168 ? (h += " AND VAICNVAT_TransactionType = 'PI' ", w = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "VAM_Warehouse_ID", !0))) : h += y == 169 ? " AND VAICNVAT_TransactionType = 'SH' and VAICNT_ReferenceNo in (SELECT DocumentNo from VAB_Order WHERE  VAB_BusinessPartner_ID = " + n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(i, 0, "VAB_BusinessPartner_ID")) + " AND DocStatus IN ('CO'))" : y == 341 ? " AND VAICNVAT_TransactionType = 'IU' AND VAICNT_ReferenceNo IN (SELECT DocumentNo FROM VAM_Requisition WHERE IsActive = 'Y' AND VAM_Warehouse_ID = " + n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "VAM_Warehouse_ID", !0)) + " AND DocStatus IN ('CO'))" : " AND VAICNVAT_TransactionType = 'OT' " } else h += " AND VAICNT_InventoryCount_ID = -1"; sql = "SELECT VAICNT_ScanName,VAICNT_ReferenceNo,DateTrx,VAICNT_InventoryCount_ID FROM VAICNT_InventoryCount WHERE IsActive='Y' AND VAF_Client_ID = " + n.Utility.Util.getValueOfInt(n.context.getVAF_Client_ID()) + h; g = n.secureEngine.encrypt(sql); s || (s = 1); t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetCart", dataType: "json", data: { sql: g, pageNo: s, isCart: r, windowID: y, WarehouseID: w, WarehouseToID: d, LocatorID: b, LocatorToID: k }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); e[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { e[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); e[0].style.visibility = "hidden"; return } ci(i.pSetting); ei(i.data) } }) }, ei = function (i) { if (i == null) { e[0].style.visibility = "hidden"; return } u != null && (u.destroy(), u = null); u = null; l.arrListColumns = []; l.arrListColumns.push({ field: "Name", caption: n.Msg.translate(n.Env.getCtx(), "Name"), sortable: !0, size: "16%", min: 150, hidden: !1 }); l.arrListColumns.push({ field: "Reference", caption: n.Msg.translate(n.Env.getCtx(), "ReferenceNo"), sortable: !0, size: "16%", min: 150, hidden: !1 }); l.arrListColumns.push({ field: "TrxDate", caption: n.Msg.translate(n.Env.getCtx(), "DateTrx"), sortable: !0, size: "16%", min: 150, hidden: !1, render: "date" }); l.arrListColumns.push({ field: "count_ID", caption: n.Msg.translate(n.Env.getCtx(), "ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }); var r = "gridPrdInfodata" + Math.random(); r = r.replace(".", ""); w2utils.encodeTags(i); u = t(pt).w2grid({ name: r, recordHeight: 30, show: { columnHeaders: !0, lineNumbers: !0, selectColumn: !0 }, columns: l.arrListColumns, records: i, onClick: function () { u.records.length > 0 && tt.removeAttr("disabled") } }); u.selectNone(); for (itm in o) for (item in u.records) u.records[item].count_ID == o[itm] && u.select(parseInt(item) + 1); u.on("unselect", function (n) { if (n.all) n.onComplete = function () { for (item in u.records) { var n = u.records[item].count_ID; o.indexOf(n) > -1 && o.splice(o.indexOf(n), 1) } }; else { var t = u.records[n.index].count_ID; o.indexOf(t) > -1 && o.splice(o.indexOf(t), 1) } }); e[0].style.visibility = "hidden" }, oi = function () { var t = "", i, r, f; if (u != null) { if (i = u.getSelection(), i.length > 0) for (r in i) o.indexOf(u.get(i[r]).count_ID) == -1 && o.push(u.get(i[r]).count_ID); if (o.length > 0) { for (r in o) t += o[r] + ","; if (t = t.substr(0, t.length - 1), f = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetCartData", { invCount_ID: t, WindowID: y }, null), l.onClose) l.onClose(f, kt.prop("checked"), t); s.dialog("close") } else alert("Please Select a Record") } }; this.showDialog = function () { s.dialog({ modal: !0, title: n.Msg.translate(n.Env.getCtx(), "Info Scan"), width: 800, height: 450, resizable: !1, close: function () { l.dispose() } }); d(!1, f.val()) }; this.disposeComponent = function () { s.off("keyup"); et.off("click"); tt.off("click"); ct.off("click"); pt = null; yt = null; p.off("click"); w.off("click"); b.off("click"); k.off("click"); f.off("change"); p = w = b = k = f = null; u != null && u.destroy(); u = null; ti = null; st = null; it = null; g = null; rt = null; ut = null; ft = null; v = null; et = null; tt = null; kt = null; ni = null; e = null; a = null; l = null; ii = !1; s != null && (s.dialog("destroy"), s.remove()); s = null; this.displayData = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.InfoScanForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h) { function fi() { d.empty(); d = null; pt.empty(); pt = null; g.empty(); g = null; c = null; v = null; y = null; p = null; w = null; ot = null; ut = null; ft = null; nt = null; tt = null; it = null; rt = null; l = null; ot = null; b = null; progresBar = null; k = null; et != null && (et.dialog("destroy"), et.remove()); et = null } function li() { wt.onClose && wt.onClose(); fi() } function ei() { ui || (l[0].style.visibility = "visible", t.ajax({ url: n.Application.contextUrl + "Attachment/GetAttachment", dataType: "json", data: { VAF_TableView_ID: u, Record_ID: f }, error: function () { n.ADialog.info("ERRORGettingAttachment"); l[0].style.visibility = "hidden" }, success: function (i) { var u = i.result.FLocation, f = i.result.Attachment, e, a, v, ot, ri, o, h, y, p, w, c, tt, st, it, ht, rt, ct, ut, vt, bt, kt, dt, ft, gt, ni; if (u == null) { n.ADialog.info("ERRORGettingAttachment"); l[0].style.visibility = "hidden"; return } e = t("<div class='vis-latest-attachments'>"); nt.append(e); a = t("<div class='vis-attach-top'>"); e.append(a); var ti = t("<div class='vis-attach-file-location'>"), ii = t("<div class='input-group vis-input-wrap' style='margin-bottom: 0;'>"), et = t("<div class='vis-control-wrap'>"); a.append(ti); ti.append(ii); ii.append(et); lt = t('<select class="vis-custom-select">'); lt.attr("disabled", !0); for (v in u.values) ot = t("<option value=" + u.values[v].Key + ">"), ot.append(u.values[v].Name), lt.append(ot), u.selectedvalue == u.values[v].Key && lt.val(u.selectedvalue); et.append(lt); ri = t("<label>").append(n.Msg.getMsg("FileLocation")); et.append(ri); o = t("<div class='vis-attach-top-btns'>"); a.append(o); h = t("<input type='file' multiple='true' style='display:none;'>"); o.append(h); h.change(function () { vi(this) }); h.click(function () { this.value = null }); y = t("<a title='" + n.Msg.getMsg("SelectFile") + "' class='vis-attach-ico'><i class='fa fa-paperclip' aria-hidden='true'><\/i><\/a>"); o.append(y); y.on("click", function () { h.trigger("click") }); s && y.hide(); p = t("<div class='vis-dropdown pull-left'>"); o.append(p); w = t("<a class='vis-btn vis-btn-arrange vis-dropdown-toggle' type='button' data-toggle='dropdown' style='color: #fff;display:none;'>"); w.append(n.Msg.getMsg("Arrange")); w.append(t("<span class='vis-caret'>")); p.append(w); c = t("<ul class='dropdown-menu' role='menu' aria-labelledby='dropdownMenu1' id='dropdownMenu' style='margin-left: -33px;'>"); p.append(c); tt = t("<li role='presentation'>"); st = t("<a role='menuitem' tabindex='-1' href='#'>"); st.append(n.Msg.getMsg("Type")); tt.append(st); tt.on("click", function () { }); c.append(tt); it = t("<li role='presentation'>"); ht = t("<a role='menuitem' tabindex='-1' href='#'>"); ht.append(n.Msg.getMsg("Size")); it.append(ht); it.on("click", function () { }); c.append(it); rt = t("<li role='presentation'>"); ct = t("<a role='menuitem' tabindex='-1' href='#'>"); ct.append(n.Msg.getMsg("Name")); rt.append(ct); rt.on("click", function () { }); c.append(rt); d = t("<div class='vis-attach-content-wrap' style='display:none;'>"); e.append(d); e.append(at); ut = t("<div class='vis-pull-right'>"); at.append(ut); vt = t("<a title='" + n.Msg.getMsg("Upload") + "' href='javascript:void(0)'  class='vis-attach-ico'><i class='fa fa-upload' aria-hidden='true'><\/i><\/a>"); ut.append(vt); vt.on("click", function () { yi() }); bt = t("<a title='" + n.Msg.getMsg("Cancel") + "' href='javascript:void(0)'  class='vis-attach-ico'><i class='fa fa-times-circle-o' aria-hidden='true'><\/i><\/a>"); ut.append(bt); bt.on("click", function () { d.empty(); yt = []; b = []; d.hide(); at.hide(); g.css("height", "353px") }); if (pt = t("<div class='vis-old-attachments'>"), nt.append(pt), g = t("<div class='vis-attach-content-wrap' style='height: 353px;'>"), pt.append(g), f != null && (r = f.VAF_Attachment_ID), f != null && f._lines != null) { r = f.VAF_Attachment_ID; for (kt in f._lines) oi(f._lines[kt], kt) } dt = t("<div class='vis-attach-footer'>"); nt.append(dt); ft = t("<div class='vis-attach-btns pull-right' style='margin-top: 5px;'>"); dt.append(ft); gt = t('<a  title="' + n.Msg.getMsg("DeleteAll") + '" class="vis-btn">').append(n.Msg.getMsg("DeleteAll")); ft.append(gt); gt.on("click", function () { k.length == 0 || s || n.ADialog.confirm("DeleteRecord?", !0, "", "Confirm", function (i) { var r, u; if (i) { r = ""; for (u in k) r += k[u].Line_ID + ","; l[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Attachment/DeleteAttachment", dataType: "json", data: { AttachmentLines: r }, error: function () { n.ADialog.info("ERRORDeletingFile"); l[0].style.visibility = "hidden" }, success: function (t) { t.result == -1 ? n.ADialog.info("ErrorDeletingFile") : (g.empty(), k = []); l[0].style.visibility = "hidden" } }) } }) }); ni = t('<a title="' + n.Msg.getMsg("Cancel") + '" class="vis-btn">').append(n.Msg.getMsg("Cancel")); ni.on("click", function () { wt.onClose && wt.onClose(); fi() }); ft.append(ni); ui = !0; l[0].style.visibility = "hidden" } })) } var ui = !1, d = null, pt = null, g = null, lt = null, r = 0, wt, et, ot, c, v, y, p, w, ft, nt, tt, it, rt, ut, l, gt, bt, st, kt, ni, a; o || (o = 0); h || (h = !1); s || (s = !1); this.onClose = null; wt = this; et = null; et = n.Application.isRTL ? t("<div style='overflow:hidden;width:100%;height:100%;'>") : t("<div style='overflow:hidden;width:100%;height:100%;'>"); ot = t("<ul style='height:30px;display:none;list-style:none;width:97%;margin-left:-41px'>"); c = t("<li>"); c.css("float", "left"); c.css("margin", "1px"); c.css("padding", "5px"); c.css("display", "block"); c.css("position", "relative"); c.css("font-weight", "700"); c.css("border", "0px"); c.css("border-bottom", "none"); c.css("border-width", "1px"); c.css("color", "#999"); c.css("cursor", "default"); c.css("height", "35px"); c.css("margin-bottom", "-1px"); c.css("margin-right", "5px"); c.css("border-top-left-radius", "3px"); c.css("border-top-right-radius", "3px"); c.append(n.Msg.getMsg("FileAttachment")); ot.append(c); v = t("<li>"); v.css("float", "left"); v.css("margin", "1px"); v.css("padding", "5px"); v.css("display", "block"); v.css("position", "relative"); v.css("font-weight", "700"); c.css("border", "0px"); v.css("border-bottom", "none"); v.css("border-width", "1px"); v.css("color", "#999"); v.css("cursor", "default"); v.css("height", "35px"); v.css("margin-bottom", "-1px"); v.css("margin-right", "5px"); v.css("border-top-left-radius", "3px"); v.css("border-top-right-radius", "3px"); v.append(n.Msg.getMsg("InboxMailAttachment")); ot.append(v); y = t("<li>"); y.css("float", "left"); y.css("margin", "1px"); y.css("padding", "5px"); y.css("display", "block"); y.css("position", "relative"); y.css("font-weight", "700"); c.css("border", "0px"); y.css("border-bottom", "none"); y.css("border-width", "1px"); y.css("color", "#999"); y.css("cursor", "default"); y.css("height", "35px"); y.css("margin-bottom", "-1px"); y.css("margin-right", "5px"); y.css("border-top-left-radius", "3px"); y.css("border-top-right-radius", "3px"); y.append(n.Msg.getMsg("SentMailAttachment")); ot.append(y); p = t("<li>"); p.css("float", "left"); p.css("margin", "1px"); p.css("padding", "5px"); p.css("display", "block"); p.css("position", "relative"); p.css("font-weight", "700"); c.css("border", "0px"); p.css("border-bottom", "none"); p.css("border-width", "1px"); p.css("color", "#999"); p.css("cursor", "default"); p.css("height", "35px"); p.css("margin-bottom", "-1px"); p.css("margin-right", "5px"); p.css("border-top-left-radius", "3px"); p.css("border-top-right-radius", "3px"); p.append(n.Msg.getMsg("Letter")); ot.append(p); w = t("<li>"); w.css("float", "left"); w.css("margin", "1px"); w.css("padding", "5px"); w.css("display", "block"); w.css("position", "relative"); w.css("font-weight", "700"); c.css("border", "0px"); w.css("border-bottom", "none"); w.css("border-width", "1px"); w.css("color", "#999"); w.css("cursor", "default"); w.css("height", "35px"); w.css("margin-bottom", "-1px"); w.css("margin-right", "5px"); w.css("border-top-left-radius", "3px"); w.css("border-top-right-radius", "3px"); w.append(n.Msg.getMsg("Appointments")); ot.append(w); et.append(ot); ft = t("<div class='vis-pu-outerwrap'>"); nt = t("<div class='vis-pu-innerwrap'>"); ft.append(nt); tt = t("<div>"); tt.append("Inbox Mail Att"); tt.css("width", "100%"); tt.css("height", "100%"); tt.css("position", "absolute"); ft.append(tt); it = t("<div>"); it.append("SENT MAIL Att"); it.css("width", "100%"); it.css("height", "100%"); it.css("position", "absolute"); ft.append(it); rt = t("<div>"); rt.append("Leter Att"); rt.css("width", "100%"); rt.css("height", "100%"); rt.css("position", "absolute"); ft.append(rt); ut = t("<div>"); ut.append("Appointment Att"); ut.css("width", "100%"); ut.css("height", "100%"); ut.css("position", "absolute"); ft.append(ut); l = t("<div class='vis-apanel-busy'>"); l.css("width", "100%"); l.css("height", "100%"); l.css("text-align", "center"); l.css("position", "absolute"); ft.append(l); gt = t("<div style='width: 100%;height: 100%;background:black;opacity: .1;display:none; position:absolute;top:0;left:0'>"); ft.append(gt); bt = t("<div style='width: 100%;height: 100%;background:transparent;text-align: center;display:none ;vertical-align: middle;position:absolute;top:0;left:0'>"); ft.append(bt); st = null; st = n.Application.isRTL ? t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:41%;width: 80%;right: 9%;'>") : t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:41%;width: 80%;left: 9%;'>"); kt = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute'>"); ni = t("<span class='vis-ui-label'  style='position:absolute'>").append("0%"); kt.append(ni); st.append(kt); bt.append(st); et.append(ft); nt[0].style.visibility = "visible"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; l[0].style.visibility = "hidden"; c.css("background", "#fff"); c.css("color", "#0088CC"); a = function (n, t) { t ? (n.css("background", "#fff"), n.css("color", "#0088CC")) : (n.css("background", "#eee"), n.css("color", "#999")) }; c.on("click", function () { nt[0].style.visibility = "visible"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; l[0].style.visibility = "hidden"; a(c, !0); a(v, !1); a(y, !1); a(p, !1); a(w, !1); ei() }); v.on("click", function () { nt[0].style.visibility = "hidden"; tt[0].style.visibility = "visible"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; l[0].style.visibility = "hidden"; a(c, !1); a(v, !0); a(y, !1); a(p, !1); a(w, !1) }); y.on("click", function () { nt[0].style.visibility = "hidden"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "visible"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; l[0].style.visibility = "hidden"; a(c, !1); a(v, !1); a(y, !0); a(p, !1); a(w, !1) }); p.on("click", function () { nt[0].style.visibility = "hidden"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "visible"; ut[0].style.visibility = "hidden"; l[0].style.visibility = "hidden"; a(c, !1); a(v, !1); a(y, !1); a(p, !0); a(w, !1) }); w.on("click", function () { nt[0].style.visibility = "hidden"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "visible"; l[0].style.visibility = "hidden"; a(c, !1); a(v, !1); a(y, !1); a(p, !1); a(w, !0) }); this.show = function () { nt[0].style.visibility = "visible"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; l[0].style.visibility = "hidden"; a(c, !0); a(v, !1); a(y, !1); a(p, !1); a(w, !1); ei(); et.dialog({ width: 841, height: 502, title: n.Msg.getMsg("Attachment"), resizable: !1, modal: !0, close: li }) }; var at = t("<div class='vis-pu-uploadsbtnswrap'>"), b = []; var ai = function () { t.ajax({ url: n.Application.contextUrl + "Attachment/GetAttachment", dataType: "json", data: { VAF_TableView_ID: u, Record_ID: f }, error: function () { n.ADialog.info("ERRORGettingAttachment"); l[0].style.visibility = "hidden" }, success: function (n) { var t = n.result.Attachment, i; if (t != null && (r = t.VAF_Attachment_ID), t != null && t._lines != null) { r = t.VAF_Attachment_ID; for (i in t._lines) oi(t._lines[i], i) } l[0].style.visibility = "hidden" } }) }, vi = function (i) { for (var r = [], u, l, o, a, v, s, y, nt, w, c, f, it, e = 0; e < i.files.length; e++) { if (file = i.files[e], file == undefined) return; if (file.name.indexOf("&") > -1 || file.name.indexOf("?") > -1 || file.name.indexOf("#") > -1 || file.name.indexOf("/") > -1 || file.name.indexOf("\\") > -1) { r.push(file.name); continue } for (u in b) if (file.name == b[u].name) { window.setTimeout(function () { n.ADialog.info("AlreadyExists") }, 20); return } if (k != null) for (u in k) if (file.name == k[u].Name && !k[u].IsDeleted) { window.setTimeout(function () { n.ADialog.info("AlreadyExists") }, 20); return } l = {}; o = t("<div class='vis-attach-file-wrapla'>"); d.append(o); a = t("<div class='vis-attach-file-top'>"); v = t("<a class='vis-file-close-ico'><i class='fa fa-times' aria-hidden='true'><\/i><\/a>"); a.append(v); o.append(a); d.show(); at.show(); v.on("click", function () { var n = t(t(this).parent()).parent(), r, i; n.css("display", "none"); r = n.html(); n.empty(); n = null; for (i in b) if (String(r).indexOf(b[i].name) > -1) { b.splice(i, 1); break } b.length > 4 ? (d.css("height", "153px"), g.css("height", "153px")) : (d.css("height", "97px"), g.css("height", "209px")); b.length == 0 && (d.hide(), at.hide(), d.css("height", "0px"), g.css("height", "353px")) }); s = t("<div class='vis-attach-file-content'>"); o.append(s); y = t("<div class='vis-attach-file-icon'>"); nt = ci(file.name); y.append(t("<img src='" + nt + "'>")); s.append(y); var p = t("<div class='vis-attach-file-text' style='margin-bottom:10px'>"), tt = "", h = t("<p>"); file.name.length > 17 ? (tt = file.name.toString().substr(0, 17), h.append(tt), w = t("<a href='#' class='VIS_Pref_tooltip'>").append("..."), c = t("<span style='width: inherit;'>"), c.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), c.append(t("<label class='VIS_Pref_Label_Font'>").append(file.name)), w.append(c), h.append(w)) : h.append(file.name); p.append(h); p.append(t("<p>").append((Number(file.size) / 1024).toFixed(2) + "KB")); s.append(p); l.Name = file.name; l.Size = file.size; b.push(file); b.length > 4 ? (d.css("height", "153px"), g.css("height", "153px")) : (d.css("height", "97px"), g.css("height", "209px")) } if (r.length > 0) { f = ""; for (it in r) f += r[it].toString() + "\n"; f += r.length == 1 ? "File has" : "Files have"; f += " invalid name. Please change the file name and try again."; n.ADialog.info(f) } }, k = [], oi = function (i, r) { var c = t("<div class='vis-attach-file-wrap'>"), u, f, a, y, o, h, p, w; g.append(c); u = {}; f = t("<div class='vis-attach-file-content'>"); c.append(f); a = t("<div class='vis-attach-file-icon'>"); a.append(t("<img src='" + ci(i.FileName) + "'>")); f.append(a); var v = t("<div class='vis-attach-file-text'>"), b = "", e = t("<p>"); i.FileName.length > 17 ? (b = i.FileName.toString().substr(0, 17), e.append(b), y = t("<a href='#' class='VIS_Pref_tooltip'>").append("..."), o = t("<span style='width: inherit;'>"), o.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), o.append(t("<label class='VIS_Pref_Label_Font'>").append(i.FileName)), y.append(o), e.append(y)) : e.append(i.FileName); v.append(e); v.append(t("<p>").append((Number(i.Size) / 1024).toFixed(2) + "KB")); f.append(v); h = t("<div class='vis-attach-BottomRight'>"); p = t("<a href='javascript:void(0)'  class='vis-attach-ico' data-id='" + r + "'><i class='fa fa-long-arrow-down' aria-hidden='true'><\/i><\/a>"); h.append(p); p.on("click", function () { var n = t(this).data("id"); k[n].HaveSource ? window.open(k[r].Source, "_blank") : pi(n, this) }); w = t("<a class='vis-attach-ico' data-id='" + r + "'><i class='vis vis-delete' aria-hidden='true'><\/i><\/a>"); h.append(w); w.on("click", function () { if (s) return !1; var i = t(this); n.ADialog.confirm("DeleteRecord?", !0, "", "Confirm", function (r) { if (r) { var u = i.data("id"); l[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Attachment/DeleteAttachment", dataType: "json", data: { AttachmentLines: k[u].Line_ID }, error: function () { n.ADialog.info("ERRORDeletingFile"); l[0].style.visibility = "hidden" }, success: function (t) { if (t.result == -1) n.ADialog.info("ErrorDeletingFile"); else { var r = i.parent().parent(); r.css("display", "none"); r.empty(); r = null; k[u].IsDeleted = !0 } l[0].style.visibility = "hidden" } }) } }) }); c.append(h); u.Name = i.FileName; u.Size = i.Size; u.Line_ID = i.Line_ID; u.HaveSource = !1; u.Source = null; u.IsDeleted = !1; k.push(u) }, ti = 0, ht = 0, si = Date.now().toString(), ct = 1048576, ii = 0, vt = 0, yt = [], yi = function () { var n = null, t, r, i; dt(!0); t = 0; r = 0; for (i in b) t = parseInt(b[i].size / ct), file.size % ct > 0 && t++, ii += t, n = {}, n.Name = b[i].name, n.Size = b[i].size, yt.push(n); hi() }, hi = function () { var i, e, s; if (b == null || b.length == 0) { dt(!1); n.ADialog.info("NothingToUpload"); return } if (ht >= b.length) { t.ajax({ url: n.Application.contextUrl + "Attachment/SaveAttachmentEntries", dataType: "json", type: "POST", data: { files: JSON.stringify(yt), VAF_Attachment_ID: r, folderKey: si, VAF_TableView_ID: u, Record_ID: f, fileLocation: lt.val(), NewRecord_ID: o, IsDMSAttachment: h }, error: function () { dt(!1); yt = []; l[0].style.visibility = "hidden" }, success: function (i) { var f = i.result.Error, r, e, u; f == "" ? (h && (r = t(".vis-old-attachments").find(".vis-attach-file-wrap"), r.length > 1 && t(r[0]).remove()), ri(100), window.setTimeout(function () { dt(!1) }, 500), yt = [], e = "transfer", u = {}, u = { to: g, className: "vis-Att-ui-effects-transfer" }, d.effect(e, u, 500, function () { window.setTimeout(function () { k = []; g.empty(); ai(); b = []; d.empty(); d.hide(); at.hide(); d.css("height", "0px"); g.css("height", "353px"); kt.css("width", "O%") }, 500) })) : (yt = [], dt(!1), n.ADialog.info(f)); ti = 0; ht = 0; ii = 0; vt = 0; l[0].style.visibility = "hidden" } }); return } i = new XMLHttpRequest; e = new FormData; e.append("file", b[ht].slice(vt * ct, vt * ct + Number(ct))); i.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + b[ht].name + "&folderKey=" + si, !1); i.send(e); ti++; vt++; s = parseInt(b[ht].size / ct); b[ht].size % ct > 0 && s++; vt == s && (ht++, vt = 0); ti <= ii && ri(parseInt(ti / ii * 80)); window.setTimeout(function () { hi() }, 2) }, dt = function (n) { n ? (gt.show(), st.show(), bt.show()) : (gt.hide(), st.hide(), bt.hide()) }, wi = function (t, i, r, u, f) { var o, c, e, s, h; for (progresBar.attr("value", 0), o = parseInt(t.size / r), t.size % r > 0 && o++, c = !1, e = 0; e < o; e++)e == o - 1 && t.size % r > 0 && (r = t.size % r), c = !0, s = new XMLHttpRequest, h = new FormData, h.append("file", t.slice(e * r, e * r + Number(r))), s.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + t.name + "&folderKey=" + i, !1), s.send(h), u++, ri(parseInt(u / f * 80)) }, pi = function (i) { l[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Attachment/DownloadAttachment", dataType: "json", data: { fileName: k[i].Name, VAF_Attachment_ID: r, VAF_AttachmentLine_ID: k[i].Line_ID }, error: function () { n.ADialog.info("ERRORGettingFile"); l[0].style.visibility = "hidden" }, success: function (t) { var u = new Date, f = t.result, r = n.Application.contextUrl + "TempDownload/" + f + "/" + k[i].Name + "?" + u.getTime(), e = k[i].Name; k[i].HaveSource = !0; l[0].style.visibility = "hidden"; window.open(r, "_blank"); k[i].Source = r } }) }, bi = function () { iFrame != null && (iFrame.css("visibility", "visible"), viewer.css("visibility", "visible"), nt.css("visibility", "collapse")) }, ri = function (n) { kt.css("width", n + "%"); ni.empty(); ni.append(n + "%") }, ki = function (n) { return st.each(function () { t(this).animate({ width: n + "%" }, { duration: 2e3, easing: "swing", step: function (n) { var i = t(".ui-label", this), r = t(".value", i); Math.ceil(n) < 20 && t(".ui-label", this).is(":visible") ? i.hide() : i.is(":hidden") && i.fadeIn(); Math.ceil(n) == 100 ? (i.text("Done"), setTimeout(function () { i.fadeOut() }, 1e3)) : r.text(Math.ceil(n) + "%") } }) }) }, ci = function (t) { var r, u, i; return t == null || t.length == 0 ? "" : (r = t.lastIndexOf("."), u = n.Application.contextUrl + "Areas/VIS/Images/", r < 1) ? u + "defult.png" : (i = t.substr(r, t.length - r), u + (i == ".xlsx" || i == ".xls" ? "excel.png" : i == ".html" || i == ".htm" ? "html.png" : i == ".pdf" ? "pdf.png" : i == ".ppt" ? "ppt.png" : i == ".txt" ? "text.png" : i == ".docx" || i == ".doc" ? "word.png" : i == ".xml" ? "xml.png" : i == ".jpg" || i == ".gif" || i == ".png" ? "image.png" : i == ".mp3" ? "audio.png" : i == ".zip" || i == ".rar" ? "compresed.png" : "defult.png")) } } n.attachmentForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function ii(i) { var r, u, f, s; i || (ct = t('<div class="wfactivity-homepage-parentdiv"><\/div>'), r = t(' <div class="frm-data-col-wrap frm-data-col-2" style="padding-right: 10px;"> <div class="frm-data-search-wrap"><input class="frm-data-col-searchinput" id="homeSearchWorkflow" type="text" placeholder="' + n.Msg.getMsg("Search") + '"><button id="btnWorkflowSearch" class="vis-wfSearch-btn"><i class="fa fa-search" aria-hidden="true"><\/i><\/button><\/div><\/div>'), nt = r.find("#homeSearchWorkflow"), kt = r.find("#btnWorkflowSearch"), u = t(' <div class="frm-data-col-wrap frm-data-col-2" style="padding-left: 7px"> <div class="frm-data-search-wrap"><select class="vis-custom-select"><\/select><\/div><\/div>'), a = u.find("select"), f = t('<div style="display:none;padding-left: 7px" class="frm-data-col-wrap frm-data-col-2"> <label>' + n.Msg.getMsg("FromDate") + '<\/label><input type="date" placeholder="date"><\/div>'), tt = f.find("input"), s = t('<div  style="display:none;padding-right:10px" class="frm-data-col-wrap frm-data-col-2"><label>' + n.Msg.getMsg("ToDate") + '<\/label><input type="date" placeholder="date"><\/div>'), y = s.find("input"), ct.append(u).append(r).append(f).append(s), d = t('<div class="frm-select-all-check"  style="display:none"><\/div>'), h = t('<input type="checkbox">'), d.append("<label>" + n.Msg.getMsg("SelectAll") + "<\/label>"), d.append(h), e.addClass("vis-eye-plus"), e.removeClass("vis-eye-minus"), e.attr("title", n.Msg.getMsg("ShowSearch"))); yt(); o = t('<div class="wfactivity-homepage-activites" style="padding-right:0px"><\/div>') } function yt(i) { t.ajax({ url: n.Application.contextUrl + "WFActivity/GetWorkflowWindows", dataType: "json", type: "POST", error: function () { return }, success: function (t) { var u, r; if (t) if (t = JSON.parse(t), a.empty(), a.append('<option value="0_0">' + n.Msg.getMsg("SelectWindow") + "<\/option>"), t && t.length > 0) { for (u = !1, r = 0; r < t.length; r++)a.append('<option value="' + t[r].VAF_Screen_ID + "_" + t[r].AD_Node_ID + '">' + t[r].WindowName + "<\/option>"), t[r].VAF_Screen_ID + "_" + t[r].AD_Node_ID == rt && (u = !0); rt && u ? a.val(rt) : (rt = "0_0", a.val("0_0")) } else rt = "0_0", a.val("0_0"); i && ht() } }) } function ri(i) { a.off("change"); a.on("change", fi); o.on("scroll", ei); if (!i) { kt.on("click", function () { w && (w = !1, ht()) }); nt.on("keydown", function (n) { n.keyCode == 13 && w && (w = !1, ht()) }); e.on("click", function () { y.is(":visible") ? (t(tt.parent()).css("display", "none"), t(y.parent()).css("display", "none"), tt.val(""), y.val(""), e.attr("title", n.Msg.getMsg("ShowSearch")), e.addClass("vis-eye-plus"), e.removeClass("vis-eye-minus"), h.is(":visible") ? o.css("top", "65px") : o.css("top", "47px")) : (t(tt.parent()).css("display", "block"), t(y.parent()).css("display", "block"), e.attr("title", n.Msg.getMsg("HideSearch")), e.removeClass("vis-eye-plus"), e.addClass("vis-eye-minus"), h.is(":visible") ? o.css("top", "118px") : o.css("top", "98px")) }); h.on("click", ui) } } function ui() { var i = o.find(".wfActivity-selectchk"), n; for (h.prop("checked") == !1 && (vt = !0), h.prop("checked") == !0 && (st = !0), n = 0; n < i.length; n++)h.prop("checked") == !0 ? t(i[n]).prop("checked") == !1 && t(i[n]).trigger("click") : t(i[n]).prop("checked") == !0 && t(i[n]).trigger("click"); vt = !1; h.prop("checked") == !1 && t(o.find(".vis-activityContainer")[0]).trigger("click") } function fi() { ft.hide(); r.empty(); a.val() == "0_0" ? (d.hide(), h.prop("checked") == !0 && h.trigger("click"), y.is(":visible") ? o.css("top", "98px") : o.css("top", "47px")) : (d.hide(), y.is(":visible") ? o.css("top", "118px") : o.css("top", "67px")); rt = a.val(); ht() } function ht() { it = 1; et = 10; ft.hide(); r.empty(); o.empty(); s = []; s.length = 0; bt.AppendRecord(it, et, !0) } function ei() { if (t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight) if (lt = parseInt(b.html()), at = it * et, at <= lt) it += 1, bt.AppendRecord(it, et); else return } function wt() { var n = o.find('input[class="wfActivity-selectchk"]:checked').length, t = o.find(".wfActivity-selectchk").length; t == n && h.prop("checked", !0) } var c = null, l = [], g = [], bt = this, ct = null, d = null, nt = null, kt = null, tt = null, y = null, o = null, a = null, h = null, it = 1, et = 10, lt = 0, at = 0, v = 0, rt = "0_0", ot = 0, w = !0, st = !1, vt = !1, s = [], p = t("#divTabMenuDataLoder"), ut = t("#hAlrtTxtTypeCount"), b = t("#divfActivity"), ft = t("#workflowActivity"), pt, dt; this.Load = function (r) { h && h.prop("checked") == !1 && ft.hide(); i.children().last().remove(); p.show(); it = 1; et = 10; lt = 0; at = 0; ii(r); s = []; r ? (i.find(".wfactivity-homepage-activites").remove(), i.append(o)) : i.append(ct).append(d).append(o); ri(r); v = a.val(); v && v != "0_0" ? (ot = v.split("_")[1], v = v.split("_")[0], y.is(":visible") ? i.find(".wfactivity-homepage-activites").css("top", "118px") : i.find(".wfactivity-homepage-activites").css("top", "68px")) : (ot = 0, v = 0, y.is(":visible") ? i.find(".wfactivity-homepage-activites").css("top", "98px") : i.find(".wfactivity-homepage-activites").css("top", "47px")); t.ajax({ url: n.Application.contextUrl + "WFActivity/GetActivities", data: { pageNo: 1, pageSize: 10, refresh: !0, searchText: nt.val(), VAF_Screen_ID: v, dateFrom: tt.val(), dateTo: y.val(), AD_Node_ID: ot }, dataType: "json", type: "POST", error: function () { p.hide(); n.HomeMgr.BindMenuClick(); return }, success: function (t) { nt.val(""); window.setTimeout(function () { n.HomeMgr.BindMenuClick(); var u = n.HomeMgr.getActiveTab(); if (u.activeTabType == 3) { if (t.result == null || t.result.LstInfo == null) { p.hide(); b.empty(); b.append(0); b.show(); ut.empty(); ut.append(0); str = "<p  id='pnorecFound' style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>"; i.find("#pnorecFound").remove(); o.empty(); i.append(str); return } c = t.result.LstInfo; o.empty(); r == !0 && (g = [], l = []); b.empty(); b.append(t.result.count); b.show(); ut.empty(); ut.append(t.result.count); pt(0); n.HomeMgr.adjustDivSize() } else return }, 100) } }) }; this.AppendRecord = function (r, u, f) { f || (f = !1); p.show(); v = a.val(); ot = v.split("_")[1]; v = v.split("_")[0]; t.ajax({ url: n.Application.contextUrl + "WFActivity/GetActivities", data: { pageNo: r, pageSize: u, refresh: f, searchText: nt.val(), VAF_Screen_ID: v, dateFrom: tt.val(), dateTo: y.val(), AD_Node_ID: ot }, dataType: "json", type: "POST", error: function () { p.hide(); n.HomeMgr.BindMenuClick(); w = !0; return }, success: function (t) { var u, e; if (nt.val(""), n.HomeMgr.BindMenuClick(), u = n.HomeMgr.getActiveTab(), u.activeTabType == 3) c = t.result ? t.result.LstInfo : null, f == !0 && (g = [], l = [], b.empty(), o.empty(), t.result ? (i.find("#pnorecFound").remove(), b.append(t.result.count)) : (ut.empty(), ut.append(0), e = "<p id='pnorecFound' style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>", i.find("#pnorecFound").remove(), i.append(e), b.append(0))), pt(r - 1), n.HomeMgr.adjustDivSize(); else { w = !0; return } } }) }; pt = function (i) { var u = null, r, f, b, e, ft, tt; if (c == null || c.length == 0) { p.hide(); d.hide(); h.prop("checked", !1); w = !0; return } a.val() != "0_0" ? (y.is(":visible") ? o.css("top", "118px") : o.css("top", "67px"), d.show()) : (y.is(":visible") ? o.css("top", "98px") : o.css("top", "47px"), d.hide(), h.prop("checked", !1)); for (r in c) { l.push(c[r]); f = {}; u = t("<div class='vis-activityContainer' data-id='" + (Number(10 * i) + Number(r)) + "'>"); u.on("click", function (n) { var u, i, r, f; if (t(".vis-activityContainer").removeClass("vis-activeFeed"), t(this).addClass("vis-activeFeed"), u = t(n.target).data("viswfazoom"), u == "wfZoom") { t(this).addClass("vis-activeFeed"); i = t(n.target).data("index"); ti(i); w = !0; return } (i = t(this).data("id"), r = !0, s.length <= 1 && h.prop("checked") == !0 && (r = !1), f = t(this).find(".wfActivity-selectchk").data("ids"), s.length != 1 || f == s[0]) && (oi(g[i].wfActivityID, i, this, r), w = !0) }); var v = t("<div class='vis-feedTitleBar'>"), k = t('<input class="wfActivity-selectchk" type="checkbox" style="float:left;margin-right:5px" data-ids="' + c[r].VAF_Screen_ID + "_" + c[r].AD_Node_ID + "_" + c[r].VAF_WFlow_Task_ID + '" ><\/input>'), nt = t("<h3>"); nt.css("font-weight", "normal"); nt.append(n.Utility.encodeText(c[r].NodeName)); a && a.val() != "0_0" && v.append(k); v.append(nt); var it = t("<div class='vis-feedTitleBar-buttons'>"), rt = t("<ul>"), ut = t("<li>"), et = t("<a href='javascript:void(0)'  data-index='" + (Number(10 * i) + Number(r)) + "' data-viswfazoom='wfZoom' >").append('<i class="vis vis-find"><\/i>'); ut.append(et); rt.append(ut); it.append(rt); v.append(it); u.append(v); b = t("<div class='vis-feedDetails'>"); e = t("<pre>"); c[r].DocumentNameValue == undefined || c[r].DocumentNameValue == "" ? e.append(n.Utility.encodeText(c[r].Summary)) : e.append(n.Utility.encodeText(c[r].DocumentNameValue + " - " + c[r].Summary)); ft = t("<br>"); e.append(ft); e.append(n.Utility.encodeText(n.Msg.getMsg("Priority") + " " + c[r].Priority)); b.append(e); k.on("click", function (n) { var i = t(n.target); dt(i, n) }); tt = t("<div class='vis-feedDateTime'>"); tt.append(t("<br>")).append(Globalize.format(new Date(c[r].Created), "d")); b.append(tt); u.append(b); o.append(u); f.ctrl = u; f.index = r; f.recordID = c[r].Record_ID; f.wfActivityID = c[r].VAF_WFlow_Task_ID; g.push(f); h.prop("checked") == !0 && (k.trigger("click"), l.length == 1) } w = !0; p.hide() }; dt = function (n, i) { var f = n.data("ids"), e, c, u, r; if (n.prop("checked") == !1 && (h.prop("checked", !1), st = !1), n.prop("checked") == !0) if (s.length == 0) s.push(n.data("ids")), st = !1, wt(); else if (e = s[0].split("_"), c = f.split("_"), e[0] + "-" + e[1] == c[0] + "-" + c[1]) s.push(f), h.prop("checked") != !0 || st || i.stopPropagation(), st = !1, wt(); else return wt(), i.preventDefault(), !1; else { if (s = jQuery.grep(s, function (n) { return n != f }), s.length == 1 && !vt) for (u = o.find(".wfActivity-selectchk"), r = 0; r < u.length; r++)if (t(u[r]).prop("checked") == !0) { t(u[r]).parent().trigger("click"); i.stopPropagation(); return } if (s.length >= 0 || h.prop("checked") == !0) return i.stopPropagation(), !1 } n.prop("checked") == !0 }; var gt = function () { var i = t(window).width(), r = t(".row.scrollerHorizontal > div").length, u, n, f; r = r - 1; t(".scrollerHorizontal").width(i); u = i / r - 20; n = parseInt(u); i >= 1366 && (ft.css("display") == "none" ? (t("#fllupsScreen").css("left", n + 20), t("#favLinks").css("left", n * 2 + 40), t("#welcomeScreen,#fllupsScreen,#favLinks").width(n)) : ft.css("display") == "block" && (f = i + n + 20, t(".scrollerHorizontal").width(f), t("#workflowActivity").css("left", n + 20), t("#fllupsScreen").css("left", n * 2 + 40), t("#favLinks").css("left", n * 3 + 60), t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(n))) }, k = [], oi = function (i, u, f, e) { p.show(); t.ajax({ url: n.Application.contextUrl + "WFActivity/GetActivityInfo", dataType: "json", type: "POST", async: e, data: { activityID: i, nodeID: l[u].AD_Node_ID, wfProcessID: l[u].VAF_WFlow_Handler_ID }, error: function () { p.hide(); return }, success: function (e) { if (s.length <= 1 || h.prop("checked") == !0) { ft.show(); n.HomeMgr.adjustDivSize(); var c = "transfer", o = {}; o = { to: r, className: "wsp-ui-effects-transfer" }; window.setTimeout(function () { ni(i, u, e.result); t(f).effect(c, o, 500, function () { }) }, 400) } else s.length <= 2 && ni(i, u, e.result), p.hide() } }) }, ni = function (i, u, f) { var e = {}, g, rt, pt, oi, wt, li, lt, ft, et, bt, ot, st, h, kt, dt, ni, ii, at, c, d, v, ai, ut, a, ri, ht, ct, ui, fi, nt, ei, y, vt, w, tt, b, it; if (k = [], e.Index = u, r.empty(), rt = t("<div class='vis-workflowActivityDetails-Heading'>"), r.append(rt), pt = t("<h3>"), pt.append(n.Msg.getMsg("Detail")), rt.append(pt), s.length <= 1) if (f.ColName == "VADMS_SignStatus") { g = l[u].DocumentNameValue.split("_"); oi = { DocumentNo: parseInt(g[g.length - 1]) }; wt = ""; t.post(n.Application.contextUrl + "VADMS/Document/GetFolderID", oi, function (t) { !t || t.result == "" || t.result.contains("ERR-") || t.result.contains("F") ? n.ADialog.error(n.Msg.getMsg("VA055_FolderNotFound")) : wt = parseInt(t.result) }, "json").fail(function (t, i) { n.ADialog.error(i) }); li = { FromName: "VADMS_Document" }; lt = ""; t.post(n.Application.contextUrl + "VADMS/Document/GetFormID", li, function (t) { t && t.result != "" ? lt = t.result : n.ADialog.error(n.Msg.getMsg("VA055_FormNotFound")) }, "json").fail(function (t, i) { n.ADialog.error(i) }); ft = t("<a href='javascript:void(0)' class='vis-btn-zoom' style='margin-left:10px;' data-id='" + g[g.length - 1] + "'>"); ft.append(t("<span class='vis-btn-ico vis-btn-zoom-bg vis-btn-zoom-border'>")); ft.append(n.Msg.getMsg("Zoom")); rt.append(ft); ft.on(n.Events.onTouchStartOrClick, function () { var i = t(this).data("id"), r = { DocNo: i, DocFolderID: wt }; lt > 0 && n.viewManager.startForm(lt, r) }) } else { et = t("<a href='javascript:void(0)' class='vis-btn-zoom' data-id='" + u + "'>"); et.append(t("<span class='vis-btn-ico vis vis-find vis-btn-zoom-border'>")); et.append(n.Msg.getMsg("Zoom")); rt.append(et); et.on(n.Events.onTouchStartOrClick, function () { var n = t(this).data("id"); ti(n) }) } if (rt.append(t("<div class='clearfix'>")), bt = t("<ul class='vis-IIColumnContent'>"), r.append(bt), ot = t("<li>"), ot.css("width", "100%"), st = t("<p>"), st.append(n.Msg.getMsg("Node")), st.append(t("<br>")), st.append(n.Utility.encodeText(l[u].NodeName)), ot.append(st), bt.append(ot), s.length <= 1 && (h = t("<pre>"), h.css("margin-top", "10px"), h.css("margin-bottom", "0px"), h.css("font-size", "14px"), h.css("font-family", "NoirPro-Regular"), h.append(n.Msg.getMsg("Summary")), h.append(t("<br>")), h.append(n.Utility.encodeText(l[u].Summary)), ot.append(h)), r.append(t("<div class='clearfix'>")), kt = t("<h4>"), kt.append(n.Msg.getMsg("Description")), r.append(kt), dt = t("<p>"), dt.append(n.Utility.encodeText(l[u].Description)), r.append(dt), r.append(t("<div class='clearfix'>")), ni = t("<h4>"), ni.append(n.Msg.getMsg("Help")), r.append(ni), ii = t("<p>"), ii.append(n.Utility.encodeText(l[u].Help)), r.append(ii), r.append(t("<h3>").append(n.Msg.getMsg("Action"))), r.append(t("<div class='clearfix'>")), at = t("<ul class='vis-IIColumnContent'>"), c = t("<li>"), at.append(c), c.append(t("<p style='margin-bottom: 0'>").append(n.Msg.getMsg("Answer"))), f.NodeAction == "C") d = hi(f, i), e.AnswerCtrl = d, d != null && (d.getBtnCount() > 0 ? (a = t("<div class='vis-wforwardwrap'>"), a.append(d.getControl()), a.append(d.getBtn(0)), c.append(a)) : c.append(d.getControl()), e.AnswerCtrl = d), e.Action = "C"; else if (f.NodeAction == "W") { v = t('<button style="margin-bottom:10px;margin-top: 0px;width: 100%;" class="VIS_Pref_pass-btn" data-id="' + u + '" data-window="' + f.VAF_Screen_ID + '" data-col="' + f.KeyCol + '">').append(f.NodeName); e.AnswerCtrl = v; c.append(v); v.on("click", function () { ci(t(this).data("id"), t(this).data("window"), t(this).data("col")) }); e.Action = "W" } else if (f.NodeAction == "X") { v = t('<button style="margin-bottom:10px;margin-top: 0px;width: 100%;" class="VIS_Pref_pass-btn" data-id="' + u + '" data-form="' + f.VAF_Page_ID + '" data-col="' + f.KeyCol + '">').append(f.NodeName); e.AnswerCtrl = v; c.append(v); v.on("click", function () { n.viewManager.startForm(t(this).data("form")) }); e.Action = "X" } c.append(t("<p style='margin-bottom: 0'>").append(n.Msg.getMsg("Forward"))); ai = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.Search, "VAF_UserContact_ID", 0, !1, null); ut = new n.Controls.VTextBoxButton("VAF_UserContact_ID", !1, !1, !0, n.DisplayType.Search, ai); e.FwdCtrl = ut; ut.getBtn(); ut.getBtnCount() == 2 && (a = t("<div class='vis-wforwardwrap'>"), a.append(ut.getControl()), a.append(ut.getBtn(0)), c.append(a)); ri = t("<li>"); ht = t("<a href='javascript:void(0)' class='vis-btn vis-btn-done vis-icon-doneButton vis-workflowActivityIcons' data-id='" + u + "'>"); ht.append(t("<span class='vis-btn-ico vis-btn-done-bg vis-btn-done-border'>")); ht.append(n.Msg.getMsg("Done")); ri.append(ht); ht.on(n.Events.onTouchStartOrClick, function () { var i, r; if (window.VA055 && window.VADMS && f.ColName == "VADMS_SignStatus") { if (i = { documentNo: g[g.length - 1], defaultReasonKey: t('[name="VADMS_SignStatus"]').children("option:selected").val(), defaultReason: t('[name="VADMS_SignStatus"]').children("option:selected").text() }, i.defaultReasonKey == undefined || i.defaultReasonKey == "" || i.defaultReason == undefined || i.defaultReason == "") { n.ADialog.info("VA055_ChooseStatus"); return } t.post(n.Application.contextUrl + "VADMS/Document/SignatureUsingWorkflow", i, function (i) { i && i != "null" && i.result == "success" ? (t("#divfeedbsy")[0].style.visibility = "hidden", o.empty(), gt(), k = [], s = [], p.show(), window.setTimeout(function () { yt(!0) }, 5e3)) : n.ADialog.error(i.result) }, "json").fail(function (t, i) { n.ADialog.error(i) }) } else r = t(this).data("id"), si(r) }); if (at.append(ri), r.append(at), r.append(t("<div class='clearfix'>")), r.append(t("<p style='margin-bottom: 0'>").append(n.Msg.getMsg("Message"))), r.append(t("<div class='clearfix'>")), ct = t("<div class='vis-sendMessage'>"), ui = t("<input type='text' placeholder='" + n.Msg.getMsg("TypeMessage") + "....'>"), e.MsgCtrl = ui, ct.append(ui), ct.append(t("<button class='vis vis-sms'><\/button>")), ct.append(t("<div class='clearfix'>")), r.append(ct), k.push(e), s.length <= 1 && (r.append(t("<h3>").append(n.Msg.getMsg("History"))), r.append(t("<div class='clearfix'>")), fi = t("<div class='vis-history-wrap'>"), r.append(fi), f.Node != null)) { nt = t("<div style='margin-top:15px;margin-bottom:15px'>"); for (node in f.Node) if (f.Node[node].History != null) { for (hNode in f.Node[node].History) f.Node[node].History[hNode].State == "CC" && node < f.Node.length - 1 ? (nt.append(t("<div class='vis-vertical-img'>").append(t("<img src='" + n.Application.contextUrl + "Areas/VIS/Images/home/4.jpg'>"))), y = t("<div class='vis-approved_wrap'>"), ei = "", ei = f.Node[node].Name, w = t("<div class='vis-left-part'>"), f.Node[node].History[hNode].TextMsg.length > 0 && (tt = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip' style='margin-right:5px'>").append(t("<img class='VIS_Pref_img-i'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/i.png")), b = t("<span>"), b.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), b.append(t("<label class='VIS_Pref_Label_Font'>").append(n.Utility.encodeText(f.Node[node].History[hNode].TextMsg))), tt.append(b), w.append(tt)), w.append(ei), y.append(w), it = t("<div class='vis-right-part'>"), it.append(n.Msg.getMsg("CompletedBy")).append(t("<span class='vis-app_by'>").append(f.Node[node].History[hNode].ApprovedBy)), y.append(it), nt.append(y)) : node < f.Node.length - 1 || f.Node.length == 1 ? (y = t("<div class='vis-pending_wrap' style='margin-top:-2px'>"), y.append(t("<div class='vis-left-part'>").append(f.Node[node].Name)), y.append(t("<div class='vis-right-part'>").append(n.Msg.getMsg("Pending"))), nt.append(y)) : (nt.append(t("<div class='vis-vertical-img'>").append(t("<img src='" + n.Application.contextUrl + "Areas/VIS/Images/home/4.jpg'>"))), vt = t("<div class='vis-start_wrap' style='margin-bottom:-8px'>"), w = t("<div class='vis-left-part'>"), f.Node[node].History[hNode].TextMsg.length > 0 && (tt = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip' style='margin-right:5px'>").append(t("<img class='VIS_Pref_img-i'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/i.png")), b = t("<span >"), b.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), b.append(t("<label class='VIS_Pref_Label_Font'>").append(n.Utility.encodeText(f.Node[node].History[hNode].TextMsg))), tt.append(b), w.append(tt)), w.append(f.Node[node].Name), vt.append(w), it = t("<div class='vis-right-part'>"), it.append(n.Msg.getMsg("CompletedBy")).append(t("<span class='vis-app_by'>").append(f.Node[node].History[hNode].ApprovedBy)), vt.append(it), nt.append(vt)); fi.append(nt) } } p.hide() }, ti = function (t) { n.AEnv.wfzoom(l[t].VAF_TableView_ID, l[t].Record_ID, l[t].VAF_WFlow_Task_ID) }, si = function (i) { t("#divfeedbsy")[0].style.visibility = "visible"; window.setTimeout(function () { var r, e, u, f; for (r in k) try { if (i === k[r].Index) { var h = k[r].FwdCtrl.getValue(), c = n.Utility.encodeText(k[r].MsgCtrl.val()), e = null; if (k[r].Action == "C" && (e = k[r].AnswerCtrl.getValue()), u = "", s && s.length > 0) for (f = 0; f < s.length; f++)u.length > 0 && (u += ","), u += s[f].split("_")[2]; else u = l[i].VAF_WFlow_Task_ID; v = l[i].VAF_Screen_ID; n.dataContext.getJSONData(n.Application.contextUrl + "WFActivity/ApproveIt", { activityID: u, nodeID: l[i].AD_Node_ID, txtMsg: c, fwd: h, answer: e, VAF_Screen_ID: v }, function (i) { i.result == "" ? (t("#divfeedbsy")[0].style.visibility = "hidden", o.empty(), gt(), k = [], s = [], p.show(), yt(!0)) : (alert(n.Msg.getMsg(i.result)), t("#divfeedbsy")[0].style.visibility = "hidden") }); break } } catch (y) { alert("FillManadatory"); t("#divfeedbsy")[0].style.visibility = "hidden" } }, 2) }, hi = function (i, r) { var f, e, u; return i.ColID == 0 ? null : i.ColReference == n.DisplayType.YesNo ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.List, i.ColName, 319, !1, null), new n.Controls.VComboBox(i.ColName, !1, !1, !0, u, 50)) : i.ColReference == n.DisplayType.List ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.List, i.ColName, i.ColReferenceValue, !1, null), new n.Controls.VComboBox(i.ColName, !1, !1, !0, u, 50)) : i.ColName.toUpperCase() == "VAB_GENFEATURESETINSTANCE_ID" ? (f = null, e = new n.MGAttributeLookup(n.context, 0), t.ajax({ url: n.Application.contextUrl + "WFActivity/GetRelativeData", async: !1, data: { activityID: r }, dataType: "json", success: function (t) { t.result && (f = new n.Controls.VPAttribute("VAB_GenFeatureSetInstance", !0, !1, !0, n.DisplayType.PAttribute, e, 0, !0, !1, !1, !1), f.SetVAB_GenFeatureSet_ID(t.result.GenAttributeSetID)) } }), f) : i.ColReference == n.DisplayType.TableDir ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.TableDir, i.ColName, i.ColReferenceValue, !1, null), new n.Controls.VComboBox(i.ColName, !1, !1, !0, u, 50)) : i.ColReference == n.DisplayType.Search ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.Search, i.ColName, i.ColReferenceValue, !1, null), new n.Controls.VTextBoxButton(i.ColName, !1, !1, !0, n.DisplayType.Search, u)) : new n.Controls.VTextBox(i.ColName, !1, !1, !0, 50, 100, null, null, !1) }, ci = function (t, i, r) { var u = new n.Query; u.addRestriction(r, n.Query.prototype.EQUAL, l[t].Record_ID); n.viewManager.startWindow(i, u) }; this.clear = function () { for (var n in g) g[n] = null } } n.wfActivity = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { function rt() { st(); ht(); ut(); ft(u) } function ut() { var f, c, i, l, t; f = n.Env.isBaseLanguage(v, "VAF_CtrlRef_List") ? "SELECT Value, Name, Description FROM VAF_CtrlRef_List WHERE VAF_Control_Ref_ID=135 ORDER BY Name" : "SELECT l.Value, t.Name, t.Description FROM VAF_CtrlRef_List l, VAF_CtrlRef_TL t WHERE l.VAF_CtrlRef_List_ID=t.VAF_CtrlRef_List_ID AND t.VAF_Language='" + n.Env.getVAF_Language(v) + "' AND l.VAF_Control_Ref_ID=135 ORDER BY t.Name"; var u = [], e = [], o = []; try { if (c = n.secureEngine.encrypt(f), i = n.dataContext.getJSONData(n.Application.contextUrl + "DocAction/GetReference", { RefQry: c }, null), i != null) for (t in i) { var y = i[t].Value, p = i[t].Name, r = i[t].Description; (r == null || r == "undefined") && (r = ""); u.push(y); e.push(p); o.push(r) } } catch (w) { console.log(w) } for (l = u.length, s = [], h = [], a = [], t = 0; t < l; t++)s.push(u[t]), h.push(e[t]), a.push(o[t]) } function ft(u) { var e, f, o, c; y = r.getValue("DocStatus"); e = r.getValue("DocAction"); f = r.getValue("Processing"); f = f == "N" ? !1 : !0; o = v.getWindowContext(i, "OrderType"); c = v.isSOTrx(i); t.ajax({ url: n.Application.contextUrl + "DocAction/GetDocActions", type: "POST", dataType: "Json", data: { VAF_TableView_ID: d, Record_ID: u, docStatus: y, processing: f, orderType: o, isSOTrx: c, docAction: e, tableName: r.getTableName(), values: JSON.stringify(s), names: JSON.stringify(h), VAB_DocTypes_ID: r.getValue("VAB_DocTypes_ID"), VAB_DocTypesTarget_ID: r.getValue("VAB_DocTypesTarget_ID") }, success: function (n) { var t = JSON.parse(n); et(t); ot(t) } }) } function et(t) { if (k(!1), y = t.DocStatus, t.Error != null && t.Error != "" && t.Error != "undefined") { n.ADialog.error(t.Error); return } if (t.DocStatus == null) { p.text("*** ERROR ***"); return } } function ot(t) { for (var u, i, r = 0; r < t.Index; r++)for (u = !1, i = 0; i < s.length && !u; i++)t.Options[r].equals(s[i]) && (o.append("<option >" + h[i] + "<\/option>"), u = !0); if (t.DefaultV != null && t.DefaultV != "" && t.DefaultV != "undefined" && o.val(t.DefaultV).change(), c.prop("disable", !1), e.getNumberOfOptions() == 0) { n.ADialog.info("InfoDocActionNoOptions", ""); e.log.info("DocAction - No Options"); f.close(); return } } function st() { var u = t("<tr>"), e = t("<tr>"), s = t("<tr>"), h = t("<td>"), v = t("<td>"), a = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), r; h.append(a); a.append(i); i.append(o); i.append("<label >" + n.Msg.getMsg("DocAction") + "<\/label>"); u.append(h); r = t("<td>"); r.append(p); e.append(r); $td31 = t("<td>"); $td32 = t('<td style="text-align:right">'); s.append($td31).append($td32); l.append(u).append(e).append(s); c.append(l); k(!0); c.append(w).append(b); f = new n.ChildDialog } function ht() { o.on("change", function () { var n = g(); n != -1 && a.length > 0 && p.text(a[n]) }); f.onOkClick = function () { ct() && (e.isOKPressed = !0, e.onClose && e.onClose()) }; f.onCancelClick = function () { e.onClose && e.onClose() } } function k(n) { n ? (w.show(), b.show(), c.find("button").prop("disabled", !0)) : (w.hide(), b.hide(), c.find("button").prop("disabled", !1)) } function g() { var t = -1, i, n; if (o.val() == null) return t; for (i = o.val(), n = 0; n < h.length && t == -1; n++)if (i.equals(h[n])) { t = n; break } return t } function ct() { k(!0); var n = g(); return n == -1 ? (k(!1), !1) : (r.setValue("DocAction", s[n]), !0) } var v = n.Env.getCtx(), d = r.getVAF_TableView_ID(), s = [], h = [], a = [], y = null, nt = 0, tt = "", l, f, w, b; this.log = n.Logging.VLogger.getVLogger("VDocAction"); var it, o = t('<select class="vis-select-docAction"><\/select>'), p = t('<p style="font-size:12px;margin-bottom:-5px"><\/p>'), c = t('<div style="margin-bottom:-5px"><\/div>'), e = this; this.batch = !1; this.isOKPressed = !1; l = t('<table style="width:360px;margin-bottom:9px">'); f = null; this.onClose = null; w = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); b = t("<label>" + n.Msg.getMsg("Loading") + "<\/label>"); n.Application.isRTL; rt(); this.getNumberOfOptions = function () { return o.children("option").length }; this.isStartProcess = function () { return this.isOKPressed }; this.isBatch = function () { return this.batch }; this.show = function () { f.setContent(c); f.setTitle(n.Msg.getMsg("DocAction")); f.setModal(!0); f.show() }; f.onClose = function () { e.dispose() }; this.dispose = function () { f.close(); f = null; d = null; s = null; h = null; a = null; y = null; nt = 0; tt = null; it = null; o = null; p = null; c = null; e = null; l && l.empty(); l = null } } function r() { this.ACTION_COMPLETE = "CO"; this.ACTION_WAITCOMPLETE = "WC"; this.ACTION_APPROVE = "AP"; this.ACTION_REJECT = "RJ"; this.ACTION_POST = "PO"; this.ACTION_VOID = "VO"; this.ACTION_CLOSE = "CL"; this.ACTION_REVERSE_CORRECT = "RC"; this.ACTION_REVERSE_ACCRUAL = "RA"; this.ACTION_REACTIVATE = "RE"; this.ACTION_NONE = "--"; this.ACTION_PREPARE = "PR"; this.ACTION_UNLOCK = "XL"; this.ACTION_INVALIDATE = "IN"; this.ACTION_REOPEN = "OP"; this.STATUS_DRAFTED = "DR"; this.STATUS_COMPLETED = "CO"; this.STATUS_APPROVED = "AP"; this.STATUS_INVALID = "IN"; this.STATUS_NOTAPPROVED = "NA"; this.STATUS_VOIDED = "VO"; this.STATUS_REVERSED = "RE"; this.STATUS_CLOSED = "CL"; this.STATUS_UNKNOWN = "??"; this.STATUS_INPROGRESS = "IP"; this.STATUS_WAITINGPAYMENT = "WP"; this.STATUS_WAITINGCONFIRMATION = "WC" } n.VDocAction = i; n.DocumentEngine = r }(VIS, jQuery), function (n, t) { function i() { function n(n, i, r, u, f, e) { if (window.WSP) { var o = t("<div id='divAptBusy' class='wsp-busy-indicater'><\/div>"); t("body").append(o); f == !1 ? (o.show(), WSP.AppointmentsForm.init(n, i, r, u, o, e)) : (o.show(), WSP.TaskForm.init(n, i, r, u, o, e)) } else alert("please download WSP !!!") } return { init: n } } n.AppointmentsForm = i() }(VIS, jQuery), function (n, t) { function i(i, r, u) { function uu() { var ii = t('<div class="input-group vis-input-wrap"><\/div>'), e = t('<div class="vis-control-wrap"><\/div>'), ri = null, u, a, v, y, b, ft, vt, yt, dt, gt; ri = t('<label class="vis-payment-spanPayment"> ' + n.Msg.translate(f, "PaymentMethod") + " <\/label>"); ii.append(e); p = t('<select class="vis-payment-cmbPayment"><\/select>'); p.appendTo(e); ri.appendTo(e); ii.appendTo(k); lt = t('<table class="vis-payment-table"><\/table>'); u = t("<tr><\/tr>"); lt.append(u); gi = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "CreditCardType") + "<\/label>"); nr = t('<label class="vis-payment-span">' + n.Msg.translate(f, "CreditCardNumber") + "<\/label>"); tr = t('<label class="vis-payment-span">' + n.Msg.translate(f, "Expires") + "<\/label>"); rr = t('<label class="vis-payment-span">' + n.Msg.translate(f, "VoiceAuthCode") + "<\/label>"); pt = t('<label class="vis-payment-span">' + n.Msg.translate(f, "Online") + "<\/label>"); pi = t('<label class="vis-payment-span"><\/label>'); s = t('<table class="vis-payment-table"><\/table>'); a = t("<tr><\/tr>"); s.append(a); ut = t('<table class="vis-payment-table"><\/table>'); a.append(ut); u.append(s); g = t('<select  class="vis-payment-cmb"><\/select>'); var hi = t("<tr><\/tr>"), ci = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(g); i.append(gi); hi.append(ci); ci.append(r); r.append(i); ut.append(hi); d = t('<input class="vis-payment-inputs" type="text" placeholder=" " data-placeholder="" >'); var li = t("<tr><\/tr>"), ai = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(d); i.append(nr); li.append(ai); ai.append(r); r.append(i); ut.append(li); wt = t('<input class="vis-payment-inputs"  type="text" placeholder=" " data-placeholder="" >'); var vi = t("<tr><\/tr>"), yi = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(wt); i.append(tr); vi.append(yi); yi.append(r); r.append(i); ut.append(vi); bt = t('<input class="vis-payment-inputs"  type="text" placeholder=" " data-placeholder="" >'); var lr = t("<tr><\/tr>"), ar = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(bt); i.append(rr); lr.append(ar); ar.append(r); r.append(i); ut.append(lr); pt = t('<button class="vis-payment-inputs-buttons"  type="button">' + n.Msg.translate(f, "Online") + "<\/button>"); v = t("<tr><\/tr>"); y = t("<td><\/td>"); y.append(pt); v.append(y); ut.append(v); ir = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "VAB_BPart_Bank_Acct_ID") + "<\/label>"); wi = t('<p class="vis-payment-span"> <\/p>'); h = t('<table class="vis-payment-table"><\/table>'); b = t("<tr><\/tr>"); si = t('<table class="vis-payment-table"><\/table>'); h.append(b); b.append(si); u.append(h); et = t('<select class="vis-payment-cmb"><\/select>'); var vr = t("<tr><\/tr>"), yr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(et); i.append(ir); vr.append(yr); yr.append(r); r.append(i); si.append(vr); hr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "VAB_Bank_Acct_ID") + "<\/label>"); di = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "Amount") + "<\/label>"); ti = t('<label class="vis-payment-span vis-payment-AmountField"> <\/label>'); fr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "RoutingNo") + "<\/label>"); ur = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "AccountNo") + "<\/label>"); sr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "CheckNo") + "<\/label>"); ui = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "VAB_Currency_ID") + "<\/label>"); bi = t('<p class="vis-payment-span"> <\/p>'); ei = t('<button class="vis-payment-inputs-buttons"  type="button">' + n.Msg.translate(f, "Online") + "<\/button>"); c = t('<table class="vis-payment-table"><\/table>'); ft = t("<tr><\/tr>"); w = t('<table class="vis-payment-table"><\/table>'); ft.append(w); c.append(ft); u.append(c); nt = t('<select class="vis-payment-cmb"><\/select>'); var pr = t("<tr><\/tr>"), wr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(nt); i.append(hr); pr.append(wr); wr.append(r); r.append(i); w.append(pr); ti = t('<input type="text" readonly class="vis-payment-span vis-payment-AmountField">'); var br = t("<tr><\/tr>"), kr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ti); i.append(di); br.append(kr); kr.append(r); r.append(i); w.append(br); it = t('<input class="vis-payment-inputs" type="text" placeholder=" " data-placeholder="" >'); var dr = t("<tr><\/tr>"), gr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(it); i.append(fr); dr.append(gr); gr.append(r); r.append(i); w.append(dr); tt = t('<input class="vis-payment-inputs" type="text" placeholder=" " data-placeholder="" >'); var nu = t("<tr><\/tr>"), tu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(tt); i.append(ur); nu.append(tu); tu.append(r); r.append(i); w.append(nu); rt = t('<input class="vis-payment-inputs"  type="text" placeholder=" " data-placeholder="" >'); var iu = t("<tr><\/tr>"), ru = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(rt); i.append(sr); iu.append(ru); ru.append(r); r.append(i); w.append(iu); ot = t('<select class="vis-payment-cmb"><\/select>'); var uu = t("<tr><\/tr>"), fu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ot); i.append(ui); uu.append(fu); fu.append(r); r.append(i); w.append(uu); ei = t('<button class="vis-payment-inputs-buttons"  type="button">' + n.Msg.translate(f, "Online") + "<\/button>"); vt = t("<tr><\/tr>"); yt = t('<td colspan="2"><\/td>'); yt.append(ei); vt.append(yt); w.append(vt); er = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "VAB_PaymentTerm_ID") + "<\/label>"); l = t('<table  class="vis-payment-table"><\/table>'); dt = t("<tr><\/tr>"); oi = t('<table  class="vis-payment-table"><\/table>'); dt.append(oi); l.append(dt); u.append(l); ht = t('<select class="vis-payment-cmb"><\/select>'); var eu = t("<tr><\/tr>"), ou = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ht); i.append(er); eu.append(ou); ou.append(r); r.append(i); oi.append(eu); cr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "VAB_CashBook_ID") + "<\/label>"); fi = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "VAB_Currency_ID") + "<\/label>"); ki = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "Amount") + "<\/label>"); ni = t('<label class="vis-payment-span vis-payment-AmountField"> <\/label>'); or = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "DateAcct") + "<\/label>"); o = t('<table class="vis-payment-table"><\/table>'); gt = t("<tr><\/tr>"); at = t('<table class="vis-payment-table"><\/table>'); gt.append(at); o.append(gt); u.append(o); st = t('<select class="vis-payment-cmb"><\/select>'); var su = t("<tr><\/tr>"), hu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(st); i.append(fi); su.append(hu); hu.append(r); r.append(i); at.append(su); ct = t('<select class="vis-payment-cmb"><\/select>'); var cu = t("<tr><\/tr>"), lu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ct); i.append(cr); cu.append(lu); lu.append(r); r.append(i); at.append(cu); kt = t('<input class="vis-payment-inputs vis-payment-date" type="date" placeholder=" " data-placeholder="" >'); var au = t("<tr><\/tr>"), vu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(kt); i.append(or); au.append(vu); vu.append(r); r.append(i); at.append(au); ni = t('<input type="text" readonly class="vis-payment-span vis-payment-AmountField"> '); var yu = t("<tr><\/tr>"), pu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ni); i.append(ki); yu.append(pu); pu.append(r); r.append(i); at.append(yu); k.append(lt) } function fu(i) { var f = !1; return (y = r.getValue("DocStatus"), r.getValue("VAB_BusinessPartner_ID") == null) ? (n.ADialog.error("0", !0, n.Msg.getMsg("SaveErrorRowNotFound")), f = !1) : (y = r.getValue("DocStatus"), y == null && (y = ""), y.equals("RE") || y.equals("VO") || y.equals("CL")) ? f = !1 : (b = y.equals("CO") || y.equals("WP") ? !1 : !0, b || ii || r.getValue("VAM_Warehouse_ID") == null || (b = !0), b ? lt.hide() : lt.show(), _Amount = r.getValue("GrandTotal"), !b && _Amount == 0) ? (n.ADialog.error("", !0, n.Msg.getMsg("PaymentZero")), f = !1) : (vr = parseInt(r.getValue("VAF_Client_ID")), yr = parseInt(r.getValue("VAF_Org_ID")), pr = parseInt(r.getValue("VAB_BusinessPartner_ID")), a = r.getValue("PaymentRule"), ri = parseInt(r.getValue("VAB_Currency_ID")), yt = r.getValue("DateAcct"), (r.getValue("VAB_PaymentTerm_ID") != null || r.getValue("VAB_PaymentTerm_ID") != {}) && (ft = parseInt(r.getValue("VAB_PaymentTerm_ID"))), r.getValue("VAB_Payment_ID") != null && r.getValue("VAB_Payment_ID") != {} && (li = parseInt(r.getValue("VAB_Payment_ID"))), r.getValue("VAB_CashJRNLLine_ID") != null && r.getValue("VAB_CashJRNLLine_ID") != {} && (ai = parseInt(r.getValue("VAB_CashJRNLLine_ID"))), e = { _DocStatus: y, _isSOTrx: ii, _VAF_Client_ID: vr, _VAF_Org_ID: yr, _VAB_BusinessPartner_ID: pr, _PaymentRule: a, _VAB_Currency_ID: ri, _DateAcct: yt, _VAB_PaymentTerm_ID: ft, _VAB_Payment_ID: li, _VAB_CashJRNLLine_ID: ai, values: JSON.stringify(i), _Amount: _Amount }, t.ajax({ url: n.Application.contextUrl + "PaymentRule/LoadPaymentMethodDetails", type: "POST", async: !1, dataType: "Json", data: e, success: function (n) { var i, v, e, r; lr(!1); i = JSON.parse(n); ar = i.CCType; b ? lt.hide() : lt.show(); ni.val(_Amount); ti.val(_Amount); d.val(i.strKNumber); wt.val(i.strKExp); bt.val(i.strKApproval); pi.val(i.strKStatus); i.canChange && (g.attr("disable", !1), d.attr("disable", !1), wt.attr("disable", !1), bt.attr("disable", !1), pt.attr("disable", !1)); it.val(i.StrSRouting); tt.val(i.StrSNumber); rt.val(i.StrSCheck); bi.text(i.StrSStatus); wi.text(i.StrTStatus); yt != null && (kt.Value = yt); v = ri; i._Currencies != null && i._Currencies != undefined && i._Currencies[ri] ? (t.each(i._Currencies, function (n, i) { ot.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), t.each(i._Currencies, function (n, i) { st.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) })) : (fi.hide(), st.hide(), ui.hide(), ot.hide()); a == null && (a = ""); for (e in u.values) { if (r = e, dt.equals(r) && !ii) continue; else if (gt.equals(r) && ii) continue; p.append(t('<option value="' + r + '">' + u.values[e] + "<\/option>")); r.equals(a) && p.val(r) } return i.loadPaymentTerms != null && i.loadPaymentTerms != undefined && (t.each(i.loadPaymentTerms, function (n, i) { ht.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), ft != null && ft != undefined && ht.val(ft)), i.loadAccounts != null && i.loadAccounts != undefined && (t.each(i.loadAccounts, function (n, i) { et.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.kp != null && et.val(i.kp)), i.ccs != null && i.ccs != undefined && (t.each(i.ccs, function (n, i) { g.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.CCType != null && g.val(i.CCType)), i.loadBankAccounts != null && i.loadBankAccounts != undefined && (t.each(i.loadBankAccounts, function (n, i) { nt.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.kp != null && nt.val(i.kp)), i.Checkbook_ID != null && nt.val(i.Checkbook_ID), i.loadCashBooks != null && i.loadCashBooks != undefined && t.each(i.loadCashBooks, function (n, i) { ct.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.Checkbook_ID != null && (ct.val(i.Checkbook_ID), vi == 0 && (vi = i.Checkbook_ID)), a == "B" ? (s.hide(), l.hide(), o.show(), h.hide(), c.hide()) : a == "K" ? (s.show(), l.hide(), o.hide(), h.hide(), c.hide()) : a == "D" ? (s.hide(), l.hide(), o.hide(), h.show(), c.hide()) : a == "P" ? (s.hide(), l.show(), o.hide(), h.hide(), c.hide()) : a == "S" && (s.hide(), l.hide(), o.hide(), h.hide(), c.show()), f = !0 } }), f) } function eu(n) { if (n != undefined && !n) { v.close(); return } p.on("change", ou); ot.on("change", su); st.on("change", hu); pt.on("click", cu); v.onOkClick = function () { lr(!0); var n = lu(); n && (vt.isOKPressed = !0, vt.onClose && vt.onClose()) }; v.onCancelClick = function () { vt.onClose && vt.onClose() }; v.onClose = function () { vt.dispose() } } function ou() { var n = p.val(), t; n != null && (t = n.toLower(), (dt == t.toLower() || dt == t.toUpper()) && (t = gt.toLower()), t += "Panel", n.equals("K") ? (s.show(), l.hide(), o.hide(), h.hide(), c.hide()) : n.equals("B") ? (s.hide(), l.hide(), o.show(), h.hide(), c.hide()) : n.equals("D") ? (s.hide(), l.hide(), o.hide(), h.show(), c.hide()) : n.equals("P") ? (s.hide(), l.show(), o.hide(), h.hide(), c.hide()) : n.equals("S") ? (s.hide(), l.hide(), o.hide(), h.hide(), c.show()) : n.equals("T") && (s.hide(), l.hide(), o.hide(), h.hide(), c.hide())) } function su() { } function hu() { } function cu() { } function lu() { var o = !0, s = au(), u; return s ? (u = p.val(), u == null) ? void 0 : b && u ? (u.equals(a) || r.setValue("PaymentRule", u), o = !0) : (e.cmbPayment = p.val(), u.equals(wr) ? (e.cmbBCurrency = st.val(), e.cmbBCashBook = ct.val(), e.bDateField = kt.val()) : u.equals(br) ? (e.cmbKType = g.val(), e.txtKNumber = d.val(), e.txtKExp = wt.val(), e.txtKApproval = bt.val()) : u.equals(gt) ? e.cmbTAccount = et.val() : u.equals(kr) ? e.cmbPTerm = ht.val() : u.equals(yi) && (e.cmbSBankAccount = nt.val(), e.txtSRouting = it.val(), e.txtSNumber = tt.val(), e.txtSCheck = rt.val(), e.cmbSCurrency = ot.val()), e.VAB_Order_ID = f.getContextAsInt(i, "VAB_Order_ID"), e.VAB_Invoice_ID = f.getContextAsInt(i, "VAB_Invoice_ID"), t.ajax({ url: n.Application.contextUrl + "PaymentRule/SaveChanges", type: "POST", async: !1, dataType: "Json", data: e, success: function (n) { var t = JSON.parse(n); return t.ErrorMsg != null && t.ErrorMsg != "" && t.ErrorMsg != undefined && alert(t.ErrorMsg), t.SucessMsg != null && t.SucessMsg != "" && t.SucessMsg != undefined && alert(t.SucessMsg), t.newPaymentRule == null || t.newPaymentRule == undefined || t.newPaymentRule.equals(a) || r.setValue("PaymentRule", t.newPaymentRule), t.newDateAcct == null || t.newDateAcct == undefined || t.newDateAcct.equals(yt) || r.setValue("DateAcct", t.newDateAcct), t.newVAB_PaymentTerm_ID != ft && t.newVAB_PaymentTerm_ID > 0 && r.setValue("VAB_PaymentTerm_ID", t.newVAB_PaymentTerm_ID), t._VAB_Payment_ID != li && (t._VAB_Payment_ID == 0 ? r.setValue("VAB_Payment_ID", null) : r.setValue("VAB_Payment_ID", t._VAB_Payment_ID)), t._VAB_CashJRNLLine_ID != ai && (t._VAB_CashJRNLLine_ID == 0 ? r.setValue("VAB_CashJRNLLine_ID", null) : r.setValue("VAB_CashJRNLLine_ID", t._VAB_CashJRNLLine_ID)), o = !0 }, error: function () { return o = !1 } }), o) : o = !1 } function au() { var i = !0, u, t, s, r, f; try { if (u = p.val(), u == null || u == undefined) return !1; if (t = u, b) return !0; var h = yt, o = ft, c = vi, l = ar, e = 0; if (t.equals(wr)) c = ct.val(), h = kt.val(); else if (t.equals(br)) l = g.val(), (d.val() == null || d.val() == "" || d.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("CreditCardNumberError")), i = !1); else if (t.equals(gt) || t.equals(dt)) s = et.val(), s == null && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBPBankNotFound")), i = !1); else if (t.equals(kr)) o = ht.val(), r != null && (o = r); else if (t.equals(yi)) r = nt.val(), r != null && (e = r), (it.val() == null || it.val() == "" || it.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBankRoutingNotValid")), i = !1), (tt.val() == null || tt.val() == "" || tt.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBankAccountNotValid")), i = !1), (rt.val() == null || rt.val() == "" || rt.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBankCheckNotValid")), i = !1); else return !1; "KTSD".indexOf(t) != -1 && e == 0 && (f = gr, t.equals(gt) ? f = dr : t.equals(dt) ? f = nu : t.equals(yi) && (f = tu), e == 0 && "S".equals(t) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentNoProcessor")), i = !1)) } catch (a) { log.Severe(a.ToString()) } return i } function lr(n) { n ? (hi.show(), k.find("button").prop("disabled", !0)) : (hi.hide(), k.find("button").prop("disabled", !1)) } var vt = this, f = n.Env.getCtx(), ci = !1, ii = n.context.isSOTrx(i), y = null, a = "", ri = 0, yt = null, ft = 0, li = 0, ai = 0, vi = 0, ar = "", pi, wi, bi, ki, ni, di, ti, iu, gi, nr, tr, ir, rr, ur, fr, ui, fi, er, or, sr, hr, cr, p, g, et, ot, st, ht, nt, ct, pt, ei, d, wt, bt, tt, it, rt, kt, lt, at, oi, ru, ut, si, w, hi; this.log = n.Logging.VLogger.getVLogger("vPayment"); var vr = 0, yr = 0, pr = 0, e = {}, wr = "B", dt = "D", br = "K", kr = "P", yi = "S", gt = "T", dr = "A", gr = "C", nu = "D", tu = "K", b = !1, k, v = null, o, s, h, c, l; this.onClose = null; hi = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><label>' + n.Msg.getMsg("Loading") + "<\/label><\/div><\/div>"); this.init = function () { uu(); ci = fu(u.values); eu(ci) }; this.isInitOK = function () { return ci }; this.show = function () { v = new n.ChildDialog; k = t('<div class="vis-formouterwrpdiv"><\/div>'); k.append(hi); lr(!0); v.setContent(k); v.setWidth(360); v.setTitle(n.Msg.getMsg("Payment")); v.setModal(!0); v.show() }; this.onClose = null; this.dispose = function () { k != null && (k = null); v = null; o = null; s = null; h = null; c = null; l = null; this.onClose = null; pi = null; wi = null; bi = null; ki = null; ni = null; di = null; ti = null; iu = null; gi = null; nr = null; tr = null; ir = null; rr = null; ur = null; fr = null; ui = null; fi = null; er = null; or = null; sr = null; hr = null; cr = null; p = null; g = null; et = null; ot = null; st = null; ht = null; nt = null; ct = null; pt = null; ei = null; d = null; wt = null; bt = null; tt = null; it = null; rt = null; kt = null; at = null; oi = null; ru = null; ut = null; si = null; w = null } } n.VPayment = i }(VIS, jQuery), function (n, t) { n.TestForm = function () { function o() { i = t("<div>"); f = t("<input type='text'>"); r = t("<input type='button'>").val("Show"); u = t("<input type='button'>").val("Close"); i.append(f).append(r).append(u) } var i, f, r, u, e; this.frame; this.windowNo; o(); e = this; r.on(n.Events.onTouchStartOrClick, function () { alert("Test From has value :==> " + f.val()) }); u.on(n.Events.onTouchStartOrClick, function () { confirm("wanna close this form???") && e.dispose() }); this.getRoot = function () { return i }; this.disposeComponent = function () { e = null; i && i.remove(); i = null; r && r.off(n.Events.onTouchStartOrClick); u && u.off(n.Events.onTouchStartOrClick); f = r = u = null; this.getRoot = null; this.disposeComponent = null } }; n.TestForm.prototype.init = function (n, t) { this.frame = t; this.frame.getContentGrid().append(this.getRoot()) }; n.TestForm.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null } }(VIS, jQuery), function (n, t) { function i() { function c() { var t = '<div style="width: 400px;margin: 20px auto;vertical-align: middle;"><div style="width: 400px;float: left;"><div style="width: 100px;float: left;   margin-top: 8px;"><span>' + n.Msg.getMsg("VISPRO_SelectTable") + '<\/span><\/div><div style="width: 300px;float: left;"><select style="width: 100%;float: left;" class="VIS_Pref_pass" id="cmbAllTable_@windowNo"><\/select><\/div><\/div><div style="float: left;margin-left: 5px;margin-top: 7px; display: none;"><input id="chkAllTable_@windowNo" type="checkbox" /><span>' + n.Msg.getMsg("VISPRO_AllTable") + '<\/span><\/div><div style="width: 400px;float: left; display: none;"><div style="width: 100px;float: left;"><span>' + n.Msg.getMsg("VISPRO_Path") + '<\/span><\/div><div style="width: 300px;float: left;"><input style="width: 81%;float: left;" class="VIS_Pref_pass" type="text" id="txtpath_@windowNo" /><input type="file" multiple="" webkitdirectory="" style="height: -1px; width:30px "><\/div><\/div><div style="width: 400px;float: left; display: none;"><div style="width: 100px;float: left;"><span>' + n.Msg.getMsg("VISPRO_EntityType") + '<\/span><\/div><div style="width: 300px;float: left;"><input id="chkClassType_@windowNo" type="checkbox" /><span>' + n.Msg.getMsg("VISPRO_ClassType") + '<\/span><\/div><\/div><div class="VIS-locator-DivStyle" style="text-align: right"><input type="button" id="btnCancel_@windowNo" style="margin-bottom:0px;margin-top:0px; float:right " value="' + n.Msg.getMsg("Cancel") + '" class="VIS_Pref_btn-2" /><input type="button" id="btnOk_@windowNo" style="margin-bottom:0px;margin-top:0px; float:right; margin-right:10px" class="VIS_Pref_btn-2" value="' + n.Msg.getMsg("VIS_Genrate") + '" /><a href="javascript:void(0)" class="VIS_Pref_pass-btn" style="display: none; margin-bottom: 0px; margin-top: 0px;float: right; margin-right: 10px;" id="btnOkA_@windowNo" >' + n.Msg.getMsg("VIS_Download") + "<\/a><\/div><\/div>"; t = t.replaceAll("@windowNo", i.windowNo); r.html(t); r.append(s); u = r.find("#btnOk_" + i.windowNo); e = r.find("#btnCancel_" + i.windowNo); f = r.find("#btnOkA_" + i.windowNo); h = r.find("#cmbAllTable_" + i.windowNo); chkAllTable = r.find("#chkAllTable_" + i.windowNo); txtpath = r.find("#txtpath_" + i.windowNo); chkClassType = r.find("#chkClassType_" + i.windowNo) } function l() { y() } function a() { if (u != null) u.on(n.Events.onTouchStartOrClick, function () { o(!0); v(); o(!1) }); if (f != null) f.on(n.Events.onTouchStartOrClick, function () { f.css("display", "none"); u.css("display", "block") }); if (e != null) e.on(n.Events.onTouchStartOrClick, function () { i.dispose() }) } function v() { var e = i, r = h.find("option:selected").val(); t.ajax({ url: n.Application.contextUrl + "Form/GenerateXClasses", dataType: "json", data: { directory: "", chkStatus: !1, tableId: r, classType: "" }, success: function (t) { if (t.contant != null) { var i = "data:text/csv;charset=utf-8," + encodeURIComponent(t.contant); f.attr("download", t.fileName).attr("href", i).attr("target", "_blank"); n.ADialog.info(t.msg); f.css("display", "block"); u.css("display", "none") } o(!1) } }) } function y() { t.ajax({ url: n.Application.contextUrl + "GenerateXModel/GenXModelGetTable", type: "POST", async: !1, success: function (t) { var r = t.result, i; if (r) for (i = 0; i < r.length; i++)h.append("<option value='" + r[i].VAF_TableView_ID + "'>" + n.Utility.encodeText(r[i].Name) + "<\/option>") }, error: function (n) { i.log.info(n) } }) } function k(n, i, r) { var u = null; return t.ajax({ url: w, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function o(n) { s.css("display", n ? "block" : "none") } this.frame; this.windowNo; this.log = n.Logging.VLogger.getVLogger("GenerateXModel"); var i = this, r = t("<div style='width: 100%; height: 100%; background-color: white;'>"), s = t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"), u = null, f = null, e = null, h = null; varchkAllTable = null; vartxtpath = null; varchkClassType = null; var p = n.Application.contextUrl, w = p + "JsonData/JDataSet", b = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, k(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; this.Initialize = function () { c(); l(); a(); o(!1) }; this.getRoot = function () { return r }; this.disposeComponent = function () { u && u.off(n.Events.onTouchStartOrClick); e && e.off(n.Events.onTouchStartOrClick); i = null; this.windowNo = null; r = null; s = null; this.getRoot = null; this.disposeComponent = null } } n.AForms = n.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; try { this.Initialize() } catch (i) { } this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.AForms.GenerateXModel = i }(VIS, jQuery), function (n, t) { function r(r, u, f) { function gr() { var i = "", t = '<div class="vis-advancedSearch-contentWrap"> <div class="vis-advancedSearchContentArea vis-pull-left" style="' + i + '"> <div class="vis-advancedSearchContentArea-up"> <div class="vis-advanedSearch-InputsWrap"><div class="vis-as-topfieldswrap"><div style="display:none" class="vis-form-group vis-advancedSearchInput vis-adsearchgroup1"><input readonly id="txtQryName_' + r + '" type="text" name="QueryName" maxlength="60"><label id="lblQryName_' + r + '" for="QueryName">' + n.Msg.getMsg("AddNameToSaveSearch") + '<\/label><\/div> <div  class="vis-form-group vis-advancedSearchInput vis-adsearchgroup2"><label id="lblSavedQry_' + r + '" for="GetSavedQuery">' + n.Msg.getMsg("GetSavedSearch") + '<\/label><select id="drpSavedQry_' + r + '"><\/select><\/div> <div class="vis-advancedSearch-Icons vis-pull-left vis-adsearchgroup2">   <ul>   <li class="vis-pull-left"><button disabled id="btnDelete_' + r + '" class="vis-advancedSearchActionIcon vis-advancedSearch-delIcon"><i class="vis vis-delete" aria-hidden="true"><\/i><\/button><\/li><\/ul><\/div><\/div><div class="vis-advanedSearch-AddFilterWrap vis-pull-left"><label id="spnAddFilter_' + r + '" class="vis-advancedSearch-AddFilter">' + n.Msg.getMsg("AddFilter") + '<\/label><\/div>  <div class="vis-as-backbtn"><button id="btnArowBack_' + r + '" class="vis-ads-icon"><i class="fa fa-arrow-left" aria-hidden="true"><\/i><\/button><\/div> <\/div><div class="vis-advanedSearch-InputsWrap vis-advs-inputwraps vis-pull-left" data-show="N" style="display:none">  <div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v">    <label id="lblColumn_' + r + '"  for="Column">' + n.Msg.getMsg("Column") + '<\/label>  <select id="drpColumn_' + r + '"><\/select><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-op"><label id="lblOperator_' + r + '" for="Oprator">' + n.Msg.getMsg("Operator") + '<\/label><select id="drpOperator_' + r + '"><\/select><\/div> <div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" id="divValue1_' + r + '">   <label  id="lblQryValue_' + r + '" for="QueryValue">' + n.Msg.getMsg("QueryValue") + '<\/label> <input  id="txtQryValue_' + r + '" type="text" name="QueryValue"><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" id="divValue2_' + r + '"><label for="QueryName"  id="lblToQryValue_' + r + '">' + n.Msg.getMsg("ToQueryValue") + '<\/label><input  id="txtToQryValue_' + r + '" type="text" name="QueryName"><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" style="display:none;" id="divFullDay_' + r + '"><input style="width: auto;float: left;" id="checkFullDay_' + r + '" type="checkbox" name="QueryName"><label for="QueryName"  id="lblToQryValue_' + r + '">' + n.Msg.getMsg("FullDay") + '<\/label><\/div><div class="vis-advancedSearch-calender-Icon vis-pull-left"><ul><li class="vis-pull-left"><button id="btnSave_' + r + '" disabled class="vis-ads-icon"><i class="vis vis-plus" aria-hidden="true"><\/i><\/button><\/li><\/ul><\/div><\/div><div id="divDynamic_' + r + '"><div class="vis-advanedSearch-InputsWrap vis-advancedSearchMrgin"><div class="vis-form-group vis-advancedSearchInput1"><input type="checkbox"  id="chkDynamic_' + r + '"  name="IsDynamic" class="vis-pull-left"><label for="IsDynamic" >' + n.Msg.getMsg("IsDynamic") + '<\/label><\/div><div class="vis-form-group vis-advancedSearchInput"><select id="drpDynamicOp_' + r + '" disabled><option>' + n.Msg.getMsg("Today") + "<\/option><option>" + n.Msg.getMsg("lastxDays") + "<\/option><option>" + n.Msg.getMsg("lastxMonth") + "<\/option><option>" + n.Msg.getMsg("lastxYears") + '<\/option><\/select><\/div><div class="vis-form-group vis-advancedSearchHorigontal vis-pull-left" id="divYear_' + r + '"><input id="txtYear_' + r + '" type="number" min="1" max="99" /><label for="Year">' + n.Msg.getMsg("Year") + '<\/label><\/div><div class="vis-form-group vis-advancedSearchHorigontal vis-pull-left" id="divMonth_' + r + '"><input id="txtMonth_' + r + '" type="number" min="0" max="12" /><label for="Month">' + n.Msg.getMsg("Month") + '<\/label><\/div><div class="vis-form-group vis-advancedSearchHorigontal vis-pull-left" id="divDay_' + r + '"><input id="txtDay_' + r + '" type="number" min="0" max="31" /> <label for="Day">' + n.Msg.getMsg("Day") + '<\/label><\/div><\/div><\/div><\/div><div class="vis-advancedSearchContentArea-down"><div class="vis-advancedSearchTableWrap vis-table-responsive vis-pull-left"><table id="tblQry_' + r + '" class="vis-advancedSearchTable"><thead><tr class="vis-advancedSearchTableHead"><th>' + n.Msg.translate(n.Env.getCtx(), "VAF_Column_ID") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "KEYVALUE") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "OperatorName") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "QueryValue") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "VALUE1VALUE") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "QueryValue2") + "<\/th><th>" + n.Msg.getMsg("FullDay") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "VALUE2VALUE") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "VAF_USERSEARCHLINE_ID") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "Operator") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "Action") + '<\/th><\/tr><\/thead><tbody class="vis-advancedSearchTableBody"><\/tbody><\/table><\/div><\/div><div class="vis-advancedSearchContentArea-button"><div class="vis-advcedfooterBtn">'; i = "float:left"; t += '<button id="btnRefresh_' + r + '" class="ui-button ui-corner-all ui-widget">' + n.Msg.getMsg("Refresh") + '<\/button><div class="vis-pull-right"><button id="btnOk_' + r + '" class="ui-button ui-corner-all ui-widget" >' + n.Msg.getMsg("Apply") + '<\/button>  <button id="btnCancel_' + r + '" class="ui-button ui-corner-all ui-widget"  style="margin: 0 10px;">' + n.Msg.getMsg("close") + '<\/button><\/div><\/div><\/div><\/div><div class="vis-advancedSearch-RecentRecords">  <div class="vis-RecentRecords-Heading">'; t += "<h4>" + n.Msg.getMsg("VHistory") + '<\/h4><\/div><div class="vis-RecentRecords-listWrap"> <ul id="ulQry_' + r + '" ><li data-value="0" title="' + n.Msg.getMsg("All") + '" >' + n.Msg.getMsg("All") + '<\/li><li data-value="365" title="' + n.Msg.getMsg("YearAll") + '">' + n.Msg.getMsg("YearAll") + '<\/li><li data-value="365 | C" title="' + n.Msg.getMsg("YearCreated") + '">' + n.Msg.getMsg("YearCreated") + '<\/li><li data-value="31" title="' + n.Msg.getMsg("MonthAll") + '">' + n.Msg.getMsg("MonthAll") + '<\/li><li data-value="31 | C" title="' + n.Msg.getMsg("MonthCreated") + '">' + n.Msg.getMsg("MonthCreated") + '<\/li><li data-value="7" title="' + n.Msg.getMsg("WeekAll") + '">' + n.Msg.getMsg("WeekAll") + '<\/li><li data-value="7 | C" title="' + n.Msg.getMsg("WeekCreated") + '">' + n.Msg.getMsg("WeekCreated") + '<\/li><li data-value="1" title="' + n.Msg.getMsg("DayAll") + '">' + n.Msg.getMsg("DayAll") + '<\/li><li data-value="1 | C" title="' + n.Msg.getMsg("DayCreated") + '">' + n.Msg.getMsg("DayCreated") + '<\/li><\/ul><\/div><div class="vis-advancedSearchFooter vis-pull-right"> <p id="pstatus_' + r + '" >16 / 16<\/p><\/div><\/div><\/div><div class="vis-apanel-busy vis-advancedSearchbusy" id="divBusy_' + r + '" ><p style="text-align:center"> ' + n.Msg.getMsg("Loading") + "<\/p><\/div>"; e.append(t); nu(); tu(); iu() } function nu() { ot = e.find("#ulQry_" + r); a = e.find("#drpSavedQry_" + r); k = e.find("#drpColumn_" + r); v = e.find("#drpOperator_" + r); ut = e.find("#divValue1_" + r); nr = e.find("#lblQryValue_" + r); it = e.find("#divValue2_" + r); sr = e.find("#divFullDay_" + r); s = e.find("#txtQryName_" + r); ht = e.find("#btnOk_" + r); ct = e.find("#btnCancel_" + r); yt = e.find("#btnSave_" + r); vt = e.find("#btnDelete_" + r); gt = e.find("#btnRefresh_" + r); lt = e.find("#divDynamic_" + r); p = e.find("#chkDynamic_" + r); y = e.find("#drpDynamicOp_" + r); ni = e.find("#txtYear_" + r); et = e.find("#txtMonth_" + r); d = e.find("#txtDay_" + r); tt = e.find("#divYear_" + r); st = e.find("#divMonth_" + r); rt = e.find("#divDay_" + r); pt = e.find("#checkFullDay_" + r); ei = e.find("#spnAddFilter_" + r); ti = e.find("#btnArowBack_" + r); g = t(e.find(".vis-advs-inputwraps")[0]); tt.hide(); st.hide(); rt.hide(); lt.hide(); oi = e.find("#tblQry_" + r); ii = oi.find("tbody"); or = e.find("#pstatus_" + r); er = e.find("#divBusy_" + r) } function tu() { var s, o, f, t, e, u; for (h = yi(null, !1), s = i.getData(n.context, di, gi, "Code"), pr(h), ci = ot.html(), ar(s), o = '<option value="-1"> <\/option>', f = 0; f < fi.length; f++)(t = fi[f], t.getIsEncrypted()) || (e = t.getColumnName(), t.getDisplayType() == n.DisplayType.Button && (t.getVAF_Control_Ref_Value_ID() == 0 ? t.setDisplayType(n.DisplayType.String) : e.endsWith("_ID") ? t.setDisplayType(n.DisplayType.Table) : (t.setDisplayType(n.DisplayType.List), t.lookup = new n.MLookupFactory.getMLookUp(n.context, r, t.getVAF_Column_ID(), n.DisplayType.List))), u = t.getHeader(), u != null && u.length != 0 || (u = n.Msg.getElement(n.context, e), u != null && u.Length != 0)) && (t.getIsKey() && (u += " (ID)"), o += '<option value="' + e + '">' + u + "<\/option>"); k.html(o); b(!1) } function iu() { ct.on("click", function () { nt || (o.okBtnPressed = !1, l.close()) }); p.on("change", function () { var n = p.prop("checked"); y.prop("disabled", !n); v.prop("disabled", n); vr(!n); ui(!n); ou(n); n ? li(o.getIsUserColumn(k.val())) : (tt.hide(), st.hide(), rt.hide()) }); y.on("change", function () { li() }); k.on("change", function () { var t, r, s, i, f; nt || (p.prop("disabled", !0), p.prop("checked", !1), p.trigger("change"), lt.hide(), t = k.val(), bi(!0), t && t != "-1" ? (r = null, s = null, r = t.endsWith("_ID") || t.endsWith("_Acct") || t.endsWith("_ID_1") || t.endsWith("_ID_2") || t.endsWith("_ID_3") ? o.getOperatorsQuery(n.Query.prototype.OPERATORS_ID) : t.startsWith("Is") ? o.getOperatorsQuery(n.Query.prototype.OPERATORS_YN) : o.getOperatorsQuery(n.Query.prototype.OPERATORS), i = u.getField(t), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 150px)"), i != null && n.DisplayType.IsDate(i.getDisplayType()) ? (y.html(o.getOperatorsQuery(n.Query.prototype.OPERATORS_DATE_DYNAMIC, !0)), lt.show(), p.prop("disabled", !1), li(), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 195px)"), i.getDisplayType() == n.DisplayType.DateTime && (kt(!1), dt(!0))) : o.getIsUserColumn(t) && (y.html(o.getOperatorsQuery(n.Query.prototype.OPERATORS_DYNAMIC_ID, !0)), lt.show(), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 195px)"), p.prop("disabled", !1), li(!0)), i.getDisplayType() != n.DisplayType.DateTime && (kt(!0), dt(!1)), i.getDisplayType() == n.DisplayType.YesNo ? nr.hide() : nr.show(), v.html(r), v[0].SelectedIndex = 0, f = pi(t), yr(!0, f), ai(yt, !0), v.prop("disabled", !1)) : (dt(!1), kt(!0)), vr(!0), ui(!1)) }); v.on("change", function () { var t, i, r; nt || (t = v.val(), t || (t = ""), i = k.val(), r = pi(i), t && t != "0" ? n.Query.prototype.BETWEEN.equals(t) ? (yr(!1, r), ui(!0)) : (i = k.val(), r = pi(i), r.getDisplayType() == n.DisplayType.DateTime && n.Query.prototype.EQUAL.equals(t) ? (kt(!1), dt(!0)) : (kt(!0), dt(!1), ui(!1))) : (ai(yt, !1), ui(!1), bi(!0))) }); a.on("change", function () { if (!nt) { var t = a.val(); tr && ii.find(".vis-advancedSearchTableRow").length > 0 ? n.ADialog.confirm("SaveSearch?", !0, "", "Confirm", function (n) { n ? a.val(o.saveQueryID) : lr(t) }) : lr(t) } }); oi.on("click", function (n) { if (!nt && t(n.target).hasClass("vis-delete")) { var r = t(n.target).data("index"); c.splice(r, 1); i.deleteLines(t(n.target).data("userquery")); vi(c); ir--; ir == 0 && (s.prop("readonly", !0), s.val("")) } }); ot.on("click", "LI", function () { var i, r; nt || (i = t(this).data("value"), i != null ? (b(!0), r = t(this).index(), setTimeout(function () { var u, f, t; r < 9 ? (u = i.toString().split("|"), f = u.length, o.created = f == 1 ? !1 : !0, o.days = parseInt(u[0]), i = "") : o.days = 0; w = new n.Query(ft); w.addRestriction(i); t = 0; t = yi(w, !0); w.setRecordCount(t); b(!1); t != 0 && (o.okBtnPressed = !0, l.close()) }, 10)) : (o.okBtnPressed = !1, l.close())) }); yt.on("click", rr); vt.on("click", function () { if (!nt) { var t = a.val(); t == null || t.toString() == "" || parseInt(t) < 1 || n.ADialog.confirm("DeleteConfirm", !0, "", "Confirm", function (r) { if (r) { b(!0); window.setTimeout(function () { var e = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetQueryDefault", { UserQuery_ID: t }, null), r, f; if (e > 0) { n.ADialog.warn("QueryDefaultForOther"); b(!1); return } u.userQueryID == t && (o.needRefreshWindow = !0); r = a.find("option:selected").text(); i.deleteUserQuery(t) ? (f = i.getData(n.context, di, gi, "Code"), ot.empty(), ot.html(ci), ar(f), a[0].selectedIndex = 0, n.ADialog.info("Deleted", !0, r, ""), s.val(""), s.prop("readony", !0), b(!1), a.trigger("change")) : n.ADialog.info("DeleteError", !0, r, ""); b(!1) }, 10) } else b(!1) }) } }); ht.on("click", function () { nt || (o.okPressed = !0, o.okBtnPressed = !0, su()) }); gt.on("click", function () { if (!nt) { rr(); var t = kr(), n = 0; n = yi(t, !0); pr(n) } }); ei.on("click", function () { g && g.data("show") == "N" && (g.data("show", "Y"), t(this).hide(), g.show(), ti.show(), t(".vis-adsearchgroup2").hide(), t(".vis-adsearchgroup1").show(), t(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 150px)")) }); ti.on("click", function () { g.data("show", "N"); g.hide(); ei.show(); ti.hide(); cr(); t(".vis-adsearchgroup1").hide(); t(".vis-adsearchgroup2").show(); a[0].selectedIndex = 0; ii.empty(); c = []; s.val("") }); s.on("input", function () { s.length > 0 ? ht.text(n.Msg.getMsg("SaveAndApply")) : ht.text(n.Msg.getMsg("Apply")) }) } function cr() { k[0].selectedIndex = 0; v[0].selectedIndex = 0; bi(); bi(!0); dt(!1); kt(!0); p.prop("checked", !1); pt.prop("checked", !1); lt.hide(); e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 100px)") } function ru() { ct && (ct.off("click"), p.off("change"), y.off("change"), k.off("change"), v.off("change"), a.off("change"), oi.off("click"), ot.off("click"), yt.off("click"), vt.off("click"), ht.off("click"), gt.off("click")) } function lr(n) { if (o.saveQueryID = n, tr = !1, n && n != "-1") c = i.getQueryLines(n), vi(c), s.val(a.find("option:selected").text()), s.prop("readonly", !1), ai(vt, !0); else ai(vt, !1), s.val(""), s.prop("readonly", !0), c = null, vi(null) } function ar(t) { var u = "", e = "", r, i, f; if (t != null) for (r in t) i = n.Utility.encodeText(t[r].Name), f = i, i.length > 25 && (i = i.substr(0, 25) + "..."), u += '<li data-value="' + t[r].Code + '" title="' + f + '">' + i + "<\/li>", e += '<option value="' + t[r].VAF_UserSearch_ID + '" title="' + f + '">' + i + "<\/option>"; u.length > 0 && ot.append(u); a.html("<option value='-1' > <\/option>" + e) } function li(n) { var t = y[0].selectedIndex; if (n) { tt.hide(); st.hide(); rt.hide(); return } tt.show(); st.show(); p.is(":checked") ? rt.show() : rt.hide(); d.prop("readonly", !1); et.prop("min", 1); t == 3 || t == 6 ? (et.prop("min", 0), d.val(0), et.val(0), ni.val(1)) : t == 2 || t == 5 ? (tt.hide(), ni.val(""), et.val(1), d.val(0)) : t == 1 || t == 4 ? (tt.hide(), st.hide(), d.val(0)) : t == 0 && (d.prop("readonly", !0), tt.hide(), st.hide(), d.val(0)) } function uu() { return rt.is(":visible") || tt.is(":visible") || rt.is(":visible") } function fu(n) { var t = "", i; return n == 3 || n == 6 ? (i = Math.round(ri(n) / 365, 1), t = "Last " + i.toString() + " Years") : n == 2 || n == 5 ? (i = Math.round(ri(n) / 31, 1), t = "Last " + i.toString() + " Month") : t = ri() != 0 ? "Last " + ri() + " Days" : "This Day", t } function eu(n) { return " adddays(sysdate, - " + ri(n) + ") " } function ri(n) { var u = 0, i, t; if (n == 3 || n == 6) { var r = ni.val(), i = et.val(), t = d.val(); r = r && r != "" ? parseInt(r) : 0; i = i && i != "" ? parseInt(i) : 0; t = t && t != "" ? parseInt(t) : 0; u = r * 365 + i * 31 + t } else n == 2 || n == 5 ? (i = et.val(), t = d.val(), i = i && i != "" ? parseInt(i) : 0, t = t && t != "" ? parseInt(t) : 0, u = i * 31 + t) : (t = t = d.val(), t = t && t != "" ? parseInt(t) : 0, u = t); return u } function vr(n) { var r = ut.children()[1], i = null; ut.children().length > 2 && (i = ut.children()[2]); i ? t(i).prop("disabled", !n).prop("readonly", !n) : r != null && t(r).prop("disabled", !n).prop("readonly", !n) } function ui(n) { var r = it.children()[1], i = null; it.children().length > 2 && (i = it.children()[2]); i ? t(i).prop("disabled", !n).prop("readonly", !n) : r != null && t(r).prop("disabled", !n).prop("readonly", !n) } function kt(n) { it.css("display", n ? "block" : "none") } function dt(n) { sr.css("display", n ? "flex" : "none") } function ou(n) { n ? pt.prop("disabled", !0) : pt.prop("disabled", !1) } function ai(n, t) { n.prop("disabled", !t) } function yr(i, r) { var e, o, u, f; i && (wt = null); bt = null; e = null; o = null; i ? (e = ut.children()[1], ut.children().length > 2 && (o = ut.children()[2])) : (e = it.children()[1], it.children().length > 2 && (o = it.children()[2])); e != null && (t(e).remove(), o != null && t(o).remove(), e = null); u = null; u = r != null ? r.getIsKey() ? new n.Controls.VNumTextBox(r.getColumnName(), !1, !1, !0, r.getDisplayLength(), r.getFieldLength(), r.getColumnName()) : n.VControlFactory.getControl(null, r, !0, !0, !1) : new n.Controls.VTextBox("columnName", !1, !0, !1, 20, 20, "format", "GetObscureType", !1); u != null && (u.setReadOnly(!1), r.getDisplayType() == n.DisplayType.AmtDimension && (u.hideButton(!1), u.setReadOnlyTextbox(!1)), n.DisplayType.Text == r.getDisplayType() || n.DisplayType.TextLong == r.getDisplayType() ? (u.getControl().attr("rows", "1"), u.getControl().css("width", "100%")) : n.DisplayType.YesNo == r.getDisplayType() ? u.getControl().css("clear", "both") : n.DisplayType.IsDate(r.getDisplayType()) && u.getControl().css("line-height", "1"), f = null, u.getBtnCount() > 0 && !(u instanceof n.Controls.VComboBox) && (f = u.getBtn(0)), i ? (ut.append(u.getControl()), wt = u, f && (ut.append(f), u.getControl().css("width", "calc(100% - 30px)"), f.css("max-width", "30px"))) : (it.append(u.getControl()), bt = u, f && (it.append(f), u.getControl().css("width", "calc(100% - 30px)"), f.css("max-width", "30px"))), r.getDisplayType() == n.DisplayType.AmtDimension && u.getControl().css("width", "100%")) } function vi(n) { var i, f; ii.empty(); var u = "", r = "", t = null; if (n) for (i = 0, f = n.length; i < f; i++)r = '<tr class="vis-advancedSearchTableRow">', t = n[i], r += "<td>" + t.KEYNAME + '<\/td><td style="display:none">' + t.KEYVALUE + "<\/td><td>" + t.OPERATORNAME + "<\/td><td>" + t.VALUE1NAME + '<\/td><td style="display:none">' + t.VALUE1VALUE + "<\/td><td>" + t.VALUE2NAME + '<\/td><td style="display:none">' + t.VALUE2VALUE + "<\/td><td>" + t.FULLDAY + '<\/td><td style="display:none">' + t.VAF_USERSEARCHLINE_ID + '<\/td><td style="display:none">' + t.OPERATOR + '<\/td><td><i style="cursor:pointer" data-userQuery="' + t.VAF_USERSEARCHLINE_ID + '" data-index = "' + i + '" class="vis vis-delete"><\/i><\/td>', r += "<\/tr>", u += r; ii.html(u) } function yi(t, i) { var u = "SELECT COUNT(*) FROM ", e, f, c, s; u += ft; e = !1; at != null && at.length > 0 && (u += at.indexOf("@") == -1 ? " WHERE " + at : " WHERE " + n.Env.parseContext(n.context, r, at, !1), e = !0); t != null && t.getIsActive() && (u += e ? " AND " : " WHERE ", u += n.Env.parseContext(n.context, r, t.getWhereClause(!0), !1)); f = n.MRole.getDefault().addAccessSQL(u.toString(), ft, n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RO); n.context.setContext(r, dr, "FindSQL", f); h = 999999; try { c = n.secureEngine.encrypt(f); h = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetNoOfRecrds", { RecQuery: c }, null) } catch (l) { hi.Log(n.Level.SEVERE, f, l) } return s = n.MRole.getDefault(), o.okPressed = !1, h == 0 || h == null ? (h = 0, i && n.ADialog.info("FindZeroRecords", !0, "")) : t != null && s.getIsQueryMax(h) ? n.ADialog.error("FindOverMax", !0, h + " > " + s.getMaxQueryRecords()) : o.okPressed = !0, t != null, h } function pr(n) { var t = " " + n + " / " + h + " "; if (or.text(t), h < f) { hr = !0; return } } function pi(n) { var t, i; if (n == null || n.length == 0) return null; for (t = 0; t < fi.length; t++)if (i = fi[t], n.equals(i.getColumnName())) return i; return null } function rr() { var r = k.val(), n, i, c, h, l; if (!r || r == "-1" || (n = k.find("option:selected").text(), i = "", n == null || n.trim().length == 0)) return !1; if (i = r.toString(), tr = !0, c = p.prop("checked"), c) if (uu()) { var u = ">=", f = " >= ", e = fu(y[0].selectedIndex), o = eu(y[0].selectedIndex); wi(n, i, f, u, e, o, null, null, ur()) } else { var u = "=", f = " = ", e = y.find("option:selected").text(), o = y.val(); wi(n, i, f, u, e, o, null, null, ur()) } else h = v.val(), v[0].selectedIndex > -1 && (h = y.find("option:selected").text()), l = v.val(), wi(n, i, h, l, br(!0), wr(!0), br(!1), wr(!1), ur()); return s.prop("readonly", !1), cr(), ir++, g && g.data("show") == "Y" && (g.data("show", "N"), g.hide(), ei.show(), ti.hide(), t(".vis-adsearchgroup2").hide(), t(".vis-adsearchgroup1").show()), !0 } function wr(t) { var i = null; return (i = t ? wt : bt, i != null) ? i.getDisplayType() == n.DisplayType.YesNo ? i.getValue().toString().toLowerCase() == "true" ? "Y" : "N" : i.displayType == n.DisplayType.AmtDimension ? i.getText() : i.getValue() : "" } function br(t) { var i = null; return (i = t ? wt : bt, i != null) ? i.displayType == n.DisplayType.AmtDimension ? i.getText() : i.getDisplay() : "" } function ur() { if (pt) return pt.is(":checked") ? "Y" : "N" } function wi(t, i, r, u, f, e, o, s, h) { c == null && (c = []); var l = {}; l.KEYNAME = t; l.KEYVALUE = i; l.OPERATORNAME = u; l.VALUE1NAME = n.Utility.encodeText(f); l.FULLDAY = h; l.VALUE1VALUE = f == "" ? "" : e == null ? "NULL" : n.Utility.encodeText(n.Utility.Util.getValueOfString(e)); l.VALUE2NAME = n.Utility.encodeText(o); l.VALUE2VALUE = s == null ? "NULL" : n.Utility.encodeText(n.Utility.Util.getValueOfString(s)); l.VAF_USERSEARCHLINE_ID = 0; l.OPERATOR = r; c.push(l); vi(c) } function bi(n) { var t = null; t = n ? bt : wt; t != null && t.setValue(null) } function kr() { var l = new n.Query(ft), b, p, tt, h, o, k, w, t; if (c) for (b = 0; b < c.length; b++) { var s = c[b], nt = s.KEYNAME.toString(), a = s.KEYVALUE.toString(), f = pi(a), y = f.getColumnSQL(), u = s.OPERATORNAME.toString(), e = s.VALUE1VALUE, i = null; if (e != null && e.toString().trim().startsWith("adddays") || e.toString().trim().startsWith("@") || (i = fr(f, e)), p = null, e == null || e.toString().length < 1) { if (n.Query.prototype.BETWEEN.equals(u)) continue; i = n.Env.NULLString; p = "NULL" } else p = s.VALUE1NAME.toString(); if (tt = s.FULLDAY.toString(), f.getIsVirtualColumn()) if (y = f.vo.ColumnSQL, a = f.vo.ColumnSQL, n.Query.prototype.BETWEEN.equals(u)) { if (h = s.VALUE2VALUE.toString(), h == null || h.toString().trim().length < 1) continue; if (o = fr(f, h), k = s.VALUE2NAME.toString(), o == null) continue; t = ki(i, o, a, u, !0); where = n.Env.parseContext(n.context, r, t, !1); l.addRestriction(t) } else t = ki(i, o, a, u, !0), where = n.Env.parseContext(n.context, r, t, !1), l.addRestriction(t); else { var d = "VAB_DimAmt", it = "IsActive", rt = "Amount", ut = "S", v = "E", et = "L", ot = "ECT", st = "F", g = "R", ht = "OM", ct = "WH"; if (f.getDisplayType() == n.DisplayType.DateTime && n.Query.prototype.EQUAL.equals(u) && i && tt == "Y") { var lt = i.getFullYear(), at = i.getMonth(), vt = i.getDate(); o = new Date(lt, at, vt, 24, 00, 00); i = new Date(lt, at, vt, 00, 00, 00); s.VALUE2VALUE = o.toUTCString(); u = n.Query.prototype.BETWEEN } if (n.Query.prototype.BETWEEN.equals(u)) { if (h = s.VALUE2VALUE.toString(), h == null || h.toString().trim().length < 1) continue; if (f.getDisplayType() == n.DisplayType.AmtDimension && (w = ut + v + et + ot + " " + d + "_ID " + st + g + ht + " " + d + " " + ct + v + g + v + " " + it + "='Y' AND " + rt + " " + u + e + " AND " + h, i = n.MRole.getDefault().addAccessSQL(w.toString(), "VAB_DimAmt", n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RO), u = n.Query.prototype.IN), f.getDisplayType() == n.DisplayType.AmtDimension) t = ki(i, o, y, u, !1), where = n.Env.parseContext(n.context, r, t, !1), l.addRestriction(t); else { if (o = fr(f, h), k = s.VALUE2NAME.toString(), o == null) continue; l.addRangeRestriction(y, i, o, nt, p, k) } } else f.getDisplayType() == n.DisplayType.AmtDimension && (w = ut + v + et + ot + " " + d + "_ID " + st + g + ht + " " + d + " " + ct + v + g + v + " " + it + "='Y' AND " + rt + " " + u + e, i = n.MRole.getDefault().addAccessSQL(w.toString(), "VAB_DimAmt", n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RO), u = n.Query.prototype.IN), i == null && e != null && (e.toString().trim().startsWith("adddays") || e.toString().trim().startsWith("@")) ? (t = ft + "." + a + u + e, f.getDisplayType() == n.DisplayType.AmtDimension && (t = a + n.Query.prototype.IN + "(" + i + ")"), where = n.Env.parseContext(n.context, r, t, !1), l.addRestriction(t)) : f.getDisplayType() == n.DisplayType.AmtDimension ? (t = ki(i, o, y, u, !1), where = n.Env.parseContext(n.context, r, t, !1), l.addRestriction(t)) : l.addRestriction(y, u, i, nt, p) } } return l } function ki(t, i, r, u, f) { var e = "", o = /(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})/; return typeof t == "string" && (e += " UPPER( "), e += ft + "." + r, typeof t == "string" && (e += " ) "), t == null || "NULL".equals(t.toString().toUpper()) || "NullValue".toUpper().equals(t.toString().toUpper()) ? e += u.equals(n.Query.prototype.EQUAL) ? " IS NULL " : " IS NOT NULL " : (e += u, (n.Query.prototype.IN.equals(u) || n.Query.prototype.NOT_IN.equals(u)) && (e += "("), t instanceof Date || t && o.test(t.toString()) ? e += n.DB.to_date(tcode, !1) : "string" == typeof t ? f ? (e += " UPPER( ", e += n.DB.to_string(t.toString()), e += " ) ") : e += t.toString() : e += t, n.Query.prototype.BETWEEN.equals(u) ? (e += " AND ", i instanceof Date || i && o.test(i.toString()) ? e += n.DB.to_date(i, !1) : typeof i == "string" ? (e += " UPPER( ", e += n.DB.to_string(i.toString()), e += " ) ") : e += i) : (n.Query.prototype.IN.equals(u) || n.Query.prototype.NOT_IN.equals(u)) && (e += ")")), e } function fr(t, i) { var u, r, e, f, o; if (i == null || (u = t.getDisplayType(), r = i.toString(), r == null || r.equals(n.Env.NULLString) || r == "" || r.toUpper() == "NULL")) return null; try { if (u == n.DisplayType.Integer || n.DisplayType.IsID(u) && t.getColumnName().endsWith("_ID")) return parseInt(r); if (n.DisplayType.IsNumeric(u)) return parseFloat(r); if (n.DisplayType.IsDate(u)) { e = ""; try { return new Date(r) } catch (h) { e = "" } try { return Date.Parse(e) } catch (c) { return null } } } catch (s) { return f = s.message, (f == null || f.length == 0) && (f = s.toString()), o = "", o += t.getColumnName() + " = " + r + " - " + f, n.ADialog.error("ValidationError", !0, o.toString()), null } return r } function su() { var f, r; if (b(!0), rr(), w = kr(), w.getRestrictionCount() == 0) { b(!1); l.close(); return } f = w.getWhereClause(!0); r = n.Utility.encodeText(s.val()); r != null && r.trim().length == 0 ? r = null : o.needRefreshWindow = !0; var t = a.val(), u = ""; t = t != null && t.toString() != "-1" && parseInt(t) > 0 ? t : 0; window.setTimeout(function () { if (t != 0 || r != null) if (i.insertOrUpdate(t, r, f, di, gi, c, o.getID)) si = !1, u = t > 0 ? "Updated" : "Saved", o.saveQueryID = i.id; else { if (i.alreadyExist) { n.ADialog.error("SearchExist"); b(!1); si = !0; return } si = !0; u = t > 0 ? "UpdatedError" : "SaveError" } var e = !1; yi(w, !0) != 0 && (e = !0); b(!1); u != "" && n.ADialog.info("", !0, n.Msg.getMsg(u) + " " + r, null); e && l.close() }, 10) } function b(n) { nt = n; er.css("visibility", nt ? "visible" : "hidden"); ht.prop("disabled", n); ct.prop("disabled", n); gt.prop("disabled", n) } var hu = u.getName(), di = u.getVAF_Tab_ID(), gi = u.getVAF_TableView_ID(), ft = u.getTableName(), at = u.getWhereClause(), fi = u.getFields(), e = t("<div  class='vis-forms-container' style='height:100%'>"), er = null, o = this, l = null, ht, ct, vt, yt, gt, s, a, k, v, y, p, ni, et, d, or, pt, ei, ti, ot, lt, tt, st, rt, ut, it, oi, ii, sr, g, nr, dr = 99, h = 0, hr = !1, si = !1, nt = !1, c = null, hi = n.Logging.VLogger.getVLogger("Find"), wt, bt, ci; this.onClose = null; this.created = !1; this.days = 0; this.okPressed = !1; this.okBtnPressed = !1; this.needRefreshWindow = !1; ci = ""; this.saveQueryID = -1; var tr = !1, ir = 0, w = new n.Query(ft); w.addRestriction(at); gr(); wi; this.getID = function (n) { this.saveQueryID = n }; this.getSavedID = function () { return this.saveQueryID }; this.show = function () { l = new n.ChildDialog; l.setHeight(550); l.setWidth(860); l.setTitle(n.Msg.getMsg("Find")); l.setModal(!0); l.onClose = function () { o.onClose && o.onClose(); o.dispose() }; l.show(); l.setContent(e); l.hideButtons(); b(!1); ct.focus() }; this.getSavedQueryName = function () { return s.val() ? n.Utility.encodeText(s.val()) : "" }; this.getQuery = function () { var t = n.MRole.getDefault(); return t.getIsQueryMax(h) ? (w = n.Query.prototype.getNoRecordQuery(ft, !1), h = 0, hi.warning("Query - over max")) : hi.info("Query=" + w), w }; this.disposeComponent = function () { ru(); ht = ct = vt = yt = gt = null; s = a = k = v = y = p = ni = et = d = null; ot = lt = tt = st = rt = null; e && e.remove(); e = null; h = hr = si = null; c = null; hi = null; this.created = this.days = 0; this.okPressed = this.okBtnPressed = null; wt = bt = ci = null; w = null } } var u = n.Application.contextUrl, f = u + "JsonData/ExecuteNonQuer", e = function (n, i, r) { var e = r ? !0 : !1, u = null, o = { sql: n, param: i }; return t.ajax({ url: f + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: e, data: JSON.stringify(o) }).done(function (n) { u = n; r && r(n) }), u }, i = { alreadyExist: !1, id: 0, getData: function (t, i, r, u) { var o = t.getVAF_Client_ID(), f = null; try { f = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetData", { ColumnName: u, Tab_ID: i, Table_ID: r }, null) } catch (e) { console.log(e) } return f }, getQueryLines: function (t) { var i = null, o = [], f, e, u, r; try { if (i = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetQueryLines", { UserQuery_ID: t }, null), f = "", e = "", i != null) for (u in i) r = {}, r.KEYNAME = i[u].KEYNAME, r.KEYVALUE = i[u].KEYVALUE, r.OPERATORNAME = i[u].OPERATORNAME, r.VALUE1NAME = i[u].VALUE1NAME, r.VALUE1VALUE = i[u].VALUE1VALUE, r.VALUE2NAME = i[u].VALUE2NAME, r.VALUE2VALUE = i[u].VALUE2VALUE, r.VAF_USERSEARCHLINE_ID = i[u].VAF_USERSEARCHLINE_ID, r.FULLDAY = i[u].FULLDAY, f = i[u].OPERATORNAME, e = n.Query.prototype.OPERATORS[f], r.OPERATOR = e, o.push(r) } catch (s) { } return o }, deleteLines: function (t) { var i = [], r; return i[0] = new n.DB.SqlParam("@VAF_UserSearch_ID", t), r = e("VIS_147", i, null), r >= 0 }, deleteUserQuery: function (i) { var r = -1; return t.ajax({ url: n.Application.contextUrl + "ASearch/DeleteQuery", type: "POST", datatype: "json", async: !1, data: { id: i } }).done(function (n) { r = parseInt(n) }), r >= 0 }, insertOrUpdate: function (r, u, f, e, o, s) { var h = -1; return t.ajax({ url: n.Application.contextUrl + "ASearch/InsertOrUpdateQuery", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ id: r, name: u, where: f, tabid: e, tid: o, qLines: s }) }).done(function (n) { h = parseInt(n); h == -5 && (i.alreadyExist = !0) }), h > 0 && (i.id = h), h >= 0 } }; r.prototype.getOperatorsQuery = function (t, i) { var f = "", r = "", u; for (u in t) r = t[u], i && (r = n.Msg.getMsg(r)), f += '<option value="' + u + '">' + r + "<\/option>"; return f }; r.prototype.getIsUserColumn = function (n) { return n.endsWith("atedBy") || n.equals("VAF_UserContact_ID") ? !0 : n.equals("SalesRep_ID") ? !0 : !1 }; r.prototype.getCurrentDays = function () { return this.days }; r.prototype.getIsCreated = function () { return this.created }; r.prototype.getIsOKPressed = function () { return this.okPressed && this.okBtnPressed }; r.prototype.needRefresh = function () { return this.needRefreshWindow }; r.prototype.dispose = function () { this.disposeComponent() }; n.Find = r }(VIS, jQuery), function (n, t) { function i(n, i, r) { var f = null; return t.ajax({ url: u, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; r && r(n) }), f } function f(i, r, u, f, e, o, s, h) { this.init = function () { l() }; var c = [], l = function () { var i = null, l, w, b, v, k, y, p, e, a; if (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetZoomTargets", data: { tableName: r }, success: function (n) { i = JSON.parse(n) } }), i != null && i.length > 0) for (l = 0; l < i.length; l++)if (w = i[l], t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetZoomTarget", data: { targetTableName: w, curWindow_ID: f, targetWhereClause: u.getWhereClause() }, success: function (n) { zoomList = JSON.parse(n) } }), zoomList != null) for (e in zoomList) { b = zoomList[e]; v = !0; for (k in c) if (c[k].Key == zoomList[e].Key) { v = !1; break } v && c.push(b) } if (i = null, c.length == 0) n.ADialog.info("NoZoomTarget"); else { y = t("<div>"); p = t("<ul class=vis-apanel-rb-ul>"); y.append(p); for (e in c) { a = t("<li data-id='" + c[e].Key + "'>"); a.append(c[e].Name); a.on("click", function (i) { var f, r, u; i.stopImmediatePropagation(); f = t(this).data("id"); r = new n.Query; r.addRestriction(s, n.Query.prototype.EQUAL, h); n.viewManager.startWindow(f, r); u = t("#w2ui-overlay-main"); u.hide(); u = null }); p.append(a) } o.w2overlay(y.clone(!0), { css: { height: "200px" } }) } }, a = function (n, t) { var i; if (t != null && t.Length != 0 && (i = t, !(i.indexOf(" EXISTS ") > 0) && !(i.indexOf(" IN ") > 0) && !(i.indexOf("(") > 0) && !(i.indexOf(")") > 0))) while (i.indexOf("=") != -1) { var f = i.indexOf("="), u = i.lastIndexOf(" ", f), e = f - (u + 1), r = i.substr(u + 1, e); r.indexOf(".") != -1 && (u = r.indexOf(".") + 1, e = f - u, r = r.substr(u, e)); n.indexOf(r) < 0 && n.push(r); i = i.substr(f + 1) } }, v = function (t, i) { var r, o, s; if (i == null || i.Length == 0) return !0; if (r = i, o = !0, r.indexOf(" EXISTS ") > 0 || r.indexOf(" IN ") > 0 || r.indexOf("(") > 0 || r.indexOf(")") > 0) return !1; while (r.indexOf("=") != -1) { var u = r.indexOf("="), f = r.lastIndexOf(" ", u), e = r.substr(f + 1, u - (f + 1)), h = "", c = ""; e.indexOf(".") != -1 && (f = e.indexOf("."), e = e.substr(f, u)); for (s in t) if (e == t[s].columnName) { h = "'" + t[s].columnValue + "'"; break } if (r = r.substr(u + 1), f = 0, u = r.indexOf(" "), c = u == -1 ? r.substr(f) : r.substr(f, u), !n.Evaluator.evaluateLogicTuple(h, "=", c)) { o = !1; break } } return o } } var r = n.Application.contextUrl, u = r + "JsonData/JDataSetWithCode", e = function (t, r, u) { var o = u ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, f; return r && (e.param = r), f = null, i(e, o, function (t) { f = (new n.DB.DataReader).toJson(t); u && u(f) }), f }, o = function (t, r, u) { var o = u ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, f; return r && (e.param = r), f = null, i(e, o, function (t) { f = (new n.DB.DataSet).toJson(t); u && u(f) }), f }; n.AZoomAcross = f }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function ui() { w = f; w || (at = i.gridTable.VAF_TableView_ID, o = r.getSelectedRows(), l = i.getRecords()[i.getCurrentRow()]); v = t('<ul class="vis-sms-ul" ><\/ul>'); y = t("<div>"); y.css("position", "absolute"); y.css("bottom", "0"); y.css("background", "url('" + n.Application.contextUrl + "Areas/VIS/Images/LoadingCircle.gif') no-repeat"); y.css("background-position", "center center"); y.css("width", "100%"); y.css("height", "100%"); y.css("text-align", "center"); y.css("opacity", ".1"); y[0].style.visibility = "hidden" } function fi() { var i = '         <div class="contentArea" style="width: 100%; float: left;">', r; i += ' <div class="vis-sms-leftDiv"><\/div>'; i += '   <div class="vis-sms-ContentWrap"><div class="vis-sms-ContentArea"><div class="vis-sms-leftWrap"><div class="vacom-form-horizontal">'; i += '   <div class="vis-sms-inputWrap"><div class="vis-sms-form-data-sub">'; i += '         <input type="text"  id="' + s.windowNo + '_emailMoblie"  placeholder="' + n.Msg.getMsg("EnterMobileNumber") + '">'; i += "<\/div>"; i += "  <\/div>"; i += '  <\/div><div class="vis-sms-textarea-div" style="width: 100%; float: left;">'; i += ' <textarea  ondrop="return false;" id="' + s.windowNo + '_vis-sms-textarea" style="width: 100%; height:100%;resize:none" placeholder="' + n.Msg.getMsg("WriteMsgHere") + '"><\/textarea><\/div>'; i += ' <div class="vis-sms-leftFooter">'; i += '<div ><p class="vis-sms-counter" id=' + s.windowNo + '_acCount><\/p> <p  class="vis-sms-counter"   id=' + s.windowNo + '_oper><\/p> <p  class="vis-sms-counter"   id=' + s.windowNo + "_maxCount >160<\/p> <\/div>"; i += ' <input id="' + s.windowNo + '_dyndis" type="checkbox"><label  id="' + s.windowNo + '_dyndislbl"  for="' + s.windowNo + '_dyndis" >' + n.Msg.getMsg("DynamicSms") + "<\/label><\/div><\/div>"; i += '  <div class="vis-sms-divider"><\/div>'; i += ' <div class="vis-sms-rytWrap"><div class="vis-sms-rytContent">'; i += ' <div class="vis-sms-rytBcc"><div class="vis-email-rytBcc-header"><h4>' + n.Msg.getMsg("Mobile") + "<\/h4>"; i += ' <i id="' + s.windowNo + '_SmsRefresh" title="' + n.Msg.getMsg("Refresh") + '" class="vis vis-refresh"><\/i>'; i += '   <\/div><div class="vis-sms-BccList">'; i += " <\/div><\/div><\/div><\/div>  <\/div><\/div>"; e.append(t(i)); r = 0; k = e.find("#" + s.windowNo + "_dyndis"); e.find(".contentArea").css("height", e.height() - 42); e.find(".vis-sms-leftDiv").height(e.height() - 42); a = e.find(".vis-sms-leftDiv"); et = e.find(".vis-sms-BccList"); c = e.find("#" + s.windowNo + "_emailMoblie"); pt = e.find("#" + s.windowNo + "_SmsRefresh"); c.css("margin-top", "10px"); h = e.find("#" + s.windowNo + "_vis-sms-textarea"); $leftfootArea = e.find(".vis-sms-leftFooter"); rt = e.find("#" + s.windowNo + "_acCount"); ut = e.find("#" + s.windowNo + "_oper"); ot = e.find("#" + s.windowNo + "_maxCount"); e.find(".vis-sms-textarea-div").css("margin-top", "10px"); e.find(".vis-sms-rytBcc").height(e.find(".vis-sms-rytContent").height() - 10); w ? (e.find(".vis-sms-leftDiv").hide(), e.find(".vis-sms-rytWrap").hide(), e.find(".vis-sms-textarea-div").height(e.height() - 150), e.find(".vis-sms-leftWrap").css("width", "100%"), e.find("#" + s.windowNo + "_dyndislbl").hide(), r = e.width() - 40, k.prop("checked", !1), k.hide()) : (e.find(".vis-sms-textarea-div").height(e.height() - 150), r = e.width() - 240, e.find(".vis-sms-leftWrap").width(r - 345)); b = e.find(".vis-sms-ContentWrap"); b.css("width", r); yt = !0; e.find(".vis-sms-BccList").height(e.find(".vis-sms-rytContent").height() - 70) } function ei() { var s, u, h, f, e, r; for (nt = t('<i class="fa fa-bars"><\/i>'), s = t('<div class="vis-apanel-lb-toggle" style="overflow-x:hidden;overflow-y:hidden"><\/div>'), s.append(nt), a.append(s), p = t('<ul class="vis-apanel-lb-ul"><\/ul>'), p.css({ height: "calc(100% - 54px)", overflow: "auto", "white-space": "nowrap", width: "100%" }), u = 0; u < i.gridTable.getFields().length; u++)if (h = i.gridTable.getFields(0)[u].getColumnName().toUpper() == i.getKeyColumnName().toUpper(), i.gridTable.getFields(0)[u].getIsDisplayed() || h) { if (h || p.append(t("<li>" + i.gridTable.getFields(0)[u].getHeader() + "<\/li>")), f = [], e = [], i.gridTable.getFields(0)[u].getColumnName().toUpper().equals(g)) for (r = 0; r < o.length; r++)n.DisplayType.IsLookup(i.getField(g).getDisplayType()) ? o[r][g.toLower()] != null && (f.push(o[r][g.toLower()]), e.push(o[r][i.getKeyColumnName().toLower()])) : o[r][g.toLower()] != null && (f.push(o[r][g.toLower()]), e.push(o[r][i.getKeyColumnName().toLower()])); si(f, e) } a.append(p) } function wt(n) { var t, u; if (n && (v.empty(), o = r.getSelectedRows(), l = i.getRecords()[i.getCurrentRow()]), r.singleRow) bt(); else if (o.length > 0) for (t = 0; t < o.length; t++)o[t].mobile != null && (u = o[t][i.getKeyColumnName().toLower()], v.append('<li class="vis-sms-list-li-bcc"  data-mobile="' + o[t].mobile + '"><input id="' + s.windowNo + "_" + o[t].mobile + '_CheckBoxList1" type="checkbox" value="' + o[t].mobile + '" checked/><label class="vis-sms-chcklist-label"  for="' + s.windowNo + "_" + o[t].mobile + '_CheckBoxList1">' + o[t].mobile + "(" + u + ")<\/label><\/li>")); else bt(); n || et.append(v); v.children().length > 1 && k.prop("checked") == !0 && (c.val(""), c.prop("disabled", !0)) } function bt() { if (l.mobile != null) { var n = l[i.getKeyColumnName().toLower()]; v.append('<li class="vis-sms-list-li-bcc" data-mobile="' + l.mobile + '"><input id="' + s.windowNo + "_" + l.mobile + '_CheckBoxList1" type="checkbox" value="' + l.mobile + '" checked /><label class="vis-sms-chcklist-label"  for="' + s.windowNo + "_" + l.mobile + '_CheckBoxList1">' + l.mobile + "(" + n + ")<\/label><\/li>") } } function oi() { it = t('<i class="vis-email-sendbtn vis vis-paper-plane vis-Sms-sendButton" title="' + n.Msg.getMsg("SendSms").replace("&", "") + '" ><\/i>'); ht.append(it); w || (tt = t('<i class="vis-email-btns vis vis-viewdocument vis-sms-preview-btn" title="' + n.Msg.getMsg("Preview").replace("&", "") + '"><\/i>'), ht.append(tt)) } function si(i, r) { for (var u, o, f, e = 0; e < i.length; e++)if (u = n.dataContext.getJSONData(n.Application.contextUrl + "Sms/GetUser", { BPartner_ID: i[e] }, null), o = !1, u != null) for (f in u) if (u[f].ISSMS != null && u[f].ISSMS.toString().equals("Y")) { if (u[f].MOBILE == null || u[f].MOBILE == "") continue; if (t(v.children("li").data(u[f].MOBILE + r[e])).length > 0) continue; v.append('<li  class="vis-sms-list-li-bcc"><input id="' + s.windowNo + "_" + u[f].MOBILE + '_CheckBoxList1" type="checkbox"  value="' + u[f].MOBILE + r[e] + '" checked/><label class="vis-sms-chcklist-label" for="' + s.windowNo + "_" + u[f].MOBILE + '_CheckBoxList1">' + u[f].MOBILE + "(" + r[e] + ")<\/label><\/li>") } } function hi() { it.on("click", bi); h.on("keyup", kt); if (!w) { nt.on("click", ci); k.on("click", li); p.children("li").on("click", ai); tt.on("click", vi); nt.trigger("click"); pt.on("click", yi) } } function ci() { k.prop("checked") == !0 ? a.width() == 40 ? (a.css("width", "200px"), a.find("ul").show(), b.width(b.width() - 160), e.find(".vis-sms-leftWrap").width(e.find(".vis-sms-leftWrap").width() - 160)) : ct() : a.width() != 40 && ct() } function ct() { a.css({ width: "40px" }); a.find("ul").hide(); b.width(b.width() + 160); e.find(".vis-sms-leftWrap").width(e.find(".vis-sms-leftWrap").width() + 160) } function li() { this.checked ? (a.width() != 40 && a.find("ul").show(), r.singleRow == !1 && o.length > 1 && (c.val(""), c.prop("disabled", !0))) : (a.width() != 40 && ct(), c.prop("disabled", !1)) } function ai() { var r = h[0], f = "@@" + t(this).text() + "@@", s = r.scrollTop, n = 0, u = r.selectionStart || r.selectionStart == "0" ? "ff" : document.selection ? "ie" : !1, e, o, i; u == "ie" ? (h.focus(), i = document.selection.createRange(), i.moveStart("character", -h.val().length), n = i.text.length) : u == "ff" && (n = r.selectionStart); e = h.val().substring(0, n); o = h.val().substring(n, h.val().length); h.val(e + f + o); n = n + f.length; u == "ie" ? (h.focus(), i = document.selection.createRange(), i.moveStart("character", -h.val().length), i.moveStart("character", n), i.moveEnd("character", 0), i.select()) : u == "ff" && (r.selectionStart = n, r.selectionEnd = n, h.focus()); r.scrollTop = s; r = null; kt() } function vi() { var f = h.val(), e = "", u, i; e = r.singleRow == !1 && o.length > 0 ? dt(f, 0) : gt(f); u = t("<div><\/div>"); u.append(n.Utility.encodeText(e)); i = new n.ChildDialog; i.setHeight(420); i.setWidth(850); i.setTitle(n.Msg.getMsg("Preview")); i.setModal(!0); i.setContent(u); i.show(); i.hidebuttons() } function yi() { wt(!0) } function kt() { rt.text(h.val().length); parseInt(rt.text()) > parseInt(ot.text()) ? (ut.text(">"), lt("#ED0000")) : parseInt(rt.text()) == parseInt(ot.text()) ? (ut.text("="), lt("#000000")) : (ut.text("<"), lt("#000000")) } function lt(n) { ut.css("color", n); rt.css("color", n); ot.css("color", n) } function pi(t, u) { for (var l = t, h = {}, f = t; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var c = f.substring(0, f.indexOf("@@")), s = null, e = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === c })[0]; n.DisplayType.IsLookup(i.getField(e).getDisplayType()) || n.DisplayType.Location == i.getField(e).getDisplayType() ? o[u][e.toLower()] != null && o[u][e.toLower()] != undefined && (s = i.getField(e.toLower()).lookup.getDisplay(o[u][e.toLower()])) : n.DisplayType.IsDate(i.getField(e).getDisplayType()) ? (s = i.getField(e).value, s = new Date(s)) : s = o[u][e.toLower()]; f = f.substring(f.indexOf("@@") + 2); h["@@" + c + "@@"] = s } return h } function wi(t) { for (var u = t, o = {}; u.indexOf("@@") > -1;) { u = u.substring(u.indexOf("@@") + 2); var s = u.substring(0, u.indexOf("@@")), e = null, f = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === s })[0]; n.DisplayType.IsLookup(i.getField(f).getDisplayType()) || n.DisplayType.Location == i.getField(f).getDisplayType() ? l[f.toLower()] != null && l[f.toLower()] != undefined && (e = i.getField(f.toLower()).lookup.getDisplay(l[f.toLower()])) : n.DisplayType.IsDate(i.getField(f).getDisplayType()) ? (e = i.getField(f).value, e = new Date(e)) : e = l[f.toLower()]; u = u.substring(u.indexOf("@@") + 2); o["@@" + s + "@@"] = e } return o } function dt(t, u) { for (var h = t, f = t; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var c = f.substring(0, f.indexOf("@@")), s = null, e = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === c })[0]; n.DisplayType.IsLookup(i.getField(e).getDisplayType()) || n.DisplayType.Location == i.getField(e).getDisplayType() ? o[u][e.toLower()] != null && o[u][e.toLower()] != undefined && (s = i.getField(e.toLower()).lookup.getDisplay(o[u][e.toLower()])) : n.DisplayType.IsDate(i.getField(e).getDisplayType()) ? (s = i.getField(e).value, s = new Date(s)) : s = o[u][e.toLower()]; f = f.substring(f.indexOf("@@") + 2); h = h.replace("@@" + c + "@@", s) } return h } function gt(t) { for (var f = t; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var o = f.substring(0, f.indexOf("@@")), e = null, u = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === o })[0]; n.DisplayType.IsLookup(i.getField(u).getDisplayType()) || n.DisplayType.Location == i.getField(u).getDisplayType() ? l[u.toLower()] != null && l[u.toLower()] != undefined && (e = i.getField(u.toLower()).lookup.getDisplay(l[u.toLower()])) : n.DisplayType.IsDate(i.getField(u).getDisplayType()) ? (e = i.getField(u).value, e = new Date(e)) : e = r.singleRow == !0 ? i.getField(u).value : l[u.toLower()]; f = f.substring(f.indexOf("@@") + 2); t = t.replace("@@" + o + "@@", e) } return t } function bi(t) { var i = h.val(), r = !0; (i == null || i == "" || i.trim().length == 0) && (r = !1, n.ADialog.confirm("SendWithoutBody", !0, "", "Confirm", function (n) { n && ni(t, i) })); r && ni(t, i) } function ni() { var s, p, i, f, u, a, w, b, d, g; if (ft = [], s = "", p = [], k.prop("checked") == !1) { if (i = {}, i.MobileNumbers = [], c.val().contains(";")) for (f = c.val().split(";"), u = 0; u < f.length; u++)f[u] != null && f[u] != "" && (ii(f[u]) ? i.MobileNumbers.push(f[u]) : s += f[u] + ","); else c.val() != null && c.val() != "" && (ii(c.val()) ? i.MobileNumbers.push(c.val()) : s += c.val() + ","); if (v != null && v != undefined) if (selectedValues = [], e.find("[id*=CheckBoxList1]:checked").each(function () { selectedValues.push(t(this).val()) }), selectedValues.length > 0) for (a = 0; a < selectedValues.length; a++)selectedValues[a] ? i.MobileNumbers.push(selectedValues[a]) : s += selectedValues[a] + ","; else if (c.val().trim().length == 0) { window.setTimeout(function () { n.ADialog.info("NoNumberFound") }, 2); return } if (s != "") { window.setTimeout(function () { n.ADialog.info("InvalidMobileNumbers", " ", n.Msg.getMsg("MobileNo") + s) }, 2); return } if (i.Body = {}, i.MobileNumbers.length > 0) for (w = 0; w < i.MobileNumbers.length; w++)ft.push({ num: i.MobileNumbers[w], info: '"' + i.MobileNumbers[w] + '","' + h.val() + '","' + new Date + '","@@response@@"' }); p.push(i) } else if (selectedValues = [], t("[id*=CheckBoxList1]:checked").each(function () { selectedValues.push(t(this).val()) }), r.singleRow == !0 && o.length > 0) p.push(ti(l, 0)); else for (b = 0; b < o.length; b++)p.push(ti(o[b], b)); d = JSON.stringify(p); y[0].style.visibility = "visible"; g = { sms: d, format: h.val() }; t.ajax({ url: n.Application.contextUrl + "Sms/SendSms", data: g, datatype: "json", type: "post", cache: !1, success: function (i) { var r = JSON.parse(i), e, o, u, s, h, c, f; if (y[0].style.visibility = "hidden", r.ResultMessage == "SmsConfigurationNotFound") { window.setTimeout(function () { n.ADialog.info("SmsConfigurationNotFound") }, 2); return } for (e = t('<div style="max-height: 300px;overflow:auto"><\/div>'), o = t("<table><\/table>"), u = 0; u < r.Response.length; u++)s = t("<tr><\/tr>"), h = t("<td><\/td>"), h.append(r.Response[u].mobileNumber + " - " + r.Response[u].response), s.append(h), o.append(s); e.append(o); c = t('<a style="float:right" href="javascript:void(0)" ><i title="' + n.Msg.getMsg("SaveSmsLog") + '" class="vis vis-save"><\/i><\/a>'); e.append(c); _SmsRefresh; f = new n.ChildDialog; f.setTitle(n.Msg.getMsg("Information")); f.setContent(e); f.show(); f.hidebuttons(); c.on("click", function () { for (var i = "", u, f, e, n = 0; n < r.Response.length; n++)u = t.grep(ft, function (t) { return t.num == r.Response[n].mobileNumber }), i += u[0].info.replace("@@response@@", r.Response[n].response) + "\n"; f = (new Date).toISOString().slice(0, 19).replace(/-/g, ""); e = "data:text/csv;base64," + window.btoa(i); t(this).attr("href", e).attr("download", "file-" + f + ".csv") }) }, error: function (t) { console.log(t); n.ADialog.error("MessageSendingFailed"); y[0].style.visibility = "hidden" } }) } function ti(n, t) { var i = {}, u, t, e, f; if (i.MobileNumbers = [], c.val().contains(";")) for (u = c.val().split(";"), t = 0; t < u.length; t++)u[t] != null && u[t] != "" && i.MobileNumbers.push(u[t]); else c.val() != null && c.val() != "" && i.MobileNumbers.push(c.val()); if (v != null && v != undefined && Object.keys(n).indexOf("mobile") > -1 && selectedValues.indexOf(n.mobile) > -1 && i.MobileNumbers.push(n.mobile), e = "", r.singleRow == !1 ? (i.Body = pi(h.val(), t), e = dt(h.val(), t)) : (i.Body = wi(h.val()), e = gt(h.val())), i.MobileNumbers.length > 0) for (f = 0; f < i.MobileNumbers.length; f++)ft.push({ num: i.MobileNumbers[f], info: '"' + i.MobileNumbers[f] + '","' + e + '","' + new Date + '","@@response@@"' }); return i } function ii(n) { var i = !0, t, r; if (n.indexOf("(") > -1 && (n = n.substring(0, n.toString().indexOf("("))), n.length < 10 || n.length > 17) i = !1; else { for (r = n.length, t = 0; t < r; t++)isNaN(n[t]) && (/\s+$/.test(n[t]) || n[t] != "(" && n[t] != ")" && (i = !1)); n.indexOf("(") > -1 && !n.indexOf(")") > -1 && (i = !1) } return i } function ki() { e.height(vt); e.width(st); var n = 0; e.find(".contentArea").css("height", e.height() - 42); e.find(".vis-sms-leftDiv").height(e.height() - 42); e.find(".vis-sms-textarea-div").css("margin-top", "10px"); e.find(".vis-sms-rytBcc").height(e.find(".vis-sms-rytContent").height() - 10); w ? (e.find(".vis-sms-leftDiv").hide(), e.find(".vis-sms-rytWrap").hide(), e.find(".vis-sms-textarea-div").height(e.height() - 150), e.find(".vis-sms-leftWrap").css("width", "100%"), n = e.width() - 40, k.prop("checked", !1), k.hide()) : (e.find(".vis-sms-textarea-div").height(e.height() - 150), n = st - (e.find(".vis-sms-leftDiv").width() + 30), e.find(".vis-sms-leftWrap").width(n - 345)); b = e.find(".vis-sms-ContentWrap"); b.css("width", n) } this.frame = null; this.windowNo = n.Env.getWindowNo(); var ri = n.Env.getCtx(), d = null, w = !1, g = "VAB_BUSINESSPARTNER_ID", o = null, l = null, at = 0, ft = [], s = this, vt = 0, st = 0, p = null, e = t('<div class="vis-sms-rootDiv vis-forms-container"><\/div>'), ht = t('<div class="vis-awindow-header vis-menuTitle">'), a = null, b = null, et = null, nt = null, h = null, v = null, c = null, p = null, rt, ut, ot, it, tt, yt = !1, y, pt = null, k = null; ui(); this.initializeComponent = function () { var i = t('<a href="javascript:void(0)"  class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/a>'), u = ""; u = w ? t("<p>" + n.Msg.getMsg("Sms") + " (" + n.Msg.getMsg("Contacts") + ") <\/p>") : t("<p>" + n.Msg.getMsg("Sms") + " (" + r.aPanel.$parentWindow.getName() + ") <\/p>"); e.append(ht.append(i).append(u)); e.append(y); i.click(function (n) { s.dispose(); s = null; n.stopPropagation() }); fi(); oi(); w || (ei(), wt(!1)); hi() }; this.disposeComponent = function () { it.off("click"); w || (nt.off("click"), p.children("li").off("click"), p.remove(), nt.remove()); k.off("click"); tt != undefined && (tt.off("click"), tt.remove()); h.off("keyup"); e.find(".vis-sms-CcBcc").off("click"); ri = null; d = null; w = !1; g = ""; o = null; l = null; at = 0; p = null; e.remove(); e = null; a.remove(); a = null; b.remove(); b = null; et.remove(); et = null; nt = null; v.remove(); v = null; c.remove(); c = null; p != null && p.remove(); p = null; it.remove(); it = null; tt = null; s = null }; this.show = function () { d = new n.ChildDialog; d.setHeight(800); d.setWidth(1600); d.setTitle(n.Msg.getMsg("Sms")); d.setModal(!0); d.show(); e = t('<div class="vis-sms-rootDiv"><\/div>'); d.setContent(e); initializeComponent() }; this.getRoot = function () { return e }; this.sizeChanged = function (n, t) { vt = n; st = t; yt == !0 && ki() } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; t.hideHeader(!0); this.initializeComponent(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Sms = i }(VIS, jQuery), function (n, t) { function f(n, i, u) { var f = null; return t.ajax({ url: r, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; u && u(n) }), f } function e(i, r, f, e, o, s) { var a = 232, c = "", l = null, h = null; this.getRequests = function () { for (var e = u("VIS_72", null), h, l, a, o, i; e.read();)if (parseInt(e.getString(0)) == 0) { n.ADialog.error("VIS_NotSupported"); return } for (c = "(VAF_TableView_ID=" + r + " AND Record_ID=" + f + ")", r == 114 ? c += " OR VAF_UserContact_ID=" + f + " OR SalesRep_ID=" + f : r == 291 ? c += " OR VAB_BusinessPartner_ID=" + f : r == 259 ? c += " OR VAB_Order_ID=" + f : r == 318 ? c += " OR VAB_Invoice_ID=" + f : r == 335 ? c += " OR VAB_Payment_ID=" + f : r == 208 ? c += " OR VAM_Product_ID=" + f : r == 203 ? c += " OR VAB_Project_ID=" + f : r == 539 && (c += " OR VAA_Asset_ID=" + f), e = null, t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetProcessedRequest", data: { VAF_TableView_ID: r, Record_ID: f }, success: function (t) { e = (new n.DB.DataReader).toJson(t) } }), h = 0, l = 0; e.read();)"Y" == e.getString(0) ? h = e.getString(1) : l += e.getString(1); a = t("<div>"); o = t("<ul class=vis-apanel-rb-ul>"); a.append(o); i = t("<li data-id='RequestCreate'>"); i.append(n.Msg.getMsg("RequestNew")); i.on("click", function (n) { v(n) }); if (o.append(i), l > 0) { i = t("<li data-id='RequestActive'>"); i.append(n.Msg.getMsg("RequestActive")); i.on("click", function (n) { y(n) }); o.append(i) } if (h > 0) { i = t("<li data-id='RequestActive'>"); i.append(n.Msg.getMsg("RequestAll")); i.on("click", function (n) { p(n) }); o.append(i) } s.w2overlay(a.clone(!0), { css: { height: "200px" } }) }; var v = function (i) { i.stopImmediatePropagation(); l = n.viewManager.startWindow(a, null); l.onLoad = function () { var n = l.cPanel.curGC; n.onRowInserting = function () { l.cPanel.cmd_new(!1) }; n.onRowInserted = function () { h = l.cPanel.curTab; h.setValue("VAF_TableView_ID", r); h.setValue("Record_ID", f); e != null && e > 0 && h.setValue("VAB_BusinessPartner_ID", e); r == 291 ? h.setValue("VAB_BusinessPartner_ID", f) : r == 114 ? h.setValue("VAF_UserContact_ID", f) : r == 203 ? h.setValue("VAB_Project_ID", f) : r == 539 ? h.setValue("VAA_Asset_ID", f) : r == 259 ? h.setValue("VAB_Order_ID", f) : r == 318 ? h.setValue("VAB_Invoice_ID", f) : r == 208 ? h.setValue("VAM_Product_ID", f) : r == 335 ? h.setValue("VAB_Payment_ID", f) : r == 319 && h.setValue("VAM_Inv_InOut_ID", f) } }; var u = t("#w2ui-overlay"); u.hide(); u = null }, y = function (i) { var r, u; i.stopImmediatePropagation(); r = new n.Query; r.addRestriction("(" + c + ") AND Processed='N'"); n.viewManager.startWindow(a, r); u = t("#w2ui-overlay"); u.hide(); u = null }, p = function (i) { var r, u; i.stopImmediatePropagation(); r = new n.Query; r.addRestriction(c); n.viewManager.startWindow(a, r); u = t("#w2ui-overlay"); u.hide(); u = null } } var i = n.Application.contextUrl, r = i + "JsonData/JDataSetWithCode", u = function (t, i, r) { var o = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, f(e, o, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; n.ARequest = e }(VIS, jQuery), function (n, t) { function i() { var c = n.Application.contextFullUrl, a, i; if (c || (c = n.Application.contextUrl), c && c.toString().toLowerCase().indexOf("softwareonthecloud.com") > -1) { n.ADialog.info("VIS_GotoControlPanel", !0, "", ""); return } var l = t("<div class='vis-forms-container' style='height:100%'>"), et = t("<div class='vis-its-main-wrap vis-pull-left'>"), ut = t("<div style='height:100%'>"); l.append(ut); ut.append(et); a = t("<div class='vis-its-ryt-panel vis-pull-right' >"); i = t("<div class='vis-its-ryt-panel-inner vis-pull-left' >"); ut.append(a); a.append(i); i.append(t("<h3>").append(n.Msg.getMsg("Result"))); var r = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), pt = n.Env.getWindowNo(), v = null, y = null, p = null, w = null, f = null, e = null, b = null, o = null, k = null, d = null, g = null, nt = null, tt = null, s = null, st = null, it = null, rt = null, ft = null, u = null, h = null, ot = null; this.load = function () { var ri = t("<div class='vis-graywrap'>"), i, ui, a, fi, ut, ei, ft, oi, st, si, yt, hi, pt, ci, wt, li, bt, ai, u, kt, dt, gt, ni, ti, c, ii; et.append(ri); i = t("<div class='initial-client-form'>"); ri.append(i); i.append(t("<h3 class='VIS_Pref_change-pass'>").append(t("<label class='VIS_Pref_Label_Font'>").append(n.Msg.getMsg("TenantHeaderComment")))); ui = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); a = t("<div class='vis-control-wrap'><\/div>"); v = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("Tenant") + '">'); ui.append(a); a.append(v); a.append(t("<label>").append(n.Msg.translate(n.context, "VAF_Client_ID"))); i.append(ui); fi = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); ut = t("<div class='vis-control-wrap'><\/div>"); y = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("Org") + '">'); fi.append(ut); ut.append(y); ut.append(t("<label>").append(n.Msg.translate(n.context, "VAF_Org_ID"))); i.append(fi); ei = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); ft = t("<div class='vis-control-wrap'><\/div>"); p = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("TenantAdmin") + '">'); ei.append(ft); ft.append(p); ft.append(t("<label>").append(n.Msg.parseTranslation(n.context, "@VAF_UserContact_ID@ @VAF_Client_ID@"))); i.append(ei); oi = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); st = t("<div class='vis-control-wrap'><\/div>"); w = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("TenantUser") + '">'); oi.append(st); st.append(w); st.append(t("<label>").append(n.Msg.parseTranslation(n.context, "@VAF_UserContact_ID@ @VAF_Org_ID@"))); i.append(oi); si = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo'>"); yt = t("<div class='vis-control-wrap'><\/div>"); f = t('<select placeholder="Currency">'); si.append(yt); yt.append(f); yt.append(t("<label>").append(n.Msg.translate(n.context, "VAB_Currency_ID"))); i.append(si); hi = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo'>"); pt = t("<div class='vis-control-wrap'><\/div>"); e = t('<select placeholder="Country">'); hi.append(pt); pt.append(e); pt.append(t("<label>").append(n.Msg.translate(n.context, "VAB_Country_ID"))); i.append(hi); ci = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo'>"); wt = t("<div class='vis-control-wrap'><\/div>"); b = t('<input type="text" placeholder="' + n.Msg.getMsg("City") + '" style="width:100%;">'); ci.append(wt); wt.append(b); wt.append(t("<label>").append(n.Msg.translate(n.context, "City"))); i.append(ci); li = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo' >"); bt = t("<div class='vis-control-wrap'><\/div>"); o = t('<select placeholder="Region">'); bt.append(o); bt.append(t("<label>").append(n.Msg.translate(n.context, "VAB_RegionState_ID"))); li.append(bt); i.append(li); i.append(t('<div style="width:100%;float:left;">').append(t("<label  class='vis-cs-op-lbl' class='vis-pull-left'>").append(n.Msg.getMsg("Optional")))); ai = t('<div class="vis-fieldset-wrap">'); u = t("<div class='vis-intial-form-data vis-fieldset-inn'>"); ai.append(u); i.append(ai); kt = t('<div class="vis-initial-form-checkbox" >'); k = t('<input type="checkbox">'); kt.append(k); kt.append(t("<label>").append(n.Msg.translate(n.context, "VAB_Project_ID"))); u.append(kt); dt = t('<div class="vis-initial-form-checkbox">'); d = t('<input type="checkbox">'); dt.append(d); dt.append(t("<label>").append(n.Msg.translate(n.context, "VAB_SalesRegionState_ID"))); u.append(dt); gt = t('<div class="vis-initial-form-checkbox">'); g = t('<input type="checkbox" checked disabled>'); gt.append(g); gt.append(t("<label>").append(n.Msg.translate(n.context, "VAM_Product_ID"))); u.append(gt); ni = t('<div class="vis-initial-form-checkbox">'); nt = t('<input type="checkbox">'); ni.append(nt); ni.append(t("<label>").append(n.Msg.translate(n.context, "VAB_Promotion_ID"))); u.append(ni); ti = t('<div class="vis-initial-form-checkbox">'); tt = t('<input type="checkbox" checked disabled>'); ti.append(tt); ti.append(t("<label>").append(n.Msg.translate(n.context, "VAB_BusinessPartner_ID"))); u.append(ti); c = t("<div class='vis-initial-btn-left vis-pull-right'>"); ri.append(c); ii = t('<div style="display: inline;">'); c.append(ii); h = t('<input type="checkbox" style="margin-right: 5px;margin-left: 10px;margin-top: 5px;display:none">'); h.prop("checked", !0); h.on("click", function () { h.prop("checked") ? s.css("display", "none") : s.css("display", "initial") }); ii.append(h); ot = t("<label style='margin-right: 10px;font-size: 14px;color: #666;font-weight: normal;display:none'>").append(n.Msg.getMsg("UseDefault")); ii.append(ot); s = t("<a class='vis-initial-btn vis-initial-btn-blue' style='margin-right:10px;display:none;'>").append(n.Msg.getMsg("LoadAccountingValues")); s.on("click", function () { rt.trigger("click") }); c.append(s); rt = t("<input type='file' style='display:none;' accept='.csv*'>"); rt.change(function () { at(this) }); c.append(rt); it = t("<a class='vis-initial-btn' style='margin-right: 15px;'>").append(n.Msg.getMsg("Done")); it.on("click", function () { vt() }); c.append(it); l.append(r); r[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "VSetup/GetInitialData", dataType: "json", error: function () { n.ADialog.error(n.Msg.getMsg("ERRORGettingInitialData")); r[0].style.visibility = "hidden" }, success: function (t) { var i = t.result; if (i == null) { n.ADialog.error(n.Msg.getMsg("ERRORGettingInitialData")); r[0].style.visibility = "hidden"; return } ht(i.currency); ct(i.country); lt(i.region); r[0].style.visibility = "hidden" } }) }; var ht = function (n) { if (n != null) for (var i in n) f.append(t('<option value="' + n[i].ID + '">').append(n[i].Name)) }, ct = function (n) { if (n != null) for (var i in n) e.append(t('<option value="' + n[i].ID + '">').append(n[i].Name)) }, lt = function (n) { if (n != null) for (var i in n) o.append(t('<option value="' + n[i].ID + '">').append(n[i].Name)) }, at = function (t) { u = t.files[0].name; r[0].style.visibility = "visible"; window.setTimeout(function () { ft = Date.now().toString(); var i = new XMLHttpRequest, f = new FormData; f.append("file", t.files[0]); i.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + u + "&folderKey=" + ft, !1); i.send(f); r[0].style.visibility = "hidden" }, 2) }, vt = function () { var l, a, s, c, it, ot, rt, st, ut, ht, et; if (i.empty(), l = v.val(), l == null || l.length == 0 || l.trim().length == 0) { n.ADialog.error("FillTenantName"); return } if (a = y.val(), a == null || a.length == 0 || a.trim().length == 0) { n.ADialog.error("FillOrgName"); return } if (s = p.val(), s == null || s.length == 0 || s.trim().length == 0) { n.ADialog.error("FillUserClient"); return } if (c = w.val(), c == null || c.length == 0 || c.trim().length == 0) { n.ADialog.error("FillUserOrg"); return } if (it = b.val(), it == null || it.length == 0 || it.trim().length == 0) { n.ADialog.error("FillCity"); return } if (ot = f.val(), rt = f.find("option:selected").text(), rt == null || rt.length == 0 || rt.trim().length == 0) { n.ADialog.error("FillCurrency"); return } if (st = e.val(), ut = e.find("option:selected").text(), ut == null || ut.length == 0 || ut.trim().length == 0) { n.ADialog.error("FillCountry"); return } if (ht = o.val(), et = o.find("option:selected").text(), et == null || et.length == 0 || et.trim().length == 0) { n.ADialog.error("FillRegion"); return } if (h.prop("checked")) u = null; else if (u == null || u.length == 0 || u.trim().length == 0) { n.ADialog.error("SelectFile"); return } if (s == c) { n.ADialog.error("UsernameMustBeDifferent"); return } var ct = g.prop("checked"), lt = tt.prop("checked"), at = k.prop("checked"), vt = nt.prop("checked"), pt = d.prop("checked"); r[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "VSetup/InitailizeClientSetup", type: "POST", dataType: "json", data: { clientName: l, orgName: a, userClient: s, userOrg: c, city: it, currencyID: ot, currencyName: rt, countryID: st, countryName: ut, regionID: ht, regionName: et, cfProduct: ct, cfBPartner: lt, cfProject: at, cfMCampaign: vt, cfSRegion: pt, fileName: u, folderKey: ft }, error: function () { n.ADialog.error("ErrorCreatingTenant"); r[0].style.visibility = "hidden" }, success: function (n) { var t = n.result; r[0].style.visibility = "hidden"; yt(t) } }) }, yt = function (r) { r.Log != null && r.Log.trim().length > 0 && (i.append(t('<div style="margin-bottom:10px">').append(" Error - " + r.Log)), i.append(t('<div style="margin-bottom:10px">').append(n.Msg.getMsg("VIS_TenantErrorMsg")))); i.append(t('<div style="margin-bottom:10px">').append(" Tenant Name - " + r.TenantName)); i.append(t('<div style="margin-bottom:10px">').append(" Organization Name - " + r.OrgName)); i.append(t('<div style="margin-bottom:10px">').append(" Admin Role - " + r.AdminRole)); i.append(t('<div style="margin-bottom:10px">').append(" User Role - " + r.UserRole)); i.append(t('<div style="margin-bottom:10px">').append(" Admin Username - " + r.AdminUser)); i.append(t('<div style="margin-bottom:10px">').append(" Admin User Password - " + r.AdminUserPwd)); i.append(t('<div style="margin-bottom:10px">').append(" Org Username - " + r.OrgUser)); i.append(t('<div style="margin-bottom:10px">').append(" Org User Password - " + r.OrgUserPwd)); var u = t('<a href="javascript:void(o)" class="vis-initial-btn vis-initial-btn-blue">').append(t("<i class='vis vis-save'><\/i>")); u.on("click", function () { var n = "", i, u; n += " Tenant Name - " + r.TenantName + "\t\n"; n += " Organization Name - " + r.OrgName + "\t\n"; n += " Admin Role - " + r.AdminRole + "\t\n"; n += " User Role - " + r.UserRole + "\t\n"; n += " Admin Username - " + r.AdminUser + "\t\n"; n += " Admin User Password - " + r.AdminUserPwd + "\t\n"; n += " Org Username - " + r.OrgUser + "\t\n"; n += " Org User Password - " + r.OrgUserPwd + "\t\n"; i = (new Date).toISOString().slice(0, 19).replace(/-/g, ""); u = "data:text/csv;base64," + window.btoa(n); t(this).attr("href", u).attr("download", "file-" + i + ".txt"); divLog.dialog("close"); divLog = null }); a.append(u) }; this.disposeComponent = function () { v = null; y = null; p = null; w = null; f = null; e = null; b = null; o = null; k = null; d = null; g = null; nt = null; tt = null; s = null; st = null; it = null; r = null; l = null }; this.getRoot = function () { return l } } n.Apps = n.Apps || {}; n.Apps.AForms = n.Apps.AForms || {}; i.prototype.sizeChanged = function () { }; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.load(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VSetup = i }(VIS, jQuery), function (n, t) { function i() { function s(o) { e = o; u = e.find("#vis_favScroll"); h(); f = t("#userFav-Tab"); i = t('<ul class="vis-userFavourites-ListMenu">'); i.on("click", function (u) { var f = t(u.target), e; f.data("btn") == "action" ? n.viewManager.startAction(f.data("action"), f.data("id")) : f.data("btn") == "zoom" ? n.viewManager.startActionInNewTab(f.data("action"), f.data("id")) : f.data("btn") == "remove" && (a(f.data("id")), e = t(f).parent().parent(), e.empty(), e.remove(), r(i.find("li").length)) }) } function h() { t.ajax({ url: n.Application.contextUrl + "Home/GetFavouriteNode", dataType: "json", error: function () { alert(n.Msg.getMsg("ERRORGetFavouriteNode")) }, success: function (n) { if (u.empty(), n.result) for (var t = 0, f = n.result.length; t < f; t++)o(n.result[t]); r(i.find("li").length); u.append(i) } }) } function c(n) { o(n); r(i.find("li").length) } function o(r) { var e, u, l, f, c, s; if (i != null) { e = t('<li data-nodeid="' + r.NodeID + '" >'); u = 0; r.Action == "W" ? u = r.WindowID : r.Action == "X" ? u = r.FormID : r.Action == "P" ? u = r.ProcessID : r.Action == "R" && (u = r.ProcessID); var o = t('<a href="#" data-id="' + u + '" data-action="' + r.Action + '" data-nodeid="' + r.NodeID + '" data-btn="action" style="overflow: auto;" >'), h = t('<div class="vis-favboxtopico">'), a = t("<a href='javascript:void(0)' data-id='" + r.NodeID + "'  data-btn='remove' class='vis vis-removefav'>"); h.append(a); l = t("<a href='javascript:void(0)' data-id='" + u + "' data-action='" + r.Action + "' data-btn='zoom' class='vis vis-new-tab'>"); h.append(l); e.append(h); e.append(o); f = r.Name; f.length > 27 ? (f = f.substr(0, 27), o.append(f), c = t("<a href='#' class='VIS_Pref_tooltip' style='display: inline-block;'>").append("..."), s = t("<span style='width: inherit;'>"), s.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), s.append(t("<label class='VIS_Pref_Label_Font'>").append(r.Name)), c.append(s), o.append(c)) : o.append(r.Name); i.append(e) } } function l(n) { var f, u, e, o; if (i != null) { for (f = i.find("li"), u = null, e = 0, o = f.length; e < o; e++)u = t(f[e]), u.data("nodeid") === n && u.remove(); f = u = null; r(i.find("li").length) } } function a(i) { n.FavouriteHelper.removeFavourite(i); t.ajax({ url: n.Application.contextUrl + "Home/RemoveNodeFavourite/?nodeID=" + i, dataType: "json" }) } function r(t) { f.empty(); f.html("<span><i class='vis vis-favourite'><\/i><\/span><span class='favouriteTabLabel-Large'>" + n.Msg.getMsg("Favourites") + " - <\/span><strong>" + t + "<\/strong>") } var e, u, i, f; return { init: s, addFavourite: c, removeFavourite: l } } n.favMgr = i() }(VIS, jQuery), function (n, t) { function h(i, r) { var u = null, f = ""; url = n.Application.contextUrl + "WSP/Contacts/GetBPLocation?WinNo=" + r.windowNo + "&bpartnerID=" + i; t.ajax({ type: "GET", async: !1, url: url, dataType: "json", success: function (n) { u = JSON.parse(n); for (var t = 0; t < u.lstBPLocation.length; t++)f += "<option value='" + u.lstBPLocation[t].ID + "'>" + u.lstBPLocation[t].Name + "<\/option>"; o.empty(); o.append(f) } }) } function c(t, i, r, f, e, o) { u = new n.ChildDialog; u.setContent(t); i == "Customer" ? u.setTitle(n.Msg.getMsg("Customer")) : i == "Employee" ? u.setTitle(n.Msg.getMsg("Employee")) : i == "Vendor" ? u.setTitle(n.Msg.getMsg("Vendor")) : i == "Prospect" && u.setTitle(n.Msg.getMsg("Prospect")); u.setEnableResize(!1); u.setModal(!0); u.show(); l(e, i, o); r.on("change", function () { h(r.val(), f) }) } function l(e, o, s) { u.onOkClick = function () { var l = t("#divBPartner_" + i.windowNo).find("img"), rt = t(window).height() * (50 / 100), ut = t(window).width() * (50 / 100), u; e.css("margin-top", rt); e.css("margin-left", ut); s.show(); l.css("visibility", "visible"); var h = t("#txtName_" + i.windowNo).val(), c = t("#txtSearchKey_" + i.windowNo).val(), a = t("#ddlGreeting1_" + i.windowNo).val(), ft = t("#txtName2_" + i.windowNo).val(), v = t("#ddlBPGroup_" + i.windowNo).val(), y = t("#ddlBPRelation_" + i.windowNo).val(), p = t("#ddlBPLoaction_" + i.windowNo).val(), w = t("#txtContact_" + i.windowNo).val(), b = t("#ddlGreeting_" + i.windowNo).val(), k = t("#txtTitle_" + i.windowNo).val(), d = t("#txtEmail_" + i.windowNo).val(), g = r.getValue(), nt = t("#txtPhone_" + i.windowNo).val(), tt = t("#txtPhone2_" + i.windowNo).val(), it = t("#txtFax_" + i.windowNo).val(); if (h.trim() == "" || c.trim() == "") { n.ADialog.info("NameMandatory"); s.hide(); l.css("visibility", "collapse"); return } u = null; o == "Customer" ? u = n.Msg.getMsg("Customer") : o == "Employee" ? u = n.Msg.getMsg("Employee") : o == "Vendor" ? u = n.Msg.getMsg("Vendor") : o == "Prospect" && (u = n.Msg.getMsg("Prospect")); url = n.Application.contextUrl + "WSP/Contacts/AddBPartnerInfo"; v == "0" && (v = undefined); y == "0" && (y = undefined); p == "0" && (p = undefined); b == "0" && (b = undefined); a == "0" && (a = undefined); g == null && (g = undefined); nt == "" && (nt = undefined); tt == "" && (tt = undefined); w == "" && (w = undefined); h == null && (h = undefined); it == "" && (it = undefined); c == "" && (c = undefined); k == "" && (k = undefined); d == "" && (d = undefined); u == "" && (u = undefined); t.ajax({ type: "Post", async: !1, url: url, dataType: "json", data: { searchKey: c, name: h, name2: ft, greeting: b, bpGroup: v, bpRelation: y, bpLocation: p, contact: w, greeting1: a, title: k, email: d, address: g, phoneNo: nt, phoneNo2: tt, fax: it, windowNo: i.windowNo, BPtype: u }, success: function (n) { s.hide(); l.css("visibility", "collapse"); alert(n); f.empty() } }) } } function a(i, u, o, s, h, l, a) { var y = null, p = "", w = "", b = "", k = "", g = new n.MLocationLookup(n.context.ctx, i.windowNo), nt, d; r = new n.Controls.VLocation("VAB_Address_ID", !0, !1, !0, n.DisplayType.Location, g); nt = r.getBtnCount(); f = t("<div id='divBPartner_" + i.windowNo + "' style='width:auto;height:auto;margin-right:5px'> <img src='/ViennaAdvantageWeb1/Areas/VIS/Images/busy.gif' style=' margin-top: 120px; margin-left: 327px; z-index:9999;position:absolute;visibility:collapse'>"); d = n.Application.contextUrl + "WSP/Contacts/AddBusinessPartner?WinNo=" + i.windowNo + "&UserID=" + u; t.ajax({ type: "GET", async: !1, url: d, dataType: "json", success: function (n) { for (var i = JSON.parse(n), t = 0; t < i.lstGreeting.length; t++)p += "<option value='" + i.lstGreeting[t].ID + "'>" + i.lstGreeting[t].Name + "<\/option>"; for (t = 0; t < i.lstBPGroup.length; t++)w += "<option value='" + i.lstBPGroup[t].ID + "'>" + i.lstBPGroup[t].Name + "<\/option>"; for (t = 0; t < i.lstBPRelation.length; t++)b += "<option value='" + i.lstBPRelation[t].ID + "'>" + i.lstBPRelation[t].Name + "<\/option>"; for (t = 0; t < i.lstBPLocation.length; t++)k += "<option value='" + i.lstBPLocation[t].ID + "'>" + i.lstBPLocation[t].Name + "<\/option>"; y = v(p, w, k, b, o, s) } }); f.append(y); f.load(); c(f, h, e, i, l, a) } function v(u, f, c, l, a, v) { var y = t("<table id='tableBPartner_" + i.windowNo + "'><tr><td><div style='margin-top: 0px; float: right' class='wsp-BPartner'>" + n.Msg.getMsg("SearchKey") + " <\/div><\/td><td style='width:300px'><div style='margin-top: 0px;width:100%' class='wsp-BPartner'><input id='txtSearchKey_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><td style='width:50px'><\/td> <td style='margin-left:10px'><div style='margin-top: 0px; float: right;margin-right: 5px' class='wsp-BPartner'>" + n.Msg.getMsg("Greeting") + "  <\/div><\/td><td style='width:300px'><div style='margin-top: 0px;margin-right:5px' class='wsp-BPartner'><select id='ddlGreeting1_" + i.windowNo + "' style='width:100%'>" + u + "<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Name") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtName_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Name2") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtName2_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><td style='width:50px'> <\/td> <td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("BPGroup") + "  <\/div><\/td><td style='width:300px'><div style='margin-right: 5px' class='wsp-BPartner'><select id='ddlBPGroup_" + i.windowNo + "' style='width: 100%'>" + f + "<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("BPRelation") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><select style='width:100%' id='ddlBPRelation_" + i.windowNo + "' >" + l + "<\/select><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("BPLoaction") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><select id='ddlBPLoaction_" + i.windowNo + "' style='width:100%'><\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Contact") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtContact_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Greeting") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><select id='ddlGreeting_" + i.windowNo + "' style='width: 100%'>" + u + "<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Title") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtTitle_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("EmailAddress") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><input id='txtEmail_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Address") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' id='divAddress_" + i.windowNo + "' class='wsp-BPartner' ><\/div> <\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Phone") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><input id='txtPhone_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("2ndPhone") + "  <\/div><\/td><td style='width:300px'><div class='wsp-BPartner' style='width:100%;'><input id='txtPhone2_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Fax") + "  <\/div><\/td><td style='width:300px' ><div style='margin-bottom:7px;margin-right: 5px' class='wsp-BPartner' ><input id='txtFax_" + i.windowNo + "' style='height: 25px;width:100%;' type='text'><\/div><\/td><\/tr><\/table>"), p = y.find("#divAddress_" + i.windowNo); return y.find("#ddlBPRelation_" + i.windowNo).val(a), e = y.find("#ddlBPRelation_" + i.windowNo), o = y.find("#ddlBPLoaction_" + i.windowNo), s = y.find("#ddlBPGroup_" + i.windowNo).val(v), h(a, i), r.getBtn(0).css("width", "10%"), r.getBtn(0).css("height", "10%"), r.getBtn(0).css("padding", "0px"), r.getBtn(1).css("width", "10%"), r.getBtn(1).css("height", "10%"), r.getBtn(1).css("padding", "0px"), p.append(r.getControl().css("width", "80%")).append(r.getBtn(0)).append(r.getBtn(1)), y } var u = null, f = null, i = null, r = null, e = null, o = null, s = null; n.BPartner = function (n, t, r, u, e, o, s) { f != null && f.empty(); i = n; a(i, t, r, u, e, o, s) }; n.AddUpdateBPartner = function (i, h, c, l, a, v) { function ti(n, t, i) { ii(n, t, i) } function ii(i, e, o) { var s = null, h = "", c = "", l = "", v = "", p = new n.MLocationLookup(n.context.ctx, i), w, a; r = new n.Controls.VLocation("VAB_Address_ID", !0, !1, !0, n.DisplayType.Location, p); w = r.getBtnCount(); f = t("<div id='divBPartner_" + i + "' style='width:auto;height:auto;margin-right:5px'> <img src='/ViennaAdvantageWeb1/Areas/VIS/Images/busy.gif' style=' margin-top: 120px; margin-left: 327px; z-index:9999;position:absolute;visibility:collapse'>"); ei(f, i, e, o); a = n.Application.contextUrl + "BPartner/InitBP?WinNo=" + i + "&bPartnerID=" + e + "&bpType=" + o; t.ajax({ type: "GET", async: !1, url: a, dataType: "json", success: function (t) { for (var u = JSON.parse(t), r = 0; r < u.lstGreeting.length; r++)h += "<option value='" + u.lstGreeting[r].ID + "'>" + n.Utility.encodeText(u.lstGreeting[r].Name) + "<\/option>"; for (r = 0; r < u.lstBPGroup.length; r++)c += "<option value='" + u.lstBPGroup[r].ID + "'>" + n.Utility.encodeText(u.lstBPGroup[r].Name) + "<\/option>"; for (r = 0; r < u.lstBPRelation.length; r++)l += "<option value='" + u.lstBPRelation[r].ID + "'>" + n.Utility.encodeText(u.lstBPRelation[r].Name) + "<\/option>"; s = ri(i, e, o, u, h, c, v, l) } }); window.setTimeout(function () { u != null && (f.append(s), f.load(), t(".vis-apanel-busy").css("visibility", "hidden"), t(".vis-apanel-busy").css("height", "460px"), t(".vis-apanel-busy").css("z-index", "99"), y != null && y.hide()) }, 500) } function ri(i, u, f, h, c, l) { var a = t("<DIV class='vis-MainDivBPartnerPopUp'><DIV class='vis-DivBPartnerLeft' ><DIV class='vis-FirstDivBPartnerPopUp' > <\/DIV>" + kt("50%", "Phone Number", 5) + kt("50%", "Internet", 100) + "<DIV class='vis-SecondDivBPartnerPopUp'> <\/DIV>" + kt("100%", "Address", 5) + "<DIV class='vis-ThirdDivBPartnerPopUp'> <\/DIV> <\/DIV><DIV class='vis-FourthDivBPartnerPopUp'> <\/DIV> <\/DIV>"), v; a.find(".vis-FirstDivBPartnerPopUp").append("<DIV class='vis-FirstDivCotrol' ><\/DIV>"); a.find(".vis-FirstDivBPartnerPopUp").append("<DIV class='vis-DivBPartnerRight' > <\/DIV>"); a.find(".vis-SecondDivBPartnerPopUp").append("<DIV class='vis-SecondDivCotrol' ><\/DIV> "); a.find(".vis-SecondDivBPartnerPopUp").append("<DIV class='vis-SecondDivImgCotrol'><\/DIV> "); a.find(".vis-ThirdDivBPartnerPopUp").append("<DIV class='vis-ThirdDivCotrol' ><\/DIV>"); a.find(".vis-FourthDivBPartnerPopUp").append("<DIV class='vis-FourthDivHeader' > " + n.Msg.getMsg("BPType") + " <\/DIV> <DIV class='vis-FourthDivControl'><\/DIV>"); a.find(".vis-DivBPartnerRight").append("<div class='image-upload' style='float: right; position: absolute; z-index: 999; top:40px;overflow:hidden;right:20px'><label for='file-input' class='vis-file-label-bp'><span style='margin-right:8px' class='vis-change-picture-ico vis vis-pencil'><\/span><\/label><input type='file' id='VISFileDialog_" + i + "' accept='image/*' class='wsp-file-input' value='Add Pic' style='opacity: 0; width: 100%; margin-top: 0px; float: right; z-index: 999; position: absolute; right: 0px; cursor: pointer;'><\/div>"); a.find(".vis-DivBPartnerRight").append("<DIV class='vis-FirstDivImgCotrol'><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("SearchKeyValue") + "  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory'  id='txtSearchKey_" + i + "' style='height: 25px;width:100%' type='text'><\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Greeting") + "  <\/div> <div class='vis-all-control'><select id='ddlGreeting_" + i + "' style='width: 100%'>" + c + "<\/select><\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("ContactName") + "  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory' id='txtContact_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("CompanyName") + "  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory' id='txtName_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("BusinessPartnerGroup") + "  <\/div> <div class='vis-all-control'><select class='vis-gc-vpanel-table-mandatory' id='ddlBPGroup_" + i + "' style='width: 100%;float:left'>" + l + "<\/select> <\/div><\/DIV>"); a.find(".vis-FirstDivImgCotrol").append("<DIV class='vis-FirstDivCotrolChild' >  <div style='float: left;width:100%;height:242px;line-height:236px;background: none repeat scroll 0% 0% #EEE;padding:0px;text-align:center;margin-top:20px' ><img id='imgBPartner_" + i + "' /><\/div> "); a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Phone") + "  <\/div> <div class='vis-all-control'><input id='txtPhone_" + i + "' style='height: 25px;width:100%' type='text'><\/div><\/DIV>"); a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Mobile") + "  <\/div> <div class='vis-all-control'><input id='txtMobile_" + i + "' style='height: 25px;width:100%' type='text'><\/div><\/DIV>"); a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Fax") + "  <\/div> <div class='vis-all-control'><input id='txtFax_" + i + "' style='height: 25px;width:100%;' type='text'> <\/div><\/DIV>"); a.find(".vis-SecondDivImgCotrol").append("<DIV class='vis-SecondDivCotrolChild' > <div class='vis-all-lable'>" + n.Msg.getMsg("EmailAddress") + "  <\/div> <div class='vis-all-control'><input id='txtEmail_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-SecondDivImgCotrol").append("<DIV class='vis-SecondDivCotrolChild' > <div class='vis-all-lable'>" + n.Msg.getMsg("WebUrl") + "  <\/div> <div class='vis-all-control'><input id='txtWebUrl_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-ThirdDivCotrol").append("<DIV class='vis-ThirdDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Address") + "  <\/div> <div id='divAddress_" + i + "' class='vis-all-control'><\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkCustomer_" + i + "' type='checkbox'> " + n.Msg.getMsg("Customer") + "<\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkVendor_" + i + "' type='checkbox'>  " + n.Msg.getMsg("Vendor") + " <\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkProspect_" + i + "' type='checkbox'> " + n.Msg.getMsg("Prospect") + "<\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkEmployee_" + i + "' type='checkbox'> " + n.Msg.getMsg("Employee") + "<\/div><\/DIV>"); v = a.find("#divAddress_" + i); e = a.find("#ddlBPRelation_" + i); o = a.find("#ddlBPLoaction_" + i); s = a.find("#ddlBPGroup_" + i); p = a.find("#txtName_" + i); w = a.find("#txtSearchKey_" + i); d = a.find("#ddlGreeting1_" + i); st = a.find("#txtName2_" + i); b = a.find("#txtContact_" + i); k = a.find("#ddlGreeting_" + i); g = a.find("#txtTitle_" + i); tt = a.find("#txtEmail_" + i); nt = a.find("#txtPhone_" + i); ht = a.find("#txtPhone2_" + i); it = a.find("#txtFax_" + i); ft = a.find("#chkCustomer_" + i); et = a.find("#chkVendor_" + i); vt = a.find("#chkProspect_" + i); ot = a.find("#chkEmployee_" + i); r.setValue(h.location); yt = a.find("#VISFileDialog_" + i); pt = a.find("#imgBPartner_" + i); wt = a.find("#txtMobile_" + i); bt = a.find("#txtWebUrl_" + i); ui(); u > 0 ? (e.val(h.bpRelationID), s.val(h.bpGroupID), o.val(h.bpLocationID), p.val(n.Utility.decodeText(h.name)), w.val(n.Utility.decodeText(h.searchKey)), d.val(), st.val(n.Utility.decodeText(h.name2)), pt.removeAttr("src").attr("src", h.userImage), b.val(n.Utility.decodeText(h.contact)), k.val(), g.val(n.Utility.decodeText(h.title)), tt.val(n.Utility.decodeText(h.email)), nt.val(n.Utility.decodeText(h.phoneNo)), ht.val(n.Utility.decodeText(h.phoneNo2)), it.val(n.Utility.decodeText(h.fax)), k.val(h.greeting), d.val(h.greeting1), r.setValue(h.location), wt.val(h.mobile), bt.val(h.WebUrl), h.isCustomer && ft.attr("checked", "checked"), h.isVendor && et.attr("checked", "checked"), h.isEmployee && ot.attr("checked", "checked"), dt(e.val(), i, h.bpLocationID)) : lt > 0 && at > 0 && (a.find("#ddlBPRelation_" + i).val(lt), a.find("#ddlBPGroup_" + i).val(at), dt(e.val(), i, h.bpLocationID)); r.getBtn(0).css("width", "10%"); r.getBtn(0).css("height", "30px"); r.getBtn(0).css("padding", "0px"); r.getBtn(1).css("width", "10%"); r.getBtn(1).css("height", "30px"); r.getBtn(1).css("padding", "0px"); v.append(r.getControl().css("width", "80%")).append(r.getBtn(0)).append(r.getBtn(1)); rt = a.find("#divAddress_" + i).find("Input"); ct = a.find("#divAddress_" + i).find("Button").eq(1); oi(i, f, u); e.on("change", function () { dt(e.val(), i) }); w.on("focusout", function () { w.val() == "" ? t("#divSearchKey").css("visibility", "visible") : t("#divSearchKey").css("visibility", "collapse ") }); p.on("focusout", function () { p.val() == "" ? t("#divName").css("visibility", "visible") : t("#divName").css("visibility", "collapse") }); s.on("focusout", function () { s.val() == "0" || s.val() == "" ? t("#divBPGroup").css("visibility", "visible") : t("#divBPGroup").css("visibility", "collapse ") }); rt.on("focusout", function () { r.getValue() <= 0 ? t("#divAddressValidate_" + i).css("visibility", "visible") : t("#divAddressValidate_" + i).css("visibility", "collapse ") }); ct.on("focusout", function () { r.getValue() <= 0 ? t("#divAddressValidate_" + i).css("visibility", "visible") : t("#divAddressValidate_" + i).css("visibility", "collapse ") }); b.on("focusout", function () { b.val() == "" ? t("#divContact_" + i).css("visibility", "visible") : t("#divContact_" + i).css("visibility", "collapse") }); return a } function kt(n, t, i) { return "<DIV class='vis-BPsplitter' style='width:" + n + "'><span style='background-color: white; position: relative;top: -0.8em;margin-left: " + i + "px;'> " + t + " <\/span><\/DIV>" } function ui() { yt.on("change", function () { ni = Date.now().toString(); var t = new XMLHttpRequest, i = new FormData; i.append("file", yt[0].files[0]); i.append("fileKey", ni); t.open("POST", n.Application.contextUrl + "BPartner/SaveImageAsByte", !0); t.setRequestHeader("Cache-Control", "no-cache"); t.setRequestHeader("Pragma", "no-cache"); t.send(i); t.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i), t = JSON.parse(r); pt.removeAttr("src").attr("src", "data:image/jpg;base64," + t[0]); gt = t[1] }, !1) }) } function fi() { w.off("focusout"); p.off("focusout"); s.off("focusout"); rt.off("focusout"); ct.off("focusout"); b.off("focusout"); r.dispose(); r = null; p = null; st = null; rt = null; b = null; tt = null; it = null; k = null; d = null; nt = null; ht = null; w = null; g = null; c = null; f.remove(); f.empty() } function ei(i) { u = new n.ChildDialog; u.setContent(i); u.onClose = function () { fi() }; var r = t(window).width(); r >= 1366 ? (u.setHeight(620), u.setWidth(870)) : (u.setHeight(520), u.setWidth(670)); u.setTitle(n.Msg.getMsg("BusinessPartner")); u.setEnableResize(!1); u.setModal(!0); u.show(); u.getRoot().dialog({ position: [200, 130] }) } function oi(i, f, h) { u.onOkClick = function () { var l, a, u; if (y != null ? (y.show(), l = t(window).height() * (50 / 100), a = t(window).width() * (50 / 100)) : t(".vis-apanel-busy").css("visibility", "visible"), ut = r.getValue(), w.val().trim() == "") return n.ADialog.info("SearchKeyMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (p.val().trim() == "") return n.ADialog.info("NameMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (s.val().trim() == "0") return n.ADialog.info("BPGroupMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (b.val().trim() == "") return n.ADialog.info("ContactMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (ut <= 0 || ut == null) return n.ADialog.info("AddressMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (ft.is(":checked") == !1 && et.is(":checked") == !1 && vt.is(":checked") == !1 && ot.is(":checked") == !1) return alert(n.Msg.getMsg("PleaseSelectBusinessType")), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; u = null; u = f; url = n.Application.contextUrl + "BPartner/AddBPartnerInfo"; var v = w.val(), rt = p.val(), st = p.val(), c = k.val(), ht = s.val(), ct = e.val(), lt = o.val(), at = b.val(), oi = d.val(), yt = g.val(), pt = tt.val(), kt = nt.val(), dt = nt.val(), ni = it.val(), ti = ft.is(":checked"), ii = et.is(":checked"), ri = vt.is(":checked"), ui = ot.is(":checked"), fi = wt.val(), ei = bt.val(); window.setTimeout(function () { t.ajax({ type: "Post", async: !1, url: url, dataType: "json", data: { VAB_BusinessPartner_ID: h, searchKey: v, name: rt, name2: st, greeting: c, bpGroup: ht, bpRelation: ct, bpLocation: lt, contact: at, greeting1: c, title: yt, email: pt, address: ut, phoneNo: kt, phoneNo2: dt, fax: ni, windowNo: i, BPtype: u, isCustomer: ti, isVendor: ii, isProspect: ri, fileName: gt, mobile: fi, webUrl: ei, isEmployee: ui }, success: function (i) { n.ADialog.info("", "", JSON.parse(i)); y != null && y.hide(); t(".vis-apanel-busy").css("visibility", "hidden") } }) }, 2) } } function dt(i, r, u) { var f = null, e = ""; url = n.Application.contextUrl + "BPartner/GetBPLocation?WinNo=" + r + "&bpartnerID=" + i; t.ajax({ type: "GET", async: !1, url: url, dataType: "json", success: function (t) { f = JSON.parse(t); for (var i = 0; i < f.lstBPLocation.length; i++)e += "<option value='" + f.lstBPLocation[i].ID + "'>" + n.Utility.encodeText(f.lstBPLocation[i].Name) + "<\/option>"; o.empty(); o.append(e); o.val(u) } }) } var p = null, w = null, k = null, st = null, b = null, d = null, g = null, tt = null, nt = null, ht = null, it = null, g = null, rt = null, ct = null, y = null, lt = 0, at = 0, ut = null, ft = null, et = null, vt = null, ot = null, yt = null, gt = null, ni = "", pt = null, wt = null, bt = null; l == null && (t(".vis-apanel-busy").css("visibility", "visible"), t(".vis-apanel-busy").css("z-index", "9999999")); y = l; f != null && f.empty(); lt = a; at = v; ti(i, h, c) } }(VIS, jQuery), function (n, t) { function y() { r = null; f = null; s = null; $mainUserInfo = null; a = 800; c = 1048576; l = 10; r = t(" <div id='mainUserInfoDiv_" + i + "'><div class='vis-view_left_part'><input type='hidden' value='0' id='userID_" + i + "'><\/input> <p id='hduserName_" + i + "' style='display: none;'><\/p>  <p id='userName_" + i + "' class='vis-view_profile_name'><\/p> <a id='dotImg_" + i + "' href='javascript:void(0)' style='display: none;'><\/a><div id='popUpDiv_" + i + "' style='display: none;'><\/div><input type='hidden' value='0' id='BPID_" + i + "'><\/input><input type='hidden' value='0' id='BPGroupID_" + i + "'><\/input><input type='hidden' value='' id='userTableID_" + i + "'><p id='companyName_" + i + "' class='vis-view_profile_possession'><\/p><p class='vis-view_profile_possession' style='border-bottom: 1px solid rgba(var(--v-c-secondary), 1); padding-bottom: 10px;' id='pContactTypeCategory_" + i + "'><\/p><div class='vis-profile_big_img_mobile'><span id='editMobileImage_" + i + "' class='mobilespan' style='width:24px;float:right;'><input type='file' id='vis-fileinput_" + i + "' class='vis-file-input' value='Add Pic' style='opacity: 0; width: 7%; margin-top: -6px; float: left; z-index: 999; position: absolute; cursor: pointer;'><img src='" + n.Application.contextUrl + "Areas/WSP/Images/Edit-icon.png' style='z-index: 100; position: absolute;'><\/span><img id='mobileImg_" + i + "' width='100%' alt='Image is not available' src='Areas/VIS/Images/home/User.png'><\/div><div id='divTeam_" + i + "' class='vis-view_team'><\/div><div id='divContactDetails_" + i + "' class='vis-view_team'><\/div><div id='divcompanyDetails_" + i + "' class='vis-view_team'><\/div><div id='divRole_" + i + "' class='vis-view_team'><\/div><\/div><div class='vis-view_right_part'  style='float:left;width: 55%;' id='WSP_view_right_part_" + i + "'><div id='userBigImg_" + i + "' class='vis-profile_big_img' style='width: 322px;'><div class='vis-image-upload'> <label for='file-input' class='vis-fileupload-label'><i class='vis vis-pencil'><\/i><\/label><input type='file' id='vis-file-input_" + i + "' class='vis-file-input' value='Add Pic' style='opacity: 0; width: 30%; margin-top: 0px; float: right; z-index: 999; position: absolute; right: 0px; cursor: pointer;'><\/div><div class='vis-bigimg'> <i id='bigUserImage_" + i + "' class='vis vis-user'><\/i><\/div><\/div><div class='vis-actionswrp'><table id='actionTable_" + i + "' class='vis-tableRightContent'><tbody><tr style='height:30px'> <td class='vis-tdactionlist'><a id='edit_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'> <i class='vis vis-edit'><\/i><\/span> <p>Edit <\/p> <\/a> <\/td> <td class='vis-tdactionlist'> <a id='sendSMS_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'> <i class='vis vis-sms'><\/i><\/span> <p> Send Sms <\/p> <\/a> <\/td> <\/tr>  <tr style='height:30px'>       <td class='vis-tdactionlist'><a id='email_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon email_icon'>           <i class='vis vis-email'><\/i><\/span>           <p>Email <\/p>       <\/a>       <\/td>       <td class='vis-tdactionlist'><a id='appointment_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'>           <i class='vis vis-appointment'><\/i><\/span>           <p>Appointment <\/p>       <\/a>       <\/td>   <\/tr>   <tr style='height:30px'>       <td class='vis-tdactionlist'><a id='activity_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'>            <i class='vis vis-cog'><\/i><\/span>           <p>Activity<\/p>       <\/a>       <\/td>        <td class='vis-tdactionlist'><a id='createOrder_" + i + "' href='javascript:void(0)' class='vis-tableaction'><span class='vis-left_icon'>           <i class='vis vis-createdocument'><\/i><\/span>           <p>Create Order<\/p>       <\/a>        <\/td>    <\/tr>   <tr style='height:30px'>       <td class='vis-tdactionlist'><a id='BPInfo_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'>           <i class='vis vis-info'><\/i><\/span>           <p>BP Info<\/p>       <\/a>        <\/td>        <td class='vis-tdactionlist'><a id='addBPartner_" + i + "' href='javascript:void(0)' class='vis-tableaction'><span class='vis-left_icon'>           <i class='vis vis-addbp'><\/i><\/span>           <p style=''>Add BPartner <\/p>       <\/a>       <\/td>   <\/tr> <tr style='height:30px'><td class='vis-tdactionlist'><a id='History_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'><i class='vis vis-history'><\/i><\/span><p>" + n.Msg.getMsg("History") + "<\/p><\/a><\/td><\/tr>   <tr>   <\/tr><\/tbody><\/table><\/div><div id='divBirthday_" + i + "' class='vis-birthday_container' style='display: none;'><\/div><\/div><\/div>") } var i = 0, o = t(document).width(), v = t(document).height(), r = null, h = 0, e = null, f = null, s = null, a = null, c = null, l = null, u = null, o = t(document).width(), v = t(document).height(); n.ContactInfo = function (v, p) { for (var w = n.DB.executeReader("SELECT COUNT(*) FROM VAF_TableView WHERE TableName='VAB_BusinessPartner'", null); w.read();)if (parseInt(w.getString(0)) == 0) { n.ADialog.error("VIS_NotSupported"); self.dispose(); return } h = v; i = p; t(".vis-apanel-busy").css("visibility", "visible"); e = n.Application.contextUrl + "WSP/Contacts/UserContactInfo?WinNo=" + i + "&userID=" + h + "&isPartialViewLoad=true"; y(h, e); this.show = function () { if (!window.WSP) { alert("please download WSP !!!"); t(".vis-apanel-busy").css("visibility", "hidden"); return } window.setTimeout(function () { u = new n.ChildDialog; u.setContent(r); u.setWidth(610); u.setTitle(n.Msg.getMsg("ContactInfo")); u.setEnableResize(!1); u.setModal(!0); u.show(); u.getRoot().dialog({ position: [400, 0] }); u.onClose = function () { dispose() }; t.ajax({ type: "GET", async: !1, url: e, dataType: "json", success: function (h) { function ri(i, r, f) { f.stopPropagation(); t.ajax({ type: "GET", async: !1, url: i, dataType: "json", success: function (t) { var i = JSON.parse(t), f = new n.Query; r ? (f.addRestriction("VAB_BusinessPartner_ID", n.Query.prototype.EQUAL, i[1]), n.viewManager.startWindow(i[0], f), k.find("p").removeAttr("style"), u.close()) : (f.addRestriction("VAB_Order_ID", n.Query.prototype.EQUAL, i[1]), win = n.viewManager.startWindow(i[0], f), win.onLoad = function () { var n = win.cPanel.curGC; n.onRowInserting = function () { win.cPanel.cmd_new(!1) }; n.onRowInserted = function () { tab = win.cPanel.curTab; tab.setValue("VAB_BusinessPartner_ID", et.text()) } }, st.find("p").removeAttr("style"), u.close()) } }) } var v = JSON.parse(h), p = "", y, wt, nt, d; v[0].Customer != "" && (p += v[0].Customer); v[0].Vendor != "" && (v[0].Customer != "" && (p += ","), p += v[0].Vendor); v[0].Employee != "" && ((v[0].Customer != "" || v[0].Vendor != "") && (p += ","), p += v[0].Employee); v[0].Prospect != "" && ((v[0].Customer != "" || v[0].Vendor != "" || v[0].Employee != "") && (p += ","), p += v[0].Prospect); var ht = r.find("#divRole_" + i), ct = r.find("#divTeam_" + i), b = r.find("#divContactDetails_" + i), it = r.find("#dotImg_" + i), w = r.find("#userID_" + i), lt = r.find("#userTableID_" + i), rt = r.find("#hduserName_" + i), ft = r.find("#userName_" + i), et = r.find("#BPID_" + i), bt = r.find("#BPGroupID_" + i), ui = r.find("#companyName_" + i), fi = r.find("#pContactTypeCategory_" + i), ai = r.find("#mobileImg_" + i), ur = r.find("#team_" + i), fr = r.find("#teamNotFound_" + i), vi = r.find("#address_" + i), yi = r.find("#country_" + i), pi = r.find("#postal_" + i), wi = r.find("#phone_" + i), bi = r.find("#userEmail_" + i), er = r.find("#emailNotFound_" + i), kt = r.find("#divcompanyDetails_" + i), ei = r.find("#companyNotFound" + i), or = r.find("#role_" + i), ki = r.find("#roleNotFound_" + i), at = r.find("#bigUserImage_" + i), ot = r.find("#divBirthday_" + i), sr = r.find("#userBigImg_" + i), k = r.find("#edit_" + i); s = r.find("#WSP_dots_" + i); var dt = r.find("#sendSMS_" + i), gt = r.find("#email_" + i), g = r.find("#BPInfo_" + i), st = r.find("#createOrder_" + i), vt = r.find("#addBPartner_" + i), di = r.find("#History_" + i), yt = r.find("#appointment_" + i), pt = r.find("#activity_" + i), gi = r.find("#ImportContacts_" + i), tt = r.find("#wsp-file-input_" + i), oi = r.find("#wsp-fileinput_" + i), hr = r.find(".WSP_profile_big_img"), nr = r.find(".WSP_profile_big_img_mobile"), si = null, tr = r.find("#mainUserInfoDiv_" + i), ni = !1, ut = !1, ti = !1, v = JSON.parse(h), hi = "", ii = ""; for (w.empty(), w.append(v[0].UserID), rt.empty(), rt.append(v[0].FirstName), rt.hide(), ft.empty(), it.empty(), p == "" || p == null ? (k.removeAttr("href"), k.css("cursor", "auto"), k.find("p").css("color", "black"), g.removeAttr("href"), g.css("cursor", "auto"), g.find("p").css("color", "black")) : (k.attr("href", "javascript:void(0)"), k.css("cursor", "pointer"), k.removeAttr("style"), g.attr("href", "javascript:void(0)"), g.css("cursor", "pointer"), g.removeAttr("style")), o >= 1e3 && o <= 1024 ? v[0].FirstName.length > 15 ? (it.show(), ft.append(v[0].FirstName.substring(0, 15)).append(it.append("..."))) : ft.append(v[0].FirstName) : v[0].FirstName.length > 20 ? (it.show(), ft.append(v[0].FirstName.substring(0, 20)).append(it.append("..."))) : ft.append(v[0].FirstName), et.empty(), et.append(v[0].BPartnerID), lt.append(v[0].TableID), bt.empty(), bt.append(v[0].BPGroupID), ui.empty(), ui.append(v[0].CompanyName), fi.empty(), fi.append(p), ai.removeAttr("src").attr("src", v[0].Image), ct.empty(), ct.append("<p>" + n.Msg.getMsg("Teams") + "<\/p>"), y = 0; y < v.length; y++)v[y].Team != "" && v[y].Team != null && (ni = !0, ii += y == 0 || ii == "" ? v[y].Team : ", " + v[y].Team); for (ni || ct.append(" <p  id='teamNotFound_" + i + "' style='word-break: break-all; font-style: italic;'>" + n.Msg.getMsg("NotFound") + "<\/p>"), ni && ct.append(" <p id='team_" + i + "' >" + ii + "<\/p>"), vi.empty(), b.empty(), b.append("<p style='word-break: break-all;'> " + n.Msg.getMsg("ContactDetails") + " <a href='javascript:void(0)'> <i id='showAddressOnGoogleMap_" + i + "' class='vis vis-location'><\/i> <\/a><\/p> "), y = 0; y < v.length; y++)v[y].FirstName == "" && v[y].Address != "" && v[y].Address != null && (ut = !0, b.append("<p id='address_" + i + "' style='word-break: break-all'>" + v[y].Address + "<\/p>")); for (yi.empty(), v[0].CountryName != "" && v[0].CountryName != null && (ut = !0, b.append("<p id='country_" + i + "' style='word-break: break-all'>" + v[0].City + "(" + v[0].CountryName + ")<\/p> ")), pi.empty(), v[0].Postal != "" && v[0].Postal != null && (ut = !0, b.append("<p id='postal_" + i + "' style='word-break: break-all'>" + n.Msg.getMsg("ZipCode") + ": " + v[0].Postal + "<\/p>")), wi.empty(), y = 0; y < v.length; y++)v[y].FirstName == "" && v[y].PhoneNo != "" && v[y].PhoneNo != null && (ut = !0, o <= 1024 ? b.append("<a href='tel:" + v[y].PhoneNo + "'><p id='phone_" + i + "' style='word-break: break-all'><span class='vis-caller'><i class='fa fa-phone'><\/i><\/span>" + v[y].PhoneNo + "<\/p><\/a>") : b.append("<p id='phone_" + i + "' style='word-break: break-all'><span class='vis-caller'><i class='fa fa-phone'><\/i><\/span>" + v[y].PhoneNo + "<\/p>")); for (bi.empty(), v[0].Email != "" && v[0].Email != null && (ut = !0, b.append("<p id='userEmail_" + i + "' style='word-break: break-all;display: inline-flex;margin-top: 0;'> <span class='vis-caller'><i class='vis vis-email'><\/i><\/span>" + v[0].Email + "<\/p>")), !ut, kt.empty(), kt.append("<p>" + n.Msg.getMsg("Company") + "<\/p>"), kt.append("<p id='companyDetails_" + i + "' style='word-break: break-all'>" + v[0].CompanyName + "<\/p>"), ei.empty(), v[0].CompanyName != "" && v[0].CompanyName != null && ei.append(n.Msg.getMsg("NotFound")), ht.empty(), ht.append("<p>" + n.Msg.getMsg("RoleAssign") + "<\/p>"), y = 0; y < v.length; y++)v[y].Role != "" && v[y].Role != null && (ti = !0, hi += y == 0 ? v[y].Role : ", " + v[y].Role); ti && ht.append("<p id='role_" + i + "'>" + hi + "<\/p>"); ki.empty(); ti || ht.append("<p id='roleNotFound_" + i + "' style='word-break: break-all; font-style: italic;'>" + n.Msg.getMsg("NotFound") + "<\/p>"); v[0].Image.indexOf("User") > 0 ? at.removeAttr("src").attr("src", n.Application.contextUrl + "Areas/VIS/Images/home/User.png") : at.removeAttr("src").attr("src", v[0].Image); ot.empty(); var ci = new Date, li = new Date(v[0].Birthday), ir = ci.getMonth() + 1 + "/" + ci.getDate(), rr = li.getMonth() + 1 + "/" + li.getDate(); v[0].Birthday != "" ? (ot.show(), ot.css("border", "1px solid #1886BF"), wt = t("<div class='vis-birthdat_text'>"), rr == ir && wt.append("<p> " + n.Msg.getMsg("Today") + " " + n.Msg.getMsg("is") + " <span class='vis-birthday_text_highlight'>" + v[0].FirstName + "<\/span> " + n.Msg.getMsg("Birthday") + "<\/p>"), wt.append("<p>" + v[0].FirstName + " " + n.Msg.getMsg("Birthday") + " " + n.Msg.getMsg("on") + "  <span class='vis-birthday_text_highlight'>" + v[0].Birthday + "<\/span><\/p> <\/div>"), ot.append(wt)) : ot.hide(); it.on("click", function (n) { $popUp.show(); var t = r.find("<div class='arrow_box'> <p style='margin-left:5px;margin-top:5px;margin-right:5px'>" + rt.text() + "<\/p><\/div>"); $popUp.append(t); $popUp.delay(2e3).fadeOut(); n.stopPropagation() }); if (s != null) s.on("click", function (n) { tr.animate({ right: "-1000px" }, a); n.stopPropagation() }); t(".ui-dialog-content").on("click", function (n) { t("#w2ui-overlay").hide(); n.stopPropagation() }); nt = t("<ul id='ulEditOption' class='vis-apanel-rb-ul'>"); d = t("<ul id='ulCreateOrder' class='vis-apanel-rb-ul'>"); k.on("click", function (r) { var u, h, e; if (p == "" || p == null) return r.preventDefault(), !1; k.find("p").css("background-color", "#e0e0e0"); r.stopPropagation(); var o = w.text(), s = p.split(","); if (s.length > 1) { for (t("#w2ui-overlay").show(), nt != null && nt.empty(), u = t("<div/>"), u.css("width", "auto"), u.css("height", "100%"), nt.css("width", "auto"), nt.css("height", "100%"), h = "", e = 0; e < s.length; e++)h += "<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' id='" + s[e].trim() + "_" + i + "'>" + n.Msg.getMsg(s[e].trim()) + "<\/li>"; nt.append(h); u.append(nt); k.w2overlay(u.clone(!0), { css: { height: "300px" } }); u.css("top", "395px"); nt.load() } else p == n.Msg.getMsg("Employee") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Employee Master&userID=" + o), p == n.Msg.getMsg("Customer") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Customer Master&userID=" + o), p == n.Msg.getMsg("Vendor") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Vendor Master&userID=" + o), p == n.Msg.getMsg("Prospect") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Prospects&userID=" + o), ri(f, !0, r) }); nt.on("click", "LI", function (i) { t("#w2ui-overlay").hide(); var r = t(this).text(); r == n.Msg.getMsg("Employee") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Employee Master&userID=" + w.text()); r == n.Msg.getMsg("Customer") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Customer Master&userID=" + w.text()); r == n.Msg.getMsg("Vendor") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Vendor Master&userID=" + w.text()); r == n.Msg.getMsg("Prospect") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Prospects&userID=" + w.text()); ri(f, !0, i); i.stopPropagation() }); dt.on("click", function (i) { dt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); i.stopPropagation(); window.setTimeout(function () { var r = new n.Sms(null, null, 0, !0), i = new n.CFrame; i.setName(n.Msg.getMsg("Sms")); i.setTitle(n.Msg.getMsg("Sms")); i.hideHeader(!0); i.setContent(r); i.show(); r.initializeComponent(); t(".vis-apanel-busy").css("visibility", "hidden"); u.close() }, 2) }); gt.on("click", function (r) { gt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); r.stopPropagation(); window.setTimeout(function () { var f = new n.Email(t("#userEmail_" + i).text(), null, null, w.text(), !0, !0, lt.text()), r = new n.CFrame; r.setName(n.Msg.getMsg("EMail")); r.setTitle(n.Msg.getMsg("EMail")); r.hideHeader(!0); r.setContent(f); r.show(); f.initializeComponent(); t(".vis-apanel-busy").css("visibility", "hidden"); u.close() }, 2) }); g.on("click", function (i) { if (p == "" || p == null) return i.preventDefault(), !1; g.find("p").css("background-color", "#e0e0e0"); window.setTimeout(function () { var r = w.text(), i = ""; i = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Business Partner Info&userID=" + r; t.ajax({ type: "GET", async: !1, url: i, dataType: "json", success: function (t) { var i = JSON.parse(t), r = new n.Query; r.addRestriction("VAB_BusinessPartner_ID", n.Query.prototype.EQUAL, i[1]); n.viewManager.startWindow(i[0], r); g.find("p").removeAttr("style"); u.close() } }) }, 500) }); st.on("click", function (r) { var u, f; st.find("p").css("background-color", "#e0e0e0"); t("#w2ui-overlay").show(); t("#w2ui-overlay").find("div").empty(); d != null && d.empty(); u = t("<div/>"); u.css("width", "auto"); u.css("height", "100%"); d.css("width", "auto"); d.css("height", "100%"); f = t("<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' id='SaleOrder_" + i + "'>" + n.Msg.getMsg("Sales Order") + "<\/li> <li  style='margin-top:10px;margin-left:10px;margin-right:13px;font-size: 15px' id='PurchaseOrder_" + i + "' >" + n.Msg.getMsg("PurchaseOrder") + "<\/li>"); d.append(f); u.append(d); st.w2overlay(u.clone(!0), { css: { height: "300px" } }); u.css("top", "395px"); r.stopPropagation(); d.load() }); d.on("click", "LI", function (i) { t("#w2ui-overlay").hide(); var r = t(this).text(); e = n.Application.contextUrl + "WSP/Contacts/GetWindowAndOrderID?windowName=" + r + "&userID=" + w.text(); ri(e, !1, i); i.stopPropagation() }); vt.on("click", function (t) { vt.find("p").css("background-color", "#e0e0e0"); t.stopPropagation(); $saleOrder = null; $purchaseOrder = null; n.AddUpdateBPartner(i, 0, p, null, et.text(), bt.text()); vt.find("p").removeAttr("style") }); di.on("click", function () { var t = new n.AttachmentHistory(lt.val(), w.text(), et.text(), 0, "VAF_UserContact_ID"); t.show() }); yt.on("click", function (r) { r.stopPropagation(); yt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); window.setTimeout(function () { n.AppointmentsForm.init(lt.text(), t("#userID_" + i).text(), n.context.getVAF_UserContact_ID(), rt.text(), !1); yt.find("p").removeAttr("style"); t(".vis-apanel-busy").css("visibility", "hidden"); u.close() }, 500) }); gi.on("click", function (n) { n.stopPropagation(); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); window.setTimeout(function () { WSP.importcontacts(self); t(".vis-apanel-busy").css("visibility", "hidden") }, 50) }); pt.on("click", function (r) { r.stopPropagation(); pt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); window.setTimeout(function () { n.AppointmentsForm.init(0, t("#userID_" + i).text(), n.context.getVAF_UserContact_ID(), rt.text(), !0); pt.find("p").removeAttr("style"); t(".vis-apanel-busy").css("visibility", "hidden") }, 500) }); tt.on("change", function () { t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); var f = w.text(), i = new XMLHttpRequest, r = new FormData, u = tt; if (r.append("file", u[0].files[0]), r.append("userID", f), u[0].files[0].size / c > l) { alert(n.Msg.getMsg("UploadedFileSizeLimit")); tt.replaceWith(tt.val("").clone(!0)); return } i.open("POST", n.Application.contextUrl + "WSP/Contacts/SaveImageAsByte", !0); i.setRequestHeader("Cache-Control", "no-cache"); i.setRequestHeader("Pragma", "no-cache"); i.send(r); i.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i); image = JSON.parse(r); at.removeAttr("src").attr("src", "data:image/jpg;base64," + image[1]); t(".vis-apanel-busy").css("visibility", "hidden") }, !1); tt.val("") }); oi.on("change", function () { t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); var f = w.text(), i = new XMLHttpRequest, r = new FormData, u = tt; if (r.append("file", u[0].files[0]), r.append("userID", f), u[0].files[0].size / c > l) { alert(n.Msg.getMsg("UploadedFileSizeLimit")); return } i.open("POST", n.Application.contextUrl + "WSP/Contacts/SaveImageAsByte", !0); i.setRequestHeader("Cache-Control", "no-cache"); i.setRequestHeader("Pragma", "no-cache"); i.send(r); i.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i); image = JSON.parse(r); at.removeAttr("src").attr("src", "data:image/jpg;base64," + image[1]); nr.removeAttr("src").attr("src", "data:image/jpg;base64," + image[1]); t(".vis-apanel-busy").css("visibility", "hidden") }, !1) }); si = b.find("#showAddressOnGoogleMap_" + i); si.on("click", function () { var n = b.find("#address_" + i).text() + b.find("#country_" + i).text(), t = "http://local.google.com/maps?q=" + n; window.open(t) }); t(".vis-apanel-busy").css("visibility", "hidden") } }) }, 2) } } }(VIS, jQuery), function (n, t) { function i() { function b() { h = t('<div style="width:100%;height:100%">'); u = t("<ul class='vis-apanel-rb-ul' style='width:100%;height:100%'>"); e = t("<li data-isfav='no' data-id='favaction'>").append(n.Msg.getMsg("AddFav")); o = t("<li data-isfav='yes' data-id='favaction'>").append(n.Msg.getMsg("RemoveFav")); l = t("<li data-isfav='" + i.data("isfav") + "' data-id='favaction'>").append(n.Msg.getMsg("OpenNewTab")); u.append(e); u.append(o); u.append(l); h.append(u); d() } function k(n) { i = n; f = i.data("value"); a = i.data("action"); s = i.data("actionid"); y = i.data("name"); v = i.data("isfav"); p || (b(), p = !0); v == "yes" ? (e.css("display", "none"), o.css("display", "block")) : (e.css("display", "block"), o.css("display", "none")); i.w2overlay(h.clone(!0), { css: { height: "300px" } }) } function d() { e.on("click", w); o.on("click", w); l.on("click", g) } function w() { v == "yes" ? (i.removeClass("vis-favitmchecked"), i.addClass("vis-favitmunchecked"), i.data("isfav", "no"), tt(f), n.favMgr.removeFavourite(f)) : (r = {}, r.Action = a, r.WindowID = s, r.FormID = s, r.ProcessID = s, r.NodeID = f, r.Name = y, i.removeClass("vis-favitmunchecked"), i.addClass("vis-favitmchecked"), i.data("isfav", "yes"), nt(f), n.favMgr.addFavourite(r)) } function g() { n.viewManager.startActionInNewTab(a, s) } function nt(i) { t.ajax({ url: n.Application.contextUrl + "Home/SetNodeFavourite/?nodeID=" + i, dataType: "json" }) } function tt(i) { t.ajax({ url: n.Application.contextUrl + "Home/RemoveNodeFavourite/?nodeID=" + i, dataType: "json" }) } function it(n) { c || (c = t("#vis_divTree")); var r = c.children(0).find("[data-value='" + n + "']"), i = t(r.children()[1]); i.removeClass("vis-favitmchecked"); i.addClass("vis-favitmunchecked"); i.data("isfav", "no") } var h = null, u = null, f = null, i = null, r = null, c = null, e = null, o = null, l = null, a, s, y, v, p = !1; return { removeFavourite: it, showOverlay: k } } n.FavouriteHelper = i() }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h, c, l) { function pf() { k = o; k ? s != null && s != undefined && (li = s) : (li = r.gridTable.VAF_TableView_ID, v = u.getSelectedRows(), w = r.getRecords()[r.getCurrentRow()]); et = t('<ul class="vis-email-ul" ><\/ul>'); rt = t("<div>"); rt.css("position", "absolute"); rt.css("bottom", "0"); rt.css("background", "url('" + n.Application.contextUrl + "Areas/VIS/Images/LoadingCircle.gif') no-repeat"); rt.css("background-position", "center center"); rt.css("width", "98%"); rt.css("height", "98%"); rt.css("text-align", "center"); rt.css("opacity", ".1"); rt[0].style.visibility = "hidden" } function wf() { e ? (dt = t('<i class="vis-email-sendbtn vis vis-paper-plane"  title="' + n.Msg.getMsg("SendMail").replace("&", "") + '"><\/i>'), ii.append(dt)) : (dt = t('<i class="vis-email-saveAttachbtn vis vis-save-attach"  title="' + n.Msg.getMsg("SaveAttachment").replace("&", "") + '" ><\/i>'), ii.append(dt)); k || (vi = t('<i class="vis-email-btns vis vis-viewdocument"  title="' + n.Msg.getMsg("Preview").replace("&", "") + '" ><\/i>'), ii.append(vi), pi = t('<i class="vis-email-btns vis vis-save-as" title="' + n.Msg.getMsg("SaveAs").replace("&", "") + '" ><\/i>'), ii.append(pi), ht = t('<i class="vis-email-btns vis vis-save" title="' + n.Msg.getMsg("Save").replace("&", "") + '"><\/i>'), ii.append(ht), yi = t('<i class="vis-email-btns vis vis-open-file" title="' + n.Msg.getMsg("Open").replace("&", "") + '" ><\/i>'), ii.append(yi)); e || (ru = t('<i class="vis-email-btns vis vis-save-pdf" title="' + n.Msg.getMsg("SavePdf").replace("&", "") + '"><\/i>'), uu = t('<i class="vis-email-btns vis vis-new" title="' + n.Msg.getMsg("NewLetter").replace("&", "") + '" ><\/i>'), ii.append(ru).append(uu)) } function bf() { var i = { windowNo: p.windowNo, language: n.Env.getVAF_Language(n.Env.getCtx()) }; t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Email/Init", data: i, success: function (n) { kf(n) } }) } function kf(n) { var r, u; a.append(t(n)); r = 0; st = a.find("#" + p.windowNo + "_dyndis"); a.find(".vis-email-attachmentContainer").hide(); d = a.find(".vis-email-leftDiv"); ki = a.find(".vis-Email-BccList"); g = a.find("#" + p.windowNo + "_emailSubject"); er = a.find(".vis-DMSAttachDocList"); tr = a.find(".vis-dmsdocumentheader"); window.VADMS || (er.css("display", "none"), tr.css("display", "none")); c != undefined && c != null && g.val(c); sr = a.find("#" + p.windowNo + "_vis-email-attacImg"); ai = a.find("#" + p.windowNo + "_vis-Email-textarea"); hr = a.find(".vis-Email-leftFooter"); a.find(".contentArea").css("height", a.height() - 44); a.find(".vis-Email-textarea-div").css({ "margin-top": "10px" }); u = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); u == !0 && a.find(".vis-Email-textarea-div").css({ overflow: "auto" }); a.find(".vis-email-leftDiv").height(a.find(".contentArea").height()); k ? (a.find(".vis-form-data-sub").css("margin-top", "0px"), a.find(".vis-email-leftDiv").hide(), a.find(".vis-Email-rytWrap").hide(), at = a.find("#" + p.windowNo + "_emailToTop"), nt = a.find("#" + p.windowNo + "_emailBccTop"), ot = a.find("#" + p.windowNo + "_eamilCcTop"), nt.hide(), ot.hide(), a.find(".vis-Email-textarea-div").height(a.height() - 180), a.find(".vis-Email-leftWrap").css("width", "100%"), a.find(".vis-Email-leftFooter").hide(), r = a.width() - 40, st.prop("checked", !1), a.find(".vis-Email-topinputWrap").css("overflow", "auto"), st.hide(), i != undefined && i != null && at.val(i), a.find(".vis-form-data-sub").width(a.width() - 85)) : e ? (a.find(".vis-Email-topinputWrap").hide(), at = a.find("#" + p.windowNo + "_emailTo"), nt = a.find("#" + p.windowNo + "_emailBcc"), ot = a.find("#" + p.windowNo + "_eamilCc"), a.find(".vis-Email-textarea-div").height(a.height() - 145), or = a.find("#" + p.windowNo + "_emailRefresh"), r = a.width() - 90, a.find(".vis-Email-leftWrap").width(r - 350), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 60)) : (a.find(".vis-Email-rytWrap").hide(), a.find(".vis-Email-topinputWrap").hide(), sr.hide(), a.find(".vis-Email-textarea-div").height(a.height() - 142), a.find(".vis-Email-leftWrap").css("margin-right", "20px"), r = a.width() - 240, a.find(".vis-Email-leftWrap").width(r - 25), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 60)); window.VADMS ? a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 70) - 520) : a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 70) - 280); lt = a.find(".vis-Email-ContentWrap"); lt.css("width", r); y != null && y != undefined && (y.body.style.width = r - 370 + "px"); wu = !0 } function df() { try { ai.kendoEditor({ tools: ["bold", "italic", "underline", "strikethrough", "justifyLeft", "justifyCenter", "justifyRight", "justifyFull", "insertUnorderedList", "insertOrderedList", "indent", "outdent", "createLink", "unlink", "insertImage", "insertFile", "subscript", "superscript", "createTable", "addRowAbove", "addRowBelow", "addColumnLeft", "addColumnRight", "deleteRow", "deleteColumn", "viewHtml", "formatting", "cleanFormatting", "fontName", { name: "fontSize", items: [].concat([{ text: "8px", value: "8px" }], [{ text: "12px", value: "12px" }], [{ text: "16px", value: "16px" }], [{ text: "20px", value: "20px" }], [{ text: "24px", value: "24px" }]) }, "foreColor", "backColor"], keyup: ku, encoded: !1 }); y = ai.data("kendoEditor"); y.value(""); h != undefined && h != null && y.value(h) } catch (t) { return console.log(t), n.ADialog.error("PleaseInstallKendoUIModule"), p.dispose(), p = null, !1 } return !0 } function ku() { (y.value() != "" || g.val() != "") && (ct = 1) } function du(n) { var i, t, f; if (n == !0 && (v = u.getSelectedRows(), w = r.getRecords()[r.getCurrentRow()]), u.singleRow && v.length == 0) gu(); else if (v.length > 0) { for (i = "", t = 0; t < v.length; t++)e && v[t].email != null && (e = !0, f = v[t][r.getKeyColumnName().toLower()], i += '<li class="vis-list-li-bcc"  data-email="' + v[t].email + '"><input data-currentrec="Y" data-recID="' + f + '" id="' + p.windowNo + "_" + v[t].email + '_CheckBoxList1" type="checkbox" value="' + v[t].email + '" checked/><label class="vis-chcklist-label"  for="' + p.windowNo + "_" + v[t].email + '_CheckBoxList1">' + v[t].email + "(" + f + ")<\/label><\/li>"); et.append(i); i = null } else gu(); n || ki.append(et) } function gu() { if (e && w.email != null) { e = !0; var n = w[r.getKeyColumnName().toLower()]; et.append('<li class="vis-list-li-bcc" data-email="' + w.email + '"><input id="' + p.windowNo + "_" + w.email + '_CheckBoxList1" type="checkbox" value="' + w.email + '" checked /><label class="vis-chcklist-label" for="' + p.windowNo + "_" + w.email + '_CheckBoxList1">' + w.email + "(" + n + ")<\/label><\/li>") } } function nf(i) { var h, f, e, o, s, u; for (i ? it.empty() : (di = t('<div class="vis-apanel-lb-toggle">'), kt = t('<i class="fa fa-bars"><\/i>'), gt = t('<div class="vis-apanel-lb-toggle" style="border:none;height:100%;overflow-x:hidden;overflow-y: hidden;"><\/div>'), fi = t("<div class='vis-apanel-lb-oflow' style='border-top:0;display:none' >"), fi.html("<a data-dir='u' href='javascript:void(0)'><i class='vis vis-arrow-up' data-dir='u'><\/i><\/a><a data-dir='d' href='javascript:void(0)' ><i class='vis vis-arrow-down' data-dir='d'><\/i><\/a>"), gi = t('<div class="vis-apanel-lb-toggle" style="padding: 5px 10px;overflow-x:hidden;overflow-y: hidden;"><\/div>'), gi.append(fi), di.append(kt), d.append(di), d.append(gt), d.append(gi), it = t('<ul class="vis-apanel-lb-ul"><\/ul>'), it.css({ overflow: "auto", "overflow-x": "hidden", "white-space": "nowrap", width: "100%" })), h = "", f = 0; f < r.gridTable.getFields().length; f++)if (e = r.gridTable.getFields(0)[f].getColumnName().toUpper() == r.getKeyColumnName().toUpper(), r.gridTable.getFields(0)[f].getIsDisplayed() || e) { if (e || (h += "<li>" + r.gridTable.getFields(0)[f].getHeader() + "<\/li>"), o = [], s = [], r.gridTable.getFields(0)[f].getColumnName().toUpper().equals(ei)) for (u = 0; u < v.length; u++)n.DisplayType.IsLookup(r.getField(ei).getDisplayType()) ? v[u][ei.toLower()] != null && (o.push(v[u][ei.toLower()]), s.push(v[u][r.getKeyColumnName().toLower()])) : v[u][ei.toLower()] != null && (o.push(v[u][ei.toLower()]), s.push(v[u][r.getKeyColumnName().toLower()])); gf(o, s) } e || it.append(h); i || gt.append(it); it.children("li").on("click", ee) } function tf() { if (!k) if (it.height() > t(it.parent()).height()) { gt.css("border-bottom", "1px solid rgba(var(--v-c-secondary), 1)"); fi.css("display", "block"); var n = gi.height() + di.height() + 37; gt.height(d.height() - n); d.css("overflow", "hidden"); gt.css({ "overflow-x": "hidden", width: "100%", "overflow-y": "visible" }) } else gt.css("border-bottom", "none"), fi.css("display", "none") } function gf(i, r) { for (var f, e = 0; e < i.length; e++) { var u = n.dataContext.getJSONData(n.Application.contextUrl + "Email/GetUser", { BPartner_ID: i[e] }, null), o = ""; if (u != null) for (f in u) if (u[f].Email != null) { if (u[f].Email == null || u[f].Email == "") continue; if (t(et.children("li").data(u[f].Email + r[e])).length > 0) continue; o += '<li  class="vis-list-li-bcc"><input data-currentrec="N" data-recid="' + r[e] + '" id="' + p.windowNo + "_" + u[f].Email + '_CheckBoxList1" type="checkbox"  value="' + u[f].Email + '" checked/><label class="vis-chcklist-label"  for="' + p.windowNo + "_" + u[f].Email + '_CheckBoxList1">' + u[f].Email + "(" + r[e] + ")<\/label><\/li>" } et.append(o); o = null } } function ne() { g.on("change", ku); if (!k) fi.on("click", function (n) { var r, e; if (n.stopPropagation(), r = t(n.target).data("dir"), r) { var o = it.parent().height(), s = it.height(), u = it.parent().scrollTop(), f = Math.ceil(o / 2), i = 0; if (r == "d") { if (u + f >= s - f) return; e = s - o; i = u + f; it.parent().animate({ scrollTop: i > e ? e : i }, 1e3) } else if (r == "u") { if (u == 0) return; i = u - f; it.parent().animate({ scrollTop: i < 0 ? 0 : i }, 1e3) } } }); sr.on("click", function () { te() }); ui.on("click", "li", function (i) { var u, r; if (i.stopPropagation(), u = t(this).attr("value"), parseInt(u) == 0) re(i); else if (parseInt(u) == 1) { if (t("#w2ui-overlay").hide(), pt != null && pt.GetDmsCloseOrNot()) { n.ADialog.info("DMSAlreadyOpen"); return } r = new n.CFrame; pt = new VADMS.DocumentManagementSystem; r.setName(n.Msg.getMsg("VADMS_Document")); r.setTitle(n.Msg.getMsg("VADMS_Document")); r.hideHeader(!0); pt.setWindowNo(p.windowNo); pt.OpenFromEmail(!0); r.setContent(pt); pt.initialize(); r.show() } }); if (e) { dt.on("click", se); if (or != null && or != undefined) or.on("click", ve) } else dt.on("click", he); if (!e) { ru.on("click", ce); uu.on("click", le) } if (k) a.find(".vis-Email-CcBcc").on("click", ye); else { kt.on("click", ie); st.on("click", fe); vi.on("click", oe); yi.on("click", sf); pi.on("click", hf); ht.on("click", vu); kt.trigger("click") } lf(); e || g.keyup(function () { ct = g.val() != "" ? y.value() != "" ? 1 : 0 : 0 }) } function te() { var i, r; ui != null && ui.empty(); i = t("<div/>"); i.css("width", "auto"); i.css("height", "100%"); ui.css("width", "auto"); ui.css("height", "100%"); r = "<li class='vis-filesystem' value='0'>" + n.Msg.getMsg("FileSystem") + "<\/li> "; window.VADMS && (r += "<li class='vis-dms' value='1'>" + n.Msg.getMsg("DMS") + "<\/li>"); ui.append(r); i.append(ui); sr.w2overlay(i.clone(!0), { css: { height: "300px" } }); i.css("top", "395px"); ui.load() } function ie(n) { st.prop("checked") == !0 ? d.width() == 40 ? (e ? (middleDivWidth = ri - (a.find(".vis-email-leftDiv").width() + 200), a.find(".vis-Email-leftWrap").width(middleDivWidth - 355), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 45), lt.width(middleDivWidth)) : (middleDivWidth = ri - (a.find(".vis-email-leftDiv").width() + 200), a.find(".vis-Email-leftWrap").width(middleDivWidth - 15), a.find(".vis-form-data-sub").width(middleDivWidth - 40), lt.width(middleDivWidth)), d.css("width", "200px"), d.find("ul").show(), tf(), y != null && y != undefined && (y.body.style.width = y.body.style.width - 160)) : (cu(), gt.css("border-bottom", "none"), k || fi.css("display", "none")) : d.width() != 40 && cu(); n.stopPropagation() } function cu() { d.css({ width: "40px" }); d.find("ul").hide(); e ? (middleDivWidth = ri - (a.find(".vis-email-leftDiv").width() + 40), a.find(".vis-Email-leftWrap").width(middleDivWidth - 355), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 45), lt.width(middleDivWidth)) : (middleDivWidth = ri - (a.find(".vis-email-leftDiv").width() + 40), a.find(".vis-Email-leftWrap").width(middleDivWidth - 15), a.find(".vis-form-data-sub").width(middleDivWidth - 40), lt.width(middleDivWidth)); y != null && y != undefined && (y.body.style.width = y.body.style.width + 160) } function re() { var n; if (gr == !1) { if (a.find(".vis-email-attachmentContainer").is(":visible")) a.find(".vis-email-attachmentContainer").hide(), a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height() + (a.find(".vis-email-attachmentContainer").height() + 13)); else if (n = a.find(".vis-Email-ContentArea").height(), a.find(".vis-email-attachmentContainer").show(), a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height() - (a.find(".vis-email-attachmentContainer").height() + 13)), ft == null || ft == undefined) { rf(); ft = a.find("<input type='file' multiple='true' style='display:none;'>"); nu.append(ft); cr.on("click", function () { ft.trigger("click") }); ft.change(function () { lu(this) }) } } else a.find(".vis-email-attachmentContainer").is(":visible") || (n = a.find(".vis-Email-ContentArea").height(), (ft == null || ft == undefined) && (rf(), ft = t("<input type='file' multiple='true' style='display:none;'>"), ft.change(function () { this.files.length < 1 || (a.find(".vis-email-attachmentContainer").show(), lu(this), k ? a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-ContentArea").height() - (a.find(".vis-form-horizontal").height() + 30)) : a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-ContentArea").height() - (a.find(".vis-form-horizontal").height() + 50)), ef()) }))), ft.trigger("click") } function rf() { nu = t("<div><\/div>"); var n = t("<div><\/div>"); if (a.find(".vis-email-attachmentContainer").append(n), gr == !1 && (cr = t('<a class="vis-attach-ico browse-ico" style="margin-right:8px;float:right;height:30px;width:30px;margin-top:6px;"><\/a>'), nu.append(cr), n.append(cr)), tu = t("<div><\/div>"), n.append(tu), si = t("<div class='vis-attach-content-wrap' style='height:83px;border-bottom:2px solid rgba(var(--v-c-secondary), 1);padding-bottom:0px'>"), si.append(t('<div style="height:auto;overflow:auto" ><\/div>')), tu.append(si), a.find(".vis-email-attachmentContainer").append(lr), gr == !1) { iu = t("<div><\/div>"); n.append(iu); fu = t('<a href="javascript:void(0)" class="vis-attach-ico uploadall-ico" style="height:30px;width:30px;margin-right: 7px;float:right"><\/a>'); iu.append(fu); fu.on("click", function () { ef() }) } } function uf() { return si.children(0).height() < 75 ? !1 : !0 } function fe() { this.checked ? (d.width() != 40 && d.find("ul").show(), e == !0 && u.singleRow == !1 && v.length > 1 && (at.val(""), at.prop("disabled", !0), ot.val(""), ot.prop("disabled", !0), nt.val(""), nt.prop("disabled", !0)), ou = !0) : (d.width() != 40 && cu(), e == !0 && u.singleRow == !1 && v.length > 1 && (at.prop("disabled", !1), ot.prop("disabled", !1), nt.prop("disabled", !1)), ou = !1, gt.css("border-bottom", "none"), k || fi.css("display", "none")) } function ee() { y.paste("@@" + t(this).text() + "@@") } function oe() { var f = y.value(), e = "", r, i; e = u.singleRow == !1 || v.length > 0 ? pe(f, 0) : we(f); r = t("<div><\/div>"); r.append(e); t(r.find("table")).css({ width: "100%", border: "1px solid Black" }); t(r.find("td")).css({ border: "1px solid Black" }); i = new n.ChildDialog; i.setHeight(420); i.setWidth(850); i.setTitle(n.Msg.getMsg("Preview")); i.setModal(!0); i.setContent(r); i.show(); i.hidebuttons() } function se(t) { var i = g.val(), r = y.value(), u = !0; if ((i == null || i == "" || i.trim().length == 0) && (r == null || r == "" || r.trim().length == 0)) { u = !1; n.ADialog.confirm("SendWithoutSubjectandBody", !0, "", "Confirm", function (n) { n && pr(t, i, r) }); return } if (i == null || i == "" || i.trim().length == 0) { u = !1; n.ADialog.confirm("SendWithoutSubject", !0, "", "Confirm", function (n) { n && pr(t, i, r) }); return } if (r == null || r == "" || r.trim().length == 0) { u = !1; n.ADialog.confirm("SendWithoutBody", !0, "", "Confirm", function (n) { n && pr(t, i, r) }); return } u && pr(t, i, r) } function pr(i, e) { var k, ut, l, s, o, ft, ht, ct, a, it, c, h, wt, lt; yt = !1; var d = at.val(), b = nt.val(), g = ot.val(); if (d.trim().length > 0) if (d.contains(";")) { for (s = d.split(";"), o = 0; o < s.length; o++)if (s[o] != null && s[o] != "") if (bt(s[o].trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + s[o]) }, 2); return } } else if (bt(d.trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + d) }, 2); return } if (g.trim().length > 0) if (g.contains(";")) { for (s = g.split(";"), o = 0; o < s.length; o++)if (s[o] != null && s[o] != "") if (bt(s[o].trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + s[o]) }, 2); return } } else if (bt(g.trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + g) }, 2); return } if (b.trim().length > 0) if (b.contains(";")) { for (s = b.split(";"), o = 0; o < s.length; o++)if (s[o] != null && s[o] != "") if (bt(s[o].trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + s[o]) }, 2); return } } else if (bt(b.trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + b) }, 2); return } if (k = [], st.prop("checked") == !1) { if (ut = !1, l = {}, l.To = d, l.Cc = g, l.Bcc = [], b.contains(";")) for (s = b.split(";"), o = 0; o < s.length; o++)s[o] != null && s[o] != "" && l.Bcc.push(s[o]); else b != null && b != "" && l.Bcc.push(b); if (et != null && et != undefined && (tt = [], t("[id*=CheckBoxList1]:checked").each(function () { tt.push(t(this).val()) }), tt.length > 0)) for (a = 0; a < tt.length; a++) { if (!bt(tt[a])) { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + tt[a]) }, 2); return } ut = !0; l.Bcc.push(tt[a]) } if (l.Subject = e, l.TableID = li, l.Recordids = "", w != null) if (u.singleRow == !1 || v.length > 0) { for (ft = "", c = 0; c < v.length; c++)ft += v[c][r.keyColumnName.toLower()] + ","; l.Recordids = ft } else l.Recordids = f > 0 ? f : u.singleRow == !0 ? r.getField(r.keyColumnName.toLower()).value : w[r.keyColumnName.toLower()]; else f > 0 && (l.Recordids = f); if (l.AttachmentFolder = vr, !ut && !yt) { window.setTimeout(function () { n.ADialog.info("NoEmailAddressFound") }, 2); return } k.push(l) } else if (tt = [], ht = [], ct = [], t("[id*=CheckBoxList1]:checked").each(function () { tt.push(t(this).val()); ht.push(t(this).data("recid")); ct.push(t(this).data("currentrec")) }), tt.length > 0) { for (a = 0; a < tt.length; a++)if (!bt(tt[a])) { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + tt[a]) }, 2); return } for (it = 0; it < tt.length; it++)if (u.singleRow == !0 && v.length == 0) { if (h = ur(w, 0), h == null || h == undefined) return; k.push(h) } else for (c = 0; c < v.length; c++)if (ht[it] == v[c][r.getKeyColumnName().toLower()]) { if (h = null, h = ct[it] == "N" ? ur(v[c], c, tt[it]) : ur(v[c], c), h == null || h == undefined) continue; k.push(h) } } else if (yt) if (u.singleRow == !0 && v.length == 0) { if (h = ur(w, 0), h == null || h == undefined) return; k.push(h) } else for (c = 0; c < v.length; c++)(h = ur(v[c], c), h != null && h != undefined) && k.push(h); if (k.length == 0) { window.setTimeout(function () { n.ADialog.info("NoEmailAddressFound") }, 2); return } wt = JSON.stringify(k); lt = !1; n.ADialog.confirm("WantAlertMessage", !0, "", "Confirm", function (i) { i && (lt = !0); rt[0].style.visibility = "visible"; var r = { mails: n.Utility.encodeText(wt), VAF_UserContact_ID: vt.getVAF_UserContact_ID(), VAF_Client_ID: vt.getVAF_Client_ID(), VAF_Org_ID: vt.getVAF_Org_ID(), attachment_ID: dr, fileNamesFornNewAttach: JSON.stringify(bi), fileNamesForopenFormat: JSON.stringify(hi), mailFormat: n.Utility.encodeText(y.value()), notify: lt, strDocAttach: n.context.getContext("DocumentAttachViaEmail_" + p.windowNo) }; t.ajax({ url: n.Application.contextUrl + "Email/SendMail", data: r, datatype: "json", type: "post", cache: !1, async: !0, success: function (t) { rt[0].style.visibility = "hidden"; var i = JSON.parse(t); i == "" ? (p.dispose(), p = null, pt != null && pt.dispose(), pt = null) : window.setTimeout(function () { n.ADialog.info(i); i.contains("MailSent") && n.context.setContext("DocumentAttachViaEmail_" + p.windowNo, "") }, 2) } }) }) } function bt(n) { return /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n) } function he() { var e, i, h, o, s; if (e = g.val(), e == null || e == "" || e.trim().length == 0) { n.ADialog.info("PleaseAddSubject"); return } if (i = y.value(), i != null && i != "" && i != undefined && !(i.trim().length < 1)) { if (h = "", o = {}, v = u.getSelectedRows(), w = r.getRecords()[r.getCurrentRow()], u.singleRow == !1 || v.length > 0) for (s = 0; s < v.length; s++)o[v[s][r.keyColumnName.toLower()]] = yu(i, s); else f > 0 ? o[f] = br(i) : o[w[r.keyColumnName.toLower()]] = br(i); rt[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Email/SaveAttachment", datatype: "json", type: "post", cache: !1, data: { subject: e, VAF_TableView_ID: li, html: n.Utility.encodeText(i), values: JSON.stringify(o) }, success: function () { rt[0].style.visibility = "hidden"; n.ADialog.info("Saved") }, error: function (n) { console.log(n) } }) } } function ce() { var i = y.value(), o, f, e; if (i != null && i != "" && i != undefined && !(i.trim().length < 1)) { if (o = "", f = [], v = u.getSelectedRows(), w = r.getRecords()[r.getCurrentRow()], u.singleRow == !1 || v.length > 0) for (e = 0; e < v.length; e++)f.push(yu(i, e)); else f.push(br(i)); rt[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Email/InsertAttachmentText", datatype: "json", type: "post", cache: !1, data: { html: n.Utility.encodeText(i), values: JSON.stringify(f) }, success: function (t) { var i, r; rt[0].style.visibility = "hidden"; i = JSON.parse(t); bu = i; r = bu; window.open(n.Application.contextUrl + r); return } }) } } function le(t) { rr = !1; ir = 0; ct == 1 ? (y.value() != "" || g.val() != "") && n.ADialog.confirm("DoYouWantToSave", !0, "", "Confirm", function (n) { n ? (vu(t), ct = 0, ir = 1) : (g.val(""), y.value(""), oi = 0, ht.css("opacity", "1"), ct = 0) }) : (g.val(""), y.value(""), oi = 0, ht.css("opacity", "1"), ct = 0) } function sf(t) { var r = 0, i; au = 0; i = new n.Openmailformat(u.gTab.getVAF_Screen_ID(), e); ae = i; e || (ir = 0, y.value() != "" && g.val() != "" && ct == 1 && (n.ADialog.confirm("DoYouWantToSave", !0, "", "Confirm", function (n) { n ? (vu(t), au = 1, rr = !0) : (oi = 0, ht.css("opacity", "1"), ct = 0, i.show()) }), r = 1)); r == 0 && i.show(); i.onClose = function () { ct = 0; var n = i.getSelectedRow(); n != null && n != undefined && (oi = n.VAF_TEXTTEMPLATE_ID, wr = n.VAF_CLIENT_ID, g.val(n.SUBJECT), wr != vt.getVAF_Client_ID() ? ht.css("opacity", "0.4") : ht.css("opacity", "1"), n.ISDYNAMICCONTENT == "Y" ? st.prop("checked", !1).trigger("click") : st.prop("checked", !0).trigger("click"), fr = n.VAF_Screen_ID != null && n.VAF_Screen_ID != undefined && n.VAF_Screen_ID > 0 ? !1 : !0, kr = n.NAME, y.value(n.MAILTEXT)); rr = !1 } } function hf() { var i = y.value(), t; i != null && i.trim() != "" && i != undefined && (t = new n.Newmailformat(e), t.show(), t.onClose = function () { kr = t.getName(); fr = t.saveForAll(); cf(0) }) } function vu() { if (wr == vt.getVAF_Client_ID()) { var n = y.value(); n != null && n != "" && n != undefined && (oi > 0 ? cf(oi) : hf()) } } function ve() { et.empty(); du(!0); nf(!0) } function cf(i) { var u = { id: i, VAF_Client_ID: vt.getVAF_Client_ID(), VAF_Org_ID: vt.getVAF_Org_ID(), name: n.Utility.encodeText(kr), isDynamic: st.prop("checked"), subject: n.Utility.encodeText(g.val()), text: n.Utility.encodeText(y.value()), saveforAll: fr, VAF_Screen_ID: r.getVAF_Screen_ID(), folderName: vr, attachmentID: dr }; t.ajax({ type: "POST", url: n.Application.contextUrl + "Email/SaveFormats", data: u, success: function (n) { oi = parseInt(n); wr = vt.getVAF_Client_ID(); ht.css("opacity", "1"); ct = 0; e || (ir == 1 && (g.val(""), y.value("")), rr == !0 && window.setTimeout(function () { au == 1 && (sf(), rr = !1) }, 200)) } }) } function ye() { nt.is(":visible") ? (nt.hide(), ot.hide(), a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - 365) : a.find(".vis-Email-textarea-div").height(a.height() - 180)) : (nt.show(), ot.show(), a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - 440) : a.find(".vis-Email-textarea-div").height(a.height() - 255)) } function ur(t, i, e) { var c = !1, o = {}, s, i, h; if (o.To = at.val(), o.Cc = ot.val(), o.Bcc = [], nt.val().contains(";")) for (s = nt.val().split(";"), i = 0; i < s.length; i++)s[i] != null && s[i] != "" && o.Bcc.push(s[i]); else nt.val() != null && nt.val() != "" && o.Bcc.push(nt.val()); if (e) bt(e) || window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + e); return }, 2), o.Bcc.push(e), c = !0; else if (et != null && et != undefined) if (Object.keys(t).indexOf("email") > -1 && tt.indexOf(t.email) > -1) bt(t.email) || window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + t.email); return }, 2), o.Bcc.push(t.email), c = !0; else if ((!u.singleRow != !1 || v.length != 1) && (!u.singleRow == !1 || v.length > 1)) return; if (h = g.val(), h.trim().length == 0 && (h = "  "), o.Subject = h, o.TableID = li, o.Recordids = u.singleRow == !0 && v.length == 0 ? f : t[r.keyColumnName.toLower()], o.Body = u.singleRow == !1 ? yu(y.value(), i) : br(y.value()), o.AttachmentFolder = vr, u.singleRow != !0 && v.length != 1 || c || yt) return o } function yu(t, i) { for (var e = t, h = {}, s; e.indexOf("@@") > -1;) { e = e.substring(e.indexOf("@@") + 2); var c = e.substring(0, e.indexOf("@@")), o = null, f = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === c })[0]; f != undefined && f != null && (n.DisplayType.IsLookup(r.getField(f).getDisplayType()) || n.DisplayType.Location == r.getField(f).getDisplayType() ? v[i][f.toLower()] != null && v[i][f.toLower()] != undefined && (o = r.getField(f.toLower()).lookup.getDisplay(v[i][f.toLower()])) : n.DisplayType.IsDate(r.getField(f).getDisplayType()) ? (s = r.getField(f).getDisplayType(), o = r.getField(f).value, o = n.DisplayType.Date == s ? new Date(o).toLocaleDateString() : n.DisplayType.Time == s ? new Date(o).toLocaleTimeString() : new Date(o).toLocaleString()) : o = v[i][f.toLower()]); e = e.substring(e.indexOf("@@") + 2); h["@@" + c + "@@"] = o } return h } function br(t) { for (var f = t, s = {}, o; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var h = f.substring(0, f.indexOf("@@")), e = null, i = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === h })[0]; i != undefined && i != null && (n.DisplayType.IsLookup(r.getField(i).getDisplayType()) || n.DisplayType.Location == r.getField(i).getDisplayType() ? w[i.toLower()] != null && w[i.toLower()] != undefined && (e = r.getField(i.toLower()).lookup.getDisplay(w[i.toLower()])) : n.DisplayType.IsDate(r.getField(i).getDisplayType()) ? (o = r.getField(i).getDisplayType(), e = r.getField(i).value, e = n.DisplayType.Date == o ? new Date(e).toLocaleDateString() : n.DisplayType.Time == o ? new Date(e).toLocaleTimeString() : new Date(e).toLocaleString()) : e = u.singleRow == !0 && v.length == 0 ? r.getField(i).value : w[i.toLower()]); f = f.substring(f.indexOf("@@") + 2); s["@@" + h + "@@"] = e } return s } function pe(t, i) { for (var s = t, o = t, c; o.indexOf("@@") > -1;) { o = o.substring(o.indexOf("@@") + 2); var h = o.substring(0, o.indexOf("@@")), e = null, f = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === h })[0]; f != undefined && f != null && (n.DisplayType.IsLookup(r.getField(f).getDisplayType()) || n.DisplayType.Location == r.getField(f).getDisplayType() ? v[i][f.toLower()] != null && v[i][f.toLower()] != undefined && (e = r.getField(f.toLower()).lookup.getDisplay(v[i][f.toLower()])) : n.DisplayType.IsDate(r.getField(f).getDisplayType()) ? (c = r.getField(f).getDisplayType(), e = r.getField(f).value, e = n.DisplayType.Date == c ? new Date(e).toLocaleDateString() : n.DisplayType.Time == c ? new Date(e).toLocaleTimeString() : new Date(e).toLocaleString()) : e = v[i][f.toLower()]); o = o.substring(o.indexOf("@@") + 2); s = e != null && e != undefined ? s.replace("@@" + h + "@@", e) : s.replace("@@" + h + "@@", "") } return s } function we(t) { for (var e = t, o; e.indexOf("@@") > -1;) { e = e.substring(e.indexOf("@@") + 2); var s = e.substring(0, e.indexOf("@@")), f = null, i = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === s })[0]; i != undefined && i != null && (n.DisplayType.IsLookup(r.getField(i).getDisplayType()) || n.DisplayType.Location == r.getField(i).getDisplayType() ? f = w[i.toLower()] != null && w[i.toLower()] != undefined ? r.getField(i.toLower()).lookup.getDisplay(w[i.toLower()]) : "" : n.DisplayType.IsDate(r.getField(i).getDisplayType()) ? (o = r.getField(i).getDisplayType(), f = r.getField(i).value, f = n.DisplayType.Date == o ? new Date(f).toLocaleDateString() : n.DisplayType.Time == o ? new Date(f).toLocaleTimeString() : new Date(f).toLocaleString()) : u.singleRow == !0 && v.length == 0 ? (f = r.getField(i).value, f == null && (f = "")) : f = w[i.toLower()]); e = e.substring(e.indexOf("@@") + 2); t = t.replace("@@" + s + "@@", f) } return t } function lf() { var n = 0; a.height(pu); a.width(ri); a.find(".contentArea").css("height", a.height() - 42); a.find(".vis-Email-BccList").height(1); a.find(".vis-email-leftDiv").height(a.find(".contentArea").height()); k ? (a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - 345) : a.find(".vis-Email-textarea-div").height(a.height() - 180), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 85), n = a.width() - 40) : e ? (a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - (a.find(".vis-email-attachmentContainer").height() + 150)) : a.find(".vis-Email-textarea-div").height(a.height() - (a.find(".vis-email-attachmentContainer").height() + 70)), n = ri - (a.find(".vis-email-leftDiv").width() + 30), a.find(".vis-Email-leftWrap").width(n - 355), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 45)) : (a.find(".vis-Email-textarea-div").height(a.height() - 155), y != null && y != undefined, n = ri - (a.find(".vis-email-leftDiv").width() + 30), a.find(".vis-Email-leftWrap").width(n - 15), a.find(".vis-form-data-sub").width(n - 40)); lt != null && lt.css("width", n - 10); y != null && y != undefined && (y.body.style.width = n - 370 + "px"); k || (window.VADMS ? a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 310)) : a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 70))) } var su, ar, yr, lu, ir; this.frame = null; this.windowNo = n.Env.getWindowNo(); var vt = n.Env.getCtx(), ti = null, ei = "VAB_BUSINESSPARTNER_ID", v = null, w = null, oi = 0, kr, fr, b = [], af = [], si = null, dr = 0; l && (dr = l); var gr = !0, yt = !1, li = 0, tt = [], k = !1, hi = [], bi = [], it = null, a = null, d = null, lt = null, ki = null, er = null, kt = null, et = null, st = null, at = null, nt = null, ot = null, or = null, sr = null, g = null, ai = null, y = null, hr = null, vi = null, dt = null, yi = null, pi = null, ht = null, vf = null, rt, ii = t('<div class="vis-awindow-header vis-menuTitle">'), p = this, nu, cr, tu, iu, ru, uu, fu, pu = 0, ri = 0, be = p.windowNo; a = t('<div class="vis-email-rootDiv vis-forms-container"><\/div>'); var eu = t('<div class="vis-email-rootDivBusy"><\/div>'), ui = t("<ul id='ulAttachmentOption' class='vis-apanel-rb-ul'>"), pt = null, wu = !1, di, gt, gi, ou = !1, lr = t("<div style='width: 100%;height: 100%;background:black;opacity: .1;display:none'>"), wi = null; wi = n.Application.isRTL ? t("<div id='progress_bar' class='vis-ui-progress-bar ui-container' style='top:41%;width: 80%;right: 10%;'>") : t("<div id='progress_bar' class='vis-ui-progress-bar ui-container' style='top:41%;width: 80%;left: 9%;'>"); lr.append(wi); su = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;margin-top:2px'>"); wi.append(su); ar = t("<span class='ui-label' >").append("0%"); wi.append(ar); var hu = 0, ci = 0, vr = Date.now().toString(), wt = 1048576, ni = 0, nr = 0, yf = [], bu = "", ft = null, ut, tr = null, fi, ct = 0; pf(); this.initializeComponent = function () { var i = null, r; (e == !0 ? (i = t('<a href="javascript:void(0)"  class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/a>'), r = k ? t("<p>" + n.Msg.getMsg("EMail") + " (" + n.Msg.getMsg("Contacts") + ") <\/p>") : t("<p>" + n.Msg.getMsg("EMail") + " (" + u.aPanel.$parentWindow.getName() + ") <\/p>")) : (i = t('<a href="javascript:void(0)"  class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/a>'), r = k ? t("<p>" + n.Msg.getMsg("Letter") + " (" + n.Msg.getMsg("Contacts") + ") <\/p>") : t("<p>" + n.Msg.getMsg("Letter") + " (" + u.aPanel.$parentWindow.getName() + ") <\/p>")), a.append(ii.append(i).append(r)), i.click(function (n) { p.dispose(); p = null; n.stopPropagation() }), bf(), df() != !1) && (a.append(rt), wf(), k || e && du(!1), k || nf(!1), ne()) }; this.getRoot = function () { return a }; this.leftULsize = function () { if (!k) { var n = gi.height() + di.height() + 53; t(it.parent()).height(d.height() - n); ou == !0 && tf() } }; yr = function (n) { n ? (lr.show(), wi.show()) : (lr.hide(), wi.hide()) }; lu = function (i) { for (var f, u, c, e, l, v, o, y, d, w, h, r = 0; r < i.files.length; r++) { if (ut = i.files[r], ut == undefined) return; if (ut.size != 0) { for (u in b) if (ut.name == b[u].name) { window.setTimeout(function () { n.ADialog.info("fileAlreadyAttached") }, 2); return } if (hi != null) for (f = 0; f < hi.length; f++)if (ut.name == hi[f]) { window.setTimeout(function () { n.ADialog.info("fileAlreadyAttached") }, 2); return } ni = 0; for (u in b) ni += b[u].size; if (ni + ut.size > wt * 24) { window.setTimeout(function () { n.ADialog.info("MaxFileSize25MB") }, 2); return } if (ut.size > wt * 24) { window.setTimeout(function () { n.ADialog.info("MaxFileSize25MB") }, 2); return } c = {}; e = t("<div style='margin-bottom:3px' class='vis-attach-file-wrapla'>"); si.children(0).append(e); l = t("<div class='vis-attach-file-top'>"); v = t("<a class='vis-file-close-ico'><i class='vis vis-mark'><\/i><\/a>"); l.append(v); e.append(l); si.show(); v.on("click", function () { var i = t(t(this).parent()).parent(), r = i.html(), n; i.remove(); i = null; for (n in b) if (String(r).indexOf(b[n].name) > -1) { ni = ni - n.size; b.splice(n, 1); break } bi.splice(0, bi.length); for (n in b) bi.push(b[n].name); uf() || (a.find(".vis-attach-content-wrap").height(83), a.find(".vis-email-attachmentContainer").height(90), k ? a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 30)) : a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 50))); b.length == 0 && (a.find(".vis-email-attachmentContainer").hide(), a.find(".vis-email-attachmentContainer").height(90), a.find(".vis-attach-content-wrap").height(83), k ? a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 30)) : a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 50))); ci-- }); o = t("<div class='vis-attach-file-content'>"); e.append(o); y = t("<div class='vis-attach-file-icon'>"); d = ff(ut.name); y.append(t("<img src='" + d + "'>")); o.append(y); var p = t("<div class='vis-attach-file-text' style='margin-bottom:10px'>"), g = "", s = t("<p>"); ut.name.length > 17 ? (g = ut.name.toString().substr(0, 17), s.append(g), w = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip'>").append("..."), h = t("<span style='width: inherit;'>"), h.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/email-ccc.png").append("ToolTip Text")), h.append(t("<label class='VIS_Pref_Label_Font'>").append(ut.name)), w.append(h), s.append(w)) : s.append(ut.name); p.append(s); p.append(t("<p>").append((Number(ut.size) / 1024).toFixed(2) + "KB")); o.append(p); c.Name = ut.name; c.Size = ut.size; b.push(ut); uf() && a.find(".vis-email-attachmentContainer").height() == 90 && (a.find(".vis-email-attachmentContainer").height(155), a.find(".vis-attach-content-wrap").height(145)) } } }; var ff = function (t) { var r, u, i; return t == null || t.length == 0 ? "" : (r = t.lastIndexOf("."), u = n.Application.contextUrl + "Areas/VIS/Images/", r < 1) ? u + "defult.png" : (i = t.substr(r, t.length - r), u + (i == ".xlsx" || i == ".xls" ? "excel.png" : i == ".html" || i == ".htm" ? "html.png" : i == ".pdf" ? "pdf.png" : i == ".ppt" ? "ppt.png" : i == ".txt" ? "text.png" : i == ".docx" || i == ".doc" ? "word.png" : i == ".xml" ? "xml.png" : "defult.png")) }, ke = function (i, r) { var s = t("<div class='vis-attach-file-wrapla'>"), h, c, u, f, l, v, o; si.append(s); h = t("<div class='vis-attach-file-top'>"); c = t("<a class='vis-file-close-ico'>"); h.append(c); s.append(h); c.on("click", function () { var n = t(t(this).parent()).parent(), r, i; n.css("display", "none"); r = n.html(); n.empty(); n = null; for (i in hi) if (String(r).indexOf(hi[i]) > -1) { hi.splice(i, 1); break } }); u = {}; f = t("<div class='vis-attach-file-content'>"); s.append(f); l = t("<div class='vis-attach-file-icon'>"); l.append(t("<img src='" + ff(i) + "'>")); f.append(l); var a = t("<div class='vis-attach-file-text'  style='margin-bottom:10px'>"), y = "", e = t("<p>"); i.length > 17 ? (y = i.toString().substr(0, 17), e.append(y), v = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip'>").append("..."), o = t("<span style='width: inherit;'>"), o.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/email-ccc.png").append("ToolTip Text")), o.append(t("<label class='VIS_Pref_Label_Font'>").append(i)), v.append(o), e.append(v)) : e.append(i); a.append(e); a.append(t("<p>").append((Number(r) / 1024).toFixed(2) + "KB")); f.append(a); u.Name = i; u.Line_ID = 0; u.HaveSource = !1; u.Source = null; u.IsDeleted = !1; af.push(u) }, ef = function () { var t = null, i = 0, r = 0, n; ni = 0; for (n in b) i = parseInt(b[n].size / wt), ut.size % wt > 0 && i++, ni += i, r += b[n].size, t = {}, bi.push(b[n].name), t.Name = b[n].name, t.Size = b[n].size, yf.push(t); r > wt * 24 || (yr(!0), of()) }, of = function () { var t, i, r; if ((b == null || b.length == 0) && (yr(!1), a.find(".vis-email-attachmentContainer").hide(), a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height() + (a.find(".vis-email-attachmentContainer").height() + 13)), window.setTimeout(function () { n.ADialog.info("NothingToUpload"); return }, 2)), ci >= b.length) { yr(!1); return } t = new XMLHttpRequest; i = new FormData; i.append("file", b[ci].slice(nr * wt, nr * wt + Number(wt))); t.open("POST", n.Application.contextUrl + "Email/SaveAttachmentinTemp?filename=" + b[ci].name + "&folderKey=" + vr, !1); t.send(i); hu++; nr++; r = parseInt(b[ci].size / wt); b[ci].size % wt > 0 && r++; nr == r && (ci++, nr = 0); hu <= ni && ue(parseInt(hu / ni * 100)); window.setTimeout(function () { of() }, 2) }, ue = function (n) { su.css("width", n + "%"); ar.empty(); ar.append(n + "%") }; ir = 0; var wr = vt.getVAF_Client_ID(), rr = !1, ae = null, au = 0; this.show = function () { ti = new n.ChildDialog; ti.setHeight(800); ti.setWidth(1600); ti.setTitle(n.Msg.getMsg("EMail")); ti.setModal(!0); ti.show(); ti.setContent(a); initializeComponent() }; this.disposeComponent = function () { vt = null; ti = null; ei = ""; v = null; w = null; li = 0; tt = null; k || (yi != null && yi.off("click"), vi != null && vi.off("click"), ht != null && ht.off("click"), pi != null && pi.off("click"), kt != null && kt.off("click"), it != null && it.remove(), kt != null && kt.remove(), et != null && et.remove(), st != null && st.remove(), ai != null && ai.remove()); dt != null && dt.off("click"); ft != null && ft != undefined && (ft.off("change"), ft.off("click")); it = null; a != null && a.remove(); a = null; d != null && d.remove(); d = null; lt != null && lt.remove(); lt = null; ki != null && ki.remove(); ki = null; kt = null; et = null; st = null; e && (at != null && at.remove(), at = null, nt != null && nt.remove(), nt = null, ot != null && ot.remove(), ot = null); g != null && g.remove(); g = null; ai = null; y != null && y != undefined && y.destroy(); y = null; hr != null && hr.remove(); hr = null; vi = null; dt = null; vf = null; yi = null; ht = null; pi = null }; this.sizeChanged = function (n, t) { pu = n; ri = t; wu == !0 && (lf(), this.leftULsize()) }; this.ShowDMSDocumentAttchment = function () { var r = null, f = null, u, i; if (er.children().remove(), u = t("<ul><\/ul>"), n.context.getContext("DocumentAttachViaEmail_" + p.windowNo) != "") { for (tr.empty(), tr.append(n.Msg.getMsg("Documents")), r = n.context.getContext("DocumentAttachViaEmail_" + p.windowNo).split(","), i = 0; i < r.length; i++)r[i].trim() != "" && (f = r[i].split("-"), u.append("<Li><input type='checkbox' checked value='" + f[0] + "'> " + f[1] + "<\/Li>")); er.append(u) } else tr.empty(); u.on("click", "input", function () { var r = "", e = t(this).attr("value"), o, u, i, f; if (t(this).is(":checked")) t(this).is(":checked") && (f = e + "-" + t(this).text(), r = n.context.getContext("DocumentAttachViaEmail_" + p.windowNo) + (r != "" ? "," + f : f)); else for (o = n.context.getContext("DocumentAttachViaEmail_" + p.windowNo).split(","), u = jQuery.grep(o, function (n) { if (!n.trim().contains(e.toString().trim())) return n }), i = 0; i < u.length; i++)r += i == 0 ? u[i].trim() : "," + u[i].trim(); n.context.setContext("DocumentAttachViaEmail_" + p.windowNo, r) }) }; this.IsBusy = function (n) { n ? eu.css("display", "block") : eu.css("display", "none"); eu.appendTo(a) } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; t.hideHeader(!0); this.initializeComponent(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.refresh = function () { window.VADMS && this.ShowDMSDocumentAttchment(); this.leftULsize() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Email = i }(VIS, jQuery), function (n, t) { n.Newmailformat = function (i) { function s() { var r; f = t('<div class="vis-forms-container" ><\/div>'); var i = t('<div class="vis-emailsavewrap"><\/div>'), o = t('<div class="input-group vis-input-wrap"><\/div>'), s = t('<div class="vis-control-wrap"><\/div>'), h = t("<label>" + n.Msg.getMsg("Name") + "<\/label>"); u = t('<input type="text" data-placeholder="" placeholder=" ">'); s.append(u).append(h); labelshow = t('<label class="vis-ec-col-lblchkbox"><input type="checkbox">' + n.Msg.getMsg("ForAllWindows") + "<\/label>"); e = t(labelshow.find("input")[0]); r = t('<div style="display: flex"><\/div>'); e; n.Application.isRTL; r.append(labelshow); i.append(o); o.append(s); i.append(r); f.append(i) } function h() { return u.val() == null || u.val() == "" ? (n.ADialog.info("FileNameMendatory"), !1) : (o.onClose(), !0) } function c() { f.remove(); f = null; u.remove(); u = null; e.remove(); e = null; r = null } var f, u, e, r, o = this; s(); this.show = function () { r = new n.ChildDialog; i ? r.setTitle(n.Msg.getMsg("EmailFormats")) : r.setTitle(n.Msg.getMsg("LetterFormats")); r.setModal(!0); r.setContent(f); r.show(); r.onOkClick = h; r.onClose = c }; this.getName = function () { return u.val() }; this.saveForAll = function () { return e.prop("checked") } } }(VIS, jQuery), function (n, t) { n.Openmailformat = function (i, r) { function l() { u = n.dataContext.getJSONData(n.Application.contextUrl + "Email/GetMailFormat", { Window_ID: i }, null) } function a() { var n = w2ui.openformatgrid.getSelection(); return o = w2ui.openformatgrid.get(n), h.onClose(), !0 } function v() { u = null; s = null; f = null; w2ui.openformatgrid != undefined && w2ui.openformatgrid.destroy(); e.remove() } var s, u = null, o = {}, h = this, c = [], e, f; this.onClose = null; l(); this.show = function () { var o, l, i, s, c, h; if (e = t('<div class="vis-forms-container" style="height:304px"><\/div>'), f = new n.ChildDialog, n.Application.isRTL ? f.setHeight(435) : f.setHeight(430), f.setWidth(850), r ? f.setTitle(n.Msg.getMsg("EmailFormats")) : f.setTitle(n.Msg.getMsg("LetterFormat")), f.setModal(!0), f.setContent(e), f.show(), f.onOkClick = a, f.onClose = v, o = [], l = [], u != null) { for (i in u) u[i].name == "NAME" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Name"), size: "20%", hidden: !1 }) : u[i].name == "SUBJECT" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Subject"), size: "20%", hidden: !1 }) : u[i].name == "MAILTEXT" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Mailtext"), size: "20%", hidden: !1 }) : u[i].name == "CREATED" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Created"), size: "20%", hidden: !1 }) : u[i].name == "ISDYNAMICCONTENT" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("IsDynamicContent"), size: "20%", hidden: !1 }) : o.push({ field: u[i].name, caption: n.Msg.getMsg(u[i].name), size: "100px", hidden: !0 }); for (s = 0; s < u[0].RowCount; s++) { c = {}; c.recid = s; for (h in u) c[u[h].name] = u[h].name == "MAILTEXT" ? u[h].value[s] : n.Utility.encodeText(u[h].value[s]); l.push(c) } } e.w2grid({ name: "openformatgrid", recordHeight: 30, show: { selectColumn: !0 }, multiSelect: !1, columns: o, records: l }) }; this.getSelectedRow = function () { return o }; this.getAttachments = function () { return c } } }(VIS, jQuery), function (n, t) { function e(n, i, r) { var u = null; return t.ajax({ url: o, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function c(i, r, u, f, e, o, s, h) { var a = null, y = o, p = s, c = new n.ReportViewer(f, e), v, l; s > 0 && c.setNodeID(s); o > 0 && c.setTreeID(o); h || c.showSummary(h); i && c.setVAF_TableView_ID(i); v = function (i) { var f, e, r; a = n.context.getVAF_Client_ID(); r = null; f = null; e = []; try { for (r = null, t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetPrintFormats", data: { VAF_TableView_ID: i, VAF_Tab_ID: u }, success: function (t) { r = (new n.DB.DataReader).toJson(t) } }); r.read();)n.Utility.Util.getValueOfInt(r.get(2).toString()) == a && (f = {}, f.Key = n.Utility.Util.getValueOfInt(r.get(0)), f.Name = r.getString(1), e.push(f)); r.close(); e.length == 0 ? f == null ? l(null, i, i) : l(f, 0, i) : l(e[0], 0, i) } catch (o) { r.close() } }; l = function (i, f, e) { var o = [], s, l; o.push(r.getTableName()); o.push(r.getWhereClause(!0)); u && o.push(u.toString()); s = null; s = i != null ? i.Key : f; l = c.getGenerateReportPara(o, r.getCode(0), f > 0 && u > 0, p, y, h, 0, 1, "", s); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: l, type: "POST", success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var f = jQuery.parseJSON(t), u = f.repInfo; if (u.IsError) { n.ADialog.error(u.ErrorText); c.close(); return } u.HTML && u.HTML.length > 0 && (c.show(u.HTML, u.VAF_Print_Rpt_Layout_ID, i, e, o, r.getCode(0), f.pSetting), c.setReportBytes(u.Report), c.setIteration(f.pSetting.TotalPage), (n.context.ctx.$AutoArchive == "1" || n.context.ctx.$AutoArchive == "2") && c.archiveDocument(o, e, u.Report)) } }) }; v(i) } function l(i, r, u) { function ri(n) { var i = t("#reportcreate").find(".progress-bar").width() * 100 / t("#reportcreate").width(); isNaN(i) && (i = 0); i <= n && t("#reportcreate").removeClass("hide").find(".progress-bar").attr("aria-valuenow", n).css({ width: n + "%" }).text(n.toFixed(0) + "%") } function wi() { t("#reportcreateresult").removeClass().text("") } function bi(n) { wi(); t("#reportcreateresult").addClass("alert alert-success").text(n); t("#forreportdownload").removeClass("hide") } function ur() { var n = window.open(), i; n.document.write("<html ><head>"); n.document.write("<\/head><body >"); i = t(ai); t(i.children()).css({ overflow: "hidden" }); n.document.write(i.html()); n.document.write("<\/body><\/html>"); n.print(); n.close() } function fr() { si = t('<ul class="vis-statusbar-ul vis-toppaging">'); a = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" aria-hidden="true" title="First Page"><\/i><\/div><\/li>'); v = t('<li style="opacity: 1;"><div><i class="vis vis-arrow-left" aria-hidden="true" title="Page Up"><\/i><\/div><\/li>'); e = t("<select>"); pi = t("<li>").append(e); y = t('<li style="opacity: 1;"><div><i class="vis vis-arrow-right" aria-hidden="true" title="Page down"><\/i><\/div><\/li>'); p = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" aria-hidden="true" title="Last Page"><\/i><\/div><\/li>'); si.append(a).append(v).append(pi).append(y).append(p); er() } function er() { a.on("click", function () { t(this).css("opacity") == "1" && ut(1) }); v.on("click", function () { t(this).css("opacity") == "1" && ut(parseInt(e.val()) - 1) }); y.on("click", function () { t(this).css("opacity") == "1" && ut(parseInt(e.val()) + 1) }); p.on("click", function () { t(this).css("opacity") == "1" && ut(parseInt(e.find("Option:last").val())) }); e.on("change", function () { ut(e.val()) }) } function ci(n) { if (e.empty(), n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)e.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); e.val(n.CurrentPage); it.setIteration(n.TotalPage); n.TotalPage > n.CurrentPage ? (y.css("opacity", "1"), p.css("opacity", "1")) : (y.css("opacity", "0.6"), p.css("opacity", "0.6")); n.CurrentPage > 1 ? (a.css("opacity", "1"), v.css("opacity", "1")) : (a.css("opacity", "0.6"), v.css("opacity", "0.6")); n.TotalPage == 1 && (a.css("opacity", "0.6"), v.css("opacity", "0.6"), y.css("opacity", "0.6"), p.css("opacity", "0.6")) } else a.css("opacity", "0.6"), v.css("opacity", "0.6"), y.css("opacity", "0.6"), p.css("opacity", "0.6") } var g = t("<div class='vis-reportrootdiv'>"), d = null, wt = null, bt = null, s = null, kt = null, dt = null, gt = null, ni = null, ti = null, ht = null, ct = null, ft = null, et = null, c = null, ai = null, nt = null, tr = null, l = null, tt = null, lt = null, ir = n.Env.getScreenHeight() - 50, fi = t(window).width(), it = this, st, rr, rt, b, hi, ki, di, ui, k, li; c = new n.CFrame; c.setName(n.Msg.getMsg("Report")); c.setTitle(n.Msg.getMsg("Report")); var ei = null, vi = t("<div>"), ot = t("<ul class='vis-apanel-rb-ul'>"); vi.append(ot); var yi = !1, h = [], ii = null, at = 0, vt = 0, oi, si, a, v, pi, y, p, e, yt = !0, w = null; this.getGenerateReportPara = function (t, i, r, u, f, e, o, s, h, c) { w || (w = new n.ProcessInfo("", 0, l, 0), w.setVAF_UserContact_ID(n.context.getVAF_UserContact_ID()), w.setVAF_Client_ID(n.context.getVAF_Client_ID())); w.setVAF_JInstance_ID(o); w.setPageNo(s); w.setFileType(h); w.set_VAF_Print_Rpt_Layout_ID(c); return { processInfo: w.toJson(), queryInfo: JSON.stringify(t), code: i, isCreateNew: r, treeID: f, node_ID: u, IsSummary: e } }; this.setNodeID = function (n) { at = n }; this.setTreeID = function (n) { vt = n }; this.setVAF_TableView_ID = function () { l = l }; this.showSummary = function (n) { yt = n }; this.setReportBytes = function (n) { ii = n }; st = 0; this.setIteration = function (n) { st = n }; this.archiveDocument = function (i, r, u) { o(!0); t.ajax({ url: n.Application.contextUrl + "JsonData/ArchiveDoc/", dataType: "json", type: "post", data: { VAF_Job_ID: 0, Name: i[0], VAF_TableView_ID: r, Record_ID: 0, VAB_BusinessPartner_ID: 0, isReport: !0, binaryData: u }, success: function () { n.ADialog.info("Archived", !0, "", ""); o(!1) } }) }; rr = function () { for (var i, r, u, n = 0; n < arguments.length; n++)i = t('<iframe style="visibility: collapse;"><\/iframe>'), t("body").append(i), r = i[0].contentDocument, u = '<form action="' + arguments[n] + '" method="GET"><\/form>', r.write(u), t("form", r).submit(), setTimeout(function (n) { return function () { n.remove() } }(i), 2e3) }; rt = ""; b = 0; this.getRoot = function () { return g }; this.dispose = function () { }; this.show = function (t, i, r, f, e, o, s) { tr = r; l = f; tt = e; nt = i; lt = o; yi = n.MRole.getDefault().getIsCanExport(l); u != !0 && (yi ? (ct.css("display", "inline-flex"), ht.css("display", "inline-flex"), n.context.ctx["#BULK_REPORT_DOWNLOAD"] == "Y" ? (et.css("display", "inline-flex"), ft.css("display", "inline-flex")) : (et.css("display", "none"), ft.css("display", "none"))) : (ct.css("display", "none"), ht.css("display", "none"), et.css("display", "none"), ft.css("display", "none"))); pt(t); s && ci(s) }; hi = function () { if (u) { var n = g.children()[1]; n = null } a.off("click"); v.off("click"); y.off("click"); p.off("click"); e.off("change"); g.empty(); g.remove(); s && s.empty(); d.empty(); d.remove(); c && (c.dispose(), c = null); a = v = y = p = e = null; g = null; d = null; wt = null; bt = null; s = null; kt = null; dt = null; gt = null; ni = null; ti = null }; this.close = function () { hi() }; ki = function () { d = t("<div class='vis-report-header' style='padding: 0;'>").append(t('<h3 class="vis-report-tittle">').append(n.Msg.getMsg("Report"))); wt = t('<a href="javascript:void(0)" class="vis-icon-menuclose vis vis-cross">'); bt = t('<div class="vis-report-top-icons">'); s = t('<ul class="vis-reporticonsul">'); bt.append(s); ei = t("<li><a  title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("ReportFormat")) + "'  class='vis vis-format'><\/a><\/li>"); s.append(ei); ct = t("<li><a  title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveCSV")) + "' class='vis vis-save-csv'><\/a><\/li>"); s.append(ct); et = t("<li style='display:none'><a  title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveAllRecordCsv")) + "' class='vis vis-csv-all'><\/a><\/li>"); s.append(et); ht = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SavePdf")) + "' class='vis vis-save-pdf'><\/a><\/li>"); s.append(ht); ft = t("<li style='display:none'><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveAllPagePdf")) + "' class='vis vis-pdf-all'><\/a><\/li>"); s.append(ft); kt = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Archive")) + "' class='vis vis-archive'><\/a><\/li>"); s.append(kt); dt = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Requery")) + "' class='vis vis-refresh'><\/a><\/li>"); s.append(dt); gt = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Search")) + "' class='vis vis-find'><\/a><\/li>"); s.append(gt); ni = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("PrintCustomize")) + "' class='vis vis-customize'><\/a><\/li>"); s.append(ni); ti = t('<li><a title="' + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Print")) + '" class="vis vis-print"><\/a><\/li>'); s.append(ti); oi = t("<div class='vis-report-top-icons'>"); fr(); oi.append(si); d.append(oi); d.append(bt); d.append(wt); g.append(d); di() }; di = function () { wt.on("click", function () { hi() }); ti.on("click", function () { ur() }); ni.on("click", function () { var t = new n.Query; t.addRestriction("VAF_Print_Rpt_Layout_ID", n.Query.prototype.EQUAL, nt); n.viewManager.startWindow(240, t) }); dt.on("click", function () { k.empty(); k.css("width", "0px"); ut(e.val()) }); ht.on("click", function () { gi(e.val(), 0); null }); ct.on("click", function () { nr(e.val(), 0, null) }); ft.on("click", function () { var r, t; for (b = 0, rt = "", r = new n.BulkDownload(i, "PDF"), r.show(), t = 1; t <= st; t++)gi(t, st, r) }); et.on("click", function () { var r, t; for (b = 0, rt = "", r = new n.BulkDownload(i, "CSV"), r.show(), t = 1; t <= st; t++)nr(t, st, r) }); ei.on("click", function () { var i, r, u; for (ot.empty(), i = 0; i < h.length; i++)h[i].ID && (r = h[i].IsDefault == "Y" ? "vis-favitmchecked" : "vis-favitmunchecked", u = t('<li data-isdefbtn="no" data-id="' + h[i].ID + '"><a data-isdefbtn="no" data-id="' + h[i].ID + '">' + h[i].Name + '<\/a><a data-isdefbtn="yes" data-id="' + h[i].ID + '" style="min-height: 16px;display: inline-block;margin-left: 5px;min-width: 16px;margin-top: 0px" class="vis-menufavitm ' + r + '" > <\/a><\/li>'), ot.append(u)); ot.append(t('<li data-isdefbtn="no" data-id="-1"><a data-id="-1">' + n.Msg.getMsg("NewReport") + "<\/a>")); t(this).w2overlay(vi.clone(!0), { css: { height: "300px" } }) }); ot.on("click", "LI", function (i) { var y = t(i.target), s = y.data("id"), c, u, a, v, p; if (s) { if (y.data("isdefbtn") == "yes") { for (c = "VIS_102", u = [], u[0] = new n.DB.SqlParam("@vaf_tableview_ID", l), u[1] = new n.DB.SqlParam("@VAF_Tab_ID", r.getVAF_Tab_ID()), f(c, u), c = "VIS_103", u = [], u[0] = new n.DB.SqlParam("@id", s), f(c, u), a = 0; a < h.length; a++)h[a].IsDefault = h[a].ID == s ? "Y" : "N"; return } nt = s; k.empty(); k.css("width", "0px"); o(!0); v = !1; s == -1 && (s = l, v = !0); p = it.getGenerateReportPara(tt, lt, v, at, vt, yt, 0, e.val(), "", s); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: p, type: "POST", success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var r = jQuery.parseJSON(t), i = r.repInfo; if (i.ErrorText) { n.ADialog.error(i.ErrorText); o(!1); return } pt(i.HTML); ii = i.Report; ci(r.pSetting); nt = i.VAF_Print_Rpt_Layout_ID; o(!1) } }) } }); gt.on("click", function () { var t = new n.Find(i, r, 0); t.onClose = function () { if (t.getIsOKPressed()) { var n = t.getQuery(), i = t.getCurrentDays(), r = t.getIsCreated(); t.dispose(); t = null; tt[1] = n.getWhereClause(!0); ut(1) } }; t.show() }); kt.on("click", function () { it.archiveDocument(tt, l, ii) }) }; var ut = function (i) { o(!0); var r = it.getGenerateReportPara(tt, lt, !1, at, vt, yt, 0, i, "", nt); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: r, type: "POST", success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var r = jQuery.parseJSON(t), i = r.repInfo; if (i.ErrorText) { n.ADialog.error(i.ErrorText); o(!1); return } pt(i.HTML); ii = i.Report; ci(r.pSetting); o(!1) } }) }, gi = function (i, r, u) { o(!0); var f = it.getGenerateReportPara(tt, lt, !1, at, vt, yt, 0, i, n.ProcessCtl.prototype.REPORT_TYPE_PDF, nt); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: f, type: "POST", success: function (f) { f == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var s = jQuery.parseJSON(f), e = s.repInfo; if (e.ErrorText) { n.ADialog.error(e.ErrorText); o(!1); return } e.HTML && e.HTML.length > 0 ? pt(e.HTML) : r == 0 ? window.open(n.Application.contextUrl + e.ReportFilePath) : (u.setBulkBusy(!1), t("#forreportdownload").addClass("hide"), rt += '<input type="checkbox" data-num="' + i + '"  data-url="' + n.Application.contextUrl + e.ReportFilePath + '" checked />', b += 1, ri(b / r * 100), b == r && setTimeout(function () { ri(100); bi(n.Msg.getMsg("Generated")); t("<form>", { id: "download_form", html: rt, action: "#", Class: "hide" }).appendTo(document.body).submit() }, 1e3)); o(!1) } }) }, nr = function (i, r, u) { o(!0); var f = it.getGenerateReportPara(tt, lt, !1, at, vt, yt, 0, i, n.ProcessCtl.prototype.REPORT_TYPE_CSV, nt); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: f, type: "POST", success: function (f) { f == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var s = jQuery.parseJSON(f), e = s.repInfo; if (e.ErrorText) { n.ADialog.error(e.ErrorText); o(!1); return } e.HTML && e.HTML.length > 0 ? pt(e.HTML) : r == 0 ? window.open(n.Application.contextUrl + e.ReportFilePath) : (u.setBulkBusy(!1), t("#forreportdownload").addClass("hide"), rt += '<input type="checkbox" data-num="' + i + '" data-url="' + n.Application.contextUrl + e.ReportFilePath + '" checked />', b += 1, ri(b / r * 100), b == r && setTimeout(function () { ri(100); bi(n.Msg.getMsg("Generated")); t("<form>", { id: "download_form", html: rt, action: "#", Class: "hide" }).appendTo(document.body).submit() }, 1e3)); o(!1) } }) }, pt = function (i) { var e, s, c, b; if (u != !0) { ot.empty(); var f = null, p = [], a = -1; try { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetShowReportDetails", data: { VAF_TableView_ID: l, VAF_Tab_ID: r.getVAF_Tab_ID() }, success: function (t) { f = (new n.DB.DataReader).toJson(t) } }), h = []; f.read();)a = parseInt(a) + 1, e = f.getString(1), p.indexOf(e) > -1 && (e = e + "_" + (parseInt(a) + 1)), s = {}, s.ID = n.Utility.Util.getValueOfInt(f.get(0)), s.Name = e, s.IsDefault = f.getString(3), p.push(f.getString(1)), h.push(s); f.close() } catch (d) { console.log(d) } f = null; k.html(i); k.css("min-width", fi + "px"); ai = i; var w = document.getElementsByClassName("vis-reptabledetect"), v = 0, y = 0; for (c = 0, b = w.length; c < b; c++)y = t(w[c]).width(), y > v && (v = y); k.css("width", v + 50) } o(!1) }, o = function (n) { li.css("display", n ? "block" : "none") }; ki(); ui = t("<div Style='width:" + fi + "px; max-height: " + (ir - 50) + "px;' class='vis-report-a-r-container'>"); k = t("<div Style='width:" + fi + "px;'>"); ui.append(k); li = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); o(!0); ui.append(li); u || g.append(ui); c.hideHeader(!0); c.setContent(it); c.show() } function a(u, f, e, o, s) { function l(f) { t.ajax({ url: n.Application.contextUrl + "JsonData/GetReportFileTypes/", dataType: "json", data: { VAF_Job_ID: u }, success: function (n) { var e, u, o; if (n != null && (e = jQuery.parseJSON(n), e.length != 0)) { for (u = 0; u < e.length; u++)o = "", o = u == 0 ? t("<li tabindex=" + u + " data-val=" + e[u].Key + " class='vis-selected-li-print'>" + e[u].Name + "<\/li>") : t("<li tabindex=" + u + " data-val=" + e[u].Key + ">" + e[u].Name + "<\/li>"), i.append(o), o = null; f.w2overlay(r.clone(!0), { css: { height: "300px" } }) } } }) } function c(i, r, h) { s && s.length != 0 ? t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateMultiPrint/", dataType: "json", data: { VAF_Job_ID: u, Name: "Print", VAF_TableView_ID: f, RecIDs: s, WindowNo: o, filetype: h }, success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var i = jQuery.parseJSON(t); if (r && r(), i.IsError) { n.ADialog.error(i.ErrorText); return } i.ReportFilePath && window.open(n.Application.contextUrl + i.ReportFilePath) } }) : t.ajax({ url: n.Application.contextUrl + "JsonData/GeneratePrint/", dataType: "json", data: { VAF_Job_ID: u, Name: "Print", VAF_TableView_ID: f, Record_ID: e, WindowNo: o, filetype: h }, success: function (t) { var i, u, e; if (t == null && alert(n.Msg.getMsg("ERRORGettingRepData")), i = jQuery.parseJSON(t), r && r(), i.IsError) { n.ADialog.error("", "", i.Message, null); return } i.ReportFilePath ? window.open(n.Application.contextUrl + i.ReportFilePath) : i.IsTelerikReport ? window.KJS && (u = new KJS.TelerikContainer(i.VAF_JInstance_ID, f), u.show(), this.unlock()) : n.context.getIsUseCrystalReportViewer() && (e = new n.ReportViewerContainer(i), e.show()) } }) } i.off("click"); i.on("click", "LI", function (n) { var i = t(n.target).data("val"); c(!1, null, i) }); this.start = function (f) { function s() { var i = t(t(t(document).find(".w2ui-overlay").find("li"))[0]), n = i.eq(0); t("#w2ui-overlay-main").attr("tabindex", 1); t("#w2ui-overlay-main").focus(); t("#w2ui-overlay-main").keydown(function (r) { if (r.which === 40) n ? (n.hasClass("vis-selected-li-print") && n.removeClass("vis-selected-li-print"), next = n.next(), n = next.length > 0 ? next.addClass("vis-selected-li-print") : i.eq(0).addClass("vis-selected-li-print")) : n = i.eq(0).addClass("vis-selected-li-print"); else if (r.which === 38) n ? (n.hasClass("vis-selected-li-print") && n.removeClass("vis-selected-li-print"), next = n.prev(), n = next.length > 0 ? next.addClass("vis-selected-li-print") : i.last().addClass("vis-selected-li-print")) : n = i.last().addClass("vis-selected-li-print"); else if (r.which === 13) { if (n) { var u = n.data("val"); c(!1, null, u); t("#w2ui-overlay-main").off("keydown"); t("#w2ui-overlay-main").remove() } } else t("#w2ui-overlay-main").off("keydown"), t("#w2ui-overlay-main").remove(); return r.stopPropagation(), !1 }) } var e = [], o; if (e[0] = new n.DB.SqlParam("@VAF_Job_ID", u), o = h("VIS_149", e), o == "Y" && n.context.getIsUseCrystalReportViewer()) { c(!1, null, n.ProcessCtl.prototype.REPORT_TYPE_PDF); return } i.find("LI").length > 0 ? (f.w2overlay(r.clone(!0), { css: { height: "300px" } }), window.setTimeout(function () { s() }, 100)) : (l(f), window.setTimeout(function () { s() }, 100)) }; this.startPdf = function (t) { c(!1, t, n.ProcessCtl.prototype.REPORT_TYPE_PDF) }; this.startCsv = function (t) { c(!0, t, n.ProcessCtl.prototype.REPORT_TYPE_CSV) } } function v(i) { var r = t('<div class="vis-reportrootdiv"> '), u = t("<div class='vis-apanel-busy bsyCrsyVwr' style='width:98%;height:98%;position:absolute'>"), f; this.getRoot = function () { return r }; this.addReport = function () { r.append(u); f(!0); var e = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"); i.pi && i.pi.getVAF_JInstance_ID() ? e.attr("src", n.Application.contextUrl + "Areas/VIS/WebPages/CrystalReprotViewer.aspx?title=rpt&aid=" + i.pi.getVAF_JInstance_ID() + "&pid=" + i.pi.getVAF_Job_ID() + "&tid=" + i.pi.getTable_ID() + "&rid=" + i.pi.getRecord_ID()) : e.attr("src", n.Application.contextUrl + "Areas/VIS/WebPages/CrystalReprotViewer.aspx?title=rpt&aid=" + i.VAF_JInstance_ID + "&pid=" + i.VAF_Job_ID + "&tid=" + i.VAF_TableView_ID + "&rid=" + i.RecordID); r.append(e) }; this.dispose = function () { r.remove(); r = null }; f = function (n) { u.css("display", n ? "block" : "none") }; this.show = function () { var t = new n.CFrame; t.setName(n.Msg.getMsg("Report")); t.setTitle(n.Msg.getMsg("Report")); t.setContent(this); this.addReport(); t.show() } } var r = t('<div class="vis-reportrootdiv">'), i = t("<ul class='vis-apanel-rb-ul'  style='width:100%;height:100%'>"); r.append(i); var u = n.Application.contextUrl, o = u + "JsonData/JDataSetWithCode", s = u + "JsonData/ExecuteNonQuer", y = function (t, i, r) { var o = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, e(f, o, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, f = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n, param: i }; return t.ajax({ url: s + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }, h = function (t, i, r) { var f = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u; return i && (o.param = i), u = null, e(o, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; n.ReportViewer = l; n.AReport = c; n.APrint = a; n.ReportViewerContainer = v }(VIS, jQuery), function (n, t) { n.AttachmentHistory = function (i, r, u, f, e) { function ye() { o = t("<div>"); o.css({ position: "absolute", bottom: "0", background: "url('" + n.Application.contextUrl + "Areas/VIS/Images/busy.gif') no-repeat", "background-position": "center center", width: "98%", height: "98%", "text-align": "center", opacity: ".1" }); o[0].style.visibility = "hidden"; br.append(o) } function pe() { br = t('<div class="vis-forms-container" style="height:100%">'); d = t('<div class="vis-history-inboxDiv">'); yt = t('<div style="display:none" class="vis-history-mainRelatedDiv">'); di = t('<div style="display:none" class="vis-history-mainRelatedDiv">'); kr = t('<div class="vis-attachhistory-content-wrap">'); yu = t('<div class="vis-attachhistory-left-wrap">'); dr = t('<div class="vis-attachhistory-table-top">'); gi = t('<div class="vis-attachhistory-search-wrap">'); du = t('<div class="vis-attachhistory-search">').append(' <input placeholder="' + n.Msg.getMsg("Search") + '" type="text">').append('<span class="vis-attachhistory-search-icon vis vis-search"><\/span>'); gi.append('<i class="prthistory vis vis-print" title="' + n.Msg.getMsg("Print") + '"><\/i>').append(du); v = t('<div class="vis-attachhistory-right-wrap">'); k = t('<div class="vis-attachhistory-right-wrap">').hide(); bu == !0 ? k.append('<label class="vis-attachhistory-noRecFoundforIP" > ' + n.Msg.getMsg("NoRecordFound") + " <\/label>") : k.append('<label class="vis-attachhistory-noRecFound" > ' + n.Msg.getMsg("NoRecordFound") + " <\/label>"); pu = t('<div class="vis-attachhistory-apanel-tabcontrol">'); nr = t('<ul class="vis-attachhistory-appsaction-ul vis-attachhistory-apanel-tabcontrol-ul">'); nr.append('<li data-type="History" class="vis-attachhistory-apanel-tab-selected" style="opacity: 1;">' + n.Msg.getMsg("History") + '<\/li><li  data-type="RelatedHistory"  style="opacity: 1;">' + n.Msg.getMsg("RelatedHistory") + "<\/li>"); u > 0 && nr.append('<li  data-type="UserHistory"  style="opacity: 1;">' + n.Msg.getMsg("UserHistory") + "<\/li>"); dr.append(pu.append(nr)); wu = t('<div class="vis-attachhistory-table-wrap">').append(d).append(yt).append(di).append(ou); br.append(kr.append(yu.append(dr).append(wu))); kr.append(gi).append(v).append(k); ht = gi.find("input"); ve = du.find(".prthistory"); ni = t('<ul class="vis-his-attachs">'); oi = t('<ul class="vis-his-attachs">'); ku = t("<ul class='vis-apanel-rb-ul'>"); ku.append('<li style="display:none" data-type="R"><a><span class="vis-attachhistory-email-icon vis-attachhistory-reply-icon"><\/span>' + n.Msg.getMsg("Reply") + '<\/a><\/li> <li data-type="F"><a><span class="vis-attachhistory-email-icon vis-attachhistory-forword-icon vis vis-undo2"><\/span>' + n.Msg.getMsg("Forward") + "<\/a><\/li>") } function we() { ou = t('<ul style="margin-top:10px" class="vis-statusbar-ul pull-right">'); et = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" style="opacity: 0.6;"><\/i><\/div><\/li>'); ot = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" style="opacity: 0.6;"><\/i><\/div><\/li>'); gt = t('<li><select class="vis-statusbar-combo"><\/select><\/li>'); lt = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" style="opacity: 0.6;"><\/i><\/div><\/li>'); ct = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" style="opacity: 0.6;"><\/i><\/div><\/li>'); ou.append(et).append(ot).append(gt).append(lt).append(ct) } function re(u) { var e, f; for (o[0].style.visibility = "visible", t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadRecordDataCount", datatype: "json", async: !1, type: "get", cache: !1, data: { searchText: u, _VAF_TableView_ID: i, _Record_ID: r }, success: function (n) { uf = JSON.parse(n) } }), e = parseInt(uf / li), ui = e + (uf % li > 0 ? 1 : 0), it = 1, s = gt.find("select"), s.empty(), f = 1; f <= ui; f++)s.append("<option>" + f + "<\/option>"); et.css("opacity", "0.6"); ot.css("opacity", "0.6") } function sr(u) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadRecordData", datatype: "json", type: "get", async: !1, cache: !1, data: { searchText: u, _VAF_TableView_ID: i, _Record_ID: r, historyPageNo: it, pageSize: li }, success: function (n) { n = JSON.parse(n); de(n) }, error: function () { } }) } function hr(i) { (i == undefined || i == null) && (i = ""); t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/RelatedHistory", datatype: "json", type: "get", cache: !1, data: { keyColumnID: r, pageSize: li, pageNo: nt, searchText: n.Utility.encodeText(i), keyColName: e }, success: function (n) { var i = JSON.parse(n), r, t; if (ke(i), fu == undefined || fu == 0 || ki == !0) { for (fu = i.TotalRecords, r = parseInt(fu / li), nt = 1, fi = r + (fu % li > 0 ? 1 : 0), s = gt.find("select"), s.empty(), t = 1; t <= fi; t++)s.append("<option>" + t + "<\/option>"); et.css("opacity", "0.6"); ot.css("opacity", "0.6"); no() } else to(); o[0].style.visibility = "hidden"; ki = !1 }, error: function (n) { console.log(n); o[0].style.visibility = "hidden"; ki = !1 } }) } function cr(i) { (i == undefined || i == null) && (i = ""); t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/UserHistory", datatype: "json", type: "get", cache: !1, data: { VAB_BusinessPartner_ID: u, pageSize: li, pageNo: tt, searchText: n.Utility.encodeText(i) }, success: function (n) { var i = JSON.parse(n), r, t; if (i.RHistory != null && be(i), eu == undefined || eu == 0 || ki == !0) { for (eu = i.TotalRecords, r = parseInt(eu / li), tt = 1, ei = r + (eu % li > 0 ? 1 : 0), s = gt.find("select"), s.empty(), t = 1; t <= ei; t++)s.append("<option>" + t + "<\/option>"); et.css("opacity", "0.6"); ot.css("opacity", "0.6"); ge() } else io(); o[0].style.visibility = "hidden"; ki = !1 }, error: function (n) { console.log(n); o[0].style.visibility = "hidden"; ki = !1 } }) } function be(i) { var u, f, e, r; for (bt = [], vi = [], u = i.RHistory, bt.push({ field: "ID", caption: n.Msg.getMsg("id"), size: "150px", hidden: !0 }), bt.push({ field: "Record_ID", caption: n.Msg.getMsg("record_id"), size: "150px", hidden: !0 }), bt.push({ field: "Created", caption: n.Msg.getMsg("Date"), size: "150px", hidden: !1 }), bt.push({ field: "Type", caption: n.Msg.getMsg("Type"), size: "150px", hidden: !1 }), n.Application.isRTL ? bt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: right", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.VAF_TableView_ID + '" ><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }) : bt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: left", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.VAF_TableView_ID + '" ><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }), bt.push({ field: "Subject", caption: n.Msg.getMsg("Subject"), size: "150px", hidden: !1 }), bt.push({ field: "UserName", caption: n.Msg.getMsg("UserName"), size: "150px", hidden: !1 }), u.length > 0 && (y = Object.keys(u[0])), r = 0; r < y.length; r++)if (y[r] == "ID" || y[r] == "Record_ID" || y[r] == "Created" || y[r] == "Type" || y[r] == "TableName" || y[r] == "Subject" || y[r] == "UserName") continue; else bt.push({ field: y[r], caption: n.Msg.getMsg(y[r]), size: "100px", hidden: !0 }); for (f = 0; f < u.length; f++) { for (e = {}, e.recid = f, r = 0; r < y.length; r++)y[r] == "Created" ? e[y[r]] = new Date(u[f][y[r]]).toLocaleString() : y[r] == "Type" ? u[f][y[r]] == "A" ? e[y[r]] = n.Msg.getMsg("Appointment") : u[f][y[r]] == "T" ? e[y[r]] = n.Msg.getMsg("Task") : u[f][y[r]] == "L" ? e[y[r]] = n.Msg.getMsg("Letter") : u[f][y[r]] == "M" ? e[y[r]] = n.Msg.getMsg("SentMail") : (u[f][y[r]] == "Z" || u[f][y[r]] == "I") && (e[y[r]] = n.Msg.getMsg("InboxMail")) : e[y[r]] = n.Utility.encodeText(u[f][y[r]]); vi.push(e) } } function ke(i) { var u, f, e, r; for (dt = [], ai = [], u = i.RHistory, dt.push({ field: "ID", caption: n.Msg.getMsg("id"), size: "150px", hidden: !0 }), dt.push({ field: "Record_ID", caption: n.Msg.getMsg("record_id"), size: "150px", hidden: !0 }), dt.push({ field: "Created", caption: n.Msg.getMsg("Date"), size: "150px", hidden: !1 }), dt.push({ field: "Type", caption: n.Msg.getMsg("Type"), size: "150px", hidden: !1 }), n.Application.isRTL ? dt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: right", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.VAF_TableView_ID + '"><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }) : dt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: left", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.VAF_TableView_ID + '"><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }), dt.push({ field: "Subject", caption: n.Msg.getMsg("Subject"), size: "150px", hidden: !1 }), u.length > 0 && (h = Object.keys(u[0])), r = 0; r < h.length; r++)if (h[r] == "ID" || h[r] == "Record_ID" || h[r] == "Created" || h[r] == "Type" || h[r] == "TableName" || h[r] == "Subject") continue; else dt.push({ field: h[r], caption: n.Msg.getMsg(h[r]), size: "100px", hidden: !0 }); for (f = 0; f < u.length; f++) { for (e = {}, e.recid = f, r = 0; r < h.length; r++)h[r] == "Created" ? e[h[r]] = new Date(u[f][h[r]]).toLocaleString() : h[r] == "Type" ? u[f][h[r]] == "A" ? e[h[r]] = n.Msg.getMsg("Appointment") : u[f][h[r]] == "T" ? e[h[r]] = n.Msg.getMsg("Task") : u[f][h[r]] == "L" ? e[h[r]] = n.Msg.getMsg("Letter") : u[f][h[r]] == "M" ? e[h[r]] = n.Msg.getMsg("SentMail") : u[f][h[r]] == "I" && (e[h[r]] = n.Msg.getMsg("InboxMail")) : e[h[r]] = n.Utility.encodeText(u[f][h[r]]); ai.push(e) } } function de(t) { var i, u, r, f; for (wt = [], si = [], wt.push({ field: "id", caption: n.Msg.getMsg("id"), size: "150px", hidden: !0 }), wt.push({ field: "record_id", caption: n.Msg.getMsg("record_id"), size: "150px", hidden: !0 }), wt.push({ field: "created", caption: n.Msg.getMsg("Date"), size: "150px", hidden: !1 }), wt.push({ field: "type", caption: n.Msg.getMsg("Type"), size: "150px", hidden: !1 }), wt.push({ field: "name", caption: n.Msg.getMsg("CreatedBy"), size: "150px", hidden: !1 }), bu == !0 ? wt.push({ field: "subject", caption: n.Msg.getMsg("Subject"), size: "150px", hidden: !1 }) : wt.push({ field: "subject", caption: n.Msg.getMsg("Subject"), size: "230px", hidden: !1 }), t.length > 0 && (h = Object.keys(t[0])), i = 0; i < t.length; i++) { for (u = {}, u.recid = i, r = 0; r < h.length; r++)f = h[r], u[f] = h[r] == "created" ? new Date(t[i][f]).toLocaleString() : n.Utility.encodeText(t[i][f]); si.push(u) } } function ge() { b != undefined && b != null && (b.destroy(), b = null); b = di.w2grid({ name: "userhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: bt, records: vi }); b.on("select", wr); b.on("search", pr); vi.length > 0 ? (b.select(0), k.hide(), v.show()) : (k.show(), v.hide()); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function no() { p != undefined && p != null && (p.destroy(), p = null); p = yt.w2grid({ name: "realtedhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: dt, records: ai }); p.on("select", wr); p.on("search", pr); ai.length > 0 ? (p.select(0), k.hide(), v.show()) : (k.show(), v.hide()); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function vr() { ut.destroy(); ut = null; ut = d.w2grid({ name: "historyinboxgrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: wt, records: si }); ut.on("select", wr); ut.on("search", pr); si.length > 0 ? (ut.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; o[0].style.visibility = "hidden" } function to() { p.destroy(); p = null; p = yt.w2grid({ name: "realtedhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: dt, records: ai }); p.on("select", wr); p.on("search", pr); ai.length > 0 ? (p.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; t(".findImg").off("click"); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function io() { b.destroy(); b = null; b = di.w2grid({ name: "userhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: bt, records: vi }); b.on("select", wr); b.on("search", pr); vi.length > 0 ? (b.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; t(".findImg").off("click"); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function ro() { nr.on("click", lo); gi.find("input").on("keydown", fe); gi.find("i").on("click", fo); ni.on("click", po); oi.on("click", wo); v.on("keydown", ce); v.on("click", ce); lt.on("click", eo); ot.on("click", oo); gt.on("change", so); et.on("click", ho); ct.on("click", co); ku.on(n.Events.onTouchStartOrClick, "LI", function (n) { var i = t(this).data("type"); uo(i, n) }) } function uo(t) { var f = null, u; t == "R" || t == "F" && (f = new n.Email("", null, null, r, !0, !0, i, hi.html(), ar.text(), pf)); u = new n.CFrame; u.setName(n.Msg.getMsg("EMail")); u.setTitle(n.Msg.getMsg("EMail")); u.hideHeader(!0); u.setContent(f); u.show(); f.initializeComponent(); kt.close() } function fo() { g != undefined && g.is(":visible") == !0 ? (t(".vis-attachhistory-right-row > ul > li").css("float", "left"), t(".vis-attachhistory-right-row > ul").css("height", "auto"), ue(g.html()), t(".vis-attachhistory-right-row > ul > li").css("float", "none"), t(".vis-attachhistory-right-row > ul").css("height", "45px")) : l != undefined && l.is(":visible") == !0 && (t(".vis-attachhistory-right-row > ul > li").css("float", "left"), t(".vis-attachhistory-right-row > ul").css("height", "auto"), t(t(".vis-attachhistory-to").find("p")).text(t(t(".vis-attachhistory-to").find("p")).text().replace(/;/g, "; ")), t(t(".vis-attachhistory-bcc").find("p")).text(t(t(".vis-attachhistory-bcc").find("p")).text().replace(/;/g, "; ")), t(t(".vis-attachhistory-cc").find("p")).text(t(t(".vis-attachhistory-cc").find("p")).text().replace(/;/g, "; ")), ue(l.html()), t(".vis-attachhistory-right-row > ul > li").css("float", "none"), t(".vis-attachhistory-right-row > ul").css("height", "45px"), t(t(".vis-attachhistory-to").find("p")).text(t(t(".vis-attachhistory-to").find("p")).text().replace(/; /g, ";")), t(t(".vis-attachhistory-bcc").find("p")).text(t(t(".vis-attachhistory-bcc").find("p")).text().replace(/; /g, ";")), t(t(".vis-attachhistory-cc").find("p")).text(t(t(".vis-attachhistory-cc").find("p")).text().replace(/; /g, ";"))) } function ue(t) { var i = window.open(), r = '<link rel="stylesheet" href="' + n.Application.contextUrl + 'Areas/VIS/Content/VIS.all.min.css" />'; i.document.write(r + t); setTimeout(function () { i.print(); i.close() }, 300) } function fe(n) { (n.keyCode == undefined || n.keyCode == 13) && ht != undefined && ht != null && (ki = !0, d.is(":visible") ? (o[0].style.visibility = "visible", re(ht.val()), sr(ht.val()), ne = ht.val(), vr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", hr(ht.val()), te = ht.val()) : (o[0].style.visibility = "visible", cr(ht.val()), ie = ht.val())) } function eo() { d.is(":visible") ? (it < ui && (o[0].style.visibility = "visible", it++, s.val(it), sr(), vr()), yr()) : yt.is(":visible") ? nt < fi && (o[0].style.visibility = "visible", nt++, s.val(nt), hr(), lu()) : tt < ei && (o[0].style.visibility = "visible", tt++, s.val(tt), cr(), au()) } function oo() { d.is(":visible") ? (it > 1 && (o[0].style.visibility = "visible", it--, s.val(it), sr(), vr()), yr()) : yt.is(":visible") ? (nt > 1 && (o[0].style.visibility = "visible", nt--, s.val(nt), hr()), lu()) : (tt > 1 && (o[0].style.visibility = "visible", tt--, s.val(tt), cr()), au()) } function so() { d.is(":visible") ? (o[0].style.visibility = "visible", it = s.val(), sr(), vr(), yr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", nt = s.val(), hr(), lu()) : (o[0].style.visibility = "visible", tt = s.val(), cr(), au()) } function ho() { d.is(":visible") ? (o[0].style.visibility = "visible", it = 1, s.val(it), sr(), vr(), yr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", nt = 1, s.val(nt), hr(), lu()) : (o[0].style.visibility = "visible", tt = 1, s.val(tt), cr(), au()) } function co() { d.is(":visible") ? (o[0].style.visibility = "visible", it = ui, s.val(it), sr(), vr(), yr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", nt = fi, s.val(nt), hr(), lu()) : (o[0].style.visibility = "visible", tt = ei, s.val(tt), cr(), au()) } function yr() { it == 1 && it < ui ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "1"), ct.css("opacity", "1")) : it > 1 && it < ui ? (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "1"), ct.css("opacity", "1")) : it == ui && ui == 1 ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) : it == ui && (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) } function lu() { nt == 1 && nt < fi ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "1"), ct.css("opacity", "1")) : nt > 1 && nt < fi ? (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "1"), ct.css("opacity", "1")) : nt == fi && fi == 1 ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) : nt == fi && (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) } function au() { tt == 1 && tt < ei ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "1"), ct.css("opacity", "1")) : tt > 1 && tt < ei ? (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "1"), ct.css("opacity", "1")) : tt == ei && ei == 1 ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) : tt == ei && (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) } function lo(i) { var f = t(i.target).data("type"), r; if (f == "History") { for ((ht != "undefined" || ht != null) && ht.val(ne), s = gt.find("select"), s.empty(), r = 1; r <= ui; r++)s.append("<option>" + r + "<\/option>"); yr(); d.show(); di.hide(); yt.hide(); s.val(it); si.length > 0 ? (ut.select(0), ut.refresh(), k.hide(), v.show()) : (k.show(), v.hide()) } else if (f == "RelatedHistory") { for ((ht != "undefined" || ht != null) && ht.val(te), s = gt.find("select"), s.empty(), r = 1; r <= fi; r++)s.append("<option>" + r + "<\/option>"); p == undefined || p == null ? (o[0].style.visibility = "visible", hr(), s.val(nt)) : (v.find("*").show(), ai.length > 0 && (p.select(0), p.refresh(), s.val(nt))); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }); ai.length > 0 ? (p.select(0), k.hide(), v.show()) : (k.show(), v.hide()); d.hide(); di.hide(); yt.show() } else if (f == "UserHistory") { if ((ht != "undefined" || ht != null) && ht.val(ie), u == null || u == 0) { n.ADialog.info("BPartnerNotFound"); return } for (s = gt.find("select"), s.empty(), r = 1; r <= ei; r++)s.append("<option>" + r + "<\/option>"); b == undefined || b == null ? (o[0].style.visibility = "visible", cr(), s.val(tt)) : (v.find("*").show(), vi.length > 0 && (b.select(0), b.refresh(), s.val(tt))); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }); vi.length > 0 ? (b.select(0), k.hide(), v.show()) : (k.show(), v.hide()); d.hide(); yt.hide(); di.show() } t(i.target).addClass("vis-attachhistory-apanel-tab-selected"); t(i.target).siblings("li").removeClass("vis-attachhistory-apanel-tab-selected") } function pr(n) { n.onComplete = function () { d.is(":visible") ? ut.last.searchIds.length > 0 && ut.select(ut.last.searchIds[0]) : p.last.searchIds.length > 0 && p.select(p.last.searchIds[0]) } } function wr(i) { var r; if (o[0].style.visibility = "visible", r = i.target == "historyinboxgrid" ? ut.get(i.recid) : i.target == "realtedhistorygrid" ? p.get(i.recid) : b.get(i.recid), t(".vis-attachhistory-view-comments").text(n.Msg.getMsg("ViewMoreComments")), r.type == n.Msg.getMsg("Appointment") || r.Type == "Appointment" || r.type == n.Msg.getMsg("Task") || r.Type == "Task" ? g != undefined && g.is(":visible") == !1 && (t(st[0].children[0]).hide(), g.show()) : r.type == n.Msg.getMsg("VA048_CallType") || r.Type == "Call" ? rt != undefined && rt.is(":visible") == !1 && (t(at[0].children[0]).hide(), rt.show()) : l != undefined && l.is(":visible") == !1 && (t(ft[0].children[0]).hide(), l.show()), r.type != undefined) switch (r.type) { case n.Msg.getMsg("Appointment"): lr(r.id); window.setTimeout(function () { w = r.id; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Task"): lr(r.id); window.setTimeout(function () { w = r.id; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("SentMail"): ee(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("InboxMail"): oe(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Letter"): se(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("VA048_CallType"): he(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !0; pt(w, c, a) }, 200) } else switch (r.Type) { case n.Msg.getMsg("Appointment"): lr(r.ID); window.setTimeout(function () { w = r.ID; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Task"): lr(r.ID); window.setTimeout(function () { w = r.ID; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("SentMail"): ee(r.ID); window.setTimeout(function () { lr(r.ID); w = r.ID; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("InboxMail"): oe(r.ID); window.setTimeout(function () { lr(r.ID); w = r.ID; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Letter"): se(r.ID); window.setTimeout(function () { lr(r.ID); w = r.ID; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("VA048_CallType"): he(r.ID); window.setTimeout(function () { w = r.ID; c = !1; a = !0; pt(w, c, a) }, 200) } } function lr(t) { var r = "SELECT AI.AppointmentsInfo_ID, AI.Subject,AI.Location,AI.Description,AI.VAF_TableView_ID, AI.Record_ID,  (  CASE Label    WHEN 1     THEN  '" + n.Msg.getMsg("Important", !0) + "'    WHEN 2    THEN '" + n.Msg.getMsg("Business", !0) + "'    WHEN 3    THEN   '" + n.Msg.getMsg("Personal", !0) + "'    WHEN 4    THEN '" + n.Msg.getMsg("Vacation", !0) + "'    WHEN 5    THEN '" + n.Msg.getMsg("MustAttend", !0) + "'    WHEN 6    THEN '" + n.Msg.getMsg("TravelRequired", !0) + "'    WHEN 7    THEN '" + n.Msg.getMsg("NeedsPreparation", !0) + "'    WHEN 8    THEN '" + n.Msg.getMsg("BirthDay", !0) + "'    WHEN 9    THEN '" + n.Msg.getMsg("Anniversary", !0) + "'    WHEN 10    Then '" + n.Msg.getMsg("PhoneCall", !0) + "'    ELSE '" + n.Msg.getMsg("None", !0) + "'  END ) AS label ,  AI.StartDate , AI.EndDate,  (  CASE AI.AllDay    WHEN 'Y'        THEN '" + n.Msg.getMsg("Yes", !0) + "'        ELSE '" + n.Msg.getMsg("No", !0) + "'  END) AS Allday ,  (  CASE AI.Status    WHEN 1    THEN '" + n.Msg.getMsg("Tentative", !0) + "'     WHEN 2    THEN '" + n.Msg.getMsg("Busy", !0) + "'    WHEN 3    THEN '" + n.Msg.getMsg("OutOfOffice", !0) + "'    Else     '" + n.Msg.getMsg("Free", !0) + "'     End) as Status,      AI.ReminderInfo , AI.AttendeeInfo,  AI.RecurrenceInfo ,      (       CASE AI.IsPrivate        WHEN 'Y'        THEN '" + n.Msg.getMsg("Yes") + "'        ELSE '" + n.Msg.getMsg("No") + "'      END) AS IsPrivate,AI.comments ,ac.Name as caname   FROM AppointmentsInfo ai LEFT OUTER JOIN appointmentcategory AC  ON AI.appointmentcategory_id=ac.appointmentcategory_id WHERE AI.AppointmentsInfo_ID=" + t, e = n.secureEngine.encrypt(r), i = n.dataContext.getJSONData(n.Application.contextUrl + "AttachmentHistory/GetAppointmentData", { AppQry: e }, null), s, u, f; if (i != null) { if (s = 0, s = d.is(":visible") ? 0 : i.VAF_TableView_ID + "-" + i.Record_ID, r = "", u = i.AttendeeInfo, u != null && u != "" && (r = " SELECT Name FROM VAF_UserContact WHERE VAF_UserContact_ID IN (" + u.replace(/;/g, ",") + ")", e = n.secureEngine.encrypt(r), names = n.dataContext.getJSONData(n.Application.contextUrl + "AttachmentHistory/GetUser", { UserQry: e }, null), names != null && names.length > 0)) { for (r = "", f = 0; f < names.length; f++)r += names[f] + ", "; r = r.substring(0, r.length - 2) } yo(t, i.Location, i.Description, i.label, i.StartDate, i.EndDate, i.Allday, "", i.comments, s, i.Subject, i.caname, "", i.AppointmentsInfo_ID, r) } else o[0].style.visibility = "hidden" } function ee(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadSentMails", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (n) { var t = JSON.parse(n), r = 0; r = d.is(":visible") ? 0 : t.VAF_TableView_ID + "-" + t.Record_ID; wf(i, t.Title, t.To, t.From, t.Date, t.Detail, t.Bcc, t.Cc, t.Comments, t.IsMail, t.IsLetter, t.Attach, r, t.ID) } }) } function oe(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadInboxMails", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (n) { var t = JSON.parse(n), r = 0; r = d.is(":visible") ? 0 : t.VAF_TableView_ID + "-" + t.Record_ID; wf(i, t.Title, t.To, t.From, t.Date, t.Detail, t.Bcc, t.Cc, t.Comments, t.IsMail, t.IsLetter, t.Attach, r, t.ID) } }) } function se(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadLetters", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (n) { var t = JSON.parse(n), r = 0; r = d.is(":visible") ? 0 : t.VAF_TableView_ID + "-" + t.Record_ID; wf(i, t.Title, "", "", t.Date, t.Detail, "", "", t.Comments, !1, !0, t.Attach, r, t.ID) } }) } function he(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadCall", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (t) { var r = JSON.parse(t), u = 0; u = d.is(":visible") ? 0 : r.VAF_TableView_ID + "-" + r.Record_ID; ao(i, r.VA048_IsConference, r.VA048_From, r.VA048_To, r.VA048_Duration, r.VA048_Price, r.VA048_Price_Unit, r.VA048_Status, r.VA048_CallNotes, r.Created, r.VAF_TableView_ID, r.Record_ID, u, n.Msg.getMsg("VA048_CallType"), "", r.VA048_FullName, r.Attach) } }) } function ao(i, r, u, f, e, s, h, c, l, a, y, p, w, b, k, d, g) { var e, tt, it, ut, et, ot, nt; if (ft != undefined && ft.hide(), st != undefined && st.hide(), e = e >= 60 ? vo(e) : e + " " + n.Msg.getMsg("VA048_Seconds"), bi == undefined || bi == null || bi == "") { if (bi = t("<p>" + n.Utility.encodeText(u) + "<\/p>"), ti = t("<p>" + n.Utility.encodeText(f) + "<\/p>"), ff = t("<p>" + n.Utility.encodeText(e) + "<\/p>"), ef = t("<p>" + n.Utility.encodeText(c) + "<\/p>"), of = t("<p>" + n.Utility.encodeText(s) + "<\/p>"), sf = t("<p>" + n.Utility.encodeText(h) + "<\/p>"), hf = t(" <p>" + n.Utility.encodeText(new Date(a).toLocaleString()) + "<\/p>"), er = t("<p>" + n.Utility.encodeText(b) + "<\/p>"), cf = t('<p style="max-height:120px;overflow-y: scroll;">' + n.Utility.encodeText(l) + "<\/p>"), af = t("<p>" + n.Utility.encodeText(d) + "<\/p>"), lf = t("<p>" + (r == "Y" ? n.Msg.getMsg("VA048_Conference") : n.Msg.getMsg("VA048_CallType")) + "<\/p>"), vt = t('<i class=" vis vis-find" data-ids="' + w + '">'), w == 0 ? vt.hide() : vt.show(), at = t('<div class="vis-attachhistory-right-content">'), rt = t('<div class="vis-attachhistory-grid-data" >'), tt = t('<div style="float:left;width:100%;margin-bottom:10px"><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("Title") + ' <i class="fa fa-phone"><\/i><\/h6>').append(vt)).append(lf)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("User") + "<\/h6> ").append(af)), rt.append(tt), it = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("VA048_From") + "<\/h6>")).append(bi)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("VA048_To") + "<\/h6> ").append(ti)), rt.append(it), ut = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2"> ').append("<h6>" + n.Msg.getMsg("VA048_Duration") + "<\/h6> ").append(ff)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("VA048_Status") + "<\/h6>").append(ef)), rt.append(ut), et = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append("<h6>" + n.Msg.getMsg("VA048_Price") + "<\/h6>").append(of)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("VA048_PriceUnit") + "<\/h6> ").append(sf)), rt.append(et), ot = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append("<h6>" + n.Msg.getMsg("Created") + "<\/h6>").append(hf)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("Category") + "<\/h6> ").append(er)), rt.append(ot), rt.append(t('<div class="vis-attachhistory-right-row" style="margin-bottom:20px;margin-right: 4px;">').append("<h6>" + n.Msg.getMsg("VA048_Notes") + "<\/h6> ").append(cf)), rt.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Attachments") + "<\/h6>")), g != undefined && g.length > 0) for (nt = 0; nt < g.length; nt++)oi.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a data-attid="' + g[nt].AttID + '" data-id="' + g[nt].ID + '">' + n.Utility.encodeText(g[nt].Name) + "<\/a><\/li>"); else rt.find(".vis-attachhistory-right-row").last().hide(); rt.find(".vis-attachhistory-right-row").last().append(oi); (wi == undefined || wi == null) && (wi = t('<input type="text" placeholder="' + n.Msg.getMsg("TypeComment") + '"><\/input>')); yf = t('<div class="vis-attachhistory-bottom"><\/div>'); vf = t('<div class="vis-attachhistory-comments vis-feedMessage"><\/div>'); vf.append(wi).append('<span class="vis-attachhistory-comment-icon vis vis-sms"><\/span>'); yf.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(vf).append('<p class="vis-attachhistory-view-comments">' + n.Msg.getMsg("ViewMoreComments") + "<\/p>")); at.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(rt).append(yf); cu = t('<div class="vis-attachhistory-right-row" >'); rt.append(cu); v.append(at); vt.on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[0], r[1]) }) } else { if (at.show(), bi.text(n.Utility.encodeText(u)), ti.text(n.Utility.encodeText(f)), ff.text(n.Utility.encodeText(e)), ef.text(n.Utility.encodeText(c)), of.text(n.Utility.encodeText(s)), sf.text(n.Utility.encodeText(h)), hf.text(n.Utility.encodeText(new Date(a).toLocaleString())), er.text(n.Utility.encodeText(b)), cf.text(n.Utility.encodeText(l)), af.text(n.Utility.encodeText(d)), lf.text(n.Utility.encodeText(r == "Y" ? n.Msg.getMsg("VA048_Conference") : n.Msg.getMsg("VA048_CallType"))), g != undefined && g.length > 0) { for (oi.empty(), nt = 0; nt < g.length; nt++)oi.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a data-attid="' + g[nt].AttID + '" data-id="' + g[nt].ID + '">' + n.Utility.encodeText(g[nt].Name) + "<\/a><\/li>"); t(oi.parent()).show() } else t(oi.parent()).hide(); vt.data("ids", w); w == 0 ? vt.hide() : vt.show(); t(at[0].children[0]).hide() } t(".vis-attachhistory-view-comments").off("click"); t(".vis-attachhistory-view-comments").on("click", function () { bf(i, !1, !0, this) }); k != undefined ? wi.val(n.Utility.encodeText(k)) : wi.val(""); t(".vis-attachhistory-comment-icon").data("ID", i); o[0].style.visibility = "hidden" } function vo(t) { var f = ~~(t / 3600), r = ~~(t % 3600 / 60), u = t % 60, i = ""; return f > 0 && (i += "" + hrs + ":" + (r < 10 ? "0" : "")), i += "" + r + ":" + (u < 10 ? "0" : ""), i += "" + u, i + " " + n.Msg.getMsg("VA048_Minutes") } function wf(i, r, u, f, e, s, h, y, p, w, b, k, d, g) { var nt; if (st != undefined && st.hide(), at != undefined && at.hide(), c = !1, a = !1, ir == undefined || ir == null) { if (ar = t("<p>" + n.Utility.encodeText(r) + "<\/p>"), ti = t("<p>" + n.Utility.encodeText(u) + "<\/p>"), rr = t("<p>" + n.Utility.encodeText(h) + "<\/p>"), ur = t("<p>" + n.Utility.encodeText(y) + "<\/p>"), tr = t(" <p>" + n.Utility.encodeText(f) + "<\/p>"), ir = t("<p>" + n.Utility.encodeText(e) + "<\/p>"), ci = t('<a class="vis-attachhistory-email-dropdown fa fa-ellipsis-v" tabindex=""><\/a>'), (hi == undefined || hi == null) && (hi = t('<p class="vis-attachhistory-detail"><\/p>')), hi.html(s), (ii == undefined || ii == null) && (ii = t('<input type="text" placeholder="' + n.Msg.getMsg("TypeComment") + '"><\/input>')), yi = t('<i class="vis vis-email"><\/i>'), pi = t('<i class="vis vis-find pull-right" data-ids="' + d + '" ><\/i>'), ft = t('<div class="vis-attachhistory-right-content">'), l = t('<div class="vis-attachhistory-grid-data">'), l.append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("Title") + "<\/h6>").append(yi)).append(ar)), l.append(t('<div class="vis-attachhistory-right-row3"><\/div>').append(ci).append(pi)), b == !0 && l.find(".vis-attachhistory-right-row").last().hide(), b == !0 && l.append(t('<div class="vis-attachhistory-right-row3">').append(ir)), d == 0 ? pi.hide() : pi.show(), w == !0 ? yi.removeClass("vis vis-letter").addClass("vis vis-email") : b == !0 && yi.removeClass("vis vis-email").addClass("vis vis-letter"), l.append(t('<div class="vis-attachhistory-right-row vis-attachhistory-to">').append("<h6>" + n.Msg.getMsg("To") + "<\/h6> ").append(ti)), (u == "undefined" || u == null || u == "" || b == !0) && l.find(".vis-attachhistory-right-row").last().hide(), l.append(t('<div value="bccDiv" class="vis-attachhistory-right-row  vis-attachhistory-bcc">').append("<h6>" + n.Msg.getMsg("Bcc") + "<\/h6> ").append(rr)), (h == "undefined" || h == null || h == "" || b == !0) && l.find(".vis-attachhistory-right-row").last().hide(), l.append(t('<div  value="ccDiv"  class="vis-attachhistory-right-row vis-attachhistory-cc">').append("<h6>" + n.Msg.getMsg("Cc") + "<\/h6> ").append(ur)), (y == "undefined" || y == null || y == "" || b == !0) && l.find(".vis-attachhistory-right-row").last().hide(), l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("From") + "<\/h6>").append(tr)), l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Attachments") + "<\/h6>")), k != undefined && k.length > 0) for (nt = 0; nt < k.length; nt++)ni.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a data-IDs="' + k[nt].ID + '">' + n.Utility.encodeText(k[nt].Name) + "<\/a><\/li>"); else l.find(".vis-attachhistory-right-row").last().hide(); l.find(".vis-attachhistory-right-row").last().append(ni); su = t('<div class="vis-attachhistory-right-row">'); l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Details") + "<\/h6>").append(hi)).append(su); gr = t('<div class="vis-attachhistory-bottom"><\/div>'); gu = t('<div class="vis-attachhistory-comments vis-feedMessage"><\/div>'); gu.append(ii).append('<span class="vis-attachhistory-comment-icon vis vis-sms"><\/span>'); gr.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(gu).append('<p class="vis-attachhistory-view-comments" style="float:right;width:auto">' + n.Msg.getMsg("ViewMoreComments") + "<\/p>")); ft.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(l).append(gr); gi.parent() != undefined ? v.append(ft) : v.append(ft); pi.on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[0], r[1]) }) } else { if (ft.show(), t(ft[0].children[0]).hide(), (ci == undefined || ci == null) && (ci = t('<a class="vis-attachhistory-email-dropdown fa fa-ellipsis-v" tabindex=""><\/a>')), w == !0 ? (yi.removeClass("vis vis-letter").addClass("vis vis-email"), ci.show()) : b == !0 && (yi.removeClass("vis vis-email").addClass("vis vis-letter"), ci.hide()), ar.text(n.Utility.encodeText(r)), u == "undefined" || u == null && u == "" || b == !0 ? t(ti.parent()).hide() : (ti.text(n.Utility.encodeText(u)), t(ti.parent()).show()), h == "undefined" || h == null || h == "" || b == !0 ? t(rr.parent()).hide() : (rr.text(n.Utility.encodeText(h)), t(rr.parent()).show()), y == "undefined" || y == null || y == "" || b == !0 ? t(ur.parent()).hide() : (ur.text(n.Utility.encodeText(y)), t(ur.parent()).show()), b == !0 ? t(tr.parent()).hide() : (tr.text(n.Utility.encodeText(f)), t(tr.parent()).show()), pi.data("ids", d), d == 0 ? pi.hide() : pi.show(), ir.text(n.Utility.encodeText(e)), k != undefined && k.length > 0) { for (ni.empty(), nt = 0; nt < k.length; nt++)ni.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a  data-IDs="' + k[nt].ID + '">' + n.Utility.encodeText(k[nt].Name) + "<\/a><\/li>"); t(ni.parent()).show() } else t(ni.parent()).hide(); hi.html(s) } t(".vis-attachhistory-view-comments").off("click"); t(".vis-attachhistory-view-comments").on("click", function () { bf(g, !1, !1, this) }); if (w) { pf = g; ci.show(); t(".vis-attachhistory-email-dropdown").off("click"); t(".vis-attachhistory-email-dropdown").on("click", function () { t(this).w2overlay(ku.clone(!0), { css: { height: "300px" } }) }) } else ci.hide(); t(".vis-attachhistory-comment-icon").data("ID", i); p != undefined ? ii.val(n.Utility.encodeText(p)) : ii.val(""); o[0].style.visibility = "hidden" } function yo(i, r, u, f, e, s, h, l, y, p, w, b, k, d, nt) { var tt, it, rt; if (ft != undefined && ft.hide(), at != undefined && at.hide(), c = !0, a = !1, or == undefined || or == null) { iu = t("<p>" + n.Utility.encodeText(r) + "<\/p>"); tu = t("<p>" + n.Utility.encodeText(w) + "<\/p>"); fr = t("<p>" + n.Utility.encodeText(u) + "<\/p>"); er = t("<p>" + n.Utility.encodeText(b) + "<\/p>"); tf = t("<p>" + n.Utility.encodeText(nt) + "<\/p>"); rf = t("<p>" + n.Utility.encodeText(f) + "<\/p>"); or = t("<p>" + n.Utility.encodeText(new Date(e).toLocaleString()) + "<\/p>"); ru = t(" <p>" + n.Utility.encodeText(new Date(s).toLocaleString()) + "<\/p>"); uu = t("<p>" + n.Utility.encodeText(h) + "<\/p>"); (ri == undefined || ri == null) && (ri = t('<input type="text" placeholder="' + n.Msg.getMsg("TypeComment") + '"><\/input>')); vt = t('<i class=" vis vis-find" data-ids="' + p + '" >'); st = t('<div class="vis-attachhistory-right-content">'); g = t('<div class="vis-attachhistory-grid-data" >'); tt = t('<div style="float:left;width:100%" ><\/div>'); tt.append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("Title") + ' <i class="vis vis-appointment"><\/i><\/h6>').append(vt)).append(tu)); p == 0 ? vt.hide() : vt.show(); tt.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>" + n.Msg.getMsg("Location") + "<\/h6> ").append(iu)); (r == "undefined" || r == null && r == "") && g.find(".vis-attachhistory-right-row").last().hide(); g.append(tt); it = t('<div style="float:left;width:100%" ><\/div>'); it.append(t('<div  class="vis-attachhistory-right-row2"> ').append("<h6>" + n.Msg.getMsg("StartDate") + "<\/h6> ").append(or)); it.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>" + n.Msg.getMsg("EndDate") + "<\/h6>").append(ru)); g.append(it); rt = t('<div style="float:left;width:100%" ><\/div>'); rt.append(t('<div class="vis-attachhistory-right-row2">').append("<h6>" + n.Msg.getMsg("AllDay") + "<\/h6>").append(uu)); rt.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>" + n.Msg.getMsg("Category") + "<\/h6> ").append(er)); g.append(rt); g.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Contacts") + "<\/h6> ").append(tf)); hu = t('<div class="vis-attachhistory-right-row" >'); g.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Description") + "<\/h6> ").append(fr)).append(hu); (u == "undefined" || u == null && u == "") && g.find(".vis-attachhistory-right-row").last().hide(); nu = t('<div class="vis-attachhistory-bottom"><\/div>'); nf = t('<div class="vis-attachhistory-comments vis-feedMessage"><\/div>'); nf.append(ri).append('<span class="vis-attachhistory-comment-icon vis vis-sms"><\/span>'); nu.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(nf).append('<p class="vis-attachhistory-view-comments">' + n.Msg.getMsg("ViewMoreComments") + "<\/p>")); st.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(g).append(nu); v.append(st); vt.on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[0], r[1]) }) } else st.show(), tu.text(n.Utility.encodeText(w)), iu.text(n.Utility.encodeText(r)), u == "undefined" || u == null || u == "" ? t(fr.parent()).hide() : (fr.text(n.Utility.encodeText(u)), t(fr.parent()).show()), tf.text(n.Utility.encodeText(nt)), b == "undefined" || b == null || b == "" ? er.text(n.Utility.encodeText("")) : er.text(n.Utility.encodeText(b)), vt.data("ids", p), p == 0 ? vt.hide() : vt.show(), or.text(n.Utility.encodeText(new Date(e).toLocaleString())), ru.text(n.Utility.encodeText(new Date(s).toLocaleString())), uu.text(n.Utility.encodeText(h)), t(st[0].children[0]).hide(); t(".vis-attachhistory-view-comments").off("click"); t(".vis-attachhistory-view-comments").on("click", function () { bf(d, !0, !1, this) }); y != undefined ? ri.val(n.Utility.encodeText(y)) : ri.val(""); t(".vis-attachhistory-comment-icon").data("ID", i); o[0].style.visibility = "hidden" } function bf(i, r, u, f) { r == !0 ? g.is(":visible") ? (t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var t = JSON.parse(n); kf(t, r, u) }, error: function () { n.ADialog.error("RecordNotSaved") } }), t(f).text(n.Msg.getMsg("HideComments"))) : (g.show(), t(st[0].children[0]).hide(), t(f).text(n.Msg.getMsg("ViewMoreComments"))) : u == !0 ? rt.is(":visible") ? (t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var t = JSON.parse(n); kf(t, r, u) }, error: function () { n.ADialog.error("RecordNotSaved") } }), t(f).text(n.Msg.getMsg("HideComments"))) : (rt.show(), t(at[0].children[0]).hide(), t(f).text(n.Msg.getMsg("ViewMoreComments"))) : l.is(":visible") ? (t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var t = JSON.parse(n); kf(t, r, u) }, error: function () { n.ADialog.error("RecordNotSaved") } }), t(f).text(n.Msg.getMsg("HideComments"))) : (l.show(), t(ft[0].children[0]).hide(), t(f).text(n.Msg.getMsg("ViewMoreComments"))) } function vu(t, i) { return t += '   <div class="vis-attachhistory-comment-data"><div class="vis-attachhistory-comment-detail vis-feedDetails-cmnt">', t += i.UserImage != "NoRecordFound" && i.UserImage != "FileDoesn'tExist" && i.UserImage != null ? '<img  class="userAvatar-Feeds"  src="' + i.UserImage + "?" + new Date + '">' : '<i class="fa fa-user userAvatar-Feeds"><\/i>', t += '<div class="vis-attachhistory-comment-text">', t += i.CreatedBy == n.Env.getCtx().getVAF_UserContact_ID() ? "<h6>" + n.Msg.getMsg("Me") + " <\/h6>" : "<h6>" + i.UserName + "<\/h6>", t + (" <p>" + i.CharacterData + '<\/p><\/div><div class="vis-attachhistory-comment-dateTime"><p>' + new Date(i.Created).toLocaleString() + "<\/p><\/div><\/div><\/div>") } function kf(n, i, r) { var u, f; if (n.length > 0) { for (u = ' <div class="vis-attachhistory-comments-container">', f = 0; f < n.length; f++)u = vu(u, n[f]); u += "<\/div>" } r == !0 ? rt.is(":visible") ? (t(at[0].children[0]).show(), t(at[0].children[0]).empty(), t(at[0].children[0]).append(u), rt.hide()) : (rt.show(), t(at[0].children[0]).hide()) : i == !0 ? g.is(":visible") ? (t(st[0].children[0]).show(), t(st[0].children[0]).empty(), t(st[0].children[0]).append(u), g.hide()) : (g.show(), t(st[0].children[0]).hide()) : l.is(":visible") ? (t(ft[0].children[0]).show(), t(ft[0].children[0]).empty(), t(ft[0].children[0]).append(u), l.hide()) : (l.show(), t(ft[0].children[0]).hide()) } function po(i) { var r = i.target, f = "", u = ""; (t(r).is("a") ? (f = t(r).text(), u = t(r).data("ids")) : t(r).is("i") ? (f = t(t(r).parent()).siblings().text(), u = t(t(r).parent()).siblings().data("ids")) : t(r).is("span") && (f = t(r).siblings().text(), u = t(r).siblings().data("ids")), u != null && u != 0) && (o[0].style.visibility = "hidden", t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/DownloadAttachment", datatype: "json", type: "get", cache: !1, data: { ID: u, Name: f }, success: function (t) { var i = JSON.parse(t), r = n.Application.contextUrl + "TempDownload/" + i; window.open(r); o[0].style.visibility = "hidden" } })) } function wo(i) { var r = i.target, f = "", u = "", e = ""; (t(r).is("a") ? (f = t(r).text(), e = t(r).data("AttID"), u = t(r).data("id")) : t(r).is("img") ? (f = t(t(r).parent()).siblings().text(), e = t(t(r).parent()).siblings().data("attid"), u = t(t(r).parent()).siblings().data("id")) : t(r).is("span") && (f = t(r).siblings().text(), e = t(r).siblings().data("attid"), u = t(t(r).parent()).siblings().data("id")), u != null && u != 0) && (o[0].style.visibility = "hidden", t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/DownloadAttachmentCall", datatype: "json", type: "get", cache: !1, data: { AttID: e, ID: u, Name: f }, success: function (t) { var i = JSON.parse(t), r; i != null && i != "" ? (r = n.Application.contextUrl + "TempDownload/" + i, window.open(r)) : n.ADialog.error("AttachmentNotFound"); o[0].style.visibility = "hidden" } })) } function ce(i) { var f = i.target, r, u; (i.keyCode == undefined || i.keyCode == 13) && (i.keyCode != undefined || t(f).hasClass("vis-attachhistory-comment-icon")) && (r = 0, r = t(".vis-attachhistory-comment-icon").data("ID"), r != 0) && (u = "", u = c == !0 ? ri.val() : a == !0 ? wi.val() : ii.val(), u.length != 0) && t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/SaveComment", datatype: "json", type: "POST", cache: !1, data: { ID: r, Text: u, isAppointment: c, isCall: a }, success: function (n) { var f = JSON.parse(n), r = !0, i, u; if (a == !0 ? (wi.val(""), rt.is(":visible") && (r = !1)) : c == !0 ? (ri.val(""), g.is(":visible") && (r = !1)) : (ii.val(""), l.is(":visible") && (r = !1)), r == !0) { if (f.length > 0) { for (i = ' <div class="vis-attachhistory-comments-container">', u = 0; u < f.length; u++)i = vu(i, f[u]); i += "<\/div>" } c == !0 ? (t(st[0].children[0]).empty(), t(st[0].children[0]).append(i)) : a == !0 ? (t(at[0].children[0]).empty(), t(at[0].children[0]).append(i)) : (t(ft[0].children[0]).empty(), t(ft[0].children[0]).append(i)) } else pt(w, c, a) }, error: function () { n.ADialog.error("RecordNotSaved") } }) } function pt(i, r, u) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonLastHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var f = JSON.parse(n), t, i; if (f.length > 0) if (r) for (t = '<div style="height:88px"><\/div>', hu.empty(), i = 0; i < f.length; i++)t = vu(t, f[i]), hu.append(t); else if (u) for (t = "<div><\/div>", cu.empty(), i = 0; i < f.length; i++)t = vu(t, f[i]), cu.append(t); else for (t = '<div style="height:120px"><\/div>', su.empty(), i = 0; i < f.length; i++)t = vu(t, f[i]), su.append(t); else u ? cu.empty() : r ? hu.empty() : su.empty() } }) } var le = n.Env.getWindowNo(), ae = n.Env.getCtx(), wt = [], si = [], h = [], dt = [], ai = [], c, bt = [], vi = [], y = [], kt, br, d, ut, yt, p, b, di, df = this, kr, yu, du, gi, dr, pu, nr, wu, v, ft, st, g, gr, nu, k, gu, nf, l, ni, ar, ti, tr, gf, hi, ir, ii, rr, ur, yi, ri, pi, vt, ci, tu, iu, fr, er, tf, rf, or, ru, uu, o, li = 50, it, nt, uf, fu, eu, ui, fi, ei, tt, ou, et, ct, lt, ot, gt, s, ht, ve, bu, ne, te, ie, ku, su, hu, at, rt, wi, ff, ef, of, sf, hf, cf, lf, af, vf, yf, a, oi, cu, bi, ki, w, pf; this.initializeComponent = function () { bu = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); it = 1; nt = 1; tt = 1; we(); pe(); ye(); re(); sr(); ro() }; this.displayInboxDiv = function () { ut = d.w2grid({ name: "historyinboxgrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: wt, records: si }); ut.on("select", wr); ut.on("search", pr); si.length > 0 ? (ut.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; t(".vis-attachhistory-search-icon").on("click", fe) }; ki = !1; w = 0; pf = 0; this.getRoot = function () { return br }; this.show = function () { kt = new n.ChildDialog; this.initializeComponent(); kt.setContent(br); bu == !0 ? (kt.setHeight(650), kt.setWidth(800)) : (kt.setHeight(650), kt.setWidth(1e3)); kt.setTitle(n.Msg.getMsg("History")); kt.setModal(!0); kt.show(); kt.hideButtons(); this.displayInboxDiv(); kt.onClose = function () { df.dispose() } }; this.dispose = function () { le = 0; ae = null; wt = []; wt = null; si = []; si = null; h = []; h = null; kr != null && kr.remove(); yu != null && yu.remove(); dr != null && dr.remove(); pu != null && pu.remove(); nr != null && nr.remove(); wu != null && wu.remove(); v != null && v.remove(); ft != null && ft.remove(); st != null && st.remove(); g != null && g.remove(); gr != null && gr.remove(); nu != null && nu.remove(); k != null && k.remove(); l != null && l.remove(); ni != null && ni.remove(); oi != null && oi.remove(); ar != null && ar.remove(); ti != null && ti.remove(); tr != null && tr.remove(); bi != null && bi.remove(); gf != null && gf.remove(); hi != null && hi.remove(); ir != null && ir.remove(); ii != null && ii.remove(); rr != null && rr.remove(); ur != null && ur.remove(); yi != null && yi.remove(); ri != null && ri.remove(); iu != null && iu.remove(); tu != null && tu.remove(); fr != null && fr.remove(); rf != null && rf.remove(); or != null && or.remove(); ru != null && ru.remove(); uu != null && uu.remove(); o != null && o.remove(); ou != null && ou.remove(); et != null && et.remove(); ct != null && ct.remove(); lt != null && lt.remove(); ot != null && ot.remove(); gt != null && gt.remove(); s != null && s.remove(); d != null && d != undefined && d.remove(); d = null; ut != null && ut != undefined && ut.destroy(); ut = null; w2ui.historyinboxgrid != undefined && w2ui.historyinboxgrid.destroy(); p != null && p != undefined && p.destroy(); p = null; w2ui.realtedhistorygrid != undefined && w2ui.realtedhistorygrid.destroy(); b != null && b != undefined && b.destroy(); b = null; w2ui.userhistorygrid != undefined && w2ui.userhistorygrid.destroy(); df = null } } }(VIS, jQuery), function (n, t) { function r() { var b = null, k = null, v = null, ut = null, d = null, y = null, ft = null, et = null, yt = null, pt = null, ot = null, wt = null, o = null, p = null, st = null, s = null, ni = null, ht = null, h = null, ti = null, ct = null, c = null, ii = null, lt = null, l = null, ri = null, at = null, g = null, nt = null, ui = null, vt = null, tt = null, it = null, e = null, f = null, si = null, hi = null, a = null, r = null, u = -1, w = !1; this.Load = function (i, r) { b = i; k = r; ft = t("<div class='vis-rad-recordData'>"); e = t("<button  class='vis-rad-navBtn' disabled='disabled'>").append(t("<i class='fa fa-caret-down'><\/i>")); f = t("<button  class='vis-rad-navBtn' disabled='disabled'>").append(t("<i class='fa fa-caret-up'><\/i>")); at = t("<div class='vis-rad-actionIcons' >"); g = t("<button  class='vis-rad-actionBtn'>").append(t("<i class='vis vis-plus'><\/i>")); vt = t("<div class='vis-rad-btnWrap' >"); it = t("<a href = 'javascript:void(0)'  class='vis-rad-buttons VIS_Pref_btn-2'>").append(n.Msg.getMsg("Cancel")); ui = t("<span class='vis-rad-paging'>").append(a); s = t("<input type='checkbox' checked >"); ni = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsActive")); h = t("<input type='checkbox' checked >"); ti = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsExclude")); c = t("<input type='checkbox'>"); ii = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsReadOnly")); l = t("<input type='checkbox'>"); ri = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsDependentEntities")); v = t("<div class='vis-forms-container'>"); ut = t("<div class='vis-forms-container vis-rad-contantWrap'>"); d = t("<div class='vis-rad-contantTop'>"); yt = t("<div class='vis-rad-roleCombo'>"); pt = t("<div class='input-group vis-input-wrap'>"); ot = t("<div class='vis-control-wrap'>"); wt = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "VAF_Role_ID")); o = t("<select class='vis-custom-select'>"); yt.append(pt); pt.append(ot); ot.append(o); ot.append(wt); p = t("<div class='vis-rad-recordOp'>"); st = t("<div class='vis-rad-check'>"); st.append(s); st.append(ni); p.append(st); ht = t("<div class='vis-rad-check'>"); ht.append(h); ht.append(ti); p.append(ht); ct = t("<div class='vis-rad-check'>"); ct.append(c); ct.append(ii); p.append(ct); lt = t("<div class='vis-rad-check'>"); lt.append(l); lt.append(ri); p.append(lt); ft.append(yt); ft.append(p); d.append(ft); et = t("<div class='vis-rad-navIcons'>"); et.append(e); et.append(f); d.append(et); y = t("<div class='vis-rad-contantBottom'>"); nt = t("<button  class='vis-rad-actionBtn'>").append(t("<i class='vis vis-delete'><\/i>")); at.append(g); at.append(nt); y.append(at); a = t("<lable>"); y.append(ui); tt = t("<a href = 'javascript:void(0)'  class='vis-rad-buttons VIS_Pref_btn-2'>").append(n.Msg.getMsg("Ok")); vt.append(it); vt.append(tt); y.append(vt); ut.append(d); ut.append(y); v.append(ut); fi(); bt(); kt(); v.dialog({ width: 600, height: 228, resizable: !1, title: "Record", modal: !0 }) }; var bt = function () { var t = n.dataContext.getJSONData(n.Application.contextUrl + "RecordAccess/GetRoles", null, null), r = '<option Value="-1"><\/option>'; if (t != null) for (i in t) r += '<option value="' + t[i].VAF_Role_ID + '">' + t[i].Name + "<\/option>"; o.append(r); r = null; t = null }, kt = function () { var t, i, f; if (r == null && (r = []), t = n.dataContext.getJSONData(n.Application.contextUrl + "RecordAccess/GetRecordAccess", { Table_ID: b, Record_ID: k }, null), i = null, t != null) for (f in t) i = {}, i.VAF_ROLE_ID = t[f].VAF_ROLE_ID, i.ISACTIVE = t[f].ISACTIVE, i.ISDEPENDENTENTITIES = t[f].ISDEPENDENTENTITIES, i.ISEXCLUDE = t[f].ISEXCLUDE, i.ISREADONLY = t[f].ISREADONLY, r.push(i); i = null; t = null; r.length > 0 ? (u = 0, rt()) : w = !0 }, dt = function () { var r = o.val(), i; r != -1 && (i = !1, w || (i = !0), t.ajax({ url: n.Application.contextUrl + "RecordAccess/SaveAccess/", dataType: "json", data: { VAF_Role_ID: r, VAF_TableView_ID: b, Record_ID: k, isActive: s.prop("checked"), isExclude: h.prop("checked"), isReadOnly: c.prop("checked"), isDependentEntities: l.prop("checked"), isUpdate: i }, success: function (n) { var t = n.result; t == !0 && gt() } })) }, fi = function () { e.on("click", function () { u += 1; rt() }); f.on("click", function () { w ? w = !1 : u -= 1; rt() }); g.on("click", function () { ei() }); nt.on("click", function () { oi() }); tt.on("click", function () { dt() }); it.on("click", function () { gt() }) }, ei = function () { w = !0; u = r.length - 1; rt(); o.val(-1); s.attr("checked", !0); h.attr("checked", !0); c.attr("checked", !1); l.attr("checked", !1); a.empty(); a.append("+" + (r.length + 1) + "/" + (r.length + 1)); r.length > 0 && (f.attr("disabled", !1), f.css("opacity", "1")) }, rt = function () { o.val(r[u].VAF_ROLE_ID); s.attr("checked", r[u].ISACTIVE == "Y" ? !0 : !1); h.attr("checked", r[u].ISEXCLUDE == "Y" ? !0 : !1); c.attr("checked", r[u].ISREADONLY == "Y" ? !0 : !1); l.attr("checked", r[u].ISDEPENDENTENTITIES == "Y" ? !0 : !1); a.empty(); a.append(u + 1 + "/" + r.length); r.length > u + 1 ? (e.attr("disabled", !1), e.css("opacity", "1")) : (e.attr("disabled", !0), e.css("opacity", ".5")); u == 0 ? (f.attr("disabled", !0), f.css("opacity", ".5")) : (f.attr("disabled", !1), f.css("opacity", "1")) }, oi = function () { var i = o.val(); i == -1 || w || t.ajax({ url: n.Application.contextUrl + "RecordAccess/DeleteRecord/", dataType: "json", data: { VAF_Role_ID: i, VAF_TableView_ID: b, Record_ID: k, isActive: s.prop("checked"), isExclude: h.prop("checked"), isReadOnly: c.prop("checked"), isDependentEntities: l.prop("checked") }, success: function (n) { var t = n.result; t == !0 && gt() } }) }, gt = function () { e.off("click"); f.off("click"); g.off("click"); nt.off("click"); tt.off("click"); it.off("click"); bt = null; kt = null; dt = null; fi = null; ei = null; rt = null; oi = null; b = null; k = null; d = null; y = null; si = null; hi = null; e = null; f = null; g = null; nt = null; tt = null; it = null; wt = null; o = null; s = null; h = null; c = null; l = null; a = null; r = null; bt = null; kt = null; dt = null; v.dialog("destroy"); v.remove(); v = null } } n.RecordAccessDialog = r }(VIS, jQuery), function (n, t) { function i() { function vi() { e.append('<div class="vis-group-colwrap"><div class="vis-group-content-wrap"><\/div><\/div><div class="vis-group-colwrap"><div class="vis-group-content-wrap"><\/div><\/div><div class="vis-group-colwrap last-child"><div class="vis-group-content-wrap"><\/div><\/div>'); var n = e.find(".vis-group-content-wrap"); v = t(n[0]); o = t(n[1]); s = t(n[2]); n = null; yi(); bi(); ki(); di() } function yi() { i = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); i[0].style.visibility = "hidden"; e.append(i) } function pi() { k.on("click", rr); tt.on("click", pt); y.on("keydown", or); rt.on("click", ui); ot.on("click", kt); ft.on("click", bt); b.on("keydown", sr); ut.on("click", wt); w.on("keydown", hr); et.on("click", fr); it.on("click", ur); p.on("scroll", er); e.on("click", wi) } function wi(i) { var u = t(i.target); return !u.hasClass("vis-group-roless") && u.parents(".vis-group-roless").length == 0 && !u.hasClass("vis-group-save-btn") && a.length > 0 ? (n.ADialog.confirm("VIS_SaveRole", !0, "", "Confirm", function (n) { n ? ui() : a = [] }), i.stopPropagation(), !1) : !u.hasClass("vis-group-groupss") && u.parents(".vis-group-groupss").length == 0 && !u.hasClass("vis-group-save-btn") && r.length > 0 ? (n.ADialog.confirm("VIS_SaveRole", !0, "", "Confirm", function (n) { n ? kt() : r = [] }), i.stopPropagation(), !1) : void 0 } function bi() { i[0].style.visibility = "visible"; v.append('<div class="vis-group-content-head"><h4 class="vis-group-content-tittle">' + n.Msg.getMsg("VIS_CreateInviteUser") + '<\/h4><span class=" vis-group-pointer vis-group-head-right">' + n.Msg.getMsg("SortBy") + '<\/span><button class="vis-group-add-btn vis-groupbtn"><i class="vis vis-addbp"><\/i><\/button><\/div>'); lt = v.find(".vis-group-head-right"); v.append('<div class="vis-group-searchwrp"><div class="vis-group-content-headDown"><input class="vis-group-SearchText" value="" placeholder="' + n.Msg.getMsg("Search") + '" type="text"><button class="vis-groupbtn vis-group-search-icon"><i class="vis vis-search"><\/i><\/button><\/div><\/div>'); y = v.find(".vis-group-SearchText"); tt = v.find(".vis-group-search-icon"); k = v.find(".vis-group-add-btn"); p = t('<div class="vis-group-users-container">'); h = t('<div class="vis-group-DataContainer">'); p.height(t(e.parent()).height() - 95); v.append(p); p.append(h); nr() } function ki() { o.append(' <div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-role">' + n.Msg.getMsg("Role") + '<\/h4><h7 class="vis-group-SaveMessage">' + n.Msg.getMsg("VIS_RoleSaved") + '<\/h7><div class="vis-group-top-right"><button class="vis-groupbtn vis-group-add-btn"><i class="vis vis-new" title="' + n.Msg.getMsg("AddNew") + '" ><\/i><\/button><button class="vis-groupbtn vis-group-save-btn"><i class="vis vis-save" title="' + n.Msg.getMsg("Save") + '"><\/i><\/button><\/div><\/div><div class="vis-group-searchwrp"><div class="vis-group-content-headDown"><input class="vis-group-SearchText" value="" placeholder="' + n.Msg.getMsg("Search") + '" type="text"><button class="vis-groupbtn vis-group-search-icon"><i class="vis vis-search"><\/i><\/button><\/div><\/div>'); rt = o.find(".vis-group-save-btn"); it = o.find(".vis-group-add-btn"); w = o.find(".vis-group-SearchText"); ut = o.find(".vis-group-search-icon"); g = t('<div class="vis-group-role-container">'); c = t('<div class="vis-group-DataContainer">'); o.append(g); g.append(c); g.height(t(e.parent()).height() - 95); oi() } function di() { s.append('<div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-rights">' + n.Msg.getMsg("VIS_Groups") + '<\/h4><h7 class="vis-group-SaveMessage">' + n.Msg.getMsg("VIS_GroupSaved") + '<\/h7><div class="vis-group-top-right"><div class="vis-group-top-right"><button class="vis-groupbtn vis-group-add-btn"><i class="vis vis-new" title="' + n.Msg.getMsg("AddNew") + '"><\/i><\/button><button class="vis-groupbtn vis-group-save-btn"><i class="vis vis-save" title="' + n.Msg.getMsg("Save") + '"><\/i><\/button><\/div><\/div><\/div><div class="vis-group-searchwrp"><div class="vis-group-content-headDown"><input class="vis-group-SearchText"  value="" placeholder="' + n.Msg.getMsg("Search") + '" type="text"><button class="vis-groupbtn vis-group-search-icon"><i class="vis vis-search"><\/i><\/button><\/div><\/div>'); b = s.find(".vis-group-SearchText"); ft = s.find(".vis-group-search-icon"); et = s.find(".vis-group-add-btn"); ot = s.find(".vis-group-save-btn"); nt = t('<div class="vis-group-role-container">'); l = t('<div class="vis-group-DataContainer">'); s.append(nt); nt.append(l); nt.height(t(e.parent()).height() - 95); ir() } function gi() { d.append("<li value=1>" + n.Msg.getMsg("Name") + "<\/li>"); d.append("<li value=2>" + n.Msg.getMsg("SearchKey") + "<\/li>"); d.append("<li value=3>" + n.Msg.getMsg("EMail") + "<\/li>"); lt.on("click", function () { t(this).w2overlay(d.clone(!0)) }); d.on(n.Events.onTouchStartOrClick, "LI", function () { ri = t(this).val(); pt() }) } function nr() { tr(); pt() } function tr() { var i = ' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap"  data-UID="{{VAF_UserContactID}}"><input type="radio" class="vis-GroupUserRadio"><div class="vis-group-user-profile vis-group-pro-width"><div class="vis-group-user-img vis-chatimgwrap">{{#if UserImage}}<img src="' + n.Application.contextUrl + '{{UserImage}}" alt="user-img">{{else}}<i class="fa fa-user"><\/i>{{/if}}<\/div><div class="vis-group-user-text">{{#if IsActive }}<p style="font-weight: bold">{{Username}}<\/p>{{else}}<p>{{Username}}<\/p>{{/if}}<span>{{Email}}<\/span><p>{{Country}}<\/p><\/div><\/div><div class="vis-group-user-right"><ul class="vis-flex-directionCol"><li><span class="vis-group-user-ico vis-group-edit vis vis-edit" style="padding-bottom: 15px;" title="' + n.Msg.getMsg("Edit") + '" data-UID="{{VAF_UserContactID}}-{{UserTableID}}-{{UserWindowID}}"><\/span><\/li>{{#if IsActive }}{{#if IsUpdate}}<li><span class="vis-group-user-ico vis-group-activeUser fa fa-check-circle" title="' + n.Msg.getMsg("Active") + '" data-UID="{{VAF_UserContactID}}"><\/span><\/li>{{else}}<li><span disabled class="vis-group-user-ico vis-group-activeUser fa fa-check-circle" title="' + n.Msg.getMsg("Active") + '" data-UID="{{VAF_UserContactID}}"><\/span><\/li>{{/if}}{{else}}{{#if IsUpdate}}<li><span class="vis-group-user-ico vis-group-inactiveUser fa fa-check-circle" title="' + n.Msg.getMsg("InActive") + '"  data-UID="{{VAF_UserContactID}}"><\/span><\/li>{{else}}<li><span disabled class="vis-group-user-ico vis-group-inactiveUser fa fa-check-circle" title="' + n.Msg.getMsg("InActive") + '" data-UID="{{VAF_UserContactID}}"><\/span><\/li>{{/if}}{{/if}}<\/ul><\/div><\/div>{{/each}}​<\/script>'; dt = t(i).html(); at = Handlebars.compile(dt) } function oi() { var i = ' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-roless vis-group-role-pad"  data-UID="{{VAF_Role_ID}}"><div class="vis-group-user-profile">{{#if IsAssignedToUser}}{{#if IsUpdate}}<input type="checkbox" data-UID="{{VAF_Role_ID}}" checked="">{{else}}<input disabled type="checkbox" data-UID="{{VAF_Role_ID}}" checked="">{{/if}}<label style="color: rgba(var(--v-c-on-secondary), 1);font-weight: bold;">{{Name}}<\/label>{{else}}{{#if IsUpdate}}<input type="checkbox" data-UID="{{VAF_Role_ID}}" >{{else}}<input disabled type="checkbox" data-UID="{{VAF_Role_ID}}" >{{/if}}<label>{{Name}}<\/label>{{/if}}<\/div><div class="vis-group-user-right"><ul><li><span class="vis-group-user-ico vis-group-edit vis vis-edit" title="' + n.Msg.getMsg("Edit") + '" data-UID="{{VAF_Role_ID}}-{{roleWindowID}}"><\/span><\/li><\/ul><\/div><\/div>{{/each}}​<\/script>'; gt = t(i).html(); ni = Handlebars.compile(gt) } function ir() { var i = ' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-groupss vis-group-role-pad" data-UID="{{VAF_Group_ID}}"><div class="vis-group-user-profile">{{#if IsAssignedToUser}}<input type="checkbox" data-UID="{{VAF_Group_ID}}" checked=""><label style="color: rgba(var(--v-c-on-secondary), 1);font-weight: bold;">{{Name}}<\/label>{{else}}<input type="checkbox" data-UID="{{VAF_Group_ID}}" ><label>{{Name}}<\/label>{{/if}}<\/div><div class="vis-group-user-right"><ul><li><span class="vis-group-user-ico vis-group-edit vis vis-edit" style="margin-right: 10px" title="' + n.Msg.getMsg("Edit") + '" data-UID="{{VAF_Group_ID}}-{{GroupWindowID}}"><\/span><\/li><li><span class="vis-group-user-ico vis-group-info vis vis-info"   data-UID="{{VAF_Group_ID}}-{{GroupWindowID}}"><\/span><\/li><\/ul>                           <\/div><\/div>{{/each}}​<\/script>'; ti = t(i).html(); ii = Handlebars.compile(ti) } function rr() { var t = new n.createUser; t.intialize(); t.show() } function ur() { var t = new n.createrole; t.intialize(); t.show() } function fr() { i[0].style.visibility = "visible"; yt == 0 && t.ajax({ url: n.Application.contextUrl + "Group/GetWindowIds", async: !1, success: function (n) { var t = JSON.parse(n); t != null && t != undefined && (yt = t.GroupWindowID, hi = t.RoleWindowID, ci = t.UserWindowID) }, error: function () { n.Msg.getMsg("VIS_GroupWindowNotFound") } }); var r = new n.Query; r.addRestriction("VAF_GroupInfo_ID", n.Query.prototype.EQUAL, 0); n.viewManager.startWindow(yt, r); i[0].style.visibility = "hidden" } function pt() { ct = 1; t.ajax({ url: n.Application.contextUrl + "Group/GetUserInfo", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { searchText: y.val(), sortBy: ri, pageNo: ct, pageSize: ei }, success: function (n) { var i = JSON.parse(n); h.find(".vis-group-user-wrap").remove(); h.append(at(i)); h.off("click"); h.on("click", cr); t(h.children(".vis-group-user-wrap")).length > 0 && t(h.children(".vis-group-user-wrap")[0]).trigger("click"); ct++ }, error: function () { n.ADialog.error("VIS_ErrorLoadingContacts"); i[0].style.visibility = "hidden" } }) } function er() { t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && t.ajax({ url: n.Application.contextUrl + "Group/GetUserInfo", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { searchText: y.val(), sortBy: ri, pageNo: ct, pageSize: ei }, success: function (n) { ct++; var t = JSON.parse(n); h.append(at(t)); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorLoadingContacts"); i[0].style.visibility = "hidden" } }) } function or(n) { (n.keyCode == undefined || n.keyCode == 13) && y != undefined && y != null && pt() } function sr(n) { (n.keyCode == undefined || n.keyCode == 13) && b != undefined && b != null && bt() } function hr(n) { (n.keyCode == undefined || n.keyCode == 13) && w != undefined && w != null && wt() } function cr(i) { var r, u, f; if (!(a.length > 0)) { if (r = t(i.target), t(t(h.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op vis-group-selected-opbackground"), t(h).find(".vis-GroupUserRadio").prop("checked", !1), r.hasClass("vis-group-user-wrap")) r.addClass("vis-group-selected-op vis-group-selected-opbackground"), vt = r.data("uid"), t(t(r).find(".vis-GroupUserRadio")[0]).prop("checked", !0); else if (t(r.parents(".vis-group-user-wrap")).length > 0) t(r.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op vis-group-selected-opbackground"), vt = t(r.parents().find(".vis-group-selected-op")).data("uid"), t(t(t(r).parents(".vis-group-user-wrap")[0]).find(".vis-GroupUserRadio")[0]).prop("checked", !0); else return; r.hasClass("vis-group-user-ico vis-group-edit") ? (u = r.data("uid").split("-"), f = new n.Query, f.addRestriction("VAF_UserContact_ID", n.Query.prototype.EQUAL, u[0]), n.viewManager.startWindow(u[2], f)) : r.hasClass("vis-group-user-ico vis-group-activeUser") && r.attr("disabled") != "disabled" ? si(r, !1) : r.hasClass("vis-group-user-ico vis-group-inactiveUser") && r.attr("disabled") != "disabled" && si(r, !0); wt(r) } } function wt() { i[0].style.visibility = "visible"; var r = w.val(); t.ajax({ url: n.Application.contextUrl + "Group/GetRoleInfo", data: { VAF_UserContact_ID: vt, name: r }, success: function (n) { var u = JSON.parse(n), r; c.find(".vis-group-user-wrap").remove(); c.append(ni(u)); c.off("click"); c.on("click", lr); for (t(c.children(".vis-group-user-wrap")).length > 0 && t(t(c).children(".vis-group-user-wrap")[0]).trigger("click"), st = [], r = 0; r < u.length; r++)st.push({ VAF_Role_ID: u[r].VAF_Role_ID, IsAssignedToUser: u[r].IsAssignedToUser }); t(c.find("input")).off("click"); t(c.find("input")).on("click", yr); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorLoadingRoles"); i[0].style.visibility = "hidden" } }) } function bt() { i[0].style.visibility = "visible"; var r = b.val(); t.ajax({ url: n.Application.contextUrl + "Group/GetGroupInfo", data: { VAF_Role_ID: u, name: r }, success: function (n) { var u = JSON.parse(n), r; l.find(".vis-group-user-wrap").remove(); l.append(ii(u)); l.off("click"); l.on("click", ar); for (t(l.children(".vis-group-user-wrap")).length > 0 && t(t(l).children(".vis-group-user-wrap")[0]).trigger("click"), ht = [], i[0].style.visibility = "hidden", r = 0; r < u.length; r++)r == 0 && (yt = u[r].GroupWindowID), ht.push({ VAF_Group_ID: u[r].VAF_Group_ID, IsAssignedToUser: u[r].IsAssignedToUser }); t(l.find("input")).off("click"); t(l.find("input")).on("click", pr) }, error: function () { n.ADialog.error("VIS_ErrorLoadingGroups"); i[0].style.visibility = "hidden" } }) } function lr(i) { var f, e; if (li = !0, r.length > 0) { n.ADialog.confirm("VIS_SaveGroup", !0, "", "Confirm", function (n) { n ? kt() : r = [] }); return } f = t(i.target); t(t(c.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op vis-group-selected-opbackground"); f.hasClass("vis-group-user-wrap") ? (f.addClass("vis-group-selected-op vis-group-selected-opbackground"), u = f.data("uid")) : u = t(f.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op vis-group-selected-opbackground").data("uid"); f.hasClass("vis-group-user-ico vis-group-edit") && (u = f.data("uid"), u = u.split("-"), e = new n.Query, e.addRestriction("VAF_Role_ID", n.Query.prototype.EQUAL, u[0]), n.viewManager.startWindow(u[1], e), u = u[0]); u != undefined && bt(f); i.originalEvent === undefined && i.stopPropagation() } function ar(i) { var r, u; ai = !0; r = t(i.target); t(t(l.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op"); r.hasClass("vis-group-user-wrap") ? (r.addClass("vis-group-selected-op"), f = r.data("uid")) : (t(r.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op"), f = t(r.parents().find(".vis-group-selected-op")).data("uid")); r.hasClass("vis-group-user-ico vis-group-edit") ? (f = r.data("uid"), f = f.split("-"), u = new n.Query, u.addRestriction("VAF_GroupInfo_ID", n.Query.prototype.EQUAL, f[0]), n.viewManager.startWindow(f[1], u)) : r.hasClass("vis-group-user-ico vis-group-info") && (f = r.data("uid"), f = f.split("-"), vr(f[0])); i.originalEvent === undefined && i.stopPropagation() } function vr(t) { var i = new n.groupInfo(t); i.intialize(); i.show() } function yr(i) { if (r.length > 0) { n.ADialog.confirm("VIS_SaveGroup", !0, "", "Confirm", function (n) { n ? kt() : r = [] }); return } var f = t(i.target), u = t.grep(st, function (n) { return n.VAF_Role_ID == f.data("uid") }); u != null && u.length > 0 && (u[0].IsAssignedToUser = f.prop("checked")); u = t.grep(a, function (n) { return n == f.data("uid") }); u == null || u.length == 0 ? a.push(f.data("uid")) : a.splice(a.indexOf(f.data("uid")), 1); i.stopPropagation() } function pr(i) { if (a.length > 0) { n.ADialog.confirm("VIS_SaveRole", !0, "", "Confirm", function (n) { n ? ui() : a = [] }); return } var f = t(i.target), u = t.grep(ht, function (n) { return n.VAF_Group_ID == f.data("uid") }); u != null && u.length > 0 && (u[0].IsAssignedToUser = f.prop("checked")); u = t.grep(r, function (n) { return n == f.data("uid") }); u == null || u.length == 0 ? r.push(f.data("uid")) : r.splice(r.indexOf(f.data("uid")), 1); i.stopPropagation() } function ui() { i[0].style.visibility = "visible"; a = []; t.ajax({ url: n.Application.contextUrl + "Group/UpdateUserRoles", type: "Post", data: { VAF_UserContact_ID: vt, roles: JSON.stringify(st) }, success: function () { t(t(o.find("h7"))[0]).show(); t(t(o.find("h7"))[0]).fadeOut(1600, "linear"); wt() }, error: function () { n.ADialog.error(n.Msg.getMsg("VIS_ErrorSavingRole")); i[0].style.visibility = "hidden" } }) } function kt() { i[0].style.visibility = "visible"; r = []; t.ajax({ url: n.Application.contextUrl + "Group/UpdateUserGroups", type: "Post", data: { VAF_Role_ID: u, VAF_Group_ID: f, groups: JSON.stringify(ht) }, success: function () { t(t(s.find("h7"))[0]).show(); t(t(s.find("h7"))[0]).fadeOut(1600, "linear"); bt() }, error: function () { n.ADialog.error(n.Msg.getMsg("VIS_ErrorSavingGroups")); i[0].style.visibility = "hidden" } }) } function si(r, u) { i[0].style.visibility = "visible"; var f = ""; u ? (r.removeClass("vis-group-user-ico vis-group-inactiveUser"), r.addClass("vis-group-user-ico vis-group-activeUser"), f = n.Application.contextUrl + "Group/ActiveUser") : (r.removeClass("vis-group-user-ico vis-group-activeUser"), r.addClass("vis-group-user-ico vis-group-inactiveUser"), f = n.Application.contextUrl + "Group/InActiveUser"); t.ajax({ url: f, data: { VAF_UserContact_ID: r.data("uid") }, success: function (t) { var f = JSON.parse(t); f < 1 && n.ADialog.error("VIS_UserNotUpdated"); u ? r.prop("title", n.Msg.getMsg("Active")) : r.prop("title", n.Msg.getMsg("InActive")); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_UserNotUpdated"); i[0].style.visibility = "hidden" } }) } this.frame = null; this.windowNo = null; var fi = this, e = t('<div class="vis-group-assign-content">'), d = t('<ul class="vis-apanel-rb-ul"><\/ul>'), v = null, o = null, s = null, p = null, y = null, tt = null, k = null, lt = null, it = null, rt = null, g = null, h = null, c = null, l = null, i = null, w = null, ut = null, b = null, ft = null, et = null, ot = null, nt = null, dt, at, gt, ni, ti, ii, ri = -1, vt = 0, st = [], ht = [], a = [], r = [], u = 0, f = 0, yt = 0, hi = 0, ci = 0, ct = 0, ei = 20, li = !1, ai = !1; this.initializeComponent = function () { vi(); pi(); gi() }; this.disposeComponent = function () { k != null && k != undefined && k.off("click"); tt.off("click"); y.off("keydown"); rt.off("click"); ot.off("click"); ft.off("click"); b.off("keydown"); ut.off("click"); w.off("keydown"); et.off("click"); it.off("click"); p.off("scroll"); e.off("click"); this.frame = null; this.windowNo = null; v.remove(); v = null; o.remove(); o = null; s.remove(); s = null; p.remove(); p = null; y.remove(); y = null; tt.remove(); tt = null; k.remove(); k = null; lt.remove(); lt = null; it.remove(); it = null; rt.remove(); rt = null; g.remove(); g = null; i.remove(); i = null; b.remove(); b = null; ft.remove(); ft = null; w.remove(); w = null; ut.remove(); ut = null; et.remove(); et = null; ot.remove(); ot = null; nt.remove(); nt = null; dt.remove(); at.remove(); gt.remove(); ni.remove(); ti.remove(); ii.remove(); st = null; ht = null; a = null; r = null; e.remove(); e = null; d = null; fi = null }; this.getRoot = function () { return e } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; t.setTitle("VIS_Group"); this.frame.getContentGrid().append(this.getRoot()); this.initializeComponent() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.GroupForm = i }(VIS, jQuery), function (n, t) { function i() { function ft() { i = t("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>"); i[0].style.visibility = "hidden"; r.append(i) } function et() { r = t("<div>"); var i = '  <div style="overflow:hidden" class="vis-group-assinRole-content"><div class="vis-group-assinRole-data" style=" margin-top: 5px; margin-bottom: 0; "><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input  tabindex="1" class="vis-group-email" type="text" name="Name" data-placeholder="" placeholder=" "><label>' + n.Msg.getMsg("EMail") + '<\/label><\/div><\/div><\/div><div style="width:auto;float:right;" class="vis-group-assinRole-data"> <a tabindex="2" class="vis-group-btn vis-group-pointer vis-group-create vis-group-grayBtn" style="float: left;">' + n.Msg.getMsg("Create") + '<\/a><a tabindex="3" class="vis-group-btn vis-group-pointer vis-group-invite vis-group-blueBtn" style="float: right;">' + n.Msg.getMsg("VIS_Invite") + "<\/a><\/div><\/div>"; s = t('<div class="vis-group-assignContainer" style="visibility:hidden"><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input  tabindex="4" type="text" maxlength="60" data-placeholder="" placeholder=" " class="vis-group-name vis-group-mandatory"  name="Name"><label>' + n.Msg.getMsg("Name") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="5" type="text" maxlength="80" data-placeholder="" placeholder=" " class="vis-group-uid"  name="Name"><label>' + n.Msg.getMsg("VIS_UserID") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="6" type="password" maxlength="250" data-placeholder="" placeholder=" " class="vis-group-pwd"  name="Name"><label>' + n.Msg.getMsg("Password") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="7" type="text"  maxlength="50" data-placeholder="" placeholder=" " class="vis-group-mobile"  name="Name"><label>' + n.Msg.getMsg("Mobile") + '<\/label><\/div><\/div><\/div><a tabindex="8" class="vis-group-btn vis-group-Save vis-group-pointer vis-group-grayBtn" style="float: right;">' + n.Msg.getMsg("Save") + "<\/a><\/div>"); o = t('<div class="vis-group-roleContainer" ><div> <label >' + n.Msg.getMsg("SelectRole") + "<\/label> <\/div><\/div>"); r.append(i); f = r.find(".vis-group-assinRole-content"); f.height("100px"); c = r.find(".vis-group-create"); l = r.find(".vis-group-invite"); a = s.find(".vis-group-Save"); e = s.find(".vis-group-name"); p = s.find(".vis-group-uid"); b = s.find(".vis-group-mobile"); w = s.find(".vis-group-pwd"); v = r.find(".vis-group-email") } function ot() { e.on("change", lt); c.on("click", tt); c.on("keydown", st); l.on("click", it); l.on("keydown", ct); a.on("click", rt); a.on("keydown", ht) } function st(n) { (n.keyCode == undefined || n.keyCode == 13) && tt() } function ht(n) { (n.keyCode == undefined || n.keyCode == 13) && rt() } function ct(n) { (n.keyCode == undefined || n.keyCode == 13) && it() } function lt() { e.val().length > 0 ? e.removeClass("vis-group-mandatory") : e.addClass("vis-group-mandatory") } function at() { g = t(' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-role-pad"  data-UID="{{VAF_Role_ID}}"><div class="vis-group-user-profile"><input tabindex="7"  type="checkbox" data-UID="{{VAF_Role_ID}}" ><label>{{Name}}<\/label><\/div><\/div>{{/each}}​<\/script>').html(); nt = Handlebars.compile(g) } function vt() { i[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Group/GetRoleInfo", data: { VAF_UserContact_ID: 0 }, success: function (r) { var f = JSON.parse(r), e = t('<div style="height:212px;overflow:auto;margin-bottom:10px">'), u; e.append(nt(f)); o.append(e); k = t('<a tabindex="400" class="vis-group-btn vis-group-pointer vis-group-finish vis-group-grayBtn" style="float: right;">' + n.Msg.getMsg("VIS_Finish") + "<\/a>"); o.append(k); k.on("click", ut); k.on("keydown", yt); for (t(o.children(".vis-group-user-wrap")).length > 0 && t(t(o).children(".vis-group-user-wrap")[0]).trigger("click"), u = 0; u < f.length; u++)d.push({ VAF_Role_ID: f[u].VAF_Role_ID, IsAssignedToUser: !1 }); t(o.find("input")).off("click"); t(o.find("input")).on("click", pt); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorLoadingRoles"); i[0].style.visibility = "hidden" } }) } function yt(n) { (n.keyCode == undefined || n.keyCode == 13) && ut() } function pt(n) { var r = t(n.target), i = t.grep(d, function (n) { return n.VAF_Role_ID == r.data("uid") }); i != null && i.length > 0 && (i[0].IsAssignedToUser = r.prop("checked")); n.stopPropagation() } function tt() { f.find(".vis-group-roleContainer").css("display", "none"); f.find(".vis-group-assignContainer").css("display", "inherit"); f.append(s); r.find(".vis-group-assignContainer").css({ visibility: "visible" }); f.height("400px") } function it() { f.find(".vis-group-assignContainer").css("display", "none"); f.find(".vis-group-roleContainer").css("display", "inherit"); f.append(o); f.height("403px") } function rt() { var f, o; if (t(r.find(".vis-group-assignContainer")[0]).css("visibility") == "visible") { if (f = e.val(), f == null || f == undefined || f == "") { n.ADialog.info("VIS_PleaseName"); return } i[0].style.visibility = "visible"; (y == null || y == undefined) && (y = null); o = n.secureEngine.encrypt(w.val()); t.ajax({ url: n.Application.contextUrl + "Group/SaveNewUser", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { Name: f, Email: v.val(), Value: p.val(), password: o, mobile: b.val(), OrgID: JSON.stringify(y) }, success: function (t) { var r = JSON.parse(t); i[0].style.visibility = "hidden"; r.length > 0 ? n.ADialog.error(r) : (n.ADialog.info("Record saved successfully"), u.close()) }, error: function () { i[0].style.visibility = "hidden"; n.ADialog.error("VIS_ErrorSavingUser") } }) } } function ut() { var r = v.val(), h, s, e, f, o; if (r == null || r == undefined || r == "") { n.ADialog.error("NotValidEmail"); return } if (h = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i), r.indexOf(";") == -1) { if (f = h.test(r), !f) { n.ADialog.error("NotValidEmail", !0, ":" + r); return } } else for (s = r.split(";"), e = 0; e < s.length; e++)if (f = h.test(s[e]), !f) { n.ADialog.error("NotValidEmail", !0, ":" + s[e]); return } if (o = t.grep(d, function (n) { return n.IsAssignedToUser == !0 }), o == null || o == undefined || o.length == 0) { n.ADialog.info("VIS_SelectRole"); return } r != null && r != undefined && r != "" && r.length > 0 && (i[0].style.visibility = "visible", t.ajax({ url: n.Application.contextUrl + "Group/InviteUsers", type: "POST", datatype: "json", async: !0, data: { email: r, roles: JSON.stringify(o) }, success: function (t) { var r = JSON.parse(t); n.ADialog.info(r); i[0].style.visibility = "hidden"; u.close() }, error: function () { n.ADialog.error("VIS_ErrorInvitingUsers"); i[0].style.visibility = "hidden" } })) } var r = null, f = null, c = null, l = null, a = null, v = null, e = null, p = null, w = null, b = null, u = null, h = this, y = null, i = null, g, nt = null, o = null, d = [], s = null, k = null; this.intialize = function () { et(); ot(); ft(); at(); vt() }; this.setSelectedOrg = function (n) { y = n }; this.show = function () { u = new n.ChildDialog; u.setContent(r); u.setPosition({ my: "center bottom-3" }); u.setWidth(550); u.setTitle(n.Msg.getMsg("VIS_CreateUser")); u.setModal(!0); u.onClose = function () { h.onClose && h.onClose(); h.dispose() }; u.show(); u.hideButtons() }; this.dispose = function () { this.prop = null; $div = null; u = null; h = null; r.remove(); r = null; c.remove(); c = null; l.remove(); l = null; a.remove(); a = null; v.remove(); v = null; e.remove(); e = null; p.remove(); p = null; w.remove(); w = null; b.remove(); b = null; u = null; h = null } } n.createUser = i }(VIS, jQuery), function (n, t) { function i(i) { function h() { u = t("<div>"); t.ajax({ url: n.Application.contextUrl + "Group/GetOrgAccess", success: function (n) { var i = JSON.parse(n); u.append(s(i)); t(u.find("input")).on("click", a) }, error: function () { n.ADialog.error("VIS_ErrorLoadingOrg") } }) } function c() { o = t(' <script type="text/x-handlebars-template">{{#each this}}<div style="border-bottom:1px solid lightgray" class="vis-group-assinRole-check"><div style="width:100%" class="vis-group-user-profile"><input type="Checkbox" data-uid="{{OrgID}}"> <p style="margin-bottom:2px">{{OrgName}}<\/p><span style="margin-left:30px;float:left">{{Description}}<\/span><\/div><\/div>{{/each}}​<\/script>').html(); s = Handlebars.compile(o) } function l() { r.onOkClick = function () { i(f); e.dispose() }; r.onCancelClick = function () { e.dispose() } } function a(n) { var i = t(n.target); i.prop("checked") ? t.inArray(i.data("uid")) == -1 && f.push(i.data("uid")) : f.splice(f.indexOf(i.data("uid")), 1) } var u = null, o, s = null, r = null, f = [], e = this; this.intialize = function () { c(); h() }; this.show = function () { r = new n.ChildDialog; r.setContent(u); r.setWidth(450); r.setHeight(350); r.setTitle(n.Msg.getMsg("VIS_OrgAccess")); r.setModal(!0); r.onClose = function () { e.dispose() }; r.show(); l() }; this.dispose = function () { this.prop = null; $div = null; u.remove(); u = null; o = null; s = null; r = null; e = null; f = null } } n.orgAccess = i }(VIS, jQuery), function (n, t) { function i(i) { function f() { u = t('<div  class="vis-forms-container">'); e() } function e() { t.ajax({ url: n.Application.contextUrl + "Group/GetGroupChildInfo", data: { groupID: i }, success: function (t) { var i = JSON.parse(t), r = '<div class="vis-group-gi-content"><label>' + i.GroupName + "<\/label>"; i.Description != null && i.Description != undefined && i.Description != "" && (r += "<p>" + i.Description + "<\/p>"); i.WindowName != null && i.WindowName != undefined && i.WindowName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("Windows") + ":<\/label><p>" + i.WindowName + "<\/p>", "<\/div>"); i.FormName != null && i.FormName != undefined && i.FormName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("VIS_Forms") + ":<\/label><p>" + i.FormName + "<\/p>", "<\/div>"); i.ProcessName != null && i.ProcessName != undefined && i.ProcessName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("VIS_Processes") + ":<\/label><p>" + i.ProcessName + "<\/p>", "<\/div>"); i.WorkflowName != null && i.WorkflowName != undefined && i.WorkflowName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("VIS_Workflows") + ":<\/label><p>" + i.WorkflowName + "<\/p>", "<\/div>"); r += "<\/div>"; u.append(r) }, error: function () { n.ADialog.error("VIS_ErrorGettingGroupInfo") } }) } var u = null, r = null; this.intialize = function () { f() }; this.show = function () { r = new n.ChildDialog; r.setContent(u); r.setHeight(500); r.setWidth(550); r.setTitle(n.Msg.getMsg("VIS_Groupinfo")); r.setModal(!0); r.onClose = function () { self.onClose && self.onClose(); self.dispose() }; r.show(); r.hideButtons() }; this.dispose = function () { self = null; u.remove(); u = null; r = null } } n.groupInfo = i }(VIS, jQuery), function (n, t) { function i() { function v() { var i = '<div class="vis-group-assinRole-content"><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="1" maxlength="60" data-placeholder="" placeholder=" " class="vis-group-role-text vis-ev-col-mandatory" type="text"><label>' + n.Msg.getMsg("Role") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><select  tabindex="2"  class="vis-group-role-select" ><\/select><label>' + n.Msg.getMsg("VIS_UserLevel") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><a style="float:left"  tabindex="3"  class="vis-group-btn vis-group-orgAccess vis-group-pointer vis-group-grayBtn">' + n.Msg.getMsg("VIS_OrgAccess") + '<\/a><a  tabindex="4"  class="vis-group-btn vis-group-Save vis-group-pointer vis-group-grayBtn" style="float: right;">' + n.Msg.getMsg("Save") + "<\/a><\/div><\/div>"; r.append(i); u = r.find(".vis-group-role-text"); o = r.find(".vis-group-role-select"); s = r.find(".vis-group-orgAccess"); h = r.find(".vis-group-Save"); y(); f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Group/GetUserLevel", success: function (n) { var t = JSON.parse(n), i; if (t != null && t.length > 0) for (i = 0; i < t.length; i++)o.append('<option value="' + t[i].ID + '">' + t[i].Name + "<\/option>"); f[0].style.visibility = "hidden" } }) } function y() { f = t("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>"); f[0].style.visibility = "hidden"; r.append(f) } function p() { s.on("click", l); s.on("keydown", w); h.on("click", a); h.on("keydown", b); u.on("change", k) } function w(n) { (n.keyCode == undefined || n.keyCode == 13) && l() } function b(n) { (n.keyCode == undefined || n.keyCode == 13) && a() } function k() { u.val().length > 0 ? u.removeClass("vis-group-mandatory") : u.addClass("vis-group-mandatory") } function l() { var t = new n.orgAccess(c.setSelectedOrg); window.setTimeout(function () { t.intialize(); t.show() }, 20) } function a() { var s = u.val(), r = o.val(); if (s == null || s == undefined || s == "") { n.ADialog.info("VIS_PleaseName"); return } if (e == undefined || e == null || e == "" || e.length == 0) { n.ADialog.info("VIS_SelectOrgAccess"); return } if (r == null || r == undefined || r == "" || r == -1) { n.ADialog.info("VIS_SelectUserLevel"); return } f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Group/AddNewRole", data: { name: s, userLevel: r, orgID: JSON.stringify(e) }, success: function (t) { var r = JSON.parse(t); r.length > 0 ? n.ADialog.error(r) : (n.ADialog.info("Record saved successfully"), i.close()); f[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorSavingRole"); f[0].style.visibility = "hidden" } }) } var r = t("<div>"), i = null, u = null, o = null, s = null, h = null, e = null, c = this, f = null; this.intialize = function () { v(); p() }; this.setSelectedOrg = function (n) { e = n }; this.show = function () { i = new n.ChildDialog; i.setContent(r); i.setWidth(550); i.setTitle(n.Msg.getMsg("VIS_CreateRole")); i.setModal(!0); i.onClose = function () { c.dispose(); c = null }; i.show(); i.hideButtons() }; this.dispose = function () { u.remove(); u = null; o.remove(); o = null; s.remove(); s = null; h.remove(); h = null; r.remove(); r = null; i = null } } n.createrole = i }(VIS, jQuery), function (n, t) { function i() { var b, k, d, g, p; this.onClose = null; var nt = this, r = null, u = null, e = null, a = null, o = null, s = null, h = null, i = null, c = [], w = null, v = null, tt = null, y = [], f = [], l = null, it = function () { r = t("<div>"); u = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); u[0].style.visibility = "visible"; r.append(u); e = t("<div>"); a = t("<div class='vis-markmodulemainwrap'>"); e.append(a); h = t("<div>"); e.append(h); var i = n.Msg.getMsg("Cancel"), f = n.Msg.getMsg("Ok"); s = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(i); o = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(f); h.append(s); h.append(o); r.append(e); l = t("<table>") }; it(); b = function () { s.on("click", function () { p() }); o.on("click", function () { d() }) }; b(); k = function () { var k, d, e, r, b, o; if (i = [], k = null, e = n.dataContext.getJSONData(n.Application.contextUrl + "MarkModule/LoadModules", null, null), e != null) for (r in e) k = {}, k.VAF_ModuleInfo_ID = e[r].VAF_ModuleInfo_ID, k.Name = e[r].Name, i.push(k); if (c.length == 1 && (d = { RecordID: c[0], TableID: v }, e = n.dataContext.getJSONData(n.Application.contextUrl + "MarkModule/GetExportData", d, null), e != null)) for (r in e) y.push(e[r]); var h = null, p = null, s = null, w = null; if (y.length == 0) for (r = 0; r < i.length; r++)h = t("<tr>"), p = t("<td>"), s = t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'), w = t("<input type='checkbox'>"), s.append(w), s.append(i[r].Name), p.append(s), h.append(p), l.append(h), o = {}, o.Ctrl = w, o.VAF_ModuleInfo_ID = i[r].VAF_ModuleInfo_ID, f.push(o); else for (b = 0; b < i.length; b++)h = t("<tr>"), p = t("<td>"), s = t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'), w = y.indexOf(i[b].VAF_ModuleInfo_ID) > -1 ? t("<input type='checkbox' checked>") : t("<input type='checkbox'>"), s.append(w), s.append(i[b].Name), p.append(s), h.append(p), l.append(h), o = {}, o.Ctrl = w, o.VAF_ModuleInfo_ID = i[b].VAF_ModuleInfo_ID, f.push(o); a.append(l); u[0].style.visibility = "hidden" }; d = function () { var i, t, e, o, r; for (u[0].style.visibility = "visible", i = [], t = 0; t < f.length; t++)e = f[t].Ctrl, e.prop("checked") && i.push(f[t].VAF_ModuleInfo_ID); o = { moduleId: i, _recordID: c, _tableID: v, _strRecordID: w }; r = n.dataContext.getJSONData(n.Application.contextUrl + "MarkModule/SaveExportData", o); r.result != "OK" && alert(r.result); u[0].style.visibility = "hidden"; p() }; this.show = function () { r.dialog({ title: n.Msg.getMsg("VIS_MarkModule"), width: 400, height: 500, resizable: !1, modal: !0, close: g }); k() }; this.init = function (n, t, i) { c = n.toString().split(","); w = n; v = t; tt = i }; g = function () { p() }; p = function () { nt.onClose && nt.onClose(); e = null; a = null; s.off("click"); o.off("click"); o = null; s = null; h = null; k = null; d = null; it = null; b = null; g = null; u = null; i = null; c = null; w = null; v = null; tt = null; y = null; f = null; l = null; r != null && (r.dialog("destroy"), r.remove()); r = null } } n.MarkModule = i }(VIS, jQuery), function (n, t) { function r(r) { function uf() { di = t('<div class="vis-forms-container" style="width:100%;height:100%"><\/div>'); ff(); ef(); su(); ki = !0; hu(); af(y) } function si(n) { n && pt != null && pt.css({ display: "block" }); n || pt == null || pt.css({ display: "none" }) } function sf() { rt != null && rt.children().find("input").prop("checked", !1) } function yr(n) { var t, i; if (n == null || n.length == 0) return null; for (t = 0; t < h.getFields().length; t++)if (i = h.getFields()[t], n.equals(i.getColumnName())) return i; return null } function vu(t) { var i = null, r; return (t && (i = yt), i != null) ? i.getDisplayType() == n.DisplayType.YesNo ? i.getValue().toString().toLowerCase() == "true" ? "Y" : "N" : n.DisplayType.IsDate(i.getDisplayType()) ? (r = i.getValue(), r && r.endsWith(".000Z") && (r = r.replace(".000Z", "Z")), r) : i.getValue() : "" } function vf(t) { var i = null; if (t && (i = yt), i != null) { if (i.getDisplayType() == n.DisplayType.YesNo) return i.getValue().toString().toLowerCase() == "true" ? "Y" : "N"; i.setValue("") } } function yu(n) { var t = null; return (n && (t = yt), t != null) ? t.getDisplay() : "" } function yf(n) { var t = null; return (n && (t = yt), t != null) ? t.getDisplayType("") : "" } function pr(n) { var t = null; n && (t = yt); t != null && t.setValue(null) } function pu(n) { var r = et.children()[1], i = null; et.children().length > 2 && (i = et.children()[2]); i ? t(i).prop("disabled", !n).prop("readonly", !n) : r != null && t(r).prop("disabled", !n).prop("readonly", !n) } function pf(n, t) { n.prop("disabled", !t) } function wr(i, r) { var f, o, u, e; i && (yt = null); rf = null; f = null; o = null; i && (f = et.children()[0], et.children().length > 1 && (o = et.children()[1])); f != null && (t(f).remove(), o != null && t(o).remove(), f = null); u = null; u = r != null ? r.getIsKey() ? new n.Controls.VNumTextBox(r.getColumnName(), !1, !1, !0, r.getDisplayLength(), r.getFieldLength(), r.getColumnName()) : n.VControlFactory.getControl(null, r, !0, !0, !1) : new n.Controls.VTextBox("columnName", !1, !0, !1, 20, 20, "format", "GetObscureType", !1); u != null && (u.setReadOnly(!1), n.DisplayType.Text == r.getDisplayType() || n.DisplayType.TextLong == r.getDisplayType() ? (u.getControl().attr("rows", "1"), u.getControl().css("width", "100%")) : n.DisplayType.YesNo == r.getDisplayType() ? u.getControl().css("clear", "both") : n.DisplayType.IsDate(r.getDisplayType()) && u.getControl().css("line-height", "1"), e = null, u.getBtnCount() > 0 && !(u instanceof n.Controls.VComboBox) && (e = u.getBtn(0)), i && (et.append(u.getControl().css("width", "95%")), yt = u, e && (et.append(e), u.getControl().css("width", "60%"), e.css("max-width", "35px")))) } function wf(n) { var e = {}, o, r; nt = {}; var u = "", s = "", t = null, i = null, h = null, c = null, l = null, a = null, v = null, y = null; for (o = 0; o < n.length; o++) { for (nt = {}, nt.Color = n[o].Color, nt.Condition = [], u = n[o].ConditionValue.split("&"), s = n[o].ConditionText.split("&"), r = 0; r < u.length; r++)e = {}, u[r].contains("!") ? (t = u[r].trim().split("!"), i = s[r].trim().split("!"), v = "!", y = "!=", h = i[0].trim().substring(1, i[0].lastIndexOf("@")), c = t[0].trim().substring(1, t[0].lastIndexOf("@")), a = i[1], l = t[1]) : u[r].contains("=") ? (t = u[r].split("="), i = s[r].split("="), v = "=", y = "=", h = i[0].trim().substring(1, i[0].lastIndexOf("@")), c = t[0].trim().substring(1, t[0].lastIndexOf("@")), a = i[1], l = t[1]) : u[r].contains("<") ? (t = u[r].split("<"), i = s[r].split("<"), v = "<", y = "<", h = i[0].trim().substring(1, i[0].lastIndexOf("@")), c = t[0].trim().substring(1, t[0].lastIndexOf("@")), a = i[1], l = t[1]) : u[r].contains(">") && (t = u[r].split(">"), i = s[r].split(">"), v = ">", y = ">", h = i[0].trim().substring(1, i[0].lastIndexOf("@")), c = t[0].trim().substring(1, t[0].lastIndexOf("@")), a = i[1], l = t[1]), e.ColHeader = h, e.ColName = c, e.Operator = v, e.OperatorText = y, e.QueryValue = l, e.QueryText = a, nt.Condition.push(e); f.push(nt) } ki || ni(f) } var wt = r.curGC, h = wt.getMTab(), d = wt.vCardView, br = h.getVAF_Screen_ID(), kr = h.getVAF_Tab_ID(), wu = h.getName(), bu = r.curGC.aPanel.$parentWindow.getName(), e = d.getVAF_CardView_ID(), tt = d.getField_Group_ID(), st = 0, hi = 0, gi = null, nr = null, tr = null, ir = null, bt = null, l = null, ku = [], s = h.getFields(), rr = [], ur = null, ci = null, dr = 0, a = -1, li = 0, ti = 0, ti = 0, du = 0, ii = [], p = [], gr = [], gu = 0, ri = "", nf = 0, v = 0, w = !1, tf = null, ft = null, kt = null, ai = null, vi = null, fr = null, nu = null, tu = null, er = null, or = null, ui = null, yi = null, u = null, o = null, pi = null, sr = null, hr = null, it = null, c = 0, g = null, ri = "", ht = 0, cr = 0, iu = [], ru = 0, bf = n.context.getVAF_UserContact_Name(), wi = null, bi = null, lt = null, at = null, rt = null, ut = [], vt = null, ct = "", fi = !1, uu = n.Msg.getMsg("IsDefault"), y = null, yt = null, rf = null, et = null, b = null, fu = h.getFields().slice(), lr = this, ot = null, f = [], nt = null, dt = null, ei = [], oi = null, ki = !1, eu = [], pt = null, di, k, ff = function () { for (var n = 0; n < h.getFields().length; n++)rr.push(h.getFields()[n]); for (n = 0; n < d.fields.length; n++)iu.push(d.fields[n].getVAF_Field_ID()) }, ef = function () { var i; pt = t("<div class='vis-apanel-busy vis-cardviewmainbusy'><\/div> "); u = t("<div class='vis-cardviewmain'><\/div>"); var e = t("<div class='vis-cardviewmainfirstchild vis-pull-left'><\/div>"), f = t("<div class='vis-cardviewtopfieldswrap'><\/div>"), s = t("<div class='vis-cardviewmainsecondchild'><\/div>"), r = t("<div class='vis-cardviewCondition'><\/div>").append("<div class='vis-cardviewConditionControls'> <\/div>  <div class='vis-cardviewConditionGrid'> <\/div> "), c = t("<div class='vis-cardviewbtn'><button class='vis-btnDelete'><i class='vis vis-delete'><\/i><\/button> <div class='vis-cdv-customokcancle'><button class='vis-btnOk'>  " + n.Msg.getMsg("Ok") + "  <\/button><button class='vis-btnCardViewCancle'>  " + n.Msg.getMsg("Cancel") + "  <\/button><\/div> <\/div>"); u.append(e); e.append(f); f.append("<div class='vis-firstdiv vis-pull-left' ><\/div>"); f.append("<div class='vis-cv-blankdiv' ><\/div>"); f.append("<div class='vis-seconddiv vis-pull-right'><\/div>"); e.append("<div class='vis-thirddiv vis-pull-left' ><\/div>"); u.find(".vis-firstdiv").append("<div class='vis-first-divHeader'><label class='vis-ddlcardview'>" + n.Msg.getMsg("SelectCardView") + " <\/label><label style='display:none' class='vis-lbcardviewname'>" + n.Msg.getMsg("CardViewName") + " <\/label><\/div>  "); var h = t("<div class='vis-CardView vis-pull-left'> <div  class='vis-cardviewchild vis-pull-left'><\/div>  <\/div>"), a = t("<input style='display:none' class='vis-txtcardviewname' type='text'>"), v = t("<div class='vis-User vis-pull-left'><\/div>"), p = t("<div class='vis-pull-left'><button  class='vis-btnnew vis-cvd-btn'><i class='vis vis-plus'><\/i><\/button><button style='display:none' class='vis-btncancle vis-cvd-canclebtn'><i class='vis vis-mark'><\/i><\/button> <button class='vis-btnedit vis-cvd-editbtn'><i class='vis vis-pencil'><\/i><\/button><\/div>"); h.find(".vis-cardviewchild").append("<select class='vis-cmbcardview'> <\/select>"); v.append("<Select type='text' class='vis-cmbuser'> <\/Select>"); n.MRole.isAdministrator ? (u.append(s), u.find(".vis-firstdiv").append(" <div style='display:none' class='vis-first-divHeader vis-pull-right'><label >" + n.Msg.getMsg("SelectUser") + "<\/label><\/div>"), u.find(".vis-CardView").append(""), u.find(".vis-firstdiv").append(h), u.find(".vis-cardviewchild").append(a), u.find(".vis-cardviewchild"), u.find(".vis-CardView").append(p), pi = u.find(".vis-cmbuser"), ou(r.find(".vis-cardviewConditionControls")), u.append(r), u.append(c), u.find(".vis-btnDelete").css("display", "block")) : (r, u.find(".vis-firstdiv").append(h), u.find(".vis-cardviewchild").append(a), u.find(".vis-cardviewchild"), u.find(".k ").css("display", "none"), ou(r.find(".vis-cardviewConditionControls")), u.append(r), u.append(c), u.find(".vis-btnDelete").css("display", "none")); lf(u.find(".vis-cardviewConditionGrid")); s.append("<label class='vis-pull-left'> " + n.Msg.getMsg("SelectRole") + "<\/label>"); s.append("<div class='vis-cardviewmainsecondchildinner'><ul class='vis-ulrole'> <\/ul><\/div>"); rt = u.find(".vis-ulrole"); bi = u.find(".vis-ddlcardview"); o = u.find(".vis-cmbcardview"); wi = u.find(".vis-lbcardviewname"); g = u.find(".vis-txtcardviewname"); lt = u.find(".vis-btnnew"); at = u.find(".vis-btncancle"); btnEdit = u.find(".vis-btnedit"); i = t("<div class='vis-divtextcontrol' ><\/div>"); i.append("<div style='display:none' class='vis-second-divHeader vis-pull-left' ><div> <label>" + n.Msg.getMsg("Window") + "<\/label><\/div><div><input type='text'  class='vis-txtwindowname'><\/div><\/div>"); i.append("<div style='display:none' class='vis-second-divHeader vis-pull-left' ><div><label>" + n.Msg.getMsg("Tab") + "<\/label><\/div><div><input type='text'  class='vis-txttabname'><\/div><\/div>"); i.append("<div class='vis-second-divHeader vis-pull-left' ><div><label>" + n.Msg.getMsg("GroupByField") + "<\/label><\/div><div class='vis-CardView'><select class='vis-cmbgroupfield'> <\/select><\/div><\/div>"); u.find(".vis-seconddiv").append(i); sr = i.find(".vis-txtwindowname"); hr = i.find(".vis-txttabname"); it = i.find(".vis-cmbgroupfield"); kt = n.MRole.isAdministrator ? t("<div class='vis-third-header vis-pull-left'><\/div>") : t("<div style='width:101%' class='vis-third-header vis-pull-left'><\/div>"); ai = t("<div class='vis-left-fields vis-pull-left'><\/div>"); vi = t("<div class='vis-left-fields vis-pull-left' ><\/div>"); fr = t("<div class='vis-cardviewbutton vis-pull-left' ><button class='vis-btnup'><i class='vis vis-arrow-up'><\/i><\/button><button  class='vis-btnright'><i class='vis vis-shiftright'><\/i><\/button><\/div>"); fr.append("<button   class='vis-btnleft'><i class='vis vis-shiftleft'><\/i><\/button><button  class='vis-btndown'><i class='vis vis-arrow-down'><\/i><\/button>"); nu = t("<div style='width:100%'><label>" + n.Msg.getMsg("SelectField") + "<\/label><\/div>"); tu = t("<div style='width:100%'><label>" + n.Msg.getMsg("IncludedField") + "<\/label><\/div>"); er = t("<div class='vis-cv-filedslist-wrap'><\/div>"); or = t("<div class='vis-cv-filedslist-wrap'><\/div>"); ui = t("<ul  class='vis-windowfield'><\/ul>"); yi = t("<ul  class='vis-cardviewcolumnfield'><\/ul>"); er.append(ui); or.append(yi); ai.append(nu); ai.append(er); vi.append(tu); vi.append(or); kt.append(ai); kt.append(fr); kt.append(vi); u.find(".vis-thirddiv").append(kt); di.append(u); u.before(pt); bt = u.find(".vis-windowfield"); l = u.find(".vis-cardviewcolumnfield"); gi = u.find(".vis-btnright"); nr = u.find(".vis-btnleft"); tr = u.find(".vis-btnup"); ir = u.find(".vis-btndown"); btnOk = u.find(".vis-btnOk"); btnCardViewCancle = u.find(".vis-btnCardViewCancle"); btnDelete = u.find(".vis-btnDelete"); y = u.find(".vis-cmbcolumn"); et = u.find(".vis-cvd-valcontainer"); b = u.find(".vis-cmboperator"); btnSave = u.find(".vis-btnsave"); ot = u.find(".vis-cv-rowtable"); dt = u.find(".vis-cmbcolor"); pt.css({ display: "none" }); of() }, ou = function (i) { var r = t('<div class="vis-cv-condctrl-inner">'), u = t("<div class='vis-divcvc-cmbcolor'><div style='width:100%'><lable>" + n.Msg.getMsg("BGColor") + "<\/lable><\/div> <div style='width:100%'> <input class='vis-cmbcolor' type='color' /><\/div><\/div>"), f = t("<div class='vis-divcvc-cmbcolumn'><div style='width:100%'><lable>" + n.Msg.getMsg("Column") + "<\/lable><\/div> <div><select class='vis-cmbcolumn'><\/select><\/div><\/div>"), e = t("<div class='vis-divcvc-cmboperator'><div style='width:100%'><lable>" + n.Msg.getMsg("Operator") + "<\/lable><\/div>  <div><select class='vis-cmboperator'><\/select> <\/div><\/div>"), o = t("<div class='vis-divcvc-queryvalue'><div style='width:100%'><lable>" + n.Msg.getMsg("QueryValue") + "<\/lable><\/div> <div class='vis-cvd-valcontainer' style='width:100%'><\/div><\/div>"), s = t("<div class='vis-divcvc-btnsave'><button class='vis-btnsave'><i class='vis vis-plus'><\/i><\/button><\/div>"); r.append(u); r.append(f); r.append(e); r.append(o); i.append(r); i.append(s) }, su = function (i) { o.children().remove(); var r = n.Application.contextUrl + "CardView/GetCardView"; if (t.ajax({ type: "GET", async: !1, url: r, dataType: "json", contentType: "application/json; charset=utf-8", data: { ad_Window_ID: br, vaf_tab_ID: kr }, success: function (t) { if (ft = JSON.parse(t), st = ft[0].lstCardViewData, hi = ft[0].lstRoleData, vt = ft[0].lstCardViewRoleData, oi = ft[0].lstCardViewConditonData, st != null && st.length > 0) for (var r = 0; r < st.length; r++)o.append("<Option VAF_UserContact_id=" + st[r].UserID + " cardviewid=" + st[r].CardViewID + " vaf_field_id=" + st[r].VAF_GroupField_ID + "> " + w2utils.encodeTags(st[r].CardViewName) + "<\/Option>"); else lt.trigger("click"), at.prop("disabled", !0), btnEdit.trigger("click"), btnDelete.prop("disabled", !0); o.find("[cardviewid='" + e + "']").attr("selected", "selected"); ht = e; try { i ? (ht = o.find(":selected").attr("cardviewid"), tt = o.find(":selected").attr("vaf_field_id"), c = parseInt(o.find(":selected").attr("VAF_UserContact_id")), e = ht) : (c = parseInt(o.find(":selected").attr("VAF_UserContact_id")), v = c, cr = c) } catch (u) { } n.MRole.isAdministrator && vr(rt); v > 0 && rt.attr("disabled", "disabled") }, error: function (n) { alert(n.statusText) } }), o != null) o.on("change", function () { ki = !1; hu() }) }, hu = function () { var n = o.find(":selected"); n.length > 0 && (e = parseInt(n.attr("cardviewid")), c = parseInt(n.attr("VAF_UserContact_id"))); au(); cu(); e > 0 ? gt(!0, !1) : gt(!1, !1); ar(); vr(rt) }, cu = function () { sr.val(bu); hr.val(wu); sr.prop("disabled", "disabled"); hr.prop("disabled", "disabled") }, ar = function () { var u, f, i, r, e; if (it != null && it.children().remove(), u = null, f = null, h != null && h.getFields().length > 0) for (it.append("<Option FieldID=-1><\/Option>"), s = h.getFields(), i = 0; i < s.length; i++)(r = s[i].getColumnName().toLower(), r != "created" && r != "createdby" && r != "updated" && r != "updatedby") && (n.DisplayType.IsLookup(s[i].getDisplayType()) && s[i].getLookup() && s[i].getLookup().getIsValidated() || s[i].getDisplayType() == n.DisplayType.YesNo) && it.append("<Option FieldID=" + s[i].getVAF_Field_ID() + "> " + s[i].getHeader() + "<\/Option>"); if (tt != null && tt > 0 && (e = jQuery.grep(s, function (n) { return n.getVAF_Field_ID() == tt }), it.find("[FieldID='" + tt + "']").attr("selected", "selected"), ru = it.find(":selected").attr("fieldid")), it != null) it.on("change", function () { tt = parseInt(t(this).find(":selected").attr("fieldid")) }) }, gt = function (t, i) { var r, u, f; if (ui != null && ui.children().remove(), tf = null, gt, ft = null, s = h.getFields(), hf(yi, t), h != null && h.getFields().length > 0) for (r = 0; r < s.length; r++)(u = s[r].getColumnName().toLower(), u != "created" && u != "createdby" && u != "updated" && u != "updatedby") && (n.DisplayType.IsLOB(s[r].getDisplayType()) || d.hasIncludedCols && !i && (f = jQuery.grep(ii, function (n) { return n == s[r].getVAF_Field_ID() }), f.length > 0) || ui.append("<li index=" + r + " FieldID=" + s[r].getVAF_Field_ID() + "> " + s[r].getHeader() + "<\/li>")) }, of = function () { if (lt != null) lt.on("click", function (n) { n.stopPropagation(); fi = !1; wi.css({ display: "block" }); g.css({ display: "block" }); bi.css({ display: "none" }); o.css({ display: "none" }); lt.css({ display: "none" }); at.css({ display: "block" }); btnEdit.css({ display: "none" }); u.find(".vis-cardviewchild"); w = !0; ut = []; sf(); it.find("[FieldID='-1']").attr("selected", "selected"); gt(!1, !0); yi.children().remove(); rt.find("input[type=checkbox]").attr("disabled", !1); eu = f; f = []; ni(f) }); if (at != null) at.on("click", function (n) { n.stopPropagation(); fi = !1; bi.css({ display: "block" }); o.css({ display: "block" }); wi.css({ display: "none" }); g.css({ display: "none" }); lt.css({ display: "block" }); at.css({ display: "none" }); g.val(""); btnEdit.css({ display: "block" }); u.find(".vis-cardviewchild"); w = !1; gt(!0, !1); ar(); vr(rt); ni(eu) }); if (btnEdit != null) btnEdit.on("click", function (n) { n.stopPropagation(); fi = !0; wi.css({ display: "block" }); g.css({ display: "block" }); bi.css({ display: "none" }); o.css({ display: "none" }); lt.css({ display: "none" }); at.css({ display: "block" }); btnEdit.css({ display: "none" }); u.find(".vis-cardviewchild"); g.val(o.find(":selected").text().trim()) }); if (pi != null) pi.on("change", function () { }); if (bt != null) bt.on("click", "li", function () { ur != null && ur.removeClass("vis-cv-liselected"); t(this).addClass("vis-cv-liselected"); ur = t(this); dr = t(this).index(); li = t(this).attr("FieldID"); ri = t(this).text() }); if (l != null) l.on("click", "li", function () { ci != null && ci.removeClass("vis-cv-liselected"); t(this).addClass("vis-cv-liselected"); ci = t(this); a = t(this).index(); ti = t(this).attr("FieldID"); du = t(this).attr("cardviewcolumnid"); ri = t(this).text(); gu = t(this).attr("seqno") }); if (gi != null) gi.on("click", function (n) { parseInt(li) <= 0 || (l.append("<li seqno=0 index=" + nf + "  FieldID=" + li + "> " + ri + "<\/li>"), li = 0, bt.children().eq(dr).remove(), n.stopPropagation(), n.preventDefault()) }); if (nr != null) nr.on("click", function (n) { if (!(parseInt(ti) <= 0)) { l.children().eq(a).remove(); var t = bt.children().length + 1; bt.append("<li seqno=0 index=" + t + "  FieldID=" + ti + "> " + ri + "<\/li>"); ti = 0; a = -1; n.stopPropagation(); n.preventDefault() } }); if (tr != null) tr.on("click", function (n) { if (parseInt(a) != 0 && parseInt(a) != -1) { var t = parseInt(a) - 1, i = l.children().eq(a), r = l.children().eq(t); l.children().eq(a).remove(); l.children().eq(t).before(i); a = t; n.stopPropagation(); n.preventDefault() } }); if (ir != null) ir.on("click", function (n) { var i = l.children().length - 1; if (i != a && parseInt(a) != -1) { var t = parseInt(a) + 1, r = l.children().eq(a), u = l.children().eq(t); l.children().eq(a).remove(); u.after(r); a = t; n.stopPropagation(); n.preventDefault() } }); if (rt != null) rt.on("click", "li", function () { var i = t(this).attr("VAF_Role_id"), n; if (t(this).find("input").is(":checked")) t(this).find("input").prop("checked", !0), ut.push({ VAF_Role_ID: parseInt(i) }); else for (t(this).find("input").prop("checked", !1), n = 0; n < ut.length; n++)ut[n].VAF_Role_ID == i && ut.splice(n, 1) }); if (btnOk != null) btnOk.on("click", function (t) { si(!0); window.setTimeout(function () { var u = "", o = "", s, r; for (ei = [], s = "", i = 0; i < f.length; i++) { for (u = "", o = "", j = 0; j < f[i].Condition.length; j++)j == 0 ? (u += "@" + f[i].Condition[j].ColName + "@" + f[i].Condition[j].Operator + f[i].Condition[j].QueryValue, o += "@" + f[i].Condition[j].ColHeader + "@" + f[i].Condition[j].Operator + f[i].Condition[j].QueryText) : (u += " & @" + f[i].Condition[j].ColName + "@" + f[i].Condition[j].Operator + f[i].Condition[j].QueryValue, o += " & @" + f[i].Condition[j].ColHeader + "@" + f[i].Condition[j].Operator + f[i].Condition[j].QueryText); ei.push({ Color: f[i].Color.toString(), ConditionValue: u, ConditionText: o }) } if (w) { if (g.val() == "") return n.ADialog.error("FillMandatory", !0, "Name"), si(!1), !1 } else if (!w && e < 1 && n.MRole.isAdministrator) return n.ADialog.error("ClickNew", !0, ""), si(!1), !1; if (r = {}, r.FieldGroupID = tt, r.IncludedCols = lu(p), !r.IncludedCols) return !1; r.Conditions = ei; r.VAF_CardView_ID = e; w && parseInt(v) < 0 && (r.FieldGroupID = ru, r.IncludedCols = iu, r.Conditions = ei, r.VAF_CardView_ID = ht); d.setCardViewData(r); wt.isCardRow && d.refreshUI(wt.getVCardPanel().width()); k.close(); t.stopPropagation(); t.preventDefault() }, 50) }); if (btnCardViewCancle != null) btnCardViewCancle.on("click", function () { k.close() }); if (btnDelete != null) btnDelete.on("click", function (t) { var i = confirm(n.Msg.getMsg("SureWantToDelete")); i && (ki = !1, cf(), su(!0), cu(), ar(), gt(!0, !1), c == n.context.getVAF_UserContact_ID() && (v = 0, c = 0)); t.stopPropagation(); t.preventDefault() }); if (y != null) y.on("change", function (t) { var i, r, f, e, u; t.stopPropagation(); i = y.val(); pr(!0); i && i != "-1" && (r = null, f = null, r = i.endsWith("_ID") || i.endsWith("_Acct") || i.endsWith("_ID_1") || i.endsWith("_ID_2") || i.endsWith("_ID_3") ? lr.getOperatorsQuery(n.Query.prototype.CVOPERATORS_ID) : i.startsWith("Is") ? lr.getOperatorsQuery(n.Query.prototype.OPERATORS_YN) : lr.getOperatorsQuery(n.Query.prototype.CVOPERATORS), e = h.getField(i), b.html(r), b[0].SelectedIndex = 0, u = yr(i), wr(!0, u), b.prop("disabled", !1)); pu(!0) }); if (b != null) b.on("change", function () { var t = b.val(), i, r; t || (t = ""); i = ""; r = ""; t && t != "0" ? n.Query.prototype.BETWEEN.equals(t) && (i = y.val(), r = yr(i), wr(!1, r)) : (pf(btnSave, !1), pr(!0)) }); if (btnSave != null) btnSave.on("click", function () { var n, i, r; y.find(":selected").val() != -1 && (n = {}, nt = {}, i = "", i = Modernizr.inputtypes.color ? dt.val() : dt.spectrum("get"), r = t.map(f, function (n, t) { if (n.Color == i) return t }), r.length <= 0 ? (nt.Color = i.toString(), nt.Condition = [], n.ColHeader = y.find(":selected").text(), n.ColName = y.find(":selected").val(), n.Operator = b.val(), n.OperatorText = b.find(":selected").text(), n.QueryValue = vu(!0), n.QueryText = yu(!0), nt.Condition.push(n), f.push(nt)) : (n.ColHeader = y.find(":selected").text(), n.ColName = y.find(":selected").val(), n.Operator = b.val(), n.OperatorText = b.find(":selected").text(), n.QueryValue = vu(!0), n.QueryText = yu(!0), f[r[0]].Condition.push(n)), ni(f), y.find("[value='-1']").attr("selected", "selected"), b[0].SelectedIndex = -1, vf(!0), yf(!0)) }); if (ot != null) ot.on("click", "tr td i", function () { var r = t(this).parent().parent().index(), u = t(this).parent().parent().children().eq(0).attr("value"), e = t(this).parent().parent().children().eq(1).attr("value"), n; for (ot.find("tr").eq(r).remove(), n = t.map(f, function (n, t) { if (n.Color == u) return t }), i = 0; i < f[n].Condition.length; i++)if (e == f[n].Condition[i].ColName && f[n].Condition.splice(i, 1), f[n].Condition.length <= 0) { f.splice(n, 1); break } }); if (ot != null) ot.on("click", "tr td", function () { var n = t(this).attr("value"); typeof n != "undefined" && n.startsWith("#") && (Modernizr.inputtypes.color ? dt.val(n) : dt.spectrum("set", n)) }) }, kf = function (n, t) { n != null && n.children().remove(); for (var i = 0; i < p.length; i++)n.append("<li seqno=" + p[i].SeqNo + " index=" + i + " FieldID=" + p[i].VAF_Field_ID + "> " + p[i].FieldName + "<\/li>"); t > 0 && (ci = n.find("[fieldid='" + t + "']"), n.find("[fieldid='" + t + "']").addClass("vis-cv-liselected")) }, df = function (n, t) { var i, r; for (n != null && n.children().remove(), i = 0; i < t.length; i++)(r = jQuery.grep(p, function (n) { return n.VAF_Field_ID == t[i].getVAF_Field_ID() }), r.length > 0) || n.append("<li index=" + i + " FieldID=" + t[i].getVAF_Field_ID() + "> " + t[i].getHeader() + "<\/li>") }, hf = function (i, r) { var h, s, u, o; if (i != null && i.children().remove(), p = [], ku = [], ii = [], r && (e > 0 || typeof e == "undefined")) typeof e == "undefined" && (e = 0), h = n.Application.contextUrl + "CardView/GetCardViewColumns", t.ajax({ type: "GET", async: !1, url: h, dataType: "json", contentType: "application/json; charset=utf-8", data: { VAF_CardView_ID: e }, success: function (n) { var t, r, u; if (ft = JSON.parse(n), t = ft[0].lstCardViewData, oi = ft[0].lstCardViewConditonData, t != null && t.length > 0) for (tt = t[0].VAF_GroupField_ID, c = t[0].UserID, r = 0; r < t.length; r++)t[r].VAF_Field_ID != 0 && (u = jQuery.grep(rr, function (n) { return n.getVAF_Field_ID() == t[r].VAF_Field_ID }), u.length > 0 && ii.push(u[0].getVAF_Field_ID()), i.append("<li seqno=0 index=" + r + " CardViewColumnID=0 FieldID=" + t[r].VAF_Field_ID + "> " + t[r].FieldName + "<\/li>")); oi != null && oi.length > 0 ? (f = [], wf(oi)) : (f = [], ni(f)) }, error: function (n) { alert(n.statusText) } }); else if (d.hasIncludedCols && (s = null, ii = [], u = d.fields, u != null && u.length > 0)) for (o = 0; o < u.length; o++)s = jQuery.grep(rr, function (n) { return n.getVAF_Field_ID() == u[o].getVAF_Field_ID() }), s.length > 0 && ii.push(s[0].getVAF_Field_ID()), p.push({ VAF_Field_ID: u[o].getVAF_Field_ID(), CardViewID: e, SeqNo: 0, FieldName: u[o].getHeader() }), i.append("<li seqno=0 index=" + o + " CardViewColumnID=0 FieldID=" + u[o].getVAF_Field_ID() + "> " + u[o].getHeader() + "<\/li>") }, lu = function () { var f, u, r, i, s; if (n.MRole.isAdministrator) if (w) if (ct = g.val(), ut == null || ut.length <= 0) if (v != n.context.getVAF_UserContact_ID()) { if (!confirm(n.Msg.getMsg("CardViewWarning"))) return v = 0, !1; v = n.context.getVAF_UserContact_ID() } else v = 0; else v = 0; else ct = g.val(), v == c || (v = 0); else (!c || c < 1) && (w = !0, v = n.context.getVAF_UserContact_ID()), w && (ht > 0 && cr > 0 ? (w = !1, e = ht, c = cr, ct = o.find(":selected").text() + " (" + uu + ")") : ct = o.find(":selected").text() + " " + uu); for (ct.length < 1 && !fi ? ct = o.find(":selected").text() : fi && (ct = g.val()), f = l.children().length, p = [], u = [], r = 0; r < f; r++)i = {}, i.VAF_Field_ID = l.children().eq(r).attr("fieldid"), i.CardViewID = e, p.push(i), u.push(parseInt(i.VAF_Field_ID)); return gr.push({ VAF_Screen_ID: br, VAF_Tab_ID: kr, UserID: v, VAF_GroupField_ID: tt, isNewRecord: w, CardViewName: ct, CardViewID: e }), s = n.Application.contextUrl + "CardView/SaveCardViewColumns", t.ajax({ type: "POST", async: !1, url: s, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ lstCardView: gr, lstCardViewColumns: p, LstRoleID: ut, lstCardViewCondition: ei }), success: function (n) { var t = JSON.parse(n); e = t; si(!1) }, error: function (n) { alert(n.statusText); si(!1) } }), u }, cf = function () { var i = n.Application.contextUrl + "CardView/DeleteCardViewRecord"; t.ajax({ type: "POST", async: !1, url: i, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ VAF_CardView_ID: e }), success: function (n) { var t = JSON.parse(n) }, error: function (n) { alert(n.statusText) } }) }, gf = function (n) { n != null && n.children().remove(); n.append("<Option VAF_UserContact_id=-1 ><\/Option>"); for (var t = 0; t < userInfo.length; t++)n.append("<Option VAF_UserContact_id=" + userInfo[t].VAF_UserContact_ID + " > " + userInfo[t].UserName + "<\/Option>"); c > 0 && pi.find("[VAF_UserContact_id='" + c + "']").attr("selected", "selected") }, vr = function (n) { var r, t, i; for (ut = [], r = "", c > 0 && (r = "disabled"), n != null && n.children().remove(), t = 0; t < hi.length; t++)n.append("<li VAF_Role_id=" + hi[t].VAF_Role_ID + " > <input type='checkbox' " + r + "> " + w2utils.encodeTags(hi[t].RoleName) + "<\/li>"); for (t = 0; t < vt.length; t++)if (vt[t] != null) for (i = 0; i < vt[t].length; i++)vt[t][i].VAF_CardView_ID == e && (n.find("[VAF_Role_id='" + vt[t][i].VAF_Role_ID + "']").find("input").prop("checked", !0), ut.push({ VAF_Role_ID: vt[t][i].VAF_Role_ID })) }, au = function () { c > 0 ? k != null && k.changeTitle(n.Msg.getMsg("Card") + "(" + n.Msg.getMsg("IsPrivate") + ")") : k != null && k.changeTitle(n.Msg.getMsg("Card")) }, lf = function (i) { var r = t("<Table class='vis-cv-headertable'><tr class='vis-cv-TableHead'><th >" + n.Msg.getMsg("BGColor") + "<\/th><th>" + n.Msg.getMsg("Column") + "<\/th><th>" + n.Msg.getMsg("Operator") + "<\/th><th>" + n.Msg.getMsg("QueryValue") + "<\/th><th>" + n.Msg.getMsg("Action") + "<\/th><tr><\/Table>"), u = t("<div class='vis-cv-divrowtable'><Table class='vis-cv-rowtable'><\/Table><\/div>"); i.append(r); i.append(u) }, ni = function (n) { var i, r; if (ot != null && ot.children().remove(), n != null) { var f = null, e = u.find(".vis-cv-TableHead").children().eq(0).innerWidth(), o = u.find(".vis-cv-TableHead").children().eq(1).innerWidth(), s = u.find(".vis-cv-TableHead").children().eq(2).innerWidth(), h = u.find(".vis-cv-TableHead").children().eq(3).innerWidth(), c = u.find(".vis-cv-TableHead").children().eq(4).innerWidth(); for (i = 0; i < n.length; i++)for (r = 0; r < n[i].Condition.length; r++)f = t("<tr class='vis-cv-TableRow'><\/tr"), f.append("<td value=" + n[i].Color + " style='width:" + e + "px'><div class='vis-cvd-bgcolor' style='background-color:" + n[i].Color + ";cursor:pointer'>" + n[i].Color + "<\/div><\/td>"), f.append("<td style='width:" + o + "px' value=" + n[i].Condition[r].ColName + ">" + n[i].Condition[r].ColHeader + "<\/td>"), f.append("<td style='width:" + s + "px' value=" + n[i].Condition[r].Operator + ">" + n[i].Condition[r].OperatorText + "<\/td>"), f.append("<td style='width:" + h + "px' value=" + n[i].Condition[r].QueryValue + ">" + n[i].Condition[r].QueryText + "<\/td>"), f.append("<td style='width:" + c + "px'><i class='vis vis-delete'><\/i><\/td>"), ot.append(f) } }, af = function () { for (var f = '<option value="-1"> <\/option>', t, u, i, r = 0; r < fu.length; r++)if (t = fu[r], !t.getIsEncrypted()) { if (u = t.getColumnName(), t.getDisplayType() == n.DisplayType.Button) { if (t.getVAF_Control_Ref_Value_ID() == 0) continue; u.endsWith("_ID") ? t.setDisplayType(n.DisplayType.Table) : t.setDisplayType(n.DisplayType.List) } (i = t.getHeader(), i != null && i.length != 0 || (i = n.Msg.getElement(n.context, u), i != null && i.Length != 0)) && (t.getIsKey() && (i += " (ID)"), f += '<option value="' + u + '">' + i + "<\/option>") } y.html(f) }, ne = function () { var n = y.val(), t; pr(!0); n && n != "-1" && (t = yr(n), wr(!0, t)); pu(!0) }; uf(); this.getRoot = function () { return di }; this.show = function () { k = new n.ChildDialog; k.setTitle(n.Msg.getMsg("Card")); k.setContent(di); k.onOkClick = function () { if (w) { if (g.val().trim() == "") return n.ADialog.error("FillMandatory", !0, "Name"), !1 } else if (!w && e < 1 && (o.val() == "" || o.val() == null) && n.MRole.isAdministrator) return n.ADialog.error("ClickNew", !0, ""), !1; var t = {}; if (t.FieldGroupID = tt, t.IncludedCols = lu(p), !t.IncludedCols) return !1; t.Conditions = []; t.VAF_CardView_ID = e; n.MRole.isAdministrator && v < 1 && ht > 0 && (t.Conditions = [], t.VAF_CardView_ID = ht); d.setCardViewData(t); wt.isCardRow && d.refreshUI(wt.getVCardPanel().width()) }; k.show(); k.hideButtons(); au(); ni(f); Modernizr.inputtypes.color || dt.spectrum({ showButtons: !1, preferredFormat: "hex" }) } } r.prototype.getOperatorsQuery = function (t, i) { var f = "", r = "", u; for (u in t) r = t[u], i && (r = n.Msg.getMsg(r)), f += '<option value="' + u + '">' + r + "<\/option>"; return f }; n.CVDialog = r }(VIS, jQuery), function (n, t) { function i(i) { function st(i) { var e, o; u = t("<div style='overflow: hidden;'>"); s = t('<div class="vis-apanel-busy" style="width: 96%; height: 97%; text-align: center; position: absolute; visibility: hidden;"><\/div>'); l = t('<div style="display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;">'); a = t('<div style="padding-left: 7px;height:88.9%;display: inline-block; float: left;width:100%;height:87.8%;">'); w = t("<button class='vis-initial-btn vis-initial-btn-blue' style='border: none;'>" + n.Msg.getMsg("SelectFile") + "<\/button>"); b = t("<div class='VIS-form-data' style='width: 100%;height:200px;border: 1px solid #ccc;margin-top: 11px;padding: 10px;overflow:auto;'>"); v = t('<div style="display: inline-block; float: left;width:100%;height:auto;margin-top: 2px;">'); d = t("<div style='float: left;'>"); y = t('<div style="float:right;">'); e = n.Msg.getMsg("Cancel"); e.indexOf("&") > -1 && (e = e.replace("&", "")); o = n.Msg.getMsg("Ok"); o.indexOf("&") > -1 && (o = o.replace("&", "")); p = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(e); f = t("<button class='VIS_Pref_btn-2' disabled='true' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(o); h = i ? t("<input type='file' multiple='true'>") : t("<input type='file'>"); a.append(w); a.append(b); l.append(a); v.append(d); y.append(p); y.append(f); v.append(y); l.append(v); u.append(l); u.append(s); r = [] } function ht() { p.on("click", function () { g = !1; et() }); f.on("click", function () { ft() }); w.on("click", function () { h.val(""); h.trigger("click") }); h.on("change", function () { ut(this) }) } function ct() { g || (k = ""); ot.onClose(k); et() } this.onClose = null; var u, s, l, a, v, y, p, f, r, h, w, b, d, ot = this, g = !1, tt = 0, o = 0, k = Date.now().toString() + "_FileCtrl", e = 1048576, it = 0, c = 0, rt = []; st(i); ht(); this.show = function () { u.dialog({ width: 500, height: 377, resizable: !1, modal: !0, title: n.Msg.getMsg("Upload"), close: ct }) }; var ut = function (i) { for (var u = [], c, e, o, v, s = 0; s < i.files.length; s++) { if (file = i.files[s], file == undefined) return; if (file.name.indexOf("&") > -1 || file.name.indexOf("?") > -1 || file.name.indexOf("#") > -1 || file.name.indexOf("/") > -1 || file.name.indexOf("\\") > -1) { u.push(file.name); continue } for (c in r) if (file.name == r[c].name) { window.setTimeout(function () { n.ADialog.info("fileAlreadyAttached") }, 20); return } if (e = {}, e.Name = file.name, e.Size = file.size, !(e.Size > 17e6)) { r.push(file); var h = t("<div class='VIS-file-wrap'>"), y = t("<p>" + e.Name + "<\/p>"), l = r.length - 1, a = t("<span class='vis vis-mark VIS-close-ico mychoice_" + l + "'  data-index='" + l + "'>"); a.on("click", function () { var n = t(this).parent(), i, u; n && (i = n.children()[0], i && (u = r.map(function (n) { return n.name == t(i).text() }).indexOf(!0), r.splice(u, 1), n.remove())); r.length == 0 ? f.attr("disabled", "true") : f.removeAttr("disabled") }); h.append(y); h.append(a); b.append(h); r.length == 0 ? f.attr("disabled", "true") : f.removeAttr("disabled") } } if (u.length > 0) { o = ""; for (v in u) o += u[v].toString() + "\n"; o += u.length == 1 ? "File has" : "Files have"; o += " " + n.Msg.getMsg("VIS_InvalidName") + " " + n.Msg.getMsg("VIS_ChangeFileName"); n.ADialog.info(o) } }, ft = function () { var t, u; s[0].style.visibility = "visible"; var n = null, i = 0; for (t in r) i = parseInt(r[t].size / e), file.size % e > 0 && i++, it += i, n = {}, n.Name = r[t].name, n.Size = r[t].size, rt.push(n); u = nt() }, nt = function () { var t, i, f; if (r == null || r.length == 0) return n.ADialog.info("NothingToUpload"), s[0].style.visibility = "hidden", !1; if (o >= r.length) return s[0].style.visibility = "hidden", g = !0, u.dialog("close"), !0; t = new XMLHttpRequest; i = new FormData; i.append("file", r[o].slice(c * e, c * e + Number(e))); t.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + r[o].name + "&folderKey=" + k, !1); t.send(i); tt++; c++; f = parseInt(r[o].size / e); r[o].size % e > 0 && f++; c == f && (o++, c = 0); window.setTimeout(function () { nt() }, 2) }, et = function () { p.off("click"); f.off("click"); s = l = a = v = y = p = f = null; r = h = w = b = d = null; tt = o = k = e = it = c = rt = null; ut = ft = nt = loadTables = loadLanguage = loadEDL = loadExportScope = null; u != null && (u.dialog("destroy"), u.remove()); u = null } } n.VisImportFiles = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function i(i, r) { function a(n) { v.css("display", n ? "block" : "none") } function y(t) { if (t.error == null) { var i = JSON.parse(t.result); if (!i.IsError) if (i.ShowParameter) u.pInstanceId = i.VAF_JInstance_ID, u.fields = i.ProcessFields; else return i.ReportProcessInfo != null && (n.ADialog.info(i.ReportProcessInfo.Summary, !0, "", ""), n.Msg.getMsg("ImportedSuccessfully") == i.ReportProcessInfo.Summary) ? (p.parentcall(!0), u && (u.isOkProcess = !0), !0) : (u && (u.isOkProcess = !1), p.parentcall(!1), !1) } } function b() { f = t("<div title='ParameterDialog'>"); c = t("<table class='vis-processpara-table'>"); f.append(c); s = t('<input type="button" style="margin-right:5px" >').val(n.Msg.getMsg("OK")); s.addClass("VIS_Pref_btn-2"); o = t("<input type='button'>").val(n.Msg.getMsg("Close")); o.addClass("VIS_Pref_btn-2"); o.css({ "margin-bottom": "0px", "margin-top": "7px" }); s.css({ "margin-bottom": "0px", "margin-top": "7px" }) } function k(t, i) { if (t) { u.paraList = i; var r = new n.ProcessInfo(u.name, u.processId, 0, 0); r.setVAF_JInstance_ID(u.pInstanceId); n.dataContext.executeProcess({ processInfo: r.toJson(), parameterList: i }, function (n) { y(n) }) } } var p = r, f, c, w, h, l, e, s, o, v, u; this.windowNo = i; this.processId = null; this.name = null; this.entityType = null; this.pInstanceId = 0; this.className = null; this.fields = null; this.paraList = null; this.asyncProcess = !0; this.gridFields = []; this.depOnFieldColumn = []; this.depOnField = []; this.vEditors = []; this.vEditors2 = []; this.mFields = []; this.mFields2 = []; this.isOkClicked = !1; this.onClosed; v = t("<div class='vis-apanel-busy' style='width:95%;height:98%;position:absolute'>"); u = this; this.onCloseMain = null; this.isOkProcess = !1; this.process = function (t, i, r) { var f = new n.ProcessInfo(i, t, 0, 0), e, o; f.setVAF_JInstance_ID(u.pInstanceId); f.setWindowNo(r); e = { processInfo: f.toJson() }; this.asyncProcess ? n.dataContext.process(e, function (n) { y(n) }) : (o = n.dataContext.process(e), y(o)) }; b(); this.addLine = function () { w = h = l = e = null; h = t("<td class=''>"); l = t("<td class=''>"); e = t("<td class='vis-processpara-table-td3'>"); c.append(t("<tr>").append(h).append(l).append(e)) }; this.addFields = function (t, i) { if (t && h.append(t.getControl()), i && (i.getControl().width("200px"), i.getControl().height("30px"), e.append(i.getControl()), i.getBtnCount() > 0)) { var r = i.getBtn(0); e.append(r); i.getDisplayType() == n.DisplayType.MultiKey && e.append(i.getBtn(1)) } }; this.addButtons = function () { this.addLine(); e.append(o).append(s) }; this.showDialog = function () { f.append(v); f.dialog({ modal: !0, width: "auto", close: function () { if (k(u.isOkClicked, u.parameterList), u.onCloseMain) u.onCloseMain(u.isOkClicked); u.dispose(); u = null; a(!1) } }); window.setTimeout(function () { o.focus() }, 200); a(!1) }; this.onClose = function (n) { u.isOkClicked = n; f.dialog("close") }; o.on(n.Events.onTouchStartOrClick, function () { u.onClose(!1) }); s.on(n.Events.onTouchStartOrClick, function () { a(!0); var n = u.saveParameters(); if (!n) { a(!1); return } u.parameterList = n; u.onClose(!0, n) }); this.disposeComponent = function () { o.off(n.Events.onTouchStartOrClick); s.off(n.Events.onTouchStartOrClick); f.dialog("destroy"); f.remove(); u = null; this.gridFields.length = 0; this.gridFields = null; this.depOnFieldColumn.length = 0; this.depOnFieldColumn - null; this.depOnField.length = 0; this.depOnField = null; this.vEditors.length = 0; this.vEditors2.length = 0; this.mFields.length = 0; this.mFields2.length = 0; this.parameterList = null; this.addLine = null; this.addFields = null; this.addButtons = null; this.showDialog = null; this.onClose = null; this.isOkClicked = null; f = c = w = h = l = e = s = o = null } } i.prototype.initDialog = function (i, r, u, f, e) { var a, o, c, b, p, v, k, s, w, y, h, l; for (this.processId = i, this.name = r, this.entityType = u, this.className = f, typeof e != "undefined" && (this.asyncProcess = e), this.process(i, r, this.windowNo), a = this.fields, o = null, c = 0, b = a.length; c < b; c++) { for (o = new n.GridField(a[c]), this.addLine(), this.mFields.push(o), p = o.getDependentOn(!1), v = 0; v < p.length; v++)this.depOnField.push(o), this.depOnFieldColumn.push(p[v]); k = n.VControlFactory.getLabel(o); s = n.VControlFactory.getControl(null, o, !1); s && (l = o.getDefault(n.context, this.windowNo), s.setValue(l), s.addVetoableChangeListener(this)); o.setPropertyChangeListener(s); this.vEditors.push(s); this.addFields(k, s); o.getIsRange() ? (this.addLine(), w = {}, t.extend(!0, w, a[c]), y = new n.GridField(w), this.mFields2.push(y), h = n.VControlFactory.getControl(null, y, !1), h && (l = y.getDefault(n.context, this.windowNo), h.setValue(l), h.addVetoableChangeListener(this)), this.vEditors2.push(h), this.addFields(null, h)) : (this.mFields2.push(null), this.vEditors2.push(null)) } return this.addButtons(), !0 }; i.prototype.vetoablechange = function (t) { var f, r, e, u, o, i; if (console.log(t), f = t.newValue == null ? "" : t.newValue.toString(), r = t.propertyName, n.Env.getCtx().setWindowContext(this.windowNo, r, f), this.depOnFieldColumn.indexOf(r) !== -1) for (e = this.getDependantFields(r), u = 0, o = e.length; u < o; u++)(i = field, i != null) && (i.refreshLookup(), i.setValue(i.getDefault(Env.getCtx(), this.windowNo), !0)) }; i.prototype.getDependantFields = function (n) { var i = [], r, t; if (this.depOnFieldColumn.indexOf(n) != -1) for (r = this.depOnFieldColumn.length, t = 0; t < r; t++)this.depOnFieldColumn[t].equals(n) && i.indexOf(this.depOnField[t]) < 0 && i.push(this.depOnField[t]); return i }; i.prototype.saveParameters = function () { for (var r = new StringBuilder, v = this.mFields.length, t = 0, u, e, o, y, s, h, c, i, a, t = 0; t < v; t++)u = this.mFields[t], u.getIsMandatory(!0) && (e = this.vEditors[t], o = e.getValue(), o == null || o.toString().length == 0 ? (u.setInserting(!0), u.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : u.setError(!1), y = this.vEditors2[t], y != null && (s = e.getValue(), h = this.mFields2[t], s == null || s.toString().length == 0 ? (u.setInserting(!0), h.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : h.setError(!1))); if (r.length() != 0) return n.ADialog.error("FillMandatory", !0, r.toString()), !1; for (c = [], i = {}, t = 0; t < v; t++) { var p = this.vEditors[t], f = this.vEditors2[t], w = p.getValue(), l = null; (f != null && (l = f.getValue()), w != null || l != null) && (i = {}, a = this.mFields[t], i.Name = a.getColumnName(), i.DisplayType = a.getDisplayType(), i.Result = w, i.Result2 = l, i.Info = p.getDisplay(), f != null && (i.Info_To = f.getDisplay()), c.push(i)) } return c }; i.prototype.dispose = function () { this.disposeComponent() }; n.ParameterDialog = i }(VIS, jQuery), function (n, t) { function f(n, i, u) { var f = null; return t.ajax({ url: r, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; u && u(n) }), f } function e(t, i) { function f() { var o, e, i, f; try { if (o = "VIS_100", e = [], e[0] = new n.DB.SqlParam("@processName", t), i = u(o, e), i != null && i.getTables()[0].getRows().length > 0) { var s = i.tables[0].getRow(0).getCell(0), h = i.tables[0].getRow(0).getCell(1), c = i.tables[0].getRow(0).getCell(2), l = i.tables[0].getRow(0).getCell(3); s > 0 ? (f = new n.ParameterDialog(r.parent.windowNo, r), f.initDialog(s, h, l, c, !1), f.onCloseMain = function (t) { t ? n.ADialog.info("ProcessWait", !0, "", "") : n.ADialog.info("Process Canceled", !0, "", "") }, f.showDialog(), f = null) : n.ADialog.info("ProcessNotFound", !0, "", "") } } catch (a) { } } this.parent = i; var r = this; f(); this.lockUI = function (n) { r.lockUI && r.lockUI(n) }; this.unlockUI = function (n) { r.unlockUI && r.unlockUI(n) }; this.parentcall = function (n) { r.parentcall && r.parentcall(n) } } var i = n.Application.contextUrl, r = i + "JsonData/JDataSetWithCode", u = function (t, i, r) { var o = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, f(e, o, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }; n.ProcessWrapper = e }(VIS, jQuery), function (n, t) { function i() { function go(n, i, r) { var u = null; return t.ajax({ url: vh, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function es() { t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/TreeDataForCombo", success: function (i) { var u = JSON.parse(i), r; if (u) for (w.append(t("<Option value=''> <\/option>")), r = 0; r < u.length; r++)w.append(t("<Option value=" + u[r].ID + " data-type='" + u[r].TreeType + "' data-isallnodes='" + u[r].IsAllNodes + "'  >" + n.Utility.encodeText(u[r].Name) + "<\/option>")); ei != null && w.val(ei.attr("value")); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "visible" } }) } function os() { nr.css("display", "none"); e = 0; u.empty(); i.empty(); ht.empty(); at = ""; gt.val(""); ei = null; d.addClass("vis-tm-delete"); o.val(""); window.setTimeout(function () { u.empty(); b.data("kendoTreeView").destroy(); b.empty() }, 200); du.text(n.Msg.getMsg("SelectTree")); ti.text(n.Msg.getMsg("SelectTree")); ii.css("display", "none"); dt.addClass("vis-tm-delete"); y.prop("disabled", !0); vi.prop("disabled", !0); y.css("cursor", "not-allowed"); vi.css("cursor", "not-allowed"); o.prop("disabled", !0); gt.prop("disabled", !0); nt.prop("disabled", !0); ft.prop("disabled", !0); ft.css("cursor", "not-allowed"); lr.css("display", "none"); bi.css("display", "none"); vi.prop("checked", !1); ft.prop("checked", !1); y.prop("checked", !1); g.prop("checked", !1) } function ou() { var u = "SELECT vaf_tableview_id FROM VAF_TreeInfo WHERE VAF_TreeInfo_id=" + e, i, r, f, s, o; if (u = k(u, null, null), u.tables[0].rows.length > 0 && (u = u.tables[0].rows[0].cells.vaf_tableview_id), i = "SELECT tablename FROM vaf_tableview WHERE vaf_tableview_id=" + u, i = k(i, null, null), i.tables[0].rows.length > 0 && (i = i.tables[0].rows[0].cells.tablename), kr(), r = "SELECT Count(*) as Count FROM " + i + " WHERE IsActive='Y' AND " + i + "_ID  IN (SELECT Node_ID FROM " + di + " where VAF_TreeInfo_ID=" + e + ")", r = n.MRole.addAccessSQL(r, i, !0, !1), r = k(r, null, null), r = r.tables[0].rows[0].cells.count, er = r > 0 ? !0 : !1, ni == "false" && r == hi.length && (f = "SELECT node_id  FROM " + di + " WHERE isactive ='Y' AND VAF_TreeInfo_ID=" + e, f = k(f, null, null), f != null)) for (s = null, o = 0; o < f.tables[0].rows.length; o++)if (s = f.tables[0].rows[o].cells.node_id, t.inArray(s, hi) < 0) { er = !0; break } else er = !1 } function nf(i, r, u, f) { oi[0].style.visibility = "visible"; it.is(":checked") || (fa(), f = it.is(":checked") ? !0 : !1); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/BindTree", type: "Post", data: { treeType: i, VAF_TreeInfo_ID: r, isAllNodes: u, isSummary: f }, success: function (n) { var t = JSON.parse(n); t && (nc(t), window.setTimeout(function () { window.setTimeout(function () { w.val() == "" ? os() : w.val() == null && os(); ou() }, 400) }, 500), po = t, vo = t.settree); oi[0].style.visibility = "hidden" }, error: function (n) { console.log(n); oi[0].style.visibility = "hidden" } }) } function gh() { wr.css("display", "none"); fi = !1; tt.css("display", "none"); c.css("height", "100%"); kt.css("height", "100%"); c.resizable("destroy"); kt.removeClass("VIS-TM-resizediv"); ei != null && nf(bt, e, vr, fi) } function nc(u) { oi[0].style.visibility = "visible"; nr.css("display", "inherit"); b && b.data("kendoTreeView") != undefined && (b.data("kendoTreeView").destroy(), b.empty()); b = r.kendoTreeView({ autoScroll: !0, dragAndDrop: !0, drag: tc, drop: ic, dataSource: u.settree, select: function (n) { st[0].style.visibility = "visible"; it.is(":checked") && cr.css("display", "inherit"); sr == !0; i.empty(); g.prop("checked", !1); r.find(".k-state-selected").removeClass("k-state-selected"); t(n.node).find(".k-state-hover").addClass("k-state-selected").removeClass("k-state-hover"); var u = t(t(t(n.node).find(".treechild")[0]).find("p")).text(); ti.text(u); pr = t(t(n.node).find(".treechild")[0]).attr("data-nodeid"); fr = !0; hf = -1; d.addClass("vis-tm-delete"); ii.css("display", "none"); wf = !1; r.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode"); r.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode"); window.setTimeout(function () { r.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode"); r.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode"); ut = 1; et = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; window.setTimeout(function () { pr = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); it.is(":checked") && (r.find(".k-state-hover").removeClass("k-state-hover"), ki(pr, e, ut, et, v, h, n)) }, 300) }, 300) }, template: "<div class='treechild'  data-getparentnode='#= item.getparentnode #'       data-IsSummary='#= item.IsSummary #' data-TableName='#= item.TableName #' data-NodeID='#= item.NodeID #'   data-TreeParentID='#= item.TreeParentID #' data-ParentID='#= item.ParentID #'  ><div class='imgdivTree'><i class='fa fa-folder-o' data-imgsrc='#= item.ImageSource #'><\/i><\/div><div class='textdivTree'><p>" + n.Utility.encodeText("#= item.text #") + "<\/p><\/div><\/div>" }); nu(); b.find(".k-plus").on("click", function () { t(this).hasClass("k-minus") && (ct.css("display", "inherit"), yt.css("display", "none")); t(this).hasClass("k-plus") && (yt.css("display", "inherit"), ct.css("display", "none")) }); b.find(".k-in").on("dblclick", function () { t(r.find(".k-state-selected").parent().find("span")[0]).hasClass("k-minus") && (ct.css("display", "inherit"), yt.css("display", "none")); t(r.find(".k-state-selected").parent().find("span")[0]).hasClass("k-plus") && (yt.css("display", "inherit"), ct.css("display", "none")) }); window.setTimeout(function () { nr.css("display", "none") }, 200); iu == !0 && (b.data("kendoTreeView").expand(".k-item"), r.find("div").find("div[data-nodeid='" + so + "']").parent().addClass("k-state-selected"), r.find("span").hasClass("k-state-selected") && r.find("div").find("div[data-nodeid='" + so + "']").parent().addClass("k-state-selected")[0].scrollIntoView()); o.val() != "" && ur(rr); lu(); window.setTimeout(function () { o.val() != "" && ur(se) }, 200); hc() } function tc(n) { rr = n; tt.addClass("vis-tm-bottomdivdisable"); ro.css("display", "inherit"); si.css("display", "inherit"); au = t(n.sourceNode).find(".treechild").attr("data-nodeid"); wo = t(n.sourceNode).find(".treechild").parent().parent().parent(); ss = t(n.sourceNode); or = this.dragging._draggable.hint.find(".k-denied"); t(r.find("ul")[0]).css("width", "95%"); s.addClass("VIS-TM-ondragdrop"); au != 0 && (ot.css("display", "inherit"), s.css("display", "inherit")); t(n.sourceNode).find(".treechild").attr("data-nodeid") == 0 && n.setStatusClass("k-denied"); t(n.dropTarget).parent().parent().attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).parent().parent().parent().parent().parent().find(".treechild").attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("k-top") && t(n.dropTarget).find(".treechild").attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("k-item") && n.setStatusClass("k-denied"); this.dragging._draggable.hint.find(".k-add").length == 1 && t(n.dropTarget).parent().attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).parent().find(".textdivTree").length == 1 && this.dragging._draggable.hint.find(".k-add").length == 1 && n.setStatusClass("k-denied"); (t(n.dropTarget).attr("aria-expanded") == "true" || t(n.dropTarget).attr("aria-expanded") == "false") && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("selectchangecolor") ? (or.css("display", "none"), or.parent().prepend(hs), or.parent().find(".vis-tm-unlinkimgss").css("display", "inherit")) : (or.css("display", "inherit"), or.parent().find(".vis-tm-unlinkimgss").css("display", "none")); t(n.dropTarget).hasClass("glyphicon glyphicon-trash") && (or.css("display", "none"), or.parent().prepend(hs)); yo = this.dragging._draggable.hint.find("span").hasClass("k-insert-bottom"); yo && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("k-state-hover") && t(n.dropTarget).find(".treechild").attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("VIS-TM-root-node") && n.setStatusClass("k-denied") } function ic(n) { var u, l, h, i, c; if (tf = 0, tf = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"), rr = n, lt.css("overflow", "auto"), gu.css("overflow", "auto"), yf.css("overflow", "auto"), tt.removeClass("vis-tm-bottomdivdisable"), ro.css("display", "none"), si.css("display", "none"), n.sourceNode.previousSibling == n.destinationNode && n.dropPosition == "after") { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (n.sourceNode.nextSibling == n.destinationNode && n.dropPosition == "before") { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (n.dropPosition == "after") { if (t(n.dropTarget).parent().attr("data-nodeid") == 0) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).find(".treechild").attr("data-nodeid") == 0) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).hasClass("k-minus")) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } } if (n.dropPosition == "before") { if (t(n.dropTarget).find(".treechild").attr("data-nodeid") == 0) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).hasClass("k-minus")) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).parent().hasClass("imgdivTree")) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).hasClass("VIS-TM-tree-wrap")) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).parent().hasClass("k-bot") && t(t(t(n.dropTarget).parent()).parent()).parent().attr("role") != "group") { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).parent().hasClass("textdivTree") && t(n.dropTarget).parent().parent().attr("data-nodeid") == 0) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } } if (n.dropPosition == "over") { if (t(n.dropTarget).parent().attr("data-issummary") == "false") { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).find(".treechild").attr("data-nodeid") == 0) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } } if (s.hasClass("selectchangecolor") && t(t(this.dragging._draggable.hint)).animate({ left: "250px", opacity: "0.5", height: "2px", width: "2px" }, 1e3), s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), ot.css("display", "none"), !or.hasClass("k-denied") || s.hasClass("selectchangecolor")) { if (u = " SELECT treetype FROM VAF_TreeInfo WHERE VAF_TreeInfo_id=" + e, u = k(u, null, null), treeType = u.tables[0].rows[0].cells.treetype, gi = treeType == "PR" ? "VAF_TreeInfoChildProd" : treeType == "BP" ? "VAF_TreeInfoChildBPart" : treeType == "MM" ? "VAF_TreeInfoChildMenu" : "VAF_TreeInfoChild", l = b.find(".k-state-hover").find(".treechild").attr("data-nodeid"), h = b.find(".k-state-hover").find(".treechild").attr("data-issummary"), h == "true") { rc(e, au, l); i = t(n.destinationNode); f[0].style.visibility = "visible"; window.setTimeout(function () { f[0].style.visibility = "visible"; ls(i); o.val() != "" && ur(n); lu(); cs(); f[0].style.visibility = "hidden" }, 100); return } if (h = t(n.destinationNode).parent().parent().find(".treechild").attr("data-issummary"), n.sourceNode === n.destinationNode) { n.setValid(!1); f[0].style.visibility = "hidden"; return } if (cs(), tf > 0 && window.setTimeout(function () { r.find(".k-state-selected").removeClass("k-state-selected"); t(r.find("div").find("div[data-nodeid='" + tf + "']").parent()).addClass("k-state-selected"); lu() }, 200), t(n.destinationNode).parent().parent().parent().attr("role") == "tree") { i = t(n.destinationNode); f[0].style.visibility = "visible"; var v = n.dropPosition, y = n.sourceNode, p = t(t(n.sourceNode.parentElement).parent().find(".k-in")[0]).find(".treechild").attr("data-nodeid"); window.setTimeout(function () { var o, h, u, r; if (f[0].style.visibility = "visible", o = i.parent().children(), o.length > 0) { var n = 0, c = "SELECT seqno FROM " + gi + "  WHERE VAF_TreeInfo_ID=" + e + " AND node_id=" + i.find(".treechild").attr("data-nodeid"), s = k(c, null, null); s.tables[0].rows.length > 0 && (n = s.tables[0].rows[0].cells.seqno); v == "after" && (n = n + 1); h = "update " + gi + " set seqno=seqno+1,Updated=Sysdate,parent_ID=0 where seqno >=" + n + " AND (parent_id=0 or parent_id is null)  AND VAF_TreeInfo_ID=" + e; fu(h, null, null); u = t(y).find(".treechild").attr("data-nodeid"); p > 0 ? (r = "update " + gi + " set seqno=" + n + ",parent_id=0  where node_id=" + u + "   AND VAF_TreeInfo_ID=" + e, fu(r, null, null)) : (r = "update " + gi + " set seqno=" + n + " where node_id=" + u + " AND (parent_id=0 or parent_id is null) AND VAF_TreeInfo_ID=" + e, fu(r, null, null)) } f[0].style.visibility = "hidden" }, 600) } else { if (c = t(n.destinationNode), c.length == 0) { if (pu = t(n.sourceNode).find(".treechild").attr("data-nodeid"), af = t(n.sourceNode).find(".treechild").parent().parent().parent(), s.hasClass("selectchangecolor")) yl(); else { s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); f[0].style.visibility = "hidden"; return } return } var w = n.destinationNode.parentElement, a = n.sourceNode.parentElement, d = n.destinationNode, g = n.sourceNode; f[0].style.visibility = "visible"; window.setTimeout(function () { var s, u, i, n, o, r; if (f[0].style.visibility = "visible", s = t(t(g).find(".treechild").parent().parent().parent().parent().parent()).find("li").find(".k-state-hover").find("div").attr("data-nodeid"), u = c.parent().children(), w == a) { if (i = t(a.parentElement).find(".treechild").attr("data-nodeid"), i != 0) for (n = 0; n < u.length; n++)o = t(u[n]).find(".treechild").attr("data-nodeid"), r = "UPDATE ", r += gi + " SET Parent_ID=" + i + ", SeqNo=" + n + ", Updated=SysDate WHERE VAF_TreeInfo_ID=" + e + " AND Node_ID=" + o, fu(r, null, null) } else if (i = t(d.parentElement).parent().find(".treechild").attr("data-nodeid"), i != 0) for (n = 0; n < u.length; n++)o = t(u[n]).find(".treechild").attr("data-nodeid"), r = "UPDATE ", r += gi + " SET Parent_ID=" + i + ", SeqNo=" + n + ", Updated=SysDate WHERE VAF_TreeInfo_ID=" + e + " AND Node_ID=" + o, fu(r, null, null); f[0].style.visibility = "hidden" }, 600) } window.setTimeout(function () { o.val() != "" && ur(n) }, 300) } } function cs() { r.find(".k-state-selected").length > 1 && (r.find(".k-state-selected").removeClass("k-state-selected"), i.empty()) } function ls(n) { var u = n.parent(), i, f; u.attr("role") == "tree" ? (i = n.parent().children().children("ul").children()[n.parent().children().children("ul").children().length - 1], i && u && (i.remove(), t(t(u.children()[0]).children("ul")).prepend(i))) : (n.children("ul") && (i = n.children("ul").children()), i && (i = t(i[i.length - 1])), i && i.siblings().length > 0 && (f = t(i.siblings()[0]).parent(), r.data("kendoTreeView").detach(i[0]), f.prepend(i[0]))) } function rc(i, r, u) { f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/SaveTreeDragDrop", type: "Post", data: { treeID: i, NodeID: r, ParentID: u }, success: function (t) { var i = JSON.parse(t); i == n.Msg.getMsg("VIS_DataSave"); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function ki(r, u, e, s, h, l, a) { st[0].style.visibility = "visible"; h == null && (h = ""); nu(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/GetDataTreeNodeSelect", type: "Post", async: !1, data: { nodeID: r, treeID: u, pageNo: e, pageLength: s, searchChildNode: h, getTreeNodeChkValue: l }, success: function (r) { var u, s, c; if (sr != !1) { var e = JSON.parse(r), h = null; if (e.length > 0) { for (st[0].style.visibility = "visible", fr == !0 && i.empty(), ui = !0, u = 0; u < e.length; u++)if ((fr != !1 || !(i.find("li li").length > 0) || (s = i.find('[data-id="' + e[u].parentID + '"]'), !s || !(s.length > 0))) && e[u].parentID != 0) if (c = t('<input class="VIS-tm-checkbox" type="checkbox" />'), e[u].issummary == "Y") continue; else h = "<i class='vis vis-m-window summNonsumImage' data='Images/mWindow.png'><\/i>", i.append(t('<li class="VIS-tm-topMLi">').append(c).append(h).append(t("<li class='VIS-tm-MLi'    data-id='" + e[u].parentID + "' data-issummary='" + e[u].issummary + "' id='" + e[u].parentID + "'   >" + n.Utility.encodeText(e[u].name) + "<\/li>"))); ii.css("display", "none"); vs(); fo(); nu() } else i.find("li").length > 0 ? (ui = !0, ii.css("display", "none")) : (ui = !1, ii.css("display", "inherit")); ur(a); window.setTimeout(function () { i.find("input:checked").length > 0 ? d.removeClass("vis-tm-delete") : d.addClass("vis-tm-delete") }, 200); ir(); g.is(":checked") && (i.find("input").prop("checked", !0), i.find("input").parent().addClass("vis-tm-menuselectedcolor")); i.find("li").length > 0 ? (ui = !0, ii.css("display", "none")) : (ui = !1, ii.css("display", "inherit")); o.prop("disabled", !1); tr.prop("disabled", !1); o.focus(); df = !0; bf = !0; cr.css("display", "none"); f[0].style.visibility = "hidden"; ou(); st[0].style.visibility = "hidden" } }, error: function (n) { cr.css("display", "none"); ui = !1; console.log(n); i.empty(); o.prop("disabled", !1); tr.prop("disabled", !1); o.focus(); bf = !0; f[0].style.visibility = "hidden"; st[0].style.visibility = "hidden" } }); window.setTimeout(function () { i.find("li").length > 0 ? (ui = !0, ii.css("display", "none"), dt.removeClass("vis-tm-delete"), st[0].style.visibility = "hidden") : (ui = !1, dt.addClass("vis-tm-delete")) }, 500); lt.height(ri.height() - (c.height() + 20 + br.height())) } function as() { f[0].style.visibility = "hidden"; th(); var r = new n.ChildDialog; r.setEnableResize(!1); r.setTitle(n.Msg.getMsg("UnlinkRecord")); r.setModal(!0); r.setContent(ue); r.show(); r.onClose = function () { }; r.onOkClick = function () { for (var n = [], u, r = 0; r < i.find("input:checked").length; r++)u = t(i.find("input:checked")[r]).parent().find("li").attr("data-id"), n.push(u); i.find("input:checked").length == 0 && n.push(su); bottomchildselectedID = n; n = n.toString(); ff(e, n); a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none") }; r.onCancelClick = function () { a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none") } } function uc(r, u) { var o, s, e, h; for (st[0].style.visibility = "visible", o = [], s = "", e = 0; e < i.find("li li").length; e++)h = t(i.find("li li")[e]).attr("data-id"), o.push(h); s = o.toString(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/UpdateItemSeqNo", type: "Post", data: { treeID: u, itemsid: s, ParentID: r }, success: function (n) { var t = JSON.parse(n) }, error: function (n) { console.log(n); f[0].style.visibility = "visible" } }); st[0].style.visibility = "hidden" } function kr() { t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/TreeTableName", async: !1, data: { treeID: e }, success: function (n) { var t = JSON.parse(n); di = t }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function vs() { t(i.find("li")).draggable({ cursorAt: { left: -10, top: -10 }, helper: function () { var r = t(i.find("li")).find("input:checked").parent(), n; if (r.length === 0 && (r = t(this)), n = t("<div/>").attr("id", "draggingContainer"), t(i.find("li")).find("input:checked").length == 0) { if (t(this).hasClass("VIS-tm-topMLi")) return; r = t(this).parent(); n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer") } return n.append(r.clone()), l = n, l.css("width", "250px"), l.css({ "z-index": 2 }), l.css({ "max-height": "250px", overflow: "auto" }), l.css({ overflow: "hidden" }), n }, start: function () { var n, i, r; for (le = t(this).attr("id"), yr = !0, li = [], hu = [], n = 0; n < t(t(l.find("li li"))).length; n++)i = t(t(l.find("li li"))[n]).attr("id"), hu.push(parseInt(i)), li.push(i); nu(); bo = !1; dr = !0; cu = !1; ys(); si.css("display", "inherit"); d.css("display", "none"); a.height(tt.height()); a.css("margin-top", "5px"); a.css("background-color", "#FFC0CB"); a.css("display", "inherit"); a.mouseover(function () { a.addClass("selectchangecolor"); a.css("background-color", "#ff0000") }); a.mouseleave(function () { a.removeClass("selectchangecolor"); a.css("background-color", "#FFC0CB") }); r = ri.width() - 35; tt.width(r); dt.css("display", "none"); lt.css("overflow", "hidden") }, drag: function () { }, stop: function () { var o, u, s, r, i; if (dr = !1, a.hasClass("selectchangecolor")) if (f[0].style.visibility = "visible", kr(), o = "Select node_id from " + di + " where parent_id=" + su + " AND isactive='Y' and VAF_TreeInfo_id=" + e + "", u = k(o, null, null), u != null && u.tables[0].rows.length == 0) { if (s = [], li.length > 0) if (ni == "false") { for (r = [], i = 0; i < hu.length; i++)t.inArray(hu[i], hi) >= 0 || r.push(hu[i]); r.length > 0 ? ff(e, r.toString()) : (n.ADialog.info("NeverDelete", !0, tu), f[0].style.visibility = "hidden") } else ff(e, li.toString()); else n.ADialog.info("NeverDelete", !0, tu), f[0].style.visibility = "hidden"; a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none"); d.css("display", "inherit") } else as(); a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none"); d.css("display", "inherit"); tt.css("width", "100%"); lt.css("overflow", "auto"); si.css("display", "none"); dt.css("display", "inherit") } }) } function ar(i, r, e, o) { u.find("li").length == 0 && ht.empty(); lf != !1 && u.empty(); wi[0].style.visibility = "visible"; e = n.Utility.encodeText(e); e == null && (e = ""); cr.css("display", "inherit"); si.css("display", "inherit"); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/LoadMenuData", type: "Post", data: { pageLength: ae, pageNo: pi, treeID: i, searchtext: e, demandsMenu: o }, success: function (i) { var f = JSON.parse(i), o, s, e, l = t("<span><\/span>"), r, h, c; if (f) { for (r = 0; r < f.length; r++)u.find("li li").length > 0 && (h = u.find('[data-id="' + f[r].ID + '"]'), h && h.length > 0) || f[r].ID != 0 && (f[r].issummary == "Y" ? (f[r].disabled == !0 ? (e = t('<input class="vis-tm-chkbox" disabled type="checkbox" />'), o = "<i class='" + f[r].classopacity + " fa fa-folder-o summNonsumImage' data-imgsrc='Images/summary.png'><\/i>") : (e = t('<input  class="vis-tm-chkbox" type="checkbox" />'), o = "<i class='vis vis-m-window summNonsumImage' data-imgsrc='Images/folder.png'><\/i>"), u.append(t('<li class="vis-tm-upperLi">').append(t("<div class='vis-tm-upperdivchkandimg'>").append(e).append(o)).append(t("<div class='vis-tm-upperdivli'>").append(t("<li class='" + f[r].classopacity + " vis-tm-textli ' checkSummary='checkSummary'  style='cursor:default;' id='" + f[r].ID + "' data-id='" + f[r].ID + "'  style='cursor:pointer'  >" + n.Utility.encodeText(f[r].Name) + " (" + n.Utility.encodeText(f[r].description) + ")<\/li>").append(t("<span title='" + n.Msg.getMsg("UnlinkNode") + "' class='" + f[r].unlinkClass + "'><\/span>")))))) : (f[r].disabled == !0 ? (e = t('<input  class="vis-tm-chkbox"  disabled type="checkbox" />'), s = "<i class='" + f[r].classopacity + " vis vis-m-window summNonsumImage' data-imgsrc='Images/nonSummary.png'><\/i>") : (e = t('<input  class="vis-tm-chkbox" type="checkbox" />'), s = "<i class='vis vis-m-window summNonsumImage' data-imgsrc='Images/mWindow.png'><\/i>"), u.append(t('<li class="vis-tm-upperLi">').append(t("<div class='vis-tm-upperdivchkandimg'>").append(e).append(s)).append(t("<div class='vis-tm-upperdivli'>").append(t("<li class='" + f[r].classopacity + " vis-tm-textli ' style='cursor:default;' id='" + f[r].ID + "' data-id='" + f[r].ID + "'   style='cursor:pointer'  >" + n.Utility.encodeText(f[r].Name) + " (" + n.Utility.encodeText(f[r].description) + ")<\/li>").append(t("<span title='" + n.Msg.getMsg("UnlinkNode") + "' class='" + f[r].unlinkClass + "'><\/span>"))))))); u.find("li").length > 0 ? eu.css("display", "none") : eu.css("display", "inherit") } else u.find("li").length > 0 ? eu.css("display", "none") : eu.css("display", "inherit"); fc(); ws(); nt.prop("disabled", !1); cr.css("display", "none"); si.css("display", "none"); nr.css("display", "none"); wi[0].style.visibility = "hidden"; c = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); c && t(u.find("li")).draggable("destroy") }, error: function (n) { console.log(n); cr.css("display", "none"); si.css("display", "none"); nt.prop("disabled", !1); nr.css("display", "none"); f[0].style.visibility = "hidden"; wi[0].style.visibility = "hidden" } }) } function fc(n) { rr = n; t(u.find("li")).draggable({ cursorAt: { left: -10, top: -10 }, helper: function () { var i, n; return l = [], i = t(u.find("input:checked")).parent().parent(), i.length === 0 && (i = t(this)), n = t("<div/>"), t(u.find("input:checked")).parent().parent().length == 0 ? t(this).hasClass("vis-tm-textli") ? t(this).parent().parent().find("input").attr("disabled") == "disabled" ? window.setTimeout(function () { }, 200) : (i = t(this).parent().parent(), n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer")) : t(this).hasClass("vis-tm-upperLi") && (t(this).find("input").attr("disabled") == "disabled", n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer")) : t(this).hasClass("vis-tm-textli") ? (t(this).parent().parent().find("input").attr("disabled") == "disabled", n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer")) : t(this).hasClass("vis-tm-upperLi") && (t(this).find("input").attr("disabled") == "disabled", n = t("<div/>").attr("id", "draggingContainer")), t(this).parent().parent().find("input").attr("disabled") != "disabled" && t(this).parent().parent().find("input").attr("disabled") != undefined && n.append(i.clone()), (t(u.find("input:checked")).length > 0 || i.find("input").attr("disabled") == undefined) && !i.hasClass("vis-tm-opacity") && n.append(i.clone()), l = n, l.css({ width: "350px" }), l.css({ "z-index": 2 }), l.find(".vis-tm-upperLi").length > 5 && (l.css({ "max-height": "250px", overflow: "auto" }), l.css({ overflow: "hidden" })), gr = n, n }, start: function () { var u, r, i, f, e; if (si.css("display", "inherit"), gr.find("li").length > 0 && hr.css("display", "inherit"), bo = !0, gr.find(".vis-tm-textli").hasClass("vis-tm-textli") && (dr = !0), le = t(this).attr("id"), yr = !1, vu = !0, li = [], uu = [], cu = !0, l.find(".vis-tm-upperLi").length == 0) i = l.find("li").attr("id"), li.push(i); else for (u = l.find(".vis-tm-upperLi"), r = 0; r < u.length; r++)i = t(u.find("li")[r]).attr("id"), li.push(i), f = t(u[r]).find("i").data("imgsrc"), e = f.substr(f.lastIndexOf("/") + 1), e == "mWindow.png" || e == "folder.png" ? uu.push("new") : uu.push("update"); nu(); fo(n); ys() }, drag: function () { }, stop: function () { li = []; dr = !1; si.css("display", "none"); hr.css("display", "none") } }) } function nu() { ri.droppable({ drop: function (n, i) { var u = !0, s, c, h, o, e, l; be == !1 && (u = !1); t(i.draggable).hasClass("ui-dialog") && (f[0].style.visibility = "hidden", u = !1); r.find("span").hasClass("k-state-hover") || r.find("span").hasClass("k-state-selected") || (f[0].style.visibility = "hidden", u = !1); vu = !1; r.find("span").hasClass("k-state-hover") ? yu = t(r.find("li").find("span")).parent().find(".k-state-hover").parent().parent() : r.find("span").hasClass("k-state-selected") && (yu = t(r.find("li").find("span")).parent().find(".k-state-selected").parent().parent()); r.find("span").hasClass("k-state-hover") ? (o = b.find(".k-state-hover").find(".treechild"), ai = o, s = o.attr("data-issummary"), c = o.attr("data-nodeid"), h = o.attr("data-parentid")) : r.find("span").hasClass("k-state-selected") && (e = r.find(".k-state-selected").find(".treechild"), e.parent().css("border", "none"), ai = e, c = e.attr("data-nodeid"), s = e.attr("data-issummary"), h = e.attr("data-parentid")); l = []; s == "true" ? (cu == !1 && ai.parent().hasClass("k-state-selected") && (u = !1), kf = u, u == !0 ? (kf = u, eo(c, h, li, yr, uu)) : u == !1 && (vu = !0, f[0].style.visibility = "hidden")) : s != "false" || it.is(":checked") || (SummaryIDs = t(yu.parent().parent().find(".treechild")[0]).attr("data-nodeid"), ai = t(yu.parent().parent().find(".treechild")[0]), eo(SummaryIDs, h, li, yr, uu)) } }) } function ys() { r.data("kendoTreeView").wrapper.find(".k-in").on({ mouseenter: function () { dr == !0 && (be = !0, t(this).hasClass("k-state-selected") && t(this).css("border", "2px solid #bac0cc")) }, mouseleave: function () { dr == !0 && t(this).hasClass("k-state-selected") && t(this).css("border", "none"); be = !1 } }) } function fo() { i.parent().droppable({ drop: function (i, u) { var o = !0, e; if (vu == !1 && (o = !1), t(u.draggable).hasClass("ui-dialog") && (f[0].style.visibility = "hidden", o = !1), o == !0 && !yr) if (r.find(".k-state-selected").length == 1) { e = r.find(".k-state-selected").find(".treechild"); ai = e; var s = e.attr("data-nodeid"), h = e.attr("data-issummary"), c = e.attr("data-parentid"); h == "true" && gr.find(".vis-tm-textli").hasClass("vis-tm-textli") && (f[0].style.visibility = "visible", eo(s, c, li, yr, uu)) } else gr.find(".vis-tm-textli").hasClass("vis-tm-textli") && n.ADialog.info("SelectAnySummaryTreeNode"); r.find(".k-state-selected").length == 0 && gr.find(".vis-tm-textli").hasClass("vis-tm-textli") && n.ADialog.info("SelectAnySummaryTreeNode") }, tolerance: "pointer" }) } function eo(s, h, c, a, v) { var p = c.toString(); p != "" && (f[0].style.visibility = "visible", ht.empty(), v = v.toString(), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/SaveDataOnDrop", type: "Post", data: { summaryid: s, nodid: h, treeID: e, dragMenuNodeID: p, checkMorRdragable: a, IsExistItem: v }, success: function (e) { var ht = !0, ri = JSON.parse(e), ft, dt, ui, v, et, lt, at, vt, p, h, w, gt, b, c, bt, rt, d, tt, ot, ut, ni, ti, kt; if (a) for (ft = 0; ft < l.find("li").find(".VIS-tm-MLi").length; ft++)r.find("div").find("div[data-nodeid='" + s + "']").parent().hasClass("k-state-selected") && cu == !1 || (et = t(l.find("li").find(".VIS-tm-MLi")[ft]).attr("id"), t(i.find("li").find("li[data-id='" + et + "']").parent()).remove()); if (ri == n.Msg.getMsg("VIS_DataSave")) { if (dt = u.find(".vis-tm-menuselectedcolor"), ui = l.find("li .vis-tm-textli").attr("id"), r.find("div").find("div[data-nodeid='" + s + "']").parent().hasClass("k-state-selected")) for (v = l.find("li li").length - 1; v >= 0; v--)if (et = l.find("li li").attr("id"), cu != !1) { if (lt = i.find("input:checked").length, at = i.find("input").length, lt == at ? lt != 0 && at != 0 ? g.prop("checked", !1) : g.prop("checked", !1) : g.prop("checked", !1), vt = t(l.find("li li")[v]).attr("id"), p = t(l.find("li li")[v]).text(), p = p.substring(0, p.lastIndexOf("(")), h = t(l.find("li li")[v]).parent().parent().find("i").data("imgsrc"), h = h.substring(h.lastIndexOf("/") + 1), w = null, h == "nonSummary.png") w = "<i class='summNonsumImage vis vis-m-window'  data-imgsrc='Images/mWindow.png'><\/i>"; else if (h == "summary.png") w = "<i class='fa fa-folder-o summNonsumImage' data-imgsrc='Images/folder.png'><\/i>"; else if (h == "folder.png") { w = "<i class='fa fa-folder-o summNonsumImage' data-imgsrc='Images/folder.png'><\/i>"; continue } (h == "mWindow.png" && (w = "<i class='summNonsumImage vis vis-m-window' data-imgsrc='Images/mWindow.png'><\/i>"), o.val() == "" || !y.is(":checked") || p.contains(o.val())) && (gt = t('<input class="VIS-tm-checkbox" type="checkbox" />'), i.prepend(t('<li class="VIS-tm-topMLi">').append(gt).append(w).append(t("<li class='VIS-tm-MLi' data-id='" + vt + "'  id='" + vt + "' style='cursor:default'  >" + n.Utility.encodeText(p) + "<\/li>")))) } for (b = 0; b < l.find("li .vis-tm-textli").length; b++) { c = t(t(u.find("li"))).find("li[data-id='" + t(l.find(".vis-tm-textli")[b]).attr("data-id") + "']").parent().parent(); c.find("input").prop("disabled", "true"); c.find("input").prop("checked", !1); c.find("i").addClass("vis-tm-opacity"); c.find(".vis-tm-textli").addClass("vis-tm-opacity"); c.find("input").css("cursor", "not-allowed"); c.find("span").hasClass("VIS-Tm-glyphiconglyphicon-link") || c.find("span").addClass("VIS-Tm-glyphiconglyphicon-link"); nt.val() == "Unlinked" && c.remove(); var pt = t(t(u.find("li"))).find("li[data-id='" + t(l.find(".vis-tm-textli")[b]).attr("data-id") + "']").parent().parent().find("img").attr("src"), wt = t(t(u.find("li"))).find("li[data-id='" + t(l.find(".vis-tm-textli")[b]).attr("data-id") + "']").parent().parent().find("img"), k, h = pt; h != null && (h = h.substring(h.lastIndexOf("/") + 1), h == "mWindow.png" ? k = n.Application.contextUrl + "Areas/VIS/Images/nonSummary.png" : h == "folder.png" && (k = n.Application.contextUrl + "Areas/VIS/Images/summary.png"), wt.attr("src", k)); ht = !1 } for (bt = 0; bt < u.find(".vis-tm-menuselectedcolor").length; bt++)ht = !1; if (ht != !1 && l.find(".vis-tm-textli").length == 1) { var fi = t(t(u.find("li"))).find("li[data-id='" + l.find(".vis-tm-textli").attr("data-id") + "']"), pt = t(t(u.find("li"))).find("li[data-id='" + l.find(".vis-tm-textli").attr("data-id") + "']").parent().parent().find("img").attr("src"), wt = t(t(u.find("li"))).find("li[data-id='" + l.find(".vis-tm-textli").attr("data-id") + "']").parent().parent().find("img"), k, h = pt; h != null && (h = h.substring(h.lastIndexOf("/") + 1), h == "mWindow.png" ? k = n.Application.contextUrl + "Areas/VIS/Images/nonSummary.png" : h == "folder.png" && (k = n.Application.contextUrl + "Areas/VIS/Images/summary.png"), wt.attr("src", k)) } for (rt = [], d = 0; d < l.find(".vis-tm-textli").length; d++)(tt = null, ot = null, t(l.find(".vis-tm-textli")[d]).attr("checkSummary") == "checkSummary" ? (tt = "true", ot = "Areas/VIS/Images/folder.png") : (tt = "false", ot = "Areas/VIS/Images/mWindow.png"), it.is(":checked") && tt == "false") || (it.is(":checked") && tt == "true" && (yt.css("display", "inherit"), ct.css("display", "none")), it.is(":checked") || (yt.css("display", "inherit"), ct.css("display", "none")), ut = t(l.find(".vis-tm-textli")[d]).text(), ut = ut.substring(0, ut.lastIndexOf("(")), ni = r.data("kendoTreeView").append({ text: n.Utility.encodeText(ut), IsSummary: tt, getparentnode: ai.attr("data-nodeid"), TableName: ai.attr("data-tablename"), NodeID: t(l.find(".vis-tm-textli")[d]).attr("id"), TreeParentID: ai.attr("data-nodeid"), ParentID: ai.attr("data-nodeid"), ImageSource: ot }, ai), rt.push(ni)); if (ti = ai.parent().parent().parent(), rt && rt.length > 0) for (kt = rt.length - 1; kt >= 0; kt--)ls(ti); dt.removeClass("vis-tm-menuselectedcolor"); i.find("li").length > 0 && (ii.css("display", "none"), st[0].style.visibility = "hidden") } vs(); ir(); window.setTimeout(function () { o.val() != "" && ur(se) }, 200); uf(); er = !0; f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } })) } function sc() { w.on("change", ea); it.on("click", ha); yf.on("scroll", sa); u.on("click", ra); i.on("click", ia); o.on("keyup", ur); o.on("keypress", dl); tr.on("click", ta); o.on("input", function (n) { if ("" == this.value) { r.find("span").removeClass("VIS-TM-highlight"); ut = 1; et = 50; v = o.val(); h = y.is(":checked") ? "true" : "false"; var t = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); ki(t, e, ut, et, v, h, n) } }); gt.on("input", function () { "" == this.value && w.val() != "" && (u.empty(), window.setTimeout(function () { u.empty(); at = ""; vt = nt.val(); pi = 1; ar(e, bt, at, vt) }, 200)) }); no.on("click", bl); ge.on("click", ee); us.on("click", pl); gt.on("keyup", wl); c.on("resize", vl); c.find(".ui-resizable-e").css("right", "0px"); c.find(".ui-resizable-s").css("bottom", "0px"); ll(); d.on("click", cl); nt.on("change", al); s.mouseover(function () { s.addClass("selectchangecolor"); s.css("background-color", "#ff0000") }); s.mouseleave(function () { s.removeClass("selectchangecolor"); s.css("background-color", "#FFC0CB") }); lt.on("scroll", hl); window.setTimeout(function () { }, 200); y.is(":checked") && (ru = -1); y.on("click", function (n) { h = y.is(":checked") ? "true" : "false"; ur(n) }); g.on("click", fl); yt.on("click", ul); ct.on("click", rl); dt.on("click", gc); ft.on("click", ws); bi.on("click", bc); lr.on("click", wc); rs.on("click", pc); hr.mouseover(function () { hr.css({ cursor: "not-allowed" }) }); hr.mouseleave(function () { hr.css({ cursor: "default" }) }); pf.on("click", yc); vi.on("click", lc) } function hc() { var i, r, c, l, a, v, u, t, s; yi = []; i = "SELECT vaf_tableview_id FROM VAF_TreeInfo WHERE VAF_TreeInfo_id=" + e; i = k(i, null, null); i.tables[0].rows.length > 0 && (i = i.tables[0].rows[0].cells.vaf_tableview_id); r = "SELECT tablename FROM vaf_tableview WHERE vaf_tableview_id=" + i; r = k(r, null, null); r.tables[0].rows.length > 0 && (r = r.tables[0].rows[0].cells.tablename); ni = "true"; r == "VAF_MenuConfig" && (c = "SELECT count(*) FROM VAF_Role WHERE VAF_TreeInfo_menu_id=" + e, l = vf(c), l > 0 ? ni = "false" : (a = "SELECT count(*) FROM VAF_ClientDetail WHERE VAF_TreeInfo_menu_id=" + e, v = vf(a), v > 0 && (ni = "false"))); var f = k("SELECT VAF_MenuConfig_id FROM VAF_MenuConfig WHERE ad_form_id IN (SELECT ad_form_id FROM ad_form WHERE name IN ('Tree Maintenance'))", null, null); if (f != null && f.tables[0].rows.length > 0) for (t = 0; t < f.tables[0].rows.length; t++)yi.push(f.tables[0].rows[t].cells.VAF_MenuConfig_id); if (u = k("SELECT VAF_MenuConfig_id FROM VAF_MenuConfig WHERE ad_window_id IN (SELECT ad_window_id FROM ad_window WHERE name IN ('Role','Tenant','Tree'))", null, null), u != null && u.tables[0].rows.length > 0) for (t = 0; t < u.tables[0].rows.length; t++)yi.push(u.tables[0].rows[t].cells.VAF_MenuConfig_id); hi = yi; yi = yi.toString(); var y = "SELECT name FROM VAF_MenuConfig WHERE VAF_MenuConfig_id IN(" + yi + ") ORDER BY upper(name)", o = k(y, null, null), h = ""; if (o != null && o.tables[0].rows.length > 0) for (s = 0; s < o.tables[0].rows.length; s++)h += o.tables[0].rows[s].cells.name, h += ","; tu = h + " " + n.Msg.getMsg("MenuBinded"); st[0].style.visibility = "hidden" } function cc(n) { var i, t, r; kr(); i = "SELECT MAX(seqno) FROM " + di + " WHERE VAF_TreeInfo_ID=" + e; t = vf(i); t += 1; r = "update " + di + " set seqno=" + t + ",Updated=Sysdate,parent_ID=0 WHERE VAF_TreeInfo_ID=" + e + " AND node_id=" + n; fu(r, null, null) } function lc() { } function ac() { if (w.val() != "") { if (t(this).find("span").hasClass("vis-tm-delete")) return; n.ADialog.confirm("RemoveUnlinkedItem", !0, "", "Confirm", function (n) { if (n) { vc(); yt.css("display", "none"); ct.css("display", "inherit"); var t = w.find("option:selected").text(); ti.text(t); er = !1 } else return }) } } function vc() { f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/RemoveLinkedItemFromTree", type: "Post", data: { treeID: e, menuId: yi }, success: function (t) { var i = JSON.parse(t); i == "count" ? (u.empty(), at = gt.val(), vt = nt.val(), pi = 1, ar(e, bt, at, vt), window.setTimeout(function () { ee(); window.setTimeout(function () { er = !1; f[0].style.visibility = "hidden" }, 200) }, 200)) : i == "menubind" && (f[0].style.visibility = "hidden", n.ADialog.info("NeverDelete", !0, tu)) }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function yc() { if (w.val() != "") { var f = t('<ul class="vis-apanel-tm-ul"><\/ul>'), u = t("<div>"), i = t('<div style="padding:0 10px;min-width:150px">'), r = t('<span class="VIS-Tm-glyphiconglyphicon-link VIS-Tm-unlinkforbottmo vis vis-link"><\/span>'); gf = t('<p style="line-height:19px;cursor:pointer;">' + n.Msg.getMsg("RemoveLinkedItem") + "<\/p>").append(r); u.append(i); i.append(t('<div style="margin-top: 10px;" ><\/div>').append(vi).append(dh)); i.append(t('<div style="float: left;margin-bottom: 6px;margin-top: 5px;width:100%" ><\/div>').append(gf)); t(this).w2overlay(u); er == !0 ? r.removeClass("vis-tm-delete") : r.addClass("vis-tm-delete"); gf.on("click", ac) } } function uf(n) { if (r.find("span").hasClass("k-state-selected") && lt.find("ul").height() < lt.height()) { ut = 1; et = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; fr = !1; var t = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); ki(t, e, ut, et, v, h, n) } } function ne() { ft.prop("checked", !1) } function pc() { var i = vf("SELECT VAF_Screen_ID FROM VAF_Screen WHERE Name='Tree'"), t = new n.Query; t.addRestriction("VAF_TreeInfo_ID", n.Query.prototype.EQUAL, e); n.viewManager.startWindow(i, t) } function wc() { lr.css("display", "none"); gt.val(""); w.val() != "" && (u.empty(), window.setTimeout(function () { u.empty(); at = ""; vt = nt.val(); pi = 1; ar(e, bt, at, vt) }, 200)) } function bc(n) { o.val(""); o.focus(); bi.css("display", "none"); r.find("span").removeClass("VIS-TM-highlight"); ut = 1; et = 50; v = o.val(); h = y.is(":checked") ? "true" : "false"; fr = !0; var t = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); w.val() != "" && ki(t, e, ut, et, v, h, n) } function ws(n) { if (rr = n, ft.is(":checked")) { wi[0].style.visibility = "visible"; ye = !1; for (var i = 0; i < u.find("input").length; i++)t(u.find("input")[i]).attr("disabled") == "disabled" && t(u.find("input")[i]).parent().parent().removeClass("vis-tm-menuselectedcolor"), t(u.find("input")[i]).attr("disabled") != "disabled" && (t(u.find("input")[i]).prop("checked", !0), t(u.find("input")[i]).parent().parent().addClass("vis-tm-menuselectedcolor")); wi[0].style.visibility = "hidden" } else ye == !1 && (wi[0].style.visibility = "visible", u.find("input").prop("checked", !1), u.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"), wi[0].style.visibility = "hidden") } function kc(n) { t(n.target).hasClass("VIS-tm-MLi") && (t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(this).find("li").find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), g.prop("checked", !1)); t(n.target).hasClass(" summNonsumImage ") && (t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(this).find("li").find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), g.prop("checked", !1)); t(n.target).hasClass("VIS-tm-checkbox") && (t(n.target).parent().find("input").prop("checked") ? t(n.target).parent().addClass("vis-tm-menuselectedcolor") : (t(n.target).parent().removeClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"), g.prop("checked", !1))) } function dc(n) { v = ""; var i = t(n.currentTarget); i[0].scrollHeight - i.scrollTop() == i.outerHeight() && (te = !1, ie += 1, f[0].style.visibility = "visible", ds(pr, e, ie, oo, v, h, n)) } function gc(u) { var c, s; if (f[0].style.visibility = "visible", w.val() != "" && (o.prop("disabled", !1), tr.prop("disabled", !1)), sr = !1, ui == !1) { sr = !0; dt.addClass("vis-tm-delete"); f[0].style.visibility = "hidden"; return } if (r.find(".k-state-selected").length == 0) { f[0].style.visibility = "hidden"; sr = !0; return } if (w.val() == "") { f[0].style.visibility = "hidden"; sr = !0; return } nl(); te = !0; ie = 1; oo = 50; v = ""; h = "false"; c = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); f[0].style.visibility = "visible"; window.setTimeout(function () { ds(c, e, ie, oo, v, h, u) }, 200); pt.on("click", kc); ks.on("scroll", dc); s = new n.ChildDialog; s.setHeight(550); s.setWidth(450); s.setEnableResize(!1); s.setTitle(n.Msg.getMsg("SetOrder")); s.setModal(!0); s.setContent(bs); pt.empty(); s.show(); s.onClose = function () { iu = !0 }; s.onOkClick = function (u) { var s, f, p; if (re == !1) { re = !0; iu = !0; st[0].style.visibility = "visible"; s = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); so = s; var c = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"), l = [], a = ""; for (f = 0; f < pt.find("li li").length; f++)p = t(pt.find("li li")[f]).attr("data-id"), l.push(p); a = l.toString(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/UpdateItemSeqNo", type: "Post", data: { treeID: e, itemsid: a, ParentID: c }, success: function (n) { var t = JSON.parse(n); ee(); i.empty(); ut = 1; et = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; fr = !0; ki(c, e, ut, et, v, h, u); yt.css("display", "inherit"); ct.css("display", "none") }, error: function (n) { console.log(n); st[0].style.visibility = "hidden" } }) } v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; sr = !0 }; s.onCancelClick = function () { f[0].style.visibility = "hidden"; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; re = !0; sr = !0; iu = !1 } } function nl() { bs.append(ks.append(pt)) } function ds(i, r, u, e, o, s) { o == null && (o = ""); te == !0 && pt.empty(); nu(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/FillSequenceDailog", type: "Post", data: { nodeID: i, treeID: r, pageNo: u, pageLength: e, searchChildNode: o, getTreeNodeChkValue: s }, success: function (i) { var r, o, s, e; f[0].style.visibility = "visible"; var u = JSON.parse(i), h = null, c = null; if (u.length > 0) for (r = 0; r < u.length; r++)fr == !1 && pt.find("li li").length > 0 && (o = pt.find('[data-id="' + u[r].parentID + '"]'), o && o.length > 0) || u[r].parentID != 0 && (s = t('<input class="VIS-tm-checkbox" type="checkbox" />'), u[r].issummary == "Y" ? (h = "<i class='fa fa-folder-o summNonsumImage' data-imgsrc='Images/folder.png'><\/i>", pt.append(t('<li class="VIS-tm-topMLi">').append(s).append(h).append(t("<li class='VIS-tm-MLi' data-NodePID='" + u[r].NodeParentID + "' data-id='" + u[r].parentID + "' data-issummary='" + u[r].issummary + "' id='" + u[r].parentID + "'   >" + n.Utility.encodeText(u[r].name) + "<\/li>")))) : (c = "<i class='vis vis-m-window summNonsumImage' data-imgsrc='Images/mWindow.png'><\/i>", e = t('<li class="VIS-tm-topMLi" >'), e.append(s), e.append(c), e.append(t("<li class='VIS-tm-MLi'  data-NodePID='" + u[r].NodeParentID + "'  data-id='" + u[r].parentID + "' data-issummary='" + u[r].issummary + "' id='" + u[r].parentID + "'   >" + n.Utility.encodeText(u[r].name) + "<\/li>")), pt.append(e))); il(); pt.sortable("refresh"); window.setTimeout(function () { f[0].style.visibility = "hidden" }, 500) }, error: function (n) { console.log(n); pt.empty(); f[0].style.visibility = "hidden" } }) } function il() { var n = null; pt.sortable({ cursorAt: { left: -10, top: -10 }, helper: function (i, r) { n = t("<li />"); r.hasClass("vis-tm-menuselectedcolor") || r.addClass("vis-tm-menuselectedcolor").siblings().removeClass("vis-tm-menuselectedcolor"); var u = r.parent().children(".vis-tm-menuselectedcolor").clone(); return gs = r.data("multidrag", u).siblings(".vis-tm-menuselectedcolor"), r.data("multidrag", u).siblings(".vis-tm-menuselectedcolor").hide(), tl = n.append(u), n.append(u) }, start: function (n, i) { re = !1; pt.find("input").prop("checked", !1); su = i.item.find("li").attr("id"); t(this).parent().parent().parent().css("overflow", "hidden") }, change: function () { }, update: function () { }, stop: function (n, t) { t.item.after(t.item.data("multidrag")).remove(); window.setTimeout(function () { gs.remove() }, 100); pt.find("input").prop("checked", !1); pt.find(".vis-tm-menuselectedcolor").find("input").prop("checked", !0) } }) } function rl() { w.val() != "" && r.find("li").length > 1 && (oi[0].style.visibility = "visible", window.setTimeout(function () { ct.css("display", "none"); yt.css("display", "inherit"); yt.css("float", "right"); b.data("kendoTreeView").expand(".k-item"); oi[0].style.visibility = "hidden" }, 150)) } function ul() { w.val() != "" && (oi[0].style.visibility = "visible", window.setTimeout(function () { ct.css("display", "inherit"); yt.css("display", "none"); ct.css("float", "right"); b.data("kendoTreeView").collapse(".k-item"); oi[0].style.visibility = "hidden" }, 150)) } function fl() { g.is(":checked") ? (i.find("input").prop("checked", !0), i.find("li").addClass("vis-tm-menuselectedcolor"), d.removeClass("vis-tm-delete"), i.find("input:checked").length == 0 && d.addClass("vis-tm-delete")) : (i.find("input").prop("checked", !1), i.find("li").removeClass("vis-tm-menuselectedcolor"), d.addClass("vis-tm-delete")) } function hl(n) { v = o.val(); var r = t(n.currentTarget); el = r[0].scrollHeight; ol = r.scrollTop(); sl = r.outerHeight(); r[0].scrollHeight - r.scrollTop() - 10 == r.outerHeight() - 10 && i.find("li").length > 0 && (ut += 1, fr = !1, st[0].style.visibility = "visible", ki(pr, e, ut, et, v, h, n), st[0].style.visibility = "hidden", i.find("li").length > 0 && (ii.css("display", "none"), st[0].style.visibility = "hidden")) } function cl() { wt = []; i.find("input:checked").length > 0 && n.ADialog.confirm("DoYouWantToUnlink", !0, "", "Confirm", function (r) { if (r) f[0].style.visibility = "visible", window.setTimeout(function () { for (var o = [], u, r = 0; r < i.find("input:checked").length; r++)(u = t(i.find("input:checked")[r]).parent().find("li").attr("data-id"), ni == "false" && t.inArray(parseInt(u), hi) >= 0) || (wt.push(u), o.push(parseInt(u))); bottomchildselectedID = wt; wt = wt.toString(); wt.length > 0 ? ff(e, wt) : (n.ADialog.info("NeverDelete", !0, tu), f[0].style.visibility = "hidden") }, 200); else { f[0].style.visibility = "hidden"; return } }); f[0].style.visibility = "hidden" } function ff(e, o) { var s, h, c, l; f[0].style.visibility = "visible"; s = "SELECT vaf_tableview_id FROM VAF_TreeInfo WHERE VAF_TreeInfo_id=" + e; s = k(s, null, null); s.tables[0].rows.length > 0 && (s = s.tables[0].rows[0].cells.vaf_tableview_id); h = " SELECT treetype FROM VAF_TreeInfo WHERE VAF_TreeInfo_id=" + e; h = k(h, null, null); treeType = h.tables[0].rows[0].cells.treetype; c = ""; c = treeType == "PR" ? "VAF_TreeInfoChildProd" : treeType == "BP" ? "VAF_TreeInfoChildBPart" : treeType == "MM" ? "VAF_TreeInfoChildMenu" : "VAF_TreeInfoChild"; rt = []; l = ""; i.find("input:checked").length > 0 && (o = o.toString(), ef(c, o, e)); i.find("input:checked").length == 0 && ef(c, o, e); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromBottom", type: "Post", data: { nodeid: o, treeID: e, menuArray: yi }, success: function (e) { var et = JSON.parse(e), ut, b, c, h, v, a, k, tt, w, it; if (et == "") { for (g.prop("checked", !1), ut = !0, h = 0; h < i.find("input:checked").length; h++)if (ut = !1, ni != "false" || (w = t(i.find("input:checked").parent().find("li")[h]).attr("data-id"), !(t.inArray(parseInt(w), hi) >= 0))) { b = o.toString(); b = b.split(","); c = u.find("li").find("li[data-id='" + b[h] + "']").parent().parent(); c.find("input").prop("disabled", !1); c.find("i").removeClass("vis-tm-opacity"); c.find(".vis-tm-textli").removeClass("vis-tm-opacity"); c.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); c.find("input").css("cursor", "pointer"); c.hasClass("vis-tm-menuselectedcolor") && (ht.empty(), c.find("input").prop("checked", !0)); nt.val() == "Linked" && c.remove(); var ft = t(i.find("input:checked").parent().find(".VIS-tm-MLi")[h]).attr("data-id"), p = t(t(u.find("li"))).find("li[data-id='" + ft + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + ft + "']").parent().parent().find("img"), l, s = p; if (s != null) if (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png") l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png", y.attr("src", l); else if (s == "summary.png") for (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png", y.attr("src", l), ch(ft), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + bottomchildselectedID[h] + "']").parent().parent().parent()), h = 0; h < rt.length; h++) { v = rt[h]; r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + v + "']").parent().parent().parent()); t(i.find("input:checked")[h]).parent().remove(); a = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent(); a.find("input").prop("disabled", !1); a.removeClass("vis-tm-menuselectedcolor"); a.find("i").removeClass("vis-tm-opacity"); a.find(".vis-tm-textli").removeClass("vis-tm-opacity"); a.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); a.find("input").css("cursor", "pointer"); var p = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img"), l, s = p; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "mWindow.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "folder.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png")); y.attr("src", l) } } if (ut == !0 && i.find("input:checked").length == 0) { c = u.find("li").find("li[data-id='" + rt + "']").parent().parent(); c.find("input").prop("disabled", !1); c.find("i").removeClass("vis-tm-opacity"); c.find(".vis-tm-textli").removeClass("vis-tm-opacity"); c.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); c.find("input").css("cursor", "pointer"); c.hasClass("vis-tm-menuselectedcolor") && (ht.empty(), c.find("input").prop("checked", !0)); nt.val() == "Linked" && c.remove(); var p = t(t(u.find("li"))).find("li[data-id='" + rt + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + rt + "']").parent().parent().find("img"), l, s = p; if (s != null) if (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png") l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png", y.attr("src", l); else if (s == "summary.png") for (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png", y.attr("src", l), ch(rt), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + rt + "']").parent().parent().parent()), h = 0; h < rt.length; h++) { v = rt[h]; r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + v + "']").parent().parent().parent()); t(i.find("input:checked")[h]).parent().remove(); a = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent(); a.find("input").prop("disabled", !1); a.removeClass("vis-tm-menuselectedcolor"); a.find("i").removeClass("vis-tm-opacity"); a.find(".vis-tm-textli").removeClass("vis-tm-opacity"); a.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); a.find("input").css("cursor", "pointer"); var p = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img"), l, s = p; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "mWindow.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "folder.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png")); y.attr("src", l) } i.find("li").find("li[data-id='" + rt + "']").parent().remove(); r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + rt + "']").parent().parent().parent()) } for (d.addClass("vis-tm-delete"), k = [], tt = 0; tt < i.find("input:checked").length; tt++)(w = t(i.find("input:checked").parent().find("li")[tt]).attr("data-id"), ni == "false" && t.inArray(parseInt(w), hi) >= 0) || k.push(w); for (it = 0; it < k.length; it++)i.find("li").find("li[data-id='" + k[it] + "']").parent().remove(); i.find("input:checked").length > 0 && n.ADialog.info("NeverDelete"); uf() } ir(); ne(); ou(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }); ir() } function ir() { i.find("input").length == 0 ? (g.prop("disabled", !0), g.css("cursor", "not-allowed"), g.prop("checked", !1), d.addClass("vis-tm-delete"), dt.addClass("vis-tm-delete"), ui = !1) : (dt.removeClass("vis-tm-delete"), ui = !0, g.prop("disabled", !1), g.css("cursor", "pointer")) } function ll() { var i = "" + n.Msg.getMsg("All") + "", r = "" + n.Msg.getMsg("Linked") + "", u = "" + n.Msg.getMsg("UnLinked") + ""; nt.append(t("<Option value='All'>" + i + "<\/option>")); nt.append(t("<Option value='Linked'>" + r + "<\/option>")); nt.append(t("<Option value='Unlinked'>" + u + "<\/option>")) } function al() { w.val() != "" && (ht.empty(), u.empty(), vt = nt.val(), window.setTimeout(function () { nt.prop("disabled", !0); nr.css("display", "inherit"); lf = !1; vt = nt.val(); at = gt.val(); pi = 1; ar(e, bt, at, vt) }, 200)) } function vl(n, t) { var i = t.size.height; c.css("height", i); c.css("overflow-x", "none"); c.css("width", "100%"); window.setTimeout(function () { lt.height(ri.height() - (c.height() + br.height() + 45)) }, 200); tt.css("overflow", "hidden"); tt.height(ri.height() - c.height()); a.height(tt.height() - 10); kt.height(i - 10); c.addClass("VIS-TM-resizediv"); kt.addClass("VIS-TM-resizediv") } function th() { ue = t("<div>"); nh = t('<input style="margin-right: 10px;" type="checkbox"/>'); var r = t("<span>" + n.Msg.getMsg("WantToUnlinked") + "<span/>"), i = t('<span style="font-size: 16px;">' + n.Msg.getMsg("UnlinkedWithChild") + "<span/>"); ue.append(t('<div style="padding: 10px;">').append(i)) } function yl(i) { rr = i; kr(); var u = "Select node_id from " + di + " where parent_id=" + au + " AND isactive='Y' and VAF_TreeInfo_id=" + e + "", r = k(u, null, null); if (r != null && r.tables[0].rows.length == 0) { if (wu = !0, s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), ot.css("display", "none"), ni == "false") { if (t.inArray(parseInt(pu), hi) >= 0) { n.ADialog.info("NeverDelete", !0, tu); return } ho(e, pu, af, wu) } else ho(e, pu, af, wu); return } f[0].style.visibility = "hidden"; th(); n.ADialog.confirm("ChildAlsoWillbeRemove", !0, "", "Confirm", function (n) { n ? (wu = !0, ho(e, pu, af, wu), s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), ot.css("display", "none")) : (s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), ot.css("display", "none")) }) } function ho(e, o, s, h) { var c, l, v, a, y; o != 0 ? (ih = !1, f[0].style.visibility = "visible", c = "SELECT vaf_tableview_id FROM VAF_TreeInfo WHERE VAF_TreeInfo_id=" + e, c = k(c, null, null), c.tables[0].rows.length > 0 && (c = c.tables[0].rows[0].cells.vaf_tableview_id), l = "SELECT tablename FROM vaf_tableview WHERE vaf_tableview_id=" + c, l = k(l, null, null), l.tables[0].rows.length > 0 && (l = l.tables[0].rows[0].cells.tablename), v = " SELECT treetype FROM VAF_TreeInfo WHERE VAF_TreeInfo_id=" + e, v = k(v, null, null), treeType = v.tables[0].rows[0].cells.treetype, a = "", a = treeType == "PR" ? "VAF_TreeInfoChildProd" : treeType == "BP" ? "VAF_TreeInfoChildBPart" : treeType == "MM" ? "VAF_TreeInfoChildMenu" : "VAF_TreeInfoChild", wt = o.toString(), ef(a, wt, e), y = "select parent_ID  from " + a + " WHERE NODE_ID=" + o + " AND VAF_TreeInfo_ID=" + e + " AND IsActive='Y'", y = k(y, null, null), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromTree", type: "Post", data: { nodeid: o, treeID: e, unlinkchild: h, menuArray: yi }, success: function (e) { var k = JSON.parse(e), p, v, s, tt, d; if (k == "") { i.find("input:checked").length == 0 && g.prop("checked", !1); ah = k; i.find("li").find("li[data-id='" + o + "']").parent().remove(); s = u.find("li").find("li[data-id='" + o + "']").parent().parent(); s.find("input").prop("disabled", !1); s.find("i").removeClass("vis-tm-opacity"); s.find(".vis-tm-textli").removeClass("vis-tm-opacity"); s.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); s.find("input").css("cursor", "pointer"); s.hasClass("vis-tm-menuselectedcolor") && (ht.empty(), s.find("input").prop("checked", !0)); var w = t(t(u.find("li"))).find("li[data-id='" + o + "']").parent().parent().find("img").attr("src"), b = t(t(u.find("li"))).find("li[data-id='" + o + "']").parent().parent().find("img"), l, c = w; if (c != null && (c = c.substring(c.lastIndexOf("/") + 1), c == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : c == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), b.attr("src", l)), rh = a, h == !0) for (ni == "false" && uh(), r.data("kendoTreeView").remove(ss), p = 0; p < rt.length; p++)if (v = rt[p], i.find("li").find("li[data-id='" + v + "']").parent().remove(), ni != "false" || !(t.inArray(parseInt(v), hi) >= 0)) { s = u.find("li").find("li[data-id='" + v + "']").parent().parent(); s.find("input").prop("disabled", !1); s.find("i").removeClass("vis-tm-opacity"); s.find(".vis-tm-textli").removeClass("vis-tm-opacity"); s.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); s.find("input").css("cursor", "pointer"); s.hasClass("vis-tm-menuselectedcolor") && (s.find("input").prop("checked", !0), ht.empty()); nt.val() == "Linked" && s.remove(); var w = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img").attr("src"), b = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img"), l, c = w; c != null && (c = c.substring(c.lastIndexOf("/") + 1), c == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : c == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), b.attr("src", l)) } h == !1 && (tt = null, d = y.tables[0].rows[0].cells.parent_id, ai = r.find("div").find("div[data-nodeid='" + d + "']")); uf() } wo.find("span").hasClass("k-state-selected") && ti.text(n.Msg.getMsg("SelectTree")); ir(); ne(); ou(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } })) : n.ADialog.info("VIS_SelectTreeNode") } function uh() { for (var u = [], s, i, f, h, e = 0; e < fe.length; e++)s = fe[e], u.push(parseInt(s)); for (i = 0; i < u.length; i++)t.inArray(u[i], hi) >= 0 && (cc(u[i]), f = r.find("div").find("div[data-nodeid='" + u[i] + "']").parent().parent().parent(), r.find("div").find("div[data-nodeid='" + u[i] + "']").parent().parent().parent().remove(), it.is(":checked") || (h = r.data("kendoTreeView").append({ text: n.Utility.encodeText(f.text()), IsSummary: f.find(".treechild").attr("data-issummary"), getparentnode: 0, TableName: f.find(".treechild").attr("data-tablename"), NodeID: f.find(".treechild").attr("data-nodeid"), TreeParentID: f.find(".treechild").attr("data-nodeid"), ParentID: 0, ImageSource: "Areas/VIS/Images/mWindow.png" }, t(t(r.find(".treechild")[0]))))); o.val() != "" && window.setTimeout(function () { ur(se) }, 200) } function ef(i, r, u) { f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/SelectAllChildNodes", type: "Post", async: !1, data: { TableName: i, treeID: u, nodeID: r }, success: function (n) { f[0].style.visibility = "visible"; var t = JSON.parse(n); rt = []; t != null && (rt = t.split(","), fe = rt) }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function pl() { w.val() != "" && (u.empty(), at = gt.val(), vt = nt.val(), pi = 1, ar(e, bt, at, vt)) } function wl(n) { n.which != 13 && n.which != 8 && n.which != 46 && lr.css("display", "inherit"); (n.which == 8 || n.which == 46) && gt.val() == "" && lr.css("display", "none"); n.which == 13 && w.val() != "" && (u.empty(), at = gt.val(), vt = nt.val(), pi = 1, ar(e, bt, at, vt)) } function bl(t) { w.val() != "" && nr.css("display", "inherit"); rr = t; w.empty(); es(); iu = !1; ee(); dt.addClass("vis-tm-delete"); yt.css("display", "none"); ct.css("display", "inherit"); ct.css("float", "right"); ti.text(n.Msg.getMsg("SelectTree")); ir() } function ee() { i.empty(); ps = !1; w.val() != "" && (it.is(":checked") ? (fi = !0, ei != null && nf(bt, e, vr, fi)) : (fi = !1, ei != null && nf(bt, e, vr, fi))); tt.css("overflow", "hidden") } function dl(n) { if (df = !0, n.which == 13) { if (o.val() != "" && it.is(":checked") && (o.prop("disabled", !0), tr.prop("disabled", !0)), h == "true" && r.find(".k-state-selected").length == 1) { ut = 1; et = 50; h = y.is(":checked") ? "true" : "false"; var u = r.find(".k-state-selected").find("div").attr("data-nodeid"); v = o.val(); i.empty(); ki(u, e, ut, et, v, h, n) } o.val() != "" && w.val() != "" && (d.removeClass("vis-tm-delete"), f[0].style.visibility = "visible", b.find("span.k-in").find(".treechild").find("p").each(function () { var r = t(this).text().toUpperCase(), i; if (r == o.val().toUpperCase()) { n.preventDefault(); i = t(this).parent().parent().parent().parent().parent().attr("class"); b.data("kendoTreeView").expand("." + i); b.find("span").removeClass("k-state-selected"); t(this).parent().parent().parent().addClass("k-state-selected"); this.parentNode.parentNode.parentNode.scrollIntoView(); f[0].style.visibility = "hidden"; return } }), sh(n), d.addClass("vis-tm-delete"), f[0].style.visibility = "hidden") } else ru = -1 } function sh(n) { if (it.is(":checked") && (o.prop("disabled", !0), tr.prop("disabled", !0)), fh = of, eh = o.val(), oe = hh(fh, eh, ru), oe > -1) { var t = sf[oe]; currentNode = t; ru = oe; gl(t, n) } else oh = !1, o.val() != "" && (o.prop("disabled", !1), tr.prop("disabled", !1)) } function hh(n, t, i) { for (var r = i + 1; r < n.length; r++)if (r != -1 && n[r].trim().toLowerCase().contains(t.trim().toLowerCase())) return r; return i > -1 ? (i = -1, hh(n, t, i)) : -1 } function gl(n, t) { return n != -1 ? (currentNode = n, na(n, !0, t)) : (currentNode = 0, !1) } function na(n, u, f) { y.is(":checked") ? (i.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"), lt.find("li").find("li[id='" + n + "']").parent().find("input").prop("checked", !0), lt.find("li").find("li[id='" + n + "']").parent().addClass("vis-tm-menuselectedcolor"), lt.find("li").find("li[id='" + n + "']").parent().hasClass("vis-tm-menuselectedcolor") && (lt.find("li").find("li[id='" + n + "']").parent()[0].scrollIntoView(), lt.height(tt.height() - (br.height() + 50)))) : df == !0 && (r.find(".k-state-selected").removeClass("k-state-selected"), t(r.find("div").find("div[data-nodeid='" + n + "']").parent()).addClass("k-state-selected"), t(r.find("div").find("div[data-nodeid='" + n + "']").parent()).hasClass("k-state-selected") && (t(r.find("div").find("div[data-nodeid='" + n + "']").parent()).addClass("k-state-selected")[0].scrollIntoView(), lu()), window.setTimeout(function () { ut = 1; et = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; var t = r.find("div").find("div[data-nodeid='" + n + "']").parent().text(); ti.text(t); i.empty(); ki(n, e, ut, et, v, h, f) }, 400)) } function ta(n) { if (o.val() != "" && (o.prop("disabled", !0), tr.prop("disabled", !0)), h == "true" && r.find(".k-state-selected").length == 1) { ut = 1; et = 50; h = y.is(":checked") ? "true" : "false"; var u = r.find(".k-state-selected").find("div").attr("data-nodeid"); v = o.val(); i.empty(); ki(u, e, ut, et, v, h, n) } o.val() != "" && (f[0].style.visibility = "visible", b.find("span.k-in").find(".treechild").find("p").each(function () { var r = t(this).text().toUpperCase(), i; r == o.val().toUpperCase() && (n.preventDefault(), i = t(this).parent().parent().parent().parent().parent().attr("class"), b.data("kendoTreeView").expand("." + i), b.find("span").removeClass("k-state-selected"), t(this).parent().parent().parent().addClass("k-state-selected"), this.parentNode.parentNode.parentNode.scrollIntoView()) }), sh(n), f[0].style.visibility = "hidden") } function ur(u) { var f, e; if (w.val() != "" && (bi.css("display", "inherit"), co == !0 && (co = !1, se = u)), w.val() == "") return !1; if (t(o).val() == "" || !wf) { t(o).val() == "" && (i.find("span").removeClass("VIS-TM-highlight"), r.find("span").removeClass("VIS-TM-highlight"), bi.css("display", "none"), df = !0, co = !0); wf = !0; return } if (u != undefined && u.which != 13) if (f = o.val().toUpperCase(), e = f.length, y.is(":checked")) ru = -1, sf = [], of = [], r.find("span").removeClass("VIS-TM-highlight"), i.find("li li").each(function (r, u) { var c = t(u), s = n.Utility.decodeText(t(this).text()), h, o; if (sf.push(c.attr("id")), of.push(s), h = "", o = 0, f == "") s.toUpperCase().indexOf(f, o) == 0 && (t(this).find("span").removeClass("VIS-TM-highlight"), i.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"), d.addClass("vis-tm-delete"), i.find("input").prop("checked", !1)); else { while ((p = s.toUpperCase().indexOf(f, o)) >= 0) h += s.substring(o, p) + '<span class="VIS-TM-highlight">' + s.substr(p, e) + "<\/span>", o = p + e; s.toUpperCase().indexOf(f, o) == -1 && t(this).find("span").removeClass("VIS-TM-highlight"); o > 0 && (h += s.substring(o)) } }); else { if (sf = [], of = [], i.find("li").find("span").removeClass("VIS-TM-highlight"), b.data("kendoTreeView").expand(".k-item"), ct.css("display", "none"), yt.css("display", "inherit"), t(o).val() == "" && b.find("span").removeClass("VIS-TM-highlight"), t("span.k-in > span.highlight").each(function () { t(this).parent().text(t(this).parent().text()) }), t.trim(o.val()) == "") return; f = o.val().toUpperCase(); e = f.length; b.find("span.k-in").each(function (i, r) { var h = t(r), o = n.Utility.decodeText(t(this).text()), s, u; for (sf.push(h.find(".treechild").attr("data-nodeid")), of.push(o), s = "", u = 0; (p = o.toUpperCase().indexOf(f, u)) >= 0;)s += o.substring(u, p) + '<span class="VIS-TM-highlight">' + o.substr(p, e) + "<\/span>", u = p + e; o.toUpperCase().indexOf(f, u) == -1 && t(this).find("span").removeClass("VIS-TM-highlight"); u > 0 && (s += o.substring(u), t(this).find("p").html(s)) }) } } function lu() { r.find(".k-state-hover").removeClass("k-state-hover"); r.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode"); r.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode") } function ia(n) { var r, u; t(n.target).hasClass("summNonsumImage") && (t(n.target).parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(n.target).parent().parent().find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), d.removeClass("vis-tm-delete"), r = i.find("input").length, u = i.find("input:checked").length, r == u && g.prop("checked", !0)); t(n.target).hasClass("VIS-tm-MLi") && (t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(this).find("li").find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), d.removeClass("vis-tm-delete"), g.prop("checked", !1), r = i.find("input").length, u = i.find("input:checked").length, r == u && g.prop("checked", !0)); t(n.target).hasClass("VIS-tm-checkbox") && (t(n.target).parent().find("input").prop("checked") ? (t(n.target).parent().addClass("vis-tm-menuselectedcolor"), d.removeClass("vis-tm-delete"), r = i.find("input").length, u = i.find("input:checked").length, r == u && g.prop("checked", !0)) : (t(n.target).parent().removeClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"), g.prop("checked", !1), i.find("input:checked").length > 0 ? d.removeClass("vis-tm-delete") : d.addClass("vis-tm-delete"))) } function he(n) { rr = n; var t = u.find("input:checked").length, i = u.find("[disabled]").length, r = u.find("input").length, f = r - i; t == f ? n != "disabled" && ft.prop("checked", !0) : ft.prop("checked", !1) } function cf() { } function ra(s) { var p, l, a, c; if (rr = s, p = u, f[0].style.visibility = "visible", u.find("input:checked").length > 1 && ht.empty(), t(s.target).hasClass("VIS-Tm-glyphiconglyphicon-link")) { wt = []; l = t(s.target).parent(); a = t(s.target).parent().attr("id"); wt.push(a); wt = wt.toString(); window.setTimeout(function () { rr = s }, 200); ni == "false" ? t.inArray(parseInt(a), hi) < 0 ? lh(e, wt, l) : (n.ADialog.info("NeverDelete", !0, tu), f[0].style.visibility = "hidden") : lh(e, wt, l); return } if (t(s.target).hasClass("vis-tm-textli") && (t(this).find("input").prop("checked", !1), t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"), t(t(s.target).parent().parent()).find("input").prop("checked", !0), ci = t(t(s.target).parent().parent()).find("img").attr("src"), s.target.id = t(s.target).attr("id"), t(s.target).parent().parent().find("input").attr("disabled") == "disabled" && t(t(s.target).parent().parent()).find("input").prop("checked", !1), ft.prop("checked", !1), he(t(s.target).parent().parent().find("input").attr("disabled")), ku && cf(t(s.target).parent().parent())), t(s.target).hasClass("vis-tm-upperLi") && (t(s.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).addClass("vis-tm-menuselectedcolor"), t(s.target).parent().find("input").prop("checked", !1), t(s.target).find("input").prop("checked", !0), ci = t(s.target).find("img").attr("src"), s.target.id = t(s.target).find(".vis-tm-textli").attr("id"), t(s.target).find("input").attr("disabled") == "disabled" && t(s.target).find("input").prop("checked", !1), ft.prop("checked", !1), he(t(s.target).find("input").attr("disabled")), ku && cf(t(s.target))), t(s.target).hasClass("vis-tm-upperdivchkandimg") && (t(s.target).parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).parent().addClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().find("input").prop("checked", !1), t(s.target).find("input").prop("checked", !0), ci = t(s.target).find("img").attr("src"), s.target.id = t(s.target).parent().find(".vis-tm-textli").attr("id"), t(s.target).find("input").attr("disabled") == "disabled" && t(s.target).find("input").prop("checked", !1), ft.prop("checked", !1), he(t(s.target).find("input").attr("disabled")), ku && cf(t(s.target).parent().parent())), t(s.target).hasClass("vis-tm-chkbox")) { if (f[0].style.visibility = "visible", t(s.target).attr("disabled") != "disabled") if (t(s.target).prop("checked")) { for (t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"), s.target.id = s.target.id = t(s.target).parent().parent().find(".vis-tm-textli").attr("id"), ci = t(s.target).parent().parent().find("img").attr("src"), c = 0; c < u.find(".vis-tm-menuselectedcolor").length; c++)t(u.find(".vis-tm-menuselectedcolor").find("input")[c]).attr("disabled") == "disabled" && t(u.find(".vis-tm-menuselectedcolor").find("input")[c]).parent().parent().removeClass("vis-tm-menuselectedcolor"); var w = u.find("input:checked").length, d = u.find("[disabled]").length, nt = u.find("input").length, tt = nt - d; w == tt ? ft.prop("checked", !0) : ft.prop("checked", !1) } else t(s.target).parent().parent().removeClass("vis-tm-menuselectedcolor"), ci = t(s.target).parent().parent().find("img").attr("src"), s.target.id = 0, ft.prop("checked", !1); f[0].style.visibility = "hidden"; ku && cf(t(s.target).parent().parent()) } t(s.target).hasClass("summNonsumImage") && (t(s.target).parent().parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().parent().find("input").prop("checked", !1), t(s.target).parent().find("input").prop("checked", !0), ci = t(s.target).parent().find("img").attr("src"), s.target.id = t(s.target).parent().parent().find(".vis-tm-textli").attr("id"), t(s.target).parent().find("input").attr("disabled") == "disabled" && t(s.target).parent().find("input").prop("checked", !1), ft.prop("checked", !1), he(t(s.target).parent().find("input").attr("disabled")), ku && cf(t(s.target).parent())); (s.target.id == "" || s.target.id == "undefined") && (s.target.id = t(s.target).find(".vis-tm-menuselectedcolor").find("li").attr("id")); u.find(".vis-tm-menuselectedcolor").length == 1 && u.find(".vis-tm-menuselectedcolor").find("li").hasClass("vis-tm-opacity") && s.target.id != "" ? t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/GetNodePath", type: "Post", data: { node_ID: s.target.id, treeID: e }, success: function (c) { var d, rt, p, w, tt, nt, l, a; ft.prop("checked", !1); d = JSON.parse(c); d = d.replaceAll("\\\\", " \\ "); ht.empty(); ht.append(n.Utility.encodeText(d)); vi.is(":checked") && (g.prop("checked", !1), rt = t(s.target).parent().parent().find("li").attr("id"), p = t(s.target).parent().parent().find("img").attr("src"), p = p.substring(p.lastIndexOf("/") + 1), p == "summary.png" && (w = t(s.target).text(), w = w.substring(0, w.lastIndexOf("(")), ti.text(w), hf = -1), ci.lastIndexOf("/"), ci = ci.substring(ci.lastIndexOf("/") + 1), ci != "mWindow.png" && ci != "folder.png" && (it.is(":checked") ? vi.is(":checked") && (f[0].style.visibility = "visible", ci != "nonSummary.png" ? b.data("kendoTreeView").expand(".k-item") : (kr(), tt = "Select parent_id from " + di + " where node_id=" + s.target.id + " AND isactive='Y' and VAF_TreeInfo_id=" + e + "", nt = k(tt, null, null), nt != null && nt.tables[0].rows.length > 0 && (l = nt.tables[0].rows[0].cells.parent_id, l == null && (l = 0), hf != l && (b.data("kendoTreeView").expand(".k-item"), window.setTimeout(function () { t(r.find(".k-state-selected")).removeClass("k-state-selected"); t(r.find("div").find("div[data-nodeid='" + l + "']").parent()).addClass("k-state-selected")[0].scrollIntoView(); var n = t(r.find(".k-state-selected")).text(); ti.text(n); hf = l; lu() }, 200), i.empty(), ut = 1, et = 50, v = o.val(), h = y.is(":checked") ? "true" : "false", ki(l, e, ut, et, v, h, s), hf = l))), f[0].style.visibility = "hidden") : b.data("kendoTreeView").expand(".k-item")), t(r.find("div").find("div[data-nodeid='" + s.target.id + "']").parent()).addClass("k-state-selected").length != 0 ? (t(r.find(".k-state-selected")).removeClass("k-state-selected"), t(r.find(".k-state-focused")).removeClass("k-state-focused"), window.setTimeout(function () { t(r.find("div").find("div[data-nodeid='" + s.target.id + "']").parent()).addClass("k-state-selected")[0].scrollIntoView(); lu() }, 200), i.empty(), ut = 1, et = 50, v = o.val(), h = y.is(":checked") ? "true" : "false", ki(s.target.id, e, ut, et, v, h, s)) : u.find(".vis-tm-menuselectedcolor").length == 1 && (a = u.find(".vis-tm-menuselectedcolor").find("img").attr("src"), a = a.substring(a.lastIndexOf("/") + 1), a != "nonSummary.png" && a != "summary.png" && ht.empty())); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) : ht.empty(); f[0].style.visibility = "hidden" } function ch(n) { var i = r.find("div").find("div[data-nodeid='" + n + "']").parent().parent().parent(); i.children("ul").length > 0 && (bu = t(t(i.children("ul")[0]).find("ul")[0]).length > 0 ? t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).length > 0 ? t(t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).length > 0 ? t(t(t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).length > 0 ? !0 : !1 : !1 : !1 : !1) } function lh(e, o) { var s, c, h, a, l; f[0].style.visibility = "visible"; s = "SELECT vaf_tableview_id FROM VAF_TreeInfo WHERE VAF_TreeInfo_id=" + e; s = k(s, null, null); s.tables[0].rows.length > 0 && (s = s.tables[0].rows[0].cells.vaf_tableview_id); c = " SELECT treetype FROM VAF_TreeInfo WHERE VAF_TreeInfo_id=" + e; c = k(c, null, null); treeType = c.tables[0].rows[0].cells.treetype; h = ""; h = treeType == "PR" ? "VAF_TreeInfoChildProd" : treeType == "BP" ? "VAF_TreeInfoChildBPart" : treeType == "MM" ? "VAF_TreeInfoChildMenu" : "VAF_TreeInfoChild"; a = "Select node_id from " + h + " where parent_id=" + o + " AND isactive='Y' and VAF_TreeInfo_id=" + e + ""; l = k(a, null, null); l != null && l.tables[0].rows.length > 0 ? n.ADialog.confirm("ChildAlsoWillbeRemove", !0, "", "Confirm", function (s) { if (s) o = o.toString(), ef(h, o, e), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromBottom", type: "Post", data: { nodeid: o, treeID: e, menuArray: yi }, success: function (e) { var w = JSON.parse(e), c, v, a, h; if (w == "") { for (i.find("input:checked").length == 0 && g.prop("checked", !1), ht.empty(), c = u.find("li").find("li[data-id='" + o + "']").parent().parent(), c.find("input").prop("disabled", !1), c.find("i").removeClass("vis-tm-opacity"), c.find(".vis-tm-textli").removeClass("vis-tm-opacity"), c.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"), c.find("input").css("cursor", "pointer"), c.hasClass("vis-tm-menuselectedcolor") && (ht.empty(), c.find("input").prop("checked", !0)), ni == "false" && uh(), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + o + "']").parent().parent().parent()), i.find("li").find("li[data-id='" + o + "']").parent().remove(), v = 0; v < rt.length; v++)if (a = rt[v], i.find("li").find("li[data-id='" + a + "']").parent().remove(), ni != "false" || !(t.inArray(parseInt(a), hi) >= 0)) { h = u.find("li").find("li[data-id='" + a + "']").parent().parent(); h.find("input").prop("disabled", !1); h.find("i").removeClass("vis-tm-opacity"); h.find(".vis-tm-textli").removeClass("vis-tm-opacity"); h.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); h.find("input").css("cursor", "pointer"); h.hasClass("vis-tm-menuselectedcolor") && (ht.empty(), h.find("input").prop("checked", !0)); nt.val() == "Linked" && h.remove(); var y = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), p.attr("src", l)) } var y = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "folder.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "mWindow.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png"), p.attr("src", l)); i.find("li").length != 0 || r.find("span").hasClass("k-state-selected") || ti.text(n.Msg.getMsg("SelectTree")); uf() } ir(); ne(); ou(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }); else { f[0].style.visibility = "hidden"; return } }) : (o = o.toString(), ef(h, o, e), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromBottom", type: "Post", data: { nodeid: o, treeID: e, menuArray: yi }, success: function (e) { var w = JSON.parse(e), h, v, a, c; if (w == "") { for (ht.empty(), h = u.find("li").find("li[data-id='" + o + "']").parent().parent(), h.find("input").prop("disabled", !1), h.find("i").removeClass("vis-tm-opacity"), h.find(".vis-tm-textli").removeClass("vis-tm-opacity"), h.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"), h.find("input").css("cursor", "pointer"), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + o + "']").parent().parent().parent()), i.find("li").find("li[data-id='" + o + "']").parent().remove(), v = 0; v < rt.length; v++)if (a = rt[v], ni != "false" || !(t.inArray(parseInt(a), hi) >= 0)) { c = u.find("li").find("li[data-id='" + a + "']").parent().parent(); c.find("input").prop("disabled", !1); c.find("i").removeClass("vis-tm-opacity"); c.find(".vis-tm-textli").removeClass("vis-tm-opacity"); c.removeClass("vis-tm-menuselectedcolor"); nt.val() == "Linked" && c.remove(); var y = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), p.attr("src", l)) } var y = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), p.attr("src", l)); uf() } i.find("li").length != 0 || r.find("span").hasClass("k-state-selected") || ti.text(n.Msg.getMsg("SelectTree")); ir(); ne(); ou(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } })) } function fa() { kr(); var n = "SELECT Count(*) as Count FROM " + di + " WHERE isactive ='Y' AND VAF_TreeInfo_ID=" + e; n = k(n, null, null); n = n.tables[0].rows[0].cells.count; n > 5e3 ? (it.prop("checked", !0), it.prop("disabled", !0), st[0].style.visibility = "hidden", fi = !0, lo = !0, wr.css("display", "inherit"), tt.css("display", "inherit"), c.css("height", "70%"), kt.css("height", "100%"), c.resizable({ handles: "n,s,se" }), c.find(".ui-resizable-e").css("right", "0px"), c.find(".ui-resizable-s").css("bottom", "0px"), kt.addClass("VIS-TM-resizediv"), tt.height(ri.height() - c.height() - 20), bi.css("right", "145px")) : (it.prop("disabled", !1), lo = !1) } function ea() { if (ps = !1, bf = !0, iu = !1, kf = !1, w.val() != "") { oi[0].style.visibility = "visible"; pf.removeClass("vis-tm-opacity"); it.prop("disabled", !1); nr.css("display", "inherit"); nt.prop("disabled", !0); vi.prop("disabled", !1); vi.css("cursor", "pointer"); y.prop("disabled", !1); y.css("cursor", "pointer"); o.prop("disabled", !1); gt.prop("disabled", !1); ft.prop("disabled", !1); ft.css("cursor", "pointer"); dt.addClass("vis-tm-delete"); yt.css("display", "none"); ct.css("display", "inherit"); d.addClass("vis-tm-delete"); fr = !0; lf = !0; u.empty(); i.empty(); at = ""; gt.val(""); o.val(""); ii.css("display", "inherit"); ae = 50; pi = 1; nt.val(t(nt.find("option")[0]).attr("value")); var r = w.find("option:selected").text(); du.text(n.Msg.getMsg("AllItems")); ti.text(r); ei = w.find("option:selected"); bt = ei.attr("data-type"); e = ei.val(); vr = ei.attr("data-isallnodes"); window.setTimeout(function () { nf(bt, e, vr, fi) }, 100); window.setTimeout(function () { u.empty(); vt = "All"; pi = 1; ar(e, bt, at, vt); nu(); fo() }, 200); oa(); it.is(":checked") ? (fi = !0, tt.css("display", "inherit"), c.css("height", "70%"), kt.css("height", "100%"), c.resizable({}), c.find(".ui-resizable-e").css("right", "0px"), c.find(".ui-resizable-s").css("bottom", "0px"), kt.addClass("VIS-TM-resizediv"), tt.height(ri.height() - c.height() - 20), lt.height(ri.height() - (c.height() + br.height() + 40)), wr.css("display", "inherit")) : (wr.css("display", "none"), fi = !1, tt.css("display", "none"), c.css("height", "100%"), kt.css("height", "100%"), c.resizable("destroy"), kt.removeClass("VIS-TM-resizediv"), tt.height(ri.height() - c.height())) } else pf.addClass("vis-tm-opacity"), it.prop("disabled", !0), it.prop("checked", !0), nr.css("display", "none"), e = 0, u.empty(), i.empty(), b.data("kendoTreeView").destroy(), b.empty(), ht.empty(), at = "", gt.val(""), ei = null, d.addClass("vis-tm-delete"), o.val(""), window.setTimeout(function () { u.empty() }, 200), du.text(n.Msg.getMsg("SelectTree")), ti.text(n.Msg.getMsg("SelectTree")), ii.css("display", "none"), dt.addClass("vis-tm-delete"), y.prop("disabled", !0), vi.prop("disabled", !0), y.css("cursor", "not-allowed"), vi.css("cursor", "not-allowed"), o.prop("disabled", !0), gt.prop("disabled", !0), nt.prop("disabled", !0), ft.prop("disabled", !0), ft.css("cursor", "not-allowed"), lr.css("display", "none"), bi.css("display", "none"); vi.prop("checked", !1); ft.prop("checked", !1); y.prop("checked", !1); u.empty(); g.prop("checked", !1); ir() } function oa() { kt.height(c.height() - 10) } function sa(n) { var i = t(n.currentTarget); i[0].scrollHeight - i.scrollTop() == i.outerHeight() && u.find("li").length > 0 && (vt = nt.val(), lf = !1, ye = !0, pi += 1, ar(e, bt, at, vt)) } function ha(n) { w.val() != "" && (i.empty(), it.is(":checked") ? (st[0].style.visibility = "hidden", fi = !0, wr.css("display", "inherit"), tt.css("display", "inherit"), c.css("height", "70%"), kt.css("height", "100%"), c.resizable({ handles: "n,s,se" }), c.find(".ui-resizable-e").css("right", "0px"), c.find(".ui-resizable-s").css("bottom", "0px"), kt.addClass("VIS-TM-resizediv"), ei != null && nf(bt, e, vr, fi), tt.height(ri.height() - c.height() - 20), bi.css("right", "145px")) : (gh(), o.val() != "" && y.prop("checked", !1), bi.css("right", "35px")), yt.css("display", "none"), ct.css("display", "inherit"), ir(), window.setTimeout(function () { o.val() != "" && window.setTimeout(function () { ur(n) }, 200) }, 200), ru = -1, iu = !1) } function ca() { f = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); f[0].style.visibility = "visible"; ce.append(f) } function la() { var n = null; n = t('<div style="position: relative; width: 100%; height: 100%; z-index: -1;">'); st = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); n[0].style.visibility = "visible"; n.append(st); tt.append(n) } function aa() { wi = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); wi[0].style.visibility = "visible"; gu.append(wi) } function va() { oi = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); oi[0].style.visibility = "visible"; c.append(oi) } var s, ot, bi, dt, hr, ri, cr, uo, lr, eu, si, er, wf, bf, tf, ui, rf, di, hu, dr, gr, kf, ec, cu, oc, gf, te, wt, ue, nh, ih, rh, fe, rt, kl, ru, fh, eh, oe, oh, ua, lo, lf; this.frame; this.windowNo; var ya = this, ce = t('<div class="vis-forms-container" style="padding:3px 0 7px;background-color:white;height:100%"/>'), b, fi = !0, ei, bt, e, vr, ao = "", le = 0, vo, ae = 50, pi = 1, l, li = [], uu = [], yr = !0, yo = null, au, pr = 0, f = null, st = null, wi = null, oi = null, fr = !0, vu = !0, yu, po, wo = null, gi = null, at = "", ah = null, bo = !0, v = null, ut = 1, et = 50, ve = 0, pu = 0, af = null, wu = !1, ai = null, bu = !1, vt = "All", ye = !1, sr = !0, ko = n.Application.contextUrl, vh = ko + "JsonData/JDataSet", yh = ko + "JsonData/ExecuteNonQuer", pe = t("<div  class='VIS-TM-left-tree'>"), ph = t("<div  class='VIS-TM-middle'>"), we = t("<div class='VIS-TM-right-slide'>"), be = !1, k = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, go(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, vf = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return go(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, fu = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n, param: i }; return t.ajax({ url: yh + "y", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }; var ke = t('<div class="VIS-TM-data-head" style="padding-top: 8px;">'), ns = t('<div class="VIS-TM-data">'), it = t('<input disabled type="checkbox" checked="true" />'), ts = t("<span>" + n.Msg.getMsg("OnlySummaryLevel") + "<span/>"), is = t("<h4>" + n.Msg.getMsg("SelectTree") + "<\/h4>"), ku = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); ke.append(is).append(ns.append(it).append(ts)); var de = t('<div class="VIS-TM-treeCombo">'), w = t("<select><\/select>"), ge = t('<span style="display:none" class="VIS-Tm-btnicon vis vis-refresh"  title=' + n.Msg.getMsg("RefreshSelectTree") + "><\/span>"), no = t('<span class="VIS-Tm-btnicon vis vis-refresh" style="float:left" title="' + n.Msg.getMsg("tmRefresh") + '"><\/span>'), yt = t('<span class="VIS-Tm-btnicon fa fa-minus-square-o"  style="display:none;" title="' + n.Msg.getMsg("TreeCollapse") + '" ><\/span>'), ct = t('<span class="VIS-Tm-btnicon fa fa-plus-square-o" title="' + n.Msg.getMsg("TreeExpand") + '" ><\/span>'), rs = t("<i class='vis vis-find VIS-Tm-btnicon' title='" + n.Msg.getMsg("CreateNewTree") + "'><\/i>"), nr = t('<div class="vis-tm-treeCmbDisable "><\/div>'); de.append(nr).append(w).append(rs).append(no).append(yt).append(ct); var c = t('<div class="VIS-TM-tree-wrap">'), r = t('<div class="VIS-TM-root-node" style="overflow:visible">'), kt = t('<div class="vis-tm-topTreeDiv">'); c.resizable({ handles: "n,s,se" }); s = t('<div style="z-index:9;width:28px;display:none;text-align:center;float: right; height: 95%; position: absolute; right: 5px;"><\/div>'); ot = t('<span class="VIS-Tm-deletetreenode" style="margin:auto;display:none;position: relative;top: 50%;"><\/span>'); s.append(ot); kt.append(ge).append(s).append(r); c.append(kt); var to = t("<div class='VIS-TM-tree-search'>"), o = t("<input disabled placeholder='" + n.Msg.getMsg("Search") + "' type='search'>"), tr = t('<span class="VIS-Tm-btnicon vis vis-search"><\/span>'), wr = t('<div class="vis-tm-b-s-ryt">'), y = t('<input type="checkbox" disabled>'), wh = t('<label style="font-weight: normal;margin-bottom:0px">' + n.Msg.getMsg("NodeItem") + "<\/label>"); wr.append(y).append(wh); bi = t('<span class="vis-tmlinkdel-icon"><\/span>'); to.append(o).append(bi).append(wr).append(tr); var br = t("<div class='VIS-TM-data-headMID'>"), d = t("<span style='display:inherit;' class='VIS-Tm-unlinkforbottmo vis vis-link ' title='" + n.Msg.getMsg("UnlinkNode") + "' ><\/span>"), ti = t('<h4 style="float:left">' + n.Msg.getMsg("SelectTree") + "<\/h4>"), lt = t("<div class='VIS-TM-dataWrap' style='padding-top:0px' >"), ii = t('<span class="VIS-TM-recordeNotFound">' + n.Msg.getMsg("TMRecordNotFound") + "<\/span>"), i = t('<ul class="vis-tm-sortable" style="list-style: none;padding:0">'), g = t('<input type="checkbox" disabled />'), bh = t('<span class="vis vis-search" style="display:none;cursor:pointer;float:left;margin: 14px 0 0 6px;font-size: 10px;" ><\/span>'); lt.append(i).append(ii); dt = t('<span style="display:inherit;" class="vis-tm-childnodeinidailog" title="' + n.Msg.getMsg("SetOrder") + '">Set Order<\/span>'); dt.addClass("vis-tm-delete"); hr = t('<div style="display:none;position:absolute;height: 40.2px;width: 100%; z-index: 5;"><\/div>'); br.append(hr).append(g).append(ti).append(bh).append(dt).append(d); var io = t("<div class='VIS-TM-data-head'>"), du = t("<h4>" + n.Msg.getMsg("AllItems") + "<\/h4>"), gu = t("<div class='VIS-TM-dataWrap'>"), yf = t("<div class='VIS-TM-treeList'>"), u = t("<ul style='list-style: none' class='scrolldrag' >"), gt = t("<input disabled placeholder='" + n.Msg.getMsg("Search") + "' type='search'>"), us = t('<span class="VIS-Tm-btnicon vis vis-search" style="top:0px;float:none"><\/span>'), fs = t("<div class='VIS-TM-path'>"), ht = t("<i style='font-weight:600'>"), nt = t('<select disabled style="float: right; min-width: 100px"><\/select>'), kh = t('<span style="margin: 0 7px;">' + n.Msg.getMsg("Show") + "<span/>"), vi = t('<input type="checkbox"  style="float:left;margin-right:5px" disabled  />'), dh = t("<span>" + n.Msg.getMsg("TraceItem") + "<span/>"), ft = t('<input type="checkbox" disabled />'), pf = t('<span class="vis-unlinkallNodes vis-tm-opacity" title="' + n.Msg.getMsg("UnlinkItem") + '"  ><b><\/b><b><\/b><b><\/b><\/span>'); io.append(ft).append(du).append(t('<div class="vis-tm-r-list-w">').append(kh).append(nt).append(pf)); var a = t('<div class="vis-tm-nodeItemDeleteliketopdiv"><span class="VIS-Tm-deletetreenode vis-tm-nodeItemDeletespans" ><\/span><\/div>'), tt = t('<div style="float:left;width:100%;">'), ro = t('<div style="z-index:999;height:100%;display:none;position:absolute; left:0; right:0; top:0; bottom:0;"><\/div>'); tt.append(ro).append(br).append(lt).append(a); ri = t('<div class="VIS-TM-leftMianDataDiv">'); ri.append(c).append(tt); cr = t('<div style="display:none;height: 100%; width: 100%; position: absolute;z-index: 9999;"><\/div>'); pe.append(cr).append(t('<div style="height:100%;" >').append(ke).append(de).append(ri).append(to)); uo = t('<div class="VIS-TM-Righttree-search" >'); lr = t('<span class="vis-tmlinkdel-icon"><\/span>'); uo.append(gt).append(lr).append(us); eu = t('<span class="VIS-TM-recordeNotFound" style="margin-top:50%" >' + n.Msg.getMsg("TMRecordNotFound") + "<\/span>"); si = t('<div style="z-index:999;height:100%;display:none;position:absolute; left:0; right:0; top:0; bottom:0;"><\/div>'); gu.append(si).append(uo).append(yf.append(u).append(eu)).append(fs.append(ht)); we.append(t('<div  style="height:100%">').append(io).append(gu)); ce.append(pe).append(we); er = !1; wf = !0; bf = !0; var or = null, ss = null, hs = t('<div class="vis-tm-unlinkimgss">'); tf = 0; ui = !1; var su = null; rf = null; di = null; hu = []; dr = !1; gr = null; kf = null; ec = !0; cu = !0; oc = null; var h = !1, ps = !1, df = !1; var yi = [], ni = "true", hi = null, tu = null; gf = null; te = !0; var ie = 1, oo = 50, iu = !1, so = 0; var pt = t("<ul style='padding:0;list-style: none'>"), bs = t("<div>"), ks = t('<div style="padding: 10px;height:425px;overflow:auto">'); var gs = null, tl = null, re = !0; var el = 0, ol = 0, sl = 0; wt = []; ue = null; nh = null; ih = !0; rh = null; fe = ""; rt = []; kl = 0; ru = -1; oh = !0; var of = [], sf = [], rr = null, co = !0, se = null; var ci = null, hf = -1; ua = !0; lo = null; lf = !0; this.Initialize = function () { ca(); aa(); va(); la(); es(); sc(); window.setTimeout(function () { f[0].style.visibility = "hidden" }, 200); f[0].style.visibility = "visible"; wi[0].style.visibility = "hidden"; oi[0].style.visibility = "hidden"; st[0].style.visibility = "hidden" }; this.disposeComponent = function () { b = null; fi = null; ei = null; bt = null; e = null; vr = null; ao = null; le = null; vo = null; ae = null; pi = null; l = null; li = null; yr = null; au = null; pr = null; f = null; yu = null; po = null; pe = null; ph = null; we = null; ke = null; ns = null; it = null; ts = null; is = null; de = null; w = null; ge = null; no = null; c = null; r = null; to = null; o = null; tr = null; br = null; ti = null; lt = null; ii = null; i = null; io = null; du = null; gu = null; yf = null; u = null; fs = null; ht = null }; this.getRoot = function () { return window.kendo == undefined || window.kendo == null ? t('<div><p style="text-align: center;line-height: 600px;">' + n.Msg.getMsg("PleaseInstallKendoUIModule") + "<\/p><\/div>") : (window.setTimeout(function () { d.addClass("vis-tm-delete"); c.find(".ui-resizable-n").css("display", "none") }, 200), f[0].style.visibility = "visible", ce) }; this.formSizeChanged = function () { tt.height(ri.height() - c.height() - 20); lt.height(tt.height()); tt.css("overflow", "hidden") }; this.sizeChanged = function (n, t) { this.formSizeChanged(n, t) } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.sizeChanged = function (n, t) { this.formSizeChanged(n, t) }; i.prototype.refresh = function () { this.formSizeChanged() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VTreeMaintenance = i }(VIS, jQuery), function (n, t) { function i(i, r) { function l() { } function a(t, i, r, u) { s.filter("p#forreportcreate").text(n.Msg.getMsg("Generating" + u + "File")); h.filter("p#forreportdownload").text(n.Msg.getMsg("Downloading" + u + "File")) } var u, f; this.onClose = null; var e = t("<div><\/div>"), o = t('<div style="overflow-y:auto;margin-bottom:15px"><\/div>'), s = t('<p id="forreportcreate"><\/p><div class="vis-ui-progress-bar hide" id="reportcreate"><div class="progress-bar vis-ui-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><\/div><\/div><br /><p class="hide" id="reportcreateresult"><\/p> <div style="margin-bottom: 15px;"><\/div>'), h = t('<p id="forreportdownload" class="hide"><\/p><div class="vis-ui-progress-bar hide" id="reportdownload"><div class="progress-bar vis-ui-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><\/div><\/div><br /><p class="hide" id="reportdownloadresult"><\/p>'), c = t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"); e.append(c).append(s).append(h); this.winNo = i; u = null; this.prop = { WindowNo: i }; a(o, i, this.prop, r); f = this; this.show = function () { u = new n.ChildDialog; u.setContent(e); u.setHeight(450); u.setWidth(650); u.setTitle(n.Msg.getMsg("Reports")); u.setModal(!0); u.onClose = function () { f.onClose && f.onClose(); f.dispose() }; u.show(); l(); u.hidebuttons() }; this.onClose = function () { u.close() }; this.setBulkBusy = function (n) { c.css("display", n ? "block" : "none") }; this.dispose = function () { this.prop = null; o = null; e = null; u = null; f = null; this.setBulkBusy(!1) } } n.BulkDownload = i }(VIS, jQuery), function (n, t) { function i() { function et() { c = t('<div class="Page-content" style="height:100%;background-color:white;">'); e = t(' <div class="formLeft" style="background-color: rgb(241, 241, 241);display: inline-block; float: left;width:23%;height:87.8%;overflow:auto;padding-left: 7px;">'); r = t('<div class="VIS_formDataRow">'); u = t("<div id=PCont_Name_" + i.windowNo + ' class="VIS_formData">'); k = t("<label>" + n.Msg.translate(n.Env.getCtx(), "Name") + "<\/label><br>"); d = t("<input type=text id=containerName_" + i.windowNo + " ><\/input>"); u.append(k).append(d); r.append(u); e.append(r); r = t('<div class="VIS_formDataRow">'); u = t("<div id=PCont_WarehouseSearch_" + i.windowNo + ' class="VIS_formData" style="margin-top:20px">'); g = t("<label>" + n.Msg.translate(n.Env.getCtx(), "VAM_Warehouse_ID") + "<\/label><br>"); u.append(g); r.append(u); e.append(r); r = t('<div class="VIS_formDataRow">'); u = t("<div id=PCont_LocatorSearch_" + i.windowNo + ' class="VIS_formData" style="margin-top:20px">'); tt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "VAM_Locator_ID") + "<\/label><br>"); u.append(tt).append(o); r.append(u); e.append(r); r = t('<div class="VIS_formDataRow">'); u = t('<div class="VIS_formData">'); v = t('<input type=button id="PCont_btnSearch_' + i.windowNo + ' class="#" style="margin-top:20px;width: 100px;" value = ' + n.Msg.getMsg("Search") + "><\/input>"); u.append(v); r.append(u); e.append(r); l = t(' <div class="formRight" style="display: inline-block; float: left; width: 75%; height: 87.8%; margin-left: 10px;">'); p = t('<div style="display: inline-block; float: left; width: 75%; height: 87.8%; margin-left: 10px;">'); a = t("<div>"); y = t('<input type=button id="PCont_OK_' + i.windowNo + ' style="margin-top:20px;width: 100px;" value = ' + n.Msg.getMsg("OK") + "><\/input>"); a.append(y); l.append(p).append(a); c.append(e).append(l); f.append(c).append(b) } function ot() { h = f.find("#PCont_WarehouseSearch_" + i.windowNo); st(); o = f.find("#PCont_LocatorSearch_" + i.windowNo); ht(); var t = f.find("#containerName_" + i.windowNo)[0].value; w(t, $ReqControlWarehouse.value, $ReqControlLocator.value); v.on("click", function () { var n = f.find("#containerName_" + i.windowNo)[0].value; w(n, $ReqControlWarehouse.value, $ReqControlLocator.value) }); y.on("click", function () { var t = n.context.getWindowTabContext(i.windowNo, 1, "KeyColumnName"), r = 0; if (t.length > 0) r = n.context.getWindowContext(i.windowNo, t, !0); else { w2alert(n.Msg.getMsg("VIS_TableNotFound")); return } r > 0 && $selectedContainerId > 0 ? lt(t, r, $selectedContainerId) : w2alert(n.Msg.getMsg("VIS_RecordNotSelected")) }) } function st() { nt = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 3798, n.DisplayType.Search, "VAM_Warehouse_ID", 0, !1, null); this.$ReqControlWarehouse = new n.Controls.VTextBoxButton("VAM_Warehouse_ID", !0, !0, !0, n.DisplayType.Search, nt); this.$ReqControlWarehouse.getControl().css("width", "55%"); this.$ReqControlWarehouse.getBtn(0).css("height", "29px"); this.$ReqControlWarehouse.getBtn(0).css("margin-top", "-1px"); this.$ReqControlWarehouse.getBtn(0).css("width", "14%"); this.$ReqControlWarehouse.getBtn(1).css("height", "29px"); this.$ReqControlWarehouse.getBtn(1).css("margin-top", "-1px"); this.$ReqControlWarehouse.getBtn(1).css("width", "14%"); h.append(this.$ReqControlWarehouse.getControl()); h.append(this.$ReqControlWarehouse.getBtn(0)); h.append(this.$ReqControlWarehouse.getBtn(1)); var t = ut(i.windowNo, "VAM_Warehouse_ID"); $ReqControlWarehouse.setValue(t) } function ht() { it = new n.MLocatorLookup(n.Env.getCtx(), i.windowNo); this.$ReqControlLocator = new n.Controls.VLocator("VAM_Locator_ID", !0, !0, !0, n.DisplayType.Locator, it); this.$ReqControlLocator.getControl().css("width", "55%"); this.$ReqControlLocator.getBtn(0).css("height", "29px"); this.$ReqControlLocator.getBtn(0).css("margin-top", "-1px"); this.$ReqControlLocator.getBtn(0).css("width", "14%"); this.$ReqControlLocator.getBtn(1).css("height", "29px"); this.$ReqControlLocator.getBtn(1).css("margin-top", "-1px"); this.$ReqControlLocator.getBtn(1).css("width", "14%"); o.append(this.$ReqControlLocator.getControl()); o.append(this.$ReqControlLocator.getBtn(0)); o.append(this.$ReqControlLocator.getBtn(1)); var t = ut(i.windowNo, "VAM_Locator_ID"); $ReqControlLocator.setValue(t) } function ut(t, i) { return n.context.getWindowContext(t, i, !1) } function w(i, r, u) { t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/ProductContainer", data: { Name: i, WarehouseId: r, LocatorId: u }, dataType: "json", success: function (n) { var t = JSON.parse(n); t ? ct(t) : w2ui[s].clear() }, error: function (n) { console.log(n) } }) } function ct(t) { var u = [], f = [], i, r; for (u.push({ field: "ContainerName", caption: n.Msg.getMsg("ContainerName"), size: "15%" }), u.push({ field: "Width", caption: n.Msg.getMsg("Width"), size: "15%" }), u.push({ field: "Height", caption: n.Msg.getMsg("Height"), size: "15%" }), u.push({ field: "ParentPath", caption: n.Msg.getMsg("ParentPath"), size: "22%" }), u.push({ field: "VAM_ProductContainer_ID", caption: n.Msg.getMsg("VAM_ProductContainer_ID"), hidden: !0 }), u.push({ field: "Ref_M_Container_ID", caption: n.Msg.getMsg("Ref_M_Container_ID"), hidden: !0 }), i = 0; i < t.length; i++)r = {}, r.VAM_ProductContainer_ID = t[i].VAM_ProductContainer_ID, r.Ref_M_Container_ID = t[i].Ref_M_Container_ID, r.ContainerName = t[i].ContainerName, r.ParentPath = t[i].ParentPath, r.Width = t[i].Width, r.Height = t[i].Height, r.recid = i + 1, f[i] = r; s = "PCont_gridContainer" + Math.random(); s = s.replace(".", ""); w2utils.encodeTags(f); rt = p.w2grid({ name: s, recordHeight: 20, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !0, selectColumn: !1, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: u, records: f, onClick: function (n) { $selectedContainerId = rt.get(n.recid).VAM_ProductContainer_ID } }) } function lt(r, u, e) { t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/UpdateProductContainer", data: { TableName: r, RecordId: u, ContainerId: e }, dataType: "json", success: function (t) { var u = JSON.parse(t), r; u ? (w2alert(n.Msg.getMsg("VIS_UpdatedSuccess")), r = f.find("#containerName_" + i.windowNo)[0].value, w(r, $ReqControlWarehouse.value, $ReqControlLocator.value)) : w2alert(n.Msg.getMsg("VIS_NotUpdated")) }, error: function (n) { console.log(n) } }) } function ft(n) { b[0].style.visibility = n } this.frame; this.windowNo; var i = this, f = t("<div style='height:100%;background-color:white;' >"), b = t("<div class='vis-apanel-busy' style='height:100%;position:relative;z-index: 2'>"), c = null, r = null, e = null, l = null, u = null, a = null, k = null, d = null, g = null, h = null, nt = null; this.$ReqControlWarehouse = null; var tt = null, o = null, it = null; this.$ReqControlLocator = null; var v = null, y = null, p = null, rt = null, s = null; this.$selectedContainerId = null; this.Initialize = function () { ft("visible"); et(); ot(); ft("hidden") }; this.getRoot = function () { return f }; this.formSizeChanged = function () { }; this.sizeChanged = function () { }; disposeComponent = function () { this.$ReqControlWarehouse = null; this.$ReqControlLocator = null; this.$selectedContainerId = null } } n.AForms = n.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; var i = this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.formSizeChanged() }; i.prototype.sizeChanged = function (n, t) { this.formSizeChanged(n, t) }; i.prototype.refresh = function () { this.formSizeChanged() }; i.prototype.dispose = function () { disposeComponent(); this.frame = null }; n.AForms.productContainer = i }(VIS, jQuery), function (n, t) { function i() { function pi() { var v, s, p, r, k; tt = t('<div class="VIS_main-wrap">'); b = t('<div class="VIS_form-wrap">'); c = t('<div class="VIS_form-row">'); h = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); lt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "VAM_Warehouse_ID") + "<\/label>"); w = t('<select disabled class="vis-ev-col-readonly">'); h.append(r); r.append(w).append(lt); l = t('<div class="VIS_form-col input-group vis-input-wrap">'); s = t('<div class="vis-control-wrap">'); at = t("<label>" + n.Msg.translate(n.Env.getCtx(), "VAM_WarehouseTo_ID") + "<\/label>"); o = t("<select>"); l.append(s); s.append(o).append(at); c.append(h).append(l); b.append(c); c = t('<div class="VIS_form-row">'); h = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); vt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "VAM_Locator_ID") + "<\/label>"); u = t("<select>"); h.append(r); r.append(u).append(vt); l = t('<div class="VIS_form-col input-group vis-input-wrap">'); s = t('<div class="vis-control-wrap">'); yt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "VAM_LocatorTo_ID") + "<\/label>"); e = t("<select>"); l.append(s); s.append(e).append(yt); c.append(h).append(l); b.append(c); c = t('<div class="VIS_form-row">'); h = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); v = t('<div class="input-group-append">'); pt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "VIS_FromContainer") + "<\/label>"); f = t('<select disabled class="VIS-container-move-combo-width" class="vis-ev-col-readonly" data-hasbtn=" ">'); d = t('<span class="fa fa-cubes input-group-text VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled"><\/span>'); h.append(r); r.append(f).append(pt); h.append(v); v.append(d); l = t('<div class="VIS_form-col input-group vis-input-wrap">'); s = t('<div class="vis-control-wrap">'); p = t('<div class="input-group-append">'); wt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "Ref_VAM_ProductContainerTo_ID") + "<\/label>"); i = t('<select disabled class="VIS-container-move-combo-width" class="vis-ev-col-readonly" data-hasbtn=" ">'); $btnToContainerTree = t('<span class="fa fa-cubes input-group-text VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled"><\/span>'); l.append(s); s.append(i).append(wt); l.append(p); p.append($btnToContainerTree); c.append(h).append(l); b.append(c); c = t('<div class="VIS_form-row">'); h = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); a = t('<label class="vis-ec-col-lblchkbox" title=' + n.Msg.translate(n.Env.getCtx(), "VIS_MoveFullContainerToolTip") + '><input type="checkbox" name="">' + n.Msg.translate(n.Env.getCtx(), "VIS_MoveFullContainer") + "<\/label>"); h.append(r); r.append(a); it = t('<div class="VIS_form-col input-group vis-input-wrap">'); k = t('<div class="vis-control-wrap">'); y = t("<label title=" + n.Msg.translate(n.Env.getCtx(), "VIS_WithoutContainerToolTip") + '><input type="checkbox" name="WithoutContainer">' + n.Msg.translate(n.Env.getCtx(), "VIS_WithoutContainer") + "<\/label>"); it.append(k); k.append(y); c.append(h).append(it); b.append(c); rt = t(' <div class="VIS_outer-table-wrap">'); ut = t('<div class="VIS_outer-table-wrap">'); rt.append(ut); ft = t('<div class="VIS_buttons-wrap">'); bt = t('<div class="pull-left" style="display: none;"><label>' + n.Msg.translate(n.Env.getCtx(), "VIS_ContainerGridInfo") + "<\/label><\/div>"); nt = t('<div class="pull-right">'); et = t('<span class="btn">' + n.Msg.translate(n.Env.getCtx(), "VIS_OK") + "<\/span>"); wi(nt); nt.append(et); ft.append(bt).append(nt); tt.append(b).append(rt).append(ft); ct.append(tt).append(ni) } function wi(i) { ulPaging = t('<ul style="float:left;margin-top:4px" class="vis-statusbar-ul">'); liFirstPage = t('<li style="display: none; "><div><i class="vis vis-shiftleft" title="' + n.Msg.translate(n.Env.getCtx(), "FirstPage") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); liPrevPage = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.translate(n.Env.getCtx(), "PageUp") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); cmbPage = t("<select>"); liCurrPage = t("<li>").append(cmbPage); liNextPage = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.translate(n.Env.getCtx(), "PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); liLastPage = t('<li style="display: none;"><div><i class="vis vis-shiftright" title="' + n.Msg.translate(n.Env.getCtx(), "LastPage") + '" style="opacity: 0.6;"><\/div><\/li>'); ulPaging.append(liFirstPage).append(liPrevPage).append(liCurrPage).append(liNextPage).append(liLastPage); i.append(ulPaging) } function bi() { liPrevPage.on("click", function (n) { n.preventDefault(); t(this).css("opacity") == "1" && (r("visible"), g(ht, !0, -1)) }); liNextPage.on("click", function (n) { n.preventDefault(); t(this).css("opacity") == "1" && (r("visible"), g(ht, !0, 1)) }); cmbPage.on("change", function (n) { n.preventDefault(); r("visible"); g(ht, !0, 0) }) } function ki(n, t) { cmbPage.val(n); t > 0 ? (t > n ? liNextPage.css("opacity", "1") : liNextPage.css("opacity", "0.6"), n > 1 ? liPrevPage.css("opacity", "1") : liPrevPage.css("opacity", "0.6"), t == 1 && (liPrevPage.css("opacity", "0.6"), liNextPage.css("opacity", "0.6"))) : (liPrevPage.css("opacity", "0.6"), liNextPage.css("opacity", "0.6")); r("hidden") } function di() { gi(); nr(); tr(); ii(); u.on("change", function () { r("visible"); f.empty(); u.val() == "0" ? d.addClass("VIS_Tree-Container-disabled") : d.removeClass("VIS_Tree-Container-disabled"); window.setTimeout(function () { g(0, !1, 0) }, 20); r("hidden") }); o.on("change", function () { r("visible"); i.empty(); ii(); r("hidden") }); e.on("change", function () { r("visible"); i.empty(); e.val() == "0" ? $btnToContainerTree.addClass("VIS_Tree-Container-disabled") : $btnToContainerTree.removeClass("VIS_Tree-Container-disabled"); r("hidden") }); g(0, !1, 0); et.on("click", function () { if (o.val() == "0") return n.ADialog.error("VIS_ToWarehouseNotSelected", !0, "", ""), !1; if (u.val() == "0") return n.ADialog.error("VIS_FromLocatorNotSelected", !0, "", ""), !1; if (e.val() == "0") return n.ADialog.error("VIS_ToLocatorNotSelected", !0, "", ""), !1; if (f.val() == null && i.val() == null) return n.ADialog.error("VIS_SelectContainer", !0, "", ""), !1; var t = p.length; if (t == 0 && !y.is(":checked") && !a.is(":checked")) return n.ADialog.error("VIS_MoveQtyNotSelected", !0, "", ""), !1; a.is(":checked") ? n.ADialog.confirm("VIS_DoYouWantToDeleteManualCL", !0, "", "Confirm", function (n) { if (n) r("visible"), ri(), r("hidden"); else return !1 }) : (r("visible"), ri(), r("hidden")) }); d.on("click", function () { if (!d.hasClass("VIS_Tree-Container-disabled")) { var i = w.val() == "0" || w.val() == null ? 0 : parseInt(w.val()), r = u.val() == "0" || u.val() == null ? 0 : parseInt(u.val()), t = new n.productContainerTree(i, r, null, null); t != null && (t.showDialog(), t.onClosing = function (n, t) { ht = n; n > 0 && bt.css("display", "block"); f.empty(); f.append(" <option value=" + n + "  selected>" + t + "<\/option>"); p = []; g(n, !1, 0) }); t = null } }); $btnToContainerTree.on("click", function () { if (!$btnToContainerTree.hasClass("VIS_Tree-Container-disabled")) { var r = o.val() == "0" || o.val() == null ? 0 : parseInt(o.val()), u = e.val() == "0" || e.val() == null ? 0 : parseInt(e.val()), t = new n.productContainerTree(r, u, null, null); t != null && (t.showDialog(), t.onClosing = function (n, t) { i.empty(); i.append(" <option value=" + n + "  selected>" + t + "<\/option>") }); t = null } }); a.change(function () { this.checked ? (w2ui[grdname].lock(""), t(this).prop("checked", !0), y.prop("checked", !1)) : (w2ui[grdname].unlock(""), t(this).prop("checked", !1)) }); y.change(function () { this.checked ? (w2ui[grdname].lock(""), t(this).prop("checked", !0), a.prop("checked", !1)) : (w2ui[grdname].unlock(""), t(this).prop("checked", !1)) }); bi() } function gi() { var i = n.context.getWindowContext(v.windowNo, "DTD001_MWarehouseSource_ID", !0); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadWarehouse", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), w.append(" <option value=" + key + ">" + value + "<\/option>"); w.prop("selectedIndex", 0) }, error: function (n) { r("hidden"); console.log(n) } }) } function nr() { var i = n.context.getWindowContext(v.windowNo, "DTD001_MWarehouseSource_ID", !0); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadLocator", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (u.empty(), u.append("<option value= 0 >Select<\/option>"), i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), u.append(" <option value=" + key + ">" + value + "<\/option>"); else u.append("<option value= 0 >Select<\/option>"); u.prop("selectedIndex", 0) }, error: function (n) { r("hidden"); console.log(n) } }) } function tr() { var i = n.context.getWindowContext(v.windowNo, "VAM_Warehouse_ID", !0); i == "" && (i = 0); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadWarehouse", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (o.append("<option value= 0 >Select<\/option>"), i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), o.append(" <option value=" + key + ">" + value + "<\/option>"); else o.append("<option value= 0 >Select<\/option>"); o.prop("selectedIndex", 0) }, error: function (n) { r("hidden"); console.log(n) } }) } function ii() { var i = o.val() == "0" || o.val() == null ? 0 : parseInt(o.val()); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadLocator", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (e.empty(), e.append("<option value= 0 >Select<\/option>"), i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), e.append(" <option value=" + key + ">" + value + "<\/option>"); else e.append("<option value= 0 >Select<\/option>"); e.prop("selectedIndex", 0) }, error: function (n) { r("hidden"); console.log(n) } }) } function g(i, f, e) { s = 1; k = 1; st = 0; dt = !1; var o = parseInt(n.context.getWindowContext(v.windowNo, "VAF_Org_ID", !0)), h = n.context.getWindowContext(v.windowNo, "MovementDate", !0), c = u.val() == "0" || u.val() == null ? 0 : parseInt(u.val()); f && (s = parseInt(cmbPage.val()), e != 0 && (e == -1 ? (s = s - 1, s < 1 && (s = 1)) : e == 1 && (s = s + 1, s > gt && (s = gt)))); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/MoveContainer", data: { container: i, movementDate: h, VAF_Org_ID: o, locator: c, page: s, size: kt }, dataType: "json", success: function (n) { var u = JSON.parse(n), i; if (u) { if (s == 1 && u.length > 0 && (st = u[0].ContainerRecord, k = Math.ceil(st / kt)), ir(u), f) ot = s, cmbPage.val(ot), ot > 1 ? liPrevPage.css("opacity", "1") : liPrevPage.css("opacity", "0.6"), r("hidden"); else { if (gt = k, liCurrPage.find("option").remove(), k > 0) for (i = 0; i < k; i++)cmbPage.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); ki(ot, k); cmbPage.val(s) } dt = !0 } }, error: function (n) { r("hidden"); console.log(n) } }) } function ir(i) { var f = [], e = [], r, u, o; for (f.push({ field: "ProductName", caption: n.Msg.translate(n.Env.getCtx(), "ProductName"), size: "20%" }), f.push({ field: "ASI", caption: n.Msg.translate(n.Env.getCtx(), "ASI"), size: "15%" }), f.push({ field: "UomName", caption: n.Msg.translate(n.Env.getCtx(), "UomName"), size: "15%" }), f.push({ field: "ContainerQty", caption: n.Msg.translate(n.Env.getCtx(), "ContainerQty"), size: "10%" }), f.push({ field: "MoveQty", caption: n.Msg.translate(n.Env.getCtx(), "MoveQty"), editable: { type: "float" }, render: "number:4", sortable: !1, size: "10%" }), f.push({ field: "VAM_ProductContainer_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAM_ProductContainer_ID"), hidden: !0 }), f.push({ field: "VAM_Product_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAM_Product_ID"), hidden: !0 }), f.push({ field: "VAM_PFeature_SetInstance_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAM_PFeature_SetInstance_ID"), size: "15%", hidden: !0 }), f.push({ field: "VAB_UOM_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAB_UOM_ID"), size: "15%", hidden: !0 }), f.push({ field: "VAM_Inv_Trx_ID", caption: n.Msg.translate(n.Env.getCtx(), "VAM_Inv_Trx_ID"), size: "15%", hidden: !0 }), r = 0; r < i.length; r++)u = {}, u.ProductName = i[r].ProductName, u.ASI = i[r].ASI, u.UomName = i[r].UomName, u.ContainerQty = i[r].ContainerQty, u.VAM_ProductContainer_ID = i[r].VAM_ProductContainer_ID, u.VAM_Product_ID = i[r].VAM_Product_ID, u.VAM_PFeature_SetInstance_ID = i[r].VAM_PFeature_SetInstance_ID, u.VAB_UOM_ID = i[r].VAB_UOM_ID, p.length > 0 ? (o = t.map(p, function (n) { if (n.VAM_Product_ID == i[r].VAM_Product_ID && n.VAM_PFeature_SetInstance_ID == i[r].VAM_PFeature_SetInstance_ID) return n }), u.MoveQty = o.length > 0 ? o[0].MoveQty : 0) : u.MoveQty = 0, u.recid = r + 1, e[r] = u; grdname = "MCont_gridContainer" + Math.random(); grdname = grdname.replace(".", ""); w2utils.encodeTags(e); ti = ut.w2grid({ name: grdname, recordHeight: 20, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !0, selectColumn: !1, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: f, records: e, multiSelect: !1, onClick: function () { }, onChange: function (t) { if (t.column == 4 && t.value_new && t.value_new != 0) { var i = t.value_new, r = w2ui[grdname].get(t.recid).ContainerQty; if (r < 0 && i > 0) return n.ADialog.error("VIS_CantbePositive"), t.value_new = 0, !1; if (Math.abs(i) > Math.abs(r)) return n.ADialog.error("VIS_CantGreater"), t.value_new = 0, !1; rr(i, t.recid) } } }); (a.is(":checked") || y.is(":checked")) && w2ui[grdname].lock("") } function ri() { var s = [], o = a.is(":checked"), h = !1, k, d, l, b, w, c; if (h = y.is(":checked"), o && f.val() == null) return n.ADialog.error("VIS_FullContainerMove", !0, "", ""), !1; if (k = f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), d = i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), k == d) return n.ADialog.error("VIS_ContainerCantSame", !0, "", ""), !1; if (l = p.length, l == 0 && !o && !h) return n.ADialog.error("VIS_MoveQtyNotSelected", !0, "", ""), !1; if (b = n.context.getWindowContext(v.windowNo, "VAM_InventoryTransfer_ID", !0), l > 0 || o || h) { if (!o && !h && l > 0 && (t.each(p, function () { this.ToLocator = parseInt(e.val()); this.ToContainer = i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()) }), s = p), o || h) { for (s = [], w = 0; w < w2ui[grdname].records.length; w++) { c = w2ui[grdname].records[w]; s.push({ VAM_Product_ID: c.VAM_Product_ID, VAM_PFeature_SetInstance_ID: c.VAM_PFeature_SetInstance_ID, VAB_UOM_ID: c.VAB_UOM_ID, FromLocator: parseInt(u.val()), ToLocator: parseInt(e.val()), FromContainer: f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), ToContainer: i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), MoveQty: c.ContainerQty, VAM_InventoryTransfer_ID: b, IsFullMoveContainer: o ? !0 : !1, IsfullContainerQtyWise: h ? !0 : !1 }); break } s.length == 0 && o && s.push({ VAM_Product_ID: 0, VAM_PFeature_SetInstance_ID: 0, VAB_UOM_ID: 0, FromLocator: parseInt(u.val()), ToLocator: parseInt(e.val()), FromContainer: f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), ToContainer: i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), MoveQty: 0, VAM_InventoryTransfer_ID: b, IsFullMoveContainer: o ? !0 : !1, IsfullContainerQtyWise: h ? !0 : !1 }) } if (s.length == 0) return n.ADialog.error("VIS_MoveQtyNotSelected", !0, "", ""), !1; t.ajax({ url: n.Application.contextUrl + "ProductContainer/SaveMoveData", type: "POST", data: { moveData: JSON.stringify(s) }, success: function (t) { JSON.parse(t) == "VIS_SuccessFullyInserted" ? n.ADialog.info("VIS_SuccessFullyInserted", !0, "", "") : n.ADialog.error("Error", !0, n.Msg.translate(n.Env.getCtx(), "VIS_NotInserted") + " - " + t, ""); a.prop("checked", !1); y.prop("checked", !1); p = []; v.frame.close() }, error: function () { p = []; v.frame.close(); r("hidden") } }) } } function rr(t, r) { var s = a.is(":checked"), h = y.is(":checked"), c = n.context.getWindowContext(v.windowNo, "VAM_InventoryTransfer_ID", !0), l = w2ui[grdname].getChanges().length, o; t != 0 && (o = w2ui[grdname].get(r), p.push({ VAM_Product_ID: o.VAM_Product_ID, VAM_PFeature_SetInstance_ID: o.VAM_PFeature_SetInstance_ID, VAB_UOM_ID: o.VAB_UOM_ID, FromLocator: parseInt(u.val()), ToLocator: parseInt(e.val()), FromContainer: f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), ToContainer: i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), MoveQty: t, VAM_InventoryTransfer_ID: c, IsFullMoveContainer: s ? !0 : !1, IsfullContainerQtyWise: h ? !0 : !1 })) } function r(n) { ni[0].style.visibility = n } this.frame; this.windowNo; var v = this, ct = t("<div style='height:100%;background-color:white;' class='vis-forms-container' >"), ni = t("<div class='vis-busyindicatorouterwrap'><div class='vis-busyindicatorinnerwrap'><i class='vis-busyindicatordiv'><\/i><\/div><\/div>"), tt = null, b = null, c = null, h = null, l = null, it = null, lt = null, w = null, at = null, o = null, vt = null, u = null, yt = null, e = null, d = null, pt = null, f = null, wt = null, i = null, ui = null, fi = null, ei = null, oi, si = null, a = null, hi = null, y = null, ci = null, li = null, ai = null, rt = null, ut = null, ti = null; this.grdname; var ft = null, nt = null, vi = null, et = null, yi = null, bt = null, kt = 50, ot = 1, s = 1, k = 1, st = 0, dt = !1, gt = 1, ht = 0, p = []; this.Initialize = function () { r("visible"); pi(); di(); r("hidden") }; this.setHeight = function () { return 700 }; this.getRoot = function () { return ct }; disposeComponent = function () { tt = null; b = null; c = null; h = null; l = null; it = null; lt = null; w = null; at = null; o = null; vt = null; u = null; yt = null; e = null; pt = null; f = null; wt = null; i = null; ui = null; fi = null; ei = null; oi; si = null; a = null; hi = null; y = null; ci = null; li = null; ai = null; rt = null; ut = null; ti = null; this.grdname = null; ft = null; nt = null; vi = null; et = null; yi = null; kt = null; s = null; k = null; st = null; dt = null; v = null; ct = null } } n.AForms = n.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; var i = this.Initialize(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { disposeComponent(); this.frame = null }; n.AForms.productContainerMove = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function et(n) { var t; return n = n.toUpperCase(), n.contains("VAM_Locator_ID") ? t = n.substr(n.indexOf("VAM_Locator_ID=") + 13, n.length) : n.contains("VAM_LocatorTO_ID") && (t = n.substr(n.indexOf("VAM_LocatorTO_ID=") + 15, n.length)), t != undefined && (t = t.contains("AND") ? t.substr(0, t.indexOf("AND")).trim() : t.trim()), t } function g(u) { t.ajax({ url: n.Application.contextUrl + "ProductContainer/LoadContainerAsTree", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { warehouse: i, locator: r, container: 0, validation: f }, success: function (n) { u(n) }, error: function () { n.ADialog.error("VIS_ErrorLoadingFromController") } }) } function nt(n) { var r, i, e, f; for (o = '<div id=containerParent style="width:100%;height:400px"><div><div class="well VIS_tree-container" style="width:100%;float: left;"><div id=containerParent1 style="overflow-y: auto;height: 383px;"><ul class="nav nav-list">', r = JSON.parse(n), i = 0; i < r.length; i++)if (i == 0) { w(r[i], r[i].Level); continue } else if (r[i - 1].Level < r[i].Level) { o += '<ul class="nav nav-list tree" style="display: none;">'; w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li> <\/ul>"); continue } else if (r[i - 1].Level == r[i].Level && r[i].Level != 1) { o += "<\/li>"; w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li>"); continue } else if (r[i - 1].Level > r[i].Level && r[i].Level != 1) { if (r[i - 1].Level > r[i].Level) for (e = r[i - 1].Level - r[i].Level, f = 0; f < e; f++)tt(); w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li>"); continue } else if (r[i].Level == 1) { if (r[i - 1].Level > r[i].Level) for (e = r[i - 1].Level - 1, f = 0; f < e; f++)tt(); o += "<\/li>"; o += '<li class="divider"><\/li>'; w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li>"); continue } o += "<\/ul> <\/div> <\/div> <\/div> <\/div>"; t("#VIS_ContainerParentChild").html(o); h = t("#VIS_ContainerParentChild")[0]; t("label.tree-toggler").click(function () { var n = t(h); n.find(".nav-header").removeClass("current"); t(t(this)).addClass("current"); t(this).parent().children("ul.tree").toggle(300) }); b.click(function () { c.val() != "" && it(t(h), c.val()); c.val() == "" && t(h).find(".nav-header").removeClass("current") }); u && b.trigger("click"); t(document).keypress(function (n) { var i = n.keyCode ? n.keyCode : n.which; i == 13 && n.preventDefault(); i == "13" && c.val() != "" && it(t(h), c.val()) }); t(document).keyup(function () { $NameInput.val() != "" ? $NameInput.css("background-color", rt(!1)) : $NameInput.css("background-color", rt(!0)) }) } function w(n, t) { o += t == 1 ? "<li data-value=" + n.VAM_ProductContainer_ID + ' class="First">' : "<li data-value=" + n.VAM_ProductContainer_ID + ">"; o += '<label class="tree-toggler nav-header" for=' + n.VAM_ProductContainer_ID + ">" + n.ContainerName + '<span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span><\/label>' } function tt() { o += "<\/li> <\/ul>" } function it(n, i) { var r = n.find("label:contains('" + i + "')"); t("label").removeClass("current"); r.addClass("current"); t(r).parents(".First").find("ul.tree:last-child").css("display") == "none" ? (t(r).parents(".First").find("ul.tree:last-child").toggle(), t(r).parents(".First").find("ul.tree:last-child").css("display", "block")) : t(r).parents(".First").find("ul.tree:last-child").css("display", "block"); r[0].scrollIntoView() } function ot(u, f, e, o, s) { t.ajax({ url: n.Application.contextUrl + "ProductContainer/SaveContainer", datatype: "json", async: !1, contentType: "application/json; charset=utf-8", data: { warehouseId: i, locatorId: r, value: u, name: f, height: e, width: o, parentContainerId: s }, success: function (i) { JSON.parse(i) == "" ? (n.ADialog.info("VIS_ContainerInserted", !0, "", ""), t(h).empty(), h = t("<div id='VIS_ContainerParentChild' style='height:382px; float: left; width: 100%;'><\/div>"), g(nt), ut(), ft()) : n.ADialog.error("", !0, JSON.parse(i), "") }, error: function () { n.ADialog.error("VIS_ErrorLoadingFromController") } }) } function rt(n) { return n ? "#FFB6C1" : "White" } function ut() { y = e.find("#AddNewContainer"); y[0].style.display = "none"; a[0].style.display = "flex"; l[0].style.display = "none"; v[0].style.display = "none"; e.find("#VIS_DialogOKCancelProductContainer")[0].style.display = "block"; e.find("#containerParent").css("height", "400px"); e.find("#containerParent1").css("height", "383px"); e.find("#VIS_ContainerParentChild").css("height", "382px"); p[0].style.display = "none" } function st() { y = e.find("#AddNewContainer"); y[0].style.display = "block"; a[0].style.display = "none"; l[0].style.display = "flex"; v[0].style.display = "flex"; e.find("#VIS_DialogOKCancelProductContainer")[0].style.display = "none"; e.find("#containerParent").css("height", "295px"); e.find("#containerParent1").css("height", "275px"); e.find("#VIS_ContainerParentChild").css("height", "265px"); p[0].style.display = "block" } function ft() { $searchInput.val(""); $NameInput.val(""); $HeightInput.val(""); $WidthInput.val("") } var d = this; this.onClose = null; this.onClosing = null; var e = null, s = null, o, h = null, b = null, c = null, l = null, a = null, v = null, y = null, k, p = null; this.showDialog = function () { var o, w = "", y, tt; f != null ? o = et(f) : r > 0 && (o = r); o != null && (w = n.dataContext.getJSONRecord("ProductContainer/GetWarehouseAndLocatorName", o)); e = t("<div style='float: left; width: 100%;min-height:480px; max-height:480px !important'><\/div>"); tt = t("<div id='AddNewContainer' style='float: left; width: 100%; display:none;'><div class='VIS_form-data-row'><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_SearchValue' type='text' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Value") + "<\/label><\/div><\/div><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_Name' type='text' class='vis-ev-col-mandatory' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Name") + "<\/label><\/div><\/div><\/div><div class='VIS_form-data-row'><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_Height' type='Number' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Height") + "<\/label><\/div><\/div><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_Width' type='Number' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Width") + "<\/label><\/div><\/div><\/div><div class='VIS_form-data-row' style='display: none;'><div class='VIS_form-data-col'><label>" + n.Msg.translate(n.Env.getCtx(), "Ref_M_Container_ID") + "<\/label><\/div><\/div><\/div>"); y = t("<div class='VIS_form-data-row'><div class='VIS_form-search-wrap input-group vis-input-wrap'><div class='vis-control-wrap'><input class='VIS_form-search-wrap input' id='VIS_Search' type='text' placeholder='Search Here...' data-hasbtn=' '><\/div><div class='input-group-append'><button class='VIS_form-search-wrap button input-group-text' id=VIS_BtnSearch title=" + n.Msg.translate(n.Env.getCtx(), "VIS_Search") + "><i class='vis vis-search'><\/i><\/button><button class='VIS_form-search-wrap button input-group-text' id=VIS_BtnAdd title=" + n.Msg.translate(n.Env.getCtx(), "VIS_NewContainer") + "><i class='vis vis-plus'><\/i><\/button><button class='VIS_form-search-wrap button input-group-text' style='display:none;' id=VIS_BtnSave title=" + n.Msg.translate(n.Env.getCtx(), "VIS_SaveContainer") + "><i class='vis vis-save'><\/i><\/button><button class='VIS_form-search-wrap button input-group-text' style='display:none;' id=VIS_BtnCancel title=" + n.Msg.translate(n.Env.getCtx(), "VIS_Cancel") + "><i class='vis vis-mark'><\/i><\/button><\/div><\/div>"); h = t("<div id='VIS_ContainerParentChild' class='VIS_Tree-Container' ><\/div>"); k = t("<div id='VIS_DialogOKCancelProductContainer' class='VIS_buttons-wrap VIS_pop-btn-wrap' style='display:block;'> <span class='btn' id=VIS_DialogOK>" + n.Msg.translate(n.Env.getCtx(), "VIS_DialogOK") + "<\/span> <span class='btn' id=VIS_DialogCancel>" + n.Msg.translate(n.Env.getCtx(), "VIS_DialogCancel") + "<\/span> <\/div>"); p = t("<div id='VIS_LabelInfo' class='VIS_Tree-Container-labelInfo'><label>" + w + "<\/label><\/div>"); y.append(h); e.append(tt).append(y).append(k).append(p); s = new n.ChildDialog; s.setContent(e); s.setTitle(n.Msg.translate(n.Env.getCtx(), "VIS_Container")); s.setWidth("450px"); s.setEnableResize(!1); s.setModal(!0); s.show(); s.hidebuttons(); b = e.find("#VIS_BtnSearch"); c = e.find("#VIS_Search"); $searchInput = e.find("#VIS_SearchValue"); $NameInput = e.find("#VIS_Name"); $HeightInput = e.find("#VIS_Height"); $WidthInput = e.find("#VIS_Width"); a = e.find("#VIS_BtnAdd"); l = e.find("#VIS_BtnSave"); v = e.find("#VIS_BtnCancel"); $DialogbtnOk = e.find("#VIS_DialogOK"); $DialogbtnCancel = e.find("#VIS_DialogCancel"); $DialogbtnOk.click(function () { var i = h, r = t(i).find(".current").length, u, f; if (r > 1) return n.ADialog.error("VIS_SelectSingleContainer", !0, "", ""), !1; if (r > 0) { u = parseInt(t(i).find(".current")[0].htmlFor); f = t(t(i).find(".current")[0]).text(); d.onClosing(u, f); s.close() } else s.close() }); $DialogbtnCancel.click(function () { s.close() }); u && c.val(u); g(nt); a.click(function () { st() }); v.click(function () { ut(); ft() }); l.click(function () { var s, u; if ($NameInput.val() == "") return n.ADialog.error("VIS_ContainerNameNotSelected", !0, "", ""), !1; if (s = f, i == "" && r == "" && f == "") return n.ADialog.error("VIS_WarehouseOrLocatorNotFound", !0, "", ""), !1; f != null && (f = f.toUpperCase(), f.contains("VAM_Locator_ID") ? u = f.substr(f.indexOf("VAM_Locator_ID=") + 13, f.length) : f.contains("VAM_LocatorTO_ID") && (u = f.substr(f.indexOf("VAM_LocatorTO_ID=") + 15, f.length)), u != undefined && (r = u.contains("AND") ? u.substr(0, u.indexOf("AND")).trim() : u.trim(), parseInt(r) == 0 && n.ADialog.error("VIS_WarehouseOrLocatorNotFound", !0, "", ""))); var e = h, c = t(e).find(".current").length, o = 0; if (c <= 1) t(e).find(".current")[0] != undefined && (o = parseInt(t(e).find(".current")[0].htmlFor)); else return n.ADialog.error("VIS_SelectSingleContainer", !0, "", ""), !1; ot($searchInput.val(), $NameInput.val(), $HeightInput.val() == "" ? 0 : $HeightInput.val(), $WidthInput.val() == "" ? 0 : $WidthInput.val(), o) }) }; jQuery.expr[":"].contains = function (n, t, i) { return jQuery(n).text().toUpperCase().indexOf(i[3].toUpperCase()) >= 0 }; this.disposeComponent = function () { d = null; e = null; s = null; o; h = null; b = null; c = null; p = null; l = null; a = null; v = null; y = null; k; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.productContainerTree = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function y() { h = t("<div class='vis-height-full'>"); l = t("<div class='vis-apanel-busy'>"); s = t("<div class='vis-height-full'>"); h.append(s).append(l); e = new n.ChildDialog; p() } function p() { n.dataContext.getFormDataString({ VAF_Page_ID: r }, function (i) { if (i.error != null) { n.ADialog.error(i.error); o.dispose(); o = null; return } var r = t.parseJSON(i.result); if (r.IsError) { n.ADialog.error(r.Message); o.dispose(); o = null; return } e.setTitle(r.DisplayName); openForm(r, o, f); r = null }) } function w(n) { e.setContent(s); n.setHeight ? e.setHeight(n.setHeight()) : e.setHeight(i); n.setWidth ? e.setWidth(n.setWidth()) : e.setWidth(window.innerWidth - 100); e.setModal(!0); e.onClose = function () { n.dispose && n.dispose(); e.dispose && e.dispose(); u.dataRefresh(); o.disposeComponent && o.disposeComponent() }; e.show(); e.hidebuttons() } var h, l, s, e, v = n.Env.getCtx(), a = n.Logging.VLogger.getVLogger("VIS.AForm"), c = n.Env.getWindowNo(), o = this; y(); this.getWindowNo = function () { return c }; this.getVAF_TableView_ID = function () { return u.getVAF_TableView_ID() }; this.getVAF_Screen_ID = function () { return u.getVAF_Screen_ID() }; this.getRecord_ID = function () { return u.getRecord_ID() }; this.getContentGrid = function () { return s }; this.close = function () { e && e.close() }; this.disposeComponent = function () { h.remove(); h = null; s.remove(); s = null; this.getContentGrid = null; o = null }; openForm = function (t, i, r) { var f, s, e; if (t.IsReport) return n.ADialog.info("Form Report is not supported"), !1; f = ""; f = t.Prefix + t.ClassName; console.log(f); a.info("Form Name= " + t.Name + ", Class=" + f); v.setWindowContext(c, "WindowName", t.DisplayName); try { s = n.Utility.getFunctionByName(f, window); e = new s(c); e.init(r, o); e.setRecordID && e.setRecordID(u.getRecord_ID()); w(e) } catch (h) { return a.log(n.Logging.Level.WARNING, "Class=" + f + ", VAF_Page Name=" + t.Name, h), !1 } return !0 } } n.WForm = i }(VIS, jQuery), function (n, t) { function i(t, i, r, u, f, e) { this._tblName = t; this.rec_ID = r; this.sqlWhere = u; this.gFields = i; this._callbackClose = e; this.gridCols = []; this.htmlUI = []; this.deletable = !1; this.maintTblVer = f; this.defaultColsIniPos = [Version = n.Msg.getMsg("VIS_RecordVersion"), ValidFrom = n.Msg.translate(n.Env.getCtx(), "VersionValidFrom"), Approved = n.Msg.getMsg("VIS_IsVersionApproved"),]; this.defaultColEleIniPos = [Version = "RECORDVERSION", ValidFrom = "VERSIONVALIDFROM", Approved = "ISVERSIONAPPROVED"]; this.defaultCols = [VersionLog = n.Msg.translate(n.Env.getCtx(), "VersionLog"), Delete = n.Msg.getMsg("Action")]; this.defaultColElements = [VersionLog = "VERSIONLOG", Delete = "ACTION"]; this.exclCols = [Tenant = "VAF_Client_ID", Created = "Created", CreatedBy = "CreatedBy", Updated = "Updated", UpdatedBy = "UpdatedBy", Export_ID = "Export_ID"] } i.prototype.show = function () { var o = !1, r = null, s = null, f = null, e = this, c = this._tblName + ",true," + this.sqlWhere, l = n.dataContext.getJSONRecord("Common/GetIDTextData", c), a = n.dataContext.getJSONRecord("Common/CheckTableDeletable", this._tblName + "_Ver"), h = "40%", i, u; if (a == "Y" && (this.deletable = !0), i = new n.ChildDialog, u = this.getMasterVersionUI(l), i.setContent(u), this.gridCols.length > 8 && (h = "70%"), i.setWidth(h), i.setTitle(n.Msg.getMsg("MasterDataVersioning")), i.setModal(!0), i.onClose = function () { r && (r.off("click"), r = null); f && (f = null); s && (s = null); this.deletable && u.find(".vis-mas-ver-btnDel").off("click"); i = null }, i.onOkClick = function () { var s, h; if (!o && e._callbackClose) if (o = !0, s = f.val(), s && s != "" || (s = new Date), r.prop("checked")) e._callbackClose(r.prop("checked"), s, 0), o = !1; else { var c = u.find(".vis-mas-ver-recRow"), l = !1, a = 0; if (c.length > 0) for (h = 0; h < c.length; h++) { var v = t(c[h]), y = v.find(".vis-mas-ver-valFromDate"), p = new Date(t(y).attr("valdt")).getTime(), w = new Date(new Date(f.val()).setHours(0, 0, 0, 0)).getTime(); if (p == w) { l = !0; a = v.attr("recid"); break } } if (l) return n.ADialog.confirm("VersionExistOverwrite", !0, "", "Confirm", function (n) { n ? (e._callbackClose(r.prop("checked"), s, a), i.close(), o = !1) : o = !1 }), !1; e._callbackClose(r.prop("checked"), s, 0); o = !1 } }, i.onCancelClick = function () { i.close() }, i.show(), this.deletable) u.find(".vis-mas-ver-btnDel").on("click", function (i) { var r = t(i.target).closest(".vis-mas-ver-recRow"), o, f; if (r.length > 0 && (o = r.attr("recid"), o > 0)) { if (f = !1, f) return; n.ADialog.confirm("DeleteConfirm", !0, "", "Confirm", function (t) { if (f = !0, t) { var s = e._tblName + "_Ver," + o, i = n.dataContext.getJSONRecord("Common/DeleteRecord", s); i && i.Success && i.Success == "Y" ? (r.remove(), r = u.find(".vis-mas-ver-recRow"), r.length <= 0 && u.find(".vis-mas-ver-gridData").append(e.getNoRecDiv())) : i.Success && i.Msg != "" ? n.ADialog.error(i.Msg) : n.ADialog.error(n.Msg.getMsg("ErrorDeletingRecord")); f = !1 } else f = !1 }) } }); r = u.find(".vis-mas-ver-chkImmSave"); s = u.find(".vis-mas-ver-secValFrom"); f = u.find(".vis-mas-ver-dtVerVal"); r.on("click", function () { s.toggle(); r.prop("checked") || f.val(e.getDateString()) }); f.on("change", function () { var n = new Date(f.val()).setHours(0, 0, 0, 0), t = (new Date).setHours(0, 0, 0, 0); n <= t && f.val(e.getDateString()) }) }; i.prototype.getMasterVersionUI = function (i) { return t('<div class= "vis-mas-ver-outerwrap"><div class="vis-mas-ver-text">' + n.Msg.getMsg("VersioningColsFoundValidFrom") + '<\/div><div style="display: flex;"><div class="vis-mas-ver-checkwrap"><input type="checkbox" class="vis-mas-ver-ImmSav vis-mas-ver-chkImmSave" checked="checked"><label>' + n.Msg.getMsg("SaveImmediate") + '<\/label><\/div><div class="vis-mas-ver-fieldwrap vis-mas-ver-checkwrap vis-mas-ver-secValFrom" style="display: none;"><label>' + n.Msg.getMsg("VersionValidFrom") + '<\/label><input type="date" class="vis-mas-ver-ImmSav vis-mas-ver-dtVerVal"><\/div><\/div>' + this.getGrid(i) + "<\/div>") }; i.prototype.getGrid = function (i) { var c, o, u, h, s, a, e; if (this.htmlUI.push('<div class= "vis-mas-ver-gridSection" style="min-height: 300px;">'), this.htmlUI.push("<table>"), c = n.Application.contextUrl + "Areas/VIS/Images/base/delete10.png", this.htmlUI.push('<thead class="vis-mas-ver-gridData">'), this.htmlUI.push(this.createHeaders()), this.htmlUI.push("<\/thead>"), i && i.Table) if (i.Table.length > 0) { for (this.htmlUI.push("<tbody>"), o = 0; o < i.Table.length; o++) { for (u = i.Table[o], h = "", o % 2 == 0 && (h = "style='background-color: #ebf1f3;'"), this.htmlUI.push('<tr recid="' + u[this._tblName.toUpper() + "_VER_ID"] + '"  ' + h + ' class="vis-mas-ver-recRow">'), s = 0; s < this.gridCols.length; s++) { var r = this.gridCols[s], f = t.grep(this.gFields, function (n) { return n.vo.ColumnName.toUpper() == r })[0], l = "---"; u[r + "_TXT"] ? this.htmlUI.push("<td>" + n.Utility.encodeText(u[r + "_TXT"]) + "<\/td>") : r == "ACTION" ? this.deletable && this.htmlUI.push("<td style='text-align: center;'><button class='vis-mas-ver-btnDel'><img src='" + c + "' /><\/button><\/td>") : u[r + "_LOC"] || u[r + "_LTR"] || u[r + "_ASI"] || u[r + "_ACT"] || u[r + "_CTR"] ? (f && (l = f.getLookup().getDisplay(f.value)), this.htmlUI.push("<td>" + n.Utility.encodeText(l) + "<\/td>")) : u[r] ? r == "ISVERSIONAPPROVED" || f && f.vo && f.vo.displayType && f.vo.displayType == 20 ? u[r] == "Y" ? this.htmlUI.push('<td style="text-align: center;"><input type="checkbox" checked="checked" disabled><\/td>') : this.htmlUI.push('<td style="text-align: center;"><input type="checkbox" disabled><\/td>') : r == "VERSIONVALIDFROM" ? (a = Globalize.format(new Date(u[r]), "d"), this.htmlUI.push('<td class="vis-mas-ver-valFromDate" valdt="' + new Date(u[r]) + '">' + a + "<\/td>")) : f && f.vo && f.vo.displayType && f.vo.displayType == 15 ? (e = Globalize.format(new Date(u[r]), "d"), this.htmlUI.push('<td dtDate="' + new Date(u[r]) + '">' + e + "<\/td>")) : f && f.vo && f.vo.displayType && f.vo.displayType == 16 ? (e = Globalize.format(new Date(u[r] + "Z"), "f"), this.htmlUI.push('<td dtDate="' + new Date(u[r]) + '">' + e + "<\/td>")) : f && f.vo && f.vo.displayType && f.vo.displayType == 24 ? (e = Globalize.format(new Date(u[r] + "Z"), "t"), this.htmlUI.push('<td dtDate="' + new Date(u[r]) + '">' + e + "<\/td>")) : r == "RECORDVERSION" ? this.htmlUI.push('<td style="text-align: center">' + n.Utility.encodeText(u[r]) + "<\/td>") : this.htmlUI.push("<td>" + n.Utility.encodeText(u[r]) + "<\/td>") : this.htmlUI.push("<td> --- <\/td>") } this.htmlUI.push("<\/tr>") } this.htmlUI.push("<\/tbody>") } else this.htmlUI.push(this.getNoRecDiv()); else this.htmlUI.push(this.getNoRecDiv()); return this.htmlUI.push("<\/table>"), this.htmlUI.push("<\/div>"), this.htmlUI.join(" ") }; i.prototype.createHeaders = function () { var t = [], r, i; if (t.push('<tr style="border-bottom: 2px #b5b3b3 solid;">'), this.gFields && this.gFields.length > 0) { for (this.createVerColsHdrs(t, this.defaultColsIniPos, this.defaultColEleIniPos), r = 0; r < this.gFields.length; r++)i = this.gFields[r], (i.vo.IsMaintainVersions || this.maintTblVer) && this.exclCols.indexOf(i.vo.ColumnName) < 0 && (this.gridCols.push(i.vo.ColumnName.toUpper()), i.vo.displayType == 20 ? t.push('<th style="text-align: center;">' + n.Utility.encodeText(i.vo.Header) + "<\/th>") : t.push("<th>" + n.Utility.encodeText(i.vo.Header) + "<\/th>")); this.createVerColsHdrs(t, this.defaultCols, this.defaultColElements) } return t.push("<\/tr>"), t.join(" ") }; i.prototype.createVerColsHdrs = function (t, i, r) { for (var u = 0; u < i.length; u++)this.gridCols.push(r[u]), r[u] == "ACTION" ? this.deletable && t.push('<th style="text-align: center;">' + n.Utility.encodeText(i[u]) + "<\/th>") : r[u] == "ISVERSIONAPPROVED" || r[u] == "RECORDVERSION" ? t.push('<th style="text-align: center;">' + n.Utility.encodeText(i[u]) + "<\/th>") : t.push("<th>" + n.Utility.encodeText(i[u]) + "<\/th>") }; i.prototype.getDateString = function () { var i = new Date, r = i.getFullYear(), t = i.getMonth() + 1, n; return t < 10 && (t = "0" + t), n = i.getDate() + 1, n < 10 && (n = "0" + n), r + "-" + t + "-" + n }; i.prototype.getNoRecDiv = function () { return '<div class="vis-mas-ver-norecord">' + n.Utility.encodeText(n.Msg.getMsg("NoRecords")) + "<\/div>" }; n.MasterDataVersion = i }(VIS, jQuery); VIS = window.VIS || {}, function () { function n() { var t, n, i, r; this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.selectedRow = null; this.panelWidth; this.extraInfo = null; this.init = function () { if (t = $('<div style="height:100%;width:100%"><\/div>'), window.VA037) n = $('<iframe height=100%; width="100%"; frameborder="0" ><\/iframe>'), t.html(n); else { var i = $('<span class="vis-bi-tab-panel">' + VIS.Msg.getMsg("PleaseInstallBIReportTool") + "<\/span>"); t.append(i) } }; this.update = function (n) { r(n) }; this.getRoot = function () { return t }; i = this; r = function (t) { if (n) { var r = VIS.Application.contextUrl + "BiPanel/GetUserBILogin?recID=" + t + "&extraInfo=" + window.encodeURIComponent(i.extraInfo); n.prop("src", r) } }; this.disposeComponent = function () { n && n.remove(); t.remove(); n = null; t = null } } n.prototype.startPanel = function (n, t, i) { this.windowNo = n; this.curTab = t; this.extraInfo = i; this.init() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n) { this.panelWidth = n }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.BiPanel = n }(); VIS = window.VIS || {}, function (n, t) { function i() { n.CalloutEngine.call(this, "calloutColumn") } n.Utility.inheritPrototype(i, n.CalloutEngine); i.prototype.setDBColumnName = function (i, r, u, f, e, o) { if (!this.isCalloutActive() && e != null && e != 0) { this.setCalloutActive(!0); var s = u; return t.ajax({ url: n.Application.contextUrl + "VIS/CalloutColumn/GetDBColunName", data: { VAF_ColumnDic_ID: e }, success: function (n) { n && s.setValue("ColumnName", n) }, error: function (n) { this.log.severe(n) } }), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } }; n.calloutColumn = i }(VIS, jQuery); VIS = window.VIS || {}, function () { function n() { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.selectedRow = null; this.panelWidth; var t = $('<div class="vis-mas-verinf-wrap"><\/div>'), n = null; this.init = function () { var i = '<div class="vis-mas-verinf-hdrCtr"><div class="vis-mas-verinf-hdrsLft">' + VIS.Msg.getMsg("FieldName") + '<\/div><div class="vis-mas-verinf-hdrsRgt">' + VIS.Msg.getMsg("OldValue") + '<\/div><\/div><div class="vis-mas-verinf-CngCtr"><\/div>'; t.append(i); n = t.find(".vis-mas-verinf-CngCtr") }; this.getRoot = function () { return t }; this.update = function () { try { if (this.selectedRow.recordversion > 1) { this.selectedRow.RID = this.record_ID; this.selectedRow.TName = this.curTab.vo.TableName; this.selectedRow.TabID = this.curTab.vo.VAF_Tab_ID; this.selectedRow.TblID = this.curTab.vo.VAF_TableView_ID; var t = this; $.ajax({ type: "POST", async: !0, url: VIS.Application.contextUrl + "JsonData/GetVerInfo", contentType: "application/json; charset=utf-8", data: "{ 'RowData': '" + JSON.stringify(this.selectedRow) + "' }", success: function (i) { var s = t.curTab, u, o, f, e, r; if (n.empty(), i && (u = JSON.parse(i), u.ColumnNames && u.ColumnNames.length > 0)) { for (o = [], f = 0; f < u.ColumnNames.length; f++) { e = 10; try { e = $.grep(t.curTab.gridTable.gTable.m_fields, function (n) { return n._vo.ColumnName == u.DBColNames[f] })[0]._vo.displayType } catch (h) { e = 10 } r = u.OldVals[f]; e == 15 ? r = Globalize.format(new Date(r), "d") : e == 16 ? r = Globalize.format(new Date(r + "Z"), "f") : e == 24 && (r = Globalize.format(new Date(r + "Z"), "t")); u.OldVals[f] == "" && (r = "&nbsp"); o.push('<div class="vis-mas-verinf-cntCtr"><div class="vis-mas-verinf-cnt">' + u.ColumnNames[f] + '<\/div><div class="vis-mas-verinf-cnt">' + r + "<\/div><\/div>") } n.append(o.join(" ")) } }, error: function () { } }) } else this.selectedRow.recordversion == 1 ? (n.empty(), n.append('<div class="vis-mas-verinf-newrecord">' + VIS.Msg.getMsg("FirstVersion") + "<\/div>")) : (n.empty(), n.append('<div class="vis-mas-verinf-newrecord">' + VIS.Msg.getMsg("NoVersionsFound") + "<\/div>")) } catch (i) { } }; this.disposeComponent = function () { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.rowSource = null; this.panelWidth = null; t.remove(); t = null } } n.prototype.startPanel = function (n, t) { this.windowNo = n; this.curTab = t; this.init() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n, t) { this.panelWidth = t }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.verinfo = n }(); VIS = window.VIS || {}, function () { function n() { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.selectedRow = null; this.panelWidth; var t = null, i = null, r = null, u = null, f = null, n = $('<div style="height:100%;width:100%;padding:15px"><\/div>'); this.init = function () { var e = '<div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Name: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblName"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Location: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblLocation"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Business Partner: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblBPartner"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Date Time: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblDateTime"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Amount: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblAmount"><\/label> <\/div>'; n.append(e); t = n.find("#" + this.windowNo + "lblName"); i = n.find("#" + this.windowNo + "lblLocation"); r = n.find("#" + this.windowNo + "lblBPartner"); u = n.find("#" + this.windowNo + "lblDateTime"); f = n.find("#" + this.windowNo + "lblAmount") }; this.getRoot = function () { return n }; this.update = function () { var n, e; t.text(VIS.context.getWindowContext(this.windowNo, "Name")); try { e = "VAB_Address_ID"; n = this.selectedRow[e.toLower()]; (VIS.DisplayType.IsLookup(this.curTab.getField(e).getDisplayType()) || VIS.DisplayType.Location == this.curTab.getField(e).getDisplayType()) && (n && (n = this.curTab.getField(e.toLower()).lookup.getDisplay(n)), i.text(n)); n = null; e = "VAB_BusinessPartner_ID"; n = this.selectedRow[e.toLower()]; (VIS.DisplayType.IsLookup(this.curTab.getField(e).getDisplayType()) || VIS.DisplayType.Location == this.curTab.getField(e).getDisplayType()) && (n && (n = this.curTab.getField(e.toLower()).lookup.getDisplay(n)), r.text(n)); n = null; e = "T_DateTime"; VIS.DisplayType.IsDate(this.curTab.getField(e).getDisplayType()) && (n = this.curTab.getField(e).value, n = new Date(n).toLocaleString(), u.text(n)); n = null; e = "T_Amount"; n = this.selectedRow[e.toLower()]; f.text(n) } catch (o) { } }; this.disposeComponent = function () { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.rowSource = null; this.panelWidth = null; t.remove(); t = null; i.remove(); i = null; r.remove(); r = null; u.remove(); u = null; f.remove(); f = null; n.remove(); n = null } } n.prototype.startPanel = function (n, t) { this.windowNo = n; this.curTab = t; this.init() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n) { this.panelWidth = n }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.TestPanel = n }(), function (n, t) { function i() { function r() { var u = t("#vis_theme"), r; u.on("click", "div.vis-theme-rec", function (n) { var r = t(n.currentTarget).data("color"); i(r) }); n.Application.theme && n.Application.theme != "" ? i(n.Application.theme) : (r = u.find("div.vis-theme-rec"), r.length > 0 && i(t(r[0]).data("color"))) } function i(n) { var t = document.documentElement, i = n.split("|"); t.style.setProperty("--v-c-primary", i[0]); t.style.setProperty("--v-c-on-primary", i[1]); t.style.setProperty("--v-c-secondary", i[2]); t.style.setProperty("--v-c-on-secondary", i[3]) } return { init: r, applyTheme: i } } n.themeMgr = i() }(VIS, jQuery), function (n, t) { VIS.VApp = function () { function i() { var n = t.context.getVAF_Language().replace("_", "-"); Globalize.culture(n) } function r() { document.getElementById("vis_mainConatiner").removeChild(document.getElementById("vis_busyGrid")); var t = n("#vis_antiForgeryToken").val(); n.ajaxSetup({ headers: { VerificationToken: t } }); VIS.Application.isIOS = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()) } function u() { var n = t.Logging; n.VLogMgt.initialize(!0); n.VLogMgt.setLevel(VIS.Ini.getTraceLevel()) } function f() { VIS.Ini.updateLocalContextFromIni() } function e() { r(); i(); f(); u(); VIS.desktopMgr.start(); VIS.themeMgr.init(); VIS.Env.setWINDOW_PAGE_SIZE(VIS.Ini.getLocalStorage(VIS.IniConstants.WIN_PAGESIZE)); var e = n("#vis_userDate").find("span"); e.text(" " + (new Date).toLocaleDateString(t.context.getVAF_Language().replace("_", "-"), { weekday: "long", year: "numeric", month: "long", day: "numeric" })) } return { init: e } }() }(jQuery, VIS)
