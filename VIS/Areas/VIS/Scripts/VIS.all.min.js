/*version 1.2.211.11*/
(function (n) { function i(n, t) { if (!(n.originalEvent.touches.length > 1)) { n.preventDefault(); var i = n.originalEvent.changedTouches[0], r = document.createEvent("MouseEvents"); r.initMouseEvent(t, !0, !0, window, 1, i.screenX, i.screenY, i.clientX, i.clientY, !1, !1, !1, !1, 0, null); n.target.dispatchEvent(r) } } if (n.support.touch = "ontouchend" in document, n.support.touch) { var t = n.ui.mouse.prototype, u = t._mouseInit, f = t._mouseDestroy, r; t._touchStart = function (n) { var t = this; !r && t._mouseCapture(n.originalEvent.changedTouches[0]) && (r = !0, t._touchMoved = !1, i(n, "mouseover"), i(n, "mousemove"), i(n, "mousedown")) }; t._touchMove = function (n) { r && (this._touchMoved = !0, i(n, "mousemove")) }; t._touchEnd = function (n) { r && (i(n, "mouseup"), i(n, "mouseout"), this._touchMoved || i(n, "click"), r = !1) }; t._mouseInit = function () { var t = this; t.element.bind({ touchstart: n.proxy(t, "_touchStart"), touchmove: n.proxy(t, "_touchMove"), touchend: n.proxy(t, "_touchEnd") }); u.call(t) }; t._mouseDestroy = function () { var t = this; t.element.unbind({ touchstart: n.proxy(t, "_touchStart"), touchmove: n.proxy(t, "_touchMove"), touchend: n.proxy(t, "_touchEnd") }); f.call(t) } } })(jQuery); String.prototype.equals = function (n, t) { return t ? this.toString().toLowerCase() === n.toLowerCase() : this.toString() === n }; String.prototype.equalsIgnoreCase = function (n) { return this.toString().toLowerCase() === n.toLowerCase() }; String.prototype.startsWith = function (n) { return n === "" ? !0 : this == null || n == null ? !1 : (n = String(n), this.length >= n.length && this.slice(0, n.length) === n) }; String.prototype.endsWith = function (n) { return n === "" ? !0 : this == null || n == null ? !1 : (n = String(n), this.length >= n.length && this.slice(this.length - n.length) === n) }; String.prototype.contains = function (n) { return this.indexOf(n) > -1 }; String.prototype.toUpper = function () { return this.toUpperCase() }; String.prototype.toLower = function () { return this.toLowerCase() }; String.prototype.compareTo = function (n) { var u = this.length, f = n.length, o = u < f ? u : f, t, r, e; for (i = 0; i < o; i++)if (t = this.charCodeAt(i), r = n.charCodeAt(i), t != r) return t > r ? 1 : t < r ? -1 : 0; return e = u - f, e > 0 ? 1 : e < 0 ? -1 : 0 }; String.prototype.replaceAll = function (n, t) { var i = this; return i.replace(new RegExp(n, "g"), t) }; Number.prototype.compareTo = function (n) { var t = this - n; return t > 0 ? 1 : t < 0 ? -1 : 0 }; Array.prototype.indexOf || (Array.prototype.indexOf = function (n) { for (var t = 0; t < this.length; t++)if (this[t] === n) return t; return -1 }); StringBuilder = function (n) { this.str = n ? n : "" }; StringBuilder.prototype.append = function (n) { return this.str += n, this }; StringBuilder.prototype.toString = function () { return this.str }; StringBuilder.prototype.endsWith = function (n) { return this.str.endsWith(n) }; StringBuilder.prototype.replace = function (n, t) { var i = this.str; return i.replace(new RegExp(n, "g"), t) }; StringBuilder.prototype.indexOf = function (n) { return this.str.indexOf(n) }; StringBuilder.prototype.length = function () { return this.str.length }; StringBuilder.prototype.insert = function (n, t) { return this.str = n > 0 ? this.str.substring(0, n) + t + this.str.substring(n, this.str.length) : t + this.str, this.str }; StringBuilder.prototype.clear = function () { return this.str.length = 0, this.str = "", this }; Date.prototype.toUniversalTime = function () { return new Date(this.getTime()) }; VISUtil = window.VISUtil || {}, function (n, t) { function l(t, i, r) { var u = function (u) { var f, e, o; if (isNaN(u) || u === null) return 0; if (f = u.toString(), e = f.indexOf("."), e != -1) { if (o = f.substring(0, e), o.length > t) return o = o.substring(0, t), o + f.substring(e, f.Length - e) } else if (i === 0 && r === 0) { if (f > n.EnvConstants.INT32MAXVALUE) return n.EnvConstants.INT32MAXVALUE; if (f < -1 * (n.EnvConstants.INT32MAXVALUE + 1)) return -1 * (n.EnvConstants.INT32MAXVALUE + 1) } return u }; this.GetFormatedValue = function (n) { var t = u(n).toString(); return r != 0 && (t.indexOf(".") <= -1 ? t = parseFloat(t).toFixed(r) : t.split(".")[1].length > r ? (t = parseFloat(t).toFixed(i), t = parseFloat(t)) : r === i ? t = parseFloat(t).toFixed(r) : t.split(".")[1].length < r && (t = parseFloat(t).toFixed(r))), t }; this.GetConvertedNumber = function (n, t) { var i; return n = this.GetConvertedString(n, t), t ? (i = n.split("."), !Number.isSafeInteger(Number(i[0]))) ? Number.MAX_SAFE_INTEGER : Number(String(n).replace(/[^0-9.-]+/g, "")) : (i = n.split(","), !Number.isSafeInteger(Number(i[0]))) ? Number.MAX_SAFE_INTEGER : Number(String(n).replace(/[^0-9,-]+/g, "").replace(/[,]+/g, ".")) }; this.GetConvertedString = function (n, t) { var i = ""; return t ? (i = n.match(/[.]+/g), i != null && i.length > 1 ? "" : String(String(n).replace(/[^0-9.-]+/g, ""))) : (i = n.match(/[,]+/g), i != null && i.length > 1 ? "" : String(String(n).replace(/[^0-9,-]+/g, "").replace(/[,]+/g, ","))) }; this.GetFormatAmount = function (n, t, i) { var e = window.navigator.language, o = String(n), f = "", u, r; return t == "init" ? f = o.split(".") : (t == "blur" || t == "formatOnly") && (f = i ? o.split(".") : o.split(",")), f[1] != undefined && (u = f[1].replace(/[\D\s\,_\-]+/g, "")), r = f[0].replace(/[\s\.\,_]+/g, ""), r = r ? parseInt(r, 10) : 0, u != undefined ? t == "init" || t == "formatOnly" ? i ? r.toLocaleString(e) + "." + u : r.toLocaleString(e) + "," + u : i ? r + "." + u : r + "," + u : t == "init" || t == "formatOnly" ? i ? r.toLocaleString(e) : r.toLocaleString(e) : i ? r : r }; this.getMinFractionDigit = function () { return r }; this.getMaxFractionDigit = function () { return i }; this.getLocaleAmount = function (t) { var i = this.GetFormatedValue(t).toLocaleString(undefined, { maximumFractionDigits: 6 }); return this.GetFormatAmount(i, "formatOnly", n.Env.isDecimalPoint()) }; this.dispose = function () { this.GetFormatedValue = null; this.GetConvertedNumber = null; this.GetConvertedString = null; this.GetFormatAmount = null; u = null } } function r(n) { this.pattern; this.applyPattern(n) } function f(t, i, r, u) { n.dataContext.getDataSetJString(i, r, function (n) { u(n) }) } function a(t, i, r, u) { n.dataContext.executeQuery(i, r, function (n) { u(n) }) } function v(t, i, r, u) { n.dataContext.executeQueries(i, r, function (n) { u(n) }) } function s(n, t) { this.name = n; this.value = t; this.isDate = !1; this.isByteArray = !1 } function e() { this.tables = []; this.total = 0 } function u() { this.count = 0; this.totalPage = 0; this.page = 1; this.columns = []; this.rows = []; this.totalRecord = 0; this.columnsName = [] } function o(n, t) { this.cells = n.cells; this.id = n.id; this.parent = t } function i() { return this.rowIndex = -1, this.tables = [], this.curTable, this } function h() { } function c() { this.List = { sq: { decimalSeparator: !1 }, ar: { decimalSeparator: !0 }, bg: { decimalSeparator: !1 }, be: { decimalSeparator: !1 }, ca: { decimalSeparator: !1 }, zh: { decimalSeparator: !0 }, "zh-HK": { decimalSeparator: !0 }, "zh-CN": { decimalSeparator: !0 }, "zh-TW": { decimalSeparator: !0 }, hr: { decimalSeparator: !0 }, cs: { decimalSeparator: !1 }, da: { decimalSeparator: !1 }, nl: { decimalSeparator: !1 }, en: { decimalSeparator: !0 }, "en-AU": { decimalSeparator: !0 }, "en-CA": { decimalSeparator: !0 }, "en-IN": { decimalSeparator: !0 }, "en-NZ": { decimalSeparator: !0 }, "en-ZA": { decimalSeparator: !0 }, "en-US": { decimalSeparator: !0 }, "en-GB": { decimalSeparator: !0 }, et: { decimalSeparator: !1 }, fi: { decimalSeparator: !1 }, fr: { decimalSeparator: !1 }, "fr-CA": { decimalSeparator: !1 }, "fr-FR": { decimalSeparator: !1 }, "fr-CH": { decimalSeparator: !1 }, de: { decimalSeparator: !1 }, "de-AT": { decimalSeparator: !1 }, "de-DE": { decimalSeparator: !1 }, "de-LI": { decimalSeparator: !1 }, "de-CH": { decimalSeparator: !1 }, el: { decimalSeparator: !1 }, he: { decimalSeparator: !0 }, hi: { decimalSeparator: !0 }, hu: { decimalSeparator: !1 }, is: { decimalSeparator: !1 }, it: { decimalSeparator: !1 }, "it-IT": { decimalSeparator: !1 }, "it-CH": { decimalSeparator: !1 }, ja: { decimalSeparator: !0 }, ko: { decimalSeparator: !0 }, lv: { decimalSeparator: !1 }, lt: { decimalSeparator: !1 }, mk: { decimalSeparator: !1 }, nb: { decimalSeparator: !1 }, nn: { decimalSeparator: !1 }, pl: { decimalSeparator: !1 }, pt: { decimalSeparator: !1 }, "pt-BR": { decimalSeparator: !1 }, "pt-PT": { decimalSeparator: !1 }, ro: { decimalSeparator: !1 }, ru: { decimalSeparator: !1 }, sr: { decimalSeparator: !1 }, sh: { decimalSeparator: !1 }, sk: { decimalSeparator: !1 }, sl: { decimalSeparator: !1 }, es: { decimalSeparator: !1 }, "es-AR": { decimalSeparator: !1 }, "es-CL": { decimalSeparator: !1 }, "es-CO": { decimalSeparator: !1 }, "es-CR": { decimalSeparator: !1 }, "es-HN": { decimalSeparator: !1 }, "es-MX": { decimalSeparator: !1 }, "es-PE": { decimalSeparator: !1 }, "es-ES": { decimalSeparator: !1 }, "es-US": { decimalSeparator: !1 }, "es-UY": { decimalSeparator: !1 }, "es-VE": { decimalSeparator: !1 }, sv: { decimalSeparator: !1 }, th: { decimalSeparator: !0 }, tr: { decimalSeparator: !1 }, uk: { decimalSeparator: !1 }, vi: { decimalSeparator: !1 } } } n.Events = function () { var n = "click", t = "touchstart", i = "click", r; return "onmouseover" in document && "ontouchstart" in document ? (n = "click", t = "click") : "ontouchstart" in document ? (n = "touchstart", t = "touchstart") : (n = "click", t = "click"), i = "ontouchend" in document ? "touchend" : "click", r = "click", { onTouchStartOrClick: n, onTouchEndOrClick: i, onClick: r, onTouchStartAndClick: t } }(); n.Actions = { zoom: "zoom", refresh: "refresh", preference: "preference", add: "add", update: "update", remove: "delete", contact: "contact", addnewrec: "AddNewRecord" }; n.EnvConstants = { WINDOW_FIND: 1110, WINDOW_MLOOKUP: 1111, WINDOW_CUSTOMIZE: 1112, WINDOW_INFO: 1113, TAB_INFO: 1113, WINDOW_ACCOUNT: 1114, WINDOW_TEMP: 111e5, INT32MAXVALUE: 2147483647 }; n.Format = l; n.Utility = { divCoding: t("<div>"), inheritPrototype: function (n, t) { var i = Object.create(t.prototype); i.constructor = n; n.prototype = i; n.prototype.$super = t.prototype }, getBusyPanel: function () { return t("<div>").html(t("<strong>").html("Loading....")) }, getFunctionByName: function (n, t) { for (var f = [].slice.call(arguments).splice(2), r = n.split("."), u = r.pop(), i = 0; i < r.length; i++)t = t[r[i]]; return t[u] }, utf8_to_b64: function (n) { return window.btoa(unescape(encodeURIComponent(n))) }, b64_to_utf8: function (n) { return decodeURIComponent(escape(window.atob(n))) }, decodeText: function (n) { return this.divCoding.html(n).text() }, encodeText: function (n) { return this.divCoding.text(n).html() } }; n.Utility.encode = n.Utility.utf8_to_b64; n.Utility.decode = n.Utility.b64_to_utf8; n.Utility.Util = { getValueOfInt: function (n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : parseInt(n.toString()) }, getValueOfDecimal: function (n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : parseFloat(n.toString()) }, getValueOfDouble: function (n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : parseFloat(n.toString()) }, getValueOfString: function (n) { return n == null || n.toString().trim() == "" ? "" : n == null ? "" : n.toString() }, getValueOfDate: function (n) { return n == null || n.toString().trim() == "" ? 0 : n ? new Date(n) : null }, getValueOfFormattedDateTime: function (n) { if (n == null || n.toString().trim() == "") return 0; if (n) { var t = new Date(n), i, r, u, f, e, o; return i = t.getFullYear(), r = t.getMonth().toString().length === 1 ? "0" + (t.getMonth() + 1).toString() : t.getMonth() + 1, u = t.getDate().toString().length === 1 ? "0" + t.getDate().toString() : t.getDate(), f = t.getHours().toString().length === 1 ? "0" + t.getHours().toString() : t.getHours(), e = t.getMinutes().toString().length === 1 ? "0" + t.getMinutes().toString() : t.getMinutes(), o = t.getSeconds().toString().length === 1 ? "0" + t.getSeconds().toString() : t.getSeconds(), i + "-" + r + "-" + u + "T" + f + ":" + e + ":" + o } return null }, getValueOfBoolean: function (n) { return n == null || n.toString().trim() == "" ? null : n.toString().toLowerCase() == "true" || n.toString() == "Y" ? !0 : !1 }, contains: function (n, t) { return n.indexOf(t) > -1 }, isEmpty: function (n) { return n == null || n.length === 0 ? !0 : !1 }, cleanMnemonic: function (n) { if (n == null || n.length == 0) return n; var t = n.indexOf("&"); return t == -1 ? n : (t + 1 < n.length && n.charAt(t + 1) != " " && (n = n.substring(0, t) + n.substring(t + 1)), n) }, scale: function (n) { var t, i; return isNaN(n) ? 0 : (t = 1.1, t = t.toLocaleString().substring(1, 2), i = n.toString().split(t), i.length > 2 || i.length == 1) ? 0 : i[1].length }, getIdentifierDisplayVal: function (n) { var t = ""; return n && n.indexOf("Images/") > -1 ? (t = n.replace("^^" + n.substring(n.indexOf("Images/"), n.lastIndexOf("^^") + 3), "_"), t.indexOf("Images/") > -1 && (t = t.replace(t.substring(t.indexOf("Images/"), t.lastIndexOf("^^") + 3), "_")), t.endsWith("_") && (t = t.substring(0, t.length - 1)), t.startsWith("_") && (t = t.substring(1))) : t = n, t } }; n.Env = function () { function h() { return r++ } function c() { return n.context } function l(n, t, i, r, u, f) { var l, c, s, a; if (typeof i != "number" && (f = u, u = r, r = i, i = 0), r == null || r.length == 0) return ""; for (var e = "", h = new String(""), o = r.indexOf("@"); o != -1 && o != r.lastIndexOf("@");) { if (l = r.substring(0, o), h += r.substring(0, o), r = r.substring(o + 1, r.length), c = r.indexOf("@"), c < 0) return ""; if (s = "", a = "", e = r.substring(0, c), e.contains(".") && (e = e.substring(0, e.indexOf("."))), s = n.getWindowContext(t, i, e, u), s.length == 0 && (e.startsWith("#") || e.startsWith("$")) && (s = n.getContext(e)), s.length == 0) { if (!f) return ""; h += " NULL " } else h += s; r = r.substring(c + 1, r.length); o = r.indexOf("@") } return h + r } function a(n, i) { if (i) { if (n == t.DigitButLast4) return i.replace(/[^a-zA-Z0-9\.\-\@]/gi, "").replace(/[0-9](?=[\w\.\-\@]{4})/g, "*"); if (n == t.DigitButFirstLast4) return i.replace(/[^a-zA-Z0-9\.\-\@\s]/gi, "").replace(/(?<=[\w\.\-\@\s]{4})[0-9](?=[\w\.\-\@\s]{4})/g, "*"); if (n == t.AlphanumButLast4) return i.replace(/[^a-zA-Z0-9\.\s\@\-]/gi, "").replace(/[a-zA-Z0-9\s\.\@\-](?=[a-zA-Z0-9\s\.\@\-]{4})/g, "*"); if (n == t.AlphaNumButFirstLast4) return i.replace(/[^a-zA-Z0-9\@\.\s\-]/gi, "").replace(/(?<=[a-zA-Z0-9\@\.\s\-]{4})([\w]|[\W])(?=[a-zA-Z0-9\s\@\.\-]{4})/g, "*") } } function v() { return u } function y(n) { n && n.toString().length != 0 || (n = 50); u = n } function p() { return f } function w(n) { f = n } function b(n, t, i, r) { if (n == null || i == null) throw new IllegalArgumentException("Require Context"); var u = null; return r ? (u = n.getContext("#" + i), u.length == 0 && (u = n.getContext("$" + i))) : (u = n.getContext("P" + t + "|" + i), u.length == 0 && (u = n.getContext("P|" + i))), u == null ? "" : u } function k(n, t) { var i = ""; return t > 0 && (i += n.getWindowContext(t, "WindowName", !1) + "  "), i } function d(n) { var t, u, i; if (n == null) throw new Error("Require Context"); t = []; for (u in n) u.startsWith(r + "|") && t.push(u); while (t.length > 0) i = t.pop(), n[i] = null, delete n[i], i = null } function g(n, t) { if (isNaN(n) || n === null) return "0"; var i = n.toString(); return i.contains(t) && (i = i.split(t).join("")), i } function e(n, t) { var i = [], r, u; return i = n.split("."), r = Globalize.format(Number(i[0]), "N", Globalize.cultureSelector), u = i[1] === "" ? ".0" : i[1], r.substring(0, r.length - 3) + t + u } function nt(t, i, r) { return i = n.Env.removeCultCommaDot(i, t.thousendSeprator), i = i.split(t.decimalSeprator).join("."), i = t.format.GetFormatedValue(i), r === n.DisplayType.Amount ? i = Globalize.format(Number(i), "N", Globalize.cultureSelector) : r === n.DisplayType.Number && (i = e(i.toString(), t.decimalSeprator)), i } function tt() { return Date.now } function it(n) { var t = ""; return t = typeof n != "string" ? o(n) : n, i() == t } function o(n) { if (n != null) { var t = n.getContext("#AD_Language"); if (t != null && t.length > 0) return t } return i() } function i() { return "en_US" } function rt(n) { return n == null || n.toString().trim() == "" ? 0 : isNaN(n) ? 0 : n > 0 ? 1 : n < 0 ? -1 : 0 } function ut(n) { window.open(n) } function s(n) { return 1.1.toLocaleString(n).substring(1, 2) } function ft(n) { var t = window.navigator.language; return (n && n != "" && (t = n), s(t) != ",") ? !0 : !1 } var r = 1, u = 50, f = 400, t = { DigitButLast4: "904", DigitButFirstLast4: "944", AlphanumButLast4: "A04", AlphaNumButFirstLast4: "A44" }; return { getWindowNo: h, getCtx: c, parseContext: l, getWINDOW_PAGE_SIZE: v, setWINDOW_PAGE_SIZE: y, setScreenHeight: w, getScreenHeight: p, getPreference: b, getHeader: k, clearWinContext: d, removeCultCommaDot: g, numberCultureValueFormat: e, numberDisplay: nt, isBaseLanguage: it, getAD_Language: o, getBaseAD_Language: i, currentTimeMillis: tt, signum: rt, startBrowser: ut, isDecimalPoint: ft, getDecimalSeparator: s, ZERO: 0, ONE: 1, ONEHUNDRED: 100, NL: "\r\n", SHOW_CLIENT_ORG: 0, SHOW_CLIENT_ONLY: 1, SHOW_ORG_ONLY: 2, HIDE_CLIENT_ORG: 3, NULLString: "NULLValue", approveCol: "IsApproved", getObscureValue: a } }(); n.AEnv = function () { function s(n, i, r) { var u = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function h(t, i, r) { n.dataContext.getWindowJString({ windowNo: t, AD_Window_ID: i }, r) } function c(n) { return t('<button class="vis-controls-txtbtn-table-td2" ' + (n ? "disabled" : "") + ' ><i class="vis vis-find" /><\/button>') } function l(i) { var r = t("<ul class='vis-apanel-rb-ul'>"); return typeof i[n.Actions.zoom] != "undefined" && (r.append(t("<li data-action='" + n.Actions.zoom + "' style='opacity:" + (i[n.Actions.zoom] ? .7 : 1) + "'><i data-action='" + n.Actions.zoom + "' class='fa fa-search-plus'><\/i><span data-action='" + n.Actions.zoom + "'>" + n.Msg.getMsg("Zoom") + "<\/span><\/li>")), i[n.Actions.addnewrec] && r.append(t("<li data-action='" + n.Actions.addnewrec + "' style='opacity:" + (i[n.Actions.zoom] ? .7 : 1) + "'><i data-action='" + n.Actions.addnewrec + "' class='fa fa-plus'><\/i><span data-action='" + n.Actions.addnewrec + "'>" + n.Msg.getMsg("AddNew") + "<\/span><\/li>"))), i[n.Actions.preference] && r.append(t("<li data-action='" + n.Actions.preference + "'><i data-action='" + n.Actions.preference + "' class='fa fa-cog'><\/i><span data-action='" + n.Actions.preference + "'>" + n.Msg.getMsg("Preference") + "<\/span><\/li>")), i[n.Actions.refresh] && r.append(t("<li data-action='" + n.Actions.refresh + "'><i data-action='" + n.Actions.refresh + "' class='fa fa-refresh'><\/i><span data-action='" + n.Actions.refresh + "'>" + n.Msg.getMsg("Requery") + "<\/span><\/li>")), i[n.Actions.add] && r.append(t("<li data-action='" + n.Actions.add + "'><i data-action='" + n.Actions.add + "' class='vis vis-addbp'><\/i><span data-action='" + n.Actions.add + "'>" + n.Msg.getMsg("Add") + "<\/span><\/li>")), i[n.Actions.update] && r.append(t("<li data-action='" + n.Actions.update + "'><i data-action='" + n.Actions.update + "' class='vis vis-updatebp'><\/i><span data-action='" + n.Actions.update + "'>" + n.Msg.getMsg("Update") + "<\/span><\/li>")), i[n.Actions.remove] && r.append(t("<li data-action='" + n.Actions.remove + "'><i data-action='" + n.Actions.remove + "' class='fa fa-arrow-left'><\/i><span data-action='" + n.Actions.remove + "'>" + n.Msg.getMsg("Clear") + "<\/span><\/li>")), i[n.Actions.contact] && r.append(t("<li data-action='" + n.Actions.contact + "'><i data-action='" + n.Actions.contact + "' class='fa fa-user'><\/i><span data-action='" + n.Actions.contact + "'>" + n.Msg.getMsg("Contact") + "<\/span><\/li>")), r } function a() { if (i == null) { i = !1; var u = 645; n.MRole.getIsTableAccess(u, !0) ? i = !0 : (u = 644, n.MRole.getIsTableAccess(u, !0) && (i = !0)); i && t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/GetWorkflowWindowID", data: { AD_Table_ID: u }, success: function (n) { var t = JSON.parse(n); t && !isNaN(t) && (r = parseInt(t)); r == 0 && (r = 297) } }) } return i } function v(t, i) { var u = null; t != 0 && i != 0 && (u = new n.Query("AD_WF_Process"), u.addRestriction("AD_Table_ID", n.Query.prototype.EQUAL, t), u.addRestriction("Record_ID", n.Query.prototype.EQUAL, i), n.viewManager.startWindow(r, u)) } function f(i, r) { var f = null, e = 0, o = 0, u = null, s; (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetZoomWindowID", data: { AD_Table_ID: i }, success: function (t) { u = (new n.DB.DataReader).toJson(t) } }), u.read() && (f = u.get(0).toString(), e = n.Utility.Util.getValueOfInt(u.getInt(1)), o = n.Utility.Util.getValueOfInt(u.getInt(2))), u.dispose(), f != null && e != 0) && (o == 0 || (s = f + "_ID=" + r, e = n.ZoomTarget.getZoomAD_Window_ID(f, 0, s, !0), e != 0)) && n.viewManager.startWindow(e, n.Query.prototype.getEqualQuery(f + "_ID", r)) } function y(t, i, r) { var e = null, h = 0, l = 0, s = 0, c = [], u, v, a; if (c[0] = new n.DB.SqlParam("@AD_Table_ID", t), c[1] = new n.DB.SqlParam("@AD_WF_Activity_ID", r), u = null, u = o("VIS_146", c), u.read()) e = u.get(0).toString(), h = n.Utility.Util.getValueOfInt(u.getInt(1)), l = n.Utility.Util.getValueOfInt(u.getInt(2)), s = n.Utility.Util.getValueOfInt(u.getInt(3)); else { f(t, i); return } if (u.dispose(), e != null || h != 0 || s == null || s == 0) { if (s != null && s != 0) { v = new n.Query; n.viewManager.startWindow(s, n.Query.prototype.getEqualQuery(e + "_ID", i)); return } (l == 0 || (a = e + "_ID=" + i, h = n.ZoomTarget.getZoomAD_Window_ID(e, 0, a, !0), h != 0)) && n.viewManager.startWindow(h, n.Query.prototype.getEqualQuery(e + "_ID", i)) } } var i = null, r = 0, u = n.Application.contextUrl, e = u + "JsonData/JDataSetWithCode", p = u + "JsonData/ExecuteNonQuer", o = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, s(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; return { getGridWindow: h, getContextPopup: l, getZoomButton: c, getIsWorkflowProcess: a, startWorkflowProcess: v, zoom: f, wfzoom: y } }(); r.prototype.typeList = ["", "", "number", "", "date", "", "time", "", "choice"]; r.prototype.modifierList = ["", "", "currency", "", "percent", "", "integer"]; r.prototype.dateModifierList = ["", "", "short", "", "medium", "", "long", "", "full"]; r.prototype.allFormats = { currency: "C", decimal: "D", general: "G", number: "N", percent: "P", shortdate: "d", longdate: "D", shorttime: "t", longtime: "T", fulltime: "T", fulldate: "D", mediumdate: "d", mediumtime: "t", choice: "" }; r.prototype.applyPattern = function (n) { var r, t, u, i; if (!this.cmpreFormat(n)) { this.pattern = n; return } for (r = [], t = new StringBuilder(""), u = 0; u < n.length; ++u)i = n[u], i == "{" ? t.length() == 0 ? t.append(i) : (r.push(t.toString()), t.clear(), t.append(i)) : i == "}" ? (t.append(i), r.push(t.toString()), t.clear()) : u == n.length ? (r.add(t.toString()), t.clear()) : t.append(i); this.pattern = this.parsePattren(r) }; r.prototype.parsePattren = function (n) { for (var r = new StringBuilder(" "), t, i = 0; i < n.length; i++) { if (t = n[i], t.startsWith("{") && this.cmpreFormat(t)) { t = this.getFormat(t.split(",")); r.append(t); continue } r.append(t) } return r.toString() }; r.prototype.getFormat = function (n) { var i = new StringBuilder(n[0]), t = ""; switch (this.findKeyword(n[1], this.typeList)) { case 0: break; case 1: case 2: switch (this.findKeyword(n[2].toString(), this.modifierList)) { case 0: t = this.allFormats.number; break; case 1: case 2: t = this.allFormats.currency; break; case 3: case 4: t = this.allFormats.percent; break; case 5: case 6: t = this.allFormats.decimal; break; default: t = this.allFormats.number }break; case 3: case 4: switch (this.findKeyword(n[2], this.dateModifierList)) { case 0: t = this.allFormats.shortdate; break; case 1: case 2: t = this.allFormats.shortdate; break; case 3: case 4: t = this.allFormats.mediumdate; break; case 5: case 6: t = this.allFormats.longdate; break; case 7: case 8: t = this.allFormats.fulldate; break; default: t = n[3].ToString() }break; case 5: case 6: switch (this.FindKeyword(n[2].ToString(), this.dateModifierList)) { case 0: t = this.allFormats.shorttime; break; case 1: case 2: t = this.allFormats.shorttime; break; case 3: case 4: t = this.allFormats.mediumtime; break; case 5: case 6: t = this.allFormats.mediumtime; break; case 7: case 8: t = this.allFormats.mediumtime; break; default: t = n[2].ToString() }break; case 7: case 8: try { t = n[3]; this.allFormats.choice = n[3].ToString() } catch (r) { throw new ArgumentException("Choice Pattern incorrect"); } break; default: throw new ArgumentException("unknown format type at "); }return n = null, t = "", i.append(t).append("}"), i.toString() }; r.prototype.format = function (n) { var i = this.pattern, t, r; for (this.pattern = null, t = 0; t < n.length; t++)r = new RegExp("\\{" + t + "\\}", "gm"), i = i.replace(r, n[t]); return i }; r.prototype.cmpreFormat = function (n) { return n.contains("number,") || n.contains("date,") || n.contains("time,") || n.contains("custom,") ? !0 : !1 }; r.prototype.findKeyword = function (n, t) { for (var i = 0; i < t.length; i++)if (n.equals(t[i])) return i; return -1 }; n.DB = { QUOTE: "'", getDBDateFormat: function (n, t, i) { var r = "", u; return i || n.setMinutes(-n.getTimezoneOffset()), r = n.toISOString(), u = r.split("T"), r = u[0], t && (r += " " + u[1].substring(0, u[1].length - 5)), r }, to_date: function (n, t) { time = n && n.toString().length > 0 ? n instanceof Date ? n : new Date(n) : null; time.toString() == "Invaild Date" && (time = null); var i = "", r = ""; if (1) { if (time == null) return t ? "TRUNC(SysDate)" : "SysDate"; i += "TO_DATE('"; r = time; t ? (r = this.getDBDateFormat(time, !1, !1), i += r, i += "','YYYY-MM-DD')") : (r = this.getDBDateFormat(time, !0, !0), i += r, i += "','YYYY-MM-DD HH24:MI:SS')") } else if (DatabaseType.IsPostgre) { if (time == null) return t ? "TRUNC(SysDate)" : "SysDate"; i = new StringBuilder("TO_DATE('"); t ? (r = time.Value.ToString("yyyy-MM-dd"), i.Append(r), i.Append("','YYYY-MM-DD')")) : (r = time.Value.ToString("yyyy-MM-dd HH:mm:ss"), i.Append(r), i.Append("','YYYY-MM-DD HH24:MI:SS')")) } else if (DatabaseType.IsMSSql) { if (time == null) return t ? "CAST(STR(YEAR(Getdate()))+'-'+STR(Month(Getdate()))+'-'+STR(Day(Getdate())) AS DATETIME)" : "getdate()"; i = new StringBuilder("CAST('"); r = time.ToString(); t ? (i.Append(r.Substring(0, 10)), i.Append("' AS DATETIME)")) : (i.Append(r.Substring(0, r.IndexOf("."))), i.Append("' AS DATETIME)")) } return i.toString() }, to_char: function (t, i) { var r = "TRIM(TO_CHAR("; return r = r.concat(t), n.DisplayType.IsNumeric(i) ? r = i == n.DisplayType.Amount ? r.concat(",'9G999G999G999G990D00'") : r.concat(",'TM9'") : n.DisplayType.IsDate(i) && (r = r.concat(",'").concat("yyyy-MM-dd").concat("'")), r = r.concat("))"), r.toString() }, to_string: function (n, t) { var i, r, u, f; if (n == null && n.length == 0) return "NULL"; for (t != null && (t = 0), i = n, t != 0 && i.length > t && (i = n.substring(0, t)), r = new StringBuilder, r.append(this.QUOTE), u = 0; u < i.length; u++)f = i.charAt(u), f == this.QUOTE ? r.append("''") : r.append(f); return r.append(this.QUOTE), i = r.toString(), r.clear(), i }, executeDataSet: function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u; return i && (o.param = i), u = null, f(arguments, o, e, function (t) { u = (new n.DB.DataSet).toJson(t); e && r(u) }), u }, executeDataReader: function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u; return i && (o.param = i), u = null, f(arguments, o, e, function (t) { u = (new n.DB.DataReader).toJson(t); e && r(u) }), u }, executeReader: function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u; return i && (o.param = i), u = null, f(arguments, o, e, function (t) { u = (new n.DB.DataReader).toJson(t); e && r(u) }), u }, executeDataReaderPaging: function (t, i, r, u, e) { var s = e ? !0 : !1, h = { sql: t, page: i, pageSize: r }, o; return u && (h.param = u), o = null, f(arguments, h, s, function (t) { o = (new n.DB.DataReader).toJson(t); s && e(o) }), o }, executeDataSetPaging: function (t, i, r, u, e) { var s = e ? !0 : !1, h = { sql: t, page: i, pageSize: r }, o; return u && (h.param = u), o = null, f(arguments, h, s, function (t) { o = (new n.DB.DataSet).toJson(t); s && e(o) }), o }, executeScalar: function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u = null; return f(arguments, o, e, function (t) { var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; e && r(u) }), u }, executeQuery: function (n, t, i) { var u = i ? !0 : !1, r = null, f = { sql: n }; return t && (f.param = t), a(arguments, f, u, function (n) { r = JSON.parse(n); u && i(r) }), r }, executeQueries: function (n, t, i) { var u = i ? !0 : !1, r = null, f = { sql: n.join("/"), param: t }; return v(arguments, f, u, function (n) { r = JSON.parse(n); u && i(r) }), r } }; s.prototype.setIsDate = function (n) { this.isDate = n }; s.prototype.setIsByteArray = function (n) { this.isByteArray = n }; e.prototype.toJson = function (i) { var r = i, u, f; for (typeof i == "string" && (r = JSON.parse(i)), r = t.isArray(r) ? r : [r], u = 0; u < r.length; u++)f = new n.DB.DataTable, f.toJson(r[u]), this.tables.push(f); return r = null, this }; e.prototype.getTable = function (n) { return n > -1 && n < this.tables.length ? this.tables[n] : null }; e.prototype.getTables = function () { return this.tables }; e.prototype.dispose = function () { for (var n = this.tables.length; n > 0; n--)this.tables.pop().dispose(); this.tables.length = 0; this.tables = null }; u.prototype.toJson = function (t) { var i, r; if (t) { if (this.totalRecord = t.records, this.totalPage = t.total, this.page = t.page, t.columns) { for (i = 0; i < t.columns.length; i++)this.columnsName[i] = t.columns[i].name; for (r = 0; r < t.rows.length; r++)this.rows.push(new n.DB.DataRow(t.rows[r], this)); this.columns = t.columns } this.count = this.rows.count } t = null }; u.prototype.getRowCount = function () { return this.rows.length }; u.prototype.getColumnCount = function () { return this.columns.length }; u.prototype.getRow = function (n) { return n > -1 && n < this.rows.length ? this.rows[n] : null }; u.prototype.getRows = function () { return this.rows }; u.prototype.getColumnsName = function () { return this.columnsName }; u.prototype.dispose = function () { for (this.count = 0, this.totalPage = 0, this.page = 1, this.columns.length = 0, this.columns = null; this.rows.length > 0;)this.rows.pop().dispose(); this.rows.length = 0; this.rows = null; this.totalRecord = 0 }; o.prototype.getCell = function (n) { var t = -1, i = ""; isNaN(n) ? (n = n.toLowerCase(), t = this.parent.columnsName.indexOf(n), i = n) : (t = n, i = this.parent.columnsName[t]); var r = this.parent.columns[t], u = r.type, f = this.cells[i]; return u == "system.datetime", f }; o.prototype.getJSCells = function () { return this.cells }; o.prototype.dispose = function () { this.cells.length = 0; this.cells = null; this.id = null; this.parent = null }; i.prototype.toJson = function (i) { for (var r = JSON.parse(i), f, r = t.isArray(r) ? r : [r], u = 0; u < r.length; u++)f = new n.DB.DataTable, f.toJson(r[u]), this.tables.push(f), u === 0 && (this.curTable = this.tables[u]); return r = null, this }; i.prototype.read = function () { return this.curTable ? ++this.rowIndex >= this.curTable.getRowCount() ? !1 : !0 : !1 }; i.prototype.getCell = function (n) { return this.curTable.getRow(this.rowIndex).getCell(n) }; i.prototype.get = function (n) { return this.curTable.getRow(this.rowIndex).getCell(n) }; i.prototype.getString = function (n) { var t = this.curTable.getRow(this.rowIndex).getCell(n); return t == null ? "" : t.toString() }; i.prototype.getInt = function (n) { var t = this.curTable.getRow(this.rowIndex).getCell(n); return t == null ? 0 : parseInt(t) }; i.prototype.getDecimal = function (n) { var t = this.curTable.getRow(this.rowIndex).getCell(n); return t == null ? 0 : parseFloat(t) }; i.prototype.getDateTime = function (n) { return this.curTable.getRow(this.rowIndex).getCell(n) }; i.prototype.setTableIndex = function (n) { this.rowIndex = 0; this.curTable = this.tables[n] }; i.prototype.close = function () { }; i.prototype.dispose = function () { this.curTable = null; for (var n = this.tables.length; n > 0; n--)this.tables.pop().dispose(); this.tables.length = 0; this.tables = null; this.rowIndex = null }; h.prototype.max = function (n, t) { return n == null ? t : t == null ? n : n > t ? n : t }; c.prototype.isDecimalSeparatorDot = function (n) { return n && this.List[n] != undefined ? this.List[n].decimalSeparator : null }; n.DB.DataSet = e; n.DB.DataTable = u; n.DB.DataRow = o; n.DB.SqlParam = s; n.DB.DataReader = i; n.MessageFormat = r; n.TimeUtil = h; n.CultureSeparator = c }(VIS, jQuery); VIS.Logging = VIS.Logging || {}, function (n) { function t(n, t) { this.name = n; this.value = t } function e(n, t) { this._level = n; this._sequenceNumber; this._sourceClassName; this._sourceMethodName; this._message = t; this._lineNumber; this._loggerName } function o() { if (o.prototype.singleInstance) return o.prototype.singleInstance; o.prototype.singleInstance = this } function u() { if (u.prototype.singletonInstance) return u.prototype.singletonInstance; u.prototype.singletonInstance = this } function s() { this.offValue = t.OFF.getIntValue(); this.logLevel = t.ALL; this.formatter; this.filter } function f() { if (f.prototype.singleInstance) return f.prototype.singleInstance; this.setFormatter(u.get()); this.setLevel(t.INFO); this.setFilter(o.get()); this.ERROR_SIZE = 20; this.m_errors = []; this.m_history = []; this.LOG_SIZE = 100; this.m_logs = []; this.m_issueError = !0; f.prototype.singleInstance = this } function i(n) { this.levelValue = t.INFO.getIntValue(); this.name = n; this.levelObject; this.handlers = []; this.kids = []; this.manager = r.getLogManager(); this.parent; this.offValue = t.OFF.getIntValue(); this.filter } function c() { i.call(this, ""); this.setLevel(t.INFO) } function r() { if (r.prototype.singleInstance) return r.prototype.singleInstance; this.emptyHandlers = []; this.loggers = {}; this.defaultLevel = t.INFO; this.rootLogger; r.prototype.singleInstance = this } function h(n) { i.call(this, n) } function l() { var e = null, n = t.INFO, h = [t.OFF, t.SEVERE, t.WARNING, t.INFO, t.CONFIG, t.FINE, t.FINER, t.FINEST, t.ALL], c = function (n) { if (n != null) { var t = i.getLogger(""); t.addHandler(n); e.push(n) } }, d = function () { return t.ALL.getIntValue() == n.getIntValue() }, l = function () { var r, t, n; if (e == null) { e = []; try { for (r = i.getLogger(""), t = r.getHandlers(), n = 0; n < t.length; n++)e.contains(t[n]) || e.Add(t[n]) } catch (s) { } f.get(!1) == null && c(f.get(!0)); v(u.get()); y(o.get()) } }, s = function (t) { var i, r; if (t != null) { for (e == null && l(!0), i = 0; i < e.length; i++)r = e[i], r.setLevel(t); t.getIntValue() != n.getIntValue() && a(t, null); n = t } }, a = function (n, t) { var f, e, o, u, s; if (n != null) { f = r.getLogManager(); e = f.getLoggerNames(); for (o in e) u = o, (t == null || u.indexOf(t) != -1) && (s = i.getLogger(u), s.setLevel(n)) } }, v = function (n) { for (var i, t = 0; t < e.length; t++)i = e[t], i.setFormatter(n) }, y = function (n) { for (var i, t = 0; t < e.length; t++)i = e[t], i.setFilter(n) }, p = function () { return n }, w = function (n) { if (n) for (var t = 0; t < h.length; t++)if (h[t].getName().equals(n)) { s(h[t]); return } }, g = function () { return n.getIntValue() }, b = function () { var n = r.getLogManager(); n.reset() }, k = function (i) { if (i) s(n); else { var r = n; s(t.OFF); n = r } }; return { initialize: l, addHandler: c, setLevel: s, setLevelByString: w, getLevel: p, shutdown: b, enable: k, getIsLevelAll: function () { return t.ALL.getIntValue() == n.getIntValue() }, getIsLevelFinest: function () { return t.FINEST.getIntValue() >= n.getIntValue() }, getIsLevelFiner: function () { return t.FINER.getIntValue() >= n.getIntValue() }, getIsLevelFine: function () { return t.FINE.getIntValue() >= n.getIntValue() }, getIsLevelInfo: function () { return t.INFO.IntValue() >= n.IntValue() } } } t.prototype.getIntValue = function () { return this.value }; t.prototype.getName = function () { return this.name }; t.prototype.getLevel = function (n) { return t.OFF.getIntValue() == n ? t.OFF : t.SEVERE.getIntValue() == n ? t.SEVERE : t.WARNING.getIntValue() == n ? t.WARNING : t.INFO.getIntValue() == n ? t.INFO : t.CONFIG.getIntValue() == n ? t.CONFIG : t.FINE.getIntValue() == n ? t.FINE : t.FINER.getIntValue() == n ? t.FINER : t.FINEST.getIntValue() == n ? t.FINEST : t.ALL.getIntValue() == n ? t.ALL : void 0 }; t.OFF = new t("OFF", 9999); t.SEVERE = new t("SEVERE", 1e3); t.WARNING = new t("WARNING", 900); t.INFO = new t("INFO", 800); t.CONFIG = new t("CONFIG", 700); t.FINE = new t("FINE", 600); t.FINER = new t("FINER", 500); t.FINEST = new t("FINEST", 400); t.ALL = new t("ALL", 0); e.prototype.getMessage = function () { return this._message }; e.prototype.setMessage = function (n) { this._message = n }; e.prototype.getSourceClassName = function () { return this._sourceClassName }; e.prototype.setSourceClassName = function (n) { this._sourceClassName = n }; e.prototype.getSourceMethodName = function () { return this._sourceMethodName }; e.prototype.setSourceMethodName = function (n) { this._sourceMethodName = n }; e.prototype.getLineNumber = function () { return this._lineNumber }; e.prototype.setLineNumber = function (n) { this._lineNumber = n }; e.prototype.getLoggerName = function () { return this._loggerName }; e.prototype.setLoggerName = function (n) { this._loggerName = n }; e.prototype.getLevel = function () { return this._level }; o.prototype.singleInstance = null; o.get = function () { return o.prototype.singleInstance ? o.prototype.singleInstance : new o }; o.prototype.getIsLoggable = function (n) { var i, r; return n.getLevel() === t.SEVERE || n.getLevel() === t.WARNING ? !0 : (i = n.getLoggerName(), i && i.startsWith("System.")) ? !1 : (r = n.sourceClassName, r && r.startsWith("System.")) ? !1 : !0 }; u.prototype.singletonInstance = null; u.prototype.NL = "/n"; u.get = function () { return u.prototype.singletonInstance ? u.prototype.singletonInstance : new u }; u.prototype.format = function (n) { var i = new StringBuilder, r = Date.now.toString("yyyy-MM-dd hh:mm:ss.ms"), u; return r = r + "00", n.getLevel() == t.prototype.SEVERE ? (i.append("===========> "), i.append("    (SEVERE)   ")) : n.getLevel() == t.WARNING ? (i.append("-----------> "), i.append("    (WARNING)  ")) : (i.append(r.Substring(11, 12)), u = 11, n.getLevel() == t.INFO ? i.append("    (INFO)     ") : n.getLevel() == t.CONFIG ? i.append("    (CONFIG)   ") : n.getLevel() == t.FINE ? i.append("    (FINE)     ") : n.getLevel() == t.FINER ? i.append("    (FINER)    ") : n.getLevel() == t.FINEST && i.append("    (FINEST)   ")), i.append(n.message), i.toString() }; u.prototype.getHead = function () { var n = (new StringBuilder).append("*** ").append(DateTime.Now.ToString()).append(" VAdvantage Log ").append(" ***").append("\n").append("ViennaAdvantage"); return n.toString() }; u.prototype.getTail = function () { var n = (new StringBuilder).append("*** ").append(" VAdvantage Log").append(" ***"); return n.toString() }; u.prototype.getClassMethod = function (n) { var i = "", t = n.getLoggerName(), r, u; return ((t == null || t.indexOf("default") != -1 || t.indexOf("global") != -1) && (t = n.getSourceClassName()), t != null ? (r = t.lastIndexOf("."), i += r != -1 ? t.substring(r + 1) : t) : i += n.getLoggerName(), n.getSourceMethodName() != null && (i += "." + n.getSourceMethodName()), u = i, u.equals("Trace.printStack")) ? "" : u }; u.prototype.getParameters = function (n) { var r = "", i = n.getParameters(), t; if (i != null && i.length > 0) for (t = 0; t < i.length; t++)t > 0 && (r += ", "), r += i[t]; return r }; u.prototype.getExceptionTrace = function () { try { } catch (n) { } return "" }; s.prototype.publish = function () { }; s.prototype.close = function () { }; s.prototype.flush = function () { }; s.prototype.setLevel = function (n) { if (n == null) throw new NullReferenceException("No Level"); this.logLevel = n }; s.prototype.getLevel = function () { return this.logLevel }; s.prototype.getFilter = function () { return this.filter }; s.prototype.setFilter = function (n) { this.filter = n }; s.prototype.getIsLoggable = function (n) { var i = this.getLevel().getIntValue(), t; return n.getLevel().getIntValue() < i || i == this.offValue ? !1 : (t = this.getFilter(), t == null) ? !0 : t.getIsLoggable(n) }; s.prototype.getFormatter = function () { return this.formatter }; s.prototype.setFormatter = function (n) { this.formatter = n }; n.Utility.inheritPrototype(f, s); f.prototype.singleInstance = null; f.get = function (n) { return f.prototype.singleInstance ? f.prototype.singleInstance : n ? new f : null }; f.prototype.setLevel = function (n) { n != null && (n == t.OFF ? this.$super.setLevel.call(this, t.SEVERE) : n == t.ALL || n == t.FINEST || n == t.FINER ? this.$super.setLevel.call(this, t.FINE) : this.$super.setLevel.call(this, n)) }; f.prototype.publish = function (n) { var i, r, u, f, e; if (this.getIsLoggable(n) && this.m_logs != null) { if (this.m_logs.length >= this.LOG_SIZE && this.m_logs.shift(), this.m_logs.push(n), n.getLevel() == t.SEVERE) { for (this.m_errors.length >= this.ERROR_SIZE && (this.m_errors.shift(), this.m_history.shift()), this.m_errors.push(n), i = [], r = 0; r < this.m_logs.length; r++)if (u = this.m_logs[r], u.getLevel() == t.SEVERE) if (i.length == 0) i.push(u); else break; else if (i.push(u), i.length > 10) break; this.m_history.push(i); this.m_issueError && (f = n.getLoggerName(), e = n.getSourceMethodName()) } console.log(n) } }; f.prototype.close = function () { this.m_logs != null && (this.m_logs.length = 0, this.m_logs = null); this.m_errors != null && (this.m_errors.length = 0, this.m_errors = null); this.m_history != null && (this.m_history.length = 0, this.m_history = null) }; f.prototype.getColumnNames = function () { var n = [4]; return n[0] = "Time", n[1] = "Level", n[2] = "Class.Method", n[3] = "Message", n }; f.prototype.getRecords = function (n) { return n ? this.m_errors.slice() : this.m_logs.slice() }; f.prototype.getLogData = function (n) { for (var f = this.getRecords(n), e = [], r, t, i = 0, o = f.length; i < o; i++)r = f[i], t = [], t.push((new Date).toString()), t.push(r.getLevel().getName()), t.push(u.get().getClassMethod(r)), t.push(r.getMessage()), e.push(t); return e }; f.prototype.resetBuffer = function (n) { this.m_errors.length = 0; this.m_history.length = 0; n || (this.m_logs.length = 0) }; i.prototype.setFilter = function (n) { this.filter = n }; i.prototype.getFilter = function () { return this.filter }; i.prototype.log = function (n, i, r) { var i = i, f, u, o, s; if ((r && (r.message && (i += " => " + r.message), r.stack && (i += " ===> " + r.stack)), !(n.getIntValue() < this.levelValue) && this.levelValue != t.OFF.getIntValue()) && (f = new e(n, i), f.setLoggerName(this.name), this.filter == null || this.filter.getIsLoggable(f))) for (u = this; u != null;) { if (o = u.getHandlers(), o != null) for (s = 0; s < o.length; s++)o[s].publish(f); u = u.getParent() } }; i.prototype.getParent = function () { return this.parent }; i.prototype.getHandlers = function () { return this.handlers == null ? emptyHandlers : this.handlers }; i.prototype.getName = function () { return this.name }; i.prototype.setLevel = function (n) { this.levelObject = n; this.levelValue = n.getIntValue() }; i.prototype.getLevel = function () { return this.levelObject }; i.prototype.addHandler = function (n) { this.handlers == null && (handlers = []); this.handlers.push(n) }; i.prototype.removeHandler = function (n) { n != null && this.handlers != null && this.handlers.remove(n) }; i.getLogger = function (n) { var u = r.getLogManager(), t = u.getLogger(n); return t == null && (t = new i(n), u.addLogger(t), t = u.getLogger(n)), t }; i.prototype.setParent = function (n) { this.parent = n }; i.prototype.getIsLoggable = function (n) { return n.getIntValue() < levelValue || levelValue == offValue ? !1 : !0 }; i.prototype.fine = function (n) { t.FINE.getIntValue() < this.levelValue || this.log(t.FINE, n) }; i.prototype.info = function (n) { t.INFO.getIntValue() < this.levelValue || this.log(t.INFO, n) }; i.prototype.config = function (n) { t.CONFIG.getIntValue() < this.levelValue || this.log(t.CONFIG, n) }; i.prototype.finer = function (n) { t.FINER.getIntValue() < this.levelValue || this.log(t.FINER, n) }; i.prototype.finest = function (n) { t.FINEST.getIntValue() < this.levelValue || this.log(t.FINEST, n) }; i.prototype.severe = function (n) { t.SEVERE.getIntValue() < this.levelValue || this.log(t.SEVERE, n) }; i.prototype.warning = function (n) { t.WARNING.getIntValue() < this.levelValue || this.log(t.WARNING, n) }; i.prototype.saveError = function (n, t) { return this.saveError(n, t.message, !0) }; i.prototype.saveError = function (n, t, i) { return i && this.warning(n + " " + t.message), !0 }; i.prototype.getIsLevelFinest = function () { return l.getIsLevelFinest() }; n.Utility.inheritPrototype(c, i); r.prototype.singleInstance = null; r.prototype.addLogger = function (n) { var t = n.getName(), i = null; return (t in this.loggers && (i = loggers[t]), i != null) ? !1 : (this.loggers[t] = n, n instanceof c || n.setParent(this.rootLogger), !0) }; r.prototype.reset = function () { for (var n in this.loggers) ResetLogger(n) }; r.prototype.resetLogger = function (n) { var t = this.getLogger(n), r, i, u; if (t != null) { for (r = t.getHandlers(), i = 0; i < r.length; i++) { u = r[i]; t.removeHandler(u); try { u.close() } catch (f) { } } n != null && n.equals("") ? t.setLevel(this.defaultLevel) : t.setLevel(null) } }; r.prototype.getLogger = function (n) { return n in this.loggers ? this.loggers[n] : null }; r.getLogManager = function () { if (!r.prototype.singleInstance) { new r; var n = r.prototype.singleInstance; n.rootLogger = new c; n.addLogger(n.rootLogger) } return r.prototype.singleInstance }; r.prototype.getLoggerNames = function () { return this.loggers }; n.Utility.inheritPrototype(h, i); h.getVLogger = function (t) { var f = r.getLogManager(), i, u; return (t || (t = ""), i = f.getLogger(t), i != null && i instanceof h) ? i : (u = new h(t), u.setLevel(n.Logging.VLogMgt.getLevel()), f.addLogger(u), u) }; n.Logging.Level = t; n.Logging.LogRecord = e; n.Logging.VLogFilter = o; n.Logging.VLogFormatter = u; n.Logging.VLogErrorBuffer = f; n.Logging.Logger = i; n.Logging.VLogger = h; n.Logging.LogManager = r; n.Logging.VLogMgt = l() }(VIS, jQuery); VIS.Controls = {}, function (n, t) { function st(t, i, r) { var u = null; return n.ajax({ url: ct, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(t) }).done(function (n) { u = n; r && r(n) }), u } function yt(t, i, r) { var u = null; return n.ajax({ url: at, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(t) }).done(function (n) { u = n; r && r(n) }), u } function i(n, r, u, f, e) { if (this instanceof i) this.ctrl = n, this.displayType = r, this.isReadOnly = u, this.colName = f, this.isMandatory = e, this.oldValue = "oldValue", this.visible, this.tag, this.setVisible(!0), this.editingGrid = null; else return new t.controls.IControl(n, r, u, f, e) } function v(r, u, f, e, o, s, h, c, l) { var p = t.DisplayType.String, a; this.obscureType = c; var v = n("<input>", { type: l ? "password" : "text", name: r, maxlength: s }), y = n('<button class="input-group-text" style="display:none"><i class="fa fa-credit-card" /><\/button>'); i.call(this, v, p, f, r, u); f || !e || c ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtn = function (n) { if (n == 0 && c) return this.setReadOnly(!0), y }; this.showObscureButton = function (n) { n && c ? y.css("display", "") : (y.css("display", "none"), y.off("click")) }; this.getBtnCount = function () { return c ? 1 : 0 }; a = this; v.on("change", function (n) { var t, i; n.stopPropagation(); t = v.val(); this.value = t; t !== a.oldValue && (i = { newValue: t, propertyName: a.getName() }, a.fireValueChanged(i), i = null); c && a.setReadOnly(!0) }); v.on("blur", function () { var n = v.val(); a.obscureType && n != "" && a.oldValue == n && (a.ctrl.val(t.Env.getObscureValue(a.obscureType, n)), a.setReadOnly(!0)) }); y.on("click", function () { a.mField.getIsEditable(!0) && (a.setReadOnly(!1, !0, !0), v.val(a.mField.getValue()), v.focus()) }); this.disposeComponent = function () { v.off("change"); v = null; a = null } } function ht(r, u, f, e) { var s, o; r = r != null ? r.replace("[&]", "") : ""; s = ' for="' + u + '"'; e && (s = ""); o = n("<label " + s + "><\/label>"); i.call(this, o, t.DisplayType.Label, !0, e ? u : "lbl" + u); f ? o.text(r).append("<sup>*<\/sup>") : o.text(r); this.disposeComponent = function () { o = null; self = null } } function ft(r, u, f, e) { var s, o; r = r != null ? r.replace("[&]", "") : ""; s = ' for="' + u + '"'; e && (s = ""); o = n("<span " + s + "><\/span>"); i.call(this, o, t.DisplayType.Label, !0, e ? u : "lbl" + u); f ? o.text(r).append("<sup>*<\/sup>") : o.text(r); this.disposeComponent = function () { o = null; self = null; this.format && this.format.dispose(); this.format = null } } function r(r, u, f, e, o, s, h, c, l, a, v, y, p) { function nt() { var i = n("<ul class='vis-apanel-rb-ul'>"); return i.append(n("<li data-action='C'>").text(t.Msg.getMsg("OpenCSV"))), i.append(n("<li data-action='P'>").text(t.Msg.getMsg("OpenPDF"))), i } var w, g; this.actionListner; this.AD_Process_ID = c; this.AD_Form_ID = v; this.description = s; this.help = h; this.text = o; this.isLink = l; this.isRightLink = a; this.actionLink = null; this.isCsv = !1; this.isPdf = !1; this.askUserBGProcess = p; this.isBackgroundProcess = y; this.values = null; this.isIconSet = !0; var k = n("<i style='color:inherit' title='" + o + "'>"), d = n("<span style='color:inherit'>").text(o), tt = t.Application.contextUrl + "Areas/VIS/Images/base/", b = null; l ? a ? (b = n("<li>"), b.append(d).append(k)) : (b = n('<button type="button" class="vis-ev-col-wrap-button vis-ev-col-linkbutton"><\/button>'), b.append(k).append(d)) : (b = n('<button class="vis-ev-col-wrap-button">', { type: "button", name: r }), k.css("margin-right", "8px"), b.append(k).append(d)); this.setIcon = function (n, t) { t ? k.src = n : k.addClass(n) }; r.equals("PaymentRule") ? (this.readReference(195), this.setIcon("vis vis-payment")) : r.equals("DocAction") ? (this.readReference(135), this.setIcon("vis vis-cog")) : r.equals("CreateFrom") ? this.setIcon("vis vis-copy") : r.equals("Record_ID") ? (this.setIcon("vis vis-find"), b.text(t.Msg.getMsg("ZoomDocument"))) : r.equals("Posted") ? (this.readReference(234), this.setIcon("fa fa-line-chart")) : l && (this.isIconSet = !1, this.setIcon("vis vis-action")); i.call(this, b, t.DisplayType.Button, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); w = this; g = null; g = nt(); b.on(t.Events.onClick, function (n) { var u, r, i, f; n.stopPropagation(); u = null; w.isReadOnly || (r = "VIS_81", i = [], i[0] = new t.DB.SqlParam("@AD_Process_ID", c), u = ot(r, i), r = "VIS_149", i = [], i[0] = new t.DB.SqlParam("@AD_Process_ID", c), f = ot(r, i), f == "Y" && t.context.getIsUseCrystalReportViewer() ? w.invokeActionPerformed({ source: w }) : u == "Y" ? k.w2overlay(g.clone(!0)) : w.invokeActionPerformed({ source: w })) }); if (g) g.on("click", "LI", function (t) { var i = n(t.target); i.data("action") == "P" ? (w.isPdf = !0, w.isCsv = !1) : i.data("action") == "C" && (w.isCsv = !0, w.isPdf = !1); w.invokeActionPerformed({ source: w }) }); this.setText = function (n) { var t, i; if (n == null) { d.text(""); return } t = n.indexOf("&"); t != -1 && (i = n.toUpperCase().charAt(t + 1), i != " " && (n = n.substring(0, t) + n.substring(t + 1))); d.text(n) }; this.setLayout = function (n) { this.mField && (n ? this.mField.getHeaderHeadingOnly() ? k.remove() : this.mField.getHeaderIconOnly() && d.remove() : this.mField.getIsFieldOnly() && this.mField.getShowIcon() ? d.remove() : this.mField.getIsFieldOnly() && k.remove()) }; this.disposeComponent = function () { b.off(t.Events.onClick); b = null; w = null; this.AD_Process_ID = null; this.description = null; this.help = null; this.setText = null } } function b(r, u, f, e, o, s, h) { var c = n("<input>", { type: "checkbox", name: r, value: o }), a = n('<label class="vis-ec-col-lblchkbox" />').html(o), l; h && (c.addClass("vis-ctrl-switch"), a.prepend('<i for="switch" class="vis-ctrl-switchSlider">Toggle<\/i>')); a.prepend(c); i.call(this, a, t.DisplayType.YesNo, f, r, u); this.cBox = c; l = this; this.setReadOnly = function (n) { this.isReadOnly = n; c.prop("disabled", n); a.css("opacity", n ? .7 : 1) }; f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.prop("checked"); t !== l.oldValue && (l.oldValue = t, i = { newValue: t, propertyName: l.getName() }, l.fireValueChanged(i), i = null) }); this.disposeComponent = function () { c.off("change"); c = null; l = null; this.cBox = null } } function s(r, u, f, e, s, h, c, l) { function d(n) { var i, r, f, e, s, u, h; if (a.lookup && !b) { if (i = a.lookup.getZoomQuery(), n || (n = a.getValue()), n == "" && (n = null), n == null || isNaN(n) || (n = parseInt(n)), i == null || n != null) { if (i = new t.Query, r = null, a.lookup != null && a.lookup instanceof t.MLookup && (f = a.lookup.getAD_Reference_Value_ID(), f != 0)) { e = "VIS_83"; s = []; s[0] = new t.DB.SqlParam("@AD_Reference_ID", f); try { u = o(e, s); u.read() && (r = u.getString(0)); u.dispose() } catch (c) { this.log.log(t.Logging.Level.SEVERE, e, c) } } r != null && r.length != 0 ? i.addRestriction(r, t.Query.prototype.EQUAL, n) : i.addRestriction(a.getColumnName(), t.Query.prototype.EQUAL, n); i.setRecordCount(1) } h = 0; h = a.mField != null && a.mField.getZoomWindow_ID() > 0 ? a.mField.getZoomWindow_ID() : a.lookup.getZoomWindow(i); (n == null || n == -1) && (i = null); t.viewManager.startWindow(h, i) } } var v, a; c || (c = t.DisplayType.Table); v = n("<select>", { name: r }); i.call(this, v, c, f, r, u); this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.loading = !1; s != null && s.getIsValidated() && (this.loading = !0); v[0].selectedIndex = -1; f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); var g = !1, y = null, k = 0, p = null, w = {}, b = !1; s != null && ((s.getDisplayType() == t.DisplayType.List && t.context.getAD_Role_ID() == 0 || s.getDisplayType() != t.DisplayType.List) && (g = !0, s instanceof t.MLookup && s.getZoomWindow() == 0 && l < 1 && (b = !0), w[t.Actions.zoom] = b), w[t.Actions.addnewrec] = !0, (this.lookup && (this.lookup.info.keyColumn.toLowerCase() == "ad_user.ad_user_id" || this.lookup.info.keyColumn.toLowerCase() == "ad_user_id") || r === "AD_User_ID" || r === "SalesRep_ID") && (w[t.Actions.contact] = !0), y = n('<button tabindex="-1" class="input-group-text"><i tabindex="-1" class="fa fa-ellipsis-v" /><\/button>'), w[t.Actions.refresh] = !0, t.MRole.getIsShowPreference() && (w[t.Actions.preference] = !0), p = t.AEnv.getContextPopup(w), k += 1, w = null); this.getBtnCount = function () { return k }; this.getBtn = function () { return y }; this.setVisible = function (n) { this.visible = n; n ? (y && y.show(), v.show()) : (v.hide(), y && y.hide()) }; a = this; v.on("focus", function () { var n; if (a.lookup != null) { if (n = v.val(), a.lookup.getIsValidated() && !a.lookup.getHasInactive()) { if (a.loading) { if (a.lookup.fillCombobox(u, !1, !1, !1), a.lookup.loading) return; a.refreshOptions(a.lookup.data, n); n != null && v[0].selectedIndex < 0 && (a.oldValue = "old", v.trigger("change")); a.loading = !1 } return } a.getIsReadonly() || (a.settingFocus = !0, n = v.val(), a.lookup.fillCombobox(a.getIsMandatory(), !0, !0, !0), a.refreshOptions(a.lookup.data, n), n && v[0].selectedIndex < 0 && (a.oldValue = "old", v.trigger("change")), a.settingFocus = !1) } }); v.on("change", function (n) { var t = v.val(), i; t !== a.oldValue && ((t == -1 || t == "") && (t = null), i = { newValue: t, propertyName: a.getName() }, a.fireValueChanged(i), i = null); n.stopPropagation() }); if (y) y.on(t.Events.onClick, function (n) { y.w2overlay(p.clone(!0)); n.stopPropagation() }); if (p) p.on("click", "LI", function (i) { var r = n(i.target).data("action"), u, e, f, o; if (r == t.Actions.preference) u = new t.ValuePreference(a.mField, a.getValue(), a.getDisplay()), u != null && u.showDialog(), u = null; else if (r == t.Actions.refresh) { if (s == null) return; a.settingFocus = !0; e = v.val(); a.lookup.refresh(); a.lookup.getIsValidated() ? a.lookup.fillCombobox(a.getIsMandatory(), !1, !1, !1) : a.lookup.fillCombobox(a.getIsMandatory(), !0, !1, !1); a.refreshOptions(a.lookup.data, e); a.settingFocus = !1 } else r == t.Actions.contact ? (f = a.getValue(), f && f.toString().length > 0 && (o = new t.ContactInfo(f, a.mField.getWindowNo()), o.show())) : r == t.Actions.zoom ? b || d() : r == t.Actions.addnewrec && (b || d(-10)) }); this.disposeComponent = function () { v.off("focus"); v.off("change"); y && (y.off(t.Events.onClick), y.remove()); y = null; p && p.remove(); p = null; this.lookup = null; this.lastDisplay = null; this.settingFocus = null; this.inserting = null; this.settingValue = null; v = null; a = null } } function k(r, u, f, e, o) { var l = "date", c = "9999-12-31", s, h; o == t.DisplayType.Time && (l = "time", c = ""); o == t.DisplayType.DateTime && (l = "datetime-local", c += "T24:00:00"); s = n("<input>", { type: l, name: r }); c != "" && s.attr("max", c); i.call(this, s, o, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); h = this; s.on("focusout", function () { var n, t; this.editingGrid || (n = h.getValue(), h.oldValue = n, t = { newValue: n, propertyName: h.getName() }, h.fireValueChanged(t), t = null) }); this.disposeComponent = function () { s.off("change"); h = null; s = null } } function h(r, u, f, s, h, c, l) { function tt(i) { var r, u, e, s, h, f, c; if (a.lookup && !g) { if (r = a.lookup.getZoomQuery(), i || (i = a.getValue()), i == "" && (i = null), r == null || n.isEmptyObject(r) || i != null) { if (r = new t.Query, u = null, a.lookup != null && a.lookup instanceof t.MLookup && (e = a.lookup.getAD_Reference_Value_ID(), e != 0)) { s = "VIS_90"; h = []; h[0] = new t.DB.SqlParam("@AD_Reference_ID", e); try { f = o(s, h); f.read() && (u = f.getString(0)); f.dispose() } catch (v) { this.log.log(t.Logging.Level.SEVERE, s, v) } } u != null && u.length != 0 ? r.addRestriction(u, t.Query.prototype.EQUAL, i) : r.addRestriction(a.getColumnName(), t.Query.prototype.EQUAL, i); r.setRecordCount(1) } c = 0; c = a.mField != null && a.mField.getZoomWindow_ID() > 0 ? a.mField.getZoomWindow_ID() : l && l > 0 ? l : a.lookup.getZoomWindow(r); t.viewManager.startWindow(c, r) } } var ft, et, st, d, v, w, ht, a; h || (h = t.DisplayType.Search); this.lookup = c; this.isMultiKeyTextBox = h === t.DisplayType.MultiKey; this.value = null; this.custInfoWin = null; ft = null; et = null; this.infoMultipleIds = null; st = null; this.log = t.Logging.VLogger.getVLogger("VTextBoxButton"); var it = 1113, rt = 1113, nt = ""; h == t.DisplayType.Location || h == t.DisplayType.MultiKey ? nt += this.isMultiKeyTextBox ? "fa fa-caret-down" : "vis vis-card" : h == t.DisplayType.Locator ? nt += "vis vis-locator" : h == t.DisplayType.Search && (nt += r.equals("C_BPartner_ID") || r.equals("C_BPartner_To_ID") && c.getColumnName().equals("C_BPartner.C_BPartner_ID") ? "fa fa-handshake-o" : r.equals("M_Product_ID") || r.equals("M_Product_To_ID") && c.getColumnName().equals("M_Product.M_Product_ID") ? "vis vis-product" : "fa fa-caret-down"); d = 0; v = n("<input>", { type: "text", name: r }); v.attr("autocomplete", "off"); w = n('<button  tabindex="-1" class="input-group-text"><i  tabindex="-1" class="' + nt + '"><\/i><\/button>'); d += 1; var y = null, b = null, p = {}, g = !1, k = null, ut = null; if (c == null || this.isMultiKeyTextBox || (c instanceof t.MLookup && c.getZoomWindow() == 0 && l < 1 && (g = !0), p[t.Actions.zoom] = g, p[t.Actions.addnewrec] = !0, y = n('<button  tabindex="-1" class="input-group-text"><i tabindex="-1" Class="fa fa-ellipsis-v" /><\/button>'), ht = !1, r === "C_BPartner_ID" && (p[t.Actions.addnewrec] = !1, p[t.Actions.add] = !0, p[t.Actions.update] = !0), (this.lookup && (this.lookup.info.keyColumn.toLowerCase() == "ad_user.ad_user_id" || this.lookup.info.keyColumn.toLowerCase() == "ad_user_id") || r === "AD_User_ID" || r === "SalesRep_ID") && (p[t.Actions.contact] = !0), t.MRole.getIsShowPreference() && (p[t.Actions.preference] = !0), p[t.Actions.refresh] = !0, p[t.Actions.remove] = !0, b = t.AEnv.getContextPopup(p), d += 1, p = null), this.isMultiKeyTextBox && (y = n('<button  tabindex="-1" class="input-group-text"><i class="fa fa-arrow-left" aria-hidden="true"><\/i><\/button>'), d += 1), a = this, i.call(this, v, h, f, r, u), this.setReadOnly = function (n) { this.isReadOnly = n; v.prop("disabled", n ? !0 : !1); n ? w.css("opacity", .7) : w.css("opacity", 1); this.isMultiKeyTextBox && (n ? y.css("opacity", .7) : y.css("opacity", 1)) }, h == t.DisplayType.Search) { k = n("<div class='vis-autocompleteList-item vis-auto-addItem' style='background-color: rgba(var(--v-c-secondary), 1)'>" + t.Msg.getMsg("AddNew") + "<\/div>"); ut = n("<div><center>" + t.Msg.getMsg("NoDataFoundSugg") + "<\/center><\/div>").append(n("<center><\/center>").append(k)); v.vaautocomplete({ source: function (i, u) { var f = a.lookup.info.query, v = a.lookup.info.keyColumn, s = a.lookup.info.displayColSubQ, c, l; f = f.replace(s, ""); var y = f.indexOf(" FROM "), h = f.indexOf(" WHERE ", y) != -1, o = f.lastIndexOf(" ORDER BY "), e = ""; if (!a.lookup.info.isValidated) { if (e = t.Env.parseContext(t.context, a.lookup.windowNo, a.lookup.tabNo, a.lookup.info.validationCode, !1, !0), e.length == 0 && a.lookup.info.validationCode.length > 0) return; e = " AND " + e } o != -1 ? (c = e.toUpper().lastIndexOf(" ORDER BY "), c == -1 && (e = e + f.substring(o)), f = f.substring(0, o) + (h ? " AND " : " WHERE ") + a.lookup.info.tableName + ".isActive='Y' " + e) : f += (h ? " AND " : " WHERE ") + a.lookup.info.tableName + ".isActive='Y' " + e; l = f.substr(f.indexOf("FROM"), f.length); f = "SELECT " + v + " AS ID,NULL," + s + " AS finalValue " + l; i = i.toUpper(); i = "%" + i + "%"; n.ajax({ type: "Post", url: t.Application.contextUrl + "Form/GetAccessSqlAutoComplete", data: { sql: t.secureEngine.encrypt(f), columnName: r, text: i }, success: function (n) { var r = [], i, f; if (JSON.parse(n) != null) { for (result = JSON.parse(n).Table, i = 0; i < result.length; i++)f = {}, f[Object.keys(result[i])[0].toLowerCase()] = result[i][Object.keys(result[i])[0]], f[Object.keys(result[i])[1].toLowerCase()] = result[i][Object.keys(result[i])[1]], f[Object.keys(result[i])[2].toLowerCase()] = result[i][Object.keys(result[i])[2]], r.push({ id: f.id, value: t.Utility.Util.getIdentifierDisplayVal(f.finalvalue) }); u(r) } r.length == 0 && (r = [], r.push({ id: "vis-AddNew", value: t.Msg.getMsg("AddNew"), msg: t.Msg.getMsg("NoDataFound") }), u(r)) } }) }, minLength: 2, html: ut, onSelect: function (n, t) { t.id == "vis-AddNew" ? (tt(), setTimeout(function () { a.setValue(-1, !0, !0) }, 500)) : a.setValue(t.id, !0, !0) } }); k.on("click", function () { tt() }) } v.on("keydown", function (n) { n.keyCode != 13 && (n.keyCode != 9 || v.val().trim() == "") || n.shiftKey || v.val().length != 0 ? (n.keyCode == 46 || n.keyCode == 8) && a.getValue() != null && a.setValue(null, !0, !0) : a.actionText() && (n.stopPropagation(), n.preventDefault()) }); this.actionText = function () { var r = v.val().trim(), u, i; if (t.context.setContext(a.lookup.windowNo, "AttrCode", r), r != null && r.indexOf("(01)") >= 0 && (u = r, u.indexOf("(10)") >= 0 && (u = u.substring(0, u.indexOf("(10)"))), u.indexOf("(17)") >= 0 && (u = u.substring(0, u.indexOf("(17)"))), u = u.replace("(01)", ""), r = u), r == null || r.length == 0 || r.equals("%")) return a.openSearchForm(), !0; r = r.toUpper(); var f = -3, o = null, i = null, s = t.Msg.parseTranslation(t.context, a.getDirectAccessSQL(r)); try { if (i = null, n.ajax({ type: "Post", async: !1, url: t.Application.contextUrl + "Form/GetTextButtonQueryResult", data: { sql: t.secureEngine.encrypt(s) }, success: function (n) { i = (new t.DB.DataReader).toJson(n) } }), i.read()) { try { o = parseInt(i.get(0)) } catch (h) { o = i.get(0) } f = 1; i.read() && (f = -1, o = null) } i.close(); i = null } catch (c) { i != null && i.close(); i = null; this.log.log(t.Logging.Level.SEVERE, e); f = -2 } if (f == -3 && !r.endsWith("%")) { r += "%"; s = t.Msg.parseTranslation(t.context, a.getDirectAccessSQL(r)); try { if (i = null, n.ajax({ type: "Get", async: !1, url: t.Application.contextUrl + "Form/GetTextButtonQueryResult", data: { sql: t.secureEngine.encrypt(s) }, success: function (n) { i = (new t.DB.DataReader).toJson(n) } }), i.read()) { try { o = parseInt(i.get(0)) } catch (l) { o = i.get(0) } f = 1; i.read() && (o = null, f = -1) } i.close() } catch (y) { i != null && i.close(); i = null; this.log.log(t.Logging.Level.SEVERE, e); f = -2 } } return f < 0 && o == null ? (st = {}, a.openSearchForm(), !0) : (r = "", a.setValue(o, !0, !0), !1) }; this.getDirectAccessSQL = function (n) { var i = a.getDirectAccessSQL1(t.context, r, c, n); return ft = i[1], et = i[2], i[0] }; this.getDirectAccessSQL1 = function (i, r, u, f) { var h = "", s = [], c = r.substring(0, r.length - 3), v = r, p, e, k, g, nt, tt, b, l, w, y; if (r.equals("M_Product_ID") ? (i.setContext(it, rt, "M_Product_ID", "0"), i.setContext(it, rt, "M_AttributeSetInstance_ID", "0"), i.setContext(it, rt, "M_Locator_ID", "0")) : r.equals("SalesRep_ID") && (c = "AD_User", v = "AD_User_ID"), n.ajax({ url: t.Application.contextUrl + "Form/GetAccessSql", dataType: "json", async: !1, data: { columnName: r, text: f }, success: function (n) { h = n } }), h.length > 0) return p = a.getWhereClause(i, r, u), r.equals("M_Product_ID") ? p != null && p.length > 0 && (h += " AND " + p.replace(/M_Product\./g, "p.") + " AND p.IsActive='Y'") : p != null && p.length > 0 && (h += " AND " + p + " AND IsActive='Y'"), s.push(t.MRole.getDefault().addAccessSQL(h, c, t.MRole.SQL_FULLYQUALIFIED, t.MRole.SQL_RO)), s.push(c), s.push(v), s; if (e = null, u != null && u instanceof t.MLookup && (k = u.getAD_Reference_Value_ID(), k != 0)) { g = "VIS_84"; try { for (l = [], l[0] = new t.DB.SqlParam("@refid", k), e = o(g, l); e.read();) { r = e.get(0); v = e.get(0); c = e.get(1); break } e.close(); e = null } catch (d) { e != null && (e.close(), e = null); this.log.log(t.Logging.Level.SEVERE, b, d) } nt = "VIS_85"; tt = null; v = r; h = "("; try { for (l = [], l[0] = new t.DB.SqlParam("@refid", k), l[1] = new t.DB.SqlParam("@colname", r), e = o(nt, l); e.read();)h.length > 1 && (h += " OR "), c = e.get(0), h += "UPPER(" + e.get(1) + ") LIKE " + t.DB.to_string(f); h += ")"; e.close(); e = null } catch (d) { e != null && (e.close(), e = null); this.log.log(t.Logging.Level.SEVERE, b, d) } return h.length == 0 ? (this.log.log(t.Logging.Level.SEVERE, r + " (TableDir) - no standard/identifier columns"), s.push(""), s.push(c), s.push(v), s) : (w = "SELECT " + r + " FROM " + c + " WHERE " + h + " AND IsActive='Y'", y = a.getWhereClause(i, r, u), y != null && y.length > 0 && (w += " AND " + y), s.push(t.MRole.getDefault().addAccessSQL(w, c, t.MRole.SQL_NOTQUALIFIED, t.MRole.SQL_RO)), s.push(c), s.push(v), s) } b = "VIS_86"; v = r; h = "("; try { for (l = [], l[0] = new t.DB.SqlParam("@colname", v), e = o(b, l); e.read();)h.length > 1 && (h += " OR "), c = e.get(0), h += "UPPER(" + e.get(1) + ") LIKE " + t.DB.to_string(f); h += ")"; e.close(); e = null } catch (d) { e != null && (e.close(), e = null); this.log.log(t.Logging.Level.SEVERE, b, d) } return h.length == 0 ? (this.log.log(t.Logging.Level.SEVERE, r + " (TableDir) - no standard/identifier columns"), s.push(""), s.push(c), s.push(v), s) : (w = "SELECT " + r + " FROM " + c + " WHERE " + h + " AND IsActive='Y'", y = a.getWhereClause(i, r, u), y != null && y.length > 0 && (w += " AND " + y), s.push(t.MRole.getDefault().addAccessSQL(w, c, t.MRole.SQL_NOTQUALIFIED, t.MRole.SQL_RO)), s.push(c), s.push(v), s) }; this.getWhereClause = function (n, i, r) { var u = "", f, e; try { if (r == null) return ""; if (r.getZoomQuery() != null && (u = r.getZoomQuery().getWhereClause()), f = r.getValidation(), f == null && (f = ""), u.length == 0 ? u = f : f.length > 0 && (u += " AND " + f), u.indexOf("@") != -1 && (e = t.Env.parseContext(n, r.getWindowNo(), r.getTabNo(), u, !1, !0), e.length != 0)) return e } catch (o) { } return u }; f || !s ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return d }; this.getBtn = function (n) { return n == 0 ? w : n == 1 && y ? y : void 0 }; this.setVisible = function (n) { this.visible = n; n ? (v.css("visibility", "visible"), y && y.show(), w.show()) : (v.css("visibility", "hidden"), y && y.hide(), w.hide()) }; this.openSearchForm = function () { var s, e, l, u, g, w, f; if (!a.isReadOnly && (s = v.val().trim(), typeof s == "object" && (s = ""), !a.isReadOnly) && a.lookup != null) { if (e = 0, l = a.getWhereClause(t.Env.getCtx(), r, a.lookup), a.custInfoWin != null ? n.ajax({ url: t.Application.contextUrl + "InfoWindow/GetInfoWindowID", dataType: "json", async: !1, data: { InfoSearchKey: a.custInfoWin }, success: function (n) { e = n.result } }) : a.getField() != null & e == 0 && (e = a.getField().getAD_InfoWindow_ID()), u = null, e != 0) u = new t.InfoWindow(e, s, a.lookup.windowNo, l, a.isMultiKeyTextBox); else { var h = h, y = r, c = null, i = null, b = 0, k = 0, p = 0, d = a.lookup.getAD_Reference_Value_ID(); if (d > 0) { c = "VIS_87"; g = null; try { for (f = [], f[0] = new t.DB.SqlParam("@AD_Reference_ID", d), i = o(c, f); i.read();)y = i.getString(0), g = i.getString(1), h = i.getString(2); i.close(); i = null } catch (nt) { i != null && (i.close(), i = null) } } else h = String(r).substr(0, r.length - 3), y = r; if (c = "VIS_88", f = [], f[0] = new t.DB.SqlParam("@AD_Tab_ID", t.context.getContext(a.lookup.windowNo, "0|AD_Tab_ID", !0)), p = ot(c, f), y.equals("M_Product_ID") && p) b = window.DTD001 && p == 170 ? t.context.getContextAsInt(a.lookup.windowNo, "DTD001_MWarehouseSource_ID") : t.context.getContextAsInt(a.lookup.windowNo, "M_Warehouse_ID"), k = t.context.getContextAsInt(a.lookup.windowNo, "M_PriceList_ID"), w = !1, a.lookup.windowNo > 0 && (w = t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "C_OrderLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "C_InvoiceLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "M_InOutLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "M_PackageLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "M_MovementLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "M_InventoryLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "M_ProductPrice_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "C_ProjectLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "M_RequisitionLine_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 0, "KeyColumnName") == "M_PriceList_ID" || t.context.getWindowTabContext(a.lookup.windowNo, 1, "KeyColumnName") == "SAP001_StockTransferLine_ID"), u = new t.infoProduct(!0, a.lookup.windowNo, b, k, s, h, y, w, l); else { for (c = "VIS_89", f = [], f[0] = new t.DB.SqlParam("@tableName", h), i = o(c, f); i.read();) { e = i.getString(0); break } i.close(); i = null; u = e > 0 ? new t.InfoWindow(e, s, a.lookup.windowNo, l, a.isMultiKeyTextBox) : new t.infoGeneral(!0, a.lookup.windowNo, s, h, y, a.isMultiKeyTextBox, l) } } u.onClose = function () { var n = u.getSelectedValues(), t, r; if (n && n.length == 0) { v.closest("td").hasClass("vis-gc-vpanel-table-td3") ? window.setTimeout(function () { v.closest("tr").nextAll().children("input,select,textarea,button").focus() }, 200) : v.closest("td").hasClass("vis-gc-vpanel-table-td1") ? (t = v.closest("td").siblings(".vis-gc-vpanel-table-td3"), t && t.length > 0 && (t = t.find("input,select,textarea,button"), t && t.length > 0 ? window.setTimeout(function () { t.focus() }, 200) : window.setTimeout(function () { v.closest("tr").nextAll().children("input,select,textarea,button").focus() }, 200))) : window.setTimeout(function () { v.closest("td").siblings(".vis-gc-vpanel-table-td3").find("input,select,textarea,button").focus() }, 200); v.closest("td").nextAll().children("input,select,textarea,button").focus(); u.constructor.name == "infoProduct" && u.getRefreshStatus() && a.fireRefreshUI(); return } if (a.isMultiKeyTextBox) { for (var f = "", i = 0, e = 0, i = 0, e = n.length; i < e; i++) { if (f.length == 0) { f += n[i]; continue } f += "," + n[i] } a.setValue(f, !1, !0) } else r = null, u.getRefreshStatus && u.getRefreshStatus() ? a.fireRefreshUI() : (n != null && n.length == 1 ? r = n[0] : (InfoMultipleIds = null, n.length > 1 && (r = n[0])), r != null && a.setValue(r, !1, !0)); u = null }; u.show() } }; w.on(t.Events.onClick, a.openSearchForm); if (y) y.on(t.Events.onClick, function (n) { if (a.isMultiKeyTextBox) { if (a.isReadOnly) return; var t = a.getValue(); t && t.toString().length > 0 && a.setValue(null, !1, !0) } else y.w2overlay(b.clone(!0)); n.stopPropagation() }); if (b) b.on("click", "LI", function (i) { var u = n(i.target).data("action"), f, r, e; if (u == t.Actions.zoom) { if (g) return; tt() } else if (u == t.Actions.addnewrec) { if (g) return; tt(-10) } else if (u == t.Actions.preference) f = new t.ValuePreference(a.mField, a.getValue(), a.getDisplay()), f != null && f.showDialog(), f = null; else if (u == t.Actions.refresh) { if (!a.lookup || a.isReadOnly) return; a.lookup.refresh() } else if (u == t.Actions.add) r = a.getValue(), t.AddUpdateBPartner(a.mField.getWindowNo(), 0, t.Msg.getMsg("Customer"), null, 0, 0); else if (u == t.Actions.update) r = a.getValue(), r && r.toString().length > 0 && t.AddUpdateBPartner(a.mField.getWindowNo(), r, t.Msg.getMsg("Customer"), null, 0, 0); else if (u == t.Actions.contact) r = a.getValue(), r && r.toString().length > 0 && (e = new t.ContactInfo(r, a.mField.getWindowNo()), e.show()); else if (u == t.Actions.remove) { if (a.isReadOnly) return; a.setValue(null, !1, !0) } }); this.disposeComponent = function () { w.off(t.Events.onClick); y && y.off(t.Events.onClick); b && b.off(t.Events.onTouchStartOrClick); b = null; a = null; v = null; w = null; y = null; this.getBtn = null; this.setVisible = null; k && k.off("click"); k = null; ut = null } } function it(r, u, f, e, o, s, h) { var l = 6, v = 79, c, a; if (h != t.DisplayType.Memo) h == t.DisplayType.TextLong ? (l = 6, s = 1e5) : (l = s < 300 ? 2 : s < 2e3 ? 4 : 6, v = s < 300 ? 79 : s < 2e3 ? 129 : 129); else try { l = s < 300 ? 2 : s < 2e3 ? 4 : s / 500; v = s < 300 ? 79 : s < 2e3 ? 129 : 129 } catch (y) { l = s < 300 ? 2 : s < 2e3 ? 4 : 6; v = s < 300 ? 79 : s < 2e3 ? 129 : 129 } c = n("<textarea>", { name: r, maxlength: s, rows: l, style: "min-height:" + v + "px" }); i.call(this, c, h, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); a = this; c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.val(); t !== a.oldValue && (i = { newValue: t, propertyName: a.getName() }, a.fireValueChanged(i), i = null) }); this.disposeComponent = function () { c.off("change"); c = null; a = null } } function c(r, u, f, e, o, s, h) { var a = h, v = s, l = n("<input>", { type: "number", step: "any", name: r, maxlength: 16, "data-type": "int" }), c; l.attr("autocomplete", "off"); i.call(this, l, a, f, r, u); this.format = t.DisplayType.GetNumberFormat(a); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); c = this; this.dotFormatter = t.Env.isDecimalPoint(); l.on("keydown", function (n) { if (n.keyCode == 189 || n.keyCode == 109 || n.keyCode == 173) { if (n.keyCode == 189 && this.value.length == 0) return !0; var t = c.format.GetConvertedNumber(this.value, c.dotFormatter); return this.value = Number(t) * -1, setTimeout(function () { l.trigger("change") }, 100), !1 } if (n.keyCode >= 37 && n.keyCode <= 40 || n.keyCode == 8 || n.keyCode == 9 || n.keyCode == 16 || n.keyCode == 17 || n.keyCode == 35 || n.keyCode == 36 || n.keyCode == 46) return !0; if (n.keyCode >= 48 && n.keyCode <= 57 && n.shiftKey == !1 || n.keyCode >= 96 && n.keyCode <= 105 && n.shiftKey == !1) return this.value.length >= v ? !1 : !0; if (n.keyCode == 189 || n.keyCode == 109 || n.keyCode == 173) return this.value = this.value * -1, !1; if (c.dotFormatter) { if (n.keyCode == 188) return !1 } else if (n.keyCode == 190 || n.keyCode == 110) return !1; if (n.keyCode == 190 || n.keyCode == 110 || n.keyCode == 188) return (this.value.indexOf(".") > -1 ? this.value = this.value.replace(".", "") : this.value.indexOf(",") > -1 && (this.value = this.value.replace(",", "")), this.value.length >= v) ? !1 : !0; if (n.ctrlKey && n.keyCode == 65) { if (this.value.length > 0) return n.stopPropagation(), l.select(), !0 } else if (n.ctrlKey && n.keyCode == 67) { if (this.value.length > 0) return n.stopPropagation(), !0 } else { if (n.ctrlKey && n.keyCode == 86) return setTimeout(function () { n.stopPropagation(); var t = n.target.value; n.target.value = t ? c.format.GetConvertedString(t, c.dotFormatter) : "" }, 10), !0; if (n.ctrlKey && n.keyCode == 88) return n.stopPropagation(), !0 } return !1 }); l.on("focus", function (n) { n.stopPropagation(); var i = n.target.value; l.attr("type", "text"); n.target.value = i ? c.format.GetConvertedString(i, c.dotFormatter) : ""; t.DisplayType.Amount == a && l.select() }); l.on("change", function (n) { var t, i; n.stopPropagation(); t = c.getValue(); this.value = t; t !== c.oldValue && (i = { newValue: t, propertyName: c.getName() }, c.fireValueChanged(i), i = null) }); l.on("blur", function (n) { var t, i, r; n.stopPropagation(); l.attr("type", "text"); t = l.val(); c.dotFormatter || (t = t.replace(".", ",")); i = c.format.GetConvertedString(t, c.dotFormatter); r = c.format.GetFormatAmount(i, "formatOnly", c.dotFormatter); l.val(r) }); this.disposeComponent = function () { l.off("keydown"); l.off("change"); l = null; c = null; this.format.dispose(); this.format = null; v = null } } function d(r, u, f, e, o, s) { var a = t.DisplayType.Integer, l = s, c = n("<input>", { type: "text", name: r, maxlength: l, "data-type": "int" }), h; i.call(this, c, a, f, r, u); this.format = t.DisplayType.GetNumberFormat(a); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); h = this; c.on("keydown", function (n) { if (n.keyCode == 189 || n.keyCode == 109 || n.keyCode == 173) return n.keyCode == 189 && this.value.length == 0 ? !0 : (this.value = Number(this.value * -1), setTimeout(function () { c.trigger("change") }, 100), !1); if (n.keyCode >= 37 && n.keyCode <= 40 || n.keyCode == 8 || n.keyCode == 9 || n.keyCode == 16 || n.keyCode == 17 || n.keyCode == 35 || n.keyCode == 36 || n.keyCode == 46) return !0; if (this.value < 0) { if (this.value.length > t.DisplayType.INTEGER_DIGITS && n.keyCode != 8 && n.keyCode != 9 && n.keyCode != 46) return !1 } else if (this.value.length >= t.DisplayType.INTEGER_DIGITS && n.keyCode != 8 && n.keyCode != 9 && n.keyCode != 46) return !1; return n.keyCode >= 48 && n.keyCode <= 57 && n.shiftKey == !1 || n.keyCode >= 96 && n.keyCode <= 105 && n.shiftKey == !1 ? this.value.length >= l ? !1 : !0 : !1 }); c.on("change", function (n) { var t, i, r; n.stopPropagation(); t = h.getValue(); t = Globalize.parseInt(t.toString()); i = Number(h.format.GetFormatedValue(t)); t != i && (h.mField.setValue(null), t = i); t !== h.oldValue && (r = { newValue: t, propertyName: h.getName() }, h.fireValueChanged(r), r = null) }); this.disposeComponent = function () { c.off("keydown"); c.off("change"); c = null; h = null; this.format.dispose(); this.format = null; l = null } } function g(r, u, f, e, o, s) { o || (o = t.DisplayType.Location); this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.value = null; var a = n("<input readonly>", { type: "text", name: r }), l = n('<button class="input-group-text"><i class="vis vis-location" aria-hidden="true"><\/i><\/button>'), c = n('<button class="input-group-text"><i class="vis vis-card" aria-hidden="true"><\/i><\/button>'), v = 2, h = this; i.call(this, a, o, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtn = function (n) { return n == 0 ? l : n == 1 ? c : void 0 }; this.getBtnCount = function () { return v }; this.setVisible = function (n) { this.visible = n; n ? (a.show(), l.show(), c.show()) : (a.hide(), l.hide(), c.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; a.prop("disabled", n ? !0 : !1); n ? c.css("opacity", .7) : c.css("opacity", 1); this.setBackground(!1) }; l.on(t.Events.onClick, function (n) { var t = "http://local.google.com/maps?q=" + h.getDisplay(); window.open(t); n.stopPropagation() }); c.on(t.Events.onClick, function (n) { var r, i; (n.stopPropagation(), h.isReadOnly) || (r = null, h.mField && h.mField.vo && (r = h.mField.vo.IsMaintainVersions), i = new t.LocationForm(h.value, r), i.load(), i.showDialog(), i.onClose = function (n, t) { if (t) { h.oldValue = 0; h.lookup.refreshLocation(n); h.setValue(n); var i = { newValue: n, propertyName: h.getColumnName() }; h.fireValueChanged(i); i = null } }, i = null) }); this.disposeComponent = function () { l.off(t.Events.onClick); c.off(t.Events.onClick); h = null; a = null; l = null; c = null; this.setVisible = null } } function l(r, u, f, e, s, h) { var y; this.mandatory = u; this.onlyWarehouseId = 0; this.onlyProductId = 0; this.onlyOutgoing = null; this.windowNum = h.getWindowNo(); this.columnName = r; this.lookup = h; y = "vis vis-locator"; this.value = null; s || (s = t.DisplayType.Locator); var a = n("<input readonly>", { type: "text", name: r }), l = n('<button class="input-group-text"><i class="' + y + '" aria-hidden="true"><\/i><\/button>'), v = n('<button class="input-group-text"><i class="vis vis-find" aria-hidden="true"><\/i><\/button>'), p = 2, c = this; i.call(this, a, s, f, r, u); this.getBtnCount = function () { return p }; this.getBtn = function (n) { return n == 0 ? l : n == 1 ? v : void 0 }; this.setVisible = function (n) { this.visible = n; n ? (a.show(), l.show(), v.show()) : (l.hide(), v.hide(), a.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; a.prop("disabled", n ? !0 : !1); n ? l.css("opacity", .7) : l.css("opacity", 1); this.setBackground(!1) }; l.on(t.Events.onClick, function (n) { if (n.stopPropagation(), !c.isReadOnly) { var t = c.getOnlyWarehouseID(), i = c.getOnlyProductID(); c.showLocatorForm(t, i) } }); v.on(t.Events.onClick, function (n) { var i, r, u, e, s, h, f, l; if (n.stopPropagation(), c.lookup) { if (i = c.lookup.getZoomQuery(), r = c.getValue(), r == null, r == "" && (r = null), i == null || r != null) { if (i = new t.Query, u = null, c.lookup != null && c.lookup instanceof t.MLookup && (e = c.lookup.getAD_Reference_Value_ID(), e != 0)) { s = "VIS_91"; h = []; h[0] = new t.DB.SqlParam("@AD_Reference_ID", e); try { f = o(s, h); f.read() && (u = f.getString(0)); f.dispose() } catch (n) { this.log.log(t.Logging.Level.SEVERE, s, n) } } u != null && u.length != 0 ? i.addRestriction(u, t.Query.prototype.EQUAL, r) : i.addRestriction(c.getColumnName(), t.Query.prototype.EQUAL, r); i.setRecordCount(1) } l = 0; l = c.mField.getZoomWindow_ID() > 0 ? c.mField.getZoomWindow_ID() : c.lookup.getZoomWindow(i); t.viewManager.startWindow(l, i) } }); this.disposeComponent = function () { l.off(t.Events.onClick); v.off(t.Events.onClick); c = null; a = null; l = null; this.getBtn = null; this.setVisible = null } } function u(r, u, f, e, o, s, h, c, l, a, v, y) { function it(n) { var i = t.Env.getCtx().getContextAsInt(p.windowNo, "C_GenAttributeSetInstance_ID"), r; p.isFromActivityForm && (i = p.C_GenAttributeSetInstance_ID); i == 0; r = new t.GenralAttributeForm(i, n, p.windowNo, p.isSearch, p.getCanSaveRecord(), p.isFromDMS); r.showDialog(); r.onClose = function (n, i, r) { t.Env.getCtx().setContext(h, "C_GenAttributeSetInstance_ID", n); k(n, i); r != null && (p.setInstanceIDs = r); p.getControl().val(i) } } function k(n) { if (p.log.finest("Changed M_AttributeSetInstance_ID=" + n), p.oldValue != n) { n == 0 && p.setValue(null); p.setValue(n); var t = { newValue: n, propertyName: p.colName }; p.fireValueChanged(t); t = null } } function rt(i) { var u = i == null ? 0 : i, r = t.Env.getCtx().getTabRecordContext(h, y, "M_Product_ID"), e = t.context.getTabRecordContext(h, y, "M_ProductBOM_ID"), c = t.Env.getCtx().getContextAsInt(h, "M_Locator_ID"), f; p.log.config("M_Product_ID=" + r + "/" + e + ",M_AttributeSetInstance_ID=" + u + ", AD_Column_ID=" + p.AD_Column_ID); var o = p.AD_Column_ID == 8418, s = !0, l = !1; e != 0 && (r = e); r != 0 && n.ajax({ url: t.Application.contextUrl + "PAttributes/ExcludeEntry", dataType: "json", async: !1, data: { productId: r, adColumn: p.AD_Column_ID, windowNo: h }, success: function (n) { s = n.result } }); !o && (r == 0 || s) ? (l = !0, u = 0, k(u), t.ADialog.info("VIS_PAttributeNotFound", null, null, null)) : (f = new t.PAttributesForm(u, r, c, p.C_BPartner_ID, o, p.AD_Column_ID, h), f.hasAttribute && f.showDialog(), f.onClose = function (n, t, i) { this.M_Locator_ID = i; k(n, t) }) } var d, nt, g; this.NO_INSTANCE = 0; this.AD_Column_ID = 0; d = "M_AttributeSetInstance_ID"; nt = !1; this.C_GenAttributeSet_ID = 0; this.C_GenAttributeSetInstance_ID = 0; this.M_Locator_ID = 0; d = r; this.value = null; this.windowNo = h; this.tabNo = y; this.lookup = s; this.C_BPartner_ID = t.Env.getCtx().getContextAsInt(this.windowNo, "C_BPartner_ID"); this.log = t.Logging.VLogger.getVLogger("VPAttribute"); g = "vis vis-pattribute"; o || (o = t.DisplayType.PAttribute); this.isFromActivityForm = c; this.isSearch = l; this.isFromDMS = a; this.isPAttribute = v; this.canSaveRecord = !0; var b = n("<input>", { type: "text", name: r }), w = n('<button class="input-group-text"><i class="' + g + '"><\/i><\/button>'), tt = 1, p = this; this.setInstanceIDs = null; i.call(this, b, o, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return tt }; this.getBtn = function (n) { if (n == 0) return w }; this.setVisible = function (n) { this.visible = n; n ? (b.show(), w.show()) : (w.hide(), b.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; b.prop("disabled", n ? !0 : !1); n ? w.css("opacity", .7) : w.css("opacity", 1); this.setBackground(!1) }; w.on(t.Events.onClick, function (n) { var r, i; if (n.stopPropagation(), !p.isReadOnly) { if (r = p.getValue(), !p.isPAttribute) { if (i = 0, i = t.Env.getCtx().getContextAsInt(p.windowNo, "C_GenAttributeSet_ID"), i == 0 && (i = p.C_GenAttributeSet_ID, i == 0)) { t.ADialog.info("NoAttributeSet", null, null, null); return } it(i, r); return } rt(r) } }); this.SetC_GenAttributeSet_ID = function (n) { this.C_GenAttributeSet_ID = n }; this.disposeComponent = function () { w.off(t.Events.onClick); p = null; b = null; w = null; this.getBtn = null; this.setVisible = null; this.value = null; this.lookup = null } } function nt(r, u, f, e, o, s, h, c) { var y, p; this.value = null; this.windowNo = h; this.lookup = s; this.title = c; y = r; p = "vis vis-account"; o || (o = t.DisplayType.PAttribute); var v = n("<input readonly>", { type: "text", name: r }), a = n('<button class="input-group-text"><i class="' + p + '" ><\/i><\/button>'), w = 1, l = this; i.call(this, v, o, f, r, u); this.getBtnCount = function () { return w }; this.getBtn = function (n) { if (n == 0) return a }; this.setVisible = function (n) { this.visible = n; n ? (v.show(), a.show()) : (v.hide(), a.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; v.prop("disabled", n ? !0 : !1); n ? a.css("opacity", .7) : a.css("opacity", 1); this.setBackground(!1) }; a.on(t.Events.onClick, function (n) { var u, r, i; (n.stopPropagation(), l.isReadOnly) || (u = t.Env.getCtx().getContextAsInt(l.windowNo, "C_AcctSchema_ID"), r = 0, l != null && l.getField() != null && l.getField().vo != null && l.getField().vo.AD_Table_ID != null && (r = l.getField().vo.AD_Table_ID), i = new t.AccountForm(l.title, l.lookup, u, r), i.load(), i.showDialog(), i.onClose = function (n) { if (l.oldValue != n) { l.setValue(n); var t = { newValue: n, propertyName: y }; l.fireValueChanged(t); t = null } }, i = null) }); this.disposeComponent = function () { a.off(t.Events.onClick); l = null; v = null; a = null; this.getBtn = null; this.setVisible = null; this.value = null; this.lookup = null; this.value = null; this.windowNo = null; this.title = null } } function a(r, u, f, e) { var h; this.values = null; this.log = t.Logging.VLogger.getVLogger("VImage"); var p = e, a = r, s = n("<img >"), v = n("<i>"), o = n("<span>").text("-"), c = n('<span class="vis vis-edit vis-img-ctrl-icon">'), l = null, y = "Thumb500x375"; l = n("<button >", { type: "button", name: a, "class": "vis-ev-col-img-ctrl", tabIndex: "-1" }); o.css("color", "blue"); l.append(c).append(s).append(v).append(o); i.call(this, l, t.DisplayType.Button, f, a, u); f ? this.setReadOnly(!0) : this.setReadOnly(!1); h = this; c.on(t.Events.onClick, function (n) { if (n.stopPropagation(), !h.isReadOnly) { var i = new t.VImageForm(h.getValue(), o.text().trim().length); i.showDialog(); i.onClose = function (n, t) { if (t) if (h.oldValue = -1, h.oldValue != n) { n = n == "null" ? null : n; h.setValue(n); var i = { newValue: n, propertyName: a }; h.fireValueChanged(i, !0); i = null } else h.refreshImage(n) }; i = null } }); this.setText = function (n) { var t, i; if (n == null) { o.text(""); s.image.src = ""; return } t = n.indexOf("&"); t != -1 && (i = n.toUpperCase().charAt(t + 1), i != " " && (n = n.substring(0, t) + n.substring(t + 1))); o.text(n) }; this.setDimension = function (n, t) { y = "Thumb" + t + "x" + n }; this.setIcon = function (n, i) { i ? (s.attr("src", t.Application.contextUrl + "Images/" + y + "/" + i + "? timestamp =" + (new Date).getTime()), s.show(), v.hide(), o.text(""), this.ctrl.addClass("vis-input-wrap-button-image-add")) : n != null ? (s.attr("src", "data:image/jpg;base64," + n + "? timestamp =" + (new Date).getTime()), s.show(), v.hide(), o.text(""), this.ctrl.addClass("vis-input-wrap-button-image-add")) : (s.attr("src", "data:image/jpg;base64," + n), s.hide(), o.text("-"), this.ctrl.removeClass("vis-input-wrap-button-image-add")) }; this.hideText = function () { o.hide() }; this.hideEditIcon = function () { c.hide() }; this.hideEditIcon = function () { c.hide() }; this.hideEditIcon = function () { c.hide() }; this.disposeComponent = function () { l.off(t.Events.onClick); l = null; this.log = null; p = null; s = null; o = null; this.setText = null; this.setIcon = null; h = null } } function y(r, u, f, e, o) { function b() { var i = n("<ul class='vis-apanel-rb-ul'>"); return i.append(n("<a id='link' style='border-bottom: 1px solid #CCDADE;color: #535353;font-size: 12px;display: block;margin-bottom: 8px;'  href='javascript:void(0)'>" + t.Msg.getMsg("SaveTolocalFile") + "<\/a>")), i.append(n("<li data-action='" + y + "'>").text(t.Msg.getMsg("Open/LoadIntoDatabase"))), i } var l, s; this.values = null; var a = n("<span>").text(""), w = o, v = r, h = null, c = null, p = "SaveTolocalFile", y = "LoadIntoDatabase"; if (this.data = null, l = n("<input type='file' class='file' name='file'/>"), h = n("<button>", { type: "button", name: v }), h.append(a), i.call(this, h, t.DisplayType.Button, f, v, u), f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1), s = this, c = b(), c) { c.on("click", "LI", function (t) { var i = n(t.target).data("action"); i == p || i == y && l.trigger("click") }); c.on("click", "a", function () { if (s.getValue() != null) { var t = (new Date).toISOString().slice(0, 19).replace(/-/g, ""), i = "data:;base64," + s.getValue(); n(this).attr("href", i).attr("download", "file-" + t + ".log") } }) } l.change(function () { var t = l[0].files[0], n = new FileReader, i = n.readAsDataURL(t); n.onloadend = function () { var t = n.result.split(",")[1], i; s.oldValue != t && (s.setValue(t), i = { newValue: t, propertyName: v }, s.fireValueChanged(i, !0), i = null) }; return }); h.on(t.Events.onClick, function (n) { s.isReadOnly || h.w2overlay(c.clone(!0)); n.stopPropagation() }); this.setText = function (n) { var t, i; if (n == null) { a.text(""); return } t = n.indexOf("&"); t != -1 && (i = n.toUpperCase().charAt(t + 1), i != " " && (n = n.substring(0, t) + n.substring(t + 1))); a.text(n) }; this.disposeComponent = function () { h.off(t.Events.onClick); h = null; this.setText = null; this.values = null; a = null; w = null; v = null; c = null; p = null; y = null; this.data = null; l = null; s = null } } function rt(r, u, f, e, o, s) { var h; this.value = null; var v = "vis vis-url", a = 0, c = n("<input>", { type: "text", name: r, maxlength: s }), l = n('<button class="input-group-text"><i class="' + v + '" ><\/i><\/button>'); a += 1; h = this; i.call(this, c, t.DisplayType.URL, f, r, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return a }; this.getBtn = function (n) { if (n == 0) return l }; this.setVisible = function (n) { this.visible = n; n ? (c.show(), l.show()) : (c.hide(), l.hide()) }; l.on(t.Events.onClick, function (n) { if ((n.stopPropagation(), h.value != null) && !h.isReadOnly) { var i = h.value.trim(); if (i.length > 0) { i.contains("http://") || i.contains("https://") || (i = "http://" + i); window.open(i); return } t.ADialog.warn("URLnotValid", !0, null) } }); c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.val(); t !== h.oldValue && (i = { newValue: t, propertyName: h.getName() }, h.fireValueChanged(i), i = null) }); this.disposeComponent = function () { l.off(t.Events.onClick); c.off("change"); h = null; c = null; l = null; this.getBtn = null; this.setVisible = null; this.value = null; v = null; a = null; this.getBtnCount = null; this.getBtn = null } } function p(r, u, f, e, o, s) { var k = !1, w, y, s, b, p, d, l, v, h; s == s.FileName && (k = !0); DialogType = { OpenFile: 0, SaveFile: 1, Custom: 2 }; SelectionType = { FilesOnly: 0, DirectoryOnly: 1 }; w = SelectionType.DirectoryOnly; y = DialogType.Custom; this.log = t.Logging.VLogger.getVLogger("VFile"); s = t.DisplayType.FileName; b = "fa fa-folder-open-o"; k && (w = SelectionType.FilesOnly, b = "fa fa-file-text-o"); p = r.toUpperCase(); p.indexOf("open") != -1 || p.indexOf("load") != -1 ? y = DialogType.OpenFile : p.indexOf("save") != -1 && (y = DialogType.SaveFile); d = o; l = r; this.value = null; var g = 0, c = n("<input>", { type: "text", name: l }), a = n('<button class="input-group-text"><i class="' + b + '" /><\/button>'); g += 1; v = n("<input autocomplete='off' type='file' class='file' name='file'/>"); c.append(a); i.call(this, c, s, f, l, u); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtnCount = function () { return g }; this.getBtn = function (n) { if (n == 0) return a }; this.setVisible = function (n) { this.visible = n; n ? (c.show(), a.show()) : (c.hide(), a.hide()) }; h = this; a.on(t.Events.onClick, function (i) { var u, f, r; h.isReadOnly || (i.stopPropagation(), w == SelectionType.DirectoryOnly ? (r = new t.VisImportFiles(!0), r.onClose = function (n) { h.setValue(n) }, r.show()) : y == DialogType.SaveFile ? h.getValue() != null && (u = (new Date).toISOString().slice(0, 19).replace(/-/g, ""), f = "data:;base64," + h.getValue(), n(this).attr("href", f).attr("download", "file-" + u + ".log")) : (r = new t.VisImportFiles(!1), r.onClose = function () { h.setValue(name) }, r.show())) }); v.on("change", function (t) { var i, r; t.stopPropagation(); i = n(v).val().split("\\").pop(); h.oldValue != i && (h.setValue(i), r = { newValue: i, propertyName: l }, h.fireValueChanged(r), r = null) }); c.on("change", function (n) { var t, i; n.stopPropagation(); t = c.val(); this.value = t; t !== h.oldValue && (i = { newValue: t, propertyName: h.getName() }, h.fireValueChanged(i), i = null, h.setValue(t)) }); this.disposeComponent = function () { c.off(t.Events.onClick); c.off("change"); v.off("change"); c = null; d = null; l = null; v = null; h = null } } function tt(r, u, f, e, o, s, h) { o || (o = t.DisplayType.AmtDimension); this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.value = null; this.defaultValue = ""; var l = n("<input readonly>", { type: "text", name: r }), a = n('<button class="input-group-text"><i class="vis vis-amtdimension" /><\/button>'), v = 1, c = this; i.call(this, l, o, f, r, u); this.format = t.DisplayType.GetNumberFormat(t.DisplayType.Amount); this.dotFormatter = t.Env.isDecimalPoint(); f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1); this.getBtn = function (n) { if (n == 0) return a }; this.getBtnCount = function () { return v }; this.hideButton = function (n) { n ? a.show() : a.hide() }; this.setVisible = function (n) { this.visible = n; n ? (l.show(), a.show()) : (l.hide(), a.hide()) }; this.setReadOnly = function (n) { this.isReadOnly = n; l.css("background-color", "#f8f8f8"); this.setBackground(n) }; this.setReadOnlyTextbox = function (n) { n ? (l.attr("readonly", "readonly"), l.attr("disabled", "disabled")) : (l.removeAttr("readonly"), l.removeAttr("disabled")) }; this.getText = function () { return l.val() }; this.setDefaultValue = function (n) { this.defaultValue = n }; a.on(t.Events.onClick, function (n) { n.stopPropagation(); c.actionText() }); this.actionText = function () { var i, r, n; c.value || (c.value = 0); i = t.Env.getCtx().getContextAsInt(h, "AD_Org_ID", !1); this.defaultValue && (c.defaultValue = c.defaultValue.replace(/@/g, "").trim().replace(".value", ""), r = t.Env.getCtx().getWindowContext(h, c.defaultValue, !1)); c.oldValue = c.value; n = new t.AmountDivision(c.value, i, r, c.isReadOnly); n.onClosing = function (n) { if (n > 0) { c.oldValue = 0; c.lookup.refreshAmountDivision(n); c.setValue(n); var t = { newValue: n, propertyName: c.getColumnName() }; c.fireValueChanged(t); t = null } }; n.show(); n = null }; this.disposeComponent = function () { a.off(t.Events.onClick); c = null; l = null; a = null; this.setVisible = null } } function w(r, u, f, e, o, s, h) { function k() { var i, n, r; c.lookup && (i = c.lookup.getZoomQuery(), n = c.getValue(), n == null, n == "" && (n = null), n == null || isNaN(n) || (n = parseInt(n)), i = new t.Query, i.addRestriction("M_ProductContainer_ID", t.Query.prototype.EQUAL, n), i.setRecordCount(1), r = 0, r = c.mField.getZoomWindow_ID() > 0 ? c.mField.getZoomWindow_ID() : c.lookup.getZoomWindow(i), t.viewManager.startWindow(r, i)) } var y, w, p, a, c; o || (o = t.DisplayType.ProductContainer); y = {}; this.lookup = s; this.lastDisplay = ""; this.settingFocus = !1; this.inserting = !1; this.settingValue = !1; this.value = null; this.defaultValue = ""; w = !1; y[t.Actions.zoom] = w; t.MRole.getIsShowPreference() && (y[t.Actions.preference] = !0); y[t.Actions.remove] = !0; p = t.AEnv.getContextPopup(y); a = n("<input>", { type: "text", name: r }); a.attr("autocomplete", "off"); var v = n('<button class="input-group-text"><i class="vis vis-pcontainer" /><\/button>'), l = n('<button  tabindex="-1" class="input-group-text"><i tabindex="-1" Class="fa fa-ellipsis-v" /><\/button>'), b = 1; if (b += 1, c = this, i.call(this, a, o, f, r, u), f || !e ? this.setReadOnly(!0) : this.setReadOnly(!1), this.getBtn = function (n) { return n == 0 ? v : n == 1 && l ? l : void 0 }, this.getBtnCount = function () { return b }, this.hideButton = function (n) { n ? (v.show(), this.getBtnCount() > 1 && l && l.show()) : (v.hide(), this.getBtnCount() > 1 && l && l.hide()) }, this.setVisible = function (n) { this.visible = n; n ? (a.show(), v.show(), this.getBtnCount() > 1 && l && l.show()) : (a.hide(), v.hide(), this.getBtnCount() > 1 && l && l.hide()) }, this.setReadOnly = function (n) { this.isReadOnly = n; a.prop("disabled", n ? !0 : !1); n ? v.css("opacity", .7) : v.css("opacity", 1); this.setBackground(!1) }, l) l.on(t.Events.onClick, function (n) { l.w2overlay(p.clone(!0)); n.stopPropagation() }); if (p) p.on("click", "LI", function (i) { var u = n(i.target).data("action"), r; if (u == t.Actions.preference) r = new t.ValuePreference(c.mField, c.getValue(), c.getDisplay()), r != null && r.showDialog(), r = null; else if (u == t.Actions.zoom) k(); else if (u == t.Actions.remove) { if (c.isReadOnly) return; c.setValue(null, !1, !0) } }); this.getText = function () { return a.val() }; this.setDefaultValue = function (n) { this.defaultValue = n }; v.on(t.Events.onClick, function (n) { (n.stopPropagation(), c.isReadOnly) || c.actionText(!0) }); this.actionText = function (i) { c.value || (c.value = 0); var r = a.val().trim(), u = t.Env.parseContext(t.Env.getCtx(), h, c.lookup.getTabNo(), c.lookup.info.validationCode, !1, !0); !r || i ? c.openForm(0, 0, r, u) : n.ajax({ url: ut + "productContainer/GetProductContainer", data: { text: r, validation: u }, success: function (n) { n = JSON.parse(n); n == "null" || n == null || n == "" || n == 0 ? c.openForm(0, 0, r, u) : c.setVal(n) }, error: function () { } }) }; a.on("keydown", function (n) { (n.keyCode == 13 || n.keyCode == 9) && c.actionText(!1) }); this.setVal = function (n) { c.oldValue = 0; c.setValue(n); var t = { newValue: n, propertyName: c.getColumnName() }; c.fireValueChanged(t, !0); t = null }; this.openForm = function (n, i, r, u) { c.oldValue = c.value; var f = new t.productContainerTree(n, i, r, u); f != null && (f.showDialog(), f.onClosing = function (n) { c.setVal(n) }); f = null }; this.disposeComponent = function () { v.off(t.Events.onClick); c = null; a = null; v = null; this.setVisible = null } } function et(r, u, f) { this.colSql = r; this.windowNo = u; this.cache = {}; this.needtoParse = !1; r.contains("@") && (this.needtoParse = !0); var o = ' for="' + f + '"', e = n("<span " + o + "><\/span>"); i.call(this, e, t.DisplayType.Label, !0, "lbl" + f); this.disposeComponent = function () { e = null; self = null; this.format && this.format.dispose(); this.format = null; this.cache = {}; this.cache = null } } function f(t, r, u, f, e, o, s) { var a = n('<div class="vis-progressCtrlWrap">'), h = n("<input>", { type: "range", step: "1", name: t, maxlength: o, "data-type": "int" }), c = n('<output  class="vis-progress-output">'), l; a.append(c).append(h); i.call(this, a, s, u, t, r); u || !f ? this.setReadOnly(!0) : this.setReadOnly(!1); this.rangeCtrl = h; this.oputput = c; c.text(0); this.setText = function (n) { c.text(n) }; this.setRange = function (n) { n != null ? h.val(n) : h.val(0) }; this.getRange = function () { return h.val() }; l = this; c.keypress(function (t) { (t.which < 46 || t.which > 59) && t.preventDefault(); (t.which == 46 && n(this).val().indexOf(".") != -1 || t.which == 44 && n(this).val().indexOf(",") != -1) && t.preventDefault() }).on("blur", function () { n.isNumeric(h.attr("max")) && Number(h.attr("max")) < Number(n(this).text()) && n(this).text(h.attr("max")); h.val(n(this).text() || 0).change() }); h.on("input", function (n) { n.stopPropagation(); var t = h.val(); c.show(); c.text(t) }); h.on("change", function (n) { var t, i; n.stopPropagation(); t = h.val(); t !== l.oldValue && (i = { newValue: t, propertyName: l.getName() }, l.fireValueChanged(i), i = null) }); this.disposeComponent = function () { a = null; h = null; this.rangeCtrl = this.$oputput = null; l = null } } var ut = t.Application.contextUrl, ct = ut + "JsonData/JDataSetWithCode", lt = ut + "JsonData/ExecuteNonQuer", at = ut + "Form/JDataSet", o = function (n, i, r) { var e = r ? !0 : !1, f = { sql: n, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, st(f, e, function (n) { u = (new t.DB.DataReader).toJson(n); r && r(u) }), u }, pt = function (n, i, r) { var e = r ? !0 : !1, f = { sql: n, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, st(f, e, function (n) { u = (new t.DB.DataSet).toJson(n); r && r(u) }), u }, ot = function (n, i, r) { var f = r ? !0 : !1, e = { sql: n, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, st(e, f, function (n) { i = (new t.DB.DataSet).toJson(n); var i = (new t.DB.DataSet).toJson(n); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, wt = function (t, i, r) { var f = r ? !0 : !1, u = null, e = { sql: t.join("/"), param: i }; return n.ajax({ url: lt + "iesWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }, vt = function (n, i, r) { var e = r ? !0 : !1, f = { sql: n, page: 1, pageSize: 0 }, u; return f.sql = t.secureEngine.encrypt(f.sql), i && (f.param = i), u = null, yt(f, e, function (n) { i = (new t.DB.DataSet).toJson(n); var i = (new t.DB.DataSet).toJson(n); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; e && r(u) }), u }; t.DisplayType = { String: 10, Integer: 11, Amount: 12, ID: 13, Text: 14, Date: 15, DateTime: 16, List: 17, Table: 18, TableDir: 19, YesNo: 20, Location: 21, Number: 22, Binary: 23, Time: 24, Account: 25, RowID: 26, Color: 27, Button: 28, Quantity: 29, Search: 30, Locator: 31, Image: 32, Assignment: 33, Memo: 34, PAttribute: 35, TextLong: 36, CostPrice: 37, FilePath: 38, FileName: 39, URL: 40, PrinterName: 42, Label: 44, MultiKey: 45, GAttribute: 46, AmtDimension: 47, ProductContainer: 48, ProgressBar: 49, IsString: function (n) { return t.DisplayType.String == n }, IsText: function (n) { return n == t.DisplayType.String || n == t.DisplayType.Text || n == t.DisplayType.TextLong || n == t.DisplayType.Memo || n == t.DisplayType.FilePath || n == t.DisplayType.FileName || n == t.DisplayType.URL || n == t.DisplayType.PrinterName ? !0 : !1 }, IsLookup: function (n) { return t.DisplayType.List == n || n == t.DisplayType.TableDir || n == t.DisplayType.Table || n == t.DisplayType.Search || n == t.DisplayType.MultiKey || n == t.DisplayType.ProductContainer ? !0 : !1 }, IsInt: function (n) { return n == t.DisplayType.Integer || n == t.DisplayType.ProgressBar ? !0 : !1 }, IsSearch: function (n) { return n == this.Search ? !0 : !1 }, IsID: function (n) { return n == t.DisplayType.ID || n == t.DisplayType.Table || n == t.DisplayType.TableDir || n == t.DisplayType.Search || n == t.DisplayType.Location || n == t.DisplayType.Locator || n == t.DisplayType.Account || n == t.DisplayType.Assignment || n == t.DisplayType.PAttribute || n == t.DisplayType.Image || n == t.DisplayType.Color || n == t.DisplayType.AmtDimension || n == t.DisplayType.ProductContainer ? !0 : !1 }, IsNumeric: function (n) { return n == t.DisplayType.Amount || n == t.DisplayType.Number || n == t.DisplayType.CostPrice || n == t.DisplayType.Integer || n == t.DisplayType.Quantity || n == t.DisplayType.ProgressBar ? !0 : !1 }, IsDate: function (n) { return n == t.DisplayType.Date || n == t.DisplayType.DateTime || n == t.DisplayType.Time ? !0 : !1 }, IsLOB: function (n) { return n == t.DisplayType.Binary || n == t.DisplayType.TextLong ? !0 : !1 }, MAX_DIGITS: 28, INTEGER_DIGITS: 10, MAX_FRACTION: 12, AMOUNT_FRACTION: 2, GetNumberFormat: function (n) { return n == this.Integer || n == this.ProgressBar ? new t.Format(this.INTEGER_DIGITS, 0, 0) : n == this.Quantity ? new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, 0) : n == this.Amount ? new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, this.AMOUNT_FRACTION) : n == this.CostPrice ? new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, this.AMOUNT_FRACTION) : new t.Format(this.MAX_DIGITS, this.MAX_FRACTION, 1) } }; t.VControlFactory = { getControl: function (n, i, e, o) { var ft, ot, ti, ei, ii, yt, pt, wt, oi, si, hi, dt, ci, gt, ni, bt, li, ai, vi, kt, lt, at; if (!i || (ft = i.getColumnName(), ot = i.getIsMandatory(!1), i.getIsHeading())) return null; var yi = i.getIsDisplayed(), ri = i.getMinValue(), ui = i.getMaxValue(), et = null, ut = i.getDisplayType(), st = i.getIsReadOnly(), ct = i.getIsEditable(!1), vt = i.getWindowNo(), fi = 0; return n && (fi = n.getTabNo()), ut == t.DisplayType.Button ? (ti = new r(ft, ot, st, ct, i.getHeader(), i.getDescription(), i.getHelp(), i.getAD_Process_ID(), i.getIsLink(), i.getIsRightPaneLink(), i.getAD_Form_ID(), i.getIsBackgroundProcess(), i.getAskUserBGProcess()), ti.setField(i), ti.setReferenceKey(i.getAD_Reference_Value_ID()), et = ti) : ut == t.DisplayType.String ? (at = new v(ft, ot, st, ct, i.getDisplayLength(), i.getFieldLength(), i.getVFormat(), i.getObscureType(), i.getIsEncryptedField()), at.setField(i), et = at) : ut == t.DisplayType.YesNo ? (ei = new b(ft, ot, st, ct, i.getHeader(), i.getDescription(), i.getIsSwitch()), ei.setField(i), et = ei) : t.DisplayType.IsDate(ut) ? (ut == t.DisplayType.DateTime && (readOnly = !0), ii = new k(ft, ot, st, ct, ut, i.getHeader()), ii.setName(ft), ii.setField(i), et = ii) : t.DisplayType.IsLookup(ut) || t.DisplayType.ID == ut ? (yt = i.getLookup(), o && yt != null && yt.disableValidation(), o ? yt == null || ut != t.DisplayType.Search && yt.getDisplayType() != t.DisplayType.Search ? (pt = new s(ft, ot, st, ct, yt, i.getDisplayLength(), ut, i.getZoomWindow_ID()), pt.setDisplayType(ut), pt.setField(i), et = pt) : (ut = t.DisplayType.Search, wt = new h(ft, ot, st, ct, ut, yt, i.getZoomWindow_ID()), wt.setField(i), et = wt) : ut != t.DisplayType.Search && ut != t.DisplayType.MultiKey && ut != t.DisplayType.ProductContainer ? (pt = new s(ft, ot, st, ct, yt, i.getDisplayLength(), ut, i.getZoomWindow_ID()), pt.setField(i), et = pt) : ut == t.DisplayType.ProductContainer ? (lt = new w(ft, ot, st, ct, ut, i.getLookup(), vt), lt.setField(i), et = lt) : (wt = new h(ft, ot, st, ct, ut, yt, i.getZoomWindow_ID()), wt.setField(i), et = wt)) : ut == t.DisplayType.Location ? (oi = new g(ft, ot, st, ct, ut, i.getLookup()), oi.setField(i), et = oi) : ut == t.DisplayType.Locator ? (si = new l(ft, ot, st, ct, ut, i.getLookup()), si.setField(i), et = si) : t.DisplayType.Text == ut || t.DisplayType.TextLong == ut || t.DisplayType.Memo == ut ? (hi = new it(ft, ot, st, ct, i.getDisplayLength(), i.getFieldLength(), ut), hi.setField(i), et = hi) : t.DisplayType.IsNumeric(ut) ? t.DisplayType.Amount == ut || t.DisplayType.Quantity == ut || t.DisplayType.CostPrice == ut ? (dt = new c(ft, ot, st, ct, i.getDisplayLength(), i.getFieldLength(), ut, "FixedHeader"), dt.setMinValue(ri), dt.setMaxValue(ui), dt.setField(i), et = dt) : t.DisplayType.Integer == ut ? (ci = new d(ft, ot, st, ct, i.getDisplayLength(), i.getFieldLength(), "FixedHeader"), ci.setField(i), et = ci) : t.DisplayType.Number == ut ? (gt = new c(ft, ot, st, ct, i.getDisplayLength(), i.getFieldLength(), ut, "FixedHeader"), gt.setField(i), gt.setMinValue(ri), gt.setMaxValue(ui), et = gt) : ut == t.DisplayType.ProgressBar && (ni = new f(ft, ot, st, ct, i.getDisplayLength(), i.getFieldLength(), ut), ni.setField(i), ni.setMinValue(ri), ni.setMaxValue(ui), et = ni) : ut == t.DisplayType.PAttribute ? (bt = new u(ft, ot, st, ct, ut, i.getLookup(), vt, !1, !1, !1, !0, fi), bt.setField(i), et = bt) : ut == t.DisplayType.GAttribute ? (bt = new u(ft, ot, st, ct, ut, i.getLookup(), vt, !1, !1, !1, !1, fi), bt.setField(i), et = bt) : ut == t.DisplayType.Account ? (li = new nt(ft, ot, st, ct, ut, i.getLookup(), vt, i.getHeader()), li.setField(i), et = li) : ut == t.DisplayType.Binary ? (ai = new y(ft, ot, st, ct, vt), ai.setField(i), et = ai) : ut == t.DisplayType.Image ? (vi = new a(ft, ot, st, vt), vi.setField(i), et = vi) : ut == t.DisplayType.URL ? (kt = new rt(ft, ot, st, ct, i.getDisplayLength(), i.getFieldLength()), kt.setField(i), et = kt) : ut == t.DisplayType.FileName || ut == t.DisplayType.FilePath ? (kt = new p(ft, ot, st, ct, vt, ut), kt.setField(i), et = kt) : ut == t.DisplayType.Label ? (at = new ht(i.getHelp(), ft, !1, !0), at.setField(i), et = at) : ut == t.DisplayType.AmtDimension ? (lt = new tt(ft, ot, st, ct, ut, i.getLookup(), vt), lt.setField(i), lt.setDefaultValue(i.vo.DefaultValue), et = lt) : ut == t.DisplayType.ProductContainer && (lt = new w(ft, ot, st, ct, ut, i.getLookup(), vt), lt.setField(i), et = lt), et == null && (at = new v(ft, ot, st, ct, i.getDisplayLength(), i.getFieldLength(), i.getVFormat(), i.getObscureType(), i.getIsEncryptedField()), at.setField(i), et = at), et }, getLabel: function (n) { if (n == null) return null; var i = n.getDisplayType(); return n.getIsFieldOnly() || i == t.DisplayType.YesNo || i == t.DisplayType.Button || i == t.DisplayType.Label ? null : new t.Controls.VLabel(n.getHeader(), n.getColumnName(), n.getIsMandatory()) }, getHeaderLabel: function (n) { if (n == null) return null; var i = n.getDisplayType(); return n.getHeaderIconOnly() && n.getHeaderHeadingOnly() || n.getHeaderIconOnly() || i == t.DisplayType.Button || i == t.DisplayType.Label ? null : new t.Controls.VLabel(n.getHeader(), n.getColumnName(), n.getIsMandatory()) }, getReadOnlyControl: function (n, i) { var u, s, h; if (!i) return null; var o = i.getColumnName(), c = i.getIsMandatory(!1), l = i.getWindowNo(), f = i.getOrginalDisplayType(), v = i.getIsReadOnly(), y = i.getIsEditable(!1), e = null; return f == t.DisplayType.Image ? (u = new a(o, c, !0, l), u.setDimension(120, 140), u.hideText(), u.hideEditIcon(), e = u) : f == t.DisplayType.Button ? (s = new r(o, c, v, y, i.getHeader(), i.getDescription(), i.getHelp(), i.getAD_Process_ID(), i.getIsLink(), i.getIsRightPaneLink(), i.getAD_Form_ID(), i.getIsBackgroundProcess(), i.getAskUserBGProcess()), s.setField(i, !0), e = s) : (h = new ft(i.getHelp(), o, !1, !0), t.DisplayType.IsNumeric(f) && (h.format = t.DisplayType.GetNumberFormat(f)), e = h), e }, getIcon: function (n) { return n.getFontClass() ? "<i class='" + n.getFontClass() + "'> <\/i>" : n.getAD_Image_ID() > 0 ? "<img src='" + t.Application.contextUrl + "Images/Thumb16x16/" + n.getAD_Image_ID() + ".jpg' > " : void 0 } }; i.prototype.getControl = function () { return this.ctrl }; i.prototype.getRoot = function () { return this.root ? this.root : this.ctrl }; i.prototype.getField = function () { return this.mField }; i.prototype.getName = function () { return this.colName }; i.prototype.getColumnName = function () { return this.colName }; i.prototype.getIsMandatory = function () { return this.isMandatory }; i.prototype.getIsReadonly = function () { return this.readOnly }; i.prototype.getDisplayType = function () { return this.displayType }; i.prototype.getIsVisible = function () { return this.visible }; i.prototype.getValue = function () { return this.ctrl.val() }; i.prototype.getDisplay = function () { return this.ctrl.val() }; i.prototype.getBtnCount = function () { return 0 }; i.prototype.setName = function (n, t) { t ? this.name = t + n : this.colName = n }; i.prototype.setField = function (n) { this.mField = n }; i.prototype.setValue = function () { }; i.prototype.setVisible = function (n) { this.visible = n; n ? this.ctrl.show() : this.ctrl.hide() }; i.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; i.prototype.setHtmlStyle = function (n) { n && this.dynStyle != n ? (n.contains(":") ? (this.dynStyle || (this.oldStyle = this.ctrl.attr("style")), this.ctrl.removeAttr(n).attr("style", n)) : this.ctrl.addClass(n), this.dynStyle = n) : !n && this.dynStyle && (this.dynStyle.contains(":") ? (this.ctrl.removeAttr("style"), this.oldStyle && this.ctrl.attr("style", this.oldStyle)) : this.ctrl.removeClass(this.dynStyle), this.oldStyle = null, this.dynStyle = null) }; i.prototype.setDefaultFocus = function (n) { n && this.ctrl.focus() }; i.prototype.setMandatory = function (n) { this.isMandatory = n; this.setBackground(!1) }; i.prototype.setBackground = function (n) { if (!this.colName.startsWith("lbl") && this.displayType != t.DisplayType.Label && this.displayType != t.DisplayType.YesNo && this.displayType != t.DisplayType.Button && this.displayType != t.DisplayType.ProgressBar) if (typeof n == "boolean") if (n) this.setBackground("vis-ev-col-error"); else if (this.isReadOnly) this.setBackground("vis-ev-col-readonly"); else if (this.isMandatory) { var i = this.getValue(); if (i && i.toString().length > 0) { this.setBackground(""); return } this.setBackground("vis-ev-col-mandatory") } else this.setBackground(""); else { if (this.activeClass == n) return; this.ctrl.removeClass(); n.length > 0 && this.ctrl.addClass(n); this.activeClass = n } }; i.prototype.setDisplayType = function (n) { this.displayType = n }; i.prototype.addVetoableChangeListener = function (n) { this.vetoablechangeListner = n }; i.prototype.fireValueChanged = function (n, t) { if (this.isReadOnly) { var i = this.oldValue; this.oldValue = ""; this.setValue(i); return } this.editingGrid && (this.gridPos.dialog || t) ? window.setTimeout(function (t) { t.ctrl.parent().length != 0 && t.ctrl.detach(); t.editingGrid.editChange.call(t.editingGrid, t.ctrl[0], t.gridPos.index, t.gridPos.col, n, n.newValue); t = null; n = null }, 10, this) : this.vetoablechangeListner && !this.editingGrid && window.setTimeout(function (t) { t.vetoablechangeListner.vetoablechange(n); t = null; n = null }, 10, this) }; i.prototype.fireRefreshUI = function (n) { this.vetoablechangeListner && window.setTimeout(function (t) { t.vetoablechangeListner.refreshUI(n); t = null; n = null }, 10, this) }; i.prototype.addActionListner = function (n) { this.actionListner = n }; i.prototype.invokeActionPerformed = function (n) { this.actionListner && this.actionListner.actionPerformed(n) }; i.prototype.dispose = function () { console.log("dispose "); this.ctrl.remove(); this.ctrl = null; this.mField = null; this.displayType = null; this.isReadOnly = null; this.colName = null; this.isMandatory = null; this.oldValue = null; this.vetoablechangeListner = null; this.actionListner = null; this.disposeComponent() }; t.Utility.inheritPrototype(v, i); v.prototype.setReadOnly = function (n, t) { n || !this.obscureType || t || this.mField.getIsInserting() && this.ctrl.val() == "" || (n = !0); this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; v.prototype.setValue = function (n) { this.oldValue != n && (this.obscureType && (!this.mField.getIsInserting() || this.ctrl.val() != "") ? (this.ctrl.val(t.Env.getObscureValue(this.obscureType, n)), this.setReadOnly(!0)) : this.ctrl.val(n), this.oldValue = n) }; v.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(ht, i); t.Utility.inheritPrototype(ft, i); ft.prototype.setValue = function (n, t) { this.oldValue != n && (this.oldValue = n, this.ctrl.text(n), t && this.ctrl.html(n)) }; ft.prototype.getValue = function () { return this.value != null ? this.ctrl.text().toString() : null }; t.Utility.inheritPrototype(r, i); r.prototype.referenceList = {}; r.prototype.setField = function (n, i) { this.mField = n; n.getShowIcon() && (n.getFontClass() != "" || n.getImageName() != "") && (n.getFontClass() != "" ? this.setIcon(n.getFontClass()) : this.setIcon(t.Application.contextUrl + "Images/Thumb16x16/" + n.getImageName(), !0)); this.setLayout(i) }; r.prototype.setReferenceKey = function (n) { n && n > 0 && n != 195 && n != 135 && n != 234 && this.readReference(n) }; r.prototype.setValue = function (n) { var i, r; this.value = n; i = this.text; n == null || this.colName.equals("Record_ID") || (this.values != null ? i = this.values[n] : this.lookup != null && (r = this.lookup.get(n), r != null && (i = r.getName()))); i || (i = t.Msg.getMsg("Invalid") + " { '" + n + "' }"); this.setText(i != null ? i : "") }; r.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.css("opacity", n ? .6 : 1); this.isLink || this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; r.prototype.getValue = function () { return this.value != null ? this.value.toString() : null }; r.prototype.getDisplay = function () { return this.value }; r.prototype.readReference = function (n) { var r, u, i; if (this.values = null, this.referenceList && (this.values = this.referenceList[n]), this.values) return this.values; this.values = {}; r = t.Env.isBaseLanguage(t.Env.getCtx(), "") ? "VIS_82" : "VIS_148"; u = []; u[0] = new t.DB.SqlParam("@AD_Reference_ID", n); try { for (i = o(r, u); i.read();)this.values[i.getString(0)] = i.getString(1); this.referenceList[n] = this.values; i.close() } catch (f) { t.Logging.VLogger.getVLogger().get().log(t.Logging.Level.SEVERE, r, f) } }; r.prototype.getProcess_ID = function () { return this.AD_Process_ID }; r.prototype.getAD_Form_ID = function () { return this.AD_Form_ID }; r.prototype.getDescription = function () { return this.description }; r.prototype.getHelp = function () { return this.help }; r.prototype.getAskUserBGProcess = function () { return this.askUserBGProcess }; r.prototype.getIsBackgroundProcess = function () { return this.isBackgroundProcess }; t.Utility.inheritPrototype(b, i); b.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.cBox.prop("checked", n)) }; b.prototype.getValue = function () { return this.cBox.prop("checked") }; b.prototype.getDisplay = function () { return this.cBox.prop("checked").toString() }; t.Utility.inheritPrototype(s, i); s.prototype.setValue = function (n, i) { var u, f, r, e; if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.ctrl.val(n), n == null) { this.lastDisplay = ""; this.settingValue = !1; return } if (this.lookup == null) { this.lastDisplay = n.toString(); this.settingValue = !1; return } if (this.lastDisplay = this.lookup.getDisplay(n, !0), this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null), this.inserting = i, u = this.lastDisplay.startsWith("<") && this.lastDisplay.endsWith(">"), f = this.ctrl.val(), f == null || this.inserting && this.lookup.getDisplayType() != t.DisplayType.Search) { if (u && this.lookup.loading) { window.setTimeout(function (t) { t.setValue(n, i); t = null; return }, 500, this); this.oldValue = "oldValue"; return } u && (this.lastDisplay = this.lookup.getDisplay(n, !1), u = this.lastDisplay.startsWith("<") && this.lastDisplay.endsWith(">")); u ? (this.oldValue = "old", this.ctrl.val(null), this.inserting && this.ctrl.trigger("change")) : this.ctrl.val() == null && (this.inserting && !this.lookup.info.isParent && this.lookup.getIsValidated() && this.lookup.allLoaded ? (this.lookup.fillCombobox(this.getIsMandatory(), !1, !1, !1), this.lookup.loading || this.refreshOptions(this.lookup.data, n)) : (r = null, this.lookup.loading || (r = this.lookup.getFromList(n)), r == null && (r = this.lookup.get(n)), r != null && (e = t.Utility.Util.getIdentifierDisplayVal(r.Name), this.ctrl.append('<option value="' + r.Key + '">' + e + "<\/option>"), this.ctrl.val(n)))); this.ctrl.val() == null && n != null && (this.oldValue = null) } this.settingValue = !1 } this.inserting = !1 }; s.prototype.getDisplayValue = function (n) { var t = ""; return n.indexOf("Images/") > -1 ? (t = n.replace("^^" + n.substring(n.indexOf("Images/"), n.lastIndexOf("^^") + 3), "_"), t.indexOf("Images/") > -1 && (t = t.replace(t.substring(t.indexOf("Images/"), t.lastIndexOf("^^") + 3), "_"))) : t = n, t }; s.prototype.getValue = function () { var n = this.ctrl.val(); return n == "-1" ? null : n }; s.prototype.refreshOptions = function (n, i) { for (var u = [], f = -1, e, r = 0; r < n.length; r++)i && i == n[r].Key && (f = r), e = t.Utility.Util.getIdentifierDisplayVal(n[r].Name), u[r] = '<option value="' + n[r].Key + '">' + e + "<\/option>"; this.ctrl.empty(); this.ctrl.html(u.join("")); this.ctrl[0].selectedIndex = f }; s.prototype.getDisplay = function () { return this.lookup == null ? this.ctrl.val() : this.lookup.getDisplay(this.ctrl.val()) }; t.Utility.inheritPrototype(k, i); k.prototype.setValue = function (n) { var i, f, e, r, u; if (this.oldValue != n) { if (this.oldValue = n, n == null || n == "") { this.ctrl.val(""); return } i = new Date(n); this.displayType != t.DisplayType.Date && i.setMinutes(-i.getTimezoneOffset() + i.getMinutes()); n = i.toISOString(); f = n.substring(0, n.length - 1); e = n.indexOf("T"); this.displayType == t.DisplayType.DateTime ? this.ctrl.val(f) : this.displayType == t.DisplayType.Date ? this.ctrl.val(f.substring(0, e)) : (r = i.getUTCHours(), u = i.getUTCMinutes(), this.ctrl.val((r < 10 ? "0" + r : r) + ":" + (u < 10 ? "0" + u : u))) } }; k.prototype.getValue = function () { var i = this.ctrl.val(), n; if (i == null || i == "") return null; if (n = null, this.displayType == t.DisplayType.Time) { n = new Date(0); var r = i.match(/(\d+)\:(\d+)/), u = parseInt(r[1], 10), f = parseInt(r[2], 10); n.setHours(u); n.setMinutes(f) } else n = new Date(i + "Z"); try { return this.displayType == t.DisplayType.DateTime && n.setMinutes(n.getTimezoneOffset() + n.getMinutes()), n.toISOString().replace(".000Z", "Z") } catch (e) { return console.log(i), new Date } }; k.prototype.getDisplay = function () { return this.getValue() }; t.Utility.inheritPrototype(h, i); h.prototype.setValue = function (n, i, r) { var s, e, o, h, f, c, u; if (this.oldValue != n || i) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; r && (u = { newValue: n, propertyName: this.getName() }, this.fireValueChanged(u), u = null); return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } if (this.displayType !== t.DisplayType.MultiKey) this.lastDisplay = this.lookup.getDisplay(n); else { for (s = n.toString().split(","), e = "", o = 0, h = s.length; o < h; o++) { if (f = s[o], isNaN(f) || (f = Number(f)), e.length == 0) { e += this.lookup.getDisplay(f); continue } e += ", " + this.lookup.getDisplay(f) } this.lastDisplay = e } this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = n; c = t.Utility.Util.getIdentifierDisplayVal(this.lastDisplay); this.ctrl.val(t.Utility.decodeText(c)); this.settingValue = !1; r && ((n == -1 || n == "") && (n = null), u = { newValue: n, propertyName: this.getName() }, this.fireValueChanged(u), u = null) } else n == null && this.ctrl.val("") }; h.prototype.getValue = function () { return this.value }; h.prototype.getMultipleIds = function () { return this.infoMultipleIds }; h.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; h.prototype.setCustomInfo = function (n) { n != null && (this.custInfoWin = n) }; t.Utility.inheritPrototype(it, i); it.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.ctrl.val(n)) }; it.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(c, i); c.prototype.setValue = function (n) { if (this.oldValue != n) { this.oldValue = n; n = this.format.GetFormatedValue(n); this.ctrl.attr("type", "text"); var t = this.format.GetFormatAmount(n, "init", this.dotFormatter); this.ctrl.val(t) } }; c.prototype.getValue = function () { var n = this.$super.getValue.call(this); return (n = this.format.GetConvertedNumber(n, this.dotFormatter), isNaN(n) || n === null) ? null : Number(n) }; c.prototype.getDisplay = function () { return this.ctrl.val() }; c.prototype.setMaxValue = function (t) { n.isNumeric(t) && this.ctrl.attr("max", t) }; c.prototype.setMinValue = function (t) { n.isNumeric(t) && this.ctrl.attr("min", t) }; t.Utility.inheritPrototype(d, i); d.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.ctrl.val(n)) }; d.prototype.getValue = function () { var n = this.$super.getValue.call(this); return n === null ? null : (this.editingGrid && (n = this.format.GetFormatedValue(n)), n) }; d.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(g, i); g.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } this.lastDisplay = this.lookup.getDisplay(n); this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = n; this.ctrl.val(t.Utility.decodeText(this.lastDisplay)); this.settingValue = !0 } }; g.prototype.getValue = function () { return this.value }; g.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(l, i); l.prototype.getOnlyWarehouseID = function () { var r = t.Env.getCtx(), u = r.getContext(this.windowNum, "0|AD_Table_ID", !0), n, i; if ("572" == u) return 0; n = r.getContext(this.windowNum, "M_Warehouse_ID", !0); i = 0; try { n != null && n.length > 0 && (i = Number(n)) } catch (f) { } return i }; l.prototype.getOnlyProductID = function () { var r = t.Env.getCtx(), u = r.getContext(this.windowNum, "0|AD_Table_ID", !0), n, i; if ("572" == u) return 0; n = r.getContext(this.windowNum, "M_Product_ID", !0); i = 0; try { n != null && n.length > 0 && (i = Number(n)) } catch (f) { } return i }; l.prototype.showLocatorForm = function (n, i) { var u = 0, r; this.value != null && (u = Number(this.value)); this.lookup.setOnlyWarehouseID(n); this.lookup.setOnlyProductID(i); var f = "Y".equals(t.context.getWindowContext(this.windowNum, "IsReturnTrx")), e = t.Env.getCtx().isSOTrx(this.windowNum), o = (e && !f || !e && f) && this.columnName == "M_Locator_ID"; this.lookup.setOnlyOutgoing(o); this.lookup.refresh(); self = this; r = new t.LocatorForm(this.columnName, this.lookup, u, this.mandatory, n, this.windowNum); r.load(); r.showDialog(); r.onClose = function (n) { if (self.oldValue != n) { self.setValue(n); var t = { newValue: n, propertyName: self.columnName }; self.fireValueChanged(t); t = null } } }; l.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } this.lastDisplay = this.lookup.getDisplay(n); this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = n; this.ctrl.val(this.lastDisplay); this.settingValue = !0 } }; l.prototype.getValue = function () { return this.value }; l.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(u, i); u.prototype.setValue = function (n) { (n == null || 0 === n) && (this.ctrl.text(""), this.value = n); this.value = n; this.ctrl.val(this.lookup.getDisplay(n)) }; u.prototype.setField = function (n) { n != null && (this.windowNo = n.getWindowNo(), this.AD_Column_ID = n.getAD_Column_ID()); this.mField = n }; u.prototype.getValue = function () { return this.value }; u.prototype.genSetInstanceIDs = function () { return this.setInstanceIDs }; u.prototype.getDisplay = function () { return this.ctrl.val() }; u.prototype.getCanSaveRecord = function () { return this.canSaveRecord }; u.prototype.setCanSaveRecord = function (n) { return this.canSaveRecord = n }; t.Utility.inheritPrototype(nt, i); nt.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.value = n, this.ctrl.val(this.lookup.getDisplay(n))) }; nt.prototype.getValue = function () { return this.value }; nt.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(a, i); a.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.oldValue = n, this.value = n, n == null) { this.setIcon(null); this.value = 0; this && this.ctrl.val(null); return } this.refreshImage(n) } }; a.prototype.refreshImage = function (i) { var r = this; n.ajax({ url: t.Application.contextUrl + "VImageForm/GetImageAsByte", dataType: "json", data: { ad_image_id: i }, success: function (n) { var n = JSON.parse(n); n ? r.setIcon(n.Bytes, n.Path) : r.setIcon(null, null); r.ctrl.val(i); r = null } }) }; a.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.isLink ? this.ctrl.css("opacity", n ? .6 : 1) : this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; a.prototype.getValue = function () { return this.value }; a.prototype.getDisplay = function () { return this.value }; t.Utility.inheritPrototype(y, i); y.prototype.setValue = function (n) { var t, i; this.oldValue != n && (this.oldValue = n, n == null ? (this.setText("-"), this.value = n, this.ctrl.val(n)) : (t = "?", n.length > 0 ? (i = n, t = "#" + i.length) : t = n.GetType().FullName, this.setText(t != null ? t : ""), this.value = n, this.ctrl.val(n))) }; y.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; y.prototype.getValue = function () { return this.value }; y.prototype.getDisplay = function () { return this.value }; t.Utility.inheritPrototype(rt, i); rt.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); return } this.value = n; this.ctrl.val(n); this.ctrl.val(n) } }; rt.prototype.getValue = function () { return this.value }; rt.prototype.getDisplay = function () { return this.ctrl.val() }; t.Utility.inheritPrototype(p, i); p.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.value = n, this.ctrl.val(n)) }; p.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.prop("disabled", n ? !0 : !1); this.setBackground(!1) }; p.prototype.getValue = function () { return this.value }; p.prototype.getDisplay = function () { return this.value }; t.Utility.inheritPrototype(tt, i); tt.prototype.setValue = function (n) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { this.lastDisplay = ""; this.ctrl.val(""); this.settingValue = !1; return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } if (this.lastDisplay = this.lookup.getDisplay(n), this.lastDisplay && this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null), this.value = this.lastDisplay && this.lastDisplay.indexOf("<") > -1 ? this.lastDisplay : n, this.lastDisplay) { var t = this.format.GetFormatedValue(this.lastDisplay); this.ctrl.val(this.format.GetFormatAmount(t, "init", this.dotFormatter)) } this.settingValue = !0 } }; tt.prototype.getValue = function () { return this.value }; tt.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(w, i); w.prototype.setValue = function (n, i, r) { if (this.oldValue != n) { if (this.settingValue = !0, this.oldValue = n, this.value = n, n == null) { if (this.lastDisplay = "", this.ctrl.val(""), this.settingValue = !1, r) { var u = { newValue: n, propertyName: this.getName() }; this.fireValueChanged(u); u = null } return } if (this.lookup == null) { this.ctrl.val(n.toString()); this.lastDisplay = n.toString(); this.settingValue = !1; return } this.lastDisplay = this.lookup.getDisplay(n); this.lastDisplay.equals("<-1>") && (this.lastDisplay = "", this.oldValue = null, this.value = null); this.value = this.lastDisplay.indexOf("<") > -1 ? this.lastDisplay : n; this.ctrl.val(t.Utility.decodeText(this.lastDisplay)); this.settingValue = !0 } }; w.prototype.getValue = function () { return this.value }; w.prototype.getDisplay = function () { return this.lookup == null ? this.value : this.lookup.getDisplay(this.value) }; t.Utility.inheritPrototype(et, i); et.prototype.setValue = function (n, i) { var r = null, e, u, f; if (r = this.needtoParse ? t.Env.parseContext(t.context, this.windowNo, 0, this.colSql, !1, !0) : this.colSql, r && r.length != 0) if (e = r.toUpperCase().lastIndexOf("WHERE"), u = "-1", e > -1 && (u = r.substring(e)), this.cache[u]) this.ctrl.text(this.cache[u]), i && this.ctrl.html(this.cache[u]); else { if (r.toLowerCase().indexOf("select") == -1) { this.cache[u] = r; this.ctrl.text(r); return } f = this; vt(r, null, function (n) { n ? f.ctrl.text(n) : f.ctrl.text(""); f.cache[u] = n }) } }; et.prototype.getValue = function () { return this.value != null ? this.ctrl.text().toString() : null }; t.Utility.inheritPrototype(f, i); f.prototype.setValue = function (n) { this.oldValue != n && (this.oldValue = n, this.setText(n), this.setRange(n)) }; f.prototype.getValue = function () { return this.getRange() }; f.prototype.setMaxValue = function (t) { n.isNumeric(t) ? this.rangeCtrl.attr("max", t) : this.rangeCtrl.attr("max", 100) }; f.prototype.setMinValue = function (t) { n.isNumeric(t) && this.rangeCtrl.attr("min", t) }; f.prototype.getDisplay = function () { return this.rangeCtrl.val() }; f.prototype.getControl = function (n) { return n ? (n.addClass("vis-progressCtrlWrap"), n.append(this.oputput), this.rangeCtrl) : this.ctrl }; f.prototype.setReadOnly = function (n) { this.isReadOnly = n; this.ctrl.find("input").prop("disabled", n ? !0 : !1); this.ctrl.find("output").attr("contenteditable", n ? !1 : !0); this.setBackground(!1) }; t.Controls.IControl = i; t.Controls.VTextBox = v; t.Controls.VLabel = ht; t.Controls.VButton = r; t.Controls.VCheckBox = b; t.Controls.VComboBox = s; t.Controls.VTextBoxButton = h; t.Controls.VTextArea = it; t.Controls.VAmountTextBox = c; t.Controls.VNumTextBox = d; t.Controls.VLocation = g; t.Controls.VDate = k; t.Controls.VLocator = l; t.Controls.VAccount = nt; t.Controls.VPAttribute = u; t.Controls.VImage = a; t.Controls.VBinary = y; t.Controls.VFile = p; t.Controls.VAmtDimension = tt; t.Controls.VProductContainer = w; t.Controls.VKeyText = et; t.Controls.VProgressBar = f }(jQuery, VIS), function (n, t) { function h(t, i, r) { var u = null; return n.ajax({ url: s, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(t) }).done(function (n) { u = n; r && r(n) }), u } function i(n) { this.log = t.Logging.VLogger.getVLogger("AccessSqlParser"); this.sqlOriginal; this.sql = []; this.tableInfo = []; this.setSql(n) } function u(n, t) { this.tableName = n; this.synonym = t } function c() { function e(t) { if (t == null) return !1; var i = t.getTableName(); return r.push(i), n.push(t), !0 } function o(t) { var r, i, u; if (t == null) return !1; for (r = !1, i = n.lenght - 1; i >= 0; i--)u = n[i], t === u && (n.splice(1, 1), r = !0); return r } function u() { var r, u, e, t; if (arguments.length == 2) return f(arguments[0], arguments[1]); if (arguments.length == 1) return f(arguments[0]); for (r = 0, u = 0, e = 0; e < n.length; e++)t = n.get(e), t != null && t.lenght > 0 && (i.info(t.toString()), u += t.reset(), r++); return r > 0 && i.info("#" + r + " (" + u + ")"), u } function f(t, f) { var e, o, s, c, h; if (t == null || t.length() == 0) return u(); if (f || (f = 0), r.indexOf(t) < 0) return 0; for (t.equals("AD_Role"), e = 0, o = 0, s = 0; s < n.length; s++)(c = n[s], c != null) && (h = c.reset(t, f), h >= 0 && e++, h > 0 && (o += h)); return e > 0 && i.fine(t + ": #" + e + " (" + o + ")"), o } var n = [], r = [], i = t.Logging.VLogger.getVLogger("CacheMgt"); return { register: e, reset: u, unregister: o } } function r(n, i, r, u, f, e) { this.m_cacheK = []; this.m_cacheV = []; this.m_tableName = n; this.m_resetAll = u ? u : !1; this.m_tableName2 = e; this.setExpireMinutes(r); t.CacheMgt.register(this) } var e = /(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})/, l = t.Logging.Level, o = t.Application.contextUrl, s = o + "JsonData/JDataSetWithCode", f = function (n, i, r, u) { var o = r ? !0 : !1, e = { sql: n, page: 1, pageSize: 0 }, f; return i && (e.param = i), f = null, h(e, o, function (n) { f = (new t.DB.DataReader).toJson(n); r && r(f) }, u), f }; t.Evaluator = { parseDepends: function (n, t) { var i, r, u; if (t != null && t.length != 0) for (i = t; i.indexOf("@") != -1;)(r = i.indexOf("@"), i = i.substring(r + 1), r = i.indexOf("@"), r != -1) && (u = i.substring(0, r), i = i.substring(r + 1), n.indexOf(u) < 0 && (n[n.length] = u)) }, evaluateLogic: function (n, i) { var u = new t.StringTokenizer(i.trim(), "&|", !0), o = u.countTokens(), r, f, e; if (o / 2 - (o + 1) / 2 == 0) return !1; for (r = this.evaluateLogicDouble(n, u.nextToken()); u.hasMoreTokens();)if (f = u.nextToken().trim(), e = this.evaluateLogicDouble(n, u.nextToken()), f.equals("&")) r = r && e; else if (f.equals("|")) r = r || e; else return !1; return r }, evaluateLogicDouble: function (n, i) { var o = new t.StringTokenizer(i.trim(), "!=^><", !0), e, u; if (o.countTokens() !== 3) return !1; e = o.nextToken().trim(); u = e.trim(); e.indexOf("@") != -1 && (e = e.replaceAll("@", " ").trim(), u = n.getValueAsString(e), u == null && (u = "")); u = u.replaceAll("'", " ").replaceAll('"', " ").trim(); var s = o.nextToken(), f = o.nextToken(), r = f.trim(); return f.indexOf("@") != -1 && f[0] == "@" && f[f.length - 1] == "@" && (f = f.replaceAll("@", " ").trim(), r = n.getValueAsString(f), r == null && (r = "")), r = r.replaceAll("'", " ").replaceAll('"', " ").trim(), e.indexOf("_ID") != -1 && u.length == 0 && (u = "0"), f.indexOf("_ID") != -1 && r.length == 0 && (r = "0"), u == "0" && (r == "" || r == "null") && (r = "0"), u.length == 0 && r == "null" && (r = ""), this.evaluateLogicTuple(u, s, r) }, evaluateLogicTuple: function (n, t, i) { if (n == null || t == null || i == null) return !1; var r = 0, u = 0; try { n.startsWith("'") || isNaN(n) || (r = Number(n)); i.startsWith("'") || isNaN(i) || (u = Number(i)) } catch (f) { r = 0; u = 0 } return t.equals("=") ? r != 0 && u != 0 ? r.compareTo(u) == 0 : n.compareTo(i) == 0 : t.equals("<") ? r != 0 && u != 0 ? r.compareTo(u) < 0 : n.compareTo(i) < 0 : t.equals(">") ? r != 0 && u != 0 ? r.compareTo(u) > 0 : n.compareTo(i) > 0 : r != 0 && u != 0 ? r.compareTo(u) != 0 : n.compareTo(i) != 0 }, getVariables: function (n) { for (var u = [], f = new StringBuilder, r = new t.StringTokenizer(n, "@"), i; r.hasMoreTokens();)f.append(r.nextToken()), r.hasMoreTokens() && (f.append("?"), i = r.nextToken(), i.indexOf("|") != -1 && (i = i.substring(0, i.indexOf("|"))), u.indexOf(i) === -1 && u.push(i)); return u }, replaceVariables: function (n, t, i) { var u = n, h = [], e, f, r, o, s; for (this.parseDepends(h, n), e = 0; e < h.length; e++) { if (f = h[e], f.indexOf("\n") != -1) break; if (r = null, i != null && (r = i.get(f)), r == null && (r = t.getContext(f)), r != null && r.length > 0) { o = null; try { o = new Number(r) } catch (c) { } if (o != null) u = u.replaceAll("@" + f + "@", o.toString()); else { s = null; try { s = new Double(r) } catch (c) { } u = s != null ? u.replaceAll("@" + f + "@", s.toString()) : u.replaceAll("@" + f + "@", r.replaceAll("'", "''")) } } else u = u.replaceAll("@" + f + "@", "NULL") } return u } }; t.Query = function (n, t) { this.tableName = n ? n : ""; this.list = []; this.recordCount = 999999; this.newRecord = !1; this.isORcondition = !1; t && t == !0 && (this.isORcondition = !0) }; t.Query.prototype.addRestriction = function () { var n = null, i; if (arguments.length == 5) n = new t.QueryRestriction(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4]), this.isORcondition && (n.andCondition = !1), arguments[3].toString().startsWith("-") || this.list.push(n); else if (arguments.length == 3) n = new t.QueryRestriction(arguments[0], arguments[1], arguments[2], null, null), this.isORcondition && (n.andCondition = !1), this.list.push(n); else if (arguments.length == 1) if (i = arguments[0], typeof i == "string") { if (i == null || i.trim().length == 0) return; n = new t.QueryRestriction(i); this.isORcondition && (n.andCondition = !1); this.list.push(n); this.newRecord = i.equals(t.Query.NEWRECORD) } else n = i, this.isORcondition && (n.andCondition = !1), this.list.push(n); else throw new Error("invalid arguments Addrestriction"); n = null }; t.Query.prototype.setTableName = function (n) { this.tableName = n }; t.Query.prototype.setRecordCount = function (n) { this.recordCount = n }; t.Query.prototype.setColumnName = function (n, t) { n < 0 || n >= this.list.length || (this.list[n].columnName = t) }; t.Query.prototype.getCode = function (n) { if (n < 0 || n >= this.list.length) return null; this.list[n].code }; t.Query.prototype.getInfo = function () { var i = "", n = null, t; for (this.tableName != null && (i += this.tableName + ": "), t = 0; t < this.list.length; t++)n = this.list[t], t != 0 && (i += n.andCondition ? " AND " : " OR "), i += n.getInfoName() + n.getInfoOperator() + n.getInfoDisplayAll(); return i }; t.Query.prototype.getIsActive = function () { return this.list.length != 0 }; t.Query.prototype.getIsNewRecordQuery = function () { return this.newRecord }; t.Query.prototype.getRecordCount = function () { return this.recordCount }; t.Query.prototype.getWhereClause = function () { var t = arguments.length == 1 ? arguments[0] : !1, n = "", i = null, u, r; if (typeof t == "boolean" || isNaN(t)) { for (u = t, u && (this.tableName == null || this.tableName.length == 0) && (u = !1), r = 0; r < this.list.length; r++)i = this.list[r], r != 0 && (n += i.andCondition ? " AND " : " OR "), n += u ? i.getSQL(this.tableName) : i.getSQL(null); return n.length > 0 ? " ( " + n + " ) " : n } return t >= 0 && t < this.list.Count && (i = this.list[t], n += i.GetSQL(null)), n }; t.Query.prototype.getRestrictionCount = function () { return this.list.length }; t.Query.prototype.clear = function () { this.list = [] }; t.Query.prototype.getRestrictions = function () { return this.list }; t.Query.prototype.copyRestrictions = function (n) { this.list = this.list.concat(n) }; t.Query.prototype.addRangeRestriction = function () { var n = null; n = arguments.length == 3 ? new t.QueryRestriction(arguments[0], arguments[1], arguments[2], null, null, null) : new t.QueryRestriction(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5]); this.list.push(n) }; t.Query.prototype.getColumnName = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].columnName }; t.Query.prototype.getTableName = function () { return this.tableName }; t.Query.prototype.getOperator = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].operator }; t.Query.prototype.getCodeTo = function (n) { return n < 0 || n >= this.list.Count ? null : this.list[n].code_to }; t.Query.prototype.getInfoDisplay = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].infoDisplay }; t.Query.prototype.getInfoDisplay_to = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].infoDisplay_to }; t.Query.prototype.getInfoName = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].infoName }; t.Query.prototype.getInfoOperator = function (n) { return n < 0 || n >= this.list.length ? null : this.list[n].getInfoOperator() }; t.Query.prototype.getInfoDisplayAll = function (n) { return n < 0 || n >= _list.Count ? null : this.list[n].getInfoDisplayAll() }; t.Query.prototype.deepCopy = function () { for (var i = new t.Query(this.tableName), n = 0; n < this.list.length; n++)i.addRestriction(this.list[n]); return i }; t.Query.prototype.getNoRecordQuery = function (n, i) { var r = new t.Query(n); return i ? r.AddRestriction(t.Query.NEWRECORD) : r.AddRestriction("1=2"), r.setRecordCount(0), r }; t.Query.prototype.NEWRECORD = "2=3"; t.Query.prototype.EQUAL = "="; t.Query.prototype.EQUAL_INDEX = 0; t.Query.prototype.NOT_EQUAL = "!="; t.Query.prototype.LIKE = " LIKE "; t.Query.prototype.NOT_LIKE = " NOT LIKE "; t.Query.prototype.GREATER = ">"; t.Query.prototype.GREATER_EQUAL = ">="; t.Query.prototype.LESS = "<"; t.Query.prototype.LESS_EQUAL = "<="; t.Query.prototype.BETWEEN = " BETWEEN "; t.Query.prototype.BETWEEN_INDEX = 8; t.Query.prototype.IN = " IN "; t.Query.prototype.NOT_IN = " NOT IN "; t.Query.prototype.OPERATORS = { "=": " = ", "!=": " != ", " LIKE ": " ~ ", " NOT LIKE ": " !~ ", ">": " > ", ">=": " >= ", "<": " < ", "<=": " <= ", " BETWEEN ": " >-< " }; t.Query.prototype.CVOPERATORS = { "=": " = ", "!=": " != ", ">": " > ", "<": " < " }; t.Query.prototype.OPERATORS_ID = { "=": " = ", "!=": " != " }; t.Query.prototype.CVOPERATORS_ID = { "=": " = ", "!": " != " }; t.Query.prototype.OPERATORS_YN = { "=": " = " }; t.Query.prototype.OPERATORS_DATE_DYNAMIC = { "0": "Today", "1": "lastxDays", "2": "lastxMonth", "3": "lastxYears" }; t.Query.prototype.OPERATORS_DYNAMIC_ID = { "@#AD_User_ID@": "LoginUser" }; t.Query.prototype.getEqualQuery = function (n, i) { var r = new t.Query; return r.addRestriction(n, t.Query.prototype.EQUAL, i), r.setRecordCount(1), r }; t.QueryRestriction = function () { this.directWhereClause = null; this.columnName; this.infoName; this.operator; this.code; this.infoDisplay; this.code_to; this.infoDisplay_to; this.andCondition = !0; switch (arguments.length) { case 5: this.fnArgu5(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4]); break; case 6: this.fnArgu6(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5]); break; case 9: this.fnArgu9(arguments[0], arguments[1], arguments[2], arguments[3], arguments[4], arguments[5], arguments[6], arguments[7], arguments[8]); break; case 1: this.fnArgu1(arguments[0]); break; case 0: break; default: throw new Error("Invalid arguments"); } }; t.QueryRestriction.prototype.fnArgu5 = function (n, t, i, r, u) { var o = n.trim(), s, f, e; s = r != null ? r : o; Operator = t; f = i != null && typeof i == "Boolean" ? new Boolean(i) == !0 ? "Y" : "N" : i; f != null && typeof f == "string" && (f.startsWith("'") && (f = f.substring(1)), f.endsWith("'") && (f = f.substring(0, f.length - 2))); u != null ? e = u.toString().trim() : i != null && (e = i); this.columnName = o; this.infoName = s; this.operator = Operator; this.code = f; this.infoDisplay = e }; t.QueryRestriction.prototype.fnArgu6 = function (n, i, r, u, f, e) { var o, s; this.fnArgu5(n, t.Query.prototype.BETWEEN, i, u, f); o = r; typeof o == "string" && (o.startsWith("'") && (o = o.substring(1)), o.endsWith("'") && (o = o.substring(0, o.length - 2))); e != null ? s = e.trim() : o != null && (s = o.toString()); this.code_to = o; this.infoDisplay_to = s }; t.QueryRestriction.prototype.fnArgu9 = function (n, t, i, r, u, f, e, o, s) { this.columnName = n; this.infoName = r; this.code = t; this.code_to = i; this.infoName = r; this.infoDisplay = u; this.infoDisplay_to = f; this.operator = e; this.directWhereClause = o; this.andCondition = s }; t.QueryRestriction.prototype.fnArgu1 = function (n) { this.directWhereClause = n }; t.QueryRestriction.prototype.getInfoName = function () { return this.infoName }; t.QueryRestriction.prototype.getInfoOperator = function () { return this.operator in t.Query.OPERATORS ? t.Query.OPERATORS[this.operator] : this.operator }; t.QueryRestriction.prototype.getInfoDisplayAll = function () { if (this.infoDisplay_to == null) return this.infoDisplay; var n = this.infoDisplay; return n + (" - " + InfoDisplay_to) }; t.QueryRestriction.prototype.getSQL = function (n) { var i, r, u; return this.directWhereClause != null ? this.directWhereClause : (i = "", typeof this.code == "string" && isNaN(this.code) && (i += " UPPER( "), n != null && n.length > 0 ? (r = this.columnName.lastIndexOf("(") + 1, u = this.columnName.indexOf(")"), i += r != -1 && u != -1 ? this.columnName.substring(0, r) + n + "." + this.columnName.substring(r, r + (u - r)) + this.columnName.substring(u) : n + "." + this.columnName) : i += this.columnName, typeof this.code == "string" && isNaN(this.code) && (i += " ) "), this.code == null || "NULL".equals(this.code.toString().toUpper()) || "NullValue".toUpper().equals(this.code.toString().toUpper()) ? i += this.operator.equals(t.Query.prototype.EQUAL) ? " IS NULL " : " IS NOT NULL " : (i += this.operator + " ", (t.Query.prototype.IN.equals(this.operator) || t.Query.prototype.NOT_IN.equals(this.operator)) && (i += "("), this.code instanceof Date || this.code && e.test(this.code.toString()) ? i += t.DB.to_date(this.code, !1) : "string" == typeof this.code ? isNaN(this.code) ? (i += " UPPER( ", i += t.DB.to_string(this.code.toString()), i += " ) ") : i += t.DB.to_string(this.code.toString()) : i += this.code, t.Query.prototype.BETWEEN.equals(this.operator) ? (i += " AND ", i += this.code_to instanceof Date || this.code_to && e.test(this.code_to.toString()) ? t.DB.to_date(this.code_to, !1) : typeof this.code_to == "string" ? t.DB.to_string(this.code_to.toString()) : this.code_to) : (t.Query.prototype.IN.equals(this.operator) || t.Query.prototype.NOT_IN.equals(this.operator)) && (i += ")")), i) }; i.prototype.FROM = " FROM "; i.prototype.FROM_LENGTH = i.prototype.FROM.length; i.prototype.WHERE = " WHERE "; i.prototype.ON = " ON "; i.prototype.setSql = function (n) { if (n == null) throw new IllegalArgumentException("No SQL"); this.sqlOriginal = n; var t = this.sqlOriginal.indexOf("\nFROM "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replace("\nFROM ", this.FROM)); t = this.sqlOriginal.indexOf("\nWHERE "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replace("\nWHERE ", this.WHERE)); this.parse() }; i.prototype.getSql = function () { return this.sqlOriginal }; i.prototype.setSql = function (n) { if (n == null) throw new IllegalArgumentException("No SQL"); this.sqlOriginal = n; var t = this.sqlOriginal.indexOf("\nFROM "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replaceAll("\nFROM ", this.FROM)); t = this.sqlOriginal.indexOf("\nWHERE "); t != -1 && (this.sqlOriginal = this.sqlOriginal.replaceAll("\nWHERE ", this.WHERE)); this.parse() }; i.prototype.getSql = function () { return this.sqlOriginal }; i.prototype.parse = function () { var n, t; if (this.sqlOriginal == null || this.sqlOriginal.length == 0) throw new IllegalArgumentException("No SQL"); for (this.getSelectStatements(), n = 0; n < this.sql.length; n++)t = this.getTableInfo(this.sql[n].trim()), this.tableInfo.push(t); return this.tableInfo.length > 0 }; i.prototype.getSelectStatements = function () { var i = [this.sqlOriginal], n = null; try { n = this.getSubSQL(i) } catch (r) { this.log.log(t.Logging.Level.SEVERE, this.sqlOriginal, r); throw new IllegalArgumentException(this.sqlOriginal); } while (i.length != n.length) { i = n; try { n = this.getSubSQL(i) } catch (r) { this.log.log(t.Logging.Level.SEVERE, this.sqlOriginal, r); throw new IllegalArgumentException(n.length + ": " + m_sqlOriginal); } } this.sql = n }; i.prototype.getSubSQL = function (n) { for (var e = [], t = "", i, r, f, o, s, u = 0; u < n.length; u++) { for (t = n[u], i = t.indexOf("(SELECT ", 7); i != -1;) { for (r = i + 1, f = 0; r++ < t.length;)if (o = t.charAt(r), o == ")") if (f == 0) break; else f--; else o == "(" && f++; s = t.substring(i, r + 1); e.push(s); t = t.substring(0, i + 1) + "##" + t.substring(r); i = t.indexOf("(SELECT ", 7) } e.push(t) } return e }; i.prototype.getTableInfo = function (n) { var o, f, i, e, s, h, r; if (isNaN(n)) { for (o = [], n.startsWith("(") && n.endsWith(")") && (n = n.substring(1, n.length - 1)), f = n.indexOf(this.FROM), f != n.lastIndexOf(this.FROM) && this.log.log(t.Logging.Level.FINE, "More than one FROM clause - " + n); f != -1;) { for (i = n.substring(f + this.FROM_LENGTH), r = i.indexOf(this.WHERE), r != -1 && (i = i.substring(0, r)), i = i.replaceAll(" AS ", " "), i = i.replaceAll(" as ", " "), i = i.replaceAll(" INNER JOIN ", ", "), i = i.replaceAll(" LEFT OUTER JOIN ", ", "), i = i.replaceAll(" RIGHT OUTER JOIN ", ", "), i = i.replaceAll(" FULL JOIN ", ", "), r = i.indexOf(this.ON); r != -1;) { if (e = i.indexOf(")"), s = i.indexOf(this.ON, r + 4), s != -1 && (e = i.lastIndexOf(")", s)), e != -1) i = i.substring(0, r) + i.substring(e + 1); else { this.log.log(t.Logging.Level.SEVERE, "Could not remove ON " + i); break } r = i.indexOf(this.ON) } for (h = new t.StringTokenizer(i, ","); h.hasMoreTokens();) { var l = h.nextToken().trim(), c = new t.StringTokenizer(l, " "), a = null; a = c.countTokens() > 1 ? new u(c.nextToken(), c.nextToken()) : new u(l); o.push(a) } n = n.substring(0, f); f = n.lastIndexOf(this.FROM) } return o } return (r = n, r < 0 || r > this.tableInfo.length) ? null : this.tableInfo[r] }; i.prototype.getSqlStatement = function (n) { return n < 0 || n > this.sql.length ? null : this.sql[n] }; i.prototype.getNoSqlStatments = function () { return this.sql == null ? 0 : this.sql.length }; i.prototype.getMainSqlIndex = function () { if (this.sql == null) return -1; if (this.sql.length == 1) return 0; for (var n = this.sql.length - 1; n >= 0; n--)if (this.sql[n].charAt(0) != "(") return n; return -1 }; i.prototype.getMainSql = function () { if (this.sql == null) return this.sqlOriginal; if (this.sql.length == 1) return this.sql[0]; for (var n = this.sql.length - 1; n >= 0; n--)if (this.sql[n].charAt(0) != "(") return this.sql[n]; return "" }; i.prototype.size = function () { return this.tableInfo.length }; u.prototype.getSynonym = function () { return this.synonym == null ? "" : this.synonym }; u.prototype.getTableName = function () { return this.tableName }; t.TableInfo = u; t.AccessSqlParser = i; t.ZoomTarget = { log: t.Logging.VLogger.getVLogger("VIS.ZoomTarget"), getZoomAD_Window_ID: function (n, i, r, u) { var c = 0, l = 0, v, e, b, s, y, p, o, a, h; n.equals("M_Product"); v = "VIS_78"; o = []; o[0] = new t.DB.SqlParam("@targetTableName", n); e = null; try { b = 1; e = f(v, o); e.read() && (c = e.getInt(0), l = e.getInt(1)) } catch (w) { this.log.log(t.Logging.Level.SEVERE, v, w) } finally { e != null && e.dispose(); e = null } if (l == 0) return c; if (l != 0 && c != 0 && r != null && r.length != 0 && (s = null, y = n.indexOf("Line"), y != -1 && (s = n.substring(0, y)), s != null)) { p = "VIS_79"; o = []; o[0] = new t.DB.SqlParam("@ParentTable", s); o[1] = new t.DB.SqlParam("@targetTableName", n); o[2] = new t.DB.SqlParam("@targetWhereClause", r); o[3] = new t.DB.SqlParam("@ParentTable1", s); o[4] = new t.DB.SqlParam("@ParentTable2", s); try { e = f(p, o); e.read() && (u = e.getString(0).equals("Y")) } catch (w) { this.log(t.Logging.Level.SEVERE, p.toString(), w) } finally { e != null && e.dispose(); e = null } } return (a = 0, r != null && r.length != 0 && (h = [], h = this.getZoomTargets(n, i, r), h != null && h.length > 0 && (a = h[0].Key)), a != 0) ? a : u ? c : l }, parseColumns: function (n, t) { var i, e, u, f, r; if (t != null && t.length != 0 && (i = t, !i.contains(" EXISTS ") && !i.contains(" IN ") && !i.contains("(") && !i.contains(")"))) while (i.indexOf("=") != -1) e = i.indexOf("="), u = i.substring(0, e), u = u.trim(), f = u.lastIndexOf(" ", u.length), r = u.substring(f + 1), r.indexOf(".") != -1 && (f = r.indexOf(".") + 1, r = r.substring(f, r.length)), n.indexOf(r) < 0 && n.push(r), i = i.substring(e + 1) }, evaluateWhereClause: function (n, i) { var r, s, o; if (i == null || i.length == 0) return !0; if (r = i, s = !0, r.contains(" EXISTS ") || r.contains(" IN ") || r.contains("(") || r.contains(")")) return !1; while (r.indexOf("=") != -1) { var u = r.indexOf("="), f = r.lastIndexOf(" ", u), e = r.substring(f + 1, u), h = "", c = ""; for (e.indexOf(".") != -1 && (f = e.indexOf(".") + 1, e = e.substring(f, e.length)), o = 0; o < n.length; o++)if (e.equals(n[o].Name)) { h = n[o].Value; break } if (r = r.substring(u + 1), f = 0, u = r.indexOf(" "), c = u == -1 ? r.substring(f) : r.substring(f, u), !t.Evaluator.evaluateLogicTuple(h, "=", c)) { s = !1; break } } return s }, getZoomTargets: function (i, r, u, e) { var it, s, k, p, h, a, d, o, l, y, g, ot, w; if (arguments.length == 4) { if (e.length != 1) return null; it = e[0]; s = u.replace("?", it.toString()); s = s.replace("WHERE ", " "); this.log.fine("WhereClause : " + s); u = s } var b = [], c = [], v = [], nt = 0, rt = 0, ut = "", s = "", ft = !1, st = null, ht = 0, ct = 0, lt = 0, et = "VIS_80", o = null; try { for (o = f(et); o.read();)k = o.getInt(0), p = o.getString(1), p.equals("Work Center") ? ht = k : p.equals("Work Center Costs") ? (ct = k, st = p) : p.equals("Production Resource") && (lt = k) } catch (tt) { this.log.log(t.Logging.Level.SEVERE, et, tt) } finally { o != null && o.dispose(); o = null } try { for (o = null, n.ajax({ type: "Get", async: !1, url: t.Application.contextUrl + "Form/GetZoomTargetClass", data: { targetTableName: i, curWindow_ID: r }, success: function (n) { o = (new t.DB.DataReader).toJson(n) } }); o.read();) { if (ft = !0, nt = o.getInt(6), ut = o.getString(7), rt = o.getInt(4), s = o.getString(2), rt == 0) break; c.push({ AD_Window_ID: o.getInt(0), windowName: o.getString(1), whereClause: s }) } } catch (tt) { this.log.log(t.Logging.Level.SEVERE, sql, tt) } finally { o != null && o.dispose() } if (h = "", !ft || c.length <= 1 && nt == 0) return b; if (c.length <= 1) h = "SELECT count(*) FROM " + i + " WHERE " + u, s != null && s.length != 0 && (h += " AND " + t.Evaluator.replaceVariables(s, t.Env.getCtx(), null)); else if (c.length > 1) { for (a = 0; a < c.length; a++)this.parseColumns(v, c[a].whereClause); for (h = "SELECT DISTINCT ", a = 0; a < v.length; a++)a != 0 && (h += ","), h += v[a]; v.length == 0 && (h += "count(*) "); h += " FROM " + i + " WHERE " + u } this.log.fine(h); d = []; try { for (o = null, n.ajax({ type: "Get", async: !1, url: t.Application.contextUrl + "Form/GetZoomWhereClause", data: { sql: t.secureEngine.encrypt(h) }, success: function (n) { o = (new t.DB.DataReader).toJson(n) } }); o.read();)if (v.length > 0) { for (d.length = 0, l = 0; l < v.length; l++)y = v[l], g = "", g = typeof o.get(y) != "string" ? o.get(y).toString() : "'" + o.get(y).toString() + "'", this.log.fine(y + " = " + g), d.push({ Value: g, Name: y }); for (l = 0; l < c.length; l++)if (this.evaluateWhereClause(d, c[l].whereClause)) { w = { Key: c[l].AD_Window_ID, Value: c[l].windowName }; b.push(w); break } } else ot = o.getInt(0), ot != 0 && (w = { Key: nt, Value: ut }, b.push(w)) } catch (tt) { this.log.log(t.Logging.Level.SEVERE, h, tt) } finally { o != null && o.dispose() } return b } }; r.prototype.setExpireMinutes = function (n) { if (n > 0) { this.m_expire = n; var i = 6e4 * n; this.m_timeExp = t.Env.currentTimeMillis() + i } else this.m_expire = 0, this.m_timeExp = 0 }; r.prototype.expire = function () { this.m_expire != 0 && this.m_timeExp < t.Env.currentTimeMillis() && this.reset() }; r.prototype.reset = function () { var n, i; return arguments.length == 2 ? this.reset2(arguments[0], arguments[1]) : arguments.length == 1 ? this.reset2(arguments[0]) : (n = this.m_cacheK.length, this.clear(), this.m_expire != 0 && (i = 6e4 * this.m_expire, this.m_timeExp = t.Env.currentTimeMillis() + i), n) }; r.prototype.reset2 = function (n, t) { if (this.tableName == null) return -1; var i = n === this.m_tableName || n === this.m_tableName2; return i || this.m_tableName2.startsWith(n) ? t == 0 || this.m_resetAll ? reset() : this.remove(t) : -1 }; r.prototype.remove = function (n) { var t = this.m_cacheK.indexOf(n); return t > -1 ? (this.m_cacheK.splice(t, 1), this.m_cacheV.splice(t, 1), 1) : 0 }; r.prototype.get = function (n) { this.expire(); var t = this.m_cacheK.indexOf(n); return t > -1 ? this.m_cacheV[t] : null }; r.prototype.contains = function (n) { var t = this.m_cacheK.indexOf(n); return t > -1 ? !0 : !1 }; r.prototype.add = function (t, i) { var u, r; this.expire(); (typeof i == "function" || n.isFunction(i)) && (u = ""); r = this.m_cacheK.indexOf(t); r < 0 ? (this.m_cacheK.push(t), this.m_cacheV.push(i)) : this.m_cacheV[r] = i }; r.prototype.clear = function () { this.m_cacheK.length = 0; this.m_cacheV.length = 0 }; r.prototype.size = function () { return this.expire(), this.m_cacheV.length }; r.prototype.getTableName = function () { return this.m_tableName }; t.CacheMgt = c(); t.CCache = r }(jQuery, VIS), function (n) { var t = function (n, t, i, r) { this.tokenizers = t.splice ? t : t.split(""); r && (this.doBuild = r); this.src = n; this.ended = !1; this.tokens = []; this.returnDelim = i; this.curIndex = 0; this.parse() }; t.prototype = { parse: function () { do this.next(); while (!this.ended); return this.tokens }, build: function (n, t) { if (n) { if (!this.returnDelim && this.tokenizers.indexOf(n) > -1) return; this.tokens.push(this.doBuild ? this.doBuild(n, t, this.tkn) : n) } }, next: function () { var n = this, t; n.findMin(); t = n.src.slice(0, n.min); n.build(t, !1); n.src = n.src.slice(n.min).replace(n.tkn, function (t) { return n.build(t, !0), "" }); n.src || (n.ended = !0) }, findMin: function () { var n = this, r = 0, t, i; for (n.min = -1, n.tkn = ""; (t = n.tokenizers[r++]) !== undefined;)i = n.src[t.test ? "search" : "indexOf"](t), i != -1 && (n.min == -1 || i < n.min) && (n.tkn = t, n.min = i); n.min == -1 && (n.min = n.src.length) }, countTokens: function () { return this.tokens.length }, nextToken: function () { return this.hasMoreTokens() ? this.tokens[this.curIndex++] : null }, hasMoreTokens: function () { return this.curIndex < this.tokens.length ? !0 : !1 }, reset: function () { this.curIndex = -1 } }; n.StringTokenizer = t }(VIS), function (n) { function u() { function ft() { return tt } function et() { function f(u) { var f = $(u.target), e, v, o, h, l, c; if (f.hasClass("fa fa-arrow-left") && (f = f.parent()), e = f.parent(), f.hasClass("vis-menuitm-backbtn")) f.closest("ul").css("display", "none"), s.find(".vismenu-parent").show(), i.find(".vismenu-selectedMbTab").removeClass("vismenu-selectedMbTab"), i.find('[data-val="' + e.data("ulid") + '"]').siblings().show(), i.find('[data-val="' + e.data("ulid") + '"]').show(), i.find("ul:not(.vismenu-parent)").hide(), i.find("li:not(.vis-hasSubMenu)").hide(), t && t.setIsMenuHeaderClicked(!1); else if (u.target.nodeName === "LABEL" && e.data("con") == "Y") { if (v = e.data("val"), !t) return; h = t.getFilterValue(); t.setIsMenuHeaderClicked(!1); o = i.find('[data-ulid="' + v + '"]'); o.css("display", "flex").addClass("vismenu-selectedMbTab"); o.find("ul").css("display", "block"); o.find("li").hide(); o.find(".vis-subNavFirstElement").show(); o.find(".vis-menu-innerFolders").show(); o.find(".fa-minus").removeClass("fa-minus").addClass("fa-plus"); h != "A" ? o.find('li > a[data-action="' + h + '"]').parent().css("display", "flex") : o.find("li:not(.vis-menusubItem)").css("display", "flex"); s.find(".vismenu-parent").hide(); t.hideMobileEmptyFolder(); e.data("summary") == "Y" ? (e.siblings().hide(), e.hide()) : (e.parent().siblings().hide(), e.hide()) } else { if (u.target.nodeName === "LABEL") { if (Date.now() - r < 300) { u.preventDefault(); u.stopPropagation(); r = Date.now(); return } r = Date.now() } if (u.target.nodeName === "A") { if (f = $(u.target), f.data("isfavbtn") == "yes") { n.FavouriteHelper.showOverlay(f); return } if (f.data("summary") == "Y") { h = t ? t.getFilterValue() : null; s.find(".vis-navmenuItems-Container").hide(); f.parent().siblings().removeClass("vis-navSelected"); f.parent().addClass("vis-navSelected"); l = s.find("#Menu" + f.data("value")); l.removeAttr("style"); l.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide"); i.find(".vismenu-hidden-header").hide(); i.find(".vis-nav-AllItems").hide(); i.find(".fa-minus").removeClass("fa-minus").addClass("fa-plus"); h != null && (h != "A" ? i.find(".fa-plus").removeClass("fa-plus").addClass("fa-minus") : i.find(".fa-minus").removeClass("fa-minus").addClass("fa-plus")); l.find(".vismenu-subSummaryNode").css("display", "none"); t && t.hideEmptyFolders(); return } a(f.data("action"), f.data("actionid")); return } if (u.target.nodeName === "I") { if (f = $(u.target), f.hasClass("vis-navAccordian")) { f.hasClass("fa-plus") ? (f.removeClass("fa-plus").addClass("fa-minus"), c = f.data("pid"), i.find('[data-ulid="' + c + '"]').show()) : (f.removeClass("fa-minus").addClass("fa-plus"), c = f.data("pid"), i.find('[data-ulid="' + c + '"]').hide()); return } if (f = f.parent(), f.data("isfavbtn") == "yes") { n.FavouriteHelper.showOverlay(f); return } } } } p.on(n.Events.onTouchStartOrClick, function (n) { n.preventDefault(); w() }); var r = Date.now(); i.on("click", function (n) { f(n) }); i.on("keyDown", function (n) { n.which == 13 && f(n) }); $(i.find(".vis-navLeftWrap a")[0]).trigger("click"); c.on(n.Events.onClick, "LI", function (n) { if (n.preventDefault(), n.target.nodeName === "I" || n.target.nodeName === "SPAN") { lt($(n.currentTarget)); return } var t = null; n.target.nodeName === "LI" ? t = $(n.target) : n.target.parentNode.nodeName === "LI" && (t = $(n.target.parentNode)); t && (y(t[0].id), v(t)); t = null }); k.on("click", function (t) { n.MRole.getIsDisableMenu() || (t.preventDefault(), window.setTimeout(function () { u.focus(); $("#vis_divTree").on("focus", "li", function (n) { var t = $(n.target); $(t).off("keydown"); $(t).on("keydown", function (n) { n.key == "Enter" && (t.siblings("label").length > 0 && $(t.siblings("label")).trigger("click"), t.siblings("a").length > 0 && $(t.siblings("label")).trigger("a")) }); $(t.siblings("label")).css("border", "1px solid rgba(var(--v-c-primary), 1)") }); $("#vis_divTree").on("focusout", "li", function (n) { var t = $(n.target); $(t.siblings("label")).css("border", "1px solid white") }) }, 2), ht()) }); it.on("click", function (n) { n.preventDefault(); w() }); nt && u.bind("input", function () { at(u.val(), this.list) }); $(window).resize(ut); window.onbeforeunload = function () { $.ajax({ url: n.Application.contextUrl + "Account/LogOffHandler", type: "POST" }) }; rt(1) } function rt(t) { window.setTimeout(function () { $.ajax({ url: n.Application.contextUrl + "Account/Refresh", complete: function () { rt(180) } }) }, 1e3 * t) } function ot() { n.Application.contextFullUrl.toLower().indexOf("softwareonthecloud.com") > -1 ? $.ajax({ url: n.Application.contextUrl + "home/GetSubscriptionDaysLeft/", success: function (t) { var i = JSON.parse(t); i && (i == "True" || i == "" ? l.css("display", "none") : i > 1 ? l.text(n.Msg.getMsg("VIS_TrialPeriod") + ": " + i + " " + n.Msg.getMsg("VIS_TrialDaysLeft")) : i == 1 && l.text(n.Msg.getMsg("VIS_TrialPeriod") + ": " + i + " " + n.Msg.getMsg("VIS_TrialDayLeft"))) }, error: function () { l.css("display", "none") } }) : l.css("display", "none") } function st() { e && e.id && e.action && (a(e.action, e.id), u.val("")); e = null } function w() { t.closePopup(); s.attr("style", "display: none !important"); p.fadeOut(); u.val(""); u.blur() } function ht() { p.fadeIn(); s.attr("style", "display: block !important") } function ut() { var t = 0; t = (n.Application.isMobile || n.Application.isIOS) && document.documentElement ? document.documentElement.clientHeight : window.innerHeight; t = t - 23; n.Utility.Util.getValueOfInt(n.context.ctx["#FRAMEWORK_VERSION"]) < 2 && (t = t - 43); n.Env.setScreenHeight(t); document.documentElement.style.setProperty("--vis-screen-height", t * .01 + "px"); n.viewManager && n.viewManager.sizeChanged(t, window.innerwidth) } function a(t, i) { n.viewManager.startAction(t, i); w() } function v(n) { if (n.length > 0) { if (n[0].id == "vis_lhome") return; g && g.removeClass("vis-app-f-selected"); g = n.addClass("vis-app-f-selected"); n = null } } function ct(n) { var t = n.data("wid"); v(c.find("LI#" + t)) } function lt(t) { r[r.length - 1] == t[0].id ? n.viewManager.closeFrame(t[0].id) : (y(t[0].id), v(t)) } function y(t) { h ? h.hide() : tt.children("div").hide(); o[t] && (h = o[t], h.css({ opacity: 0 }), h.show().animate({ opacity: 1 }, 500, "linear", function () { n.viewManager.resize(t) })); r.indexOf(t) != -1 && r.splice(r.indexOf(t), 1); r.push(t); w() } function at(n, t) { var i, r; if (n !== "" && !(n.length < 1)) for (i = 0; i < t.options.length; i++)if (t.options[i].value === n) { r = $(t.options[i]); a(r.data("action"), r.data("actionid")); u.val(""); break } } function vt() { dt(); t.init(i, $("#vis_filterMenu"), s); f.init($("#vis_home_ca"), $("#vis_userName")); yt(); historyMgr.restoreHistory(); ti(); window.addEventListener("DOMContentLoaded", n.sseManager.start, !1) } function yt() { n.MRole.getIsDisableMenu() || pt(); n.MRole.getIsDisableMenu() && ($(".vis-topMenu").hide(), $(".vis-menuHeaderLogo").show()); var t = n.MRole.getHomePage(); t && parseInt(t) > 0 && a("X", t) } function pt() { $("#vis_lhome").show(); o.vis_lhome = b; h = b.show(); n.HomeMgr.initHome(b) } function wt(n, t) { return o[n] = t, r.push(n), y(n), t } function bt(n) { var i, t; return c.find("LI#" + n).remove(), i = o[n], o[n] = null, delete o[n], r.pop(), i = null, t = "", t = r.length > 0 ? r[r.length - 1] : "vis_lhome", y(t), v(c.find("LI#" + t)), !0 } function kt(n, t, i) { var r = ["<li id=" + n + ">"], u; t && (t.indexOf(".") > -1 ? r.push('<img src= "' + t + '" />') : r.push('<i class= "' + t + '" />')); r.push("<a>" + i + '<\/a><span style="padding:0 7px;"><i class="fa fa-times-circle-o" /><\/span><\/li>'); u = $(r.join(" ")); c.append(u); v(u); u = null } function dt() { var n, i, t = []; nt || (i = u.attr("list"), n = $("#" + i), n.length > 0 && (t = [], n.find("option").each(function () { t.push({ label: this.value, value: this.value, action: $(this).data("action"), id: $(this).data("actionid") }) }), u.autocomplete({ source: t, open: function () { window.setTimeout(function () { $(".ui-autocomplete").css("z-index", 1e3); var n = window.innerHeight * 60 / 100; $(".ui-autocomplete").css("max-height", n) }) }, select: function (n, t) { e = t.item }, close: function () { st() } })), n.remove()) } function gt() { k.trigger("click") } function ni() { it.trigger("click") } function ti() { } function ii() { return d || (d = $(".vis-app-action-nav")), d } function ri() { return k } var e = null, h = null, o = {}, r = [], nt = !1, b = $("#vis_home"), ui = $("#vis_mainSection"), tt = $("#vis_mainConatiner"), c = $("#vis_taskbar"), k = $("#vis_appMenu"), s = $("#vis_mainMenu"), it = $("#vis_closeMenu"), l = $("#vis_cloud_daysleft"), u = $("#vis_menuSearch"), i = $("#vis_divTree"), p = $("#vis_menuOverlay"), d = null, g = null; return ut(), et(), ot(), { startMenuAction: a, getMainConatiner: ft, toggleContainer: y, registerView: wt, unRegisterView: bt, addTaskBarItem: kt, start: vt, activateTaskBarItemUsingID: ct, openMenu: gt, closeMenu: ni, getNavSection: ii, getMenuDiv: ri } } n.desktopMgr = u(); var f = function () { function et(s, l) { s.remove(); b = l; o = s; v = s.find("#vis_changeAuthForm"); f = s.find("#vis_home_role"); r = s.find("#vis_home_client"); i = s.find("#vis_home_org"); t = s.find("#vis_home_warehouse"); y = s.find("#vis_home_warehouseId"); e = s.find("#vis-auth-close"); u = s.find("#vis-auth-change"); tt = s.find('label[for="Login2Model_Role"]'); it = s.find('label[for="Login2Model_Client"]'); rt = s.find('label[for="Login2Model_Org"]'); ut = s.find('label[for="Login2Model_Warehouse"]'); k = f.val(); d = r.html(); g = i.html(); nt = t.html(); st(); $("body").append(c); $("body").append(o); h = n.Application.contextUrl; ot(); y.val() == "-1" && t.val(null) } function ot() { tt.text(Globalize.localize("Role")); it.text(Globalize.localize("Client")); rt.text(Globalize.localize("Organization")); ut.text(Globalize.localize("Warehouse")); u.val(n.Msg.getMsg("Change")); e.val(n.Msg.getMsg("Close")) } function st() { b.on("click", ct); c.on("click", ft); e.on("click", ft); f.on("change", l); r.on("change", l); i.on("change", l); t.on("change", l); v.submit(at) } function ht() { f.val(k); r.html(d); i.html(g); t.html(nt); y.val() == "-1" && t.val(null); u.prop("disabled", !0); a(v, []); s = !1 } function ct() { c.show(); o.show("slideDown"); e.prop("disabled", !1); u.prop("disabled", !0) } function ft(n) { return s && ht(), c.hide(), o.hide("slideUp"), n.preventDefault(), !1 } function w(n, t, i) { $.ajax(t, { data: i }).success(function (t) { lt(n, t.data) }).fail(function (n) { alert(n) }) } function l() { if (!p) { s || (s = !0, u.prop("disabled", !1)); combo = this; combo.id === f.attr("id") ? (r.empty(), i.empty(), t.empty(), w(r, h + "Account/GetClients", { Id: combo.value })) : combo.id === r.attr("id") ? (i.empty(), t.empty(), w(i, h + "Account/GetOrgs", { role: f.val(), user: n.context.getAD_User_ID(), client: combo.value })) : combo.id === i.attr("id") ? (t.empty(), w(t, h + "Account/GetWarehouse", { id: i.val() })) : combo.id === t.attr("id"); var e = $("#" + combo.id + "Name"), o = this.options[this.selectedIndex].innerHTML; e.val(o) } } function lt(n, t) { p = !0; n.empty(); var u = Globalize.localize("SelectWarehouse"); n === f ? u = Globalize.localize("SelectRole") : n === r ? u = Globalize.localize("SelectClient") : n === i && (u = Globalize.localize("SelectOrg")); $("<option />", { val: "-1", text: u }).appendTo(n); $(t).each(function () { $("<option />", { val: this.Key, text: this.Name }).appendTo(n) }); p = !1 } function at(n) { var t = $(this); a(t, []); e.prop("disabled", !0); u.prop("disabled", !0); t.find("#vis_home_langugage").val(localStorage.getItem("vis_login_langCode")); (!t.valid || t.valid()) && $.post(t.attr("action"), t.serializeArray()).done(function (n) { n = n || {}; n.success ? (window.location = n.redirect || location.href, window.location.href.indexOf("#") != -1 && location.reload()) : n.errors && (a(t, n.errors), e.prop("disabled", !1), u.prop("disabled", !1)) }).error(function () { a(t, ["An unknown error happened."]); e.prop("disabled", !1); u.prop("disabled", !1) }); n.preventDefault() } var v, f, r, i, t, b, o, e, u, k, d, g, nt, y, s = !1, p = !1, h = "", tt, it, rt, ut, c = $('<div class="vis-wakeup-main" >').hide(), vt = function (n) { return n.find(".validation-summary-errors, .validation-summary-valid") }, a = function (n, t) { var i = vt(n).removeClass("validation-summary-valid").addClass("validation-summary-errors"), r = $.map(t, function (n) { return "<li>" + Globalize.localize(n) + "<\/li>" }).join(""); i.find("ul").empty().append(r) }; return { init: et } }(), t = function () { function b(r, e, o) { i.html('<input type="radio" name="filter" id="vis_filter_radio_1" value="A" checked style="margin-bottom:5px;margin:1px;" /><label for="vis_filter_radio_1">' + n.Msg.getMsg("All") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_2" value="W" style="margin-bottom:5px;margin:1px;" /><label for="vis_filter_radio_2">' + n.Msg.getMsg("Window") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_3" value="X" style="margin-bottom:5px;margin:1px;"/><label for="vis_filter_radio_3">' + n.Msg.getMsg("Form") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_4" value="P" style="margin-bottom:5px;margin:1px;"/><label for="vis_filter_radio_4">' + n.Msg.getMsg("Process") + '<\/label><br><input type="radio" name="filter" id="vis_filter_radio_5" value="R" style="margin-bottom:20px;margin:1px;"/><label for="vis_filter_radio_5">' + n.Msg.getMsg("Report") + '<\/label><br/><input type="button" name="filter" value=' + n.Msg.getMsg("Filter") + "><\/input>"); f = o; t = r; var s = []; s = k(); p = u.html(); w = s; c = e; $("body").append(i); nt(); d() } function k() { var r = [], i, n; for (u = t.find(".vis-navMainContent"), i = t.find(".vismenu-hidden-header"), n = 0; n < i.length; n++)itm = $(i[n]), r.push(itm[0].outerHTML); return r } function d() { function r() { var r = i.find("input[type=radio]:checked").val(); g(r); r == "A" ? (f.find(".vis-removeFilter").hide(), t.find(".vismenu-subSummaryNode").css("display", "none"), (n.Application.isMobile || n.Application.isIOS) && document.documentElement ? o ? (t.find(".vis-menusubItem").css("display", ""), t.find(".fa-plus").removeClass("fa-plus").addClass("fa-minus")) : (t.find(".vis-menusubItem").css("display", "none"), t.find(".fa-minus").removeClass("fa-minus").addClass("fa-plus")) : t.find(".fa-minus").removeClass("fa-minus").addClass("fa-plus")) : (f.find(".vis-removeFilter").show(), t.find(".fa-plus").removeClass("fa-plus").addClass("fa-minus")); y() } c.on("click", l); i.on("click", "input[type=button]", function (n) { n.stopPropagation(); r() }); f.find(".vis-removeFilter").on("click", function () { i.find("#vis_filter_radio_1").prop("checked", !0); r() }); f.find(".vis-menu-headerName").click(function () { v(!0); tt() }) } function g(i) { if ((n.Application.isMobile || n.Application.isIOS) && document.documentElement) { if (t.find(".vismenu-parent").is(":visible")) return; t.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide"); i === "A" ? t.find("li").show() : (t.find("li").hide(), t.find(".vis-menu-innerFolders").show(), t.find(".vis-menuitm-backbtn").parent().show(), t.find('li > a[data-action="' + i + '"]').parent().show()); s() } else t.find(".vis-navSubMenu").removeClass("vis-menuSum-hide"), r.is(":visible") && r.find(".vis-navMainContent").removeAttr("style"), i === "A" ? t.find(".vis-navMainContent li").show() : (t.find(".vis-navMainContent li").hide(), t.find('.vis-navMainContent li > a[data-action="' + i + '"]').parent().show()), h() } function s() { var n, f, r, h, s, e, u; if (i.find("input[type=radio]:checked").val() != "A") { if (t.find(".vismenu-parent").is(":visible")) return; for (n = t.find(".vismenu-selectedMbTab"), f = [], n && n.length > 0 ? (f = n.find("ul"), n.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide")) : (f = t.find("ul"), t.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide")), e = 0; e < f.length; e++)if (r = $(f[e]), !r.hasClass("vismenu-parent")) { for (h = r.find("li"), s = !1, u = 0; u < h.length; u++) { if ($(h[u]).is(":visible") && !$(h[u]).hasClass("vis-menu-innerFolders")) { s = !1; break } s = !0 } s && (r.addClass("vis-menuSum-hide"), r.css("display", ""), r.parent().css("display", "")) } for (n && n.length > 0 && !o ? f = n.find(".vis-menuitm-backbtn") : (f = t.find(".vis-menuitm-backbtn"), n = null), e = 0; e < f.length; e++) { var r = $(f[e]).parent(), h = r.siblings(), s = !1; for (u = 0; u < h.length; u++) { if ($(h[u]).is(":visible")) { s = !1; break } s = !0 } s && (n == null || n.length == 0 || o) && (r.css("display", ""), r.addClass("vis-menuSum-hide")) } } } function h() { var e, t, f, r, n; if (i.find("input[type=radio]:checked").val() != "A") { for (e = u.find(".vis-navmenuItems-Container").find("ul"), u.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide"), u.find(".vismenu-subSummaryNode").css("display", ""), t = 0; t < e.length; t++) { var o = $(e[t]), r = o.find("li"), f = !1; for (n = 0; n < r.length; n++) { if ($(r[n]).is(":visible")) { f = !1; break } f = !0 } f && o.closest(".vis-navSubMenu").addClass("vis-menuSum-hide") } for (e = u.find(".vis-navmenuItems-Container-allItems"), t = 0; t < e.length; t++) { if (f = !1, r = $(e[t]).find(".vis-navSubMenu"), r.length > 0) for (n = 0; n < r.length; n++) { if (!$(r[n]).hasClass("vis-menuSum-hide")) { f = !1; break } f = !0 } for (r = $(e[t]).find("li"), n = 0; n < r.length; n++) { if ($(r[n]).is(":visible")) { f = !1; break } f = !0 } f && $(e[t]).addClass("vis-menuSum-hide") } } else u.find(".vis-menuSum-hide").removeClass("vis-menuSum-hide") } function nt() { var u, i; if (!(n.Application.isMobile || n.Application.isIOS) || !document.documentElement) { for (u = t.find(".vis-navmenuItems-Container"), r = $("<div class='vis-nav-AllItems'><\/div>"), i = 0; i < u.length; i++)r.append($(u[i]).clone().removeAttr("style").addClass("vis-navmenuItems-Container-allItems")); r.hide(); t.find(".vis-navMainContent").append(r) } } function tt() { if ((n.Application.isMobile || n.Application.isIOS) && document.documentElement) { var i = a(); t.find("li").hide(); t.find(".vis-subNavFirstElement").show(); t.find(".vis-menu-innerFolders").show(); t.find("ul").show(); i == "A" ? t.find("li").show() : t.find('li > a[data-action="' + i + '"]').parent().show(); t.find(".vis-subNavFirstElement").css({ position: "relative", top: "0px" }); t.find(".fa-plus").removeClass("fa-plus").addClass("fa-minus"); t.find(".vismenu-parent").hide(); s(!0) } else t.find(".vis-navmenuItems-Container").hide(), r.find(".vis-navmenuItems-Container").removeAttr("style"), r.find(".vismenu-hidden-header").show(), t.find(".vis-navSelected").removeClass("vis-navSelected"), r.show(), t.find(".fa-plus").removeClass("fa-plus").addClass("fa-minus"), r.find(".vismenu-subSummaryNode").css("display", ""), h() } function l() { e = !e; var t = Math.round(f.find(".vis-navFilterIco").offset().left) - 84; n.Application.isRTL && i.css("right", "auto"); i.css("left", t); e ? i.show("slide-down") : i.hide("slide-up") } function a() { return i.find("input[type=radio]:checked").val() } function v(n) { o = n } function y() { e && l() } var u = null, p = "", w = "", c = null, e = !1, t = null, r = null, o = !1, f = null, i = $('<div class="vis-dialog vis-filter-dialog">'); return { init: b, closePopup: y, hideEmptyFolders: h, getFilterValue: a, hideMobileEmptyFolder: s, setIsMenuHeaderClicked: v } }(), r = function () { function r(t) { i.text(t); $("body").append(n) } var n = $('<div class="vis-wakeup-main"><\/div><div class="vis-wakeup-outerwrap"><div class="vis-wakeup-content"><div class="vis-wakeup-headsec"><\/div><div class="vis-wakeup-datawrp"><strong>Oh no! Something went wrong<\/strong><div class="vis-wakeup-text"><\/div><button>Refresh<\/button><\/div><\/div><\/div><\/div>'), t = n.find("button"), u = n.find(".vis-wakeup-sleep"), f = n.find(".vis-wakeup-awake"), i = n.find(".vis-wakeup-text"); t.on("click", function () { t.prop("disabled", !0); window.location.reload() }); return { init: r } }(), i = !1; $(document).ajaxError(function (t, u) { u.status === 401 ? i || (r.init(n.Msg.getMsg("UnAuthorized")), i = !0) : u.status === 999 ? i || (r.init(n.Msg.getMsg("WakeupText")), i = !0) : console.log(u.responseText) }) }(VIS), function (n) { function u() { function ot(n) { return i[n].dispose() } function rt(n, t) { v === n ? ut(t) : y === n ? ft(t) : (g === n || nt === n) && ht(t, n) } function o(i, r, u, f) { if (w) st(); else { var e = "fa fa-window-maximize"; r && (e = r); t.addTaskBarItem(i, e, u); f && i.slice(i.indexOf("_") + 1) != n.MRole.getHomePage() && (s.push(f), historyMgr.updateHistory(b(s.join(p)))) } } function st() { if (it++, it == Object.keys(i).length) { w = !1; for (var n in i) o(i[n].id, i[n].img, i[n].name, i[n].hid) } } function b(t) { return n.Utility.encode(t) } function a(n, r, u, e) { var o, h; return (t.unRegisterView(n), u && (o = s.indexOf(u), o > -1 && s.splice(o, 1), historyMgr.updateHistory(b(s.join(p)))), h = i[n], i[n] = null, delete i[n], f = null, e && pt(h)) ? !1 : !0 } function ut(t, i) { var f = null, u; return (t.toString().indexOf("&") != -1 && (f = t.split("&")[1], t = t.split("&")[0]), u = wt(t), u) ? (u.refreshData(), u.show(r, o), c(u), k(), u) : (u = new n.AWindow, u.initWindow(t, i, o, v, f) && (u.onClosed = a, u.show(r), c(u), k()), u) } function k() { var n = ".w2ui-reset table{font-family: var(--v-c-font-family);"; n += Math.round(window.devicePixelRatio * 100) >= 100 ? "font-size: 0.85rem !important;}" : "font-size: 1rem !important;}"; this.styleTag ? (this.styleTag.remove(), $(".vis-gc-vtable").removeClass("w2ui-reset"), $(".vis-gc-vtable").addClass("w2ui-reset")) : $(".vis-gc-vtable").addClass("w2ui-reset"); this.styleTag = document.createElement("style"); this.styleTag.type = "text/css"; this.styleTag.innerHTML = n; $($("head")[0]).append(this.styleTag) } function ft(t, i) { t.toString().indexOf("&") != -1 && (i = t.split("&")[1], t = t.split("&")[0]); var u = new n.AWindow; n.MRole.getIsDisableMenu() && u.hideCloseIcon(!0); u.initForm(t, o, y, i) && (u.onClosed = a, u.show(r), c(u)) } function ht(t, i) { var u = new n.AWindow; u.initProcess(t, o, i, !0) && (u.onClosed = a, u.show(r), c(u)) } function ct(n) { n.onClosed = a; n.show(r); o(n.getId(), "fa fa-list-alt", n.getName(), null); c(n) } function c(n) { t.registerView(n.getId(), n.getRootLayout()); i[n.getId()] = n } function lt(t) { var i, e, u, o; try { if (historyMgr.updateHistory("#"), i = [], t.indexOf("&") != -1 && (t = t.split("&"), i = t[1].split(","), t = t[0]), t = n.Utility.decode(t), t.length > 0) for (w = !0, e = t.split(p), u = 0, o = e.length; u < o; u++)if (e[u].length > 0) { var s = e[u], f = s.substring(0, 1), r = s.substring(2); if (y === f) { if (!n.MRole.getFormAccess(r)) { console.log("No Form Access"); i && i.length > 0 && i.shift(); continue } i && i.length > 0 && (r += "&" + i.shift()) } else if (g === f || nt === f) { if (!n.MRole.getProcessAccess(r)) { console.log("No Process Access"); continue } } else if (v === f) { if (!n.MRole.getWindowAccess(r)) { console.log("No Window Access"); i && i.length > 0 && i.shift(); continue } i && i.length > 0 && (r += "&" + i.shift()) } rt(f, r) } } catch (h) { historyMgr.updateHistory("#"); console.log(h) } } function at(n) { i[n] && (f = i[n].refresh()) } function vt(n, t) { k(); for (var r in i) i[r].sizeChanged(n, t) } function yt(t, i) { if (t && i) { var r = t + "=" + i; r = b(r); window.open(n.Application.contextUrl + "#" + r); return } alert("improper data") } function pt(t) { var i, r; if (!n.Ini.getIsCacheWindow()) return !1; for (i = 0; i < e.length; i++)if (r = e[i], r.getAD_Window_ID() == t.getAD_Window_ID()) return !0; if (t.getAD_Window_ID() != 0) try { return e.push(t), e.length > 10 && e.splice(0, 1), !0 } catch (u) { return !1 } return !1 } function wt(n) { for (var i, t = 0; t < e.length; t++)if (i = e[t], i.getAD_Window_ID() == n) return e.splice(t, 1), i; return } function bt() { tt = t.getMenuDiv(); $(document).on("keydown", kt).on("keyup", dt); l = t.getNavSection(); u = l.find(".vis-app-action-nav-inner"); u.on("click", gt) } function kt(r) { if ($(".ui-widget-overlay.ui-front").length > 0 && (r.altKey && r.ctrlKey || r.altKey)) return !1; if (r.altKey && r.keyCode == 88) f.dispose(); else if (r.altKey && r.keyCode == 77) t.openMenu(); else if (tt.css("display") != "none" && r.keyCode == 27) t.closeMenu(); else if (r.altKey && r.keyCode == 76) n.ADialog.confirm("LogOut?", !0, "", "Confirm", function (n) { n && $("#logoutForm").trigger("submit") }); else if (!r.altKey && (r.ctrlKey || r.ctrlKey && r.shiftKey) && r.keyCode == 32) { if (!i || Object.keys(i).length <= 0) return; r.ctrlKey && r.shiftKey ? d(!0, !1) : d(!0, !0); r.preventDefault(); r.stopPropagation() } else r.altKey && r.ctrlKey && (r.keyCode == 37 || r.keyCode == 39) ? (f.navigateThroghtShortcut(r.keyCode == 39), r.preventDefault(), r.stopPropagation()) : f && typeof f.keyDown == "function" && f.keyDown.call(f, r) } function dt(n) { n.ctrlKey || (d(!1), h = !1) } function d(n, t) { var e, r; if (n) l.css("display", "flex"); else { h && (r = u.find(".vis-current-nav-window"), et(r)); return } h || (e = [], $.each(i, function (n, t) { t.img && t.img != "" || (t.img = "fa fa-list-alt"); var i = t.img; e.push("<div tabindex=" + n + ' data-wid="' + t.id + '" class="'); f.id == t.id && e.push("vis-current-nav-window "); e.push('vis-nav-window">'); e.push("<span>" + t.name + '<\/span><div class="vis-nav-content-wrap">'); i.indexOf(".") > -1 ? (i = i.replace("Thumb16x16", "Thumb140x120"), e.push('<img data-wid="' + t.id + '" class="vis-nav-window-img" src="' + i + '" alt="' + t.name + '"> <\/img>')) : e.push('<i data-wid="' + t.id + '" class="' + i + '"><\/i>'); e.push("<\/div><\/div>") }), u.append(e.join(" ")), h = !0); t ? (r = u.find(".vis-current-nav-window").next(), (!r || r.length <= 0) && (r = u.children().first())) : (r = u.find(".vis-current-nav-window").prev(), (!r || r.length <= 0) && (r = u.children().last())); u.find(".vis-current-nav-window").removeClass("vis-current-nav-window"); r.addClass("vis-current-nav-window").focus() } function et(n) { f.id != n.data("wid") && (t.toggleContainer(n.data("wid")), t.activateTaskBarItemUsingID(n)); l.css("display", "none"); u.empty(); h = !1 } function gt(n) { var t = $(n.target); (t.hasClass("vis-nav-window") || t.hasClass("vis-nav-window-img")) && et(t) } var g = "P", nt = "R", v = "W", y = "X", p = "!", s = [], i = {}, e = [], h = !1, l = null, u = null, tt = null, w = !1, it = 0, f = null; return bt(), { startAction: rt, restoreActions: lt, resize: at, sizeChanged: vt, startWindow: ut, startForm: ft, startCFrame: ct, startActionInNewTab: yt, closeFrame: ot } } function i(t) { var i, r; this.frame = new n.AWindow; this.frame.setName("Form"); this.onOpened = null; this.onClose = null; i = null; this.contentDispose = null; this.error = !1; this.windowNo = t || n.Env.getWindowNo(); this.hideH = !1; r = this; this.setContent = function (t) { t.getRoot && t.getRoot() || (n.Dialog.error("Error", !0, "class must define root element  and implement getRoot function"), t.dispose(), this.error = !0); t.sizeChanged || (t.sizeChanged = function () { }); t.refresh || (t.refresh = function () { }); t.dispose && (this.contentDispose = t.dispose, t.dispose = function () { r.dispose() }); i = t; this.frame.setCFrameContent(t, this.windowNo); this.hideH && this.frame.hideHeader(this.hideH) }; this.dispose = function () { this.disposing || (this.disposing = !0, this.contentDispose.call(i), this.frame && this.frame.dispose(), this.frame = null, this.onOpened = null, this.onClose = null, i = null, this.contentDispose = null, r = null) } } var t = n.desktopMgr, r = t.getMainConatiner(); i.prototype.setTitle = function (n) { this.frame.setTitle(n) }; i.prototype.getTitle = function () { return this.frame.getTitle() }; i.prototype.setName = function (n) { this.frame.setName(n) }; i.prototype.show = function () { if (this.error) { this.dispose(); return } n.viewManager.startCFrame(this.frame); this.onOpened && this.onOpened() }; i.prototype.hideHeader = function (n) { this.hideH = n; this.frame.cPanel && this.frame.hideHeader(n) }; n.viewManager = u(); n.CFrame = i }(VIS); VIS.context.m_map = {}; VIS.context.getContext = function (n) { if (n == null) throw new ArgumentException("Require Context"); if (arguments.length > 2) return typeof arguments[1] == "number" ? this.getWindowTabContext(arguments[0], arguments[1], arguments[2]) : this.getWindowContext(arguments[0], arguments[1], arguments[2]); if (arguments.length == 2) return this.getWindowContext(arguments[0], arguments[1]); var t = VIS.context.ctx[n]; return t ? t : n == "#AD_User_ID" ? VIS.context.getContext("#" + n) : n == "#AD_User_Name" ? VIS.context.getContext("#" + n) : "" }; VIS.context.getWindowContext = function (n, t, i, r) { var u, e, f; if (t == null) throw new ArgumentException("Require Context"); return typeof arguments[1] == "number" && arguments.length > 2 ? VIS.context.getTabRecordContext(arguments[0], arguments[1], arguments[2], r) : (u = "", typeof t == "number" && (u = "-" + t, t = i, i = r), e = n + u + "|" + t, u = "", typeof t == "number" && (u = "-" + t, t = i, i = r), e = n + u + "|" + t, f = "", this.m_map[n] && (f = this.m_map[n][e]), !f || f == "") ? t.startsWith("#") || t.startsWith("$") ? VIS.context.getContext(t) : i ? "" : VIS.context.getContext("#" + t) : f }; VIS.context.getWindowTabContext = function (n, t, i) { if (i == null) throw new ArgumentException("Require Context"); var r = ""; return (this.m_map[n] && (r = this.m_map[n][n + "|" + t + "|" + i]), !r || r == "") ? VIS.context.getWindowContext(n, i, !1) : r }; VIS.context.getTabRecordContext = function (n, t, i, r) { if (i == null) throw new ArgumentException("Require Context"); var u = ""; return (this.m_map[n] && (u = this.m_map[n][n + "-" + t + "|" + i]), !u || u == "") ? VIS.context.getWindowContext(n, i, r) : u }; VIS.context.setTabRecordContext = function (n, t, i, r) { i != null && (this.m_map[n] || (this.m_map[n] = {}), this.m_map[n][n + "-" + t + "|" + i] = r == null || r === "" ? null : r) }; VIS.context.setContext = function (n, t) { return arguments.length == 4 ? this.setWindowTabContext(arguments[0], arguments[1], arguments[2], arguments[3]) : arguments.length == 3 ? this.setWindowContext(arguments[0], arguments[1], arguments[2]) : VIS.context.ctx[n] = t, n }; VIS.context.setWindowContext = function (n, t, i, r) { if (t != null) { this.m_map[n] || (this.m_map[n] = {}); var u = ""; typeof t == "number" && (u = "-" + t, t = i, i = r); this.m_map[n][n + u + "|" + t] = i == null || i === "" ? null : i } }; VIS.context.setWindowTabContext = function (n, t, i, r) { i != null && (this.m_map[n] || (this.m_map[n] = {}), this.m_map[n][n + "|" + t + "|" + i] = r == null || String(r).equals("") ? null : r) }; VIS.context.clearTabContext = function (n, t) { var r = this.m_map[n], i; for (i in r) i.startsWith(n + "-" + t + "|") && delete r[i] }; VIS.context.getAD_User_ID = function () { return VIS.context.getContext("##AD_User_ID") }; VIS.context.getAD_User_Name = function () { return this.getContext("#AD_User_Name") }; VIS.context.getAD_Role_ID = function () { return this.getContextAsInt("#AD_Role_ID") }; VIS.context.getAD_Role_Name = function () { return this.getContext("#AD_Role_Name") }; VIS.context.getAD_Client_ID = function () { return VIS.context.getContext("#AD_Client_ID") }; VIS.context.getAD_Client_Name = function () { return this.getContext("#AD_Client_Name") }; VIS.context.getAD_Org_ID = function () { return VIS.context.getContext("#AD_Org_ID") }; VIS.context.getAD_Language = function () { return VIS.context.getContext("#AD_Language") }; VIS.context.setAutoCommit = function (n, t) { VIS.context.setWindowContext(n, "AutoCommit", t ? "Y" : "N") }; VIS.context.setAutoNew = function (n, t) { VIS.context.setWindowContext(n, "AutoNew", t ? "Y" : "N") }; VIS.context.isAutoNew = function () { var n = VIS.context.getContext("AutoNew"); return n != null && n === "Y" ? !0 : !1 }; VIS.context.getStdPrecision = function () { return VIS.context.getContext("#StdPrecision") }; VIS.context.setStdPrecision = function () { return VIS.context.getContext("#StdPrecision") }; VIS.context.getIsAutoNew = function (n) { var t = this.getWindowContext(n, "AutoNew", !1); return t != null && t != "" ? t.equals("Y") ? !0 : !1 : this.isAutoNew() }; VIS.context.isAutoCommit = function () { var n = VIS.context.getContext("AutoCommit"); return n != null && n === "Y" ? !0 : !1 }; VIS.context.setContextOfWindow = function (n, t) { if (n && t) { for (prop in n) VIS.context.setWindowContext(t, prop, n[prop]); n = null } }; VIS.context.getContextAsInt = function (n, t, i) { var r = ""; if (r = arguments.length > 1 && typeof arguments[1] == "number" ? this.getWindowTabContext(arguments[0], arguments[1], arguments[2]) : arguments.length > 1 && typeof arguments[0] == "number" ? this.getWindowContext(n, t, i) : this.getContext(arguments[0]), r.length == 0) return 0; try { return parseInt(r) } catch (u) { } return 0 }; VIS.context.getWindowContextAsInt = function (n, t, i) { var r = this.getWindowContext(n, t, i); if (r.length == 0) return 0; try { return parseInt(r) } catch (u) { } return 0 }; VIS.context.getContextAsTime = function (n, t) { var i = this.getContext(n, t, !1); return i == null || i.length == 0 ? Date.now().getTime() : new Date(i).getTime() }; VIS.context.getShowClientOrg = function () { return this.getContextAsInt("#ClientOrgLevel") }; VIS.context.removeWindow = function (n) { this.m_map[n] = null; delete this.m_map[n]; key = null }; VIS.context.getWindowCtx = function (n) { var t = {}; return $.extend(t, this.ctx), n && $.extend(t, this.m_map[n]), t }; VIS.context.getEntireCtx = function () { var n = {}, t; $.extend(n, this.ctx); for (t in this.m_map) this.m_map.hasOwnProperty(t) && $.extend(n, this.m_map[t]); return n }; VIS.context.isSOTrx = function (n) { var t = !1; return (t = n ? this.getWindowContext(n, "IsSOTrx", !0) : this.getContext("IsSOTrx"), t != null && t.equals("Y")) ? !0 : !1 }; VIS.context.setIsSOTrx = function () { arguments.length == 2 ? this.setContext(arguments[0], "IsSOTrx", arguments[1] ? "Y" : "N") : this.setContext("IsSOTrx", arguments[0] ? "Y" : "N") }; VIS.context.getIsUseCrystalReportViewer = function () { return VIS.context.getContext("#USE_CRYSTAL_REPORT_VIEWER") == "Y" }; VIS.context.getLocationBulkReload = function () { return VIS.context.getContext("#LOCATION_NAME_BULK_REQUEST") == "Y" }; VIS.Msg = {}; VIS.Msg.elements = {}; VIS.I18N.getLabel = function (n, t, i, r) { var u, f; if (!VIS.I18N.labels[n]) return i && r && VIS.I18N.getLabelFromServer(n, t, i, r), "[" + n + "]"; if (u = VIS.I18N.labels[n], t && t.length && t.length > 0) for (f = 0; f < t.length; f++)u = u.replace("%" + f, t[f]); return i && r && (Object.prototype.toString.call(i[r]) === "[object Function]" ? i[r](u) : i[r] = u), u }; VIS.I18N.getLabelFromServer = function (n) { return "UNDEFINED " + n }; VIS.Msg.getMsg = function (n, t, i) { if (!VIS.I18N.labels[n]) return "[" + n + "]"; label = VIS.Utility.Util.cleanMnemonic(VIS.I18N.labels[n]); var r = label.split("      "); return t || (label = r[0]), i && r.length > 1 && (label = r[1]), label }; VIS.Msg.parseTranslation = function (n, t) { var u; if (t == null || t.length == 0) return t; for (var i = t, e, f = "", r = i.indexOf("@"); r != -1;) { if (f += i.substring(0, r), i = i.substring(r + 1, i.length), u = i.indexOf("@"), u < 0) { i = "@" + i; break } e = i.substring(0, u); f += this.translate(n, e); i = i.substring(u + 1, i.length); r = i.indexOf("@") } return f + i }; VIS.Msg.translate = function (n, t, i) { if (t == null || t.length == 0) return t; if (i) { var r = null; if ($.ajax({ url: VIS.Application.contextUrl + "JsonData/GetTranslatedText", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ Columns: t, AD_Language: VIS.Env.getAD_Language(n) }) }).done(function (n) { r = n }), r) return JSON.parse(r); r } else return VIS.Msg.translate3(VIS.Env.getAD_Language(n), n.isSOTrx(), t) }; VIS.Msg.getElement = function (n, t) { return VIS.Msg.getElement3(VIS.Env.getAD_Language(n), t, !0) }; VIS.Msg.getElement1 = function (n) { return VIS.Msg.getElement3(VIS.Env.getAD_Language(VIS.Env.getCtx()), n, !0) }; VIS.Msg.translate3 = function (n, t, i) { var u, r; return i == null || i.equals("") ? "" : (u = n, (u == null || u.length == 0) && (u = VIS.Env.getBaseAD_Language()), r = VIS.Msg.getElement3(u, i, t), !r.equals("")) ? r.trim() : (r = VIS.Msg.getMsg(i), r && r.length > 0) ? r : i }; VIS.Msg.getElement3 = function (n, t, i) { function a(n, t, i) { var r = null; return $.ajax({ url: l, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: t, data: JSON.stringify(n) }).done(function (n) { r = n; i && i(n) }), r } var c = VIS.Application.contextUrl, l = c + "JsonData/JDataSetWithCode", h = function (n, t, i) { var f = i ? !0 : !1, u = { sql: n, page: 1, pageSize: 0 }, r; return t && (u.param = t), r = null, a(u, f, function (n) { r = (new VIS.DB.DataReader).toJson(n); i && i(r) }), r }, r, u, s; if (t == null || t.equals("")) return ""; if (r = n, (r == null || r.length == 0) && (r = VIS.Env.getBaseAD_Language()), VIS.Msg.elements[t]) return VIS.Msg.elements[t]; var f = "", o = "", e = null; try { r == null || r.length == 0 || VIS.Env.isBaseLanguage(r, "AD_Element") ? (o = "VIS_73", u = [], u[0] = new VIS.DB.SqlParam("@ColumnName", t.toUpper()), e = h(o, u)) : (o = "VIS_74", u = [], u[0] = new VIS.DB.SqlParam("@ColumnName", t.toUpper()), u[1] = new VIS.DB.SqlParam("@AD_Language", r), e = h(o, u)); e.read() && (f = e.getString(0), i || (s = e.getString(1), s != null && s.length > 0 && (f = s))); e.close() } catch (v) { e.close() } return f != null && (f = f.trim()), VIS.Msg.elements[t] = f, f }; VIS.MRole.getDefault = function () { return VIS.MRole }; VIS.MRole.log = VIS.Logging.VLogger.getVLogger("MRole"); VIS.MRole.canUpdate = function (n, t, i, r, u) { var e = this.vo.UserLevel.trim(), f = !0, o = ""; return n == 0 && t == 0 && e.indexOf("S") == -1 ? (f = !1, o += "S") : n != 0 && t == 0 && e.indexOf("C") == -1 ? e.indexOf("O") == -1 && this.getIsOrgAccess(t, !0) || (f = !1, o += "C") : n != 0 && t != 0 && e.indexOf("O") == -1 && (f = !1, o += "O"), f && (f = this.getIsTableAccess(i, !1)), f && r != 0 && (f = this.getIsRecordAccess(i, r, !1)), !f && u && VIS.MRole.log.warning("AccessTableNoUpdate => AD_Client_ID=" + n + ", AD_Org_ID=" + t + ", UserLevel=" + e + " => missing=" + o), f }; VIS.MRole.getIsColumnAccess = function (n, t, i) { var u, f, r; if (!this.getIsTableAccess(n, i)) return !1; for (u = !0, f = this.vo.columnAccess, r = 0; r < f.length; r++)if (f[r].IsExclude) { if (f[r].AD_Table_ID == n && f[r].AD_Column_ID == t && (u = i ? !1 : !f[r].IsReadOnly, !u)) return u } else if (f[r].AD_Table_ID == n && f[r].AD_Column_ID == t && (u = i ? !0 : !f[r].IsReadOnly, !u)) return u; return !u, u }; VIS.MRole.getIsTableAccessLevel = function (n, t) { var i, r; return t ? !0 : (i = this.vo.tableAccessLevel[n], i == null) ? !1 : i.equals(VIS.Consts.ACCESSLEVEL_All) ? !0 : (r = this.vo.UserLevel.trim(), r.indexOf("S") != -1 && (i.equals(VIS.Consts.ACCESSLEVEL_SystemOnly) || i.equals(VIS.Consts.ACCESSLEVEL_SystemPlusClient))) ? !0 : r.indexOf("C") != -1 && (i.equals(VIS.Consts.ACCESSLEVEL_ClientOnly) || i.equals(VIS.Consts.ACCESSLEVEL_SystemPlusClient)) ? !0 : r.indexOf("O") != -1 && (i.equals(VIS.Consts.ACCESSLEVEL_Organization) || i.equals(VIS.Consts.ACCESSLEVEL_ClientPlusOrganization)) ? !0 : !1 }; VIS.MRole.canView = function (n) { var i = this.vo.UserLevel.trim(), t = !0; return (VIS.Consts.ACCESSLEVEL_All.equals(n) ? t = !0 : VIS.Consts.ACCESSLEVEL_SystemOnly.equals(n) && i.indexOf("S") == -1 ? t = !1 : VIS.Consts.ACCESSLEVEL_ClientOnly.equals(n) && i.indexOf("C") == -1 ? t = !1 : VIS.Consts.ACCESSLEVEL_Organization.equals(n) && i.indexOf("O") == -1 ? t = !1 : !VIS.Consts.ACCESSLEVEL_ClientPlusOrganization.equals(n) || i.indexOf("C") != -1 || i.indexOf("O") != -1 ? !VIS.Consts.ACCESSLEVEL_SystemPlusClient.equals(n) || i.indexOf("S") != -1 || i.indexOf("C") != -1 || (t = !1) : t = !1, t) ? t : (VIS.MRole.log.warning("AccessTableNoView", "Required=" + n + "() != UserLevel=" + i), t) }; VIS.MRole.getIsTableAccess = function (n, t) { var u, i, r; if (!this.getIsTableAccessLevel(n, t)) return !1; for (u = !0, i = this.vo.tableAccess, r = 0; r < i.length; r++)if (VIS.Consts.ACCESSTYPERULE_Accessing.equals(i[r].AccessTypeRule)) if (i[r].IsExclude) { if (i[r].AD_Table_ID === n) return t ? i[r].IsReadOnly : !1 } else if (u = !1, i[r].AD_Table_ID == n) return t ? !0 : !i[r].IsReadOnly; return !u, i = null, u }; VIS.MRole.getIsCanReport = function (n) { var r, t, i; if (!this.vo.IsCanReport || !this.getIsTableAccess(n, !0)) return !1; for (r = !0, t = this.vo.tableAccess, i = 0; i < t.length; i++)if (VIS.Consts.ACCESSTYPERULE_Reporting.equals(t[i].AccessTypeRule)) if (t[i].IsExclude) { if (t[i].AD_Table_ID === n) return t[i].IsCanReport } else if (r = !1, t[i].AD_Table_ID === n) return t[i].IsCanReport; return t = null, r }; VIS.MRole.getIsCanExport = function (n) { var r, t, i; if (!this.vo.IsCanExport || !this.getIsTableAccess(n, !0) || !this.getIsCanReport(n)) return !1; for (r = !0, t = this.vo.tableAccess, i = 0; i < t.length; i++)if (VIS.Consts.ACCESSTYPERULE_Exporting.equals(t[i].AccessTypeRule)) if (t[i].IsExclude) { if (t[i].AD_Table_ID === n) return t[i].IsCanExport } else if (r = !1, t[i].AD_Table_ID === n) return t[i].IsCanExport; return t = null, r }; VIS.MRole.getIsOrgAccess = function (n, t) { var i, r; if (this.vo.IsAccessAllOrgs || n == 0 && !t) return !0; for (i = this.vo.orgAccess, r = 0; r < i.length; r++)if (i[r].AD_Org_ID === n) return t ? i[r].readOnly ? !1 : !0 : !0; return i = null, !1 }; VIS.MRole.getIsRecordAccess = function (n, t, i) { for (var e = !0, u = this.vo.recordAccess, r = null, f = 0; f < u.length; f++)if (r = u[f], r.AD_Table_ID === n) if (r.IsExclude) { if (r.Record_ID === t) return u = null, i ? r.IsReadOnly : !1 } else if (e = !1, r.Record_ID === t) return u = null, i ? !0 : !r.IsReadOnly; return e }; VIS.MRole.getClientWhere = function (n) { var t, r, u, i, e, f; if (this.vo.IsAccessAllOrgs) return n || this.vo.AD_Client_ID == 0 ? "AD_Client_ID=" + this.vo.AD_Client_ID : "AD_Client_ID IN (0," + this.vo.AD_Client_ID + ")"; for (t = [], n || t.push("0"), r = 0; r < this.vo.orgAccess.length; r++)u = this.vo.orgAccess[r].AD_Client_ID.toString(), t.indexOf(u) < 0 && t.push(u), u = null; for (i = new StringBuilder, e = !0, f = 0; f < t.length; f++)i.length() > 0 && (i.append(","), e = !1), i.append(t[f]); return (t = null, e) ? i.length() > 0 ? "AD_Client_ID=" + i.toString() : (this.log.log(VIS.Logging.Level.SEVERE, "No Access Org records"), "AD_Client_ID=-1") : "AD_Client_ID IN(" + i.toString() + ")" }; VIS.MRole.getOrgWhere = function (n, t) { var i, f, e, r, s; if (this.vo.IsAccessAllOrgs) return null; for (i = [], t || i.push("0"), f = this.vo.orgAccess, e = 0; e < f.length; e++)r = f[e].AD_Org_ID.toString(), t ? r.readOnly || i.indexOf(r) < 0 && i.push(r) : i.indexOf(r) < 0 && i.push(r); if (f = null, i.length == 1) return "COALESCE(" + (n == null ? "" : n + ".") + "AD_Org_ID,0)=" + i[0]; if (i.length == 0) return this.log.log(VIS.Logging.Level.SEVERE, "No Access Org records"), (n == null ? "" : n + ".") + "AD_Org_ID=-1"; var o = new StringBuilder, u = new StringBuilder, h = 0; for (s = 0; s < i.length; s++)u.length() > 0 && u.append(","), u.append(i[s]), h++, (h % 999 == 0 || h == i.length) && (o.length() > 0 && o.append(" OR "), o.append("COALESCE(" + (n == null ? "" : n + ".") + "AD_Org_ID,0) IN(").append(u.toString()).append(")"), u = null, u = new StringBuilder); return "(" + o.toString() + ")" }; VIS.MRole.getAD_Table_ID = function (n) { var t = this.vo.tableName[n]; return t != null ? t : 0 }; VIS.MRole.getSynonym = function (n) { var t = this.columnSynonym[n]; return t ? t : null }; VIS.MRole.getKeyColumnName = function (n, t) { var u = this.getSynonym(t), i, r; if (u == null) return t; for (i = 0; i < n.length; i++)if (r = n[i], t.equals("AD_User_ID")) { if (r.getTableName().equals("AD_User")) return t } else if (t.equals("AD_ElementValue_ID") && r.getTableName().equals("AD_ElementValue")) return t; return u }; VIS.MRole.getDependentAccess = function (n, t, i, r) { var u, f; if (t.length == 0 && i.length == 0) return ""; if (t.length != 0 && i.length != 0 && this.log.warning("Mixing Include and Excluse rules - Will not return values"), u = new StringBuilder(" AND "), r && u.append(" ( "), t.length == 1) u.append(n).append("=").append(t[0]); else if (t.length > 1) { for (u.append(n).append(" IN ("), f = 0; f < t.length; f++)f > 0 && u.append(","), u.append(t[f]); u.append(")") } else if (i.length == 1) u.append(n).append("<>").append(i[0]); else if (i.length > 1) { for (u.append(n).append(" NOT IN ("), f = 0; f < i.length; f++)f > 0 && u.append(","), u.append(i[f]); u.append(")") } return r && u.append(" OR ").append(n).append(" IS NULL").append(" ) "), u.toString() }; VIS.MRole.getDependentRecordWhereColumn = function (n, t) { var f = t, e = n.indexOf(t), u = e - 1, i = n.charAt(u), r; if (i == ".") { for (r = new StringBuilder; i != " " && i != "," && i != "(";)r.insert(0, i), i = n.charAt(--u); return r.append(t), r.toString() } return f }; VIS.MRole.getRecordWhere = function (n, t, i) { for (var o = new StringBuilder, s = new StringBuilder, e = !1, f = this.vo.recordAccess, r, h, u = 0; u < f.length; u++)f[u].AD_Table_ID == n && (f[u].IsExclude ? (s.length() == 0 ? s.append(t).append(" NOT IN (") : s.append(","), s.append(f[u].Record_ID)) : i && f[u].IsReadOnly || (o.length() == 0 ? o.append(t).append(" IN (") : o.append(","), o.append(f[u].Record_ID)), e = e || f[u].IsIncludeNull); return r = new StringBuilder, s.length() > 0 && (e && r.append("("), r.append(s).append(")"), e && r.append(" OR ").append(t).append(" IS NULL )"), e = !1), o.length() > 0 && (r.length() > 0 && r.append(" AND "), e && r.append("("), r.append(o).append(")"), e && r.append(" OR ").append(t).append(" IS NULL )")), this.vo.IsPersonalAccess || !this.vo.tableData[n].IsView && this.vo.tableData[n].HasKey && (h = " NOT IN ( SELECT Record_ID FROM AD_Private_Access WHERE AD_Table_ID = " + n + " AND AD_User_ID <> " + this.vo.AD_User_ID + " AND IsActive = 'Y' )", r.length() > 0 && r.append(" AND "), r.append(t).append(h)), f = null, r.toString() }; VIS.MRole.getDocWhere = function (n) { function s(n, t, i) { var r = null; return $.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: t, data: JSON.stringify(n) }).done(function (n) { r = n; i && i(n) }), r } var f = VIS.Application.contextUrl, e = f + "JsonData/JDataSetWithCode", o = function (n, t, i) { var u = i ? !0 : !1, f = { sql: n, page: 1, pageSize: 0 }, r = null; return s(f, u, function (n) { t = (new VIS.DB.DataSet).toJson(n); var t = (new VIS.DB.DataSet).toJson(n); r = t.getTable(0).getRows().length > 0 ? t.getTable(0).getRow(0).getCell(0) : null; t.dispose(); t = null; u && i(r) }), r }, t, u; if (!this.vo.IsUseBPRestrictions) return ""; var i = !1, r = []; return (r[0] = new VIS.DB.SqlParam("@TableName", n), t = o("VIS_101", r), i = (t ? parseInt(t) : 0) != 0, !i) ? "" : (u = VIS.context.getAD_User_ID(), $.ajax({ type: "Get", async: !1, url: VIS.Application.contextUrl + "Form/GetDocWhere", data: { AD_User_ID: u, TableName: n }, success: function (n) { docAccess = n }, error: function (n) { console.log(n) } }), docAccess) }; VIS.MRole.addAccessSQL = function (n, t, r, u, f) { var a, h, o, d, ft, s, b, p, k, v, g, w, y, it, l, ht, rt; r && VIS.Utility.Util.isEmpty(t) && (r = !1); var e = new StringBuilder, st = "", ut = n.lastIndexOf(" ORDER BY "); for (ut != -1 ? (st = n.substring(ut), e.append(n.substring(0, ut))) : e.append(n), a = new VIS.AccessSqlParser(e.toString()), h = a.getTableInfo(a.getMainSqlIndex()), a.getMainSql().indexOf(" WHERE ") == -1 ? e.append(" WHERE ") : e.append(" AND "), o = "", h.length > 0 && (h[0].getTableName().equals(t) || h[0].getSynonym().equals(t)) && (o = h[0].getSynonym(), VIS.Utility.Util.isEmpty(o) && (o = h[0].getTableName())), !VIS.Utility.Util.isEmpty(t) && VIS.Utility.Util.isEmpty(o) && (d = "TableName not correctly parsed - TableNameIn=" + t + " - " + a, h.length > 0 && (d += " - #1 " + h[0]), d += "\n = " + n, this.log.log(VIS.Logging.Level.SEVERE, d), o = t), r && !VIS.Utility.Util.isEmpty(o) && e.append(o).append("."), e.append(this.getClientWhere(u)), this.vo.IsAccessAllOrgs || f || (e.append(" AND "), r && !VIS.Utility.Util.isEmpty(o) ? e.append(this.getOrgWhere(o, u)) : e.append(this.getOrgWhere(null, u))), this.vo.IsUseBPRestrictions && (ft = this.getDocWhere(o), ft.length() > 0 && (e.append(" AND "), e.append(ft))), s = 0, i = 0; i < h.length; i++) { if (b = h[i], p = b.getTableName(), s = this.getAD_Table_ID(p), s != 0 && !this.vo.IsAccessAllOrgs && f && (k = b.getSynonym(), (k == null || k.isEmpty()) && (k = p), e.append(" AND "), e.append(this.getOrgWhere(k, u))), s != 0 && !this.getIsTableAccess(s, !u)) { e.append(" AND 1=3"); this.log.fine("No access to AD_Table_ID=" + s + " - " + p + " - " + e); break } v = ""; r && (v = b.getSynonym(), v.length == 0 && (v = p), v += "."); v += p + "_ID"; g = this.getRecordWhere(s, v, u); g.length > 0 && (e.append(" AND ").append(g), this.log.finest("Record access - " + g)) } b = null; w = a.getMainSql(); s = 0; var nt = null, et = [], ot = [], tt = !1, c = this.vo.recordDependentAccess; for (i = 0; i < c.length; i++)(y = this.getKeyColumnName(a.getTableInfo(a.getMainSqlIndex()), c[i].KeyColumnName), y != null) && (it = w.indexOf(y), it != -1) && (l = w.charAt(it - 1), l == "," || l == "." || l == " " || l == "(") && (l = w.charAt(it + y.length), l == "," || l == " " || l == ")") && (s != 0 && s != c[i].AD_Table_ID && e.append(this.getDependentAccess(nt, et, ot, tt)), s = c[i].AD_Table_ID, c[i].IsExclude ? (ot.push(c[i].Record_ID), this.log.fine("Exclude " + y + " - " + c[i])) : u && c[i].IsReadOnly || et.push(c[i].Record_ID), tt = tt || c[i].IsIncludeNull, ht = null, ht != null ? (rt = "", nt = rt == null || rt.length() == 0 ? this.getDependentRecordWhereColumn(w, y) : rt) : nt = this.getDependentRecordWhereColumn(w, y)); return e.append(this.getDependentAccess(nt, et, ot, tt)), e.append(st), e.toString() }; VIS.MRole.getWindowAccess = function (n) { return this.vo.windowAccess[n] ? !0 : !1 }; VIS.MRole.getFormAccess = function (n) { return this.vo.formAccess[n] ? !0 : !1 }; VIS.MRole.getProcessAccess = function (n) { return this.vo.processAccess[n] ? !0 : !1 }; VIS.MRole.getIsClientAccess = function (n, t) { var r, i; if (n == 0 && !t) return !0; for (r = this.vo.orgAccess, i = 0; i < r.length; i++)if (r[i].AD_Client_ID == n && (!t || !r[i].readOnly)) return !0; return !1 }; VIS.MRole.getIsShowPreference = function () { return this.vo.IsShowPreference }; VIS.MRole.getName = function () { return this.vo.Name }; VIS.MRole.getPreferenceType = function () { return this.vo.PreferenceType }; VIS.MRole.getIsDisplayClient = function () { return this.vo.IsDisplayClient }; VIS.MRole.getIsDisplayOrg = function () { return this.vo.IsDisplayOrg }; VIS.MRole.getIsPersonalLock = function () { return this.vo.IsPersonalLock }; VIS.MRole.getMaxQueryRecords = function () { return this.vo.MaxQueryRecords }; VIS.MRole.getIsQueryMax = function (n) { var t = this.getMaxQueryRecords(); return t > 0 && n > t }; VIS.MRole.getIsShowAcct = function () { return this.vo.IsShowAcct }; VIS.MRole.getIsOverwritePriceLimit = function () { return this.vo.IsOverwritePriceLimit }; VIS.MRole.getIsOverrideReturnPolicy = function () { return this.vo.IsOverrideReturnPolicy }; VIS.MRole.getIsDisableMenu = function () { return this.vo.IsDisableMenu }; VIS.MRole.getHomePage = function () { return this.vo.HomePage }; VIS.MRole.toStringX = function (n) { var t = new StringBuilder; return t.append(VIS.Msg.translate(n, "AD_Role_ID")).append("=").append(this.getName()).append(" - ").append(VIS.Msg.translate(n, "IsCanExport")).append("=").append(this.getIsCanExport()).append(" - ").append(VIS.Msg.translate(n, "IsCanReport")).append("=").append(this.getIsCanReport()).append(VIS.Env.NL).append(VIS.Env.NL), t.toString() }, function (n, t) { function r() { function w(n) { if (n) window.setTimeout(function () { c.focus(); u.on("keydown", function (n) { if (n.keyCode == 9) l.is(":focus") ? c.focus() : c.is(":focus") ? l.focus() : c.focus(), n.preventDefault(), n.stopPropagation(); else if (n.keyCode == 27) return n.preventDefault(), n.stopPropagation(), k(n), !1 }) }, 100); else { u.focus(); u.on("keydown", function (n) { return n.preventDefault(), n.stopPropagation(), k(n), !1 }) } } function k(n) { n.stopPropagation(); f && f(); f = null; b() } function b() { a.hide(); u.css({ position: "inherit", display: "none" }); r.find(".vis-Dialog-buttons").css("display", "none"); l && l.off("click"); c && c.off("click"); u.off("keydown") } function g(t, i, c) { f = c; try { } catch (l) { } u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/info-icon.png"); _prodFound = !0; p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Info")); a.show(); r.fadeIn(300); w(!1) } function nt(t, i, v) { f = v; try { } catch (d) { } u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info vis-PopupContent-alert-Confirm"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/confirm-icon.png"); var k = r.find(".vis-Dialog-buttons"); k.css("display", "inherit"); l = k.find(".vis-Dialog-buttons-OK"); c = k.find(".vis-Dialog-buttons-Cancel"); _prodFound = !0; p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Confirm")); a.show(); r.fadeIn(300); l.one("click", function () { b(); k.css("display", "none"); f(!0) }); c.one("click", function () { b(); k.css("display", "none"); f(!1) }); w(!0) } function tt(t, i, k, d) { f = d; try { } catch (nt) { } u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info vis-PopupContent-alert-Confirm"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/confirm-icon.png"); var g = r.find(".vis-Dialog-buttons"); g.css("display", "inherit"); l = g.find(".vis-Dialog-buttons-OK"); c = g.find(".vis-Dialog-buttons-Cancel"); _prodFound = !0; p.text(t); v.empty(); v.css("display", "block"); v.append(k); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Confirm")); a.show(); r.fadeIn(300); l.one("click", function () { b(); g.css("display", "none"); v.css("display", "none"); v.empty(); f(!0) }); c.one("click", function () { b(); g.css("display", "none"); v.css("display", "none"); v.empty(); f(!1) }); w(!0) } function it(t, i, c) { f = c; try { } catch (l) { } _prodFound = !0; u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-warn"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-warn"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-warn"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/warning-icon.png"); p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Warning")); a.show(); w(!1) } function rt(t, i, c) { f = c; try { } catch (l) { } _prodFound = !0; u.css({ position: "absolute", display: "flex" }); r.show(); e.removeClass(); e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-error"); h.removeClass(); h.addClass("vis-PopupContent-alert vis-PopupContent-alert-error"); o.removeClass(); o.addClass("vis-popup-headerContainer vis-popup-headerContainer-error"); y.attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/error-icon.png"); p.text(t); i ? s.text(n.Msg.getMsg(i)) : s.text(n.Msg.getMsg("Error")); a.show(); r.fadeIn(300); w(!1) } var a = t('<div id="overlayMsgDialog" class="web_dialog_overlay"><\/div>'), u = t('<div class="vis-PopupWrap-alertmain" tabIndex=1>'), r = t('<div id="VAPOS_ErrorInfo" class="vis-PopupWrap-alert"><input class="vis-Dialog-buttons-text" type="number"  tabindex="-30" style="z-index:-44;position:absolute"  autofocus="autofocus"  >        <div class="vis-popup-headerContainer">                                                  <div class="vis-PopupHeader-alert">           <h4 id="VAPOS_CLInformation">Information<\/h4>           <span id="btnCloseInfo" class="fa fa-times"><\/span>                            <\/div>  <\/div>                                                                                          <div class="vis-PopupContent-alert">                                                                    <div class="form-group vis-PopupInput-alert" style="width: 100%">                                <img class="vis-alert-img" style="float:left"  />                                                                      <label style="width: 90%;padding-left: 10px;word-break: break-word" id="VAPOS_lblErrorInfo"><\/label>                                   <div class="vis-confirm-customUI" style="display:none"> <\/div>                        <\/div>                                                                                                <div class="vis-Dialog-buttons" style="display:none">                                           <input class="vis-Dialog-buttons-OK " type="button" value="' + n.Msg.getMsg("OK") + '" > <input  class="vis-Dialog-buttons-Cancel"  type="button" value="' + n.Msg.getMsg("Cancel") + '" >                                               <\/div>                                                                                                                                                  <\/div>                                                                                      <\/div>'); u.append(r); i.append(a).append(u); var e = r.find(".vis-PopupHeader-alert"), o = r.find(".vis-popup-headerContainer"), d = r.find("#btnCloseInfo"), s = r.find("#VAPOS_CLInformation"), y = r.find(".vis-alert-img"), h = r.find(".vis-PopupContent-alert"), p = r.find("#VAPOS_lblErrorInfo"), v = r.find(".vis-confirm-customUI"), ut = r.find("#VAPOS_busyInd"), l = null, c = null, f = null; d.on("click", function (n) { k(n) }); return { info: g, ask: nt, error: rt, warn: it, askCustomUI: tt } } var i = t("body"), u = t("#vis_buzzer"); n.ADialog = { info: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); r != null && r.length > 0 && (f += "\n" + r); n.ADialogUI.info(f, u); f = null }, ask: function (t, i, r) { var u = "", f; return t == null || t.equals("") || (u += n.Msg.getMsg(t)), r != null && r.length > 0 && (u += "\n" + r), f = !1, confirm(u) && (f = !0), f }, error: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); r != null && r.length > 0 && (f += "\n" + r); n.ADialogUI.error(f, u); f = null }, warn: function (t, i, r, u) { var f = ""; t == null || t.equals("") || (f += n.Msg.getMsg(t)); r != null && r.length > 0 && (f += "\n" + r); n.ADialogUI.warn(f, u); f = null }, confirm: function (t, i, r, u, f) { var e = "", o; return t == null || t.equals("") || (e += n.Msg.getMsg(t)), r != null && r.length > 0 && (e += "\n" + r), o = !1, n.ADialogUI.ask(e, u, f), o }, confirmCustomUI: function (t, i, r, u, f, e) { var o = "", s; return t == null || t.equals("") || (o += n.Msg.getMsg(t)), r != null && r.length > 0 && (o += "\n" + r), s = !1, n.ADialogUI.askCustomUI(o, u, f, e), s } }; n.ADialogUI = r() }(VIS, jQuery), function (n, t) { function k(n, i, r) { var u = null; return t.ajax({ url: d, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function w(i, r, u) { var f = null; return i.sql = n.secureEngine.encrypt(i.sql), t.ajax({ url: g, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: r, data: JSON.stringify(i) }).done(function (n) { f = n; u && u(n) }), f } function i(n, t, i, r, u) { this.info = n; this.lookup = null; this.allLoaded = !1; this.hasInactive = !1; this.displayType = u; this.selectedObject; this.windowNo = r; this.validationDisabled = !1; this.tabNo = 0; this.colName = ""; this.data = []; this.ctx = i; t && (this.lookup = t._lookup, this.allLoaded = t._allLoaded, this.hasInactive = t._hasInactive, this.displayType = t._displayType, this.windowNo = t._WindowNo, this.tabNo = t._TabNo, this.colName = t._columnName, this.info && (this.info.windowNo = t._WindowNo)) } function r(t, r) { i.call(this, t, r); this.lookupDirect = {}; this.directNullKey; this.loading = !1; this.nextRead = 0; this.cLookup = !1; this.lookupDirectAll = {}; this.zomQuery = null; this.prepareZQuery(); this.log = n.Logging.VLogger.getVLogger("MLookup") } function f(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.lookup = {}; this.load() } function u(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.C_Locator_ID = 0; this.OnlyOrgID = 0; this.onlyWarehouseID = 0; this.onlyProductID = 0; this.onlyOutgoing = !1; this.lookup = {}; this.maxRows = 1e4; this.defaultID = ""; this.log = n.Logging.VLogger.getVLogger("MLocatorLookup"); this.load(!1); this.disposeLocal = function () { this.lookup = null; this.log = null } } function s(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.log = n.Logging.VLogger.getVLogger("MAccountLookup"); this.C_ValidCombination_ID = 0; this.combination; this.description; this.lst = {} } function a(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.NO_INSTANCE = { Key: 0, Name: "" }; this.log = n.Logging.VLogger.getVLogger("MPAttributeLookup") } function c(t, r) { i.call(this, null, null, t, r, n.DisplayType.TableDir); this.NO_INSTANCE = { Key: 0, Name: "" }; this.log = n.Logging.VLogger.getVLogger("MGAttributeLookup") } function h(t, r) { i.call(this, null, null, t, r, n.DisplayType.AmtDimension); this.lookup = {} } function l(t, r) { i.call(this, null, null, t, r, n.DisplayType.ProductContainer); this.log = n.Logging.VLogger.getVLogger("MProductContainerLookup"); this.lookup = {} } var v = n.DB, e = n.Logging.Level, y = n.Application.contextUrl, d = y + "JsonData/JDataSetWithCode", g = y + "Form/JDataSet", nt = y + "JsonData/ExecuteNonQuer", o = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, k(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, tt = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, k(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, it = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, w(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, p = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, w(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, b = function (t, i, r, u, f) { var s = f ? !0 : !1, o = { sql: t, page: i, pageSize: r }, e; return u && (o.param = u), e = null, w(o, s, function (t) { e = (new n.DB.DataReader).toJson(t); f && f(e) }), e }; i.prototype.INACTIVE_S = "~"; i.prototype.INACTIVE_E = "~"; i.prototype.MAX_ROWS = 1e4; i.prototype.MINUS_ONE = -1; i.prototype.getValidation = function () { return "" }; i.prototype.getWindowNo = function () { return this.windowNo }; i.prototype.getTabNo = function () { return this.tabNo }; i.prototype.setTabNo = function (n) { this.tabNo = n }; i.prototype.getFieldColName = function () { return this.colName }; i.prototype.getDisplayType = function () { return this.displayType }; i.prototype.setDisplayType = function (n) { this.displayType = n }; i.prototype.disableValidation = function () { this.validationDisabled = !0 }; i.prototype.getIsValidationDisabled = function () { return this.validationDisabled }; i.prototype.getIsValidated = function () { return !0 }; i.prototype.getHasInactive = function () { return this.hasInactive }; i.prototype.getData = function () { return [] }; i.prototype.getDisplay = function () { return "" }; i.prototype.getSelectedItem = function () { return this.selectedObject }; i.prototype.fillCombobox = function (n, t, i, r) { var u = this.selectedObject, f; this.data != null && (this.data.length = 0); this.data = this.getData(n, t, i, r); f = 0; this.data != null && (f = this.data.length); u != this.selectedObject && (u = this.selectedObject); u == null && n && f > 0 && (u = this.data[0], this.selectedObject = u) }; i.prototype.setSelectedItem = function (n) { (this.selectedObject != null && this.selectedObject !== n || this.selectedObject == null && n != null) && this.setSelectedItemAlways(n) }; i.prototype.setSelectedItemAlways = function (n) { this.selectedObject = this.data.indexOf(n) > -1 || n == null ? n : null }; i.prototype.refresh = function () { return 0 }; i.prototype.getZoomQuery = function () { return null }; i.prototype.getColumnName = function () { return this.info.keyColumn }; i.prototype.dispose = function () { this.info = null; this.lookup = null; this.allLoaded = null; this._hasInactive = null; this.selectedObject = null; this.data = null; this.ctx = null }; i.prototype.removeAllElements = function () { this.data.length > 0 && (this.data.length = 0, this.selectedObject = null) }; i.prototype.clear = function () { this.removeAllElements() }; i.prototype.gethasImageIdentifier = function () { return !1 }; n.Utility.inheritPrototype(r, i); r.prototype.prepareZQuery = function () { var r, f, u, i; if (this.info.zoomQuery != null && !t.isEmptyObject(this.info.zoomQuery)) for (r = this.info.zoomQuery, this.zomQuery = new n.Query(r._tableName), f = null, u = 0; u < r._list.length; u++)i = r._list[u], f = new n.QueryRestriction(i.ColumnName, i.Code, i.Code_to, i.InfoName, r.InfoDisplay, i.InfoDisplay_to, i.Operator, i.DirectWhereClause, i.AndCondition), this.zomQuery.addRestriction(f) }; r.prototype.initialize = function (t) { return t ? this : this.info.isParent || this.info.isKey ? (this.hasInactive = !0, this) : this.getDisplayType() == n.DisplayType.Search || this.info.isCreadedUpdatedBy ? this : (this.info.isValidated ? this.load(!0, !0) : this.fillDirectList(), this) }; r.prototype.getValidation = function () { return this.getIsValidationDisabled() ? "" : this.info.validationCode }; r.prototype.getIsValidated = function () { return this.getIsValidationDisabled() ? !0 : this.info == null ? !1 : this.info.isValidated }; r.prototype.getData = function (n, t, i, r) { var u = this.getData2(t, r), f, o, e, s; if (i && this.hasInactive) for (f = u.length; f > 0; f--)o = u[f - 1], o != null && (e = o.Name, e.startsWith(this.INACTIVE_S) && e.endsWith(this.INACTIVE_E) && (console.log(e), u.splice(f - 1, 1))); return n || (s = null, s = this.info.keyColumn != null && this.info.keyColumn.toUpperCase().endsWith("_ID") ? { Key: -1, Name: "" } : { Key: "", Name: "" }, u.unshift(s)), u }; r.prototype.getData2 = function (n, i) { return ((!this.allLoaded || t.isEmptyObject(this.lookup)) && this.refresh(i), this.info.isValidated) ? this.getObjectArray(this.lookup) : (!this.info.isValidated && n && this.refresh(i), this.getObjectArray(this.lookup)) }; r.prototype.getObjectArray = function (n) { var t = [], r = 0, i; for (i in n) t[r++] = n[i]; return t }; r.prototype.getDisplay = function (t, i, r) { if (t == null) return ""; var u = i ? this.getFromList(t) : this.get(t); return u == null ? "<" + t.toString() + ">" : r ? u.Name : n.Utility.Util.getIdentifierDisplayVal(u.Name) }; r.prototype.getLovIconType = function (n) { var t = this.lookup[" " + n]; if (t) return t.icoType }; r.prototype.getLOVIconElement = function (t, i, r) { var o = this.lookup[" " + t], u, f, e; if (o && (u = o.ico, f = o.icohtml, f = f ? " style='" + f + "'" : "", u)) return u.indexOf(" ") > -1 ? r ? u : "<i class='" + u + "'" + f + "><\/i>" : (e = u.substring(u.indexOf("Images/") + 7), e = n.Application.contextUrl + "Images/Thumb32x32/" + e, r ? e : "<img src='" + e + "'" + f + "><\/img>") }; r.prototype.getLOVIconStyle = function (n) { var t = this.lookup[" " + n]; if (t) return t.icohtml }; r.prototype.get = function (i) { var r, u; return i == null || this.MINUS_ONE === i ? null : (this.info.isParent && this.nextRead < Date.now() && (this.nextRead = Date.now() + 2e3), r = this.lookup[" " + i], r) ? r : (!this.info.isParent && this.info.isValidated && this.allLoaded && this.getDirect(i, !1, !0), !this.allLoaded && t.isEmptyObject(this.lookup) && !this.info.isCreadedUpdatedBy && !this.info.isParent && this.getDisplayType() != n.DisplayType.Search && (this.load(), r = this.lookup[" " + i], r != null)) ? r : (u = !0, this.getDirect(i, !1, u)) }; r.prototype.getFromList = function (i) { var r, u; return i == null || this.MINUS_ONE === i ? null : this.info.isParent && this.nextRead < Date.now() ? (this.nextRead = Date.now() + 2e3, this.get(i)) : (r = this.lookup[" " + i], r != null) ? r : (!this.info.isParent && this.info.isValidated && this.allLoaded && this.getDirectFromList(i, !1, !0), !this.allLoaded && t.isEmptyObject(this.lookup) && !this.info.isCreadedUpdatedBy && !this.info.isParent && this.getDisplayType() != n.DisplayType.Search && (r = this.lookup[" " + i], r != null)) ? r : (u = this.info.isValidated, this.getDirectFromList(i, !1, u)) }; r.prototype.getDirect = function (t, i, r) { var u, s, h, o, f, e, w, c, l, a, y; if (t == null || this.info.queryDirect == null || this.info.queryDirect.length == 0 || t === this.directNullKey) return null; if (u = null, this.lookupDirect != null && (u = this.lookupDirect[t], u)) return u; s = this.info.keyColumn.toUpperCase().endsWith("_ID"); try { h = this.info.queryDirect; o = []; s ? o.push(new v.SqlParam("@key", parseInt(t))) : o.push(new v.SqlParam("@key", t.toString())); f = p(h, o); f.read() ? (e = f.getString(2), w = f.getString(3).equals("Y"), w || (e = this.INACTIVE_S + e + this.INACTIVE_E, this.hasInactive = !0), s ? (c = f.getInt(0), l = { Key: c, Name: n.Utility.encodeText(e) }, i && (this.lookup[" " + c] = l), u = l) : (a = f.getString(1), y = { Key: a, Name: n.Utility.encodeText(e) }, i && (this.lookup[" " + a] = y), u = y), f.read() && this.log.log(n.Logging.Level.SEVERE, this.info.keyColumn + ": Not unique (first returned) for " + t + " SQL=" + h)) : (this.directNullKey = t, u = null) } catch (b) { this.log.log(n.Logging.Level.SEVERE, this.info.keyColumn + ": SQL=" + this.info.queryDirect + "; Key=" + t, b); u = null } finally { f != null && f.dispose(); f = null } return r && !i && u != null && (this.lookupDirect == null && (this.lookupDirect = {}), this.lookupDirect[t] = u), this.hasInactive = !0, u }; r.prototype.getDirectFromList = function (t, i, r) { var u, f, o, s, e, h; return t == null || this.info.queryDirect == null || this.info.queryDirect.length == 0 ? null : t === this.directNullKey ? null : (u = null, this.lookupDirect != null && (f = null, f = this.lookupDirect[" " + t], f && f != null)) ? f : (this.lookupDirectAll[" " + t] || (s = this.getFieldColName(), e = n.MLookupCache.getRecordLookup(this.getWindowNo(), this.getTabNo(), s, t), (e || !e && t == 0) && (h = { Key: t, Name: n.Utility.encodeText(e) }, this.lookupDirectAll[" " + t] = h)), this.lookupDirectAll[" " + t] ? (o = this.lookupDirectAll[" " + t], i && (this.lookup[" " + t] = o), u = o) : this.loading || (this.addInList(t), u = null), r && !i && u != null && (this.lookupDirect == null && (this.lookupDirect = {}), this.lookupDirect[" " + t] = u), this.hasInactive = !0, u) }; r.prototype.addInList = function (t) { var f, i; if (!(this.info.queryDirect.length <= 0) && t != null) { var u = this.info.keyColumn.toUpperCase().endsWith("_ID"), e = this.info.queryDirect, r = []; u ? r.push(new v.SqlParam("@key", parseInt(t))) : r.push(new v.SqlParam("@key", t.toString())); f = this.info.queryDirect; i = this; p(f, r, function (r) { var f, e, o; try { r.read() ? (f = r.getString(2), u ? (e = n.Utility.Util.getValueOfInt(r.getCell(0)), i.lookupDirectAll[" " + e] = { Key: e, Name: n.Utility.encodeText(f) }) : (o = r.getString(1), i.lookupDirectAll[" " + o] = { Key: o, Name: n.Utility.encodeText(f) })) : i.directNullKey = t } catch (s) { console.log(s) } i = null }) } }; r.prototype.load = function (t, i) { var r = this.info.query, e, s, f, u; if (!this.info.isValidated) { if (e = n.Env.parseContext(n.context, this.getWindowNo(), this.getTabNo(), this.info.validationCode, !1, !0), e.length == 0 && this.info.validationCode.length > 0) { this.log.fine(this.info.keyColumn + ": Loader NOT Validated: " + this.info.validationCode); return } var c = r.lastIndexOf(" FROM "), h = r.indexOf(" WHERE ", c) != -1, o = r.lastIndexOf(" ORDER BY "); o != -1 ? r = r.substring(0, o) + (h ? " AND " : " WHERE ") + e + r.substring(o) : r += (h ? " AND " : " WHERE ") + e; this.log.fine(this.info.keyColumn + ": Validation=" + e) } if (s = this.info.keyColumn.toUpperCase().endsWith("_ID"), this.hasInactive = !1, f = null, this.lookup = {}, i && (this.cLookup = !1, n.MLookupCache.loadFromCache(this.info, this))) return this; if (t) return u = this, u.loading = !0, b(r, 1, 1e3, null, function (t) { u.readData(t, s); i && n.MLookupCache.loadEnd(u.info, u); u.loading = !1; u = null }), 0; try { f = p(r, null); this.readData(f, s); i && n.MLookupCache.loadEnd(this.info, this) } catch (l) { this.log.log(n.Logging.Level.SEVERE, this.info.keyColumn + ": Loader - " + r, l) } finally { f != null && (f.dispose(), f = null) } return 0 }; r.prototype.fillDirectList = function () { var i, t; this.info.queryAll == null || this.info.queryAll.length <= 0 || (i = this.info.queryAll, this.cLookup = !0, n.MLookupCache.loadFromCache(this.info, this)) || (t = this, b(i, 1, 100, null, function (i) { var e, r, u, f; try { for (e = t.info.keyColumn.endsWith("_ID"); i.read();)r = i.getString(2), e ? (u = i.getInt(0), t.lookupDirectAll[" " + u] = { Key: u, Name: n.Utility.encodeText(r) }) : (f = i.getString(1), t.lookupDirectAll[" " + f] = { Key: f, Name: n.Utility.encodeText(r) }) } catch (o) { console.log(o) } n.MLookupCache.loadEnd(t.info, t); t.loading = !1; t = null }), this.loading = !0) }; r.prototype.readData = function (t, i) { var s = {}, h = 0, f, o; for (this.allLoaded = !0; t.read();) { if (h++ > this.MAX_ROWS) { this.log.fine(this.info.keyColumn + ": Loader - Too many records"); this.allLoaded = !1; break } var e = t.getString(2), c = t.getString(3).equals("Y"), r = {}, u; c || (e = this.INACTIVE_S + e + this.INACTIVE_E, this.hasInactive = !0); i ? (u = t.getInt(0), r = { Key: u, Name: n.Utility.encodeText(e) }) : (u = t.getString(1), r = { Key: u, Name: n.Utility.encodeText(e) }); t.tables[0].columns.length > 4 && (f = t.getString(4), f && f.length > 0 ? (o = f.split("|"), r.ico = o[0], r.icohtml = o[1]) : r.ico = f, r.icoType = t.getString(5)); s[" " + u] = r } this.lookup = null; this.lookup = s; this.loading = !1 }; r.prototype.refresh = function () { if (this.getDisplayType() == n.DisplayType.Search || this.info.IsCreadedUpdatedBy || this.loading) return 0; return this.load() }; r.prototype.clear = function () { this.$super.clear.call(this); this.lookup = {} }; r.prototype.getCLookup = function () { return this.cLookup && this.lookupDirectAll, this.lookup }; r.prototype.setCLookup = function (n) { this.cLookup && (this.lookupDirectAll = n); this.lookup = n }; r.prototype.getIsLoading = function () { return this.loading }; r.prototype.setIsLoading = function (n) { this.loading = n }; r.prototype.getZoomWindow = function () { if (arguments.length == 0) return this.info.zoomWindow; var t = arguments[0]; return n.ZoomTarget.getZoomAD_Window_ID(this.info.tableName, this.windowNo, t.getWhereClause(), n.context.isSOTrx(this.windowNo)) }; r.prototype.getZoomQuery = function () { return this.zomQuery }; r.prototype.getAD_Reference_Value_ID = function () { return this.info.AD_Reference_Value_ID }; r.prototype.gethasImageIdentifier = function () { return this.info.hasImageIdentifier }; r.prototype.disableValidation = function () { var t = this.info.validationCode; this.$super.disableValidation.call(this); this.info.isValidated = !0; this.info.validationCode = ""; t != null && t.length > 0 && (t.indexOf("@") != -1 && this.getDisplayType() == n.DisplayType.Table || this.getDisplayType() == n.DisplayType.TableDir) && this.setDisplayType(n.DisplayType.Search) }; r.prototype.dispose = function () { this.$super.dispose.call(this); this.lookupDirect = null; this.directNullKey = null; this.log = null }; n.Utility.inheritPrototype(f, i); f.prototype.cacheLookup = null; f.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.getLocation(n, null); return t == null ? "<" + n.toString() + ">" : t.Name }; f.prototype.get = function (n) { if (n == null) return null; var t = this.getLocation(n, null); return t == null ? null : t }; f.prototype.getColumnName = function () { return "C_Location_ID" }; f.prototype.getLocation = function (t, i) { var r, u; if (t == null) return null; if (i) { if (t in this.lstLatLng) return this.lstLatLng[t] } else if (t in this.lookup) return this.lookup[t]; return n.context.getLocationBulkReload() ? (r = n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocation", { id: t }), this.lookup[t] = r.LocItem, this.lstLatLng[t] = r.LocLatLng, !i) ? r.LocItem : r.LocLatLng : (u = this, n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocation", { id: t }, function (n) { t in u.lookup || (u.lookup[t] = n.LocItem, u.lstLatLng[t] = n.LocLatLng) }), null) }; f.prototype.refreshLocation = function (t) { if (t == null) return null; var i = n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocation", { id: t }); return this.lookup[t] = i.LocItem, this.lstLatLng[t] = i.LocLatLng, i }; f.prototype.load = function () { var t = this; if (t.lstLatLng = {}, f.prototype.cacheLookup != null) { t.lookup = f.prototype.cacheLookup.LocLookup; t.lstLatLng = f.prototype.cacheLookup.LocLatLng; t = null; return } n.dataContext.getJSONData(n.Application.contextUrl + "Location/GetLocations", "", function (n) { f.prototype.cacheLookup || (f.prototype.cacheLookup = n); t.lookup = n.LocLookup; t.lstLatLng = n.LocLatLng; t = null }) }; f.prototype.getLatLng = function (n) { if (n == null || n.toString().len < 1) return null; if (n in this.lstLatLng) return this.lstLatLng[n]; return this.getLocation(n, !0) }; f.prototype.dispose = function () { this.lstLatLng = null; this.$super.dispose.call(this); this.lookup = null }; n.Utility.inheritPrototype(u, i); u.prototype.getDefault = function () { return this.defaultID }; u.prototype.getOnlyOrgID = function () { return this.OnlyOrgID }; u.prototype.getOnlyWarehouseID = function () { return this.onlyWarehouseID }; u.prototype.getOnlyProductId = function () { return this.onlyProductID }; u.prototype.getIsOnlyOutgoing = function () { return this.onlyOutgoing }; u.prototype.setOnlyOrgID = function (n) { this.OnlyOrgID = n }; u.prototype.setOnlyWarehouseID = function (n) { this.onlyWarehouseID = n }; u.prototype.setOnlyProductID = function (n) { this.onlyProductID = n }; u.prototype.setOnlyOutgoing = function (n) { this.onlyOutgoing = n }; u.prototype.getDirect = function (t, i) { var s, u, r, f, e; if (t == null) return null; if (s = "VIS_92", u = [], u[0] = new n.DB.SqlParam("@keyValue", t), r = o(s, u), f = "", r.read()) f = r.getString(0); else return null; return r.dispose(), e = { Key: t, Name: n.Utility.encodeText(f) }, i && (this.lookup[" " + t] = e), e }; u.prototype.getIsValid = function (n) { if (n == null) return !0; var t = this.lookup[n]; return t != null }; u.prototype.load = function (i) { var o = 0, c = this.getOnlyOrgID(), l = this.getOnlyWarehouseID(), a = this.getOnlyProductId(), s = this.getIsOnlyOutgoing(), h = "Value, LocatorCombination, M_Warehouse_ID, (SELECT Name FROM M_Warehouse WHERE M_Warehouse_ID = M_Locator.M_Warehouse_ID) AS Warehouse", r, f, v, u, y, e; try { } catch (p) { this.log.log(n.Logging.Level.SEVERE, sql, p); h = "Value" } this.lookup = null; this.lookup = {}; s = s != null && s.value ? !1 : !0; try { if (r = null, i) { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetWareProWiseLocator", data: { colName: h, orgId: c, warehouseId: l, productId: a, onlyIsSOTrx: s }, success: function (t) { r = (new n.DB.DataSet).toJson(t) } }), f = r.getTable(0), v = f.getRows().length, u = 0; u < v; u++) { if (o++ > this.maxRows) { this.log.warning("Over Max Rows - " + o); break } y = n.Utility.Util.getValueOfString(f.getRow(u).getCell(4)) + "_" + n.Utility.Util.getValueOfString(f.getRow(u).getCell(1)) + "(" + n.Utility.Util.getValueOfString(f.getRow(u).getCell(2)) + ")"; this.lookup[f.getRow(u).getCell(0)] = { Key: f.getRow(u).getCell(0), Name: y } } r.dispose(); r = null; this.log.fine("Complete #" + o) } else e = this, t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/GetWareProWiseLocator", data: { colName: h, orgId: c, warehouseId: l, productId: a, onlyIsSOTrx: s }, success: function (t) { var u, f, i; r = (new n.DB.DataSet).toJson(t); try { for (u = r.getTable(0), f = u.getRows().length, i = 0; i < f; i++) { if (o++ > e.maxRows) { e.log.warning("Over Max Rows - " + o); break } e.lookup[u.getRow(i).getCell(0)] = { Key: u.getRow(i).getCell(0), Name: n.Utility.Util.getValueOfString(u.getRow(i).getCell(1)) } } r.dispose(); r = null; e.log.fine("Complete #" + o) } catch (s) { e.log(n.Logging.Level.SEVERE, "", s) } e = null } }) } catch (w) { this.log.log(n.Logging.Level.SEVERE, finalSql, w) } i && t.isEmptyObject(this.lookup) && this.log.Finer(finalSql) }; u.prototype.get = function (n) { if (n == null) return null; var i = Number(n), t = this.lookup[i]; return t != null ? t : this.getDirect(n, !0, null) }; u.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; u.prototype.getData = function () { var n = this.lookup; return t.map(this.lookup, function (n) { return n }) }; u.prototype.refresh = function () { this.log.fine("start"); try { this.load(!0) } catch (n) { this.log.severe("#" + this.lookup.Count) } return this.log.info("#" + this.lookup.Count), this.lookup.length }; u.prototype.getColumnName = function () { return "M_Locator.M_Locator_ID" }; u.prototype.getZoomWindow = function () { if (arguments.length == 0) return this.info.zoomWindow; var t = arguments[0]; return n.ZoomTarget.getZoomAD_Window_ID("M_Locator", this.windowNo, t.getWhereClause(), n.context.isSOTrx(this.windowNo)) }; u.prototype.dispose = function () { this.disposeLocal(); this.$super.dispose.call(this); this.lookupDirect = null; this.directNullKey = null; this.log = null; this.disposeLocal = null }; n.Utility.inheritPrototype(s, i); s.prototype.getDisplay = function (n) { return this.containsKey(n) ? this.toStringX() : "<" + n.toString() + ">" }; s.prototype.toStringX = function () { return this.C_ValidCombination_ID == 0 ? "" : this.combination }; s.prototype.containsKey = function (n) { var t = 0; return n != null && (t = parseInt(n.toString())), this.load(t) }; s.prototype.load = function (t) { var i, u, f, r, e; return t == 0 ? (this.C_ValidCombination_ID = 0, this.combination = "", this.description = "", !0) : t == this.C_ValidCombination_ID ? !0 : (i = this.lst[t], i) ? (this.C_ValidCombination_ID = t, this.combination = i.C, this.description = i.D, !0) : (u = n.MLookupCache.getRecordLookup(this.getWindowNo(), this.getTabNo(), "c_validcombination_id", t), u) ? (i = { C: u, D: "-" }, this.C_ValidCombination_ID = t, this.combination = i.C, this.description = i.D, this.lst[t] = i, !0) : (f = "VIS_94", r = [], r[0] = new n.DB.SqlParam("@ID", t), e = this, o(f, r, function (n) { var n = null; try { if (n = o(f, r), !n.read()) return !1; e.lst[n.getInt(0)] = { C: n.getString(1), D: n.getString(2) } } catch (t) { return !1 } }), !1) }; s.prototype.getColumnName = function () { return "" }; s.prototype.getData = function (i, r, u) { var o = [], f; i || o.push({ Key: -1, Name: "" }); f = null; try { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetValidAccountCombination", data: { AD_Client_ID: AD_Client_ID, onlyActive: u }, success: function () { f = (new n.DB.DataReader).toJson(jString) } }); f.read();)o.push({ Key: f.getInt(0), Name: f.getString(1) + " - " + f.getString(2) }) } catch (s) { this.log.log(e.SEVERE, sql, s) } return o }; n.Utility.inheritPrototype(a, i); a.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; a.prototype.get = function (t) { var i, r, f, u; if (t == null) return null; if (i = 0, t instanceof Number) i = t; else try { i = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (i == 0) return this.NO_INSTANCE; r = null; try { f = []; f[0] = new n.DB.SqlParam("@M_AttributeSetInstance_ID", i); u = o("VIS_95", f); u.read() && (r = u.getString(0), (r == null || r.length == 0) && (r = n.Logging.VLogMgt.getIsLevelFine() ? "{" + i + "}" : "")); u.dispose(); u = null } catch (s) { this.log.log(e.SEVERE, "get", s) } return r == null ? null : { Key: i, Name: r } }; a.prototype.getColumnName = function () { return "M_AttributeSetInstance_ID" }; a.prototype.dispose = function () { this.$super.dispose.call(this); this.NO_INSTANCE = null; this.log = null }; n.Utility.inheritPrototype(c, i); c.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; c.prototype.get = function (t) { var i, r, f, u; if (t == null) return null; if (i = 0, t instanceof Number) i = t; else try { i = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (i == 0) return this.NO_INSTANCE; r = null; try { f = []; f[0] = new n.DB.SqlParam("@C_GenttributeSetInstance_ID", i); u = o("VIS_96", f); u.read() && (r = u.getString(0), (r == null || r.length == 0) && (r = n.Logging.VLogMgt.getIsLevelFine() ? "{" + i + "}" : "")); u.dispose(); u = null } catch (s) { this.log.log(e.SEVERE, "get", s) } return r == null ? null : { Key: i, Name: r } }; c.prototype.getColumnName = function () { return "C_GenAttributeSetInstance_ID" }; c.prototype.dispose = function () { this.$super.dispose.call(this); this.NO_INSTANCE = null; this.log = null }; c.prototype.getData = function (i, r, u) { var o = [], f; i || o.push({ Key: -1, Name: "" }); f = null; try { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GenAttributeSetInstance", data: { C_GenAttributeSet_ID: n.Env.getCtx().getContextAsInt(this.windowNo, "C_GenAttributeSet_ID"), onlyActive: u }, success: function () { f = (new n.DB.DataReader).toJson(jString) } }); f.read();)o.push({ Key: f.getInt(0), Name: f.getString(1) + " - " + f.getString(2) }) } catch (s) { this.log.log(e.SEVERE, sql, s) } return o }; n.MLookupFactory = { get: function (t, i, r, u, f, e, o, s) { var c = { ctx: t.getWindowCtx(i), windowNo: i, column_ID: r, AD_Reference_ID: u, columnName: f, AD_Reference_Value_ID: e, isParent: o, validationCode: s }, h = n.dataContext.getJSONData(n.Application.contextUrl + "JsonData/GetLookup", c); return new n.MLookup(h._vInfo, h) }, getMLookUp: function (t, i, r, u) { var s = "", h = 0, c = !1, l = "", f = null, e; try { e = []; e[0] = new n.DB.SqlParam("@Column_ID", r); f = o("VIS_97".toString(), e, null); f.read() && (s = f.getString(0), h = f.getInt(1), c = "Y".equals(f.getString(2)), l = f.getString(3)); f.close(); f = null } catch (a) { f != null && (f.close(), f = null) } return n.MLookupFactory.get(t, i, r, u, s, h, c, l) }, GetLookUpInfo: function (n, t, i, r, u, f, e, o) { var s = { WindowNum: t, AD_Reference_ID: i, Column_ID: r, columnName: u, AD_Reference_Value_ID: f, IsParent: e, ValidationCode: o } }, getLookup_TableDirEmbed: function (t, i, r, u) { var h = i.substring(0, i.length - 3), l = [], a = [], s, f, c, e; a[0] = new n.DB.SqlParam("@tableName", h); try { for (s = o("VIS_98", a); s.read();)l.push({ ColumnName: s.getString(0), IsTranslated: s.getString(1), DisplayType: s.getInt(2), AD_Reference_Value_ID: s.getInt(3) }); s.close(); s = null } catch (v) { return "" } if (l.length == 0) return ""; for (f = "SELECT ", c = 0; c < l.length; c++)c > 0 && (f = f.concat("||' - '||")), e = l[c], n.DisplayType.IsDate(e.DisplayType) || n.DisplayType.IsNumeric(e.DisplayType) ? f = f.concat(n.DB.to_char(h + "." + e.ColumnName, e.DisplayType, n.Env.getAD_Language(n.Env.getCtx()))) : (e.DisplayType == n.DisplayType.TableDir || e.DisplayType == n.DisplayType.Search) && e.ColumnName.endsWith("_ID") ? alert("TableDir") : f = f.concat(h).concat(".").concat(e.ColumnName); return f = f.concat(" FROM ").concat(h), f = f.concat(" WHERE ").concat(r).concat(".").concat(u), f = f.concat("=").concat(h).concat(".").concat(i), f.toString() } }; n.MLookupCache = { s_log: n.Logging.VLogger.getVLogger("MLookupCache"), s_loadedLookups: new n.CCache("MLookupCache"), s_sentLookups: new n.CCache("MLookupCacheSent"), s_windowLookup: {}, s_windowRecordLookup: {}, getKey: function (t) { if (t == null) return n.Env.currentTimeMillis(); var i = t.windowNo + ":"; return i + (":" + t.keyColumn + t.AD_Reference_Value_ID + t.query + t.validationCode) }, loadFromCache: function (n, i) { var u = this.getKey(n), f = null, r = !0; return this.s_loadedLookups.contains(u) && (f = this.s_loadedLookups.get(u)), f == null && (r = !1), r && t.isEmptyObject(f) && (this.s_loadedLookups.remove(u), r = !1), r && (i.setCLookup(jQuery.extend({}, f)), i.setIsLoading(!1)), r || (r = !0, this.s_sentLookups.contains(u) ? this.s_sentLookups.get(u).indexOf(i) == -1 && (i.setIsLoading(!0), this.s_sentLookups.get(u).push(i)) : (this.s_sentLookups.add(u, []), r = !1)), r }, loadEnd: function (n, i) { var f = this.getKey(n), o, e, r, u; if (i.getCLookup() && !t.isEmptyObject(i.getCLookup())) { if (this.s_loadedLookups.add(f, i.getCLookup()), this.s_sentLookups.contains(f)) { for (r = this.s_sentLookups.get(f), r.length > 0 && (o = ""), u = 0; u < r.length; u++)e = r[u], e.setCLookup(t.extend({}, i.getCLookup())), e.setIsLoading(!1); r.length = 0; this.s_sentLookups.remove(f) } } else if (this.s_sentLookups.contains(f)) { for (r = this.s_sentLookups.get(f), u = 0; u < r.length; u++)r[u].setIsLoading(!1); r.length = 0; this.s_sentLookups.remove(f) } }, cacheReset: function (n) { for (var e = n.toString() + ":", c = this.s_loadedLookups.size(), u = [], i, s, r, h, f, t = 0, o = this.s_loadedLookups.m_cacheK.length; t < o; t++) { i = this.s_loadedLookups.m_cacheK[t]; try { i != null && i.startsWith(e) && u.push(i) } catch (l) { s = "" } } for (r = 0; r < u.length; r++)this.s_loadedLookups.remove(u[r]); h = this.s_loadedLookups.size(); for (f in this.s_windowRecordLookup) f.startsWith(e) && delete this.s_windowRecordLookup[f] }, addWindowLookup: function (n, t) { if (this.s_windowLookup[n]) this.s_windowLookup[n].push(t); else { var i = []; i.push(t); this.s_windowLookup[n] = i } }, initWindowLookup: function (n) { var t, i, r; if (this.s_windowLookup[n]) { for (t = this.s_windowLookup[n], i = 0, r = t.length; i < r; i++)t[i].initialize(); t.length = 0; delete this.s_windowLookup[n] } }, addRecordLookup: function (n, t, i) { var r = n + ":" + t; this.s_windowRecordLookup[r] = i }, getRecordLookup: function (n, t, i, r) { var u = this.s_windowRecordLookup[n + ":" + t]; return u && i in u ? u[i][r] : null } }; n.Utility.inheritPrototype(h, i); h.prototype.cacheLookup = null; h.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t }; h.prototype.get = function (t) { var i, r, f, u; if (t == null) return null; if (i = 0, t instanceof Number) i = t; else try { i = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (i in this.lookup) return this.lookup[i]; if (i == 0) return this.NO_INSTANCE; r = null; try { f = []; f[0] = new n.DB.SqlParam("@C_DimAmt_ID", i); u = o("VIS_99", f); u.read() && (r = u.getString(0), (r == null || r.length == 0) && (r = n.Logging.VLogMgt.getIsLevelFine() ? "{" + i + "}" : "")); u.dispose(); u = null; this.lookup[i] = r } catch (s) { this.log.log(e.SEVERE, "get", s) } return r == null ? null : r }; h.prototype.getColumnName = function () { return "C_DimAmt_ID" }; h.prototype.refreshAmountDivision = function (t) { var r, i, f, u; if (t == null) return null; if (r = 0, t instanceof Number) r = t; else try { r = parseInt(t.toString()) } catch (s) { this.log.log(e.SEVERE, "Value=" + t, s) } if (r == 0) return this.NO_INSTANCE; i = null; try { f = []; f[0] = new n.DB.SqlParam("@C_DimAmt_ID", r); u = o("VIS_99", f); u.read() && (i = u.getString(0), (i == null || i.length == 0) && (i = n.Logging.VLogMgt.getIsLevelFine() ? "{" + r + "}" : "")); u.dispose(); u = null; this.lookup[r] = i } catch (s) { this.log.log(e.SEVERE, "get", s) } return i == null ? null : i }; h.prototype.dispose = function () { this.lstLatLng = null; this.$super.dispose.call(this); this.lookup = null }; n.Utility.inheritPrototype(l, i); l.prototype.cacheLookup = null; l.prototype.getDisplay = function (n) { if (n == null) return ""; var t = this.get(n); return t == null ? "<" + n.toString() + ">" : t.Name }; l.prototype.get = function (i) { var r, u; if (i == null) return null; if (r = 0, i instanceof Number) r = i; else try { r = parseInt(i.toString()) } catch (f) { this.log.log(e.SEVERE, "Value=" + i, f) } return r in this.lookup ? this.lookup[r] : r == 0 ? this.NO_INSTANCE : (u = null, t.ajax({ url: y + "ProductContainer/GetProductContainerInfo", data: { ID: r }, async: !1, success: function (t) { u = t ? t : n.Logging.VLogMgt.getIsLevelFine() ? "{" + r + "}" : "" }, error: function (n) { this.log.log(e.SEVERE, "get", n) } }), this.lookup[r] = u, u == null) ? null : { Key: r, Name: u } }; l.prototype.getColumnName = function () { return "M_ProductContainer_ID" }; l.prototype.dispose = function () { this.lstLatLng = null; this.$super.dispose.call(this); this.lookup = null }; n.MLookup = r; n.MLocationLookup = f; n.MAccountLookup = s; n.MPAttributeLookup = a; n.MGAttributeLookup = c; n.MLocatorLookup = u; n.MAmtDivLookup = h; n.MProductContainerLookup = l }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function ct() { c = t("<table style='width:100%;height:100%'><tr><td style='height:100%'><div class='vis-css-treewindow' ><\/td><\/tr><tr><td style='text-align:center'><div class='vis-tree-search'><div class='input-group'><input type='text' class='form-control ui-autocomplete-input' placeholder='Search'>  <span class='input-group-append'><button class='input-group-text'><a href='#' class='vis vis-search'><\/a><\/button><\/span><\/div><\/div><\/td><\/tr><\/table>"); h = c.find(".vis-css-treewindow"); h.css({ "max-width": "290px" }); ot = c.find(".vis-tree-search"); tt = c.find(".input-group-addon"); it = c.find("input"); a = t("<ul class='vis-apanel-rb-ul'>"); w = t("<li data-action='Copy'>").text(n.Msg.getMsg("Copy")); b = t("<li data-action='Move'>").text(n.Msg.getMsg("Move")); k = t("<li data-action='Cancel'>").text(n.Msg.getMsg("Cancel")); a.append(w); o.onDemandTree && (d = t("<li data-action='MoveHere'>").text(n.Msg.getMsg("MoveHere")), a.append(d)); a.append(b).append(k) } function lt() { var h, u, i, e; if (s != null && l != null && s.data("value") != l.data("value")) { h = s.parent(); s.remove(); var a = h.parent().data("value"), o = null, r = l, c = 0; l.data("summary") != "Y" ? (r = l.parent(), c = l.index(), s.insertAfter(r.children()[c]), o = r.parent().data("value")) : (u = r.find(">ul"), u.children().length > 0 ? s.insertBefore(u.children()[c]) : s.appendTo(u), o = r.data("value"), r = u); for (var f = h.children(), i = 0, v = [], p = [], i = 0; i < f.length; i++)e = t(f[i]), v.push(e.data("value")); if (a != o) for (f = r.children(), i = 0; i < f.length; i++)e = t(f[i]), p.push(e.data("value")); t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/UpdateTree", data: { oldParentChildren: JSON.stringify(v), newParentChildren: JSON.stringify(p), oldId: a, newId: o, AD_Tree_ID: y, tableName: rt }, success: function (n) { console.log(n) }, error: function () { } }) } } function at() { g.length = 0; nt.length = 0; h.find("LI").each(function (n, i) { var r = t(i), u = r.find(">label"); u.length < 1 && (u = r.find(">A")); g.push(r.data("value")); nt.push(u.text()) }) } function et() { var i = it.val(), n, t; if (i == null || i.length < 2) { o.searchNode = !1; return } n = o.containsTextInArray(nt, i, ut); n > -1 ? (t = g[n], o.currentNode = t, ut = n, o.setSelectedNode(t), o.selectionChangeListner ? o.selectionChangeListner.nodeSelectionChanged({ newValue: t, propertyName: "" }) : o.searchNode = !1) : o.searchNode = !1 } var o; this.selectionChangeListner = null; this.windowNo = i; var rt = "", p = null, g = [], nt = [], ut = -1, v = null, s = null, l = null, y = 0, ft = 0; this.onDemandTree = f; this.currentNode = 0; this.searchNode = !1; this.gc = e; var o = this, c = null, h = null, ot = null, tt = null, it = null, a = null, w, b, k, d, st = n.Application.contextUrl, ht = st + "JsonData/ExecuteNonQuer", vt = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n.join("/"), param: i }; return t.ajax({ url: ht + "ies", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }; ct(); o = this; this.setSize = function (n) { h.height(n - 40) }; this.setTabID = function (n) { ft = n }; this.initTree = function (r) { y = r; (this.onDemandTree == "undefined" || this.onDemandTree == null) && (this.onDemandTree = !1); var f = { AD_Tree_ID: y, editable: u, windowNo: i, onDemandTree: this.onDemandTree, AD_Tab_ID: ft }; y = y; n.dataContext.getTreeAsString(f, function (n) { var i, r; h.html(n); at(); p = h.find(">ul"); rt = p.data("tablename"); p = p.find(">li>ul"); o.onDemandTree && h && (i = h.find("ul"), i && i.length > 1 && (r = t(i.find("ul")[0]).children(), r && r.length > 0 && !o.gc.isZoomAction ? t(r[0]).trigger("click") : o.gc.isZoomAction || (o.gc.query(o.selectionChangeListner.aPanel.curTab.getOnlyCurrentDays(), 0, !1), o.selectionChangeListner.aPanel.setBusy(!1)))) }) }; this.getRoot = function () { return c }; h.on(n.Events.onClick, function (n) { var r, u, i, f; n.target.nodeName === "INPUT" || n.target.nodeName === "LI" || n.target.nodeName === "A" ? (r = t(n.target), n.target.nodeName === "INPUT" && (r = t(n.target.parentNode)), o.selectionChangeListner && (o.onDemandTree && (u = c.find("*.vis-css-treewindow-selected"), u.length > 0 && u.removeClass("vis-css-treewindow-selected"), i = t(t(n.target).parent()), i.find(">label").length > 0 ? i.find(">label").addClass("vis-css-treewindow-selected") : (i.find(">a").addClass("vis-css-treewindow-selected"), t(i.find("label")[0]).addClass("vis-css-treewindow-selected"))), o.selectionChangeListner.nodeSelectionChanged({ newValue: r.data("value"), propertyName: "" })), n.stopPropagation()) : n.target.nodeName === "SPAN" && (n.target.parentNode.nodeName == "SPAN" || n.target.parentNode.nodeName == "LI") && (f = t(n.target.parentNode), n.target.parentNode.nodeName === "SPAN" && (f = t(n.target.parentNode.parentNode)), v = f, w.hide(), k.hide(), b.hide(), o.onDemandTree && d.hide(), s != null ? (b.show(), k.show()) : (w.show(), o.onDemandTree && d.show()), t(n.target).w2overlay(a.clone(!0))) }); tt.on(n.Events.onTouchStartOrClick, function (n) { o.searchNode = !0; et(n) }); it.on("keydown", function (n) { n.keyCode == 13 && (o.searchNode = !0, et(n)) }); a.on(n.Events.onTouchStartOrClick, "LI", function (i) { var f = t(i.target).data("action"), r, e, h, c, u, a; if (f == "Copy") s = v; else if (f == "Move") l = v, lt(), s = null, l = null, v = null; else if (f == "MoveHere") { if (r = o.selectionChangeListner.vTable.getSelection(!0), e = "", o.selectionChangeListner.aPanel.setBusy(!0), r && r.length > 0) for (h = o.selectionChangeListner.vTable.grid, c = o.selectionChangeListner.getMTab().gridTable.keyColumnName.toLower(), u = 0; u < r.length; u++)e += u == 0 ? h.get(r[u] + 1)[c] : "," + h.get(r[u] + 1)[c]; a = { nodeID: e, oldParentID: 0, newParentID: v.data("value"), AD_Tree_ID: y }; t.ajax({ url: n.Application.contextUrl + "Tree/UpdateTree", dataType: "json", data: a, success: function (n) { var t = n; t > 0 && o.selectionChangeListner.removeRecord() }, error: function () { o.selectionChangeListner.aPanel.setBusy(!1) } }); v = null; s = null } else f == "Cancel" && (s = null, v = null) }); this.getRootNode = function () { return p }; this.disposeLocal = function () { h.off(n.Events.onClick); tt.off(n.Events.onTouchStartOrClick); a.off(n.Events.onTouchStartOrClick); a = null; h = null; c.remove(); c = null; o = null } } i.prototype.containsTextInArray = function (n, t, i) { for (var r = i + 1; r < n.length; r++)if (r != -1 && n[r].trim().toLowerCase().contains(t.trim().toLowerCase())) return r; return i > -1 ? (i = -1, this.containsTextInArray(n, t, i)) : -1 }; i.prototype.addSelectionChangeListner = function (n) { this.selectionChangeListner = n }; i.prototype.setSelectedNode = function (n) { return n != -1 ? this.selectID(n, !0) : (this.currentNode = 0, !1) }; i.prototype.selectID = function (n) { var r, t, u, f, i; if (!this.onDemandTree || this.searchNode) { if (this.currentNode = n, this.searchNode = !1, r = this.getRoot(), t = r.find("li[data-value='" + n + "']"), t != null && t.length > 0) { for (u = r.find("*.vis-css-treewindow-selected"), u.length > 0 && u.removeClass("vis-css-treewindow-selected"), t.find(">label").length > 0 ? t.find(">label").addClass("vis-css-treewindow-selected") : t.find(">a").addClass("vis-css-treewindow-selected"), f = t; t != null;)i = t.find("input"), i.length > 0 && (i.prop("checked") || i.prop("checked", !0)), t = t.parent(), t[0].nodeName == "UL" && (t = t.parent()), t[0].nodeName == "LI" || (t = null); return f[0].scrollIntoView(), !0 } return !1 } }; i.prototype.nodeChanged = function (n, i, r, u, f, e) { var c, l, y, s, a; if (console.log("Save=" + n + ", KeyID=" + i + ", Name=" + r + ", Description=" + u + ", IsSummary=" + f + ", ImageInd=" + e), i != 0) { var v = this.getRoot(), h = !1, o = v.find("li[data-value='" + i + "']"); o != null && o.length > 0 && (h = !0); !h && n ? this.onDemandTree ? (c = v.find("*.vis-css-treewindow-selected"), c && f && (l = t(c.parent()).find("ul"), l && l.length > 0 ? t(l[0]).append(this.getNode(i, r, u, f, e, this.windowNo)) : t(c.parent()).append(t("<ul>").append(this.getNode(i, r, u, f, e, this.windowNo))))) : (y = this.getRootNode(), y.append(this.getNode(i, r, u, f, e, this.windowNo))) : h && n ? (this.toggleTypeOfNode(o, f, i, this.windowNo, e), f && o.find(">ul").length == 0 && o.append(t("<ul>")), s = o.find(">label"), s && s.length != 0 || (s = o.find(">a")), s.length > 0 && s.text(r)) : h && !n ? (a = o.find(">ul"), a.length > 0 && (a.remove(), this.getRootNode().append(a.children())), o.remove()) : o = null; o == null } }; i.prototype.getNode = function (i, r, u, f, e, o) { r = n.Utility.encodeText(r); var s = '<li data-value="' + i + '"'; return s += f ? 'data-summary="Y" class="vis-hasSubMenu"> <input type="checkbox" id="' + o + i + '"><label for="' + o + i + '">' + r + '<\/label><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span><ul><ul>' : 'data-summary="N">  <img src="' + n.Application.contextUrl + "Areas/VIS/Images/login/" + this.getIcon(e) + '">  <a href="javascript:void(0)" data-value="' + i + '" data-action="' + e + '" data-actionid="' + i + '"> ' + r + '<\/a><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"> <\/span><\/span><\/li>', t(s) }; i.prototype.getIcon = function (n) { switch (n) { case "W": return "mWindow.png"; case "R": return "mReport.png"; case "P": return "mProcess.png"; case "F": return "mWorkflow.png"; case "B": return "mWorkbench.png"; case "X": return "mWindow.png"; case "V": return "mWindow.png"; case "D": return "mDocAction.png"; default: return "mWindow.png" } }; i.prototype.toggleTypeOfNode = function (t, i, r, u, f) { var h = t.data("summary") == "Y", o, e, s; i !== h ? (o = t.find(">ul"), o.remove(), t.data("summary", i ? "Y" : "N"), t.toggleClass("vis-hasSubMenu"), i ? t.html('<input type="checkbox" id="' + u + r + '"><label for="' + u + r + '">' + name + '<\/label><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span>') : t.html('<img src="' + n.Application.contextUrl + "Areas/VIS/Images/login/" + this.getIcon(f) + '">  <a href="javascript:void(0)" data-value="' + r + '" data-action="' + f + '" data-actionid="' + r + '"> ' + name + '<\/a><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"> <\/span><\/span>'), o.length > 0 && t.append(o)) : i || (e = t.find(">a"), e.length > 0 && (s = e.data("action"), e != f && (t.find(">img").attr("src", n.Application.contextUrl + "Areas/VIS/Images/login/" + this.getIcon(f)), e.data("action", f)), e = s = null)) }; i.prototype.dispose = function () { this.disposeLocal(); this.addPropertyChangeListner = null }; n.TreePanel = i }(VIS, jQuery), function (n, t) { function l(n, i, r) { var u = null; return t.ajax({ url: y, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function v(i, r, u) { var f = null; return i.sql = n.secureEngine.encrypt(i.sql), t.ajax({ url: w, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: r, data: JSON.stringify(i) }).done(function (n) { f = n; u && u(n) }), f } function f(t) { var i, r; for (this.vo = t._vo, this.tabs = [], i = 0; i < t._tabs.length; i++)r = new n.GridTab(t._tabs[i], this.vo), r.setGridWindow(this), this.tabs.push(r); t = null } function i(t, i) { this.gTab = t; this.vo = t._vo; this.gridTable = new n.GridTable(t._gridTable); this.gridTable.onlyCurrentDays = this.vo.onlyCurrentDays; this.gridTable.MaintainVerOnApproval = this.vo.MaintainVerOnApproval; this.gridTable.IsMaintainVersions = this.vo.IsMaintainVersions; this.parents = []; this.orderBys = []; this.depOnFieldColumn = []; this.depOnField = []; this.tabPanels = []; this.linkColumnName = t._linkColumnName; this.extendedWhere = t._extendedWhere; this.keyColumnName = ""; this.defaultFocusField; this.isThroughRoleCenter = !1; this.query = new n.Query; this.oldQuery = "0=9"; this.linkValue = "999999"; this.currentRow = -1; this.hasPanel = !1; this.isHeaderPanel = !1; this.headerPanel = null; this.isHPanelNotShowInMultiRow = !1; this.mDataStatusEvent; this.mDataListenerList = []; this.loadFields(); this.loadTabPanels(); this.loadHeaderPanelItems(); this.gridTable.addDataStatusListener(this); this.gridTable.setAD_Tab_ID(this.vo.AD_Tab_ID); this.log = n.Logging.VLogger.getVLogger("VIS.GridTab"); this.loadData(i); i = null; this.gridWindow = null; this.outerWhereCondition = null } function u(t) { this.gTable = t; this.readOnly = this.gTable._readOnly; this.AD_Table_ID = t._AD_Table_ID; this.deleteable = this.gTable._deleteable; this.gridFields = []; this.keyColumnName = ""; this.isOpen = !1; this.inserting = !1; this.SQL_Select = ""; this.SQL_Count = ""; this.SQL = ""; this.bufferList = []; this.defaultModel = {}; this.pazeSize = n.Env.getWINDOW_PAGE_SIZE(); this.newRow = -1; this.compareDB = !0; this.treeNode_ID = 0; this.treeTable_ID = 0; this.treeID = 0; this.selectedTreeNode = 0; this.ShowSummaryNodes = !1; this.isZoomAction = !1; this.currentPage; this.dopaging; t = null; this.mSortList; this.AD_Tab_ID = 0; this.log = n.Logging.VLogger.getVLogger("VIS.GridTable"); this.card_ID = 0 } function r(t) { this.gfield = t; this.vo = t._vo; this.vo.orginalDispaly = t._vo.displayType; this.oldValue; this.value; this.inserting; this.error; this.valueNoFire = !0; this.gridTab = null; var i = null; (this.vo.IsDisplayedf || this.vo.ColumnName.toLower().equals("createdby") || t._vo.ColumnName.toLower().equals("updatedby") || this.vo.IsHeaderPanelitem) && (t._vo.lookupInfo != null && n.DisplayType.IsLookup(t._vo.displayType) ? n.DisplayType.IsLookup(t._vo.displayType) && (i = new n.MLookup(t._vo.lookupInfo, t._lookup), this.vo.tabNo > 0 ? (i.initialize(!0), n.MLookupCache.addWindowLookup(this.vo.windowNo, i)) : i.initialize()) : t._vo.displayType == n.DisplayType.Location ? i = new n.MLocationLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.Locator ? i = new n.MLocatorLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.Account ? (i = new n.MAccountLookup(n.context, t._vo.windowNo), i.setTabNo(this.vo.tabNo)) : t._vo.displayType == n.DisplayType.PAttribute ? i = new n.MPAttributeLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.GAttribute ? i = new n.MGAttributeLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.AmtDimension ? i = new n.MAmtDivLookup(n.context, t._vo.windowNo) : t._vo.displayType == n.DisplayType.ProductContainer && (i = new n.MProductContainerLookup(n.context, t._vo.windowNo))); this.lookup = i; this.propertyChangeListner; this.log = n.Logging.VLogger.getVLogger("VIS.GridField"); t = null } function s(n) { this.tPanel = n; this.vo = n._vo } function e(t, i, r, u, f) { this.mTotalPage = 1; this.mCurrentPage = 1; this.mPageSize = n.Env.getWINDOW_PAGE_SIZE(); this.totalRecords = 1; this.m_totalRows = i; this.m_changed = r; this.m_autoSave = u; this.m_inserting = f; this.m_AD_Message; this.m_info = null; this.m_isError = !1; this.m_isWarning = !1; this.m_confirmed = !1; this.m_allLoaded = !0; this.m_loadedRows = -1; this.m_currentRow = -1; this.m_changedColumn = -1; this.m_columnName = null; this.Created; this.CreatedBy; this.Updated; this.UpdatedBy; this.Info; this.AD_Table_ID; this.Record_ID; this.source = t } var o = n.Logging.Level, c = n.Application.contextUrl, y = c + "JsonData/JDataSetWithCode", p = c + "JsonData/ExecuteNonQuer", w = c + "Form/JDataSet", h = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, l(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, b = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, l(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, d = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, l(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, g = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, v(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, a = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, v(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, nt = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n.join("/"), param: i }; return t.ajax({ url: p + "ies", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }; f.prototype.getTabs = function () { return this.tabs }; f.prototype.getTab = function (n) { return n < 0 || n + 1 > this.tabs.length ? null : this.tabs[n] }; f.prototype.getIsAppointment = function () { return this.vo.IsAppointment }; f.prototype.getIsTask = function () { return this.vo.IsTask }; f.prototype.getIsEmail = function () { return this.vo.IsEmail }; f.prototype.getIsLetter = function () { return this.vo.IsLetter }; f.prototype.getIsSms = function () { return this.vo.IsSms }; f.prototype.getIsChat = function () { return this.vo.IsChat }; f.prototype.getIsAttachment = function () { return this.vo.IsAttachment }; f.prototype.getIsHistory = function () { return this.vo.IsHistory }; f.prototype.getIsCheckRequest = function () { return this.vo.IsCheckRequest }; f.prototype.getIsCopyReocrd = function () { return this.vo.IsCopyReocrd }; f.prototype.getIsSubscribedRecord = function () { return this.vo.IsSubscribedRecord }; f.prototype.getIsZoomAcross = function () { return this.vo.IsZoomAcross }; f.prototype.getIsCreatedDocument = function () { return this.vo.IsCreatedDocument }; f.prototype.getIsUploadedDocument = function () { return this.vo.IsUploadedDocument }; f.prototype.getIsViewDocument = function () { return this.vo.IsViewDocument }; f.prototype.getIsAttachDocumentFrom = function () { return this.vo.IsAttachDocumentFrom }; f.prototype.getIsFaxEmail = function () { return this.vo.IsFaxEmail }; f.prototype.getIsMarkToExport = function () { return this.vo.IsMarkToExport }; f.prototype.getIsArchive = function () { return this.vo.IsArchive }; f.prototype.getIsImportMap = function () { return this.vo.IsImportMap }; f.prototype.getIsAttachmail = function () { return this.vo.IsAttachmail }; f.prototype.getIsRoleCenterView = function () { return this.vo.IsRoleCenterView }; f.prototype.getIsSOTrx = function () { return this.vo.IsSOTrx }; f.prototype.getIsTransaction = function () { return this.vo.IsTransaction }; f.prototype.getName = function () { return this.vo.Name }; f.prototype.getWindowWidth = function () { return this.vo.WinWidth }; f.prototype.getHasPanel = function () { return this.vo.hasPanel }; f.prototype.getFontName = function () { return this.vo.FontName }; f.prototype.getAD_Image_ID = function () { return this.vo.AD_Image_ID }; f.prototype.getImageUrl = function () { return this.vo.ImageUrl }; f.prototype.getIsCompositeView = function () { return this.vo.IsCompositeView }; f.prototype.dispose = function () { var n; for (originalLength = this.tabs.length, n = originalLength; n > 0; n--)gtab = this.tabs.pop(), gtab.dispose(), gtab = null; this.tabs.length = 0; this.vo = null; this.tabs = null }; i.prototype.setGridWindow = function (n) { this.gridWindow = n }; i.prototype.getParentTab = function () { var n = this.getParentTabNo(); return n < 0 || n == this.vo.tabNo ? null : this.gridWindow.getTab(n) }; i.prototype.getParentTabNo = function () { var t = this.vo.tabNo, i = this.vo.TabLevel, r = i - 1; if (r < 0) return t; while (r < i && t > 0) t--, i = n.context.getContextAsInt(this.vo.windowNo, t, "TabLevel"); return t }; i.prototype.getAD_Tab_ID = function () { return this.vo.AD_Tab_ID }; i.prototype.getAD_Window_ID = function () { return this.vo.AD_Window_ID }; i.prototype.getAD_Table_ID = function () { return this.vo.AD_Table_ID }; i.prototype.getTableName = function () { return this.vo.TableName }; i.prototype.getName = function () { return this.vo.Name }; i.prototype.getDescription = function () { return this.vo.Description }; i.prototype.getIsSortTab = function () { return this.vo.IsSortTab }; i.prototype.getDependentOn = function () { var t = []; return n.Evaluator.parseDepends(t, this.vo.DisplayLogic), t }; i.prototype.getTabLevel = function () { return this.vo.TabLevel }; i.prototype.getWindowNo = function () { return this.vo.windowNo }; i.prototype.getTabNo = function () { return this.vo.tabNo }; i.prototype.getIsSingleRow = function () { return this.vo.IsSingleRow }; i.prototype.getTabLayout = function () { return this.vo.TabLayout }; i.prototype.getNewRecordView = function () { return this.vo.NewRecordView }; i.prototype.getIsDisplayed = function (t) { var i = this.vo.DisplayLogic, r; return i == null || i.equals("") ? !0 : t ? i.indexOf("@#") != -1 && (r = n.Env.parseContext(n.context, 0, i, !1, !0).trim(), r.Length != 0) ? n.Evaluator.evaluateLogic(this, i) : !0 : n.Evaluator.evaluateLogic(this, i) }; i.prototype.getValueAsString = function (t) { var i = n.context.getWindowContext(this.vo.windowNo, this.vo.tabNo, t, !0); return i ? i.toString() : "" }; i.prototype.getIsCurrent = function () { if (!this.gridTable.getIsOpen() || !this.oldQuery.equals(this.query.getWhereClause())) return !1; if (!this.getIsDetail()) return !0; var t = n.context.getWindowContext(this.vo.windowNo, this.getLinkColumnName()); return this.linkValue.equals(t) }; i.prototype.getIsDetail = function () { return this.parents.length > 0 || this.vo.AD_Column_ID != 0 ? !0 : !1 }; i.prototype.getField = function (n) { return this.gridTable.getField(n) }; i.prototype.getFieldById = function (n) { return this.gridTable.getFieldById(n) }; i.prototype.getFields = function () { return this.gridTable.getFields() }; i.prototype.getLinkColumnName = function () { return this.linkColumnName ? this.linkColumnName : "" }; i.prototype.getOnlyCurrentDays = function () { return this.getIsZoomAction() ? 0 : this.vo.onlyCurrentDays }; i.prototype.getShowSummaryLevel = function () { return this.vo.ShowSummaryLevel }; i.prototype.getIsTPBottomAligned = function () { return this.vo.TabPanelAlignment == "H" }; i.prototype.getIsTreeTab = function () { return this.vo.HasTree }; i.prototype.getRowCount = function () { return this.gridTable.getRowCount() }; i.prototype.getRecords = function () { return this.gridTable.getDataTable() }; i.prototype.getCurrentRow = function () { return this.currentRow }; i.prototype.getOrderByClause = function (n) { var i, t; if (this.vo.orderByClause.length > 0) return this.vo.OrderByClause; for (this.vo.orderByClause = "", i = 0; i < 3; i++)t = this.orderBys[i], t && t != null && t != "" && t.length > 0 && (this.vo.orderByClause.length > 0 && (this.vo.OrderByClause += ","), this.vo.orderByClause += t); return this.vo.orderByClause.Length > 0 ? this.vo.orderByClause : (this.vo.orderByClause = "Created", n > 0 && (this.vo.orderByClause += " DESC"), this.vo.orderByClause) }; i.prototype.getTableModel = function () { return this.gridTable }; i.prototype.getIsOpen = function () { return this.gridTable != null ? this.gridTable.getIsOpen() : !1 }; i.prototype.getIsQueryActive = function () { return this.query != null ? this.query.getIsActive() : !1 }; i.prototype.getDependantFields = function (n) { var i = [], r, t; if (this.depOnFieldColumn.indexOf(n) != -1) for (r = this.depOnFieldColumn.length, t = 0; t < r; t++)this.depOnFieldColumn[t].equals(n) && i.indexOf(this.depOnField[t]) < 0 && i.push(this.depOnField[t]); return i }; i.prototype.getIsReadOnly = function () { if (this.vo.IsReadOnly) return !0; if (this.vo.ReadOnlyLogic == null || this.vo.ReadOnlyLogic.equals("")) return this.vo.IsReadOnly; return n.Evaluator.evaluateLogic(this, this.vo.ReadOnlyLogic) }; i.prototype.getIsQueryNewRecord = function () { return this.query != null ? this.query.getIsNewRecordQuery() : !1 }; i.prototype.getIsInsertRecord = function () { return this.getIsReadOnly() ? !1 : this.vo.IsInsertRecord }; i.prototype.getIncluded_Tab_ID = function () { return this.vo.Included_Tab_ID }; i.prototype.getIsAlwaysUpdateField = function () { for (var t, n = 0; n < this.gridTable.getColumnCount(); n++)if (t = this.gridTable.getField(n), t.getIsAlwaysUpdateable()) return !0; return !1 }; i.prototype.getValue = function (n) { if (n == null) return null; var t = this.gridTable.getField(n); return this.getValueOfField(t) }; i.prototype.getValueOfField = function (n) { return n == null ? null : n.getValue() }; i.prototype.getAD_Process_ID = function () { return this.vo.AD_Process_ID }; i.prototype.getRecord_ID = function () { return this.gridTable.getKeyID(this.currentRow) }; i.prototype.getKeyID = function (n) { return this.gridTable.getKeyID(n) }; i.prototype.getFooterInfo = function (i, r, u, f, e) { return new Promise(function (f, o) { var s; if (i.startsWith("C_Order") || i.startsWith("C_Invoice")) { var s, l = i.startsWith("C_Order"), h = null, c = null; try { h = new n.MessageFormat(n.Msg.getMsg("OrderSummary")); c = new n.MessageFormat(n.Msg.getMsg("OrderSummaryMC")) } catch (a) { o(""); return } if (h == null || c == null) { f(""); return } s = 0; s = l ? r.getContextAsInt(u, "C_Order_ID") : r.getContextAsInt(u, "C_Invoice_ID"); s < 1 && e > 0 && (s = e); t.ajax({ type: "Get", async: !0, url: n.Application.contextUrl + "Form/GetTrxInfo", data: { Record_ID: s, isOrder: l }, success: function (t) { var s, l; try { var arguments = [], e = !1, i = (new n.DB.DataReader).toJson(t), u = n.DisplayType.GetNumberFormat(n.DisplayType.Amount); i.read() && (s = i.getInt(0), arguments[0] = s, arguments[1] = u.getLocaleAmount(i.getDecimal(2)), arguments[2] = u.getLocaleAmount(i.getDecimal(3)), l = i.getString(1), arguments[3] = l, arguments[4] = u.getLocaleAmount(i.getDecimal(4)), arguments[5] = r.getContext("$CurrencyISO"), e = !0) } catch (a) { o("") } e ? arguments[2] === arguments[4] ? f(h.format(arguments)) : f(c.format(arguments)) : f(" ") }, error: function () { o("") } }) } }) }; i.prototype.getTrxInfo = function (i, r, u) { var e, f, l, a, v, y, p; if (i.startsWith("C_Order") || i.startsWith("C_Invoice")) { var e, h = i.startsWith("C_Order"), o = null, s = null; try { o = new n.MessageFormat(n.Msg.getMsg("OrderSummary")); s = new n.MessageFormat(n.Msg.getMsg("OrderSummaryMC")) } catch (w) { } if (o == null || s == null) return " "; var arguments = [], c = !1, f = null; try { e = 0; e = h ? r.getContextAsInt(u, "C_Order_ID") : r.getContextAsInt(u, "C_Invoice_ID"); f = null; t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetTrxInfo", data: { Record_ID: e, isOrder: h }, success: function (t) { f = (new n.DB.DataReader).toJson(t) } }); f.read() && (l = f.getInt(0), arguments[0] = l, a = f.getDecimal(2).toLocaleString(), arguments[1] = a, v = f.getDecimal(3).toLocaleString(), arguments[2] = v, y = f.getString(1), arguments[3] = y, p = f.getDecimal(4).toLocaleString(), arguments[4] = p, arguments[5] = r.getContext("$CurrencyISO"), c = !0) } catch (w) { } finally { f != null && f.dispose() } return c ? arguments[2] === arguments[4] ? o.format(arguments) : s.format(arguments) : " " } }; i.prototype.getIsProcessed = function () { var i = this.gridTable.findColumn("Processed"), t; if (i != -1) { if (t = this.gridTable.getValueAt(this.currentRow, i), typeof t == "string") return "Y".equals(t); if (typeof t == "boolean") return t } return "Y".equals(n.context.getWindowContext(this.vo.windowNo, this.vo.tabNo, "Processed")) }; i.prototype.getKeyColumnName = function () { return this.keyColumnName }; i.prototype.getAD_ColumnSortOrder_ID = function () { return this.vo.AD_ColumnSortOrder_ID }; i.prototype.getIsMapView = function () { return this.vo.locationCols && this.vo.locationCols.length > 0 ? !0 : !1 }; i.prototype.getMapColumns = function () { return this.vo.locationCols }; i.prototype.getAD_ColumnSortYesNo_ID = function () { return this.vo.AD_ColumnSortYesNo_ID }; i.prototype.getWhereClause = function () { return this.vo.WhereClause }; i.prototype.getSearchQuery = function (t) { for (var r = null, f = this.getFields(), i = null, u = 0; u < f.length; u++)(i = f[u], i.getIsVirtualColumn()) || i.getColumnName().toLowerCase() != "export_id" && n.DisplayType.IsText(i.getDisplayType()) && (r || (r = new n.Query(this.getTableName(), !0)), r.addRestriction(i.getColumnName(), n.Query.prototype.LIKE, t, i.getColumnName(), t)); return f = null, i = null, r }; i.prototype.getParentColumnNames = function () { return this.parents }; i.prototype.clearSelectedRow = function () { for (var i = this.gridTable.getFields().length, t, n = 0; n < i; n++)t = this.gridTable.getField(n), t.getIsKey() ? t.setValue(null, !1) : t.setNullValue() }; i.prototype.setCurrentRow = function (n, t) { var f = -1, c = this.verifyRow(n), r, s, u, i, h, o; for (this.currentRow = c, r = this.gridTable.getRow(this.currentRow), r && (f = r.recid), s = this.gridTable.getFields().length, u = 0; u < s; u++)i = this.gridTable.getField(u), r ? (h = r[i.getColumnName().toLowerCase()], i.setValue(h, this.gridTable.getIsInserting())) : i.getIsKey() ? i.setValue(null, !1) : i.setNullValue(); return t ? (this.mDataStatusEvent == null && (this.mDataStatusEvent = new e(null, this.getRowCount(), this.gridTable.getIsInserting(), !1, this.gridTable.getIsInserting()), this.mDataStatusEvent.AD_Table_ID = this.getAD_Table_ID(), this.mDataStatusEvent.setPageInfo(this.gridTable.currentPage, this.gridTable.rowCount, this.gridTable.pazeSize)), this.mDataStatusEvent.setCurrentRow(this.currentRow), o = this.mDataStatusEvent.getAD_Message(), (o == null || o.length == 0) && this.mDataStatusEvent.setInfo("NavigateOrUpdate", null, !1, !1), this.fireDataStatusChanged(this.mDataStatusEvent), f) : f }; i.prototype.fireDataStatusEventOnly = function () { this.mDataStatusEvent == null && (this.mDataStatusEvent = new e(null, this.getRowCount(), this.gridTable.getIsInserting(), !1, this.gridTable.getIsInserting()), this.mDataStatusEvent.AD_Table_ID = this.getAD_Table_ID(), this.mDataStatusEvent.setPageInfo(this.gridTable.currentPage, this.gridTable.rowCount, this.gridTable.pazeSize)); this.mDataStatusEvent.setCurrentRow(this.currentRow); var n = this.mDataStatusEvent.getAD_Message(); (n == null || n.length == 0) && this.mDataStatusEvent.setInfo("NavigateOrUpdate", null, !1, !1); this.fireDataStatusChanged(this.mDataStatusEvent) }; i.prototype.setQuery = function (t) { t == null ? this.query = new n.Query : (this.query = t, this.vo.onlyCurrentDays = 0) }; i.prototype.setValue = function (t, i) { var r, u; if (!(t instanceof n.GridField)) { if (t == null) return "NoColumn"; t = this.gridTable.getField(t) } return t == null ? "NoField" : (r = t.getDisplayType(), i == null || i.toString() == "" ? i = null : i === 0 && (n.DisplayType.IsID(r) || r == n.DisplayType.List) && !this.getIsStdColumn(t.getColumnName().toUpper()) && (i = null), u = this.gridTable.findColumn(t.getColumnName()), this.gridTable.setValueAt(i, this.currentRow, u, !1), this.processFieldChange(t)) }; i.prototype.getIsStdColumn = function (n) { return n == "AD_USER_ID" || n == "AD_ROLE_ID" || n == "AD_CLIENT_ID" || n == "AD_ORG_ID" ? !0 : !1 }; i.prototype.addDataStatusListener = function (n) { this.mDataListenerList.push(n) }; i.prototype.removeDataStatusListener = function (n) { for (var t = this.mDataListenerList.length - 1; t >= 0; t--)this.mDataListenerList[t] === n && (this.mDataListenerList[t] = null, this.mDataListenerList.splice(t, 1)) }; i.prototype.needSave = function (n, t) { return n ? this.gridTable.needSave(-2, t) : t ? this.gridTable.needSave() : this.gridTable.needSave(t) }; i.prototype.loadFields = function () { for (var n, t, i, e, f, u = 0; u < this.gTab._gridTable.m_fields.length; u++) { for (n = new r(this.gTab._gridTable.m_fields[u]), n.setGridTab(this), this.gridTable.gridFields.push(n), n.getIsDefaultFocus() && (this.defaultFocusField = n), t = n.getColumnName(), n.getIsKey() && (this.keyColumnName = t, this.gridTable.setKeyColumnName(t)), n.getIsParentColumn() && this.parents.push(t), i = n.getSortNo(), i == 0 || (Math.abs(i) == 1 ? (this.orderBys[0] = t, i < 0 && (this.orderBys[0] += " DESC")) : Math.abs(i) == 2 ? (this.orderBys[1] = t, i < 0 && (this.orderBys[1] += " DESC")) : Math.abs(i) == 3 && (this.orderBys[2] = t, i < 0 && (this.orderBys[2] += " DESC"))), e = n.getDependentOn(), f = 0; f < e.length; f++)this.depOnFieldColumn.push(e[f]), this.depOnField.push(n); (t.equals("IsActive") || t.equals("Processed") || t.equals("Processing")) && (this.depOnFieldColumn.push(t), this.depOnField.push(null)); n = null } }; i.prototype.loadTabPanels = function () { var n, t; if (this.gTab._panels && this.gTab._panels.length > 0) for (this.hasPanel = !0, n = 0; n < this.gTab._panels.length; n++)t = new s(this.gTab._panels[n]), this.tabPanels.push(t); else this.hasPanel = !1 }; i.prototype.loadHeaderPanelItems = function () { this.vo.HeaderItems && (this.isHeaderPanel = !0, headerPanel = this.vo.HeaderItems, this.isHPanelNotShowInMultiRow = this.vo.HPanelNotShowInMultiRow) }; i.prototype.getIsHeaderPanel = function () { return this.isHeaderPanel }; i.prototype.getHeaderPanelItems = function () { return headerPanel }; i.prototype.getHeaderHeight = function () { return this.vo.HeaderHeight && this.vo.HeaderHeight > 0 ? this.vo.HeaderHeight + "px" : "200px" }; i.prototype.getHeaderWidth = function () { return this.vo.HeaderWidth && this.vo.HeaderWidth > 0 ? this.vo.HeaderWidth + "px" : "250px" }; i.prototype.getHeaderBackColor = function () { return this.vo.HeaderBackColor }; i.prototype.getHeaderPadding = function () { return this.vo.HeaderPadding }; i.prototype.getHeaderHorizontal = function () { return this.vo.HeaderAlignment.equals("H") ? !0 : !1 }; i.prototype.getHasPanel = function () { return this.hasPanel }; i.prototype.getTabPanels = function () { return this.tabPanels }; i.prototype.validateQuery = function (t) { var i, r, s, f, c, e, u, v, l; if (t == null || t.getRestrictionCount() == 0) return null; if (t.getRestrictionCount() != 1 || (i = t.getColumnName(0), i == null) || i.indexOf("(") != -1) return t.getWhereClause(); if (r = null, i.equals("R_RequestRelated_ID") ? r = "R_Request_ID" : i.startsWith("C_DocType") ? r = "C_DocType_ID" : i.equals("CreatedBy") || i.equals("UpdatedBy") ? r = "AD_User_ID" : i.equals("Orig_Order_ID") ? r = "C_Order_ID" : i.equals("Orig_InOut_ID") && (r = "M_InOut_ID"), r != null) { if (this.getField(r) != null) return t.setColumnName(0, r), t.getWhereClause(); r = null } if (this.getField(i) != null) return t.getWhereClause(); s = "VIS_104"; u = []; u[0] = new n.DB.SqlParam("@colName", i); f = null; try { f = h(s, u); f.read() && (r = f.getString(0)) } catch (a) { return this.log.log(o.SEVERE, "(ref) - Column=" + i, a), t.getWhereClause() } finally { f != null && f.dispose() } if (r != null) { if (t.setColumnName(0, r), this.getField(r) != null) return this.log.fine("Column " + i + " replaced with " + r), t.getWhereClause(); i = r } c = null; e = this.getKeyColumnName(); s = "VIS_105"; u = []; u[0] = new n.DB.SqlParam("@colName", i); u[1] = new n.DB.SqlParam("@tabKeyColumn", e); try { f = h(s, u); f.read() && (c = f.getString(0)) } catch (a) { return this.log.log(o.SEVERE, "Column=" + i + ", Key=" + e, a), null } finally { f != null && f.dispose() } return e.equals("AD_Reference_ID") ? (s = "VIS_106", u = [], u[0] = new n.DB.SqlParam("@colName", i), v = d(s, u), "AD_Reference_ID=" + v) : c == null ? (this.log.info("Not successfull - Column=" + i + ", Key=" + e + ", Query=" + t), t.getWhereClause()) : (t.setTableName("xx"), l = "EXISTS (SELECT * FROM " + c + " xx WHERE " + t.getWhereClause(!0) + " AND xx." + e + "=" + this.getTableName() + "." + e + ")", this.log.fine(l), l) }; i.prototype.setTreeNodeID = function (n) { this.treeNode_ID = n; this.gridTable.treeNode_ID = n }; i.prototype.setTreeID = function (n) { this.treeID = n; this.gridTable.treeID = n }; i.prototype.setTreeTable = function (n) { this.treeTable_ID = n; this.gridTable.treeTable_ID = n }; i.prototype.setShowSummaryNodes = function (n) { this.ShowSummaryNodes = n; this.gridTable.ShowSummaryNodes = n }; i.prototype.setIsZoomAction = function (n) { this.isZoomAction = n; this.gridTable.isZoomAction = n }; i.prototype.getIsZoomAction = function () { return this.isZoomAction }; i.prototype.prepareQuery = function (t, i, r, u) { var v = !0, w = !1, h, f, y, s, e, p, k, c, a, o, l; if (n.context.clearTabContext(this.vo.windowNo, this.vo.tabNo), h = this.oldQuery.equals(this.query.getWhereClause()) && this.vo.onlyCurrentDays == t, this.getIsTreeTab() && (this.getShowSummaryLevel() || this.gridTable.setDoPaging(!1), this.getShowSummaryLevel() && (this.gridTable.setDoPaging(!0), h = !1)), this.oldQuery = this.query.getWhereClause(), this.vo.onlyCurrentDays = t, f = "", u || (f += this.vo.WhereClause), !this.ShowSummaryNodes && this.getShowSummaryLevel() && (f += f.length > 0 ? " AND IsSummary='N'" : " IsSummary='N'"), this.getOnlyCurrentDays() > 0 && (f.length > 0 && (f += " AND "), y = this.findColumn("Processed") != -1, y && (f += "(Processed='N' OR "), f += r ? "Created>=" : "Updated>=", f += "addDays(SysDate, -" + this.vo.onlyCurrentDays + ")", y && (f += ")")), this.isThroughRoleCenter || this.getIsDetail() && (s = this.getLinkColumnName(), s.equals("") ? (f.length > 0 && (f += " AND "), f += " 2=3", v = !1) : (e = "", e = this.vo.tabNo > 0 ? n.context.getTabRecordContext(this.vo.windowNo, this.getParentTabNo(), s, !0) : n.context.getTabRecordContext(this.vo.windowNo, this.getParentTabNo(), s), h && (h = this.linkValue.equals(e), w = !h), this.linkValue = e, e.length == 0 ? (f.length > 0 && (f += " AND "), f += " 2=4", v = !1) : (f.length > 0 && (f += " AND "), "NULL".equals(e.toUpper()) ? f += s + " IS NULL " : (f += s + "=", f += s.endsWith("_ID") ? e : "'" + e + "'")))), this.query.getIsActive() && (p = this.validateQuery(this.query), p == null || w || (f.length > 0 && (f += " AND "), f += p)), this.extendedWhere = f.toString(), this.mDataStatusEvent = null, this.gridTable.getIsOpen()) h ? this.gridTable.dataRefreshAll() : this.gridTable.dataRequery(f.toString()); else { if (!this.isZoomAction && (k = "VIS_107", c = [], c[0] = new n.DB.SqlParam("@AD_User_ID", n.Env.getCtx().getAD_User_ID()), c[1] = new n.DB.SqlParam("@AD_Client_ID", n.Env.getCtx().getAD_Client_ID()), c[2] = new n.DB.SqlParam("@AD_Tab_ID", this.gridTable.AD_Tab_ID), c[3] = new n.DB.SqlParam("@AD_Table_ID", this.gridTable.AD_Table_ID), a = "", o = b(k, c), o && o.tables[0].rows && o.tables[0].rows.length > 0)) { for (l = 0; l < o.tables[0].rows.length; l++)n.Env.getCtx().getAD_User_ID() == o.tables[0].rows[l].cells.ad_user_id && this.gridTable.AD_Tab_ID == o.tables[0].rows[l].cells.ad_tab_id && (a = o.tables[0].rows[l].cells.code); a && (f = f.length > 0 ? f + " AND " + a : a) } this.gridTable.setSelectWhereClause(f.toString()); this.gridTable.open(i) } return v }; i.prototype.dataRefresh = function () { var n = this.currentRow, t = this.gridTable.dataRefresh(n); return this.setCurrentRow(n, !0), t }; i.prototype.dataRefreshAll = function () { this.mDataStatusEvent = null; this.getTableModel().dataRefreshAll() }; i.prototype.dataIgnore = function () { this.gridTable.dataIgnore(!0) && (this.setCurrentRow(this.currentRow, !1), this.currentRow < 0 && (this.currentRow = 0), this.gridTable.fireDataStatusIEvent("Ignored", "")) }; i.prototype.getLinkWhereClause = function () { var t = "", i, r; return this.getIsDetail() && (i = this.getLinkColumnName(), i.equals("") ? (t.length > 0 && (t += " AND "), t += " 2=3") : (r = n.context.getTabRecordContext(this.vo.windowNo, this.getParentTabNo(), i, !0), i = this.getTableName() + "." + i, r.length == 0 ? (t.length > 0 && (t += " AND "), t += " 2=4") : (t.length > 0 && (t += " AND "), "NULL".equals(r.toUpper()) ? t += i + " IS NULL " : (t += i + "=", t += i.endsWith("_ID") ? r : "'" + r + "'")))), t }; i.prototype.SetSelectedNode = function (n) { this.gridTable.selectedTreeNode = n }; i.prototype.dataSave = function (t) { try { var i = this.gridTable.dataSave(t) == n.GridTable.prototype.SAVE_OK; return t && this.setCurrentRow(this.currentRow, !1), i, i } catch (r) { this.log.log(n.Logging.Level.SEVERE, "#" + this.vo.tabNo + " - row=" + this.currentRow, r) } return !1 }; i.prototype.dataNew = function (t) { var r, u, f, i; if (!this.getIsInsertRecord()) return this.log.warning("Insert Not allowed in TabNo=" + this.vo.tabNo), null; if (this.vo.tabNo > 0) { if (r = "Y".equals(n.context.getWindowContext(this.vo.windowNo, "Processed")), r) return this.log.warning("Not allowed in TabNo=" + this.vo.tabNo + " -> Processed=" + r), null; this.log.finest("Processed=" + r) } if (u = this.gridTable.dataNew(this.currentRow, t), !u) return u; for (this.setCurrentRow(this.currentRow + 1, !0), f = this.getFieldCount(), this.gridTable.setDisableNotification(!0), i = 0; i < f; i++)this.processCallout(this.getField(i)); for (i = 0; i < f; i++)this.getField(i).setError(!1); return this.gridTable.setDisableNotification(!1), this.gridTable.fireDataStatusIEvent(t ? "UpdateCopied" : "Insertdata", ""), u }; i.prototype.dataDelete = function (n) { var t = this.gridTable.dataDelete(n, this.currentRow); return this.setCurrentRow(this.currentRow, !0), t }; i.prototype.findColumn = function (n) { return this.gridTable.findColumn(n) }; i.prototype.navigate = function (n, t, i) { var u = -1, r = null; return !i && (n === this.currentRow || (r = this.verifyRow(n), r === this.currentRow)) ? u : (r = r != null ? r : this.currentRow, this.gridTable.dataSave(r, !1) && (u = this.setCurrentRow(r, t)), u) }; i.prototype.verifyRow = function (n) { var t = n, i; return this.gridTable.getIsOpen() ? (i = this.getRowCount(), i == 0) ? -1 : (t >= i ? t = i - 1 : t < 0 && (t = 0), t) : -1 }; i.prototype.navigateRelative = function (n) { return this.navigate(this.currentRow + n) }; i.prototype.hasDependants = function (n) { return this.depOnFieldColumn.indexOf(n) !== -1 }; i.prototype.dataStatusChanged = function (n) { var i = n.getCurrentRow(), r = n.getAD_Message(), t; n.setCurrentRow(this.currentRow); this.mDataStatusEvent = n; i == this.currentRow ? (t = this.gridTable.getField(n.getChangedColumn()), t != null) : this.fireDataStatusChanged(this.mDataStatusEvent) }; i.prototype.fireDataStatusChanged = function (n) { var u = this.mDataListenerList, t, i, f, r; if (u.length != 0) { if (n.getCurrentRow() >= 0) { if (n.Created = this.getValue("Created"), n.CreatedBy = this.getValue("CreatedBy"), n.Updated = this.getValue("Updated"), n.UpdatedBy = this.getValue("UpdatedBy"), n.Record_ID = this.getKeyID(n.getCurrentRow()), t = new StringBuilder(this.getTableName()), this.keyColumnName != null && this.keyColumnName.length > 0) t.append(" - ").append(this.keyColumnName).append("=").append(n.Record_ID); else for (i = 0; i < this.parents.length; i++)f = this.parents[i], t.append(" - ").append(f).append("=").append(this.getValue(f)); n.Info = t.toString() } for (n.setInserting(this.gridTable.getIsInserting()), r = 0; r < u.length; r++)u[r].dataStatusChanged(n) } }; i.prototype.processFieldChange = function (n) { return this.processDependencies(n), this.processCallout(n) }; i.prototype.processDependencies = function (t) { var r = t.getColumnName(), f, u, i, e; if (this.hasDependants(r)) for (f = this.getDependantFields(r), u = 0; u < f.length; u++) { if (i = f[u], i != null && i.getLookup() instanceof n.MLookup && (e = i.getLookup(), e.getValidation().indexOf("@" + r + "@") != -1)) if (r == "C_BPartner_ID" && i.getColumnName() == "C_BPartner_Location_ID") continue; else { if (i.getValue() == null) continue; if (this.log.fine(r + " changed - " + i.getColumnName() + " set to null"), i.getValue() == null) return; this.setValue(i, null) } i != null && i.getLookup() instanceof n.MLocatorLookup } }; i.prototype.processCallout = function (t) { var l = t.getCallout(), e, i; if (l.length == 0 || this.getIsProcessed()) return ""; for (var v = t.getValue(), y = t.getOldValue(), a = new n.StringTokenizer(l, ";,", !1); a.hasMoreTokens();) { var u = a.nextToken().trim(), h = null, f = null, r = u, c = u.lastIndexOf("."); try { c != -1 && (r = u.substring(0, c).replace("ViennaAdvantage", "VIS").replace("VAdvantage", "VIS"), e = n.Utility.getFunctionByName(r, window), e || r.startsWith("VIS") || (r = "VIS" + r.substring(r.indexOf(".")), e = n.Utility.getFunctionByName(r, window)), h = new e, f = u.substring(c + 1)) } catch (s) { return this.log.log(o.SEVERE, r, s), "Callout Invalid: " + r + " (" + s.toString() + ")" } if (h == null || f == null || f.length == 0) return "Callout Invalid: " + f; i = ""; try { i = h.start(n.context, f, this.vo.windowNo, this, t, v, y) } catch (s) { return this.log.log(n.Logging.Level.SEVERE, "start", s), i = "Callout Invalid: " + s.toString() } if (i && !i.toString().equals("")) return i instanceof Error && (i = i.toString() + "-> " + u), this.log.warning(i), i } return "" }; i.prototype.getFieldCount = function () { return this.gridTable.getColumnCount() }; i.prototype.getCM_ChatID = function () { var t; return ((this.chats == null || this.chats.length == 0) && this.loadChats(), this.chats == null) ? 0 : (t = this.getRecord_ID(), this.hasKey(this.chats, t)) ? n.Utility.Util.getValueOfInt(this.getKeyValue(this.chats, t)) : 0 }; i.prototype.getCM_SubScribedID = function () { var t; return ((this._subscribe == null || this._subscribe.length == 0) && this.loadSubscribe(), this._subscribe == null) ? 0 : (t = this.getRecord_ID(), this.hasKey(this._subscribe, t)) ? n.Utility.Util.getValueOfInt(this.getKeyValue(this._subscribe, t)) : 0 }; i.prototype.hasKey = function (n, t) { for (var i = 0; i < n.length; i++)if (n[i].ID === t) return !0; return !1 }; i.prototype.getKeyValue = function (n, t) { for (var i = 0; i < n.length; i++)if (n[i].ID === t) return n[i].value; return 0 }; i.prototype.getCommitWarning = function () { return this.vo.CommitWarning }; i.prototype.getField = function (n) { return this.gridTable.getField(n) }; i.prototype.dispose = function () { if (this.gTab = null, this.vo = null, this.gridTable.removeDataStatusListener(this), this.gridTable.dispose(), this.gridTable = null, this.mDataListenerList != null) for (var n = this.mDataListenerList.length - 1; n >= 0; n--)this.mDataListenerList[n] = null, this.mDataListenerList.splice(n, 1) }; i.prototype.getIsLocked = function () { if (!n.MRole.getIsPersonalLock() || this.isDataLoading || (this._Lock == null && this.loadLocks(), this._Lock == null || this._Lock.length == 0)) return !1; var t = this.getRecord_ID(); return this._Lock.indexOf(t) > -1 }; i.prototype.loadLocks = function () { var f = n.context.getAD_User_ID(), r, i, t, u; if (this.canHaveAttachment()) { r = "VIS_108"; i = []; i[0] = new n.DB.SqlParam("@AD_User_ID", f.toString()); i[1] = new n.DB.SqlParam("@AD_Table_ID", this.vo.AD_Table_ID.toString()); t = null; try { for (this._Lock == null ? this._Lock = [] : this._Lock.length = 0, t = h(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.get("Record_ID")), this._Lock.push(u); t.close(); t = null } catch (e) { this.log.log(o.SEVERE, r, e) } this.log.fine("#" + this._Lock.length) } }; i.prototype.loadSubscribe = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_109"; i = []; i[0] = new n.DB.SqlParam("@AD_User_ID", n.context.getAD_User_ID()); i[1] = new n.DB.SqlParam("@AD_Table_ID", this.getAD_Table_ID()); t = null; try { for (this._subscribe = [], this._subscribe == null ? this._subscribe = {} : this._subscribe.length = 0, t = h(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this._subscribe.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.loadDocuments = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_110"; i = []; i[0] = new n.DB.SqlParam("@ad_table_id", this.getAD_Table_ID()); t = null; try { for (this.viewDocument = [], this.viewDocument == null ? this.viewDocument = {} : this.viewDocument.length = 0, t = h(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this.viewDocument.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.loadChats = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_111"; i = []; i[0] = new n.DB.SqlParam("@AD_Table_ID", this.getAD_Table_ID()); t = null; try { for (this.chats = [], this.chats == null ? this.chats = {} : this.chats.length = 0, t = h(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this.chats.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.canHaveAttachment = function () { return this.keyColumnName.endsWith("_ID") ? !0 : !1 }; i.prototype.hasChat = function () { if (this.isDataLoading || (this.chats == null && this.loadChats(), this.chats == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this.chats, n) }; i.prototype.hasDocument = function () { if (this.isDataLoading || (this.viewDocument == null && this.loadDocuments(), this.viewDocument == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this.viewDocument, n) }; i.prototype.HasSubscribed = function () { if (this.isDataLoading || (this._subscribe == null && this.loadSubscribe(), this._subscribe == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this._subscribe, n) }; i.prototype.loadAttachments = function () { var r, i, t, u, f; if (this.canHaveAttachment()) { r = "VIS_112"; i = []; i[0] = new n.DB.SqlParam("@AD_Table_ID", this.getAD_Table_ID()); t = null; try { for (this._attachments = [], t = h(r, i); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(1)), f = n.Utility.Util.getValueOfInt(t.getString(0)), this._attachments.push({ ID: u, value: f }); t = null } catch (e) { } } }; i.prototype.loadMarking = function () { var i = [], t, r, u; i[0] = new n.DB.SqlParam("@AD_Table_ID", this.getAD_Table_ID()); t = null; try { for (this._marking = [], t = h("VIS_113", i); t.read();)r = n.Utility.Util.getValueOfInt(t.getString(1)), u = n.Utility.Util.getValueOfInt(t.getString(0)), this._marking.push({ ID: r, value: u }); t = null } catch (f) { } }; i.prototype.hasAttachment = function () { if (this.isDataLoading || (this._attachments == null && this.loadAttachments(), this._attachments == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this._attachments, n) }; i.prototype.hasMarked = function () { if (this.isDataLoading || (this._marking == null && this.loadMarking(), this._marking == null)) return !1; var n = this.getRecord_ID(); return this.hasKey(this._marking, n) }; i.prototype.loadData = function () { this.isDataLoading = !1; this.isExportLoading = !1; this._attachments = this.gTab._attachments; this.chats = this.gTab._chats; this._lock = this.gTab._pAccess; this._subscribe = this.gTab._subscribe; this.viewDocument = this.gTab._documents }; i.prototype.locks = function (t, i, r) { var u = t.getAD_User_ID(); n.dataContext.updateInsertLocks(u, this.vo.AD_Table_ID, i, r); this.loadLocks() }; i.prototype.setRecordStatus = function (n) { var t = n }; u.prototype.ctx = n.context; u.prototype.SAVE_OK = "O"; u.prototype.SAVE_ERROR = "E"; u.prototype.SAVE_ACCESS = "A"; u.prototype.SAVE_MANDATORY = "M"; u.prototype.SAVE_ABORT = "U"; u.prototype.SAVE_REGEX_ERROR = "R"; u.prototype.getReadOnly = function () { return !1 }; u.prototype.setAD_Tab_ID = function (n) { this.AD_Tab_ID = n }; u.prototype.getField = function (n) { var r, t, i; if (isNaN(n)) { if (n == null || n.length == 0) return null; for (r = this.gridFields.length, t = 0; t < r; t++)if (i = this.gridFields[t], n.equals(i.getColumnName(), !0)) return i; return null } return n < 0 || n >= this.gridFields.length ? null : this.gridFields[n] }; u.prototype.getFieldById = function (n) { var r, t, i; if (n < 1) return null; for (r = this.gridFields.length, t = 0; t < r; t++)if (i = this.gridFields[t], n === i.getAD_Field_ID()) return i; return null }; u.prototype.getIsInserting = function () { return this.inserting }; u.prototype.getColumnCount = function () { return this.gridFields.length }; u.prototype.getFields = function () { return this.gridFields }; u.prototype.getWhereClause = function (t) { for (var h = this.gridFields.length, s = null, u = null, f, i, r, e = 0; e < h; e++)if (f = this.gridFields[e], f.getIsKey()) { if (i = f.getColumnName().toLowerCase(), r = t[i], r == null) return this.log.log(n.Logging.Level.WARNING, "PK data is null - " + i), null; s = i.toUpperCase().endsWith("_ID") ? new StringBuilder(i).append("=").append(r) : new StringBuilder(i).append("=").append(n.DB.to_string(r.toString())) } else if (f.getIsParentColumn()) { if (i = f.getColumnName().toLowerCase(), r = t[i], r == null) { this.log.log(o.INFO, "FK data is null - " + i); continue } u == null ? u = new StringBuilder : u.append(" AND "); i.toUpperCase().endsWith("_ID") ? u.append(i).append("=").append(r) : u.append(i).append("=").append(n.DB.to_string(r.toString())) } return s != null ? s.toString() : u != null ? u.toString() : (this.log.log(o.WARNING, "No key Found"), null) }; u.prototype.getIsOpen = function () { return this.isOpen }; u.prototype.getTableID = function () { return this.gTable._AD_Table_ID }; u.prototype.getDataTable = function () { return this.bufferList }; u.prototype.getSortModel = function () { return this.mSortList }; u.prototype.getRow = function (n) { return this.mSortList[n] }; u.prototype.getRowCount = function () { return this.mSortList ? this.mSortList.length : this.bufferList ? this.bufferList.length : 0 }; u.prototype.getTotalRowCount = function () { return this.rowCount }; u.prototype.getValueAt = function (n, t) { var i = this.getRow(n); return i && t in i ? i[t] : null }; u.prototype.checkMaxMin = function () { for (var o = new StringBuilder, e = this.gridFields.length, r = "", u = "", i, f = 0; f < e; f++)if (i = this.gridFields[f], n.DisplayType.IsNumeric(i.getDisplayType())) if (r = i.getMaxValue(), u = i.getMinValue(), t.isNumeric(r) && t.isNumeric(u)) { if (Number(i.getValue()) > Number(i.getMaxValue()) || Number(i.getValue()) < Number(i.getMinValue())) return n.ADialog.error("ValidationError", !0, ": " + n.Msg.getMsg("VIS_ValueOf") + " " + i.getHeader() + " " + n.Msg.getMsg("VIS_MustBetween") + " " + i.getMinValue() + " " + n.Msg.getMsg("VIS_And") + " " + i.getMaxValue()), !1 } else if (t.isNumeric(r)) { if (Number(i.getValue()) > Number(r)) return n.ADialog.error("ValidationError", !0, ": " + n.Msg.getMsg("VIS_ValueOf") + " " + i.getHeader() + " " + n.Msg.getMsg("VIS_Lessthan") + " " + r), !1 } else if (t.isNumeric(u) && Number(i.getValue()) < Number(u)) return n.ADialog.error("ValidationError", !0, ": " + n.Msg.getMsg("VIS_ValueOf") + " " + i.getHeader() + " " + n.Msg.getMsg("VIS_Greaterthan") + " " + u), !1; return !0 }; u.prototype.getMandatory = function (n) { for (var i = new StringBuilder, f = this.gridFields.length, t, u, r = 0; r < f; r++)t = this.gridFields[r], t.getIsMandatory(!0) && (u = t.getColumnName().toLowerCase(), (n[u] == null || n[u].toString().length == 0) && (t.setInserting(!0), t.setError(!0), i.length() > 0 && i.append(", "), i.append(t.getHeader()))); return i.length() == 0 ? "" : i.toString() }; u.prototype.getErrorColumns = function () { for (var n = new StringBuilder, r = this.gridFields.length, i, t = 0; t < r; t++)i = this.gridFields[t], i.getIsError() && (n.length() > 0 && n.append(", "), n.append(i.getHeader())); return n.length() == 0 ? "" : n.toString() }; u.prototype.getClientOrg = function (n) { var u = -1, t, i, r; return this.gTable._indexClientColumn != -1 && (t = this.getValueAt(n, "ad_client_id"), t != null && (u = t)), i = 0, this.gTable._indexOrgColumn != -1 && (r = this.getValueAt(n, "ad_org_id"), r != null && (i = r)), [u, i] }; u.prototype.getKeyID = function (n) { if (this.gTable._indexKeyColumn != -1) try { var t = this.getValueAt(n, this.keyColumnName.toLowerCase()); return t == null || isNaN(t) ? -1 : t } catch (i) { return -1 } return -1 }; u.prototype.setKeyColumnName = function (n) { this.keyColumnName = n }; u.prototype.setTableName = function (n) { this.isOpen || n != null && n.length != 0 && (this.gTable._tableName = n) }; u.prototype.setReadOnly = function (n) { this.readOnly = n }; u.prototype.setDeleteable = function (n) { this.gTable._deleteable = n }; u.prototype.setOrderClause = function (n) { this.gTable._orderClause = n; this.gTable._orderClause == null && (this.gTable._orderClause = "") }; u.prototype.setSelectWhereClause = function (n) { return this.isOpen ? !1 : (this.gTable._whereClause = n, this.gTable._whereClause == null && (this.gTable._whereClause = ""), !0) }; u.prototype.setDoPaging = function (n) { this.dopaging = n }; u.prototype.setCurrentPage = function (n) { this.currentPage = n }; u.prototype.setCurrentPageRelative = function (n) { var t = this.currentPage; isNaN(n) ? t = Math.ceil(this.rowCount / this.pazeSize) : n !== 0 ? t += n : t = 1; this.currentPage = t }; u.prototype.setSortModel = function (n) { this.mSortList = null; this.mSortList = n }; u.prototype.setCardID = function (n) { this.card_ID = n }; u.prototype.resetCard = function () { this.cardTempalte = null; this.setCardID(0) }; u.prototype.setValueAt = function (n, i, r, u) { var f, e, o, s; !this.isOpen || i < 0 || r < 0 || this.rowCount == 0 || (f = this.getField(r), e = this.getValueAt(i, f.getColumnName().toLowerCase()), u || (e != null || n != null) && e !== n) && (o = this.getRow(i), this.rowChanged = i, this.rowData == null && (this.rowData = {}, t.extend(this.rowData, o)), f.setValue(n, this.inserting), o[f.getColumnName().toLowerCase()] = n, this.disableNotification || (s = this.createDSE(), s.setChangedColumn(r, f.getColumnName()), this.fireDataStatusChanged(s))) }; u.prototype.setDisableNotification = function (n) { this.disableNotification = n }; u.prototype.needSave = function (n, t) { var i = n, r = t; return (arguments.length == 0 ? (i = this.rowChanged, r = !1) : arguments.length == 1 ? (i = arguments[0], r = !1) : (i = arguments[0], r = arguments[1]), typeof this.changed == "undefined" || !this.changed && (this.rowChanged == -1 || typeof this.rowChanged == "undefined")) ? !1 : this.changed && (typeof this.rowChanged == "undefined" || this.rowChanged == -1) && r ? !1 : i == this.rowChanged ? !1 : !0 }; u.prototype.findColumn = function (n) { for (var i = this.gridFields, r, t = 0; t < i.length; t++)if (r = i[t], n.equals(r.getColumnName(), !0)) return t; return -1 }; u.prototype.createSelectSql = function () { var t = this.gTable, h, i, u, c, y, l, s, f; if (this.gridFields.length == 0 || t._tableName == null || t._tableName.equals("")) return ""; var e = new StringBuilder("SELECT "), r = null, o = null, v = !1, a = []; for (h = 0; h < this.gridFields.length; h++)h > 0 && e.append(", "), i = this.gridFields[h], o = i.getColumnSQL(!0), o.indexOf("@") == -1 ? e.append(o) : e.append(n.Env.parseContext(this.ctx, t._windowNo, o, !1)), i.getDisplayType() == n.DisplayType.Image && (a.push(o), v = !0), i.getLookup() != null && i.getLookup() instanceof n.MLookup ? (u = i.getLookup().info, u.displayColSubQ && u.displayColSubQ != "" && t._tableName.toLowerCase() != u.tableName.toLowerCase() && (r == null ? r = new StringBuilder("SELECT ") : r.append(","), c = u.queryDirect.substring(u.queryDirect.lastIndexOf(" FROM " + u.tableName + " ")), c = i.getIsVirtualColumn() ? c.replace("@key", i.getColumnSQL(!1)) : c.replace("@key", t._tableName + "." + i.getColumnSQL()), r.append("( SELECT (").append(u.displayColSubQ).append(") ").append(c).append(" ) AS ").append(i.getColumnSQL() + "_T").append(",").append(i.getColumnSQL(!0)))) : i.getLookup() != null && i.getLookup() instanceof n.MAccountLookup && (r == null ? r = new StringBuilder("SELECT ") : r.append(","), r.append("( SELECT C_ValidCombination.Combination FROM C_ValidCombination WHERE C_ValidCombination.C_ValidCombination_ID=").append(t._tableName + "." + i.getColumnSQL()).append(" ) AS ").append(i.getColumnSQL() + "_T").append(",").append(i.getColumnSQL(!0))); if (o = null, y = Math.random(), v) for (l = 0; l < a.length; l++)e.append(", (SELECT ImageURL||'?random=" + y + "' from AD_Image img where img.AD_Image_ID=CAST(" + t._tableName + "." + a[l] + " AS INTEGER)) as imgUrlColumn" + a[l]); return e.append(" FROM ").append(t._tableName), this.SQL_Select = e.toString(), this.SQL_Count = "SELECT COUNT(*) FROM " + t._tableName, s = new StringBuilder(""), f = t._whereClause, f.length > 0 && (s.append(" WHERE "), f.indexOf("@") == -1 ? s.append(f) : s.append(n.Env.parseContext(this.ctx, t._windowNo, f, !1)), f.toUpperCase().indexOf("=NULL") > 0 && this.log.Severe("Invalid NULL - " + _tableName + "=" + f)), this.SQL = this.SQL_Select + s.toString(), this.SQL_Count += s.toString(), t._withAccessControl && (this.SQL = n.MRole.addAccessSQL(this.SQL, t._tableName, n.MRole.SQL_FULLYQUALIFIED, n.MRole.SQL_RO), this.SQL_Count = "SELECT COUNT(*) FROM " + t._tableName + this.SQL.substring(this.SQL_Select.length)), this.SQL_Direct = r != null ? r.toString() + " " + this.SQL_Count.substring(this.SQL_Count.indexOf(" COUNT(*) FROM") + 9) : "", t._orderClause.equals("") || (this.SQL += " ORDER BY " + t._orderClause, this.SQL_Direct += " ORDER BY " + t._orderClause), this.ctx.setWindowTabContext(t._windowNo, t._tabNo, "SQL", this.SQL), this.SQL }; u.prototype.open = function (i) { if (this.maxRows = i, this.isOpen) return this.dataRefreshAll(), !0; if (this.createSelectSql(), this.SQL == null || this.SQL.equals("")) return !1; this.rowCount = 0; var r = 0; return this.treeNode_ID > 0 ? t.ajax({ url: n.Application.contextUrl + "jsonData/GetRecordCountForTreeNode", data: { sqlIn: this.gTable._whereClause, AD_Table_ID: this.AD_Table_ID, treeID: this.treeID, treeNodeID: this.treeNode_ID, windowNo: this.gTable._windowNo, summaryOnly: this.ShowSummaryNodes }, type: "POST", async: !1, success: function (n) { r = JSON.parse(n) }, error: function () { } }) : this.card_ID > 0 ? t.ajax({ url: n.Application.contextUrl + "jsonData/GetRecordCountWithCard", data: { sql: n.secureEngine.encrypt(this.SQL_Count), cardID: this.card_ID }, type: "POST", async: !1, success: function (n) { r = JSON.parse(n) }, error: function () { } }) : r = g(this.SQL_Count, null), this.rowCount = r, this.rowCount > 0 ? (this.fillData(), this.isOpen = !0, this.changed = !1, this.rowChanged = -1) : (this.bufferList != null && (this.bufferList.length = 0), this.mSortList != null && (this.mSortList = null), this.currentPage = 1, this.isOpen = !0, this.changed = !1, this.rowChanged = -1, window.setTimeout(function (n) { n.fireQueryCompleted(!0) }, 300, this)), !0 }; u.prototype.fillData = function () { var t; this.pazeSize = n.Env.getWINDOW_PAGE_SIZE(); this.maxRows > 0 && this.rowCount > this.maxRows ? (this.pazeSize = this.maxRows, this.rowChanged = this.maxRows) : (!this.dopaging || this.pazeSize > this.rowCount) && (this.pazeSize = this.rowCount); this.dopaging && this.rowCount + this.pazeSize <= this.currentPage * this.pazeSize && --this.currentPage; this.bufferList.length = 0; t = this; this.SQL_Count = n.secureEngine.encrypt(this.SQL_Count); var r = this.createGridFieldArr(this.gridFields, !0), i = { sql: this.SQL, page: this.dopaging ? this.currentPage : 0, pageSize: this.dopaging ? this.pazeSize : 0, treeID: 0, treeNode_ID: 0, card_ID: this.card_ID, ad_Tab_ID: this.AD_Tab_ID, tableName: this.gTable._tableName }, u = this.createObsecureFields(this.gridFields); i.sqlDirect = n.secureEngine.encrypt(this.SQL_Direct); i.sql = n.secureEngine.encrypt(i.sql); this.treeNode_ID > 0 ? (i.treeID = this.treeID, i.treeNode_ID = this.treeNode_ID, n.dataContext.getWindowRecordsForTreeNode(i, r, this.rowCount, this.SQL_Count, this.AD_Table_ID, this.treeID, this.treeNode_ID, function (n) { var s, e, r, u, f, i; try { if (n != null) { if (s = 0, n.getTables().length != 0) for (e = n.getTable(0).getRows(), r = n.getTable(0).getColumnsName(), u = 0; u < e.length; u++) { for (f = e[u].getJSCells(), i = 0; i < r.length; i++)f[r[i]] = t.readDataOfColumn(r[i], f[r[i]]); t.bufferList[u] = f; s++ } n.dispose(); n = null } } catch (h) { this.log.Log(o.SEVERE, t.SQL, h) } t.fireQueryCompleted(!0); t = null })) : n.dataContext.getWindowRecords(i, r, this.rowCount, this.SQL_Count, this.AD_Table_ID, u, function (r, u, f) { var a, l, s, h, c, e; try { if (r != null) { if (a = 0, r.getTables().length != 0) { for (l = r.getTable(0).getRows(), s = r.getTable(0).getColumnsName(), h = 0; h < l.length; h++) { for (c = l[h].getJSCells(), e = 0; e < s.length; e++)c[s[e]] = t.readDataOfColumn(s[e], c[s[e]]); t.bufferList[h] = c; a++ } console.log(r.getTable(0).lookupDirect) } r.dispose(); r = null } u && n.MLookupCache.addRecordLookup(t.gTable._windowNo, t.gTable._tabNo, u); t.cardTempalte = f; i.card_ID > 0 && f && f.DisableWindowPageSize && (t.pazeSize = t.rowCount, t.currentPage = 1) } catch (v) { t.log.Log(o.SEVERE, t.SQL, v) } t.fireQueryCompleted(!0); t = null }) }; u.prototype.getCardTemplate = function () { return this.cardTempalte }; u.prototype.readDataOfColumn = function (t, i) { var u, f, r, o, e; if (i == null) return i; try { if (u = this.getField(t), u == null) return i; f = u.getColumnName(); r = u.getDisplayType(); n.DisplayType.IsID(r) && (f.endsWith("_ID") || f.endsWith("_Acct")) || f.endsWith("atedBy") || f.endsWith("_ID_1") || f.endsWith("_ID_2") || f.endsWith("_ID_3") || r == n.DisplayType.Integer ? i = n.Utility.Util.getValueOfInt(i) : n.DisplayType.IsNumeric(r) ? i = n.Utility.Util.getValueOfDecimal(i) : n.DisplayType.IsDate(r) ? dte = null : r == n.DisplayType.RowID ? i = null : r == n.DisplayType.YesNo ? (o = i.toString(), u.getIsEncryptedColumn() && (o = this.decrypt(o)), i = o.equals("Y")) : n.DisplayType.IsLOB(r) ? (e = i, e == null && (i = null), i = typeof e == typeof string ? e.toString() : e) : i = i.toString(); u.getIsEncryptedColumn() && r != n.DisplayType.YesNo && (i = this.decrypt(i)); u.getObscureType() && r != n.DisplayType.YesNo && (i = this.decrypt(i)) } catch (s) { console.log(s) } return i }; u.prototype.encrypt = function (t) { return t == null || t.length < 1 ? t : n.secureEngine.encrypt(t) }; u.prototype.decrypt = function (t) { return t == null || t.length < 1 ? t : n.secureEngine.isEncrypted(t) ? n.secureEngine.decrypt(t) : t }; u.prototype.dataSave = function (n, t) { return arguments.length == 2 ? !this.changed && (typeof this.rowChanged == "undefined" || this.rowChanged == -1) ? !0 : n == this.rowChanged ? !0 : this.dataSaveL(t) == u.prototype.SAVE_OK : this.dataSaveL(t) }; u.prototype.dataSaveL = function (i) { var s, h, w, b, v, p, r, u, a, tt, f; if (!this.isOpen) return this.log.warning("Error - Open=" + this.isOpen), this.SAVE_ERROR; if (this.rowChanged == -1 && (this.log.config("NoNeed - Changed=" + this.changed + ", Row=" + this.rowChanged), !i)) return this.SAVE_OK; if (this.rowData == null) return this.log.fine("No Changes"), this.SAVE_ERROR; if (this.readOnly) return log.warning("IsReadOnly - ignored"), this.dataIgnore(), this.SAVE_ACCESS; if (this.rowChanged == -1) if (this.newRow != -1) this.rowChanged = this.newRow; else return this.fireDataStatusEEvent("SaveErrorNoChange", "", !1), this.SAVE_ERROR; var k = this.getClientOrg(this.rowChanged), d = k[0], g = k[1]; if (!n.MRole.canUpdate(d, g, this.AD_Table_ID, 0, !0)) return this.fireDataStatusEEvent("AccessTableNoUpdate", "", !0), this.dataIgnore(), this.SAVE_ACCESS; for (s = this.getRow(this.rowChanged), r = 0; r < this.gridFields.length; r++)if (h = this.gridFields[r], n.DisplayType.IsString(h.getDisplayType()) && h.value != null && h.value.toString().trim().length > 0 && !new RegExp(h.getVFormat()).test(h.value)) return this.fireDataStatusEEvent("RegexFailed", (h.getHeader() == "" ? h.getColumnName() : h.getHeader()) + "\n", !0), h.propertyChangeListner.ctrl.focus(), this.SAVE_ERROR; if (w = this.getMandatory(s), w.length != 0) return this.fireDataStatusEEvent("FillMandatory", w + "\n", !0), this.SAVE_MANDATORY; if (this.checkMaxMin()) { if (b = this.getErrorColumns(), b.length != 0) return this.fireDataStatusEEvent("Error", b + "\n", !0), this.SAVE_ERROR; v = 0; this.inserting || (v = this.getKeyID(this.rowChanged)); var nt = [], y = this.gridFields, it = y.length; nt = this.createGridFieldArr(y); var l = this.createGridFieldArr(y, !0), e = this.createObsecureFields(y), c = {}, o = {}; if (t.extend(!0, c, s), t.extend(!0, o, this.rowData), l && l.length > 0) for (p = l.length, r = 0; r < p; r++)c[l[r]] && (c[l[r]] = this.encrypt(c[l[r]])), o[l[r]] && (o[l[r]] = this.encrypt(o[l[r]])); if (e && e.length > 0) for (p = e.length, r = 0; r < p; r++)(c[e[r]] || c[e[r]] == 0) && (c[e[r]] = this.encrypt(c[e[r]])), (o[e[r]] || o[e[r]] == 0) && (o[e[r]] = this.encrypt(o[e[r]])); if (u = { Record_ID: v, AD_Table_ID: this.AD_Table_ID, TableName: this.gTable._tableName, Inserting: this.inserting, CompareDB: this.compareDB, RowData: c, OldRowData: o, ManualCmd: i, WhereClause: this.getWhereClause(s), Fields: nt, AD_Client_ID: d, AD_Org_ID: g, SelectSQL: n.secureEngine.encrypt(this.SQL_Select), AD_WIndow_ID: y[0].getAD_Window_ID(), MaintainVersions: !1, UnqFields: this.gFieldUnique }, this.selectedTreeNode > 0 && (u.SelectedTreeNodeID = this.selectedTreeNode), this.treeNode_ID > 0 && (u.ParentNodeID = this.treeNode_ID, u.TreeID = this.treeID, u.TreeTableID = this.treeTable_ID), this.onlyCurrentDays == 0 && (this.IsMaintainVersions || this.maintainVersionFieldChanged(c, o))) { if (a = this, o.updatedby == null) { if (!this.MaintainVerOnApproval || this.MaintainVerOnApproval && n.context.getWindowContext(this.gTable._windowNo, n.Env.approveCol) == "Y") { u.MaintainVersions = !0; u.ImmediateSave = !0; u.ValidFrom = (new Date).toISOString(); a.showVersions(a, v, u, s, !0); return } return f = a.dataSaveDB(u, s), f.Status == "E" ? f.FireEEvent || f.FireIEvent || n.ADialog.info(f.ErrorMsg) : f.Status == "W" && (n.ADialog.info("SentForApproval"), a.dataRefreshAll()), f.Status } if (this.MaintainVerOnApproval && n.context.getWindowContext(this.gTable._windowNo, n.Env.approveCol) != "Y") return f = this.dataSaveDB(u, s), f.Status; tt = n.dataContext.getJSONData(n.Application.contextUrl + "Common/CheckVersions", { RowData: u }); tt.result ? n.ADialog.confirm("FoundVersions", !0, "", "Confirm", function (n) { n && a.showVersions(a, v, u, s, !1) }) : a.showVersions(a, v, u, s, !1) } else return f = this.dataSaveDB(u, s), f.Status } }; u.prototype.showVersions = function (t, i, r, u, f) { var e = new n.MasterDataVersion(t.gTable._tableName, t.gridFields, i, r.WhereClause, t.IsMaintainVersions, f, function (i, f, e) { r.MaintainVersions = !0; r.ImmediateSave = i; r.ValidFrom = new Date(f).toISOString(); r.VerRecID = e; var o = t.dataSaveDB(r, u); return o.Status != "O" && (o.Status == "E" ? o.FireEEvent || o.FireIEvent || n.ADialog.info(o.ErrorMsg) : (i || o.LatestVersion || t.dataRefreshAll(), o.Status == "W" ? n.ADialog.info("SentForApproval") : o.Status == "F" ? n.ADialog.info("SavedForFuture") : o.Status == "B" && n.ADialog.info("SavedForBackDate"))), o.Status }); e.show() }; u.prototype.dataSaveDB = function (i, r) { var u = n.dataContext.insertOrUpdateWRecord(i); return u = JSON.parse(u), u.IsError || (u.RowData && t.extend(!0, r, this.readDataOfObject(u.RowData)), this.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH, r, this.rowChanged), this.fireRowChanged(!0, this.getKeyID(this.rowChanged)), this.rowData = null, this.changed = !1, this.compareDB = !0, this.rowChanged = -1, this.newRow = -1, this.inserting = !1), u.ErrorMsg != null && this.log.log(n.Logging.Level.SEVERE, u.ErrorMsg), u.FireEEvent ? this.fireDataStatusEEvent(u.EventParam.Msg, u.EventParam.Info, u.EventParam.IsError, u.IsWarning) : u.FireIEvent && this.fireDataStatusIEvent(u.EventParam.Msg, u.EventParam.Info, u.EventParam.IsError), u }; u.prototype.createGridFieldArr = function (n, t) { var u = n.length, f, r, i; if (t) { if (this.gFieldLessData) return this.gFieldLessData; for (this.gFieldLessData = [], r = 0; r < u; r++)i = n[r], f = i.getColumnName().toLowerCase(), i.getIsEncryptedColumn() && this.gFieldLessData.push(f); return this.gFieldLessData } if (this.gFieldData) return this.gFieldData; for (this.gFieldData = [], this.gFieldUnique = [], r = 0; r < u; r++)i = n[r], this.gFieldData.push({ IsVirtualColumn: i.getIsVirtualColumn(), DisplayType: i.getDisplayType(), ColumnName: i.getColumnName(), IsKey: i.getIsKey(), ColumnSQL: i.getColumnSQL(!0), IsEncryptedColumn: i.getIsEncryptedColumn(), IsParentColumn: i.getIsParentColumn(), Name: i.getHeader(), IsUnique: i.getIsUnique(), IsObscure: i.getObscureType() ? !0 : !1 }), i.getIsUnique() && !i.getIsVirtualColumn() && i.getIsDisplayed() && this.gFieldUnique.push(i.getColumnName()); return this.gFieldData }; u.prototype.createObsecureFields = function (n) { var r = n.length, t, i; if (this.gFieldObscureList) return this.gFieldObscureList; for (this.gFieldObscureList = [], t = 0; t < r; t++)i = n[t], i.getObscureType() && this.gFieldObscureList.push(i.getColumnName().toLowerCase()); return this.gFieldObscureList }; u.prototype.dataRefreshAll = function () { this.inserting = !1; this.dataIgnore(); this.close(!1); this.open(this.maxRows); this.dseEvent = "Refreshed" }; u.prototype.dataRequery = function (n) { return this.close(!1), this.setSelectWhereClause(n), this.rowData = null, this.changed = !1, this.rowChanged = -1, this.inserting = !1, this.open(this.maxRows), this.dseEvent = "Refreshed", !0 }; u.prototype.dataRefresh = function (t) { var e, r; if (t < 0 || this.getRowCount() == 0 || this.inserting) return null; e = this.getRow(t); this.dataIgnore(); r = this.getWhereClause(e); (r == null || r.length == 0) && (r = "1=2"); var i = this.SQL_Select + " WHERE " + r, f = null, u = null; try { i = n.secureEngine.encrypt(i); u = n.dataContext.getWindowRecord(i, this.createGridFieldArr(this.gridFields, !0), this.createObsecureFields(this.gridFields)); u.read() && (f = this.readData(u)); f.recid = e.recid } catch (s) { return i = n.secureEngine.decrypt(i), this.log.log(o.SEVERE, i, s), this.fireDataStatusEEvent("RefreshError", i, !0), null } finally { u != null && u.dispose() } return this.rowData = null, this.changed = !1, this.rowChanged = -1, this.inserting = !1, this.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH, f), this.fireDataStatusIEvent("Refreshed", ""), f }; u.prototype.dataNew = function (t, i) { var c, s, e, a, h, o, u, f; if (this.log.info("Current=" + t + ", Copy=" + i), this.readOnly) return this.fireDataStatusEEvent("AccessCannotInsert", "", !0), !1; if (this.inserting = !0, c = this.gridFields.length, this.rowData = {}, s = {}, e = this.gTable._windowNo + n.EnvConstants.WINDOW_TEMP, i) for (a = this.getRow(t), o = 0; o < c; o++) { var u = this.gridFields[o], r = u.getColumnName(), l = r.toLowerCase(); u.getIsVirtualColumn() || (u.getIsKey() || r.equals("AD_Client_ID") || r.equals("IsActive") || r.startsWith("Created") || r.startsWith("Updated") || r.equals("EntityType") || r.equals("DocumentNo") || r.equals("Processed") || r.equals("IsSelfService") || r.equals("DocAction") || r.equals("DocStatus") || r.startsWith("Ref_") || r.equals("Posted") || r.equals("GrandTotal") || r.equals("TotalLines") || r.equals("C_CashLine_ID") || r.equals("C_Payment_ID") || r.equals("IsPaid") || r.equals("IsAllocated") || r.equalsIgnoreCase("C_Location_ID") || r.equals("IsApproved") || r.equals("IsDelivered") || r.equals("IsInvoiced") || r.equals("TotalDr") || r.equals("TotalCr") || r.equalsIgnoreCase("I_IsImported") ? (f = u.getDefault(this.ctx, e), s[l] = f, f != null && this.ctx.setWindowContext(e, u.getColumnName(), f.toString())) : u.getIsCopy() ? (h = a[r.toLowerCase()], s[l] = h, h != null && this.ctx.setWindowContext(e, u.getColumnName(), h.toString())) : (f = u.getDefault(this.ctx, e), s[l] = f, f != null && this.ctx.setWindowContext(e, u.getColumnName(), f.toString()))) } else for (o = 0; o < c; o++)u = this.gridFields[o], f = u.getDefault(this.ctx, e), s[u.getColumnName().toLowerCase()] = f, f != null && this.ctx.setWindowContext(e, u.getColumnName(), f.toString()); return this.ctx.removeWindow(e), this.changed = !0, this.compareDB = !0, this.newRow = t + 1, this.getRowCount() < this.newRow && (this.newRow = this.getRowCount()), this.rowChanged = this.newRow, this.rowCount++, s.recid = this.rowCount, this.pazeSize++, this.fireTableModelChanged(n.VTable.prototype.ROW_ADD, s, this.newRow, null), this.log.fine("Current=" + this.currentRow + ", New=" + this.newRow + " - complete"), !0 }; u.prototype.dataDelete = function (t, i) { var f, l, r, s, w; if (!t || t.length < 0) return !1; if (this.readOnly) return this.fireDataStatusEEvent("AccessCannotDelete", "", !0), !1; if (!this.deleteable) return this.fireDataStatusEEvent("AccessNotDeleteable", "", !0), !1; var h = this.gTable._indexKeyColumn != -1, y = this.gTable._indexProcessedColumn > 0 && !this.gTable._tableName.startsWith("I_"), e = [], c = [], a = [], v = [], p = this.AD_Table_ID, u = null; for (f = 0; f < t.length; f++) { if (u = this.mSortList[t[f]], y && (l = this.getValueAt(t[f], "processed"), l != null && l)) { e.push(u.recid); continue } c.push(u.recid); h ? a.push(u[this.keyColumnName.toLowerCase()]) : v.push(this.getWhereClause(u)) } if (r = null, c.length > 0) s = { RecIds: c, HasKeyColumn: h, TableName: this.gTable._tableName, AD_Table_ID: p }, h ? s.SingleKeyWhere = a : s.MultiKeyWhere = v, r = n.dataContext.deleteWRecords(s), r = JSON.parse(r); else if (e.length > 0) return this.fireDataStatusEEvent("CannotDeleteTrx", "", !0), !1; if (r) { if (w = null, selIndexOrId = r.UnDeletedRecIds && r.UnDeletedRecIds.length > 0 ? r.UnDeletedRecIds : e.length > 0 ? e : i, r.DeletedRecIds && r.DeletedRecIds.length > 0 && (this.rowCount -= r.DeletedRecIds.length, this.fireTableModelChanged(n.VTable.prototype.ROW_DELETE, r.DeletedRecIds, selIndexOrId), r.RecIds && r.RecIds.length > 0 && this.fireRowChanged(!1, r.RecIds)), r.ErrorMsg && this.log.log(o.SEVERE, r.ErrorMsg), r.InfoMsg && this.log.log(o.Info, r.InfoMsg), r.IsError) return r.FireEEvent && this.fireDataStatusEEvent(r.EventParam.Msg, r.EventParam.Info, r.EventParam.IsError), !1; this.changed = !1; this.rowChanged = -1; this.fireDataStatusIEvent("Deleted", "") } return !0 }; u.prototype.dataDeleteAsync = function (t, i) { var r = this; return new Promise(function (u) { var e, a, p, h; if (!t || t.length < 0) { u(!1); return } if (r.readOnly) { r.fireDataStatusEEvent("AccessCannotDelete", "", !0); u(!1); return } if (!r.deleteable) { r.fireDataStatusEEvent("AccessNotDeleteable", "", !0); u(!1); return } var c = r.gTable._indexKeyColumn != -1, w = r.gTable._indexProcessedColumn > 0 && !r.gTable._tableName.startsWith("I_"), s = [], l = [], v = [], y = [], b = r.AD_Table_ID, f = null; for (e = 0; e < t.length; e++) { if (f = r.mSortList[t[e]], w && (a = r.getValueAt(t[e], "processed"), a != null && a)) { s.push(f.recid); continue } l.push(f.recid); c ? v.push(f[r.keyColumnName.toLowerCase()]) : y.push(r.getWhereClause(f)) } if (p = null, l.length > 0) h = { RecIds: l, HasKeyColumn: c, TableName: r.gTable._tableName, AD_Table_ID: b }, c ? h.SingleKeyWhere = v : h.MultiKeyWhere = y, p = n.dataContext.deleteWRecords(h).then(function (t) { if (t = JSON.parse(t), t) { if (selIndexOrId = t.UnDeletedRecIds && t.UnDeletedRecIds.length > 0 ? t.UnDeletedRecIds : s.length > 0 ? s : i, t.DeletedRecIds && t.DeletedRecIds.length > 0 && (r.rowCount -= t.DeletedRecIds.length, r.fireTableModelChanged(n.VTable.prototype.ROW_DELETE, t.DeletedRecIds, selIndexOrId), t.RecIds && t.RecIds.length > 0 && r.fireRowChanged(!1, t.RecIds)), t.ErrorMsg && r.log.log(o.SEVERE, t.ErrorMsg), t.InfoMsg && r.log.log(o.Info, t.InfoMsg), t.IsError) { t.FireEEvent && r.fireDataStatusEEvent(t.EventParam.Msg, t.EventParam.Info, t.EventParam.IsError); u(!1); return } r.changed = !1; r.rowChanged = -1; r.fireDataStatusIEvent("Deleted", ""); u(!0); return } }); else if (s.length > 0) { r.fireDataStatusEEvent("CannotDeleteTrx", "", !0); u(!1); return } }) }; u.prototype.readData = function (n) { var r = {}, u = this.gridFields.length, t = null, i; try { for (i = 0; i < u; i++)t = this.gridFields[i].getColumnName().toLowerCase(), r[t] = this.readDataOfColumn(t, n.getCell(t)), t = null; return r } catch (f) { throw f; } }; u.prototype.readDataOfObject = function (t) { var f = {}, e = this.gridFields.length, r = null, i = [], u; try { for (u = 0; u < e; u++)r = this.gridFields[u].getColumnName().toLowerCase(), f[r] = this.readDataOfColumn(r, t[r]), this.gridFields[u].getDisplayType() == n.DisplayType.Image && i.push("imgurlcolumn" + r), r = null; if (i && i.length > 0) for (k = 0; k < i.length; k++)f[i[k]] = this.readDataOfColumn(i[k], t[i[k]]); return f } catch (o) { throw o; } }; u.prototype.close = function (n) { this.isOpen && (n, !this.inserting, this.bufferList != null && (this.bufferList.length = 0, this.bufferList = null, this.bufferList = [], this.mSortList = null), this.mSortList != null && (this.mSortList = null), n && this.dispose(), this.isOpen = !1) }; u.prototype.dataIgnore = function (i) { if (this.inserting || this.changed || !(this.rowChanged < 0)) { if (this.inserting) this.rowCount--, this.pazeSize--, this.changed = !1, this.rowChanged = -1, this.inserting = !1, this.fireTableModelChanged(n.VTable.prototype.ROW_UNDO, this.mSortList[this.newRow].recid, this.newRow); else if (this.rowData != null) { var r = this.getRow(this.rowChanged); t.extend(r, this.rowData) } return this.changed = !1, this.rowChanged = -1, this.rowData = null, this.inserting = !1, this.newRow = -1, i || this.fireDataStatusIEvent("Ignored", ""), !0 } }; u.prototype.createDSE = function () { var t = this.changed, n; return this.rowChanged != -1 && (t = !0), n = new e(null, this.getRowCount(), t, !1, this.inserting), n.setPageInfo(this.currentPage, this.rowCount, this.pazeSize), n.AD_Table_ID = this.gTable._AD_Table_ID, n.Record_ID = null, n }; u.prototype.fireDataStatusChanged = function (n) { this.mDataListener && this.mDataListener.dataStatusChanged(n); n = null }; u.prototype.fireTableModelChanged = function (n, t, i, r) { this.mCardModelListener && this.mCardModelListener.tableModelChanged(n, t, i, r); this.mTableModelListener && this.mTableModelListener.tableModelChanged(n, t, i, r) }; u.prototype.fireRowChanged = function (n, t) { this.mRowChangedListener && this.mRowChangedListener.rowChanged(n, t) }; u.prototype.fireDataStatusIEvent = function (n, t) { var i = this.createDSE(); i.setInfo(n, t, !1, !1); this.fireDataStatusChanged(i) }; u.prototype.fireQueryCompleted = function (n) { this.mQueryCompletedListener && this.mQueryCompletedListener.queryCompleted(n); n = null }; u.prototype.fireDataStatusEEvent = function (n, t, i, r) { if (arguments.length === 1) this.fireDataStatusEEvent(arguments[0].value, arguments[0].name, !0, !1); else { var u = this.createDSE(); r ? i = !r : r = !i; u.setInfo(n, t, i, r); this.fireDataStatusChanged(u) } }; u.prototype.addDataStatusListener = function (n) { this.mDataListener = n }; u.prototype.removeDataStatusListener = function () { this.mDataListener = null }; u.prototype.addQueryCompleteListner = function (n) { this.mQueryCompletedListener = n }; u.prototype.removeQueryCompleteListner = function () { this.mQueryCompletedListener = null }; u.prototype.addTableModelListener = function (n) { this.mTableModelListener = n }; u.prototype.removeTableModelListener = function (n) { this.mTableModelListener = null; n = null }; u.prototype.addCardModelListener = function (n) { this.mCardModelListener = n }; u.prototype.removeCardModelListener = function (n) { this.mCardModelListener = null; n = null }; u.prototype.addRowChangedListener = function (n) { this.mRowChangedListener = n }; u.prototype.removeRowChangedListener = function (n) { this.mRowChangedListener = null; n = null }; u.prototype.updateTableModel = function (t) { var i = t.getColumnName(), r = t.getDisplayType(); r == n.DisplayType.Integer || n.DisplayType.IsID(r) && (i.endsWith("_ID") || i.endsWith("_Acct") || i.endsWith("_ID_1") || i.endsWith("_ID_2") || i.endsWith("_ID_3")) || i.endsWith("atedBy") ? this.defaultModel[i.toLowerCase()] = new Number : n.DisplayType.IsNumeric(r) ? this.defaultModel[i.toLowerCase()] = new Number : n.DisplayType.IsDate(r) ? this.defaultModel[i.toLowerCase()] = new Date : r == n.DisplayType.RowID ? (dc = new DataColumn(i, typeof Object), this.defaultModel[i.toLowerCase()] = {}) : this.defaultModel[i.toLowerCase()] = r == n.DisplayType.YesNo ? new Boolean : n.DisplayType.IsLOB(r) ? new String : new String }; u.prototype.dispose = function () { var n, t; for (originalLength = this.gridFields.length, t = originalLength; t > 0; t--)n = this.gridFields.pop(), n.dispose(), n = null; this.gridFields.length = 0; this.gTable = null; this.gridFields = null; this.gFieldLessData = null; this.gFieldData = null; this.gFieldUnique = null }; u.prototype.maintainVersionFieldChanged = function (n, t) { var i, r; if (this.gridFields && this.gridFields.length > 0) for (i = 0; i < this.gridFields.length; i++)if (this.gridFields[i].vo.IsMaintainVersions && (r = this.gridFields[i].vo.ColumnName.toLowerCase(), n[r] != t[r])) return !0; return !1 }; r.prototype.PROPERTY = "FieldValue"; r.prototype.INSERTING = "FieldValueInserting"; r.prototype.setGridTab = function (n) { this.gridTab = n }; r.prototype.getIsInserting = function () { return this.inserting }; r.prototype.getIsDisplayed = function (t) { var u; if (arguments.length == 0) return this.vo.IsDisplayedf; if (!this.vo.IsDisplayedf) return !1; if (this.vo.DisplayLogic == null || this.vo.DisplayLogic.equals("")) return !0; if (t) { for (var i = !1, r = [], f = [], e = new n.StringTokenizer(this.vo.DisplayLogic, "[]"); e.hasMoreTokens();)u = e.nextToken(), u.trim() != " & ".trim() ? (i = n.Evaluator.evaluateLogic(this, u), r.push(i)) : f.push(u); return r.length > 1 && (f[0].trim().equals("&") ? i = r.indexOf(!1) > -1 ? !1 : !0 : f[0].trim().equals("|") && r.indexOf(!0) > -1 && (i = !0)), i } return !0 }; r.prototype.getIsDisplayedMR = function (t) { var u; if (arguments.length == 0) return this.vo.IsDisplayedMR; if (!this.vo.IsDisplayedMR) return !1; if (this.vo.DisplayLogic == null || this.vo.DisplayLogic.equals("")) return !0; if (t) { for (var i = !1, r = [], f = [], e = new n.StringTokenizer(this.vo.DisplayLogic, "[]"); e.hasMoreTokens();)u = e.nextToken(), u.trim() != " & ".trim() ? (i = n.Evaluator.evaluateLogic(this, u), r.push(i)) : f.push(u); return r.length > 1 && (f[0].trim().equals("&") ? i = r.indexOf(!1) > -1 ? !1 : !0 : f[0].trim().equals("|") && r.indexOf(!0) > -1 && (i = !0)), i } return !0 }; r.prototype.getColumnName = function () { return this.vo.ColumnName }; r.prototype.getIsLongField = function () { return this.vo.DisplayLength >= 30 }; r.prototype.getFieldColSpan = function () { return this.vo.DisplayLength <= 9 ? 1 : this.vo.DisplayLength <= 19 ? 2 : this.vo.DisplayLength <= 29 ? 3 : 4 }; r.prototype.getIsMandatory = function (t) { var r, i; return t && this.vo.mandatoryLogic != null && this.vo.mandatoryLogic.length > 0 && (r = n.Evaluator.evaluateLogic(this, this.vo.mandatoryLogic), r) ? !0 : !this.vo.IsMandatoryUI || this.getIsVirtualColumn() ? !1 : (i = this.vo, i.IsKey && i.ColumnName.endsWith("_ID") || i.ColumnName.startsWith("Created") || i.ColumnName.startsWith("Updated") || i.ColumnName.equals("M_AttributeSetInstance_ID")) ? !1 : this.getIsDisplayed(t) }; r.prototype.getDisplayType = function () { return this.vo.displayType }; r.prototype.getOrginalDisplayType = function () { return this.vo.orginalDispaly }; r.prototype.getIsVirtualColumn = function () { return this.vo.ColumnSQL && this.vo.ColumnSQL.length > 0 ? !0 : !1 }; r.prototype.getIsReadOnly = function () { return this.getIsVirtualColumn() ? !0 : this.vo.IsReadOnly }; r.prototype.setReadOnly = function (n) { this.vo.IsReadOnly = n }; r.prototype.getIsEditable = function (t, i) { var r = this.vo, o, u, h, e, s, c; if (this.getIsVirtualColumn()) return !1; if (r.ColumnName.equals("Posted") || r.ColumnName.equals("Record_ID") && r.displayType == n.DisplayType.Button || (o = i && !(this.vo.DisplayLogic == null || this.vo.DisplayLogic.equals("")), r.IsAlwaysUpdateable && !r.tabReadOnly && !o)) return !0; if (r.tabReadOnly || r.IsReadOnly || !r.IsUpdateable && !this.inserting || r.ColumnName.equals(n.context.getWindowTabContext(r.windowNo, r.tabNo, "LinkColumnName"))) return !1; if (u = n.context, t) { h = parseInt(u.getTabRecordContext(r.windowNo, r.tabNo, "AD_Client_ID")); r.ColumnName.equals("AD_Org_ID") && (u.getWindowContext(r.windowNo, "AD_Org_ID") == null || u.getWindowContext(r.windowNo, "AD_Org_ID").length == 0) && u.setWindowContext(r.windowNo, "AD_Org_ID", u.getContext("#AD_Org_ID")); var l = parseInt(u.getTabRecordContext(r.windowNo, r.tabNo, "AD_Org_ID")), f = u.getWindowTabContext(r.windowNo, r.tabNo, "KeyColumnName"), a = r.AD_Window_ID; if (("EntityType".equals(f) && (f = "AD_EntityType_ID"), f.toUpperCase().endsWith("_ID") || (f += "_ID"), e = u.getWindowTabContext(r.windowNo, r.tabNo, f), e == "" && (e = 0), s = r.AD_Table_ID, !n.MRole.canUpdate(h, l, s, e, !1) || !n.MRole.getWindowAccess(a)) || !n.MRole.getIsColumnAccess(s, this.vo.AD_Column_ID, !1)) return !1 } return t && r.ReadOnlyLogic.length > 0 && (c = !n.Evaluator.evaluateLogic(this, r.ReadOnlyLogic), !c) ? !1 : r.ColumnName.equals("Processing") || r.ColumnName.equals("DocAction") || r.ColumnName.equals("GenerateTo") ? !0 : t && (u.getWindowContext(r.windowNo, r.tabNo, "Processed").equals("Y") || u.getWindowContext(r.windowNo, r.tabNo, "Processing").equals("Y")) && !o ? !1 : r.ColumnName.equals("IsActive") ? !0 : t && !u.getWindowContext(r.windowNo, r.tabNo, "IsActive").equals("Y") ? !1 : i ? this.getIsDisplayedMR(t) : this.getIsDisplayed(t) }; r.prototype.getWindowNo = function () { return this.vo.windowNo }; r.prototype.getIsHeading = function () { return this.vo.IsHeading }; r.prototype.getIsSameLine = function () { return this.vo.IsSameLine }; r.prototype.getHeader = function () { return this.vo.Header }; r.prototype.getDescription = function () { return this.vo.Description }; r.prototype.getHelp = function () { return this.vo.Help }; r.prototype.getAD_Process_ID = function () { return this.vo.AD_Process_ID }; r.prototype.getAD_Form_ID = function () { return this.vo.AD_Form_ID }; r.prototype.getAD_Column_ID = function () { return this.vo.AD_Column_ID }; r.prototype.getAD_Field_ID = function () { return this.vo.AD_Field_ID }; r.prototype.getFieldGroup = function () { return this.vo.FieldGroup }; r.prototype.getIsFieldOnly = function () { return this.vo.IsFieldOnly }; r.prototype.getShowLabel = function () { return !0 }; r.prototype.getIsKey = function () { return this.vo.IsKey }; r.prototype.getIsParentColumn = function () { return this.vo.IsParent }; r.prototype.getSortNo = function () { return this.vo.SortNo }; r.prototype.getMRSeqNo = function () { return this.vo.mrSeqNo }; r.prototype.getIsSelectionColumn = function () { return this.vo.IsSelectionColumn }; r.prototype.getSelectionSeqNo = function () { return this.vo.SelectionSeqNo }; r.prototype.getIsIncludedColumn = function () { return this.vo.IsIncludedColumn }; r.prototype.getDependentOn = function () { var t = [], i = this.getColumnName(); return i.equals("M_AttributeSetInstance_ID") ? t.push("M_Product_ID") : (i.equals("M_Locator_ID") || i.equals("M_LocatorTo_ID")) && (t.push("M_Product_ID"), t.push("M_Warehouse_ID")), n.Evaluator.parseDepends(t, this.vo.DisplayLogic), n.Evaluator.parseDepends(t, this.vo.ReadOnlyLogic), this.lookup != null && n.Evaluator.parseDepends(t, this.lookup.getValidation()), t }; r.prototype.getAD_Window_ID = function () { return this.vo.AD_Window_ID }; r.prototype.getAD_InfoWindow_ID = function () { return this.vo.AD_InfoWindow_ID }; r.prototype.getValueAsString = function (t) { var i = n.context.getWindowContext(this.vo.windowNo, this.vo.tabNo, t, !0); return i ? i.toString() : "" }; r.prototype.getColumnSQL = function (t) { return arguments.length == 0 ? this.vo.ColumnName : this.vo.ColumnSQL != null && this.vo.ColumnSQL.length > 0 ? t ? (this.vo.displayType == n.DisplayType.YesNo, this.vo.ColumnSQL + " AS " + this.vo.ColumnName) : (this.vo.displayType == n.DisplayType.YesNo, this.vo.ColumnSQL) : (this.vo.displayType == n.DisplayType.YesNo, this.vo.ColumnName) }; r.prototype.getIsLink = function () { return this.vo.isLink }; r.prototype.getIsRightPaneLink = function () { return this.vo.isRightPaneLink }; r.prototype.getColumnWidth = function () { return this.vo.ColumnWidth }; r.prototype.getIsAlwaysUpdateable = function () { return this.getIsVirtualColumn() || !this.vo.IsUpdateable ? !1 : this.vo.IsAlwaysUpdateable }; r.prototype.getIsEncryptedField = function () { return this.vo.IsEncryptedField }; r.prototype.getIsEncrypted = function () { if (this.vo.IsEncryptedField) return !0; var n = this.getObscureType(); return n != null && n.length > 0 ? !0 : this.vo.ColumnName.equals("Password") }; r.prototype.getObscureType = function () { return this.vo.ObscureType }; r.prototype.getDisplayLength = function () { return this.vo.DisplayLength }; r.prototype.getFieldLength = function () { return this.vo.FieldLength }; r.prototype.getMinValue = function () { return this.vo.ValueMin }; r.prototype.getMaxValue = function () { return this.vo.ValueMax }; r.prototype.getVFormat = function () { return this.vo.VFormat }; r.prototype.getVFormatError = function () { return this.vo.VFormatError }; r.prototype.getLookup = function () { return this.lookup }; r.prototype.getIsError = function () { return this.error }; r.prototype.getIsCopy = function () { return this.vo.IsCopy }; r.prototype.getCallout = function () { return this.vo.Callout }; r.prototype.getValue = function () { return this.value }; r.prototype.getIsIdentifier = function () { return this.vo.IsIdentifier }; r.prototype.getOldValue = function () { return this.oldValue }; r.prototype.getIsRange = function () { return this.vo.isRange }; r.prototype.getIsRange = function () { return this.vo.isRange }; r.prototype.getIsParentValue = function () { var i = n.context, t; return this.parentValue != null ? this.parentValue : (n.DisplayType.IsID(this.vo.displayType) && this.vo.tabNo != 0 ? (t = i.getWindowTabContext(this.vo.windowNo, this.vo.tabNo, "LinkColumnName"), this.parentValue = t.length == 0 ? !1 : this.vo.ColumnName.equals(t), this.parentValue && this.log.config(this.parentValue + " - Link(" + t + ", W=" + this.vo.windowNo + ",T=" + this.vo.tabNo + ") = " + this.vo.ColumnName)) : this.parentValue = !1, this.parentValue) }; r.prototype.getDefault = function (t, i) { var r = this.vo, c, u, s, w, f, l, v, h, g; if (r.IsKey || r.displayType == n.DisplayType.RowID || n.DisplayType.IsLOB(r.displayType)) return null; if (this.getIsParentValue() && n.Utility.Util.isEmpty(r.DefaultValue)) return c = t.getWindowContext(r.windowNo, r.ColumnName), this.gridTab && (c = t.getWindowContext(r.windowNo, this.gridTab.getParentTabNo(), r.ColumnName)), this.log.fine("[Parent] " + r.ColumnName + "=" + c), this.createDefault(r.ColumnName, c); if (r.ColumnName.equals("IsActive")) return this.log.fine("[IsActive] " + r.ColumnName + "=Y"), !0; if (n.Consts.ACCESSLEVEL_SystemOnly.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && (r.ColumnName.equals("AD_Client_ID") || r.ColumnName.equals("AD_Org_ID"))) return this.log.fine("[SystemAccess] " + r.ColumnName + "=0"), 0; if (n.Consts.ACCESSLEVEL_SystemPlusClient.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && r.ColumnName.equals("AD_Org_ID")) return this.log.fine("[ClientAccess] " + r.ColumnName + "=0"), 0; if (u = "", r.DefaultValue.startsWith("@SQL=")) { var y = r.DefaultValue.substring(5), e = n.Env.parseContext(t, r.windowNo, y, !1, !0), p = e.toUpperCase(); if (p.indexOf("DELETE ") != -1 && p.indexOf("UPDATE ") != -1 && p.indexOf("DROP ") != -1 && (e = ""), e.equals("")) this.log.log(o.WARNING, "(" + r.ColumnName + ") - Default SQL variable parse failed: " + y); else { s = null; try { s = a(e); s.read() ? u = s.getString(0) : this.log.log(o.WARNING, "(" + r.ColumnName + ") - no Result: " + e); s.close() } catch (k) { e.endsWith("=") ? this.log.log(o.SEVERE, "(" + r.ColumnName + ") " + y, k) : this.log.log(o.WARNING, "(" + r.ColumnName + ") " + e, k) } finally { s != null && s.dispose() } } if (u != null && u.length > 0) return this.log.fine("[SQL] " + r.ColumnName + "=" + u), this.createDefault("", u) } if (!r.DefaultValue.equals("") && !r.DefaultValue.startsWith("@SQL=")) for (u = "", w = new n.StringTokenizer(r.DefaultValue, ",;", !1); w.hasMoreTokens();) { if (f = w.nextToken().trim(), f.equals("@SysDate@") || f.equals("@Now@")) return l = new Date, l.setMilliseconds(0), l.setSeconds(0), l.toISOString(); if (u = f.indexOf("@") != -1 ? t.getWindowContext(r.windowNo, f.replaceAll("@", " ").trim()) : f.startsWith("'") && f.endsWith("'") ? f.length - 2 > 0 ? f.substring(1, f.length - 1) : f.replaceAll("'", "") : f, u.length > 0) return this.log.fine("[DefaultValue] " + r.ColumnName + "=" + u), this.createDefault(f, u) } if (this.lookup != null && !n.Utility.Util.isEmpty(this.lookup.getValidation())) { var nt = this.lookup.getValidation(), d = n.Evaluator.getVariables(nt), b = !1; for (v = 0; v < d.length; v++)if (h = d[v], !h.startsWith("#") && h.toUpperCase().endsWith("_ID") && !h.equals(r.ColumnName) && (g = t.getWindowContext(i, h), b = n.Utility.Util.isEmpty(g), b)) break; if (b) return this.lookup.clear(), null } return (u = n.Env.getPreference(t, r.AD_Window_ID, r.ColumnName, !1), u !== "") ? (this.log.fine("[UserPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : (u = n.Env.getPreference(t, r.AD_Window_ID, r.ColumnName, !0), u !== "") ? (this.log.fine("[SystemPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : r.displayType == n.DisplayType.Button && !r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[Button=N] " + r.ColumnName), "N") : this.vo.displayType == n.DisplayType.YesNo ? (this.log.fine("[YesNo=N] " + r.ColumnName), !1) : r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[ID=null] " + r.ColumnName), null) : n.DisplayType.IsNumeric(r.displayType) ? (this.log.fine("[Number=0] " + r.ColumnName), this.createDefault("", "0")) : (this.log.fine("[NONE] " + r.ColumnName), null) }; r.prototype.getDefault2 = function (t, i) { var r = this.vo, l, u, s, p, f, k, d, c, h, nt; if (r.IsKey || r.displayType == n.DisplayType.RowID || n.DisplayType.IsLOB(r.displayType)) return null; if (this.getIsParentValue() && n.Utility.Util.isEmpty(r.DefaultValue2)) return l = t.getWindowContext(r.windowNo, r.ColumnName), this.log.fine("[Parent] " + r.ColumnName + "=" + l), this.createDefault(r.ColumnName, l); if (r.ColumnName.equals("IsActive")) return this.log.fine("[IsActive] " + r.ColumnName + "=Y"), !0; if (n.Consts.ACCESSLEVEL_SystemOnly.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && (r.ColumnName.equals("AD_Client_ID") || r.ColumnName.equals("AD_Org_ID"))) return this.log.fine("[SystemAccess] " + r.ColumnName + "=0"), 0; if (n.Consts.ACCESSLEVEL_SystemPlusClient.equals(t.getWindowTabContext(r.windowNo, r.tabNo, "AccessLevel")) && r.ColumnName.equals("AD_Org_ID")) return this.log.fine("[ClientAccess] " + r.ColumnName + "=0"), 0; if (u = "", r.DefaultValue2.startsWith("@SQL=")) { var v = r.DefaultValue2.substring(5), e = n.Env.parseContext(t, r.windowNo, v, !1, !0), y = e.toUpperCase(); if (y.indexOf("DELETE ") != -1 && y.indexOf("UPDATE ") != -1 && y.indexOf("DROP ") != -1 && (e = ""), e.equals("")) this.log.log(o.WARNING, "(" + r.ColumnName + ") - Default SQL variable parse failed: " + v); else { s = null; try { s = a(e); s.read() ? u = s.getString(0) : this.log.log(o.WARNING, "(" + r.ColumnName + ") - no Result: " + e); s.close() } catch (b) { e.endsWith("=") ? this.log.log(o.SEVERE, "(" + r.ColumnName + ") " + v, b) : this.log.log(o.WARNING, "(" + r.ColumnName + ") " + e, b) } finally { s != null && s.dispose() } } if (u != null && u.length > 0) return this.log.fine("[SQL] " + r.ColumnName + "=" + u), this.createDefault("", u) } if (!r.DefaultValue2.equals("") && !r.DefaultValue2.startsWith("@SQL=")) for (u = "", p = new n.StringTokenizer(r.DefaultValue2, ",;", !1); p.hasMoreTokens();) { if (f = p.nextToken().trim(), f.equals("@SysDate@") || f.equals("@Now@")) return k = new Date, d = k.toISOString(), d; if (u = f.indexOf("@") != -1 ? t.getWindowContext(r.windowNo, f.replaceAll("@", " ").trim()) : f.startsWith("'") && f.endsWith("'") ? f.length - 2 > 0 ? f.substring(1, f.length - 1) : f.replaceAll("'", "") : f, u.length > 0) return this.log.fine("[DefaultValue2] " + r.ColumnName + "=" + u), this.createDefault(f, u) } if (this.lookup != null && !n.Utility.Util.isEmpty(this.lookup.getValidation())) { var tt = this.lookup.getValidation(), g = n.Evaluator.getVariables(tt), w = !1; for (c = 0; c < g.length; c++)if (h = g[c], !h.startsWith("#") && h.toUpperCase().endsWith("_ID") && !h.equals(r.ColumnName) && (nt = t.getWindowContext(i, h), w = n.Utility.Util.isEmpty(nt), w)) break; if (w) return this.lookup.clear(), null } return (u = n.Env.getPreference(t, r.AD_Window_ID, r.ColumnName, !1), u !== "") ? (this.log.fine("[UserPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : (u = n.Env.getPreference(t, r.AD_Window_ID, r.ColumnName, !0), u !== "") ? (this.log.fine("[SystemPreference] " + r.ColumnName + "=" + u), this.createDefault("", u)) : r.displayType == n.DisplayType.Button && !r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[Button=N] " + r.ColumnName), "N") : this.vo.displayType == n.DisplayType.YesNo ? (this.log.fine("[YesNo=N] " + r.ColumnName), !1) : r.ColumnName.toUpperCase().endsWith("_ID") ? (this.log.fine("[ID=null] " + r.ColumnName), null) : n.DisplayType.IsNumeric(r.displayType) ? (this.log.fine("[Number=0] " + r.ColumnName), this.createDefault("", "0")) : (this.log.fine("[NONE] " + r.ColumnName), null) }; r.prototype.getIsEncryptedColumn = function () { return this.vo.IsEncryptedColumn }; r.prototype.getZoomWindow_ID = function () { return this.vo.ZoomWindow_ID }; r.prototype.getIsDefaultFocus = function () { return this.vo.IsDefaultFocus }; r.prototype.getStyleLogic = function () { return this.vo.StyleLogic || (this.vo.StyleLogic = ""), this.vo.StyleLogic }; r.prototype.createDefault = function (t, i) { var u, f, r, e; if (i == null || i.length == 0) return null; try { if (this.vo.ColumnName.endsWith("atedBy") || this.vo.ColumnName.toUpperCase().endsWith("_ID")) { try { return (u = parseInt(i), u < 0) ? null : u } catch (s) { this.log.warning("Cannot parse: " + i + " - " + s.message) } return 0 } if (this.vo.displayType == n.DisplayType.Integer) return parseInt(i); if (n.DisplayType.IsNumeric(this.vo.displayType)) return parseFloat(i); if (n.DisplayType.IsDate(this.vo.displayType)) { try { return r = null, isNaN(Number(i)) ? r = new Date(i) : (r = new Date, console.log(this.vo.ColumnName + "==>[1n] " + r), r.setMinutes(-r.getTimezoneOffset() + r.getMinutes()), console.log(this.vo.ColumnName + "==>[3n] " + r.toISOString())), r.setMilliseconds(0), r.setSeconds(0), r.toISOString() } catch (c) { } f = i + "2014-01-01T01:00:05Z".substring(i.length); try { new Date(f).toISOString() } catch (l) { this.log.warning("Cannot convert to Timestamp: " + f) } return r = new Date, r.setMilliseconds(0), r.setSeconds(0), r.toISOString() } if (this.vo.displayType == n.DisplayType.YesNo) return "Y".equals(i); if (t.equals("@#Date@")) try { e = new Date(parseInt(i)); i = e.toLocaleDateString() } catch (a) { } return i } catch (h) { this.log.log(o.SEVERE, this.vo.ColumnName + " - " + h.message) } return null }; r.prototype.setValue = function (t, i) { this.inserting || (this.oldValue = this.value); this.value = t; this.inserting = i; this.error = !1; this.updateContext(); var r = this.oldValue; i && (r = this.INSERTING); (r !== t || this.forcefirepropchange) && this.propertyChangeListner && this.propertyChangeListner.setValue(t, i); this.forcefirepropchange = this.inserting || this.vo.displayType == n.DisplayType.YesNo }; r.prototype.setCardViewSeqNo = function (n) { this.cardViewSeq = n }; r.prototype.getCardViewSeqNo = function () { return this.cardViewSeq }; r.prototype.setCardFieldStyle = function (n) { this.cardFieldStyle = n }; r.prototype.getCardFieldStyle = function () { return this.cardFieldStyle }; r.prototype.setCardIconHide = function (n) { this.cardHideIcon = n }; r.prototype.isCardIconHide = function () { return this.cardHideIcon }; r.prototype.setCardTextHide = function (n) { this.cardTextHide = n }; r.prototype.isCardTextHide = function () { return this.cardTextHide }; r.prototype.updateContext = function () { var t = this.vo, u = n.DisplayType, r = n.context, i = this.value, f; t.displayType == u.Text || t.displayType == u.Memo || t.displayType == u.TextLong || t.displayType == u.Binary || t.displayType == u.RowID || this.getIsEncrypted() || (i == "undefined" || i == null ? this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, null) : r.setWindowContext(t.windowNo, t.ColumnName, null) : typeof i == typeof Boolean || t.displayType == u.YesNo ? (f = i.toString().toLowerCase() == "true" || i.toString() == "Y" ? "Y" : "N", this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, f) : r.setWindowContext(t.windowNo, t.ColumnName, f)) : typeof i == typeof date || u.IsDate(t.displayType) ? this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, i) : r.setWindowContext(t.windowNo, t.ColumnName, i) : this.getIsParentTabField() ? this.gridTab && r.setTabRecordContext(t.windowNo, t.tabNo, t.ColumnName, i.toString()) : r.setWindowContext(t.windowNo, t.ColumnName, i == null ? null : i.toString())) }; r.prototype.getIsParentTabField = function (n) { if (!this.gridTab) return !1; n || (n = this.vo.ColumnName); var t = this.gridTab.getParentTab(); return t == null ? !1 : t.getField(n) != null }; r.prototype.setNullValue = function () { this.valueNoFire && (this.oldValue = this.value); this.value = null; this.inserting = !1; this.error = !1; this.oldValue !== this.value && this.propertyChangeListner && this.propertyChangeListner.setValue(this.value) }; r.prototype.setPropertyChangeListener = function (n) { this.propertyChangeListner = n }; r.prototype.setError = function (n) { this.error = n }; r.prototype.setInserting = function (n) { this.inserting = n }; r.prototype.getAD_Reference_Value_ID = function () { return this.vo.AD_Reference_Value_ID }; r.prototype.setDisplayType = function (n) { this.vo.displayType = n }; r.prototype.setDisplayLength = function (n) { this.vo.DisplayLength = n }; r.prototype.setDisplayed = function (n) { this.vo.IsDisplayedf = n }; r.prototype.setValueNoFire = function (n) { this.valueNoFire = n }; r.prototype.getLoadRecursiveData = function () { return this.vo.LoadRecursiveData }; r.prototype.getShowChildOfSelected = function () { return this.vo.ShowChildOfSelected }; r.prototype.getIsBackgroundProcess = function () { return this.vo.IsBackgroundProcess }; r.prototype.getAskUserBGProcess = function () { return this.vo.AskUserBGProcess }; r.prototype.getIsHeaderPanelitem = function () { return this.vo.IsHeaderPanelitem }; r.prototype.getHeaderOverrideReference = function () { return this.vo.HeaderOverrideReference }; r.prototype.getHeaderStyle = function () { return this.vo.HeaderStyle }; r.prototype.getHeaderHeadingOnly = function () { return this.vo.HeaderHeadingOnly }; r.prototype.getHeaderSeqno = function () { return this.vo.HeaderSeqno }; r.prototype.getHeaderIconOnly = function () { return this.vo.HeaderIconOnly }; r.prototype.getHtmlStyle = function () { return this.vo.HtmlStyle }; r.prototype.getGridImageStyle = function () { return this.vo.GridImageStyle }; r.prototype.getShowIcon = function () { return this.vo.ShowIcon }; r.prototype.getAD_Image_ID = function () { return this.vo.AD_Image_ID }; r.prototype.getFontClass = function () { return this.vo.FontClass }; r.prototype.getPlaceHolder = function () { return this.vo.PlaceHolder }; r.prototype.getImageName = function () { return this.vo.ImageName }; r.prototype.getCellSpace = function () { return this.vo.CellSpace }; r.prototype.getFieldBreadth = function () { return this.vo.FieldBreadth }; r.prototype.getIsLineBreak = function () { return this.vo.LineBreak }; r.prototype.getIsFieldgroupDefault = function () { return this.vo.FieldGroupDefault }; r.prototype.getShowFilterOption = function () { return this.vo.ShowFilterOption }; r.prototype.getIsUnique = function () { return this.vo.IsUnique }; r.prototype.getIsSwitch = function () { return this.vo.IsSwitch }; r.prototype.refreshLookup = function () { return !this.lookup || this.lookup.getValidation().length == 0 ? !0 : (this.lookup.refresh(), this.lookup.getIsValidated()) }; r.prototype.dispose = function () { this.lookup != null && (this.lookup.dispose(), this.lookup = null); this.gfield = null; this.vo = null; this.propertyChangeListner = null }; s.prototype.getName = function () { return this.vo.Name }; s.prototype.getAD_Tab_ID = function () { return this.vo.AD_Tab_ID }; s.prototype.getIconPath = function () { return this.vo.IconPath }; s.prototype.getIsDefault = function () { return this.vo.IsDefault }; s.prototype.getClassName = function () { return this.vo.Classname }; s.prototype.getAD_TabPanel_ID = function () { return this.vo.AD_TabPanel_ID }; s.prototype.getSeqNo = function () { return this.vo.SeqNo }; s.prototype.getExtraInfo = function () { return this.vo.ExtraInfo }; e.prototype.getRecord_ID = function () { return this.Record_ID }; e.prototype.setLoading = function (n) { this.m_allLoaded = !1; this.m_loadedRows = n }; e.prototype.getIsLoading = function () { return !this.m_allLoaded }; e.prototype.getLoadedRows = function () { return this.m_loadedRows }; e.prototype.setCurrentRow = function (n) { this.m_currentRow = n }; e.prototype.setCurrentPage = function (n) { this.mCurrentPage = n }; e.prototype.getCurrentRow = function () { return this.m_currentRow }; e.prototype.getTotalRows = function () { return this.m_totalRows }; e.prototype.getTotalRecords = function () { return this.totalRecords }; e.prototype.getCurrentPage = function () { return this.mCurrentPage }; e.prototype.getTotalPage = function () { return this.mTotalPage }; e.prototype.getPageSize = function () { return this.mPageSize }; e.prototype.setInfo = function (n, t, i, r) { this.m_AD_Message = n; this.m_info = t; this.m_isError = i; this.m_isWarning = r }; e.prototype.setPageInfo = function (n, t, i) { this.mCurrentPage = n; this.mPageSize = i; t < 1 || t < i ? (this.mcurrentPage = 1, this.mTotalPage = 1) : this.mTotalPage = i == 0 ? 1 : Math.ceil(t / i); this.totalRecords = t }; e.prototype.setInserting = function (n) { this.m_inserting = n }; e.prototype.getIsInserting = function () { return this.m_inserting }; e.prototype.getAD_Message = function () { return this.m_AD_Message }; e.prototype.getInfo = function () { return this.m_info }; e.prototype.getIsError = function () { return this.m_isError }; e.prototype.getIsWarning = function () { return this.m_isWarning }; e.prototype.getMessage = function () { var n = new StringBuilder; return this.m_inserting && n.append("+"), n.append(this.m_changed ? this.m_autoSave ? "*" : "?" : " "), this.m_totalRows == 0 ? n.append(this.m_currentRow) : n.append(this.m_currentRow + 1), n.append("/"), this.m_allLoaded ? n.append(this.m_totalRows) : n.append(this.m_loadedRows).append("->").append(this.m_totalRows), n.toString() }; e.prototype.getIsChanged = function () { return this.m_changed }; e.prototype.getIsFirstRow = function () { return this.m_totalRows == 0 ? !0 : this.m_currentRow == 0 }; e.prototype.getIsLastRow = function () { return this.m_totalRows == 0 ? !0 : this.m_currentRow == this.m_totalRows - 1 }; e.prototype.getIsFirstPage = function () { return this.mTotalPage < 2 ? !0 : this.mCurrentPage < 2 }; e.prototype.getIsLastPage = function () { return this.mTotalPage < 2 ? !0 : this.mCurrentPage >= this.mTotalPage }; e.prototype.setChangedColumn = function (n, t) { this.m_changedColumn = n; this.m_columnName = t }; e.prototype.getChangedColumn = function () { return this.m_changedColumn }; e.prototype.getColumnName = function () { return this.m_columnName }; e.prototype.setConfirmed = function (n) { this.m_confirmed = n }; e.prototype.getIsConfirmed = function () { return this.m_confirmed }; n.GridWindow = f; n.GridTab = i; n.GridTable = u; n.GridField = r }(VIS, jQuery), function (n, t) { function i(i) { function e() { r = t("<div class='vis-height-full vis-app-aform-root' >"); u = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); f = t("<div class='vis-height-full'>"); r.append(f).append(u) } this.$parent; this.mPanel; this.ctx = n.Env.getCtx(); this.log = n.Logging.VLogger.getVLogger("VIS.AForm"); var r, u, f; e(); this.setSize = function (n) { r.height(n); f.height(n) }; this.setSize(i); this.getRoot = function () { return r }; this.getContentGrid = function () { return f }; this.setBusy = function (n, t) { isLocked = n; n ? u[0].style.visibility = "visible" : (u[0].style.visibility = "hidden", t) }; this.disposeComponent = function () { r.remove(); r = null; f.remove(); f = null; u.remove(); u = null; this.$parentWindow = null; this.ctx = null; this.getRoot = null; this.getContentGrid = null; this.setBusy = null; this.setSize = null } } i.prototype.openForm = function (t, i, r, u) { var f, o, e; if (t.IsReport) return n.ADialog.info("Form Report is not supported"), !1; this.parent = i; f = ""; f = t.Prefix + t.ClassName; console.log(f); this.log.info("Form Name= " + t.Name + ", Class=" + f); this.ctx.setWindowContext(r, "WindowName", t.DisplayName); try { o = n.Utility.getFunctionByName(f, window); e = new o(r); e.init(r, this, u); this.mPanel = e; e = null } catch (s) { return this.log.log(n.Logging.Level.WARNING, "Class=" + f + ", AD_Form Name=" + t.Name, s), !1 } return this.setBusy(!1), this.windowNo = r, this.setTitle(n.Env.getHeader(this.ctx, r)), this.parent.setName(t.DisplayName), i = null, !0 }; i.prototype.setTitle = function (t) { this.parent && this.parent.setTitle(n.Utility.Util.cleanMnemonic(t)) }; i.prototype.hideHeader = function (n) { this.parent && this.parent.hideHeader(n) }; i.prototype.hideCloseIcon = function (n) { this.parent && this.parent.hideCloseIcon(n) }; i.prototype.sizeChanged = function (n, t) { this.setSize(n); this.mPanel && this.mPanel.sizeChanged && this.mPanel.sizeChanged(n, t) }; i.prototype.refresh = function () { this.mPanel && this.mPanel.refresh && this.mPanel.refresh() }; i.prototype.dispose = function () { this.disposed || (this.disposed = !0, this.mPanel && (this.mPanel.disposeComponent && this.mPanel.dispose(), this.mPanel = null), this.parent && (this.parent.dispose(), this.parent = null), n.Env.clearWinContext(this.ctx, this.windowNo), this.disposeComponent()) }; n.AForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function g() { var i, u, f; d = t("<div style='position:relative;width:100%'>"); s = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); w = t("<table  class='vis-process-table'>"); h = t("<button class='vis-button-ok' tabindex=0>").text(n.Msg.getMsg("OK")); a = t("<button class='vis-button-close'>").text(n.Msg.getMsg("Close")); s.css("top", "0px"); h.hide(); a.hide(); w.height(r); s.height(r); c = t("<div>"); d.append(w).append(s); y.append(s); l = t('<select style="display:none;width:100%">'); p = t('<label  class="vis-ec-col-lblchkbox" style="display: none;"><input type="checkbox">' + n.Msg.translate(n.context, "IsBackgroundProcess") + "<\/label>"); v = t(p.find("input")[0]); o = t("<span class='vis-process-description-Span' style='height: 40px;'>").val("asassasasasasaasa"); c.append(o); i = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); b = t('<label style="display:none;">' + n.Msg.getMsg("ChooseReportType") + "<\/label>"); f = t('<div style="display:inherit"><\/div>'); e.parameterFixedArea.append(i); i.append(u); u.append(p).append(l).append(b); c.append(f); c.append(h).append(a); e.$divDesc.append(c) } var e = null, y, k, d, s, c, w, h, a, o, l, b, v, p; this.parent; this.mPanel; this.ctx = n.Env.getCtx(); this.isLocked = !1; this.log = n.Logging.VLogger.getVLogger("VIS.AProcess"); this.isComplete = !1; this.jpObj = null; this.splitUI = u; this.extrnalForm = f; this.partitionContainer = null; this.parameterContainer = null; this.reportContainer = null; this.reportToolbar = null; this.isReport = !1; this.calculateWidth = !0; this.hideclose = !1; this.showParameterClose = !0; this.cssForAll = null; this.visRepformatIcons = null; this.visSaveCsvIcons = null; this.visSavePdfIcons = null; this.visArchiveIcons = null; this.visRequeryIcons = null; this.visCustomizeIcons = null; this.visPrintIcons = null; this.toolbarColor = null; y = null; k = t('<i class="fa fa-bars vis-apanel-lb-img" title="Actions"><\/i>'); this.splitUI && (this.partitionContainer = t('<div class="vis-process-outer-wrap">'), this.parameterContainer = t('<div class="vis-process-left-sidebar vis-leftsidebarouterwrap">'), this.reportAreaContainer = t('<div class="vis-process-main-wrap">'), this.reportToolbar = t('<div class="vis-process-toolbar vis-processtoolpadd">'), this.parameterFixedArea = t('<div class="vis-process-parm-top">'), this.parameterContainer.append(t('<div class="vis-apanel-lb-toggle"><\/div>').append(k)).append(this.parameterFixedArea), y = t('<div class="vis-process-outer-main-wrap">'), this.$divDesc = t('<div class="vis-process-description">'), this.reportContainer = t('<div class="vis-process-result">'), this.reportAreaContainer.append(this.reportToolbar).append(this.$divDesc).append(this.reportContainer), y.append(this.parameterContainer).append(this.reportAreaContainer), this.partitionContainer.append(y), this.showParameterClose = !1); e = this; this.loadFileTypes = function () { var i = this; t.ajax({ url: n.Application.contextUrl + "JsonData/GetReportFileTypes/", dataType: "json", data: { AD_Process_ID: e.jpObj.AD_Process_ID }, success: function (r) { var u, f, e; if (r != null) { if (u = jQuery.parseJSON(r), u.length == 0) { i.showReportTypes(!1); return } for (l.append("<option value='S'>" + n.Msg.getMsg("Select") + "<\/option>"), f = 0; f < u.length; f++)e = t("<option value=" + u[f].Key + ">" + u[f].Name + "<\/li>"), l.append(e), e = null } } }) }; g(); this.setSize = function (n) { s.height(n); this.setMsg && this.setMsg("") }; this.setSize(r); this.isBackground = function () { return v.is(":checked") }; this.getRoot = function () { return d }; this.getContentGrid = function () { return c }; this.setBusy = function (n) { isLocked = n; n ? (s[0].style.visibility = "visible", s.css("display", "")) : (s[0].style.visibility = "hidden", s.css("display", "none")) }; this.setMsg = function (n) { var r = o.find("b"), u, i, f, s; if (o.text().length > 0 && n && n.length > 0 ? (u = t("<span>" + n + "<\/span>"), this.reportContainer.removeClass("vis-process-result"), this.reportContainer.addClass("vis-process-detail-result"), this.reportContainer.empty(), this.reportContainer.append(u)) : o.append(n), i = "", this.isReport && (!r || r.length <= 0) && (i = t('<strong class="vis-process-papapa vis-procss-more"    style="position: fixed;right: 29px;top:96px"><i class="glyphicon glyphicon-chevron-down"><\/i><\/strong>'), o.append(i)), f = t(o.find("p")[0]), i = o.find(".vis-process-papapa"), this.isReport && (s = f.width(), s + 45 > o.width() ? i.show() : i.hide()), this.isReport && (!r || r.length <= 0)) i.on("click", function () { var t = e.reportAreaContainer.height(), n = i.find("i"); n.hasClass("glyphicon-chevron-up") ? (n.addClass("glyphicon-chevron-down"), n.removeClass("glyphicon-chevron-up"), o.css({ height: "40px" })) : (n.addClass("glyphicon-chevron-up"), n.removeClass("glyphicon-chevron-down"), o.css({ height: "" })); e.reportContainer.height(t - (e.$divDesc.height() + 20)) }); this.setMsgHeight(this.isReport) }; this.setMsgHeight = function (n) { n ? (o.css("height", "40px"), o.css("max-height", "")) : (o.css("height", ""), e.parent && o.css("max-height", e.parent.getContentGrid().height() - 100 + "px")); this.reportContainer.height(this.reportAreaContainer.height() - (this.$divDesc.height() + 20)); this.reportAreaContainer.width(this.partitionContainer.width() - this.parameterContainer.width()) }; this.setParameterHeights = function (n) { var i = this, r = t(i.partitionContainer.find(".vis-process-outer-main-wrap")[0]), u, f; n && (i.partitionContainer.height(n), r.height(n)); u = r.height(); f = t(i.partitionContainer.find(".vis-pro-para-root")[0]); f.height(u - 114 + "px") }; this.getParametersContainer = function () { return this.parameterContainer }; this.getReportAreaContainer = function () { return this.reportContainer }; this.getContentTable = function () { return w }; this.getBusyIndicator = function () { return s }; this.getToolbar = function () { return this.reportToolbar }; this.additemtoToolbar = function () { var n = t('<div class="vis-ad-w-p-t-close vis-ad-process-close"><i class="vis vis-cross"><\/i><\/div>'); e.reportToolbar.append(n).append(t('<div class="vis-ad-w-p-t-name vis-ad-process-header"><h5>' + e.parent.getName() + "<\/h5><\/div >")); n.on("click", function () { e.parent.dispose() }) }; this.showCloseIcon = function (n) { this.hideclose = n ? !1 : !0 }; this.showOkIcon = function (n) { n ? (this.parameterContainer.append(t('<div style="overflow:auto;padding:0 10px">').append(h)), h.removeClass(""), h.addClass("vis-process-ok-btn VIS_Pref_btn-2"), h.show(), window.setTimeout(function () { h.focus() }, 100)) : h.hide() }; this.showParameterCloseIcon = function (n) { this.showParameterClose = n ? !0 : !1 }; this.getShowParameterCloseIcon = function () { return this.showParameterClose }; this.setCssForToolbarIcons = function (n) { this.cssForAll = n }; this.setReportFormatIcons = function (n) { this.visRepformatIcons = n }; this.setSaveCsvIcons = function (n) { this.visSaveCsvIcons = n }; this.setSavePdfIcons = function (n) { this.visSavePdfIcons = n }; this.setArchiveIcons = function (n) { this.visArchiveIcons = n }; this.setRequeryIcons = function (n) { this.visRequeryIcons = n }; this.setCustomizeIcons = function (n) { this.visCustomizeIcons = n }; this.setPrintIcons = function (n) { this.visPrintIcons = n }; this.setToolbarColor = function (n) { this.toolbarColor = n }; this.getFileType = function () { return l.val() }; this.reportBytes = null; this.reportPath = null; this.showReportTypes = function (n) { n ? (l.css("display", "block"), b.css("display", "block")) : (l.css("display", "none"), b.css("display", "none")) }; this.showBackgroundProcess = function (n) { n ? (e.parameterFixedArea.addClass("vis-process-pram-checkbox-text"), p.css("display", "flex")) : (e.parameterFixedArea.removeClass("vis-process-pram-checkbox-text"), p.css("display", "none")) }; this.enableBackgroundSetting = function (n) { v.prop("checked", n); n == !0 ? v.prop("disabled", "disabled") : v.prop("disabled", "") }; this.archiveDocument = function (i, r) { i.setBusy(!0); t.ajax({ url: n.Application.contextUrl + "JsonData/ArchiveDoc/", dataType: "json", type: "post", data: { AD_Process_ID: r.pi.getAD_Process_ID(), Name: r.pi.getTitle(), AD_Table_ID: r.pi.getTable_ID(), Record_ID: r.pi.getRecord_ID(), C_BPartner_ID: 0, isReport: !0, binaryData: e.reportBytes, reportPath: e.reportPath }, success: function () { n.ADialog.info("Archived", !0, "", ""); i.setBusy(!1) } }) }; h.on("click", function () { e.onclickTrigger(e) }); this.onclickTrigger = function (t) { var i, r, u; if (t.isComplete) { t.dispose(); return } i = null; i = new n.ProcessInfo(t.jpObj.Name, t.jpObj.AD_Process_ID, 0, 0); i.setAD_User_ID(t.ctx.getAD_User_ID()); i.setAD_Client_ID(t.ctx.getAD_Client_ID()); i.setUseCrystalReportViewer(n.context.getIsUseCrystalReportViewer()); i.setIsBackground(v.is(":checked")); i.setIsReport(t.isReport); i.setActionOrigin(t.ActionOrigin); r = n.context.getWindowContext(t.windowNo, "WindowName"); r || (r = "Menu"); i.setOriginName(r); u = new n.ProcessCtl(t, i, null); i.setFileType(l.val()); t.windowNo ? u.process(t.windowNo) : u.process(n.Env.getWindowNo()); u = null }; a.on("click", function () { e.parent.dispose() }); k.on("click", function (n) { n.stopPropagation(); n.preventDefault(); e.parameterContainer.width() > 40 ? (e.parameterContainer.css("flex-basis", "40px"), e.parameterFixedArea.hide(), e.getParametersContainer().find(".vis-pro-para-root").hide(), e.getParametersContainer().find(".vis-process-ok-btn").hide()) : (e.parameterContainer.css("flex-basis", "280px"), e.parameterFixedArea.show(), e.getParametersContainer().find(".vis-pro-para-root").show(), e.getParametersContainer().find(".vis-process-ok-btn").show()) }); this.disposeComponent = function () { h && h.off("click"); a && a.off("click"); c && c.remove(); c = null; this.reportContainer && this.reportContainer.remove(); this.parameterContainer && this.parameterContainer.remove(); this.reportToolbar && this.reportToolbar.remove(); this.partitionContainer && this.partitionContainer.remove(); s && s.remove(); s = null; h = a = o = null; this.$parentWindow = null; this.isComplete = !1; this.jpObj = null; e = null } } function e(n, i, r) { var u = null; return t.ajax({ url: o, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } var r = n.Application.contextUrl, u = r + "JsonData/ExecuteNonQuer", f = function (n, i, r) { var e = r ? !0 : !1, f = null, o = { sql: n.join("/"), param: i }; return t.ajax({ url: u + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: e, data: JSON.stringify(o) }).done(function (n) { f = n; r && r(n) }), f }; i.prototype.init = function (t, i, r) { if (t.Name == null || t.Name == "") return n.ADialog.info("Process Name is empty"), fasle; if (this.ctx.setWindowContext(r, "IsSOTrx", t.IsSOTrx), i.getContentGrid().append(this.getRoot()), this.isReport = t.IsReport, this.setMsg(t.MessageText), this.setBusy(!1), this.parent = i, this.jpObj = t, this.additemtoToolbar(), t.IsReport ? (this.showReportTypes(!0), this.loadFileTypes(), t.IsCrystal && n.context.getIsUseCrystalReportViewer() && this.parameterFixedArea.hide()) : (this.showBackgroundProcess(!0), this.enableBackgroundSetting(t.IsBackground)), this.setMsgHeight(t.IsReport), t.HasPara || this.showOkIcon(!0), this.splitUI && t.HasPara) this.onclickTrigger(this); return this.splitUI && (this.parent.getContentGrid().empty(), this.parent.getContentGrid().append(this.partitionContainer)), this.windowNo = r, !0 }; i.prototype.setActionOrigin = function (n) { this.ActionOrigin = n }; i.prototype.setTitle = function (t) { this.parent && this.parent.setTitle(n.Utility.Util.cleanMnemonic(t)) }; i.prototype.lockUI = function () { this.isLocked = !0; this.setBusy(!0) }; i.prototype.unlockUI = function (t) { t.logs && t.logs.length > 0 && (t.logs = null); n.ProcessInfoUtil.setLogFromDB(t); var i = ""; t && t.getSummary() ? i = "<p style='float: left;width: 100%;'><font color=\"" + (t.getIsError() ? "#FF0000" : "#0000FF") + '">** ' + t.getSummary() + "<\/font><\/p>" : this.jpObj.IsReport || (i = "<p style='float: left;width: 100%;'><font color=\"" + (t.getIsError() ? "#FF0000" : "#0000FF") + '">** <\/font><\/p>'); i += t.customHTML && t.customHTML != "" ? t.customHTML : t.getLogInfo(!0); this.setMsg(i); this.setBusy(!1); t.setSummary(""); this.isLocked = !1 }; i.prototype.getIsUILocked = function () { return this.isLocked }; i.prototype.dispose = function () { this.disposed || (this.disposed = !0, this.mPanel && (this.mPanel.dispose(), this.mPanel = null), this.parent && (this.parent.dispose(), this.parent = null), n.Env.clearWinContext(this.ctx, this.windowNo), this.disposeComponent()) }; var r = n.Application.contextUrl, o = r + "JsonData/JDataSetWithCode", u = r + "JsonData/ExecuteNonQuer", s = function (t, i, r) { var o = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, e(f, o, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, h = function (t, i, r) { var f = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u = null; return e(o, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, f = function (n, i, r) { var e = r ? !0 : !1, f = null, o = { sql: n, param: i }; return t.ajax({ url: u + "iesWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: e, data: JSON.stringify(data) }).done(function (n) { f = n; r && r(n) }), f }; i.prototype.createUI = function (i, r, u) { function ft(i, u) { var ft, st, ht, ot, f, ut; if (r.pi.setActionOrigin(e.ActionOrigin), ft = n.context.getWindowContext(e.windowNo, "WindowName"), ft || (ft = "Menu"), r.pi.setOriginName(ft), st = r.pi.get_AD_PrintFormat_Table_ID(), w = n.MRole.getDefault().getIsCanExport(st), ht = [], ot = -1, s = [], f = null, t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetPrintFormatDetails", data: { AD_Table_ID: st }, success: function (t) { var i, r; f = (new n.DB.DataReader).toJson(t); try { while (f.read()) ot = parseInt(ot) + 1, i = f.getString(1), ht.indexOf(i) > -1 && (i = i + "_" + (parseInt(ot) + 1)), r = {}, r.ID = n.Utility.Util.getValueOfInt(f.get(0)), r.Name = i, r.IsDefault = f.getString(3), ht.push(f.getString(1)), s.push(r); f.close() } catch (u) { f.close() } f = null } }), et(), rt = t("<div>"), h = t('<select class="vis-selectcsview-page">'), c = t("<ul class='vis-apanel-rb-ul'>"), e.cssForAll ? (b = t("<li><a  title='" + n.Msg.getMsg("SaveAllRecordCsv") + "' class='vis vis-csv-all'><\/a><\/li>"), k = t("<li><a  title='" + n.Msg.getMsg("SaveAllPagePdf") + "' class='vis vis-pdf-all'><\/a><\/li>")) : (b = t("<li><a  title='" + n.Msg.getMsg("SaveAllRecordCsv") + "' class='vis vis-csv-all'><\/a><\/li>"), k = t("<li><a  title='" + n.Msg.getMsg("SaveAllPagePdf") + "' class='vis vis-pdf-all'><\/a><\/li>")), d = t("<div class='vis-report-header vis-ad-print-process'>"), d.append(t('<div class="vis-ad-w-p-t-name vis-ad-process-header"><h5>' + e.parent.getName() + "<\/h5><\/div >")), v = t('<div class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/div >'), g = t('<div class="vis-report-top-icons">'), o = t('<ul  class="vis-reporticonsulprint">'), p = t("<li><a class='" + e.visRepformatIcons + "'><\/a><\/li>"), c.append(t('<li data-id="-1">').append(n.Msg.getMsg("NewReport"))), rt.append(c), o.append(p), w && (tt = t("<li><a title='" + n.Msg.getMsg("SaveCSVPage") + "' class='vis vis-save-csv'><\/a><\/li>"), o.append(tt)), r.pi.getSupportPaging() && w) { for (o.append(b), ut = 1; ut < r.pi.getTotalPages() + 1; ut++)h.append(t("<option value=" + ut + ">" + ut + "<\/option>")); g.append(h) } w && (it = t("<li><a title='" + n.Msg.getMsg("SavePDFDocumentPage") + "' class='vis vis-save-pdf'><\/a><\/li>"), o.append(it)); r.pi.getSupportPaging() && w ? o.append(k) : (tt.find("a").attr("title", n.Msg.getMsg("SaveCSV")), it.find("a").attr("title", n.Msg.getMsg("SavePdf"))); n.context.ctx["#BULK_REPORT_DOWNLOAD"] == "Y" ? (b.css("display", ""), k.css("display", "")) : (b.css("display", "none"), k.css("display", "none")); nt = t("<li><a title='" + n.Msg.getMsg("Archive") + "'  class='vis vis-archive'><\/a><\/li>"); o.append(nt); y = t("<li><a title='" + n.Msg.getMsg("Requery") + "'  class='vis vis-refresh'><\/a><\/li>"); o.append(y); l = t("<li><a style='cursor:pointer;' class='vis vis-customize'><\/a><\/li>"); o.append(l); a = t("<li><a style='cursor:pointer;' class='vis vis-print'><\/a><\/li>"); o.append(a); u.HTML || (a.css("display", "none"), l.css("display", "none"), p.css("display", "none")); g.append(o); d.append(g); e.hideclose || d.append(v); e.splitUI ? (e.reportToolbar.removeClass("vis-processtoolpadd"), e.reportToolbar.empty().append(d), e.reportContainer.empty().append(i.getRoot()), e.extrnalForm && e.getContentTable().empty().append(e.reportContainer)) : (e.parent.getContentGrid().append(d).append(i.getRoot()), i.getRoot().css("width", t(window).width())) } function ut(i) { function lt(t) { var i; return r.pi.setFileType(t), r.pi.setActionOrigin(e.ActionOrigin), i = n.context.getWindowContext(e.windowNo, "WindowName"), i || (i = "Menu"), r.pi.setOriginName(i), { processInfo: r.pi.toJson(), parameterList: r.paraList } } function wt(n, t) { var i = r.pi.getOriginName(); return i || (i = "Menu"), { AD_Process_ID: r.pi.getAD_Process_ID(), Name: r.pi.getTitle(), AD_PInstance_ID: r.pi.getAD_PInstance_ID(), AD_Table_ID: r.pi.getTable_ID(), Record_ID: r.pi.getRecord_ID(), pageNumber: n, page_Size: t, saveAll: !1, ActionOrigin: r.pi.getActionOrigin(), OriginName: i } } function ot(n, t, i, u, f, e) { return { processInfo: r.pi.toJson(), queryInfo: JSON.stringify(n), code: t, isCreateNew: i, treeID: f, node_ID: u, IsSummary: e } } function bt(n, t, i, u, f, e, o, s) { var h = r.pi.getOriginName(); return h || (h = "Menu"), { AD_Process_ID: n, Name: t, AD_PInstance_ID: i, AD_Table_ID: u, Record_ID: f, pageNumber: e, page_Size: o, printAllPages: s, ActionOrigin: r.pi.getActionOrigin(), OriginName: h } } function at(t, i) { n.dataContext.executeProcess(t, function (n) { if (n.error != null) { r.pi.setSummary(n.error, !0); r.unlock(); r = null; return } var t = JSON.parse(n.result); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } i(t) }) } function d(i, r) { var f, u, o, s, c, h; try { if (i.HTML) { if (r.getRightInnerDiv().html(i.HTML), f = document.getElementsByClassName("vis-reptabledetect"), f.length > 0) { for (u = 0, o = 0, s = 0, c = f.length; s < c; s++)o = t(f[s]).width(), o > u && (u = o); r.getRightDiv().width(t(window).width() - 10); r.getRightDiv().css("min-width", t(window).width() + "px"); r.getRightInnerDiv().width(u + 50) } r.getRightInnerDiv().width(u) } else i.ReportFilePath && (h = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), h.attr("src", n.Application.contextUrl + i.ReportFilePath), r.getRightDiv().empty().append(h), e.reportPath = i.ReportFilePath) } catch (l) { } r.setBusy(!1) } function kt(t, i, r, u, f) { t.HTML && t.HTML.length > 0 ? d(t, i) : u == 0 ? (window.open(n.Application.contextUrl + t.ReportFilePath), i.setBusy(!1)) : ft(u, t.ReportFilePath, f, t) } function ft(i, r, f, e) { f.setBulkBusy(!1); t("#forreportdownload").addClass("hide"); et += '<input type="checkbox" data-num="' + e + '"  data-url="' + n.Application.contextUrl + r + '" checked />'; u += 1; updateCreateBar(u / i * 100); u == i && setTimeout(function () { updateCreateBar(100); showCreateMessage(n.Msg.getMsg("Generated")); t("<form>", { id: "download_form", html: et, action: "#", Class: "hide" }).appendTo(document.body).submit() }, 1e3) } function st(u) { var f = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + r.pi.dynamicAction, type: "Post", data: f, success: function (f) { var o = JSON.parse(f), s; return ct || u != r.REPORT_TYPE_PDF ? window.open(n.Application.contextUrl + o) : (s = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), s.attr("src", n.Application.contextUrl + o), i.getRightDiv().empty().append(s), e.reportPath = o.ReportFilePath), i.setBusy(!1), o.ReportFilePath } }) } function vt(u, f, e) { r.pi.setPageNo(u); var o = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + r.pi.dynamicAction, type: "Post", data: o, success: function (n) { n = JSON.parse(n); ft(e, n, f, u); i.setBusy(!1) } }) } var ht = e.parent, ct = /ipad|iphone|ipod|mobile|android|blackberry|webos|windows phone/i.test(navigator.userAgent.toLowerCase()), yt, pt, u, ri, et; v.off("click"); y.off("click"); l.off("click"); a.off("click"); p.off("click"); c.off("click"); nt.off("click"); v.on("click", function () { i && (i.dispose(), i = null); ht && (ht.dispose(), ht = null); r.pi && r.pi.dispose(); r.pi = null; o.empty(); v.off("click"); y.off("click"); l.off("click"); a.off("click"); p.off("click"); c.off("click"); v = null; g = null; o = null; nt = null; y = null; l = null; a = null; tt = null; it = null; ut = null }); y.on("click", function () { i.setBusy(!0); i.getRightInnerDiv().html(""); i.getRightInnerDiv().width(0); r.pi.dynamicAction && r.pi.dynamicAction.length > 0 ? st(r.REPORT_TYPE_PDF, h.val()) : loadReportData() }); l.on("click", function () { var t = new n.Query; t.addRestriction("AD_PrintFormat_ID", n.Query.prototype.EQUAL, r.pi.AD_PrintFormat_ID); n.viewManager.startWindow(240, t) }); a.on("click", function () { if (i.getIsHtmlReport()) { var n = window.open(); n.document.write("<html><head>"); n.document.write("<\/head><body >"); n.document.write(i.getHtml()); n.document.write("<\/body><\/html>"); n.print(); n.close() } }); if (w) { tt.on("click", function () { r.pi.setFileType("C"); r.pi.getPageNo() == 1 ? (i.setBusy(!0), at(lt(r.REPORT_TYPE_CSV), function (t) { window.open(n.Application.contextUrl + t.ReportFilePath); i.setBusy(!1) })) : (i.setBusy(!0), window.setTimeout(function () { if (r.pi.dynamicAction && r.pi.dynamicAction.length > 0) st(r.REPORT_TYPE_CSV, r.pi.getPageNo()); else if (r.pi.GetAD_ReportView_ID() > 0) pt(h.val(), 0, null); else if (r.pi.getIsJasperReport()) dt("C", r.pi.getPageNo()); else { pageNo = h.val(); var u = wt(pageNo, r.pi.getPageSize()); t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReportforCsv", type: "Post", data: u, success: function (t) { var r = JSON.parse(t); window.open(n.Application.contextUrl + "TempDownload/" + r); i.setBusy(!1) } }) } }, 100)) }); it.on("click", function () { r.pi.setFileType(r.REPORT_TYPE_PDF); r.pi.getPageNo() == 1 ? (i.setBusy(!0), at(lt(r.REPORT_TYPE_PDF), function (n) { d(n, i) })) : loadReportData() }); function loadReportData() { i.setBusy(!0); window.setTimeout(function () { if (r.pi.dynamicAction && r.pi.dynamicAction.length > 0) st(r.REPORT_TYPE_PDF, r.pi.getPageNo()); else if (r.pi.GetAD_ReportView_ID() > 0) yt(r.pi.getPageNo(), 0, null); else if (r.pi.getIsJasperReport()) dt(r.REPORT_TYPE_PDF, r.pi.getPageNo()); else if (r.pi.getIsReportFormat()) { var u = bt(r.pi.getAD_Process_ID(), r.pi.getTitle(), r.pi.getAD_PInstance_ID(), r.pi.getTable_ID(), r.pi.getRecord_ID(), r.pi.getPageNo(), r.pi.getPageSize(), !1); t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReport", type: "Post", data: u, success: function (r) { var u = JSON.parse(r), f; ct ? window.open(n.Application.contextUrl + u) : (f = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), f.attr("src", n.Application.contextUrl + u), i.getRightDiv().empty().append(f)); e.reportPath = u; i.setBusy(!1) } }) } else at(lt(r.REPORT_TYPE_PDF), function (n) { d(n, i) }) }, 200) } h.on("change", function () { var u, f, o; pageNo = h.val(); r.pi.GetAD_ReportView_ID() > 0 ? (i.setBusy(!0), u = [], r.pi.setPageNo(pageNo), f = new n.Query(r.pi.getPrintFormatTableName()), r.pi.getPrintFormatTableName() && (u.push(f.getTableName()), u.push(f.getWhereClause(!0))), o = ot(u, "", !1, 0, 0, !1), t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", type: "POST", data: o, success: function (n) { var t = jQuery.parseJSON(n); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } d(t.repInfo, i); e.reportPath = t.repInfo.ReportFilePath } })) : r.pi.setPageNo(pageNo) }); function dt(u) { r.pi.setFileType(u); var f = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + "JasperReport/ExecuteReport", type: "Post", data: f, success: function (f) { var o = JSON.parse(f), s; ct ? window.open(n.Application.contextUrl + o) : (u == r.REPORT_TYPE_PDF ? (s = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), s.attr("src", n.Application.contextUrl + o), i.getRightDiv().empty().append(s)) : window.open(n.Application.contextUrl + o), e.reportPath = o); i.setBusy(!1) } }) } function gt(u, f, e) { var o; r.pi.setPageNo(u); o = { processInfo: r.pi.toJson() }; t.ajax({ url: n.Application.contextUrl + "JasperReport/ExecuteReport", type: "Post", data: o, success: function (n) { n = JSON.parse(n); ft(f, n, e, u); i.setBusy(!1) } }) } b.on("click", function () { i.setBusy(!0); u = 0; et = ""; r.pi.setFileType("C"); window.setTimeout(function () { var i = new n.BulkDownload(e.windowNo, "CSV"), t; if (i.onClose = function () { }, i.show(), r.pi.dynamicAction && r.pi.dynamicAction.length > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)vt(t, i, r.pi.getTotalPages()); else if (r.pi.GetAD_ReportView_ID() > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)pt(t, r.pi.getTotalPages(), i); else if (r.pi.getIsJasperReport()) for (t = 1; t <= r.pi.getTotalPages(); t++)gt(t, r.pi.getTotalPages(), i); else for (t = 1; t <= r.pi.getTotalPages(); t++)ti(t, i, r.pi.getTotalPages()); r.pi.setPageNo(h.val()) }, 100) }); function ti(u, f, e) { var s = "", o; r.pi.dynamicAction && r.pi.dynamicAction.length > 0 ? s = st(r.REPORT_TYPE_CSV, u) : (o = wt(u, r.pi.getPageSize()), t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReportforCsv", type: "Post", data: o, success: function (n) { var t = JSON.parse(n); t = "TempDownload/" + t; ft(e, t, f, u); i.setBusy(!1) } })) } yt = function (u, f, o) { var s = [], h = new n.Query(r.pi.getPrintFormatTableName()), c; s.push(h.getTableName()); s.push(h.getWhereClause(!0)); c = ot(s, "", !1, 0, 0, !1); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: c, type: "POST", success: function (t) { t == null && n.ADialog.error("ERRORGettingRepData"); var s = jQuery.parseJSON(t), r = s.repInfo; if (r.ErrorText) { n.ADialog.error(r.ErrorText); i.setBusy(!0); return } kt(r, i, u, f, o); i.setBusy(!1); e.reportPath = r.ReportFilePath } }) }; pt = function (u, f, o) { var s = [], h = new n.Query(r.pi.getPrintFormatTableName()), c; s.push(h.getTableName()); s.push(h.getWhereClause(!0)); c = ot(s, "", !1, 0, 0, !1); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: c, type: "POST", success: function (t) { t == null && n.ADialog.error("ERRORGettingRepData"); var s = jQuery.parseJSON(t), r = s.repInfo; if (r.ErrorText) { n.ADialog.error(r.ErrorText); setBusy(!1); return } kt(r, i, u, f, o); e.reportPath = r.ReportFilePath; i.setBusy(!1) } }) }; k.on("click", function () { i.setBusy(!0); u = 0; et = ""; r.pi.setFileType(r.REPORT_TYPE_PDF); window.setTimeout(function () { var i = new n.BulkDownload(e.windowNo, "PDF"), t; if (i.onClose = function () { }, i.show(), r.pi.dynamicAction && r.pi.dynamicAction.length > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)vt(t, i, r.pi.getTotalPages()); else if (r.pi.GetAD_ReportView_ID() > 0) for (t = 1; t <= r.pi.getTotalPages(); t++)yt(t, r.pi.getTotalPages(), i); else if (r.pi.getIsJasperReport()) for (t = 1; t <= r.pi.getTotalPages(); t++)gt(t, r.pi.getTotalPages(), i); else for (t = 1; t <= r.pi.getTotalPages(); t++)ii(t, i, r.pi.getTotalPages()); r.pi.setPageNo(h.val()) }, 100) }); u = 0; function ii(u, f, o) { var h = "", s; r.pi.dynamicAction && r.pi.dynamicAction.length > 0 ? h = vt(r.REPORT_TYPE_CSV, u) : (s = bt(r.pi.getAD_Process_ID(), r.pi.getTitle(), r.pi.getAD_PInstance_ID(), r.pi.getTable_ID(), r.pi.getRecord_ID(), u, r.pi.getPageSize(), !1), t.ajax({ url: n.Application.contextUrl + "ReportCom/ExecuteReport", type: "Post", data: s, success: function (n) { var t = JSON.parse(n); ft(o, t, f, u); e.reportPath = t; i.setBusy(!1) } })) } ri = function () { for (var i, r, u, n = 0; n < arguments.length; n++)i = t('<iframe style="visibility: collapse;"><\/iframe>'), t("body").append(i), r = i[0].contentDocument, u = '<form action="' + arguments[n] + '" method="GET"><\/form>', r.write(u), t("form", r).submit(), setTimeout(function (n) { return function () { n.remove() } }(i), 2e3) }; et = ""; function updateCreateBar(n) { var i = t("#reportcreate").find(".progress-bar").width() * 100 / t("#reportcreate").width(); isNaN(i) && (i = 0); i <= n && t("#reportcreate").removeClass("hide").find(".progress-bar").attr("aria-valuenow", n).css({ width: n + "%" }).text(n.toFixed(0) + "%") } function ni() { t("#reportcreateresult").removeClass().text("") } function showCreateMessage(n) { ni(); t("#reportcreateresult").addClass("alert alert-success").text(n); t("#forreportdownload").removeClass("hide") } function ui(n) { ni(); t("#reportcreateresult").addClass("alert alert-danger").text(n) } } p.on("click", function () { var i, u, r; for (c.empty(), i = 0; i < s.length; i++)u = s[i].IsDefault == "Y" ? "vis-mainfavitem" : "vis-mainnonfavitem", r = t('<li><a data-isdefbtn="no" data-id="' + s[i].ID + '">' + s[i].Name + "<\/a><\/li>"), c.append(r); c.append(t('<li><a data-id="-1">' + n.Msg.getMsg("NewReport") + "<\/a>")); t(this).w2overlay(rt.clone(!0), { css: { height: "300px" } }) }); c.on("click", "LI", function (u) { var v, h, y, o, c, p, l, a, w; if (i.setBusy(!0), v = t(u.target), h = v.data("id"), v.data("isdefbtn") == "yes") { for (y = "VIS_76", o = [], o[0] = new n.DB.SqlParam("@tableID", r.pi.Ad_Table_ID), o[1] = new n.DB.SqlParam("@tabID", curTab.getAD_Tab_ID()), f(sql, o), y = "VIS_77", o = [], o[0] = new n.DB.SqlParam("@printForamt", h), f(sql, o), c = 0; c < s.length; c++)s[c].IsDefault = s[c].ID == h ? "Y" : "N"; return } AD_PrintFormat_ID = h; p = !1; h == -1 && (h = r.pi.get_AD_PrintFormat_Table_ID, p = !0); l = []; a = new n.Query(r.pi.getPrintFormatTableName()); l.push(a.getTableName()); l.push(a.getWhereClause(!0)); w = ot(l, a.getCode(0), false0, 0, !1); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: w, type: "POST", success: function (n) { var t = jQuery.parseJSON(n); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } d(t.repInfo, i); e.reportPath = t.repInfo.ReportFilePath } }) }); nt.on("click", function () { e.archiveDocument(i, r) }) } function et() { e.visRepformatIcons && e.visRepformatIcons.length != 0 || (e.visRepformatIcons = e.cssForAll ? e.cssForAll + "vis vis-format" : "vis vis-format"); e.visSaveCsvIcons = e.visSaveCsvIcons && e.visSaveCsvIcons.length != 0 ? e.visSaveCsvIcons + " vis-report-icon " : " vis vis-save-csv"; e.visSavePdfIcons = e.visSavePdfIcons && e.visSavePdfIcons.length != 0 ? e.visSavePdfIcons + " vis-report-icon " : " vis vis-save-pdf"; e.visArchiveIcons = e.visArchiveIcons && e.visArchiveIcons.length != 0 ? e.visArchiveIcons + " vis-report-icon " : " vis vis-archive"; e.visRequeryIcons = e.visRequeryIcons && e.visRequeryIcons.length != 0 ? e.visRequeryIcons + " vis-report-icon " : " vis vis-refresh"; e.visCustomizeIcons = e.visCustomizeIcons && e.visCustomizeIcons.length != 0 ? e.visCustomizeIcons + " vis-report-icon " : " vis vis-customize"; e.visPrintIcons = e.visPrintIcons && e.visPrintIcons.length != 0 ? e.visPrintIcons + " vis-report-icon " : " vis vis-print " } var v = null, g = null, o = null, nt = null, y = null, l = null, a = null, tt = null, it = null, p = null, w = !1, s = [], rt = null, h = null, c = null, b = null, k = null, e = this, d = null; ft(i, u); ut(i, u) }; i.prototype.showReport = function (t, i, r) { var u = this; this.splitUI || (this.mPanel && (this.mPanel.dispose(), this.mPanel = null), this.disposeComponent()); this.mPanel = t; this.pCtl = r; this.createUI(t, r, i); this.parent.hideHeader(!0); t.setBusy(!1); (n.context.ctx.$AutoArchive == "1" || n.context.ctx.$AutoArchive == "2") && u.archiveDocument(t, r) }; i.prototype.showTelerikReport = function (n, t) { var i = new KJS.TelerikContainer(n, t); i.getRoot().height(this.parent.getContentGrid().height()); this.parent.getContentGrid().empty(); this.parent.getContentGrid().append(i.getRoot()); i.init() }; i.prototype.setReportBytes = function (n) { this.reportBytes = n }; i.prototype.setReportPath = function (n) { this.reportPath = n }; i.prototype.sizeChanged = function (n, t) { this.setSize(n, t); this.mPanel && this.mPanel.sizeChanged && !this.splitUI && this.mPanel.sizeChanged(n, t); this.setParameterHeights && this.setParameterHeights(n, t) }; i.prototype.refresh = function () { this.setParameterHeights && this.setParameterHeights(); this.mPanel && this.mPanel.refresh && this.mPanel.refresh(); this.setMsg && this.setMsg("") }; n.AProcess = i }(VIS, jQuery), function (n, t) { function i(n, t) { this.parent = n; this.pi = t; this.windowNo; this.paraList = null; this.splitUI = n.splitUI; this.parameters = null; this.cansplitUI = function (n) { splitUI = n }; this.getFileType = function () { return n.getFileType() }; this.setBusy = function (t) { n.setBusy(t) }; this.isBackground = function () { return n.isBackground() } } function r(i, r, u) { function h() { o = t("<div class='vis-height-full'>"); f = t("<div class='vis-height-full'>"); f.css("background-color", "rgba(var(--v-c-primary), .3)"); $innerRightDiv = t("<div class='vis-height-full' style='padding:5px;'>"); o.append(f); o.append(s); u ? (f.append($innerRightDiv), $innerRightDiv.html(i)) : r.getIsBiHtml() ? (e = t("<iframe style = 'width:100%;height:99.4%;'>"), e.attr("src", n.Application.contextUrl + "BiPanel/GetHTMLReport?info=" + window.encodeURIComponent(i)), f.css("height", "95%"), f.css("width", "100%"), f.append(e)) : (e = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"), e.attr("src", n.Application.contextUrl + i), f.css("height", "95%"), f.css("width", "100%"), f.append(e)) } this.bytes = null; this.RptFileName = i; this.Pi = r; var o = null, f = null; $innerRightDiv = null; var e = null, s = t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"); h(); this.getRoot = function () { return o }; this.getRightDiv = function () { return f }; this.getRightInnerDiv = function () { return $innerRightDiv }; this.getIsHtmlReport = function () { return u }; this.getHtml = function () { return i }; this.disposeComponent = function () { o != null && (o.remove(), o = null) }; this.setBusy = function (n) { s.css("display", n ? "block" : "none") }; this.sizeChanged = function () { }; this.refresh = function () { e && (window.setTimeout(function () { e.css("height", "99.4%") }, 50), e.css("height", e.height() - 1)) } } i.prototype.REPORT_TYPE_CSV = "C"; i.prototype.REPORT_TYPE_PDF = "P"; i.prototype.REPORT_TYPE_RTF = "R"; i.prototype.REPORT_TYPE_BIHTML = "B"; i.prototype.ORIGIN_WINDOW = "W"; i.prototype.ORIGIN_FORM = "F"; i.prototype.ORIGIN_MENU = "P"; i.prototype.process = function (t) { var i, r; this.lock(); this.windowNo = t; this.pi.setWindowNo(t); i = this; this.jObjectFromServer = null; r = { processInfo: this.pi.toJson() }; n.dataContext.process(r, function (n) { if (n.error != null) { i.pi.setSummary(n.error, !0); i.unlock(); i = null; return } var t = JSON.parse(n.result); if (t.IsError) { i.pi.setSummary(t.Message, !0); i.unlock(); i = null; return } i.complete(t); i = null }) }; i.prototype.complete = function (t) { var i, u, r, f, e; if (this.jObjectFromServer = t, this.pi.setAD_PInstance_ID(t.AD_PInstance_ID), this.pi.setIsBiHtml(t.IsBiHTMlReport), this.pi.setCustomHTML(t.CustomHTML), this.pi.set_AD_PrintFormat_ID(t.AD_PrintFormat_ID), t && t.ReportProcessInfo && (this.pi.setTotalPages(t.ReportProcessInfo.TotalPage), this.pi.setSupportPaging(t.ReportProcessInfo.SupportPaging), this.pi.setPageSize(t.ReportProcessInfo.PageSize)), t.ShowParameter) { this.pi.setAD_PInstance_ID(t.AD_PInstance_ID); try { i = new n.ProcessParameter(this.pi, this, this.windowNo); this.splitUI && (this.parent.parameterContainer.append(i.getRoot()), this.parent.setParameterHeights()); i.initDialog(t.ProcessFields); this.splitUI ? i.showCloseIcon(this.parent.getShowParameterCloseIcon()) : (i.showDialog(), i = null) } catch (o) { this.pi.setSummary(o.message, !0) } this.unlock() } else t.IsTelerikReport ? window.KJS && this.parent && this.parent.showTelerikReport(this.pi.AD_PInstance_ID, this.pi.getTable_ID()) : (this.unlock(), this.parent && (t.AskForNewTab && t.HTML && t.HTML.length > 0 ? n.ADialog.confirm("VIS_OpenNewTab", !0, "", "Confirm", function (i) { i && window.open(n.Application.contextUrl + t.ReportFilePath) }) : t.ReportFilePath ? (u = /ipad|iphone|ipod|mobile|android|blackberry|webos|windows phone/i.test(navigator.userAgent.toLowerCase()), u ? window.open(n.Application.contextUrl + t.ReportFilePath) : this.parent.setReportBytes ? (this.parent.setReportBytes(t.Report), this.parent.setReportPath(t.ReportFilePath), r = null, f = !1, t.HTML && t.HTML.length > 0 ? (r = new n.PdfViewer(t.HTML, null, !0), this.parent.showReport(r, t, this)) : t.ReportFilePath && t.ReportFilePath.length > 0 && (r = new n.PdfViewer(t.ReportFilePath, this.pi), f = !0, this.parent.showReport(r, t, this))) : window.open(n.Application.contextUrl + t.ReportFilePath)) : this.pi.getUseCrystalReportViewer() && this.pi.getIsReport() && (e = new n.ReportViewerContainer(this), e.show()))), this.setBusy(!1), this.dispose() }; i.prototype.onProcessDialogClosed = function (t, i) { var r, u; t && (r = this, this.paraList = i, this.lock(), u = { processInfo: r.pi.toJson(), parameterList: i }, n.dataContext.executeProcess(u, function (n) { if (n.error != null) { r.pi.setSummary(n.error, !0); r.unlock(); r = null; return } var t = JSON.parse(n.result); if (t.IsError) { r.pi.setSummary(t.Message, !0); r.unlock(); r = null; return } r.complete(t); this.splitUI || (r = null) })) }; i.prototype.unlock = function () { var t = this.jObjectFromServer ? this.jObjectFromServer.Result : null; t != null && t.indexOf("@") != -1 ? this.pi.setSummary(n.Msg.parseTranslation(n.Env.getCtx(), t)) : t && this.pi.setSummary(t); this.jObjectFromServer && this.pi.setError(this.jObjectFromServer.IsError); this.parent && this.parent.unlockUI(this.pi) }; i.prototype.lock = function () { this.parent && this.parent.lockUI(this.pi) }; i.prototype.dispose = function () { this.splitUI || (this.parent = null) }; r.prototype.dispose = function () { this.disposeComponent() }; n.PdfViewer = r; n.ProcessCtl = i }(VIS, jQuery), function (n, t) { function i(t, i, r, u) { this.title = t; this.AD_Process_ID = i; this.table_ID = r; this.tableName = ""; this.record_ID = u; this.AD_User_ID = 0; this.AD_Client_ID = 0; this.className = null; this.AD_PInstance_ID = 0; this.summary = ""; this.error = !1; this.batch = !1; this.timeout = !1; this.parameter = null; this.AD_PrintFormat_Table_ID = 0; this.AD_PrintFormat_ID = 0; this.isReportFormat = !1; this.isCrystal = !1; this.totalrecords = 0; this.isTelerikReport = !1; this.supportPaging = !1; this.dynamicAction = ""; this.pageSize = n.context.ctx["#REPORT_PAGE_SIZE"]; this.totalPage = 1; this.pageNo = 1; this.fileType = n.ProcessCtl.prototype.REPORT_TYPE_PDF; this.windowNo = 0; this.tableName = ""; this.AD_Window_ID = 0; this.AD_ReportView_ID = 0; this.printFormatTableName = ""; this.useCrystalReportViewer = !1; this.isReport = !1; this.isBackground = !1; this.ActionOrigin = ""; this.OriginName = ""; this.isBiHtml = !1 } function u(n, t) { n.className = t.ClassName; n.record_ID = t.Record_ID; n.error = t.Error; n.AD_PInstance_ID = t.AD_PInstance_ID; n.summary = t.Summary; n.table_ID = t.AD_Table_ID; n.tableName = t.AD_TableName; n.AD_User_ID = t.AD_User_ID; n.AD_Client_ID = t.AD_Client_ID; n.batch = t.Batch; n.timeout = t.TimeOut; n.AD_PrintFormat_Table_ID = t.AD_PrintFormat_Table_ID; n.printFormatTableName = t.PrintFormatTableName; n.AD_PrintFormat_ID = t.AD_PrintFormat_ID; n.isCrystal = t.IsCrystal; n.isReportFormat = t.IsReportFormat; n.totalrecords = parseInt(t.TotalRecords); n.isTelerikReport = t.IsTelerikReport; n.supportPaging = t.SupportPaging; n.dynamicAction = t.DynamicAction; n.pageSize = t.PageSize; n.title = t.Title; n.AD_Process_ID = t.Process_ID; n.totalPage = t.TotalPage; n.pageNo = t.PageNo; n.windowNo = t.WindowNo; n.AD_ReportView_ID = t.AD_ReportView_ID; n.isJasperReport = t.IsJasperReport; n.useCrystalReportViewer = t.UseCrystalReportViewer; n.isReport = t.IsReport; n.isBackground = t.IsBackground; n.ActionOrigin = t.ActionOrigin; n.OriginName = t.OriginName } function s(n, i, r) { var u = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function r(n, t, i, r, u) { this.P_ID; this.P_Date; this.P_Number; this.P_Msg; n ? this.setLog_ID(n) : this.setLog_ID(this.Log_ID++); this.setP_ID(t); this.setP_Date(i); this.setP_Number(r); this.setP_Msg(u) } i.prototype.toJson = function () { return { Title: this.title, Process_ID: this.AD_Process_ID, AD_PInstance_ID: this.AD_PInstance_ID, Record_ID: this.record_ID, Error: this.error, Summary: this.getSummary(), ClassName: this.className, AD_Table_ID: this.table_ID, AD_TableName: this.tableName, AD_User_ID: this.AD_User_ID, AD_Client_ID: this.AD_Client_ID, Batch: this.batch, TimeOut: this.timeout, AD_PrintFormat_Table_ID: this.AD_PrintFormat_Table_ID, PrintFormatTableName: this.printFormatTableName, AD_PrintFormat_ID: this.AD_PrintFormat_ID, SupportPaging: this.supportPaging, DynamicAction: this.dynamicAction, PageSize: this.pageSize, TotalPage: this.totalPage, PageNo: this.pageNo, FileType: this.fileType, AD_Window_ID: this.AD_Window_ID, WindowNo: this.windowNo, AD_ReportView_ID: this.AD_ReportView_ID, UseCrystalReportViewer: this.useCrystalReportViewer, IsReport: this.isReport, IsBackground: this.isBackground, ActionOrigin: this.ActionOrigin, OriginName: this.OriginName } }; i.prototype.fromJson = function (n) { var t = null; return t = this instanceof i ? this : new i(n.Title, n.Process_ID), n && n.length > 0 && u(t, n), t }; i.prototype.setPrintFormatTableName = function (n) { this.printFormatTableName = n }; i.prototype.getPrintFormatTableName = function () { return this.printFormatTableName }; i.prototype.setSupportPaging = function (n) { this.supportPaging = n }; i.prototype.getSupportPaging = function () { return this.supportPaging }; i.prototype.setTotalPages = function (n) { this.totalPage = n }; i.prototype.getTotalPages = function () { return this.totalPage }; i.prototype.setPageNo = function (n) { this.pageNo = n }; i.prototype.getPageNo = function () { return this.pageNo }; i.prototype.setPageSize = function (n) { this.pageSize = n }; i.prototype.getPageSize = function () { return this.pageSize }; i.prototype.setError = function (n) { this.error = n }; i.prototype.getIsError = function () { return this.error }; i.prototype.getIsBatch = function () { return this.batch }; i.prototype.setIsBatch = function (n) { this.batch = n }; i.prototype.getAD_PInstance_ID = function () { return this.AD_PInstance_ID }; i.prototype.setAD_PInstance_ID = function (n) { this.AD_PInstance_ID = n }; i.prototype.getAD_Process_ID = function () { return this.AD_Process_ID }; i.prototype.setAD_Process_ID = function (n) { this.AD_Process_ID = n }; i.prototype.getClassName = function () { return this.className }; i.prototype.setClassName = function (n) { this.className = n; n != null && n.length == 0 && (this.className = null) }; i.prototype.getTable_ID = function () { return this.table_ID }; i.prototype.setTable_ID = function (n) { this.table_ID = n }; i.prototype.setTable_Name = function (n) { this.tableName = n }; i.prototype.getTable_Name = function () { return this.tableName }; i.prototype.setPrintFormatTableName = function (n) { this.printFormatTableName = n }; i.prototype.getPrintFormatTableName = function () { return this.printFormatTableName }; i.prototype.getRecord_ID = function () { return this.record_ID }; i.prototype.setRecord_ID = function (n) { this.record_ID = n }; i.prototype.getTitle = function () { return this.title }; i.prototype.setTitle = function (n) { this.title = n }; i.prototype.setAD_Client_ID = function (n) { this.AD_Client_ID = n }; i.prototype.getAD_Client_ID = function () { return this.AD_Client_ID }; i.prototype.setAD_User_ID = function (n) { this.AD_User_ID = n }; i.prototype.getAD_User_ID = function () { return this.AD_User_ID }; i.prototype.getParameter = function () { return this.parameter }; i.prototype.setParameter = function (n) { this.parameter = n }; i.prototype.setIsTimeout = function (n) { this.timeout = n }; i.prototype.getIsTimeout = function () { return this.timeout }; i.prototype.set_AD_PrintFormat_Table_ID = function (n) { this.AD_PrintFormat_Table_ID = n }; i.prototype.get_AD_PrintFormat_Table_ID = function () { return this.AD_PrintFormat_Table_ID }; i.prototype.set_AD_PrintFormat_ID = function (n) { this.AD_PrintFormat_ID = n }; i.prototype.Get_AD_PrintFormat_ID = function () { return this.AD_PrintFormat_ID }; i.prototype.setIsCrystal = function (n) { this.isCrystal = n }; i.prototype.getIsCrystal = function () { return this.isCrystal }; i.prototype.setIsTelerikReport = function (n) { this.isTelerikReport = n }; i.prototype.getIsTelerikReport = function () { return this.isTelerikReport }; i.prototype.setIsReportFormat = function (n) { this.isReportFormat = n }; i.prototype.getIsReportFormat = function () { return this.isReportFormat }; i.prototype.getTotalRecord = function () { return this.totalrecords }; i.prototype.getFileType = function () { return this.fileType }; i.prototype.setFileType = function (n) { this.fileType = n }; i.prototype.setWindowNo = function (n) { this.windowNo = n }; i.prototype.getWindowNo = function () { return this.windowNo }; i.prototype.setUseCrystalReportViewer = function (n) { this.useCrystalReportViewer = n }; i.prototype.getUseCrystalReportViewer = function () { return this.useCrystalReportViewer }; i.prototype.setIsReport = function (n) { this.isReport = n }; i.prototype.getIsReport = function () { return this.isReport }; i.prototype.GetAD_ReportView_ID = function () { return this.AD_ReportView_ID }; i.prototype.SetAD_ReportView_ID = function (n) { this.AD_ReportView_ID = n }; i.prototype.setIsJasperReport = function (n) { this.isJasperReport = n }; i.prototype.getIsJasperReport = function () { return this.isJasperReport }; i.prototype.setAD_Window_ID = function (n) { this.AD_Window_ID = n }; i.prototype.getAD_Window_ID = function () { return this.AD_Window_ID }; i.prototype.setIsBackground = function (n) { this.isBackground = n }; i.prototype.getIsBackground = function () { return this.isBackground }; i.prototype.getActionOrigin = function () { return this.ActionOrigin }; i.prototype.setActionOrigin = function (n) { this.ActionOrigin = n }; i.prototype.getOriginName = function () { return this.OriginName }; i.prototype.setOriginName = function (n) { this.OriginName = n }; i.prototype.setIsBiHtml = function (n) { this.isBiHtml = n }; i.prototype.getIsBiHtml = function () { return this.isBiHtml }; i.prototype.setSummary = function (n, t) { arguments.length == 2 && this.setError(t); this.summary = n }; i.prototype.getSummary = function () { return this.summary }; i.prototype.setCustomHTML = function (n) { this.customHTML = n }; i.prototype.getCustomHTML = function () { return this.customHTML }; i.prototype.addLog = function (n, t, i, u, f) { return this.addLogEntry(new r(n, t, i, u, f)) }; i.prototype.addLogEntry = function (n) { var r, t, i, u; if (n == null) return null; for (this.logs == null && (this.logs = []), r = n.getLog_ID(), t = 0; t < this.logs.length; t++)if (i = this.logs[t], u = i.getLog_ID(), r == u) return i; return this.logs.push(n), n }; i.prototype.getLogInfo = function (t) { var i, u, r, s; if (this.logs == null) return ""; i = new StringBuilder; t && i.append('<div class=\'vis-process-result-table\'><table width="100%" border="0" cellspacing="0" cellpadding="2">'); var f = !1, e = !1, o = !1; for (u = 0; u < this.logs.length; u++)r = this.logs[u], r.getP_Date() != null && (f = !0), r.getP_Number() != null && (e = !0), r.getP_Msg() != null && (o = !0); for (u = 0; u < this.logs.length; u++)t ? i.append("<tr>") : u > 0 && i.append("\n"), r = this.logs[u], r.getP_Date() != null ? (i.append(t ? "<td>" : ""), s = r.getP_Date(), i.append(t ? "<\/td>" : " \t")) : f && i.append(t ? "<td>&nbsp;<\/td>" : " \t"), r.getP_Number() != null ? i.append(t ? "<td>" : "").append(r.getP_Number()).append(t ? "<\/td>" : " \t") : e && i.append(t ? "<td>&nbsp;<\/td>" : " \t"), r.getP_Msg() != null ? i.append(t ? "<td>" : "").append(n.Msg.parseTranslation(n.Env.getCtx(), r.getP_Msg())).append(t ? "<\/td>" : "") : o && i.append(t ? "<td>&nbsp;<\/td>" : ""), t && i.append("<\/tr>"); return t && i.append("<\/table><\/div>"), i.toString() }; i.prototype.dispose = function () { this.title = null; this.AD_Process_ID = null; this.table_ID = null; this.tableName = null; this.record_ID = null; this.AD_User_ID = null; this.AD_Client_ID == null; this.className = null; this.AD_PInstance_ID = null; this.summary = null; this.error = null; this.batch = null; this.timeout = null; this.parameter = null; this.AD_PrintFormat_Table_ID = null; this.AD_PrintFormat_ID = null; this.isReportFormat = null; this.isCrystal = null; this.totalrecords = null; this.isJasperReport = null; this.customHTML = null }; var f = n.Application.contextUrl, e = f + "JsonData/JDataSetWithCode", o = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, s(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; n.ProcessInfoUtil = { setLogFromDB: function (t) { var r = [], i; r[0] = new n.DB.SqlParam("@AD_PInstance_ID", t.getAD_PInstance_ID()); i = null; try { for (i = o("VIS_144", r); i.read();)t.addLog(i.getInt(0), i.getInt(1), i.getDateTime(2), i.getDecimal(3), i.getString(4)) } catch (u) { console.log(u) } finally { i && i.dispose() } } }; r.prototype.Log_ID = 0; r.prototype.getLog_ID = function () { return this.Log_ID }; r.prototype.setLog_ID = function (n) { this.Log_ID = n }; r.prototype.getP_ID = function () { return this.P_ID }; r.prototype.setP_ID = function (n) { this.P_ID = n }; r.prototype.getP_Date = function () { return this.P_Date }; r.prototype.setP_Date = function (n) { this.P_Date = n }; r.prototype.getP_Number = function () { return this.P_Number }; r.prototype.setP_Number = function (n) { this.P_Number = n }; r.prototype.getP_Msg = function () { return this.P_Msg }; r.prototype.setP_Msg = function (n) { this.P_Msg = n }; n.ProcessInfo = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { function b() { e = t("<div class='vis-pro-para-root'>"); l = t("<table class='vis-processpara-table vis-formouterwrpdiv'>"); p = t('<div class="vis-processbtnwrap">'); v = t('<div class="vis-para-maxheight">'); v.append(l); e.append(v).append(p); h = t('<input type="button" class="vis-process-ok-btn" >').val(n.Msg.getMsg("OK")); h.addClass("VIS_Pref_btn-2"); o = t("<input type='button'>").val(n.Msg.getMsg("Close")); o.addClass("VIS_Pref_btn-2"); c || v.css("height", "auto") } var c, e, l, a, y, w, s, h, o, p, v, f; this.pi = i; this.parent = r; this.windowNo = u; this.gridFields = []; this.depOnFieldColumn = []; this.depOnField = []; this.vEditors = []; this.vEditors2 = []; this.mFields = []; this.mFields2 = []; this.isOkClicked = !1; c = r.splitUI; this.onClosed; b(); f = this; this.addLine = function () { a = y = w = s = null; a = t("<tr>"); y = t("<td class=''>"); s = t("<td class='vis-processpara-table-td3'>"); l.append(a.append(s)); c && (l.width("100%"), a.addClass("vis-processpara-table-SplitUI"), s.addClass("vis-processpara-table-SplitUI")) }; this.addFields = function (n, i) { var r, u, f, e, c, o, h; n; i && (r = null, n && (r = n.getControl()), u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), s.append(u), u.append(f), e = i.getControl().attr("placeholder", " ").attr("data-placeholder", ""), f.append(e), r && f.append(r), i.getBtnCount() > 0 ? (i.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "), e.attr("type") == "date", c = i.getBtn(0), o = t('<div class="input-group-append">'), o.append(c), u.append(o), h = i.getBtn(1), h && o.append(h)) : e.attr("type") == "date") }; this.addButtons = function () { this.addLine(); p.append(o).append(h) }; this.canOpenDialog = function (n) { c = n }; this.showCloseIcon = function (n) { n || o.hide() }; this.showDialog = function () { e.dialog({ modal: !0, width: "auto", closeText: n.Msg.getMsg("close"), close: function () { if (f.parent) f.parent.onProcessDialogClosed(f.isOkClicked, f.parameterList); f.dispose(); f = null } }); window.setTimeout(function () { o.focus() }, 200) }; this.getRoot = function () { var n = this; return e }; this.onClose = function (n) { f.isOkClicked = n; e.dialog("close") }; o.on(n.Events.onTouchStartAndClick, function (n) { n.stopPropagation(); n.preventDefault(); f.onClose(!1) }); h.on(n.Events.onTouchStartAndClick, function (t) { var i; if (c) { if (f.isOkClicked = !0, r.setBusy(!0), i = f.saveParameters(), !i) { r.setBusy(!1); return } f.pi.setAD_PInstance_ID(0); f.pi.setPageNo(1); f.parent.getFileType() ? f.pi.setFileType(f.parent.getFileType()) : f.pi.setFileType(n.ProcessCtl.prototype.REPORT_TYPE_PDF); f.pi.setIsBackground(f.parent.isBackground()); f.parameterList = i; f.parent.onProcessDialogClosed(f.isOkClicked, f.parameterList) } else { if (t.stopPropagation(), t.preventDefault(), i = f.saveParameters(), !i) return; f.parameterList = i; f.onClose(!0, i) } }); this.setHeights = function () { }; this.disposeComponent = function () { o.off(n.Events.onTouchStartOrClick); h.off(n.Events.onTouchStartOrClick); e.dialog("destroy"); e.remove(); f = null; this.gridFields.length = 0; this.gridFields = null; this.depOnFieldColumn.length = 0; this.depOnFieldColumn - null; this.depOnField.length = 0; this.depOnField = null; this.vEditors.length = 0; this.vEditors2.length = 0; this.mFields.length = 0; this.mFields2.length = 0; this.parent = null; this.parameterList = null; this.pi = null; this.addLine = null; this.addFields = null; this.addButtons = null; this.showDialog = null; this.onClose = null; this.isOkClicked = null; e = l = a = y = w = s = h = o = null } } i.prototype.initDialog = function (i) { for (var u = null, c, s, v, r, l, h, f, o, e = 0, a = i.length; e < a; e++) { for (u = new n.GridField(i[e]), this.addLine(), this.mFields.push(u), c = u.getDependentOn(!1), s = 0; s < c.length; s++)this.depOnField.push(u), this.depOnFieldColumn.push(c[s]); v = n.VControlFactory.getLabel(u); r = n.VControlFactory.getControl(null, u, !1); r && (o = u.getDefault(n.context, this.windowNo), r.setValue(o), r.addVetoableChangeListener(this), u.getDisplayType() == n.DisplayType.AmtDimension && (r.hideButton(!1), r.setReadOnlyTextbox(!1), r.getControl().css("width", "100%"))); u.setPropertyChangeListener(r); this.vEditors.push(r); this.addFields(v, r); e == 0 && r && r.setDefaultFocus(!0); u.getIsRange() ? (this.addLine(), l = {}, t.extend(!0, l, i[e]), h = new n.GridField(l), this.mFields2.push(h), f = n.VControlFactory.getControl(null, h, !1), f && (o = h.getDefault2(n.context, this.windowNo), f.setValue(o), f.addVetoableChangeListener(this), u.getDisplayType() == n.DisplayType.AmtDimension && (f.hideButton(!1), f.setReadOnlyTextbox(!1), f.getControl().css("width", "100%"))), this.vEditors2.push(f), this.addFields(null, f)) : (this.mFields2.push(null), this.vEditors2.push(null)) } return this.addButtons(), !0 }; i.prototype.vetoablechange = function (t) { var f, r, e, s, o, i, h, u; for (console.log(t), f = t.newValue == null ? "" : t.newValue.toString(), r = t.propertyName, i = 0; i < this.mFields.length; i++)if (this.mFields[i].getColumnName().toLower() == r.toLower()) if (e = this.vEditors[i], e instanceof n.Controls.IControl && (s = this.mFields[i].getIsEditable(!0), e.setReadOnly(s)), this.mFields[i].getDisplayType() == n.DisplayType.YesNo) { f.toString() == "Y" || f.toString() == "N" ? n.Env.getCtx().setWindowContext(this.windowNo, r, f.toString()) : n.Env.getCtx().setWindowContext(this.windowNo, r, f.toString().toLowerCase() == "true" ? "Y" : "N"); break } else { n.Env.getCtx().setWindowContext(this.windowNo, r, f); break } if (this.depOnFieldColumn.indexOf(r) !== -1) for (o = this.getDependantFields(r), i = 0, h = o.length; i < h; i++)if (u = o[i], u != null) if (r == "M_Product_ID" && (u.getColumnName() == "M_Locator_ID" || u.getColumnName() == "M_LocatorTo_ID")) continue; else u.refreshLookup(), u.setValue(u.getDefault(n.Env.getCtx(), this.windowNo), !0) }; i.prototype.getDependantFields = function (n) { var i = [], r, t; if (this.depOnFieldColumn.indexOf(n) != -1) for (r = this.depOnFieldColumn.length, t = 0; t < r; t++)this.depOnFieldColumn[t].equals(n) && i.indexOf(this.depOnField[t]) < 0 && i.push(this.depOnField[t]); return i }; i.prototype.saveParameters = function () { for (var r = new StringBuilder, p = this.mFields.length, t = 0, u, w, c, l, a, v, y, i, h, o, t = 0; t < p; t++)u = this.mFields[t], u.getIsMandatory(!0) && (w = this.vEditors[t], c = w.getValue(), c == null || c.toString().length == 0 ? (u.setInserting(!0), u.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : u.setError(!1), l = this.vEditors2[t], l != null && (a = l.getValue(), v = this.mFields2[t], a == null || a.toString().length == 0 ? (u.setInserting(!0), v.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : v.setError(!1))); if (r.length() != 0) return n.ADialog.error("FillMandatory", !0, r.toString()), !1; for (y = [], i = {}, t = 0; t < p; t++) { var f = this.vEditors[t], e = this.vEditors2[t], s = f.getValue(); (f.getDisplayType() == n.DisplayType.AmtDimension && (s = f.getText()), h = null, e != null && (h = e.getValue(), e.getDisplayType() == n.DisplayType.AmtDimension && (s = e.getText())), s !== null && s !== "" || h !== null && h !== "") && (i = {}, o = this.mFields[t], i.Name = o.getColumnName(), i.DisplayType = o.getDisplayType(), i.Result = s, i.Result2 = h, i.LoadRecursiveData = o.getLoadRecursiveData(), i.ShowChildOfSelected = o.getShowChildOfSelected(), i.AD_Column_ID = o.getAD_Column_ID(), i.Info = f.getDisplay(), f.getDisplayType() == n.DisplayType.MultiKey && (i.Info = f.lastDisplay), e != null && (i.Info_To = e.getDisplay()), y.push(i)) } return y }; i.prototype.dispose = function () { this.disposeComponent() }; n.ProcessParameter = i }(VIS, jQuery), function (n, t) { n.Apps = n.Apps || {}; n.Apps.TestForm = function () { function y() { r = t("<div class='vis-height-full'>"); s = t("<input type='text'>"); f = t("<input type='button'>").val(n.Msg.getMsg("OK")); e = t("<input type='button'>").val(n.Msg.getMsg("Close")); o = t('<select style="width:300px;height:30px">'); h = t('<div style="width:300px;height:100%;float:left;background-color:gray">'); c = t('<div style="width:calc(100% - 400px);height:calc(100% - 35px);float:right;background-color:yellow">'); l = t('<div style="width:calc(100% - 300px);height:35px;float:right;background-color:brown">'); v = t('<div style="width:calc(100% - 400px);height:calc(100%);position:absolute">'); r.append(o).append(l).append(h).append(c); t.ajax({ url: n.Application.contextUrl + "home/GetReports", success: function (n) { if (n = JSON.parse(n), n) for (var t = 0; t < n.length; t++)o.append('<option value="' + n[t].Key + '">' + n[t].Name + "<\/option>") } }); o.on("change", function () { a || (a = new n.AWindow); i = a.refreshProcess(o.val(), null, "P", !0, u); i.showCloseIcon(!1); i.setSaveCsvIcons("vis-savecsv-ico-pos"); i.setReportFormatIcons("vis-repformat-ico-pos"); i.setSavePdfIcons("vis-savepdf-ico-pos"); i.setArchiveIcons("vis-archive-ico-pos"); i.setRequeryIcons("vis-requery-ico-pos"); i.setCustomizeIcons("vis-customize-ico-pos"); i.setPrintIcons("vis-print-ico-pos"); i.setToolbarColor("white"); i.showParameterCloseIcon(!1) }) } var r, s, f, e, h, c, l, v, o, a, i, u; this.frame; this.windowNo; i = null; u = this; y(); u = this; f.on(n.Events.onTouchStartOrClick, function () { alert("Test From has value :==> " + s.val()) }); e.on(n.Events.onTouchStartOrClick, function () { confirm("wanna close this form???") && u.dispose() }); this.getRoot = function () { return r }; this.getParameterContainer = function () { return h }; this.getContentContainer = function () { return c }; this.getToolbarContainer = function () { return l }; this.getBusyIndicatorContainer = function () { return v }; this.disposeComponent = function () { u = null; r && r.remove(); r = null; f && f.off(n.Events.onTouchStartOrClick); e && e.off(n.Events.onTouchStartOrClick); s = f = e = null; this.getRoot = null; this.disposeComponent = null } }; n.Apps.TestForm.prototype.init = function (n, t) { this.frame = t; this.frame.getContentGrid().append(this.getRoot()) }; n.Apps.TestForm.prototype.sizeChanged = function () { }; n.Apps.TestForm.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.TestForm.prototype.show = function () { var t = new n.CFrame; t.setName(n.Msg.getMsg("Tect")); t.setTitle(n.Msg.getMsg("Test")); t.hideHeader(!0); t.setContent(this); t.show() } }(VIS, jQuery), function (n, t) { var i = n.Application.contextUrl, f = i + "JsonData/GetGridWindow", e = i + "JsonData/InsertOrUpdateWRecords", o = i + "JsonData/DeleteWRecords", s = i + "JsonData/GetWindowRecords", h = i + "JsonData/GetWindowRecordsForTreeNode", c = i + "JsonData/GetFormInfo", l = i + "JsonData/GetProcessInfo", r = i + "JsonData/Process", a = i + "JsonData/ExecuteProcess", v = i + "JsonData/UpdateOrInsertPersonalLock", y = i + "JsonData/JDataSet", u = i + "JsonData/ExecuteNonQuer", p = i + "JsonData/GetCardViewDetail", w = i + "JsonData/GetLocLatLng", b = function () { function b(n, r) { t.ajax({ url: i + "JsonData/UpdateCtx", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify({ dCtx: n }) }).done(function (n) { r && r(n) }) } function k(n, i, r, u, f) { var e = { AD_Window_ID: n, AD_Tab_ID: i, AD_CardView_ID: r, SQL: u }; t.ajax({ url: p, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(e) }).done(function (n) { if (f) { var t = null; n && (t = n, typeof n == "string" && (t = JSON.parse(n))); f(t) } }) } function d(n, i) { t.ajax({ url: f, type: "GET", datatype: "json", async: !0, data: n }).done(function (n) { i && i(n) }) } function g(n) { var i = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify(n) }).done(function (n) { i = n }), i } function nt(n) { return new Promise(function (i) { var r = null; return t.ajax({ url: o, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify(n) }).done(function (n) { r = n; i(r) }), r }) } function tt(i, r, u, f, e, o, h) { var c = { fields: r, sqlIn: i, rowCount: u, sqlCount: f, AD_Table_ID: e, obscureFields: o }; t.ajax({ url: s, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(c) }).done(function (t) { if (h) { var i = JSON.parse(t), r = null, u = null, f = null; i && (r = (new n.DB.DataSet).toJson(i.Tables), u = i.LookupDirect, f = i.CardViewTpl); h(r, u, f) } }) } function it(i, r, u, f, e, o, s, c) { var l = { fields: r, sqlIn: i, rowCount: u, sqlCount: f, AD_Table_ID: e, treeID: o, treeNodeID: s }; t.ajax({ url: h, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify(l) }).done(function (t) { if (c) { var i = null; t && (i = (new n.DB.DataSet).toJson(t)); c(i) } }) } function rt(r, u, f) { var e = null; return t.ajax({ url: i + "JsonData/GetWindowRecord", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ sql: r, fields: u, obscureFields: f }) }).done(function (t) { t && (e = (new n.DB.DataReader).toJson(t)) }), e } function ut(n, i, r, u) { var f = null, e = { AD_User_ID: n, AD_Table_ID: i, Record_ID: r, locked: u }; return t.ajax({ url: v, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify(e) }).done(function (n) { f = n }), f } function ft(i, r) { var u = null; return i.indexOf(n.Application.contextUrl) == -1 && (i = n.Application.contextUrl + i), t.ajax({ url: i, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ fields: r }) }).done(function (n) { n && (u = JSON.parse(n)) }).fail(function (n, t, i) { alert(i) }), u } function et(n, i) { t.ajax({ url: c, type: "GET", datatype: "json", async: !0, data: n }).done(function (n) { i && i(n) }) } function ot(n, i) { t.ajax({ url: l, type: "GET", datatype: "json", async: !0, data: n }).done(function (n) { i && i(n) }) } function st(n, i) { var f = i ? !0 : !1, u = null; return t.ajax({ url: r, type: "POST", datatype: "json", async: f, data: n }).done(function (n) { u = n; i && i(n) }), u } function ht(n, i) { t.ajax({ url: r, type: "GET", datatype: "json", async: !1, data: n }).done(function (n) { i && i(n) }) } function ct(n, i) { var u = i ? !0 : !1, r = null; return t.ajax({ url: a, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: u, data: JSON.stringify(n) }).done(function (n) { r = n; i && i(n) }), r } function lt(n, i, r) { var u = null; return t.ajax({ url: y, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function at(n, i, r) { var f = null; return t.ajax({ url: u + "y", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; r && r(n) }), f } function vt(n, i, r) { var f = null; return t.ajax({ url: u + "ies", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; r && r(n) }), f } function yt(n, i, r) { var f = r ? !0 : !1, u = null; return t.ajax({ url: n, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(i) }).done(function (n) { n && (u = n, typeof n == "string" && (u = JSON.parse(n))); f && r(u) }), u } function pt(n, i, r) { var f = r ? !0 : !1, u = null; return t.ajax({ url: n, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(i) }).done(function (n) { n && (u = n, typeof n == "string" && (u = JSON.parse(n))); f && r(u) }), u } function wt(i, r) { t.ajax({ url: n.Application.contextUrl + "Chat/LoadChat", data: i, type: "GET", cache: !1, datatype: "Json", success: function (n) { r && r(n) } }) } function bt(i) { t.ajax({ url: n.Application.contextUrl + "Chat/SaveChat", type: "POST", dataType: "Json", data: i, success: function (n) { n ? console.log("Chat Saved") : console.log("Chat Not Saved") }, error: function () { console.log("Chat Not Saved") } }) } function kt(n, r) { var u = null, f = r ? !0 : !1; return t.ajax({ url: i + "Tree/GetTreeAsString", async: f, data: n }).done(function (n) { u = n; r && r(n) }), u } function dt(i, r, u, f, e) { var o, s; i == 0 ? (o = n.Application.contextUrl + "Subscribe/Subscribe", s = { AD_Window_ID: r, Record_ID: u, AD_Table_ID: f }) : (o = n.Application.contextUrl + "Subscribe/UnSubscribe", s = { AD_Window_ID: r, Record_ID: u, AD_Table_ID: f }); t.ajax({ url: o, type: "GET", dataType: "Json", data: s, success: function (t) { t == 0 ? i == 0 ? n.ADialog.error("SubscriptionFailed") : n.ADialog.error("UnSubscriptionFailed") : t == 2 && n.ADialog.info("AlreadyUnsubscribed"); e() }, error: function (t) { n.ADialog.error(n.Msg.getMsg("Error") + t.statusText) } }) } return { insertOrUpdateWRecord: g, getWindowJString: d, deleteWRecords: nt, getWindowRecords: tt, getWindowRecordsForTreeNode: it, getWindowRecord: rt, updateInsertLocks: ut, getDataSetJString: lt, getFormDataString: et, getProcessDataString: ot, process: st, processAsyncFalse: ht, executeProcess: ct, updateClientCtx: b, executeQueries: vt, executeQuery: at, getJSONRecord: ft, getJSONData: yt, subscribeUnsubscribeRecords: dt, getChatRecords: wt, saveChat: bt, getTreeAsString: kt, getCardViewInfo: k, postJSONData: pt } }(); n.dataContext = b }(VIS, jQuery); VIS.Model = VIS.Model || {}, function (n) { function t(t) { t || (t = "CalloutEngine"); this.log = n.Logging.VLogger.getVLogger(t) } var i = !1; t.prototype.isCalloutActive = function () { return i }; t.prototype.setCalloutActive = function (n) { i = n }; t.prototype.start = function (t, i, r, u, f, e, o) { var c, l, s, h; if (i == null || i.length == 0) throw new Error("No Method Name"); if (c = "", l = i + " - " + f.getColumnName() + "=" + e + " (old=" + o + ") {active=" + this.isCalloutActive() + "}", this.isCalloutActive() || this.log.info(l.toString()), s = this[i], s == null && (i = i.charAt(0).toUpperCase() + i.substr(1), s = this[i], !s)) throw new Error("Method not found: " + i); if (h = s.length, !(h == 5 || h == 6)) throw new Error("Method " + i + " has invalid no of arguments: " + h); try { c = h == 6 ? this[i](t, r, u, f, e, o) : this[i](t, r, u, f, e) } catch (a) { this.setCalloutActive(!1); this.log.log(n.Logging.Level.SEVERE, "start: " + i, a); c = a.toString() } return c }; t.prototype.DateAcct = function (n, t, i, r, u, f) { return this.isCalloutActive() ? "" : u ? (i.setValue("DateAcct", u), i.getTableName() == "C_BankStatementLine" && i.setValue("ValutaDate", u), this.setCalloutActive(!1), n = t = i = r = u = f = null, "") : "" }; t.prototype.Rate = function (t, i, r, u, f, e) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var s = f, o = n.Env.ZERO; return n.Utility.Util.getValueOfDouble(s) != 0 && (o = (1 / s).toFixed(12)), u.getColumnName().toString() == "MultiplyRate" ? r.setValue("DivideRate", o) : r.setValue("MultiplyRate", o), this.log.info(u.getColumnName() + "=" + s + " => " + o), this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutEngine = t; n.CalloutEngine = t }(VIS, jQuery), function (n) { function hi() { n.CalloutEngine.call(this, "VIS.TestClass") } function u() { n.CalloutEngine.call(this, "VIS.CalloutOrder") } function ci() { n.CalloutEngine.call(this, "VIS.CalloutInventoryMove") } function li() { n.CalloutEngine.call(this, "VIS.CalloutAssignment") } function a() { n.CalloutEngine.call(this, "VIS.CalloutCashJournal") } function yt() { n.CalloutEngine.call(this, "VIS.CalloutSetAttributeCode") } function g() { n.CalloutEngine.call(this, "VIS.CalloutProduct") } function pt() { n.CalloutEngine.call(this, "VIS.CalloutProject") } function nt() { n.CalloutEngine.call(this, "VIS.CalloutBankStatement") } function v() { n.CalloutEngine.call(this, "VIS.CalloutOfferSerIncluded") } function y() { n.CalloutEngine.call(this, "VIS.CalloutOfferServices") } function it() { n.CalloutEngine.call(this, "VIS.CalloutCheckInOut") } function b() { n.CalloutEngine.call(this, "VIS.CalloutInventory") } function o() { n.CalloutEngine.call(this, "VIS.CalloutInvoice") } function p() { n.CalloutEngine.call(this, "VIS.CalloutInvoiceBatch") } function ai() { n.CalloutEngine.call(this, "VIS.CalloutMovement") } function vi() { n.CalloutEngine.call(this, "VIS.CalloutObjectData") } function wt() { n.CalloutEngine.call(this, "VIS.CalloutOffer") } function rt() { n.CalloutEngine.call(this, "VIS.CalloutGLJournal") } function ut() { n.CalloutEngine.call(this, "VIS.CalloutProduction") } function ft() { n.CalloutEngine.call(this, "VIS.CalloutRequest") } function tt() { n.CalloutEngine.call(this, "VIS.CalloutRequisition") } function bt() { n.CalloutEngine.call(this, "VIS.CalloutPaySelection") } function et() { n.CalloutEngine.call(this, "VIS.CalloutOrderLine") } function yi() { n.CalloutEngine.call(this, "VIS.CalloutOrderlineRecording") } function pi() { n.CalloutEngine.call(this, "VIS.CalloutCurrency") } function wi() { n.CalloutEngine.call(this, "VIS.CalloutContractQty") } function bi() { n.CalloutEngine.call(this, "VIS.CalloutContractProduct") } function k() { n.CalloutEngine.call(this, "VIS.CalloutContract") } function kt() { n.CalloutEngine.call(this, "VIS.copyname") } function ki() { n.CalloutEngine.call(this, "VIS.CalloutUserTimeRec") } function ot() { n.CalloutEngine.call(this, "VIS.CalloutTimeExpense") } function c() { n.CalloutEngine.call(this, "VIS.CalloutTeamForcast") } function st() { n.CalloutEngine.call(this, "VIS.CalloutMasterForecast") } function dt() { n.CalloutEngine.call(this, "VIS.CalloutTaxAmt") } function gt() { n.CalloutEngine.call(this, "VIS.CalloutTax") } function di() { n.CalloutEngine.call(this, "VIS.CalloutSetBP") } function gi() { n.CalloutEngine.call(this, "VIS.CalloutProjectLine") } function ni() { n.CalloutEngine.call(this, "VIS.CalloutProductToOpportunity") } function nr() { n.CalloutEngine.call(this, "VIS.CalloutPriceListOpp") } function s() { n.CalloutEngine.call(this, "VIS.CalloutInOut") } function ti() { n.CalloutEngine.call(this, "VIS.CalloutPaymentAllocate") } function h() { n.CalloutEngine.call(this, "VIS.CalloutPayment") } function su(i) { var r = t.getValueOfInt(i.getValue("C_BankAccount_ID")), u = t.getValueOfInt(i.getValue("VA009_PaymentMethod_ID")), o = t.getValueOfString(i.getValue("CheckNo")), f = !1, e; r > 0 && u > 0 && o != "" && t.getValueOfString(i.getValue("TenderType")) == "K" && (e = r.toString() + "," + u.toString(), f = t.getValueOfBoolean(n.dataContext.getJSONRecord("MPayment/GetAutoCheckControl", e.toString()))); i.setValue("IsOverrideAutoCheck", f) } function w() { n.CalloutEngine.call(this, "VIS.CalloutOrderContract") } function ht() { n.CalloutEngine.call(this, "VIS.CalloutKPI") } function d() { n.CalloutEngine.call(this, "VIS.CalloutDashboard") } function ct() { n.CalloutEngine.call(this, "VIS.CalloutDashboardView") } function tr() { n.CalloutEngine.call(this, "VIS.CalloutService") } function ri() { n.CalloutEngine.call(this, "VIS.CalloutSetReadOnly") } function ir() { n.CalloutEngine.call(this, "VIS.CalloutSetContract") } function ui() { n.CalloutEngine.call(this, "VIS.CallOutWorkflow ") } function rr() { n.CalloutEngine.call(this, "VIS.CalloutSalesQuotation ") } function ur() { n.CalloutEngine.call(this, "VIS.CalloutSetDate ") } function fr() { n.CalloutEngine.call(this, "VIS.CalloutDisplayButton ") } function er() { n.CalloutEngine.call(this, "VIS.CalloutMoveConfirmLine") } function fi() { n.CalloutEngine.call(this, "VIS.CalloutDocumentType") } function or() { n.CalloutEngine.call(this, "VIS.CalloutProjectCBPartner") } function sr() { n.CalloutEngine.call(this, "VIS.CalloutPaymentTypeSO") } function hr() { n.CalloutEngine.call(this, "VIS.CalloutMCampaign") } function ei() { n.CalloutEngine.call(this, "VIS.CalloutMRequest") } function lt() { n.CalloutEngine.call(this, "VIS.CalloutModuleMgmt") } function cr() { n.CalloutEngine.call(this, "VIS.CalloutPriclistUOM") } function at() { n.CalloutEngine.call(this, "VIS.CalloutTaxAmount") } function lr() { n.CalloutEngine.call(this, "VIS.CalloutProdCatVal") } function ar() { n.CalloutEngine.call(this, "VIS.CalloutProdTypeVal") } function vr() { n.CalloutEngine.call(this, "VIS.CalloutProfitTax") } function yr() { n.CalloutEngine.call(this, "VIS.CalloutBPartner") } function pr() { n.CalloutEngine.call(this, "VIS.CalloutshipLine") } function wr() { n.CalloutEngine.call(this, "VIS.CalloutRecurring") } function br() { n.CalloutEngine.call(this, "VIS.CalloutProductionLine") } function oi() { n.CalloutEngine.call(this, "VIS.CalloutProfitLoss") } function kr() { n.CalloutEngine.call(this, "VIS.CalloutShipReceiptConfirmLine") } function si() { n.CalloutEngine.call(this, "VIS.CalloutCashJournalLine") } function dr() { n.CalloutEngine.call(this, "VIS.CalloutUOMConversion") } function gr() { n.CalloutEngine.call(this, "VIS.CalloutIncoTerm") } function nu() { n.CalloutEngine.call(this, "VIS.CalloutBlanketOrderRef") } function l(n) { var t = new Date(n); return t.setMinutes(-t.getTimezoneOffset() + t.getMinutes()), t.toISOString() } function tu() { n.CalloutEngine.call(this, "VIS.CalloutLocatorPC") } function iu() { n.CalloutEngine.call(this, "VIS.CalloutSetDates") } function ru() { n.CalloutEngine.call(this, "VIS.CalloutLandedCost") } function uu() { n.CalloutEngine.call(this, "VIS.CalloutRFQ") } function fu() { n.CalloutEngine.call(this, "VIS.CalloutPaymentTerm") } function vt() { n.CalloutEngine.call(this, "VIS.ProvisionalInvoice") } function eu() { n.CalloutEngine.call(this, "VIS.CalloutLead") } function ou() { n.CalloutEngine.call(this, "VIS.CalloutAzureBlob") } var i = n.Logging.Level, t = n.Utility.Util, f = !1, r = 0; n.Utility.inheritPrototype(hi, n.CalloutEngine); hi.prototype.set = function (n, t, i, r, u) { return i.setValue("Description", u), "" }; n.Model.TestClass = hi; n.Utility.inheritPrototype(u, n.CalloutEngine); u.prototype.DocType = function (r, u, f, e, o, s) { var d = "PR", y = "WR", it = "F", b, k, a, g, tt, c, ft; if (this.isCalloutActive() || o == null || o.toString() == "" || (b = t.getValueOfInt(o), b == null || b == 0)) return ""; this.setCalloutActive(!0); k = t.getValueOfString(f.getValue("DocumentNo")); a = k == null; !a && k.startsWith("<") && k.endsWith(">") && (a = !0); var rt = t.getValueOfInt(f.getValue("C_DocType_ID")), p = "SELECT d.DocSubTypeSO,d.HasCharges,'N',d.IsReleaseDocument,d.IsDocNoControlled,s.CurrentNext,s.CurrentNextSys,s.AD_Sequence_ID,d.IsSOTrx, d.IsReturnTrx, d.value, d.IsBlanketTrx FROM C_DocType d LEFT OUTER JOIN AD_Sequence s ON (d.DocNoSequence_ID=s.AD_Sequence_ID) WHERE C_DocType_ID=@param1", h = null, v = []; try { g = 0; a || t.getValueOfInt(rt) == 0 || (v[0] = new n.DB.SqlParam("@param1", rt), h = n.DB.executeReader(p, v), h.read() && (g = t.getValueOfInt(h.get("currentnextsys"))), h.close()); v[0] = new n.DB.SqlParam("@param1", b); h = n.DB.executeReader(p, v); v.length = 0; v = null; var l = "", w = !0, nt = !1, ut = ""; if (h.read() && (l = h.get("docsubtypeso"), ut = h.get("value"), l == null && (l = "--"), r.setContext(u, "OrderType", l), r.setContext(u, "DocTypeValue", ut), l == "BO" ? (r.setContext(u, "BlanketOrderType", l), f.setValue("BlanketOrderType", l)) : t.getValueOfString(h.get("IsReleaseDocument")).equals("Y") ? f.setValue("BlanketOrderType", "BO") : (r.setContext(u, "BlanketOrderType", "OO"), f.setValue("BlanketOrderType", "OO"), f.setValue("C_Order_Blanket", null)), !l == "SO" && f.setValue("IsDropShip", "N"), "N" == h.get("issotrx") && (w = !1), nt = h.get("isreturntrx") == "Y" ? !0 : !1, nt ? l == y ? f.setValue("DeliveryRule", it) : f.setValue("DeliveryRule", "M") : (l == y ? f.setValue("DeliveryRule", it) : l == d ? f.setValue("DeliveryRule", "R") : f.setValue("DeliveryRule", "A"), l == y || l == d || l == "WI" ? f.setValue("InvoiceRule", "I") : f.setValue("InvoiceRule", "D"), l == y ? f.setValue("PaymentRule", "B") : f.setValue("PaymentRule", "P"), r.setContext(u, "HasCharges", t.getValueOfString(h.get("hascharges")))), h.get("isdocnocontrolled") == "Y" && (a || g == t.getValueOfInt(h.get("ad_sequence_id")) || (a = !0), a && (n.Ini.getLocalStorage(n.IniConstants.P_VIENNASYS) && r.getAD_Client_ID() < 1e6 ? f.setValue("DocumentNo", "<" + h.tables[0].rows[0].cells.currentnextsys + ">") : f.setValue("DocumentNo", "<" + h.tables[0].rows[0].cells.currentnext + ">")))), h.close(), nt) return this.setCalloutActive(!1), ""; l == y || l == d || (tt = r.getContextAsInt(u, "C_BPartner_ID"), p = "SELECT PaymentRule,C_PaymentTerm_ID,InvoiceRule,DeliveryRule,FreightCostRule,DeliveryViaRule, PaymentRulePO,PO_PaymentTerm_ID FROM C_BPartner WHERE C_BPartner_ID=" + tt, tt != 0 && (h = n.DB.executeReader(p, null)), h.read() && (c = h.get(w ? "paymentrule" : "paymentrulepo"), c != null && c.length != 0 && ((w && c == "B" || c == "S" || c == "U") && (c = "P"), w || c != "B" || (c = "P"), f.setValue("PaymentRule", c)), ft = h.get(w ? "c_paymentterm_id" : "po_paymentterm_id"), h != null && f.setValue("C_PaymentTerm_ID", ft), c = h.get("invoicerule"), c != null && c.length != 0 && f.setValue("InvoiceRule", c), c = h.get("deliveryrule"), c != null && c.length != 0 && f.setValue("DeliveryRule", c), c = h.get("freightcostrule"), c != null && c.length != 0 && f.setValue("FreightCostRule", c), c = h.get("deliveryviarule"), c != null && c.length != 0 && f.setValue("DeliveryViaRule", c)), h.close()) } catch (et) { return this.setCalloutActive(!1), h != null && (h.close(), h = null), this.log.log(i.SEVERE, p, et), et } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; u.prototype.BlanketOrderLine = function (i, r, u, f, e, o) { var s = null, y, nt, rt, p, ut, ft, g; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (y = 0, e != null && (y = t.getValueOfInt(e.toString())), y == 0) return ""; if (this.setCalloutActive(!0), nt = y.toString(), s = n.dataContext.getJSONRecord("MOrderLine/GetOrderLine", nt), s != null) { var l = t.getValueOfInt(s.M_Product_ID), et = t.getValueOfInt(s.C_Charge_ID), a = t.getValueOfInt(s.Qty), h = t.getValueOfInt(s.QtyOrdered), v = t.getValueOfInt(s.QtyReleased), tt = t.getValueOfDouble(s.PriceList), w = t.getValueOfDouble(s.PriceActual), c = t.getValueOfDouble(s.C_UOM_ID), it = t.getValueOfDouble(s.Discount), b = t.getValueOfDouble(s.PriceEntered), k = t.getValueOfInt(s.M_AttributeSetInstance_ID), d = t.getValueOfDouble(s.C_Tax_ID); QtyEntered = t.getValueOfDecimal(a); paramStr = c.toString().concat(","); rt = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr); p = QtyEntered.toFixed(t.getValueOfInt(rt)); QtyEntered != p && (this.log.fine("Corrected QtyEntered Scale UOM=" + c + "; QtyEntered=" + QtyEntered + "->" + p), QtyEntered = p); paramStr = l.toString().concat(",", c.toString(), ",", QtyEntered.toString()); ut = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr); h = ut; h == null && (h = QtyEntered); ft = QtyEntered != h; ft && (paramStr = l.toString().concat(",", c.toString(), ",", v.toString()), g = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", paramStr), g != null && (v = g)); l != 0 && l != null ? u.setValue("M_Product_ID", l) : u.setValue("C_Charge_ID", et); a != 0 && a != null && u.setValue("QtyEntered", a); tt != null && u.setValue("PriceList", tt); w != null && (u.setValue("PriceActual", w), u.setValue("LineNetAmt", w * a)); b != null && (u.setValue("PriceEntered", b), u.setValue("PriceEntered", b)); it != null && u.setValue("Discount", it); c != 0 && c != null && u.setValue("C_UOM_ID", c); h != 0 && h != null && v != null && u.setValue("QtyBlanket", h + v - v); k != 0 && k != null && u.setValue("M_AttributeSetInstance_ID", k); d != 0 && d != null && u.setValue("C_Tax_ID", d) } } catch (ot) { return this.setCalloutActive(!1), ot } return this.setCalloutActive(!1), o = null, this.Qty(i, r, u, f, u.getValue("QtyEntered")) }; u.prototype.BlanketOrder = function (i, r, u, f, e, o) { var s = null, h, rt, it; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (h = 0, e != null && (h = t.getValueOfInt(e.toString())), h == 0) return ""; if (this.setCalloutActive(!0), rt = i.isSOTrx(r), it = h.toString(), s = n.dataContext.getJSONRecord("MOrder/GetOrder", it), s != null) { var l = t.getValueOfDouble(s.C_BPartner_ID), a = t.getValueOfDouble(s.M_PriceList_ID), v = t.getValueOfDouble(s.M_Warehouse_ID), y = t.getValueOfDouble(s.C_PaymentTerm_ID), p = t.getValueOfDouble(s.PaymentRule), w = t.getValueOfDouble(s.C_Payment_ID), b = t.getValueOfDouble(s.VA009_PaymentMethod_ID), k = t.getValueOfDouble(s.C_Currency_ID), d = t.getValueOfDouble(s.C_Project_ID), g = t.getValueOfDouble(s.C_Campaign_ID); c; var c = t.getValueOfDouble(s.C_ProjectRef_ID), nt = t.getValueOfDouble(s.SalesRep_ID), tt = t.getValueOfDouble(s.PriorityRule); l != 0 && l != null && u.setValue("C_BPartner_ID", l); a != 0 && a != null && u.setValue("M_PriceList_ID", a); v != 0 && v != null && u.setValue("M_Warehouse_ID", v); y != 0 && y != null && u.setValue("C_PaymentTerm_ID", y); p != 0 && p != null && u.setValue("PaymentRule", p); w != 0 && w != null && u.setValue("C_Payment_ID", w); b != 0 && b != null && u.setValue("VA009_PaymentMethod_ID", b); k != 0 && k != null && u.setValue("C_Currency_ID", k); d != 0 && d != null && u.setValue("C_Project_ID", d); g != 0 && g != null && u.setValue("C_Campaign_ID", g); c != 0 && c != null && u.setValue("C_ProjectRef_ID", c); nt != 0 && nt != null && u.setValue("SalesRep_ID", nt); tt != 0 && tt != null && u.setValue("PriorityRule", tt); u.getField("C_IncoTerm_ID") != null && u.setValue("C_IncoTerm_ID", t.getValueOfInt(s.C_IncoTerm_ID)) } } catch (ut) { return this.setCalloutActive(!1), ut } return this.setCalloutActive(!1), o = null, this.BPartner(i, r, u, f, u.getValue("C_BPartner_ID")) }; u.prototype.BPartner = function (i, r, u, f, e, o) { var c = null, h = null, yt, pt, k, et, ot, st, g, ht, ct, v, d, lt, nt, at, ut, wt, rt, tt, it, s, vt, bt, a, kt; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { var p = 0, l = "N", ft = "N"; if ((e != null && (p = t.getValueOfInt(e.toString())), p == 0) || (yt = t.getValueOfBoolean(u.getValue("IsReturnTrx")), yt)) return ""; this.setCalloutActive(!0); var w = !1, d = "VA009_", b = i.isSOTrx(r), h = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", d); if (h != null && (w = h.VA009_), d = w.toString() + "," + p, h = n.dataContext.getJSONRecord("MBPartner/GetBPartnerOrderData", d), h != null) { if (pt = t.getValueOfInt(u.getValue("M_PriceList_ID")), a = t.getValueOfDecimal(u.getValue("C_Order_Blanket")), pt > 0 && a > 0 || (k = t.getValueOfInt(b ? h.M_PriceList_ID : h.PO_PriceList_ID), k != 0 && u.setValue("M_PriceList_ID", k)), et = t.getValueOfInt(b ? h.C_IncoTerm_ID : h.C_IncoTermPO_ID), et > 0 && u.setValue("C_IncoTerm_ID", et), u.setValue("Bill_BPartner_ID", p), ot = t.getValueOfInt(h.Bill_Location_ID), ot == 0 ? (st = t.getValueOfInt(h.Bill_BPartner_ID), st > 0 && u.setValue("Bill_BPartner_ID", st)) : u.setValue("Bill_Location_ID", ot), g = t.getValueOfInt(h.C_BPartner_Location_ID), p.toString() == i.getContext("C_BPartner_ID") && (ht = i.getContext("C_BPartner_Location_ID"), ht.length > 0 && (g = t.getValueOfInt(ht))), g == 0 ? u.setValue("C_BPartner_Location_ID", null) : (u.setValue("C_BPartner_Location_ID", g), "Y" == t.getValueOfString(h.IsShipTo) && u.setValue("Bill_Location_ID", g)), ct = t.getValueOfInt(h.SalesRep_ID), ct > 0 && u.setValue("SalesRep_ID", ct), w) { var y = t.getValueOfInt(h.VA009_PaymentMethod_ID); a <= 0 && (v = n.dataContext.getJSONRecord("MBPartner/GetBPDetails", p), v != null && (l = t.getValueOfString(v.IsVendor), ft = t.getValueOfString(v.IsCustomer), b ? l == "Y" ? (y = 0, c = null, ft == "Y" && (y = t.getValueOfInt(v.VA009_PaymentMethod_ID), c = t.getValueOfString(v.VA009_PAYMENTBASETYPE))) : ft == "Y" && (y = t.getValueOfInt(v.VA009_PaymentMethod_ID), c = t.getValueOfString(v.VA009_PAYMENTBASETYPE)) : l == "Y" ? (y = t.getValueOfInt(v.VA009_PO_PaymentMethod_ID), c = t.getValueOfString(v.VA009_PAYMENTBASETYPEPO)) : (y = 0, c = null))); y == 0 ? (a = t.getValueOfInt(u.getValue("C_Order_Blanket")), a > 0 && (d = w.toString() + "," + a.toString(), h = n.dataContext.getJSONRecord("MOrder/GetPaymentMethod", d), h != null && (lt = t.getValueOfInt(h.VA009_PaymentMethod_ID), lt > 0 && (u.setValue("VA009_PaymentMethod_ID", lt), c = t.getValueOfString(h.VA009_PaymentBaseType), c != "W" && c != null && (u.setValue("PaymentMethod", c), l == "N" ? u.setValue("PaymentRule", c) : u.setValue("PaymentRulePO", c)))))) : y == 0 ? u.setValue("VA009_PaymentMethod_ID", null) : (u.setValue("VA009_PaymentMethod_ID", y), c != "W" && c != null ? (u.setValue("PaymentMethod", c), l == "N" ? u.setValue("PaymentRule", c) : u.setValue("PaymentRulePO", c)) : (u.setValue("PaymentMethod", "T"), l == "N" ? u.setValue("PaymentRule", "T") : u.setValue("PaymentRulePO", "T"))) } nt = t.getValueOfInt(h.AD_User_ID); p.toString() == i.getContext("C_BPartner_ID") && (at = i.getContext("AD_User_ID"), at.length > 0 && (nt = t.getValueOfInt(at))); nt == 0 ? u.setValue("AD_User_ID", null) : (u.setValue("AD_User_ID", nt), u.setValue("Bill_User_ID", nt)); b && (ut = t.getValueOfString(h.CreditStatusSettingOn), ut == "CH" ? (tt = t.getValueOfDouble(h.SO_CreditLimit), tt != 0 && (it = t.getValueOfDouble(h.CreditAvailable), it <= 0 && n.ADialog.info("CreditOver"))) : (wt = t.getValueOfInt(u.getValue("C_BPartner_Location_ID")), rt = n.dataContext.getJSONRecord("MBPartner/GetLocationData", wt.toString()), rt != null && (ut = t.getValueOfString(rt.CreditStatusSettingOn), ut == "CL" && (tt = t.getValueOfDouble(rt.SO_CreditLimit), tt != 0 && (it = t.getValueOfDouble(rt.CreditAvailable), it <= 0 && n.ADialog.info("CreditOver")))))); s = t.getValueOfString(h.POReference); s != null && s.length != 0 && u.setValue("POReference", s); s = t.getValueOfString(h.SO_Description); s != null && s.trim().length != 0 && u.setValue("Description", s); s = t.getValueOfString(h.IsDiscountPrinted); s != null && s.length != 0 ? u.setValue("IsDiscountPrinted", s) : u.setValue("IsDiscountPrinted", "N"); vt = i.getContext("OrderType"); u.setValue("InvoiceRule", "D"); u.setValue("DeliveryRule", "A"); w ? c != "W" && c != null ? l == "N" ? u.setValue("PaymentRule", c) : u.setValue("PaymentRulePO", c) : (l == "N" ? u.setValue("PaymentRule", "T") : u.setValue("PaymentRulePO", "T"), u.setValue("PaymentMethod", "T")) : u.setValue("PaymentRule", "P"); vt == "PR" ? (u.setValue("InvoiceRule", "I"), u.setValue("DeliveryRule", "R")) : vt == "WR" ? w ? c != "W" && c != null ? l == "N" ? u.setValue("PaymentRule", c) : u.setValue("PaymentRulePO", c) : (l == "N" ? u.setValue("PaymentRule", "T") : u.setValue("PaymentRulePO", "T"), u.setValue("PaymentMethod", "T")) : u.setValue("PaymentRule", "B") : (w ? c != "W" && c != null ? l == "N" ? u.setValue("PaymentRule", c) : u.setValue("PaymentRulePO", c) : (l == "N" ? u.setValue("PaymentRule", "T") : u.setValue("PaymentRulePO", "T"), u.setValue("PaymentMethod", "T")) : (s = t.getValueOfString(b ? h.PaymentRule : h.PaymentRulePO), s != null && s.length != 0 && (s == "B" && (s = "P"), (b && s == "S" || s == "U") && (s = "P"), u.setValue("PaymentRule", s))), bt = t.getValueOfInt(u.getValue("C_PaymentTerm_ID")), a = t.getValueOfDecimal(u.getValue("C_Order_Blanket")), bt > 0 && a > 0 || (k = t.getValueOfInt(b ? h.C_PaymentTerm_ID : h.PO_PaymentTerm_ID), kt = this.checkAdvancePaymentTerm(t.getValueOfInt(u.getValue("C_DocTypeTarget_ID")), k), kt ? k != 0 && u.setValue("C_PaymentTerm_ID", k) : u.setValue("C_PaymentTerm_ID", null)), s = t.getValueOfString(h.InvoiceRule), s != null && s.length != 0 && u.setValue("InvoiceRule", s), s = t.getValueOfString(h.DeliveryRule), s != null && s.length != 0 && u.setValue("DeliveryRule", s), s = t.getValueOfString(h.FreightCostRule), s != null && s.length != 0 && u.setValue("FreightCostRule", s), s = t.getValueOfString(h.DeliveryViaRule), s != null && s.length != 0 && u.setValue("DeliveryViaRule", s)) } } catch (dt) { return this.setCalloutActive(!1), dt } return this.setCalloutActive(!1), o = null, this.BPartnerBill(i, r, u, f, u.getValue("Bill_BPartner_ID")) }; u.prototype.BPartnerLoc = function (r, u, f, e, o, s) { var h = null, l = "", c, a, v, y, p, w; if (this.isCalloutActive() || o == null || o.toString() == "") return ""; try { if ((c = 0, o != null && (c = t.getValueOfInt(o.toString())), c == 0) || (a = t.getValueOfBoolean(f.getValue("IsReturnTrx")), a)) return ""; this.setCalloutActive(!0); v = r.isSOTrx(u); v && (l = "SELECT bp.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable FROM C_BPartner_Location p INNER JOIN C_BPartner bp ON (bp.C_BPartner_ID = p.C_BPartner_ID) WHERE p.C_BPartner_Location_ID = " + c, h = n.DB.executeReader(l), h.read() && (y = h.getString("CreditStatusSettingOn"), y == "CL" && (p = t.getValueOfDouble(h.get("so_creditlimit")), p != 0 && (w = t.getValueOfDouble(h.get("creditavailable")), h != null && w <= 0 && n.ADialog.info("CreditOver", null, "", ""))))) } catch (b) { return h != null && (h.close(), h = null), this.log.log(i.SEVERE, l, b), this.setCalloutActive(!1), b } this.setCalloutActive(!1); s = null }; u.prototype.BPartnerBill = function (r, u, f, e, o) { var h, c, b, k, l, a, y, v, p, d, g, s, w, nt, tt, it; if (this.isCalloutActive() || o == null || o.toString() == "") return ""; h = null; try { if (c = t.getValueOfInt(o.toString()), c == null || c == 0) return ""; if (this.setCalloutActive(!0), b = t.getValueOfBoolean(f.getValue("IsReturnTrx")), b) return this.setCalloutActive(!1), ""; k = "SELECT p.AD_Language,p.C_PaymentTerm_ID,p.M_PriceList_ID,p.PaymentRule,p.POReference,p.SO_Description,p.IsDiscountPrinted,p.InvoiceRule,p.DeliveryRule,p.FreightCostRule,DeliveryViaRule,p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable,c.AD_User_ID,p.PO_PriceList_ID, p.PaymentRulePO, p.PO_PaymentTerm_ID,lbill.C_BPartner_Location_ID AS Bill_Location_ID FROM C_BPartner p LEFT OUTER JOIN C_BPartner_Location lbill ON (p.C_BPartner_ID=lbill.C_BPartner_ID AND lbill.IsBillTo='Y' AND lbill.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID=" + c + " AND p.IsActive='Y'"; l = "Y" == r.getWindowContext(u, "IsSOTrx", !0); h = n.DB.executeReader(k); h.read() && (a = t.getValueOfInt(h.get("bill_location_id")), c.toString() == r.getContext("C_BPartner_ID") && (y = r.getContext("C_BPartner_Location_ID"), y.length > 0 && (a = t.getValueOfInt(y))), a == 0 ? f.setValue("Bill_Location_ID", null) : f.setValue("Bill_Location_ID", t.getValueOfInt(a)), v = t.getValueOfInt(h.get("ad_user_id")), c.toString() == r.getContext("C_BPartner_ID") && (p = r.getContext("AD_User_ID"), p.length > 0 && (v = t.getValueOfInt(p))), v == 0 ? f.setValue("Bill_User_ID", null) : f.setValue("Bill_User_ID", t.getValueOfInt(v.toString())), l && (d = 0, d != 0 && (g = 0, h != null && g < 0 && n.ADialog.info("CreditLimitOver", null, "", ""))), s = h.get("poreference"), s = h.get("so_description"), s != null && s.toString().trim().length != 0 && f.setValue("Description", s), s = h.get("isdiscountprinted"), s != null && s.toString().length != 0 ? f.setValue("IsDiscountPrinted", s) : f.setValue("IsDiscountPrinted", "N"), w = r.getContext("OrderType"), f.setValue("InvoiceRule", "D"), f.setValue("PaymentRule", "P"), w == "PR" ? f.setValue("InvoiceRule", "I") : w == "WR" ? f.setValue("PaymentRule", "B") : (s = h.get(l ? "paymentrule" : "paymentrulepo"), s != null && s.toString().length != 0 && (s == "B" && (s = "P"), l && (s == "S" || s == "U") && (s = "P"), f.setValue("PaymentRule", s)), nt = t.getValueOfInt(f.getValue("C_PaymentTerm_ID")), tt = t.getValueOfDecimal(f.getValue("C_Order_Blanket")), nt > 0 && tt > 0 || (ii = h.get(l ? "c_paymentterm_id" : "po_paymentterm_id"), it = this.checkAdvancePaymentTerm(t.getValueOfInt(f.getValue("C_DocTypeTarget_ID")), ii), it ? h != null && f.setValue("C_PaymentTerm_ID", ii) : f.setValue("C_PaymentTerm_ID", null)), s = h.get("invoicerule"), s != null && s.toString().length != 0 && f.setValue("InvoiceRule", s))); h.close() } catch (rt) { return this.setCalloutActive(!1), h != null && (h.close(), h = null), this.log(i.SEVERE, "bPartnerBill", rt), rt } return this.setCalloutActive(!1), this.PriceList(r, u, f, e, f.getValue("M_PriceList_ID")) }; u.prototype.PriceList = function (r, u, e, o, s, h) { var a = "", c = null, l, v; if (this.isCalloutActive() || s == null || s.toString() == "") return ""; try { if (l = t.getValueOfInt(s.toString()), l == null || l == 0) return ""; if (this.setCalloutActive(!0), f && this.log.warning("init"), a = "SELECT pl.IsTaxIncluded,pl.EnforcePriceLimit,pl.C_Currency_ID,c.StdPrecision,plv.M_PriceList_Version_ID,plv.ValidFrom FROM M_PriceList pl,C_Currency c,M_PriceList_Version plv WHERE pl.C_Currency_ID=c.C_Currency_ID AND pl.M_PriceList_ID=plv.M_PriceList_ID AND pl.M_PriceList_ID=" + l + "ORDER BY plv.ValidFrom DESC", c = n.DB.executeReader(a), c.read()) { e.setValue("IsTaxIncluded", "Y" == c.get("istaxincluded").toString()); r.setContext(u, "EnforcePriceLimit", c.get("enforcepricelimit").toString()); var p = t.getValueOfInt(c.get("c_currency_id")), w = t.getValueOfInt(e.getValue("C_Currency_ID")), b = t.getValueOfDecimal(e.getValue("C_Order_Blanket")); w > 0 && b > 0 || e.setValue("C_Currency_ID", p); v = t.getValueOfInt(c.get("m_pricelist_version_id")); r.setContext(u, "M_PriceList_Version_ID", v) } c.close() } catch (y) { return this.setCalloutActive(!1), c != null && c.close(), this.log(i.SEVERE, a, y), y } return f && this.log.warning("finish"), this.setCalloutActive(!1), r = u = e = o = s = h = null, "" }; u.prototype.Product = function (i, u, e, o, s, h) { var l, ft, g, y, p, c, st, w, d, b, v, a, tt, rt, lt; if (this.isCalloutActive() || s == null || s.toString() == "") return ""; var k = t.getValueOfInt(s); if (k == null || k == 0 || (y = "Y" == i.getContext("IsReturnTrx"), y)) return ""; this.setCalloutActive(!0); try { f && this.log.warning("init"); e.setValue("C_Charge_ID", null); e.setValue("M_AttributeSetInstance_ID", null); d = e.getValue("M_Product_ID").toString().concat(",", e.getValue("C_BPartner_ID").toString()); l = n.dataContext.getJSONRecord("MOrderLine/GetProductInfo", d); l != null && e.setValue("PrintDescription", l.DocumentNote); ft = l.productType.toString(); ft == "S" ? e.setValue("IsContract", !0) : (e.setValue("IsContract", !1), e.setValue("NoofCycle", null), e.setValue("QtyPerCycle", null), e.setValue("StartDate", null), e.setValue("C_Contract_ID", 0), e.setValue("EndDate", null), e.setValue("C_Frequency_ID", 0)); g = i.getWindowContext(u, "IsSOTrx", !0) == "Y"; y = i.getWindowContext(u, "IsReturnTrx", !0) == "Y"; l.IsDropShip.toString() == "Y" ? e.setValue("IsDropShip", !0) : e.setValue("IsDropShip", !1); r = t.getValueOfInt(l.countEd011); p = 0; r > 0 && (p = t.getValueOfInt(l.purchasingUom), p > 0 && g == !1 && y == !1 ? e.setValue("C_UOM_ID", p) : e.setValue("C_UOM_ID", t.getValueOfInt(l.headerUom))); var et = i.getContextAsInt(u, "C_BPartner_ID", !1), at = t.getValueOfDecimal(e.getValue("QtyOrdered")), g = i.getWindowContext(u, "IsSOTrx", !0) == "Y", ot = i.getContextAsInt(u, "M_PriceList_ID", !1), vt = i.getContextAsInt(u, "M_PriceList_Version_ID", !1), it = i.getContextAsInt(u, "M_AttributeSetInstance_ID", !1), yt = e.getValue("DateOrdered"), pt = t.getValueOfInt(e.getValue("C_UOM_ID")), a = k.toString().concat(",", et.toString(), ",", at.toString(), ",", g, ",", ot.toString(), ",", vt.toString(), ",", yt.toString(), ",", null, ",", it.toString(), ",", pt, ",", r); try { if (c = null, c = n.dataContext.getJSONRecord("MPriceList/GetPriceList", ot.toString()), st = 2, w = 2, c != null && (st = t.getValueOfInt(c.StdPrecision), w = t.getValueOfInt(c.PriceListPrecision)), c = n.dataContext.getJSONRecord("MProductPricing/GetProductPricing", a), c != null && (e.setValue("PriceList", c.PriceList), e.setValue("PriceLimit", c.PriceLimit), e.setValue("PriceActual", t.getValueOfDecimal(c.PriceActual.toFixed(w))), e.setValue("PriceEntered", t.getValueOfDecimal(c.PriceEntered.toFixed(w))), e.setValue("C_Currency_ID", t.getValueOfInt(c.C_Currency_ID)), e.setValue("Discount", t.getValueOfDecimal(c.Discount.toFixed(w))), r <= 0 && e.setValue("C_UOM_ID", t.getValueOfInt(c.C_UOM_ID)), e.setValue("QtyOrdered", e.getValue("QtyEntered")), r > 0 && p > 0 && g == !1 && y == !1 && (d = e.getValue("M_Product_ID").toString().concat("," + i.getAD_Client_ID().toString() + "," + e.getValue("C_Order_ID").toString() + "," + et.toString() + "," + e.getValue("QtyEntered").toString() + "," + t.getValueOfString(p)), b = n.dataContext.getJSONRecord("MOrderLine/GetPricesOnProductChange", d), PriceList = t.getValueOfDecimal(b.PriceList), e.setValue("PriceList", PriceList), PriceEntered = t.getValueOfDecimal(b.PriceEntered), e.setValue("PriceEntered", PriceEntered), PriceActual = t.getValueOfDecimal(b.PriceEntered.toFixed(w)), e.setValue("PriceActual", PriceActual), e.setValue("QtyOrdered", t.getValueOfDecimal(b.QtyOrdered.toFixed(b.UOMStdPrecision)))), i.setContext(u, "EnforcePriceLimit", c.IsEnforcePriceLimit ? "Y" : "N"), i.setContext(u, "DiscountSchema", c.IsDiscountSchema ? "Y" : "N"), i.isSOTrx())) { var ht = t.getValueOfDecimal(e.getValue("QtyOrdered")), ct = i.getContextAsInt(u, "M_Warehouse_ID"), it = i.getContextAsInt(u, "M_AttributeSetInstance_ID"), nt = 0; e.getValue("C_OrderLine_ID") != null && (nt = t.getValueOfInt(e.getValue("C_OrderLine_ID"))); nt == null && (nt = 0); a = k.toString().concat(",", ct.toString(), ",", it.toString(), ",", nt.toString()); v = n.dataContext.getJSONRecord("MStorage/GetQtyAvailable", a); v == null && (v = n.Env.ZERO); v == 0 || v.toString().compareTo(ht) < 0 || (a = ct.toString() + "," + k.toString() + "," + it.toString() + "," + nt.toString(), tt = n.dataContext.getJSONRecord("MOrderLine/GetNotReserved", a), tt == null && (tt = n.Env.ZERO), rt = v - tt, rt.compareTo(ht) < 0 && (lt = n.Msg.parseTranslation(i, "@QtyAvailable@=" + v + " - @QtyNotReserved@=" + tt + " = " + rt), n.ADialog.info("InsufficientQtyAvailable", !0, lt, ""))) } f && this.log.warning("fini") } catch (ut) { return this.log.saveError("calloutorder", ut.toString()), this.setCalloutActive(!1), ut.message } this.setCalloutActive(!1) } catch (ut) { this.setCalloutActive(!1); this.log.saveError("calloutorder", ut.toString()) } return this.setCalloutActive(!1), h = null, this.Tax(i, u, e, o, s) }; u.prototype.Charge = function (r, u, f, e, o, s) { var c, v, l, a, h; try { if (this.isCalloutActive() || o == null || o.toString() == "") return ""; if ((this.setCalloutActive(!0), c = t.getValueOfInt(o), c == null || c == 0) || (v = "Y" == r.getContext("IsReturnTrx"), v)) return this.setCalloutActive(!1), ""; f.getValue("M_Product_ID") != null && f.setValue("M_Product_ID", null); f.setValue("M_AttributeSetInstance_ID", null); f.setValue("S_ResourceAssignment_ID", null); l = r.getContextAsInt("#C_UOM_ID"); l > 0 ? f.setValue("C_UOM_ID", l) : f.setValue("C_UOM_ID", 100); r.setContext(u, "DiscountSchema", "N"); a = n.dataContext.getJSONRecord("MOrder/GetPrecision", f.getValue("C_Order_ID").toString()); h = n.dataContext.getJSONRecord("MCharge/GetChargeDetails", c.toString()); h != null && (f.setValue("PriceEntered", t.getValueOfDecimal(h.ChargeAmt).toFixed(a)), f.setValue("PrintDescription", t.getValueOfString(h.PrintDescription)), f.setValue("PriceActual", t.getValueOfDecimal(h.ChargeAmt).toFixed(a))); f.setValue("PriceLimit", n.Env.ZERO); f.setValue("PriceList", n.Env.ZERO); f.setValue("Discount", n.Env.ZERO) } catch (y) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, y.toString()), y } return this.setCalloutActive(!1), s = null, this.Tax(r, u, f, e, o) }; u.prototype.Tax = function (i, r, u, e, o, s) { var w, y, l, a, c, b, k, d, g, v, h; if (this.isCalloutActive() || o == null || o.toString() == "" || (console.log("Before Charge Or Product"), t.getValueOfInt(u.getValue("C_Charge_ID")) == 0 && t.getValueOfInt(u.getValue("M_Product_ID")) == 0)) return ""; this.setCalloutActive(!0); try { var nt = "", tt = "", ut = t.getValueOfString(u.getValue("M_Product_ID")).concat(",", t.getValueOfString(u.getValue("C_Order_ID")) + "," + t.getValueOfString(u.getValue("C_Charge_ID"))), h = n.dataContext.getJSONRecord("MOrderLine/GetTaxId", ut), ft = t.getValueOfInt(h._CountVATAX), it = i.getWindowContext(r, "IsSOTrx", !0) == "Y", rt = i.getWindowContext(r, "IsReturnTrx", !0) == "Y"; if (ft > 0 && (nt = t.getValueOfString(h.taxRule)), nt == "T" && (it == !0 && rt == !1 || it == !1 && rt == !1)) if (w = t.getValueOfInt(h.taxId), t.getValueOfInt(w) > 0) u.setValue("C_Tax_ID", w), u.findColumn("C_TaxExemptReason_ID") > -1 && u.findColumn("IsTaxExempt") > -1 && (u.setValue("C_TaxExemptReason_ID", t.getValueOfInt(h.C_TaxExemptReason_ID)), u.setValue("IsTaxExempt", t.getValueOfString(h.IsTaxExempt).equals("Y") ? !0 : !1)); else { if (t.getValueOfInt(u.getValue("M_Product_ID")) > 0) return u.setValue("M_Product_ID", ""), this.setCalloutActive(!1), h.TaxExempt == "Y" ? n.ADialog.info("TaxNoExemptFound") : n.ADialog.info("VATAX_DefineTax"); if (t.getValueOfInt(u.getValue("C_Charge_ID")) > 0) return u.setValue("C_Charge_ID", ""), this.setCalloutActive(!1), h.TaxExempt == "Y" ? n.ADialog.info("TaxNoExemptFound") : n.ADialog.info("VATAX_DefineChargeTax") } else { if (y = e.getColumnName(), o == null) return ""; if ((f && this.log.warning("init"), l = 0, l = y == "M_Product_ID" ? t.getValueOfInt(o) : t.getValueOfInt(i.getContextAsInt(r, "M_Product_ID")), a = 0, a = y == "C_Charge_ID" ? t.getValueOfInt(o) : t.getValueOfInt(i.getContextAsInt(r, "C_Charge_ID")), this.log.fine("Product=" + l + ", C_Charge_ID=" + a), l == 0 && a == 0) || (c = 0, c = y == "C_BPartner_Location_ID" ? t.getValueOfInt(o) : t.getValueOfInt(i.getContextAsInt(r, "C_BPartner_Location_ID")), c == 0)) return this.setCalloutActive(!1), this.Amt(i, r, u, e, o); this.log.fine("Ship BP_Location=" + c); b = i.getContext("DateOrdered"); this.log.fine("Bill Date=" + b); k = i.getContext("DatePromised"); this.log.fine("Ship Date=" + k); d = i.getContextAsInt(r, "AD_Org_ID"); this.log.fine("Org=" + d); g = i.getContextAsInt(r, "M_Warehouse_ID"); this.log.fine("Warehouse=" + g); v = i.getContextAsInt(r, "Bill_Location_ID"); v == 0 && (v = c); this.log.fine("Bill BP_Location=" + v); var et = "Y" == i.getWindowContext(r, "IsSOTrx", !0), tt = l.toString() + "," + a.toString() + "," + b.toString() + "," + k.toString() + "," + d.toString() + "," + g.toString() + "," + v.toString() + "," + c.toString() + "," + et.toString(), p = n.dataContext.getJSONRecord("MTax/Get_Tax_ID", tt); this.log.info("Tax ID=" + p); p == 0 || (u.setValue("C_Tax_ID", t.getValueOfInt(p)), u.findColumn("C_TaxExemptReason_ID") > -1 && u.findColumn("IsTaxExempt") > -1 && (h = n.dataContext.getJSONRecord("MTax/GetTaxExempt", p), h != null && (u.setValue("C_TaxExemptReason_ID", t.getValueOfInt(h.C_TaxExemptReason_ID)), u.setValue("IsTaxExempt", t.getValueOfString(h.IsTaxExempt).equals("Y") ? !0 : !1)))); f && this.log.warning("fini") } } catch (ot) { return this.setCalloutActive(!1), ot } return this.setCalloutActive(!1), s = null, this.Amt(i, r, u, e, o) }; u.prototype.Amt = function (i, u, e, o, s, h) { var w, fi, g, k, nt, rt, c, l, tt, a, v, st, ni, ut, y, yt, at, vt, p, ct, ri, b, kt, lt, dt; if (this.isCalloutActive() || s == null || s.toString() == "" || (console.log("Before Charge Or Product"), t.getValueOfInt(e.getValue("C_Charge_ID")) == 0 && t.getValueOfInt(e.getValue("M_Product_ID")) == 0)) return ""; console.log("After Charge Or Product"); this.setCalloutActive(!0); try { f && this.log.Warning("init"); var ot = i.getContextAsInt(u, "C_UOM_ID"), it = i.getContextAsInt(u, "M_Product_ID"), wt = i.getContextAsInt(u, "M_PriceList_ID"), d = t.getValueOfInt(e.getValue("C_OrderLine_Blanket_ID")) > 0 ? !0 : !1, gt = t.getValueOfInt(e.getValue("C_Quotation_Line_ID")) > 0 ? !0 : !1; gt && (d = gt); w = t.getValueOfDecimal(e.getValue("QtyDelivered")) > 0 ? !0 : !1; w || (w = t.getValueOfDecimal(e.getValue("QtyInvoiced")) > 0 ? !0 : !1); fi = wt.toString(); y = n.dataContext.getJSONRecord("MPriceList/GetPriceList", wt.toString()); g = 2; k = 2; y != null && (g = t.getValueOfInt(y.StdPrecision), k = t.getValueOfInt(y.PriceListPrecision)); nt = t.getValueOfDecimal(e.getValue("QtyEntered")); rt = t.getValueOfDecimal(e.getValue("QtyOrdered")); this.log.fine("QtyEntered=" + nt + ", Ordered=" + rt + ", UOM=" + ot); c = t.getValueOfDecimal(e.getValue("PriceEntered")); l = t.getValueOfDecimal(e.getValue("PriceActual")); a = t.getValueOfDecimal(e.getValue("Discount")); tt = t.getValueOfDecimal(e.getValue("PriceLimit")); v = t.getValueOfDecimal(e.getValue("PriceList")); this.log.fine("PriceList=" + v + ", Limit=" + tt + ", Precision=" + k); this.log.fine("PriceEntered=" + c + ", Actual=" + l + ", Discount=" + a); var at = i.getContextAsInt(u, "C_BPartner_ID", !1), vt = it.toString().concat(",", t.getValueOfString(e.getValue("C_Order_ID")) + "," + t.getValueOfString(e.getValue("M_AttributeSetInstance_ID")) + "," + t.getValueOfString(e.getValue("C_UOM_ID")) + "," + i.getAD_Client_ID().toString() + "," + t.getValueOfString(at) + "," + t.getValueOfString(e.getValue("QtyEntered")) + "," + t.getValueOfString(e.getValue("StartDate")) + "," + t.getValueOfString(e.getValue("M_PriceList_ID"))), p = n.dataContext.getJSONRecord("MOrderLine/GetPrices", vt); if (r = t.getValueOfInt(p.countEd011), st = t.getValueOfInt(p.countVAPRC), (r >= 1 || st >= 1) && (l = c), o.getColumnName() == "QtyEntered" && r > 0 && (t.getValueOfInt(e.getValue("Orig_OrderLine_ID")) > 0 || d || w || (v = t.getValueOfDecimal(p.PriceList), e.setValue("PriceList", t.getValueOfDecimal(p.PriceList)), c = t.getValueOfDecimal(p.PriceEntered), e.setValue("PriceEntered", t.getValueOfDecimal(p.PriceEntered)), l = t.getValueOfDecimal(p.PriceEntered), e.setValue("PriceActual", l))), o.getColumnName() != "QtyOrdered" && o.getColumnName() != "QtyEntered" && o.getColumnName() != "M_Product_ID" || "N" == i.getContext("DiscountSchema")) o.getColumnName() == "PriceActual" ? (l = t.getValueOfDecimal(s.toFixed(k)), c = l, this.log.fine("PriceActual=" + l + " -> PriceEntered=" + c), e.setValue("PriceEntered", c), e.setValue("PriceActual", l)) : o.getColumnName() == "PriceEntered" && (c = t.getValueOfDecimal(s.toFixed(k)), ht = it.toString().concat(",", ot.toString(), ",", c.toString()), ct = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", ht), l = ct, t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO  WHERE PREFIX IN('VAPRC_','ED011_')")) > 1 && (l = c), l == null && (l = c), this.log.fine("PriceEntered=" + c + " -> PriceActual=" + l), e.setValue("PriceActual", l), e.setValue("PriceEntered", c)); else if (ni = i.getContextAsInt(u, "C_BPartner_ID"), o.getColumnName() == "QtyEntered" && (ut = it.toString().concat(",", ot.toString() + "," + nt.toString()), y = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", ut), rt = y), rt == null && (rt = nt), !(t.getValueOfInt(e.getValue("Orig_OrderLine_ID")) > 0)) { var ei = i.getWindowContext(u, "IsSOTrx", !0) == "Y", oi = e.getValue("DateOrdered"), ht = it.toString().concat(",", ni.toString(), ",", rt.toString(), ",", ei, ",", wt.toString(), ",", "0,", oi.toString(), ",", null, ",", null, ",", ot, ",", r), ft = null; ft = n.dataContext.getJSONRecord("MProductPricing/GetProductPricing", ht); yt = ft.PriceStd; r <= 0 && st <= 0 ? (ht = it.toString().concat(",", ot.toString(), ",", yt.toString()), ct = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", ht), c = ct) : (at = i.getContextAsInt(u, "C_BPartner_ID", !1), d || w || (vt = it.toString().concat(",", e.getValue("C_Order_ID").toString() + "," + t.getValueOfString(e.getValue("M_AttributeSetInstance_ID")) + "," + t.getValueOfString(e.getValue("C_UOM_ID")) + "," + i.getAD_Client_ID().toString() + "," + at.toString() + "," + e.getValue("QtyEntered").toString() + "," + r.toString() + "," + st.toString()), p = n.dataContext.getJSONRecord("MOrderLine/GetPricesOnChange", vt), v = t.getValueOfDecimal(p.PriceList), e.setValue("PriceList", t.getValueOfDecimal(p.PriceList)), c = t.getValueOfDecimal(p.PriceEntered))); c == null && (c = yt); this.log.fine("QtyChanged -> PriceActual=" + yt + ", PriceEntered=" + c + ", Discount=" + ft.Discount); l = t.getValueOfDecimal(ft.PriceStd.toFixed(k)); d || w || e.setValue("PriceActual", c); r <= 0 && st <= 0 ? d || w || e.setValue("Discount", ft.Discount) : d || w || (l = c, e.setValue("Discount", (t.getValueOfDecimal(e.getValue("PriceList")) - c) / t.getValueOfDecimal(e.getValue("PriceList")) * 100)); e.setValue("PriceEntered", c); i.setContext(u, "DiscountSchema", ft.DiscountSchema ? "Y" : "N") } if (o.getColumnName() == "Discount") l = t.getValueOfDecimal((100 - a) / 100 * v), t.scale(l) > k && (l = l.toFixed(k)), c = l, c == null && (c = l), e.setValue("PriceActual", l), e.setValue("PriceEntered", c); else { if (v == 0) a = n.Env.ZERO; else if (a = t.getValueOfDecimal((v - l) / v * 100), isNaN(a)) return this.setCalloutActive(!1), "PriceListNotSelected"; a = t.getValueOfDecimal(a.toFixed(k)); e.setValue("PriceList", t.getValueOfDecimal(v.toFixed(k))); d || w || e.setValue("Discount", a) } this.log.fine("PriceEntered=" + c + ", Actual=" + l + ", Discount=" + a); var ti = !1, et = i.getContext("EnforcePriceLimit"), pt = i.isSOTrx() && et != null && et == "Y"; if (et == "") { var ut = t.getValueOfInt(e.getValue("C_Order_ID")).toString(), ii = n.dataContext.getJSONRecord("MOrder/GetOrder", ut), bt = "SELECT EnforcePriceLimit FROM M_PriceList WHERE IsActive = 'Y' AND M_PriceList_ID = " + ii.M_PriceList_ID; et = n.DB.executeScalar(bt); pt = ii.IsSOTrx && et != null && et == "Y"; bt = "SELECT OverwritePriceLimit FROM AD_Role WHERE IsActive = 'Y' AND AD_Role_ID = " + i.getContext("#AD_Role_ID"); ti = t.getValueOfBoolean(n.DB.executeScalar(bt)) } if (ri = "Y" == i.getContext("IsReturnTrx"), pt && (ti || ri) && (pt = !1), pt && tt != 0 && l.compareTo(tt) < 0 && (l = tt, c = l, c == null && (c = tt), this.log.fine("(under) PriceEntered=" + c + ", Actual" + tt), d || w || (e.setValue("PriceActual", tt), e.setValue("PriceEntered", c)), n.ADialog.info("UnderLimitPrice", !0, "", ""), v != 0 && (a = t.getValueOfDecimal((v - l) / v * 100), a = a.toFixed(2), d || w || e.setValue("Discount", a))), c = t.getValueOfDecimal(e.getValue("PriceEntered")), b = nt * c, nt > 0 && b == 0 && (kt = t.getValueOfDecimal(e.getValue("C_OrderLine_Blanket_ID")), kt > 0 && (y = n.dataContext.getJSONRecord("MOrderLine/GetOrderLine", kt.toString()), y != null))) { var v = t.getValueOfDouble(y.PriceList), l = t.getValueOfDouble(y.PriceActual), c = t.getValueOfDouble(y.PriceEntered), a = t.getValueOfDouble(y.Discount); c != null && (e.setValue("PriceEntered", c), e.setValue("LineNetAmt", c * nt), b = c * nt); v != null && e.setValue("PriceList", v); a != null && e.setValue("Discount", a); l != null && e.setValue("PriceActual", l) } if (t.scale(b) > g && (b = t.getValueOfDecimal(b.toFixed(g))), this.log.info("LineNetAmt=" + b), e.setValue("LineNetAmt", b), lt = n.Env.ZERO, o.getColumnName() == "TaxAmt") lt = e.getValue("TaxAmt"); else if (dt = e.getValue("C_Tax_ID"), dt != null) { var si = dt, ui = this.IsTaxIncluded(u, i), ut = si.toString().concat(",", b.toString(), ",", ui, ",", g.toString()), y = null; lt = n.dataContext.getJSONRecord("MTax/CalculateTax", ut); e.setValue("TaxAmt", lt); e.getField("SurchargeAmt") != null && e.setValue("SurchargeAmt", 0) } ui ? e.setValue("LineTotalAmt", t.getValueOfDecimal(b.toFixed(g))) : e.setValue("LineTotalAmt", t.getValueOfDecimal(b.toFixed(g)) + t.getValueOfDecimal(lt.toFixed(g))) } catch (hi) { return this.setCalloutActive(!1), hi } return this.setCalloutActive(!1), i = u = e = o = s = h = null, "" }; u.prototype.IsTaxIncluded = function (t, i) { var r = i.getContext("IsTaxIncluded"), u; try { if (r.toString().length == 0) { if (u = i.getContextAsInt(t, "M_PriceList_ID"), u == 0) return !1; r = n.DB.executeScalar("SELECT IsTaxIncluded FROM M_PriceList WHERE M_PriceList_ID=" + u, null, null).toString(); r == null && (r = "N"); i.setContext(t, "IsTaxIncluded", r) } } catch (f) { this.setCalloutActive(!1); this.log.severe(f.toString()) } return i = t = mTab = mField = value = oldValue = null, "Y" == r }; u.prototype.Qty = function (i, u, e, o, s, h) { var a = "", b, tt, et, dt, gt, ut, ui, it, ni, vt, p, pt, g, k, v, w, y, ti, st, ht, wt, ii; if (this.isCalloutActive() || s == null || s.toString() == "" || (console.log("Before Charge Or Product"), t.getValueOfInt(e.getValue("C_Charge_ID")) == 0 && t.getValueOfInt(e.getValue("M_Product_ID")) == 0)) return ""; console.log("After Charge Or Product"); this.setCalloutActive(!0); try { b = i.getContextAsInt(u, "M_Product_ID"); f && this.log.Warning("init - M_Product_ID=" + b + " - "); var l = n.Env.ZERO, c = n.Env.ZERO, li = n.Env.ZERO, nt, d, lt = "Y" == i.getContext("IsReturnTrx"), rt = t.getValueOfInt(e.getValue("C_OrderLine_Blanket_ID")) > 0 ? !0 : !1, bt = t.getValueOfInt(e.getValue("C_Quotation_Line_ID")) > 0 ? !0 : !1; bt && (rt = bt); var ct = i.getContextAsInt(u, "C_BPartner_ID", !1), kt = n.dataContext.getJSONRecord("MBPartner/GetBPartner", ct.toString()), ri = n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID", b.toString()); if (b == 0) c = t.getValueOfDecimal(e.getValue("QtyEntered")), l = c, e.setValue("QtyOrdered", l); else if (o.getColumnName() == "C_UOM_ID" || o.getColumnName() == "M_AttributeSetInstance_ID" || o.getColumnName() == "StartDate") p = t.getValueOfInt(e.getValue("C_UOM_ID")), c = t.getValueOfDecimal(e.getValue("QtyEntered")), it = t.getValueOfString(ct).concat(",", t.getValueOfString(e.getValue("C_Order_ID")) + "," + t.getValueOfString(e.getValue("M_AttributeSetInstance_ID")) + "," + t.getValueOfString(p) + "," + t.getValueOfString(i.getAD_Client_ID()) + "," + t.getValueOfString(e.getValue("M_Product_ID")) + "," + t.getValueOfString(e.getValue("QtyEntered")) + "," + t.getValueOfString(e.getValue("StartDate")) + "," + t.getValueOfString(e.getValue("M_PriceList_ID"))), tt = n.dataContext.getJSONRecord("MOrderLine/GetProductPriceOnUomChange", it), r = t.getValueOfInt(tt.countEd011), r > 0 ? (et = t.getValueOfInt(tt.isAttributeValue), et == 1 ? (dt = t.getValueOfDecimal(tt.PriceEntered), rt || (e.setValue("PriceList", t.getValueOfDecimal(tt.PriceList)), e.setValue("PriceLimit", t.getValueOfDecimal(tt.PriceLimit)), e.setValue("PriceActual", t.getValueOfDecimal(tt.PriceEntered)), e.setValue("PriceEntered", t.getValueOfDecimal(tt.PriceEntered))), a = p.toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + p + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", p.toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, y = !1, l != null && (y = c != l), l == null && (y = !1, l = 1), y ? e.setValue("QtyOrdered", l) : e.setValue("QtyOrdered", l * v), rt || (e.setValue("PriceActual", dt), e.setValue("PriceList", t.getValueOfDecimal(tt.PriceList)))) : (et == 2 || et == 0) && (et == 2 ? (gt = t.getValueOfDecimal(tt.PriceEntered), rt || (e.setValue("PriceList", t.getValueOfDecimal(tt.PriceList)), e.setValue("PriceLimit", t.getValueOfDecimal(tt.PriceLimit)), e.setValue("PriceActual", t.getValueOfDecimal(tt.PriceEntered)), e.setValue("PriceEntered", t.getValueOfDecimal(tt.PriceEntered))), a = p.toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + p + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", p.toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, y = !1, l != null && (y = c != l), l == null && (y = !1, l = 1), y ? e.setValue("QtyOrdered", l) : e.setValue("QtyOrdered", l * v), rt || (e.setValue("PriceActual", gt), e.setValue("PriceList", t.getValueOfDecimal(tt.PriceList)))) : (a = p.toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + p + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", p.toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, l == null && (l = c), y = c != l, nt = t.getValueOfDecimal(e.getValue("PriceEntered")), a = b.toString().concat(",", p.toString(), ",", nt.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), d = w, d == null && (d = nt), this.log.fine("UOM=" + p + ", QtyEntered/PriceActual=" + c + "/" + nt + " -> " + y + " QtyOrdered/PriceEntered=" + l + "/" + d), i.setContext(u, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyOrdered", l), e.setValue("PriceEntered", d), ut = 0, ui = 0, rt || (it = t.getValueOfString(b).concat(",", t.getValueOfString(e.getValue("C_Order_ID")) + "," + t.getValueOfString(e.getValue("M_AttributeSetInstance_ID")) + "," + t.getValueOfString(p) + "," + t.getValueOfString(i.getAD_Client_ID()) + "," + t.getValueOfString(kt.M_DiscountSchema_ID) + "," + t.getValueOfString(kt.FlatDiscount) + "," + t.getValueOfString(e.getValue("QtyEntered")) + "," + t.getValueOfString(ri)), g = n.dataContext.getJSONRecord("MOrderLine/GetPricesOnUomChange", it), PriceList = t.getValueOfDecimal(g.PriceList), e.setValue("PriceList", t.getValueOfDecimal(g.PriceList)), d = t.getValueOfDecimal(g.PriceEntered), e.setValue("PriceEntered", t.getValueOfDecimal(g.PriceEntered)), nt = t.getValueOfDecimal(g.PriceEntered), e.setValue("PriceActual", nt))))) : (a = p.toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + p + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", p.toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, l == null && (l = c), y = c != l, nt = t.getValueOfDecimal(e.getValue("PriceActual")), a = b.toString().concat(",", p.toString(), ",", nt.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), d = w, d == null && (d = nt), this.log.fine("UOM=" + p + ", QtyEntered/PriceActual=" + c + "/" + nt + " -> " + y + " QtyOrdered/PriceEntered=" + l + "/" + d), i.setContext(u, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyOrdered", l), e.setValue("PriceEntered", d)); else if (o.getColumnName() == "QtyEntered") p = i.getContextAsInt(u, "C_UOM_ID"), c = t.getValueOfDecimal(s), a = p.toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + p + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", p.toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, l == null && (l = c), y = c != l, this.log.fine("UOM=" + p + ", QtyEntered=" + c + " -> " + y + " QtyOrdered=" + l), i.setContext(u, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyOrdered", l); else if (o.getColumnName() == "QtyOrdered") { p = i.getContextAsInt(u, "C_UOM_ID"); l = t.getValueOfDecimal(s); a = b.toString().concat(","); var k = n.dataContext.getJSONRecord("MProduct/GetUOMPrecision", a), fi = k, at = l.toFixed(fi); l != at && (this.log.fine("Corrected QtyOrdered Scale " + l + "->" + at), l = at, e.setValue("QtyOrdered", l)); a = b.toString().concat(",", p.toString(), ",", l.toString()); ni = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", a); c = ni; c == null && (c = l); y = l != c; this.log.fine("UOM=" + p + ", QtyOrdered=" + l + " -> " + y + " QtyEntered=" + c); i.setContext(u, "UOMConversion", y ? "Y" : "N"); e.setValue("QtyEntered", c) } else l = t.getValueOfDecimal(e.getValue("QtyOrdered")); if (b != 0 && lt && (vt = t.getValueOfInt(e.getValue("Orig_InOutLine_ID")), vt != 0)) { a = vt.toString(); var yt = n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine", a), ei = yt.MovementQty, ot = t.getValueOfDecimal(ei); l = t.getValueOfDecimal(e.getValue("QtyOrdered")); ot < l && (i.isSOTrx() ? n.ADialog.info("QtyShippedAndReturned", null, ot.toString(), "") : n.ADialog.info("QtyRecievedAndReturnd", null, ot.toString(), ""), e.setValue("QtyOrdered", ot), l = ot, p = i.getContextAsInt(u, "C_UOM_ID"), a = b.toString().concat(",", p.toString(), ",", l.toString()), c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", a), c == null && (c = l), e.setValue("QtyEntered", c), this.log.fine("QtyEntered : " + c.toString() + "QtyOrdered : " + l.toString())) } if (b != 0 && l > 0 && !lt && o.getColumnName() == "M_AttributeSetInstance_ID") { c = t.getValueOfDecimal(e.getValue("QtyEntered")); var ut = 0, it = b.toString().concat(",", t.getValueOfString(e.getValue("C_Order_ID")) + "," + t.getValueOfString(e.getValue("M_AttributeSetInstance_ID")) + "," + t.getValueOfString(e.getValue("C_UOM_ID")) + "," + i.getAD_Client_ID().toString() + "," + t.getValueOfString(ct) + "," + t.getValueOfString(c) + "," + t.getValueOfString(e.getValue("StartDate")) + "," + t.getValueOfString(e.getValue("M_PriceList_ID"))), g = n.dataContext.getJSONRecord("MOrderLine/GetPrices", it); g != null && (r = t.getValueOfInt(g.countEd011), pt = t.getValueOfInt(g.countVAPRC), d = g.PriceEntered, ut = g.PriceList, rt || (e.setValue("PriceList", ut), e.setValue("PriceActual", d), e.setValue("PriceEntered", d)), r <= 0 && pt <= 0 ? (it = e.getValue("C_UOM_ID").toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", it), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + t.getValueOfInt(e.getValue("C_UOM_ID")) + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), it = b.toString().concat(",", e.getValue("C_UOM_ID").toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", it), l = w, l == null && (l = c), y = c != l, nt = t.getValueOfDecimal(e.getValue("PriceEntered")), a = b.toString().concat(",", e.getValue("C_UOM_ID").toString(), ",", nt.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), d = w, d == null && (d = nt), this.log.fine("UOM=" + p + ", QtyEntered/PriceActual=" + c + "/" + nt + " -> " + y + " QtyOrdered/PriceEntered=" + l + "/" + d), i.setContext(u, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyOrdered", l), e.setValue("PriceEntered", d)) : (rt || (it = b.toString().concat(",", t.getValueOfString(e.getValue("C_Order_ID")) + "," + t.getValueOfString(e.getValue("M_AttributeSetInstance_ID")) + "," + t.getValueOfString(e.getValue("C_UOM_ID")) + "," + i.getAD_Client_ID().toString() + "," + t.getValueOfString(ct) + "," + t.getValueOfString(c) + "," + t.getValueOfString(r) + "," + t.getValueOfString(pt) + "," + t.getValueOfString(e.getValue("StartDate")) + "," + t.getValueOfString(e.getValue("M_PriceList_ID"))), g = n.dataContext.getJSONRecord("MOrderLine/GetPricesOnChange", it), ut = t.getValueOfDecimal(g.PriceList), e.setValue("PriceList", ut), d = t.getValueOfDecimal(g.PriceEntered), e.setValue("PriceEntered", d), nt = t.getValueOfDecimal(g.PriceEntered), e.setValue("PriceActual", nt)), a = e.getValue("C_UOM_ID").toString().concat(","), k = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), v = c.toFixed(t.getValueOfInt(k)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + t.getValueOfInt(e.getValue("C_UOM_ID")) + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), a = b.toString().concat(",", e.getValue("C_UOM_ID").toString(), ",", c.toString()), w = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = w, y = !1, l != null && (y = c != l), l == null && (y = !1, l = 1), y ? e.setValue("QtyOrdered", l) : e.setValue("QtyOrdered", l * v))) } if (b != 0 && i.isSOTrx() && l > 0 && !lt && (ti = n.dataContext.getJSONRecord("MProduct/GetProduct", b.toString()), st = 0, t.getValueOfBoolean(ti.IsStocked))) { var oi = i.getContextAsInt(u, "M_Warehouse_ID"), si = i.getContextAsInt(u, "M_AttributeSetInstance_ID"), hi = b.toString().concat(",", oi.toString(), ",", si.toString(), ",", st.toString()), yt = null, ft = n.dataContext.getJSONRecord("MStorage/GetQtyAvailable", hi); ft == null && (ft = n.Env.ZERO); ft == 0 || ft.toString().compareTo(l) < 0 || (st = e.getValue("C_OrderLine_ID") == "" ? 0 : t.getValueOfInt(e.getValue("C_OrderLine_ID")), st == null && (st = 0), ht = yt.notReserved, ht == null && (ht = n.Env.ZERO), wt = ft - ht, wt < l && (ii = n.Msg.parseTranslation(i, "@QtyAvailable@=" + ft + "  -  @QtyNotReserved@=" + ht + "  =  " + wt), n.ADialog.info("InsufficientQtyAvailable", null, ii, ""))) } } catch (ci) { return this.setCalloutActive(!1), ci } return this.setCalloutActive(!1), i = u = e = o = s = h = null, "" }; u.prototype.Orig_Order = function (i, r, u, f, e, o) { var h, s, a, v, y, l, c; if (this.isCalloutActive() || e == null || e.toString() == "" || (h = t.getValueOfInt(e), h == null || h == 0)) return ""; this.setCalloutActive(!0); try { s = n.dataContext.getJSONRecord("MOrder/GetOrder", h.toString()); a = n.dataContext.getJSONRecord("MBPartner/GetBPartner", s.C_BPartner_ID.toString()); u.setValue("Orig_InOut_ID", null); u.setValue("C_BPartner_ID", t.getValueOfInt(s.C_BPartner_ID)); u.setValue("C_BPartner_Location_ID", t.getValueOfInt(s.C_BPartner_Location_ID)); u.setValue("Bill_BPartner_ID", t.getValueOfInt(s.Bill_BPartner_ID)); u.setValue("Bill_Location_ID", t.getValueOfInt(s.Bill_Location_ID)); s.AD_User_ID != 0 && u.setValue("AD_User_ID", t.getValueOfInt(s.AD_User_ID)); s.Bill_User_ID != 0 && u.setValue("Bill_User_ID", t.getValueOfInt(s.Bill_User_ID)); i.isSOTrx() ? u.setValue("M_ReturnPolicy_ID", t.getValueOfInt(a.M_ReturnPolicy_ID)) : u.setValue("M_ReturnPolicy_ID", t.getValueOfInt(a.PO_ReturnPolicy_ID)); !0 && (this.setCalloutActive(!1), u.setValue("M_PriceList_ID", t.getValueOfInt(s.M_PriceList_ID)), this.setCalloutActive(!0)); u.setValue("PaymentRule", s.PaymentRule); v = this.checkAdvancePaymentTerm(t.getValueOfInt(u.getValue("C_DocTypeTarget_ID")), t.getValueOfInt(s.C_PaymentTerm_ID)); v ? u.setValue("C_PaymentTerm_ID", t.getValueOfInt(s.C_PaymentTerm_ID)) : u.setValue("C_PaymentTerm_ID", null); u.setValue("Bill_Location_ID", t.getValueOfInt(s.Bill_Location_ID)); u.setValue("InvoiceRule", s.InvoiceRule); u.setValue("PaymentRule", s.PaymentRule); u.setValue("DeliveryViaRule", s.DeliveryViaRule); u.setValue("FreightCostRule", s.FreightCostRule); y = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")); y > 0 && (l = n.DB.executeScalar("SELECT VA009_PaymentMethod_ID FROM C_Order WHERE C_Order_ID=" + h), l > 0 && (u.setValue("VA009_PaymentMethod_ID", l), c = n.DB.executeScalar("SELECT VA009_PaymentBaseType FROM VA009_PaymentMethod WHERE VA009_PaymentMethod_ID=" + l), c != "W" && c != null && (u.setValue("PaymentMethod", c), u.setValue("PaymentRule", c)))) } catch (p) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; u.prototype.Orig_InOut = function (i, r, u, f, e, o) { var h, s; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (h = t.getValueOfInt(e), h == null || h == 0) return ""; this.setCalloutActive(!0); s = n.dataContext.getJSONRecord("MInOut/GetInOut", h.toString()); u.setValue("C_Project_ID", t.getValueOfInt(s.C_Project_ID)); u.setValue("C_Campaign_ID", t.getValueOfInt(s.C_Campaign_ID)); u.setValue("C_Activity_ID", t.getValueOfInt(s.C_Activity_ID)); u.setValue("AD_OrgTrx_ID", t.getValueOfInt(s.AD_OrgTrx_ID)); u.setValue("User1_ID", t.getValueOfInt(s.User1_ID)); u.setValue("User2_ID", t.getValueOfInt(s.User2_ID)); t.getValueOfString(s.IsDropShip) == "Y" ? (u.setValue("M_Warehouse_ID", t.getValueOfInt(s.M_Warehouse_ID)), u.setValue("IsDropShip", !0)) : (u.setValue("IsDropShip", !1), u.setValue("M_Warehouse_ID", null)) } catch (c) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; u.prototype.Orig_OrderLine = function (i, r, u, f, e, o) { var c, s, a, v, l, y, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (c = t.getValueOfInt(e), c == null || c == 0) return ""; this.setCalloutActive(!0); s = n.dataContext.getJSONRecord("MOrderLine/GetOrderLine", c.toString()); u.setValue("Orig_InOutLine_ID", null); u.setValue("C_Tax_ID", t.getValueOfInt(s.C_Tax_ID)); u.setValue("PriceList", t.getValueOfDecimal(s.PriceList)); u.setValue("PriceLimit", t.getValueOfDecimal(s.PriceLimit)); u.setValue("PriceActual", t.getValueOfDecimal(s.PriceActual)); u.setValue("PriceEntered", t.getValueOfDecimal(s.PriceEntered)); u.setValue("C_Currency_ID", t.getValueOfInt(s.C_Currency_ID)); u.setValue("Discount", t.getValueOfDecimal(s.Discount)); a = i.getContextAsInt(r, "M_PriceList_ID"); v = n.dataContext.getJSONRecord("MPriceList/GetPriceList", a.toString()); l = t.getValueOfInt(v.StdPrecision); y = t.getValueOfDecimal(u.getValue("QtyOrdered")); h = y * t.getValueOfDecimal(s.PriceActual); t.scale(h) > l && (h = h.toFixed(l)); this.log.info("LineNetAmt=" + h); u.setValue("LineNetAmt", h) } catch (p) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; u.prototype.Orig_InOutLine = function (i, r, u, f, e, o) { var h, s, c; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (h = t.getValueOfInt(e), h == null || h == 0) return ""; if (this.setCalloutActive(!0), s = n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine", h.toString()), s != null) { u.setValue("C_Project_ID", t.getValueOfInt(s.C_Project_ID)); u.setValue("C_Campaign_ID", t.getValueOfInt(s.C_Campaign_ID)); u.setValue("M_Product_ID", t.getValueOfInt(s.M_Product_ID)); u.setValue("M_AttributeSetInstance_ID", t.getValueOfInt(s.M_AttributeSetInstance_ID)); u.setValue("C_UOM_ID", t.getValueOfInt(s.C_UOM_ID)); c = t.getValueOfDecimal(s.QtyEntered); u.setValue("QtyEntered", c); var a = s.M_Product_ID.toString().concat(",", s.C_UOM_ID.toString(), ",", c.toString()), v = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), l = v; l == null && (l = c); u.setValue("QtyOrdered", l); t.getValueOfString(s.IsDropShip) == "Y" ? (u.setValue("IsDropShip", !0), i.setContext(r, "IsDropShip", t.getValueOfString(s.IsDropShip))) : u.setValue("IsDropShip", !1) } } catch (y) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; u.prototype.checkAdvancePaymentTerm = function (i, r) { var u = !0, f = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), e; return f != null && !f.VA009_ ? u : (t.getValueOfInt(i) != 0 && t.getValueOfInt(r) != 0 && (e = i.toString() + "," + r.toString(), u = n.dataContext.getJSONRecord("MOrder/checkAdvancePaymentTerm", e)), u) }; n.Model.CalloutOrder = u; n.Utility.inheritPrototype(ci, n.CalloutEngine); ci.prototype.UOM = function (i, r, u, f, e, o) { var c, s, v, a, l, h; if (e == 0 || e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; this.setCalloutActive(!0); try { if (c = t.getValueOfDecimal(u.getValue("M_Product_ID")), c == 0) return QtyEntered = 1, QtyOrdered = QtyEntered, u.setValue("QtyOrdered", QtyOrdered), u.setValue("QtyEntered", QtyEntered), this.setCalloutActive(!1), i = r = u = f = e = o = null, ""; f.getColumnName() == "C_UOM_ID" ? (s = t.getValueOfInt(e), QtyEntered = t.getValueOfDecimal(u.getValue("QtyEntered")), c = t.getValueOfInt(u.getValue("M_Product_ID")), paramStr = c.toString().concat(",").concat(s.toString()).concat(",").concat(QtyEntered.toString()), l = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), QtyOrdered = l, h = !1, QtyOrdered != null && (h = QtyEntered != QtyOrdered), QtyOrdered == null && (h = !1, QtyOrdered = 1), h ? u.setValue("MovementQty", QtyOrdered) : u.setValue("MovementQty", QtyOrdered * QtyEntered)) : f.getColumnName() == "QtyEntered" && (s = i.getContextAsInt(r, "C_UOM_ID"), QtyEntered = t.getValueOfDecimal(e), paramStr = s.toString().concat(","), v = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr), a = QtyEntered.toFixed(t.getValueOfInt(v)), QtyEntered != a && (this.log.fine("Corrected QtyEntered Scale UOM=" + s + "; QtyEntered=" + QtyEntered + "->" + a), QtyEntered = a, u.setValue("QtyEntered", QtyEntered)), paramStr = c.toString().concat(",", s.toString(), ",", QtyEntered.toString()), l = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), QtyOrdered = l, QtyOrdered == null && (QtyOrdered = QtyEntered), h = QtyEntered != QtyOrdered, this.log.fine("UOM=" + s + ", QtyEntered=" + QtyEntered + " -> " + h + " QtyOrdered=" + QtyOrdered), i.setContext(r, "UOMConversion", h ? "Y" : "N"), u.setValue("MovementQty", QtyOrdered)) } catch (y) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutInventoryMove = ci; n.Utility.inheritPrototype(li, n.CalloutEngine); li.prototype.Product = function (r, u, f, e, o, s) { var c, v; if (o == null || o.toString() == "" || this.isCalloutActive() || o == null || (c = t.getValueOfInt(o), c == 0)) return ""; this.setCalloutActive(!0); var l = 0, a = null, y = null, p = null, w = "SELECT p.M_Product_ID, ra.Name, ra.Description, ra.Qty FROM S_ResourceAssignment ra INNER JOIN M_Product p ON (p.S_Resource_ID=ra.S_Resource_ID) WHERE ra.S_ResourceAssignment_ID=" + c, h = null; try { h = n.DB.executeReader(w, null, null); h.read() && (l = t.getValueOfInt(h.get(0)), a = t.getValueOfString(h.get(1)), y = t.getValueOfString(h.get(2)), p = t.getValueOfDecimal(h.get(3))); h.close() } catch (b) { h != null && (h.close(), h = null); this.setCalloutActive(!1); this.log.log(i.SEVERE, "product", b) } return this.log.fine("S_ResourceAssignment_ID=" + c + " - M_Product_ID=" + l), l != 0 && (f.setValue("M_Product_ID", t.getValueOfInt(l)), y != null && (a += " (" + y + ")"), "." != a && f.setValue("Description", a), v = "Qty", f.getTableName().startsWith("C_Order") ? v = "QtyOrdered" : f.getTableName().startsWith("C_Invoice") && (v = "QtyInvoiced"), p != null && f.setValue(v, p)), this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; n.Model.CalloutAssignment = li; n.Utility.inheritPrototype(a, n.CalloutEngine); a.prototype.Invoice = function (r, u, f, e, o, s) { var l, v, g, d; if (this.isCalloutActive()) return ""; if (o == null || o.toString() == "") return e.getColumnName() == "C_Invoice_ID" && (this.setCalloutActive(!0), f.setValue("C_BPartner_ID", null), f.setValue("C_BPartner_Location_ID", null), f.setValue("C_InvoicePaySchedule_ID", null), r.setContext(u, "InvTotalAmt", ""), r.setContext("InvTotalAmt", ""), f.setValue("ConvertedAmt", n.Env.ZERO), f.setValue("Amount", n.Env.ZERO), f.setValue("DiscountAmt", n.Env.ZERO), f.setValue("WriteOffAmt", n.Env.ZERO), f.setValue("OverUnderAmt", n.Env.ZERO), this.setCalloutActive(!1)), ""; this.setCalloutActive(!0); var a = t.getValueOfInt(o), p = 0, w = 0, b = 0, c = null; try { c = n.dataContext.getJSONRecord("MInvoice/GetInvPaySchedDetail", a.toString()); c != null && (w = t.getValueOfInt(c.C_InvoicePaySchedule_ID), f.setValue("C_InvoicePaySchedule_ID", w), p = t.getValueOfDecimal(c.dueAmount), b = 1) } catch (y) { return c != null && (c = null), this.log.log(i.SEVERE, "CalloutCashJournal.Invoice -" + a, y.message), y.toString() } if (a == null || a == 0) return f.setValue("C_Currency_ID", null), this.setCalloutActive(!1), ""; var k = new Date(r.getContext(u, "DateAcct")), nt = "TO_DATE( '" + (Number(k.getMonth()) + 1) + "-" + k.getDate() + "-" + k.getFullYear() + "', 'MM-DD-YYYY')", tt = a.toString() + "," + nt.toString() + "," + w.toString(), h = null; try { h = n.dataContext.getJSONRecord("MInvoice/GetInvoiceDetails", tt); h != null && (l = 0, f.setValue("C_BPartner_ID", t.getValueOfInt(h.C_BPartner_ID)), f.setValue("C_Currency_ID", t.getValueOfInt(h.C_Currency_ID)), f.setValue("C_ConversionType_ID", t.getValueOfInt(h.C_ConversionType_ID)), f.setValue("C_BPartner_Location_ID", t.getValueOfInt(h.C_BPartner_Location_ID)), l = b == 0 ? t.getValueOfDecimal(h.invoiceOpen) : p, v = t.getValueOfDecimal(h.paymentTermDiscount), g = "Y" == h.IsSOTrx, g || (l = b == 0 ? l * -1 : p * -1, v = v * -1), d = t.getValueOfString(h.docbaseType), "ARC" == d || "API" == d ? f.setValue("VSS_PAYMENTTYPE", "P") : f.setValue("VSS_PAYMENTTYPE", "R"), r.setContext("InvTotalAmt", l.toString()), f.setValue("Amount", l - v), f.setValue("DiscountAmt", v), f.setValue("WriteOffAmt", n.Env.ZERO)) } catch (y) { return idr != null && (idr.close(), idr = null), this.log.log(i.SEVERE, "invoice", y), this.setCalloutActive(!1), y.toString() } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; a.prototype.SetAmount = function (i, r, u, f, e) { var l, y, p, o, w, a, v, s, c, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; if (this.setCalloutActive(!0), e == null || e.toString() == "") return t.getValueOfInt(u.getValue("C_Invoice_ID")) > 0 ? (l = t.getValueOfDecimal(n.dataContext.getJSONRecord("MCashBook/GetPaySheduleAmt", u.getValue("C_Invoice_ID").toString())), i.setContext(r, "InvTotalAmt", l.toString()), u.setValue("Amount", l), this.setCalloutActive(!1), "") : ""; if (u.setValue("DiscountAmt", n.Env.ZERO), u.setValue("WriteOffAmt", n.Env.ZERO), u.setValue("OverUnderAmt", n.Env.ZERO), y = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), y.VA009_) { if (i.setContext("InvTotalAmt", ""), s = t.getValueOfInt(e), s == null || s == 0) return i.setContext(r, "InvTotalAmt", null), u.getTableName() == "C_Payment" ? (u.setValue("PayAmt", null), u.setValue("PaymentAmount", null)) : u.setValue("Amount", null), u.setValue("DiscountAmt", 0), u.setValue("WriteOffAmt", n.Env.ZERO), i.setContext("InvTotalAmt", 0), this.setCalloutActive(!1), ""; p = s.toString() + "," + u.getValue("C_Cash_ID") + "," + u.getValue("C_Invoice_ID"); o = n.dataContext.getJSONRecord("MCashBook/GetPaySheduleData", p); o != null && (u.getTableName() == "C_Payment" ? (w = o.IsReturnTrx, w == "Y" ? (u.setValue("PayAmt", t.getValueOfDecimal(o.DueAmt) * -1), u.setValue("PaymentAmount", t.getValueOfDecimal(o.DueAmt) * -1)) : (u.setValue("PayAmt", t.getValueOfDecimal(o.DueAmt)), u.setValue("PaymentAmount", t.getValueOfDecimal(o.DueAmt)))) : (u.setValue("Amount", t.getValueOfDecimal(o.DueAmt)), i.setContext(r, "InvTotalAmt", t.getValueOfDecimal(u.getValue("Amount"))), u.setValue("WriteOffAmt", 0), u.setValue("OverUnderAmt", 0), a = t.getValueOfDate(o.accountDate), v = t.getValueOfString(o.isSoTrx), t.getValueOfDate(o.DiscountDate) >= a ? (v == "N" ? u.setValue("DiscountAmt", -1 * t.getValueOfDecimal(o.DiscountAmt)) : u.setValue("DiscountAmt", t.getValueOfDecimal(o.DiscountAmt)), u.setValue("Amount", t.getValueOfDecimal(o.DueAmt) - t.getValueOfDecimal(o.DiscountAmt))) : t.getValueOfDate(o.DiscountDays2) >= a ? (v == "N" ? u.setValue("DiscountAmt", -1 * t.getValueOfDecimal(o.Discount2)) : u.setValue("DiscountAmt", t.getValueOfDecimal(o.Discount2)), u.setValue("Amount", t.getValueOfDecimal(o.DueAmt) - t.getValueOfDecimal(o.Discount2))) : u.setValue("DiscountAmt", 0))) } else { if (s = t.getValueOfInt(e), s == null || s == 0) return i.setContext(r, "InvTotalAmt", null), u.getTableName() == "C_Payment" ? (u.setValue("PayAmt", null), u.setValue("PaymentAmount", null)) : u.setValue("Amount", null), this.setCalloutActive(!1), ""; c = n.dataContext.getJSONRecord("MCashBook/GetInvSchedDueAmt", s.toString()); c != null && (h = c.DueAmt, u.getTableName() == "C_Payment" ? c.IsReturnTrx == "Y" ? (u.setValue("PayAmt", h * -1), u.setValue("PaymentAmount", h * -1)) : (u.setValue("PayAmt", h), u.setValue("PaymentAmount", h)) : (u.setValue("Amount", h), i.setContext(r, "InvTotalAmt", t.getValueOfDecimal(u.getValue("Amount"))))) } return this.setCalloutActive(!1), "" }; a.prototype.Amounts = function (i, r, u, f, e, o) { var v, c, p, s, b, nt; if (this.isCalloutActive()) return ""; if (v = 0, c = 0, "I" == u.getValue("CashType")) { if (v = i.getContext("InvTotalAmt"), (v == null || v.toString().length == 0) && (v = i.getContext(r, "InvTotalAmt")), v == null || v.toString().length == 0) return ""; c = t.getValueOfDecimal(v) } if (this.setCalloutActive(!0), p = 0, s = t.getValueOfDecimal(u.getValue("Amount")), "I" == u.getValue("CashType")) { var a = t.getValueOfDecimal(u.getValue("DiscountAmt")), l = t.getValueOfDecimal(u.getValue("WriteOffAmt")), h = t.getValueOfDecimal(u.getValue("OverUnderAmt")), w = f.getColumnName(), y = u.getValue("VSS_PaymentType"); y == "P" ? (s > 0 && (s = s * -1, u.setValue("PayAmt", s)), a > 0 && (a = a * -1), l > 0 && (l = l * -1, u.setValue("WriteOffAmt", l)), h > 0 && (h = h * -1, u.setValue("OverUnderAmt", h)), c > 0 && (c = c * -1)) : (s < 0 && (s = s * -1, u.setValue("PayAmt", s)), a < 0 && (a = a * -1), l < 0 && (l = l * -1, u.setValue("WriteOffAmt", l)), h < 0 && (h = h * -1, u.setValue("OverUnderAmt", h)), c < 0 && (c = c * -1)); this.log.fine(w + " - Invoice=" + c + " - Amount=" + s + ", Discount=" + a + ", WriteOff=" + l); w == "Amount" ? (b = c - s, h = b - a - l, (y == "R" && h > 0 || y == "P" && h < 0) && n.ADialog.info("LessScheduleAmount"), (y == "P" && h > 0 || y == "R" && h < 0) && (n.ADialog.info("MoreScheduleAmount"), s = c - a - l, h = c - s - a - l, u.setValue("PayAmt", s)), u.setValue("DiscountAmt", a), u.setValue("OverUnderAmt", h)) : (b = c - a, s = b - l - h, (y == "P" && s > 0 || y == "R" && s < 0) && (n.ADialog.info("MoreScheduleAmount"), w == "OverUnderAmt" && (s = c - a - l, h = c - s - a - l, u.setValue("OverUnderAmt", h)), w == "DiscountAmt" && (s = c - h - l, a = c - s - h - l, u.setValue("DiscountAmt", a)), w == "WriteOffAmt" && (s = c - a - h, l = c - s - a - h, u.setValue("WriteOffAmt", l))), u.setValue("Amount", s), (y == "R" && h > 0 || y == "P" && h < 0) && n.ADialog.info("LessScheduleAmount")) } var k = u.getValue("C_Cash_ID").toString(), d = n.dataContext.getJSONRecord("MCashBook/GetCashJournal", k), it = d.DateAcct, g = d.C_Currency_ID, tt = d.C_Currency_ID; return u.getValue("C_Currency_ID") != null && (g = u.getValue("C_Currency_ID").toString()), nt = 0, u.getField("C_ConversionType_ID") != null && (nt = t.getValueOfInt(u.getValue("C_ConversionType_ID"))), g != tt ? (k = s.toString() + "," + g + "," + tt + "," + it + "," + nt.toString() + "," + i.getAD_Client_ID().toString() + "," + i.getAD_Org_ID().toString(), p = n.dataContext.getJSONRecord("MConversionRate/CurrencyConvert", k), t.getValueOfDecimal(u.getValue("Amount")) != 0 && p == 0 && n.ADialog.info("NoCurrencyConversion")) : p = s, u.setValue("convertedAmt", p), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; a.prototype.BeginningBalCalc = function (r, u, f, e, o, s) { var c, y; if (o == null || o.toString() == "" || this.isCalloutActive()) return ""; if (this.setCalloutActive(!0), c = t.getValueOfInt(o), c == null || c == 0) return f.setValue("BeginningBalance", 0), this.setCalloutActive(!1), ""; var l = t.getValueOfInt(f.getValue("C_CashBook_ID")), a = t.getValueOfInt(f.getValue("AD_Client_ID")), v = t.getValueOfInt(f.getValue("AD_Org_ID")), b = r.getContext("DateAcct"), w = "SELECT EndingBalance FROM C_Cash WHERE C_CashBook_ID=" + l + " AND AD_Client_ID=" + a + " AND AD_Org_ID=" + v + " AND c_cash_id IN (SELECT Max(c_cash_id) FROM C_Cash WHERE C_CashBook_ID=" + l + "AND AD_Client_ID=" + a + " AND AD_Org_ID=" + v + ") AND Processed='Y'", h = null; try { h = n.DB.executeReader(w, null, null); h.read() ? (y = t.getValueOfDecimal(h.get(0)), f.setValue("BeginningBalance", y)) : f.setValue("BeginningBalance", 0); h.close() } catch (p) { return h != null && h.close(), this.log.log(i.SEVERE, "Beginning balance", p), this.setCalloutActive(!1), p.toString() } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; a.prototype.SetCurrency = function (i, r, u, f, e, o) { var s, c, l, w, h, b, k, p; if ((e == null || e.toString() == "") && f.getColumnName() != "C_ConversionType_ID" || this.isCalloutActive()) return ""; if (this.setCalloutActive(!0), s = "", c = t.getValueOfDecimal(u.getValue("Amount")), f.getColumnName() == "C_CashBook_ID") { if (l = t.getValueOfInt(e), l == null || l == 0) return u.setValue("C_Currency_ID", 0), this.setCalloutActive(!1), ""; s = l.toString(); w = n.dataContext.getJSONRecord("MCashBook/GetCashBook", s); u.setValue("C_Currency_ID", w.C_Currency_ID) } else if (f.getColumnName() == "C_BankAccount_ID") { if (h = t.getValueOfInt(e), h == null || h == 0) return u.setValue("C_Currency_ID", 0), this.setCalloutActive(!1), ""; s = h.toString(); b = "SELECT C_Currency_ID FROM C_BankAccount WHERE C_BankAccount_ID = " + h; k = t.getValueOfInt(n.DB.executeScalar(b, null, null)); u.setValue("C_Currency_ID", k) } if (c != 0) { s = u.getValue("C_Cash_ID").toString(); var a = 0, v = n.dataContext.getJSONRecord("MCashBook/GetCashJournal", s), g = v.DateAcct, y = v.C_Currency_ID, d = v.C_Currency_ID; u.getValue("C_Currency_ID") != null && (y = u.getValue("C_Currency_ID").toString()); p = 0; u.getField("C_ConversionType_ID") != null && (p = t.getValueOfInt(u.getValue("C_ConversionType_ID"))); y != d ? (s = c.toString() + "," + y + "," + d + "," + g + "," + p.toString() + "," + i.getAD_Client_ID().toString() + "," + i.getAD_Org_ID().toString(), a = n.dataContext.getJSONRecord("MConversionRate/CurrencyConvert", s), a == 0 && n.ADialog.info("NoCurrencyConversion")) : a = c; u.setValue("convertedAmt", a) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; a.prototype.ConvertedAmt = function (i, r, u, f, e, o) { var c, s; if (e == null || e.toString() == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); c = "SELECT CASHLINE.Amount FROM C_CashLine CASHLINE INNER JOIN C_Cashbook CB ON (CB.C_Cashbook_ID=CASHLINE.C_Cashbook_ID) WHERE CASHLINE.C_CashLine_ID =" + e; try { if (s = t.getValueOfInt(n.DB.executeScalar("SELECT C_Currency_ID FROM C_CashBook WHERE C_CashBook_ID=(SELECT C_CashBook_ID FROM C_Cash WHERE C_Cash_ID=" + u.getValue("C_Cash_ID") + ")")), s == 0) return this.setCalloutActive(!1), ""; var h = t.getValueOfDecimal(n.DB.executeScalar(c)), a = t.getValueOfInt(n.DB.executeScalar("SELECT C_Currency_ID FROM C_Cashbook WHERE C_Cashbook_ID= (SELECT C_CashBook_ID FROM C_Cash WHERE C_Cash_ID= (SELECT C_Cash_ID FROM C_CashLine WHERE C_CashLine_ID= " + e + "))")), v = h.toString() + "," + a.toString() + "," + s.toString() + "," + i.getAD_Client_ID().toString() + "," + i.getAD_Org_ID().toString(), l = n.dataContext.getJSONRecord("MConversionRate/Convert", v); h != 0 && l == 0 && n.ADialog.info("NoCurrencyConversion"); u.setValue("ConvertedAmt", l); u.setValue("Amount", h) } catch (y) { this.setCalloutActive(!1) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; a.prototype.GetBeginBal = function (i, r, u, f, e) { if (e == null || e == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); var o = t.getValueOfDecimal(n.DB.executeScalar(" select sum(nvl(CompletedBalance,0)) + sum(nvl(runningbalance,0)) as TotalBal from c_cashbook where c_cashbook_id=" + e)); return u.setValue("BeginningBalance", o), this.setCalloutActive(!1), "" }; n.Model.CalloutCashJournal = a; n.Utility.inheritPrototype(yt, n.CalloutEngine); yt.prototype.FillAttribute = function (i, r, u, f, e) { var o, s, l, h, a, c; return this.isCalloutActive() || e == null || e.toString() == "" ? "" : (o = i.getContext(r, "AttrCode"), this.setCalloutActive(!0), o != null && o != "" && (s = "SELECT M_AttributeSet_ID FROM M_Product WHERE M_Product_ID = " + t.getValueOfInt(e), l = t.getValueOfInt(n.DB.executeScalar(s)), l > 0 && (s = "SELECT M_AttributeSetInstance_ID FROM M_ProductAttributes WHERE UPC = '" + o + "' AND M_Product_ID = " + t.getValueOfInt(e), h = t.getValueOfInt(n.DB.executeScalar(s)), h > 0 ? u.setValue("M_AttributeSetInstance_ID", h) : o.indexOf("(01)") >= 0 && (a = o + "," + t.getValueOfInt(e) + "," + r, c = n.dataContext.getJSONRecord("MInOut/GetASIID", a), c != 0 && u.setValue("M_AttributeSetInstance_ID", c)))), this.setCalloutActive(!1), "") }; yt.prototype.FillUPC = function (i, r, u, f, e) { var s = "", h = 0, o; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; if (o = i.getContext(r, "AttrCode"), this.setCalloutActive(!0), t.getValueOfString(o) != "") { if (s = "SELECT Count(*) FROM M_Manufacturer WHERE IsActive = 'Y' AND UPC = '" + o + "'", h = t.getValueOfInt(n.DB.executeScalar(s, null, null)), h > 0) return this.setCalloutActive(!1), n.Msg.getMsg("Attribute Code Already Exist"); u.setValue("UPC", o) } return this.setCalloutActive(!1), "" }; n.Model.CalloutSetAttributeCode = yt; n.Utility.inheritPrototype(g, n.CalloutEngine); g.prototype.ProductCategory = function (i, r, u, f, e, o) { var s, c, h, l; return e == null || e.toString() == "" ? "" : (s = t.getValueOfInt(e), s == null || t.getValueOfInt(s) == 0 || s == 0) ? "" : (c = t.getValueOfInt(e), h = null, h = n.dataContext.getJSONRecord("MProductCategory/GetProductCategory", c), l = h.IsPurchasedToOrder, u.setValue("IsPurchasedToOrder", l), pc = null, i = r = u = f = e = o = null, "") }; g.prototype.UOM = function (i, r, u, f, e, o) { var s, h, c; return this.isCalloutActive() || e == null || e.toString() == "" ? "" : u.getValue("M_Product_id") == null ? "" : (this.setCalloutActive(!0), s = "select count(*) from m_transaction where m_product_id = " + t.getValueOfInt(u.getValue("M_Product_id")), h = t.getValueOfInt(n.DB.executeScalar(s, null, null)), h > 0 && (n.ADialog.info("Can't change UOM due to Transactions happens based on existing UOM"), s = "select c_uom_id from m_product where m_product_id =  " + t.getValueOfInt(u.getValue("M_Product_id")), c = t.getValueOfInt(n.DB.executeScalar(s, null, null)), u.setValue("C_UOM_ID", c)), this.setCalloutActive(!1), i = r = u = f = e = o = null, "") }; g.prototype.ResourceGroup = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = t.getValueOfString(f); return o == null || o.length == 0 ? "" : ("O" == o ? r.setValue("BasisType", null) : r.setValue("BasisType", "I"), n = i = r = u = f = e = null, "") }; g.prototype.Organization = function (i, r, u, f, e, o) { var h, s, c; return e == null || e.toString() == "" ? "" : (h = t.getValueOfInt(e), h == null) ? "" : (s = null, s = n.dataContext.getJSONRecord("MLocator/GetLocator", paramString), c = s.Default_Locator_ID, u.setValue("M_Locator_ID", c), i = r = u = f = e = o = null, "") }; n.Model.CalloutProduct = g; n.Utility.inheritPrototype(pt, n.CalloutEngine); pt.prototype.Planned = function (i, r, u, f, e, o) { var w, k, it, d, a, p; if (e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; this.setCalloutActive(!0); var v, s, c, h, b = 0, y = i.getStdPrecision(), l = y, g = i.getContextAsInt(r, "M_PriceList_Version_ID"); g != 0 && (w = n.dataContext.getJSONRecord("MProject/GetPriceListPrecision", g.toString()), w != null && (y = t.getValueOfInt(w.StdPrecision), l = t.getValueOfInt(w.PriceListPrecision)), w = null); var nt = t.getValueOfInt(u.getValue("C_ProjectTask_ID")), rt = "SELECT C_Project_ID FROM C_ProjectPhase WHERE C_ProjectPhase_id IN (select C_ProjectPhase_id from C_ProjectTask WHERE C_ProjectTask_ID=" + nt + ")", tt = t.getValueOfInt(n.DB.executeScalar(rt, null, null)); return nt == 0 && (tt = t.getValueOfInt(u.getValue("C_Project_ID"))), k = "SELECT PriceLimit FROM M_ProductPrice WHERE M_PriceList_Version_ID = (SELECT c.m_pricelist_version_id FROM  c_project c WHERE c.c_project_Id=" + tt + ")  AND M_Product_id=" + t.getValueOfInt(u.getValue("M_Product_ID")), u.findColumn("M_AttributeSetInstance_ID") > 0 && (k += " AND NVL(M_AttributeSetInstance_ID,0)=" + t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID"))), u.findColumn("C_UOM_ID") > 0 && (k += t.getValueOfInt(u.getValue("C_UOM_ID")) > 0 ? " AND C_UOM_ID =" + t.getValueOfInt(u.getValue("C_UOM_ID")) : " AND C_UOM_ID = (SELECT C_UOM_ID FROM M_Product WHERE M_Product_ID=" + t.getValueOfInt(u.getValue("M_Product_ID")) + ")"), it = t.getValueOfDecimal(n.DB.executeScalar(k, null, null)), v = t.getValueOfDecimal(u.getValue("PlannedQty")), v == null && (v = Envs.ONE), s = t.getValueOfDecimal(u.getValue("PlannedPrice")), s = s == null ? n.Env.ZERO : s.toFixed(l), c = t.getValueOfDecimal(u.getValue("PriceList")), c = c == null ? s : c.toFixed(l), h = t.getValueOfDecimal(u.getValue("Discount")), h = h == null ? n.Env.ZERO : h.toFixed(l), d = f.getColumnName(), d == "PlannedPrice" ? (c == 0 ? h = n.Env.ZERO : (a = (s * n.Env.ONEHUNDRED / c).toFixed(10), h = n.Env.ONEHUNDRED - a), u.setValue("Discount", h.toFixed(l)), u.setValue("PlannedPrice", s), this.log.fine("PriceList=" + c + " - Discount=" + h + " -> [PlannedPrice=" + s + "] (Precision=" + l + ")")) : d == "PriceList" ? (n.Env.signum(c) == 0 ? h = n.Env.ZERO : (a = s * n.Env.ONEHUNDRED / c, h = n.Env.ONEHUNDRED - a), u.setValue("Discount", h.toFixed(l)), u.setValue("PriceList", c), this.log.fine("[PriceList=" + c + "] - Discount=" + h + " -> PlannedPrice=" + s + " (Precision=" + l + ")")) : d == "Discount" && (a = (h / n.Env.ONEHUNDRED).toFixed(10), a = n.Env.ONE - a, s = c * a, t.scale(s) > l && (s = s.toFixed(l)), u.setValue("PlannedPrice", s), u.setValue("Discount", h), this.log.fine("PriceList=" + c + " - [Discount=" + h + "] -> PlannedPrice=" + s + " (Precision=" + l + ")")), p = v * s, t.scale(p) > y && (p = p.toFixed(y)), v != null && (b = (t.getValueOfDecimal(u.getValue("PlannedPrice")) - it) * t.getValueOfDecimal(u.getValue("PlannedQty")), b = b.toFixed(y)), this.log.fine("PlannedQty=" + v + " * PlannedPrice=" + s + " -> PlannedAmt=" + p + " (Precision=" + y + ")"), u.setValue("PlannedAmt", p), u.setValue("PlannedMarginAmt", b), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; pt.prototype.Product = function (i, r, u, f, e, o) { var c, l, a, h, p; if (e == null || e.toString() == "" || (c = t.getValueOfInt(e), l = i.getContextAsInt(r, "M_PriceList_Version_ID"), c == null || t.getValueOfInt(c) == 0 || l == 0)) return ""; this.setCalloutActive(!0); var v = i.getContextAsInt(r, "C_BPartner_ID"), y = t.getValueOfDecimal(u.getValue("PlannedQty")), s = t.getValueOfDateTime(u.getValue("PlannedDate")); return s == null ? (s = t.getValueOfDateTime(u.getValue("DateContract")), s == null && (s = t.getValueOfDateTime(u.getValue("DateFinish")), s == null && (s = new Date)), a = c.toString().concat(",", v.toString(), ",", y.toString(), ",", isSOTrx, ",", M_PriceList_ID.toString(), ",", l.toString(), ",", s.toString(), ",", null), h = null, h = n.dataContext.getJSONRecord("MProductPricing/GetProductPricing", a), p = null, u.setValue("PriceList", h.PriceList), u.setValue("PlannedPrice", h.PriceActual), u.setValue("Discount", h.Discount), u.setValue("PlannedAmt", h.LineAmt), "") : (i = r = u = f = e = o = null, "") }; n.Model.CalloutProject = pt; n.Utility.inheritPrototype(nt, n.CalloutEngine); nt.prototype.BankAccount = function (t, r, u, f, e, o) { if (e == null || e.toString() == "") return ""; try { var l = e, h = e.toString(), s; s = n.dataContext.getJSONRecord("MBankStatement/GetCurrentBalance", h); u.setValue("BeginningBalance", s) } catch (c) { this.setCalloutActive(!1); this.log.log(i.SEVERE, "", c) } return t = r = u = f = e = o = null, "" }; nt.prototype.Amount = function (n, t, i, r, u, f) { var s, h, o, e, c; return u == null || u.toString() == "" ? "" : this.isCalloutActive() ? "" : (this.setCalloutActive(!0), s = i.getValue("StmtAmt"), s == null && (s = 0), h = i.getValue("TrxAmt"), h == null && (h = 0), e = i.getValue("ChargeAmt"), e == null && (e = 0), o = s - h, r.getColumnName() == "ChargeAmt" ? (e = u, e == null && (e = 0), o = o - e, i.setValue("InterestAmt", o)) : (c = i.getValue("InterestAmt"), c == null && (c = 0), o = o - c, i.setValue("ChargeAmt", o)), this.setCalloutActive(!1), n = t = i = r = u = f = null, "") }; nt.prototype.Payment = function (t, r, u, f, e, o) { var h, c, a, s; if (this.isCalloutActive() || e == null || e.toString() == "" || (this.setCalloutActive(!0), h = u.getValue("C_Payment_ID"), h == null || h == 0)) return u.setValue("StmtAmt", 0), u.setValue("TrxAmt", 0), u.setValue("ChargeAmt", 0), u.setValue("C_BPartner_ID", 0), u.setValue("C_Invoice_ID", 0), u.findColumn("C_ConversionType_ID") >= 0 && u.setValue("C_ConversionType_ID", 0), this.setCalloutActive(!1), ""; c = u.getValue("StmtAmt"); c == null && (c = 0); var y = u.getValue("C_Currency_ID"), l = u.getValue("DateAcct"), p = u.getValue("AD_Org_ID"); if (l == null) return u.setValue("C_Payment_ID", 0), this.setCalloutActive(!1), "PlzSelectStmtDate"; try { if (a = h.toString() + "," + y.toString() + "," + l + "," + p.toString(), s = n.dataContext.getJSONRecord("MBankStatement/GetPayment", a), s != null && s.length > 0) { if (s[0].ConvertedAmt != "") return u.setValue("C_Payment_ID", 0), this.setCalloutActive(!1), s[0].ConvertedAmt; u.setValue("TrxAmt", s[0].payAmt); u.setValue("StmtAmt", s[0].payAmt); u.findColumn("C_ConversionType_ID") >= 0 && u.setValue("C_ConversionType_ID", s[0].C_ConversionType_ID); u.findColumn("VA009_PaymentMethod_ID") >= 0 && u.getValue("VA009_PaymentMethod_ID") > 0 ? u.setValue("VA009_PaymentMethod_ID", s[0].VA009_PaymentMethod_ID) : u.findColumn("VA009_PaymentMethod_ID") >= 0 && u.setValue("VA009_PaymentMethod_ID", null); u.getValue("EFTCheckNo") == null && s[0].EFTCheckNo != null && u.setValue("EFTCheckNo", s[0].EFTCheckNo); s[0].EFTValutaDate != null && u.setValue("EFTValutaDate", s[0].EFTValutaDate); u.findColumn("TenderType") >= 0 && s[0].TenderType != null && u.setValue("TenderType", s[0].TenderType) } } catch (v) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, "BankStmt_Payment", v), v.toString() } return this.setCalloutActive(!1), this.Amount(t, r, u, f, e), t = r = u = f = e = o = null, "" }; nt.prototype.SetConvertedAmt = function (r, u, f, e, o, s) { var h, a, c, v, l; if (this.isCalloutActive() || o == null || o.toString() == "" || (h = t.getValueOfInt(f.getValue("C_Payment_ID")), h == 0)) return ""; if (a = f.getValue("C_Currency_ID"), c = f.getValue("DateAcct"), c == null) return "PlzSelectStmtDate"; try { v = h.toString() + "," + a.toString() + "," + c.toString(); l = n.dataContext.getJSONRecord("MBankStatement/GetConvertedAmt", v); f.setValue("StmtAmt", l); f.setValue("TrxAmt", l) } catch (y) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, "BankStmt_DateAcct", y), y.toString() } return this.Amount(r, u, f, e, o), r = u = f = e = o = s = null, "" }; n.Model.CalloutBankStatement = nt; n.Utility.inheritPrototype(v, n.CalloutEngine); v.prototype.CalculatePrice = function (n, t, i) { return Decimal.Subtract(Decimal.Multiply(n, t), i) }; v.prototype.CalculateRebate = function (n, t, i) { return Decimal.Multiply(Decimal.Multiply(n, t), Decimal.Multiply(new Decimal(.01), i)) }; v.prototype.OfferServices = function (i, r, u, f, e, o) { var it, ht, kt, st; if (e == null || e.toString() == "" || (it = 24, ht = t.getValueOfInt(e), ht == null || ht == 0)) return ""; var ct = 0, lt = new Decimal(0), at = new Decimal(0), vt = new Decimal(0), s, l, a, v, h, k, d, pt, wt, ut = null; try { for (st = [], st[0] = new n.DB.SqlParam("@FO_SERVICE_ID", ht), ut = n.DB.executeReader("select uom.FO_HOTEL_UOM_ID,s.DESCRIPTION from FO_HOTEL_UOM uom inner join FO_SERVICE s ON(uom.FO_HOTEL_UOM_ID= s.FO_HOTEL_UOM_ID) where s.FO_SERVICE_ID=@FO_SERVICE_ID ", st, null); ut.read();)ct = t.getValueOfInt(ut[0]), u.setValue("AUOM_ID", ct), u.setValue("CG1UOM_ID", ct), u.setValue("CG2UOM_ID", ct), u.setValue("DESCRIPTION", t.getValueOfString(ut[1])); ut.close() } catch (bt) { this.setCalloutActive(!1); ut != null && ut.close(); this.log.severe(bt.toString()) } kt = "select PRICE,CHILDGROUP1,CHILDGROUP2,UOM1,UOM2 from FO_SERVICE_PRICE_PRICELINE where CREATED=(select max(CREATED) from FO_SERVICE_PRICE_PRICELINE where FO_SERVICE_ID=@FO_SERVICE_ID)"; try { for (st = [], st[0] = new n.DB.SqlParam("@FO_SERVICE_ID", ht), ut = n.DB.executeReader(kt, st, null); ut.read();)lt = t.getValueOfDecimal(ut[0]), at = t.getValueOfDecimal(ut[1]), vt = t.getValueOfDecimal(ut[2]), pt = ut[3].toString(), wt = ut[4].toString(), pt.equals("Y") && (at = Decimal.Multiply(Decimal.Multiply(lt, at), new Decimal(.01))), wt.equals("Y") && (vt = Decimal.Multiply(Decimal.Multiply(lt, vt), new Decimal(.01))), u.setValue("APRICE", lt), u.setValue("CG1PRICE", at), u.setValue("CG2PRICE", vt); ut.close() } catch (bt) { this.setCalloutActive(!1); this.log.severe(bt.toString()) } var dt = u.getValue("AUOM_ID").toString(), g = t.getValueOfInt(u.getValue("ANUM")), p = t.getValueOfDecimal(u.getValue("AP0RICE")), b = t.getValueOfDecimal(u.getValue("AREBATE")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1P0RICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), gt = t.getValueOfDateTime(u.getValue("ADATETO")), ni = t.getValueOfDateTime(u.getValue("ADATEFROM")), c = Utility.timeUtil.getDaysBetween(ni, gt), yt = ni.Subtract(gt), ft, rt, ti = c / 30, ri = c % 30, ii = c / 7, ui = c % 7; ft = ri == 0 ? ti : ti + 1; rt = ui == 0 ? ii : ii + 1; var fi = yt.TotalMilliseconds, et = yt.TotalSeconds, ot = yt.TotalMinutes; if (t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(dt)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(rt), p, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(it * c), p, h); l = CalculatePrice(new Decimal(it * c), y, h); a = CalculatePrice(new Decimal(it * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(ot), p, h); l = CalculatePrice(new Decimal(ot), y, h); a = CalculatePrice(new Decimal(ot), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(et), p, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) } } else switch (int.Parse(dt)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(rt), p, b); s = CalculatePrice(new Decimal(rt), p, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), w, b); a = CalculatePrice(new Decimal(rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(it * c), p, b); s = CalculatePrice(new Decimal(it * c), p, h); k = CalculateRebate(new Decimal(it * c), y, b); l = CalculatePrice(new Decimal(it * c), y, k); d = CalculateRebate(new Decimal(it * c), w, b); a = CalculatePrice(new Decimal(it * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(ot), p, b); s = CalculatePrice(new Decimal(ot), p, h); k = CalculateRebate(new Decimal(ot), y, b); l = CalculatePrice(new Decimal(ot), y, k); d = CalculateRebate(new Decimal(ot), w, b); a = CalculatePrice(new Decimal(ot), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(et), p, b); s = CalculatePrice(new Decimal(et), p, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), w, b); a = CalculatePrice(new Decimal(et), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; v.prototype.tochkdate = function (i, r, u, f, e, o) { var it, s, l, a, h, k, d, v, ct, vt, yt, at, st; if (e == null || e.toString() == "" || (it = 24, ct = t.getValueOfDateTime(e), ct == null || ct.equals(0))) return ""; var ot = t.getValueOfDateTime(e), ht = t.getValueOfDateTime(u.getValue("ADATEFROM")), g = t.getValueOfInt(u.getValue("CG1NUM")), nt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), p = t.getValueOfDecimal(u.getValue("CG2PRICE")); try { if (ot = t.getValueOfDateTime(u.getValue("ADATETO")), vt = Utility.timeUtil.getDaysBetween(ht, ot), vt <= 0) yt = Utility.TimeUtil.AddDays(ht, 1), u.setValue("ADATETO", yt); else if (ot.compareTo(ht) > 0) { var lt = ot.Subtract(ht), c = Utility.timeUtil.getDaysBetween(ht, ot), gt = lt.TotalMilliseconds, ft = lt.TotalMinutes, et = lt.TotalMinutes, ut, rt, pt = c / 30, bt = c % 30, wt = c / 7, kt = c % 7; ut = bt == 0 ? pt : pt + 1; rt = kt == 0 ? wt : wt + 1; at = t.getValueOfDateTime(u.getValue("ADATEFROM")); u.setValue("CG1DATETO", ot); u.setValue("CG2DATETO", ot); u.setValue("CG1DATEFROM", at); u.setValue("CG2DATEFROM", at); st = u.getValue("AUOM_ID").toString(); (st == "" || st.toString().trim().length == 0) && (st = "0"); var w = t.getValueOfDecimal(u.getValue("APRICE")), tt = t.getValueOfInt(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")); if (t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(st)) { case 1000003: s = w; l = y; a = p; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), w, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ut), w, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(rt), w, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), w, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(it * c), w, h); l = CalculatePrice(new Decimal(it * c), y, h); a = CalculatePrice(new Decimal(it * c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), w, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), w, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(tt * rt), w, h); l = CalculatePrice(new Decimal(g * rt), y, h); a = CalculatePrice(new Decimal(nt * rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(tt * rt), w, h); l = CalculatePrice(new Decimal(g * rt), y, h); a = CalculatePrice(new Decimal(nt * rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); l = CalculatePrice(new Decimal(g * (c + 1)), y, h); a = CalculatePrice(new Decimal(nt * (c + 1)), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * tt), w, h); l = CalculatePrice(new Decimal((c + 1) * g), y, h); a = CalculatePrice(new Decimal((c + 1) * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(it * c * tt), w, h); l = CalculatePrice(new Decimal(it * c * g), y, h); a = CalculatePrice(new Decimal(it * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(it * c * tt), w, h); l = CalculatePrice(new Decimal(it * c * g), y, h); a = CalculatePrice(new Decimal(it * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) } } else switch (int.Parse(st)) { case 1000003: s = w; l = y; a = p; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), w, b); s = CalculatePrice(new Decimal(c), w, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), p, b); a = CalculatePrice(new Decimal(c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ut), w, b); s = CalculatePrice(new Decimal(ut), w, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), p, b); a = CalculatePrice(new Decimal(ut), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(rt), w, b); s = CalculatePrice(new Decimal(rt), w, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), p, b); a = CalculatePrice(new Decimal(rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), w, b); s = CalculatePrice(new Decimal(c + 1), w, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), p, b); a = CalculatePrice(new Decimal(c + 1), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(it * c), w, b); s = CalculatePrice(new Decimal(it * c), w, h); k = CalculateRebate(new Decimal(it * c), y, b); l = CalculatePrice(new Decimal(it * c), y, k); d = CalculateRebate(new Decimal(it * c), p, b); a = CalculatePrice(new Decimal(it * c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), w, b); s = CalculatePrice(new Decimal(et), w, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), p, b); a = CalculatePrice(new Decimal(et), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), w, b); s = CalculatePrice(new Decimal(ft), w, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), p, b); a = CalculatePrice(new Decimal(ft), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(tt * rt), w, b); s = CalculatePrice(new Decimal(tt * rt), w, h); k = CalculateRebate(new Decimal(g * rt), y, b); l = CalculatePrice(new Decimal(g * rt), y, k); d = CalculateRebate(new Decimal(nt * rt), p, b); a = CalculatePrice(new Decimal(nt * rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(tt * rt), w, b); s = CalculatePrice(new Decimal(tt * rt), w, h); k = CalculateRebate(new Decimal(g * rt), y, b); l = CalculatePrice(new Decimal(g * rt), y, k); d = CalculateRebate(new Decimal(nt * rt), p, b); a = CalculatePrice(new Decimal(nt * rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal((c + 1) * tt), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(it * c * tt), w, b); s = CalculatePrice(new Decimal(it * c * tt), w, h); k = CalculateRebate(new Decimal(it * c * g), y, b); l = CalculatePrice(new Decimal(it * c * g), y, k); d = CalculateRebate(new Decimal(it * c * nt), p, b); a = CalculatePrice(new Decimal(it * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(it * c * tt), w, b); s = CalculatePrice(new Decimal(it * c * tt), w, h); k = CalculateRebate(new Decimal(it * c * g), y, b); l = CalculatePrice(new Decimal(it * c * g), y, k); d = CalculateRebate(new Decimal(it * c * nt), p, b); a = CalculatePrice(new Decimal(it * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) }tt == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)); g == 0 && u.setValue("CG1TOTAL_AMOUNT", 0); nt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0) } } catch (dt) { this.setCalloutActive(!1); this.log.severe(dt.toString()) } return i = r = u = f = e = o = null, "" }; v.prototype.fromchkdate = function (i, r, u, f, e, o) { var it, s, l, a, h, k, d, v, ct, vt, at, ht; if (e == null || e.toString() == "" || (it = 24, ct = t.getValueOfDateTime(e), ct == null || ct.equals(0))) return ""; var ot = t.getValueOfDateTime(u.getValue("ADATEFROM")), st = t.getValueOfDateTime(u.getValue("ADATETO")), g = t.getValueOfInt(u.getValue("CG1NUM")), nt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), p = t.getValueOfDecimal(u.getValue("CG2PRICE")); try { if (ot = t.getValueOfDateTime(u.getValue("ADATEFROM")), ot.compareTo(st) > 0) u.setValue("CG1DATEFROM", ot), u.setValue("CG2DATEFROM", ot), vt = Utility.timeUtil.addDays(ot, 1), u.setValue("ADATETO", vt); else if (st.compareTo(ot) > 0) { var lt = st.Subtract(ot), c = Utility.timeUtil.getDaysBetween(ot, st), dt = lt.TotalMilliseconds, ft = lt.TotalSeconds, et = lt.TotalMinutes, ut, rt, yt = c / 30, wt = c % 30, pt = c / 7, bt = c % 7; ut = wt == 0 ? yt : yt + 1; rt = bt == 0 ? pt : pt + 1; at = t.getValueOfDateTime(u.getValue("ADATEFROM")); u.setValue("CG1DATETO", st); u.setValue("CG2DATETO", st); u.setValue("CG1DATEFROM", at); u.setValue("CG2DATEFROM", at); ht = u.getValue("AUOM_ID").toString(); (ht == "" || ht.toString().trim().length == 0) && (ht = "0"); var w = t.getValueOfDecimal(u.getValue("APRICE")), tt = t.getValueOfInt(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")); if (t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(ht)) { case 1000003: s = w; l = y; a = p; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), w, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ut), w, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(rt), w, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), w, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(it * c), w, h); l = CalculatePrice(new Decimal(it * c), y, h); a = CalculatePrice(new Decimal(it * c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), w, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), w, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(tt * rt), w, h); l = CalculatePrice(new Decimal(g * rt), y, h); a = CalculatePrice(new Decimal(nt * rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(tt * rt), w, h); l = CalculatePrice(new Decimal(g * rt), y, h); a = CalculatePrice(new Decimal(nt * rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); l = CalculatePrice(new Decimal(g * (c + 1)), y, h); a = CalculatePrice(new Decimal(nt * (c + 1)), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * tt), w, h); l = CalculatePrice(new Decimal((c + 1) * g), y, h); a = CalculatePrice(new Decimal((c + 1) * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(it * c * tt), w, h); l = CalculatePrice(new Decimal(it * c * g), y, h); a = CalculatePrice(new Decimal(it * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(it * c * tt), w, h); l = CalculatePrice(new Decimal(it * c * g), y, h); a = CalculatePrice(new Decimal(it * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) } } else switch (int.Parse(ht)) { case 1000003: s = w; l = y; a = p; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), w, b); s = CalculatePrice(new Decimal(c), w, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), p, b); a = CalculatePrice(new Decimal(c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ut), w, b); s = CalculatePrice(new Decimal(ut), w, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), p, b); a = CalculatePrice(new Decimal(ut), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(rt), w, b); s = CalculatePrice(new Decimal(rt), w, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), p, b); a = CalculatePrice(new Decimal(rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), w, b); s = CalculatePrice(new Decimal(c + 1), w, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), p, b); a = CalculatePrice(new Decimal(c + 1), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(it * c), w, b); s = CalculatePrice(new Decimal(it * c), w, h); k = CalculateRebate(new Decimal(it * c), y, b); l = CalculatePrice(new Decimal(it * c), y, k); d = CalculateRebate(new Decimal(it * c), p, b); a = CalculatePrice(new Decimal(it * c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), w, b); s = CalculatePrice(new Decimal(et), w, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), p, b); a = CalculatePrice(new Decimal(et), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), w, b); s = CalculatePrice(new Decimal(ft), w, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), p, b); a = CalculatePrice(new Decimal(ft), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(tt * rt), w, b); s = CalculatePrice(new Decimal(tt * rt), w, h); k = CalculateRebate(new Decimal(g * rt), y, b); l = CalculatePrice(new Decimal(g * rt), y, k); d = CalculateRebate(new Decimal(nt * rt), p, b); a = CalculatePrice(new Decimal(nt * rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(tt * rt), w, b); s = CalculatePrice(new Decimal(tt * rt), w, h); k = CalculateRebate(new Decimal(g * rt), y, b); l = CalculatePrice(new Decimal(g * rt), y, k); d = CalculateRebate(new Decimal(nt * rt), p, b); a = CalculatePrice(new Decimal(nt * rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal((c + 1) * tt), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(it * c * tt), w, b); s = CalculatePrice(new Decimal(it * c * tt), w, h); k = CalculateRebate(new Decimal(it * c * g), y, b); l = CalculatePrice(new Decimal(it * c * g), y, k); d = CalculateRebate(new Decimal(it * c * nt), p, b); a = CalculatePrice(new Decimal(it * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(it * c * tt), w, b); s = CalculatePrice(new Decimal(it * c * tt), w, h); k = CalculateRebate(new Decimal(it * c * g), y, b); l = CalculatePrice(new Decimal(it * c * g), y, k); d = CalculateRebate(new Decimal(it * c * nt), p, b); a = CalculatePrice(new Decimal(it * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) }tt == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)); g == 0 && u.setValue("CG1TOTAL_AMOUNT", 0); nt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0) } } catch (kt) { this.setCalloutActive(!1); this.log.severe(kt.toString()) } return i = r = u = f = e = o = null, "" }; v.prototype.UOMSelected = function (i, r, u, f, e, o) { var it, s, l, a, h, k, d, v, ot; if (e == null || e.toString() == "" || (it = 24, ot = t.getValueOfInt(e), ot = t.getValueOfInt(u.getValue("AUOM_ID")), ot == null)) return ""; u.setValue("CG1UOM_ID", ot); u.setValue("CG2UOM_ID", ot); var ht = u.getValue("AUOM_ID").toString(), p = t.getValueOfDecimal(u.getValue("APRICE")), g = t.getValueOfInt(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), ct = t.getValueOfDateTime(u.getValue("ADATETO")), lt = t.getValueOfDateTime(u.getValue("ADATEFROM")), st = ct.Subtract(lt), c = Utility.timeUtil.getDaysBetween(lt, ct), wt = st.TotalMilliseconds, ft = st.TotalSeconds, et = st.TotalMinutes, ut, rt, at = c / 30, yt = c % 30, vt = c / 7, pt = c % 7; if (ut = yt == 0 ? at : at + 1, rt = pt == 0 ? vt : vt + 1, t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(ht)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ut), p, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(rt), p, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(it * c), p, h); l = CalculatePrice(new Decimal(it * c), y, h); a = CalculatePrice(new Decimal(it * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), p, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) } } else switch (int.Parse(ht)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ut), p, b); s = CalculatePrice(new Decimal(ut), p, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), w, b); a = CalculatePrice(new Decimal(ut), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(rt), p, b); s = CalculatePrice(new Decimal(rt), p, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), w, b); a = CalculatePrice(new Decimal(rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(it * c), p, b); s = CalculatePrice(new Decimal(it * c), p, h); k = CalculateRebate(new Decimal(it * c), y, b); l = CalculatePrice(new Decimal(it * c), y, k); d = CalculateRebate(new Decimal(it * c), w, b); a = CalculatePrice(new Decimal(it * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), p, b); s = CalculatePrice(new Decimal(et), p, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), w, b); a = CalculatePrice(new Decimal(et), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; v.prototype.AVALSelected = function (i, r, u, f, e, o) { var it, s, l, a, h, k, d, v, ot; if (e == null || e.toString() == "") return ""; it = 24; ot = null; try { ot = u.getValue("AUOM_ID").toString() } catch (pt) { return this.setCalloutActive(!1), "" } var p = t.getValueOfDecimal(u.getValue("APRICE")), b = t.getValueOfDecimal(u.getValue("AREBATE")), g = t.getValueOfInt(u.getValue("ANUM")), ht = t.getValueOfDateTime(u.getValue("ADATETO")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), ct = t.getValueOfDateTime(u.getValue("ADATEFROM")), st = ht.Subtract(ct), c = Utility.timeUtil.getDaysBetween(ct, ht), wt = st.TotalMilliseconds, ft = st.TotalSeconds, et = st.TotalMinutes, ut, rt, lt = c / 30, vt = c % 30, at = c / 7, yt = c % 7; if (ut = vt == 0 ? lt : lt + 1, rt = yt == 0 ? at : at + 1, t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(ot)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ut), p, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(rt), p, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(it * c), p, h); l = CalculatePrice(new Decimal(it * c), y, h); a = CalculatePrice(new Decimal(it * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), p, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * rt), p, h); l = CalculatePrice(new Decimal(nt * rt), y, h); a = CalculatePrice(new Decimal(tt * rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(it * c * g), p, h); l = CalculatePrice(new Decimal(it * c * nt), y, h); a = CalculatePrice(new Decimal(it * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) } } else switch (int.Parse(ot)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ut), p, b); s = CalculatePrice(new Decimal(ut), p, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), w, b); a = CalculatePrice(new Decimal(ut), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(rt), p, b); s = CalculatePrice(new Decimal(rt), p, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), w, b); a = CalculatePrice(new Decimal(rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(it * c), p, b); s = CalculatePrice(new Decimal(it * c), p, h); k = CalculateRebate(new Decimal(it * c), y, b); l = CalculatePrice(new Decimal(it * c), y, k); d = CalculateRebate(new Decimal(it * c), w, b); a = CalculatePrice(new Decimal(it * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), p, b); s = CalculatePrice(new Decimal(et), p, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), w, b); a = CalculatePrice(new Decimal(et), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * rt), p, b); s = CalculatePrice(new Decimal(g * rt), p, h); k = CalculateRebate(new Decimal(nt * rt), y, b); l = CalculatePrice(new Decimal(nt * rt), y, k); d = CalculateRebate(new Decimal(tt * rt), w, b); a = CalculatePrice(new Decimal(tt * rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(it * c * g), p, b); s = CalculatePrice(new Decimal(it * c * g), p, h); k = CalculateRebate(new Decimal(it * c * nt), y, b); l = CalculatePrice(new Decimal(it * c * nt), y, k); d = CalculateRebate(new Decimal(it * c * tt), w, b); a = CalculatePrice(new Decimal(it * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v) }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; n.Model.CalloutOfferSerIncluded = v; n.Utility.inheritPrototype(y, n.CalloutEngine); y.prototype.CalculatePrice = function (n, t, i) { return Decimal.Subtract(Decimal.Multiply(n, t), i) }; y.prototype.CalculateRebate = function (n, t, i) { return Decimal.Multiply(Decimal.Multiply(n, t), Decimal.Multiply(new Decimal(.01), i)) }; y.prototype.OfferServices = function (i, r, u, f, e, o) { var st, wt, ot, ft, et; if (e == null || e.toString() == "" || (st = t.getValueOfInt(e), st == null || st == 0)) return ""; var ht = 0, ct = new Decimal(0), lt = new Decimal(0), at = new Decimal(0), s, l, a, v, h, k, d, vt, yt, rt = null; try { for (ot = [], ot[0] = new n.DB.SqlParam("@FO_SERVICE_ID", st), rt = n.DB.executeReader("select uom.FO_HOTEL_UOM_ID,s.DESCRIPTION from FO_HOTEL_UOM uom inner join FO_SERVICE s ON(uom.FO_HOTEL_UOM_ID= s.FO_HOTEL_UOM_ID) where s.FO_SERVICE_ID=@FO_SERVICE_ID ", ot, null); rt.read();)ht = t.getValueOfInt(rt[0]), u.setValue("AUOM_ID", ht), u.setValue("CG1UOM_ID", ht), u.setValue("CG2UOM_ID", ht), u.setValue("DESCRIPTION", t.getValueOfString(rt[1])); rt.close() } catch (pt) { this.setCalloutActive(!1); rt != null && rt.close(); this.log.severe(pt.toString()) } finally { rt != null && rt.close() } wt = "select PRICE,CHILDGROUP1,CHILDGROUP2,UOM1,UOM2 from FO_SERVICE_PRICE_PRICELINE where CREATED=(select max(CREATED) from FO_SERVICE_PRICE_PRICELINE where FO_SERVICE_ID=@FO_SERVICE_ID)"; try { for (ot = [], ot[0] = new SqlParameter("@FO_SERVICE_ID", st), rt = n.DB.executeReader(wt, ot, null); rt.read();)ct = t.getValueOfDecimal(rt[0]), lt = t.getValueOfDecimal(rt[1]), at = t.getValueOfDecimal(rt[2]), vt = rt[3].toString(), yt = rt[4].toString(), vt == "Y" && (lt = Decimal.Multiply(Decimal.Multiply(ct, lt), new Decimal(.01))), yt == "Y" && (at = Decimal.Multiply(Decimal.Multiply(ct, at), new Decimal(.01))), u.setValue("APRICE", ct), u.setValue("CG1PRICE", lt), u.setValue("CG2PRICE", at) } catch (pt) { this.setCalloutActive(!1); this.log.severe(pt.toString()) } finally { rt != null && rt.close() } var bt = u.getValue("AUOM_ID").toString(), g = t.getValueOfInt(u.getValue("ANUM")), p = t.getValueOfDecimal(u.getValue("APRICE")), b = t.getValueOfDecimal(u.getValue("AREBATE")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), kt = t.getValueOfDateTime(u.getValue("ADATETO")), dt = t.getValueOfDateTime(u.getValue("ADATEFROM")), c = Utility.timeUtil.getDaysBetween(dt, kt), gt = dt.Subtract(kt), ut, it, ni = c / 30, ii = c % 30, ti = c / 7, ri = c % 7; if (ut = ii == 0 ? ni : ni + 1, it = ri == 0 ? ti : ti + 1, ft = gt.Seconds, et = gt.Minutes, t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(bt)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(ut), p, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(it), p, h); l = CalculatePrice(new Decimal(it), y, h); a = CalculatePrice(new Decimal(it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(24 * c), p, h); l = CalculatePrice(new Decimal(24 * c), y, h); a = CalculatePrice(new Decimal(24 * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), p, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") } } else switch (int.Parse(bt)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(ut), p, b); s = CalculatePrice(new Decimal(ut), p, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), w, b); a = CalculatePrice(new Decimal(ut), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(it), p, b); s = CalculatePrice(new Decimal(it), p, h); k = CalculateRebate(new Decimal(it), y, b); l = CalculatePrice(new Decimal(it), y, k); d = CalculateRebate(new Decimal(it), w, b); a = CalculatePrice(new Decimal(it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(24 * c), p, b); s = CalculatePrice(new Decimal(24 * c), p, h); k = CalculateRebate(new Decimal(24 * c), y, b); l = CalculatePrice(new Decimal(24 * c), y, k); d = CalculateRebate(new Decimal(24 * c), w, b); a = CalculatePrice(new Decimal(24 * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), p, b); s = CalculatePrice(new Decimal(et), p, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), w, b); a = CalculatePrice(new Decimal(et), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; y.prototype.tochkdate = function (i, r, u, f, e, o) { var s, l, a, h, k, d, v, ht, ut, at, vt, lt, ot; if (e == null || e.toString() == "" || (ht = t.getValueOfDateTime(e), ht == null || ht.equals(0))) return ""; ut = t.getValueOfDateTime(e); ut = t.getValueOfDateTime(u.getValue("ADATETO")); var st = t.getValueOfDateTime(u.getValue("ADATEFROM")), g = t.getValueOfInt(u.getValue("CG1NUM")), nt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), p = t.getValueOfDecimal(u.getValue("CG2PRICE")); try { if (ut = t.getValueOfDateTime(u.getValue("ADATETO")), at = Utility.TimeUtil.getDaysBetween(st, ut), at <= 0) vt = Utility.TimeUtil.AddDays(st, 1), u.setValue("ADATETO", vt); else if (ut.compareTo(st) > 0) { var ct = ut.Subtract(st), c = Utility.TimeUtil.getDaysBetween(st, ut), dt = ct.Milliseconds, ft = ct.Seconds, et = ct.Minutes, rt, it, yt = c / 30, wt = c % 30, pt = c / 7, bt = c % 7; rt = wt == 0 ? yt : yt + 1; it = bt == 0 ? pt : pt + 1; lt = t.getValueOfDateTime(u.getValue("ADATEFROM")); u.setValue("CG1DATETO", ut); u.setValue("CG2DATETO", ut); u.setValue("CG1DATEFROM", lt); u.setValue("CG2DATEFROM", lt); ot = u.getValue("AUOM_ID").toString(); (ot == "" || ot.Trim().Length == 0) && (ot = "0"); var w = t.getValueOfDecimal(u.getValue("APRICE")), tt = System.Convert.ToInt16(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")); if (t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(ot)) { case 1000003: s = w; l = y; a = p; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), w, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(rt), w, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(it), w, h); l = CalculatePrice(new Decimal(it), y, h); a = CalculatePrice(new Decimal(it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), w, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(24 * c), w, h); l = CalculatePrice(new Decimal(24 * c), y, h); a = CalculatePrice(new Decimal(24 * c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(et), w, h); l = CalculatePrice(new Decimal(et), y, h); a = CalculatePrice(new Decimal(et), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ft), w, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(tt * it), w, h); l = CalculatePrice(new Decimal(g * it), y, h); a = CalculatePrice(new Decimal(nt * it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(tt * it), w, h); l = CalculatePrice(new Decimal(g * it), y, h); a = CalculatePrice(new Decimal(nt * it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); l = CalculatePrice(new Decimal(g * (c + 1)), y, h); a = CalculatePrice(new Decimal(nt * (c + 1)), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * tt), w, h); l = CalculatePrice(new Decimal((c + 1) * g), y, h); a = CalculatePrice(new Decimal((c + 1) * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(24 * c * tt), w, h); l = CalculatePrice(new Decimal(24 * c * g), y, h); a = CalculatePrice(new Decimal(24 * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(24 * c * tt), w, h); l = CalculatePrice(new Decimal(24 * c * g), y, h); a = CalculatePrice(new Decimal(24 * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") } } else switch (int.Parse(ot)) { case 1000003: s = w; l = y; a = p; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), w, b); s = CalculatePrice(new Decimal(c), w, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), p, b); a = CalculatePrice(new Decimal(c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(rt), w, b); s = CalculatePrice(new Decimal(rt), w, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), p, b); a = CalculatePrice(new Decimal(rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(it), w, b); s = CalculatePrice(new Decimal(it), w, h); k = CalculateRebate(new Decimal(it), y, b); l = CalculatePrice(new Decimal(it), y, k); d = CalculateRebate(new Decimal(it), p, b); a = CalculatePrice(new Decimal(it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), w, b); s = CalculatePrice(new Decimal(c + 1), w, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), p, b); a = CalculatePrice(new Decimal(c + 1), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(24 * c), w, b); s = CalculatePrice(new Decimal(24 * c), w, h); k = CalculateRebate(new Decimal(24 * c), y, b); l = CalculatePrice(new Decimal(24 * c), y, k); d = CalculateRebate(new Decimal(24 * c), p, b); a = CalculatePrice(new Decimal(24 * c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(et), w, b); s = CalculatePrice(new Decimal(et), w, h); k = CalculateRebate(new Decimal(et), y, b); l = CalculatePrice(new Decimal(et), y, k); d = CalculateRebate(new Decimal(et), p, b); a = CalculatePrice(new Decimal(et), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ft), w, b); s = CalculatePrice(new Decimal(ft), w, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), p, b); a = CalculatePrice(new Decimal(ft), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(tt * it), w, b); s = CalculatePrice(new Decimal(tt * it), w, h); k = CalculateRebate(new Decimal(g * it), y, b); l = CalculatePrice(new Decimal(g * it), y, k); d = CalculateRebate(new Decimal(nt * it), p, b); a = CalculatePrice(new Decimal(nt * it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(tt * it), w, b); s = CalculatePrice(new Decimal(tt * it), w, h); k = CalculateRebate(new Decimal(g * it), y, b); l = CalculatePrice(new Decimal(g * it), y, k); d = CalculateRebate(new Decimal(nt * it), p, b); a = CalculatePrice(new Decimal(nt * it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal((c + 1) * tt), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(24 * c * tt), w, b); s = CalculatePrice(new Decimal(24 * c * tt), w, h); k = CalculateRebate(new Decimal(24 * c * g), y, b); l = CalculatePrice(new Decimal(24 * c * g), y, k); d = CalculateRebate(new Decimal(24 * c * nt), p, b); a = CalculatePrice(new Decimal(24 * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(24 * c * tt), w, b); s = CalculatePrice(new Decimal(24 * c * tt), w, h); k = CalculateRebate(new Decimal(24 * c * g), y, b); l = CalculatePrice(new Decimal(24 * c * g), y, k); d = CalculateRebate(new Decimal(24 * c * nt), p, b); a = CalculatePrice(new Decimal(24 * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") }tt == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)); g == 0 && u.setValue("CG1TOTAL_AMOUNT", 0); nt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0) } } catch (kt) { this.setCalloutActive(!1); this.log.severe(kt.toString()) } return i = r = u = f = e = o = null, "" }; y.prototype.fromchkdate = function (i, r, u, f, e, o) { var s, l, a, h, k, d, v, ht, at, lt, st; if (e == null || e.toString() == "" || (ht = t.getValueOfDateTime(e), ht == null || ht.equals(0))) return ""; var et = t.getValueOfDateTime(u.getValue("ADATEFROM")), ot = t.getValueOfDateTime(u.getValue("ADATETO")), g = t.getValueOfInt(u.getValue("CG1NUM")), nt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), p = t.getValueOfDecimal(u.getValue("CG2PRICE")); try { if (et = t.getValueOfDateTime(u.getValue("ADATEFROM")), et.compareTo(ot) > 0) u.setValue("CG1DATEFROM", et), u.setValue("CG2DATEFROM", et), at = et.addDays(1), u.setValue("ADATETO", at); else if (ot.compareTo(et) > 0) { var ct = et.subtract(ot), c = Utility.TimeUtil.getDaysBetween(et, ot), kt = ct.Milliseconds, ut = ct.Seconds, ft = ct.Minutes, rt, it, vt = c / 30, pt = c % 30, yt = c / 7, wt = c % 7; rt = pt == 0 ? vt : vt + 1; it = wt == 0 ? yt : yt + 1; lt = t.getValueOfDateTime(u.getValue("ADATEFROM")); u.setValue("CG1DATETO", ot); u.setValue("CG2DATETO", ot); u.setValue("CG1DATEFROM", lt); u.setValue("CG2DATEFROM", lt); st = u.getValue("AUOM_ID").toString(); (st == "" || st.Trim().Length == 0) && (st = "0"); var w = t.getValueOfDecimal(u.getValue("APRICE")), tt = t.getValueOfInt(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")); if (t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(st)) { case 1000003: s = w; l = y; a = p; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(tt), w, h); l = CalculatePrice(new Decimal(g), y, h); a = CalculatePrice(new Decimal(nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), w, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(rt), w, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(it), w, h); l = CalculatePrice(new Decimal(it), y, h); a = CalculatePrice(new Decimal(it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), w, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(24 * c), w, h); l = CalculatePrice(new Decimal(24 * c), y, h); a = CalculatePrice(new Decimal(24 * c), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(ft), w, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ut), w, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * tt), w, h); l = CalculatePrice(new Decimal(c * g), y, h); a = CalculatePrice(new Decimal(c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(tt * it), w, h); l = CalculatePrice(new Decimal(g * it), y, h); a = CalculatePrice(new Decimal(nt * it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(tt * it), w, h); l = CalculatePrice(new Decimal(g * it), y, h); a = CalculatePrice(new Decimal(nt * it), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); l = CalculatePrice(new Decimal(g * (c + 1)), y, h); a = CalculatePrice(new Decimal(nt * (c + 1)), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * tt), w, h); l = CalculatePrice(new Decimal((c + 1) * g), y, h); a = CalculatePrice(new Decimal((c + 1) * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(24 * c * tt), w, h); l = CalculatePrice(new Decimal(24 * c * g), y, h); a = CalculatePrice(new Decimal(24 * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(24 * c * tt), w, h); l = CalculatePrice(new Decimal(24 * c * g), y, h); a = CalculatePrice(new Decimal(24 * c * nt), p, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") } } else switch (int.Parse(st)) { case 1000003: s = w; l = y; a = p; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(tt), w, b); s = CalculatePrice(new Decimal(tt), w, h); k = CalculateRebate(new Decimal(g), y, b); l = CalculatePrice(new Decimal(g), y, k); d = CalculateRebate(new Decimal(nt), p, b); a = CalculatePrice(new Decimal(nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), w, b); s = CalculatePrice(new Decimal(c), w, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), p, b); a = CalculatePrice(new Decimal(c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(rt), w, b); s = CalculatePrice(new Decimal(rt), w, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), p, b); a = CalculatePrice(new Decimal(rt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(it), w, b); s = CalculatePrice(new Decimal(it), w, h); k = CalculateRebate(new Decimal(it), y, b); l = CalculatePrice(new Decimal(it), y, k); d = CalculateRebate(new Decimal(it), p, b); a = CalculatePrice(new Decimal(it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), w, b); s = CalculatePrice(new Decimal(c + 1), w, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), p, b); a = CalculatePrice(new Decimal(c + 1), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(24 * c), w, b); s = CalculatePrice(new Decimal(24 * c), w, h); k = CalculateRebate(new Decimal(24 * c), y, b); l = CalculatePrice(new Decimal(24 * c), y, k); d = CalculateRebate(new Decimal(24 * c), p, b); a = CalculatePrice(new Decimal(24 * c), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(ft), w, b); s = CalculatePrice(new Decimal(ft), w, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), p, b); a = CalculatePrice(new Decimal(ft), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ut), w, b); s = CalculatePrice(new Decimal(ut), w, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), p, b); a = CalculatePrice(new Decimal(ut), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * tt), w, b); s = CalculatePrice(new Decimal(c * tt), w, h); k = CalculateRebate(new Decimal(c * g), y, b); l = CalculatePrice(new Decimal(c * g), y, k); d = CalculateRebate(new Decimal(c * nt), p, b); a = CalculatePrice(new Decimal(c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(tt * it), w, b); s = CalculatePrice(new Decimal(tt * it), w, h); k = CalculateRebate(new Decimal(g * it), y, b); l = CalculatePrice(new Decimal(g * it), y, k); d = CalculateRebate(new Decimal(nt * it), p, b); a = CalculatePrice(new Decimal(nt * it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(tt * it), w, b); s = CalculatePrice(new Decimal(tt * it), w, h); k = CalculateRebate(new Decimal(g * it), y, b); l = CalculatePrice(new Decimal(g * it), y, k); d = CalculateRebate(new Decimal(nt * it), p, b); a = CalculatePrice(new Decimal(nt * it), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal(tt * (c + 1)), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(tt * (c + 1)), w, b); s = CalculatePrice(new Decimal((c + 1) * tt), w, h); k = CalculateRebate(new Decimal(g * (c + 1)), y, b); l = CalculatePrice(new Decimal(g * (c + 1)), y, k); d = CalculateRebate(new Decimal(nt * (c + 1)), p, b); a = CalculatePrice(new Decimal(nt * (c + 1)), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(24 * c * tt), w, b); s = CalculatePrice(new Decimal(24 * c * tt), w, h); k = CalculateRebate(new Decimal(24 * c * g), y, b); l = CalculatePrice(new Decimal(24 * c * g), y, k); d = CalculateRebate(new Decimal(24 * c * nt), p, b); a = CalculatePrice(new Decimal(24 * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(24 * c * tt), w, b); s = CalculatePrice(new Decimal(24 * c * tt), w, h); k = CalculateRebate(new Decimal(24 * c * g), y, b); l = CalculatePrice(new Decimal(24 * c * g), y, k); d = CalculateRebate(new Decimal(24 * c * nt), p, b); a = CalculatePrice(new Decimal(24 * c * nt), p, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") }tt == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)); g == 0 && u.setValue("CG1TOTAL_AMOUNT", 0); nt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0) } } catch (bt) { this.setCalloutActive(!1); this.log.severe(bt.toString()) } return i = r = u = f = e = o = null, "" }; y.prototype.UOMSelected = function (i, r, u, f, e, o) { var s, l, a, h, k, d, v, et; if (e == null || e.toString() == "" || (et = t.getValueOfInt(e), et = t.getValueOfInt(u.getValue("AUOM_ID")), et == null)) return ""; u.setValue("CG1UOM_ID", et); u.setValue("CG2UOM_ID", et); var ct = u.getValue("AUOM_ID").toString(), p = t.getValueOfDecimal(u.getValue("APRICE")), g = t.getValueOfInt(u.getValue("ANUM")), b = t.getValueOfDecimal(u.getValue("AREBATE")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), ot = t.getValueOfDateTime(u.getValue("ADATETO")), st = t.getValueOfDateTime(u.getValue("ADATEFROM")), ht = st.compareTo(ot) > 0 ? st.Subtract(ot) : ot.Subtract(st); var c = Utility.timeUtil.getDaysBetween(st, ot), pt = ht.Milliseconds, ut = ht.Seconds, ft = ht.Minutes, rt, it, lt = c / 30, vt = c % 30, at = c / 7, yt = c % 7; if (rt = vt == 0 ? lt : lt + 1, it = yt == 0 ? at : at + 1, t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(ct)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(rt), p, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(it), p, h); l = CalculatePrice(new Decimal(it), y, h); a = CalculatePrice(new Decimal(it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(24 * c), p, h); l = CalculatePrice(new Decimal(24 * c), y, h); a = CalculatePrice(new Decimal(24 * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ut), p, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") } } else switch (int.Parse(ct)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(rt), p, b); s = CalculatePrice(new Decimal(rt), p, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), w, b); a = CalculatePrice(new Decimal(rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(it), p, b); s = CalculatePrice(new Decimal(it), p, h); k = CalculateRebate(new Decimal(it), y, b); l = CalculatePrice(new Decimal(it), y, k); d = CalculateRebate(new Decimal(it), w, b); a = CalculatePrice(new Decimal(it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(24 * c), p, b); s = CalculatePrice(new Decimal(24 * c), p, h); k = CalculateRebate(new Decimal(24 * c), y, b); l = CalculatePrice(new Decimal(24 * c), y, k); d = CalculateRebate(new Decimal(24 * c), w, b); a = CalculatePrice(new Decimal(24 * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ut), p, b); s = CalculatePrice(new Decimal(ut), p, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), w, b); a = CalculatePrice(new Decimal(ut), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; y.prototype.AVALSelected = function (i, r, u, f, e, o) { var s, l, a, h, k, d, v, et; if (e == null || e.toString() == "") return ""; et = null; try { et = u.getValue("AUOM_ID").toString() } catch (yt) { return this.setCalloutActive(!1), "" } var p = t.getValueOfDecimal(u.getValue("APRICE")), b = t.getValueOfDecimal(u.getValue("AREBATE")), g = t.getValueOfInt(u.getValue("ANUM")), st = t.getValueOfDateTime(u.getValue("ADATETO")), nt = t.getValueOfInt(u.getValue("CG1NUM")), tt = t.getValueOfInt(u.getValue("CG2NUM")), y = t.getValueOfDecimal(u.getValue("CG1PRICE")), w = t.getValueOfDecimal(u.getValue("CG2PRICE")), ht = t.getValueOfDateTime(u.getValue("ADATEFROM")), ot = ht.Subtract(st), c = Utility.TimeUtil.getDaysBetween(ht, st), pt = ot.Milliseconds, ut = ot.Seconds, ft = ot.Minutes, rt, it, ct = c / 30, at = c % 30, lt = c / 7, vt = c % 7; if (rt = at == 0 ? ct : ct + 1, it = vt == 0 ? lt : lt + 1, t.getValueOfInt(b) == 0) { h = n.Env.ZERO; switch (int.Parse(et)) { case 1000003: s = p; l = y; a = w; l = y; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: s = CalculatePrice(new Decimal(g), p, h); l = CalculatePrice(new Decimal(nt), y, h); a = CalculatePrice(new Decimal(tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: s = CalculatePrice(new Decimal(c), p, h); l = CalculatePrice(new Decimal(c), y, h); a = CalculatePrice(new Decimal(c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: s = CalculatePrice(new Decimal(rt), p, h); l = CalculatePrice(new Decimal(rt), y, h); a = CalculatePrice(new Decimal(rt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: s = CalculatePrice(new Decimal(it), p, h); l = CalculatePrice(new Decimal(it), y, h); a = CalculatePrice(new Decimal(it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: s = CalculatePrice(new Decimal(c + 1), p, h); l = CalculatePrice(new Decimal(c + 1), y, h); a = CalculatePrice(new Decimal(c + 1), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: s = CalculatePrice(new Decimal(24 * c), p, h); l = CalculatePrice(new Decimal(24 * c), y, h); a = CalculatePrice(new Decimal(24 * c), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: s = CalculatePrice(new Decimal(ft), p, h); l = CalculatePrice(new Decimal(ft), y, h); a = CalculatePrice(new Decimal(ft), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: s = CalculatePrice(new Decimal(ut), p, h); l = CalculatePrice(new Decimal(ut), y, h); a = CalculatePrice(new Decimal(ut), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: s = CalculatePrice(new Decimal(c * g), p, h); l = CalculatePrice(new Decimal(c * nt), y, h); a = CalculatePrice(new Decimal(c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: s = CalculatePrice(new Decimal(g * it), p, h); l = CalculatePrice(new Decimal(nt * it), y, h); a = CalculatePrice(new Decimal(tt * it), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: s = CalculatePrice(new Decimal(g * (c + 1)), p, h); l = CalculatePrice(new Decimal(nt * (c + 1)), y, h); a = CalculatePrice(new Decimal(tt * (c + 1)), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: s = CalculatePrice(new Decimal((c + 1) * g), p, h); l = CalculatePrice(new Decimal((c + 1) * nt), y, h); a = CalculatePrice(new Decimal((c + 1) * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: s = CalculatePrice(new Decimal(24 * c * g), p, h); l = CalculatePrice(new Decimal(24 * c * nt), y, h); a = CalculatePrice(new Decimal(24 * c * tt), w, h); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") } } else switch (int.Parse(et)) { case 1000003: s = p; l = y; a = w; u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000004: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000005: h = CalculateRebate(new Decimal(g), p, b); s = CalculatePrice(new Decimal(g), p, h); k = CalculateRebate(new Decimal(nt), y, b); l = CalculatePrice(new Decimal(nt), y, k); d = CalculateRebate(new Decimal(tt), w, b); a = CalculatePrice(new Decimal(tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000006: h = CalculateRebate(new Decimal(c), p, b); s = CalculatePrice(new Decimal(c), p, h); k = CalculateRebate(new Decimal(c), y, b); l = CalculatePrice(new Decimal(c), y, k); d = CalculateRebate(new Decimal(c), w, b); a = CalculatePrice(new Decimal(c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000007: h = CalculateRebate(new Decimal(rt), p, b); s = CalculatePrice(new Decimal(rt), p, h); k = CalculateRebate(new Decimal(rt), y, b); l = CalculatePrice(new Decimal(rt), y, k); d = CalculateRebate(new Decimal(rt), w, b); a = CalculatePrice(new Decimal(rt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000008: h = CalculateRebate(new Decimal(it), p, b); s = CalculatePrice(new Decimal(it), p, h); k = CalculateRebate(new Decimal(it), y, b); l = CalculatePrice(new Decimal(it), y, k); d = CalculateRebate(new Decimal(it), w, b); a = CalculatePrice(new Decimal(it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000009: h = CalculateRebate(new Decimal(c + 1), p, b); s = CalculatePrice(new Decimal(c + 1), p, h); k = CalculateRebate(new Decimal(c + 1), y, b); l = CalculatePrice(new Decimal(c + 1), y, k); d = CalculateRebate(new Decimal(c + 1), w, b); a = CalculatePrice(new Decimal(c + 1), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000010: h = CalculateRebate(new Decimal(24 * c), p, b); s = CalculatePrice(new Decimal(24 * c), p, h); k = CalculateRebate(new Decimal(24 * c), y, b); l = CalculatePrice(new Decimal(24 * c), y, k); d = CalculateRebate(new Decimal(24 * c), w, b); a = CalculatePrice(new Decimal(24 * c), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000011: h = CalculateRebate(new Decimal(ft), p, b); s = CalculatePrice(new Decimal(ft), p, h); k = CalculateRebate(new Decimal(ft), y, b); l = CalculatePrice(new Decimal(ft), y, k); d = CalculateRebate(new Decimal(ft), w, b); a = CalculatePrice(new Decimal(ft), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000012: h = CalculateRebate(new Decimal(ut), p, b); s = CalculatePrice(new Decimal(ut), p, h); k = CalculateRebate(new Decimal(ut), y, b); l = CalculatePrice(new Decimal(ut), y, k); d = CalculateRebate(new Decimal(ut), w, b); a = CalculatePrice(new Decimal(ut), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000013: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000014: h = CalculateRebate(new Decimal(c * g), p, b); s = CalculatePrice(new Decimal(c * g), p, h); k = CalculateRebate(new Decimal(c * nt), y, b); l = CalculatePrice(new Decimal(c * nt), y, k); d = CalculateRebate(new Decimal(c * tt), w, b); a = CalculatePrice(new Decimal(c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000015: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000016: h = CalculateRebate(new Decimal(g * it), p, b); s = CalculatePrice(new Decimal(g * it), p, h); k = CalculateRebate(new Decimal(nt * it), y, b); l = CalculatePrice(new Decimal(nt * it), y, k); d = CalculateRebate(new Decimal(tt * it), w, b); a = CalculatePrice(new Decimal(tt * it), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000017: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal(g * (c + 1)), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000018: h = CalculateRebate(new Decimal(g * (c + 1)), p, b); s = CalculatePrice(new Decimal((c + 1) * g), p, h); k = CalculateRebate(new Decimal(nt * (c + 1)), y, b); l = CalculatePrice(new Decimal(nt * (c + 1)), y, k); d = CalculateRebate(new Decimal(tt * (c + 1)), w, b); a = CalculatePrice(new Decimal(tt * (c + 1)), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; case 1000019: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = Decimal.Add(Decimal.Add(s, l), a); u.setValue("GRAND_TOTAL", v); break; case 1000020: h = CalculateRebate(new Decimal(24 * c * g), p, b); s = CalculatePrice(new Decimal(24 * c * g), p, h); k = CalculateRebate(new Decimal(24 * c * nt), y, b); l = CalculatePrice(new Decimal(24 * c * nt), y, k); d = CalculateRebate(new Decimal(24 * c * tt), w, b); a = CalculatePrice(new Decimal(24 * c * tt), w, d); u.setValue("ATOTAL_AMOUNT", s); u.setValue("CG1TOTAL_AMOUNT", l); u.setValue("CG2TOTAL_AMOUNT", a); v = s; u.setValue("GRAND_TOTAL", v); break; default: ShowMessage.Info("false", !0, "", "") }return g == 0 && (u.setValue("ATOTAL_AMOUNT", 0), u.setValue("GRAND_TOTAL", 0)), nt == 0 && u.setValue("CG1TOTAL_AMOUNT", 0), tt == 0 && u.setValue("CG2TOTAL_AMOUNT", 0), i = r = u = f = e = o = null, "" }; n.Model.CalloutOfferServices = y; it.prototype.TypeSelection = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = t.getValueOfBoolean(f); return o == null ? "" : (o == !0 ? r.setValue("flag1", !0) : r.setValue("flag1", !1), n = i = r = u = f = e = null, "") }; it.prototype.RecordSort = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = t.getValueOfBoolean(f); return o == null ? "" : (o == !0 ? r.setValue("flag2", !0) : r.setValue("flag2", !1), n = i = r = u = f = e = null, "") }; it.prototype.EndDate = function (i, r, u, f, e, o) { var s, h, c; if (e == null || e.toString() == "" || (s = t.getValueOfDateTime(e), s == null || s.equals(0))) return ""; h = t.getValueOfDateTime(e); c = t.getValueOfDateTime(u.getValue("DATE_FROM")); try { h = t.getValueOfDateTime(u.getValue("TILL_DATE")); h.compareTo(c) < 0 && (n.ADialog.info("EndAndStartDate"), u.setValue("TILL_DATE", c)) } catch (l) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; it.prototype.StartDate = function (n, i, r, u, f, e) { var s, o, h; if (f == null || f.toString() == "" || (s = t.getValueOfDateTime(f), s == null || s.equals(0))) return ""; o = t.getValueOfDateTime(r.getValue("DATE_FROM")); h = t.getValueOfDateTime(r.getValue("TILL_DATE")); try { o = t.getValueOfDateTime(r.getValue("DATE_FROM")); o.compareTo(h) > 0 && r.setValue("TILL_DATE", o) } catch (c) { this.setCalloutActive(!1) } return n = i = r = u = f = e = null, "" }; n.Model.CalloutCheckInOut = it; n.Utility.inheritPrototype(b, n.CalloutEngine); b.prototype.Product = function (i, r, u, f, e, o) { var l, v, d, g, ut, s, a, y, h, tt, c, it, w, rt, p; if (this.isCalloutActive() || f.getColumnName() != "M_ProductContainer_ID" || e != null && e.toString() != "" || (e = 0), this.isCalloutActive() || e == null || e.toString() == "") return ""; l = 0; v = i.getContext(r, "AttrCode"); v != null && v != "" && f.getColumnName() != "M_ProductContainer_ID" && (a = e.toString() + "," + v.toString(), l = n.dataContext.getJSONRecord("MInventoryLine/GetProductAttribute", a)); var b = t.getValueOfInt(u.getValue("M_InventoryLine_ID")), st = t.getValueOfInt(u.getValue("M_Inventory_ID")), k = null, ht = st.toString(); if (k = n.dataContext.getJSONRecord("MInventory/GetMInventory", ht), d = k.MovementDate, g = k.AD_Org_ID, f.getColumnName() == "M_Product_ID" && (ut = n.dataContext.getJSONRecord("MInventoryLine/GetProductUOM", e.toString()), u.setValue("C_UOM_ID", t.getValueOfInt(ut))), s = null, a = b.toString(), b != null && b != 0) { y = null; y = n.dataContext.getJSONRecord("MInventoryLine/GetMInventoryLine", a); var h = y.M_Product_ID, c = y.M_Locator_ID, nt = t.getValueOfInt(u.getValue("M_Product_ID")), ft = t.getValueOfInt(u.getValue("M_Locator_ID")), p = t.getValueOfInt(u.getValue("M_ProductContainer_ID")), et = 0; if (nt != h || ft != c || f.getColumnName() == "M_ProductContainer_ID") { this.setCalloutActive(!0); l > 0 && u.setValue("M_AttributeSetInstance_ID", l); nt == h ? et = t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID")) : u.setValue("M_AttributeSetInstance_ID", null); try { s = this.SetQtyBook(g, et, nt, ft, t.getValueOfDate(d), p); u.setValue("QtyBook", s) } catch (ot) { return this.setCalloutActive(!1), this.log.severe(ot.toString()), u.setValue("QtyBook", s) } } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } if ((h = 0, tt = t.getValueOfInt(u.getValue("M_Product_ID")), tt != null && (h = tt), h == 0) || (c = 0, it = t.getValueOfInt(u.getValue("M_Locator_ID")), it != null && (c = it), c == 0)) return ""; this.setCalloutActive(!0); l > 0 && u.setValue("M_AttributeSetInstance_ID", l); w = 0; rt = t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID")); rt != null && (w = rt); u.setValue("M_AttributeSetInstance_ID", null); p = t.getValueOfInt(u.getValue("M_ProductContainer_ID")); try { s = this.SetQtyBook(g, w, h, c, t.getValueOfDate(d), p); u.setValue("QtyBook", s) } catch (ot) { return this.setCalloutActive(!1), this.log.severe(ot.toString()), u.setValue("QtyBook", s) } return this.log.info("M_Product_ID=" + h + ", M_Locator_ID=" + c + ", M_AttributeSetInstance_ID=" + w + " - QtyBook=" + s), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; b.prototype.AttributeSetInstance = function (i, r, u, f, e, o) { var s, v, l, y, w; if (this.isCalloutActive()) return ""; var tt = t.getValueOfInt(u.getValue("M_InventoryLine_ID")), b = t.getValueOfInt(u.getValue("M_Inventory_ID")), a = null, k = b.toString(); a = n.dataContext.getJSONRecord("MInventory/GetMInventory", k); var d = a.MovementDate, g = a.AD_Org_ID, h = null, c = 0, p = t.getValueOfInt(u.getValue("M_Product_ID")); if ((p != null && (c = p), c == 0) || (s = 0, v = t.getValueOfInt(u.getValue("M_Locator_ID")), v != null && (s = v), s == 0)) return ""; this.setCalloutActive(!0); l = 0; y = t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID")); y != null && (l = y); w = t.getValueOfInt(u.getValue("M_ProductContainer_ID")); try { h = this.SetQtyBook(g, l, c, s, t.getValueOfDate(d), w); u.setValue("QtyBook", h) } catch (nt) { return this.setCalloutActive(!1), this.log.severe(nt.toString()), u.setValue("QtyBook", h) } return this.log.info("M_Product_ID=" + c + ", M_Locator_ID=" + s + ", M_AttributeSetInstance_ID=" + l + " - QtyBook=" + h), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; b.prototype.SetDiff = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = 0, s = 0, h = 0; this.setCalloutActive(!0); try { u.getColumnName().equals("DifferenceQty") ? (s = t.getValueOfDecimal(r.getValue("OpeningStock")), h = t.getValueOfDecimal(r.getValue("DifferenceQty")), o = s - h, r.setValue("AsOnDateCount", o), r.setValue("QtyCount", 0)) : u.getColumnName().equals("AsOnDateCount") && (s = t.getValueOfDecimal(r.getValue("OpeningStock")), o = t.getValueOfDecimal(r.getValue("AsOnDateCount")), h = s - o, r.setValue("DifferenceQty", h), r.setValue("QtyCount", 0)) } catch (c) { return this.setCalloutActive(!1), this.log.severe(c.toString()), c.message } return this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; b.prototype.SetQtyBook = function (i, r, u, f, e, o) { var c = null, l = "", a = "", v = 0, h = !1, s; return (n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"] != undefined && (h = n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y", !0)), s = "TO_DATE( '" + (Number(e.getMonth()) + 1) + "-" + e.getDate() + "-" + e.getFullYear() + "', 'MM-DD-YYYY')", l = h ? "SELECT COUNT(*) FROM M_Transaction WHERE movementdate = " + s + " AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + " AND NVL(M_ProductContainer_ID, 0) = " + o : "SELECT COUNT(*) FROM M_Transaction WHERE movementdate = " + s + " AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r, v = t.getValueOfInt(n.DB.executeScalar(l)), v > 0 ? (a = h ? "SELECT  NVL(ContainerCurrentQty, 0) AS currentqty FROM M_Transaction WHERE M_Transaction_ID = (SELECT MAX(M_Transaction_ID)   FROM M_Transaction  WHERE movementdate = (SELECT MAX(movementdate) FROM M_Transaction WHERE movementdate <= " + s + "  AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + " AND NVL(M_ProductContainer_ID, 0) = " + o + ") AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + " AND NVL(M_ProductContainer_ID, 0) = " + o + ")  AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + " AND NVL(M_ProductContainer_ID, 0) = " + o : "SELECT currentqty FROM M_Transaction WHERE M_Transaction_ID = (SELECT MAX(M_Transaction_ID)   FROM M_Transaction  WHERE movementdate = (SELECT MAX(movementdate) FROM M_Transaction WHERE movementdate <= " + s + "  AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + ") AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + ") AND AD_Org_ID = " + i + " AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r, c = t.getValueOfDecimal(n.DB.executeScalar(a))) : (l = h ? "SELECT COUNT(*) FROM M_Transaction WHERE movementdate < " + s + " AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + " AND NVL(M_ProductContainer_ID, 0) = " + o : "SELECT COUNT(*) FROM M_Transaction WHERE movementdate < " + s + " AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r, v = t.getValueOfInt(n.DB.executeScalar(l)), v > 0 && (a = h ? "SELECT NVL(ContainerCurrentQty, 0) AS currentqty FROM M_Transaction WHERE M_Transaction_ID = (SELECT MAX(M_Transaction_ID)   FROM M_Transaction  WHERE movementdate =  (SELECT MAX(movementdate) FROM M_Transaction WHERE movementdate < " + s + " AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + " AND NVL(M_ProductContainer_ID, 0) = " + o + ") AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + " AND NVL(M_ProductContainer_ID, 0) = " + o + ")  AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + " AND NVL(M_ProductContainer_ID, 0) = " + o : "SELECT currentqty FROM M_Transaction WHERE M_Transaction_ID = (SELECT MAX(M_Transaction_ID)   FROM M_Transaction  WHERE movementdate =  (SELECT MAX(movementdate) FROM M_Transaction WHERE movementdate < " + s + " AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + ") AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r + ") AND AD_Org_ID = " + i + " AND  M_Product_ID = " + u + " AND M_Locator_ID = " + f + " AND M_AttributeSetInstance_ID = " + r, c = t.getValueOfDecimal(n.DB.executeScalar(a)))), c != null) ? c : 0 }; b.prototype.SetUOMQty = function (i, r, u, f, e, o) { var v, h, l, c, a, y; if (e == null || e.toString() == "" || this.isCalloutActive()) return ""; var p = 0, w = 0, b = 0, s = 0; this.setCalloutActive(!0); try { if (v = t.getValueOfDecimal(u.getValue("M_Product_ID")), v == 0) return this.setCalloutActive(!1), ""; u.getValue("IsInternalUse") == !1 || u.getValue("IsInternalUse") == null ? (f.getColumnName() == "C_UOM_ID" ? (h = t.getValueOfInt(e), QtyEntered = t.getValueOfDecimal(u.getValue("QtyEntered")), v = t.getValueOfInt(u.getValue("M_Product_ID")), paramStr = h.toString().concat(","), l = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr), c = QtyEntered.toFixed(t.getValueOfInt(l)), QtyEntered != c && (this.log.fine("Corrected QtyEntered Scale UOM=" + h + "; QtyEntered=" + QtyEntered + "->" + c), QtyEntered = c, u.setValue("QtyEntered", QtyEntered)), paramStr = v.toString().concat(",").concat(h.toString()).concat(",").concat(QtyEntered.toString()), a = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), s = a, s == null && (s = QtyEntered)) : f.getColumnName() == "QtyEntered" && (h = i.getContextAsInt(r, "C_UOM_ID"), QtyEntered = t.getValueOfDecimal(e), paramStr = h.toString().concat(","), l = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr), c = QtyEntered.toFixed(t.getValueOfInt(l)), QtyEntered != c && (this.log.fine("Corrected QtyEntered Scale UOM=" + h + "; QtyEntered=" + QtyEntered + "->" + c), QtyEntered = c, u.setValue("QtyEntered", QtyEntered)), paramStr = v.toString().concat(",", h.toString(), ",", QtyEntered.toString()), a = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), s = a, s == null && (s = QtyEntered), y = QtyEntered != s, this.log.fine("UOM=" + h + ", QtyEntered=" + QtyEntered + " -> " + y + " QtyOrdered=" + s), i.setContext(r, "UOMConversion", y ? "Y" : "N")), u.getValue("AdjustmentType").toString() == "D" ? (w = t.getValueOfDecimal(u.getValue("OpeningStock")), b = s, p = w - b, u.setValue("DifferenceQty", s), u.setValue("AsOnDateCount", p)) : u.getValue("AdjustmentType").toString() == "A" && (w = t.getValueOfDecimal(u.getValue("OpeningStock")), p = s, b = w - p, u.setValue("AsOnDateCount", s), u.setValue("DifferenceQty", b))) : u.getValue("IsInternalUse") == !0 && (f.getColumnName() == "C_UOM_ID" ? (h = t.getValueOfInt(e), QtyEntered = t.getValueOfDecimal(u.getValue("QtyEntered")), v = t.getValueOfInt(u.getValue("M_Product_ID")), paramStr = h.toString().concat(","), l = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr), c = QtyEntered.toFixed(t.getValueOfInt(l)), QtyEntered != c && (this.log.fine("Corrected QtyEntered Scale UOM=" + h + "; QtyEntered=" + QtyEntered + "->" + c), QtyEntered = c, u.setValue("QtyEntered", QtyEntered)), paramStr = v.toString().concat(",").concat(h.toString()).concat(",").concat(QtyEntered.toString()), a = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), s = a, s == null && (s = QtyEntered), u.setValue("QtyInternalUse", s)) : f.getColumnName() == "QtyEntered" && (h = i.getContextAsInt(r, "C_UOM_ID"), QtyEntered = t.getValueOfDecimal(e), paramStr = h.toString().concat(","), l = n.dataContext.getJSONRecord("MUOM/GetPrecision", paramStr), c = QtyEntered.toFixed(t.getValueOfInt(l)), QtyEntered != c && (this.log.fine("Corrected QtyEntered Scale UOM=" + h + "; QtyEntered=" + QtyEntered + "->" + c), QtyEntered = c, u.setValue("QtyEntered", QtyEntered)), paramStr = v.toString().concat(",", h.toString(), ",", QtyEntered.toString()), a = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", paramStr), s = a, s == null && (s = QtyEntered), y = QtyEntered != s, this.log.fine("UOM=" + h + ", QtyEntered=" + QtyEntered + " -> " + y + " QtyOrdered=" + s), i.setContext(r, "UOMConversion", y ? "Y" : "N"), u.setValue("QtyInternalUse", s))) } catch (k) { return this.setCalloutActive(!1), this.log.severe(k.toString()), k.message } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutInventory = b; n.Utility.inheritPrototype(o, n.CalloutEngine); o.prototype.DocType = function (r, u, f, e, o, s) { var l, a, h, c; if (o == null || o.toString() == "" || (l = o, l == null || l == 0)) return ""; a = l.toString(); h = n.dataContext.getJSONRecord("MDocType/GetDocTypeData", a); try { r.setContext(u, "HasCharges", t.getValueOfString(h.HasCharges)); h.IsDocNoControlled == "Y" && f.setValue("DocumentNo", "<" + t.getValueOfString(h.CurrentNext) + ">"); c = t.getValueOfString(h.DocBaseType); r.setContext(u, "DocBaseType", c); c.startsWith("AP") ? f.setValue("PaymentRule", "S") : c.endsWith("C") && f.setValue("PaymentRule", "P"); f.getField("TreatAsDiscount") != null && (c.equals("APC") ? f.setValue("TreatAsDiscount", t.getValueOfBoolean(h.TreatAsDiscount)) : f.setValue("TreatAsDiscount", !1)); f.getField("IsReturnTrx") != null && f.setValue("IsReturnTrx", t.getValueOfBoolean(h.IsReturnTrx)) } catch (v) { return this.setCalloutActive(!1), h != null && h.close(), this.log.log(i.SEVERE, sql, v), v.message } return r = u = f = e = o = s = null, "" }; o.prototype.BPartner = function (r, u, f, e, o, s) { var p, k, st, c, tt, l, ct, lt, it, rt, ut, ft, et, at, g, nt; if (o == null || o.toString() == "") return ""; try { if (p = t.getValueOfInt(o), p == null || p == 0) return ""; var b = "N", ot = "N", d = "SELECT p.AD_Language,p.C_PaymentTerm_ID, COALESCE(p.M_PriceList_ID,g.M_PriceList_ID) AS M_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted, p.C_IncoTerm_ID,p.C_IncoTermPO_ID, ", tt = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")); tt > 0 && (d += " p.VA009_PaymentMethod_ID, p.VA009_PO_PaymentMethod_ID, "); d += "p.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable, l.C_BPartner_Location_ID,c.AD_User_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID,  p.SalesRep_ID,p.IsSalesRep, p.C_Withholding_ID  FROM C_BPartner p INNER JOIN C_BP_Group g ON (p.C_BP_Group_ID=g.C_BP_Group_ID) LEFT OUTER JOIN C_BPartner_Location l ON (p.C_BPartner_ID=l.C_BPartner_ID AND l.IsBillTo='Y' AND l.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID=" + p + " AND p.IsActive='Y'"; var w = r.isSOTrx(u), h = null, a = null; try { if (h = n.DB.executeReader(d, null, null), h.read()) { if (k = t.getValueOfInt(h.get(w ? "m_pricelist_id" : "po_pricelist_id")), k > 0 && f.setValue("M_PriceList_ID", k), st = t.getValueOfInt(h.get(w ? "C_IncoTerm_ID" : "C_IncoTermPO_ID")), st > 0 && f.setValue("C_IncoTerm_ID", st), c = t.getValueOfString(h.get(w ? "paymentrule" : "paymentrulepo")), c != null && c.length != 0 && (r.getContext("DocBaseType").toString().endsWith("C") ? c = "P" : w && (c.toString().equals("S") || c.toString().equals("U")) && (c = "P"), f.setValue("PaymentRule", c)), tt = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")), tt > 0) { var y = t.getValueOfInt(h.get("VA009_PaymentMethod_ID")), b = "N", v = n.dataContext.getJSONRecord("MBPartner/GetBPDetails", p); v != null && (b = t.getValueOfString(v.IsVendor), ot = t.getValueOfString(v.IsCustomer), w ? b == "Y" ? (y = 0, l = null, ot == "Y" && (y = t.getValueOfInt(v.VA009_PaymentMethod_ID), l = t.getValueOfString(v.VA009_PAYMENTBASETYPE))) : ot == "Y" && (y = t.getValueOfInt(v.VA009_PaymentMethod_ID), l = t.getValueOfString(v.VA009_PAYMENTBASETYPE)) : b == "Y" ? (y = t.getValueOfInt(v.VA009_PO_PaymentMethod_ID), l = t.getValueOfString(v.VA009_PAYMENTBASETYPEPO)) : (y = 0, l = null)); y == 0 ? f.setValue("VA009_PaymentMethod_ID", null) : (f.setValue("VA009_PaymentMethod_ID", y), l = n.DB.executeScalar("SELECT VA009_PaymentBaseType FROM VA009_PaymentMethod WHERE VA009_PaymentMethod_ID=" + y), l != null ? (f.setValue("PaymentMethod", l), b == "N" ? f.setValue("PaymentRule", l) : f.setValue("PaymentRule", l)) : (f.setValue("PaymentMethod", "T"), b == "N" ? f.setValue("PaymentRule", "T") : f.setValue("PaymentRule", "T"))) } ct = t.getValueOfInt(f.getValue("C_PaymentTerm_ID")); lt = t.getValueOfDecimal(f.getValue("C_Order_Blanket")); ct > 0 && lt > 0 || (k = t.getValueOfInt(h.get(w ? "c_paymentterm_id" : "po_paymentterm_id")), k > 0 && f.setValue("C_PaymentTerm_ID", k)); it = t.getValueOfInt(h.get("c_bpartner_location_id")); p.toString().equals(r.getContext("C_BPartner_ID")) && (rt = r.getContext("C_BPartner_Location_ID"), rt && rt.toString().length > 0 && (it = parseInt(rt))); it == 0 ? f.setValue("C_BPartner_Location_ID", null) : f.setValue("C_BPartner_Location_ID", it); ut = t.getValueOfInt(h.get("ad_user_id")); p.toString().equals(r.getContext("C_BPartner_ID")) && (ft = r.getContext("AD_User_ID"), ft && ft.toString().length > 0 && (ut = parseInt(ft))); ut == 0 ? f.setValue("AD_User_ID", null) : f.setValue("AD_User_ID", ut); w && (et = h.getString("CreditStatusSettingOn"), et == "CH" ? (g = t.getValueOfDouble(h.get("so_creditlimit")), g != 0 && (nt = t.getValueOfDouble(h.get("creditavailable")), h != null && nt <= 0 && n.ADialog.info("CreditOver"))) : (at = t.getValueOfInt(f.getValue("C_BPartner_Location_ID")), d = "SELECT bp.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable FROM C_BPartner_Location p INNER JOIN C_BPartner bp ON (bp.C_BPartner_ID = p.C_BPartner_ID) WHERE p.C_BPartner_Location_ID = " + at, a = n.DB.executeReader(d), a.read() && (et = a.getString("CreditStatusSettingOn"), et == "CL" && (g = t.getValueOfDouble(a.get("so_creditlimit")), g != 0 && (nt = t.getValueOfDouble(a.get("creditavailable")), h != null && nt <= 0 && n.ADialog.info("CreditOver")))))); c = t.getValueOfString(h.get("poreference")); c != null && c.length != 0 ? f.setValue("POReference", c) : f.setValue("POReference", null); c = t.getValueOfString(h.get("so_description")); c != null && c.toString().trim().length != 0 && f.setValue("Description", c); c = t.getValueOfString(h.get("isdiscountprinted")); c != null && c.toString().trim().length != 0 ? f.setValue("IsDiscountPrinted", c) : f.setValue("IsDiscountPrinted", "N") } h.close() } catch (ht) { return this.setCalloutActive(!1), h != null && h.close(), a != null && a.close(), this.log.log(i.SEVERE, "bPartner", ht), ht.message } finally { h != null && h.close(); a != null && a.close() } } catch (ht) { this.setCalloutActive(!1); this.log.severe(ht.toString()) } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; o.prototype.PaymentTerm = function (t, i, r, u, f, e) { var o, h, c, l, s, a; if (f == null || f.toString() == "") return ""; try { if (o = f, h = t.getContextAsInt(i, "C_Invoice_ID", !1), o == null || o == 0 || h == 0) return ""; if (l = o.toString().concat(",", h.toString()), s = n.dataContext.getJSONRecord("MPaymentTerm/GetPaymentTerm", l), s != null) { if (c = s.Get_ID, a = s.Apply, c == 0) return "PaymentTerm not found"; r.setValue("IsPayScheduleValid", a ? !0 : !1) } } catch (v) { this.setCalloutActive(!1); this.log.severe(v.toString()) } return t = i = r = u = f = e = null, "" }; o.prototype.Product = function (i, u, f, e, o, s) { var a, b, d, c, rt, lt, nt, p, it, et, w, h; if (this.isCalloutActive() || o == null || o.toString() == "") return f.setValue("VA038_AmortizationTemplate_ID", 0), ""; if (a = o, a == null || a == 0) return ""; this.setCalloutActive(!0); try { f.setValue("C_Charge_ID", null); f.setValue("M_AttributeSetInstance_ID", null); b = i.getWindowContext(u, "IsSOTrx", !0) == "Y"; sql = "SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'"; r = t.getValueOfInt(n.DB.executeScalar(sql)); d = n.dataContext.getJSONRecord("MInvoice/GetInvoice", f.getValue("C_Invoice_ID").toString()); c = 0; r > 0 && (sql = "SELECT C_UOM_ID FROM M_Product_PO WHERE IsActive = 'Y' AND  C_BPartner_ID = " + t.getValueOfInt(d.C_BPartner_ID) + " AND M_Product_ID = " + a, c = t.getValueOfInt(n.DB.executeScalar(sql)), c > 0 && b == !1 ? f.setValue("C_UOM_ID", c) : (sql = "SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_Product_ID = " + a, f.setValue("C_UOM_ID", t.getValueOfInt(n.DB.executeScalar(sql))))); f.findColumn("C_REVENUERECOGNITION_ID") > -1 && (rt = n.dataContext.getJSONRecord("MProduct/GetRevenuRecognition", a), f.setValue("C_REVENUERECOGNITION_ID", rt)); var ut = i.getContextAsInt(u, "C_BPartner_ID", !1), ot = f.getValue("QtyInvoiced"), g = i.getContextAsInt(u, "M_PriceList_ID", !1), st = i.getContextAsInt(u, "M_PriceList_Version_ID"), ht = i.getContextAsInt(u, "M_AttributeSetInstance_ID"), ct = i.getContext("DateInvoiced"), v = t.getValueOfInt(f.getValue("C_UOM_ID")), y = a.toString().concat(",", ut.toString(), ",", ot.toString(), ",", b, ",", g.toString(), ",", st.toString(), ",", null, ",", ct.toString(), ",", ht.toString(), ",", v, ",", r), l = null; if (l = n.dataContext.getJSONRecord("MProductPricing/GetProductPricing", y), lt = null, nt = n.dataContext.getJSONRecord("MCurrency/GetCurrency", l.C_Currency_ID), f.setValue("PriceList", l.PriceList), f.setValue("PriceLimit", l.PriceLimit), f.setValue("PriceActual", t.getValueOfDecimal(l.PriceActual.toFixed(nt))), f.setValue("PriceEntered", t.getValueOfDecimal(l.PriceEntered.toFixed(nt))), f.setValue("C_Currency_ID", t.getValueOfInt(l.C_Currency_ID)), f.setValue("PrintDescription", l.DocumentNote), r <= 0 && f.setValue("C_UOM_ID", t.getValueOfInt(l.C_UOM_ID)), r > 0 && c > 0 && b == !1) { var y = a.toString(), v = n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID", y), g = t.getValueOfInt(d.M_PriceList_ID), tt = n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID", g.toString()), ft = n.dataContext.getJSONRecord("MUOM/GetPrecision", v.toString()), k = n.dataContext.getJSONRecord("MBPartner/GetBPartner", ut.toString()); sql = "SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = " + t.getValueOfInt(f.getValue("M_Product_ID")) + " AND M_PriceList_Version_ID = " + tt + " AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID=" + c; p = n.DB.executeDataSet(sql); p.getTables().length > 0 && (p.getTables()[0].getRows().length > 0 ? (y = a.toString().concat(",", i.getAD_Client_ID().toString(), ",", p.getTables()[0].getRows()[0].getCell("PriceStd").toString(), ",", k.M_DiscountSchema_ID.toString(), ",", k.FlatDiscount.toString(), ",", f.getValue("QtyEntered").toString()), it = t.getValueOfDecimal(n.dataContext.getJSONRecord("MOrderLine/FlatDiscount", y)), f.setValue("PriceList", t.getValueOfDecimal(p.getTables()[0].getRows()[0].getCell("PriceList"))), f.setValue("PriceLimit", t.getValueOfDecimal(p.getTables()[0].getRows()[0].getCell("PriceLimit"))), f.setValue("PriceActual", it), f.setValue("PriceEntered", it), sql = "SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.M_Product_ID = " + t.getValueOfInt(f.getValue("M_Product_ID")) + " AND con.C_UOM_ID = " + v + " AND con.C_UOM_To_ID = " + c, h = t.getValueOfDecimal(n.DB.executeScalar(sql)), h == 0 && (sql = "SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = " + v + " AND con.C_UOM_To_ID = " + c, h = t.getValueOfDecimal(n.DB.executeScalar(sql))), v == c && h == 0 && (h = 1), f.setValue("QtyInvoiced", t.getValueOfDecimal(f.getValue("QtyEntered")).toFixed(ft) * h)) : (sql = "SELECT PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = " + t.getValueOfInt(f.getValue("M_Product_ID")) + " AND M_PriceList_Version_ID = " + tt + " AND M_AttributeSetInstance_ID = 0 AND C_UOM_ID=" + v, et = t.getValueOfDecimal(n.DB.executeScalar(sql)), sql = "SELECT PriceStd FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = " + t.getValueOfInt(f.getValue("M_Product_ID")) + " AND M_PriceList_Version_ID = " + tt + " AND M_AttributeSetInstance_ID = 0 AND C_UOM_ID=" + v, w = t.getValueOfDecimal(n.DB.executeScalar(sql)), y = a.toString().concat(",", i.getAD_Client_ID().toString(), ",", w.toString(), ",", k.M_DiscountSchema_ID.toString(), ",", k.FlatDiscount.toString(), ",", f.getValue("QtyEntered").toString()), w = t.getValueOfDecimal(n.dataContext.getJSONRecord("MOrderLine/FlatDiscount", y)), sql = "SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.M_Product_ID = " + t.getValueOfInt(f.getValue("M_Product_ID")) + " AND con.C_UOM_ID = " + v + " AND con.C_UOM_To_ID = " + c, h = t.getValueOfDecimal(n.DB.executeScalar(sql)), h == 0 && (sql = "SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = " + v + " AND con.C_UOM_To_ID = " + c, h = t.getValueOfDecimal(n.DB.executeScalar(sql))), f.setValue("PriceList", et * h), f.setValue("PriceActual", w * h), f.setValue("PriceEntered", w * h), h == 0 && (h = 1), f.setValue("QtyInvoiced", t.getValueOfDecimal(f.getValue("QtyEntered")).toFixed(ft) * h))) } i.setContext(u, "EnforcePriceLimit", l.IsEnforcePriceLimit ? "Y" : "N"); i.setContext(u, "DiscountSchema", l.IsDiscountSchema ? "Y" : "N") } catch (at) { this.setCalloutActive(!1); this.log.severe(at.toString()) } return this.setCalloutActive(!1), s = null, this.Tax(i, u, f, e, o) }; o.prototype.Charge = function (i, r, u, f, e, o) { var h, c, l, s; if (e == null || e.toString() == "") return u.setValue("VA038_AmortizationTemplate_ID", 0), ""; s = null; try { if (h = e, h == null || h == 0) return ""; if (u.getValue("M_Product_ID") != null) return u.setValue("C_Charge_ID", null), "ChargeExclusively"; u.setValue("M_AttributeSetInstance_ID", null); u.setValue("S_ResourceAssignment_ID", null); c = i.getContextAsInt("#C_UOM_ID"); c > 0 ? u.setValue("C_UOM_ID", c) : u.setValue("C_UOM_ID", 100); i.setContext(r, "DiscountSchema", "N"); l = n.dataContext.getJSONRecord("MInvoice/GetPercision", u.getValue("C_Invoice_ID").toString()); s = n.dataContext.getJSONRecord("MCharge/GetChargeDetails", h.toString()); s != null && (u.setValue("PriceEntered", t.getValueOfDecimal(s.ChargeAmt).toFixed(l)), u.setValue("PrintDescription", t.getValueOfString(s.PrintDescription)), u.setValue("PriceActual", t.getValueOfDecimal(s.ChargeAmt).toFixed(l)), u.setValue("PriceLimit", 0), u.setValue("PriceList", 0), u.setValue("Discount", 0)); u.setValue("PriceLimit", n.Env.ZERO); u.setValue("PriceList", n.Env.ZERO); u.setValue("Discount", n.Env.ZERO) } catch (a) { return this.setCalloutActive(!1), a.message } return o = null, this.Tax(i, r, u, f, e) }; o.prototype.Tax = function (i, r, u, f, e, o) { var y, p, l, h, c, w, a, b, k, d, nt, v; if (e == null || e.toString() == "") return ""; y = f.getColumnName(); try { var g = "", tt = t.getValueOfString(u.getValue("C_Invoice_ID")).concat(",", t.getValueOfString(u.getValue("M_Product_ID")) + "," + t.getValueOfString(u.getValue("C_Charge_ID"))), s = n.dataContext.getJSONRecord("MInvoice/GetTax", tt), it = t.getValueOfInt(s._CountVATAX), ut = i.getWindowContext(r, "IsSOTrx", !0) == "Y"; if (it > 0 && (g = t.getValueOfString(s.taxRule)), g == "T") if (p = t.getValueOfInt(s.taxId), p > 0) u.setValue("C_Tax_ID", p); else { if (t.getValueOfInt(u.getValue("M_Product_ID")) > 0) return u.setValue("M_Product_ID", ""), this.setCalloutActive(!1), s.TaxExempt == "Y" ? n.ADialog.info("TaxNoExemptFound") : n.ADialog.info("VATAX_DefineTax"); if (t.getValueOfInt(u.getValue("C_Charge_ID")) > 0) return u.setValue("C_Charge_ID", ""), this.setCalloutActive(!1), s.TaxExempt == "Y" ? n.ADialog.info("TaxNoExemptFound") : n.ADialog.info("VATAX_DefineChargeTax") } else { if ((l = 0, l = y.toString() == "M_Product_ID" ? e : i.getContextAsInt(r, "M_Product_ID"), h = 0, h = y.toString() == "C_Charge_ID" ? e : i.getContextAsInt(r, "C_Charge_ID"), this.log.fine("Product=" + l + ", C_Charge_ID=" + h), l == 0 && h == 0) || (c = i.getContextAsInt(r, "C_BPartner_Location_ID"), c == 0)) return this.Amt(i, r, u, f, e); this.log.fine("Ship BP_Location=" + c); w = c; this.log.fine("Bill BP_Location=" + w); a = i.getContext("DateInvoiced"); this.log.fine("Bill Date=" + a); b = a; this.log.fine("Ship Date=" + b); k = i.getContextAsInt(r, "AD_Org_ID"); this.log.fine("Org=" + k); d = i.getContextAsInt("#M_Warehouse_ID"); this.log.fine("Warehouse=" + d); nt = h.toString().concat(",", a.toString(), b.toString(), ",", k.toString(), ",", d.toString(), ",", w.toString(), ",", c.toString(), ",", i.getWindowContext(r, "IsSOTrx", !0).equals("Y")); v = t.getValueOfInt(n.dataContext.getJSONRecord("MTax/Get", nt)); this.log.info("Tax ID=" + v); v == 0 || u.setValue("C_Tax_ID", v) } } catch (rt) { this.setCalloutActive(!1); this.log.severe(rt.toString()) } return o = null, this.Amt(i, r, u, f, e) }; o.prototype.Amt = function (u, f, e, o, s, h) { var ft, rt, nt, tt, c, l, k, ot, p, lt, it, at, st, wt, bt, vt, d, a, y, v, w, ni, et, pt; if (this.isCalloutActive() || s == null || s.toString() == "") return ""; this.setCalloutActive(!0); try { this.log.log(i.WARNING, "amt - init"); var b = u.getContextAsInt(f, "C_UOM_ID"), g = u.getContextAsInt(f, "M_Product_ID"), ct = u.getContextAsInt(f, "M_PriceList_ID"), y = ct.toString(), a; a = n.dataContext.getJSONRecord("MPriceList/GetPriceList", y); ft = 2; rt = 2; a != null && (rt = a.StdPrecision, ft = a.PriceListPrecision); lt = t.getValueOfInt(e.getValue("C_OrderLine_ID")); nt = e.getValue("QtyEntered"); tt = e.getValue("QtyInvoiced"); this.log.fine("QtyEntered=" + nt + ", Invoiced=" + tt + ", UOM=" + b); c = e.getValue("PriceEntered"); l = e.getValue("PriceActual"); k = e.getValue("PriceLimit"); p = e.getValue("PriceList"); this.log.fine("PriceList=" + p + ", Limit=" + k + ", Precision=" + ft); this.log.fine("PriceEntered=" + c + ", Actual=" + l); o.getColumnName() == "QtyEntered" && r > 0 && (it = u.getContextAsInt(f, "C_BPartner_ID", !1), lt == 0 && (y = g.toString().concat(",", e.getValue("C_Invoice_ID").toString() + "," + t.getValueOfString(e.getValue("M_AttributeSetInstance_ID")) + "," + b.toString() + "," + u.getAD_Client_ID().toString() + "," + it.toString() + "," + nt.toString()), v = n.dataContext.getJSONRecord("MInvoice/GetPrices", y), v != null && (p = v.PriceList, e.setValue("PriceList", p), c = v.PriceEntered, e.setValue("PriceLimit", v.PriceLimit), l = c, e.setValue("PriceActual", l), e.setValue("PriceEntered", c)))); (o.getColumnName() == "QtyInvoiced" || o.getColumnName() == "QtyEntered" || o.getColumnName() == "M_Product_ID") && !1 == u.getContext("DiscountSchema") ? (it = u.getContextAsInt(f, "C_BPartner_ID"), o.getColumnName() == "QtyEntered" && (y = g.toString().concat(",", b.toString(), ",", nt.toString()), tt = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", y)), tt == null && (tt = nt), at = u.getWindowContext(f, "IsSOTrx", !0) == "Y", st = e.getValue("DateInvoiced"), r = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'")), wt = n.dataContext.getJSONRecord("MInvoice/GetInvoice", e.getValue("C_Invoice_ID").toString()), bt = wt.M_PriceList_ID.toString().concat(",", e.getValue("C_Invoice_ID").toString(), ",", g.toString(), ",", b.toString(), ",", t.getValueOfString(e.getValue("M_AttributeSetInstance_ID")), ",", "2"), vt = n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID", bt), lt == 0 && (d = st == null ? g.toString().concat(",", it.toString(), ",", tt.toString(), ",", at, ",", ct.toString(), ",", vt.toString(), ",", st, ",", null, ",", b.toString(), ",", r) : g.toString().concat(",", it.toString(), ",", tt.toString(), ",", at, ",", ct.toString(), ",", vt.toString(), ",", st.toString(), ",", null, ",", b.toString(), ",", r), a = null, a = n.dataContext.getJSONRecord("MProductPricing/GetProductPricing", d), r <= 0 ? (y = g.toString().concat(",", b.toString(), ",", l.toString()), c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", y)) : (d = g.toString().concat(",", e.getValue("C_Invoice_ID").toString() + "," + t.getValueOfString(e.getValue("M_AttributeSetInstance_ID")) + "," + b.toString() + "," + u.getAD_Client_ID().toString() + "," + it.toString() + "," + nt.toString()), v = n.dataContext.getJSONRecord("MInvoice/GetPrices", d), v != null && (p = v.PriceList, e.setValue("PriceList", p), c = v.PriceEntered, e.setValue("PriceLimit", v.PriceLimit))), c == null && (c = a.PriceStd), this.log.fine("amt - QtyChanged -> PriceActual=" + a.PriceStd + ", PriceEntered=" + c + ", Discount=" + a.Discount), l = r <= 0 ? a.PriceStd : c, e.setValue("PriceActual", l), e.setValue("PriceEntered", c)), u.setContext(f, "DiscountSchema", a.IsDiscountSchema ? "Y" : "N")) : o.getColumnName() == "PriceActual" ? (l = t.getValueOfDecimal(s.toFixed(ft)), c = l, this.log.fine("amt - PriceActual=" + l + " -> PriceEntered=" + c), e.setValue("PriceEntered", c), e.SetValue("PriceActual", l)) : o.getColumnName() == "PriceEntered" && (c = t.getValueOfDecimal(s.toFixed(ft)), l = c, l == null && (l = c), this.log.fine("amt - PriceEntered=" + c + " -> PriceActual=" + l), e.setValue("PriceActual", l), e.setValue("PriceEntered", c)); var kt = !1, ut = u.getContext("EnforcePriceLimit"), ht = u.isSOTrx() && ut != null && ut == "Y"; if (ut == "") { var d = t.getValueOfInt(e.getValue("C_Invoice_ID")).toString(), dt = n.dataContext.getJSONRecord("MInvoice/GetInvoice", d), yt = "SELECT EnforcePriceLimit FROM M_PriceList WHERE IsActive = 'Y' AND M_PriceList_ID = " + dt.M_PriceList_ID; ut = n.DB.executeScalar(yt); ht = dt.IsSOTrx && ut != null && ut == "Y"; yt = "SELECT OverwritePriceLimit FROM AD_Role WHERE IsActive = 'Y' AND AD_Role_ID = " + u.getContext("#AD_Role_ID"); kt = t.getValueOfBoolean(n.DB.executeScalar(yt)) } if (ht && kt && (ht = !1), ht && t.getValueOfDouble(k) != 0 && l.compareTo(k) < 0 && (l = k, c = l, c == null && (c = k), this.log.fine("amt =(under) PriceEntered=" + c + ", Actual" + k), e.setValue("PriceActual", k), e.setValue("PriceEntered", c), n.ADialog.info("UnderLimitPrice"), t.getValueOfInt(p) != 0 && (ot = (p - l) / p * 100, t.scale(ot) > 2 && (ot = ot.toFixed(2)))), c = t.getValueOfDecimal(e.getValue("PriceEntered")), w = nt * c, t.scale(w) > rt && (w = t.getValueOfDecimal(w.toFixed(rt))), this.log.info("amt = LineNetAmt=" + w), e.setValue("LineNetAmt", w), ni = "Y" == u.getWindowContext(f, "IsSOTrx", !0), et = n.Env.ZERO, o.getColumnName() == "TaxAmt") et = e.getValue("TaxAmt"); else if (pt = e.getValue("C_Tax_ID"), pt != null) { var ti = pt, gt = this.IsTaxIncluded(f, u), d = ti.toString().concat(",", w.toString(), ",", gt, ",", rt.toString()), a = null; et = n.dataContext.getJSONRecord("MTax/CalculateTax", d); e.setValue("TaxAmt", et); e.getField("SurchargeAmt") != null && e.setValue("SurchargeAmt", 0) } gt ? e.setValue("LineTotalAmt", t.getValueOfDecimal(w)) : e.setValue("LineTotalAmt", t.getValueOfDecimal((w + et).toFixed(rt))) } catch (ii) { this.setCalloutActive(!1); this.log.severe(ii.toString()) } return this.setCalloutActive(!1), u = f = e = o = s = h = null, "" }; o.prototype.IsTaxIncluded = function (t, i) { var r = i.getContext("IsTaxIncluded"), u; try { if (r.toString().length == 0) { if (u = i.getContextAsInt(t, "M_PriceList_ID"), u == 0) return !1; r = n.DB.executeScalar("SELECT IsTaxIncluded FROM M_PriceList WHERE M_PriceList_ID=" + u, null, null).toString(); r == null && (r = "N"); i.setContext(t, "IsTaxIncluded", r) } } catch (f) { this.setCalloutActive(!1); this.log.severe(f.toString()) } return i = t = mTab = mField = value = oldValue = null, "Y" == r }; o.prototype.Qty = function (u, f, e, o, s, h) { var p, w, l, c, nt, b, it, ot, k, rt, ut, ft, et, v, d, a, y; if (s == null || s.toString() == "" || this.isCalloutActive() || s == null) return ""; this.setCalloutActive(!0); try { if (p = "", w = u.getContextAsInt(f, "M_Product_ID"), this.log.log(i.WARNING, "qty - init - M_Product_ID=" + w), w == 0) c = e.getValue("QtyEntered"), e.setValue("QtyInvoiced", c); else if (o.getColumnName().toString().equals("C_UOM_ID") || o.getColumnName().toString().equals("M_AttributeSetInstance_ID")) a = t.getValueOfInt(e.getValue("C_UOM_ID")), c = e.getValue("QtyEntered"), it = u.getContextAsInt(f, "C_BPartner_ID", !1), ot = n.dataContext.getJSONRecord("MBPartner/GetBPartner", it.toString()), p = w.toString().concat(",", e.getValue("C_Invoice_ID").toString() + "," + t.getValueOfString(e.getValue("M_AttributeSetInstance_ID")) + "," + a.toString() + "," + u.getAD_Client_ID().toString() + "," + it.toString() + "," + c.toString()), k = n.dataContext.getJSONRecord("MInvoice/GetPrices", p), k != null && (r = k.countEd011, rt = k.countVAPRC, r <= 0 && rt <= 0 ? (v = null, c != null && (p = a.toString(), d = n.dataContext.getJSONRecord("MUOM/GetPrecision", p), v = c.toFixed(d)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + a + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), p = w.toString().concat(",", a.toString(), ",", c.toString()), l = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", p), l == null && (l = c), y = c != l, nt = e.getValue("PriceActual"), p = w.toString().concat(",", a.toString(), ",", nt.toString()), b = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", p), b == null && (b = nt), this.log.fine("qty - UOM=" + a + ", QtyEntered/PriceActual=" + c + "/" + nt + " -> " + y + " QtyInvoiced/PriceEntered=" + l + "/" + b), u.setContext(f, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyInvoiced", l), e.setValue("PriceEntered", b)) : (ut = k.PriceList, e.setValue("PriceList", ut), b = k.PriceEntered, e.setValue("PriceLimit", k.PriceLimit), e.setValue("PriceActual", b), e.setValue("PriceEntered", b), p = a.toString().concat(","), ft = n.dataContext.getJSONRecord("MUOM/GetPrecision", p), v = c.toFixed(t.getValueOfInt(ft)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + a + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), p = w.toString().concat(",", a.toString(), ",", c.toString()), et = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", p), l = et, y = !1, l != null && (y = c != l), l == null && (y = !1, l = 1), y ? e.setValue("QtyInvoiced", l) : e.setValue("QtyInvoiced", l * v))); else if (o.getColumnName().equals("QtyEntered")) a = u.getContextAsInt(f, "C_UOM_ID"), c = s, v = null, c != null && (d = n.dataContext.getJSONRecord("MUOM/GetPrecision", a.toString()), v = c.toFixed(d)), c != v && (this.log.fine("Corrected QtyEntered Scale UOM=" + a + "; QtyEntered=" + c + "->" + v), c = v, e.setValue("QtyEntered", c)), g = w.toString().concat(",", a.toString(), ",", c.toString()), l = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", g), l == null && (l = c), y = c != l, this.log.fine("qty - UOM=" + a + ", QtyEntered=" + c + " -> " + y + " QtyInvoiced=" + l), u.setContext(f, "UOMConversion", y ? "Y" : "N"), e.setValue("QtyInvoiced", l); else if (o.getColumnName().equals("QtyInvoiced")) { a = u.getContextAsInt(f, "C_UOM_ID"); l = s; var g = w.toString(), d = n.dataContext.getJSONRecord("MProduct/GetUOMPrecision", g), tt = null; l != null && (tt = t.getValueOfDecimal(l.toFixed(d))); l != tt && (this.log.fine("Corrected QtyInvoiced Scale " + l + "->" + tt), l = tt, e.setValue("QtyInvoiced", l)); g = w.toString().concat(",", a.toString(), ",", l.toString()); c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", g); c == null && (c = l); y = l != c; this.log.fine("qty - UOM=" + a + ", QtyInvoiced=" + l + " -> " + y + " QtyEntered=" + c); u.setContext(f, "UOMConversion", y ? "Y" : "N"); e.setValue("QtyEntered", c) } } catch (st) { this.setCalloutActive(!1); this.log.severe(st.toString()) } finally { this.setCalloutActive(!1) } return u = f = e = o = s = h = null, "" }; o.prototype.PriceList = function (r, u, f, e, o, s) { var l = "", h = null, c, a, v; try { if (o == null || o.toString() == "" || (c = t.getValueOfInt(o.toString()), c == null || c == 0)) return ""; l = "SELECT pl.IsTaxIncluded,pl.EnforcePriceLimit,pl.C_Currency_ID,c.StdPrecision,plv.M_PriceList_Version_ID,plv.ValidFrom FROM M_PriceList pl,C_Currency c,M_PriceList_Version plv WHERE pl.C_Currency_ID=c.C_Currency_ID AND pl.M_PriceList_ID=plv.M_PriceList_ID AND pl.M_PriceList_ID=" + c + "ORDER BY plv.ValidFrom DESC"; h = n.DB.executeReader(l); h.read() && (f.setValue("IsTaxIncluded", Boolean("Y".equals(h.get("istaxincluded")))), r.setContext(u, "EnforcePriceLimit", h.get("enforcepricelimit")), a = t.getValueOfInt(h.get("c_currency_id")), f.setValue("C_Currency_ID", a), v = t.getValueOfInt(h.get("m_pricelist_version_id")), r.setContext(u, "M_PriceList_Version_ID", v)); h.close() } catch (y) { return this.setCalloutActive(!1), h != null && h.close(), this.log.log(i.severe, l, y), y.message } return r = u = f = e = o = s = null, "" }; o.prototype.CheckDueDate = function (t, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; if (r.getValue("DateInvoiced") == null || r.getValue("DateInvoiced") == "") return this.setCalloutActive(!1), ""; try { if (this.setCalloutActive(!0), r.getValue("DateInvoiced") != null && r.getValue("DueDate") != null) { var o = new Date(r.getValue("DateInvoiced")), s = new Date(r.getValue("DueDate")); s < o && (n.ADialog.error("DueDateLessThanInvoiceDate"), r.setValue("DueDate", "")) } t = i = r = u = f = e = null; this.setCalloutActive(!1) } catch (h) { return this.setCalloutActive(!1), h } return "" }; n.Model.CalloutInvoice = o; n.Utility.inheritPrototype(p, n.CalloutEngine); p.prototype.Date = function (n, t, i, r, u, f) { return u == null || u.toString() == "" ? "" : (i.setValue("DateAcct", u), this.SetDocumentNo(n, t, i), n = t = i = r = u = f = null, "") }; p.prototype.BPartner = function (r, u, f, e, o, s) { var l, c, p, a, w, v, b, g, nt; if (o == null || o.toString() == "" || (l = t.getValueOfInt(o), l == null || l == 0)) return ""; var k = "SELECT p.AD_Language,p.C_PaymentTerm_ID, COALESCE(p.M_PriceList_ID,g.M_PriceList_ID) AS M_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted, p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable, l.C_BPartner_Location_ID,c.AD_User_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID FROM C_BPartner p INNER JOIN C_BP_Group g ON (p.C_BP_Group_ID=g.C_BP_Group_ID) LEFT OUTER JOIN C_BPartner_Location l ON (p.C_BPartner_ID=l.C_BPartner_ID AND l.IsBillTo='Y' AND l.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID=@Param1 AND p.IsActive='Y'", y = r.isSOTrx(), d = [], h = null; try { d[0] = new n.DB.SqlParam("@Param1", l); h = n.DB.executeReader(k, d, null); h.read() && (c = t.getValueOfString(h.get(y ? "paymentrule" : "paymentrulepo")), c != null && c.length != 0 && (r.getContext("DocBaseType").endsWith("C") ? c = "P" : (this.isSOTrx && c == "S" || c == "U") && (c = "P")), p = t.getValueOfInt(h.get(y ? "c_paymentterm_id" : "po_paymentterm_id")), p > 0 && f.setValue("C_PaymentTerm_ID", p), a = t.getValueOfInt(h.get("c_bpartner_location_id")), l.toString().equals(r.getContext("C_BPartner_ID")) && (w = r.getContext("C_BPartner_Location_ID"), w.toString().length > 0 && (a = t.getValueOfInt(w))), a == 0 ? f.setValue("C_BPartner_Location_ID", null) : f.setValue("C_BPartner_Location_ID", t.getValueOfInt(a)), v = t.getValueOfInt(h.get("ad_user_id")), l.toString().equals(r.getContext("C_BPartner_ID")) && (b = r.getContext("AD_User_ID"), b.toString().length > 0 && (v = t.getValueOfInt(b))), v == 0 ? f.setValue("AD_User_ID", null) : f.setValue("AD_User_ID", t.getValueOfInt(v)), y && (g = t.getValueOfDouble(h.get("so_creditlimit")), g != 0 && (nt = t.getValueOfDouble(h.get("creditavailable")), h == null && nt < 0 && n.ADialog.info("CreditLimitOver")))); h.close() } catch (tt) { return this.setCalloutActive(!1), h != null && h.close(), this.log.log(i.severe, k, tt), tt.message } return this.SetDocumentNo(r, u, f), s = null, this.Tax(r, u, f, e, o) }; p.prototype.DocType = function (n, t, i, r, u, f) { return this.SetDocumentNo(n, t, i), n = t = i = r = u = f = null, "" }; p.prototype.SetDocumentNo = function (i, r, u, f, e, o) { var w = i.getContextAsInt(r, "C_InvoiceBatch_ID"), b = "SELECT COALESCE(MAX(C_InvoiceBatchLine_ID),0) FROM C_InvoiceBatchLine WHERE C_InvoiceBatch_ID=" + w, l = n.DB.executeScalar(b), a, s, v, y, c, h, p; l != 0 && (a = l.toString(), s = null, s = n.dataContext.getJSONRecord("MInvoiceBatchLine/GetInvoiceBatchLine", a), v = i.getContextAsInt(r, "C_DocType_ID"), y = i.getContextAsInt(r, "C_BPartner_ID"), v != s.C_DocType_ID || y != s.C_BPartner_ID) && (c = s.DocumentNo, c != null) && (h = 0, h = t.getValueOfInt(c), h != 0) && (p = t.getValueOfString(h + 1), u.setValue("DocumentNo", p), i = r = u = f = e = o = null) }; p.prototype.Charge = function (r, u, f, e, o, s) { var c; if (o == null || o.toString() == "" || (c = t.getValueOfInt(o), c == null || t.getValueOfInt(c) == 0)) return ""; var l = "SELECT ChargeAmt FROM C_Charge WHERE C_Charge_ID=@Param1", a = [], h = null; try { a[0] = new n.DB.SqlParam("@Param1", c); h = n.DB.executeReader(l, a, null); h.read() && f.setValue("PriceEntered", t.getValueOfDecimal(h.get(0))); h.close() } catch (v) { return this.setCalloutActive(!1), h != null && h.close(), this.log.log(i.severe, l, v), v.message } return s = null, this.Tax(r, u, f, e, o) }; p.prototype.Tax = function (i, r, u, f, e) { var p = f.getColumnName(), o, s, h, c, l, a, y, v; return e == null || e.toString() == "" ? "" : (o = 0, o = p.equals("C_Charge_ID") ? t.getValueOfInt(e) : i.getContextAsInt(r, "C_Charge_ID"), this.log.fine("C_Charge_ID=" + o), o == 0) ? this.Amt(i, r, u, f, e) : (s = i.getContextAsInt(r, "C_BPartner_Location_ID"), s == 0) ? this.Amt(i, r, u, f, e) : (this.log.fine("BP_Location=" + s), h = t.getValueOfDate(i.getContext("DateInvoiced")), this.log.fine("Bill Date=" + h), c = h, this.log.fine("Ship Date=" + c), l = i.getContextAsInt(r, "AD_Org_ID"), this.log.fine("Org=" + l), a = i.getContextAsInt("#M_Warehouse_ID"), this.log.fine("Warehouse=" + a), y = o.toString().concat(",", h.toString(), c.toString(), ",", l.toString(), ",", a.toString(), ",", s.toString(), ",", s.toString(), ",", i.getWindowContext(r, "IsSOTrx", !0).equals("Y")), v = n.dataContext.getJSONRecord("MTax/Get", y), v == 0 || u.setValue("C_Tax_ID", t.getValueOfInt(v)), this.Amt(i, r, u, f, e)) }; p.prototype.Amt = function (i, r, u, f, e, o) { var s, v, h, y; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); var a = i.getStdPrecision(), c = t.getValueOfDecimal(u.getValue("QtyEntered")), l = t.getValueOfDecimal(u.getValue("PriceEntered")); if (this.log.fine("QtyEntered=" + c + ", PriceEntered=" + l), c == null && (c = n.Env.ZERO), l == null && (l = n.Env.ZERO), s = c * l, t.scale(s) > a && (s = s.toFixed(a)), v = "Y" == i.getContext("IsTaxIncluded"), h = null, f.getColumnName().equals("TaxAmt")) h = u.getValue("TaxAmt"); else if (y = u.getValue("C_Tax_ID"), y != null) { var p = t.getValueOfInt(y), w = p.toString().concat(",", s.toString(), ",", v.toString(), ",", a.toString()); h = n.dataContext.getJSONRecord("MTax/CalculateTax", w); u.setValue("TaxAmt", h); u.getField("SurchargeAmt") != null && u.setValue("SurchargeAmt", 0) } return v ? (u.setValue("LineTotalAmt", s), u.setValue("LineNetAmt", t.getValueOfDecimal(s) * t.getValueOfDecimal(h))) : (u.setValue("LineNetAmt", s), u.setValue("LineTotalAmt", t.getValueOfDecimal(s) + t.getValueOfDecimal(h))), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutInvoiceBatch = p; n.Utility.inheritPrototype(ai, n.CalloutEngine); ai.prototype.Product = function (r, u, f, e, o, s) { var h, c, l, a, y, p, v; if (o == null || o.toString() == "") return t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(*) FROM AD_column WHERE ad_table_id =  (SELECT ad_table_id   FROM ad_table   WHERE upper(tablename) = upper('M_MovementLine')) and upper(columnname) = 'C_UOM_ID'", null, null)) > 0 && (f.setValue("MovementQty", 1), f.setValue("QtyEntered", 1)), ""; if (this.isCalloutActive()) return ""; this.setCalloutActive(!0); try { if (h = o, h == null || h == 0) return ""; f.setValue("M_AttributeSetInstance_ID", null); c = "SELECT COUNT(*) FROM AD_column WHERE ad_table_id =  (SELECT ad_table_id   FROM ad_table   WHERE upper(tablename) = upper('M_MovementLine')) and upper(columnname) = 'C_UOM_ID'"; t.getValueOfInt(n.DB.executeScalar(c, null, null)) > 0 && (c = "select c_uom_id from m_product where m_product_id=" + h, l = t.getValueOfInt(n.DB.executeScalar(c, null, null)), f.setValue("C_UOM_ID", l), o != s && (f.setValue("MovementQty", 1), f.setValue("QtyEntered", 1)), l = t.getValueOfDecimal(f.getValue("C_UOM_ID")), a = t.getValueOfDecimal(f.getValue("QtyEntered")), h = t.getValueOfInt(f.getValue("M_Product_ID")), y = h.toString().concat(",").concat(l.toString()).concat(",").concat(a.toString()), p = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", y), QtyOrdered = p, v = !1, QtyOrdered != null && (v = a != QtyOrdered), QtyOrdered == null && (v = !1, QtyOrdered = 1), v ? f.setValue("MovementQty", QtyOrdered) : f.setValue("MovementQty", QtyOrdered * a)) } catch (w) { return this.setCalloutActive(!1), this.log.log(i.severe, c, w), w.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; n.Model.CalloutMovement = ai; n.Utility.inheritPrototype(vi, n.CalloutEngine); vi.prototype.Objectchk = function (i, r, u, f, o, s) { var y, a, v, c, w, h, p, l; if (o == null || o.toString() == "" || o == null || (y = t.getValueOfInt(u.getValue("FO_OBJECT_DATA_ID")), c = t.getValueOfDateTime(u.getValue("TODAYDATE")), y == null)) return ""; w = "select FO_RES_ACCOMODATION_ID,DATE_FROM,TILL_DATE from FO_RES_ACCOMODATION where FO_OBJECT_DATA_ID=@FO_OBJ_DATA_ID"; h = null; try { for (p = [], p[0] = new n.DB.SqlParam("@FO_OBJ_DATA_ID", y), h = n.DB.executeReader(w, p, null); h.read();) { if ((a = t.getValueOfDateTime(h[1]), v = t.getValueOfDateTime(h[2]), l = a, c.compareTo(v) > 0) || c.compareTo(a) < 0) return u.setValue("RES_STATUS", !1), ""; if (c.compareTo(a) > 0 && c.compareTo(v) < 0) while (!(l.compareTo(v) == 0)) c.compareTo(l) == 0 && u.setValue("RES_STATUS", !0), l = l.AddDays(1) } h.close() } catch (b) { this.setCalloutActive(!1); h != null && h.close(); this.log.severe(e.toString()) } finally { h != null && h.close() } return i = r = u = f = o = s = null, "" }; n.Model.CalloutObjectData = vi; n.Utility.inheritPrototype(wt, n.CalloutEngine); wt.prototype.Datechk = function (i, r, u, f, e, o) { var c, v, y, p, h, w; if (e == null || e.toString() == "" || (c = t.getValueOfDateTime(e), c == null || c == 0)) return ""; var b = u.getValue("AD_ORG_ID"), l = 0, k = "select  DAYSPAYABLE2 from FO_SETTINGS where AD_ORG_ID=" + b, s = null; try { for (s = n.DB.executeReader(k, null, null); s.read();)l = t.getValueOfInt(s[0].toString()); s.close() } catch (a) { this.setCalloutActive(!1); s != null && s.close(); this.log.severe(a.toString()) } v = t.getValueOfDateTime(u.getValue("DATE1")); y = v.AddDays(l); u.setValue("DATE2", y); h = 100; w = "select max(OFFERNO)from FO_OFFER"; try { for (s = n.DB.executeReader(w, null, null); s.read();)h = t.getValueOfInt(s[0].toString()); s.close() } catch (a) { this.setCalloutActive(!1); s != null && s.close(); this.log.severe(a.toString()) } finally { s != null && s.close() } return p = h == null | h == 0 ? 100 : h + 1, u.setValue("OFFERNO", p), i = r = u = f = e = o = null, "" }; wt.prototype.guestpricelist = function (i, r, u, f, e, o) { var h; if (e == null || (h = t.getValueOfInt(e), h == null || h == 0)) return ""; var l = "select FO_PRICE_LIST_ID from FO_ADDRESS_PRICE where FO_ADDRESS_ID=" + h, c = 0, s = null; try { for (s = n.DB.executeReader(l, null, null); s.read();)c = t.getValueOfInt(s[0]); s.close() } catch (a) { this.setCalloutActive(!1); s != null && s.close(); this.log.severe(a.toString()) } finally { s != null && s.close() } return u.setValue("FO_PRICE_LIST_ID", c), i = r = u = f = e = o = null, "" }; n.Model.CalloutOffer = wt; n.Utility.inheritPrototype(rt, n.CalloutEngine); rt.prototype.Period = function (i, r, u, f, e, o) { var s, h, a, l; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; s = f.getColumnName(); this.setCalloutActive(!0); var y = i.getContextAsInt(r, "AD_Client_ID", !1), p = t.getValueOfInt(u.getValue("AD_Org_ID")), c = new Date; if (c = s == "DateAcct" ? e : u.getValue("DateAcct"), h = 0, s == "C_Period_ID" && (h = t.getValueOfInt(e)), s == "DateDoc") u.setValue("DateAcct", e); else if (s == "DateAcct" || s == "AD_Org_ID") a = y + "," + c + "," + p, h = t.getValueOfInt(n.dataContext.getJSONRecord("MPeriod/GetPeriod", a)), h != 0 && u.setValue("C_Period_ID", h); else if (l = n.dataContext.getJSONRecord("MPeriod/GetPeriodDetail", h.toString()), l != null) { var w = l.PeriodType, b = l.StartDate, v = l.EndDate; w == "S" && (c == null || c < b || c > v) && u.setValue("DateAcct", v) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; rt.prototype.Rate = function (r, u, f, o, s, h) { var a; if (s == null || s.toString() == "") return ""; try { var v = t.getValueOfInt(f.getValue("C_Currency_ID")), y = t.getValueOfInt(v), p = t.getValueOfInt(f.getValue("C_ConversionType_ID")), w = t.getValueOfInt(p), l = f.getValue("DateAcct"); l == null && (a = new Date, l = a.toGMTString()); var b = t.getValueOfInt(r.getContextAsInt(u, "C_AcctSchema_ID", !1)), k = b, d = n.dataContext.getJSONRecord("MAcctSchema/GetAcctSchema", k), g = t.getValueOfInt(r.getContextAsInt(u, "AD_Client_ID", !1)), nt = t.getValueOfInt(r.getContextAsInt(u, "AD_Org_ID", !1)), tt = y + "," + d.C_Currency_ID + "," + l + "," + w + "," + g + "," + nt, c = n.dataContext.getJSONRecord("MConversionRate/GetRate", tt); this.log.fine("rate = " + c); c == null && (c = 0); f.setValue("CurrencyRate", c) } catch (it) { return this.log.log(i.SEVERE, sql, e), this.setCalloutActive(!1), e.message } return r = u = f = o = s = h = null, "" }; rt.prototype.Amt = function (i, r, u, f, e, o) { var h, c, l, a; if (e == null || e.toString() == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); var y = t.getValueOfInt(i.getContextAsInt(r, "C_AcctSchema_ID")), p = y.toString(), w = n.dataContext.getJSONRecord("MAcctSchema/GetAcctSchema", p), v = w.StdPrecision, s = u.getValue("CurrencyRate"); return s == null && (s = 1, u.setValue("CurrencyRate", s)), h = u.getValue("AmtSourceDr"), h == null && (h = 0), c = u.getValue("AmtSourceCr"), c == null && (c = 0), l = h * s, l.toFixed(v), u.setValue("AmtAcctDr", l), a = c * s, a.toFixed(v), u.setValue("AmtAcctCr", a), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutGLJournal = rt; n.Utility.inheritPrototype(ut, n.CalloutEngine); ut.prototype.Product = function (n, t, i, r, u, f) { if (u == null || u.toString() == "") return ""; var e = u; return e == null || e == 0 ? "" : (i.setValue("M_AttributeSetInstance_ID", null), n = t = i = r = u = f = null, "") }; ut.prototype.SetAttributeSetInstance = function (t, i, r, u, f, e) { if (f == null || f.toString() == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); try { var o = f.toString(), s = n.dataContext.getJSONRecord("MProductionLine/GetAttributeSetInstance", o); r.setValue("M_AttributeSetInstance_ID", s) } catch (h) { this.setCalloutActive(!1); this.log.severe(h.toString()) } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; ut.prototype.SetBOM = function (t, i, r, u, f, e) { var o, s; if (f == null || f.toString() == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); try { u.getColumnName().equals("M_Product_ID") ? (r.setValue("M_AttributeSetInstance_ID", 0), o = f.toString().concat(",", 0)) : u.getColumnName().equals("M_AttributeSetInstance_ID") && (o = r.getValue("M_Product_ID").toString().concat(",", f.toString())); s = n.dataContext.getJSONRecord("MProductionLine/GetBOM", o); r.setValue("M_BOM_ID", s) } catch (h) { this.setCalloutActive(!1); this.log.severe(h.toString()) } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutProduction = ut; n.Utility.inheritPrototype(ft, n.CalloutEngine); ft.prototype.CopyMail = function (r, u, f, e, o, s) { var v = e.getColumnName(), c; if (this.log.info(v + "=" + o), o == null || o.toString() == "") return ""; var y = t.getValueOfInt(o), l = "SELECT MailHeader, MailText FROM R_MailText WHERE R_MailText_ID=@Param1", a = [], h = null; try { a[0] = new n.DB.SqlParam("@Param1", t.getValueOfInt(y)); h = n.DB.executeReader(l, a, null); h.read() && (c = h.get("mailtext"), c = n.Env.parseContext(r, u, c, !1, !0), f.setValue("Result", c)); h.close() } catch (p) { this.setCalloutActive(!1); h != null && h.close(); this.log.log(i.SEVERE, l, p) } return r = u = f = e = o = s = null, "" }; ft.prototype.CopyResponse = function (r, u, f, e, o, s) { var v = e.getColumnName(), c; if (this.log.info(v + "=" + o), o == null || o.toString() == "") return ""; var y = t.getValueOfInt(o), l = "SELECT Name, ResponseText FROM R_StandardResponse WHERE R_StandardResponse_ID=@Param1", a = [], h = null; try { a[0] = new n.DB.SqlParam("@Param1", t.getValueOfInt(y)); h = n.DB.executeReader(l, a, null); h.read() && (c = h.get("responsetext"), c = n.Env.parseContext(r, u, c, !1, !0), f.setValue("Result", c)); h.close() } catch (p) { this.setCalloutActive(!1); h != null && h.close(); this.log.log(i.SEVERE, l, p) } return r = u = f = e = o = s = null, "" }; ft.prototype.Type = function (i, r, u, f, e, o) { var l = f.getColumnName(), s, c, h; return (this.log.info(l + "=" + e), u.setValue("R_Status_ID", null), e == null || e.toString() == "") ? "" : (s = t.getValueOfInt(e), s == 0) ? "" : (c = s.toString(), h = n.dataContext.getJSONRecord("MRequestType/GetDefaultR_Status_ID", c), h != 0 && u.setValue("R_Status_ID", t.getValueOfInt(h)), i = r = u = f = e = o = null, "") }; n.Model.CalloutRequest = ft; n.Utility.inheritPrototype(tt, n.CalloutEngine); tt.prototype.Product = function (i, r, u, f, e, o) { var s, c, h, l, y; try { if (e == null || e.toString() == "" || (s = e, s == null || s == 0)) return ""; u.setValue("M_AttributeSetInstance_ID", null); var p = i.getContextAsInt(r, "C_BPartner_ID"), w = u.getValue("Qty"), b = !1, a = i.getContextAsInt(r, "M_PriceList_ID"), c = i.getContextAsInt(r, "M_PriceList_Version_ID"), k = u.getValue("DateRequired"), l = "SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'", d = t.getValueOfInt(n.DB.executeScalar(l)), g, v = n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID", s), nt; nt = t.getValueOfString(a).concat(",", t.getValueOfString(u.getValue("M_Requisition_ID")), ",", t.getValueOfString(s), ",", t.getValueOfString(v), ",", t.getValueOfString(u.getValue("M_AttributeSetInstance_ID")), ",", "3"); c = n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID", nt); g = d > 0 ? s.toString().concat(",", p, ",", w, ",", b, ",", a, ",", c, ",", k, ",", null, ",", v, ",", d) : s.toString().concat(",", p, ",", w, ",", b, ",", a, ",", c, ",", k, ",", null); h = null; h = n.dataContext.getJSONRecord("MProductPricing/GetProductPricing", g); u.setValue("PriceActual", h.PriceActual); u.setValue("PrintDescription", t.getValueOfString(h.DocumentNote)); i.setContext(r, "EnforcePriceLimit", h.EnforcePriceLimit ? "Y" : "N"); i.setContext(r, "DiscountSchema", h.DiscountSchema ? "Y" : "N"); u.setValue("C_UOM_ID", v); l = "SELECT C_OrderLine_ID FROM C_OrderLine WHERE C_Order_ID = (SELECT C_Order_ID  FROM C_Order  WHERE DocumentNo= (SELECT DocumentNo FROM M_Requisition WHERE M_Requisition.M_Requisition_id = " + u.getValue("M_Requisition_id") + ") AND AD_Client_ID =" + i.getAD_Client_ID() + ") AND M_Product_ID=" + e; y = t.getValueOfInt(n.DB.executeScalar(l)); y > 0 && u.setValue("C_OrderLine_ID", y) } catch (tt) { return this.setCalloutActive(!1), tt.message } return i = r = u = f = e = o = null, "" }; tt.prototype.Charge = function (i, r, u, f, e, o) { var s, c, h; try { if (this.isCalloutActive() || e == null || e.toString() == "") return ""; if (this.setCalloutActive(!0), s = t.getValueOfInt(e), s == null || s == 0) return this.setCalloutActive(!1), ""; u.getValue("M_Product_ID") != null && u.setValue("M_Product_ID", null); u.setValue("M_AttributeSetInstance_ID", null); c = i.getContextAsInt("#C_UOM_ID"); c > 0 ? u.setValue("C_UOM_ID", c) : u.setValue("C_UOM_ID", 100); h = n.dataContext.getJSONRecord("MCharge/GetChargeDetails", s.toString()); h != null && (u.setValue("PriceActual", t.getValueOfDecimal(h.ChargeAmt)), u.setValue("PrintDescription", t.getValueOfString(h.PrintDescription))) } catch (l) { return this.setCalloutActive(!1), l.message } return this.setCalloutActive(!1), o = null, "" }; tt.prototype.Amt = function (i, r, u, f, e, o) { var y, a, h; if (e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; try { this.setCalloutActive(!0); var c = i.getStdPrecision(), l = c, v = i.getContextAsInt(r, "M_PriceList_ID"), s; if (v != 0 && (s = n.dataContext.getJSONRecord("MPriceList/GetPriceList", v.toString()), s != null && (c = t.getValueOfInt(s.StdPrecision), l = t.getValueOfInt(s.PriceListPrecision))), f.getColumnName() == "Qty" && "Y" == i.getContext("DiscountSchema")) { var p = i.getContextAsInt(r, "M_Product_ID"), w = i.getContextAsInt(r, "C_BPartner_ID"), b = e, k = i.getContextAsInt(r, "M_PriceList_Version_ID"), d = u.getValue("DateInvoiced"), g = p.concat(",", w, ",", b, ",", !1, ",", v, ",", k, ",", d, ",", null), s = null; s = n.dataContext.getJSONRecord("MProductPricing/GetProductPricing", g); u.setValue("PriceActual", t.getValueOfDecimal(s.PriceActual.toFixed(l))) } y = u.getValue("QtyEntered"); a = u.getValue("PriceActual"); this.log.fine("amt - Qty=" + y + ", Price=" + a + ", Precision=" + l); h = y * a; t.scale(h) > c && (h = h.toFixed(c)); u.setValue("LineNetAmt", h); u.setValue("PriceActual", t.getValueOfDecimal(a.toFixed(l))); this.log.info("amt - LineNetAmt=" + h) } catch (nt) { this.setCalloutActive(!1); this.log.saveError("CalloutRequisation", nt) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; tt.prototype.Qty = function (i, r, u, e, o, s) { var a = "", w, rt, ut, ft, l, nt, p, b, k, tt, v, d; if (this.isCalloutActive() || o == null || o.toString() == "" || (console.log("Before Charge Or Product"), t.getValueOfInt(u.getValue("M_Product_ID")) == 0 && t.getValueOfInt(u.getValue("C_Charge_ID")) == 0)) return ""; console.log("After Charge Or Product"); this.setCalloutActive(!0); try { w = i.getContextAsInt(r, "M_Product_ID"); f && this.log.Warning("init - M_Product_ID=" + w + " - "); var h = n.Env.ZERO, c = n.Env.ZERO, y, g, it = i.getContextAsInt(r, "M_PriceList_ID"); if (w == 0) h = t.getValueOfDecimal(u.getValue("QtyEntered")), c = h, u.setValue("Qty", c); else if (e.getColumnName() == "C_UOM_ID" || e.getColumnName() == "M_AttributeSetInstance_ID") { l = t.getValueOfInt(u.getValue("C_UOM_ID")); h = t.getValueOfDecimal(u.getValue("QtyEntered")); v = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"); rt = 0; v != null && (rt = v.VA009_ ? 1 : 0); ut = i.getContextAsInt(r, "C_BPartner_ID"); ft = e.getColumnName() == "M_AttributeSetInstance_ID" ? t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID")) : i.getContextAsInt(r, "M_AttributeSetInstance_ID"); var et = i.getContextAsInt(r, "M_PriceList_Version_ID"), ot = i.getContext(r, "DateDoc"); a = w.toString().concat(",", ut, ",", h, ",", !1, ",", it, ",", et, ",", ot, ",", null, ",", ft.toString(), ",", l, ",", rt); v = null; v = n.dataContext.getJSONRecord("MProductPricing/GetProductPricing", a); v != null && (y = v.PriceActual, e.getColumnName() == "M_AttributeSetInstance_ID" && u.setValue("PriceActual", t.getValueOfInt(y))); a = l.toString().concat(","); nt = n.dataContext.getJSONRecord("MUOM/GetPrecision", a); p = h.toFixed(t.getValueOfInt(nt)); h != p && (this.log.fine("Corrected QtyEntered Scale UOM=" + l + "; QtyEntered=" + h + "->" + p), h = p, u.setValue("QtyEntered", h)); a = w.toString().concat(",", l.toString(), ",", h.toString()); b = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a); c = b; c == null && (c = h); k = h != c; y == 0 ? (y = t.getValueOfDecimal(u.getValue("PriceActual")), a = w.toString().concat(",", l.toString(), ",", y.toString()), b = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), g = b, g == null && (g = y), this.log.fine("UOM=" + l + ", QtyEntered/PriceActual=" + h + "/" + y + " -> " + k + " QtyRequired/PriceEntered=" + c + "/" + g), i.setContext(r, "UOMConversion", k ? "Y" : "N"), u.setValue("PriceActual", g)) : u.setValue("PriceActual", y); u.setValue("Qty", c) } else e.getColumnName() == "QtyEntered" && (l = i.getContextAsInt(r, "C_UOM_ID"), h = t.getValueOfDecimal(o), a = l.toString().concat(","), nt = n.dataContext.getJSONRecord("MUOM/GetPrecision", a), p = h.toFixed(t.getValueOfInt(nt)), h != p && (this.log.fine("Corrected QtyEntered Scale UOM=" + l + "; QtyEntered=" + h + "->" + p), h = p, u.setValue("QtyEntered", h)), a = w.toString().concat(",", l.toString(), ",", h.toString()), b = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a), c = b, c == null && (c = h), k = h != c, this.log.fine("UOM=" + l + ", QtyEntered=" + h + " -> " + k + " Qty=" + c), i.setContext(r, "UOMConversion", k ? "Y" : "N"), u.setValue("Qty", c)); y = t.getValueOfDecimal(u.getValue("PriceActual")); tt = i.getStdPrecision(); it > 0 && (v = n.dataContext.getJSONRecord("MPriceList/GetPriceList", it.toString()), v != null && (tt = t.getValueOfInt(v.StdPrecision)), v = null); d = h * y; t.scale(d) > tt && (d = d.toFixed(tt)); u.setValue("LineNetAmt", d); this.log.info("amt - LineNetAmt=" + d) } catch (st) { return this.setCalloutActive(!1), st } return this.setCalloutActive(!1), i = r = u = e = o = s = null, "" }; n.Model.CalloutRequisition = tt; n.Utility.inheritPrototype(bt, n.CalloutEngine); bt.prototype.PayAmt = function (n, i, r, u, f, e) { var o, h, s; if (this.isCalloutActive() || f == null || f == "" || (o = t.getValueOfInt(r.getValue("C_Invoice_ID")), o == null) || (h = o, h == 0)) return ""; var c = t.getValueOfDecimal(r.getValue("OpenAmt")), l = t.getValueOfDecimal(r.getValue("PayAmt")), a = t.getValueOfDecimal(r.getValue("DiscountAmt")); return this.setCalloutActive(!0), s = c - l - a, this.log.fine(" - OpenAmt=" + c + " - PayAmt=" + l + ", Discount=" + a + ", Difference=" + s), r.setValue("DifferenceAmt", s), this.setCalloutActive(!1), n = i = r = u = f = e = null, "" }; bt.prototype.Invoice = function (r, u, f, e, o, s) { var c, a, p; if (this.isCalloutActive() || o == null || o == "" || (c = t.getValueOfInt(o), c == 0)) return ""; a = r.getContextAsInt(u, "C_BankAccount_ID"); p = r.getContext("PayDate"); this.setCalloutActive(!0); var l = n.Env.ZERO, v = n.Env.ZERO, w = "SELECT currencyConvert(invoiceOpen(i.C_Invoice_ID, 0), i.C_Currency_ID,ba.C_Currency_ID, i.DateInvoiced, i.C_ConversionType_ID, i.AD_Client_ID, i.AD_Org_ID) as OpenAmt, paymentTermDiscount(i.GrandTotal,i.C_Currency_ID,i.C_PaymentTerm_ID,i.DateInvoiced,'" + p + "') As DiscountAmt, i.IsSOTrx FROM C_Invoice_v i, C_BankAccount ba WHERE i.C_Invoice_ID=@Param2 AND ba.C_BankAccount_ID=@Param3", y = [], h = null; try { y[0] = new n.DB.SqlParam("@Param2", c); y[1] = new n.DB.SqlParam("@Param3", a); h = n.DB.executeReader(w, y, null); h.read() && (l = h.get("openamt"), v = h.get("discountamt"), IsSOTrx = "Y" == h.get("issotrx")); h.close() } catch (b) { this.setCalloutActive(!1); h != null && h.close(); this.log.log(i.SEVERE, w, b) } return this.log.fine(" - OpenAmt=" + l + " (Invoice=" + c + ",BankAcct=" + a + ")"), f.setValue("OpenAmt", l), f.setValue("PayAmt", l - v), f.setValue("DiscountAmt", v), f.setValue("DifferenceAmt", n.Env.ZERO), f.setValue("IsSOTrx", "N"), this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; n.Model.CalloutPaySelection = bt; n.Utility.inheritPrototype(et, n.CalloutEngine); et.prototype.EndDate = function (i, r, u, f, e, o) { if (e == null || e.toString() == "") return ""; var h = new Date(u.getValue("StartDate")), c = t.getValueOfInt(u.getValue("C_Frequency_ID")), l = "Select NoOfMonths from C_Frequency where C_Frequency_ID=" + c, v = t.getValueOfInt(n.DB.executeScalar(l, null, null)), a = t.getValueOfInt(u.getValue("NoofCycle")), s = h.getDate() + "/" + (h.getMonth() + months * a) + "/" + h.getFullYear(); return s = s <= 0 ? new Date : new Date(s), s = s.toISOString(), u.setValue("EndDate", s), i = r = u = f = e = o = null, "" }; et.prototype.Qty = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var s = t.getValueOfDecimal(f), h = t.getValueOfDecimal(r.getValue("QtyPerCycle")), o = s * h; return r.setValue("QtyEntered", o), r.setValue("QtyOrdered", o), n = i = r = u = f = e = null, "" }; et.prototype.QtyPerCycle = function (n, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var s = t.getValueOfDecimal(f), h = t.getValueOfDecimal(r.getValue("NoofCycle")), o = h * s; return r.setValue("QtyEntered", o), r.setValue("QtyOrdered", o), n = i = r = u = f = e = null, "" }; n.Model.CalloutOrderLine = et; n.Utility.inheritPrototype(yi, n.CalloutEngine); yi.prototype.Orderline = function (i, r, u, f, e, o) { if (e == null || e.toString() == "" || t.getValueOfInt(e) == 0 || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); var h = t.getValueOfInt(e), s = n.dataContext.getJSONRecord("MOrderLine/GetOrderLine", h); u.setValue("M_Product_ID", s.M_Product_ID); u.setValue("Qty", s.Qty); u.setValue("C_UOM_ID", s.C_UOM_ID); u.setValue("C_BPartner_ID", s.C_BPartner_ID); u.setValue("PlannedHours", s.PlannedHours); this.setCalloutActive(!1) } catch (c) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutOrderlineRecording = yi; n.Utility.inheritPrototype(pi, n.CalloutEngine); pi.prototype.Currency = function (i, r, u, f, e, o) { var s, h; if (e == null || e.toString() == "") return ""; s = ""; try { s = "select C_Currency_id from m_pricelist where m_pricelist_ID = " + t.getValueOfInt(e); h = t.getValueOfInt(n.DB.executeScalar(s, null, null)); u.setValue("C_Currency_ID", h) } catch (c) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutCurrency = pi; n.Utility.inheritPrototype(wi, n.CalloutEngine); wi.prototype.Qty = function (i, r, u, f, e, o) { var c, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; var y = t.getValueOfDecimal(u.getValue("PriceActual")), p = t.getValueOfDecimal(u.getValue("QtyEntered")), l = 0, w = n.Env.ZERO, s = n.Env.ZERO; if (u.setValue("LineNetAmt", y * p), l = t.getValueOfInt(u.getValue("C_Tax_ID")), u.getField("SurchargeAmt") != null) { var b = 0, a = !1, v = n.dataContext.getJSONRecord("MPriceList/GetPriceListData", u.getValue("M_PriceList_ID").toString()); v != null && (b = v.StdPrecision, a = "Y" == v.IsTaxIncluded); h = t.getValueOfDecimal(u.getValue("LineNetAmt")); c = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", l.toString() + "," + h.toString() + "," + b.toString() + "," + a.toString()); s = c.TaxAmt; u.setValue("TaxAmt", s); u.setValue("SurchargeAmt", c.SurchargeAmt); a ? u.setValue("GrandTotal", h) : u.setValue("GrandTotal", h + s + c.SurchargeAmt) } else w = n.dataContext.getJSONRecord("MTax/GetTaxRate", l.toString()), h = t.getValueOfDecimal(u.getValue("LineNetAmt")), s = t.getValueOfDecimal(t.getValueOfDecimal(h) * t.getValueOfDecimal(w) / 100), s = s.toFixed(2), u.setValue("taxamt", s), u.setValue("GrandTotal", y * p + t.getValueOfDecimal(u.getValue("TaxAmt"))); return i = r = u = f = e = o = null, "" }; n.Model.CalloutContractQty = wi; n.Utility.inheritPrototype(bi, n.CalloutEngine); bi.prototype.ContractProduct = function (n, i, r, u, f, e) { if (f == null || f.toString() == "" || t.getValueOfInt(f) == 0) return ""; var o = t.getValueOfInt(r.getValue("M_Proudct_ID")); return o != 0 && t.getValueOfBoolean(f) && (r.setValue("PriceList", 0), r.setValue("PriceLimit", 0), r.setValue("PriceActual", 0), r.setValue("PriceEntered", 0)), n = i = r = u = f = e = null, "" }; n.Model.CalloutContractProduct = bi; n.Utility.inheritPrototype(k, n.CalloutEngine); k.prototype.InvoiceCount = function (i, r, u, f, e, o) { if (e == null || e.toString() == "" || t.getValueOfInt(e) == 0) return ""; var s = t.getValueOfDateTime(u.getValue("StartDate")), h = u.getValue("EndDate"), c = t.getValueOfInt(u.getValue("C_Frequency_ID")), l = "Select NoOfDays from C_Frequency where C_Frequency_ID=" + c, a = t.getValueOfInt(n.DB.executeScalar(l, null, null)), v = (h - s).Days, y = v / a; return u.setValue("TotalInvoice", y), i = r = u = f = e = o = null, "" }; k.prototype.EndDate = function (i, r, u, f, e, o) { var h = new Date(u.getValue("StartDate")), c = new Date(u.getValue("StartDate")), l = n.dataContext.getJSONRecord("MOrderLine/GetNoOfMonths", t.getValueOfString(u.getValue("C_Frequency_ID"))), a = t.getValueOfInt(u.getValue("TotalInvoice")), s = h.setMonth(h.getMonth() + l * a); return s = new Date(h.setDate(h.getDate() - 1)), u.setValue("EndDate", s), s = new Date(s), s = s.toISOString(), h = c.toISOString(), s < h && u.setValue("EndDate", c), i = r = u = f = e = o = null, "" }; k.prototype.BillStartDate = function (t, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = new Date(r.getValue("StartDate")), s = new Date(r.getValue("BillStartDate")); return s.toISOString() < o.toISOString() && (n.ADialog.info("StartDateShouldBeLessThanBillStartDate"), r.setValue("BillStartDate", r.getValue("StartDate"))), t = i = r = u = f = e = null, "" }; k.prototype.StartDate = function (i, r, u, f, e, o) { if (e == null || e.toString() == "") return ""; var h = new Date(u.getValue("StartDate")), c = t.getValueOfInt(u.getValue("C_Frequency_ID")), l = "Select NoOfDays from C_Frequency where C_Frequency_ID=" + c, a = t.getValueOfInt(n.DB.executeScalar(l, null, null)), v = t.getValueOfInt(u.getValue("TotalInvoice")), y = v * a, s = new Date(h.setDate(h.getDay() + t.getValueOfDouble(y))); return s = s.toISOString(), u.setValue("EndDate", s), i = r = u = f = e = o = null, "" }; k.prototype.StartDateChange = function (i, r, u, f, e, o) { if (e == null || e.toString() == "") return ""; var c = t.getValueOfInt(u.getValue("C_Frequency_ID")), l = "Select NoOfMonths from C_Frequency where C_Frequency_ID=" + c, a = t.getValueOfInt(n.DB.executeScalar(l, null, null)), v = t.getValueOfInt(u.getValue("TotalInvoice")), s = new Date(e), y = new Date(e), h = s.setMonth(s.getMonth() + a * v); return h = new Date(s.setDate(s.getDate() - 1)), u.setValue("EndDate", h.toISOString()), h = h.toISOString(), s = y.toISOString(), h < s && u.setValue("EndDate", s), u.setValue("BillStartDate", u.getValue("StartDate")), i = r = u = f = e = o = null, "" }; n.Model.CalloutContract = k; n.Utility.inheritPrototype(kt, n.CalloutEngine); kt.prototype.product = function (n, t, i, r, u, f) { return i.setValue("Help", i.getValue("Name")), n = t = i = r = u = f = null, "" }; kt.prototype.product2 = function (n, t, i, r, u, f) { return i.setValue("Description", i.getValue("Help")), n = t = i = r = u = f = null, "" }; n.Model.copyname = kt; n.Utility.inheritPrototype(ki, n.CalloutEngine); ki.prototype.IsInternal = function (i, r, u, f, e, o) { if (e == null || e.toString() == "" || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); var h = "select ProfileType from S_Resource where AD_User_ID = " + t.getValueOfInt(e), s = t.getValueOfString(n.DB.executeScalar(h, null, null)); s != "" && (s.toUpper() == "I" ? u.setValue("IsInternal", !0) : s.toUpper() == "E" && u.setValue("IsInternal", !1)); this.setCalloutActive(!1) } catch (c) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutUserTimeRec = ki; n.Utility.inheritPrototype(ot, n.CalloutEngine); ot.prototype.Product = function (r, u, f, o, s, h) { var c = s, w, v; if (c == null || t.getValueOfInt(c) == 0) return ""; this.setCalloutActive(!0); var l = null, g = r.getContext(u, "DateExpense"), p = null, a = null; try { w = !0; v = n.dataContext.getJSONRecord("MProduct/GetProduct", c.toString()); f.setValue("C_UOM_ID", t.getValueOfInt(v.C_UOM_ID)); uom = f.getValue("C_UOM_ID"); var b = paramStr = c.toString().concat(",").concat(f.getValue("S_TimeExpense_ID").toString()).concat(",").concat(f.getValue("C_UOM_ID").toString().concat(",").concat(f.getValue("DateExpense").toString())), y = n.dataContext.getJSONRecord("MExpenseReport/GetstandardPrice", b), l = y.PriceActual, k = y.C_Currency_ID; f.setValue("ExpenseAmt", l); f.setValue("C_Currency_ID", k); f.setValue("ConvertedAmt", l) } catch (d) { return a != null && a.close(), this.log.log(i.SEVERE, p, d), this.setCalloutActive(!1), e.message } return this.setCalloutActive(!1), r = u = f = o = s = h = null, "" }; ot.prototype.Amount = function (i, r, u, f, e, o) { var a, s; if (this.isCalloutActive()) return ""; this.setCalloutActive(!0); var l = u.getValue("ExpenseAmt"), h = 0, c = u.getValue("C_Currency_ID"); if (h = n.dataContext.getJSONRecord("MExpenseReport/GetPriceListCurrency", u.getValue("S_TimeExpense_ID")), a = i.getContext(r, "DateExpense"), this.log.fine("Amt=" + l + ", C_Currency_ID=" + c), s = l.toString(), !s.equals(n.Env.ZERO) && h != t.getValueOfInt(c)) { var v = i.getContextAsInt(r, "AD_Client_ID"), y = i.getContextAsInt(r, "AD_Org_ID"), p = s.toString() + "," + c.toString() + "," + h.toString() + "," + a + ",0," + v.toString() + "," + y.toString(); s = n.dataContext.getJSONRecord("MConversionRate/CurrencyConvert", p) } return u.setValue("ConvertedAmt", s), this.log.fine("= ConvertedAmt=" + s), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutTimeExpense = ot; n.Utility.inheritPrototype(c, n.CalloutEngine); c.prototype.ProductInfo = function (i, r, u, f, e, o) { var s, l, v, c, a, h; return e == null || e.toString() == "" || t.getValueOfInt(e) == 0 ? "" : (s = e, s == null || s == 0) ? "" : (s = i.getContextAsInt(r, "M_Product_ID"), s == null || s == 0) ? "" : (l = i.getContextAsInt(r, "M_PriceList_ID"), v = i.getContextAsInt(r, "M_AttributeSetInstance_ID"), l != 0 ? (c = "Select M_PriceList_Version_ID from M_ProductPrice where M_Product_id=" + t.getValueOfInt(s) + " and M_PriceList_Version_ID in (select m_pricelist_version_id from m_pricelist_version where m_pricelist_id = " + l + " and isactive='Y')", a = t.getValueOfInt(n.DB.executeScalar(c, null, null)), a != 0 && (c = "Select PriceStd from M_ProductPrice where M_PriceList_Version_ID=" + a + " and M_Product_id=" + t.getValueOfInt(s) + " and M_AttributeSetInstance_ID=" + t.getValueOfInt(v), h = t.getValueOfDecimal(n.DB.executeScalar(c, null, null)), u.setValue("PriceStd", h), u.setValue("UnitPrice", h), u.setValue("PriceStd", h * t.getValueOfDecimal(u.getValue("QtyEntered"))), u.setValue("TotalPrice", h * t.getValueOfDecimal(u.getValue("QtyEntered"))))) : n.ADialog.info("PriceLisetNotFound"), i = r = u = f = e = o = null, "") }; c.prototype.Charge = function (n, t, r, u, f, e) { try { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); r.getValue("M_Product_ID") != null && (r.setValue("M_Product_ID", null), r.setValue("M_AttributeSetInstance_ID", null)); var o = n.getContextAsInt("#C_UOM_ID"); o > 0 ? r.setValue("C_UOM_ID", o) : r.setValue("C_UOM_ID", 100) } catch (s) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, sql, s), s } this.setCalloutActive(!1); e = null }; c.prototype.CalculatePrice = function (i, r, u, f, e, o) { if (this.isCalloutActive() || e == null || e.toString() == "" || t.getValueOfInt(e) <= 0) return ""; this.setCalloutActive(!0); var s = n.dataContext.getJSONRecord("MCurrency/GetCurrency", t.getValueOfString(i.getContextAsInt(r, "C_Currency_ID"))), h = t.getValueOfDecimal(u.getValue("UnitPrice")) * t.getValueOfDecimal(u.getValue("BaseQty")); return u.setValue("PriceStd", h.toFixed(t.getValueOfInt(s.StdPrecision))), u.setValue("TotalPrice", h.toFixed(t.getValueOfInt(s.StdPrecision))), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; c.prototype.Qty = function (i, r, u, f, e, o) { var h, s, c; if (this.isCalloutActive() || e == null || e.toString() == "" || t.getValueOfInt(e) == 0) return ""; if (this.setCalloutActive(!0), h = u.getValue("C_UOM_ID"), h == null && (h = i.getContextAsInt(r, "C_UOM_ID")), s = u.getValue("BaseQty"), c = n.dataContext.getJSONRecord("MCurrency/GetCurrency", t.getValueOfString(i.getContextAsInt(r, "C_Currency_ID"))), u.getValue("M_Product_ID") != null) { var a = u.getValue("M_Product_ID"), v = a.toString().concat(",", h.toString(), ",", s.toString()), l = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", v); l != null ? u.setValue("QtyEntered", l) : u.setValue("QtyEntered", s) } else u.setValue("QtyEntered", s); return t.getValueOfDecimal(u.getValue("UnitPrice")) != 0 && s != 0 && (u.setValue("PriceStd", (s * u.getValue("UnitPrice")).toFixed(t.getValueOfInt(c.StdPrecision))), u.setValue("TotalPrice", (s * u.getValue("UnitPrice")).toFixed(t.getValueOfInt(c.StdPrecision)))), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; c.prototype.Currency = function (i, r, u, f, e, o) { if (this.isCalloutActive() || e == null || e.toString() == "" || t.getValueOfInt(e) == 0) return ""; this.setCalloutActive(!0); var s = n.dataContext.getJSONRecord("MPriceList/GetPriceListData", t.getValueOfString(u.getValue("M_PriceList_ID"))); return s.C_Currency_ID != null && u.setValue("C_Currency_ID", s.C_Currency_ID), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; c.prototype.ProductPrice = function (i, r, u, f, e, o) { var h; if (this.isCalloutActive() || e == null || e.toString() == "" || t.getValueOfInt(e) == 0) return u.getValue("M_Product_ID") == null && (u.setValue("PriceStd", 0), u.setValue("TotalPrice", 0), u.setValue("UnitPrice", 0), u.setValue("QtyEntered", 1), u.setValue("BaseQty", 1)), ""; if (this.setCalloutActive(!0), i.getContextAsInt(r, "M_PriceList_ID") > 0) { var c = n.dataContext.getJSONRecord("MCurrency/GetCurrency", t.getValueOfString(i.getContextAsInt(r, "C_Currency_ID"))), l = t.getValueOfString(u.getValue("M_Product_ID")).concat(",", t.getValueOfString(u.getValue("M_AttributeSetInstance_ID")), ",", t.getValueOfString(i.getContextAsInt(r, "M_PriceList_ID")), ",", t.getValueOfString(u.getValue("C_UOM_ID"))), s = n.dataContext.getJSONRecord("MProductPricing/GetProductdata", l); s != null && (u.setValue("PriceStd", s.PriceStd), u.setValue("UnitPrice", s.PriceStd), u.setValue("PriceStd", (s.PriceStd * t.getValueOfDecimal(u.getValue("BaseQty"))).toFixed(t.getValueOfInt(c.StdPrecision))), u.setValue("TotalPrice", (s.PriceStd * t.getValueOfDecimal(u.getValue("BaseQty"))).toFixed(t.getValueOfInt(c.StdPrecision))), t.getValueOfInt(u.getValue("C_UOM_ID")) == 0 && u.setValue("C_UOM_ID", s.C_UOM_ID), u.findColumn("IsBOM") > 0 && u.setValue("IsBOM", s.IsBOM)) } return h = n.dataContext.getJSONRecord("MTeamForcast/GetBOMdetails", t.getValueOfString(u.getValue("M_Product_ID"))), h != null && (u.setValue("BOMUse", h.BOMUse), u.setValue("VAMFG_M_Routing_ID", h.VAMFG_M_Routing_ID), u.setValue("M_BOM_ID", h.M_BOM_ID)), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; c.prototype.AccountDate = function (r, u, f, e, o, s) { if (this.isCalloutActive() || o == null || o.toString() == "") return ""; try { this.setCalloutActive(!0); var l = t.getValueOfString(f.getValue("AD_Client_ID")).concat(",", t.getValueOfString(f.getValue("DateAcct")), ",", t.getValueOfString(f.getValue("AD_Org_ID"))), h = n.dataContext.getJSONRecord("MPeriod/GetPeriod", l); h != null && f.setValue("C_Period_ID", h) } catch (c) { return this.log.log(i.SEVERE, sql, c), c.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; c.prototype.SuperVisor = function (r, u, f, e, o, s) { if (this.isCalloutActive() || o == null || o.toString() == "" || t.getValueOfInt(o) == 0) return ""; try { this.setCalloutActive(!0); var h = n.dataContext.getJSONRecord("MTeamForcast/GetSuperVisor", t.getValueOfString(o)); h != null && f.setValue("Supervisor_ID", h) } catch (c) { return this.log.log(i.SEVERE, sql, c), c.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; n.Model.CalloutTeamForcast = c; n.Utility.inheritPrototype(st, n.CalloutEngine); st.prototype.Currency = function (r, u, f, e, o, s) { if (this.isCalloutActive() || o == null || o.toString() == "" || t.getValueOfInt(o) == 0) return f.getValue("M_PriceList_ID") == null && f.setValue("C_Currency_ID", t.getValueOfInt(r.getContext("$C_Currency_ID"))), ""; try { this.setCalloutActive(!0); var h = n.dataContext.getJSONRecord("MPriceList/GetPriceListData", t.getValueOfString(f.getValue("M_PriceList_ID"))); h.C_Currency_ID != null && f.setValue("C_Currency_ID", h.C_Currency_ID) } catch (c) { return this.log.log(i.SEVERE, sql, c), c.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; st.prototype.Product = function (r, u, f, e, o, s) { var c; if (this.isCalloutActive() || o == null || o.toString() == "" || t.getValueOfInt(o) == 0) return f.getValue("M_Product_ID") == null && (f.setValue("Price", 0), f.setValue("PlannedRevenue", 0), f.setValue("ForcastQty", 0), f.setValue("TotalQty", 0)), ""; try { if (this.setCalloutActive(!0), r.getContextAsInt(u, "M_PriceList_ID") > 0) { var a = n.dataContext.getJSONRecord("MCurrency/GetCurrency", t.getValueOfString(r.getContextAsInt(u, "C_Currency_ID"))), v = t.getValueOfString(f.getValue("M_Product_ID")).concat(",", t.getValueOfString(f.getValue("M_AttributeSetInstance_ID")), ",", t.getValueOfString(r.getContextAsInt(u, "M_PriceList_ID")), ",", t.getValueOfString(f.getValue("C_UOM_ID"))), h = n.dataContext.getJSONRecord("MProductPricing/GetProductdata", v); h != null && (f.setValue("Price", h.PriceStd), f.setValue("PlannedRevenue", (h.PriceStd * t.getValueOfDecimal(f.getValue("TotalQty"))).toFixed(t.getValueOfInt(a.StdPrecision))), t.getValueOfInt(f.getValue("C_UOM_ID")) == 0 && f.setValue("C_UOM_ID", h.C_UOM_ID), f.findColumn("IsBOM") > 0 && f.setValue("IsBOM", h.IsBOM)); c = n.dataContext.getJSONRecord("MTeamForcast/GetBOMdetails", t.getValueOfString(f.getValue("M_Product_ID"))); c != null && (f.setValue("BOMUse", c.BOMUse), f.setValue("VAMFG_M_Routing_ID", c.VAMFG_M_Routing_ID), f.setValue("M_BOM_ID", c.M_BOM_ID)) } } catch (l) { return this.log.log(i.SEVERE, sql, l), l.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; st.prototype.CalculatePrice = function (r, u, f, e, o, s) { var h, c, l; if (this.isCalloutActive() || o == null || o.toString() == "" || t.getValueOfInt(o) <= 0) return ""; try { this.setCalloutActive(!0); h = n.dataContext.getJSONRecord("MCurrency/GetCurrency", t.getValueOfString(r.getContextAsInt(u, "C_Currency_ID"))); c = t.getValueOfDecimal(f.getValue("ForcastQty")) + t.getValueOfDecimal(f.getValue("SalesOrderQty")) + t.getValueOfDecimal(f.getValue("OppQty")); f.setValue("TotalQty", c); l = t.getValueOfDecimal(f.getValue("Price")) * t.getValueOfDecimal(f.getValue("TotalQty")); f.setValue("PlannedRevenue", l.toFixed(t.getValueOfInt(h.StdPrecision))) } catch (a) { return this.log.log(i.SEVERE, sql, a), a.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; n.Model.CalloutMasterForecast = st; n.Utility.inheritPrototype(dt, n.CalloutEngine); dt.prototype.TaxID = function (i, r, u, f, e, o) { var c, h, s; if (e == null || e.toString() == "" || t.getValueOfInt(e) == 0 || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); c = "select Rate from C_Tax where C_Tax_ID = " + t.getValueOfInt(e); h = t.getValueOfDecimal(n.DB.executeScalar(c, null, null)); h != 0 ? (s = t.getValueOfDecimal(u.getValue("ApprovedExpenseAmt")) * h / 100, s = s.toFixed(2), u.setValue("TaxAmt", s)) : u.setValue("TaxAmt", n.Env.ZERO); this.setCalloutActive(!1) } catch (l) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; dt.prototype.ExpenseAmt = function (i, r, u, f, e, o) { var c, h, s; if (e == null || e.toString() == "" || t.getValueOfInt(e) == 0 || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); c = "select Rate from C_Tax where C_Tax_ID = " + t.getValueOfInt(u.getValue("C_Tax_ID")); h = t.getValueOfDecimal(n.DB.executeScalar(c, null, null)); h != 0 ? (s = t.getValueOfDecimal(e) * h / 100, s = s.toFixed(2), u.setValue("TaxAmt", s)) : u.setValue("TaxAmt", n.Env.ZERO); this.setCalloutActive(!1) } catch (l) { this.setCalloutActive(!1) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutTaxAmt = dt; n.Utility.inheritPrototype(gt, n.CalloutEngine); gt.prototype.Tax = function (i, r, u, f, e, o) { var c, h; if (e == null || e == 0 || e.toString() == "") return ""; var l = 0, y = n.Env.ZERO, s = n.Env.ZERO; if (l = t.getValueOfInt(u.getValue("C_Tax_ID")), u.getField("SurchargeAmt") != null) { var p = 0, a = !1, v = n.dataContext.getJSONRecord("MPriceList/GetPriceListData", u.getValue("M_PriceList_ID").toString()); v != null && (p = v.StdPrecision, a = "Y" == v.IsTaxIncluded); h = t.getValueOfDecimal(u.getValue("LineNetAmt")); c = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", l.toString() + "," + h.toString() + "," + p.toString() + "," + a.toString()); s = c.TaxAmt; u.setValue("TaxAmt", s); u.setValue("SurchargeAmt", c.SurchargeAmt); a ? u.setValue("GrandTotal", h) : u.setValue("GrandTotal", h + s + c.SurchargeAmt) } else y = n.dataContext.getJSONRecord("MTax/GetTaxRate", l.toString()), h = t.getValueOfDecimal(u.getValue("LineNetAmt")), s = t.getValueOfDecimal(h * y / 100), s = t.getValueOfDecimal(s.toFixed(2)), u.setValue("GrandTotal", s + h), u.setValue("taxamt", s); return i = r = u = f = e = o = null, "" }; gt.prototype.SetTaxExemptReason = function (r, u, f, e, o, s) { if (o == null || o == 0 || o.toString() == "" || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); var h = n.dataContext.getJSONRecord("MTax/GetTaxExempt", t.getValueOfString(f.getValue("C_Tax_ID"))); h != null && (f.setValue("IsTaxExempt", t.getValueOfString(h.IsTaxExempt).equals("Y") ? !0 : !1), f.setValue("C_TaxExemptReason_ID", t.getValueOfInt(h.C_TaxExemptReason_ID))) } catch (c) { return this.log.log(i.SEVERE, sql, c), this.setCalloutActive(!1), c.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; n.Model.CalloutTax = gt; n.Utility.inheritPrototype(di, n.CalloutEngine); di.prototype.SetBP = function (n, i, r, u, f, e) { if (f == null || f.toString() == "" || t.getValueOfInt(f) == 0 || this.isCalloutActive()) return ""; try { this.setCalloutActive(!0); r.setValue("C_BPartner_ID", t.getValueOfInt(f)); this.setCalloutActive(!1) } catch (o) { this.setCalloutActive(!1) } return n = i = r = u = f = e = null, "" }; n.Model.CalloutSetBP = di; n.Utility.inheritPrototype(gi, n.CalloutEngine); gi.prototype.Charge = function (t, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; var o = r.getValue("C_Charge_ID").toString(), s = n.dataContext.getJSONRecord("MCharge/GetCharge", o); return r.setValue("PlannedQty", 1), r.setValue("PlannedPrice", s), t = i = r = u = f = e = null, "" }; n.Model.CalloutProjectLine = gi; n.Utility.inheritPrototype(ni, n.CalloutEngine); ni.prototype.ProductInfo = function (i, r, u, f, e, o) { var y, s, h, c, p, l; if (e == null || e.toString() == "") return t.getValueOfInt(u.getValue("M_Product_ID")) == 0 && (u.setValue("PriceList", 0), u.setValue("PlannedPrice", 0), u.setValue("Discount", 0), u.setValue("PlannedMarginAmt", 0), u.setValue("PlannedAmt", 0)), ""; if (t.getValueOfInt(u.getValue("M_Product_ID")) == 0) return u.setValue("PriceList", 0), u.setValue("PlannedPrice", 0), u.setValue("Discount", 0), u.setValue("PlannedMarginAmt", 0), u.setValue("PlannedAmt", 0), ""; var w = t.getValueOfInt(u.getValue("C_ProjectTask_ID")), b = t.getValueOfInt(u.getValue("C_ProjectPhase_ID")), k = t.getValueOfInt(u.getValue("C_Project_ID")), d = t.getValueOfInt(u.getValue("M_Product_ID")), a = 0, v = 0; if (u.findColumn("M_AttributeSetInstance_ID") > 0 && (a = t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID"))), u.findColumn("C_UOM_ID") > 0 && (v = t.getValueOfInt(u.getValue("C_UOM_ID"))), y = w.toString() + "," + b.toString() + "," + k.toString() + "," + d.toString() + "," + a.toString() + "," + v.toString(), s = n.dataContext.getJSONRecord("MProject/GetProjectDetail", y), s != null) { h = t.getValueOfDecimal(s.PriceList); u.setValue("PriceList", h); c = t.getValueOfDecimal(s.PriceStd); u.setValue("PlannedPrice", c); u.setValue("PlannedQty", 1); p = t.getValueOfDecimal(s.PriceLimit); try { if (l = (h - c) * 100 / h, isNaN(l)) return this.setCalloutActive(!1), n.Msg.getMsg("PriceNotDefined") } catch (g) { return this.setCalloutActive(!1), "PriceListNotSelected" } u.setValue("Discount", l.toFixed(2)); u.setValue("PlannedMarginAmt", c - p); t.getValueOfInt(u.getValue("C_UOM_ID")) == 0 && u.setValue("C_UOM_ID", s.C_UOM_ID) } else u.setValue("PriceList", 0), u.setValue("PlannedPrice", 0), u.setValue("Discount", 0), u.setValue("PlannedMarginAmt", 0), u.setValue("PlannedAmt", 0); return i = r = u = f = e = o = null, "" }; ni.prototype.SetQty = function (i, r, u, f, e, o) { var h, s; if (this.isCalloutActive() || e == null || e.toString() == "" || t.getValueOfInt(e) == 0) return ""; if (this.setCalloutActive(!0), h = u.getValue("C_UOM_ID"), s = u.getValue("PlannedQty"), u.getValue("M_Product_ID") != null) { var l = u.getValue("M_Product_ID"), a = l.toString().concat(",", h.toString(), ",", s.toString()), c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a); c != null ? u.setValue("BaseQty", c) : u.setValue("BaseQty", s) } else u.setValue("BaseQty", s); return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutProductToOpportunity = ni; n.Utility.inheritPrototype(nr, n.CalloutEngine); nr.prototype.PriceList = function (i, r, u, f, e, o) { var s, h, c; if (e == null || e.toString() == "") return ""; s = ""; try { s = "select M_PriceList_ID from M_PriceList_Version where M_PriceList_Version_ID = " + t.getValueOfInt(e); h = t.getValueOfInt(n.DB.executeScalar(s, null, null)); h != 0 && (u.setValue("M_PriceList_ID", h), s = "select C_Currency_id from m_pricelist where m_pricelist_ID = " + h, c = t.getValueOfInt(n.DB.executeScalar(s, null, null)), c != 0 ? u.setValue("C_Currency_ID", c) : n.ADialog.info("CurrencyNotDefinedForThePriceList")) } catch (l) { this.setCalloutActive(!1); this.log.saveError(s, s) } return i = r = u = f = e = o = null, "" }; n.Model.CalloutPriceListOpp = nr; n.Utility.inheritPrototype(s, n.CalloutEngine); s.prototype.Order = function (i, r, u, f, e, o) { var h, c; if (e == null || e.toString() == "") return ""; try { if ((h = t.getValueOfInt(e.toString()), h == null || h == 0) || this.isCalloutActive()) return ""; var a = h.toString(), s = n.dataContext.getJSONRecord("MOrder/GetOrder", a), v = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA077_"); t.getValueOfInt(s.ID) != 0 && (u.setValue("DateOrdered", s.DateOrdered), u.setValue("POReference", s.POReference), u.getValue("AD_Org_ID") != t.getValueOfInt(s.AD_Org_ID) && u.setValue("AD_Org_ID", t.getValueOfInt(s.AD_Org_ID)), u.setValue("DeliveryRule", s.DeliveryRule), u.setValue("DeliveryViaRule", s.DeliveryViaRule), u.setValue("M_Shipper_ID", t.getValueOfInt(s.M_Shipper_ID)), u.setValue("FreightCostRule", s.FreightCostRule), u.setValue("FreightAmt", s.FreightAmt), u.setValue("C_BPartner_ID", t.getValueOfInt(s.C_BPartner_ID)), u.setValue("C_BPartner_Location_ID", t.getValueOfInt(s.C_BPartner_Location_ID)), u.setValue("AD_OrgTrx_ID", t.getValueOfInt(s.AD_OrgTrx_ID)), u.setValue("C_Activity_ID", t.getValueOfInt(s.C_Activity_ID)), u.setValue("C_Campaign_ID", t.getValueOfInt(s.C_Campaign_ID)), u.setValue("C_Project_ID", t.getValueOfInt(s.C_Project_ID)), u.setValue("User1_ID", t.getValueOfInt(s.User1_ID)), u.setValue("User2_ID", t.getValueOfInt(s.User2_ID)), u.getField("C_IncoTerm_ID") != null && u.setValue("C_IncoTerm_ID", t.getValueOfInt(s.C_IncoTerm_ID)), c = u.getValue("IsReturnTrx"), c && (u.setValue("Orig_Order_ID", s.Orig_Order_ID), u.setValue("Orig_InOut_ID", s.Orig_InOut_ID), t.getValueOfString(s.IsDropShip) == "Y" ? u.setValue("IsDropShip", !0) : u.setValue("IsDropShip", !1)), u.setValue("M_Warehouse_ID", t.getValueOfInt(s.M_Warehouse_ID)), v.VA077_ && (s.VA077_HistoricContractDate != "" && u.setValue("VA077_HistoricContractDate", l(s.VA077_HistoricContractDate)), s.VA077_ChangeStartDate != "" && u.setValue("VA077_ChangeStartDate", l(s.VA077_ChangeStartDate)), s.VA077_ContractCPStartDate != "" && u.setValue("VA077_ContractCPStartDate", l(s.VA077_ContractCPStartDate)), s.VA077_ContractCPEndDate != "" && u.setValue("VA077_ContractCPEndDate", l(s.VA077_ContractCPEndDate)), u.setValue("VA077_PartialAmtCatchUp", t.getValueOfDecimal(s.VA077_PartialAmtCatchUp)), u.setValue("VA077_OldAnnualContractTotal", t.getValueOfDecimal(s.VA077_OldAnnualContractTotal)), u.setValue("VA077_AdditionalAnnualCharge", t.getValueOfDecimal(s.VA077_AdditionalAnnualCharge)), u.setValue("VA077_NewAnnualContractTotal", t.getValueOfDecimal(s.VA077_NewAnnualContractTotal)), u.setValue("VA077_SalesCoWorker", t.getValueOfDecimal(s.VA077_SalesCoWorker)), u.setValue("VA077_SalesCoWorkerPer", t.getValueOfDecimal(s.VA077_SalesCoWorkerPer)), u.setValue("VA077_TotalMarginAmt", t.getValueOfDecimal(s.VA077_TotalMarginAmt)), u.setValue("VA077_TotalPurchaseAmt", t.getValueOfDecimal(s.VA077_TotalPurchaseAmt)), u.setValue("VA077_TotalSalesAmt", t.getValueOfDecimal(s.VA077_TotalSalesAmt)), u.setValue("VA077_MarginPercent", t.getValueOfDecimal(s.VA077_MarginPercent)))) } catch (y) { this.setCalloutActive(!1); this.log.severe(y.toString()) } return i = r = u = f = e = o = null, "" }; s.prototype.DocType = function (r, u, f, e, o, s) { var c, v, h, l, a; if (o == null || o.toString() == "" || (c = t.getValueOfInt(o.toString()), c == null || c == 0)) return ""; v = "SELECT d.docBaseType, d.IsDocNoControlled, s.CurrentNext, d.IsReturnTrx FROM C_DocType d, AD_Sequence s WHERE C_DocType_ID=" + c + " AND d.DocNoSequence_ID=s.AD_Sequence_ID(+)"; h = null; try { r.setContext(u, "C_DocTypeTarget_ID", c); h = n.DB.executeReader(v, null, null); h.read() && (l = h.get("docbasetype"), a = h.get("isreturntrx") == "Y", l.equals("MMS") && !a ? f.setValue("MovementType", "C-") : l.equals("MMS") && a ? f.setValue("MovementType", "C+") : l.equals("MMR") && !a ? f.setValue("MovementType", "V+") : l.equals("MMR") && a && f.setValue("MovementType", "V-"), h.get("isdocnocontrolled") == "Y" && f.setValue("DocumentNo", "<" + h.get("currentnext") + ">")); h.close() } catch (y) { return this.setCalloutActive(!1), h != null && (h.close(), h = null), this.log.log(i.SEVERE, v, y), y.message } return r = u = f = e = o = s = null, "" }; s.prototype.BPartner = function (i, r, u, f, e, o) { var s = null, c = null, a, h, y, v, w, b, l; if (e == null || e.toString() == "") return ""; try { if (a = t.getValueOfInt(e.toString()), a == null || a == 0) return ""; var k = u.getValue("IsReturnTrx"), p = u.getValue("IsSOTrx"), d = u.getValue("C_Order_ID"), g = (!0).toString() + "," + a, s = n.dataContext.getJSONRecord("MBPartner/GetBPartnerOrderData", g); s != null && (h = s.C_BPartner_Location_ID, d == null && (h == 0 ? u.setValue("C_BPartner_Location_ID", null) : u.setValue("C_BPartner_Location_ID", h)), h = s.AD_User_ID, h == 0 ? u.setValue("AD_User_ID", null) : u.setValue("AD_User_ID", h), y = p ? s.C_IncoTerm_ID : s.C_IncoTermPO_ID, y > 0 && u.setValue("C_IncoTerm_ID", y), p & !k && (v = s.CreditStatusSettingOn, l = s.CreditAvailable, v == "CH" ? s.SOCreditStatus != null && (s.SOCreditStatus.equals("X") || l <= 0 && n.ADialog.info("CreditLimitOver")) : (w = t.getValueOfInt(u.getValue("C_BPartner_Location_ID")), c = n.dataContext.getJSONRecord("MBPartner/GetLocationData", w.toString()), c != null && (v = t.getValueOfString(c.CreditStatusSettingOn), v == "CL" && (b = t.getValueOfDouble(c.SO_CreditLimit), b != 0 && (l = t.getValueOfDouble(c.CreditAvailable), l <= 0 && n.ADialog.info("CreditOver"))))))) } catch (nt) { return this.setCalloutActive(!1), nt } return i = r = u = f = e = o = null, "" }; s.prototype.Warehouse = function (r, u, f, e, o, s) { var l, a, h, c, v; if (o == null || o.toString() == "" || this.isCalloutActive() || (l = t.getValueOfInt(o), l == null || l == 0)) return ""; this.setCalloutActive(!0); a = "SELECT w.AD_Org_ID, l.M_Locator_ID FROM M_Warehouse w LEFT OUTER JOIN M_Locator l ON (l.M_Warehouse_ID=w.M_Warehouse_ID AND l.IsDefault='Y') WHERE w.M_Warehouse_ID=" + l; h = null; try { h = n.DB.executeReader(a, null, null); h.read() && (c = t.getValueOfInt(h.get("ad_org_id")), v = r.getContextAsInt(u, "AD_Org_ID"), v != c && f.setValue("AD_Org_ID", c), c = t.getValueOfInt(h.get("m_locator_id")), c == 0 ? r.setContext(u, 0, "M_Locator_ID", null) : (this.log.config("M_Locator_ID=" + c), r.setContext(u, "M_Locator_ID", c))); h.close() } catch (y) { return this.setCalloutActive(!1), h != null && (h.close(), h = null), this.log.log(i.SEVERE, a, y), this.setCalloutActive(!1), y.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; s.prototype.OrderLine = function (i, r, u, f, e, o) { var h, v, a, c, p; if (e == null || e.toString() == "") return ""; if (this.setCalloutActive(!0), h = t.getValueOfInt(e.toString()), h == null || h == 0) return this.setCalloutActive(!1), ""; try { var c = h.toString(), y = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA077_"), s = n.dataContext.getJSONRecord("MOrderLine/GetOrderLine", c); t.getValueOfInt(s.GetID) != 0 && (t.getValueOfInt(s.M_Product_ID) > 0 ? (u.setValue("M_Product_ID", t.getValueOfInt(s.M_Product_ID)), u.setValue("C_Charge_ID", null)) : (u.setValue("C_Charge_ID", t.getValueOfInt(s.C_Charge_ID)), u.setValue("M_Product_ID", null)), u.setValue("PrintDescription", s.PrintDescription.toString()), u.setValue("M_AttributeSetInstance_ID", t.getValueOfInt(s.M_AttributeSetInstance_ID)), u.setValue("C_UOM_ID", t.getValueOfInt(s.C_UOM_ID)), v = t.getValueOfDecimal(s.QtyOrdered) - t.getValueOfDecimal(s.QtyDelivered), u.setValue("MovementQty", v), a = v, t.getValueOfDecimal(s.QtyEntered).toString().compareTo(t.getValueOfDecimal(s.QtyOrdered)) != t.getValueOfDecimal(s.QtyOrdered) && (a = a * t.getValueOfDecimal(s.QtyEntered) / t.getValueOfDecimal(s.QtyOrdered).toFixed(12)), u.setValue("QtyEntered", a), u.setValue("C_Activity_ID", t.getValueOfInt(s.C_Activity_ID)), u.setValue("C_Campaign_ID", t.getValueOfInt(s.C_Campaign_ID)), u.setValue("C_Project_ID", t.getValueOfInt(s.C_Project_ID)), u.setValue("C_ProjectPhase_ID", t.getValueOfInt(s.C_ProjectPhase_ID)), u.setValue("C_ProjectTask_ID", t.getValueOfInt(s.C_ProjectTask_ID)), u.setValue("AD_OrgTrx_ID", t.getValueOfInt(s.AD_OrgTrx_ID)), u.setValue("User1_ID", t.getValueOfInt(s.User1_ID)), u.setValue("User2_ID", t.getValueOfInt(s.User2_ID)), t.getValueOfBoolean(s.IsReturnTrx) && (u.setValue("Orig_OrderLine_ID", t.getValueOfInt(s.Orig_OrderLine_ID)), c = s.Orig_InOutLine_ID, p = n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine", c)), t.getValueOfString(s.IsDropShip) == "Y" ? u.setValue("IsDropShip", !0) : u.setValue("IsDropShip", !1), y.VA077_ && (u.setValue("VA077_CNAutodesk", t.getValueOfString(s.VA077_CNAutodesk)), u.setValue("VA077_Duration", t.getValueOfString(s.VA077_Duration)), u.setValue("VA077_MarginAmt", t.getValueOfDecimal(s.VA077_MarginAmt)), u.setValue("VA077_MarginPercent", t.getValueOfDecimal(s.VA077_MarginPercent)), u.setValue("VA077_OldSN", t.getValueOfString(s.VA077_OldSN)), u.setValue("VA077_ProductInfo", t.getValueOfString(s.VA077_ProductInfo)), u.setValue("VA077_PurchasePrice", t.getValueOfDecimal(s.VA077_PurchasePrice)), u.setValue("VA077_RegEmail", t.getValueOfString(s.VA077_RegEmail)), u.setValue("VA077_SerialNo", t.getValueOfString(s.VA077_SerialNo)), u.setValue("VA077_UpdateFromVersn", t.getValueOfString(s.VA077_UpdateFromVersn)), u.setValue("VA077_UserRef_ID", t.getValueOfInt(s.VA077_UserRef_ID)), u.setValue("VA077_ServiceContract_ID", t.getValueOfInt(s.VA077_ServiceContract_ID)), s.VA077_StartDate != "" && u.setValue("VA077_StartDate", l(s.VA077_StartDate)), s.VA077_EndDate != "" && u.setValue("VA077_EndDate", l(s.VA077_EndDate)), t.getValueOfBoolean(s.VA077_LicenceTracked) ? u.setValue("VA077_LicenceTracked", !0) : u.setValue("VA077_LicenceTracked", !1))) } catch (w) { this.setCalloutActive(!1); this.log.severe(w.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; s.prototype.Product = function (i, r, u, f, e, o) { var h, b, v, y, s, p, l, w, a; if (this.isCalloutActive() || e == null || e.toString() == "" || (h = t.getValueOfInt(e), h == 0)) return ""; this.setCalloutActive(!0); try { if (b = 0, u.setValue("M_AttributeSetInstance_ID", null), v = i.getWindowContext(r, "IsSOTrx", !0) == "Y", v) return this.setCalloutActive(!1), ""; y = h.toString(); s = n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID", y); u.setValue("C_UOM_ID", s); p = t.getValueOfDecimal(u.getValue("QtyEntered")); u.setValue("MovementQty", p); var k = "SELECT C_BPartner_ID FROM M_InOut WHERE M_InOut_ID = " + t.getValueOfInt(u.getValue("M_InOut_ID")), d = t.getValueOfInt(n.DB.executeScalar(k)), g = "SELECT vdr.C_UOM_ID FROM M_Product p LEFT JOIN M_Product_Po vdr ON p.M_Product_ID= vdr.M_Product_ID WHERE p.M_Product_ID=" + h + " AND vdr.C_BPartner_ID = " + d, c = t.getValueOfInt(n.DB.executeScalar(g)); s != 0 && (s != c && c != 0 ? (l = t.getValueOfDecimal(n.DB.executeScalar("SELECT trunc(multiplyrate,4) FROM C_UOM_Conversion WHERE C_UOM_ID = " + s + " AND C_UOM_To_ID = " + c + " AND M_Product_ID= " + h + " AND IsActive='Y'")), l > 0 ? u.setValue("QtyEntered", t.getValueOfInt(u.getValue("QtyEntered")) * l) : (w = t.getValueOfDecimal(n.DB.executeScalar("SELECT trunc(multiplyrate,4) FROM C_UOM_Conversion WHERE C_UOM_ID = " + s + " AND C_UOM_To_ID = " + c + " AND IsActive='Y'")), w > 0 && u.setValue("QtyEntered", t.getValueOfInt(u.getValue("QtyEntered")) * l)), u.setValue("C_UOM_ID", c)) : u.setValue("C_UOM_ID", s)); a = n.dataContext.getJSONRecord("MProduct/GetProduct", h.toString()); a != null && u.setValue("PrintDescription", a.DocumentNote) } catch (nt) { this.setCalloutActive(!1); this.log.severe(nt.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; s.prototype.Qty = function (r, u, f, e, o, s) { var y, c, h, l, w, nt, p, b, v, tt, it, k, d, a; if (this.isCalloutActive() || o == null || o.toString() == "") return ""; this.setCalloutActive(!0); try { if (y = r.getContextAsInt(u, "M_Product_ID"), this.log.log(i.WARNING, "qty - init - M_Product_ID=" + y), l = "", w = 0, y == 0) h = t.getValueOfDecimal(f.getValue("QtyEntered")), f.setValue("MovementQty", h); else if (e.getColumnName().toString().equals("C_UOM_ID")) a = o, h = t.getValueOfDecimal(f.getValue("QtyEntered")), l = a.toString(), w = n.dataContext.getJSONRecord("MUOM/GetPrecision", l), p = t.getValueOfDecimal(h.toFixed(w)), h.compareTo(p) != 0 && (this.log.fine("Corrected qtyEntered Scale UOM=" + a + "; qtyEntered=" + h + "->" + p), h = p, f.setValue("QtyEntered", h)), l = y.toString().concat(",", a.toString(), ",", h.toString()), c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", l), c == null && (c = h), v = h.compareTo(c) != 0, this.log.fine("UOM=" + a + ", qtyEntered=" + h + " -> " + v + " movementQty=" + c), r.setContext(u, "UOMConversion", v ? "Y" : "N"), f.setValue("MovementQty", c); else if (r.getContextAsInt(u, "C_UOM_ID") == 0) h = t.getValueOfDecimal(f.getValue("QtyEntered")), f.setValue("MovementQty", h); else if (e.getColumnName().toString().equals("QtyEntered")) { if (t.getValueOfInt(f.getValue("M_InOutLine_ID")) > 0 && (nt = n.dataContext.getJSONRecord("MInOutLine/GetInvoiceLine", f.getValue("M_InOutLine_ID").toString()), nt > 0)) return f.setValue("QtyEntered", s), this.setCalloutActive(!1), "VIS_CantChangeQty"; a = r.getContextAsInt(u, "C_UOM_ID"); h = t.getValueOfDecimal(o); l = y.toString(); w = n.dataContext.getJSONRecord("MProduct/GetUOMPrecision", l); p = t.getValueOfDecimal(h.toFixed(w)); h.compareTo(p) != 0 && (this.log.fine("Corrected qtyEntered Scale UOM=" + a + "; qtyEntered=" + h + "->" + p), h = p, f.setValue("QtyEntered", h)); l = y.toString().concat(",", a.toString(), ",", h.toString()); c = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", l); c == null && (c = h); v = h.compareTo(c) != 0; this.log.fine("UOM=" + a + ", qtyEntered=" + h + " -> " + v + " movementQty=" + c); r.setContext(u, "UOMConversion", v ? "Y" : "N"); f.setValue("MovementQty", c) } else e.getColumnName().toString().equals("MovementQty") && (a = r.getContextAsInt(u, "C_UOM_ID"), c = t.getValueOfDecimal(o), l = y.toString(), w = n.dataContext.getJSONRecord("MProduct/GetUOMPrecision", l), b = t.getValueOfDecimal(c.toFixed(w)), c.compareTo(b) != 0 && (this.log.fine("Corrected movementQty " + c + "->" + b), c = b, f.setValue("MovementQty", c)), l = y.toString().concat(",", a.toString(), ",", c.toString()), h = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", l), h == null && (h = c), v = c.compareTo(h) != 0, this.log.fine("UOM=" + a + ", movementQty=" + c + " -> " + v + " qtyEntered=" + h), r.setContext(u, "UOMConversion", v ? "Y" : "N"), f.setValue("QtyEntered", h)); if (tt = "Y".equals(r.getContext("IsReturnTrx")), y != 0 && tt && (it = t.getValueOfInt(f.getValue("C_OrderLine_ID")), l = it.toString(), k = n.dataContext.getJSONRecord("MOrderLine/GetOrderLine", l), k.Get_ID() != 0 && (d = k.Orig_InOutLine_ID, d != 0))) { var l = d.toString(), rt = n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine", l), g = rt.MovementQty; c = t.getValueOfDecimal(f.getValue("MovementQty")); g.toString().compareTo(c) < 0 && (r.getWindowContext(u, "IsSOTrx", !0) == "Y" ? n.ADialog.info("QtyShippedAndReturned") : n.ADialog.info("QtyRecievedAndReturnd"), f.setValue("MovementQty", g), c = g, a = r.getContextAsInt(u, "C_UOM_ID"), l = y.toString().concat(",", a.toString(), ",", c.toString()), h = n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", l), h == null && (h = c), f.setValue("QtyEntered", h), f.setValue("MovementQty", c), this.log.fine("qtyEntered : " + h.toString() + "movementQty : " + c.toString())) } } catch (ut) { this.setCalloutActive(!1); this.log.severe(ut.toString()) } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; s.prototype.Asi = function (i, r, u, f, e, o) { var s, a, h; if (this.isCalloutActive() || e == null || e.toString() == "" || (s = t.getValueOfInt(e), s == null || s == 0)) return ""; this.setCalloutActive(!0); try { if (t.getValueOfInt(u.getValue("M_Locator_ID")) == 0) { var v = i.getContextAsInt(r, "M_Product_ID"), c = i.getContextAsInt(r, "M_Warehouse_ID"), y = c.toString(), l = n.dataContext.getJSONRecord("MInOut/GetDefaultLocatorID", y); i.setContext(r, "M_Locator_ID", l); this.log.fine("M_Product_ID=" + v + ", M_ASI_ID=" + s + " - M_Warehouse_ID=" + c + ", M_Locator_ID=" + l); a = i.getContextAsInt(r, "M_AttributeSetInstance_ID"); s == a && (h = i.getContextAsInt(r, "M_Locator_ID"), h != 0 && (this.log.fine("Selected M_Locator_ID=" + h), u.setValue("M_Locator_ID", h))) } } catch (p) { this.setCalloutActive(!1); this.log.severe(p.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; s.prototype.Charge = function (i, r, u, f, e, o) { var s, h; if (this.isCalloutActive() || e == null || e.toString() == "" || (s = t.getValueOfInt(u.getValue("C_Charge_ID")), s == null || s == 0)) return ""; this.setCalloutActive(!0); try { h = n.dataContext.getJSONRecord("MCharge/GetChargeDetails", s.toString()); h != null && u.setValue("PrintDescription", h.PrintDescription) } catch (c) { this.setCalloutActive(!1); this.log.severe(c.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutInOut = s; n.Utility.inheritPrototype(ti, n.CalloutEngine); ti.prototype.Invoice = function (r, u, f, e, o, s) { var h, c, k, p, a, v, y; if (o == null || o.toString() == "" || (h = t.getValueOfInt(o), this.isCalloutActive() || h == null || h == 0)) return ""; var nt = r.getContextAsInt(u, "C_Payment_ID"), p = nt.toString(), w = null; if (w = n.dataContext.getJSONRecord("MPayment/GetPayment", p), w.C_Charge_ID != 0 || w.C_Invoice_ID != 0 || w.C_Order_ID != 0) return n.Msg.getMsg("PaymentIsAllocated"); this.setCalloutActive(!0); f.setValue("DiscountAmt", n.Env.ZERO); f.setValue("WriteOffAmt", n.Env.ZERO); f.setValue("OverUnderAmt", n.Env.ZERO); c = 0; r.getContextAsInt(u, "C_Invoice_ID") == h && r.getContextAsInt(u, "C_InvoicePaySchedule_ID") != 0 && (c = r.getContextAsInt(u, "C_InvoicePaySchedule_ID")); var b = 0, g = 0, l = null; try { l = n.dataContext.getJSONRecord("MInvoice/GetInvPaySchedDetail", h); l != null && (c = t.getValueOfInt(l.C_InvoicePaySchedule_ID), b = t.getValueOfDecimal(l.dueAmount), IsReturnTrx = l.IsReturnTrx, "Y" == IsReturnTrx && (b = b * -1), f.setValue("C_InvoicePaySchedule_ID", c), f.setValue("Amount", b), g = 1) } catch (d) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, "PaymentAllocate.Invoice -" + h, d.message), d.toString() } k = t.getValueOfDate(r.getContextAsTime(u, "DateTrx")); k == null && (k = new Date); p = h.toString() + "," + c.toString() + "," + k.toString(); a = null; try { a = n.dataContext.getJSONRecord("MPayment/GetInvoiceData", p); a != null && (v = t.getValueOfDecimal(a.invoiceOpen), v == null && (v = n.Env.ZERO), y = t.getValueOfDecimal(a.invoiceDiscount), y == null && (y = n.Env.ZERO), f.setValue("InvoiceAmt", v), g == 0 && f.setValue("Amount", v - y), f.setValue("DiscountAmt", y), r.setContext(u, "C_Invoice_ID", h.toString())) } catch (d) { return this.setCalloutActive(!1), d.message } return this.setCalloutActive(!1), r = u = f = e = o = s = null, "" }; ti.prototype.Amounts = function (i, r, u, f, e, o) { var d, g, b, k, p, w, it, y; if (this.isCalloutActive() || (d = i.getContextAsInt(r, "C_Invoice_ID"), d == 0)) return ""; this.setCalloutActive(!0); g = 0; u.getValue("C_InvoicePaySchedule_ID") != null && (g = u.getValue("C_InvoicePaySchedule_ID")); var a = n.Env.ZERO, v = "N", tt = 0, nt = !0, h = t.getValueOfDecimal(u.getValue("Amount")), c = t.getValueOfDecimal(u.getValue("DiscountAmt")), l = t.getValueOfDecimal(u.getValue("WriteOffAmt")), s = t.getValueOfDecimal(u.getValue("OverUnderAmt")), rt = t.getValueOfDecimal(u.getValue("InvoiceAmt")); return this.log.fine("Amt=" + h + ", Discount=" + c + ", WriteOff=" + l + ", OverUnder=" + s + ", Invoice=" + rt), b = i.getContext(r, "DateTrx"), b == null && (b = new Date), k = d.toString() + "," + g.toString() + "," + b.toString(), p = n.dataContext.getJSONRecord("MPayment/GetInvoiceData", k), p != null && (tt = t.getValueOfInt(p.C_Currency_ID), a = t.getValueOfDecimal(p.invoiceOpen), a == null && (a = n.Env.ZERO), n.Env.ZERO == c && (c = t.getValueOfDecimal(p.invoiceDiscount)), v = p.IsReturnTrx), v == "Y" ? (h > 0 && (h = h * -1, u.setValue("Amount", h)), c > 0 && (c = c * -1), l > 0 && (l = l * -1, u.setValue("WriteOffAmt", l)), s > 0 && (s = s * -1, u.setValue("OverUnderAmt", s)), a > 0 && (a = a * -1)) : (h < 0 && (h = h * -1, u.setValue("Amount", h)), c < 0 && (c = c * -1), l < 0 && (l = l * -1, u.setValue("WriteOffAmt", l)), s < 0 && (s = s * -1, u.setValue("OverUnderAmt", s)), a < 0 && (a = a * -1)), w = f.getColumnName(), k = tt.toString(), it = n.dataContext.getJSONRecord("MCurrency/GetCurrency", k), y = it.StdPrecision, w == "Amount" ? (s = a - h - c - l, (v == "N" && s > 0 || v == "Y" && s < 0) && n.ADialog.info("LessScheduleAmount"), (v == "Y" && s > 0 || v == "N" && s < 0) && (n.ADialog.info("MoreScheduleAmount"), h = a - c - l, s = a - h - c - l, nt ? u.setValue("Amount", h.toFixed(y)) : u.setValue("Amount", h)), nt ? (u.setValue("DiscountAmt", c.toFixed(y)), u.setValue("OverUnderAmt", s.toFixed(y))) : (u.setValue("DiscountAmt", c), u.setValue("OverUnderAmt", s))) : (h = a - c - l - s, (v == "Y" && h > 0 || v == "N" && h < 0) && (n.ADialog.info("MoreScheduleAmount"), w == "OverUnderAmt" && (h = a - c - l, s = a - h - c - l), w == "DiscountAmt" && (h = a - s - l, c = a - h - s - l), w == "WriteOffAmt" && (h = a - c - s, l = a - h - c - s)), nt ? (u.setValue("Amount", h.toFixed(y)), u.setValue("DiscountAmt", c.toFixed(y)), u.setValue("WriteOffAmt", l.toFixed(y)), u.setValue("OverUnderAmt", s.toFixed(y))) : (u.setValue("Amount", h), u.setValue("DiscountAmt", c), u.setValue("WriteOffAmt", l), u.setValue("OverUnderAmt", s)), (v == "N" && s > 0 || v == "Y" && s < 0) && n.ADialog.info("LessScheduleAmount")), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutPaymentAllocate = ti; n.Utility.inheritPrototype(h, n.CalloutEngine); h.prototype.Invoice = function (r, u, f, e, o) { var c, g, p, nt, s, tt, y, l; if (o == null || o.toString() == "" || (c = t.getValueOfInt(o.toString()), this.isCalloutActive() || c == null || c == 0)) return ""; this.setCalloutActive(!0); f.setValue("C_Order_ID", null); f.setValue("C_Charge_ID", null); f.setValue("IsPrepayment", !1); f.setValue("DiscountAmt", n.Env.ZERO); f.setValue("WriteOffAmt", n.Env.ZERO); f.setValue("IsOverUnderPayment", !1); f.setValue("OverUnderAmt", n.Env.ZERO); var a = 0, b = "", k = !1, it = f.getField("IsInDispute") != null, v = 0, d = 0, h = null; try { h = n.dataContext.getJSONRecord("MInvoice/GetInvPaySchedDetail", c.toString()); h != null && (a = t.getValueOfInt(h.C_InvoicePaySchedule_ID), v = t.getValueOfDecimal(h.dueAmount), b = t.getValueOfString(h.IsReturnTrx), "Y" == b && (v = v * -1), f.setValue("C_InvoicePaySchedule_ID", a), f.setValue("PayAmt", v), f.setValue("PaymentAmount", v), d = 1, g = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), g.VA009_ && (t.getValueOfString(h.VA009_PaymentBaseType) != "B" && t.getValueOfString(h.VA009_PaymentBaseType) != "C" && t.getValueOfString(h.VA009_PaymentBaseType) != "P" ? f.setValue("VA009_PaymentMethod_ID", t.getValueOfInt(h.VA009_PaymentMethod_ID)) : f.setValue("VA009_PaymentMethod_ID", null))) } catch (w) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, "CalloutPayment.Invoice -" + c, w.message), w.toString() } r.getContextAsInt(u, "C_Invoice_ID") == c && r.getContextAsInt(u, "C_InvoicePaySchedule_ID") != 0 && (a = r.getContextAsInt(u, "C_InvoicePaySchedule_ID")); p = new Date(f.getValue("DateTrx")); p == null && (p = new Date); nt = c.toString() + "," + a.toString() + "," + p.toString(); s = null; try { s = n.dataContext.getJSONRecord("MPayment/GetInvoiceData", nt); s != null && (f.setValue("C_BPartner_ID", t.getValueOfInt(s.C_BPartner_ID)), f.setValue("C_Bpartner_Location_Id", t.getValueOfInt(s.C_Bpartner_Location_Id)), tt = t.getValueOfInt(s.C_Currency_ID), f.setValue("C_Currency_ID", tt), f.setValue("C_ConversionType_ID", s.C_ConversionType_ID), y = t.getValueOfDecimal(s.invoiceOpen), y == null && (y = n.Env.ZERO), l = t.getValueOfDecimal(s.invoiceDiscount), l == null && (l = n.Env.ZERO), d == 0 && (f.setValue("PayAmt", y - l), f.setValue("PaymentAmount", y - l)), f.setValue("C_InvoicePaySchedule_ID", a), f.setValue("DiscountAmt", l), r.setContext(u, "C_Invoice_ID", c.toString()), k = t.getValueOfString(s.IsInDispute) == "Y", it && (k ? (f.setValue("IsInDispute", !0), n.ADialog.info("DiscrepancyInvoice")) : f.setValue("IsInDispute", !1))) } catch (w) { return this.setCalloutActive(!1), w.message } return this.setCalloutActive(!1), this.DocType(r, u, f, e, o) }; h.prototype.Order = function (r, u, f, e, o) { var c, l, h, v; if (o == null || o.toString() == "" || (c = o, this.isCalloutActive() || c == null || c == 0)) return ""; this.setCalloutActive(!0); f.setValue("C_Invoice_ID", null); f.setValue("C_Charge_ID", null); f.setValue("IsPrepayment", !0); f.setValue("DiscountAmt", n.Env.ZERO); f.setValue("WriteOffAmt", n.Env.ZERO); f.setValue("IsOverUnderPayment", !1); f.setValue("OverUnderAmt", n.Env.ZERO); l = f.getValue("DateTrx"); l == null && (l = new Date); var a = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), p = a.VA009_ + "," + c.toString(), s = null; try { s = n.dataContext.getJSONRecord("MPayment/GetOrderData", p); s != null && (f.setValue("C_BPartner_ID", t.getValueOfInt(s.C_BPartner_ID)), f.setValue("C_Bpartner_Location_Id", t.getValueOfInt(s.C_BPartner_Location_ID)), f.setValue("C_Currency_ID", t.getValueOfInt(s.C_Currency_ID)), f.setValue("C_ConversionType_ID", t.getValueOfInt(s.C_ConversionType_ID)), h = t.getValueOfDecimal(s.GrandTotal), h == null && (h = n.Env.ZERO), a.VA009_ && (v = t.getValueOfInt(s.VA009_PaymentMethod_ID), f.setValue("VA009_PaymentMethod_ID", v)), f.setValue("PaymentAmount", h), f.setValue("PayAmt", h), s.IsPrePayOrder == !0 ? f.getField("PaymentAmount").setReadOnly(!0) : f.getField("PaymentAmount").setReadOnly(!1)) } catch (y) { return s != null && (s = null), this.log.log(i.SEVERE, sql, y), this.setCalloutActive(!1), y.message } return this.setCalloutActive(!1), this.DocType(r, u, f, e, o) }; h.prototype.Charge = function (t, i, r, u, f) { if (f == null || f.toString() == "") return "" }; h.prototype.DocType = function (i, r, u, f, e, o) { var c = i.getContextAsInt(r, "C_Invoice_ID"), v = i.getContextAsInt(r, "C_Order_ID"), l = i.getContextAsInt(r, "C_DocType_ID"), y, p; this.log.fine("Payment_DocType - C_Invoice_ID=" + c + ", C_DocType_ID=" + l); var s = l.toString(), a = n.dataContext.getJSONRecord("MDocType/GetDocType", s), h = t.getValueOfBoolean(a.IsSOTrx); return (l != 0 && (i.setWindowContext(r, "IsSOTrx", h ? "Y" : "N"), u.setValue("IsReceipt", h ? "Y" : "N")), c != 0 && (s = c.toString(), y = n.dataContext.getJSONRecord("MInvoice/GetInvoice", s), a != null && t.getValueOfBoolean(y.IsSOTrx) != h)) ? n.Msg.getMsg("DocTypeInvInconsistent") : v != 0 && (s = v.toString(), p = n.dataContext.getJSONRecord("MOrder/GetOrder", s), a != null && t.getValueOfBoolean(p.IsSOTrx) != h) ? n.Msg.getMsg("DocTypeOrdInconsistent") : (i = r = u = f = e = o = null, "") }; h.prototype.AmountCurrencyType = function (r, u, f, e, o) { var l, c, h, s, a, y; if (this.isCalloutActive() || o == null || o.toString() == "") return f.setValue("OutStandingAmount", ""), ""; this.setCalloutActive(!0); l = f.getValue("C_BPartner_ID"); c = f.getValue("AsOnDate"); c = n.DB.to_date(c, !0); h = "SELECT LTRIM(MAX(SYS_CONNECT_BY_PATH( ConvertPrice, ',')),',') amounts FROM (SELECT ConvertPrice, ROW_NUMBER () OVER (ORDER BY ConvertPrice ) RN, COUNT (*) OVER () CNT FROM (SELECT iso_code || ':' || SUM(OpenAmt) AS ConvertPrice FROM (SELECT c.iso_code,  invoiceOpen (i.C_Invoice_ID,i.C_InvoicePaySchedule_ID)*MultiplierAP AS OpenAmt  FROM C_Invoice_V i LEFT JOIN C_Currency C ON C.C_Currency_ID=i.C_Currency_ID LEFT JOIN C_InvoicePaySchedule IPS ON IPS.c_invoice_ID = i.c_invoice_ID WHERE i.docstatus IN ('CO','CL') AND i.IsActive ='Y' AND i.ispaid ='N' AND ips.duedate IS NOT NULL AND NVL(ips.dueamt,0)!=0 AND i.c_bpartner_id = " + l + "AND to_date(ips.duedate,'dd-mm-yyyy')<= ( CASE WHEN to_date(" + c + ",'dd-mm-yyyy')>to_date(sysdate,'dd-mm-yyyy') THEN to_date(sysdate,'dd-mm-yyyy') ELSE to_date(" + c + ",'dd-mm-yyyy') END ) UNION SELECT c.iso_code, paymentAvailable(p.C_Payment_ID)*p.MultiplierAP*-1 AS OpenAmt FROM C_Payment_v p LEFT JOIN C_Currency C ON C.C_Currency_ID=p.C_Currency_ID LEFT JOIN c_payment pay ON (p.c_payment_id   =pay.c_payment_ID) WHERE p.IsAllocated  ='N' AND p.C_BPARTNER_ID = " + l + " AND p.DocStatus     IN ('CO','CL') AND to_date(pay.DateTrx,'dd-mm-yyyy')<=( CASE WHEN to_date(" + c + ",'dd-mm-yyyy')>to_date(sysdate,'dd-mm-yyyy') THEN to_date(sysdate,'dd-mm-yyyy') ELSE to_date(" + c + ",'dd-mm-yyyy') END ) ) GROUP BY iso_code ) ) WHERE RN = CNT START WITH RN = 1 CONNECT BY RN = PRIOR RN + 1 "; s = null; try { if (s = n.DB.executeReader(h, null, null), s.read()) { if (a = s.get("amounts"), h = "", h = "Select COUNT(AD_ModuleInfo_ID) From AD_ModuleInfo Where Prefix='VA027_' AND IsActive='Y'", y = t.getValueOfInt(n.DB.executeScalar(h)), y > 0) { h = ""; h = "SELECT LTRIM(MAX(SYS_CONNECT_BY_PATH( ConvertPrice, ',')),',') amounts                    FROM (SELECT ConvertPrice, ROW_NUMBER () OVER (ORDER BY ConvertPrice ) RN,                    COUNT (*) OVER () CNT FROM                      (SELECT ' PDC-'||iso_code|| ':'|| ROUND(SUM(PdcDue),2) AS ConvertPrice                     FROM (SELECT c.iso_code,                     CASE WHEN (pdc.VA027_MultiCheque = 'Y')                      THEN chk.VA027_ChequeAmount                      ELSE pdc.VA027_PayAmt END AS PdcDue                       FROM VA027_PostDatedCheck pdc LEFT JOIN VA027_ChequeDetails chk                       ON chk.VA027_PostDatedCheck_ID = pdc.VA027_PostDatedCheck_ID                       INNER JOIN C_Currency C ON C.C_Currency_ID=PDC.C_Currency_ID                       INNER JOIN C_DocType doc ON doc.C_DocType_ID = pdc.C_DocType_ID                      WHERE pdc.IsActive ='Y' AND doc.DocBaseType = 'PDR'                      AND pdc.DocStatus = 'CO'                       AND pdc.VA027_PAYMENTGENERATED ='N'                      AND pdc.VA027_PaymentStatus !=3                      AND ( CASE WHEN (pdc.VA027_MultiCheque = 'Y')                       THEN to_date(chk.VA027_CheckDate,'dd-mm-yyyy') ELSE to_date(pdc.VA027_CheckDate,'dd-mm-yyyy') END ) <= to_date(" + c + ", 'dd-mm-yyyy')                        AND PDC.c_bpartner_id = " + l + " UNION SELECT c.iso_code,                        CASE WHEN (pdc.VA027_MultiCheque = 'Y')                         THEN chk.VA027_ChequeAmount*-1                         ELSE pdc.VA027_PayAmt*-1 END AS PdcDue                         FROM VA027_PostDatedCheck pdc LEFT JOIN VA027_ChequeDetails chk                         ON chk.VA027_PostDatedCheck_ID = pdc.VA027_PostDatedCheck_ID                         INNER JOIN C_Currency C ON C.C_Currency_ID=pdc.C_Currency_ID                         INNER JOIN C_DocType doc ON doc.C_DocType_ID = pdc.C_DocType_ID                         WHERE pdc.IsActive ='Y' AND doc.DocBaseType = 'PDP'                         AND pdc.VA027_PAYMENTGENERATED ='N'                         AND pdc.VA027_PaymentStatus !=3                         AND ( CASE WHEN (pdc.VA027_MultiCheque = 'Y')                       THEN to_date(chk.VA027_CheckDate,'dd-mm-yyyy') ELSE to_date(pdc.VA027_CheckDate,'dd-mm-yyyy') END ) <= to_date(" + c + ", 'dd-mm-yyyy')                        AND pdc.c_bpartner_id = " + l + ") GROUP BY iso_code                       )                     )                     WHERE RN = CNT                    START WITH RN = 1                     CONNECT BY RN = PRIOR RN + 1"; s = null; try { s = n.DB.executeReader(h, null, null); s.read() && s.get("amounts") != null && s.get("amounts").toUpper().indexOf("NULL") == -1 && (a = a + " PDC-" + s.get("amounts")) } catch (v) { return s != null && (s.close(), s = null), this.log.log(i.SEVERE, h, v), this.setCalloutActive(!1), v.message } } f.setValue("OutStandingAmount", a) } s.close() } catch (v) { return s != null && (s.close(), s = null), this.log.log(i.SEVERE, h, v), this.setCalloutActive(!1), v.message } return this.setCalloutActive(!1), "" }; h.prototype.Amounts = function (r, u, f, e, o, s) { var k, rt, w, et, ut, ft, g, at, vt, yt; if (this.isCalloutActive() || (k = r.getContextAsInt(u, "C_Invoice_ID"), r.getContextAsInt(u, "C_Payment_ID") == 0 && r.getContextAsInt(u, "C_BPartner_ID") == 0 && k == 0) || (rt = f.getValue("C_Currency_ID"), rt == null)) return ""; if (k != 0) { this.setCalloutActive(!0); w = e.getColumnName(); et = 0; r.getContextAsInt(u, "C_Invoice_ID") == k && f.getValue("C_InvoicePaySchedule_ID") != null && (et = f.getValue("C_InvoicePaySchedule_ID")); var a = n.Env.ZERO, l = n.Env.ZERO, d = 0, ot = 0, b = "N", st = !0; k != 0 && (ut = f.getValue("DateTrx"), ut == null && (ut = new Date), ft = k.toString() + "," + et.toString() + "," + ut.toString(), g = n.dataContext.getJSONRecord("MPayment/GetInvoiceData", ft), g != null && (d = t.getValueOfInt(g.C_Currency_ID), ot = t.getValueOfInt(g.C_ConversionType_ID), a = t.getValueOfDecimal(g.invoiceOpen), a == null && (a = n.Env.ZERO), l = t.getValueOfDecimal(g.invoiceDiscount), b = g.IsReturnTrx)); this.log.fine("Open=" + a + " Discount= " + l + ", C_Invoice_ID=" + k + ", C_Currency_ID=" + d); w == "PaymentAmount" && f.setValue("PayAmt", f.getValue("PaymentAmount")); var h = t.getValueOfDecimal(f.getValue("PayAmt") == null ? n.Env.ZERO : f.getValue("PayAmt")), v = t.getValueOfDecimal(f.getValue("WriteOffAmt") == null ? n.Env.ZERO : f.getValue("WriteOffAmt")), c = t.getValueOfDecimal(f.getValue("OverUnderAmt") == null ? n.Env.ZERO : f.getValue("OverUnderAmt")), y = t.getValueOfDecimal(f.getValue("DiscountAmt") == null ? n.Env.ZERO : f.getValue("DiscountAmt")); b == "Y" ? (h > 0 ? (h = h * -1, f.setValue("PayAmt", h), f.setValue("PaymentAmount", h)) : f.setValue("PaymentAmount", h), y > 0 && (y = y * -1), l > 0 && (l = l * -1), v > 0 && (v = v * -1, f.setValue("WriteOffAmt", v)), c > 0 && (c = c * -1, f.setValue("OverUnderAmt", c)), a > 0 && (a = a * -1)) : (h < 0 ? (h = h * -1, f.setValue("PayAmt", h), f.setValue("PaymentAmount", h)) : f.setValue("PaymentAmount", h), y < 0 && (y = y * -1), l < 0 && (l = l * -1), v < 0 && (v = v * -1, f.setValue("WriteOffAmt", v)), c < 0 && (c = c * -1, f.setValue("OverUnderAmt", c)), a < 0 && (a = a * -1)); this.log.fine("Pay=" + h + ", Discount=" + y + ", WriteOff=" + v + ", OverUnderAmt=" + c); var tt = t.getValueOfInt(rt), ft = tt.toString(), it = n.dataContext.getJSONRecord("MCurrency/GetCurrency", ft), p = it.StdPrecision, ct = f.getValue("DateAcct"), ht = 0, lt = t.getValueOfInt(f.getValue("C_ConversionType_ID")); lt != null && (ht = lt); var wt = r.getContextAsInt(u, "AD_Client_ID"), bt = r.getContextAsInt(u, "AD_Org_ID"), nt = n.Env.ONE; if (tt > 0 && d > 0 && tt != d || w == "C_Currency_ID" || w == "C_ConversionType_ID") { if (this.log.fine("InvCurrency=" + d + ", PayCurrency=" + tt + ", Date=" + ct + ", Type=" + ht), at = d + "," + tt + "," + ct + "," + ht + "," + wt + "," + bt, nt = n.dataContext.getJSONRecord("MConversionRate/GetRate", at), nt == null || nt.toString() == 0) { if (this.setCalloutActive(!1), d == 0) return ""; if (f.setValue("C_Currency_ID", d), w == "C_ConversionType_ID") { if (ot == 0) return ""; f.setValue("C_ConversionType_ID", ot) } return "NoCurrencyConversion" } a = t.getValueOfDecimal((a * nt).toFixed(it.StdPrecision)); y != 0 && (l = y); l = t.getValueOfDecimal((l * nt).toFixed(it.StdPrecision)); this.log.fine("Rate=" + nt + ", InvoiceOpenAmt=" + a + ", DiscountAmt=" + l) } w == "C_Currency_ID" || w == "C_ConversionType_ID" ? (v = 0, f.setValue("WriteOffAmt", v), c = 0, f.setValue("OverUnderAmt", c), y = 0, f.setValue("DiscountAmt", y), l = y, h = a - l - v - c, f.setValue("PayAmt", t.getValueOfDecimal(h.toFixed(p))), f.setValue("PaymentAmount", t.getValueOfDecimal(h.toFixed(p)))) : k == 0 ? (n.Env.ZERO != l && f.setValue("DiscountAmt", n.Env.ZERO), n.Env.ZERO != v && f.setValue("WriteOffAmt", n.Env.ZERO), n.Env.ZERO != c && f.setValue("OverUnderAmt", n.Env.ZERO)) : w == "PayAmt" || w == "PaymentAmount" ? (y != 0 && (l = y), c = a - h - l - v, (b == "N" && c > 0 || b == "Y" && c < 0) && n.ADialog.info("LessScheduleAmount"), (b == "Y" && c > 0 || b == "N" && c < 0) && (n.ADialog.info("MoreScheduleAmount"), h = a - l - v, c = a - h - l - v, st ? (f.setValue("PayAmt", t.getValueOfDecimal(h.toFixed(p))), f.setValue("PaymentAmount", t.getValueOfDecimal(h.toFixed(p)))) : (f.setValue("PayAmt", h), f.setValue("PaymentAmount", h))), st ? (f.setValue("DiscountAmt", t.getValueOfDecimal(l.toFixed(p))), f.setValue("OverUnderAmt", t.getValueOfDecimal(c.toFixed(p)))) : (f.setValue("DiscountAmt", l), f.setValue("OverUnderAmt", c))) : (l = y, h = a - l - v - c, (b == "Y" && h > 0 || b == "N" && h < 0) && (n.ADialog.info("MoreScheduleAmount"), w == "OverUnderAmt" && (h = a - l - v, c = a - h - l - v), w == "DiscountAmt" && (h = a - c - v, l = a - h - c - v), w == "WriteOffAmt" && (h = a - l - c, v = a - h - l - c)), st ? (f.setValue("PayAmt", t.getValueOfDecimal(h.toFixed(p))), f.setValue("PaymentAmount", t.getValueOfDecimal(h.toFixed(p))), f.setValue("DiscountAmt", t.getValueOfDecimal(l.toFixed(p))), f.setValue("WriteOffAmt", t.getValueOfDecimal(v.toFixed(p))), f.setValue("OverUnderAmt", t.getValueOfDecimal(c.toFixed(p)))) : (f.setValue("PayAmt", h), f.setValue("PaymentAmount", h), f.setValue("DiscountAmt", l), f.setValue("WriteOffAmt", v), f.setValue("OverUnderAmt", c)), (b == "N" && c > 0 || b == "Y" && c < 0) && n.ADialog.info("LessScheduleAmount")); this.setCalloutActive(!1) } else { this.setCalloutActive(!0); try { if ((t.getValueOfInt(f.getValue("C_Order_ID")) > 0 && t.getValueOfInt(f.getValue("VA009_OrderPaySchedule_ID")) == 0 || t.getValueOfInt(f.getValue("C_Order_ID")) == 0 && t.getValueOfInt(f.getValue("VA009_OrderPaySchedule_ID")) == 0 && t.getValueOfInt(f.getValue("C_Invoice_ID")) == 0 && t.getValueOfInt(f.getValue("C_InvoicePaySchedule_ID")) == 0) && f.setValue("PayAmt", t.getValueOfDecimal(f.getValue("PaymentAmount"))), vt = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA026_"), vt.VA026_ && e.getColumnName() == "PaymentAmount" && (yt = n.dataContext.getJSONRecord("MDocType/GetDocType", f.getValue("C_DocType_ID")), !t.getValueOfBoolean(yt.IsSOTrx))) { var it = n.dataContext.getJSONRecord("MCurrency/GetCurrency", rt), p = it.StdPrecision, kt = t.getValueOfDecimal(f.getValue("PaymentAmount")) / t.getValueOfDecimal(f.getValue("VA026_Interest") / 100 + 1).toString(); f.setValue("VA026_InterestAmt", t.getValueOfDecimal(kt.toFixed(p))); f.setValue("VA026_InterestAmount", t.getValueOfDecimal((f.getValue("PaymentAmount") - f.getValue("VA026_InterestAmt")).toFixed(p))) } this.setCalloutActive(!1) } catch (pt) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, sql, pt), pt } } return r = u = f = e = o = s = null, "" }; h.prototype.BankAccount = function (i, r, u, f, e, o) { var s, h; if (e == null || e.toString() == "" || (s = e, this.isCalloutActive())) return ""; this.setCalloutActive(!0); try { h = t.getValueOfInt(n.dataContext.getJSONRecord("MPayment/GetBankAcctCurrency", s.toString())); u.setValue("C_Currency_ID", h); su(u) } catch (c) { return this.setCalloutActive(!1), c.message } return this.setCalloutActive(!1), i = u = f = e = o = null, "" }; h.prototype.SetOverrideAutoCheck = function (n, t, i, r, u, f) { if (u == null || u.toString() == "") return i.setValue("IsOverrideAutoCheck", !1), ""; if (this.isCalloutActive()) return ""; this.setCalloutActive(!0); try { su(i) } catch (e) { return this.setCalloutActive(!1), e.message } return this.setCalloutActive(!1), n = i = r = u = f = null, "" }; h.prototype.ProvisionalInvoice = function (i, r, u, f, e, o) { var s, h; if (e == null || e.toString() == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); try { s = n.dataContext.getJSONRecord("MPayment/GetProvisionalInvoiceData", t.getValueOfInt(u.getValue("C_ProvisionalInvoice_ID"))); s != null && (u.setValue("C_BPartner_ID", s.C_BPartner_ID), u.setValue("C_BPartner_Location_ID", s.C_BPartner_Location_ID), u.setValue("PaymentAmount", s.GrandTotal), u.setValue("PayAmt", s.GrandTotal), u.setValue("C_Currency_ID", s.C_Currency_ID), u.setValue("C_ConversionType_ID", s.C_ConversionType_ID), h = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), h.VA009_) } catch (c) { this.setCalloutActive(!1); this.log.severe(c.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutPayment = h; n.Utility.inheritPrototype(w, n.CalloutEngine); w.prototype.DocType = function (r, u, f, o, s, h) { var ot = "O", st = "S", ot = "O", st = "S", ut = "F", nt = "PR", b = "WR", y = "", d, g, w, tt, it, a, ft, l, p, c, et; try { if (s == null || s.toString() == "" || (d = s, d == null || d == 0)) return ""; if (g = f.getValue("DocumentNo"), w = g == null, !w && g.toString().startsWith("<") && g.toString().endsWith(">") && (w = !0), tt = f.getValue("C_DocType_ID"), y = "SELECT d.DocSubTypeSO,d.HasCharges,'N',d.IsDocNoControlled,s.CurrentNext,s.CurrentNextSys,s.AD_Sequence_ID,d.IsSOTrx, d.IsReturnTrx FROM C_DocType d LEFT OUTER JOIN AD_Sequence s ON (d.DocNoSequence_ID=s.AD_Sequence_ID) WHERE C_DocType_ID=", it = 0, a = null, w || tt == 0) y = y + d, a = n.DB.executeDataset(y, null); else for (y = y + tt, a = n.DB.executeDataset(y, null), l = 0; l < a.getTables()[0].rows.count; l++)it = t.getValueOfInt(a.getRows()[l].getCell("AD_Sequence_ID")); var v = "", k = !0, rt = !1; for (l = 0; l < a.getTables()[0].rows.count; l++)if (v = t.getValueOfString(a.getRows()[l].getCell("DocSubTypeSO")), v == null && (v = "--"), r.setContext(u, "OrderType", v), v.toString().equals("SO") || f.setValue("IsDropShip", "N"), "N".toString().equals(t.getValueOfString(a.getRows()[l].getCell("IsSOTrx"))) && (k = !1), rt = "Y".toString().equals(t.getValueOfString(a.getRows()[l].getCell("IsReturnTrx"))), rt ? v.toString().equals(b) ? f.setValue("DeliveryRule", ut) : f.setValue("DeliveryRule", "M") : (v.toString().equals(b) ? f.setValue("DeliveryRule", ut) : v.toString().equals(nt) ? f.setValue("DeliveryRule", "R") : f.setValue("DeliveryRule", "A"), v.toString().equals(b) || v.toString().equals(nt) || v.toString().equals("WI") ? f.setValue("InvoiceRule", "I") : f.setValue("InvoiceRule", "D"), v.toString().equals(b) ? f.setValue("PaymentRule", PAYMENTRULE_Cash) : f.setValue("PaymentRule", PAYMENTRULE_OnCredit), r.setContext(u, "HasCharges", t.getValueOfString(a.getRows()[l].getCell("HasCharges")))), p[3].toString().equals("Y") && (w || it == t.getValueOfInt(a.getRows()[l].getCell("AD_Sequence_ID")) || (w = !0), w)) try { f.setValue("DocumentNo", "<" + t.getValueOfString(a.getRows()[l].getCell("CurrentNext")) + ">") } catch (ht) { this.setCalloutActive(!1) } if (rt) return ""; if (!v.toString().equals(b) && !v.toString().equals(nt)) for (ft = r.getContextAsInt(u, "C_BPartner_ID"), y = "SELECT PaymentRule,C_PaymentTerm_ID,InvoiceRule,DeliveryRule,FreightCostRule,DeliveryViaRule, PaymentRulePO,PO_PaymentTerm_ID FROM C_BPartner WHERE C_BPartner_ID=" + ft, a = n.DB.executeDataset(y, null), l = 0; l < a.getTables()[0].rows.count; l++)p = a.getTables()[0].rows[l], c = t.getValueOfString(p.get(k ? "paymentrule" : "paymentrulepo")), c != null && c.toString().length != 0 && (k && (c.toString().equals("B") || c.toString().equals("S") || c.toString().equals("U")) && (c = "P"), !k && c.toString().equals("B") && (c = "P"), f.setValue("PaymentRule", c)), et = t.getValueOfInt(p.get(k ? "c_paymentterm_id" : "po_paymentterm_id")), p != null && f.setValue("C_PaymentTerm_ID", et), c = p[2].toString(), c != null && c.length != 0 && f.setValue("InvoiceRule", c), c = p[3].toString(), c != null && c.length != 0 && f.setValue("DeliveryRule", c), c = p[4].toString(), c != null && c.length != 0 && f.setValue("FreightCostRule", c), c = p[5].toString(), c != null && c.length != 0 && f.setValue("DeliveryViaRule", c) } catch (ht) { return this.setCalloutActive(!1), this.log.log(i.SEVERE, y, ht), e.message } return r = u = f = o = s = h = null, "" }; w.prototype.BPartner = function (r, u, f, o, s, h) { var et = "O", ot = "S", et = "O", ot = "S", k = "", a, rt, v, d, b, l, y, g, p, nt, w, tt, ut, ft, c, it; try { if (s == null || s == 0 || s.toString() == "" || (a = 0, s != null && (a = t.getValueOfInt(s.toString())), a == 0) || (rt = f.getValue("IsReturnTrx"), rt)) return ""; for (this.setCalloutActive(!0), k = "SELECT p.AD_Language,p.C_PaymentTerm_ID, COALESCE(p.M_PriceList_ID,g.M_PriceList_ID) AS M_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted, p.InvoiceRule,p.DeliveryRule,p.FreightCostRule,DeliveryViaRule, p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable, lship.C_BPartner_Location_ID,c.AD_User_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID, lbill.C_BPartner_Location_ID AS Bill_Location_ID, p.SOCreditStatus, lbill.IsShipTo FROM C_BPartner p INNER JOIN C_BP_Group g ON (p.C_BP_Group_ID=g.C_BP_Group_ID) LEFT OUTER JOIN C_BPartner_Location lbill ON (p.C_BPartner_ID=lbill.C_BPartner_ID AND lbill.IsBillTo='Y' AND lbill.IsActive='Y') LEFT OUTER JOIN C_BPartner_Location lship ON (p.C_BPartner_ID=lship.C_BPartner_ID AND lship.IsShipTo='Y' AND lship.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID=" + a + " AND p.IsActive='Y'", v = r.getWindowContext(u, "IsSOTrx", !0) == "Y", d = n.DB.executeDataset(k, null), b = 0; b < d.getTables()[0].rows.count; b++)l = d.getTables()[0].rows[b], y = t.getValueOfInt(l.get(v ? "m_pricelist_id" : "po_pricelist_id")), l != null && y != 0 && f.setValue("M_PriceList_ID", y), f.setValue("Bill_BPartner_ID", a), g = t.getValueOfInt(l.get("bill_location_id")), g == 0 ? f.setValue("Bill_Location_ID", null) : f.setValue("Bill_Location_ID", g), p = t.getValueOfInt(l.get("c_bpartner_location_id")), a.toString().equals(r.getContext("C_BPartner_ID")) && (nt = r.getContext("C_BPartner_Location_ID"), nt.toString().length > 0 && (p = int.Parse(nt))), p == 0 ? f.setValue("C_BPartner_Location_ID", null) : (f.setValue("C_BPartner_Location_ID", p), "Y".toString().equals(t.getValueOfString(l.get("isshipto"))) && f.setValue("Bill_Location_ID", p)), w = t.getValueOfInt(l.get("ad_user_id").toString()), a.toString().toString().equals(r.getContext("C_BPartner_ID")) && (tt = r.getContext("AD_User_ID"), tt.toString().length > 0 && (w = t.getValueOfInt(tt))), w == 0 ? f.setValue("AD_User_ID", null) : (f.setValue("AD_User_ID", w), f.setValue("Bill_User_ID", w)), v && (ut = t.getValueOfDouble(l.get("so_creditlimit")), ut != 0 && (ft = t.getValueOfDouble(l.get("creditavailable")), l != null && ft < 0)), c = l.get("poreference").toString(), c != null && c.toString().length != 0 && f.setValue("POReference", c), c = t.getValueOfString(l.get("so_description")), c != null && c.toString().trim().length != 0 && f.setValue("Description", c), c = t.getValueOfString(l.get("isdiscountprinted")), c != null && c.toString().length != 0 ? f.setValue("IsDiscountPrinted", c) : f.setValue("IsDiscountPrinted", "N"), it = r.getContext("OrderType"), f.setValue("InvoiceRule", "D"), f.setValue("DeliveryRule", "A"), f.setValue("PaymentRule", PAYMENTRULE_OnCredit), it.toString().equals("PR") ? (f.setValue("InvoiceRule", "I"), f.setValue("DeliveryRule", "R")) : it.toString().equals(MOrder.DocSubTypeSO_POS) ? f.setValue("PaymentRule", PAYMENTRULE_Cash) : (c = l[v ? "PaymentRule" : "PaymentRulePO"].toString(), c != null && c.length != 0 && (c.toString().equals("B") && (c = "P"), v && (c.toString().equals("S") || c.toString().equals("U")) && (c = "P"), f.setValue("PaymentRule", c)), y = t.getValueOfInt(l.get(v ? "c_paymentterm_id" : "po_paymentterm_id")), l != null && y != 0 && f.setValue("C_PaymentTerm_ID", y), c = t.getValueOfString(l.get("invoicerule")), c != null && c.length != 0 && f.setValue("InvoiceRule", c), c = t.getValueOfString(l.get("deliveryrule")), c != null && c.length != 0 && f.setValue("DeliveryRule", c), c = t.getValueOfString(l.get("freightcostrule")), c != null && c.length != 0 && f.setValue("FreightCostRule", c), c = t.getValueOfString(l.get("deliveryviarule")), c != null && c.length != 0 && f.setValue("DeliveryViaRule", c)) } catch (st) { return this.log.log(i.SEVERE, k, st), this.setCalloutActive(!1), e.message } return this.setCalloutActive(!1), r = u = f = o = s = h = null, "" }; w.prototype.Product = function (i, u, e, o, s) { var c, b, p, nt, h, l, tt, y, w, ft; if (s == null || s == 0 || s.toString() == "") return ""; try { if ((c = s, c == null || c == 0) || (b = "Y".toString().equals(i.getContext("IsReturnTrx")), b)) return ""; this.setCalloutActive(!0); f && this.log.warning("init"); e.setValue("C_Charge_ID", null); e.setValue("M_AttributeSetInstance_ID", null); var et = i.getContextAsInt(u, "C_BPartner_ID"), ot = t.getValueOfDecimal(e.getValue("QtyEntered")), k = i.getWindowContext(u, "IsSOTrx", !0) == "Y", d = i.getContextAsInt(u, "M_PriceList_ID"), st = d.toString().concat(",", t.getValueOfString(e.getValue("StartDate")), ",", t.getValueOfString(e.getValue("M_Product_ID")), ",", t.getValueOfInt(e.getValue("C_UOM_ID")), ",", t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))), g = n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID_On_Transaction_Date", st), ht = e.getValue("DateOrdered"), a = "SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'"; if (r = t.getValueOfInt(n.DB.executeScalar(a)), p = 0, r > 0 && (a = "SELECT C_UOM_ID FROM M_Product_PO WHERE IsActive = 'Y' AND  C_BPartner_ID = " + t.getValueOfInt(e.getValue("C_BPartner_ID")) + " AND M_Product_ID = " + c, p = t.getValueOfInt(n.DB.executeScalar(a)), p > 0 && k == !1 ? e.setValue("C_UOM_ID", p) : (a = "SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_Product_ID = " + c, e.setValue("C_UOM_ID", t.getValueOfInt(n.DB.executeScalar(a))))), nt = t.getValueOfInt(e.getValue("C_UOM_ID")), l = c.toString().concat(",", et.toString(), ",", ot.toString(), ",", k, ",", d.toString(), ",", g.toString(), ",", null, ",", null, ",", null, ",", nt, ",", r), t.getValueOfInt(g) > 0 && (h = null, h = n.dataContext.getJSONRecord("MProductPricing/GetProductPricing", l), e.setValue("PriceList", h.PriceList), e.setValue("PriceLimit", h.PriceLimit), e.setValue("PriceActual", h.PriceActual), e.setValue("PriceEntered", h.PriceEntered), t.getValueOfInt(h.C_Currency_ID) > 0 && e.setValue("C_Currency_ID", t.getValueOfInt(h.C_Currency_ID)), e.setValue("Discount", h.Discount), e.setValue("C_UOM_ID", t.getValueOfInt(h.C_UOM_ID)), e.setValue("QtyOrdered", e.getValue("QtyEntered")), i.setContext(u, "EnforcePriceLimit", h.IsEnforcePriceLimit ? "Y" : "N"), i.setContext(u, "DiscountSchema", h.IsDiscountSchema ? "Y" : "N")), i.getWindowContext(u, "IsSOTrx", !0) == "Y" && (l = c.toString() + ",0", tt = n.dataContext.getJSONRecord("MProduct/GetProduct", l), tt)) { var it = t.getValueOfDecimal(e.getValue("QtyEntered")), rt = i.getContextAsInt(u, "M_Warehouse_ID"), ut = i.getContextAsInt(u, "M_AttributeSetInstance_ID"), l = rt + "," + c + "," + ut, v = n.dataContext.getJSONRecord("MStorage/GetQtyAvailable", l); v == null && (v = n.Env.ZERO); v == 0 || v.toString().compareTo(it) < 0 || (y = 0, e.getValue("C_OrderLine_ID") != null && (y = t.getValueOfInt(e.getValue("C_OrderLine_ID"))), y == null && (y = 0), l = rt.toString() + "," + c.toString() + "," + ut.toString() + "," + y.toString(), w = t.getValueOfDecimal(n.dataContext.getJSONRecord("MOrderLine/GetNotReserved", l)), w == null && (w = n.Env.ZERO), ft = v - w, ft.toString().compareTo(it) < 0) } this.setCalloutActive(!1); f && this.log.warning("fini") } catch (ct) { this.setCalloutActive(!1) } return this.Tax(i, u, e, o, s) }; w.prototype.Tax = function (i, r, u, f, e) { var o = 0, s = n.Env.ZERO, h = n.Env.ZERO, a = "", c, l; return o = t.getValueOfInt(u.getValue("C_Tax_ID")), c = "select rate from c_tax WHERE c_tax_id=" + o + "", s = t.getValueOfDecimal(n.DB.executeScalar(c, null, null)), a = this.Amt(i, r, u, f, e), l = t.getValueOfDecimal(u.getValue("LineNetAmt")), h = t.getValueOfDecimal(t.getValueOfDecimal(l) * t.getValueOfDecimal(s) / 100), u.setValue("taxamt", h), this.Amt(i, r, u, f, e) }; w.prototype.Amt = function (i, u, e, o, s, h) { var ft, it, st, a, y, g; if (this.isCalloutActive() || s == null || s.toString() == "") return ""; this.setCalloutActive(!0); try { f && this.log.warning("init"); var d = i.getContextAsInt(u, "C_UOM_ID"), p = i.getContextAsInt(u, "M_Product_ID"), rt = i.getContextAsInt(u, "M_PriceList_ID"), ct = rt.toString(), y = n.dataContext.getJSONRecord("MPriceList/GetPriceList", ct), nt = t.getValueOfInt(y.StdPrecision), k, c, l, w, v, b; if (k = t.getValueOfDecimal(e.getValue("QtyEntered")), k = t.getValueOfDecimal(e.getValue("QtyEntered")), this.log.fine("QtyEntered=" + k + ", Ordered=" + k + ", UOM=" + d), c = t.getValueOfDecimal(e.getValue("PriceEntered")), l = t.getValueOfDecimal(e.getValue("PriceActual")), v = t.getValueOfDecimal(e.getValue("Discount")), w = t.getValueOfDecimal(e.getValue("PriceLimit")), b = t.getValueOfDecimal(e.getValue("PriceList")), this.log.fine("PriceList=" + b + ", Limit=" + w + ", Precision=" + nt), this.log.fine("PriceEntered=" + c + ", Actual=" + l + ", Discount=" + v), (o.getColumnName().toString().equals("QtyEntered") || o.getColumnName().toString().equals("QtyEntered") || o.getColumnName().toString().equals("M_Product_ID")) && !"N".toString().equals(i.getContext("DiscountSchema"))) { ft = i.getContextAsInt(u, "C_BPartner_ID"); o.getColumnName().toString().equals("QtyEntered") && (a = p.toString() + "," + d.toString() + "," + k.toString(), k = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", a))); var et = i.getWindowContext(u, "IsSOTrx", !0) == "Y", lt = rt.toString().concat(",", t.getValueOfString(e.getValue("StartDate")), ",", t.getValueOfString(e.getValue("M_Product_ID")), ",", t.getValueOfInt(e.getValue("C_UOM_ID")), ",", t.getValueOfInt(e.getValue("M_AttributeSetInstance_ID"))), ot = n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID_On_Transaction_Date", lt), tt = "SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'"; r = t.getValueOfInt(n.DB.executeScalar(tt)); it = 0; r > 0 && (tt = "SELECT C_UOM_ID FROM M_Product_PO WHERE IsActive = 'Y' AND  C_BPartner_ID = " + t.getValueOfInt(e.getValue("C_BPartner_ID")) + " AND M_Product_ID = " + p, it = t.getValueOfInt(n.DB.executeScalar(tt)), it > 0 && et == !1 ? e.setValue("C_UOM_ID", it) : (tt = "SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_Product_ID = " + p, e.setValue("C_UOM_ID", t.getValueOfInt(n.DB.executeScalar(tt))))); st = t.getValueOfInt(e.getValue("C_UOM_ID")); a = p.toString().concat(",", ft.toString(), ",", k.toString(), ",", et, ",", rt.toString(), ",", ot.toString(), ",", null, ",", null, ",", null, ",", st, ",", r); t.getValueOfInt(ot) > 0 && (y = null, y = n.dataContext.getJSONRecord("MProductPricing/GetProductPricing", a), a = p.toString() + "," + d.toString() + "," + y.PriceStd.toString(), c = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a)), (c == null || c == 0) && (c = y.PriceStd), this.log.fine("QtyChanged -> PriceActual=" + y.PriceStd + ", PriceEntered=" + c + ", Discount=" + y.Discount), l = y.PriceStd, e.setValue("PriceActual", y.PriceActual), e.setValue("Discount", y.Discount), e.setValue("PriceEntered", y.PriceEntered), i.setContext(u, "DiscountSchema", y.DiscountSchema ? "Y" : "N")) } else o.getColumnName().toString().equals("PriceActual") ? (l = t.getValueOfDecimal(s), a = p.toString() + "," + d.toString() + "," + l.toString(), c = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a)), (c == null || c == 0) && (c = l), this.log.fine("PriceActual=" + l + " -> PriceEntered=" + c), e.setValue("PriceEntered", c)) : o.getColumnName().toString().equals("PriceEntered") && (c = t.getValueOfDecimal(s), a = p.toString() + "," + d.toString() + "," + c.toString(), l = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo", a)), (l == null || c == 0) && (l = c), this.log.fine("PriceEntered=" + c + " -> PriceActual=" + l), e.setValue("PriceActual", l)); o.getColumnName().toString().equals("Discount") ? (l = t.getValueOfDecimal((100 - t.getValueOfDouble(v)) / 100 * t.getValueOfDouble(b)), t.scale(l) > nt && (l = l.toFixed(nt)), a = p.toString() + "," + d.toString() + "," + l.toString(), c = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a)), (c == null || c == 0) && (c = l), e.setValue("PriceActual", l), e.setValue("PriceEntered", c)) : (v = b == 0 ? n.Env.ZERO : t.getValueOfDecimal((b - l) / b * 100), t.scale(v) > 2 && (v = v.toFixed(2)), e.setValue("Discount", v)); this.log.fine("PriceEntered=" + c + ", Actual=" + l + ", Discount=" + v); var ht = i.getContext("EnforcePriceLimit"), ut = i.getWindowContext(u, "IsSOTrx", !0) == "Y" && ht != null && ht.toString().equals("Y"), at = "Y".toString().equals(i.getContext("IsReturnTrx")); ut && (n.MRole.getDefault().IsOverwritePriceLimit() || at) && (ut = !1); ut && t.getValueOfDouble(w) != 0 && l.toString().compare(w) < 0 && (l = w, a = p.toString() + "," + d.toString() + "," + w.toString(), c = t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom", a)), (c == null || c == 0) && (c = w), this.log.fine("(under) PriceEntered=" + c + ", Actual" + w), e.setValue("PriceActual", w), e.setValue("PriceEntered", c), n.ADialog.info("UnderLimitPrice"), b != 0 && (v = t.getValueOfDecimal((b - l) / b * 100), t.scale(v) > 2 && (v = v.toFixed(2)), e.setValue("Discount", v))); g = k * l; t.scale(g) > nt && (g = g.toFixed(nt)); this.log.info("LineNetAmt=" + g); e.setValue("LineNetAmt", g); e.setValue("GrandTotal", t.getValueOfDecimal(e.getValue("TaxAmt")) + g) } catch (vt) { } return this.setCalloutActive(!1), i = u = e = o = s = h = null, "" }; w.prototype.BPartnerContract = function (i, r, u, f, e, o) { var h = null, s = null, at, yt, ft, et, w, ot, st, c, it, p, ht, b, ct, rt, vt, g, k, d, pt, v; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { var a = 0, y = "N", ut = "N", lt = t.getValueOfString(u.getValue("ContractType")); if (lt == "" || (e != null && (a = t.getValueOfInt(e.toString())), a == 0) || (at = t.getValueOfBoolean(u.getValue("IsReturnTrx")), at)) return ""; this.setCalloutActive(!0); var nt = !1, p = "VA009_", tt = lt == "ASR" ? !0 : !1, s = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", p); if (s != null && (nt = s.VA009_), p = nt.toString() + "," + a, s = n.dataContext.getJSONRecord("MBPartner/GetBPartnerOrderData", p), s != null) { if (yt = t.getValueOfInt(u.getValue("M_PriceList_ID")), v = t.getValueOfInt(tt ? s.M_PriceList_ID : s.PO_PriceList_ID), v != 0 ? u.setValue("M_PriceList_ID", v) : u.setValue("M_PriceList_ID", null), u.setValue("Bill_BPartner_ID", a), ft = t.getValueOfInt(s.Bill_Location_ID), ft == 0 ? (et = t.getValueOfInt(s.Bill_BPartner_ID), et > 0 && u.setValue("Bill_BPartner_ID", et)) : u.setValue("Bill_Location_ID", ft), w = t.getValueOfInt(s.C_BPartner_Location_ID), a.toString() == i.getContext("C_BPartner_ID") && (ot = i.getContext("C_BPartner_Location_ID"), ot.length > 0 && (w = t.getValueOfInt(ot))), w == 0 ? u.setValue("C_BPartner_Location_ID", null) : (u.setValue("C_BPartner_Location_ID", w), "Y" == t.getValueOfString(s.IsShipTo) && u.setValue("Bill_Location_ID", w)), st = t.getValueOfInt(s.SalesRep_ID), st > 0 && u.setValue("SalesRep_ID", st), nt) { var l = t.getValueOfInt(s.VA009_PaymentMethod_ID); it <= 0 && (c = n.dataContext.getJSONRecord("MBPartner/GetBPDetails", a), c != null && (y = t.getValueOfString(c.IsVendor), ut = t.getValueOfString(c.IsCustomer), tt ? y == "Y" ? (l = 0, h = null, ut == "Y" && (l = t.getValueOfInt(c.VA009_PaymentMethod_ID), h = t.getValueOfString(c.VA009_PAYMENTBASETYPE))) : ut == "Y" && (l = t.getValueOfInt(c.VA009_PaymentMethod_ID), h = t.getValueOfString(c.VA009_PAYMENTBASETYPE)) : y == "Y" ? (l = t.getValueOfInt(c.VA009_PO_PaymentMethod_ID), h = t.getValueOfString(c.VA009_PAYMENTBASETYPEPO)) : (l = 0, h = null))); l == 0 ? (it = t.getValueOfInt(u.getValue("C_Order_Blanket")), it > 0 && (p = nt.toString() + "," + it.toString(), s = n.dataContext.getJSONRecord("MOrder/GetPaymentMethod", p), s != null && (ht = t.getValueOfInt(s.VA009_PaymentMethod_ID), ht > 0 && (u.setValue("VA009_PaymentMethod_ID", ht), h = t.getValueOfString(s.VA009_PaymentBaseType), h != "W" && h != null && (u.setValue("PaymentMethod", h), y == "N" ? u.setValue("PaymentRule", h) : u.setValue("PaymentRulePO", h)))))) : l == 0 ? u.setValue("VA009_PaymentMethod_ID", null) : (u.setValue("VA009_PaymentMethod_ID", l), h != "W" && h != null ? (u.setValue("PaymentMethod", h), y == "N" ? u.setValue("PaymentRule", h) : u.setValue("PaymentRulePO", h)) : (u.setValue("PaymentMethod", "T"), y == "N" ? u.setValue("PaymentRule", "T") : u.setValue("PaymentRulePO", "T"))) } b = t.getValueOfInt(s.AD_User_ID); a.toString() == i.getContext("C_BPartner_ID") && (ct = i.getContext("AD_User_ID"), ct.length > 0 && (b = t.getValueOfInt(ct))); b == 0 ? u.setValue("AD_User_ID", null) : (u.setValue("AD_User_ID", b), u.setValue("Bill_User_ID", b)); tt && (rt = t.getValueOfString(s.CreditStatusSettingOn), rt == "CH" ? (k = t.getValueOfDouble(s.SO_CreditLimit), k != 0 && (d = t.getValueOfDouble(s.CreditAvailable), d <= 0 && n.ADialog.info("CreditOver"))) : (vt = t.getValueOfInt(u.getValue("C_BPartner_Location_ID")), g = n.dataContext.getJSONRecord("MBPartner/GetLocationData", vt.toString()), g != null && (rt = t.getValueOfString(g.CreditStatusSettingOn), rt == "CL" && (k = t.getValueOfDouble(g.SO_CreditLimit), k != 0 && (d = t.getValueOfDouble(g.CreditAvailable), d <= 0 && n.ADialog.info("CreditOver")))))); pt = t.getValueOfInt(u.getValue("C_PaymentTerm_ID")); v = t.getValueOfInt(tt ? s.C_PaymentTerm_ID : s.PO_PaymentTerm_ID); v != 0 ? u.setValue("C_PaymentTerm_ID", v) : u.setValue("C_PaymentTerm_ID", null) } } catch (wt) { return this.setCalloutActive(!1), wt } this.setCalloutActive(!1); o = null }; w.prototype.UpdateIsSOTrx = function (n, t, i, r, u) { if (this.isCalloutActive() || u == null || u.toString() == "" || u == !1) return ""; this.setCalloutActive(!0); n.setIsSOTrx(t, u == "ASR" ? !0 : !1); this.setCalloutActive(!1) }; n.Model.CalloutOrderContract = w; n.Utility.inheritPrototype(ht, n.CalloutEngine); ht.prototype.CalculationSelection = function (n, t, i, r, u) { return this.isCalloutActive() || u == null || u.toString() == "" || u == !1 ? "" : (this.setCalloutActive(!0), r.getColumnName() == "IsSum" ? (i.setValue("IsMaximum", !1), i.setValue("IsCount", !1), i.setValue("IsMinimum", !1)) : r.getColumnName() == "IsMaximum" ? (i.setValue("IsSum", !1), i.setValue("IsMinimum", !1), i.setValue("IsCount", !1)) : r.getColumnName() == "IsCount" ? (i.setValue("IsMaximum", !1), i.setValue("IsSum", !1), i.setValue("IsMinimum", !1)) : r.getColumnName() == "IsMinimum" && (i.setValue("IsSum", !1), i.setValue("IsCount", !1), i.setValue("IsMaximum", !1)), this.setCalloutActive(!1), "") }; ht.prototype.UpdateKPITableInContext = function (n, t, i, r, u) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), u == !0 ? (i.setValue("AD_Table_ID", -1), i.setValue("AD_Tab_ID", -1), n.setContext(t, "AD_Table_ID", -1), n.setContext(t, "AD_Tab_ID", -1)) : (i.setValue("TableView_ID", -1), n.setContext(t, "TableView_ID", -1)), this.setCalloutActive(!1), "") }; ht.prototype.UpdateTabIDContext = function (n, t, i, r, u) { return this.isCalloutActive() ? "" : (this.setCalloutActive(!0), u < 1 || u == null || u.toString() == "" ? (i.setValue("AD_Tab_ID", -1), n.setContext(t, "AD_Tab_ID", -1)) : n.setContext(t, "AD_Tab_ID", u), this.setCalloutActive(!1), "") }; n.Model.CalloutKPI = ht; n.Utility.inheritPrototype(d, n.CalloutEngine); d.prototype.UpdateTableInContext = function (n, t, i, r, u) { return this.isCalloutActive() ? "" : (this.setCalloutActive(!0), u == !0 ? (i.setValue("AD_Table_ID", -1), i.setValue("AD_Tab_ID", -1), n.setContext(t, "AD_Table_ID", -1), n.setContext(t, "AD_Tab_ID", -1)) : (i.setValue("TableView_ID", -1), n.setContext(t, "TableView_ID", -1)), this.setCalloutActive(!1), "") }; d.prototype.UpdateTabIDContext = function (n, t, i, r, u) { return this.isCalloutActive() ? "" : (this.setCalloutActive(!0), u < 1 || u == null || u.toString() == "" ? (i.setValue("AD_Tab_ID", -1), n.setContext(t, "AD_Tab_ID", -1)) : (n.setContext(t, "AD_Tab_ID", u), i.setValue("TableView_ID", -1), n.setContext(t, "TableView_ID", -1)), this.setCalloutActive(!1), "") }; d.prototype.UpdateTableViewIDOnTableContext = function (n, t, i, r, u) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), u > 0 && (i.setValue("TableView_ID", -1), n.setContext(t, "TableView_ID", -1)), this.setCalloutActive(!1), "") }; d.prototype.SelectFunctionOnDashboard = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "" || f == !1) return ""; this.setCalloutActive(!0); var e = t.getValueOfBoolean(f); return u.getColumnName() == "IsSum" ? (r.setValue("IsAvg", !1), r.setValue("IsCount", !1), r.setValue("IsNone", !1)) : u.getColumnName() == "IsAvg" ? (r.setValue("IsSum", !1), r.setValue("IsCount", !1), r.setValue("IsNone", !1)) : u.getColumnName() == "IsCount" ? (r.setValue("IsSum", !1), r.setValue("IsAvg", !1), r.setValue("IsNone", !1)) : u.getColumnName() == "IsNone" && (r.setValue("IsSum", !1), r.setValue("IsCount", !1), r.setValue("IsAvg", !1)), this.setCalloutActive(!1), "" }; d.prototype.ValueCheck = function (n, t, i, r, u, f) { if (this.isCalloutActive()) return ""; this.setCalloutActive(!0); var e = i.getValue("LastNValue"); return e > 60 && i.setValue("LastNValue", 1), this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; n.Model.CalloutDashboard = d; n.Utility.inheritPrototype(ct, n.CalloutEngine); ct.prototype.UpdateTabIDContext = function (n, t, i, r, u) { return this.isCalloutActive() ? "" : (this.setCalloutActive(!0), u < 1 || u == null || u.toString() == "" ? (i.setValue("AD_Tab_ID", -1), n.setContext(t, "AD_Tab_ID", -1)) : n.setContext(t, "AD_Tab_ID", u), this.setCalloutActive(!1), "") }; ct.prototype.GroupByChecked = function (t, i, r, u, f) { if (this.isCalloutActive() || f == null) return ""; this.setCalloutActive(!0); var e = "UPDATE RC_ViewColumn SET IsGroupBy='N' WHERE RC_View_ID=" + r.getValue("RC_View_ID") + " AND RC_ViewColumn_ID NOT IN(" + r.getValue("RC_ViewColumn_ID") + ")", o = n.DB.executeQuery(e); return this.setCalloutActive(!1), "" }; ct.prototype.IsViewChecked = function (n, t, i, r, u) { return this.isCalloutActive() || u == null ? "" : (this.setCalloutActive(!0), u ? (i.setValue("AD_Tab_ID", -1), i.setValue("AD_Table_ID", -1), n.setContext(t, "AD_Tab_ID", -1), n.setContext(t, "AD_Table_ID", -1)) : (i.setValue("TableView_ID", -1), n.setContext(t, "TableView_ID", -1)), this.setCalloutActive(!1), "") }; n.Model.CalloutDashboardView = ct; n.Utility.inheritPrototype(tr, n.CalloutEngine); tr.prototype.StatisticGroup = function (n, t, i, r, u) { return u == null || u.toString() == "" ? "" : (i.setValue("FO_STATISTICSUBGROUP_ID", 0), "") }; n.Model.CalloutService = tr; n.Utility.inheritPrototype(ri, n.CalloutEngine); ri.prototype.SetReadnly = function (n, i, r, u, f) { return f == null || f.toString() == "" || f.toString() == "E" ? (this.setCalloutActive(!1), f != null && f.toString() == "E" && (r.getField("VSS_PAYMENTTYPE").setReadOnly(!0), r.setValue("VSS_PAYMENTTYPE", "P")), "") : (this.setCalloutActive(!0), t.getValueOfString(r.getValue("CashType")) == "A" || t.getValueOfString(r.getValue("CashType")) == "E" ? (r.setValue("VSS_PAYMENTTYPE", "P"), r.getField("VSS_PAYMENTTYPE").setReadOnly(!0)) : t.getValueOfString(r.getValue("CashType")) == "F" || t.getValueOfString(r.getValue("CashType")) == "R" ? (r.setValue("VSS_PAYMENTTYPE", "R"), r.getField("VSS_PAYMENTTYPE").setReadOnly(!0)) : t.getValueOfString(r.getValue("CashType")) == "I" ? r.getField("VSS_PAYMENTTYPE").setReadOnly(!0) : r.getField("VSS_PAYMENTTYPE").setReadOnly(!1), t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "P" || t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "E" ? t.getValueOfDecimal(r.getValue("amount")) > 0 && r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))) : (t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "R" || t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "A") && t.getValueOfDecimal(r.getValue("amount")) < 0 && r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))), this.setCalloutActive(!1), "") }; ri.prototype.SetAmountValue = function (n, i, r, u, f) { if (f == null || f.toString() == "") return r.getField("VSS_PAYMENTTYPE").setReadOnly(!1), this.setCalloutActive(!1), ""; if (this.setCalloutActive(!0), t.getValueOfString(r.getValue("CashType")) != "B") t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "P" ? t.getValueOfDecimal(r.getValue("amount")) > 0 && r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))) : t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")) == "R" && t.getValueOfDecimal(r.getValue("amount")) < 0 && r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))); else if (t.getValueOfString(r.getValue("CashType")) == "B") { var e = t.getValueOfString(r.getValue("VSS_PAYMENTTYPE")); (e == "P" || e == "E") && t.getValueOfDecimal(r.getValue("amount")) > 0 ? (r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))), r.setValue("ConvertedAmount", 0 - t.getValueOfDecimal(r.getValue("ConvertedAmount")))) : (e == "R" || e == "A") && t.getValueOfDecimal(r.getValue("amount")) < 0 && (r.setValue("Amount", 0 - t.getValueOfDecimal(r.getValue("amount"))), r.setValue("ConvertedAmount", 0 - t.getValueOfDecimal(r.getValue("ConvertedAmount")))) } return this.setCalloutActive(!1), "" }; n.Model.CalloutSetReadOnly = ri; n.Utility.inheritPrototype(ir, n.CalloutEngine); ir.prototype.SetContract = function (t, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); try { var e = t.getContextAsInt(i, "M_Product_ID"), o = e.toString().concat(","), s = n.dataContext.getJSONRecord("MProduct/GetProductType", o); s == "S" ? r.getField("IsContract").setReadOnly(!1) : (r.getValue("IsContract", !1), r.getField("IsContract").setReadOnly(!0)) } catch (h) { this.log.severe(h.toString()) } return this.setCalloutActive(!1), "" }; n.Model.CalloutSetContract = ir; n.Utility.inheritPrototype(ui, n.CalloutEngine); ui.prototype.WorkflowType = function (i, r, u, f, e) { var s, o; if (e == null || e.toString() == "") return ""; if (this.setCalloutActive(!0), s = t.getValueOfString(e.toString()), s == "R") { if (o = t.getValueOfInt(n.DB.executeScalar("SELECT AD_Table_ID FROM AD_Table WHERE IsActive='Y' AND TableName= 'VADMS_MetaData'")), o == 0) return n.ADialog.info("No_VADMS", null, "", ""), n.Msg.getMsg("No_VADMS"); u.setValue("AD_Table_ID", o) } return this.setCalloutActive(!1), "" }; ui.prototype.SetSelectedColumn = function (i, r, u, f, e) { return e == null || e.toString() == "" ? "" : (this.setCalloutActive(!0), t.getValueOfString(n.DB.executeScalar("SELECT ColumnName FROM AD_Column WHERE AD_Column_ID=" + e)).toLower() == "C_GenAttributeSetInstance_ID".toLower() ? i.setContext(r, "IsGenericAttribute", "Y") : i.setContext(r, "IsGenericAttribute", "N"), this.setCalloutActive(!1), "") }; n.Model.CallOutWorkflow = ui; n.Utility.inheritPrototype(rr, n.CalloutEngine); rr.prototype.GetPaymentNote = function (i, r, u, f, e) { if (e == null || e.toString() == "" || e == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); var o = t.getValueOfString(n.DB.executeScalar("select documentnote from c_paymentterm where c_paymentterm_id=" + e)); return o != null && u.setValue("description", o), this.setCalloutActive(!1), "" }; n.Model.CalloutSalesQuotation = rr; n.Utility.inheritPrototype(ur, n.CalloutEngine); ur.prototype.SetDate = function (i, r, u, f, e, o) { var h, s, c; if (e == null || e.toString() == "") return ""; if (u.getValue("StartDate") == null || u.getValue("NoofCycle") == null) return this.setCalloutActive(!1), ""; try { this.setCalloutActive(!0); h = ""; h = n.dataContext.getJSONRecord("MOrderLine/GetNoOfMonths", t.getValueOfString(u.getValue("C_Frequency_ID"))); s = new Date(u.getValue("StartDate")); c = s.setMonth(s.getMonth() + h * t.getValueOfInt(u.getValue("NoofCycle"))); c = new Date(s.setDate(s.getDate() - 1)); u.setValue("EndDate", c.toISOString()); i = r = u = f = e = o = null; this.setCalloutActive(!1) } catch (l) { } return "" }; n.Model.CalloutSetDate = ur; n.Utility.inheritPrototype(fr, n.CalloutEngine); fr.prototype.DisplayButton = function (i, r, u, f, e) { if (e == null || e.toString() == "") return ""; if (t.getValueOfInt(u.getValue("C_DocTypeTarget_ID")) != 0) { var s = "select dc.DocSubTypeSO from c_doctype dc inner join c_docbasetype db on(dc.DocBaseType=db.DocBaseType)where c_doctype_id=" + t.getValueOfInt(u.getValue("C_DocTypeTarget_ID")) + " and db.DocBaseType='SOO' and dc.DocSubTypeSO in ('WR','WI')", o = t.getValueOfString(n.DB.executeScalar(s, null, null)); o == "WR" || o == "WI" ? u.setValue("InvoicePrint", "Y") : u.setValue("InvoicePrint", "N") } else return this.setCalloutActive(!1), ""; return this.setCalloutActive(!1), "" }; n.Model.CalloutDisplayButton = fr; n.Utility.inheritPrototype(er, n.CalloutEngine); er.prototype.SetQty = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; if (this.setCalloutActive(!0), t.getValueOfDecimal(r.getValue("TargetQty")) < t.getValueOfDecimal(r.getValue("ConfirmedQty"))) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; if (u.getColumnName() == "ConfirmedQty") { if (t.getValueOfDecimal(r.getValue("ConfirmedQty")) < 0) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; r.setValue("ScrappedQty", 0); r.setValue("DifferenceQty", t.getValueOfDecimal(r.getValue("TargetQty")) - (t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty")))) } else if (u.getColumnName() == "DifferenceQty") { if (t.getValueOfDecimal(r.getValue("TargetQty")) < t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("DifferenceQty"))) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; r.setValue("ScrappedQty", t.getValueOfDecimal(r.getValue("TargetQty")) - (t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("DifferenceQty")))) } else if (u.getColumnName() == "ScrappedQty") { if (t.getValueOfDecimal(r.getValue("ScrappedQty")) < 0 || t.getValueOfDecimal(r.getValue("TargetQty")) < t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty"))) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; r.setValue("DifferenceQty", t.getValueOfDecimal(r.getValue("TargetQty")) - (t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty")))) } return this.setCalloutActive(!1), "" }; n.Model.CalloutMoveConfirmLine = er; n.Utility.inheritPrototype(fi, n.CalloutEngine); fi.prototype.SetSalesQuotation = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; try { this.setCalloutActive(!0); t.getValueOfString(r.getValue("DocSubTypeSO")) == "OB" || t.getValueOfString(r.getValue("DocSubTypeSO")) == "ON" ? r.setValue("IsSalesQuotation", !0) : r.setValue("IsSalesQuotation", !1) } catch (e) { return this.setCalloutActive(!1), e } return this.setCalloutActive(!1), "" }; fi.prototype.Organization = function (t, i, r, u, f) { var o, e; if (this.isCalloutActive() || f == null || f.toString() == "") return ""; try { this.setCalloutActive(!0); o = ""; r.getField("M_Warehouse_ID") != null && (e = n.dataContext.getJSONRecord("MDocType/GetWarehouse", f.toString()), e > 0 ? r.getTableName() == "M_Movement" && r.getField("DTD001_MWarehouseSource_ID") != null ? r.setValue("DTD001_MWarehouseSource_ID", e) : r.setValue("M_Warehouse_ID", e) : r.getTableName() == "M_Movement" && r.getField("DTD001_MWarehouseSource_ID") != null ? r.setValue("DTD001_MWarehouseSource_ID", 0) : r.setValue("M_Warehouse_ID", 0)) } catch (s) { return this.setCalloutActive(!1), s } return this.setCalloutActive(!1), "" }; n.Model.CalloutDocumentType = fi; n.Utility.inheritPrototype(or, n.CalloutEngine); or.prototype.SetAddress = function (i, r, u, f, e) { var o, s, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { this.setCalloutActive(!0); f.getColumnName() == "C_BPartner_ID" ? (u.getField("Ref_BPartner_ID") != null && u.setValue("Ref_BPartner_ID", e), o = null, o = n.dataContext.getJSONRecord("MBPartner/GetBPData", t.getValueOfString(u.getValue("C_BPartner_ID"))), o != null && (s = n.Utility.Util.getValueOfInt(o.C_BPartner_Location_ID), s == 0 ? u.setValue("C_BPartner_Location_ID", null) : u.setValue("C_BPartner_Location_ID", s), h = n.Utility.Util.getValueOfInt(o.AD_User_ID), h == 0 ? u.setValue("AD_User_ID", null) : u.setValue("AD_User_ID", h))) : f.getColumnName() == "C_BPartnerSR_ID" && (u.getField("Ref_BPartner_ID") != null && u.setValue("Ref_BPartner_ID", e), o = null, o = n.dataContext.getJSONRecord("MBPartner/GetBPData", t.getValueOfString(u.getValue("C_BPartnerSR_ID"))), o != null && (s = n.Utility.Util.getValueOfInt(o.C_BPartner_Location_ID), s == 0 ? u.setValue("C_BPartner_Location_ID", null) : u.setValue("C_BPartner_Location_ID", s), h = n.Utility.Util.getValueOfInt(o.AD_User_ID), h == 0 ? u.setValue("AD_User_ID", null) : u.setValue("AD_User_ID", h))) } catch (c) { return this.setCalloutActive(!1), c } return this.setCalloutActive(!1), "" }; n.Model.CalloutProjectCBPartner = or; n.Utility.inheritPrototype(sr, n.CalloutEngine); sr.prototype.SetPaymentType = function (n, t, i, r, u) { if (this.isCalloutActive() || u == null || u.toString() == "") return ""; try { if (this.setCalloutActive(!0), r.getColumnName() == "PaymentRule") if (i.getValue("PaymentRule") == null) i.setValue("PaymentMethod", null); else { var f = i.getValue("PaymentRule"); i.setValue("PaymentMethod", f) } } catch (e) { return this.setCalloutActive(!1), e } return this.setCalloutActive(!1), "" }; n.Model.CalloutPaymentTypeSO = sr; n.Utility.inheritPrototype(hr, n.CalloutEngine); hr.prototype.DateRequired = function (t, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); try { var s, o; s = new Date(r.getValue("DateContract")); o = new Date(r.getValue("DateFinish")); o.toISOString() < s.toISOString() && (r.setValue("DateFinish", ""), this.setCalloutActive(!1), n.ADialog.info("DateInvalid", null, "", "")); this.log.fine("DateFinish=" + o) } catch (h) { return n.ADialog.info("DateError" + h, null, "", ""), this.setCalloutActive(!1), h } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutMCampaign = hr; n.Utility.inheritPrototype(ei, n.CalloutEngine); ei.prototype.DateRequired = function (t, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); try { var s, o; s = new Date(r.getValue("StartDate")); o = new Date(r.getValue("CloseDate")); o.toISOString() < s.toISOString() && (r.setValue("CloseDate", ""), this.setCalloutActive(!1), n.ADialog.info("CloseDateInvalid", null, "", "")); this.log.fine("CloseDate=" + o) } catch (h) { return n.ADialog.info("error in Date" + h, null, "", ""), this.setCalloutActive(!1), h } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; ei.prototype.PlanDateRequired = function (t, i, r, u, f, e) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); try { var s, o; s = new Date(r.getValue("DateStartPlan")); o = new Date(r.getValue("DateCompletePlan")); o.toISOString() < s.toISOString() && (r.setValue("DateCompletePlan", ""), this.setCalloutActive(!1), n.ADialog.info("CmpDateInvalid", null, "", "")); this.log.fine("DateCompletePlan=" + o) } catch (h) { return n.ADialog.info("error in Date" + h, null, "", ""), this.setCalloutActive(!1), h } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutMRequest = ei; n.Utility.inheritPrototype(lt, n.CalloutEngine); lt.prototype.GenerateMenuItemExportID = function (n, t, i, r, u) { var f, e, o; return u == null || u.toString() == "" ? "" : (f = n.getContext(t, "Prefix"), i.getValue("MenuItemExport_ID") == null && i.getValue("IsMenuItem").toString() == "true" && (e = new Date, o = f + e.getTime(), i.setValue("MenuItemExport_ID", o)), this.setCalloutActive(!1), "") }; lt.prototype.GenerateVersionID = function (n, t, i, r, u) { if (u == null || u.toString() == "") return ""; var f = n.getContext(t, "VersionNo"), e = f.replace(".", ""); return i.setValue("VersionID", e), this.setCalloutActive(!1), "" }; lt.prototype.CheckBoxValidation = function (n, i, r, u, f) { var o, e; return f == null || f.toString() == "" ? "" : (o = t.getValueOfBoolean(f), o == !0 && (e = u.getColumnName(), e == "IsProfessionalFree" ? (r.setValue("IsProfessionalPaid", !1), r.setValue("IsFree", !1), r.setValue("IsPaid", !1)) : e == "IsProfessionalPaid" ? (r.setValue("IsProfessionalFree", !1), r.setValue("IsFree", !1), r.setValue("IsPaid", !1)) : e == "IsFree" ? (r.setValue("IsProfessionalPaid", !1), r.setValue("IsProfessionalFree", !1), r.setValue("IsPaid", !1)) : e == "IsPaid" && (r.setValue("IsProfessionalPaid", !1), r.setValue("IsFree", !1), r.setValue("IsProfessionalFree", !1))), this.setCalloutActive(!1), "") }; n.Model.CalloutModuleMgmt = lt; n.Utility.inheritPrototype(cr, n.CalloutEngine); cr.prototype.SetUOM = function (i, r, u, f, e, o) { if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); u.getField("M_AttributeSetInstance_ID") != null && u.setValue("M_AttributeSetInstance_ID", null); try { if (t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_' ")) > 0) { var s = t.getValueOfInt(e), h = t.getValueOfInt(n.DB.executeScalar("SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_PRoduct_ID = " + s)); u.setValue("C_UOM_ID", h) } } catch (c) { this.setCalloutActive(!1); this.log.severe(c.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutPriclistUOM = cr; n.Utility.inheritPrototype(at, n.CalloutEngine); at.prototype.PaymentTaxAmount = function (i, r, u, f, e, o) { var a, l, s, c, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { if (a = n.dataContext.getJSONRecord("MCurrency/GetCurrency", u.getValue("C_Currency_ID").toString()), l = a.StdPrecision, f.getColumnName() == "C_Tax_ID") if (t.getValueOfDecimal(u.getValue("PayAmt")) > 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", e.toString() + "," + u.getValue("PayAmt").toString() + "," + l.toString()), u.setValue("TaxAmount", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", e.toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("PayAmt")) - t.getValueOfDecimal(u.getValue("PayAmt")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmount", h); else return u.setValue("TaxAmount", 0), this.setCalloutActive(!1), "" } else return this.setCalloutActive(!1), ""; else if (t.getValueOfInt(u.getValue("C_Tax_ID")) > 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", u.getValue("C_Tax_ID").toString() + "," + u.getValue("PayAmt").toString() + "," + l.toString()), u.setValue("TaxAmount", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", u.getValue("C_Tax_ID").toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("PayAmt")) - t.getValueOfDecimal(u.getValue("PayAmt")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmount", h); else return u.setValue("TaxAmount", 0), this.setCalloutActive(!1), "" } else return this.setCalloutActive(!1), "" } catch (v) { this.setCalloutActive(!1); this.log.severe(v.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; at.prototype.CashLineTaxAmount = function (i, r, u, f, e, o) { var a, l, s, c, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { if (a = n.dataContext.getJSONRecord("MCurrency/GetCurrency", i.getContext(r, "C_Currency_ID").toString()), l = a.StdPrecision, f.getColumnName() == "C_Tax_ID") if (t.getValueOfDecimal(u.getValue("Amount")) != 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", e.toString() + "," + u.getValue("Amount").toString() + "," + l.toString()), u.setValue("TaxAmt", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", e.toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("Amount")) - t.getValueOfDecimal(u.getValue("Amount")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmt", h); else return u.setValue("TaxAmt", 0), this.setCalloutActive(!1), "" } else return this.setCalloutActive(!1), ""; else if (t.getValueOfInt(u.getValue("C_Tax_ID")) > 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", u.getValue("C_Tax_ID").toString() + "," + u.getValue("Amount").toString() + "," + l.toString()), u.setValue("TaxAmt", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", u.getValue("C_Tax_ID").toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("Amount")) - t.getValueOfDecimal(u.getValue("Amount")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmt", h); else return u.setValue("TaxAmt", 0), this.setCalloutActive(!1), "" } else return this.setCalloutActive(!1), "" } catch (v) { this.setCalloutActive(!1); this.log.severe(v.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; at.prototype.BankStatementLineTaxAmount = function (i, r, u, f, e, o) { var a, v, l, s, c, h; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); a = ""; try { if (a = u.getValue("C_Currency_ID").toString(), v = n.dataContext.getJSONRecord("MCurrency/GetCurrency", a), l = v.StdPrecision, f.getColumnName() == "C_Tax_ID") if (t.getValueOfDecimal(u.getValue("ChargeAmt")) != 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", e.toString() + "," + u.getValue("ChargeAmt").toString() + "," + l.toString()), u.setValue("TaxAmt", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", e.toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("ChargeAmt")) - t.getValueOfDecimal(u.getValue("ChargeAmt")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmt", h); else return u.setValue("TaxAmt", 0), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } else return this.setCalloutActive(!1), i = r = u = f = e = o = null, ""; else if (t.getValueOfInt(u.getValue("C_Tax_ID")) > 0) { if (s = null, u.getField("SurchargeAmt") != null) return s = n.dataContext.getJSONRecord("MTax/CalculateSurcharge", u.getValue("C_Tax_ID").toString() + "," + u.getValue("ChargeAmt").toString() + "," + l.toString()), u.setValue("TaxAmt", s.TaxAmt), u.setValue("SurchargeAmt", s.SurchargeAmt), this.setCalloutActive(!1), ""; if (s = n.dataContext.getJSONRecord("MTax/GetTaxRate", u.getValue("C_Tax_ID").toString()), c = t.getValueOfDecimal(s), c > 0) h = t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("ChargeAmt")) - t.getValueOfDecimal(u.getValue("ChargeAmt")) / (c / 100 + 1)), h = t.getValueOfDecimal(h.toFixed(l)), u.setValue("TaxAmt", h); else return u.setValue("TaxAmt", 0), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } else return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } catch (y) { this.setCalloutActive(!1); this.log.severe(y.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutTaxAmount = at; n.Utility.inheritPrototype(lr, n.CalloutEngine); lr.prototype.SetProdCatValues = function (i, r, u, f, e, o) { var s, l, a; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { var h = "SELECT IsActive ", v = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA038_' ")), c = t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='DTD001_' ")); c > 0 && (h += " , producttype "); c > 0 && (h += " , m_attributeset_id, c_taxcategory_id "); h += " FROM M_Product_Category WHERE m_product_category_id=" + t.getValueOfInt(e); s = n.DB.executeDataSet(h); s != null && s.tables[0].rows.length > 0 && (t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='DTD001_' ")) > 0 && (s.tables[0].rows[0].cells.producttype != null || t.getValueOfString(s.tables[0].rows[0].cells.producttype) != "" ? u.setValue("PRODUCTTYPE", s.tables[0].rows[0].cells.producttype) : u.setValue("PRODUCTTYPE", "")), c > 0 && (s.tables[0].rows[0].cells.m_attributeset_id != null || t.getValueOfString(s.tables[0].rows[0].cells.m_attributeset_id) != "" ? u.setValue("M_AttributeSet_ID", t.getValueOfInt(s.tables[0].rows[0].cells.m_attributeset_id)) : u.setValue("M_AttributeSet_ID", 0), s.tables[0].rows[0].cells.c_taxcategory_id != null || t.getValueOfString(s.tables[0].rows[0].cells.c_taxcategory_id) != "" ? u.setValue("C_TaxCategory_ID", t.getValueOfInt(s.tables[0].rows[0].cells.c_taxcategory_id)) : u.setValue("C_TaxCategory_ID", 0))); v > 0 && (t.getValueOfString(s.tables[0].rows[0].cells.producttype) == "E" || t.getValueOfString(s.tables[0].rows[0].cells.producttype) == "S" ? (l = t.getValueOfInt(n.DB.executeScalar("SELECT A_Asset_Group_ID FROM M_Product_Category WHERE M_Product_Category_ID=" + t.getValueOfInt(e))), l > 0 ? (a = t.getValueOfInt(n.DB.executeScalar("SELECT VA038_AmortizationTemplate_ID FROM A_Asset_Group WHERE A_Asset_Group_ID=" + l)), a > 0 ? u.setValue("VA038_AmortizationTemplate_ID", a) : u.setValue("VA038_AmortizationTemplate_ID", 0)) : u.setValue("VA038_AmortizationTemplate_ID", 0)) : u.setValue("VA038_AmortizationTemplate_ID", 0)) } catch (y) { this.setCalloutActive(!1); this.log.severe(y.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutProdCatVal = lr; n.Utility.inheritPrototype(ar, n.CalloutEngine); ar.prototype.SetProdTypeValues = function (n, t, i, r, u, f) { if (this.isCalloutActive() || u == null || u.toString() == "") return ""; this.setCalloutActive(!0); try { u != "I" && i.setValue("IsStocked", !1) } catch (e) { this.setCalloutActive(!1); this.log.severe(e.toString()) } return this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; n.Model.CalloutProdTypeVal = ar; n.Utility.inheritPrototype(vr, n.CalloutEngine); vr.prototype.SetProfitBeforeTax = function (i, r, u, f, e, o) { if (e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; this.setCalloutActive(!0); try { var h = 0, c = 0, l = 0, s = null; s = n.DB.executeDataSet("SELECT ProfitBeforeTax,C_Year_ID,C_ProfitAndLoss_ID FROM C_ProfitLoss WHERE C_ProfitLoss_ID=" + e, null, null); s != null && s.tables[0].rows.length > 0 && (h = t.getValueOfDecimal(s.getTables()[0].getRows()[0].getCell("ProfitBeforeTax")), c = t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("C_Year_ID")), l = t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("C_ProfitAndLoss_ID")), u.setValue("ProfitBeforeTax", h), u.setValue("C_Year_ID", c), u.setValue("C_ProfitAndLoss_ID", l)) } catch (a) { this.setCalloutActive(!1); this.log.severe(a.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutProfitTax = vr; n.Utility.inheritPrototype(yr, n.CalloutEngine); yr.prototype.BPGroup = function (i, r, u, f, e, o) { if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { var a = "select M_ReturnPolicy_ID, M_DiscountSchema_ID, M_PRICELIST_ID, PO_PriceList_ID,PO_DiscountSchema_ID,PO_ReturnPolicy_ID from C_BP_Group where C_BP_Group_ID=" + t.getValueOfInt(e), s = n.DB.executeDataSet(a), v = u.getValue("IsCustomer"), y = u.getValue("IsVendor"); if (v && s != null && s.tables[0].rows.length > 0) { var h = t.getValueOfInt(s.tables[0].rows[0].cells.m_returnpolicy_id), c = t.getValueOfInt(s.tables[0].rows[0].cells.m_discountschema_id), l = t.getValueOfInt(s.tables[0].rows[0].cells.m_pricelist_id); u.setValue("M_ReturnPolicy_ID", h); u.setValue("M_DiscountSchema_ID", c); u.setValue("M_PRICELIST_ID", l) } y && s != null && s.tables[0].rows.length > 0 && (h = t.getValueOfInt(s.tables[0].rows[0].cells.po_returnpolicy_id), c = t.getValueOfInt(s.tables[0].rows[0].cells.po_discountschema_id), l = t.getValueOfInt(s.tables[0].rows[0].cells.po_pricelist_id), u.setValue("PO_ReturnPolicy_ID", h), u.setValue("PO_DiscountSchema_ID", c), u.setValue("PO_PriceList_ID", l)) } catch (p) { this.setCalloutActive(!1); this.log.severe(p.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutBPartner = yr; n.Utility.inheritPrototype(pr, n.CalloutEngine); pr.prototype.DocType = function (i, r, u, f, e, o) { var s, h, c, l, a; if (e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; this.setCalloutActive(!0); try { sql = "SELECT M_Product_ID , movementqty , M_AttributeSetInstance_ID FROM M_InOutLine WHERE M_InOutLine_ID=" + t.getValueOfInt(e); s = n.DB.executeDataSet(sql); h = 0; s.getTables().length > 0 && s.getTables()[0].getRows().length > 0 && (c = t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("M_Product_ID")), h = t.getValueOfDecimal(s.getTables()[0].getRows()[0].getCell("movementqty")), l = t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("M_AttributeSetInstance_ID"))); sql = "SELECT  SUM(ConfirmedQty + scrappedqty) FROM M_PackageLine WHERE  M_Package_ID=" + u.getValue("M_Package_ID") + " and m_inoutline_id =  " + u.getValue("M_InOutLine_ID"); a = t.getValueOfDecimal(n.DB.executeScalar(sql)); u.setValue("M_Product_ID", c); u.setValue("Qty", h - a); u.setValue("M_AttributeSetInstance_ID", l); u.setValue("DTD001_IsConfirm", !0) } catch (v) { this.setCalloutActive(!1); this.log.severe(v.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutshipLine = pr; n.Utility.inheritPrototype(wr, n.CalloutEngine); wr.prototype.SetMaxRunZero = function (n, t, i, r, u, f) { if (u == null || u.toString() == "") return ""; this.setCalloutActive(!0); var e = i.getValue("RunsMax"); return e != "" && e > 0 && i.setValue("RunsRemaining", 0), this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; n.Model.CalloutRecurring = wr; n.Utility.inheritPrototype(br, n.CalloutEngine); br.prototype.SetChargeAmount = function (t, i, r, u, f, e) { if (f == null || f.toString() == "") return ""; this.setCalloutActive(!0); try { var s = f.toString(), o = n.dataContext.getJSONRecord("MProductionLine/GetChargeAmt", s); o != null && (r.setValue("Amt", o.ChargeAmt), r.setValue("M_Product_ID", null)) } catch (h) { this.setCalloutActive(!1); this.log.severe(h.toString()) } return this.setCalloutActive(!1), t = i = r = u = f = e = null, "" }; n.Model.CalloutProductionLine = br; n.Utility.inheritPrototype(oi, n.CalloutEngine); oi.prototype.SetDateFromAndDateTo = function (i, r, u, f, e, o) { var h, s, c, l; if (e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { h = e.toString() + "," + i.getAD_Client_ID().toString(); s = n.dataContext.getJSONRecord("Common/GetPeriodFromYear", h); s != null && (c = t.getValueOfDate(s.STARTDATE), l = t.getValueOfDate(s.ENDDATE), u.setValue("DateFrom", c), u.setValue("DateTo", l)) } catch (a) { this.setCalloutActive(!1); this.log.severe(a.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; oi.prototype.SetCurrency = function (i, r, u, f, e, o) { var h, s, c; if (e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { h = e.toString() + "," + i.getAD_Client_ID().toString(); s = n.dataContext.getJSONRecord("Common/GetCurrencyFromAccountingSchema", h); s != null && (c = t.getValueOfInt(s.CurrencyID), u.setValue("C_Currency_ID", c)) } catch (l) { this.setCalloutActive(!1); this.log.severe(l.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.CalloutProfitLoss = oi; n.Utility.inheritPrototype(kr, n.CalloutEngine); kr.prototype.SetQty = function (n, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; if (this.setCalloutActive(!0), t.getValueOfDecimal(r.getValue("TargetQty")) < t.getValueOfDecimal(r.getValue("ConfirmedQty"))) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; if (u.getColumnName() == "ConfirmedQty") { if (t.getValueOfDecimal(r.getValue("ConfirmedQty")) < 0) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; r.setValue("ScrappedQty", 0); r.setValue("DifferenceQty", t.getValueOfDecimal(r.getValue("TargetQty")) - (t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty")))) } else if (u.getColumnName() == "ScrappedQty") { if (t.getValueOfDecimal(r.getValue("ScrappedQty")) < 0 || t.getValueOfDecimal(r.getValue("TargetQty")) < t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty"))) return r.setValue("ConfirmedQty", t.getValueOfDecimal(r.getValue("TargetQty"))), r.setValue("DifferenceQty", 0), r.setValue("ScrappedQty", 0), this.setCalloutActive(!1), ""; r.setValue("DifferenceQty", t.getValueOfDecimal(r.getValue("TargetQty")) - (t.getValueOfDecimal(r.getValue("ConfirmedQty")) + t.getValueOfDecimal(r.getValue("ScrappedQty")))) } return this.setCalloutActive(!1), "" }; n.Model.CalloutShipReceiptConfirmLine = kr; n.Utility.inheritPrototype(si, n.CalloutEngine); si.prototype.SetBPLocation = function (i, r, u, f, e) { var o, c, s, l, h; if (this.isCalloutActive() || e == null || e.toString() == "") return u.setValue("C_BPartner_Location_ID", null), ""; this.setCalloutActive(!0); try { if (u.getValue("CashType") == "B" || u.getValue("CashType") == "C") { if (o = u.getValue("C_BPartner_ID"), o == null || o == "") return u.setValue("C_BPartner_Location_ID", null), this.setCalloutActive(!1), ""; if (c = o.toString() + "," + i.getAD_Client_ID().toString(), s = n.dataContext.getJSONRecord("MCashJournal/GetBPLocation", c), s != null) { if (l = t.getValueOfInt(s.CreditStatusSettingOn), h = t.getValueOfInt(s.C_BPartner_Location_ID), l == "CL" && h == 0) return this.setCalloutActive(!1), n.Msg.getMsg("LocationNew"); u.setValue("C_BPartner_Location_ID", h) } } } catch (a) { this.setCalloutActive(!1); this.log.severe(a.toString()) } return this.setCalloutActive(!1), "" }; si.prototype.setAccountNo = function (i, r, u, f, e) { if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); try { var o = n.dataContext.getJSONRecord("MCashJournal/GetBankAccountData", e); o != null && (u.setValue("RoutingNo", t.getValueOfString(o.RoutingNo)), u.setValue("AccountNo", t.getValueOfString(o.AccountNo))) } catch (s) { this.setCalloutActive(!1); this.log.severe(s.toString()) } return this.setCalloutActive(!1), "" }; n.Model.CalloutCashJournalLine = si; n.Utility.inheritPrototype(dr, n.CalloutEngine); dr.prototype.SetMultiplyRate = function (n, t, i, r, u) { if (this.isCalloutActive() || u == null || u.toString() == "") return i.setValue("MultiplyRate", 0), ""; this.setCalloutActive(!0); var f = i.getValue("C_UOM_ID"), e = i.getValue("C_UOM_To_ID"); return f == e && (i.setValue("DivideRate", 1), i.setValue("MultiplyRate", 1)), this.setCalloutActive(!1), "" }; n.Model.CalloutUOMConversion = dr; n.Utility.inheritPrototype(gr, n.CalloutEngine); gr.prototype.CheckIncoTerm = function (i, r, u, f, e) { if (this.isCalloutActive() || e == null || e.toString() == "") return ""; this.setCalloutActive(!0); var s = i.isSOTrx(r), h = 0, o = ""; try { if (u.getTableName().startsWith("C_Order") ? s && t.getValueOfInt(u.getValue("C_Order_Quotation")) > 0 ? (o = s + "," + u.getTableName() + ",C_Order_Quotation," + t.getValueOfInt(u.getValue("C_Order_Quotation")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : !s && t.getValueOfInt(u.getValue("Ref_Order_ID")) > 0 ? (o = s + "," + u.getTableName() + ",Ref_Order_ID," + t.getValueOfInt(u.getValue("Ref_Order_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : t.getValueOfInt(u.getValue("C_Order_Blanket")) > 0 && (o = s + "," + u.getTableName() + ",C_Order_Blanket," + t.getValueOfInt(u.getValue("C_Order_Blanket")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : u.getTableName().startsWith("C_Invoice") ? s && t.getValueOfInt(u.getValue("C_Order_ID")) > 0 ? (o = s + "," + u.getTableName() + ",C_Order_ID," + t.getValueOfInt(u.getValue("C_Order_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : !s && t.getValueOfInt(u.getValue("C_Order_ID")) > 0 ? (o = s + "," + u.getTableName() + ",C_Order_ID," + t.getValueOfInt(u.getValue("C_Order_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : !s && t.getValueOfInt(u.getValue("M_InOut_ID")) > 0 && (o = s + "," + u.getTableName() + ",M_InOut_ID," + t.getValueOfInt(u.getValue("M_InOut_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : u.getTableName().startsWith("M_InOut") && (s && t.getValueOfInt(u.getValue("C_Order_ID")) > 0 ? (o = s + "," + u.getTableName() + ",C_Order_ID," + t.getValueOfInt(u.getValue("C_Order_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : !s && t.getValueOfInt(u.getValue("C_Order_ID")) > 0 ? (o = s + "," + u.getTableName() + ",C_Order_ID," + t.getValueOfInt(u.getValue("C_Order_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o)) : !s && t.getValueOfInt(u.getValue("C_Invoice_ID")) > 0 && (o = s + "," + u.getTableName() + ",C_Invoice_ID," + t.getValueOfInt(u.getValue("C_Invoice_ID")).toString(), h = n.dataContext.getJSONRecord("MOrder/GetIncoTerm", o))), h > 0 & h != e) return this.setCalloutActive(!1), n.ADialog.warn("IncoTermChanged"), "" } catch (c) { this.setCalloutActive(!1); this.log.severe(c.toString()) } return this.setCalloutActive(!1), "" }; n.Model.CalloutIncoTerm = gr; n.Utility.inheritPrototype(nu, n.CalloutEngine); nu.prototype.BlanketOrderRef = function (t, i, r, u, f) { var o, s, e; return this.isCalloutActive() || f == null || f.toString() == "" ? "" : (this.setCalloutActive(!0), u.getColumnName() == "Blanket_Ref_Order_ID" && (o = n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix", "VA009_"), s = o.VA009_ ? f.toString() + "," + o.VA009_ : f.toString() + ",false", e = n.dataContext.getJSONRecord("MOrder/GetOrderHeader", s), e != null && (r.setValue("AD_Client_ID", e.AD_Client_ID), r.setValue("AD_Org_ID", e.AD_Org_ID), r.setValue("Description", e.Description), r.setValue("C_DocTypeTarget_ID", e.C_DocTypeTarget_ID), r.setValue("DateOrdered", l(e.DateOrdered)), r.setValue("DatePromised", l(e.DatePromised)), r.setValue("OrderValidFrom", l(e.OrderValidFrom)), r.setValue("OrderValidTo", l(e.OrderValidTo)), r.setValue("C_BPartner_ID", e.C_BPartner_ID), r.setValue("Bill_BPartner_ID", e.Bill_BPartner_ID), r.setValue("C_BPartner_Location_ID", e.C_BPartner_Location_ID), r.setValue("Bill_Location_ID", e.Bill_Location_ID), r.setValue("AD_User_ID", e.AD_User_ID), r.setValue("Bill_User_ID", e.Bill_User_ID), r.setValue("M_Warehouse_ID", e.M_Warehouse_ID), r.setValue("PriorityRule", e.PriorityRule), r.setValue("M_PriceList_ID", e.M_PriceList_ID), r.setValue("C_IncoTerm_ID", e.C_IncoTerm_ID), r.setValue("C_Currency_ID", e.C_Currency_ID), r.setValue("C_ConversionType_ID", e.C_ConversionType_ID), r.setValue("SalesRep_ID", e.SalesRep_ID), o.VA009_ && r.setValue("VA009_PaymentMethod_ID", e.VA009_PaymentMethod_ID), r.setValue("C_PaymentTerm_ID", e.C_PaymentTerm_ID), r.setValue("C_Campaign_ID", e.C_Campaign_ID), r.setValue("C_Activity_ID", e.C_Activity_ID), r.setValue("AD_OrgTrx_ID", e.AD_OrgTrx_ID), r.setValue("User1_ID", e.User1_ID), r.setValue("User2_ID", e.User2_ID), r.setValue("TotalLines", e.TotalLines), r.setValue("GrandTotal", e.GrandTotal))), this.setCalloutActive(!1), "") }; n.Model.CalloutBlanketOrderRef = nu; n.Utility.inheritPrototype(tu, n.CalloutEngine); tu.prototype.SetLocatorPC = function (n, t, i, r, u, f) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), r.getColumnName() == "M_Warehouse_ID" ? u != f && (i.setValue("M_Locator_ID", ""), i.setValue("Ref_M_Container_ID", "")) : r.getColumnName() == "M_Locator_ID" && u != f && i.setValue("Ref_M_Container_ID", ""), this.setCalloutActive(!1), n = t = i = r = u = f = null, "") }; n.Model.CalloutLocatorPC = tu; n.Utility.inheritPrototype(iu, n.CalloutEngine); iu.prototype.SetDates = function (n, t, i, r, u, f) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), r.getColumnName() == "C_Frequency_ID" && u != f && (i.setValue("StartDate", ""), i.setValue("EndDate", "")), this.setCalloutActive(!1), "") }; n.Model.CalloutSetDates = iu; n.Utility.inheritPrototype(ru, n.CalloutEngine); ru.prototype.Product = function (n, t, i, r, u) { return this.isCalloutActive() || u == null || u.toString() == "" ? "" : (this.setCalloutActive(!0), i.getField("M_AttributeSetInstance_ID") != null && i.setValue("M_AttributeSetInstance_ID", null), this.setCalloutActive(!1), "") }; n.Model.CalloutLandedCost = ru; n.Utility.inheritPrototype(uu, n.CalloutEngine); uu.prototype.Comparedates = function (t, i, r, u, f) { if (this.isCalloutActive() || f == null || f.toString() == "") return ""; this.setCalloutActive(!0); var e = new Date(r.getValue("DateWorkStart")), o = new Date(r.getValue("DateWorkComplete")); if (u.getColumnName() == "DateWorkStart") { if (e >= o && r.getValue("DateWorkComplete") != null) return r.setValue("DateWorkStart", ""), this.setCalloutActive(!1), n.ADialog.info("DateWorkGreater") } else if (e >= o && r.getValue("DateWorkStart") != null) return r.setValue("DateWorkComplete", ""), this.setCalloutActive(!1), n.ADialog.info("DateWorkGreater"); return this.setCalloutActive(!1), "" }; n.Model.CalloutRFQ = uu; n.Utility.inheritPrototype(fu, n.CalloutEngine); fu.prototype.ClearWeekDay = function (t, i, r, u, f) { return this.isCalloutActive() || f == null || f.toString() == "" ? "" : (this.setCalloutActive(!0), f == !0 && (r.setValue("NetDay", ""), r.setValue("WeekOffset", n.Env.ZERO)), this.setCalloutActive(!1), "") }; ot.prototype.SetPrice = function (i, r, u, f, e) { var o, l, s, h, c; if (e == null || e.toString() == "" || this.isCalloutActive() || e == null) return ""; this.setCalloutActive(!0); try { if (o = "", l = i.getContextAsInt(r, "M_Product_ID"), o = l.toString().concat(",").concat(u.getValue("S_TimeExpense_ID").toString()).concat(",").concat(t.getValueOfString(u.getValue("C_UOM_ID"))), s = n.dataContext.getJSONRecord("MExpenseReport/GetPrices", o), s != null && (h = s.PriceStd, u.setValue("ExpenseAmt", h), u.setValue("ConvertedAmt", h)), u.getValue("C_Charge_ID") > 0) { c = i.getContextAsInt("#C_UOM_ID"); c > 0 ? u.setValue("C_UOM_ID", c) : u.setValue("C_UOM_ID", 100); var v = n.Utility.Util.getValueOfInt(u.getValue("C_Charge_ID")), y = v.toString(), a = n.dataContext.getJSONRecord("MExpenseReport/GetChargeAmount", y); u.setValue("ExpenseAmt", a); u.setValue("ConvertedAmt", a) } this.setCalloutActive(!1); return } catch (p) { this.setCalloutActive(!1); this.log.severe(p.toString()) } return this.setCalloutActive(!1), "" }; n.Model.CalloutPaymentTerm = fu; n.Utility.inheritPrototype(vt, n.CalloutEngine); vt.prototype.DateAcct = function (n, t, i, r, u, f) { if (u == null || u.toString() == "" || this.isCalloutActive()) return ""; this.setCalloutActive(!0); try { i.setValue("DateAcct", u) } catch (e) { this.setCalloutActive(!1); this.log.severe(e.toString()) } return this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; vt.prototype.PriceList = function (r, u, e, o, s, h) { var l, c, a, v; if (this.isCalloutActive() || s == null || s.toString() == "") return ""; try { if (l = s.toString(), t.getValueOfInt(l) == 0) return ""; this.setCalloutActive(!0); f && this.log.warning("init"); c = n.dataContext.getJSONRecord("MPriceList/GetPriceListDataForProvisionalInvoice", l); c != null && (e.setValue("IsTaxIncluded", "Y" == c.IsTaxIncluded), r.setContext(u, "EnforcePriceLimit", c.EnforcePriceLimit), a = t.getValueOfInt(c.C_Currency_ID), e.setValue("C_Currency_ID", a), v = t.getValueOfInt(c.M_PriceList_Version_ID), r.setContext(u, "M_PriceList_Version_ID", v)) } catch (y) { return this.setCalloutActive(!1), this.log(i.SEVERE, "", y), y } return f && this.log.warning("finish"), this.setCalloutActive(!1), r = u = e = o = s = h = null, "" }; vt.prototype.BPartner = function (i, r, u, f, e, o) { var h, l, s, c, b, a, v, y, p, w; if (this.isCalloutActive() || e == null || e.toString() == "") return ""; try { if (h = t.getValueOfInt(e), h == null || h == 0) return ""; this.isCalloutActive(!0); l = i.isSOTrx(r); s = n.dataContext.getJSONRecord("MBPartner/GetBPDataForProvisionalInvoice", h); s != null && (c = t.getValueOfInt(s[l ? "M_PriceList_ID" : "PO_PriceList_ID"]), c > 0 && u.setValue("M_PriceList_ID", c), b = s.countVA009, b > 0 && (a = 0, a = l || t.getValueOfString(s.IsVendor) != "Y" ? l && t.getValueOfString(s.IsCustomer) == "Y" ? t.getValueOfInt(s.VA009_PaymentMethod_ID) : 0 : t.getValueOfInt(s.VA009_PO_PaymentMethod_ID), a == 0 ? u.setValue("VA009_PaymentMethod_ID", null) : u.setValue("VA009_PaymentMethod_ID", a)), c = t.getValueOfInt(s[l ? "C_PaymentTerm_ID" : "PO_PaymentTerm_ID"]), c > 0 && u.setValue("C_PaymentTerm_ID", c), v = t.getValueOfInt(s.C_BPartner_Location_ID), h.toString().equals(i.getContext("C_BPartner_ID")) && (y = i.getContext("C_BPartner_Location_ID"), y && y.toString().length > 0 && (v = parseInt(y))), v == 0 ? u.setValue("C_BPartner_Location_ID", null) : u.setValue("C_BPartner_Location_ID", v), p = t.getValueOfInt(s.AD_User_ID), h.toString().equals(i.getContext("C_BPartner_ID")) && (w = i.getContext("AD_User_ID"), w && w.toString().length > 0 && (p = parseInt(w))), p == 0 ? u.setValue("AD_User_ID", null) : u.setValue("AD_User_ID", p)) } catch (k) { this.setCalloutActive(!1); this.log.severe(k.toString()) } return this.setCalloutActive(!1), i = r = u = f = e = o = null, "" }; n.Model.ProvisionalInvoice = vt; n.Utility.inheritPrototype(eu, n.CalloutEngine); eu.prototype.SetFullName = function (n, t, i, r, u, f) { if ((this.isCalloutActive() || u == null || u.toString() == "") && r.getColumnName() != "LastName") return ""; this.setCalloutActive(!0); var e = ""; return i.getValue("Firstname") != null && (e = i.getValue("Firstname")), i.getValue("LastName") != null && i.getValue("LastName") != "" && (e = e == "" ? i.getValue("LastName") : e + " " + i.getValue("LastName")), e != "" && i.setValue("ContactName", e), this.setCalloutActive(!1), n = t = i = r = u = f = null, "" }; n.Model.CalloutLead = eu; n.Utility.inheritPrototype(ou, n.CalloutEngine); ou.prototype.CheckModule = function (i, r, u, f, e) { var o, s; return this.isCalloutActive() || e == null || e.toString() == "" ? "" : (this.setCalloutActive(!0), o = t.getValueOfString(u.getValue("SaveAttachmentOn")), o == "AB" && (s = n.dataContext.getJSONRecord("VIS/ModulePrefix/GetModulePrefix", "VA090_"), !s.VA090_)) ? (u.setValue("SaveAttachmentOn", null), this.setCalloutActive(!1), n.Msg.getMsg("VIS_VA090NotInstalled")) : (this.setCalloutActive(!1), "") }; n.Model.CalloutAzureBlob = ou }(VIS, jQuery), function (n, t) { function i() { function di(n, i, r) { var u = null; return t.ajax({ url: bi, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function gi(n) { oi = n; tr() } function y() { var u = t(window).width(), e = t(".row.scrollerHorizontal > div").length, h; e = e - 1; t(".scrollerHorizontal").width(u); var l = u / e - 20, i = parseInt(l), o = {}; if (n.Application.isRTL && (t("#welcomeScreen").css({ right: "0", left: "auto" }), t(".vis-welcomeScreenFeeds > .row").css("margin-right", "0px")), u >= 1366 && (t("#workflowActivity").css("display") == "none" ? (t("#welcomeScreen").width(i), o = n.Application.isRTL ? { width: i, right: i + 20 } : { width: i, left: i + 20 }, t("#fllupsScreen").animate(o, 200, function () { }), o = n.Application.isRTL ? { width: i, right: i * 2 + 40 } : { width: i, left: i * 2 + 40 }, t("#favLinks").animate(o, 200, function () { })) : t("#workflowActivity").css("display") == "block" && (h = u + i + 20, t(".scrollerHorizontal").width(h), ot.scroll(), t("#welcomeScreen").width(i), o = n.Application.isRTL ? { width: i, right: i + 20 } : { width: i, left: i + 20 }, t("#workflowActivity").animate(o, 200, function () { pt.scroll() }), o = n.Application.isRTL ? { width: i, right: i * 2 + 40 } : { width: i, left: i * 2 + 40 }, t("#fllupsScreen").animate(o, 200, function () { }), o = n.Application.isRTL ? { width: i, right: i * 3 + 60 } : { width: i, left: i * 3 + 60 }, t("#favLinks").animate(o, 200, function () { })), t("#vis_userDate").show()), u > 1024 && u < 1366) t("#workflowActivity").css("display") == "none" ? (n.Application.isRTL ? (t("#fllupsScreen").css("right", i + 20), t("#favLinks").css("right", i * 2 + 40)) : (t("#fllupsScreen").css("left", i + 20), t("#favLinks").css("left", i * 2 + 40)), t("#welcomeScreen,#fllupsScreen,#favLinks").width(i)) : t("#workflowActivity").css("display") == "block" && (h = u + i + 20, t(".scrollerHorizontal").width(h), ot.scroll(), t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(i), n.Application.isRTL ? (t("#workflowActivity").css("right", i + 20), t("#fllupsScreen").css("right", i * 2 + 40), t("#favLinks").css("right", i * 3 + 60)) : (t("#workflowActivity").css("left", i + 20), t("#fllupsScreen").css("left", i * 2 + 40), t("#favLinks").css("left", i * 3 + 60))), t("#vis_userDate").show(); else if (u >= 1e3 && u <= 1024) { if (t("#workflowActivity").css("display") == "none") { var s = u / 2, r = parseInt(s), c = r * e; t(".scrollerHorizontal").width(c); n.Application.isRTL ? (t("#fllupsScreen").css("right", r), t("#favLinks").css("right", r * 2)) : (t("#fllupsScreen").css("left", r), t("#favLinks").css("left", r * 2)); t("#welcomeScreen,#fllupsScreen,#favLinks").width(r - 20) } else if (t("#workflowActivity").css("display") == "block") { e = e + 1; var s = u / 2, r = parseInt(s), c = r * e; t(".scrollerHorizontal").width(c); ot.scroll(); t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(r - 20); n.Application.isRTL ? (t("#workflowActivity").css("right", r), t("#fllupsScreen").css("right", r * 2), t("#favLinks").css("right", r * 3)) : (t("#workflowActivity").css("left", r), t("#fllupsScreen").css("left", r * 2), t("#favLinks").css("left", r * 3)) } t("#vis_userDate").show() } else if (u < 1e3) { if (t("#workflowActivity").css("display") == "none") { var s = u * e, r = parseInt(s), f = u; t(".scrollerHorizontal").width(r); n.Application.isRTL ? (t("#fllupsScreen").css("right", f), t("#favLinks").css("right", f * 2)) : (t("#fllupsScreen").css("left", f), t("#favLinks").css("left", f * 2)); t("#welcomeScreen,#fllupsScreen,#favLinks").width(f - 20) } else if (t("#workflowActivity").css("display") == "block") { e = e + 1; var s = u * e, r = parseInt(s), f = u; t(".scrollerHorizontal").width(r); ot.scroll(); t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(f - 20); n.Application.isRTL ? (t("#workflowActivity").css("right", f), t("#fllupsScreen").css("right", f * 2), t("#favLinks").css("right", f * 3)) : (t("#workflowActivity").css("left", f), t("#fllupsScreen").css("left", f * 2), t("#favLinks").css("left", f * 3)) } t("#vis_userDate").hide() } } function nr() { var i = new Date, t = i.getHours(); return t < 12 ? n.Msg.getMsg("GoodMorning") : t < 17 ? n.Msg.getMsg("GoodAfternoon") : n.Msg.getMsg("GoodEvening") } function tr() { oi.load(n.Application.contextUrl + "Home/Home", function () { function cr(i, r, u) { sr.show(); er = !0; var f = n.Application.contextUrl + "Home/GetJSONFllups"; t.ajax({ url: f, data: { fllPageSize: i, fllPage: r, isRef: u }, type: "GET", cache: !1, datatype: "json", success: function (i) { var r = JSON.parse(i), f = 0, o = "", s = "", h = "", a, c, l, e; if (r.lstFollowups.length > 0) { u && di.text(r.FllCnt); for (a in r.lstFollowups) { if (c = r.lstFollowups[f].ChatID + "-" + r.lstFollowups[f].RecordID + "-" + r.lstFollowups[f].SubscriberID + "-" + r.lstFollowups[f].TableID + "-" + r.lstFollowups[f].WinID + "-" + r.lstFollowups[f].TableName, r.lstFollowups[f].Cdate != null && r.lstFollowups[f].Cdate != "" && (l = new Date(r.lstFollowups[f].Cdate), h = Globalize.format(l, "F", Globalize.cultureSelector)), r.lstFollowups[f].AD_Image_ID == 0) s = "<i data-fll='UID' data-UID='" + r.lstFollowups[f].AD_User_ID + "' class='fa fa-user'><\/i>"; else for (e in r.lstUserImg) if (r.lstUserImg[e].AD_Image_ID == r.lstFollowups[f].AD_Image_ID) { s = r.lstUserImg[e].UserImg != "NoRecordFound" && r.lstUserImg[e].UserImg != "FileDoesn'tExist" && r.lstUserImg[e].UserImg != null ? "<div class='vis-feedimgwrap'  data-fll='UID' data-UID='" + r.lstFollowups[f].AD_User_ID + "'><img data-fll='UID' data-UID='" + r.lstFollowups[f].AD_User_ID + "' alt='" + n.Msg.getMsg("UserImage") + "' title='" + n.Msg.getMsg("UserImage") + "' class='userAvatar-Feeds' src='" + n.Application.contextUrl + r.lstUserImg[e].UserImg + "?" + new Date(t.now()).getSeconds() + "'/><\/div>" : "<i data-fll='UID' data-UID='" + r.lstFollowups[f].AD_User_ID + "' class='fa fa-user'><\/i>"; break } o += "<div id=" + c + " data-fll='divfllups' class='vis-feedContainer'><div class='vis-feedTitleBar'><h3> " + r.lstFollowups[f].WinName + " : " + r.lstFollowups[f].Identifier + " <\/h3><div class='vis-feedTitleBar-buttons'><ul><li> <a href='javascript:void(0)'  data-fll='azoomfllups'  title='" + n.Msg.getMsg("ViewFollowups") + "'  class='vis vis-find'><\/a><\/li><li> <a href='javascript:void(0)'  data-fll='asubscribefllups'  title='" + n.Msg.getMsg("UnsubscribeFollowups") + "' class='fa fa-rss'><\/a><\/li><\/ul> <\/div><\/div><div id='divfllcmntdata" + r.lstFollowups[f].ChatID + "' data-fll='fll-cmnt' class='vis-feedDetails'><div class='vis-feedDetails-cmnt' data-fll='fll-cmnt'>" + s + "<p> <strong data-fll='UID' data-UID='" + r.lstFollowups[f].AD_User_ID + "'>"; o += r.lstFollowups[f].AD_User_ID == n.Env.getCtx().getAD_User_ID() ? n.Msg.getMsg("Me") + " <\/strong> <br />" : r.lstFollowups[f].Name + "<\/strong> <br />"; o += n.Utility.encodeText(r.lstFollowups[f].ChatData) + "<\/p><p class='vis-feedDateTime'>" + h + "<\/p><\/div><\/div><a id='divfllvm_" + r.lstFollowups[f].ChatID + "'  data-fll='viewmorefllupscmnt' href='javascript:void(0)' class='vis-viewMoreComments'><span class='vis-feedIcons vis-icon-viewMoreComments'><\/span>" + n.Msg.getMsg("ViewMoreComments") + "...<\/a><a id='divfllvl_" + r.lstFollowups[f].ChatID + "' style='display:none;'  data-fll='viewlessfllupscmnt' href='javascript:void(0)' class='vis-viewMoreComments'><span class='vis-feedIcons vis-icon-viewMoreComments'><\/span>" + n.Msg.getMsg("ViewLessComments") + "...<\/a> <div class='clearfix'><\/div> <div id=" + r.lstFollowups[f].ChatID + " class='vis-feedMessage'> <input id='txtFllCmnt" + r.lstFollowups[f].ChatID + "' data-fll='txtcmntfll' placeholder='" + n.Msg.getMsg("TypeMessage") + "' type='text' value='' /> <span  id='btnFllCmnt" + r.lstFollowups[f].ChatID + "' data-fll='btncmntfll' title='" + n.Msg.getMsg("PostMessage") + "'  class='vis vis-sms' ><\/span> <div class='clearfix'><\/div> <\/div><\/div> "; f++ } ut.append(o) } else br == !1 && (n.Application.isRTL ? ut.append("<p style='margin-top: 200px;text-align: center '>" + n.Msg.getMsg("NoRecordFound") + "!!!<\/p>") : ut.append("<p style='margin-top: 200px;text-align: center '>" + n.Msg.getMsg("NoRecordFound") + "!!!<\/p>")); er = !1; bi = !0; sr.hide() }, error: function () { bi = !0 } }) } function kr(i, r, u) { var f = n.Application.contextUrl + "Home/GetJSONFllupsCmnt/"; t.ajax({ url: f, data: { FllupsID: i, fllCmntPageSize: r, fllCmntPage: u }, type: "GET", cache: !1, datatype: "json", success: function (i) { var r = JSON.parse(i), u = 0, e = "", c = "", a = r.lstFollowups[u].ChatID, s = "", o, l, f, h; for (o in r.lstFollowups) { if (r.lstFollowups[o].Cdate != null && r.lstFollowups[o].Cdate != "" && (l = new Date(r.lstFollowups[o].Cdate), c = Globalize.format(l, "F", Globalize.cultureSelector)), r.lstFollowups[u].AD_Image_ID == 0) s = "<i data-fll='UID' data-UID='" + r.lstFollowups[u].AD_User_ID + "' class='fa fa-user'><\/i>"; else for (f in r.lstUserImg) if (r.lstUserImg[f].AD_Image_ID == r.lstFollowups[u].AD_Image_ID) { s = r.lstUserImg[f].UserImg != "NoRecordFound" && r.lstUserImg[f].UserImg != "FileDoesn'tExist" && r.lstUserImg[f].UserImg != null ? "<div class='vis-feedimgwrap' data-fll='UID' data-UID='" + r.lstFollowups[u].AD_User_ID + "'><img  alt='" + n.Msg.getMsg("UserImage") + "'  title='" + n.Msg.getMsg("UserImage") + "'  class='userAvatar-Feeds' src='" + r.lstUserImg[f].UserImg + "?" + new Date(t.now()).getSeconds() + "'/><\/div>" : "<i  data-fll='UID' data-UID='" + r.lstFollowups[u].AD_User_ID + "'    class='fa fa-user'><\/i>"; break } e += "<div class='vis-feedDetails-cmnt'  data-fll='fll-cmnt'>" + s + "<p> <strong  data-fll='UID' data-UID='" + r.lstFollowups[u].AD_User_ID + "'>"; e += r.lstFollowups[u].AD_User_ID == n.Env.getCtx().getAD_User_ID() ? n.Msg.getMsg("Me") + " <\/strong> <br />" : r.lstFollowups[u].Name + "<\/strong> <br />"; e += n.Utility.encodeText(r.lstFollowups[u].ChatData) + "<\/p><p class='vis-feedDateTime'>" + c + "<\/p><\/div>"; u++ } h = t("#divfllcmntdata" + a); h.html(""); h.append(e) }, error: function () { console.log("Error") } }) } function lr(i, r) { var u = n.Application.contextUrl + "Home/PostFllupsCmnt/"; t.ajax({ url: u, data: { fllChatID: wi, fllSubscriberID: fr, cmntTxt: i }, type: "POST", cache: !1, datatype: "json", success: function (u) { var s = new Date, h = Globalize.format(s, "F", Globalize.cultureSelector), f = u, c = n.context.getContext("##AD_User_Name"), e = "", o; e = f !== null ? f != "NoRecordFound" && f != "FileDoesn'tExist" ? "<div class='vis-feedimgwrap'  data-fll='UID' data-UID='" + n.Env.getCtx().getAD_User_ID() + "' ><img data-fll='UID' data-UID='" + n.Env.getCtx().getAD_User_ID() + "'  alt='" + n.Msg.getMsg("UserImage") + "'  class='userAvatar-Feeds' src='" + f + "?" + new Date(t.now()).getSeconds() + "' /><\/div>" : "<i data-fll='UID' data-UID='" + n.Env.getCtx().getAD_User_ID() + "' class='fa fa-user'><\/i>" : "<i data-fll='UID' data-UID='" + n.Env.getCtx().getAD_User_ID() + "' class='fa fa-user'><\/i>"; o = "<div class='vis-feedDetails-cmnt' data-fll='fll-cmnt'>" + e + "<p> <strong  data-fll='UID' data-UID='" + n.Env.getCtx().getAD_User_ID() + "'>" + n.Msg.getMsg("Me") + "<\/strong><br />" + n.Utility.encodeText(i) + "<\/p><p class='vis-feedDateTime'>" + h + "<\/p><\/div>"; r.append(o) }, error: function () { console.log("Error") } }) } var or, ir, bi; et = !1; at = !1; k = !1; f = !1; l = t("#sAlrtTxtType"); h = t("#hAlrtTxtTypeCount"); b = t("#ulHomeTabMenu"); wt = t("#divTabMenuDataLoder"); c = t("#spanWelcomeTabtopHdr"); yi = t("#searchData"); ot = t("#dataContainer"); ut = t("#fllupsList"); pt = t("#workflowActivityData"); li = t("#userLinks-List"); ai = t("#userFavs-List"); a = t("#hlnkTabDataRef"); i = t("#welcomeScreenFeedsList"); vi = t("#favLinks"); r = 1; w = t("#workflowActivity"); dt = t("#divTabMenuDataLoder"); vt = t("#workflowActivityDetails"); ft = t("#hWelcomeScreenSwapHdr"); v = t("#sNewNts"); p = t("#WFSearchshow"); tt = t("#divNoticeCount"); rt = t("#divRequestCount"); gt = t("#divNotesCount"); ni = t("#divAptCount"); ii = t("#divKPI"); e = 10; u = 0; o = 0; s = 0; y(); t(window).resize(y); t("div.vis-workflowActivityTitleBar-buttons ul li .vis-icon-check").on(n.Events.onTouchStartOrClick, function () { t("#workflowActivity").hide(); t(".vis-activityContainer").removeClass("vis-activeFeed"); y(); ot.scroll() }); t("#btnWFAClose").on(n.Events.onTouchStartOrClick, function () { t("#workflowActivity").hide(); t(".vis-activityContainer").removeClass("vis-activeFeed"); y(); ot.scroll() }); n.changeUserImage(); t("#userFav-Tab").click(function () { t("#userLinks div").removeClass("row userLinks_activeTab"); t("#userLinks div").addClass("row userLinks_inactiveTab"); t("#userFavs div").removeClass("row userFavs_inactiveTab"); t("#userFavs div").addClass("row userFavs_activeTab"); t("#userLinks-List").hide("fast"); t("#userFavs-List").show("fast", function () { setTimeout(function () { }, 0) }) }); t("#userLinks-Tab").click(function () { t("#userFavs div").removeClass("row userFavs_activeTab"); t("#userFavs div").addClass("row userFavs_inactiveTab"); t("#userLinks div").removeClass("row userLinks_inactiveTab"); t("#userLinks div").addClass("row userLinks_activeTab"); t("#userFavs-List").hide("fast"); t("#userLinks-List").show("fast", function () { setTimeout(function () { }, 0) }) }); n.shortcutMgr.init(t("#userLinks-List"), t("#userFavs-List")); t(".vis-welcomeScreenFeeds").hide(); t(".vis-icon-userfeeds").off("click"); t(".vis-icon-userfeeds").on("click", function () { t(".vis-welcomeScreen-Data").hide("slow"); t(".vis-welcomeScreenFeeds").show("fast") }); t(".vis-welcomeScreenTab-notificationBubbles").on("click", function () { return !1 }); or = nr(); t("#vis-userGreeting").text(or); a.on("click", function () { if (f = !0, et == !1 && r != si) if (r == yt) d = 0, e = g, u = nt, s = 0, it(), fi(); else if (r == ri) y(), v.hide(), p.show(), l.empty(), l.append(n.Msg.getMsg("WorkflowActivities")), h.empty(), h.append(t("#divfActivity").html()), ft.empty(), ft.append(n.Msg.getMsg("Activity")), d = 0, e = g, u = nt, s = 0, st == null && (st = new n.wfActivity(i, vt, pt, i, p)), st.Load(!0); else if (r == ct) d = 0, e = g, u = nt, s = 0, it(), ei(); else if (r == bt) d = 0, e = g, u = nt, s = 0, WSP.wspHomeMgr.viewWSPHome(bt, f); else if (r == kt) d = 0, e = g, u = nt, s = 0, WSP.wspHomeMgr.viewWSPHome(kt, f); else { if (r == hi) return; r == ht ? (d = 0, e = g, u = nt, s = 0, it(), WSP.wspHomeMgr.viewWSPHome(ht, f)) : r == lt ? (d = 0, e = g, u = nt, s = 0, it(), WSP.wspHomeMgr.viewWSPHome(lt, f)) : r == ui && (w.hide(), y(), d = 0, e = g, u = nt, s = 0, it(), p.hide(), VADB.Apps.KpiHomeScreen(i, dt, v, w, vt, ft, ii)) } }); i.on("click", function (i) { var o = t(i.target).data("vishomercrd"), f; if (r == ct) { if (i.target.tagName === "SPAN" && o === "more") { if (t(i.target.parentNode.parentNode).data("vishomercrd") == "more-details") { var s = i.target.parentNode.parentNode.id, h = t("#snoticetitle_" + s), c = t("#snoticedesc_" + s), l = t("#snoticemore_" + s); l.hide(); h.hide(); c.show(); t("#snoticeless_" + s).show() } } else if (t(i.target.parentNode.parentNode).data("vishomercrd") == "more-details") { var s = i.target.parentNode.parentNode.id, h = t("#snoticetitle_" + s), c = t("#snoticedesc_" + s), l = t("#snoticemore_" + s); l.show(); h.show(); c.hide(); t("#snoticeless_" + s).hide() } if (o === "view") { var f = i.target.id, u = f.toString().split("|"), a = u[0], v = u[1], y = u[2], nt = u[3], e = new n.Query; e.addRestriction(v + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(a)); n.viewManager.startWindow(y, e) } else if (o === "liview") { var f = i.target.firstChild.id, u = f.toString().split("|"), a = u[0], v = u[1], y = u[2], nt = u[3], e = new n.Query; e.addRestriction(v + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(a)); n.viewManager.startWindow(y, e) } else if (o === "approve") f = i.target.id, ci(f, !0); else if (o === "liapprove") f = i.target.firstChild.id, ci(f, !0); else if (o === "lispecial") { var f = i.target.firstChild.id, u = f.toString().split("|"), p = u[0], w = u[1], b = u[2], e = new n.Query; e.addRestriction(w + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(p)); n.viewManager.startWindow(b, e) } else if (o === "lispecial1") { var f = i.target.id, u = f.toString().split("|"), p = u[0], w = u[1], b = u[2], e = new n.Query; e.addRestriction(w + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(p)); n.viewManager.startWindow(b, e) } } else if (r == yt) if (o === "view") { var f = i.target.id, u = f.toString().split("|"), k = u[0], d = u[1], g = u[2], e = new n.Query; e.addRestriction(d + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(k)); n.viewManager.startWindow(g, e) } else if (o === "liview") { var f = i.target.firstChild.id, u = f.toString().split("|"), k = u[0], d = u[1], g = u[2], e = new n.Query; e.addRestriction(d + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(k)); n.viewManager.startWindow(g, e) } }); ir = !0; i.bind("scroll", function () { if (t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight * .75 && ir) if (ir = !1, setTimeout(function () { ir = !0 }, 100), k = !0, f = !1, r == ri) if (o = parseInt(t("#divfActivity").html()), s = u * e, s <= o && st != null) u += 1, st.AppendRecord(u, e); else return; else if (r == ct) if (o = parseInt(tt.text()), s = u * e, u += 1, s <= o) ei(); else return; else if (r == yt) if (o = parseInt(rt.text()), s = u * e, u += 1, s <= o) fi(); else return; else if (r == ht && window.WSP) if (o = parseInt(ni.text()), s = u * e, u += 1, s <= o) WSP.wspHomeMgr.doScrollWSPHome(ht, u, e); else return; else if (r == lt && window.WSP) if (o = parseInt(gt.text()), s = u * e, s <= o) u += 1, WSP.wspHomeMgr.doScrollWSPHome(lt, u, e); else return }); var ar = t("#hlnkFllupsRef"), di = t("#follupsCount"), sr = t("#divFllMainLoder"), ki = "", vr = "", oi = "", yr = 0, gi = 10, tr = 1, ur = 0, hr = 0, pr = 10, wr = 0, wi = 0, fr = 0, br = !1, rr = !1, er = !1; ut.on("click", function (i) { var f = t(i.target).data("fll"), u, e, o, c, s, r, h, l, a; if (f === "viewmorefllupscmnt") oi = i.target.parentNode.id, wi = 0, fr = 0, wi = i.target.parentNode.children[3].id, kr(oi, pr, wr), u = i.target.id, e = u.split("_"), t("#divfllvl_" + e[1]).show(), t("#" + u).hide(); else if (f === "viewlessfllupscmnt") oi = i.target.parentNode.id, wi = 0, fr = 0, wi = i.target.parentNode.children[3].id, u = i.target.id, e = u.split("_"), t("#divfllvm_" + e[1]).show(), o = t("#divfllcmntdata" + e[1]), c = o.find("div:last-child"), o.empty(), o.html(c), t("#" + u).hide(); else if (f === "azoomfllups") oi = i.target.parentNode.parentNode.parentNode.parentNode.parentNode.id, r = oi.toString().split("-"), s = new n.Query, s.addRestriction(r[5] + "_ID", n.Query.prototype.EQUAL, n.Utility.Util.getValueOfInt(r[1])), n.viewManager.startWindow(r[4], s); else if (f === "asubscribefllups") oi = i.target.parentNode.parentNode.parentNode.parentNode.parentNode.id, r = oi.toString().split("-"), t.ajax({ url: n.Application.contextUrl + "Subscribe/UnSubscribe", type: "GET", dataType: "Json", data: { AD_Window_ID: r[4], Record_ID: r[1], AD_Table_ID: r[3] }, success: function (i) { if (i == !1) alert(n.Msg.getMsg("UnSubscription Failed")); else { t("#" + oi).animate({ width: "100%", height: "132px", "margin-top": "-132px" }, 700, function () { t("#" + oi).remove() }); var r = di.text(); di.text(r - 1) } } }); else if (f === "btncmntfll") wi = i.target.parentNode.id, FllupsData = t("#" + i.target.parentNode.parentNode.children[1].id), ki = t("#" + i.target.previousElementSibling.id), vr = t("#" + i.target.id), h = t(ki).val(), h !== "" && (l = new Date, a = Globalize.format(l, "F", Globalize.cultureSelector), lr(h, FllupsData), t(ki).val("")); else if (f == "UID") { var v = t(i.target).data("uid"), y = n.Env.getWindowNo(), p = new n.ContactInfo(v, y); p.show() } }); ut.on("keydown", function (n) { var u = t(n.target).data("fll"), i, r; u === "txtcmntfll" && (oi = n.target.parentNode.parentNode.id, wi = n.target.parentNode.id, FllupsData = t("#" + n.target.parentNode.parentNode.children[1].id), ki = t("#" + n.target.id), i = t(ki).val(), i !== "" && i !== null && (r = n.charCode || n.keyCode, r === pi && (lr(i, FllupsData), t(ki).val("")))) }); bi = !0; ut.bind("scroll", function () { if (t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight * .75 && bi) { if (rr = !1, bi = !1, ur = di.text(), ur > gi) if (hr = tr * gi, tr += 1, hr <= ur) cr(gi, tr, rr); else { bi = !0; return } bi = !0 } }); ar.on("click", function () { er == !1 && (gi = 10, tr = 1, yr = di.text(), rr = !0, ut.empty(), cr(gi, tr, rr)) }); b.off("click"); ti(); window.WSP ? (at = !0, p.hide(), WSP.wspHomeMgr.initWSPHome(i, b, vt, pt, w, dt, ft, v, l, h, ni, gt)) : console.log("PleaseInstallWSPModule") }) } function ir() { return { activeTabType: r } } function fi() { wt.show(); et = !0; t.ajax({ url: n.Application.contextUrl + "Home/GetJSONHomeRequest", data: { pagesize: e, page: u, isTabDataRef: f }, type: "GET", datatype: "json", cache: !1, success: function (t) { var u = JSON.parse(t.data), c = "", e, p, v, y, s, l, a; if (u.length > 0) { r == yt && f && (o = parseInt(t.count), rt.empty(), rt.show(), h.empty(), rt.text(t.count), h.text(t.count)); for (e in u) p = "", (u[e].StartDate != null || u[e].StartDate != "") && (s = new Date(u[e].StartDate), p = Globalize.format(s, "d", Globalize.cultureSelector)), v = "", u[e].NextActionDate != null ? (s = new Date(u[e].NextActionDate), v = Globalize.format(s, "d", Globalize.cultureSelector)) : v = "&nbsp;-----------", y = "", (u[e].CreatedDate != null || u[e].CreatedDate != "") && (s = new Date(u[e].CreatedDate), y = Globalize.format(s, "F", Globalize.cultureSelector)), l = u[e].Summary, l.length > 80 && (l = l.substr(0, 80) + "..."), a = u[e].CaseType, a.length > 30 && (a = a.substr(0, 30) + "..."), c += "<div class='vis-activityContainer'><div class='vis-feedTitleBar'><h3>#" + u[e].DocumentNo + "<\/h3><div class='vis-feedTitleBar-buttons'><ul>", u[e].Name && u[e].Name.length > 0 && (c += "<li class='vis-home-request-BP'>" + u[e].Name + "<\/li>"), + "<li class='vis-home-request-BP'>" + u[e].Name + "<\/li>", c += "<li data-vishomercrd='liview'><a href='javascript:void(0)' data-vishomercrd='view' id=" + u[e].R_Request_ID + "|" + u[e].TableName + "|" + u[e].AD_Window_ID + "  title='" + n.Msg.getMsg("View") + "'  class='vis vis-find'><\/a><\/li><\/ul><\/div><\/div><div  class='vis-feedDetails vis-pt-0 vis-pl-0'><div class='vis-table-request'><ul><li><span>" + n.Msg.getMsg("Priority") + ":<\/span><br>" + u[e].Priority + "<\/li><li><span>" + n.Msg.getMsg("Status") + ":<\/span><br>" + u[e].Status + "<\/li><li><span>" + n.Msg.getMsg("NextActionDate") + ":<\/span><br>" + v + "<\/li><\/ul><\/div><p class='vis-maintain-customer-p'><strong>" + n.Utility.encodeText(a) + " <\/strong><br /><span>" + n.Msg.getMsg("Message") + ":<\/span><br>" + n.Utility.encodeText(l) + "<\/p><p class='vis-feedDateTime'  style=' width: 69%; margin-right: 10px;'>" + y + "<\/p><\/div><\/div>" } else i.find(".vis-table-request").length == 0 && k == !1 && (c = n.Application.isRTL ? "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>" : "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>", rt.empty(), h.empty(), rt.text(0), rt.hide(), h.text(0)); et = !1; ti(); r == yt && i.append(c); wt.hide() } }) } function ei() { et = !0; wt.show(); t.ajax({ url: n.Application.contextUrl + "Home/GetJSONHomeNotice", data: { pagesize: e, page: u, isTabDataRef: f }, type: "GET", datatype: "json", success: function (t) { var u = JSON.parse(t.data), s = "", l = null, e, a, c, v; if (u.length > 0) { r == ct && f && (o = parseInt(t.count), tt.empty(), tt.show(), h.empty(), tt.text(t.count), h.text(t.count)); for (e in u) u[e].CDate != null && u[e].CDate != "" && (a = new Date(u[e].CDate), l = Globalize.format(a, "F", Globalize.cultureSelector)), c = "", v = u[e].Description, c = v.length <= 100 ? "<pre><strong style='color:#666666' data-vishomercrd='title' id='" + u[e].AD_Note_ID + "'>" + n.Utility.encodeText(u[e].Title) + "<\/strong><\/pre>" : "<pre><strong  id='snoticetitle_" + u[e].AD_Note_ID + "'  style='color:#666666;' >" + n.Utility.encodeText(u[e].Title) + "...<\/strong><strong id='snoticedesc_" + u[e].AD_Note_ID + "' style='display:none; color:#666666;'>" + n.Utility.encodeText(u[e].Description) + "...<\/strong> <span id='snoticemore_" + u[e].AD_Note_ID + "' data-vishomercrd='more' style='color:rgba(var(--v-c-primary), 1); float:right;height:20px'>" + n.Msg.getMsg("more") + "<\/span><span id='snoticeless_" + u[e].AD_Note_ID + "' data-vishomercrd='less' style='display:none; color:rgba(var(--v-c-primary), 1); float:right;height:20pxvis-feedTitleBar'>" + n.Msg.getMsg("less") + "<\/span><\/pre>", s += "<div data-vishomercrd='view-recrd-cntainer' id='divrecdcntnr_" + u[e].AD_Note_ID + "' class='vis-activityContainer'> <div class='vis-feedTitleBar'>", s += u[e].SpecialTable ? "<h3>" + n.Utility.encodeText(u[e].MsgType) + "<\/h3>" : "<h3>" + n.Utility.encodeText(u[e].MsgType) + "<\/h3>", s += " <div class='vis-feedTitleBar-buttons'>  <ul>", s += "<li data-vishomercrd='liapprove'><a href='javascript:void(0)' data-vishomercrd='approve'  id=" + u[e].AD_Note_ID + "  title='" + n.Msg.getMsg("Acknowledge") + "' class='vis vis-markx'><\/a><\/li><li data-vishomercrd='liview'><a href='javascript:void(0)' data-vishomercrd='view' id=" + u[e].AD_Note_ID + "|" + u[e].TableName + "|" + u[e].AD_Window_ID + "|" + u[e].Record_ID + " title='" + n.Msg.getMsg("View") + "' class='vis vis-find'><\/a><\/li><\/ul>  <\/div><\/div><div data-vishomercrd='more-details' id=" + u[e].AD_Note_ID + " class='vis-feedDetails'>" + c + " <p class='vis-feedDateTime'>" + n.Utility.encodeText(l) + "<\/p> <\/div> <\/div>" } else i.find(".vis-feedTitleBar").length == 0 && (s = n.Application.isRTL ? "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>" : "<p style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>", r == ct && (tt.empty(), h.empty(), tt.hide(), tt.text(t.count), h.text(t.count))); et = !1; ti(); wt.hide(); r == ct && i.append(s) } }) } function ci(i, r) { t.ajax({ url: n.Application.contextUrl + "Home/ApproveNotice", data: { Ad_Note_ID: i, isAcknowldge: r }, type: "POST", datatype: "json", success: function (n) { var r = JSON.parse(n); t("#divrecdcntnr_" + i).animate({ width: "0px", height: "132px", "margin-left": "800px" }, 700, "", function () { t("#divrecdcntnr_" + i).remove() }) } }) } function ti() { b.off("click"); b.on("click", function (ut) { var ot, wt; if (a.show(), i.css({ "margin-left": "auto", "margin-top": "auto" }), i.css({ "text-align": "", "margin-top": "" }), t(".vis-welcomeScreenTabMenu li").removeClass("vis-activeTab"), ut.target.nodeName == "LI" ? t(ut.target).addClass("vis-activeTab") : ut.target.nodeName == "A" && t(ut.target.parentNode).addClass("vis-activeTab"), ot = t(ut.target).data("vishome"), ot === "userprofile") c.show(), r = si, k = !1, f = !0, t("li .vis-welcomeScreenTab-notificationBubbles").removeClass("blank").addClass("vis-feedsAlert"), t("li:first-child .vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t("li:last-child .vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreenContainer > div").fadeOut("fast"), t(".vis-welcomeScreen-Data").fadeIn("fast"), v.hide(), p.hide(), w.hide(), y(); else if (ot === "KPI") t(".vis-welcomeScreen-Data").hide("fast"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(""), c.show(), l.html(n.Msg.getMsg("KPI")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-kpi"), i.css({ "text-align": "", "margin-top": "" }), r = ui, window.VADB && window.VADB != null && VADB.Apps.KpiHomeScreen != undefined ? (i.css({ "text-align": "auto" }), r = ui, k = !1, f = !0, t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), a.css("margin-right", "17px"), b.off("click"), VADB.Apps.KpiHomeScreen(i, dt, v, w, vt, ft, ii), w.hide(), y(), v.show(), p.hide()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallVADashboard")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" })); else if (ot === "workflow") c.show(), b.off("click"), i.css("overflow-y", "auto"), i.css({ "text-align": "auto" }), r = ri, k = !1, f = !0, a.css("margin-right", "17px"), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-userfeed"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), w.hide(), y(), v.hide(), p.show(), l.empty(), l.append(n.Msg.getMsg("WorkflowActivities")), h.empty(), h.append(t("#divfActivity").html()), ft.empty(), ft.append(n.Msg.getMsg("Activity")), it(), d = 0, e = g, u = nt, s = 0, st = new n.wfActivity(i, vt, pt, i, p), st.Load(!1); else if (ot === "notice") c.show(), b.off("click"), r = ct, k = !1, f = !0, a.css("margin-right", "17px"), i.css("overflow-y", "auto"), i.css({ "text-align": "auto" }), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-notice"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(n.Msg.getMsg("Notice")), v.hide(), p.hide(), o = parseInt(tt.text()), tt.text(o), h.text(o), et == !1 && (d = 0, e = 10, u = 1, s = 0, it(), ei()), w.hide(), y(); else if (ot === "mytask") t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(""), l.html(n.Msg.getMsg("MyTask")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-mytasks"), i.css({ "text-align": "", "margin-top": "" }), r = bt, at ? (i.css({ "text-align": "auto" }), b.off("click"), c.show(), r = bt, k = !1, f = !1, i.css("overflow-y", "hidden"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.show(), p.hide(), h.html(t("#divMyTaskCount").html()), a.css("margin-right", "17px"), WSP.wspHomeMgr.viewWSPHome(bt, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" })); else if (ot === "taskassignbyme") t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(""), l.html(n.Msg.getMsg("TaskAssignByMe")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-taskassigned"), i.css({ "text-align": "", "margin-top": "" }), r = kt, at ? (i.css({ "text-align": "auto" }), c.show(), b.off("click"), k = !1, f = !1, r = kt, i.css("overflow-y", "hidden"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.show(), p.hide(), h.html(parseInt(t("#divTaskAssignBymeCount").html())), a.css("margin-right", "17px"), WSP.wspHomeMgr.viewWSPHome(kt, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" })); else if (ot === "documentrecive") c.show(), a.css("margin-right", "17px"), a.hide(), r = hi, k = !1, f = !0, w.hide(), y(), i.css("overflow-y", "auto"), i.css({ "text-align": "auto" }), l.html(n.Msg.getMsg("Documents")), o = 0, h.html(o), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-document"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), it(), wt = "<p style=' margin-top:200px;text-align:center'>" + n.Msg.getMsg("PleaseInstallDMSModule") + "<\/p>", i.html(wt), v.hide(), p.hide(); else if (ot === "request") { c.show(); b.off("click"); r = yt; k = !1; f = !0; i.css("overflow-y", "auto"); i.css({ "text-align": "auto" }); c.removeClass().addClass("vis-welcomeScreenContentTittle-icon fa fa-bell-o"); t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"); t(".vis-welcomeScreen-Data").hide("slow"); t(".vis-welcomeScreenFeeds").fadeIn("fast"); v.show(); p.hide(); a.css("margin-right", "17px"); l.html(n.Msg.getMsg("Requests")); o = parseInt(rt.text()); h.html(o); et == !1 && (d = 0, e = g, u = nt, s = 0, it(), fi()); w.hide(); y(); v.off("click"); v.on("click", function () { var i = ki("VIS_129"), t = new n.Query; t.addRestriction("R_Request_ID", n.Query.prototype.EQUAL, 0); n.viewManager.startWindow(i, t) }) } else ot === "appointments" ? (t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(""), l.html(n.Msg.getMsg("Appointment")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-appointment"), i.css({ "text-align": "", "margin-top": "" }), r = ht, at ? (i.css({ "text-align": "auto" }), b.off("click"), c.show(), r = ht, k = !1, f = !0, a.css("margin-right", "17px"), i.css("overflow-y", "auto"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.hide(), p.hide(), o = parseInt(ni.text()), h.html(o), d = 0, e = g, u = nt, s = 0, WSP.wspHomeMgr.viewWSPHome(ht, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" }))) : ot === "notes" && (t(".vis-welcomeScreen-Data").hide("slow"), t(".vis-welcomeScreenFeeds").fadeIn("fast"), l.html(""), l.html(n.Msg.getMsg("MyNotes")), c.removeClass().addClass("vis-welcomeScreenContentTittle-icon vis vis-contacts"), i.css({ "text-align": "", "margin-top": "" }), r = lt, at ? (i.css({ "text-align": "auto" }), b.off("click"), r = lt, c.show(), k = !1, f = !0, a.css("margin-right", "17px"), i.css("overflow-y", "auto"), t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"), v.show(), p.hide(), o = parseInt(gt.text()), h.html(o), d = 0, e = g, u = nt, s = 0, it(), WSP.wspHomeMgr.viewWSPHome(lt, f), w.hide(), y()) : (a.hide(), i.html(n.Msg.getMsg("PleaseInstallWSPModule")), n.Application.isRTL ? i.css({ "text-align": "center", "margin-top": "200px" }) : i.css({ "text-align": "center", "margin-top": "200px" }))) }) } function it() { i.children().length > 0 && i.children().remove(); i.empty() } var oi = null, ot = null, ut = null, pt = null, li = null, ai = null, i = null, a = null, vi = null, r = null, w = null, at = null, dt = null, vt = null, ft = null, st = null, et = null, f = null, b = null, wt = null, tt = null, rt = null, gt = null, ni = null, ii = null, l = null, h = null, c = null, yi = null, pi = 13, si = 1, yt = 2, ri = 3, ht = 4, bt = 5, kt = 6, hi = 7, ct = 8, lt = 9, ui = 10, g = 10, nt = 1, k = null, d = null, e = null, u = null, o = null, s = null, v = null, p = null, wi = n.Application.contextUrl, bi = wi + "JsonData/JDataSetWithCode", ki = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return di(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; return t("#vis_appInfoWindow").click(function () { n.InfoMenu.show(t(this)) }), { initHome: gi, adjustDivSize: y, BindMenuClick: ti, getActiveTab: ir } } n.HomeMgr = i() }(VIS, jQuery), function (n, t) { function i() { function e() { i = t("#vis-textStatus"); t.ajax({ url: n.Application.contextUrl + "Home/SaveStatus", dataType: "json", type: "POST", async: !1, data: { status: i.val() }, success: function (n) { JSON.parse(n).length > 0 ? (i.css("visibility", "hidden"), f.css("visibility", "hidden"), u.css("visibility", "hidden"), r.css("visibility", "visible"), r.text(JSON.parse(n))) : (i.css("visibility", "visible"), f.css("visibility", "hidden"), u.css("visibility", "hidden"), r.css("visibility", "visible"), r.text(JSON.parse(n))) } }) } var i = t("#vis-textStatus"), u = t("#vis-img-OKStatus"), f = t("#vis-img-CancelStatus"), r = t("#vis-labelStatus"); t("#vis-file-input").change(function () { var u = document.getElementById("vis-file-input").files[0], i, r, f; if (u != null) { if (i = u.type.split("/").pop().toLowerCase(), i != "jpeg" && i != "jpg" && i != "png" && i != "ico" && i != "webp" && i != "svg") return n.ADialog.info("SelectImageOnly"), !1; r = new XMLHttpRequest; f = new FormData; f.append("file", u); r.open("POST", n.Application.contextUrl + "Home/SaveImageAsByte", !0); r.send(f); r.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i), u = JSON.parse(r); t("#imgUsrImage").attr("src", "data:image/jpg;base64," + u) }, !1) } }); u.on("click", function () { e() }); f.on("click", function () { i.css("visibility", "hidden"); f.css("visibility", "hidden"); u.css("visibility", "hidden"); r.css("visibility", "visible") }); i.on("focus", function () { f.css("visibility", "visible"); u.css("visibility", "visible") }); i.on("keypress", function (n) { var t = n.keyCode || n.which; t == 13 && e() }); i.on("blur", function () { }); r.on("click", function () { r.css("visibility", "hidden"); i.css("visibility", "visible"); i.val(r.text()); i.focus() }) } n.changeUserImage = i }(VIS, jQuery), function (n, t) { function r() { function s(t, i) { e = t; r = e.find("#vis_linkScroll"); n.favMgr.init(i); h(); c() } function h() { n.dataContext.getJSONData(n.Application.contextUrl + "Home/GetShortcutItems", null, function (t) { var u, i, e; if (f = t, u = null, i = ['<ul class="vis-userLinks-ListMenu">'], t) for (e = 0; e < t.length; e++)u = t[e], i.push('<li data-index="' + e + '" ><a data-index="' + e + '" href="javascript:void(0)">'), u.HasImage ? !u.IsImageByteArray && u.IconUrl.indexOf(".") < 0 ? i.push('<i data-index="' + e + '" class="' + u.IconUrl + '"') : (i.push('<img data-index="' + e + '"  src="'), u.IsImageByteArray ? i.push("data:image/*;base64," + u.IconBytes) : i.push(n.Application.contextUrl + u.IconUrl)) : i.push('<i data-index="' + e + '" class="vis vis-shortcut"'), i.push('" />'), i.push(u.ShortcutName + "<\/a><\/li>"); i.push("<\/ul>"); r.empty(); r.html(i.join(" ")); i = []; l(t.length) }) } function c() { r.on("click", function (r) { var e = t(r.target).data("index"), u, h, s, a, l, c; if ((e || e == "0") && e < f.length) if (u = f[e], u.HasChild) h = new i(u.KeyID), h.show(), h = null; else if (u.Url || u.Url.length > 0) n.Env.startBrowser(u.Url); else if (u.SpecialAction && u.SpecialAction.length > 0) { s = u.SpecialAction; a = u.ActionName; try { l = n.Utility.getFunctionByName(s, window); c = new l; c.show(); c = null } catch (r) { return o.log(n.Logging.Level.WARNING, "Class=" + s + ", Action Class Name=" + s, r), !1 } } else { if (u.Action == null || u.Action.length <= 0 || u.ActionID < 1) return; n.viewManager.startAction(u.Action, u.ActionID) } }) } function l(i) { u.empty(); u.append(t("<span><i class='fa fa-link' aria-hidden='true' style='transform: rotate(90deg);'><\/i><\/span>")); u.append(n.Msg.getMsg("Links") + " - "); u.append(t("<strong>").append(i)) } var e, r, f = null, o = n.Logging.VLogger.getVLogger("ShortCut"), u = t("#userLinks-Tab"); return { init: s } } function i(i) { function s() { n.dataContext.getJSONData(n.Application.contextUrl + "Home/GetSettingItems", { AD_Shortcut_ID: i }, function (t) { var r, i, e; if (u = t, r = null, i = ['<ul class="vis-userLinks-ListMenu">'], t) for (e = 0; e < t.length; e++)r = t[e], i.push('<li data-index="' + e + '" ><a data-index="' + e + '" href="javascript:void(0)">'), r.HasImage ? !r.IsImageByteArray && r.IconUrl.indexOf(".") < 0 ? i.push('<i data-index="' + e + '" class="' + r.IconUrl + '"') : (i.push('<img data-index="' + e + '"  src="'), r.IsImageByteArray ? i.push("data:image/*;base64," + r.IconBytes) : i.push(n.Application.contextUrl + r.IconUrl)) : i.push('<i data-index="' + e + '" class="vis vis-shortcut"'), i.push('" />'), i.push(r.ShortcutName + "<\/a><\/li>"); i.push("<\/ul>"); f.empty(); f.html(i.join(" ")); h() }) } function h() { f.on("click", function (i) { var e = t(i.target).data("index"), f, s, l, c, h; if ((e || e == "0") && e < u.length) { if (f = u[e], f.HasChild) n.Msg.getMsg("settingDialog"); else if (f.Url || f.Url.length > 0) n.Env.startBrowser(f.Url); else if (f.SpecialAction && f.SpecialAction.length > 0) { s = f.SpecialAction; l = f.ActionName; try { c = n.Utility.getFunctionByName(s, window); h = new c; h.show(); h = null } catch (i) { return o.log(n.Logging.Level.WARNING, "Class=" + s + ", Action Class Name=" + s, i), !1 } } else { if (f.Action == null || f.Action.length <= 0 || f.ActionID < 1) return; n.viewManager.startAction(f.Action, f.ActionID) } r.close() } }) } var e = t("<div>"), f = t('<div style="width:auto;z-index:1">').html('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), o = n.Logging.VLogger.getVLogger("SettingDialog"), r, u; e.append(f); r = null; u = null; this.show = function () { r = new n.ChildDialog; r.setWidth(540); r.setHeight(400); r.setTitle(n.Msg.getMsg("Setting")); r.setContent(e); r.show() }; this.disposeComponent = function () { f.off("click"); f.remove(); u && (u.length = 0); u = null; this.show = null; e = null; r && r.dispose() }; s() } i.prototype.dispose = function () { this.disposeComponent() }; n.shortcutMgr = r() }(VIS, jQuery), function (n, t) { var i = n.historyMgr || {}, r; "replaceState" in history ? i.replaceHash = function (n) { ("" + n).charAt(0) !== "#" && (n = "#" + n); history.replaceState("", "", n) } : (r = location.hash, i.replaceHash = function (n) { location.hash !== r && history.back(); location.hash = n }); i.updateHistory = function (n) { i.replaceHash(n) }; i.restoreHistory = function () { var n = i.geHashtLocation(); t.viewManager.restoreActions(n) }; i.geHashtLocation = function () { var n = location.hash; return n.length > 1 ? n.substring(1) : "" }; n.historyMgr = i }(window, VIS); var CryptoJS = CryptoJS || function (n, t) { var u = {}, f = u.lib = {}, o = function () { }, i = f.Base = { extend: function (n) { o.prototype = this; var t = new o; return n && t.mixIn(n), t.hasOwnProperty("init") || (t.init = function () { t.$super.init.apply(this, arguments) }), t.init.prototype = t, t.$super = this, t }, create: function () { var n = this.extend(); return n.init.apply(n, arguments), n }, init: function () { }, mixIn: function (n) { for (var t in n) n.hasOwnProperty(t) && (this[t] = n[t]); n.hasOwnProperty("toString") && (this.toString = n.toString) }, clone: function () { return this.init.prototype.extend(this) } }, r = f.WordArray = i.extend({ init: function (n, i) { n = this.words = n || []; this.sigBytes = i != t ? i : 4 * n.length }, toString: function (n) { return (n || l).stringify(this) }, concat: function (n) { var i = this.words, r = n.words, u = this.sigBytes, t; if (n = n.sigBytes, this.clamp(), u % 4) for (t = 0; t < n; t++)i[u + t >>> 2] |= (r[t >>> 2] >>> 24 - 8 * (t % 4) & 255) << 24 - 8 * ((u + t) % 4); else if (65535 < r.length) for (t = 0; t < n; t += 4)i[u + t >>> 2] = r[t >>> 2]; else i.push.apply(i, r); return this.sigBytes += n, this }, clamp: function () { var i = this.words, t = this.sigBytes; i[t >>> 2] &= 4294967295 << 32 - 8 * (t % 4); i.length = n.ceil(t / 4) }, clone: function () { var n = i.clone.call(this); return n.words = this.words.slice(0), n }, random: function (t) { for (var i = [], u = 0; u < t; u += 4)i.push(4294967296 * n.random() | 0); return new r.init(i, t) } }), e = u.enc = {}, l = e.Hex = { stringify: function (n) { var u = n.words, i, t, r; for (n = n.sigBytes, i = [], t = 0; t < n; t++)r = u[t >>> 2] >>> 24 - 8 * (t % 4) & 255, i.push((r >>> 4).toString(16)), i.push((r & 15).toString(16)); return i.join("") }, parse: function (n) { for (var i = n.length, u = [], t = 0; t < i; t += 2)u[t >>> 3] |= parseInt(n.substr(t, 2), 16) << 24 - 4 * (t % 8); return new r.init(u, i / 2) } }, s = e.Latin1 = { stringify: function (n) { var r = n.words, i, t; for (n = n.sigBytes, i = [], t = 0; t < n; t++)i.push(String.fromCharCode(r[t >>> 2] >>> 24 - 8 * (t % 4) & 255)); return i.join("") }, parse: function (n) { for (var i = n.length, u = [], t = 0; t < i; t++)u[t >>> 2] |= (n.charCodeAt(t) & 255) << 24 - 8 * (t % 4); return new r.init(u, i) } }, a = e.Utf8 = { stringify: function (n) { try { return decodeURIComponent(escape(s.stringify(n))) } catch (t) { throw Error("Malformed UTF-8 data"); } }, parse: function (n) { return s.parse(unescape(encodeURIComponent(n))) } }, h = f.BufferedBlockAlgorithm = i.extend({ reset: function () { this._data = new r.init; this._nDataBytes = 0 }, _append: function (n) { "string" == typeof n && (n = a.parse(n)); this._data.concat(n); this._nDataBytes += n.sigBytes }, _process: function (t) { var e = this._data, s = e.words, u = e.sigBytes, o = this.blockSize, f = u / (4 * o), f = t ? n.ceil(f) : n.max((f | 0) - this._minBufferSize, 0), i; if (t = f * o, u = n.min(4 * t, u), t) { for (i = 0; i < t; i += o)this._doProcessBlock(s, i); i = s.splice(0, t); e.sigBytes -= u } return new r.init(i, u) }, clone: function () { var n = i.clone.call(this); return n._data = this._data.clone(), n }, _minBufferSize: 0 }), c; return f.Hasher = h.extend({ cfg: i.extend(), init: function (n) { this.cfg = this.cfg.extend(n); this.reset() }, reset: function () { h.reset.call(this); this._doReset() }, update: function (n) { return this._append(n), this._process(), this }, finalize: function (n) { return n && this._append(n), this._doFinalize() }, blockSize: 16, _createHelper: function (n) { return function (t, i) { return new n.init(i).finalize(t) } }, _createHmacHelper: function (n) { return function (t, i) { return new c.HMAC.init(n, i).finalize(t) } } }), c = u.algo = {}, u }(Math); (function () { var n = CryptoJS, t = n.lib.WordArray; n.enc.Base64 = { stringify: function (n) { var i = n.words, u = n.sigBytes, f = this._map, t, e, r; for (n.clamp(), n = [], t = 0; t < u; t += 3)for (e = (i[t >>> 2] >>> 24 - 8 * (t % 4) & 255) << 16 | (i[t + 1 >>> 2] >>> 24 - 8 * ((t + 1) % 4) & 255) << 8 | i[t + 2 >>> 2] >>> 24 - 8 * ((t + 2) % 4) & 255, r = 0; 4 > r && t + .75 * r < u; r++)n.push(f.charAt(e >>> 6 * (3 - r) & 63)); if (i = f.charAt(64)) for (; n.length % 4;)n.push(i); return n.join("") }, parse: function (n) { var e = n.length, f = this._map, i = f.charAt(64), o, s; i && (i = n.indexOf(i), -1 != i && (e = i)); for (var i = [], u = 0, r = 0; r < e; r++)r % 4 && (o = f.indexOf(n.charAt(r - 1)) << 2 * (r % 4), s = f.indexOf(n.charAt(r)) >>> 6 - 2 * (r % 4), i[u >>> 2] |= (o | s) << 24 - 8 * (u % 4), u++); return t.create(i, u) }, _map: "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=" } })(), function (n) { function i(n, t, i, r, u, f, e) { return n = n + (t & i | ~t & r) + u + e, (n << f | n >>> 32 - f) + t } function r(n, t, i, r, u, f, e) { return n = n + (t & r | i & ~r) + u + e, (n << f | n >>> 32 - f) + t } function u(n, t, i, r, u, f, e) { return n = n + (t ^ i ^ r) + u + e, (n << f | n >>> 32 - f) + t } function f(n, t, i, r, u, f, e) { return n = n + (i ^ (t | ~r)) + u + e, (n << f | n >>> 32 - f) + t } for (var o = CryptoJS, e = o.lib, c = e.WordArray, s = e.Hasher, e = o.algo, t = [], h = 0; 64 > h; h++)t[h] = 4294967296 * n.abs(n.sin(h + 1)) | 0; e = e.MD5 = s.extend({ _doReset: function () { this._hash = new c.init([1732584193, 4023233417, 2562383102, 271733878]) }, _doProcessBlock: function (n, e) { for (var v, a, l = 0; 16 > l; l++)v = e + l, a = n[v], n[v] = (a << 8 | a >>> 24) & 16711935 | (a << 24 | a >>> 8) & 4278255360; var l = this._hash.words, v = n[e + 0], a = n[e + 1], y = n[e + 2], p = n[e + 3], w = n[e + 4], b = n[e + 5], k = n[e + 6], d = n[e + 7], g = n[e + 8], nt = n[e + 9], tt = n[e + 10], it = n[e + 11], rt = n[e + 12], ut = n[e + 13], ft = n[e + 14], et = n[e + 15], o = l[0], s = l[1], h = l[2], c = l[3], o = i(o, s, h, c, v, 7, t[0]), c = i(c, o, s, h, a, 12, t[1]), h = i(h, c, o, s, y, 17, t[2]), s = i(s, h, c, o, p, 22, t[3]), o = i(o, s, h, c, w, 7, t[4]), c = i(c, o, s, h, b, 12, t[5]), h = i(h, c, o, s, k, 17, t[6]), s = i(s, h, c, o, d, 22, t[7]), o = i(o, s, h, c, g, 7, t[8]), c = i(c, o, s, h, nt, 12, t[9]), h = i(h, c, o, s, tt, 17, t[10]), s = i(s, h, c, o, it, 22, t[11]), o = i(o, s, h, c, rt, 7, t[12]), c = i(c, o, s, h, ut, 12, t[13]), h = i(h, c, o, s, ft, 17, t[14]), s = i(s, h, c, o, et, 22, t[15]), o = r(o, s, h, c, a, 5, t[16]), c = r(c, o, s, h, k, 9, t[17]), h = r(h, c, o, s, it, 14, t[18]), s = r(s, h, c, o, v, 20, t[19]), o = r(o, s, h, c, b, 5, t[20]), c = r(c, o, s, h, tt, 9, t[21]), h = r(h, c, o, s, et, 14, t[22]), s = r(s, h, c, o, w, 20, t[23]), o = r(o, s, h, c, nt, 5, t[24]), c = r(c, o, s, h, ft, 9, t[25]), h = r(h, c, o, s, p, 14, t[26]), s = r(s, h, c, o, g, 20, t[27]), o = r(o, s, h, c, ut, 5, t[28]), c = r(c, o, s, h, y, 9, t[29]), h = r(h, c, o, s, d, 14, t[30]), s = r(s, h, c, o, rt, 20, t[31]), o = u(o, s, h, c, b, 4, t[32]), c = u(c, o, s, h, g, 11, t[33]), h = u(h, c, o, s, it, 16, t[34]), s = u(s, h, c, o, ft, 23, t[35]), o = u(o, s, h, c, a, 4, t[36]), c = u(c, o, s, h, w, 11, t[37]), h = u(h, c, o, s, d, 16, t[38]), s = u(s, h, c, o, tt, 23, t[39]), o = u(o, s, h, c, ut, 4, t[40]), c = u(c, o, s, h, v, 11, t[41]), h = u(h, c, o, s, p, 16, t[42]), s = u(s, h, c, o, k, 23, t[43]), o = u(o, s, h, c, nt, 4, t[44]), c = u(c, o, s, h, rt, 11, t[45]), h = u(h, c, o, s, et, 16, t[46]), s = u(s, h, c, o, y, 23, t[47]), o = f(o, s, h, c, v, 6, t[48]), c = f(c, o, s, h, d, 10, t[49]), h = f(h, c, o, s, ft, 15, t[50]), s = f(s, h, c, o, b, 21, t[51]), o = f(o, s, h, c, rt, 6, t[52]), c = f(c, o, s, h, p, 10, t[53]), h = f(h, c, o, s, tt, 15, t[54]), s = f(s, h, c, o, a, 21, t[55]), o = f(o, s, h, c, g, 6, t[56]), c = f(c, o, s, h, et, 10, t[57]), h = f(h, c, o, s, k, 15, t[58]), s = f(s, h, c, o, ut, 21, t[59]), o = f(o, s, h, c, w, 6, t[60]), c = f(c, o, s, h, it, 10, t[61]), h = f(h, c, o, s, y, 15, t[62]), s = f(s, h, c, o, nt, 21, t[63]); l[0] = l[0] + o | 0; l[1] = l[1] + s | 0; l[2] = l[2] + h | 0; l[3] = l[3] + c | 0 }, _doFinalize: function () { var u = this._data, r = u.words, t = 8 * this._nDataBytes, i = 8 * u.sigBytes, f; for (r[i >>> 5] |= 128 << 24 - i % 32, f = n.floor(t / 4294967296), r[(i + 64 >>> 9 << 4) + 15] = (f << 8 | f >>> 24) & 16711935 | (f << 24 | f >>> 8) & 4278255360, r[(i + 64 >>> 9 << 4) + 14] = (t << 8 | t >>> 24) & 16711935 | (t << 24 | t >>> 8) & 4278255360, u.sigBytes = 4 * (r.length + 1), this._process(), u = this._hash, r = u.words, t = 0; 4 > t; t++)i = r[t], r[t] = (i << 8 | i >>> 24) & 16711935 | (i << 24 | i >>> 8) & 4278255360; return u }, clone: function () { var n = s.clone.call(this); return n._hash = this._hash.clone(), n } }); o.MD5 = s._createHelper(e); o.HmacMD5 = s._createHmacHelper(e) }(Math), function () { var t = CryptoJS, n = t.lib, i = n.Base, r = n.WordArray, n = t.algo, u = n.EvpKDF = i.extend({ cfg: i.extend({ keySize: 4, hasher: n.MD5, iterations: 1 }), init: function (n) { this.cfg = this.cfg.extend(n) }, compute: function (n, t) { for (var i, o, u = this.cfg, f = u.hasher.create(), e = r.create(), h = e.words, s = u.keySize, u = u.iterations; h.length < s;) { for (i && f.update(i), i = f.update(n).finalize(t), f.reset(), o = 1; o < u; o++)i = f.finalize(i), f.reset(); e.concat(i) } return e.sigBytes = 4 * s, e } }); t.EvpKDF = function (n, t, i) { return u.create(i).compute(n, t) } }(); CryptoJS.lib.Cipher || function (n) { var i = CryptoJS, t = i.lib, f = t.Base, e = t.WordArray, c = t.BufferedBlockAlgorithm, l = i.enc.Base64, y = i.algo.EvpKDF, s = t.Cipher = c.extend({ cfg: f.extend(), createEncryptor: function (n, t) { return this.create(this._ENC_XFORM_MODE, n, t) }, createDecryptor: function (n, t) { return this.create(this._DEC_XFORM_MODE, n, t) }, init: function (n, t, i) { this.cfg = this.cfg.extend(i); this._xformMode = n; this._key = t; this.reset() }, reset: function () { c.reset.call(this); this._doReset() }, process: function (n) { return this._append(n), this._process() }, finalize: function (n) { return n && this._append(n), this._doFinalize() }, keySize: 4, ivSize: 4, _ENC_XFORM_MODE: 1, _DEC_XFORM_MODE: 2, _createHelper: function (n) { return { encrypt: function (t, i, r) { return ("string" == typeof i ? v : u).encrypt(n, t, i, r) }, decrypt: function (t, i, r) { return ("string" == typeof i ? v : u).decrypt(n, t, i, r) } } } }); t.StreamCipher = s.extend({ _doFinalize: function () { return this._process(!0) }, blockSize: 1 }); var o = i.mode = {}, a = function (t, i, r) { var f = this._iv, u; for (f ? this._iv = n : f = this._prevBlock, u = 0; u < r; u++)t[i + u] ^= f[u] }, r = (t.BlockCipherMode = f.extend({ createEncryptor: function (n, t) { return this.Encryptor.create(n, t) }, createDecryptor: function (n, t) { return this.Decryptor.create(n, t) }, init: function (n, t) { this._cipher = n; this._iv = t } })).extend(); r.Encryptor = r.extend({ processBlock: function (n, t) { var i = this._cipher, r = i.blockSize; a.call(this, n, t, r); i.encryptBlock(n, t); this._prevBlock = n.slice(t, t + r) } }); r.Decryptor = r.extend({ processBlock: function (n, t) { var i = this._cipher, r = i.blockSize, u = n.slice(t, t + r); i.decryptBlock(n, t); a.call(this, n, t, r); this._prevBlock = u } }); o = o.CBC = r; r = (i.pad = {}).Pkcs7 = { pad: function (n, t) { for (var i = 4 * t, i = i - n.sigBytes % i, f = i << 24 | i << 16 | i << 8 | i, r = [], u = 0; u < i; u += 4)r.push(f); i = e.create(r, i); n.concat(i) }, unpad: function (n) { n.sigBytes -= n.words[n.sigBytes - 1 >>> 2] & 255 } }; t.BlockCipher = s.extend({ cfg: s.cfg.extend({ mode: o, padding: r }), reset: function () { var t; s.reset.call(this); var n = this.cfg, i = n.iv, n = n.mode; this._xformMode == this._ENC_XFORM_MODE ? t = n.createEncryptor : (t = n.createDecryptor, this._minBufferSize = 1); this._mode = t.call(n, this, i && i.words) }, _doProcessBlock: function (n, t) { this._mode.processBlock(n, t) }, _doFinalize: function () { var t = this.cfg.padding, n; return this._xformMode == this._ENC_XFORM_MODE ? (t.pad(this._data, this.blockSize), n = this._process(!0)) : (n = this._process(!0), t.unpad(n)), n }, blockSize: 4 }); var h = t.CipherParams = f.extend({ init: function (n) { this.mixIn(n) }, toString: function (n) { return (n || this.formatter).stringify(this) } }), o = (i.format = {}).OpenSSL = { stringify: function (n) { var t = n.ciphertext; return n = n.salt, (n ? e.create([1398893684, 1701076831]).concat(n).concat(t) : t).toString(l) }, parse: function (n) { var t, i; return n = l.parse(n), t = n.words, 1398893684 == t[0] && 1701076831 == t[1] && (i = e.create(t.slice(2, 4)), t.splice(0, 4), n.sigBytes -= 16), h.create({ ciphertext: n, salt: i }) } }, u = t.SerializableCipher = f.extend({ cfg: f.extend({ format: o }), encrypt: function (n, t, i, r) { r = this.cfg.extend(r); var u = n.createEncryptor(i, r); return t = u.finalize(t), u = u.cfg, h.create({ ciphertext: t, key: i, iv: u.iv, algorithm: n, mode: u.mode, padding: u.padding, blockSize: n.blockSize, formatter: r.format }) }, decrypt: function (n, t, i, r) { return r = this.cfg.extend(r), t = this._parse(t, r.format), n.createDecryptor(i, r).finalize(t.ciphertext) }, _parse: function (n, t) { return "string" == typeof n ? t.parse(n, this) : n } }), i = (i.kdf = {}).OpenSSL = { execute: function (n, t, i, r) { return r || (r = e.random(8)), n = y.create({ keySize: t + i }).compute(n, r), i = e.create(n.words.slice(t), 4 * i), n.sigBytes = 4 * t, h.create({ key: n, iv: i, salt: r }) } }, v = t.PasswordBasedCipher = u.extend({ cfg: u.cfg.extend({ kdf: i }), encrypt: function (n, t, i, r) { return r = this.cfg.extend(r), i = r.kdf.execute(i, n.keySize, n.ivSize), r.iv = i.iv, n = u.encrypt.call(this, n, t, i.key, r), n.mixIn(i), n }, decrypt: function (n, t, i, r) { return r = this.cfg.extend(r), t = this._parse(t, r.format), i = r.kdf.execute(i, n.keySize, n.ivSize, t.salt), r.iv = i.iv, u.decrypt.call(this, n, t, i.key, r) } }) }(), function () { for (var i, tt, h = CryptoJS, y = h.lib.BlockCipher, o = h.algo, t = [], p = [], w = [], b = [], k = [], d = [], c = [], l = [], a = [], v = [], u = [], f = 0; 256 > f; f++)u[f] = 128 > f ? f << 1 : f << 1 ^ 283; for (var r = 0, e = 0, f = 0; 256 > f; f++) { i = e ^ e << 1 ^ e << 2 ^ e << 3 ^ e << 4; i = i >>> 8 ^ i & 255 ^ 99; t[r] = i; p[i] = r; var s = u[r], g = u[s], nt = u[g], n = 257 * u[i] ^ 16843008 * i; w[r] = n << 24 | n >>> 8; b[r] = n << 16 | n >>> 16; k[r] = n << 8 | n >>> 24; d[r] = n; n = 16843009 * nt ^ 65537 * g ^ 257 * s ^ 16843008 * r; c[i] = n << 24 | n >>> 8; l[i] = n << 16 | n >>> 16; a[i] = n << 8 | n >>> 24; v[i] = n; r ? (r = s ^ u[u[u[nt ^ s]]], e ^= u[u[e]]) : r = e = 1 } tt = [0, 1, 2, 4, 8, 16, 32, 64, 128, 27, 54]; o = o.AES = y.extend({ _doReset: function () { for (var n, u = this._key, e = u.words, r = u.sigBytes / 4, u = 4 * ((this._nRounds = r + 6) + 1), f = this._keySchedule = [], i = 0; i < u; i++)i < r ? f[i] = e[i] : (n = f[i - 1], i % r ? 6 < r && 4 == i % r && (n = t[n >>> 24] << 24 | t[n >>> 16 & 255] << 16 | t[n >>> 8 & 255] << 8 | t[n & 255]) : (n = n << 8 | n >>> 24, n = t[n >>> 24] << 24 | t[n >>> 16 & 255] << 16 | t[n >>> 8 & 255] << 8 | t[n & 255], n ^= tt[i / r | 0] << 24), f[i] = f[i - r] ^ n); for (e = this._invKeySchedule = [], r = 0; r < u; r++)i = u - r, n = r % 4 ? f[i] : f[i - 4], e[r] = 4 > r || 4 >= i ? n : c[t[n >>> 24]] ^ l[t[n >>> 16 & 255]] ^ a[t[n >>> 8 & 255]] ^ v[t[n & 255]] }, encryptBlock: function (n, i) { this._doCryptBlock(n, i, this._keySchedule, w, b, k, d, t) }, decryptBlock: function (n, t) { var i = n[t + 1]; n[t + 1] = n[t + 3]; n[t + 3] = i; this._doCryptBlock(n, t, this._invKeySchedule, c, l, a, v, p); i = n[t + 1]; n[t + 1] = n[t + 3]; n[t + 3] = i }, _doCryptBlock: function (n, t, i, r, u, f, e, o) { for (var b = this._nRounds, h = n[t] ^ i[0], c = n[t + 1] ^ i[1], l = n[t + 2] ^ i[2], s = n[t + 3] ^ i[3], a = 4, w = 1; w < b; w++)var v = r[h >>> 24] ^ u[c >>> 16 & 255] ^ f[l >>> 8 & 255] ^ e[s & 255] ^ i[a++], y = r[c >>> 24] ^ u[l >>> 16 & 255] ^ f[s >>> 8 & 255] ^ e[h & 255] ^ i[a++], p = r[l >>> 24] ^ u[s >>> 16 & 255] ^ f[h >>> 8 & 255] ^ e[c & 255] ^ i[a++], s = r[s >>> 24] ^ u[h >>> 16 & 255] ^ f[c >>> 8 & 255] ^ e[l & 255] ^ i[a++], h = v, c = y, l = p; v = (o[h >>> 24] << 24 | o[c >>> 16 & 255] << 16 | o[l >>> 8 & 255] << 8 | o[s & 255]) ^ i[a++]; y = (o[c >>> 24] << 24 | o[l >>> 16 & 255] << 16 | o[s >>> 8 & 255] << 8 | o[h & 255]) ^ i[a++]; p = (o[l >>> 24] << 24 | o[s >>> 16 & 255] << 16 | o[h >>> 8 & 255] << 8 | o[c & 255]) ^ i[a++]; s = (o[s >>> 24] << 24 | o[h >>> 16 & 255] << 16 | o[c >>> 8 & 255] << 8 | o[l & 255]) ^ i[a++]; n[t] = v; n[t + 1] = y; n[t + 2] = p; n[t + 3] = s }, keySize: 8 }); h.AES = y._createHelper(o) }(), function (n, t) { var i = t.enc.Utf8.parse(n.context.getContext("#key")), r = t.enc.Utf8.parse(n.context.getContext("#key")); n.secureEngine = { encrypt: function (n) { var u = ""; return (n || n === 0) && (u = t.AES.encrypt(t.enc.Utf8.parse(n.toString()), i, { keySize: 16, iv: r, mode: t.mode.CBC, padding: t.pad.Pkcs7 })), u.toString() }, decrypt: function (n) { var u = ""; return (n || n.length > 12) && (u = t.AES.decrypt(n, i, { keySize: 16, iv: r, mode: t.mode.CBC, padding: t.pad.Pkcs7 })), u.toString(t.enc.Utf8) }, isEncrypted: function (n) { if (n || n.length > 12) return !0 } } }(VIS, CryptoJS), function (n, t) { function i(i) { this.frame; this.windowNo; var ci = null, ir = null, li = null, it = null, ht = null, ct = null, lt = null, rr = null, w = null, at = null, ai = null, br = null, rt = null, vt = null, b = null, yt = null, ut = null, ur = null, fr = null, k = null, pt = null, wt = null, vi = null, yi = null, ft = null, et = null, ot = null, er = null, pi = null, wi = this, kr = null, bi = null, bt = null, kt = null, or = null, sr = null, hr = null, cr = null, ki = null, di = null, lr = null, ar = null, vr = null, dr = null, c = null, f = null, gr = null, nu = null, dt = null, tu = null, gt = null, d = null, ni = null, e = null, gi = null, ti = !1, iu = null, ii = null, y = null, g = null, o = null, st = null, ri = !1, ru = null, ui = null, nt = null, u = null, fi = !1, ei = null, oi = null, si = null, nr = null, tr = null, u = null, uu = null, l = null, a = null, h = null, p = null, v = null, hi = null, fu = null, s = t("<div class='vis-forms-container'>"), tt = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), r = n.Env.getWindowNo(); this.log = n.Logging.VLogger.getVLogger("UserPreference"); this.load = function () { tt[0].style.visibility = "visible"; s.load(n.Application.contextUrl + "UserPreference/Index/?windowno=" + r + "&adUserId=" + n.context.getAD_User_ID(), function () { wi.init(s); var n = s.find("#content_" + r); n != null; tt[0].style.visibility = "hidden" }) }; this.init = function (wi) { function du(n) { tt[0].style.visibility = n ? "visible" : "hidden" } function no(n) { var t = new Date, i = ("0" + t.getDate()).slice(-2), r = ("0" + (t.getMonth() + 1)).slice(-2), u = t.getFullYear() + "-" + r + "-" + i; n.val(u) } function so() { t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/GetSavedDetail", dataType: "json", data: { isTask: !0 }, success: function (t) { ri = !1; ti = !1; fi = !1; var i = JSON.parse(t); i.IsSyncInBackground == "false" ? (ni.prop("checked", !1), gi = !1) : (ni.prop("checked", !0), gi = !0); i.IsCalSyncInBackground == "false" ? (g.prop("checked", !1), st = !1) : (g.prop("checked", !0), st = !0); d.val(i.TaskAuthCode); d.val().length > 0 && (gt.html(n.Msg.getMsg("RemoveLink")), ti = !0); y.val(i.CalendarAuthCode); y.val().length > 0 && (ii.html(n.Msg.getMsg("RemoveLink")), ri = !0); nt.val(i.ContactAuthCode); nt.val().length > 0 && (ui.html(n.Msg.getMsg("RemoveLink")), fi = !0) } }) } function ho() { var t = n.Application.contextUrl + "JsonData/GetThemes"; n.dataContext.getJSONData(t, null, co) } function co(n) { var t = [], r, u, i; if (n) { for (r = 0, u = n.length; r < u; r++)i = n[r], t.push("<li>"), t.push('<div class="vis-theme-rec" data-color="'), t.push(i.PColor), t.push("|"), t.push(i.OnPColor), t.push("|"), t.push(i.SColor), t.push("|"), t.push(i.OnSColor), t.push('" data-id="' + i.Id + '" >'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.PColor + ',1)"><\/span>'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.OnPColor + ',1)"><\/span>'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.SColor + ',1)"><\/span>'), t.push('<span class="vis-theme-color" style="background-color:rgba(' + i.OnSColor + ',1)"><\/span>'), t.push("<\/div>"), t.push("<\/li>"); fu.append(t.join("")) } } function gu(i, r) { t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/GetGmailAuthorizationCode", dataType: "json", data: { isTask: i, isContact: r }, success: function (n) { var t = JSON.parse(n); t != null && t.length > 0 && window.open(t) } }) } function nf(i, r, f, s, h) { t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/SaveGmailAccountSettings", dataType: "json", data: { authCodes: f, isTask: i, isSyncInBackground: r, isRemoveLink: s, isContact: h }, success: function (t) { var r = JSON.parse(t); i ? r.toString() == "false" ? (e.css("color", "red"), e.text(n.Msg.getMsg("RecordNotSaved")), e.show()) : r.toString() == "true" ? (e.css("color", "green"), e.text(n.Msg.getMsg("RecordSaved")), s ? (d.val(""), gt.html(n.Msg.getMsg("Save")), ni.prop("checked", !1), ti = !1, d.removeAttr("disabled"), e.text(n.Msg.getMsg("LinkRemoved"))) : (gt.html(n.Msg.getMsg("RemoveLink")), d.attr("disabled", !0), ti = !0), e.show()) : window.open(r) : h ? r.toString() == "false" ? (u.css("color", "red"), u.text(n.Msg.getMsg("RecordNotSaved")), u.show()) : r.toString() == "true" ? (u.css("color", "green"), u.text(n.Msg.getMsg("RecordSaved")), s ? (nt.val(""), ui.html(n.Msg.getMsg("Save")), fi = !1, nt.removeAttr("disabled"), u.text(n.Msg.getMsg("LinkRemoved"))) : (ui.html(n.Msg.getMsg("RemoveLink")), nt.attr("disabled", !0), fi = !0), u.show()) : window.open(r) : r.toString() == "false" ? (o.css("color", "red"), o.text(n.Msg.getMsg("RecordNotSaved")), o.show()) : r.toString() == "true" ? (o.css("color", "green"), o.text(n.Msg.getMsg("RecordSaved")), s ? (y.val(""), ii.html(n.Msg.getMsg("Save")), g.prop("checked", !1), ri = !1, y.removeAttr("disabled"), o.text(n.Msg.getMsg("LinkRemoved"))) : (ii.html(n.Msg.getMsg("RemoveLink")), y.attr("disabled", !0), ri = !0), o.show()) : window.open(r) } }) } function lo() { vo(); si != null && si.append(pu); ao() } function ao() { if (window.WSP) { var i = n.Application.contextUrl + "WSP/ContactSettings/GetSavedDetail"; t.ajax({ type: "GET", async: !0, url: i, dataType: "json", success: function (n) { var t = JSON.parse(n), i; ei.val(t.Username); oi.val(t.Password); t.Role != "" && si.val(t.Role); i = t.IsUpdate; i.toString().toLowerCase() == "false" ? (nr.prop("checked", !1), tr = !1) : (nr.prop("checked", !0), tr = !0) } }) } } function vo() { if (window.WSP) { var i = n.Application.contextUrl + "WSP/ContactSettings/GetRole"; t.ajax({ type: "GET", async: !0, url: i, dataType: "json", success: function (t) { var r = JSON.parse(t), i; for (pu += "<option value='-1'  selected='selected'>" + n.Msg.getMsg("SelectRole") + "<\/option>", i = 0; i < r.length; i++)pu += "<option value='" + r[i].RoleID + "'>" + r[i].RoleName + "<\/option>" } }) } } function yo(i, r, f, e) { var o = n.Application.contextUrl + "WSP/ContactSettings/SaveGmailContactSettings"; t.ajax({ type: "POST", async: !1, url: o, dataType: "json", data: { username: i, password: r, role_ID: f, isUpdateExisting: e }, success: function (t) { var i = JSON.parse(t); i.toString() == "false" ? (u.css("color", "red"), u.text(n.Msg.getMsg("RecordNotSaved")), u.show()) : (u.css("color", "green"), u.text(n.Msg.getMsg("RecordSaved")), u.show()) } }) } function to() { var r, u, t, i, f; n.Env.getCtx().setContext("AutoCommit", ci.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_A_NEW, ct.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("AutoNew", ct.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACEFILE, at.prop("checked") ? "Y" : "N"); r = w.find("option:selected").val(); u = n.Logging.Level.prototype.getLevel(r); n.Logging.VLogMgt.setLevel(u); n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACELEVEL, w.find("option:selected").val()); t = rt[0].selectedIndex; n.Ini.setValueToLocalStorage(n.IniConstants.CO_SHOWLEVEL, t < 0 ? 0 : t); n.Env.getCtx().setContext("#ClientOrgLevel", t < 0 ? 0 : t); n.Ini.setValueToLocalStorage(n.IniConstants.W_PAGESIZE, b.find("option:selected").val()); n.Env.getCtx().setContext("#ShowWorkSpacePageSize", b.find("option:selected").val()); i = ut.find("option:selected").val(); n.Ini.setValueToLocalStorage(n.IniConstants.WIN_PAGESIZE, i); n.Env.setWINDOW_PAGE_SIZE(i); n.Ini.setValueToLocalStorage(n.IniConstants.P_Show_Mini_Grid, vt.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowMiniGrid", vt.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_Print_Native_Digits, yt.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#PrintNativeDigits", yt.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_A_LOGIN, li.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_STORE_PWD, ir.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowAcct", ht.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowTrl", it.prop("checked") ? "Y" : "N"); n.Env.getCtx().setContext("#ShowAdvanced", lt.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_CACHE_WINDOW, rr.prop("checked") ? "Y" : "N"); n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACEFILE, at.prop("checked") ? "Y" : "N"); f = wo({ IsAutoCommit: ci.prop("checked") ? "Y" : "N", IsShowAcct: ht.prop("checked") ? "Y" : "N", IsShowTrl: it.prop("checked") ? "Y" : "N", IsShowAdvanced: lt.prop("checked") ? "Y" : "N" }) } function tf(n) { for (var e = n.length, f = "", u, r, i = 0; i < e; i += 1) { for (f += "<tr class='VIS_Pref-tbl-Row'>", u = 0; u < n[i].length; u += 1)r = n[i][u], f += u == 0 ? i % 2 ? "<td class='VIS_Pref_table-row2'>" + r + "<\/td>" : "<td class='VIS_Pref_table-row1'>" + r + "<\/td>" : u == n[i].length - 1 ? i % 2 ? "<td class='VIS_Pref_table-row2'>" + r + "<\/td>" : "<td class='VIS_Pref_table-row1'>" + r + "<\/td>" : i % 2 ? "<td class='VIS_Pref_table-row2'>" + r + "<\/td>" : "<td class='VIS_Pref_table-row1'>" + r + "<\/td>"; f += " <\/tr>" } ft.find("tbody > tr").eq(0).after(t.parseHTML(f)); lu = null; f = null } function po() { ht.prop("checked", n.Env.getCtx().ctx["#ShowAcct"] == "Y" ? !0 : !1); it.prop("checked", n.Env.getCtx().ctx["#ShowTrl"] == "Y" ? !0 : !1); lt.prop("checked", n.Env.getCtx().ctx["#ShowAdvanced"] == "Y" ? !0 : !1) } function wo(i) { var r = null; t.ajax({ url: n.Application.contextUrl + "UserPreference/SavePrefrence", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ pref: i }) }).done(function (n) { r = n; s.dialog("close") }) } var rf, uf, ff, ef, of, sf, hf, cf, lf, af, vf, yf, pf, wf, bf, kf, df, gf, ne, te, ie, re, ue, fe, ee, oe, se, he, ce, le, ae, ve, au, ye, pe, we, be, ke, de, ge, bu, hu, su, eu, yu, cu, ku, pu; ci = wi.find("#chkAutoCommit_" + r); ir = wi.find("#chkStorePassword_" + r); li = wi.find("#chkAutoLogin_" + r); it = wi.find("#chkShowTranslationTab_" + r); ht = wi.find("#chkShowAccountingTab_" + r); ct = wi.find("#chkAutoNewRecord_" + r); lt = wi.find("#chkShowAdvancedTab_" + r); rr = wi.find("#chkCacheWindows_" + r); w = wi.find("#cmbTraceLevel_" + r); at = wi.find("#chkTraceFile_" + r); ai = wi.find("#dt_Date_" + r); br = wi.find("#chkDictionaryMaintain_" + r); rt = wi.find("#cmbClientOrg_" + r); vt = wi.find("#chkShowMiniGrid_" + r); b = wi.find("#cmbPageSize_" + r); yt = wi.find("#chkNativeDigit_" + r); ut = wi.find("#cmbWindowPageSize_" + r); ur = wi.find("#lblVariableName_" + r); fr = wi.find("#lblVariableValue_" + r); et = wi.find("#btnOk_" + r); ot = wi.find("#btnCancel_" + r); er = wi.find("#btnRole_" + r); pi = wi.find("#contextlst_" + r); ft = wi.find("#prefErrortbl_" + r); et.hide(); ot.hide(); kr = wi.find("#btnChangePws_" + r); bi = wi.find("#txtCurrentPws_" + r); bt = wi.find("#txtNewPws_" + r); kt = wi.find("#txtConformPws_" + r); or = wi.find("#chkIsEmail_" + r); sr = wi.find("#chkIsNotice_" + r); hr = wi.find("#chkIsSMS_" + r); cr = wi.find("#chkIsFax_" + r); ki = wi.find("#txtUserName_" + r); di = wi.find("#txtPws_" + r); lr = wi.find("#btnEmailConfig_" + r); ar = wi.find("#btnSubstitute_" + r); vr = wi.find("#btnSaveChanges_" + r); dr = wi.find("#btnSaveChangePassword_" + r); nu = wi.find("#lblPrefSave_" + r); gr = wi.find("#btnSave_" + r); tu = wi.find("#vbtnGmailAuth_" + r); gt = wi.find("#vbtnSyncGmailTask_" + r); d = wi.find("#txtAuthCode_" + r); ni = wi.find("#chkIsSyncBackground_" + r); e = wi.find("#lblTaskSettingMessage_" + r); e.hide(); iu = wi.find("#vbtnGmailCalAuth_" + r); ii = wi.find("#vbtnSyncGmailCalendar_" + r); y = wi.find("#txtCalAuthCode_" + r); g = wi.find("#chkCalIsSyncBackground_" + r); o = wi.find("#lblCalendarSettingMessage_" + r); o.hide(); ru = wi.find("#vbtnGmailContactAuth_" + r); ui = wi.find("#vbtnSyncGmailContact_" + r); nt = wi.find("#txtContactAuthCode_" + r); u = wi.find("#lblContactSettingMessage_" + r); u.hide(); so(); ei = wi.find("#txtGmailUserName_" + r); oi = wi.find("#txtGmailPassword_" + r); si = wi.find("#cmbSettingRole_" + r); nr = wi.find("#chkbxUpdateExisting_" + r); uu = wi.find("#vbtnSyncGmailContact_" + r); u = wi.find("#lblContactSettingMessage_" + r); u.hide(); lo(); l = wi.find("#cmbRole_" + r); l.on("change", function () { yr() }); a = wi.find("#cmbClient_" + r); a.on("change", function () { pr() }); h = wi.find("#cmbOrg_" + r); h.on("change", function () { wr() }); p = wi.find("#cmbWareHouse_" + r); $btnTheme = wi.find("#btnTheme_" + r); v = {}; ou(); ho(); var io = wi.find("#lblUserSetMenu_" + r), ro = wi.find("#lblPreferenceMenu_" + r), uo = wi.find("#lblContextMenu_" + r), fo = wi.find("#lblErrorMenu_" + r); if (io.text(n.Msg.getMsg("UserSetting")), ro.text(n.Msg.getMsg("Preference")), uo.text(n.Msg.getMsg("Context")), fo.text(n.Msg.getMsg("PreferenceError")), rf = wi.find("#lblchangePwsHeader_" + r), rf.text(n.Msg.getMsg("ChangePassword")), uf = wi.find("#lblAutoMatic_" + r), uf.text(n.Msg.getMsg("AutoCommit")), ff = wi.find("#imgAutoMatic_" + r), ff.text(n.Msg.getMsg("AutoCommit", !0)), ef = wi.find("#lblTranslation_" + r), ef.text(n.Msg.getMsg("ShowTranslationTab")), of = wi.find("#imgTranslation_" + r), of.text(n.Msg.getMsg("ShowTranslationTab")), sf = wi.find("#lblShowAccounting_" + r), sf.text(n.Msg.getMsg("ShowAcctTab")), hf = wi.find("#imgShowAccounting_" + r), hf.text(n.Msg.getMsg("ShowAcctTab")), cf = wi.find("#lblAutoNewRecord_" + r), cf.text(n.Msg.getMsg("AutoNew")), lf = wi.find("#imgAutoNewRecord_" + r), lf.text(n.Msg.getMsg("AutoNew")), af = wi.find("#lblShowAdvanced_" + r), af.text(n.Msg.getMsg("ShowAdvancedTab")), vf = wi.find("#imgShowAdvanced_" + r), vf.text(n.Msg.getMsg("ShowAdvancedTab")), yf = wi.find("#lblCacheWindows_" + r), yf.text(n.Msg.getMsg("CacheWindow")), pf = wi.find("#imgCacheWindows_" + r), pf.text(n.Msg.getMsg("CacheWindow")), wf = wi.find("#vlblClientOrg_" + r), wf.text(n.Msg.getMsg("Show")), bf = wi.find("#imgClientOrg_" + r), bf.text(n.Msg.getMsg("ClientOrg")), kf = wi.find("#lblWindowPageSize_" + r), kf.text(n.Msg.getMsg("WindowPageSize")), df = wi.find("#imgWindowPageSize_" + r), df.text(n.Msg.getMsg("WindowPageSize")), gf = wi.find("#lblAutoLogin_" + r), gf.text(n.Msg.getMsg("AutoLogin")), ne = wi.find("#imgAutoLogin_" + r), ne.text(n.Msg.getMsg("AutoLogin")), te = wi.find("#lblStorePassword_" + r), te.text(n.Msg.getMsg("StorePassword")), ie = wi.find("#imgStorePassword_" + r), ie.text(n.Msg.getMsg("StorePassword")), re = wi.find("#lblTraceLevel_" + r), re.text(n.Msg.getMsg("TraceLevel")), ue = wi.find("#imgTraceLevel_" + r), ue.text(n.Msg.getMsg("TraceLevel")), fe = wi.find("#lblTraceFile_" + r), fe.text(n.Msg.getMsg("TraceFile")), ee = wi.find("#imgTraceFile_" + r), ee.text(n.Msg.getMsg("TraceFile")), oe = wi.find("#lblNativeDigit_" + r), oe.text(n.Msg.getMsg("PrintNativeDigits")), se = wi.find("#imgNativeDigit_" + r), se.text(n.Msg.getMsg("PrintNativeDigits")), he = wi.find("#vlblDateText_" + r), he.text(n.Msg.getMsg("Date")), ce = wi.find("#imgDateText_" + r), ce.text(n.Msg.getMsg("Date")), le = wi.find("#vlblthemeText_" + r), le.text(n.Msg.getMsg("SelectTheme")), ae = wi.find("#imgThemetext" + r), ae.text(n.Msg.getMsg("SelectTheme")), hi = wi.find("#vis_pref_theme" + r), fu = hi.find("ul"), au = wi.find("#vlblPageSize_" + r), au.text(n.Msg.getMsg("Pagesize")), ve = wi.find("#imgPageSize_" + r), ve.text(n.Msg.getMsg("Pagesize")), au = wi.find("#vlblPageSize_" + r), au.text(n.Msg.getMsg("Pagesize")), ye = wi.find("#lblContext_" + r), ye.text(n.Msg.getMsg("Context")), c = wi.find("#lblRecordSave_" + r), f = wi.find("#lblChangePasswordMessage_" + r), c.hide(), nu.hide(), f.hide(), pe = wi.find("#pchangePws_" + r), pe.text(n.Msg.getMsg("PPasswordInfo")), we = wi.find("#pNotification_" + r), we.text(n.Msg.getMsg("PNotificationInfo")), be = wi.find("#pEmailConfig_" + r), be.text(n.Msg.getMsg("PEmailConfigInfo")), ke = wi.find("#pSubstitute_" + r), ke.text(n.Msg.getMsg("PSubstituteInfo")), de = wi.find("#pContext_" + r), de.text(n.Msg.getMsg("PContextInfo")), ge = wi.find("#pError_" + r), ge.text(n.Msg.getMsg("PErrorInfo")), w != null) { var wu = [n.Logging.Level.OFF.getIntValue(), n.Logging.Level.SEVERE.getIntValue(), n.Logging.Level.WARNING.getIntValue(), n.Logging.Level.INFO.getIntValue(), n.Logging.Level.CONFIG.getIntValue(), n.Logging.Level.FINE.getIntValue(), n.Logging.Level.FINER.getIntValue(), n.Logging.Level.FINEST.getIntValue(), n.Logging.Level.ALL.getIntValue()], eo = [n.Logging.Level.OFF.getName(), n.Logging.Level.SEVERE.getName(), n.Logging.Level.WARNING.getName(), n.Logging.Level.INFO.getName(), n.Logging.Level.CONFIG.getName(), n.Logging.Level.FINE.getName(), n.Logging.Level.FINER.getName(), n.Logging.Level.FINEST.getName(), n.Logging.Level.ALL.getName()], su = 0; for (eu = 0; eu < wu.length; eu++)w.append(" <option value=" + wu[eu] + ">" + eo[eu] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.P_TRACELEVEL) == wu[eu] && (su = eu); w.prop("selectedIndex", su) } if (rt != null) { for (bu = [n.Msg.getMsg("Client+Org"), n.Msg.getMsg("Client"), n.Msg.getMsg("Org"), n.Msg.getMsg("None")], su = 0, eu = 0; eu < bu.length; eu++)rt.append("<option>" + bu[eu] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.CO_SHOWLEVEL) == eu && (su = eu); rt.prop("selectedIndex", su) } if (b != null) { for (hu = [5, 6, 7, 8, 9, 10], su = 0, eu = 0; eu < hu.length; eu++)b.append("<option>" + hu[eu] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.W_PAGESIZE) == hu[eu] && (su = eu); b.prop("selectedIndex", su) } if (ut != null) { for (hu = [50, 100, 500], su = 0, eu = 0; eu < hu.length; eu++)ut.append("<option>" + hu[eu] + "<\/option>"), n.Ini.getLocalStorage(n.IniConstants.WIN_PAGESIZE) == hu[eu] && (su = eu); ut.prop("selectedIndex", su) } if (pi != null) { var lu = n.context.getEntireCtx(), vu = [], eu = 0, oo = Object.keys(lu).length; for (yu = 0; yu < oo; yu += 1)vu[eu++] = ' <li class="VIS_Pref_li-err" ><span >', vu[eu++] = Object.keys(lu)[yu] + " == " + lu[Object.keys(lu)[yu]], vu[eu++] = "<\/span><\/li>"; pi.append(vu.join("")); lu = null; vu = null } k = wi.find("#vchkErrorOnly_" + r); pt = wi.find("#vbtnReset_" + r); wt = wi.find("#vbtnSaveToFile_" + r); n.context && !n.context.getAD_Role_ID() == 0 && wi.find(".VIS_Pref_err_btnLeft").hide(); vi = wi.find("#vbtnLogDate_" + r); yi = wi.find("#vbtnDownLog_" + r); no(vi); yi.on("click", function () { var i = vi.val(); i = i ? new Date(i).toISOString() : (new Date).toISOString(); du(!0); t.ajax({ type: "POST", url: n.Application.contextUrl + "UserPreference/DownloadServerLog", dataType: "json", data: { logDate: i }, success: function (t) { if (t) { var i = "TempDownload/" + t; window.open(n.Application.contextUrl + i); no(vi) } else n.ADialog.info("VIS_NoLogFound", null, null); du(!1) }, error: function () { du(!1) } }) }); k.prop("checked", !0); ft != null && (cu = n.Logging.VLogErrorBuffer.get(!0).getLogData(k.prop("checked")), dt = cu, tf(cu)); hi.on("click", "div.vis-theme-rec", function (i) { var r = t(i.currentTarget), u = r.data("color"), f = Number(r.data("id")); n.themeMgr && n.themeMgr.applyTheme(u); n.dataContext.postJSONData(n.Application.contextUrl + "Theme/SaveForUser", { id: f, uid: n.context.getAD_User_ID() }, function () { }) }); $btnTheme.on("click", function () { var t = new n.ThemeCnfgtor; t.show() }); wt.on("click", function () { var i, n, r, u; if (cu = dt, cu.length > 0) { for (i = "", n = 0; n < cu.length; n++)i += cu[n] + "\n"; r = (new Date).toISOString().slice(0, 19).replace(/-/g, ""); u = "data:text/csv;base64," + window.btoa(i); t(this).attr("href", u).attr("download", "file-" + r + ".csv") } }); po(); ci.prop("checked", n.Env.getCtx().isAutoCommit()); ct.prop("checked", n.Env.getCtx().isAutoNew()); li.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_A_LOGIN) == "N" ? !1 : !0); ir.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_STORE_PWD) == "N" ? !1 : !0); vt.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_Show_Mini_Grid) == "N" ? !1 : !0); yt.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_Print_Native_Digits) == "Y" ? !0 : !1); rr.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_CACHE_WINDOW) == "Y" ? !0 : !1); at.prop("checked", n.Ini.getLocalStorage(n.IniConstants.P_TRACEFILE) == "Y" ? !0 : !1); ku = new Date(Number(n.Env.getCtx().ctx["#Date"])); ku != null && ai.val(Globalize.format(ku, "yyyy-MM-dd")); pi.on("click", "li", function () { var n = t(this).text().split("==")[0], i = t(this).text().split("==")[1]; ur.text(n.toString()); fr.text(i.toString()) }); t(".VIS_Pref_meni li").on("click", function () { t(".VIS_Pref_menu li").removeClass("active"); t(this).addClass("active") }); pt.on("click", function () { var t = n.Logging.VLogErrorBuffer.get(!0).resetBuffer(k.prop("checked")); dt = t; t != null ? tf(t) : ft.find("tr:gt(0)").remove() }); t(".VIS_Pref_btn-pass-click").on("click", function () { t(".VIS_Pref_new-password").css("display", "block"); t(".VIS_Pref_Save").css("display", "block") }); t(".VIS_Pref_close-btn").click(function () { t(".VIS_Pref_new-password").css("display", "none"); t(".VIS_Pref_Save").css("display", "none") }); t(".VIS_Pref_link-1").click(function () { t(".VIS_Pref_content-right").css("display", "block"); t(".VIS_Pref_content-right-2").css("display", "none"); t(".VIS_Pref_content-right-3").css("display", "none"); t(".VIS_Pref_content-right-4").css("display", "none"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-2").click(function () { t(".VIS_Pref_content-right").css("display", "none"); t(".VIS_Pref_content-right-2").css("display", "block"); t(".VIS_Pref_content-right-3").css("display", "none"); t(".VIS_Pref_content-right-4").css("display", "none"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-3").click(function () { t(".VIS_Pref_content-right").css("display", "none"); t(".VIS_Pref_content-right-2").css("display", "none"); t(".VIS_Pref_content-right-3").css("display", "block"); t(".VIS_Pref_content-right-4").css("display", "none"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-4").click(function () { t(".VIS_Pref_content-right").css("display", "none"); t(".VIS_Pref_content-right-2").css("display", "none"); t(".VIS_Pref_content-right-3").css("display", "none"); t(".VIS_Pref_content-right-4").css("display", "flex"); t(".VIS_Pref_content-right-5").css("display", "none") }); t(".VIS_Pref_link-5").click(function () { window.WSP ? (t(".VIS_Pref_content-right").css("display", "none"), t(".VIS_Pref_content-right-2").css("display", "none"), t(".VIS_Pref_content-right-3").css("display", "none"), t(".VIS_Pref_content-right-4").css("display", "none"), t(".VIS_Pref_content-right-5").css("display", "block")) : alert("please download WSP !!!") }); i && t(".VIS_Pref_link-5").trigger("click"); gr.on("click", function () { to() }); et.on("click", function () { to() }); ot.on("click", function () { s.dialog("close") }); k.on("click", function () { var t = null; ft.find("tr").slice(1, -1).remove(); t = n.Logging.VLogErrorBuffer.get(!0).getLogData(k.prop("checked")); dt = t; t != null && tf(t) }); er.on("click", function () { var t = n.MRole.toStringX(n.Env.getCtx()) }); dr.on("click", function () { var r = bi.val(), i = bt.val(), u = kt.val(), e = ki.val(), o = di.val(); if (r.length <= 0 || i.length <= 0 || u.length <= 0) { f.css("color", "red"); f.text(n.Msg.getMsg("FillMandatory")); f.show(); return } if (i != u) { f.css("color", "red"); f.text(n.Msg.getMsg("samePassword")); f.show(); return } t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/SaveChangePassword", dataType: "json", data: { AD_User_ID: n.context.getAD_User_ID(), currentPws: r, newPws: i }, success: function (t) { returnValue = t.result; f.show(); returnValue == "OK" ? (f.css("color", "green"), f.text(n.Msg.getMsg("Passwordchanged"))) : (f.css("color", "red"), f.text(returnValue)) } }) }); vr.on("click", function () { var i = bi.val(), r = bt.val(), u = kt.val(), v = ki.val(), y = di.val(); if ((!(i.length <= 0) || !(r.length <= 0) || !(u.length <= 0)) && (!(i.length > 0) || !(r.length > 0) || !(u.length > 0))) { c.text(n.Msg.getMsg("mandatoryFields")); return } if (bt.text().localeCompare(kt.text()) == -1) { c.text(n.Msg.getMsg("samePassword")); return } var e = l.val(), o = a.val(), s = h.val(), f = p.val(); if (e == undefined || o == undefined || s == undefined) { c.text(n.Msg.getMsg("VIS_FillLogin")); return } f == undefined && (f = 0); t.ajax({ type: "POST", async: !1, url: n.Application.contextUrl + "UserPreference/SaveUserSettings", dataType: "json", data: { AD_User_ID: n.context.getAD_User_ID(), currentPws: i, newPws: r, conformPws: u, chkEmail: or.prop("checked"), chkNotice: sr.prop("checked"), chkSMS: hr.prop("checked"), chkFax: cr.prop("checked"), emailUserName: v, emailPws: y, AD_Role_ID: e, AD_Client_ID: o, AD_Org_ID: s, M_Warehouse_ID: f }, success: function (n) { returnValue = n.result; c.show(); c.css("color", "green"); c.text(returnValue.Msg); returnValue.IsSaved || c.css("color", "red") } }) }); lr.on("click", function () { var t = 0, i; try { t = n.dataContext.getJSONData(n.Application.contextUrl + "UserPreference/GetWindowID", { WindowName: "Mail Configuration" }, null); t > 0 && (i = new n.Query, i.addRestriction("AD_User_ID", n.Query.prototype.EQUAL, n.context.getAD_User_ID()), n.viewManager.startWindow(t, i)) } catch (r) { this.log.log(n.Logging.Level.SEVERE, sql, r) } s.dialog("close") }); ar.on("click", function () { var t = 0, i; try { t = n.dataContext.getJSONData(n.Application.contextUrl + "UserPreference/GetWindowID", { WindowName: "User Substitute" }, null); t > 0 && (i = new n.Query, i.addRestriction("AD_User_ID", n.Query.prototype.EQUAL, n.context.getAD_User_ID()), n.viewManager.startWindow(t, i)) } catch (r) { this.log.log(n.Logging.Level.SEVERE, sql, r) } s.dialog("close") }); tu.on("click", function () { gu(!0, !1) }); gt.on("click", function () { e.css("color", "gray"); e.text(n.Msg.getMsg("PleaseWait")); e.show(); window.setTimeout(function () { nf(!0, gi, d.val(), ti, !1) }, 500) }); ni.on("click", function (n) { gi = n.originalEvent.target.checked }); ru.on("click", function () { gu(!1, !0) }); ui.on("click", function () { u.css("color", "gray"); u.text(n.Msg.getMsg("PleaseWait")); u.show(); window.setTimeout(function () { nf(!1, !1, nt.val(), fi, !0) }, 500) }); iu.on("click", function () { gu(!1, !1) }); ii.on("click", function () { o.css("color", "gray"); o.text(n.Msg.getMsg("PleaseWait")); o.show(); window.setTimeout(function () { nf(!1, st, y.val(), ri, !1) }, 500) }); g.on("click", function (n) { st = n.originalEvent.target.checked }); nr.on("click", function (n) { tr = n.originalEvent.target.checked }); uu.on("click", function () { ei.val() != "" && ei.val().length != 0 && oi.val() != "" && oi.val().length != 0 && (u.css("color", "gray"), u.text(n.Msg.getMsg("PleaseWait")), u.show(), window.setTimeout(function () { yo(ei.val(), oi.val(), si.val(), tr) }, 500)) }); pu = null }; var ou = function () { t.ajax({ url: n.Application.contextUrl + "UserPreference/GetDefaultLogin", dataType: "json", data: { AD_User_ID: n.context.getAD_User_ID() }, success: function (n) { var t = JSON.parse(n); v.AD_Role_ID = t.AD_Role_ID; v.AD_Client_ID = t.AD_Client_ID; v.AD_Org_ID = t.AD_Org_ID; v.M_Warehouse_ID = t.M_Warehouse_ID; eu() } }) }, eu = function () { var i = "SELECT  r.Name,r.AD_Role_ID FROM AD_User u INNER JOIN AD_User_Roles ur ON (u.AD_User_ID=ur.AD_User_ID AND ur.IsActive='Y') INNER JOIN AD_Role r ON (ur.AD_Role_ID=r.AD_Role_ID AND r.IsActive='Y')  WHERE  u.AD_User_ID=" + n.context.getAD_User_ID() + " AND u.IsActive='Y'  AND u.IsLoginUser='Y'  AND EXISTS (SELECT * FROM AD_Client c WHERE u.AD_Client_ID=c.AD_Client_ID AND c.IsActive='Y') AND EXISTS (SELECT * FROM AD_Client c WHERE r.AD_Client_ID=c.AD_Client_ID AND c.IsActive='Y') ORDER BY r.Name"; t.ajax({ url: n.Application.contextUrl + "UserPreference/GetLoginData", dataType: "json", data: { sql: i }, success: function (n) { var t = JSON.parse(n), i = "", r; for (r in t) i += "<option value=" + t[r].RecKey + ">" + t[r].Name + "<\/option>"; l.append(i); l.val(v.AD_Role_ID); i = null; t = null; yr() } }) }, yr = function () { var i = l.val(), r; (a.empty(), h.empty(), p.empty(), i != undefined) && (r = "SELECT c.Name,r.AD_Client_ID FROM AD_Role r INNER JOIN AD_Client c ON (c.AD_Client_ID=r.AD_Client_ID) WHERE r.AD_Role_ID=" + i, i = null, t.ajax({ url: n.Application.contextUrl + "UserPreference/GetLoginData", dataType: "json", data: { sql: r }, success: function (n) { var t = JSON.parse(n), i = "", u; for (u in t) i += "<option value=" + t[u].RecKey + ">" + t[u].Name + "<\/option>"; a.append(i); a.val(v.AD_Client_ID); i = null; t = null; r = null; pr() } })) }, pr = function () { var i = l.val(), r = a.val(), u; (h.empty(), p.empty(), i != undefined && r != undefined) && (u = "SELECT o.Name,o.AD_Org_ID FROM AD_Role r, AD_Client c INNER JOIN AD_Org o ON (c.AD_Client_ID=o.AD_Client_ID OR o.AD_Org_ID=0) WHERE r.AD_Role_ID='" + i + "' AND c.AD_Client_ID='" + r + "' AND o.IsActive='Y' AND o.IsSummary='N'  AND o.IsCostCenter='N' AND o.IsProfitCenter='N'  AND (r.IsAccessAllOrgs='Y' OR (r.IsUseUserOrgAccess='N' AND o.AD_Org_ID IN (SELECT AD_Org_ID FROM AD_Role_OrgAccess ra WHERE ra.AD_Role_ID=r.AD_Role_ID AND ra.IsActive='Y')) OR (r.IsUseUserOrgAccess='Y' AND o.AD_Org_ID IN (SELECT AD_Org_ID FROM AD_User_OrgAccess ua WHERE ua.AD_User_ID='" + n.context.getAD_User_ID() + "' AND ua.IsActive='Y'))) ORDER BY o.Name", i = null, r = null, t.ajax({ url: n.Application.contextUrl + "UserPreference/GetLoginData", dataType: "json", data: { sql: u }, success: function (n) { var t = JSON.parse(n), i = "", r; for (r in t) i += "<option value=" + t[r].RecKey + ">" + t[r].Name + "<\/option>"; h.append(i); h.val(v.AD_Org_ID); i = null; t = null; u = null; wr() } })) }, wr = function () { var i = h.val(), r; (p.empty(), i != undefined) && (r = "SELECT Name,M_Warehouse_ID  FROM M_Warehouse WHERE AD_Org_ID=" + i + " AND IsActive='Y' ORDER BY Name", i = null, t.ajax({ url: n.Application.contextUrl + "UserPreference/GetLoginData", dataType: "json", data: { sql: r }, success: function (n) { var t = JSON.parse(n), i = "", u; for (u in t) i += "<option value=" + t[u].RecKey + ">" + t[u].Name + "<\/option>"; p.append(i); p.val(v.M_Warehouse_ID); i = null; t = null; r = null } })) }; this.showDialog = function () { var i = t(window).width() - 150, r = t(window).height() - 40; tt.height(r); tt.width(i); s.append(tt); s.dialog({ modal: !1, title: n.Msg.getMsg("Preference"), width: i, height: r, position: { at: "center top", of: window }, close: function () { wi.dispose(); s.dialog("destroy"); t("#ui-datepicker-div").remove(); s = null; wi = null } }) }; this.show = function () { this.load(); this.showDialog() }; this.disposeComponent = function () { wi = null; hi && hi.off("click"); et && et.off("click"); ot && ot.off("click"); pt && pt.off("click"); wt && wt.off("click"); yi && yi.off("click"); li = null; it = null; ht = null; ct = null; lt = null; at = null; w = null; dt = null; br = null; rt = null; vt = null; b = null; yt = null; ut = null; ur = null; fr = null; it = null; k = null; pt = null; wt = null; ft = null; er = null; et = null; ot = null; kr = null; bi = null; bt = null; kt = null; or = null; sr = null; hr = null; cr = null; ki = null; di = null; lr = null; ar = null; vr = null; lblUserSetMenu = null; lblPreferenceMenu = null; lblContextMenu = null; lblErrorMenu = null; lblchangePwsHeader = null; lblAutoMatic = null; imgAutoMatic = null; lblTranslation = null; imgTranslation = null; lblShowAccounting = null; imgShowAccounting = null; lblAutoNewRecord = null; imgAutoNewRecord = null; lblShowAdvanced = null; imgShowAdvanced = null; lblCacheWindows = null; imgCacheWindows = null; vlblClientOrg = null; imgClientOrg = null; lblWindowPageSize = null; imgWindowPageSize = null; lblAutoLogin = null; imgAutoLogin = null; lblStorePassword = null; imgStorePassword = null; lblTraceLevel = null; imgTraceLevel = null; lblTraceFile = null; imgTraceFile = null; lblNativeDigit = null; imgNativeDigit = null; vlblDateText = null; imgDateText = null; vlblPageSize = null; imgPageSize = null; vlblPageSize = null; lblContext = null; ai.datepicker("destroy"); ai = null; l.off("change"); a.off("change"); h.off("change"); l = null; a = null; h = null; p = null; eu = null; pr = null; yr = null; wr = null; this.disposeComponent = null } } n.Framework = n.Framework || {}; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Framework.UserPreference = i }(VIS, jQuery), function (n, t) { function i(i, r) { var e = this, u = t("<div>"), h = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), f = n.Env.getWindowNo(), v = null, y = null, s = null, d, g; this.onClose = null; var nt = null, p = null, c = null, l = null, k = null, b = null, o = !1, w = null, a = null; (i == null || i == "null") && (i = 0); d = function () { u.load(n.Application.contextUrl + "VImageForm/Index/?windowno=" + f + "&ad_image_id=" + i, function () { h[0].style.visibility = "visible"; g(u); h[0].style.visibility = "hidden" }) }; g = function (t) { v = u.find("#btnOk_" + f); y = u.find("#btnCancel_" + f); s = u.find("#btnImgDelete_" + f); i > 0 ? s.css("display", "inline-block") : s.css("display", "none"); p = t.find("#fileUpload_" + f); c = t.find("#holderDiv_" + f); l = t.find("#imgUsrImage_" + f); c.css("width", w - 48); a > 180 && c.css("height", a - 180); r > 0 ? l.hide() : l[0].width > 300 && c.css("overflow", "auto"); k = t.find("#lblfileUpload_" + f); b = t.find("#chkDataBaseSave_" + f); p.on("change", function () { l.show(); var t = p[0].files[0], n = new FileReader; return n.onload = function (n) { l.removeAttr("src").attr("src", n.target.result); c.css("overflow", "auto") }, n.readAsDataURL(t), o = !0, n = null, t = null, !1 }); b.on("change", function () { return o = !0, !1 }); v.on("click", function () { if (o) { var r = new XMLHttpRequest, t = new FormData; t.append("file", p[0].files[0]); t.append("isDatabaseSave", b.prop("checked")); t.append("ad_image_id", i); r.open("POST", n.Application.contextUrl + "VImageForm/SaveImage", !0); r.send(t); r.addEventListener("load", function (n) { var i = n.target.response, f; if (i = JSON.parse(i), f = i.result, e.onClose) e.onClose(f, o); r = null; t = null; u.dialog("close") }, !1) } else { if (e.onClose) e.onClose(i, o); u.dialog("close") } }); y.on("click", function () { u.dialog("close") }); s.on("click", function () { o = !0; var t = new XMLHttpRequest, r = new FormData; r.append("ad_image_id", i); t.open("POST", n.Application.contextUrl + "VImageForm/DeleteImage", !0); t.send(r); t.addEventListener("load", function (n) { var i = n.target.response, f; if (i = JSON.parse(i), f = i.result, e.onClose) e.onClose(f, o); t = null; r = null; u.dialog("close") }, !1) }) }; this.showDialog = function () { d(); w = t(window).width() - 150; a = t(window).height() - 40; h.height(a); h.width(w); u.append(h); u.dialog({ modal: !0, title: n.Msg.getMsg("ImageDialog"), width: w, height: a, position: { at: "center top", of: window }, close: function () { e.dispose(); e = null; u.dialog("destroy"); u = null } }) }; this.disposeComponent = function () { e = null; v && v.off("click"); y && y.off("click"); s && s.off("click"); h = null; f = null; v = null; y = null; s = null; nt = null; p = null; c = null; l = null; k = null; b = null; o = !1; w = null; a = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.VImageForm = i }(VIS, jQuery), function (n, t) { function i(i) { function f() { var e, s, f, h, o; for (r = t("<div><\/div>"), e = "<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>", e += n.Application.isRTL ? "<html dir='rtl' xmlns='http://www.w3.org/1999/xhtml'>" : "<html xmlns='http://www.w3.org/1999/xhtml'>", e += "<head><script type='text/javascript' language='javascript'> document.onkeydown = function(){ if((window.event && window.event .keyCode == 116)||(window.event && window.event .keyCode == 78)) { window.event.keyCode = 505; }if(window.event && window.event .keyCode == 505){ return false; } }<\/script> <meta http-equiv='Content-Type' content='text/html; charset=utf-8' /><title>Help &amp; Support " + i.vo.Name + "<\/title><style type='text/css'><!--body {margin-left: 0px;margin-top: 0px;margin-right: 0px;margin-bottom: 0px;font-family:verdana;font-size:12px;color:#000000;}.hed1{font-family:verdana;font-weight:bold;font-size:12px;color:#000000;}.border{border:1px solid #c6daf3;}.border-1{border:1px solid #aac7e7;background-color:#e9e8e8;}.border-2{border:1px solid #aac7e7;}.border-bottom{border-bottom:1px solid #c6daf3;}.border-top-none{border-bottom:1px solid #c6daf3;border-right:1px solid #c6daf3;border-left:1px solid #c6daf3;}.red{font-size:12px;color:#FF0000;font-weight:bold;}.white{font-size:16px;color:#FFffff;font-weight:bold;}.black{font-size:16px;color:#000000;font-weight:bold;}.blue{color:#5490fa;font-weight:bold;}.orange{color:#f2b227;font-weight:bold;}.pad{padding:5px;}a{color:#5490fa;\t}a:hover{color:#000000;\ttext-decoration:none;}--><\/style><\/head><body oncontextmenu='return false;'>", e = e + "<table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'><tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' bgcolor='#c6daf3' class='border-bottom'><tr><td width='100%' class='hed1' height='29'>Vienna Solutions<\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td>", e = e + "<\/tr><tr><td><table width='98%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'><tr><td><table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td class='red'>&nbsp;<\/td><\/tr><tr><td class='red'>Window: " + i.vo.Name + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>" + i.vo.Description + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>" + i.vo.Help + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>", s = "", f = 0; f < i.tabs.length; f++)s == "" ? s = "<a href='#" + i.tabs[f].vo.Name + "" + f + "'>" + i.tabs[f].vo.Name + "<\/a>" : s += " -&gt; <a href='#" + i.tabs[f].vo.Name + "" + f + "'>" + i.tabs[f].vo.Name + "<\/a> "; for (e = e + s, e = e + "<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><\/table><\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>", e = e + "<tr><td><table width='98%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'>", f = 0; f < i.tabs.length; f++) { for (e = e + "<tr><td><table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td class='black' style='padding-top:5px;' ><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td width='340' height='5' bgcolor='#f9b31c'><\/td><td width='4'><\/td><td width='624' bgcolor='#f9b31c'><\/td><\/tr><tr><td height='35' bgcolor='#FFFFFF' class='border-top-none' style='padding-left:10px;'>Tab:" + i.tabs[f].vo.Name + "<a name='" + i.tabs[f].vo.Name + "" + f + "'><\/a> <\/td><td ><\/td><td bgcolor='#FFFFFF' class='border-top-none' style='padding-left:10px;'>" + i.tabs[f].vo.Description, "NaN<\/tr><\/table><\/td><\/tr><tr><td >&nbsp;<\/td><\/tr><tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border-2'><tr><td style='padding:10px; text-align:justify'><span class='red'>" + i.tabs[f].vo.Help, "NaN<br />", h = "", o = 0; o < i.tabs[f].gTab._gridTable.m_fields.length; o++)h == "" && (i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR || i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf) ? h = "<a href='#" + i.tabs[f].vo.Name + "" + f + "" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "" + o + "'>" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "<\/a>" : (i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR || i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf) && (h += " | <a href='#" + i.tabs[f].vo.Name + "" + f + "" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "" + o + "'>" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "<\/a>"); for (e = e + h, e = e + " <\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>", o = 0; o < i.tabs[f].gTab._gridTable.m_fields.length; o++)i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header != "" && (i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR || i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf) && (e = e + "<tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border-1'><tr><td style='padding:10px; text-align:justify'><span class='blue'>Field: " + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "<\/span><a name='" + i.tabs[f].vo.Name + "" + f + "" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header + "" + o + "'><\/a><br /><br />" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Description + "<br /><br />" + i.tabs[f].gTab._gridTable.m_fields[o]._vo.Help + " <\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>"); e = e + "<\/table><\/td><\/tr>" } e = e + "<\/table><\/td><\/tr><\/table><\/body><\/html>"; r.append(jQuery.parseHTML(e)); u = e } function e() { var n = window.open(); n.document.open(); n.document.write(u) } var r, u = ""; f(); e() } n.Apps.help = i }(VIS, jQuery), function (n, t) { t.IniConstants = { log: t.Logging.VLogger.getVLogger(" VIS.Ini"), ENV_PREFIX: "env.", VIENNA_HOME: "VIENNA_HOME", VIENNA_PROPERTY_FILE: "vienna.properties", VIENNA_ENV_FILE: "viennaEnv.properties", P_UID: "ApplicationUserID", DEFAULT_UID: "UserPwd", P_PWD: "ApplicationPassword", DEFAULT_PWD: "UserPwd", P_STORE_PWD: "StorePassword", DEFAULT_STORE_PWD: !0, P_TRACELEVEL: "TraceLevel", DEFAULT_TRACELEVEL: "WARNING", P_TRACEFILE: "TraceFile", DEFAULT_TRACEFILE: !1, P_INI: "FileNameINI", DEFAULT_INI: "", P_CONNECTION: "Connection", DEFAULT_CONNECTION: "", P_A_LOGIN: "AutoLogin", DEFAULT_A_LOGIN: !1, P_A_NEW: "AutoNew", DEFAULT_A_NEW: !0, P_VIENNASYS: "ViennaSys", DEFAULT_VIENNASYS: !1, P_CACHE_WINDOW: "CacheWindow", DEFAULT_CACHE_WINDOW: !1, P_TEMP_DIR: "TempDir", DEFAULT_TEMP_DIR: "", P_ROLE: "Role", DEFAULT_ROLE: "", P_CLIENT: "Client", DEFAULT_CLIENT: "", P_ORG: "Organization", DEFAULT_ORG: "", P_WAREHOUSE: "Warehouse", DEFAULT_WAREHOUSE: "", P_TODAY: "CDate264", DEFAULT_TODAY: Date.now, P_PRINTPREVIEW: "PrintPreview", DEFAULT_PRINTPREVIEW: !0, P_WARNING: "Warning", DEFAULT_WARNING: "Do_not_change_any_of_the_data_as_they_will_have_undocumented_side_effects.", P_PRINTER: "Printer", DEFAULT_PRINTER: "", P_DBUSED: "dbused", DEFAULT_DBUSED: "", P_DB_NAME: "dbname", DEFAULT_DB_NAME: "", P_DBUSER_ID: "dbuserid", DEFAULT_DBUSER_ID: "", P_DBPWD: "dbpwd", DEFAULT_DB_PWD: "", P_DB_PORT: "dbport", DEFAULT_DB_PORT: "", P_DB_HOST: "dbhost", DEFAULT_DB_HOST: "", CO_SHOWLEVEL: "ClientOrgLevel", DEFAULT_CO_SHOWLEVEL: "2", W_PAGESIZE: "WorkSpacePageSize", DEFAULT_W_PAGESIZE: "5", WIN_PAGESIZE: "WindowPageSize", DEFAULT_WIN_PAGESIZE: "50", P_Show_Mini_Grid: "ShowMiniGrid", DEFAULT_MiniGrid_Status: !1, P_Print_Native_Digits: "PrintNativeDigits", DEFAULT_Native_Digits_Status: !0, P_WELCOME_SCREEN: "HideWelcomeScreen", DEFAULT_SCREEN_STATUS: !1, P_APP_TYPE: "AppType", DEFAULT_APP_TYPE: "VServer", P_APP_HOST: "AppHost", DEFAULT_APP_HOST: "localhost", P_APP_PORT: "AppPort", DEFAULT_APP_PORT: "2090", _VIENNASYS: "VFramworkSys", _XML_DOC_PATH: "appconn.xml", _XML_ROOT: "//connectionvar" }; t.Ini = function () { function n(n, t) { localStorage.setItem(n, t) } function i(n) { return localStorage.getItem(n) } function r() { localStorage.clear() } function u(n) { localStorage.removeItem(n) } function f() { return localStorage.getItem(t.IniConstants.P_CACHE_WINDOW) == "Y" } function e() { return t.Ini.getLocalStorage(t.IniConstants.P_TRACELEVEL) != null ? t.Logging.Level.prototype.getLevel(t.Ini.getLocalStorage(t.IniConstants.P_TRACELEVEL)) : t.Logging.Level.INFO } function o() { for (var i = [t.IniConstants.P_A_NEW, t.IniConstants.P_TRACEFILE, t.IniConstants.P_TRACELEVEL, t.IniConstants.CO_SHOWLEVEL, t.IniConstants.W_PAGESIZE, t.IniConstants.WIN_PAGESIZE, t.IniConstants.P_Show_Mini_Grid, t.IniConstants.P_Print_Native_Digits, t.IniConstants.P_A_LOGIN, t.IniConstants.P_STORE_PWD, t.IniConstants.P_CACHE_WINDOW, t.IniConstants.P_PRINTPREVIEW, t.IniConstants.P_TRACEFILE], r = {}, n = 0; n < i.length; n++)i[n] == "AutoNew" ? t.context.setContext(i[n], t.Ini.getLocalStorage(i[n]) == null ? "N" : t.Ini.getLocalStorage(i[n])) : t.context.setContext("#" + i[n], t.Ini.getLocalStorage(i[n])), r[i[n]] = t.Ini.getLocalStorage(i[n]); r["#TimezoneOffset"] = (new Date).getTimezoneOffset().toString(); r["#ClientLanguage"] = window.navigator.language; t.dataContext.updateClientCtx(r) } return { setValueToLocalStorage: n, getLocalStorage: i, clearLocalStorage: r, removeLocalStorageItem: u, updateLocalContextFromIni: o, getIsCacheWindow: f, getTraceLevel: e } }() }(jQuery, VIS), function (n, t) { function i(i, r) { function nt(n) { tt.css("display", n ? "block" : "none") } this.onClose = null; var o = i, w = this, u = t("<div style='position:relative;'>"), tt = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), f = n.Env.getWindowNo(), it = null, b = null, s = null, h = null, c = null, l = null, a = null, k = null, v = null, y = null, d = null, rt = null, p = null, g = null, ft = null, ut = null, e = !1, et = r; this.load = function () { u.load(n.Application.contextUrl + "Location/Locations/?windowno=" + f + "&locationId=" + o + "&AD_Language=" + n.context.getContext("#AD_Language"), function () { u.append(tt); nt(!0); w.init(); nt(!1) }) }; this.init = function () { function tt(i) { var r = null; t.ajax({ url: n.Application.contextUrl + "Location/SaveLocation", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ pref: i }) }).done(function (n) { if (r = n, o = r.locationid, ut = r.locaddress, this.location = o, nt(!1), w.onClose) w.onClose(o, e); u.dialog("close"); e = null }) } var r, i; p = u.find("#btnOk_" + f); g = u.find("#btnCancel_" + f); it = u.find("#lstLocation_" + f); b = u.find("#txtCountry_" + f); s = u.find("#txtAddress1_" + f); h = u.find("#txtAddress2_" + f); c = u.find("#txtAddress3_" + f); l = u.find("#txtAddress4_" + f); n.Application.isRTL && (p.removeClass("pull-left"), p.addClass("pull-right"), u.find("Sup").css("float", "right"), t(u.find(".cat2 a")[0]).removeClass("pull-right"), t(u.find(".cat2 a")[0]).addClass("pull-left"), t(u.find(".cat3 a")[0]).removeClass("pull-right"), t(u.find(".cat3 a")[0]).addClass("pull-left")); s.val() && s.val(s.val()); h.val() && h.val(h.val()); c.val() && (r = u.find("#aCollection"), i = u.find(".cat" + t(r).attr("data-prod-cat")), i ? i.length > 0 && i.toggle() : u.find(".cat" + t(r).attr("data-prod-close")).hide(), c.val(c.val())); l.val() && (r = u.find(".cat3").find("a")[0], i = u.find(".cat" + t(r).attr("data-prod-cat")), i ? i.length > 0 && i.toggle() : u.find(".cat" + t(r).attr("data-prod-close")).hide(), l.val(l.val())); a = u.find("#txtCity_" + f); a.val() && a.val(a.val()); k = u.find("#txtState_" + f); v = u.find("#txtZipCode_" + f); v.val() && v.val(v.val()); y = u.find("#countryhdn_" + f).val(); d = u.find("#Statehdn_" + f).val(); b.autocomplete({ source: function (i, r) { i.term.trim().length != 0 && t.ajax({ url: n.Application.contextUrl + "Location/GetCountry", dataType: "json", data: { style: "full", name_startsWith: i.term }, success: function (n) { r(t.map(n.result, function (n) { return { label: n.Name, value: n.Name, id: n.Key } })) } }) }, minLength: 1, select: function (n, t) { y = t.item.id }, open: function () { u.find(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { u.find(this).removeClass("ui-corner-top").addClass("ui-corner-all"); Number(y) > 0 && (e = !0) } }); k.autocomplete({ source: function (i, r) { i.term.trim().length != 0 && t.ajax({ url: n.Application.contextUrl + "Location/GetStates", dataType: "json", data: { style: "full", name_startsWith: i.term, countryId: y }, success: function (n) { r(t.map(n.result, function (n) { return { label: n.Name, value: n.Name, id: n.Key } })) } }) }, minLength: 1, select: function (n, t) { d = t.item.id }, open: function () { u.find(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { u.find(this).removeClass("ui-corner-top").addClass("ui-corner-all") } }); it.autocomplete({ source: function (i, r) { i.term.trim().length != 0 && t.ajax({ url: n.Application.contextUrl + "Location/GetAddresses", dataType: "json", data: { style: "full", name_startsWith: i.term }, success: function (n) { r(t.map(n.result, function (n) { return { label: n.ADDRESS, value: n.ADDRESS, C_COUNTRY_ID: n.C_COUNTRY_ID, C_LOCATION_ID: n.C_LOCATION_ID, C_REGION_ID: n.C_REGION_ID, COUNTRYNAME: n.COUNTRYNAME, ADDRESS1: n.ADDRESS1, ADDRESS2: n.ADDRESS2, ADDRESS3: n.ADDRESS3, ADDRESS4: n.ADDRESS4, CITYNAME: n.CITYNAME, STATENAME: n.STATENAME, ZIPCODE: n.ZIPCODE } })) } }) }, minLength: 1, select: function (n, t) { b.val(t.item.COUNTRYNAME); s.val(t.item.ADDRESS1); h.val(t.item.ADDRESS2); c.val(t.item.ADDRESS3); l.val(t.item.ADDRESS4); a.val(t.item.CITYNAME); k.val(t.item.STATENAME); v.val(t.item.ZIPCODE); e = !0; d = t.item.C_REGION_ID; o = 0; rt = 0; y = t.item.C_COUNTRY_ID }, open: function () { u.find(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { u.find(this).removeClass("ui-corner-top").addClass("ui-corner-all") } }); p.on("click", function () { if (nt(!0), Number(y) <= 0) { n.ADialog.warn("SelectCountry", !0, null); nt(!1); return } et && e && (o = 0); var t = { countryName: b.val(), addvalue1: s.val(), addvalue2: h.val(), addvalue3: c.val(), addvalue4: l.val(), cityValue: a.val(), stateValue: k.val(), zipValue: v.val(), clocationId: o, countryId: y, stateId: d, cityId: rt }, i = tt(t) }); g.on("click", function () { u.dialog("close") }); u.find(".VIS-Location-toggler").click(function (n) { n.preventDefault(); var t = u.find(".cat" + u.find(this).attr("data-prod-cat")); t && t.length > 0 ? t.toggle() : u.find(".cat" + u.find(this).attr("data-prod-close")).hide() }); b.bind("change", function () { e = !0 }); s.bind("change", function () { e = !0 }); h.bind("change", function () { e = !0 }); c.bind("change", function () { e = !0 }); l.bind("change", function () { e = !0 }); a.bind("change", function () { e = !0 }); k.bind("change", function () { e = !0 }); v.bind("change", function () { e = !0 }) }; this.showDialog = function () { u.append(tt); u.dialog({ modal: !0, resizable: !1, title: n.Msg.getMsg("Location"), closeText: n.Msg.getMsg("close"), width: 620, position: { at: "center top", of: window }, close: function () { w.dispose(); w = null; u.dialog("destroy"); u = null } }) }; this.disposeComponent = function () { w = null; p && p.off("click"); g && g.off("click"); o = 0; it = null; b = null; s = null; h = null; c = null; l = null; a = null; k = null; v = null; y = null; d = null; rt = null; p = null; g = null; ft = null; ut = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.LocationForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o) { function pt() { function o() { var n = nt.prop("checked"); n ? (it.hide(), rt.show(), v.removeClass("vis-gc-vpanel-table-readOnly"), y.removeClass("vis-gc-vpanel-table-readOnly"), p.removeClass("vis-gc-vpanel-table-readOnly"), w.removeClass("vis-gc-vpanel-table-readOnly"), c.removeClass("vis-gc-vpanel-table-readOnly"), c.removeAttr("disabled")) : (rt.hide(), it.show(), v.addClass("vis-gc-vpanel-table-readOnly"), y.addClass("vis-gc-vpanel-table-readOnly"), p.addClass("vis-gc-vpanel-table-readOnly"), w.addClass("vis-gc-vpanel-table-readOnly"), c.addClass("vis-gc-vpanel-table-readOnly"), c.attr("disabled", !0)); v.attr("readonly", !n); y.attr("readonly", !n); p.attr("readonly", !n); w.attr("readonly", !n) } function r() { var n = c.find("option:selected").text() + " " + g + " " + v.val() + " " + g + " " + y.val() + " " + g + " " + p.val(); w.val(n) } function lt() { d.on("click", function () { if (wt(), k.onClose) k.onClose(u); s.dialog("close") }); b.on("click", function () { s.dialog("close") }); nt.change(function () { o() }); ut.change(function () { }); v.change(function () { r() }); y.change(function () { r() }); p.change(function () { r() }); c.change(function () { r() }); ft.on("click", function () { l.val() == "" ? (l.autocomplete({ source: t.map(a.data, function (n) { return { label: n.Name, value: n.Name, locatorID: n.Key } }), minLength: 0 }).bind("focus", function () { l.val().length == 0 && l.autocomplete("search", "") }), l.trigger("focus")) : l.autocomplete("search") }) } var i, e; if (d = s.find("#btnOk_" + h), b = s.find("#btnCancel_" + h), vt = s.find("#cmbLocator_" + h), l = s.find("#lstLocator_" + h), ft = s.find("#locatorSearch_" + h), nt = s.find("#chkCreateNew_" + h), ut = s.find("#txtWarehouseInfo_" + h), c = s.find("#cmbWarehouse_" + h), v = s.find("#txtX_" + h), y = s.find("#txtY_" + h), p = s.find("#txtZ_" + h), w = s.find("#txtValue_" + h), tt = s.find("#divchkCreateNew_" + h), it = s.find("#divWarehouseInfo_" + h), rt = s.find("#divWarehouse_" + h), et = s.find("#lblX_" + h), ot = s.find("#lblY_" + h), st = s.find("#lblZ_" + h), ht = s.find("#lblValue_" + h), ct = s.find("#lblWarehouse_" + h), n.Application.isRTL && (b.css("margin-right", "10px"), tt.children(0).css("float", "left")), a.refresh(), a.fillCombobox(f, !0, !0, !1), i = n.dataContext.getJSONData(n.Application.contextUrl + "Locator/GetWarehouse", { Warehouse_ID: at }, null), i != null) for (e in i) c.append(" <option value=" + i[e].M_Warehouse_ID + ">" + i[e].Name + "<\/option>"); c.prop("selectedIndex", 0); a.data.length > 0 && u == 0 && (u = a.data[0].Key); yt(i); l.autocomplete({ source: function (n, i) { (n == null || n.term == null || n.term.trim().length != 0) && a.data.length > 0 && i(t.map(a.data, function (n) { return { label: n.Name, value: n.Name, locatorID: n.Key } })) }, minLength: 1, select: function (n, t) { u = t.item.locatorID; yt(i) }, open: function () { t(this).removeClass("ui-corner-all").addClass("ui-corner-top") }, close: function () { t(this).removeClass("ui-corner-top").addClass("ui-corner-all") } }); a.getIsOnlyOutgoing() && tt.hide(); o(); lt() } function wt() { var i; if (nt.prop("checked")) { i = ""; w.val().trim().length == 0 && (i += ht.val() + " - "); v.val().trim().length == 0 && (i += et.val() + " - "); y.val().trim().length == 0 && (i += ot.val() + " - "); p.val().trim().length == 0 && (i += st.val() + " - "); var f = ct.val(), o = w.val(), s = v.val(), h = y.val(), l = p.val(), r = c.find("option:selected").val(); r != 0 && e != r && (e = r); e == 0 && (i += f + " - "); i.length != 0 ? n.ADialog.error("FillMandatory", !0, i.substring(0, i.length - 3)) : t.ajax({ url: n.Application.contextUrl + "Locator/Save", dataType: "json", async: !1, data: { warehouseId: e, tValue: o, tX: s, tY: h, tZ: l }, success: function (n) { returnValue = n.locatorId; u = returnValue; a.refresh() } }) } else k.change = !0 } function yt(t) { var f = "", s = "", i = n.dataContext.getJSONData(n.Application.contextUrl + "Locator/GetWarehouseData", { Locator_ID: u }, null), o, r; if (t != null && i != null && (ut.val(i.Name), v.val(i.x), y.val(i.y), p.val(i.z), w.val(i.Value), e = i.M_Warehouse_ID, s = i.wValue, f = i.Separator, l.length > 0 && (l[0].value = i.Name + "_" + i.Value + "(" + i.x + i.Separator + i.y + i.Separator + i.z + ")")), g = f, o = i.Value, w.val(o), t != null) for (r in t) if (e == t[r].M_Warehouse_ID) { c.prop("selectedIndex", r); break } } this.onClose = null; this.change = !1; var s = t("<div style='position:relative;'>"), lt = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), d = null, b = null, k = this, g = null, i = i, u = u, f = f, at = e, e = 0, h = o, a = r, l = null, ft = null, vt = null, nt = null, tt = null, it = null, rt = null, ut = null, c = null, v = null, y = null, p = null, w = null, et = null, ot = null, st = null, ht = null, ct = null; setBusy = function (n) { lt.css("display", n ? "block" : "none") }; this.load = function () { s.load(n.Application.contextUrl + "Locator/Index/?windowno=" + h + "&locatorId=" + u, function () { setBusy(!0); pt(); setBusy(!1) }) }; this.showDialog = function () { s.append(lt); s.dialog({ modal: !0, resizable: !1, title: n.Msg.translate(n.Env.getCtx(), "Locator"), width: 510, position: { at: "center top", of: window }, close: function () { k.dispose(); k = null; s.dialog("destroy"); s = null } }) }; this.disposeComponent = function () { d && d.off("click"); b && b.off("click"); d = null; b = null; k = null; l = null; ft = null; i = null; u = null; f = null; at = null; e = null; h = null; a = null; tt = null; it = null; rt = null; vt = null; nt = null; ut = null; c = null; v = null; y = null; p = null; w = null; et = null; ot = null; st = null; ht = null; ct = null; this.disposeComponent = null; this.load = null; g = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.LocatorForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { function o(n) { s.css("display", n ? "block" : "none") } function h(n) { var t = '<div class="vis-valpreferencedatawrp" id="fisrt_' + n.windowNum + '"><div class="input-group vis-input-wrap" style="flex: 1;"><div class="vis-control-wrap"><input class="VIS_Pref_pass vis-gc-vpanel-table-readOnly" data-placeholder="" placeholder=" " style="margin-bottom: 0;" type="text" readonly="true" id="vtxtAttribute_' + n.windowNum + '" /><label class=" VIS_Pref_Label_Font" id="vlblAttributeText_' + n.windowNum + '">test<\/label><\/div><\/div><label class="VIS_Pref_Label_Font" id="vlblAttribute_' + n.windowNum + '">test<\/label><\/div><div class="vis-valpreferencedatawrp" id="second_' + n.windowNum + '"><div class="input-group vis-input-wrap" style="flex: 1;"><div class="vis-control-wrap"><input class="VIS_Pref_pass vis-gc-vpanel-table-readOnly" data-placeholder="" placeholder=" " style="margin-bottom: 0;" type="text" readonly="true" id="vtxtSearchKey_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font" id="vlblValueText_' + n.windowNum + '">test<\/label><\/div><\/div><label class="VIS_Pref_Label_Font" id="vlblValue_' + n.windowNum + '">test<\/label><\/div><\/div><\/div><div style="width: 100%; float: left">    <div> <div class="VIS_Pref_col-50"><input  type="checkbox" id="vchkTenant_' + n.windowNum + '" ><label class="VIS_Pref_Label_Font">test<\/label><\/div>   <div class="VIS_Pref_col-50"> <input  type="checkbox" id="vchkOrg_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font">test<\/label><\/div> <div class="VIS_Pref_col-50"><input  type="checkbox" id="vchkUser_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font">test<\/label><\/div>  <div class="VIS_Pref_col-50"> <input  type="checkbox" id="vchkWindow_' + n.windowNum + '" /><label class="VIS_Pref_Label_Font">test<\/label><\/div> <\/div><div id="divMsg_' + n.windowNum + '" style="width: 100%; float: left; margin-bottom: 5px; margin-top: 5px; text-align: left"><label class="VIS_Pref_Label_Font" id="vlblMsg_' + n.windowNum + '">test<\/label><\/div><div style="height: 10%; width: 100%; float: left"> <button type="button" id="btnDelete_' + n.windowNum + '"  class="VIS_Pref_btn-2"  style="float: left" value="Ok" role="button" aria-disabled="false"><i class="vis vis-delete"><\/i><\/button> <input id= "btnCancel_' + n.windowNum + '" class="VIS_Pref_btn-2" style="float:right" type="button" value="Cancel" /><input id="btnOK_' + n.windowNum + '"  class="VIS_Pref_btn-2" style="float:right; margin-right:10px" type="button" value="Ok" /><\/div>'; f.append(t) } if (i == null) return null; var e = this, f = t("<div class='vis-forms-container' style='position:relative;'>"), s = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); if (this.Okbtn = null, this.cancelbtn = null, this.deletebtn = null, this.txtAttribute = null, this.lblAttribute = null, this.txtSearchKey = null, this.lblValue = null, this.lblAttribute = null, this.lblValueText = null, this.lblLevelText = null, this.chkTenant = null, this.chkOrg = null, this.chkUser = null, this.chkWindow = null, this.lblMsg = null, this.userchk = null, this.tenantchk = null, this.windowchk = null, this.orgchk = null, this.aValue = null, this.aDisplayValue = null, r != null && (this.aValue = r, typeof r == Boolean && (this.aValue = r ? "Y" : "N"), this.aDisplayValue = u == null ? this.aValue : u), this.AD_Window_ID = i.getAD_Window_ID(), this.aAttribute = i.getColumnName(), this.aDisplayAttribute = i.getHeader(), this.aDisplayType = i.getDisplayType(), this.AD_Reference_ID = 0, this.windowNum = i.getWindowNo(), "Value".equals(this.aAttribute) || "DocumentNo".equals(this.aAttribute)) return null; this.AD_Client_ID = n.context.getAD_Client_ID(); this.AD_Org_ID = n.context.getWindowContext(this.windowNum, "AD_Org_ID", !0); this.AD_User_ID = n.context.getAD_User_ID(); this.role = n.MRole.getDefault(); this.load = function () { h(e); f.append(s); o(!0); e.init(f); o(!1) }; this.init = function () { this.lblAttributeText = f.find("#vlblAttributeText_" + this.windowNum); this.lblValueText = f.find("#vlblValueText_" + this.windowNum); this.lblLevelText = f.find("#vlblLevelText_" + this.windowNum); this.deletebtn = f.find("#btnDelete_" + this.windowNum); this.txtAttribute = f.find("#vtxtAttribute_" + this.windowNum); this.txtSearchKey = f.find("#vtxtSearchKey_" + this.windowNum); this.chkTenant = f.find("#vchkTenant_" + this.windowNum); this.chkOrg = f.find("#vchkOrg_" + this.windowNum); this.chkUser = f.find("#vchkUser_" + this.windowNum); this.chkWindow = f.find("#vchkWindow_" + this.windowNum); this.lblMsg = f.find("#vlblMsg_" + this.windowNum); this.lblAttribute = f.find("#vlblAttribute_" + this.windowNum); this.lblValue = f.find("#vlblValue_" + this.windowNum); this.Okbtn = f.find("#btnOK_" + this.windowNum); this.cancelbtn = f.find("#btnCancel_" + this.windowNum); n.Application.isRTL && (this.Okbtn.css("margin-right", "-128px"), this.cancelbtn.css("margin-right", "55px"), this.lblAttributeText.css("text-align", "right"), this.lblValueText.css("text-align", "right"), this.lblLevelText.css("text-align", "right"), this.chkOrg.css("margin-right", "0px"), this.chkTenant.css("margin-right", "37px"), f.find("#divMsg_" + this.windowNum).css("text-align", "right")); this.txtAttribute.val(this.aDisplayAttribute == null ? "" : this.aDisplayAttribute); this.lblAttribute.text(this.aAttribute == null ? "" : this.aAttribute); this.txtSearchKey.val(this.aDisplayValue == null ? "" : n.Utility.decodeText(this.aDisplayValue)); this.lblValue.text(this.aValue); this.lblAttributeText.text(n.Msg.getMsg("Attribute")); this.lblValueText.text(n.Msg.getMsg("SearchKey")); this.lblLevelText.text(n.Msg.getMsg("ValuePreferenceSetFor")); this.chkTenant.next("label").text(n.Msg.getMsg("Tenant")); this.chkOrg.next("label").text(n.Msg.getMsg("Org")); this.chkUser.next("label").text(n.Msg.getMsg("UserContact")); this.chkWindow.next("label").text(n.Msg.getMsg("Window")); this.chkTenant.prop("disabled", !0); this.chkTenant.prop("checked", !0); this.chkUser.prop("checked", !0); this.chkWindow.prop("checked", !0); n.MRole.PREFERENCETYPE_Client.equals(n.MRole.getPreferenceType()) || (this.chkOrg.prop("disabled", !0), this.chkOrg.prop("checked", !0)); n.MRole.PREFERENCETYPE_Client.equals(n.MRole.getPreferenceType()) || n.MRole.PREFERENCETYPE_Organization.equals(n.MRole.getPreferenceType()) || (this.chkUser.prop("disabled", !0), this.chkUser.prop("checked", !0)); this.setExplanation(); this.Okbtn.on("click", function () { o(!0); e.save(); o(!1); f.dialog("close") }); this.cancelbtn.on("click", function () { f.dialog("close") }); this.deletebtn.on("click", function () { e.delete(); f.dialog("close") }); t("[id^=vch]").click(function () { e.setExplanation() }) }; this.showDialog = function () { f.append(s); o(!0); setTimeout(this.load(), 5); f.dialog({ modal: !0, title: n.Msg.getMsg("ValuePreference"), width: 530, position: { at: "center top", of: window }, close: function () { e.dispose(); f.dialog("destroy"); f = null } }) }; this.disposeComponent = function () { this.Okbtn && this.Okbtn.off("click"); this.cancelbtn && this.cancelbtn.off("click"); this.deletebtn && this.deletebtn.off("click"); t("[id^=vch]") && t("[id^=vch]").off("click"); this.Okbtn = null; this.cancelbtn = null; this.deletebtn = null; s = null; e = null; this.disposeComponent = null } } i.prototype.setExplanation = function () { var t = "For "; this.chkTenant.prop("checked") && this.chkOrg.prop("checked") ? t += "this Client and Organization" : this.chkTenant.prop("checked") && !this.chkOrg.prop("checked") ? t += "all Organizations of this Client" : !this.chkTenant.prop("checked") && this.chkOrg.prop("checked") ? (this.chkOrg.prop("checked", !1), t += "entire System") : t += "entire System"; t += this.chkUser.prop("checked") ? ", this User" : ", all Users"; t += this.chkWindow.prop("checked") ? " and this Window" : " and all Windows"; n.Env.isBaseLanguage() && this.lblMsg.text(t.toString()); this.orgchk = this.chkOrg.prop("checked"); this.userchk = this.chkUser.prop("checked"); this.windowchk = this.chkWindow.prop("checked"); this.tenantchk = this.chkTenant.prop("checked") }; i.prototype.getADPreferenceID = function () { var t = "SELECT AD_Preference_ID FROM AD_Preference WHERE ", u = this.tenantchk ? this.AD_Client_ID : 0, i, r; return t += "AD_Client_ID=" + u, u = this.orgchk ? this.AD_Org_ID : 0, t += " AND AD_Org_ID=" + u, t += this.userchk ? " AND AD_User_ID=" + this.AD_User_ID : " AND AD_User_ID IS NULL", t += this.windowchk ? " AND AD_Window_ID=" + this.AD_Window_ID : " AND AD_Window_ID IS NULL", t += " AND Attribute='" + this.aAttribute + "'", i = 0, r = n.DB.executeDataSet(t.toString()), r != null && r.tables[0].rows.length > 0 && (i = r.tables[0].rows[0].getCell("ad_preference_id")), i < 0 && (i = 0), i }; i.prototype.delete = function () { var i = !1, r = this.getADPreferenceID(), u = this; return r > 0 ? t.ajax({ url: n.Application.contextUrl + "ValuePreference/Delete", dataType: "json", data: { preferenceId: r }, success: function (t) { i = t.result; i && (n.Env.getCtx().setContext(u.getContextKey(), null), n.ADialog.info("ValuePreferenceDeleted", !0, "", null)) } }) : n.ADialog.warn("ValuePreferenceNotFound", !0, "", null), i }; i.prototype.save = function () { var i, r, u; if (this.aValue == null) if (n.DisplayType.IsLookup(this.displayType)) this.aValue = "-1"; else if (n.DisplayType.IsDate(this.displayType)) this.aValue = " "; else return n.ADialog.warn("ValuePreferenceNotInserted", !0, "", null), !1; else if (this.aValue.toString().indexOf("@") != -1) return !1; return i = !1, this.orgchk = this.chkOrg.prop("checked"), this.userchk = this.chkUser.prop("checked"), this.windowchk = this.chkWindow.prop("checked"), this.tenantchk = this.chkTenant.prop("checked"), r = this, u = this.getADPreferenceID(), t.ajax({ url: n.Application.contextUrl + "ValuePreference/Save", dataType: "json", data: { preferenceId: u, clientId: this.tenantchk ? this.AD_Client_ID : 0, orgId: this.orgchk ? this.AD_Org_ID : 0, chkWindow: this.windowchk, AD_Window_ID: this.AD_Window_ID, chkUser: this.userchk, attribute: this.aAttribute, userId: this.AD_User_ID, value: this.aValue }, success: function (t) { i = t.result; i ? (n.Env.getCtx().setContext(r.getContextKey(), r.aValue), n.ADialog.info("ValuePreferenceInserted", !0, "", null)) : n.ADialog.warn("ValuePreferenceNotInserted", !0, "", null) } }), i }; i.prototype.getContextKey = function () { return this.windowchk ? "P" + this.AD_Window_ID + "|" + this.aAttribute : "P|" + this.aAttribute }; i.prototype.dispose = function () { this.disposeComponent() }; n.ValuePreference = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s) { function pi() { t.ajax({ url: n.Application.contextUrl + "PAttributes/Load", dataType: "json", async: !1, data: { mAttributeSetInstanceId: k, mProductId: tt, productWindow: et, windowNo: v, AD_Column_ID: o, window_ID: ot, IsSOTrx: kt, IsInternalUse: ui }, success: function (t) { if (returnValue = t.result, returnValue.Error != null) { n.ADialog.error(returnValue.Error, null, null, null); it.hasAttribute = !1; return } h.html(returnValue.tableStucture); h.append(ni); returnValue.ControlList && (c = returnValue.ControlList.split(",")); vi = returnValue.MAttributeSetID; ct = returnValue.IsCanCreate; lt = returnValue.IsCanEdit } }) } function wi(t) { var i, r; if (l.val(""), p.val(""), a.val(Globalize.format(new Date, "yyyy-MM-dd")), t = jQuery.parseJSON(t), t.result != null) for (i in t.result) if (c) { r = h.find("[attribute_id=" + i + "]"); r.attr("id").contains("cmb") ? r.val(n.Utility.Util.getValueOfInt(t.result[i])) : r.val(t.result[i]); continue } l != null && t.lot != "" ? l.val(t.lot) : p != null && t.serial != "" && p.val(t.serial); a != null && t.gdate != "" && a.val(Globalize.format(new Date(t.gdate), "yyyy-MM-dd")) } function bi() { var t = !0, f = !1, i, r, u; if (nt.prop("checked")) f = gt.val().length > 0 ? !0 : !1; else if (rt.prop("checked")) { if (i = l.val(), t = !1, r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/CheckUniqueLot", null, null), r > 0 && (u = di(i), u)) return t = !0, n.ADialog.Info("LotNoExists", null, null, null), !1; t || ei() } else { if (t = !1, n.Env.getCtx().setContext(w, "AttrCode", ht), it.onClose) it.onClose(k, wt, ft); b(!1); h.dialog("close") } t && ei() } function ei() { var f = [], u, i; if (c) for (u = 0; u < c.length; u++)if (i = h.find("#" + c[u]), c[u].toString().contains("cmb")) i.find("option:selected").length > 0 ? f.push({ Key: Number(i.find("option:selected").val()), Name: i.find("option:selected").text() }) : f.push({ Key: 0, Name: i.val() }); else { if (i.attr("class").contains("vis-gc-vpanel-table-mandatory") && i.val().trim().length == 0) return n.ADialog.warn("FillMandatoryFields", !0, null), b(!1), !1; i.attr("type") == "number" && (i.val().contains(".") || i.val(i.val().concat(".0"))); f.push({ Key: 0, Name: i.val() }) } t.ajax({ url: n.Application.contextUrl + "PAttributes/Save", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ windowNoParent: w, strLotString: l.val(), strSerNo: p.val(), dtGuaranteeDate: new Date(a.val()), strAttrCode: vt.val(), productWindow: et, mAttributeSetInstanceId: k, mProductId: r, windowNo: v, description: gt.val(), isEdited: nt.prop("checked"), lst: f }), success: function (t) { if (returnValue = t.result, returnValue) if (returnValue.Error != null) n.ADialog.info("", null, returnValue.Error, null), b(!1); else { if (n.Env.getCtx().setContext(w, "AttrCode", returnValue.attrCode), it.onClose) it.onClose(returnValue.M_AttributeSetInstance_ID, returnValue.M_AttributeSetInstanceName, ft); b(!1); h.dialog("close") } }, error: function (n, t) { console.log(t); b(!1) } }) } function ki() { var t, r, f, i; it.log.config(""); t = 0; w != -1 && (window.DTD001 && ot == 170 ? t = n.Env.getCtx().getContextAsInt(w, "DTD001_MWarehouseSource_ID") : (ot == 143 || ri == "Blanket Sales Order" || ot == 169 || ot == 168 || ot == 341) && (t = n.Env.getCtx().getContextAsInt(w, "M_Warehouse_ID"))); r = ""; try { r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/GetTitle", { Warehouse_ID: t, Product_ID: tt }, null) } catch (u) { console.log(u) } f = -1; i = new n.PAttributeInstance(r, t, ft, tt, bt, p.val(), l.val(), a.val(), kt); i.showDialog(); i.onClose = function (n, t, i, r) { n != -1 && (k = n, wt = t, ft = i, ht = r, ii = !0, b(!0), hi(), rt.prop("checked") && (rt.prop("checked", !1), oi()), nt.prop("checked") && (nt.prop("checked", !1), si()), lt && (dt.show(), nt.show())) }; i = null } function oi() { var n = rt.prop("checked"), i, t; if (nt.attr("disabled", n), l && (l.attr("readOnly", !n), n ? l.removeClass("vis-gc-vpanel-table-readOnly") : l.addClass("vis-gc-vpanel-table-readOnly")), y && (n ? (y.removeClass("vis-gc-vpanel-table-readOnly"), y.removeAttr("disabled")) : (y.attr("disabled", !0), y.addClass("vis-gc-vpanel-table-readOnly"))), d && (n ? d.removeAttr("disabled") : d.attr("disabled", !0)), p && (p.attr("readOnly", !n), n ? p.removeClass("vis-gc-vpanel-table-readOnly") : p.addClass("vis-gc-vpanel-table-readOnly")), g && (n ? g.removeAttr("disabled") : g.attr("disabled", !0)), a && (a.prop("disable", n), n ? (a.removeClass("vis-gc-vpanel-table-readOnly"), a.removeAttr("disabled")) : (a.addClass("vis-gc-vpanel-table-readOnly"), a.attr("disabled", !0))), c) for (i = 0; i < c.length; i++)t = h.find("#" + c[i]), t.attr("readOnly", !n), n ? (t.removeClass("vis-gc-vpanel-table-readOnly"), t.removeAttr("disabled")) : (t.addClass("vis-gc-vpanel-table-readOnly"), t.attr("disabled", !0)) } function si() { var n = nt.prop("checked"), i, t; if (rt.attr("disabled", n), l && (l.attr("readOnly", !n), n ? l.removeClass("vis-gc-vpanel-table-readOnly") : l.addClass("vis-gc-vpanel-table-readOnly")), y && (n ? (y.removeClass("vis-gc-vpanel-table-readOnly"), y.removeAttr("disabled")) : (y.attr("disabled", !0), y.addClass("vis-gc-vpanel-table-readOnly"))), d && (n ? d.removeAttr("disabled") : d.attr("disabled", !0)), p && (p.attr("readOnly", !n), n ? p.removeClass("vis-gc-vpanel-table-readOnly") : p.addClass("vis-gc-vpanel-table-readOnly")), g && (n ? g.removeAttr("disabled") : g.attr("disabled", !0)), a && (a.prop("disable", n), n ? (a.removeClass("vis-gc-vpanel-table-readOnly"), a.removeAttr("disabled")) : (a.addClass("vis-gc-vpanel-table-readOnly"), a.attr("disabled", !0))), c) for (i = 0; i < c.length; i++)t = h.find("#" + c[i]), t.attr("readOnly", !n), n ? (t.removeClass("vis-gc-vpanel-table-readOnly"), t.removeAttr("disabled")) : (t.addClass("vis-gc-vpanel-table-readOnly"), t.attr("disabled", !0)) } function di(t) { var i = !1, r; try { r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/CheckAttribute", { Window_No: w, Product_ID: tt, LotNumber: t }, null); r > 0 && (i = !0) } catch (u) { console.log(u) } return i } function gi(n) { y.append(new Option(n.Name, n.Key, !0, !0)); y.change() } function hi() { if (c) for (var i = 0; i < c.length; i++)c[i].toString().contains("cmb") ? h.find("#" + c[i]).prop("selectedIndex", -1) : h.find("#" + c[i]).val(""); t.ajax({ url: n.Application.contextUrl + "PAttributes/GetAttribute", dataType: "json", data: { mAttributeSetInstanceId: k, mProductId: tt, productWindow: et, windowNo: v, AD_Column_ID: o, attrcode: ht }, success: function (n) { returnValue = n; returnValue != null && wi(returnValue); b(!1) }, error: function (n, t) { console.log(t); b(!1) } }) } function nr() { if (y != null && y.change(function () { var n = y.find("option:selected").val(), t = y.find("option:selected").text(); n != null && n != -1 ? (l.val(t), l.attr("readOnly", !0), l.addClass("vis-gc-vpanel-table-readOnly"), ci = n) : (l.attr("readOnly", !1), l.removeClass("vis-gc-vpanel-table-readOnly")) }), rt != null && rt.change(function () { oi() }), nt != null && nt.change(function () { si() }), vt != null) vt.on("keydown", function (n) { (n.keyCode == 13 || n.keyCode == 9) && (b(!0), ht = vt.val(), hi()) }); if (ut != null) ut.on("click", function () { b(!0); bi() }); if (st != null) st.on("click", function () { h.dialog("close") }); if (at != null) { b(!0); at.on("click", function () { ki() }); b(!1) } if (d != null) d.on("click", function () { t.ajax({ url: n.Application.contextUrl + "PAttributes/CreateLot", dataType: "json", async: !1, data: { mAttributeSetInstanceId: k, mProductId: tt }, success: function (n) { returnValue = n.result; gi(returnValue) } }) }); if (g != null) g.on("click", function () { t.ajax({ url: n.Application.contextUrl + "PAttributes/GetSerNo", dataType: "json", async: !1, data: { mAttributeSetInstanceId: k, mProductId: tt }, success: function (n) { returnValue = n.result; p.val(returnValue) } }) }); c } function b(n) { ni.css("display", n ? "block" : "none") } var fi, yt, pt; this.onClose = null; var it = this, h = t("<div style='position:relative'>"), ni = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), v = n.Env.getWindowNo(), k = null, ft = null, wt = null, tt = null, bt = null, ti = null, w = null, ci = null, ht = "", et = !1, ii = !1, li = 40, ai = {}, c = null, vi = null, ot = 0, ri = "", kt = !1, ui = !1, ct = !1, lt = !1; if (this.log = n.Logging.VLogger.getVLogger("PAttributesForm"), this.log.config("M_AttributeSetInstance_ID=" + i + ", M_Product_ID=" + r + ", C_BPartner_ID=" + f + ", ProductW=" + et + ", Column=" + o), k = i, tt = r, bt = f, et = e, ti = o, w = s, ft = u, w != -1 && (fi = n.context.getWindowTabContext(w, 0, "AD_Tab_ID"), ot = n.dataContext.getJSONRecord("InfoProduct/GetWindowID", fi.toString()), ri = n.context.getContext(w, "WindowName"), kt = n.context.isSOTrx(w), ui = n.context.getWindowTabContext(w, 0, "IsInternalUse")), tt != 0) { this.hasAttribute = !0; pi(); var ut = h.find("#btnOk_" + v), st = h.find("#btnCancel_" + v), at = h.find("#btnSelect_" + v), d = h.find("#btnLot_" + v), g = h.find("#btnSerNo_" + v), y = h.find("#cmbLot_" + v), yi = h.find("#cmdNew_" + v), rt = h.find("#chkNewEdit_" + v), dt = h.find("#lblEdit_" + v), nt = h.find("#chkEdit_" + v), gt = h.find("#txtDescription_" + v), l = h.find("#txtLotString_" + v), p = h.find("#txtSerNo_" + v), a = h.find("#dtpicGuaranteeDate_" + v), vt = h.find("#txtAttrCode_" + v); if (at.children(0).attr("src", n.Application.contextUrl + "Areas/VIS/Images/base/Locator10.png"), n.Application.isRTL && (ut.css("margin-right", "0px"), ut.css("margin-left", "10px"), ut.css("float", "left"), st.css("margin-right", "0px"), st.css("float", "left")), !et) if (ct ? rt.prop("checked", k == 0) : yi.hide(), k > 0 || !ct) { if (l && (l.attr("readOnly", !0), l.addClass("vis-gc-vpanel-table-readOnly")), y && (y.attr("disabled", !0), y.addClass("vis-gc-vpanel-table-readOnly")), d && d.attr("disabled", !0), p && (p.attr("readOnly", !0), p.addClass("vis-gc-vpanel-table-readOnly")), g && g.attr("disabled", !0), a && (a.prop("disable", !0), a.addClass("vis-gc-vpanel-table-readOnly"), a.attr("disabled", !0)), c) for (yt = 0; yt < c.length; yt++)pt = h.find("#" + c[yt]), pt.attr("readOnly", !0), pt.addClass("vis-gc-vpanel-table-readOnly"), pt.attr("disabled", !0); lt || (dt.hide(), nt.hide()); !ct & !lt && d.hide() } else dt.hide(), nt.hide(); nr(); this.showDialog = function () { if (h.dialog({ modal: !0, title: n.Msg.translate(n.Env.getCtx(), "M_AttributeSetInstance_ID"), width: 490, close: function () { it.dispose(); it = null; h.dialog("destroy"); h = null } }), c && i == 0) for (var t = 0; t < c.length; t++)c[t].toString().contains("cmb") && h.find("#" + c[t]).prop("selectedIndex", -1); b(!1) }; this.disposeComponent = function () { ut && ut.off("click"); st && st.off("click"); n.Env.clearWinContext(n.Env.getCtx(), v); n.Env.getCtx().setContext(n.Env.WINDOW_INFO, n.Env.TAB_INFO, "M_AttributeSetInstance_ID", k); n.Env.getCtx().setContext(n.Env.WINDOW_INFO, n.Env.TAB_INFO, "M_Locator_ID", ft); ft = null; wt = null; tt = null; bt = null; ti = null; w = null; et = null; ii = null; li = 0; ai = null; ut = null; st = null; at = null; d = null; g = null; y = null; rt = null; gt = null; l = null; p = null; a = null; it = null; v = null; k = null; this.disposeComponent = null } } } i.prototype.dispose = function () { this.disposeComponent() }; n.PAttributesForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h, c) { function bt(t) { var f; if (l.log.config("C_BPartner_ID=" + t), t != 0) { var u = 0, i = 0, r = null; try { r = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/GetBPData", { Product_ID: ut, BPartner_ID: t }, null); r != null && (u = r.ShelfLifeMinPct, f = r.PCT, f > 0 && (i = f), i = r.ShelfLifeMinDays) } catch (e) { console.log(e) } u > 0 && (k = " AND COALESCE(TRUNC((daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD'))/p.GuaranteeDays)*100),0)>=" + u, l.log.config("PAttributeInstance.dynInit - ShelfLifeMinPct=" + u)); i > 0 && (k += " AND COALESCE(daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD')),0)>=" + i, l.log.config("PAttributeInstance.dynInit - ShelfLifeMinDays=" + i)) } y = kt(at, vt, !1, "patr") + " ORDER BY asi.GuaranteeDate, QtyOnHand DESC"; tt.append(w); ot.append(p).append(a); b.append(it).append(tt).append(et).append(ot); ct ? w.prop("checked", !1) : w.prop("checked", !0); gt() } function kt(t, i, r, u) { var f = "SELECT DISTINCT patr.M_AttributeSetInstance_ID, asi.Description, asi.Lot, asi.SerNo, asi.GuaranteeDate, asi.Value AS AttrCode, l.Value, NVL(s.M_Locator_ID,0) AS M_Locator_ID, NVL(s.QtyOnHand,0) AS QtyOnHand, NVL(s.QtyReserved,0) AS QtyReserved, NVL(s.QtyOrdered,0) AS QtyOrdered, (daysBetween(TRUNC(asi.GuaranteeDate,'DD'), TRUNC(SysDate,'DD'))-p.GuaranteeDaysMin) as ShelfLifeDays, daysBetween(TRUNC(asi.GuaranteeDate,'DD'), TRUNC(SysDate,'DD')) as GoodForDays, CASE WHEN p.GuaranteeDays > 0 THEN  ROUND(daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD'))/p.GuaranteeDays*100,12) ELSE 0 END as ShelfLifeRemainingPct", e; return (f = f.concat(" FROM ").concat(t), f = f.concat(" WHERE ").concat(i), rt != 0 && (f = f.concat(" AND NVL(l.M_Warehouse_ID,0) IN (0," + rt + ")")), t.length == 0) ? f.toString() : (l.log.finest(e), n.MRole.getDefault().addAccessSQL(f, u, n.MRole.SQL_FULLYQUALIFIED, n.MRole.SQL_RO)) } function pt() { var o, u, i, t; y == null && (y = ""); var f = [], r = y, e = y.lastIndexOf(" ORDER BY "); w.prop("checked") || (r = y.substring(0, e) + ft, k.length > 0 && (r += k), r += y.substring(e)); l.log.finest(r); try { if (o = n.secureEngine.encrypt(r), dr = n.dataContext.getJSONData(n.Application.contextUrl + "PAttributes/GetAttributeData", { Sq1Atribute: o, Product_ID: ut }, null), dr != null && dr.length > 0) { u = 1; for (i in dr) t = {}, t.M_AttributeSetInstance_ID = dr[i].M_AttributeSetInstance_ID, t.Description = dr[i].Description, t.Lot = dr[i].Lot, t.SerNo = dr[i].SerNo, t.GuaranteeDate = dr[i].GuaranteeDate, t.Value = dr[i].Value, t.QtyReserved = dr[i].QtyReserved, t.QtyOrdered = dr[i].QtyOrdered, t.QtyOnHand = dr[i].QtyOnHand, t.GoodForDays = dr[i].GoodForDays, t.ShelfLifeDays = dr[i].ShelfLifeDays, t.ShelfLifeRemainingPct = dr[i].ShelfLifeRemainingPct, t.M_Locator_ID = dr[i].M_Locator_ID, t.AttrCode = dr[i].AttrCode, t.recid = u, u++, f.push(t) } wt() } catch (s) { console.log(s) } dt(f) } function dt(i) { l.dGrid != null && (l.dGrid.destroy(), l.dGrid = null); l.arrListColumns.length == 0 && (l.arrListColumns.push({ field: "Description", caption: n.Msg.translate(n.Env.getCtx(), "Description"), sortable: !0, size: "16%", min: 150, hidden: !1 }), l.arrListColumns.push({ field: "Lot", caption: n.Msg.translate(n.Env.getCtx(), "Lot"), sortable: !0, size: "10%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "SerNo", caption: n.Msg.getElement(n.Env.getCtx(), "SerNo"), sortable: !0, size: "10%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "GuaranteeDate", caption: n.Msg.getElement(n.Env.getCtx(), "GuaranteeDate"), sortable: !0, size: "10%", min: 100, hidden: !1, render: "date", options: { format: "yyyy-mm-dd" } }), l.arrListColumns.push({ field: "Value", caption: n.Msg.getElement(n.Env.getCtx(), "M_Locator_ID"), sortable: !0, size: "10%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "QtyReserved", caption: n.Msg.getElement(n.Env.getCtx(), "QtyReserved"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "QtyOrdered", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOrdered"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "QtyOnHand", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOnHand"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "GoodForDays", caption: n.Msg.getElement(n.Env.getCtx(), "GoodForDays"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "ShelfLifeDays", caption: n.Msg.getElement(n.Env.getCtx(), "ShelfLifeDays"), sortable: !0, size: "15%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "ShelfLifeRemainingPct", caption: n.Msg.getElement(n.Env.getCtx(), "ShelfLifeRemainingPct"), sortable: !0, size: "20%", min: 100, hidden: !1 }), l.arrListColumns.push({ field: "M_Locator_ID", caption: n.Msg.getElement(n.Env.getCtx(), "M_Locator_ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }), l.arrListColumns.push({ field: "M_AttributeSetInstance_ID", caption: n.Msg.translate(n.Env.getCtx(), "ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }), l.arrListColumns.push({ field: "AttrCode", caption: n.Msg.getElement(n.Env.getCtx(), "AttrCode"), sortable: !0, size: "16%", min: 150, hidden: !0 })); setTimeout(10); w2utils.encodeTags(i); l.dGrid = t(et).w2grid({ name: "gridPinstance" + v, show: { toolbar: !0, footer: !0 }, recordHeight: 30, columns: l.arrListColumns, records: i, multiSearch: !0, searches: [{ field: "Description", caption: "Description", type: "text" }, { field: "Lot", caption: "Lot", type: "text" }, { field: "SerNo", caption: "SerNo", type: "text" }, { field: "GuaranteeDate", caption: "GuaranteeDate", type: "date", options: { format: "yyyy-mm-dd" } }], onClick: function () { l.dGrid.records.length > 0 && a.removeAttr("disabled") } }); yt || (o ? l.dGrid.search("all", o) : s && l.dGrid.search("all", s)); it.css("display", "none") } function wt() { var n = -1, t = n != -1, i; l.dGrid != null && (n = Number(l.dGrid.getSelection().toString()), g = -1, nt = null, d = 0, t = n != -1, t && n > 0 && (i = l.dGrid.get(n).M_AttributeSetInstance_ID, i > 0 && (g = i, nt = l.dGrid.get(n).Description, d = l.dGrid.get(n).M_Locator_ID, lt = l.dGrid.get(n).AttrCode))); a.attr("disabled", !0); t && a.removeAttr("disabled"); l.log.fine("M_AttributeSetInstance_ID=" + g + " - " + nt + "; M_Locator_ID=" + d) } function gt() { if (a != null) a.on(n.Events.onTouchStartOrClick, function () { if (wt(), l.onClose) l.onClose(g, nt, d, lt); b.dialog("close") }); if (p != null) p.on(n.Events.onTouchStartOrClick, function () { b.dialog("close") }); w != null && w.change(function () { yt = !0; pt() }) } var l = this, k; this.onClose = null; var b = t("<div>"), it = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), rt = r, d = u, ut = f, st = e, ht = i, ct = c; this.arrListColumns = []; this.dGrid = null; var g = -1, nt = null, lt = "", y = "", ft = "", at = "M_ProductAttributes patr LEFT JOIN M_Storage s ON (patr.M_AttributeSetInstance_ID = s.M_AttributeSetInstance_ID AND patr.M_Product_ID = s.M_Product_ID) LEFT JOIN M_Locator l ON (s.M_Locator_ID=l.M_Locator_ID) LEFT JOIN M_Warehouse w ON (l.M_Warehouse_ID=w.M_Warehouse_ID) INNER JOIN M_Product p ON (patr.M_Product_ID=p.M_Product_ID) INNER JOIN M_AttributeSetInstance asi ON (patr.M_AttributeSetInstance_ID=asi.M_AttributeSetInstance_ID)", vt = " patr.M_Product_ID=@M_Product_ID AND patr.M_AttributeSetInstance_ID != 0"; ft = " AND s.QtyOnHand>0"; k = ""; this.log = n.Logging.VLogger.getVLogger("PAttributeInstance"); var v = n.Env.getWindowNo(), w = t("<input id='chkShowAll_" + v + "' type='checkbox' ><span><label id='lblShowAll_" + v + "' class='VIS_Pref_Label_Font'>" + n.Msg.getMsg("VIS_ShowAll") + "<\/label><\/span>"), a = t("<input id='btnOk_" + v + "' class='VIS_Pref_btn-2' style='float: right; margin-right: 10px;' type='button' value='" + n.Msg.getMsg("OK") + "'>"), p = t("<input id='btnCancel_" + v + "' class='VIS_Pref_btn-2' style='float: right;margin-right: 0px;' type='button' value='" + n.Msg.getMsg("Cancel") + "'>"), tt = t("<div id='topdiv_" + v + "' style='float: left; width: 100%; height: 7%; text-align: right;'>"), et = t("<div id='middeldiv_" + v + "' style='float: left; width: 100%; height: 79%;'>"), ot = t("<div id='bottomdiv_" + v + "' style='float: left; width: 100%; height: 14%;'>"), yt = !1; n.Application.isRTL && (tt.css("text-align", "left"), a.css("margin-right", "0px"), a.css("margin-left", "10px"), a.css("float", "left"), p.css("margin-right", "0px"), p.css("float", "left")); this.showDialog = function () { b.dialog({ modal: !0, title: ht, width: 600, height: 450, resizable: !1, close: function () { l.dispose(); l = null; b.dialog("destroy"); b = null } }); pt() }; this.disposeComponent = function () { a && a.off("click"); p && p.off("click"); a = null; p = null; v = null; this.onClose = null; it = null; rt = null; d = null; ut = null; st = null; ht = null; ct = null; this.arrListColumns = null; this.dGrid = null; at = null; vt = null; ft = null; k = null; this.log = null; w = null; tt = null; et = null; ot = null; g = null; nt = null; y = null; this.disposeComponent = null }; bt(st) } i.prototype.dispose = function () { this.disposeComponent() }; n.PAttributeInstance = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o) { function rt() { t.ajax({ url: n.Application.contextUrl + "GenralAttribute/Load", dataType: "json", async: !1, data: { mAttributeSetInstanceId: v, vadms_AttributeSet_ID: p, windowNo: h }, success: function (t) { if (returnValue = t.result, n.Env.getCtx().setContext(h, "C_GenAttributeSet_ID", p), returnValue.Error != null) { n.ADialog.error(returnValue.Error, null, null, null); return } s.html(returnValue.tableStucture); a = returnValue.ControlList.split(",") } }) } function ut() { for (var u = [], r, i = 0; i < a.length; i++)r = s.find("#" + a[i]), a[i].toString().contains("cmb") ? u.push({ Key: Number(r.find("option:selected").val()), Name: r.find("option:selected").text() }) : u.push({ Key: 0, Name: n.Utility.decodeText(r.val()) }); t.ajax({ url: n.Application.contextUrl + "GenralAttribute/Save", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ windowNoParent: w, mAttributeSetInstanceId: v, vadms_AttributeSet_ID: p, windowNo: h, lst: u }), success: function (n) { if (returnValue = n.result, l.onClose) l.onClose(returnValue.M_AttributeSetInstance_ID, returnValue.M_AttributeSetInstanceName) } }) } function ft() { for (var u = [], r, i = 0; i < a.length; i++)r = s.find("#" + a[i]), a[i].toString().contains("cmb") ? u.push({ Key: Number(r.find("option:selected").val()), Name: r.find("option:selected").text() }) : u.push({ Key: 0, Name: r.val() }); t.ajax({ url: n.Application.contextUrl + "GenralAttribute/SearchValues", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ windowNoParent: Number(w), mAttributeSetInstanceId: v, vadms_AttributeSet_ID: p, windowNo: h, lst: u }), success: function (n) { if (returnValue = n.result, l.onClose) { returnValue.M_AttributeSetInstanceName == null && (returnValue.M_AttributeSetInstanceName = returnValue.Description); l.onClose(returnValue.M_AttributeSetInstance_ID, returnValue.M_AttributeSetInstanceName, returnValue.GenSetInstance) } } }) } var l, s; this.onClose = null; l = this; s = t("<div>"); this.log = n.Logging.VLogger.getVLogger("GenralAttributeForm"); var h = n.Env.getWindowNo(), v = null, k = null, d = null, w = u, p = 0, g = !1, nt = 40, tt = o, it = {}, b = !1, c = null, y = null, a = null; this.log.config("C_GenAttributeSetInstance_ID=" + i); v = i; p = r; tt = o; b = f; rt(); c = s.find("#btnOk_" + h); y = s.find("#btnCancel_" + h); e ? (c.attr("disabled", !1), c.css("opacity", "1")) : (c.attr("disabled", !0), c.css("opacity", "0.6")); n.Application.isRTL && y.css("margin-right", "10px"); this.btnSelect = s.find("#btnSelect_" + h); this.txtDescription = s.find("#txtDescription_" + h); c.on("click", function () { b ? ft() : ut(); s.dialog("close") }); y.on("click", function () { s.dialog("close") }); this.showDialog = function () { s.dialog({ modal: !0, title: n.Msg.translate(n.Env.getCtx(), "C_GenAttributeSetInstance_ID"), width: 400, close: function () { l.dispose(); l = null; s.dialog("destroy"); s = null } }) }; this.disposeComponent = function () { c && c.off("click"); y && y.off("click"); n.Env.clearWinContext(n.Env.getCtx(), h); n.Env.getCtx().setContext(n.Env.WINDOW_INFO, n.Env.TAB_INFO, "M_AttributeSetInstance_ID", v); c = null; y = null; mLocatorId = null; k = null; mProductId = null; d = null; adColumnId = null; w = null; productWindow = null; g = null; nt = 0; it = null; l = null; h = null; v = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.GenralAttributeForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function of(i, r, u) { var f = null; return i.sql = n.secureEngine.encrypt(i.sql), t.ajax({ url: rf, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: r, data: JSON.stringify(i) }).done(function (n) { f = n; u && u(n) }), f } function bu(n, i, r) { var u = null; return t.ajax({ url: nf, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } this.onClose = null; var ti = t("<div style='position:relative;'>"), ei = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), s = this, pu = i, oi = r, at = u, o = n.Env.getWindowNo(), wu = null, di = new n.Controls.VLabel, k = null, wt = null, d = null, nt = null, tt = null, g = null, it = null, rt = null, ut = null, ft = null, et = null, ot = null, st = null, ht = null, ct = null, lt = null, h = null, c = null, l = null, a = null, v = null, y = null, p = null, w = null, b = null, gi = null, nr = null, tr = null, ir = null, rr = null, ur = null, fr = null, er = null, or = null, sr = !1, hr = !1, cr = !1, lr = !1, ar = !1, vr = !1, yr = !1, pr = !1, wr = !1, br = n.Application.contextUrl, nf = br + "JsonData/JDataSetWithCode", tf = br + "JsonData/ExecuteNonQuer", rf = br + "Form/JDataSet", uf = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, bu(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, vt = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, bu(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, ff = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n, param: i }; return t.ajax({ url: tf + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }, ef = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, of(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; this.log = n.Logging.VLogger.getVLogger("AccountForm"); this.log.config("C_AcctSchema_ID=" + at + ", C_ValidCombination_ID=" + oi.C_ValidCombination_ID); var sf = 181, kr = "AC", dr = "AY", gr = "BP", nu = "LF", tu = "LT", iu = "MC", ru = "OO", uu = "OT", fu = "PJ", eu = "PR", ou = "SA", su = "SR", hu = "U1", cu = "U2", si = "X1", hi = "X2", ci = "X3", li = "X4", ai = "X5", vi = "X6", yi = "X7", pi = "X8", wi = "X9", dt = t("<table>"); dt.css("width", "100%"); var bt = t("<tr>"), gt = null, ni = null, ri = null, ui = null, fi = null, lu = null, bi = null, ku = null, du = null, ki = null, gu = null, yt = null, hf = !1, au = null, ii = null, e = null, vu = null, yu = null, pt = null, kt = null; this.load = function () { ti.load(n.Application.contextUrl + "AccountForm/Index/?windowno=" + o, function () { s.setBusy(!0); s.init(ti); s.setBusy(!1) }) }; this.setBusy = function (n) { ei.css("display", n ? "block" : "none") }; this.init = function (i) { function br() { n.Env.getCtx().setContext(o, "C_AcctSchema_ID", at); t.ajax({ url: n.Application.contextUrl + "AccountForm/LoadControls", dataType: "json", data: { windowNo: o, C_AcctSchema_ID: at }, success: function (n) { returnValue = n.result; pu(returnValue); kt = returnValue } }) } function pu(i) { n.AEnv.getGridWindow(o, 153, function (r) { var ku, pu, du, wu, bu, kt, bt, ti, fi, ei, ui, ni, gu, au, yu; if (r.error != null) { n.ADialog.error(r.error); self.dispose(); self = null; return } if (ku = t.parseJSON(r.result), n.context.setContextOfWindow(t.parseJSON(r.wCtx), o), pu = new n.GridWindow(ku), pu != null) { for (e = pu.getTabs()[0], e.getField("Alias").setDisplayLength(15), e.getField("Combination").setDisplayLength(15), e.getField("AD_Client_ID").setDisplayed(!1), e.getField("C_AcctSchema_ID").setDisplayed(!1), e.getField("IsActive").setDisplayed(!1), e.getField("IsFullyQualified").setDisplayed(!1), kt = 0; kt < e.getFieldCount(); kt++)bt = e.getField(kt), bt.getIsDisplayed(!0) || bt.setDisplayed(!1); for (du = o + "_" + at, yt = new n.GridController(!1, !1, du), yt.initGrid(!0, o, s, e), yt.setVisible(!0), window.innerHeight > 700 ? yt.sizeChanged(window.innerHeight - 230, window.innerWidth) : yt.sizeChanged(window.innerHeight - 215, window.innerWidth), ki.append(yt.getRoot()), yt.activate(), i.IsHasAlies && (wu = e.getField("Alias"), k = n.VControlFactory.getControl(e, wu, !1), u(wu, k, !1)), bu = e.getField("Combination"), wt = n.VControlFactory.getControl(e, bu, !1), u(bu, wt, !1), kt = 0; kt < i.Elements.length; kt++) { var di = returnValue.Elements[kt].Type, gt = returnValue.Elements[kt].IsMandatory, br = returnValue.Elements[kt].IsHeavyData, ri = returnValue.Elements[kt].Name; if (di.equals(ru)) { bt = e.getField("AD_Org_ID"); d = n.VControlFactory.getControl(e, bt, !1); u(bt, d, gt, ri, ru); d.fireValueChanged = nf; function nf() { var t = d.getValue(); n.Env.getCtx().setContext(o, "AcctOrg_ID", t) } } else if (di.equals(kr)) bt = e.getField("Account_ID"), nt = n.VControlFactory.getControl(e, bt, !1), nt.setValue(at), u(bt, nt, gt, ri, kr); else if (di.equals(ou)) bt = e.getField("C_SubAcct_ID"), tt = n.VControlFactory.getControl(e, bt, !1), u(bt, tt, gt, ri, ou); else if (di.equals(eu)) bt = e.getField("M_Product_ID"), g = n.VControlFactory.getControl(e, bt, !1), g.getBtn(), u(bt, g, gt, ri, eu); else if (di.equals(gr)) bt = e.getField("C_BPartner_ID"), it = n.VControlFactory.getControl(e, bt, !1), u(bt, it, gt, ri, gr); else if (di.equals(iu)) bt = e.getField("C_Campaign_ID"), rt = n.VControlFactory.getControl(e, bt, !1), u(bt, rt, gt, ri, iu); else if (di.equals(nu)) bt = e.getField("C_LocFrom_ID"), ut = n.VControlFactory.getControl(e, bt, !1), u(bt, ut, gt, ri, nu); else if (di.equals(tu)) bt = e.getField("C_LocTo_ID"), ft = n.VControlFactory.getControl(e, bt, !1), u(bt, ft, gt, ri, tu); else if (di.equals(fu)) bt = e.getField("C_Project_ID"), et = n.VControlFactory.getControl(e, bt, !1), u(bt, et, gt, ri, fu); else if (di.equals(su)) bt = e.getField("C_SalesRegion_ID"), ot = n.VControlFactory.getControl(e, bt, !1), u(bt, ot, gt, ri, su); else if (di.equals(uu)) bt = e.getField("AD_OrgTrx_ID"), st = n.VControlFactory.getControl(e, bt, !1), u(bt, st, gt, ri, uu); else if (di.equals(dr)) bt = e.getField("C_Activity_ID"), ht = n.VControlFactory.getControl(e, bt, !1), u(bt, ht, gt, ri, dr); else if (di.equals(hu)) bt = e.getField("User1_ID"), ct = n.VControlFactory.getControl(e, bt, !1), u(bt, ct, gt, ri, hu); else if (di.equals(cu)) bt = e.getField("User2_ID"), lt = n.VControlFactory.getControl(e, bt, !1), u(bt, lt, gt, ri, cu); else if (di.equals(si)) if (bt = e.getField("UserElement1_ID"), i.Elements[kt].AD_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); h = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, h, gt, ri, si); h.fireValueChanged = lu; function lu() { gi = h.getValue(); sr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), h = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, h, gt, ri, si), sr = !1; else continue; else if (di.equals(hi)) if (bt = e.getField("UserElement2_ID"), i.Elements[kt].AD_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); c = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, c, gt, ri, hi); c.fireValueChanged = lu; function lu() { nr = c.getValue(); hr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), c = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, c, gt, ri, hi), hr = !1; else continue; else if (di.equals(ci)) if (bt = e.getField("UserElement3_ID"), i.Elements[kt].AD_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); l = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, l, gt, ri, ci); l.fireValueChanged = lu; function lu() { tr = l.getValue(); cr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), l = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, l, gt, ri, ci), cr = !1; else continue; else if (di.equals(li)) if (bt = e.getField("UserElement4_ID"), i.Elements[kt].AD_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); a = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, a, gt, ri, li); a.fireValueChanged = lu; function lu() { ir = a.getValue(); lr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), a = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, a, gt, ri, li), lr = !1; else continue; else if (di.equals(ai)) if (bt = e.getField("UserElement5_ID"), i.Elements[kt].AD_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); v = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, v, gt, ri, ai); v.fireValueChanged = lu; function lu() { rr = v.getValue(); ar = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), v = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, v, gt, ri, ai), ar = !1; else continue; else if (di.equals(vi)) if (bt = e.getField("UserElement6_ID"), i.Elements[kt].AD_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); y = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, y, gt, ri, vi); y.fireValueChanged = lu; function lu() { ur = y.getValue(); vr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), y = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, y, gt, ri, vi), vr = !1; else continue; else if (di.equals(yi)) if (bt = e.getField("UserElement7_ID"), i.Elements[kt].AD_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); p = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, p, gt, ri, yi); p.fireValueChanged = lu; function lu() { fr = p.getValue(); yr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), p = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, p, gt, ri, yi), yr = !1; else continue; else if (di.equals(pi)) if (bt = e.getField("UserElement8_ID"), i.Elements[kt].AD_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); w = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, w, gt, ri, pi); w.fireValueChanged = lu; function lu() { er = w.getValue(); pr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), w = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, w, gt, ri, pi), pr = !1; else continue; else if (di.equals(wi)) if (bt = e.getField("UserElement9_ID"), i.Elements[kt].AD_Column_ID > 0) if (ui = "VIS_125", ni = [], ni[0] = new n.DB.SqlParam("@AD_Column_ID", i.Elements[kt].AD_Column_ID), ti = vt(ui, ni), br) { fi = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.Search); b = new n.Controls.VTextBoxButton(ti, gt, !1, !0, n.DisplayType.Search, fi); u(bt, b, gt, ri, wi); b.fireValueChanged = lu; function lu() { or = b.getValue(); wr = !0 } } else ei = n.MLookupFactory.getMLookUp(n.Env.getCtx(), o, i.Elements[kt].AD_Column_ID, n.DisplayType.TableDir), b = new n.Controls.VComboBox(ti, !1, !1, !0, ei, 150, n.DisplayType.TableDir, 0), u(bt, b, gt, ri, wi), wr = !1; else continue } pt.css("display", "none"); bi.html(dt); ii = new n.Query; ii.addRestriction("C_AcctSchema_ID", n.Query.prototype.EQUAL, at); ui = "VIS_126"; ni = []; ni[0] = new n.DB.SqlParam("@tblID_s", f); gu = vt(ui, ni); gu == "GL_JournalLine" && ii.addRestriction("IsFullyQualified", n.Query.prototype.EQUAL, "Y"); oi.C_ValidCombination_ID == 0 ? e.setQuery(n.Query.prototype.getEqualQuery("1", "2")) : (au = new n.Query, au.addRestriction("C_AcctSchema_ID", n.Query.prototype.EQUAL, at), au.addRestriction("C_ValidCombination_ID", n.Query.prototype.EQUAL, oi.C_ValidCombination_ID), e.setQuery(au)); yt.query(0, 0, !1); vu.text(i.Description); yu = dt.find('[name="AD_Org_ID"]'); window.setTimeout(function () { var r; ki.css("width", "73%"); bi.parent().css({ width: "27%", padding: "0 10px 0 0" }); var u = t(dt.find("button").parent().find("input")[0]).width(), i = []; if (i[0] = new n.DB.SqlParam("@tblID_s", f), r = vt("VIS_126", i), r == "GL_JournalLine") yu.on("click", function () { yu.find("option[value=0]").length != 0 && yu.find("option[value=0]").remove() }) }, 200) } }) } function u(i, r, u, f, e) { var l, c, h, o; s.log.fine("Field=" + i); bt = t("<tr>"); dt.append(bt); l = n.VControlFactory.getLabel(i); r.setReadOnly(!1); r.setMandatory(u); i.setPropertyChangeListener(r); c = t("<td>"); bt.append(c.css("padding", "4px 0px 2px 0px")); c.append(l.getControl().addClass("VIS_Pref_Label_Font")); e != undefined && (e == "X1" || e == "X2" || e == "X3" || e == "X4" || e == "X5" || e == "X6" || e == "X7" || e == "X8" || e == "X9") && c.find("label").text(f); bt = t("<tr>"); dt.append(bt); h = t("<td>"); r.getBtnCount() >= 2 ? (bt.append(h), o = t("<Div class='vis-act-frm-parm'>"), h.append(o), window.innerHeight > 700 ? (o.append(r.getControl().css("width", "85%")), o.append(r.getBtn(0))) : (o.append(r.getControl().css("width", "85%")), o.append(r.getBtn(0).css("width", "30px").css("-webkit-appearance", "none").css("height", "30px").css("padding", "0px").css("border-color", "#BBBBBB")))) : (bt.append(h), h.append(r.getControl().css("width", "100%"))) } function r(n) { return n == null || n == 0 ? !0 : !1 } function wu() { if (au = e.getValue("C_ValidCombination_ID"), s.onClose) s.onClose(au); i.dialog("close") } function ti(t) { var i = null, u; i = ii != null ? jQuery.extend(!0, {}, ii) : new n.Query; t && k != null && k.getValue().toString().length > 0 && (u = k.getValue().toString().toUpperCase(), u.endsWith("%") || (u += "%"), i.addRestriction("UPPER(Alias)", i.LIKE, u)); t && wt.getValue().toString().length > 0 && (u = wt.getValue().toString().toUpperCase(), u.endsWith("%") || (u += "%"), i.addRestriction("UPPER(Combination)", i.LIKE, u)); d != null && d.getValue() != null && i.addRestriction("AD_Org_ID", i.EQUAL, n.Utility.Util.getValueOfInt(d.getValue())); nt == null || r(nt.getValue()) || i.addRestriction("Account_ID", i.EQUAL, n.Utility.Util.getValueOfInt(nt.getValue())); tt == null || r(tt.getValue()) || i.addRestriction("C_SubAcct_ID", i.EQUAL, n.Utility.Util.getValueOfInt(tt.getValue())); g == null || r(g.getValue()) || i.addRestriction("M_Product_ID", i.EQUAL, n.Utility.Util.getValueOfInt(g.getValue())); it == null || r(it.getValue()) || i.addRestriction("C_BPartner_ID", i.EQUAL, n.Utility.Util.getValueOfInt(it.getValue())); rt == null || r(rt.getValue()) || i.addRestriction("C_Campaign_ID", i.EQUAL, n.Utility.Util.getValueOfInt(rt.getValue())); ut == null || r(ut.getValue()) || i.addRestriction("C_LocFrom_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ut.getValue())); ft == null || r(ft.getValue()) || i.addRestriction("C_LocTo_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ft.getValue())); et == null || r(et.getValue()) || i.addRestriction("C_Project_ID", i.EQUAL, n.Utility.Util.getValueOfInt(et.getValue())); ot == null || r(ot.getValue()) || i.addRestriction("C_SalesRegion_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ot.getValue())); st == null || r(st.getValue()) || i.addRestriction("AD_OrgTrx_ID", i.EQUAL, n.Utility.Util.getValueOfInt(st.getValue())); ht == null || r(ht.getValue()) || i.addRestriction("C_Activity_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ht.getValue())); ct == null || r(ct.getValue()) || i.addRestriction("User1_ID", i.EQUAL, n.Utility.Util.getValueOfInt(ct.getValue())); lt == null || r(lt.getValue()) || i.addRestriction("User2_ID", i.EQUAL, n.Utility.Util.getValueOfInt(lt.getValue())); h == null || r(h.getValue()) || i.addRestriction("UserElement1_ID", i.EQUAL, n.Utility.Util.getValueOfInt(h.getValue())); c == null || r(c.getValue()) || i.addRestriction("UserElement2_ID", i.EQUAL, n.Utility.Util.getValueOfInt(c.getValue())); l == null || r(l.getValue()) || i.addRestriction("UserElement3_ID", i.EQUAL, n.Utility.Util.getValueOfInt(l.getValue())); a == null || r(a.getValue()) || i.addRestriction("UserElement4_ID", i.EQUAL, n.Utility.Util.getValueOfInt(a.getValue())); v == null || r(v.getValue()) || i.addRestriction("UserElement5_ID", i.EQUAL, n.Utility.Util.getValueOfInt(v.getValue())); y == null || r(y.getValue()) || i.addRestriction("UserElement6_ID", i.EQUAL, n.Utility.Util.getValueOfInt(y.getValue())); p == null || r(p.getValue()) || i.addRestriction("UserElement7_ID", i.EQUAL, n.Utility.Util.getValueOfInt(p.getValue())); w == null || r(w.getValue()) || i.addRestriction("UserElement8_ID", i.EQUAL, n.Utility.Util.getValueOfInt(w.getValue())); b == null || r(b.getValue()) || i.addRestriction("UserElement9_ID", i.EQUAL, n.Utility.Util.getValueOfInt(b.getValue())); e.setQuery(i); yt.query(0, 0, !1) } function bu() { k != null && k.setValue(""); wt.setValue(""); di.Content = ""; di.Visible = !1; pt.val(""); d.setValue(null); nt.setValue(null); tt != null && tt.setValue(null); g != null && g.setValue(null); it != null && it.setValue(null); rt != null && rt.setValue(null); ut != null && ut.setValue(null); ft != null && ft.setValue(null); et != null && et.setValue(null); ot != null && ot.setValue(null); st != null && st.setValue(null); ht != null && ht.setValue(null); ct != null && ct.setValue(null); lt != null && lt.setValue(null); h != null && h.setValue(null); c != null && c.setValue(null); l != null && l.setValue(null); a != null && a.setValue(null); v != null && v.setValue(null); y != null && y.setValue(null); p != null && p.setValue(null); w != null && w.setValue(null); b != null && b.setValue(null) } function nf() { var o = null, u = "", ui = null, fi, br, yt, vt, si, hi, ci, li, ai, vi, yi, pi, wi, bi, ki, di, pt, wt, bt, dt, gt, ni, ti, ii, ri, kr, dr; for (kt.IsHasAlies && (ui = k.getValue(), ui == null && o != null && (o = o.concat(n.Msg.translate(n.Env.getCtx(), "Alias")).concat(", "))), fi = [], vt = 0; vt < kt.Elements.length; vt++)br = kt.Elements[vt], fi.push(br.Name); if (t.ajax({ url: n.Application.contextUrl + "Form/GetValidCombination", dataType: "json", type: "POST", async: !1, data: { accountSchemaElements: JSON.stringify(kt), Elements: JSON.stringify(kt.Elements), aseList: JSON.stringify(fi), value: ui, strinB: o }, success: function (n) { u = n }, error: function (n) { console.log(n) } }), o != null) { n.ADialog.info("FillMandatory", !0, o.ToString().Substring(0, o.Length - 2), null); return } if (d == null || d.getValue() == null) { n.ADialog.info("FillMandatory", !0, n.Msg.getElement(n.Env.getCtx(), "AD_Org_ID"), null); return } if (nt == null || r(nt.getValue())) { n.ADialog.info("FillMandatory", !0, n.Msg.getElement(n.Env.getCtx(), "Account_ID"), null); s.setBusy(!1); return } u = u.concat("AD_Client_ID=" + n.Env.getCtx().getAD_Client_ID() + " AND C_AcctSchema_ID=" + at); s.log.fine("Check = " + u.toString()); var gr = k.getValue().toString(), f = 0, e = null, oi = k.getValue().toString(), i = null; try { i = ef(u, null); i.read() && (f = i.tables[0].rows[0].cells.c_validcombination_id, e = i.tables[0].rows[0].cells.alias); i.close(); i = null } catch (nu) { f = 0; i != null && (i.close(), i = null) } if (s.log.fine("ID=" + f + ", Alias=" + e), e == null && (e = ""), f != 0 && kt.IsHasAlies && oi.equals(e)) { yt = []; oi.toString().length == 0 ? (u = "VIS_127", yt[0] = new n.DB.SqlParam("@IDvalue", f)) : (u = "VIS_128", yt[0] = new n.DB.SqlParam("@f_alies", oi), yt[1] = new n.DB.SqlParam("@IDvalue", f)); vt = 0; try { ff(u, yt) } catch (nu) { } } if (f != 0) { ei(f, at); return } s.log.config("New"); e = null; k != null && (e = k.getValue().toString()); si = 0; tt != null && tt.getValue() != null && (si = tt.getValue()); hi = 0; g == null || r(g.getValue()) || (hi = g.getValue()); ci = 0; it == null || r(it.getValue()) || (ci = it.getValue()); li = 0; st == null || r(st.getValue()) || (li = st.getValue()); ai = 0; ut == null || r(ut.getValue()) || (ai = ut.getValue()); vi = 0; ft == null || r(ft.getValue()) || (vi = ft.getValue()); yi = 0; ot == null || r(ot.getValue()) || (yi = ot.getValue()); pi = 0; et == null || r(et.getValue()) || (pi = et.getValue()); wi = 0; rt == null || r(rt.getValue()) || (wi = rt.getValue()); bi = 0; ht == null || r(ht.getValue()) || (bi = ht.getValue()); ki = 0; ct == null || r(ct.getValue()) || (ki = ct.getValue()); di = 0; lt == null || r(lt.getValue()) || (di = lt.getValue()); pt = 0; h == null || r(h.getValue()) || (pt = h.getValue()); wt = 0; c == null || r(c.getValue()) || (wt = c.getValue()); bt = 0; l == null || r(l.getValue()) || (bt = l.getValue()); dt = 0; a == null || r(a.getValue()) || (dt = a.getValue()); gt = 0; v == null || r(v.getValue()) || (gt = v.getValue()); ni = 0; y == null || r(y.getValue()) || (ni = y.getValue()); ti = 0; p == null || r(p.getValue()) || (ti = p.getValue()); ii = 0; w == null || r(w.getValue()) || (ii = w.getValue()); ri = 0; b == null || r(b.getValue()) || (ri = b.getValue()); kr = d.getValue(); dr = nt.getValue(); sr && gi != null && (pt = gi); hr && nr != null && (wt = nr); cr && tr != null && (bt = tr); lr && ir != null && (dt = ir); ar && rr != null && (gt = rr); vr && ur != null && (ni = ur); yr && fr != null && (ti = fr); pr && er != null && (ii = er); wr && or != null && (ri = or); t.ajax({ url: n.Application.contextUrl + "AccountForm/Save", dataType: "json", data: { AD_Client_ID: n.Env.getCtx().getAD_Client_ID(), AD_Org_ID: kr, C_AcctSchema_ID: at, AD_Account_ID: dr, C_SubAcct_ID: si, M_Product_ID: hi, C_BPartner_ID: ci, AD_OrgTrx_ID: li, C_LocFrom_ID: ai, C_LocTo_ID: vi, C_SRegion_ID: yi, C_Project_ID: pi, C_Campaign_ID: wi, C_Activity_ID: bi, User1_ID: ki, User2_ID: di, UserElement1_ID: pt, UserElement2_ID: wt, UserElement3_ID: bt, UserElement4_ID: dt, UserElement5_ID: gt, UserElement6_ID: ni, UserElement7_ID: ti, UserElement8_ID: ii, UserElement9_ID: ri, Alias: e }, success: function (n) { returnValue = n.result; ei(returnValue.C_ValidCombination_ID, returnValue.C_AcctSchema_ID) } }) } function ei(t, i) { var r = null, u; try { u = []; u[0] = new n.DB.SqlParam("@C_ValidCombination_ID", t); u[1] = new n.DB.SqlParam("@C_AcctSchema_ID", i); r = uf("VIS_124", u); r.read() && (k != null && k.setValue(r.getString("Alias")), wt != null && wt.setValue(r.getString("Combination")), d != null && d.setValue(r.getInt("AD_Org_ID")), nt != null && nt.setValue(r.getInt("Account_ID")), tt != null && tt.setValue(r.getInt("C_SubAcct_ID")), g != null && r.getInt("M_Product_ID") != 0 && g.setValue(r.getInt("M_Product_ID")), it != null && r.getInt("C_BPartner_ID") != 0 && it.setValue(r.getInt("C_BPartner_ID")), rt != null && rt.setValue(r.getInt("C_Campaign_ID")), ut != null && ut.setValue(r.getInt("C_LocFrom_ID")), ft != null && ft.setValue(r.getInt("C_LocTo_ID")), et != null && et.setValue(r.getInt("C_Project_ID")), ot != null && ot.setValue(r.getInt("C_SalesRegion_ID")), st != null && st.setValue(r.getInt("AD_OrgTrx_ID")), ht != null && ht.setValue(r.getInt("C_Activity_ID")), ct != null && ct.setValue(r.getInt("User1_ID")), lt != null && lt.setValue(r.getInt("User2_ID")), h != null && r.getInt("UserElement1_ID") != 0 && h.setValue(r.getInt("UserElement1_ID")), c != null && r.getInt("UserElement2_ID") != 0 && c.setValue(r.getInt("UserElement2_ID")), l != null && r.getInt("UserElement3_ID") != 0 && l.setValue(r.getInt("UserElement3_ID")), a != null && r.getInt("UserElement4_ID") != 0 && a.setValue(r.getInt("UserElement4_ID")), v != null && r.getInt("UserElement5_ID") != 0 && v.setValue(r.getInt("UserElement5_ID")), y != null && r.getInt("UserElement6_ID") != 0 && y.setValue(r.getInt("UserElement6_ID")), p != null && r.getInt("UserElement7_ID") != 0 && p.setValue(r.getInt("UserElement7_ID")), w != null && r.getInt("UserElement8_ID") != 0 && w.setValue(r.getInt("UserElement8_ID")), b != null && r.getInt("UserElement9_ID") != 0 && b.setValue(r.getInt("UserElement9_ID")), pt != null && pt.text(r.getString("Description"))); r.close(); r = null } catch (f) { r != null && (r.close(), r = null) } ti(!1) } gt = i.find("#btnOk_" + o); ni = i.find("#btnCancel_" + o); ri = i.find("#btnRefresh_" + o); ui = i.find("#btnUndo_" + o); fi = i.find("#btnSave_" + o); lu = i.find("#lblParameter_" + o); bi = i.find("#parameterDiv_" + o); ku = i.find("#bottumDiv_" + o); du = i.find("#discriptionDiv_" + o); ki = i.find("#accDiv_" + o); gu = i.find("#acctbl_" + o); vu = i.find("#lblbottumMsg_" + o); yu = i.find("#lblCount_" + o); pt = i.find("#lblbottumMsg2_" + o); n.Application.isRTL && (gt.css("margin-right", "-128px"), ni.css("margin-right", "55px")); gt.val(n.Msg.getMsg("OK")); ni.val(n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Cancel"))); lu.val(n.Msg.getMsg("Parameter")); br(); gt.on("click", function () { s.setBusy(!0); wu(); s.setBusy(!1) }); ni.on("click", function () { i.dialog("close") }); ri.on("click", function () { s.setBusy(!0); ti(!0); s.setBusy(!1) }); ui.on("click", function () { bu() }); fi.on("click", function () { s.setBusy(!0); nf(); s.setBusy(!1) }) }; this.showDialog = function () { var n = t(window).width() - 50, i = t(window).height() - 60; ei.height(i); ei.width(n); ti.append(ei); ti.dialog({ modal: !1, resizable: !1, title: pu, width: n, height: i, position: { at: "center top", of: window }, close: function () { s.dispose(); ti.dialog("destroy"); ti = null; s = null } }) }; this.dataStatusChanged = function (n) { var t = e.getValue("Description"); wu = e.getValue("COMBINATION"); t != null && t.length > 0 ? pt.css("display", "inline-block") : pt.css("display", "none"); pt.text(t); yu.text(n.totalRecords) }; this.disposeComponent = function () { gt && gt.off("click"); ni && ni.off("click"); ri && ri.off("click"); ui && ui.off("click"); fi && fi.off("click"); pu = null; oi = null; at = null; o = null; wu = null; di = null; k = null; wt = null; d = null; nt = null; tt = null; g = null; it = null; rt = null; ut = null; ft = null; et = null; ot = null; st = null; ht = null; ct = null; lt = null; this.log = null; sf = null; kr = null; dr = null; gr = null; nu = null; tu = null; iu = null; ru = null; uu = null; fu = null; eu = null; ou = null; su = null; hu = null; cu = null; si = null; hi = null; ci = null; li = null; ai = null; vi = null; yi = null; pi = null; wi = null; dt = null; bt = null; gt = null; ni = null; ri = null; ui = null; fi = null; lu = null; bi = null; ku = null; du = null; ki = null; gu = null; yt = null; hf = !1; au = null; ii = null; e = null; vu = null; yu = null; pt = null; kt = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.AccountForm = i }(VIS, jQuery), function (n, t) { function i() { function di() { var d, wt, e, r; h = t("<label id='lblReportQ_" + i.windowNo + "' class='vis-ec-col-lblchkbox'><input id='chkReportQ_" + i.windowNo + "' type='checkbox' style='margin-left: 0px;' class='VIS_Pref_automatic'>" + n.Msg.translate(n.Env.getCtx(), "IsReport") + "<\/label>"); bt = new n.Controls.VLabel; y = new n.Controls.VLabel; kt = new n.Controls.VLabel; dt = new n.Controls.VLabel; gt = new n.Controls.VLabel; ni = new n.Controls.VLabel; ti = new n.Controls.VLabel; ii = new n.Controls.VLabel; d = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 0, n.DisplayType.Search, "C_BPartner_ID", 0, !1, null); ft = new n.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, n.DisplayType.Search, d); p = new n.Controls.VComboBox("", !1, !1, !0); o = new n.Controls.VComboBox("", !1, !1, !0); et = new n.Controls.VTextBox("NameQ", !1, !1, !0, 50, 50, "NameQ"); ot = new n.Controls.VTextBox("DescriptionQ", !1, !1, !0, 50, 50, "DescriptionQ"); st = new n.Controls.VTextBox("CommentQ", !1, !1, !0, 50, 50, "CommentQ"); et.getControl().val("%%"); ot.getControl().val("%%"); st.getControl().val("%%"); w = new n.Controls.VComboBox("", !1, !1, !0); ri = t("<input id='dtpCreatedFromQ_" + i.windowNo + "' type='date'>"); ui = t("<input id='dtpCreatedToQ_" + i.windowNo + "' type='date'>"); fi = new n.Controls.VLabel; ei = new n.Controls.VLabel; oi = new n.Controls.VLabel; si = new n.Controls.VLabel; hi = new n.Controls.VLabel; ht = new n.Controls.VTextBox("CreatedBy", !1, !0, !0, 50, 50, "CreatedBy"); g = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 50, "Name"); nt = new n.Controls.VTextBox("Description", !1, !1, !0, 50, 50, "Description"); tt = new n.Controls.VTextArea("Comment", !1, !1, !0, 200, 200); ct = t("<input id='dtpCreatedOn_" + i.windowNo + "' readonly class='vis-gc-vpanel-table-readOnly'>"); lt = new n.Controls.VLabel; s = t("<input id='btnOk_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' style=' margin-top: 0px; margin-right: 0px;' type='button' value='Ok'>"); it = t("<input id='btnSave_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin-top: 0px;float: right;' type='button' value='Save'>"); at = t("<input id='btnNext_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin: 10px; display: none;'  type='button' value='>>'>"); vt = t("<input id='btnPre_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin: 10px; display: none;' type='button' value='<<'>"); it.val(n.Msg.getMsg("Save")); s.val(n.Msg.getMsg("OK")); wt = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; f = t("<div class='vis-archive-left-sidebar' id='topLeftDiv_" + i.windowNo + "'><div id='topToggalDiv_" + i.windowNo + "' class='vis-archive-l-s-head'><button id='btnToggal_" + i.windowNo + "' class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>"); this.btnToggal = f.find("#btnToggal_" + i.windowNo); u = t("<div class='vis-archive-l-s-content vis-leftsidebarouterwrap' id='topleftparaDiv_" + i.windowNo + "'>"); ci = t("<div  class='vis-archive-l-s-content-inner' id='topleftInnerParaDiv_" + i.windowNo + "'>"); u.append(ci); f.append(u); f.css("width", l); var b = t("<table style='width: 100%' class='vis-formouterwrpdiv'>"), v = t("<tr>"), a = t("<td style='padding: 0px 10px 0px;'>"), e = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); ci.append(b); b.append(v); v.append(a); a.append(e); e.append(r); r.append(h); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); var e = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'), rt = t('<div class="input-group-append">'); b.append(v); v.append(a); a.append(e); e.append(r); e.append(rt); r.append(ft.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ").addClass("VIS-Search-hide")); rt.append(ft.getBtn(0).addClass("VIS-Search-hide")); r.append(bt.getControl().addClass("VIS-Search-hide").addClass("VIS_Pref_Label_Font")); r.append(o.getControl()); r.append(y.getControl().addClass("VIS_Pref_Label_Font")); y.getControl().hide(); o.getControl().hide(); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(p.getControl()); r.append(kt.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(et.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(dt.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(ot.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(gt.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(st.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(ni.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(w.getControl()); r.append(ti.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(ri); r.append(ii.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td style='padding: 0px 10px 0px;'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(ui); li = t("<div class='vis-frm-bot-btn-wrp' id='leftBottomDiv_" + i.windowNo + "'>"); f.append(li); li.append(s); c = t("<div id='topRightDiv_" + i.windowNo + "' class='vis-frm-grid-wrap'>"); yt = t("<div id='rightTopDiv_" + i.windowNo + "' style='float: left; width: 100%; height: 55%;'>"); pt = t("<div id='rightBottomDiv_" + i.windowNo + "' style='float: left; width: 100%;margin-top: 5px; margin-bottom: 10px; '>"); yt.css("height", "calc(100% - 274px)"); pt.css("height", ki); b = t("<table style='width: 100%; ' class='vis-formouterwrpdiv'>"); v = t("<tr>"); a = t("<td colspan='4' style='text-align: right; height: 10px;'>"); pt.append(b); b.append(v); v.append(a); a.append(vt).append(lt.getControl().css("display", "inline-block").css("margin-top", "20px").css("margin-right", "10px").css("margin-left", "10px").addClass("VIS_Pref_Label_Font")).append(at); lt.getControl().css("display", "none"); v = t("<tr>"); a = t("<td colspan='2' class='VIS-archive-table-padding'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(ht.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(fi.getControl().addClass("VIS_Pref_Label_Font")); a = t("<td colspan='2' class='VIS-archive-table-padding'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(ct.addClass("VIS_Pref_Label_Font")); r.append(ei.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td colspan='2' class='VIS-archive-table-padding'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(g.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(oi.getControl().addClass("VIS_Pref_Label_Font")); a = t("<td colspan='2' class='VIS-archive-table-padding'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(nt.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(si.getControl().addClass("VIS_Pref_Label_Font")); v = t("<tr>"); a = t("<td colspan='4' class='VIS-archive-table-padding'>"); e = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); b.append(v); v.append(a); a.append(e); e.append(r); r.append(tt.getControl().attr("data-placeholder", "").attr("placeholder", " ").addClass("VIS_Pref_Label_Font")); r.append(hi.getControl().addClass("VIS_Pref_Label_Font")); ai = t("<div style='float: left; width: 100%;height: 40px;position: relative;' id='rightBottomSaveDiv_" + i.windowNo + "'>"); ai.append(it); c.append(yt).append(pt).append(ai); ut.append(k); ut.append(f).append(c) } function gi() { y.getControl().text(n.Msg.translate(n.Env.getCtx(), "AD_Process_ID")); kt.getControl().text(n.Msg.translate(n.Env.getCtx(), "AD_Table_ID")); bt.getControl().text(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); dt.getControl().text(n.Msg.translate(n.Env.getCtx(), "Name")); gt.getControl().text(n.Msg.translate(n.Env.getCtx(), "Description")); ni.getControl().text(n.Msg.translate(n.Env.getCtx(), "Help")); ti.getControl().text(n.Msg.translate(n.Env.getCtx(), "CreatedBy")); ii.getControl().text(n.Msg.translate(n.Env.getCtx(), "Created")); fi.getControl().text(n.Msg.translate(n.Env.getCtx(), "CreatedBy")); ei.getControl().text(n.Msg.translate(n.Env.getCtx(), "Created")); oi.getControl().text(n.Msg.translate(n.Env.getCtx(), "Name")); si.getControl().text(n.Msg.translate(n.Env.getCtx(), "Description")); hi.getControl().text(n.Msg.translate(n.Env.getCtx(), "Help")); lt.getControl().text(n.Msg.translate(n.Env.getCtx(), "NoRecordFound")) } function nr() { for (var e = n.context.getAD_Role_ID(), i = !0, r = "SELECT DISTINCT p.AD_Process_ID, p.Name FROM AD_Process p INNER JOIN AD_Process_Access pa ON (p.AD_Process_ID=pa.AD_Process_ID) WHERE pa.AD_Role_ID=" + e + " AND p.IsReport='Y' AND p.IsActive='Y' AND pa.IsActive='Y' ORDER BY 2", t = n.DB.executeReader(r.toString(), null), u, f; t.read();)u = n.Utility.Util.getValueOfInt(t.getString(0)), f = n.Utility.encodeText(t.getString(1)), i && (o.getControl().append(" <option><\/option>"), i = !1), o.getControl().append(" <option value=" + u + ">" + f + "<\/option>"); for (t.close(), i = !0, o.getControl().prop("selectedIndex", 0), r = "SELECT DISTINCT t.AD_Table_ID, t.Name FROM AD_Table t INNER JOIN AD_Tab tab ON (tab.AD_Table_ID=t.AD_Table_ID) INNER JOIN AD_Window_Access wa ON (tab.AD_Window_ID=wa.AD_Window_ID) WHERE wa.AD_Role_ID=" + e + " AND t.IsActive='Y' AND tab.IsActive='Y' ORDER BY 2", t = n.DB.executeReader(r.toString(), null); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(0)), f = n.Utility.encodeText(t.getString(1)), i && (p.getControl().append(" <option><\/option>"), i = !1), p.getControl().append(" <option value=" + u + ">" + f + "<\/option>"); for (t.close(), i = !0, p.getControl().prop("selectedIndex", 0), r = "SELECT AD_User_ID, Name FROM AD_User u WHERE EXISTS (SELECT * FROM AD_User_Roles ur WHERE u.AD_User_ID=ur.AD_User_ID) ORDER BY 2", r = n.MRole.getDefault().addAccessSQL(r, "AD_User", n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RW), t = n.DB.executeReader(r.toString(), null); t.read();)u = n.Utility.Util.getValueOfInt(t.getString(0)), f = n.Utility.encodeText(t.getString(1)), i && (w.getControl().append(" <option><\/option>"), i = !1), w.getControl().append(" <option value=" + u + ">" + f + "<\/option>"); t.close(); i = !0; w.getControl().prop("selectedIndex", 0); a > 0 && (h.find("input").prop("checked", !0), wt()) } function wt() { var t = "", l = h.find("input").prop("checked"), b = null, u, y, r, e, f, s, c; b = n.MRole.getDefault(); try { if (!b.getIsCanReport()) { i.log.warning("User/Role cannot Report AD_User_ID=" + n.context.getAD_User_ID()); return } t = t.concat(" AND IsReport=").concat(l ? "'Y'" : "'N'"); l && (u = o.getControl().find("option:selected").val(), u != "" && u != null && (t = t.concat(" AND AD_Process_ID=").concat(u))); a > 0 ? (t = t.concat(" AND ((AD_Table_ID=").concat(a), v > 0 && (t = t.concat(" AND Record_ID=").concat(v)), t = t.concat(")"), a == X_C_BPartner.Table_ID && v > 0 && (t = t.concat(" OR C_BPartner_ID=").concat(v)), t = t.concat(")"), a = 0, v = 0) : (u = p.getControl().find("option:selected").val(), u != "" && u != null && (t = t.concat(" AND AD_Table_ID=").concat(u))); l || (y = ft.getValue(), t = y != null ? t.concat(" AND C_BPartner_ID=").concat(y) : t.concat(" AND C_BPartner_ID IS NOT NULL")); r = et.getControl().val(); r != null && r != "%%" && r.length > 0 && (t = r.indexOf("%") != -1 || r.indexOf("_") != -1 ? t.concat(" AND LOWER(Name) LIKE LOWER( ").concat("'").concat(r).concat("')") : t.concat(" AND LOWER(Name)= LOWER(").concat("'").concat(r).concat("')")); r = ot.getControl().val(); r != null && r != "%%" && r.length > 0 && (t = r.indexOf("%") != -1 || r.indexOf("_") != -1 ? t.concat(" AND LOWER(Description) LIKE LOWER( ").concat("'").concat(r).concat("')") : t.concat(" AND LOWER(Description)= LOWER(").concat("'").concat(r).concat("')")); r = st.getControl().val(); r != null && r != "%%" && r.length > 0 && (t = r.indexOf("%") != -1 || r.indexOf("_") != -1 ? t.concat(" AND LOWER(Help) LIKE LOWER( ").concat("'").concat(r).concat("')") : t.concat(" AND LOWER(Help)= LOWER(").concat("'").concat(r).concat("')")); e = w.getControl().find("option:selected").val(); e != null && e > 0 && (t = t.concat(" AND CreatedBy=").concat(e)); f = ri.val(); f != "" && (t = t.concat(" AND ").concat("TRUNC(").concat("Created,'DD') >= ").concat(n.DB.to_date(f))); f = ui.val(); f != "" && (t = t.concat(" AND ").concat("TRUNC(").concat("Created,'DD') <= ").concat(n.DB.to_date(f))); i.log.fine(t.toString()); t = t.concat(" AND (AD_Process_ID IS NULL OR AD_Process_ID IN (SELECT AD_Process_ID FROM AD_Process_Access WHERE AD_Role_ID=").concat(n.context.getAD_Role_ID()).concat("))"); t = t.concat(" AND (AD_Table_ID IS NULL OR (AD_Table_ID IS NOT NULL AND AD_Process_ID IS NOT NULL) OR AD_Table_ID IN (SELECT t.AD_Table_ID FROM AD_Tab t INNER JOIN AD_Window_Access wa ON (t.AD_Window_ID=wa.AD_Window_ID) WHERE wa.AD_Role_ID=").concat(n.context.getAD_Role_ID()).concat("))"); i.log.finest(t.toString()) } catch (k) { } s = t; c = "SELECT AD_ARCHIVE_ID,AD_CLIENT_ID,AD_ORG_ID,AD_PROCESS_ID,AD_TABLE_ID,C_BPARTNER_ID,CREATED,CREATEDBY,DESCRIPTION,HELP, ISACTIVE,ISREPORT,NAME,RECORD_ID,UPDATED,UPDATEDBY,EXPORT_ID FROM AD_Archive WHERE AD_Client_ID=" + n.Env.getCtx().getAD_Client_ID(); s != null && s.length > 0 && (c += s); c += " ORDER BY Created desc"; fr(c) } function pi(n, t) { return n == null ? t == null : t == null ? !1 : n.equals(t) } function tr() { var u; if (!(r.getSelection().length < 0)) { var f = g.getControl().val(), e = nt.getControl().val(), o = tt.getControl().val(), i = Number(r.getSelection().toString()); r.get(i) != null && (u = !1, pi(f, r.get(i).NAME) || f != null && f.length > 0 && (u = !0), pi(e, r.get(i).DESCRIPTION) || (u = !0), pi(o, r.get(i).HELP) || (u = !0), d = r.get(i).AD_ARCHIVE_ID, u && t.ajax({ url: n.Application.contextUrl + "Common/UpdateArchive", dataType: "json", data: { name: f, des: e, help: o, archiveId: d }, success: function (n) { n.result && wt() } })) } } function wi(u) { r != null && (r.destroy(), r = null); e.length == 0 && (e.push({ field: "NAME", caption: n.Msg.translate(n.Env.getCtx(), "NAME"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "DESCRIPTION", caption: n.Msg.translate(n.Env.getCtx(), "DESCRIPTION"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "HELP", caption: n.Msg.getElement(n.Env.getCtx(), "HELP"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "CREATEDBY", caption: n.Msg.getElement(n.Env.getCtx(), "CREATEDBY"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "CREATED", caption: n.Msg.getElement(n.Env.getCtx(), "CREATED"), sortable: !0, size: "16%", min: 150, hidden: !1 }), e.push({ field: "View", caption: n.Msg.translate(n.Env.getCtx(), "View"), sortable: !0, size: "80px", min: 150, hidden: !1, render: function () { return '<div><i class="vis vis-download" title="View record" style="opacity: 1; font-size: 1rem"><\/i><\/div>' } }), e.push({ field: "AD_ARCHIVE_ID", caption: n.Msg.translate(n.Env.getCtx(), "AD_ARCHIVE_ID"), hidden: !0 })); setTimeout(10); w2utils.encodeTags(u); r = t(yt).w2grid({ name: "gridArchive" + i.windowNo, recordHeight: 40, columns: e, records: u, onClick: function (n) { n.column == 5 && r.records.length > 0 && ir(n.recid); rr(n.recid) } }) } function ir(i) { d = r.get(i).AD_ARCHIVE_ID; t.ajax({ url: n.Application.contextUrl + "Common/DownloadPdf", dataType: "json", data: { archiveId: d }, success: function (t) { t.result != null && (t.result.indexOf("TempDownload") > -1 ? window.open(n.Application.contextUrl + t.result) : window.open("data:application/pdf;base64, " + t.result)) } }) } function rr(n) { g.getControl().val(r.get(n).NAME); nt.getControl().val(r.get(n).DESCRIPTION); tt.getControl().val(r.get(n).HELP); ht.getControl().val(r.get(n).CREATEDBY); r.get(n).CREATED != null && ct.val(r.get(n).CREATED); d = r.get(n).AD_ARCHIVE_ID } function ur(t) { var r = "", u = "SELECT Name FROM AD_User WHERE AD_User_ID=" + t, i; try { i = n.DB.executeReader(u.toString(), null, null); i.read() && (r = i.getString("Name")); i.close() } catch (f) { } return r } function fr(t) { var u = [], i, f, r, e, o; try { for (i = n.DB.executeReader(t.toString(), null, null), f = 1; i.read();)r = {}, r.NAME = i.getString("NAME"), r.DESCRIPTION = i.getString("DESCRIPTION"), r.HELP = i.getString("HELP"), r.CREATEDBY = ur(i.getString("CREATEDBY")), e = i.getString("CREATED"), o = new Date(e), CreatedOn = o.toLocaleDateString(), r.CREATED = CreatedOn, r.AD_ARCHIVE_ID = i.getInt("AD_ARCHIVE_ID"), r.recid = f, f++, u.push(r); i.close() } catch (s) { } return wi(u), u } function er() { g.getControl().val(""); nt.getControl().val(""); tt.getControl().val(""); ht.getControl().val(""); ct.val(null) } function or() { if (s != null) s.on(n.Events.onTouchStartOrClick, function () { k[0].style.visibility = "visible"; wt(); er(); k[0].style.visibility = "hidden" }); if (it != null) it.on(n.Events.onTouchStartOrClick, function () { k[0].style.visibility = "visible"; tr(); k[0].style.visibility = "hidden" }); if (at != null) at.on(n.Events.onTouchStartOrClick, function () { alert("btnNext") }); if (vt != null) vt.on(n.Events.onTouchStartOrClick, function () { alert("btnPre") }); if (this.btnToggal != null) var i = 0; this.btnToggal.on(n.Events.onTouchStartOrClick, function () { rt ? (i = n.Application.isRTL ? 180 : 0, btnToggal.animate({ borderSpacing: i }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), rt = !1, f.animate({ width: l }, "slow"), u.animate({ width: l }, "slow"), u.find("table").css("display", "block"), s.css("display", "block"), c.animate({ width: vi }, "slow", null, function () { r.resize() })) : (i = n.Application.isRTL ? 0 : 180, btnToggal.animate({ borderSpacing: i }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), rt = !0, f.animate({ width: b }, "slow"), u.animate({ width: b }, "slow"), u.find("table").css("display", "none"), s.css("display", "none"), c.animate({ width: yi }, "slow", null, function () { r.resize() })) }); h.change(function () { o.getControl().hide(); y.getControl().hide(); t(".VIS-Search-hide").show(); h.find("input").prop("checked") && (o.getControl().show(), y.getControl().show(), t(".VIS-Search-hide").hide()) }) } this.log = n.Logging.VLogger.getVLogger("VIS.ArchiveViewer"); this.frame; this.windowNo; var a = 0, v = 0, i = this, rt = !1, ut = t("<div class='vis-forms-container' style='width: 100%; height: 100%; background-color: white;'>"), k = t('<div class="vis-busyindicatorouterwrap" style="visibility: hidden"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), e = [], r = null, d = 0, h = null, bt = null, y = null, kt = null, dt = null, gt = null, ni = null, ti = null, ii = null, ft = null, p = null, et = null, ot = null, st = null, w = null, o = null, ri = null, ui = null, fi = null, ei = null, oi = null, si = null, hi = null, g = null, nt = null, tt = null, ht = null, ct = null, lt = null, s = null, it = null, at = null, vt = null; this.btnToggal = null; var f = null, c = null, u = null, ci = null, li = null, yt = null, pt = null, ai = null, l = 260, b = 50, vi = t(window).width() - l, yi = t(window).width() - b, sr = t(window).height() - 193, bi = t(window).height() - 382, ki = t(window).height() - (bi + 55 + 118); this.sizeChanged = function (n, t) { vi = t - (l + 1); yi = t - (b + 1); rt == !0 ? (f.animate({ width: b }, "slow"), u.animate({ width: b }, "slow"), u.find("table").css("display", "none"), s.css("display", "none"), c.animate({ width: yi }, "slow", null, function () { r.resize() })) : (f.animate({ width: l }, "slow"), u.animate({ width: l }, "slow"), u.find("table").css("display", "block"), s.css("display", "block"), c.animate({ width: vi }, "slow", null, function () { r.resize() })) }; this.display = function () { wi() }; this.load = function () { di(); gi(); nr(); or() }; this.getRoot = function () { return ut }; this.disposeComponent = function () { ut = null } } n.Apps = n.Apps || {}; n.Apps.AForms = n.Apps.AForms || {}; i.prototype.sizeChanged = function () { }; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.load(); this.frame.getContentGrid().append(this.getRoot()); this.display() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.ArchiveViewer = i }(VIS, jQuery), function (n, t) { function i() { function l() { r.onClose && r.onClose(); r.dispose(); r = null } var i = t("<div><\/div>"), u = "Dialog", f = "auto", e = "auto", o = !0, s = !1, h = !0, c = { at: "center center", of: window }, r; this.onOkClick = null; this.onCancelClick = null; this.onClose = null; this.setTitle = function (n) { u = n }; this.setModal = function (n) { o = n }; this.changeTitle = function (n) { i.dialog("widget").find(".ui-dialog-title").text(n) }; this.setHeight = function (n) { f = n }; this.setWidth = function (n) { e = n }; this.setPosition = function (n) { c = n }; this.setEnableResize = function (n) { h = n }; r = this; this.setContent = function (n) { i.empty(); i.append(n) }; this.getRoot = function () { return i }; this.hidebuttons = function () { i.dialog("widget").find(".ui-dialog-buttonpane .ui-button").hide(); i.dialog("widget").find(".ui-widget-content").css("border", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("padding", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top", "0px"); i.dialog("widget").find(".ui-dialog .ui-dialog-buttonpane").hide() }; this.hideButtons = function () { i.dialog("widget").find(".ui-dialog-buttonpane .ui-button").hide(); i.dialog("widget").find(".ui-widget-content").css("border", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("padding", "0px"); i.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top", "0px"); i.dialog("widget").find(".ui-dialog .ui-dialog-buttonpane").hide() }; this.close = function () { i.dialog("close"); this.dispose() }; this.show = function () { var a = "", v = "margin-right:12px"; n.Application.isRTL && (a = "margin-right:7px;", v = ""); i.dialog({ height: f, width: e, title: u, modal: o, resizable: h, closeOnEscape: !s, closeText: n.Msg.getMsg("close"), position: c, buttons: [{ text: n.Msg.getMsg("Ok"), click: function (n) { var f = n.target, u; t(f).attr("disabled", !0); u = !0; r.onOkClick && (u = r.onOkClick(n)); u == !0 || u == undefined ? i != null && i.dialog("close") : t(f).attr("disabled", !1) }, style: v }, { text: n.Msg.getMsg("Cancel"), click: function () { r.onCancelClick && r.onCancelClick(); i && i.dialog("close") }, style: a }], close: l }); t(document).on("keydown", function (n) { if (event.altKey && event.keyCode == 37) return n.preventDefault(), !1; n.stopPropagation() }); return t(".ui-dialog .ui-dialog-buttonpane").css("border-width", "0 0 0"), s && t(".ui-dialog-titlebar-close").remove(), i }; this.dispose = function () { i != null && (i.dialog("destroy"), i.remove()); i = null; this.Show = null; this.setContent = null; this.setTitle = null } } n.ChildDialog = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function a() { } function v() { o.onOkClick = function (i) { var r = l.val(); if (t.trim(r) == "" || r == "" || r == null) return n.ADialog.info("EnterData"), i != undefined && i.preventDefault(), !1; s.prop.ChatText = r; n.dataContext.saveChat(s.prop) }; o.onCancelClick = function () { } } function y(i, r, u) { n.dataContext.getChatRecords(u, function (t) { var r = JSON.parse(t), s = "", u, o, e; for (u in r.subChat) { var c = new Date(r.subChat[u].ChatDate), h = c.toLocaleString(), f = '   <div class="vis-chatboxwrap">'; if (f += n.Application.isRTL ? '<div class="vis-chatimgwrap">' : '<div class="vis-chatimgwrap">', o = !1, r.subChat[u].AD_Image_ID == 0) f += "<i class='fa fa-user' data-uID='" + r.subChat[u].AD_User_ID + "'><\/i>", o = !0; else for (e in r.userimages) if (r.userimages[e].AD_Image_ID == r.subChat[u].AD_Image_ID && r.userimages[e].UserImg != "NoRecordFound" && r.userimages[e].UserImg != "FileDoesn'tExist") { f += '<img  data-uID="' + r.subChat[u].AD_User_ID + '" src="' + n.Application.contextUrl + r.userimages[e].UserImg + '" />'; o = !0; break } o == !1 && (f += "<i class='fa fa-user' data-uID='" + r.subChat[u].AD_User_ID + "'><\/i>"); f += '<\/div><div class="vis-chatdetailwrap"><div style="display: flex;">'; f += n.Application.isRTL ? '<span data-uID="' + r.subChat[u].AD_User_ID + '" class="vis-chatusername">' : '<span data-uID="' + r.subChat[u].AD_User_ID + '" class="vis-chatusername">'; f += n.Env.getCtx().getAD_User_ID() == r.subChat[u].AD_User_ID ? "Me" : r.subChat[u].UserName; f += n.Application.isRTL ? '<\/span><span style="font-size: .75rem; padding-right: 5px;">' + h + '<\/span><\/div><div  style="overflow:auto">' : '<\/span><span style="font-size: .75rem; padding-right: 5px;">' + h + "<\/span><\/div><div>"; f += n.Application.isRTL ? '<span style="font-size: .75rem;padding-right:5px">' + n.Utility.encodeText(r.subChat[u].ChatData) + "<\/span><\/div>" : '<span style="font-size: .75rem;padding-right:5px">' + n.Utility.encodeText(r.subChat[u].ChatData) + "<\/span><\/div>"; f += "<\/div>"; f += "            <\/div>  "; s += f } i.html(s) }); i.on("click", function (i) { var u, f; (t(i.target).is("span") || t(i.target).is("img")) && (u = t(i.target).data("uid"), u != undefined && u != null && u > 0 && (f = new n.ContactInfo(u, r), f.show(), o.close())) }) } var o, s; this.onClose = null; var h = t('<div class="vis-forms-container"><\/div>'), c = t('<div class="vis-chatdetailouterwrap"><\/div>'), l = t('<textarea  id="input-chat-new" class="vis-chat-msgbox"  maxlength="500" />'); h.append(c).append(l); this.winNo = e; o = null; this.prop = { WindowNo: e, ChatID: r, AD_Table_ID: u, Record_ID: i, Description: f, TrxName: null, ChatText: "", page: 0, pageSize: 10 }; y(c, e, this.prop); s = this; a(); this.show = function () { o = new n.ChildDialog; o.setContent(h); o.setHeight(450); o.setWidth(655); o.setTitle(n.Msg.getMsg("Chat")); o.setModal(!0); o.onClose = function () { s.onClose && s.onClose(); s.dispose() }; o.show(); v() }; this.dispose = function () { this.prop = null; c = null; h.remove(); h = null; o = null; s = null } } n.Chat = i }(VIS, jQuery), function (n, t) { function u() { t.ajax({ url: n.Application.contextUrl + "InfoMenu/LoadMenu", dataType: "json", error: function () { alert("No DATA") }, success: function (n) { var r = n.result, u, f; for (u in r) f = t("<li data-id='" + r[u].AD_InfoWindow_ID + "' >"), f.append(r[u].Name), i.append(f) } }) } var r = t("<div/>"), i; r.css("width", "100%"); r.css("height", "100%"); i = t("<ul class='vis-apanel-rb-ul'>"); i.css("width", "100%"); i.css("height", "100%"); r.append(i); i.on("click", "LI", function (i) { var r = t(i.target).data("id"), u = new n.InfoWindow(r, null, 0, null, null); u.show() }); u(); n.InfoMenu = { show: function (n) { n.w2overlay(r.clone(!0), { css: { height: "300px" } }) } } }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function fi() { var u, i, r, f; v.css("width", "100%"); v.css("height", "100%"); v.css("position", "relative"); ht = t("<div class='vis-info-l-s-wrap vis-leftsidebarouterwrap'>"); rt = t("<div>"); ht.append(rt); ut = t("<div class='vis-info-datasec'>"); tt = t("<div class='vis-info-btnsec'>"); it.append(ht); it.append(ut); it.append(tt); u = n.Msg.getMsg("Refresh"); u.indexOf("&") > -1 && (u = u.replace("&", "")); i = n.Msg.getMsg("Cancel"); i.indexOf("&") > -1 && (i = i.replace("&", "")); r = n.Msg.getMsg("Ok"); r.indexOf("&") > -1 && (r = r.replace("&", "")); ft = t("<div class='vis-info-btnswrap'>"); et = t("<button class='VIS_Pref_btn-2'>").append(i); ot = t("<button class='VIS_Pref_btn-2'>").append(r); f = t("<div class='vis-info-btnleft'>"); st = t("<button class='VIS_Pref_btn-2' style='margin-top: 10px;'>").append(t("<i class='vis vis-refresh'><\/i>")); lt = t('<div class="vis-info-pagingwrp">'); li(); lt.append(at); ft.append(et); ft.append(ot); f.append(st); tt.append(f); tt.append(lt); tt.append(ft); y = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); v.append(it); v.append(y) } function ei() { ot.on("click", function () { dt() }); st.on("click", function () { y[0].style.visibility = "visible"; f != null && f != undefined && f.length > 0 && (f = n.Env.parseContext(n.Env.getCtx(), u, f, !1, !1)); nt(!0, l.val()) }); et.on("click", function () { g.onClose != null && g.onClose(); ct() }); if (!n.Application.isMobile) v.on("keyup", function (t) { t.keyCode === 13 && (y[0].style.visibility = "visible", f != null && f != undefined && f.length > 0 && (f = n.Env.parseContext(n.Env.getCtx(), u, f, !1, !1)), nt(!0, l.val())) }) } function oi() { g.onClose != null && g.onClose(); ct() } function ci(n) { var i, t; if (e) if (n.index) t = w2ui[n.target].records[n.index][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1); else for (i = 0; i < w2ui[n.target].records.length; i++)t = w2ui[n.target].records[i][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1) } function li() { at = t('<ul class="vis-statusbar-ul">'); vt = t('<li class="flex-fill"><div class="vis-ad-w-p-s-result"><span><\/span><\/div><\/li>'); p = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="' + n.Msg.getMsg("FirstPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); w = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.getMsg("PageUp") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); l = t("<select>"); pt = t("<li>").append(l); b = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.getMsg("PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); k = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="' + n.Msg.getMsg("LastPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); wt = vt.find(".vis-ad-w-p-s-result").find("span"); at.append(vt).append(p).append(w).append(pt).append(b).append(k); ai() } function ai() { p.on("click", function () { t(this).css("opacity") == "1" && nt(!0, 1) }); w.on("click", function () { t(this).css("opacity") == "1" && nt(!0, parseInt(l.val()) - 1) }); b.on("click", function () { t(this).css("opacity") == "1" && nt(!0, parseInt(l.val()) + 1) }); k.on("click", function () { t(this).css("opacity") == "1" && nt(!0, parseInt(l.find("Option:last").val())) }); l.on("change", function () { nt(!0, l.val()) }) } function vi(n) { var i, o; if (l.empty(), n.TotalPage > 0) { for (i = 0; i < n.TotalPage; i++)l.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); l.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (b.css("opacity", "1"), k.css("opacity", "1")) : (b.css("opacity", "0.6"), k.css("opacity", "0.6")); n.CurrentPage > 1 ? (p.css("opacity", "1"), w.css("opacity", "1")) : (p.css("opacity", "0.6"), w.css("opacity", "0.6")); n.TotalPage == 1 && (p.css("opacity", "0.6"), w.css("opacity", "0.6"), b.css("opacity", "0.6"), k.css("opacity", "0.6")) } else p.css("opacity", "0.6"), w.css("opacity", "0.6"), b.css("opacity", "0.6"), k.css("opacity", "0.6"); var s = n.CurrentPage, e = n.PageSize, r = n.TotalRecords, u = (s - 1) * e, f = u + e; f > r && (f = r); r == 0 && (u -= 1); o = ri + " " + (u + 1) + "-" + f + " " + ui + " " + r; wt.text(o) } var kt, dt, ct; this.onClose = null; var v = t("<div class='vis-forms-container'>"), it = t("<div class='vis-info-subroot'>"), gt = !0, ni, ti, ii, ht, rt, ut, tt, y, ft, et, ot, st, d = null, h = null, o = null, yt = !1, s = []; this.keyCol = ""; this.windowNo = u; var g = this, c = [], a = null, lt, at, p, w, pt, b, k, l, vt, wt = null, ri = n.Msg.getMsg("ShowingResult"), ui = n.Msg.getMsg("of"); fi(); ei(); this.show = function () { var r = g; t.ajax({ url: n.Application.contextUrl + "InfoWindow/GetSearchColumn/?Ad_InfoWindow_ID=" + i, dataType: "json", error: function () { alert(n.Msg.getMsg("ERRORGettingSchema")); y[0].style.visibility = "hidden" }, success: function (t) { if (t.result == null || t.result.Schema == null) { alert(n.Msg.getMsg("ERRORGettingSchema")); return } if (h = t.result, o = h.Schema, o == null) { alert(n.Msg.getMsg("ERRORGettingSchema")); return } si(r) } }) }; var si = function (i) { var pt = null, e = null, it = t("<table>"), c, y, w, ft, ii, yt, p, a, ti, ot, st, ht; it.css("width", "100%"); var k = null, wt = 0, b = !1, kt = null, dt = null, ct = null; for (c in o) if (o[c].IsQueryCriteria) { b = !1; var gt = t("<td class='vis-gc-vpanel-table-td1'>"), ut = t('<div class="input-group vis-input-wrap">'), g = t('<div class="vis-control-wrap">'), tt = t('<div class="input-group-append">'); if (k = t("<tr>"), it.append(k), k.append(gt), gt.append(ut), ut.append(g), y = {}, kt = o[c].AD_Reference_ID, e = bt(o[c].AD_Reference_ID, o[c].ColumnName, o[c].Name, o[c].AD_Reference_Value_ID, o[c].lookup), y.Ctrl = e, o[c].SetValue != null) { if (w = !1, o[c].Condition != null) { for (var d = [], lt = [], ni = new n.StringTokenizer(o[c].Condition, "[]"); ni.hasMoreTokens();)ft = ni.nextToken(), ft.trim() != " & ".trim() ? (w = n.Evaluator.evaluateLogic(i, ft), d.push(w)) : lt.push(ft); d.length > 1 ? lt[0].trim().equals("&") ? w = d.indexOf(!1) > -1 ? !1 : !0 : lt[0].trim().equals("|") && d.indexOf(!0) > -1 && (w = !0) : d.length == 1 && d[0] == !0 && (w = !0) } else w = !0; w && (kt == n.DisplayType.YesNo ? o[c].SetValue.toUpperCase() == "Y" ? e.getControl().find("input").prop("checked", !0) : o[c].SetValue.toUpperCase() == "N" && e.getControl().find("input").prop("checked", !1) : o[c].SetValue.contains("@") ? (dt = o[c].SetValue.substring(1, o[c].SetValue.lastIndexOf("@")), ct = n.context.getWindowContext(u, dt, !1), ct.equals("") ? e.setValue(null) : e.setValue(ct)) : e.setValue(o[c].SetValue)) } if (y.AD_Reference_ID = o[c].AD_Reference_ID, y.ColumnName = o[c].SelectClause, y.SearchColumnName = y.ColumnName.toUpperCase().indexOf(" AS ") > -1 ? y.ColumnName.substring(0, y.ColumnName.toUpperCase().indexOf(" AS ")) : y.ColumnName, o[c].ISIDENTIFIER && r != null && e.setValue(r), ii = t("<td>"), p = e.getBtnCount(), p == 2 ? (b, g.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " ")), a = e.getBtn(0), a != null && (tt.append(a.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), a = e.getBtn(1), a != null && (tt.append(a.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), p = -1, e = null, ut.append(tt)) : p == 1 ? (b, g.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " ")), a = e.getBtn(0), a != null && (tt.append(a.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), p = -1, e = null, ut.append(tt)) : (b && e.getControl(), o[c].AD_Reference_ID == n.DisplayType.YesNo && e.getControl(), g.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " "))), o[c].IsRange) { y.IsRange = !0; var at = t('<div class="input-group vis-input-wrap">'), et = t('<div class="vis-control-wrap">'), vt = t('<div class="input-group-append">'); k = t("<tr>"); it.append(k); e = bt(o[c].AD_Reference_ID, o[c].ColumnName, o[c].Name); y.CtrlTo = e; yt = t("<td>"); k.append(yt); yt.append(at); at.append(et); p = e.getBtnCount(); p == 2 ? (b && e.getControl(), et.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " ")), a = e.getBtn(0), a != null && (vt.append(a.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), a = e.getBtn(1), a != null && (vt.append(a.css("class", "vis-controls-txtbtn-table-td2")), e.getControl().attr("data-hasbtn", " ")), p = -1, e = null, at.append(vt)) : (b && e.getControl(), o[c].AD_Reference_ID == n.DisplayType.YesNo ? e.getControl() : e.getControl(), et.append(e.getControl().attr("data-placeholder", "").attr("placeholder", " "))); et.append(new n.Controls.VLabel(n.Msg.getMsg("To"), o[c].ColumnName).getControl()) } else y.IsRange = !1; wt = wt + 1; s.push(y); o[c].AD_Reference_ID == n.DisplayType.YesNo || o[c].AD_Reference_ID == n.DisplayType.Button || o[c].AD_Reference_ID == n.DisplayType.Label ? b = !0 : (pt = new n.Controls.VLabel(o[c].Name, o[c].ColumnName), ti = pt.getControl(), g.append(ti)) } rt.append(it); ot = n.Msg.getMsg("Refresh"); ot.indexOf("&") > -1 && (ot = ot.replace("&", "")); st = n.Msg.getMsg("Cancel"); st.indexOf("&") > -1 && (st = st.replace("&", "")); ht = n.Msg.getMsg("Ok"); ht.indexOf("&") > -1 && (ht = ht.replace("&", "")); v.dialog({ width: 1020, height: 487, resizable: !1, title: h.WindowName, modal: !0, closeText: n.Msg.getMsg("close"), close: oi }); f != null && f != undefined && f.length > 0 && (f = n.Env.parseContext(n.Env.getCtx(), u, f, !1, !1)); nt(!0, l.val()) }, bt = function (t, i, r, f, e) { var o = null, y, c, p, l, e, w, a, b, k, d, g, nt, tt, s, v, it, rt, h; return t == n.DisplayType.Button ? (y = new n.Controls.VButton(i, !1, !1, !0, r, null, null, 0), o = y) : t == n.DisplayType.String ? (c = new n.Controls.VTextBox(i, !1, !1, !0, 50, 100, null, null, !1), o = c, c.click = function () { yt = !0 }) : t == n.DisplayType.YesNo ? (p = new n.Controls.VCheckBox(i, !1, !1, !0, r, null), o = p) : n.DisplayType.IsDate(t) ? (t == n.DisplayType.DateTime && (readOnly = !0), l = new n.Controls.VDate(i, !1, !1, !0, t, r), l.setName(i), o = l) : n.DisplayType.IsLookup(t) || n.DisplayType.ID == t ? (e = n.MLookupFactory.get(n.Env.getCtx(), u, 0, t, i, f, !1, null), t != n.DisplayType.Search && t != n.DisplayType.MultiKey ? (w = new n.Controls.VComboBox(i, !1, !1, !0, e, 50), o = w) : (t = n.DisplayType.Search, a = new n.Controls.VTextBoxButton(i, !1, !1, !0, t, e), a.getBtn(), o = a)) : t == n.DisplayType.Location ? (b = new n.Controls.VLocation(i, !1, !1, !0, t, null), o = b) : t == n.DisplayType.Locator ? (k = new n.Controls.VLocator(i, !1, !1, !0, t, e), o = k) : n.DisplayType.Text == t || n.DisplayType.TextLong == t ? (d = new n.Controls.VTextArea(i, !1, !1, !0, 50, 100, t), o = d) : n.DisplayType.IsNumeric(t) ? n.DisplayType.Amount == t ? (g = new n.Controls.VAmountTextBox(i, !1, !1, !0, 50, 100, t, r), o = g) : n.DisplayType.Integer == t ? (nt = new n.Controls.VNumTextBox(i, !1, !1, !0, 50, 100, r), o = nt) : n.DisplayType.Number == t && (tt = new n.Controls.VAmountTextBox(i, !1, !1, !0, 50, 100, t, r), o = tt) : t == n.DisplayType.PAttribute ? (s = new n.Controls.VPAttribute(i, !1, !1, !0, t, e, u, !1, !1, !1, !0), s.getBtn(0), o = s) : t == n.DisplayType.GAttribute ? (s = new n.Controls.VPAttribute(i, !1, !1, !0, t, e, u, !1, !1, !1, !1), s.getBtn(0), o = s) : t == n.DisplayType.Account ? (v = new n.Controls.VAccount(i, !1, !1, !0, t, e, u, r), v.getBtn(0), o = v) : t == n.DisplayType.Binary ? (it = new n.Controls.VBinary(i, !1, !1, !0, u), o = it) : t == n.DisplayType.Image ? (rt = new n.Controls.VImage(i, !1, !1, u), o = rt) : t == n.DisplayType.URL ? (h = new n.Controls.VURL(i, !1, !1, !0, 50, 100), o = h) : (t == n.DisplayType.FileName || t == n.DisplayType.FilePath) && (h = new n.Controls.VFile(i, !1, !1, !0, u, t), o = h), o }, nt = function (i, r) { var nt, d, it, ut, u, b, g; if (e && w2ui[a]) { nt = w2ui[a].getSelection(); for (d in nt) c.indexOf(w2ui[a].get(nt[d])[keyCol]) == -1 && c.push(w2ui[a].get(nt[d])[keyCol]) } kt(); var p = "SELECT ", k = null, tt = null, rt = 0, et = t.makeArray(o).length; for (d in o) { if (k = o[d].SelectClause, tt = String(k).indexOf(".") > -1 ? String(k).substring(String(k).lastIndexOf(".") + 1, String(k).length) : k, o[d].IsKey && (keyCol = tt.toUpperCase()), rt = o[d].AD_Reference_ID, rt == n.DisplayType.YesNo) p += " ( CASE " + k + " WHEN 'Y' THEN  'True' ELSE 'False'  END ) AS " + tt; else if (rt == n.DisplayType.List) { it = o[d].RefList; p += " CASE "; for (ut in it) p += " WHEN " + k + "='" + it[ut].Key + "' THEN '" + it[ut].Value + "'"; p += " END AS " + tt } else p += k + " "; et - 1 == d || (p += ", ") } if (p += " FROM " + h.FromClause, i == !0) { var w = " ", l = null, ft = !1; for (u = 0; u < s.length; u++)if (l = s[u].Ctrl.getValue(), s[u].AD_Reference_ID == n.DisplayType.Date && s[u].IsRange && l == null && (l = s[u].CtrlTo.getValue()), l != null && l.length != 0 && (l != 0 || s[u].AD_Reference_ID == n.DisplayType.YesNo) && l != -1 && l) { if (ft == !0 && (w += " AND "), s[u].AD_Reference_ID == n.DisplayType.String || s[u].AD_Reference_ID == n.DisplayType.Text || s[u].AD_Reference_ID == n.DisplayType.TextLong) l = String(l).indexOf("%") == 0 ? String(l).replace("%", "") : "" + l, String(l).lastIndexOf("") == String(l).length || (l = l + ""), l = n.DB.to_string(l), w += "  UPPER(" + s[u].SearchColumnName + ") LIKE " + l.toUpperCase(); else if (s[u].AD_Reference_ID == n.DisplayType.Date) { var b = null, g = null, v = new Date(s[u].Ctrl.getValue()); b = "TO_DATE( '" + (Number(v.getMonth()) + 1) + "-" + v.getDate() + "-" + v.getFullYear() + "', 'MM-DD-YYYY')"; s[u].IsRange ? (v = s[u].CtrlTo.getValue() == null ? new Date : new Date(s[u].CtrlTo.getValue()), g = "TO_DATE( '" + (Number(v.getMonth()) + 1) + "-" + v.getDate() + "-" + v.getFullYear() + "', 'MM-DD-YYYY')", w += " ( " + s[u].SearchColumnName + " BETWEEN " + b + " AND " + g + ")") : w += s[u].SearchColumnName + " =" + b } else if (s[u].AD_Reference_ID == n.DisplayType.DateTime) { var b = null, g = null, v = new Date(s[u].Ctrl.getValue()); b = "TO_DATE( '" + (Number(v.getMonth()) + 1) + "-" + v.getDate() + "-" + v.getFullYear() + " " + v.getHours() + ":" + v.getMinutes() + ":" + v.getSeconds() + "', 'MM-DD-YYYY HH24:MI:SS')"; s[u].IsRange ? (v = new Date(s[u].CtrlTo.getValue()), g = "TO_DATE( '" + (Number(v.getMonth()) + 1) + "-" + v.getDate() + "-" + v.getFullYear() + " " + v.getHours() + ":" + v.getMinutes() + ":" + v.getSeconds() + "', 'MM-DD-YYYY HH24:MI:SS')", w += " ( " + s[u].SearchColumnName + " BETWEEN " + b + " AND " + g + ")") : w += s[u].SearchColumnName + " =" + b } else s[u].AD_Reference_ID == n.DisplayType.YesNo ? (l = s[u].Ctrl.getValue() == !0 ? "Y" : "N", w += s[u].SearchColumnName + " = '" + l + "'") : (b = null, g = null, b = s[u].Ctrl.getValue(), s[u].IsRange ? s[u].Ctrl.getValue() && (l = s[u].Ctrl.getValue() == !0 ? "Y" : "", w += s[u].SearchColumnName + " = '" + l + "'") : w += " " + s[u].SearchColumnName + " ='" + b + "'"); ft = !0 } w.length > 1 ? (p += h.FromClause.toUpperCase().indexOf("WHERE") > -1 ? " AND " + w : " WHERE " + w, f != null && f.length > 0 && (p += " AND " + f)) : f != null && f.length > 0 && (p += h.FromClause.toUpperCase().indexOf("WHERE") > -1 ? " AND " + f : " WHERE " + f); h.OTHERCLAUSE != null && (String(h.OTHERCLAUSE).toUpperCase().indexOf("WHERE") > -1 && (h.FromClause.toUpperCase().indexOf("WHERE") > -1 || w.length > 1 || f != null && f.length > 1) && (h.OTHERCLAUSE = String(h.OTHERCLAUSE).replace("WHERE", "AND")), p += " " + h.OTHERCLAUSE) } else p += h.FromClause.toUpperCase().indexOf("WHERE") > -1 ? " AND rownum=-1" : " WHERE rownum=-1"; r || (r = 1); t.ajax({ url: n.Application.contextUrl + "InfoWindow/GetData", dataType: "json", type: "POST", data: { sql: p, tableName: h.TableName, pageNo: r }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); y[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { y[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); y[0].style.visibility = "hidden"; return } vi(i.pSetting); hi(i.data) } }) }, hi = function (i) { var r, h, l, f; if (i == null) { alert(n.Msg.getMsg("NoDataFound")); y[0].style.visibility = "hidden"; return } var s = [], v = [], u = null; for (f in i) r = { resizable: !0 }, u = o[f].AD_Reference_ID, r.caption = o[f].Name, r.field = i[f].ColumnName.toUpperCase(), r.columnName = i[f].ColumnName.toUpperCase(), r.sortable = !0, r.hidden = !o[f].IsDisplayed, r.size = "100px", n.DisplayType.IsNumeric(u) ? r.render = u == n.DisplayType.Integer ? "int" : function (t, i, r) { var u = n.Utility.Util.getValueOfDecimal(t[s[r].field]); return u.toLocaleString() } : n.DisplayType.IsDate(u) ? r.render = u == n.DisplayType.Date ? function (n, t, i) { var r = n[s[i].field]; return r ? (r = new Date(r), r = r.toLocaleDateString()) : r = "", r } : u == n.DisplayType.DateTime ? function (n, t, i) { var r = n[s[i].field]; return r ? (r = new Date(r), r = r.toDateString()) : r = "", r } : function (n, t, i) { var r = n[s[i].field]; return r ? (r = new Date(r), r = r.toLocaleTimeString()) : r = "", r } : u == n.DisplayType.Location || u == n.DisplayType.Locator ? r.render = "int" : u == n.DisplayType.Account ? r.render = "int" : u == n.DisplayType.PAttribute ? r.render = "int" : u == n.DisplayType.Button ? r.render = function () { return "<div>button<\/div>" } : u == n.DisplayType.Image ? r.render = function () { return "<div>Image<\/div>" } : n.DisplayType.IsLOB(u) && (r.render = function () { return "<div>[Lob-blob]<\/div>" }), s[f] = r; for (h = 0; h < i[0].RowCount; h++) { l = {}; for (f in i) l[i[f].ColumnName.toUpperCase()] = i[f].Values[h]; l.recid = h + 1; v[h] = l } if (a = "gridInfodata" + Math.random(), a = a.replace(".", ""), w2utils.encodeTags(v), d = t(ut).w2grid({ name: a, recordHeight: 40, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !1, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: s, records: v, multiSelect: e, onUnselect: ci }), e) for (itm in c) for (f in w2ui[a].records) w2ui[a].records[f][keyCol] == c[itm] && w2ui[a].select(parseInt(f) + 1); y[0].style.visibility = "hidden" }; kt = function () { d != null && d.destroy(); d = null }; dt = function () { var n = w2ui[a].getSelection(); for (item in n) c.indexOf(w2ui[a].get(n[item])[keyCol]) == -1 && c.push(w2ui[a].get(n[item])[keyCol]); g.onClose != null && c.length > 0 && g.onClose(); ct() }; this.getSelectedValues = function () { return c }; ct = function () { ot.off("click"); st.off("click"); et.off("click"); v.off("keyup"); p.off("click"); w.off("click"); b.off("click"); k.off("click"); l.off("change"); ut = null; rt = null; d != null && d.destroy(); d = null; it = null; gt = null; ni = ti = ii = ht = rt = ut = tt = null; y = ft = et = ot = st = null; p = w = b = k = l = null; d = null; h = null; o = null; yt = null; s = null; keyCol = null; g = null; c = null; v != null && (v.dialog("destroy"), v.remove()); v = null; this.disposeComponent = null; this.displaySchema = null; this.getControl = null; this.displayData = null; this.loadData = null; this.disposeDataSec = null; this.btnOKClick = null; this.getSelectedValues = null; this.disposeComponent = null } } i.prototype.getValueAsString = function (t) { return n.context.getWindowContext(this.windowNo, t, !0) }; n.InfoWindow = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function vs() { function dr(t) { t && (br = s.find("option:selected").val()); it = 1; v = []; s.val() != 0 ? v[0] = s.val() : v = ct; li(v, null, function (t) { ki(t); po(s.val(), function () { t.length != 0 ? (e.val(t[0].DimensionTypeVal), cu(e.val()), c.setValue(0), st = !1, tt.empty().append(n.Msg.getMsg("Add")), s.val() != -1 && e.val() != 0 ? (p.css("display", "block"), tt.css("display", "block"), ni.html() == "" ? k.getRoot().parent().css("height", "448px") : k.getRoot().parent().css("height", "469px")) : (p.css("display", "none"), tt.css("display", "none"), ni.html() == "" ? k.getRoot().parent().css("height", "390px") : k.getRoot().parent().css("height", "410px"))) : (cu(e.val()), s.val() != -1 && e.val() != 0 ? (p.css("display", "block"), tt.css("display", "block"), ni.html() == "" ? k.getRoot().parent().css("height", "448px") : k.getRoot().parent().css("height", "469px")) : (p.css("display", "none"), tt.css("display", "none"), ni.html() == "" ? k.getRoot().parent().css("height", "390px") : k.getRoot().parent().css("height", "410px"))) }) }) } var u, b, nt, tu, hi, ci, hr, iu, lr, vr, pr, wr; sf = t("<label>"); hf = t("<label>"); cf = t("<label>"); lf = t("<label>"); ro = t("<label>"); af = t("<label>"); ni = t("<label>"); s = t("<select tabindex='2'>"); e = t("<select tabindex='3'>"); ai = t("<select>"); c = new n.Controls.VAmountTextBox("Amount", !1, !1, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); a = new n.Controls.VAmountTextBox("ModalAmount", !1, !1, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); y = new n.Controls.VAmountTextBox("TotalAmount", !1, !0, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); ft = new n.Controls.VAmountTextBox("Total", !1, !0, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")); tt = t("<a style='cursor:pointer;' tabindex='7'>"); ir = t("<a>"); tf = t("<a style='cursor:pointer;' tabindex='12'>"); rf = t("<a style='cursor:pointer;' tabindex='13'>"); ee = t("<div class='VIS-AMTD-Grid'>"); ne = t("<div class='VIS-AMTD-SubGrid'>"); g = t("<div class='VIS-AMTD-formDynmicInput'>"); d = t("<div class='VIS-AMTD-formDynmicInput'>"); go = t("<button>"); ns = t("<button>"); cr = t("<div class='VIS-AMTD-Modal' id='updateModal'>"); fe = t("<div class='VIS-AMTD-Modal-Content'>"); io = t("<span class='VIS-AMTD-Close'>"); statusSpanShowRecordNo = t("<label>"); statusSpanShowRecordNo.addClass("vis-statusbar-pageMsg"); io.append("X"); sr = t('<ul class="vis-statusbar-ul"><\/ul>'); we = t('<div class="VIS-AMTD-StatusContainer"><\/div>'); fo = t('<li  style="opacity: 0.6;"><div><i class="vis vis-shiftleft" style="opacity: 1;" action="first" title="First Page" ><\/i><\/div><\/li>'); sr.append(fo); eo = t('<li style="opacity: 0.6;"><div><i class="vis vis-pageup" style="opacity: 1;" action="prev" title="Page Down" ><\/i><\/div><\/li>'); sr.append(eo); gt = t('<select class="vis-statusbar-combo" style="width:50px;"><\/select>'); u = t("<li><\/li>"); u.append(gt); sr.append(u); oo = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" style="opacity: 1;" action="next" title="Page Up" alt="Page Down" src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/PageDown16.png"><\/div><\/li>'); sr.append(oo); so = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" style="opacity: 1;" action="last" title="Last Page" ><\/i><\/div><\/li>'); sr.append(so); we.append(sr); wo = []; h = 0; st = !1; bo = 0; ko = 0; te = ""; ht = ""; ur = ""; fr = ""; er = ""; rt = ""; yi = ""; pi = ""; wi = ""; ct = ""; si = ""; ts = 0; ct = []; v = []; be = 0; uf = !0; w = 0; yr = 30; it = 1; ls = 0; ar = 0; br = -1; ho = 0; bi = n.DisplayType.GetNumberFormat(n.DisplayType.Amount); ie = t("<div class='VIS-AMTD-formWrap'>"); lu = t("<input type='button' class='VIS_Pref_btn-2 pull-left' tabindex='16' >"); tt.append(n.Msg.getMsg("Add")); ir.append(n.Msg.getMsg("Cancel")); tf.append(n.Msg.getMsg("Update")); rf.append(n.Msg.getMsg("Cancel")); lu.val(n.Msg.getMsg("OK")); sf.append(n.Msg.translate(n.Env.getCtx(), "C_AcctSchema_ID")); hf.append(n.Msg.translate(n.Env.getCtx(), "ElementType")); cf.append(n.Msg.getMsg("TotalAmount")); lf.append(n.Msg.getMsg("Amount")); ro.append(n.Msg.getMsg("Amount")); ir.css("display", "none"); af.append(n.Msg.getMsg("Total")); b = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); nt = t("<div class='vis-control-wrap'>"); b.append(nt); nt.append(s).append(sf); var r = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"), gr = t("<div class='vis-control-wrap'>"), nu = t('<div class="vis-excelimportbtn VIS-AMTD-formBtns" style=" display: block; "><a tabindex="" class="vis vis-doc-excel"><\/a><\/div>'); r.append(gr); r.append(nu); gr.append(e).append(hf); tu = t('<div style="float: right;margin-right: 5px;display:none" ><input id="VIS-AMTD-file-input" style="display:none" type="file"  accept=".xls,.xlsx"><label title="' + n.Msg.getMsg("VIS_ExcelImport") + '"  for="VIS-AMTD-file-input" ><\/label><\/div>'); r.append(tu); lo = r.find("#VIS-AMTD-file-input"); hi = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); ci = t("<div class='vis-control-wrap'>"); hi.append(ci); ci.append(y.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(cf); p = t("<div class='VIS-AMTD-formData VIS-AMTD-amountTxt input-group vis-input-wrap'>"); hr = t("<div class='vis-control-wrap'>"); p.append(hr); hr.append(c.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(lf); fi = t("<div class='VIS-AMTD-formData VIS-AMTD-amountTxt input-group vis-input-wrap'>"); iu = t("<div class='vis-control-wrap'>"); fi.append(iu); fi.append(a.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(ro); re = t("<div class='VIS-AMTD-formBtns'>"); lr = t("<div>"); lr.append(tt); re.append(lr); ue = t("<div class='VIS-AMTD-ModalformBtns'>"); vr = t("<div>"); vr.append(tf).append(rf); ue.append(vr); pr = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); wr = t("<div class='vis-control-wrap'>"); fe.append(d).append(fi).append(ue); cr.append(fe); ee.append(ne).append(cr).append(we); pr.append(wr); wr.append(ft.getControl().attr("placeholder", " ").attr("data-placeholder", "")).append(af); su = t("<div style='color:green;font-size:small'>"); su.append(ni); ie.append(su).append(hi).append(b).append(r).append(g).append(p).append(re); of.append(ie).append(ee).append(pr).append(lu); kr.append(of).append(no); f && of.addClass("VIS-AMTD-ReadOnly"); s.on("change", function () { o("visible"); var t = !0; s.val() == 0 && (t = !1, li(ct, null, function (t) { t.length != 0 && n.ADialog.confirm("ConfirmSelectAllAcctSchema", !0, "", "Confirm", function (t) { if (t) { o("visible"); for (var r = 0; r < ct.length; r++)n.DB.executeQuery("delete from c_dimamtaccttype where c_acctschema_id=" + ct[r] + " and c_dimamt_id=" + i + ""); ef(); li(ct, null, function (t) { o("visible"); ki(t); br = s.find("option:selected").val(); h = 0; c.setValue(0); st = !1; ir.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? p.css("width", "26%") : p.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")); ft.setValue(0); dr(!1) }) } else s.val(br), e.val(ar), dr(!1) }) })); li(ct, null, function () { dr(t); o("hidden") }); hu = s.find("option:selected").attr("precision") }); e.on("change", function () { o("visible"); li(v, null, function (t) { if (t.length != 0) n.ADialog.confirm("ConfirmChangeDimensionType", !0, "", "Confirm", function (t) { if (t) { o("visible"); cu(e.val()); ar = e.find("option:selected").val(); c.setValue(0); st = !1; ir.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? p.css("width", "26%") : p.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")); for (var r = 0; r < v.length; r++)n.DB.executeQuery("delete from c_dimamtaccttype where c_acctschema_id=" + v[r] + " and c_dimamt_id=" + i + ""); li(v, null, function (n) { ki(n); ef(); ft.setValue(0) }); o("hidden") } else return e.val(ar), ao(), o("hidden"), !1; ao() }); else { if (cu(e.val()), !co) return o("hidden"), n.ADialog.warn("VIS_ElementDifferent"), !1; ar = e.find("option:selected").val(); e.val() == "AC" ? ui.showColumn("C_BPartner") : ui.hideColumn("C_BPartner") } ao(); e.focus(); o("hidden") }) }); tt.on("keydown", function (n) { if (n.keyCode == 13 && (o("visible"), de())) { st || h++; var t = e.find("option:selected").val(); t == "AC" ? (l(e.find("option:selected").text(), ot.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vi.getValue(), ti, 0, ht.getValue(), et.val()), ai.val("-1"), vi.setValue("-1")) : t == "AY" ? (l(e.find("option:selected").text(), ii.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ii.find("option:selected").val(), -1, 0, 0, ""), ii.val(-1)) : t == "BP" ? (l(e.find("option:selected").text(), et.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ht.getValue(), -1, 0, 0, ""), et.val(""), ht.setValue("-1")) : t == "LF" || t == "LT" ? (l(e.find("option:selected").text(), rr.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ur.getValue(), -1, 0, 0, ""), rr.val(""), ur.setValue("-1")) : t == "MC" ? (l(e.find("option:selected").text(), kt.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), kt.find("option:selected").val(), -1, 0, 0, ""), kt.val(-1)) : t == "OO" || t == "OT" ? (l(e.find("option:selected").text(), at.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), at.find("option:selected").val(), -1, 0, 0, ""), at.val("-1")) : t == "PJ" ? (l(e.find("option:selected").text(), di.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), fr.getValue(), -1, 0, 0, ""), di.val(""), fr.setValue("-1")) : t == "PR" ? (l(e.find("option:selected").text(), gi.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), er.getValue(), -1, 0, 0, ""), gi.val(""), er.setValue("-1")) : t == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, 0, 0, "") : t == "SR" ? (l(e.find("option:selected").text(), ri.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ri.find("option:selected").val(), -1, 0, 0, ""), ri.val("-1")) : t == "U1" || t == "U2" ? (l(e.find("option:selected").text(), ot.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vi.getValue(), ti, 0, ht.getValue(), et.val()), ai.val("-1"), ot.val(""), vi.setValue("-1")) : (t == "X1" || t == "X2" || t == "X3" || t == "X4" || t == "X5" || t == "X6" || t == "X7" || t == "X8" || t == "X9") && (l(e.find("option:selected").text(), vt.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vt.find("option:selected").val(), -1, 0, 0, ""), vt.val(-1)) } }); tt.on("click", function () { if (o("visible"), de()) { st || h++; var n = e.find("option:selected").val(); n == "AC" ? (l(e.find("option:selected").text(), ot.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vi.getValue(), ti, 0, ht.getValue(), et.val()), ai.val("-1"), vi.setValue("-1"), et.val(""), ht.setValue("-1")) : n == "AY" ? (l(e.find("option:selected").text(), ii.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ii.find("option:selected").val(), -1, 0, 0, ""), ii.val(-1)) : n == "BP" ? (l(e.find("option:selected").text(), et.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ht.getValue(), -1, 0, 0, ""), et.val(""), ht.setValue("-1")) : n == "LF" || n == "LT" ? (l(e.find("option:selected").text(), rr.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ur.getValue(), -1, 0, 0, ""), rr.val(""), ur.setValue("-1")) : n == "MC" ? (l(e.find("option:selected").text(), kt.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), kt.find("option:selected").val(), -1, 0, 0, ""), kt.val(-1)) : n == "OO" || n == "OT" ? (l(e.find("option:selected").text(), at.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), at.find("option:selected").val(), -1, 0, 0, ""), at.val("-1")) : n == "PJ" ? (l(e.find("option:selected").text(), di.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), fr.getValue(), -1, 0, 0, ""), di.val(""), fr.setValue("-1")) : n == "PR" ? (l(e.find("option:selected").text(), gi.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), er.getValue(), -1, 0, 0, ""), gi.val(""), er.setValue("-1")) : n == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, 0, 0, "") : n == "SR" ? (l(e.find("option:selected").text(), ri.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ri.find("option:selected").val(), -1, 0, 0, ""), ri.val("-1")) : n == "U1" || n == "U2" ? (l(e.find("option:selected").text(), ot.val(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vi.getValue(), ti, 0, ht.getValue(), et.val()), ai.val("-1"), ot.val(""), vi.setValue("-1")) : (n == "X1" || n == "X2" || n == "X3" || n == "X4" || n == "X5" || n == "X6" || n == "X7" || n == "X8" || n == "X9") && (l(e.find("option:selected").text(), vt.find("option:selected").text(), c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), vt.find("option:selected").val(), -1, 0, 0, ""), vt.val(-1)) } }); nu.on("click", function () { if (t("#VIS-AMTD-file-input").val(""), e.val() == "0") return n.ADialog.error("VIS_DimensionType", !0, "", ""), !1; lo.trigger("click") }); lo.on("change", function () { var r = this, i = t("#VIS-AMTD-file-input").val(); if (i = i.substring(i.lastIndexOf(".")), [".xlsx", ".xls"].indexOf(i) < 0) return n.ADialog.error("VIS_InValidFile", !0, "", ""), !1; window.setTimeout(function () { o("visible"); _result = t.parseJSON(n.UploadAmountDimension(r, null)); ys(_result) }, 400) }); ir.on("click", function () { o("visible"); cu(e.val()); c.setValue(0); st = !1; ir.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? p.css("width", "26%") : p.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")); o("hidden") }); tf.on("keydown", function (n) { if (n.keyCode == 13 && (o("visible"), de())) { var t = e.find("option:selected").val(); t == "AC" ? (l(e.find("option:selected").text(), bt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), oi.getValue(), ti, w, rt.getValue(), lt.val()), ei.val("-1"), oi.setValue("-1"), lt.val(""), rt.setValue("-1")) : t == "AY" ? (l(e.find("option:selected").text(), pt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), pt.find("option:selected").val(), -1, w, 0, ""), pt.val(-1)) : t == "BP" ? (l(e.find("option:selected").text(), lt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), rt.getValue(), -1, w, 0, ""), lt.val(""), rt.setValue("-1")) : t == "LF" || t == "LT" ? (l(e.find("option:selected").text(), or.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), yi.getValue(), -1, w, 0, ""), or.val(""), yi.setValue("-1")) : t == "MC" ? (l(e.find("option:selected").text(), dt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), dt.find("option:selected").val(), -1, w, 0, ""), dt.val(-1)) : t == "OO" || t == "OT" ? (l(e.find("option:selected").text(), yt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), yt.find("option:selected").val(), -1, w, 0, ""), yt.val("-1")) : t == "PJ" ? (l(e.find("option:selected").text(), nr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), pi.getValue(), -1, w, 0, ""), nr.val(""), pi.setValue("-1")) : t == "PR" ? (l(e.find("option:selected").text(), tr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), wi.getValue(), -1, w, 0, ""), tr.val(""), wi.setValue("-1")) : t == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, w, 0, "") : t == "SR" ? (l(e.find("option:selected").text(), wt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), wt.find("option:selected").val(), -1, w, 0, ""), wt.val("-1")) : t == "U1" || t == "U2" ? (l(e.find("option:selected").text(), bt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), oi.getValue(), ti, w, 0, ""), ei.val("-1"), bt.val(""), oi.setValue("-1")) : (t == "X1" || t == "X2" || t == "X3" || t == "X4" || t == "X5" || t == "X6" || t == "X7" || t == "X8" || t == "X9") && (l(e.find("option:selected").text(), ut.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ut.find("option:selected").val(), -1, w, 0, ""), ut.val(-1)) } }); tf.on("click", function () { if (o("visible"), de()) { var n = e.find("option:selected").val(); n == "AC" ? (l(e.find("option:selected").text(), bt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), oi.getValue(), ti, w, rt.getValue(), lt.val()), ei.val("-1"), oi.setValue("-1"), lt.val(""), rt.setValue("-1")) : n == "AY" ? (l(e.find("option:selected").text(), pt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), pt.find("option:selected").val(), -1, w, 0, ""), pt.val(-1)) : n == "BP" ? (l(e.find("option:selected").text(), lt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), rt.getValue(), -1, w, 0, ""), lt.val(""), rt.setValue("-1")) : n == "LF" || n == "LT" ? (l(e.find("option:selected").text(), or.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), yi.getValue(), -1, w, 0, ""), or.val(""), yi.setValue("-1")) : n == "MC" ? (l(e.find("option:selected").text(), dt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), dt.find("option:selected").val(), -1, w, 0, ""), dt.val(-1)) : n == "OO" || n == "OT" ? (l(e.find("option:selected").text(), yt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), yt.find("option:selected").val(), -1, w, 0, ""), yt.val("-1")) : n == "PJ" ? (l(e.find("option:selected").text(), nr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), pi.getValue(), -1, w, 0, ""), nr.val(""), pi.setValue("-1")) : n == "PR" ? (l(e.find("option:selected").text(), tr.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), wi.getValue(), -1, w, 0, ""), tr.val(""), wi.setValue("-1")) : n == "SA" ? l(e.find("option:selected").text(), "", c.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), "", -1, w, 0, "") : n == "SR" ? (l(e.find("option:selected").text(), wt.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), wt.find("option:selected").val(), -1, w, 0, ""), wt.val("-1")) : n == "U1" || n == "U2" ? (l(e.find("option:selected").text(), bt.val(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), oi.getValue(), ti, w, 0, ""), ei.val("-1"), bt.val(""), oi.setValue("-1")) : (n == "X1" || n == "X2" || n == "X3" || n == "X4" || n == "X5" || n == "X6" || n == "X7" || n == "X8" || n == "X9") && (l(e.find("option:selected").text(), ut.find("option:selected").text(), a.getValue(), h, s.find("Option:selected").val(), e.find("option:selected").val(), ut.find("option:selected").val(), -1, w, 0, ""), ut.val(-1)) } }); rf.on("click", function () { st = !1; cr.css("display", "none") }); rf.on("keydown", function (n) { n.keyCode == 13 && (st = !1, cr.css("display", "none")) }); sr.on(n.Events.onTouchStartOrClick, "LI", function (n) { var i; if (o("visible"), t(n.target).attr("action") == "first") it != 1 && (it = 1, li(v, null, function (n) { ki(n); gt.val(it) })); else if (t(n.target).attr("action") == "prev") it != 1 && (it--, li(v, null, function (n) { ki(n); gt.val(it) })); else if (t(n.target).attr("action") == "next") { if (i = vo(), it >= i) { o("hidden"); return } it++; li(v, null, function (n) { ki(n); gt.val(it) }) } else if (t(n.target).attr("action") == "last") { if (i = vo(), it >= i) { o("hidden"); return } it = i; li(v, null, function (n) { ki(n); gt.val(it) }) } o("hidden") }); gt.on("change", function () { o("visible"); it != gt.val() && (it = gt.val(), li(v, null, function (n) { ki(n); gt.val(it) })); o("hidden") }); lu.on("click", function () { if (o("visible"), Math.abs(parseFloat(ft.getValue())) > Math.abs(parseFloat(y.getValue()))) n.ADialog.warn("LineTotalNotGrater"), y.getControl().focus(), o("hidden"); else if (y.getValue() != "" && y.getValue() != 0) v = [], s.val() == 0 ? v = ct : v[0] = s.val(), yo(i, y.getValue(), -1, v, "", "", "", -1, -1, -1, 0, "", 0, function () { ru.onClosing(i); k.close() }); else { ru.onClosing(i); k.close() } }) } function ys(i) { if (i != null) { if (i._filename == null || i._filename == "" || i._path == null || i._path == "") return; if (i._error != null && i._error != "") { n.ADialog.info(i._error, null, "", ""); return } var u = i._path, c = i._filename, f = e.find("option:selected").val(), o = s.find("Option:selected").val(), h = parseFloat(y.getValue()), r = []; r.push(u); r.push(f); r.push(o); r.push(h); t.ajax({ url: n.Application.contextUrl + "AmountDivision/GetDataFromExcelOrText", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify(r), success: function (t) { var i = !0; i = ps(t); ff == 0 && i && n.ADialog.warn("VIS_InCorrectData", null, "", "") }, error: function () { as[0].style.visibility = "hidden"; n.ADialog.info(n.Msg.getMsg("error"), null, "", "") } }) } } function ps(t) { var u = parseFloat(y.getValue()), f, r, i; if (t = JSON.parse(t), f = parseFloat(t.result[0].TotalAmount), u > 0 && f > u || u < 0 && Math.abs(f) > Math.abs(u)) return n.ADialog.warn("LineTotalNotGrater"), o("hidden"), !1; for (ff = 0, r = 0; r < t.result.length; r++)i = e.find("option:selected").val(), i == "AY" || i == "BP" || i == "MC" || i == "OO" || i == "OT" || i == "PJ" || i == "PR" || i == "SR" ? parseInt(t.result[r].Record_ID) > 0 && (l(e.find("option:selected").text(), t.result[r]["Search Key/Name"], t.result[r].Amount, h, s.find("Option:selected").val(), e.find("option:selected").val(), t.result[r].Record_ID, -1, w, 0, ""), ff++) : i == "U1" || i == "U2" || i == "AC" ? t.result[r].AccoutId != 0 && t.result[r].BPartnerId != 0 && (l(e.find("option:selected").text(), t.result[r].AccountValue, t.result[r].Amount, h, s.find("Option:selected").val(), e.find("option:selected").val(), t.result[r].AccoutId, t.result[r].C_Element_ID, w, t.result[r].BPartnerId, t.result[r]["Search Key/Name"]), ei.val("-1"), bt.val(""), oi.setValue("-1"), ff++) : (i == "X1" || i == "X2" || i == "X3" || i == "X4" || i == "X5" || i == "X6" || i == "X7" || i == "X8" || i == "X9") && parseInt(t.result[r].Record_ID) != 0 && (l(e.find("option:selected").text(), t.result[r]["Search Key/Name"], t.result[r].Amount, h, s.find("Option:selected").val(), e.find("option:selected").val(), t.result[r].Record_ID, -1, w, 0, ""), ut.val(-1), ff++); o("hidden") } function ao() { e.val() == "" || e.val() == 0 ? (p.css("display", "none"), tt.css("display", "none"), ni.html() == "" ? k.getRoot().parent().css("height", "390px") : k.getRoot().parent().css("height", "410px")) : (p.css("display", "block"), tt.css("display", "block"), ni.html() == "" ? k.getRoot().parent().css("height", "448px") : k.getRoot().parent().css("height", "469px")) } function ef() { var f = !1, t = "", e = "", o, r, s; for (ni.empty(), ni.append(""), o = " select distinct ct.totaldimlineamout as amount,ac.name from c_dimamtaccttype ct  inner join c_dimamtline cl on ct.c_dimamt_id=cl.c_dimamt_id and ct.c_dimamtaccttype_id=cl.c_dimamtaccttype_id  inner join c_acctschema ac on ac.c_acctschema_id=ct.c_acctschema_id   where ct.totaldimlineamout in (Select max(totaldimlineamout) from c_Dimamtaccttype    where c_dimamt_id=" + i + ") and ct.c_dimamt_id=" + i + "", r = n.DB.executeReader(o); r.read();)r.getInt(0) != null ? (su.css("display", "block"), f = !0, e = bi.GetFormatedValue(r.getString(0)), t += t == "" ? r.getString(1) : "," + r.getString(1)) : (ni.append(""), f = !1, window.setTimeout(function () { k.getRoot().parent().css("height", "448px") }, 200)); f && (t.length > 55 && (t = t.substring(0, 55) + "..."), ni.append(n.Msg.getMsg("MaxDimensionAmount") + " : " + e + " " + n.Msg.getMsg("ForAcctSchema") + " : " + t), window.setTimeout(function () { k.getRoot().parent().css("height", "470px") }, 200)); i != 0 ? (s = n.DB.executeScalar("select amount from c_dimAmt where c_dimamt_id=" + i + ""), Math.abs(parseFloat(u)) > 0 ? y.setValue(u) : y.setValue(s)) : u ? y.setValue(u) : y.setValue(0); ni.html() == "" && (su.css("display", "none"), k.getRoot().parent().css("height", "448px")) } function de() { return y.getValue() == 0 || y.getValue() == "" && y.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateTotalAmount"), y.getControl().focus(), o("hidden"), !1) : s.val() == "" || s.val() == -1 ? (n.ADialog.warn("ValidateAcctSchema"), s.focus(), o("hidden"), !1) : e.val() == "" || e.val() == 0 ? (n.ADialog.warn("ValidateDimType"), e.focus(), o("hidden"), !1) : y.getValue() == 0 || y.getValue() == "" && y.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateTotalAmount"), y.getControl().focus(), o("hidden"), !1) : st ? st ? a.getValue() == 0 || a.getValue() == "" && a.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateAmount"), a.getControl().focus(), o("hidden"), !1) : Math.abs(parseFloat(a.getValue())) > Math.abs(parseFloat(y.getValue())) ? (n.ADialog.warn("LineTotalNotGrater"), a.getControl().focus(), o("hidden"), !1) : parseFloat(a.getValue()) > 0 && parseFloat(y.getValue()) < 0 ? (n.ADialog.warn("VIS_NegativeAmount"), c.getControl().focus(), o("hidden"), !1) : parseFloat(a.getValue()) < 0 && parseFloat(y.getValue()) > 0 ? (n.ADialog.warn("VIS_PositiveAmount"), c.getControl().focus(), o("hidden"), !1) : rs() ? (o("hidden"), !0) : (o("hidden"), !1) : (o("hidden"), !0) : c.getValue() == 0 || c.getValue() == "" && c.getValue().trim().length == 0 ? (n.ADialog.warn("ValidateAmount"), c.getControl().focus(), o("hidden"), !1) : Math.abs(parseFloat(c.getValue())) > Math.abs(parseFloat(y.getValue())) ? (n.ADialog.warn("LineTotalNotGrater"), c.getControl().focus(), o("hidden"), !1) : parseFloat(c.getValue()) > 0 && parseFloat(y.getValue()) < 0 ? (n.ADialog.warn("VIS_NegativeAmount"), c.getControl().focus(), o("hidden"), !1) : parseFloat(c.getValue()) < 0 && parseFloat(y.getValue()) > 0 ? (n.ADialog.warn("VIS_PositiveAmount"), c.getControl().focus(), o("hidden"), !1) : rs() ? (o("hidden"), !0) : (o("hidden"), !1) } function rs() { if (e.val() != 0) if (st) { if (e.val() == "AC") return bt.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), bt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "AY") return pt.val() == -1 || pt.val() == null ? (n.ADialog.warn("ValidateActivity"), pt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "BP") return lt.val() == "" ? (n.ADialog.warn("ValidateBPartner"), lt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "LF" || e.val() == "LT") return or.val() == "" ? (n.ADialog.warn("ValidateLocation"), or.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "MC") return dt.val() == -1 || dt.val() == null ? (n.ADialog.warn("ValidateCamp"), kt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "OO" || e.val() == "OT") return yt.val() == -1 || yt.val() == null ? (n.ADialog.warn("ValidateOrg"), yt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PJ") return nr.val() == "" ? (n.ADialog.warn("ValidateProject"), nr.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PR") return tr.val() == "" ? (n.ADialog.warn("ValidateProduct"), tr.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "SA") return !0; if (e.val() == "SR") return wt.val() == -1 || wt.val() == null ? (n.ADialog.warn("ValidateSales"), wt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "U1" || e.val() == "U2") return ei.val() == -1 || ei.val() == null ? (n.ADialog.warn("ValidateElement"), ei.focus(), o("hidden"), !1) : bt.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), bt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "X1" || e.val() == "X2" || e.val() == "X3" || e.val() == "X4" || e.val() == "X5" || e.val() == "X6" || e.val() == "X7" || e.val() == "X8" || e.val() == "X9") return ut.val() == -1 || ut.val() == null ? (n.ADialog.warn("ValidateUElement"), ut.focus(), o("hidden"), !1) : (o("hidden"), !0) } else { if (e.val() == "AC") return ot.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), ot.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "AY") return ii.val() == -1 || ii.val() == null ? (n.ADialog.warn("ValidateActivity"), ii.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "BP") return et.val() == "" ? (n.ADialog.warn("ValidateBPartner"), et.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "LF" || e.val() == "LT") return rr.val() == "" ? (n.ADialog.warn("ValidateLocation"), rr.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "MC") return kt.val() == -1 || kt.val() == null ? (n.ADialog.warn("ValidateCamp"), kt.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "OO" || e.val() == "OT") return at.val() == -1 || at.val() == null ? (n.ADialog.warn("ValidateOrg"), at.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PJ") return di.val() == "" ? (n.ADialog.warn("ValidateProject"), di.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "PR") return gi.val() == "" ? (n.ADialog.warn("ValidateProduct"), gi.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "SA") return !0; if (e.val() == "SR") return ri.val() == -1 || ri.val() == null ? (n.ADialog.warn("ValidateSales"), ri.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "U1" || e.val() == "U2") return ot.val() == -1 || ot.val() == null ? (n.ADialog.warn("ValidateElement"), ot.focus(), o("hidden"), !1) : ot.val() == "" ? (n.ADialog.warn("ValidateAcctElement"), ot.focus(), o("hidden"), !1) : (o("hidden"), !0); if (e.val() == "X1" || e.val() == "X2" || e.val() == "X3" || e.val() == "X4" || e.val() == "X5" || e.val() == "X6" || e.val() == "X7" || e.val() == "X8" || e.val() == "X9") return vt.val() == -1 || vt.val() == null ? (n.ADialog.warn("ValidateUElement"), vt.focus(), o("hidden"), !1) : (o("hidden"), !0) } } function li(r, u, f) { var l = []; return t.ajax({ dataType: "json", type: "POST", url: n.Application.contextUrl + "AmountDivision/GetDiminsionLine", data: { accountingSchema: JSON.stringify(r), dimensionID: i, DimensionLineID: 0, pageNo: it, pSize: yr }, success: function (t) { var i, r; if (t) { if (t = JSON.parse(t), uf = !0, t.length > 0) { for (i = 0; i < t.length; i++)if (i == 0 && uf) { for (ke = t[i].TotalRecord, r = vo(), gt.empty(), b = 1; b < r + 1; b++)gt.empty().append("<option value=" + b + ">" + b + "<\/option>"); gt.val(1); uf = !1 } u && (s.val(t[0].AcctSchema), po(s.val(), function () { e.val(t[0].DimensionTypeVal); cu(e.val()); ar = t[0].DimensionTypeVal; br = t[0].AcctSchema; ft.setValue(bi.GetFormatedValue(t[0].TotalLineAmount)) })); u || (ar = t[0].DimensionTypeVal, br = t[0].AcctSchema, ft.setValue(bi.GetFormatedValue(t[0].TotalLineAmount))) } else gt.empty().append('<option value="1">1<\/option>'), ft.setValue(bi.GetFormatedValue(0)); h = t.length; c.setValue(0); st = !1; tt.empty().append(n.Msg.getMsg("Add")); l = t; f && f(t) } else n.ADialog.error("ErrorGettingData"), o("hidden") }, error: function () { o("hidden"); n.ADialog.error("ErrorGettingData"); return } }), l } function o(n) { no[0].style.visibility = n } function vo() { var n = ke % yr; return n != 0 ? parseInt(ke / yr) + 1 : parseInt(ke / yr) } function yo(r, u, f, e, s, c, l, a, v, y, p, w, b, k) { o("visible"); u = bi.GetFormatedValue(u); f = bi.GetFormatedValue(f); t.ajax({ dataType: "json", type: "POST", url: n.Application.contextUrl + "AmountDivision/InsertDimensionLine", data: { recordId: r, totalAmount: u, lineAmount: f, acctSchemaID: JSON.stringify(e), elementTypeID: c, dimensionValue: a, elementID: v, oldDimensionName: y, bpartner_ID: n.Utility.Util.getValueOfInt(p), oldBPartner_ID: b }, success: function (t) { var u, r; t = JSON.parse(t); t[0] != "" ? (i = t[0], ef(), st ? (n.ADialog.info("UpdatedDimLine"), w2ui[si].set(h, { DimensionName: l }), w2ui[si].set(h, { DimensionValueAmount: f }), w2ui[si].set(h, { CalculateDimValAmt: f }), (c == "AC" || c == "U1" || c == "U2") && (w2ui[si].set(h, { C_BPartner: w }), w2ui[si].set(h, { C_BPartner_ID: p })), r = bi.GetFormatedValue((parseFloat(parseFloat(ft.getValue()) - parseFloat(be)) + parseFloat(f)).toFixed(hu)), ft.setValue(r)) : (u = w2ui[si].records.length, c == "AC" || c == "U1" || c == "U2" ? w2ui[si].add({ recid: u + 1, DimensionType: s, DimensionName: l, C_BPartner: w, DimensionValueAmount: f, lineAmountID: t[1], CalculateDimValAmt: f, C_BPartner_ID: p }) : w2ui[si].add({ recid: u + 1, DimensionType: s, DimensionName: l, DimensionValueAmount: f, lineAmountID: t[1], CalculateDimValAmt: f }), r = bi.GetFormatedValue((parseFloat(ft.getValue()) + parseFloat(f)).toFixed(hu)), ft.setValue(r)), o("hidden")) : (n.ADialog.error("ErrorGettingData"), o("hidden")); k && k() }, error: function () { o("hidden"); n.ADialog.error("ErrorGettingData"); retval = !1; loading = !1 } }) } function l(t, r, u, f, e, s, h, l, p, w, b) { var d, g, nt, k; if (u = bi.GetFormatedValue(u.toFixed(hu)), d = "", v = [], e == 0 ? v = ct : v[0] = e, st) if (k = "select nvl(cline.c_dimamtline_id,0) as DimLineID from c_dimamt cd inner join c_dimamtaccttype cact on cd.c_dimamt_id=cact.c_dimamt_id  inner join c_dimamtline cline on cd.c_Dimamt_id=cline.c_dimamt_id and cact.c_dimamtaccttype_id=cline.c_dimamtaccttype_id  where cd.c_dimamt_id=" + i + " and cact.elementtype='" + s + "' and cact.c_acctschema_id in(" + v.toString() + ") and cline.c_dimamtline_id not in (" + p + ") ", s == "AC" ? k += " and C_ElementValue_ID=" + h + " AND NVL(C_BPartner_ID,0)=" + w : s == "AY" ? k += " and C_Activity_ID =" + h : s == "BP" ? k += " and C_BPartner_ID=" + h : s == "LF" || s == "LT" ? k += " and C_Location_ID=" + h : s == "MC" ? k += " and C_Campaign_ID=" + h : s == "OO" || s == "OT" ? k += " and Org_ID=" + h : s == "PJ" ? k += " and C_Project_ID=" + h : s == "PR" ? k += " and M_Product_ID=" + h : s == "SA" || (s == "SR" ? k += " and C_SalesRegion_ID=" + h : s == "U1" || s == "U2" ? (k += " and C_ElementValue_ID=" + h, w > 0 && (k += " AND NVL(C_BPartner_ID,0)=" + w)) : (s == "X1" || s == "X2" || s == "X3" || s == "X4" || s == "X5" || s == "X6" || s == "X7" || s == "X8" || s == "X9") && (k += " and AD_Column_ID=" + h)), d = n.DB.executeScalar(k), d == null) g = p.toString(), nt = n.dataContext.getJSONRecord("AmountDivision/GetTempDimLineAmount", g), Math.abs(parseFloat(ft.getValue()) + parseFloat(u) - parseFloat(nt)) <= Math.abs(parseFloat(y.getValue())) ? yo(i, y.getValue(), u, v, t, s, r, h, l, ho, w, b, is, function () { ge() }) : (n.ADialog.warn("LineTotalNotGrater"), a.setValue(0), a.getControl().focus(), ge()); else return n.ADialog.warn("NameExists"), a.setValue(0), o("hidden"), !1; else if (Math.abs(parseFloat(ft.getValue()) + parseFloat(u)) <= Math.abs(parseFloat(y.getValue()))) if (k = "select nvl(cline.c_dimamtline_id,0) as DimLineID from c_dimamt cd inner join c_dimamtaccttype cact on cd.c_dimamt_id=cact.c_dimamt_id  inner join c_dimamtline cline on cd.c_Dimamt_id=cline.c_dimamt_id and cact.c_dimamtaccttype_id=cline.c_dimamtaccttype_id  where cd.c_dimamt_id=" + i + " and cact.elementtype='" + s + "' and cact.c_acctschema_id in(" + v.toString() + ")", s == "AC" ? k += " and C_ElementValue_ID=" + h + " AND C_BPartner_ID=" + w : s == "AY" ? k += " and C_Activity_ID =" + h : s == "BP" ? k += " and C_BPartner_ID=" + h : s == "LF" || s == "LT" ? k += " and C_Location_ID=" + h : s == "MC" ? k += " and C_Campaign_ID=" + h : s == "OO" || s == "OT" ? k += " and Org_ID=" + h : s == "PJ" ? k += " and C_Project_ID=" + h : s == "PR" ? k += " and M_Product_ID=" + h : s == "SA" || (s == "SR" ? k += " and C_SalesRegion_ID=" + h : s == "U1" || s == "U2" ? (k += " and C_ElementValue_ID=" + h, w > 0 && (k += " AND C_BPartner_ID=" + w)) : (s == "X1" || s == "X2" || s == "X3" || s == "X4" || s == "X5" || s == "X6" || s == "X7" || s == "X8" || s == "X9") && (k += " and AD_Column_ID=" + h)), d = n.DB.executeScalar(k), d == null) yo(i, y.getValue(), u, v, t, s, r, h, l, 0, w, b, 0, function () { ge() }); else return n.ADialog.warn("NameExists"), f = f - 1, c.setValue(0), o("hidden"), !1; else n.ADialog.warn("LineTotalNotGrater"), c.setValue(0), c.getControl().focus(), f = f - 1, ge() } function ge() { c.setValue(0); st = !1; ir.css("display", "none"); cr.css("display", "none"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? p.css("width", "26%") : p.css("width", "33.3%"); tt.empty().append(n.Msg.getMsg("Add")) } function us() { au = null; at = null; vf = null; ii = null; yf = null; kt = null; pf = null; ri = null; wf = null; vt = null; vr = null; et = null; bf = null; di = null; kf = null; gi = null; df = null; gf = null; ai = null; oe = null; yt = null; se = null; pt = null; he = null; dt = null; ce = null; wt = null; le = null; ut = null; wr = null; lt = null; ae = null; nr = null; ve = null; tr = null; ye = null; pe = null; ei = null; g.empty(); d.empty(); ti = 0; co = !0 } function cu(n) { us(); n == "AC" ? os() : n == "AY" ? bs() : n == "BP" ? nh() : n == "LF" ? es() : n == "LT" ? es() : n == "MC" ? ks() : n == "OO" ? fs(n) : n == "OT" ? fs(n) : n == "PJ" ? th() : n == "PR" ? ih() : n == "SA" || (n == "SR" ? ds() : n == "U1" || n == "U2" ? os() : (n == "X1" || n == "X2" || n == "X3" || n == "X4" || n == "X5" || n == "X6" || n == "X7" || n == "X8" || n == "X9") && gs()) } function ws(r, u) { t.ajax({ url: n.Application.contextUrl + "AmountDivision/GetAccountingSchema", dataType: "json", data: { OrgID: r }, type: "POST", error: function () { o("hidden"); alert(n.Msg.getMsg("ErrorWhileGettingData")); return }, success: function (r) { var h = n.DB.executeScalar("select c_acctschema1_id from ad_clientinfo where ad_client_ID=" + n.Env.getCtx().getAD_Client_ID() + ""), l = !1, e = JSON.parse(r), f, c; if (e.Error) { n.ADialog.error(e.Error); o("hidden"); return } for (s.empty().append('<option selected="selected" value="-1">Please select<\/option>'), f = 0; f < e.length; f++)f == 0 && s.append('<option precision="' + hu + '" value="0">ALL<\/option>'), h == e[f].Key && (l = !0), s.append(t('<option precision="' + e[f].Precision + '"><\/option>').val(e[f].Key).html(e[f].Value)), ct.push(e[f].Key); l && (c = n.DB.executeScalar("select cd.c_acctschema_id from c_dimamtaccttype cd inner join c_dimamtline cl on cd.c_dimamtaccttype_id=cl.c_dimamtaccttype_id where cd.c_dimamt_id=" + i + ""), (c == "" || c == null) && (s.val(h), po(h))); u && (o("visible"), u(), o("hidden")) } }) } function po(i, r) { o("visible"); t.ajax({ url: n.Application.contextUrl + "AmountDivision/GetDiminsionType", dataType: "json", data: "{}", type: "POST", error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); o("hidden"); return }, success: function (u) { var s = "", h = JSON.parse(u), c, f; if (h.Error) { n.ADialog.error(h.Error); o("hidden"); return } if (i == 0) { for (f = 0; f < ct.length; f++)f == 0 ? s = "SELECT Distinct ElementType, Name FROM C_AcctSchema_Element WHERE  c_acctschema_id =" + ct[f] + " AND ElementType NOT IN('SA','X1','X2','X3','X4','X5','X6','X7','X8','X9') " : s += " AND ElementType IN(SELECT ElementType FROM C_AcctSchema_Element WHERE  c_acctschema_id =" + ct[f] + " AND ElementType NOT IN('SA','X1','X2','X3','X4','X5','X6','X7','X8','X9')) "; s += " ORDER BY ElementType" } else s = "SELECT Distinct ElementType, Name FROM C_AcctSchema_Element WHERE  c_acctschema_id =" + i + " AND ElementType<>'SA' ORDER BY ElementType"; for (s = n.MRole.addAccessSQL(s, "C_AcctSchema_Element", n.MRole.SQL_FULLYQUALIFIED, n.MRole.SQL_RW), c = n.DB.executeReader(s), e.empty().append('<option selected="selected" value="0">Please select<\/option>'); c.read();)for (f = 0; f < h.length; f++)if (h[f].Key == c.getString(0)) { e.append(t("<option><\/option>").val(h[f].Key).html(c.getString(1))); break } r && r(); o("hidden") } }) } function rh(t, r, u) { n.ADialog.confirm("DeleteConfirm", !0, "", "Confirm", function (f) { var e, s, h; f && (o("visible"), n.DB.executeQuery("delete from c_dimamtline where c_dimamtline_id in(" + t + ")"), e = "select nvl((sum(cd.amount)),0) as Amount from c_dimamtline cd inner join c_dimamtaccttype ct on cd.c_dimamt_id=ct.c_dimamt_id  and cd.c_dimamtaccttype_id=ct.c_dimamtaccttype_id  where cd.c_dimamt_id=" + i + " and ct.c_acctSchema_id=" + v[0] + "", s = n.DB.executeScalar(e), n.DB.executeQuery("update c_dimamtaccttype set totaldimlineamout=" + s + " where c_dimamt_id=" + i + " and c_acctSchema_id=" + v[0] + ""), w2ui[si].select(u), console.log("selected Rows : " + w2ui[si].getSelection().length), w2ui[si].delete(!0), h = parseFloat((ft.getValue() - parseFloat(r)).toFixed(hu)), ft.setValue(h), ef(), o("hidden")) }) } function uh(r, u, f) { o("visible"); var c = []; cr.css("display", "table"); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? fi.css({ width: "11%", "padding-right": "0" }) : (p.css("width", "33.3%"), fi != undefined && fi != null && fi.css("width", "33.3%")); st = !0; v = []; s.val() == 0 ? v = ct : v[0] = s.val(); t.ajax({ dataType: "json", type: "POST", url: n.Application.contextUrl + "AmountDivision/GetDiminsionLine", data: { accountingSchema: JSON.stringify(v), dimensionID: i, DimensionLineID: r[0], pageNo: it, pSize: yr }, success: function (n) { if (n) { c = JSON.parse(n); h = f; w = r.toString(); var t = e.val(); DimensionNameVal = c[0].DimensionNameVal; ho = c[0].DimensionNameVal; a.setValue(c[0].CalculateDimValAmt); be = c[0].CalculateDimValAmt; is = c[0].C_BPartner_ID; e.val() == "AC" ? (ti = c[0].ElementID, oi.setValue(DimensionNameVal), rt.setValue(c[0].C_BPartner_ID > 0 ? c[0].C_BPartner_ID : -1)) : t == "AY" ? (pt.focus(), pt.val(DimensionNameVal)) : t == "BP" ? (rt.getControl(0).val(rt.getDisplay()), rt.setValue(DimensionNameVal)) : t == "LF" || t == "LT" ? (yi.getControl(0).val(yi.getDisplay()), yi.setValue(DimensionNameVal)) : t == "MC" ? (dt.focus(), dt.val(DimensionNameVal)) : t == "OO" || t == "OT" ? (yt.focus(), yt.val(DimensionNameVal)) : t == "PJ" ? (pi.getControl(0).val(pi.getDisplay()), pi.setValue(DimensionNameVal)) : t == "PR" ? (wi.getControl(0).val(wi.getDisplay()), wi.setValue(DimensionNameVal)) : t == "SA" || (t == "SR" ? (wt.focus(), wt.val(DimensionNameVal)) : t == "U1" || t == "U2" ? (ti = c[0].ElementID, oi.setValue(DimensionNameVal), rt.setValue(c[0].C_BPartner_ID > 0 ? c[0].C_BPartner_ID : -1)) : (t == "X1" || t == "X2" || t == "X3" || t == "X4" || t == "X5" || t == "X6" || t == "X7" || t == "X8" || t == "X9") && (ut.focus(), ut.val(DimensionNameVal))); o("hidden") } } }) } var ki, ss; i && i.toString().indexOf("<") > -1 && (i = 0); this.onClose = null; this.onClosing = null; var kr = t("<div style='width:100%;height:100%;position:relative;display: flex;'>"), of = t("<div class='VIS-AMTD-MainContent vis-formouterwrpdiv'>"), no = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), fh = t("<table>"), s, e, y, at, c, tt, lu, ir, hs, sf, hf, cf, au, lf, ft, af, vf, ii, yf, kt, pf, ri, wf, vt, vr, et, to, rr, bf, di, kf, gi, df, gf, ai, ot, vi, yr = null, it = null, dr = null, ui = null, ne = null, g = null, wo = null, nt = n.Env.getWindowNo(), h = null, st = null, bo = null, ko = null, te = null, ht = null, ur = null, fr = null, er = "", rt = null, yi = null, pi = null, wi = null, v = null, cs = null, k = new n.ChildDialog, ie = null, vu = null, gr = null, hr = null, yu = null, hi = null, nu = null, pu = null, tu = null, iu = null, wu = null, bu = null, p = null, go = null, ns = null, ts = null, ct = null, ru = this, re = null, ue = null, cr = null, fe = null, io = null, ee = null, pr = null, uu = null, lr = null, ku = null, ci = null, fu = null, du = null, eu = null, ou = null, gu = null, nf = null, fi = null, d = null, yt, a, tf, rf, oe, ro, se, pt, he, dt, ce, wt, le, ut, wr, lt, uo, or, ae, nr, ve, tr, ye, pe, ei, bt, oi, we = null, sr = null, fo = null, eo = null, gt = null, oo = null, so = null, uf = null, si = null, w = null, be = null, ni = null, su = null, bi = null; this.dotFormatter = n.Env.isDecimalPoint(); var hu = n.Env.getCtx().getContextAsInt("#StdPrecision"), ls = null, ar = null, br = null, ho = null, ke = 0, ti = 0, co = !0, is = 0, as = null, lo = null, ff = 0; this.vetoablechange = function (n) { n.propertyName == "Amount" ? c.setValue(n.newValue) : n.propertyName == "ModalAmount" && a.setValue(n.newValue) }; var fs = function (i) { var r, u, h; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); au = t("<label>"); oe = t("<label>"); r = ""; r = i == "OO" ? " AND IsSummary='N' AND IsCostCenter='N' AND IsProfitCenter='N'" : " AND IsSummary='N' AND (IsCostCenter='Y' OR IsProfitCenter='Y')"; var f = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "AD_Org_ID", 0, !1, "AD_Org_ID<>0" + r), e = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "AD_Org_ID", 0, !1, "AD_Org_ID<>0" + r), o = new n.Controls.VComboBox("Org_ID", !1, !1, !0, f, 50), s = new n.Controls.VComboBox("Org_ID", !1, !1, !0, e, 50); at = o.getControl().attr("placeholder", " ").attr("data-placeholder", ""); at.find("option[value=0]").remove(); at.attr("tabindex", "4"); yt = s.getControl().attr("placeholder", " ").attr("data-placeholder", ""); yt.attr("tabindex", "9"); au.append(n.Msg.translate(n.Env.getCtx(), "Org_ID")); oe.append(n.Msg.translate(n.Env.getCtx(), "Org_ID")); vu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); vu.css("width", "100%"); u = t('<div class="vis-control-wrap">'); pr = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); pr.css("width", "100%"); h = t('<div class="vis-control-wrap">'); vu.append(u); u.append(at).append(au); g.append(vu); pr.append(pr); pr.append(yt).append(oe); d.append(pr); at.focus(); yt.focus() }, bs = function () { var i, r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); vf = t("<label>"); se = t("<label>"); var u = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Activity_ID", 0, !1, null), f = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Activity_ID", 0, !1, null), e = new n.Controls.VComboBox("C_Activity_ID", !1, !1, !0, u, 50), o = new n.Controls.VComboBox("C_Activity_ID", !1, !1, !0, f, 50); ii = e.getControl().attr("placeholder", " ").attr("data-placeholder", ""); ii.attr("tabindex", "4"); pt = o.getControl().attr("placeholder", " ").attr("data-placeholder", ""); pt.attr("tabindex", "9"); vf.append(n.Msg.translate(n.Env.getCtx(), "C_Activity_ID")); yu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); yu.css("width", "100%"); i = t("<div class='vis-control-wrap'>"); yu.append(i); i.append(ii).append(vf); g.append(yu); ii.focus(); se.append(n.Msg.translate(n.Env.getCtx(), "C_Activity_ID")); ku = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); ku.css("width", "100%"); r = t("<div class='vis-control-wrap'>"); ku.append(r); r.append(pt).append(se); d.append(ku); pt.focus() }, ks = function () { var i, r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); yf = t("<label>"); he = t("<label>"); var u = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Campaign_ID", 0, !1, null), f = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Campaign_ID", 0, !1, null), e = new n.Controls.VComboBox("C_Campaign_ID", !1, !1, !0, u, 50), o = new n.Controls.VComboBox("C_Campaign_ID", !1, !1, !0, f, 50); kt = e.getControl().attr("placeholder", " ").attr("data-placeholder", ""); kt.attr("tabindex", "4"); dt = o.getControl().attr("placeholder", " ").attr("data-placeholder", ""); dt.attr("tabindex", "9"); yf.append(n.Msg.translate(n.Env.getCtx(), "C_Campaign_ID")); pu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); pu.css("width", "100%"); i = t("<div class='vis-control-wrap'>"); pu.append(i); i.append(kt).append(yf); g.append(pu); kt.focus(); he.append(n.Msg.translate(n.Env.getCtx(), "C_Campaign_ID")); du = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); du.css("width", "100%"); r = t("<div class='vis-control-wrap'>"); du.append(r); r.append(dt).append(he); d.append(du); dt.focus() }, ds = function () { var u, f, i, e, o, r; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); pf = t("<label>"); ce = t("<label>"); u = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_SalesRegion_ID", 0, !1, null); f = new n.Controls.VComboBox("C_SalesRegion_ID", !1, !1, !0, u, 50); ri = f.getControl().attr("placeholder", " ").attr("data-placeholder", ""); ri.attr("tabindex", "4"); pf.append(n.Msg.translate(n.Env.getCtx(), "C_SalesRegion_ID")); wu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); wu.css("width", "100%"); i = t("<div class='vis-control-wrap'>"); wu.append(i); i.append(ri).append(pf); g.append(wu); ri.focus(); e = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_SalesRegion_ID", 0, !1, null); o = new n.Controls.VComboBox("C_SalesRegion_ID", !1, !1, !0, e, 50); wt = o.getControl().attr("placeholder", " ").attr("data-placeholder", ""); wt.attr("tabindex", "9"); ce.append(n.Msg.translate(n.Env.getCtx(), "C_SalesRegion_ID")); gu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); gu.css("width", "100%"); r = t("<div class='vis-control-wrap'>"); gu.append(r); r.append(wt).append(ce); d.append(gu); wt.focus() }, gs = function () { var i, r, s, h; vt = t("<select>"); ut = t("<select>"); for (var i = "select adt.ad_column_id,adt.columnname,adtab.TableName from c_acctschema_element ac inner join ad_column ad on ac.ad_column_id=ad.ad_column_id  inner join ad_column adt on ad.ad_table_ID=adt.ad_table_ID and adt.isactive='Y'   inner join ad_table adtab on adtab.ad_table_id=ad.ad_table_ID  where ac.c_acctschema_id=" + v[0] + " and ac.elementtype='" + e.find("option:selected").val() + "' and adt.isidentifier='Y' order by adt.ad_column_ID", f = n.DB.executeReader(i), u = "", o = ""; f.read();)u = f.getString(2), o += o == "" ? f.getString(1) : " ||'_'|| " + f.getString(1); if (g.css({ width: "33.3%" }), d.css({ width: "33.3%" }), p.css("width", "33.3%"), wf = t("<label>"), vt.empty().append("<option value=-1><\/option>"), ut.empty().append("<option value=-1><\/option>"), u != "") for (i = "SELECT " + u + "_ID ,(" + o + ") as Name FROM " + u + " WHERE isactive='Y' ORDER BY " + o, i = n.MRole.addAccessSQL(i, u, n.MRole.SQL_FULLYQUALIFIED, n.MRole.SQL_RW), r = n.DB.executeReader(i); r.read();)vt.append("<option value=" + r.getInt(0) + ">" + r.getString(1) + "<\/option>"), ut.append("<option value=" + r.getInt(0) + ">" + r.getString(1) + "<\/option>"); vt.attr("tabindex", "4"); wf.append(n.Msg.translate(n.Env.getCtx(), "AD_Column_ID")); bu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); bu.css("width", "100%"); s = t("<div class='vis-control-wrap'>"); bu.append(s); s.append(vt).append(wf); g.append(bu); vt.focus(); le = t("<label>"); ut.attr("tabindex", "9"); le.append(n.Msg.translate(n.Env.getCtx(), "AD_Column_ID")); nf = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); nf.css("width", "100%"); h = t("<div class='vis-control-wrap'>"); nf.append(h); h.append(ut).append(le); d.append(nf); ut.focus() }, nh = function () { var e, i, r, o, u, f; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); vr = t("<label>"); e = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_BPartner_ID", 0, !1, null); ht = new n.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, n.DisplayType.Search, e); et = ht.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); et.attr("tabindex", "4"); vr.append(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); hi = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); i = t('<div class="vis-control-wrap">'); r = t('<div class="input-group-append">'); hi.css("width", "100%"); hi.append(i); hi.append(r); i.append(et).append(vr); r.append(ht.getBtn(0)); g.append(hi); wr = t("<label>"); o = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_BPartner_ID", 0, !1, null); rt = new n.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, n.DisplayType.Search, o); lt = rt.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); lt.attr("tabindex", "9"); wr.append(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); ci = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); u = t('<div class="vis-control-wrap">'); f = t('<div class="input-group-append">'); ci.css("width", "100%"); ci.append(u); ci.append(f); u.append(lt).append(wr); f.append(rt.getBtn(0)); d.append(ci) }, es = function () { var e, i, r, o, u, f; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); to = t("<label>"); e = new n.MLocationLookup(n.Env.getCtx(), nt); ur = new n.Controls.VLocation("C_Location_ID", !1, !1, !0, n.DisplayType.Location, e); rr = ur.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); rr.attr("tabindex", "4"); to.append(n.Msg.translate(n.Env.getCtx(), "C_Location_ID")); nu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); i = t('<div class="vis-control-wrap">'); r = t('<div class="input-group-append">'); nu.css("width", "100%"); nu.append(i); nu.append(r); i.append(rr).append(to); r.append(ur.getBtn(1)); g.append(nu); uo = t("<label>"); o = new n.MLocationLookup(n.Env.getCtx(), nt); yi = new n.Controls.VLocation("C_Location_ID", !1, !1, !0, n.DisplayType.Location, o); or = yi.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); or.attr("tabindex", "9"); uo.append(n.Msg.translate(n.Env.getCtx(), "C_Location_ID")); fu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); u = t('<div class="vis-control-wrap">'); f = t('<div class="input-group-append">'); fu.css("width", "100%"); fu.append(u); fu.append(f); u.append(or).append(uo); f.append(yi.getBtn(1)); d.append(fu) }, th = function () { var e, i, r, o, u, f; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); bf = t("<label>"); e = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Project_ID", 0, !1, null); fr = new n.Controls.VTextBoxButton("C_Project_ID", !1, !1, !0, n.DisplayType.Search, e); di = fr.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); di.attr("tabindex", "4"); bf.append(n.Msg.translate(n.Env.getCtx(), "C_Project_ID")); iu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); i = t('<div class="vis-control-wrap">'); r = t('<div class="input-group-append">'); iu.css("width", "100%"); iu.append(i); iu.append(r); i.append(di).append(bf); r.append(fr.getBtn(0)); g.append(iu); ae = t("<label>"); o = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Project_ID", 0, !1, null); pi = new n.Controls.VTextBoxButton("C_Project_ID", !1, !1, !0, n.DisplayType.Search, o); nr = pi.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); nr.attr("tabindex", "9"); ae.append(n.Msg.translate(n.Env.getCtx(), "C_Project_ID")); ou = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); u = t('<div class="vis-control-wrap">'); f = t('<div class="input-group-append">'); ou.css("width", "100%"); ou.append(u); ou.append(f); u.append(nr).append(ae); f.append(pi.getBtn(0)); d.append(ou) }, ih = function () { var e, i, r, o, u, f; g.css({ width: "33.3%" }); d.css({ width: "33.3%" }); p.css("width", "33.3%"); kf = t("<label>"); e = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "M_Product_ID", 0, !1, null); er = new n.Controls.VTextBoxButton("M_Product_ID", !1, !1, !0, n.DisplayType.Search, e); gi = er.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); gi.attr("tabindex", "4"); kf.append(n.Msg.translate(n.Env.getCtx(), "M_Product_ID")); tu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); i = t('<div class="vis-control-wrap">'); r = t('<div class="input-group-append">'); tu.css("width", "100%"); tu.append(i); tu.append(r); i.append(gi).append(kf); r.append(er.getBtn(0)); g.append(tu); ve = t("<label>"); o = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "M_Product_ID", 0, !1, null); wi = new n.Controls.VTextBoxButton("M_Product_ID", !1, !1, !0, n.DisplayType.Search, o); tr = wi.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); tr.attr("tabindex", "9"); ve.append(n.Msg.translate(n.Env.getCtx(), "M_Product_ID")); eu = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); u = t('<div class="vis-control-wrap">'); f = t('<div class="input-group-append">'); eu.css("width", "100%"); eu.append(u); eu.append(f); u.append(tr).append(ve); f.append(wi.getBtn(0)); d.append(eu) }, os = function () { var b, u, k, f, o, i, s, h, tt, c, it, l, a, r, y, w; if (ti = n.dataContext.getJSONData(n.Application.contextUrl + "AmountDivision/GetElementID", { accountingSchema: JSON.stringify(v) }, null), ti == 0) return co = !1, !1; g.css({ width: "66.6%" }); d.css({ width: "66.6%", "margin-right": "9px" }); p.css("width", "26.5%"); fi.css("width", "26.5%"); df = t("<label>"); gf = t("<label>"); df.append(n.Msg.translate(n.Env.getCtx(), "C_Element_ID")); gf.append(n.Msg.translate(n.Env.getCtx(), "C_ElementValue_ID")); i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Element_ID", 0, !1, null); b = new n.Controls.VComboBox("C_Element_ID", !1, !1, !0, i, 50); ai = b.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); ai.attr("tabindex", "4"); gr = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); u = t('<div class="vis-control-wrap">'); gr.css("width", "50%"); gr.append(u); u.append(ai).append(df); g.append(gr); gr.hide(); k = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_ElementValue_ID", 0, !1, "C_Element_ID=" + ti); vi = new n.Controls.VTextBoxButton("C_ElementValue_ID", !1, !1, !0, n.DisplayType.Search, k); ot = vi.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); ot.attr("tabindex", "4"); hr = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); f = t('<div class="vis-control-wrap">'); o = t('<div class="input-group-append">'); hr.css("width", "50%"); hr.append(f); hr.append(o); f.append(ot).append(gf); o.append(vi.getBtn(0)); g.append(hr); ai.on("change", function () { var t = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_ElementValue_ID", 0, !1, "C_Element_ID=" + ai.val()); ot.lookup = t }); ot.focus(); vr = t("<label>"); i = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_BPartner_ID", 0, !1, null); ht = new n.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, n.DisplayType.Search, i); et = ht.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); et.attr("tabindex", "5"); vr.append(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); hi = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); s = t('<div class="vis-control-wrap">'); h = t('<div class="input-group-append">'); hi.css("width", "50%"); hi.append(s); hi.append(h); s.append(et).append(vr); h.append(ht.getBtn(0)); g.append(hi); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? (ui.showColumn("C_BPartner"), hr.css("width", "49%"), hi.css("width", "49%").css("margin-left", "9px"), p.css("width", "26%"), fi.css("width", "26%")) : (hr.css("width", "51%"), hi.css("width", "49%").css("margin-left", ""), p.css("width", "26.5%"), fi.css("width", "26.5%")); ye = t("<label>"); pe = t("<label>"); ye.append(n.Msg.translate(n.Env.getCtx(), "C_Element_ID")); pe.append(n.Msg.translate(n.Env.getCtx(), "C_ElementValue_ID")); r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_Element_ID", 0, !1, null); tt = new n.Controls.VComboBox("C_Element_ID", !1, !1, !0, r, 50); ei = tt.getControl().attr("placeholder", " ").attr("data-placeholder", ""); ei.attr("tabindex", "9"); uu = t("<div class='VIS-AMTD-formData input-group vis-input-wrap'>"); c = t('<div class="vis-control-wrap">'); uu.css("width", "50%"); uu.append(c); c.append(ei).append(ye); d.append(uu); uu.hide(); it = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_ElementValue_ID", 0, !1, "C_Element_ID=" + ti); oi = new n.Controls.VTextBoxButton("C_ElementValue_ID", !1, !1, !0, n.DisplayType.Search, it); bt = oi.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); bt.attr("tabindex", "9"); lr = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); l = t('<div class="vis-control-wrap">'); a = t('<div class="input-group-append">'); lr.css("width", "50%"); lr.append(l); lr.append(a); l.append(bt).append(pe); a.append(oi.getBtn(0)); d.append(lr); ei.on("change", function () { var t = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_ElementValue_ID", 0, !1, "C_Element_ID=" + ei.val()); bt.lookup = t }); bt.focus(); wr = t("<label>"); r = n.MLookupFactory.get(n.Env.getCtx(), nt, 0, n.DisplayType.TableDir, "C_BPartner_ID", 0, !1, null); rt = new n.Controls.VTextBoxButton("C_BPartner_ID", !1, !1, !0, n.DisplayType.Search, r); lt = rt.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " "); lt.attr("tabindex", "10"); wr.append(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); ci = t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns input-group vis-input-wrap'>"); y = t('<div class="vis-control-wrap">'); w = t('<div class="input-group-append">'); ci.css("width", "49%"); ci.append(y); ci.append(w); e.val() == "AC" || e.val() == "U1" || e.val() == "U2" ? (lr.css("width", "49%"), ci.css("width", "48%").css("margin-left", "9px"), fi.css("width", "26%")) : (lr.css("width", "51%"), ci.css("width", "49%"), fi.css("width", "26.5%")); y.append(lt).append(wr); w.append(rt.getBtn(0)); d.append(ci) }; ki = function (i) { var r = []; r.push({ field: "DimensionType", caption: "Dimension Type", size: "30%", min: 217 }); r.push({ field: "DimensionName", caption: "Dimension Name", size: "30%", min: 217 }); r.push({ field: "C_BPartner", caption: "Business Partner", size: "30%", min: 217, hidden: !0 }); r.push({ field: "DimensionValueAmount", caption: "Dimension Value Amount", size: "30%", min: 216, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.DimensionValueAmount); return i.toLocaleString() } }); r.push({ field: "Edit", caption: "", size: "5%", resizable: !1, render: function () { return '<a  tabindex="8"><div><img src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/Edit_sub16.png" alt="Edit record" title="Edit record" style="opacity: 1;cursor:pointer"><\/div><\/a>' } }); r.push({ field: "Delete", caption: "", size: "5%", resizable: !1, render: function () { return '<a id="a1" tabindex="14"><div><img src="' + n.Application.contextUrl + 'Areas/VIS/Images/base/delete10.png" alt="Delete record" title="Delete record" style="opacity: 1;cursor:pointer"><\/div><\/a>' } }); r.push({ field: "lineAmountID", caption: "lineAmountID", hidden: !0, resizable: !1, min: 0, max: 0 }); r.push({ field: "CalculateDimValAmt", caption: "CalculateDimValAmt", hidden: !0, resizable: !1, min: 0, max: 0 }); r.push({ field: "C_BPartner_ID", caption: "C_BPartner", hidden: !0, resizable: !1, min: 0, max: 0 }); dr = "gridAmountDivision" + Math.random(); dr = dr.replace(".", ""); si = dr; w2utils.encodeTags([]); ui = t(ne).w2grid({ name: dr, recordHeight: 20, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !1, selectColumn: !1, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: r, records: i, onClick: function (t) { if (t.column == 4 && ui.records.length > 0) { te = t.recid; var i = ui.get(t.recid).lineAmountID, r = []; i.search(",") == -1 ? r[0] = i : r = i.split(","); uh(r, ui.get(t.recid).CalculateDimValAmt, t.recid) } t.column == 5 && ui.records.length > 0 && (tt.html() == n.Msg.getMsg("Update") && te == t.recid ? n.ADialog.warn("PleaseFirstUpdateThisRecord") : rh(ui.get(t.recid).lineAmountID, ui.get(t.recid).CalculateDimValAmt, t.recid)) } }); (e.val() == "AC" || e.val() == "U1" || e.val() == "U2") && ui.showColumn("C_BPartner") }; this.show = function () { ss(); k.getRoot(); o("visible"); c.addVetoableChangeListener(this); a.addVetoableChangeListener(this); ws(r, function () { li(ct, !0, function (n) { ki(n); v[0] = s.val(); ef(); i == 0 || n.length == 0 ? (p.css("display", "none"), tt.css("display", "none"), k.getRoot().parent().css("height", "390px")) : (p.css("display", "block"), tt.css("display", "block"), ni.html() == "" ? k.getRoot().parent().css("height", "448px") : k.getRoot().parent().css("height", "469px")); o("hidden") }) }) }; vs(); ss = function () { k.setContent(kr); k.setWidth(750); k.setTitle(n.Msg.getMsg("AmountDimension")); k.setModal(!0); k.setEnableResize(!1); k.show(); k.hideButtons(); k.onClose = function () { ru.onClosing(i); ru.onClose && ru.onClose() } } } n.AmountDivision = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { n.UploadAmountDimension = function (i, r) { var b = null, u = [], c = [], l = 0, e = 0, h = Date.now().toString(), o = 1048576, a = 0, s = 0, y = [], f = null, g = i, rt = t(window).width(), ut = t(window).height(), h = Date.now().toString(), ft = r; savedFileName = ""; var k = t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:40%;width: 40%;left: 32%;position:absolute;z-index:99999;'>"), p = null, w = null; this.isWait = !1; self = this; var nt = function () { var n = null, i = 0, t; for (t in u) i = parseInt(u[t].size / o), f.size % o > 0 && i++, a += i, n = {}, n.Name = u[t].name, n.Size = u[t].size, y.push(n); d() }, d = function () { var i; if (u == null || u.length == 0) { v(!1); return } if (!(e >= u.length)) { var t = new XMLHttpRequest, r = new FormData, f = u[e].name.substring(0, u[e].name.lastIndexOf(".")) + h + u[e].name.substring(u[e].name.lastIndexOf(".")); savedFileName = f; r.append("file", u[e].slice(s * o, s * o + Number(o))); t.open("POST", n.Application.contextUrl + "AmountDivision/SaveFileinTemp?fileName=" + f + "&folderKey=" + h + "&orgFileName=" + u[e].name, !1); t.send(r); b = t.responseText; l++; s++; i = parseInt(u[e].size / o); u[e].size % o > 0 && i++; s == i && (e++, s = 0); l <= a && it(parseInt(l / a * 80)); window.setTimeout(function () { d() }, 2) } }, tt = function (t) { for (var i = [], r, b, p, k, w = 0; w < t.files.length; w++) { if (f = t.files[w], f == undefined) return; if (f.size <= 0) return u = [], c = [], l = 0, e = 0, h = null, o = null, a = 0, s = 0, y = [], f = null, n.ADialog.info("VADMS_FileSizeShouldGreaterThan0KB"), v(!1), !1; if (f.name.indexOf("&") > -1 || f.name.indexOf("?") > -1 || f.name.indexOf("#") > -1 || f.name.indexOf("/") > -1 || f.name.indexOf("\\") > -1) { i.push(f.name); continue } for (r in u) if (f.name == u[r].name) { window.setTimeout(function () { v(!1); n.ADialog.info("fileAlreadyAttached") }, 20); return } if (c != null) for (r in c) if (f.name == c[r].Name && !c[r].IsDeleted) { window.setTimeout(function () { v(!1); n.ADialog.info("fileAlreadyAttached") }, 20); return } b = {}; b.Name = f.name; b.Size = f.size; u.push(f) } if (i.length > 0) { p = ""; for (k in i) p += i[k].toString() + "\n"; p += i.length == 1 ? "File has" : "Files have"; p += " invalid name. Please change the file name and try again."; v(!1); n.ADialog.info("", !0, p) } }, v = function (n) { if (t("body").find("#progressbar").remove(), n) { p = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;height: 35px;'>"); w = t("<span class='vis-ui-label'  style='position:absolute;left: 60%;top: 4px;'>").append("0%"); p.append(w); k.append(p); var i = t("<div id='progressbar' style='z-index: 999999;' class='VIS-AMTD-Busy-Progress'><\/div>"); i.append(k); i.appendTo("<body>") } else t("body").find("progressbar").remove() }, it = function (n) { p.css("width", n + "%"); w.empty(); w.append(n + "%") }; return this.getFolderKey = h, this.getSavedFileName = savedFileName, this.GetUploadedExcelColumns = function () { var t, f, i; if (e >= u.length) return t = [], f = n.Application.contextUrl + "contextUrl/SaveAttachmentEntries", t.push({ Files: JSON.stringify(y) }), t.push({ FolderKey: h }), t.push({ FileName: savedFileName }), t.push({ Mapping: r }), i = n.ControllerRequestAjaxParameter1(f, t, !1), r.ExcelCol = i.ExcelCol, r.FileName = i.FileName, i }, v(!0), tt(i), nt(), b } }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s) { function ci() { y.css("width", "100%"); y.css("height", "100%"); y.css("position", "relative"); yt = t("<div class='vis-info-l-s-wrap vis-leftsidebarouterwrap'>"); ct = t("<div>"); yt.append(ct); lt = t("<div class='vis-info-datasec'>"); rt = t("<div class='vis-info-btnsec'>"); ht.append(yt); ht.append(lt); ht.append(rt); at = n.Msg.getMsg("Refresh"); at.indexOf("&") > -1 && (at = at.replace("&", "")); ft = n.Msg.getMsg("Cancel"); ft.indexOf("&") > -1 && (ft = ft.replace("&", "")); et = n.Msg.getMsg("Ok"); et.indexOf("&") > -1 && (et = et.replace("&", "")); nt = t("<div class='vis-info-btnswrap'>"); ot = t("<button class='VIS_Pref_btn-2'>").append(ft); st = t("<button class='VIS_Pref_btn-2'>").append(et); nt.append(ot); nt.append(st); rt.append(nt); pt = t("<div class='vis-info-btnleft'>"); vt = t("<button class='VIS_Pref_btn-2' style='margin-top: 10px;'>").append(t("<i class='vis vis-refresh'><\/i>")); bt = t('<div class="vis-info-pagingwrp">'); wi(); bt.append(kt); nt.append(ot); nt.append(st); pt.append(vt); rt.append(pt); rt.append(bt); rt.append(nt); a = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); a[0].style.visibility = "visible"; y.append(ht); y.append(a) } function li() { if (!n.Application.isMobile) y.on("keyup", function (t) { t.keyCode === 13 && (a[0].style.visibility = "visible", s != null && s.length > 0 && (s = n.Env.parseContext(n.Env.getCtx(), r, s, !1, !1)), it(!0, l.val())) }); ot.on("click", function () { ut.onClose != null && ut.onClose(); wt() }); st.on("click", function () { ti() }); vt.on("click", function () { a[0].style.visibility = "visible"; s != null && s != undefined && s.length > 0 && (s = n.Env.parseContext(n.Env.getCtx(), r, s, !1, !1)); it(!0, l.val()) }) } function ai() { ut.onClose != null && ut.onClose(); wt() } function pi(n) { var i, t; if (o) if (n.index) t = w2ui[n.target].records[n.index][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1); else for (i = 0; i < w2ui[n.target].records.length; i++)t = w2ui[n.target].records[i][keyCol], c.indexOf(t) > -1 && c.splice(c.indexOf(t), 1) } function wi() { kt = t('<ul class="vis-statusbar-ul">'); dt = t('<li class="flex-fill"><div class="vis-ad-w-p-s-result"><span><\/span><\/div><\/li>'); b = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="' + n.Msg.getMsg("FirstPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); k = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.getMsg("PageUp") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); l = t("<select>"); gt = t("<li>").append(l); d = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.getMsg("PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); g = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="' + n.Msg.getMsg("LastPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); ni = dt.find(".vis-ad-w-p-s-result").find("span"); kt.append(dt).append(b).append(k).append(gt).append(d).append(g); bi() } function bi() { b.on("click", function () { t(this).css("opacity") == "1" && it(!0, 1) }); k.on("click", function () { t(this).css("opacity") == "1" && it(!0, parseInt(l.val()) - 1) }); d.on("click", function () { t(this).css("opacity") == "1" && it(!0, parseInt(l.val()) + 1) }); g.on("click", function () { t(this).css("opacity") == "1" && it(!0, parseInt(l.find("Option:last").val())) }); l.on("change", function () { it(!0, l.val()) }) } function ki(n) { var i, o; if (l.empty(), n.TotalPage > 0) { for (i = 0; i < n.TotalPage; i++)l.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); l.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (d.css("opacity", "1"), g.css("opacity", "1")) : (d.css("opacity", "0.6"), g.css("opacity", "0.6")); n.CurrentPage > 1 ? (b.css("opacity", "1"), k.css("opacity", "1")) : (b.css("opacity", "0.6"), k.css("opacity", "0.6")); n.TotalPage == 1 && (b.css("opacity", "0.6"), k.css("opacity", "0.6"), d.css("opacity", "0.6"), g.css("opacity", "0.6")) } else b.css("opacity", "0.6"), k.css("opacity", "0.6"), d.css("opacity", "0.6"), g.css("opacity", "0.6"); var s = n.CurrentPage, e = n.PageSize, r = n.TotalRecords, u = (s - 1) * e, f = u + e; f > r && (f = r); r == 0 && (u -= 1); o = si + " " + (u + 1) + "-" + f + " " + hi + " " + r; ni.text(o) } var ti, ii, wt; this.onClose = null; var y = t("<div class='vis-forms-container'>"), ri = !0, ht = t("<div class='vis-info-subroot'>"), ui = null, fi = null, ei = null, yt = null, ct = null, lt = null, rt = null, at = null, ft = null, et = null, nt = null, ot = null, st = null, pt = null, vt = null, a = null, p = null, w = [], h = null, tt = null, ut = this; this.keyCol = ""; var c = [], oi = null, v = null, bt, kt, b, k, gt, d, g, l, dt, ni = null, si = n.Msg.getMsg("ShowingResult"), hi = n.Msg.getMsg("of"); ci(); li(); ti = function () { var n = w2ui[v].getSelection(); for (item in n) c.indexOf(w2ui[v].get(n[item])[keyCol]) == -1 && c.push(w2ui[v].get(n[item])[keyCol]); ut.onClose != null && c.length > 0 && ut.onClose(); wt() }; this.show = function () { t.ajax({ url: n.Application.contextUrl + "InfoGeneral/GetSearchColumns", dataType: "json", data: { tableName: f, ad_Language: n.context.getAD_Language(), isBaseLangage: n.Env.isBaseLanguage(n.context) }, error: function () { n.ADialog.error("ERRORGettingSearchCols"); a[0].style.visibility = "hidden" }, success: function (t) { if (p = t.result, p == null) { n.ADialog.error("ERRORGettingSearchCols"); a[0].style.visibility = "hidden"; return } vi() } }) }; var vi = function () { var c, i, e, ut, v, b, k; if (h = n.dataContext.getJSONData(n.Application.contextUrl + "InfoGeneral/GetDispalyColumns", { AD_Table_ID: p[0].AD_Table_ID, AD_Language: n.context.getAD_Language(), IsBaseLangage: n.Env.isBaseLanguage(n.context), TableName: f }).result, h == null) { alert(n.Msg.getMsg("ERRORGettingDisplayCols")); a[0].style.visibility = "hidden"; return } var nt = null, o = null, d = t("<table>"); d.css("width", "100%"); c = null; for (i in p) { var tt = t("<td>"), rt = t('<div class="input-group vis-input-wrap">'), g = t('<div class="vis-control-wrap">'); c = t("<tr>"); d.append(c); c.append(tt); tt.append(rt); rt.append(g); e = {}; o = new n.Controls.VTextBox(p[i].ColumnName, !1, !1, !0, 50, 100, null, null, !1); e.Ctrl = o; e.AD_Reference_ID = 10; e.ColumnName = p[i].ColumnName; e.IsTranslated = p[i].IsTranslated; p[i].IsIdentifier && o.setValue(u); ut = t("<td>"); g.append(o.getControl().attr("data-placeholder", "").attr("placeholder", " ")); nt = new n.Controls.VLabel(p[i].Name, p[i].ColumnName); g.append(nt.getControl()); w.push(e) } ct.append(d); v = n.Msg.getMsg("Refresh"); v.indexOf("&") > -1 && (v = v.replace("&", "")); b = n.Msg.getMsg("Cancel"); b.indexOf("&") > -1 && (b = b.replace("&", "")); k = n.Msg.getMsg("Ok"); k.indexOf("&") > -1 && (k = k.replace("&", "")); y.dialog({ width: 1020, height: 500, resizable: !1, title: p[0].TableDisplayName, modal: !0, close: ai, closeText: n.Msg.getMsg("close") }); s != null && s != undefined && s.length > 0 && (s = n.Env.parseContext(n.Env.getCtx(), r, s, !1, !1)); it(!0, l.val()) }, it = function (i, r) { var b, u, d, nt, y; if (o && w2ui[v]) { b = w2ui[v].getSelection(); for (u in b) c.indexOf(w2ui[v].get(b[u])[keyCol]) == -1 && c.push(w2ui[v].get(b[u])[keyCol]) } ii(); var e = "SELECT ", g = 0, it = t.makeArray(h).length, k = !1; for (u in h) { if (g = h[u].AD_Reference_ID, g == n.DisplayType.YesNo) e += " ( CASE " + f + "." + h[u].ColumnName + " WHEN 'Y' THEN  'True' ELSE 'False'  END ) AS " + h[u].ColumnName; else if (g == n.DisplayType.List) { d = h[u].RefList; e += " CASE "; for (nt in d) e += " WHEN " + f + "." + h[u].ColumnName + "='" + d[nt].Key + "' THEN '" + d[nt].Value.replace("'", "''") + "'"; e += " END AS " + h[u].ColumnName } else n.Env.isBaseLanguage(n.context) ? e += f + "." + h[u].ColumnName + " " : h[u].trlTableExist ? h[u].IsTranslated ? (e += "trlTable." + h[u].ColumnName + " ", k = !0) : e += f + "." + h[u].ColumnName + " " : e += f + "." + h[u].ColumnName + " "; h[u].IsKey && (keyCol = h[u].ColumnName.toUpperCase()); it - 1 == u || (e += ", ") } if (e += " FROM " + f + " " + f, k && (e += " Inner join " + f + "_Trl trlTable on (" + f + "." + f + "_ID=trlTable." + f + "_ID  AND trlTable.AD_Language='" + n.context.getAD_Language() + "')"), i == !0) { var p = " ", l = null, tt = !1; for (y = 0; y < w.length; y++)(l = w[y].Ctrl.getValue(), l != null && l.length != 0 && l != 0) && (tt == !0 && (p += " AND "), l = String(l).indexOf("%") == 0 ? String(l).replace("%", "") : "" + l, String(l).lastIndexOf("") == String(l).length || (l = l + ""), n.Env.isBaseLanguage(n.context) ? p += "  UPPER(" + f + "." + w[y].ColumnName + ") LIKE '" + l.toUpperCase() + "' " : k ? w[y].IsTranslated ? (p += "  UPPER(trlTable." + w[y].ColumnName + ") LIKE '" + l.toUpperCase() + "' ", k = !0) : p += "  UPPER(" + f + "." + w[y].ColumnName + ") LIKE '" + l.toUpperCase() + "' " : p += "  UPPER(" + f + "." + w[y].ColumnName + ") LIKE '" + l.toUpperCase() + "' ", tt = !0); p.length > 1 ? (e += " WHERE " + p, s != null && s.length > 0 && (e += " AND " + s)) : s != null && s.length > 0 && (e += " WHERE " + s) } else e += s.length > 0 && s.trim().toUpperCase().startsWith("WHERE") ? " " + s + " AND " + f + "_ID=-1" : s.length > 0 ? " WHERE " + f + "." + f + "_ID=-1 AND " + s : " WHERE " + f + "." + f + "_ID=-1"; r || (r = 1); t.ajax({ url: n.Application.contextUrl + "InfoGeneral/GetData", dataType: "json", type: "POST", data: { sql: e, tableName: f, pageNo: r }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); a[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { a[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); a[0].style.visibility = "hidden"; return } ki(i.pSetting); yi(i.data) } }) }, yi = function (i) { var r, e, s, u; if (i == null) { alert(n.Msg.getMsg("NoDataFound")); a[0].style.visibility = "hidden"; return } var l = [], y = [], f = null; for (u in i) r = { resizable: !0 }, f = h[u].AD_Reference_ID, r.caption = h[u].Name, r.field = h[u].ColumnName.toUpperCase(), r.columnName = h[u].ColumnName.toUpperCase(), r.sortable = !0, r.hidden = !h[u].IsDisplayed, r.size = "100px", n.DisplayType.IsNumeric(f) ? r.render = f == n.DisplayType.Integer ? "int" : f == n.DisplayType.Amount ? "number:2" : "number:1" : n.DisplayType.IsDate(f) ? r.render = function (n, t, i) { var r = n[l[i].field]; return r ? Globalize.format(new Date(r), "d") : "" } : f == n.DisplayType.Location || f == n.DisplayType.Locator ? r.render = "int" : f == n.DisplayType.Account ? r.render = "int" : f == n.DisplayType.PAttribute ? r.render = "int" : f == n.DisplayType.Button ? r.render = function () { return "<div>button<\/div>" } : f == n.DisplayType.Image ? r.render = function () { return "<div>Image<\/div>" } : n.DisplayType.IsLOB(f) && (r.render = function () { return "<div>[Lob-blob]<\/div>" }), l[u] = r; for (e = 0; e < i[0].RowCount; e++) { s = {}; for (u in i) s[i[u].ColumnName.toUpperCase()] = i[u].Values[e]; s.recid = e + 1; y[e] = s } if (v = "gridGenInfodata" + Math.random(), v = v.replace(".", ""), w2utils.encodeTags(y), tt = t(lt).w2grid({ name: v, recordHeight: 40, show: { toolbar: !0, columnHeaders: !0, lineNumbers: !1, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: l, records: y, multiSelect: o, onUnselect: pi }), o) for (itm in c) for (u in w2ui[v].records) w2ui[v].records[u][keyCol] == c[itm] && w2ui[v].select(parseInt(u) + 1); a[0].style.visibility = "hidden" }; ii = function () { tt != null && tt.destroy(); tt = null }; this.getSelectedValues = function () { return c }; wt = function () { y.off("keyup"); ot.off("click"); st.off("click"); vt.off("click"); b.off("click"); k.off("click"); d.off("click"); g.off("click"); l.off("change"); lt = null; ct = null; tt != null && tt.destroy(); tt = null; ri = null; ht = null; ui = null; fi = null; ei = null; yt = null; ct = null; lt = null; rt = null; at = null; ft = null; et = null; nt = null; ot = null; st = null; pt = null; vt = null; a = null; p = null; w = null; h = null; tt = null; ut = null; keyCol = null; c = null; oi = null; b = k = d = g = l = null; y != null && (y.dialog("destroy"), y.remove()); y = null; this.btnOKClick = null; this.displaySearchCol = null; this.displayData = null; this.loadData = null; this.disposeComponent = null; this.disposeDataSec = null; this.getSelectedValues = null } } n.infoGeneral = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h, c) { function gf() { var o, i; fu = []; fu.push({ field: "WareHouse", caption: n.Msg.getMsg("Warehouse"), size: "150px" }, { field: "Variant", caption: n.Msg.getMsg("Variant"), size: "150px" }, { field: "Quantity", caption: n.Msg.getMsg("Quantity"), size: "100px", editable: { type: "float" }, render: "number:1" }, { field: "Available", caption: n.Msg.getElement(n.Env.getCtx(), "QtyAvailable"), size: "100px" }, { field: "OnHand", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOnHand"), size: "100px" }, { field: "Reserved", caption: n.Msg.getElement(n.Env.getCtx(), "QtyReserved"), size: "100px" }, { field: "Ordered", caption: n.Msg.getElement(n.Env.getCtx(), "QtyOrdered"), size: "100px" }, { field: "M_Warehouse_ID", caption: "WareHouse ID", size: "150px", hidden: !0 }, { field: "M_AttributeSetInstance_ID", caption: "M_AttributeSetInstance_ID", size: "150px", hidden: !0 }, { field: "M_Product_ID", caption: "M_Product_ID", size: "150px", hidden: !0 }, { field: "ParentRec_ID", caption: "Parent recid", size: "150px", hidden: !0 }); ft.css("width", "100%"); ft.css("height", "100%"); ft.css("position", "relative"); ot.css("width", "100%"); vi = t("<div class='vis-info-l-s-wrap vis-pad-0 vis-leftsidebarouterwrap'>"); yi = t("<div class='vis-info-l-s-content'>"); vi.append(yi); ri = t("<div class='vis-info-datasec'>"); ui = t("<div class='vis-info-btnsec'>"); ai.append(vi); ai.append(ri); ai.append(ui); nr = n.Msg.getMsg("Value"); nr.indexOf("&") > -1 && (nr = nr.replace("&", "")); tr = n.Msg.getMsg("Name"); tr.indexOf("&") > -1 && (tr = tr.replace("&", "")); ir = n.Msg.getMsg("UPC"); ir.indexOf("&") > -1 && (ir = ir.replace("&", "")); rr = n.Msg.getMsg("SKU"); rr.indexOf("&") > -1 && (rr = rr.replace("&", "")); ur = n.Msg.getMsg("Warehouse"); ur.indexOf("&") > -1 && (ur = ur.replace("&", "")); fr = n.Msg.getMsg("PriceListVersion"); fr.indexOf("&") > -1 && (fr = fr.replace("&", "")); pi = n.Msg.getMsg("Refresh"); pi.indexOf("&") > -1 && (pi = pi.replace("&", "")); vr = n.Msg.getMsg("AddCatalog"); vr.indexOf("&") > -1 && (vr = vr.replace("&", "")); yr = n.Msg.getMsg("ShowSaved"); yr.indexOf("&") > -1 && (yr = yr.replace("&", "")); wr = n.Msg.getMsg("ShowCart"); wr.indexOf("&") > -1 && (wr = wr.replace("&", "")); pr = n.Msg.getMsg("ShowScan"); pr.indexOf("&") > -1 && (pr = pr.replace("&", "")); fi = n.Msg.getMsg("Cancel"); fi.indexOf("&") > -1 && (fi = fi.replace("&", "")); ei = n.Msg.getMsg("Ok"); ei.indexOf("&") > -1 && (ei = ei.replace("&", "")); er = n.Msg.getElement(n.Env.getCtx(), "M_AttributeSet_ID"); er.indexOf("&") > -1 && (er = er.replace("&", "")); or = n.Msg.getElement(n.Env.getCtx(), "M_AttributeSetInstance_ID"); or.indexOf("&") > -1 && (or = or.replace("&", "")); sr = n.Msg.getMsg("AttrCode"); sr.indexOf("&") > -1 && (sr = sr.replace("&", "")); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(nr); k.append(u); u.append(f); f.append(r); i = {}; rt = new n.Controls.VTextBox("Value", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = rt; i.AD_Reference_ID = 10; i.ColumnName = "Value"; o = t("<td>"); r.append(rt.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(tr); k.append(u); u.append(f); f.append(r); i = {}; rt = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = rt; i.AD_Reference_ID = 10; i.ColumnName = "Name"; rt.setValue(e); o = t("<td>"); r.append(rt.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(ir); k.append(u); u.append(f); f.append(r); i = {}; rt = new n.Controls.VTextBox("UPC", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = rt; i.AD_Reference_ID = 10; i.ColumnName = "UPC"; r.append(rt.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(rr); k.append(u); u.append(f); f.append(r); i = {}; rt = new n.Controls.VTextBox("SKU", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = rt; i.AD_Reference_ID = 10; i.ColumnName = "SKU"; o = t("<td>"); r.append(rt.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(ur); k.append(u); u.append(f); f.append(r); i = {}; ti = new n.Controls.VComboBox("M_Warehouse_ID", !1, !1, !0, null, 50); i.Ctrl = ti; i.AD_Reference_ID = n.DisplayType.tableDir; i.ColumnName = "M_Warehouse_ID"; o = t("<td>"); k.append(o); r.append(ti.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(fr); k.append(u); u.append(f); f.append(r); i = {}; oi = new n.Controls.VComboBox("M_PriceList_Version_ID", !1, !1, !0, null, 50); i.Ctrl = oi; i.AD_Reference_ID = n.DisplayType.tableDir; i.ColumnName = "M_PriceList_Version_ID"; o = t("<td>"); r.append(oi.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(sr); k.append(u); u.append(f); f.append(r); i = {}; rt = new n.Controls.VTextBox("AttributeCode", !1, !1, !0, 50, 100, null, null, !1); i.Ctrl = rt; i.AD_Reference_ID = 10; i.ColumnName = "AttributeCode"; o = t("<td>"); r.append(rt.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(er); k.append(u); u.append(f); f.append(r); i = {}; gt = new n.Controls.VComboBox("M_AttributeSet_ID", !1, !1, !0, null, 50); i.Ctrl = gt; i.AD_Reference_ID = n.DisplayType.tableDir; i.ColumnName = "M_AttributeSet_ID"; o = t("<td>"); r.append(gt.getControl().attr("data-placeholder", "").attr("placeholder", " ")); r.append(tt); b.push(i); k = t("<tr>"); ot.append(k); var u = t("<td>"), f = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); k.append(u); u.append(f); f.append(r); i = {}; tf(); yi.append(ot); bt = t("<div class='vis-info-btnswrap'>"); br = t("<div class='vis-info-ls-btnswrap'>"); bi = t("<button class='VIS_Pref_btn-2'>").append(fi); ki = t("<button class='VIS_Pref_btn-2'>").append(ei); ut = t("<button class='VIS_Pref_btn-2'>").append(t("<i class='fa fa-cart-plus'><\/i>")); kt = t("<button class='VIS_Pref_btn-2' disabled>").append(t("<i class='fa fa-list-ul'><\/i>")); kr = t("<button class='VIS_Pref_btn-2'>").append(t("<i class='vis vis-scanner'>")); wi = t("<button class='VIS_Pref_btn-2'>").append(t("<i class='fa fa-shopping-cart'><\/i>")); dr = t("<div class='vis-info-btnleft'>"); di = t("<button class='VIS_Pref_btn-2' style='margin-top: 10px;'>").append(t("<i class='vis vis-refresh'><\/i>")); cu = t('<div class="vis-info-pagingwrp">'); ge(); cu.append(lu); bt.append(bi); bt.append(ki); bt.append(kt); bt.append(ut); br.append(kr); br.append(wi); vi.append(br); dr.append(di); ui.append(dr); ui.append(cu); ui.append(bt); y = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); y[0].style.visibility = "visible"; ft.append(ai); ft.append(y) } function tf() { var i = {}, o; k.empty(); o = " M_AttributeSetInstance_ID IN (SELECT  asi.M_AttributeSetInstance_ID as M_AttributeSetInstance_ID   FROM M_AttributeSetInstance asi   WHERE asi.IsActive='Y' AND asi.M_ATTRIBUTESET_ID=" + gt.ctrl.val() + ")"; uu = n.MLookupFactory.get(n.Env.getCtx(), r, 8472, n.DisplayType.Search, "M_AttributeSetInstance_ID", 0, !1, o); ni = new n.Controls.VTextBoxButton("M_AttributeSetInstance_ID", !1, !1, !0, n.DisplayType.Search, uu); ni.getControl(); i.Ctrl = ni; i.AD_Reference_ID = n.DisplayType.Search; i.ColumnName = "M_AttributeSetInstance_ID"; var s = t("<td>"), u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), e = t('<div class="input-group-append">'); tt = t("<label class='VIS_Pref_Label_Font'>").append(or); s.append(u); u.append(f); u.append(e); f.append(ni.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); e.append(ni.getBtn(0)); e.append(ni.getBtn(1)); f.append(tt); b.push(i) } function ne() { if (!n.Application.isMobile) ft.on("keyup", function (t) { if (t.keyCode === 13 && (y[0].style.visibility = "visible", c != null && c.length > 0 && (d = n.Env.parseContext(n.Env.getCtx(), r, c, !1, !1)), ct(!0, g.val()), w.length > 0)) { for (var i = 0; i < w.length; i++)w2ui["subgrid-" + w[i]].destroy(); w = [] } }); kr.on("click", function () { le() }); wi.on("click", function () { ce() }); ut.on("click", function () { ae() }); kt.on("click", function () { y[0].style.visibility = "visible"; yu() }); bi.on("click", function () { lt.onClose != null && lt.onClose(); ru() }); ki.on("click", function () { ef() }); di.on("click", function () { if (d = null, h && !st && ut.show(), v.length == 0 && kt.prop("disabled", !0), a = [], y[0].style.visibility = "visible", c != null && c != undefined && c.length > 0 && (d = n.Env.parseContext(n.Env.getCtx(), r, c, !1, !1)), ct(!0, 1), w.length > 0) { for (var t = 0; t < w.length; t++)w2ui["subgrid-" + w[t]].destroy(); w = [] } }); gt.ctrl.change(function () { ni = null; uu = null; for (var n = 0; n < b.length; n++)b[n].Ctrl.colName == "M_AttributeSetInstance_ID" && b.splice(n); tf() }) } function te(i, u) { hu = new n.MPAttributeLookup(n.context, r); du = new n.Controls.VPAttribute("M_AttributeSetInstance_ID", !1, !1, !0, n.DisplayType.PAttribute, hu, r, !1, !1, !1, !0); ti.ctrl.append(t('<Option value="0"><\/option>')); oi.ctrl.append(t('<Option value="0"><\/option>')); gt.ctrl.append(t('<Option value="0"><\/option>')); wu = jQuery.parseJSON(wu); bu = jQuery.parseJSON(bu); u == 0 && (u = ue()); ou = he(n.Env.getCtx(), r, u); ie() } function ie() { try { var t = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetWarehouse", null, null); re(t) } catch (i) { console.log(i); y[0].style.visibility = "hidden" } } function re(t) { var i, e, r; if (t.length > 0) { for (r in t) i = n.Utility.Util.getValueOfInt(t[r].M_Warehouse_ID), e = n.Utility.Util.getValueOfString(t[r].Name), ti.getControl().append(" <option value=" + i + ">" + e + "<\/option>"), i == u && ti.ctrl.val(u); u == 0 && ti.ctrl.val(n.Utility.Util.getValueOfInt(t[0].M_Warehouse_ID)) } fe(f) } function uf(t, i) { var f = !1, u, r; if (t.value_new = n.Utility.Util.getValueOfString(i), t.value_new.contains(".")) { for (f = !0, u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "." && u.push(r); u.length > 1 && (t.value_new = vu(t.value_new, ".")) } if (t.value_new.contains(",")) if (f) t.value_new = vu(t.value_new, ","); else { for (u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "," && u.push(r); t.value_new = u.length > 1 ? vu(t.value_new, ",") : t.value_new.replace(",", ".") } return t.value_new == "" && (t.value_new = "0"), t.value_new } function vu(n, t) { var i = n.split(t); return n = i.slice(0, -1).join("") + "." + i.slice(-1), n.indexOf(".") == n.length - 1 && (n = n.replace(".", "")), n } function ue() { var i = 0, t; try { t = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetDefaultPriceList", null, null); t != null && (i = t) } catch (r) { console.log(r); y[0].style.visibility = "hidden" } return i } function fe(t) { try { var i = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetPriceList", { PriceList: t }, null); ee(i) } catch (r) { console.log(r); y[0].style.visibility = "hidden" } } function ee(t) { var i, u, r; if (t.length > 0) for (r in t) i = n.Utility.Util.getValueOfInt(t[r].M_PriceList_Version_ID), u = n.Utility.Util.getValueOfString(t[r].Name), oi.getControl().append(" <option value=" + i + ">" + u + "<\/option>"), i == ou && oi.ctrl.val(ou); oe() } function oe() { try { n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetAttributeSet", null, se) } catch (t) { console.log(t); y[0].style.visibility = "hidden" } } function se(t) { var r, u, i; if (t.length > 0) for (i in t) r = n.Utility.Util.getValueOfInt(t[i].M_AttributeSet_ID), u = n.Utility.Util.getValueOfString(t[i].Name), gt.getControl().append(" <option value=" + r + ">" + u + "<\/option>") } function he(t, i, u) { var e = null, s = 0, o = t.getContext(i, "DateOrdered"), c, f, h, l, a; o != null && o.Length > 0 ? e = System.Convert.ToDateTime(n.Env.parseContext(n.Env.getCtx(), r, "DateOrdered", !1, !1)) : (o = t.getContext(i, "DateInvoiced"), o != null && o.Length > 0 && (e = System.Convert.ToDateTime(n.Env.parseContext(n.Env.getCtx(), r, "DateInvoiced", !1, !1)))); e == null && (c = new Date, e = n.Utility.Util.getValueOfDate(c)); try { if (f = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetPriceListVersion", { PriceList: u }, null), f.length > 0) { for (h in f) l = n.Utility.Util.getValueOfInt(f[h].M_PriceList_Version_ID), a = n.Utility.Util.getValueOfString(f[h].ValidFrom), e > a && (s = l); s == 0 && (s = n.Utility.Util.getValueOfInt(f[0].M_PriceList_Version_ID)) } } catch (v) { console.log(v); y[0].style.visibility = "hidden" } return s } function ce() { ii = !1; si = 0; var t = new n.InfoScanForm(r, !0); t.showDialog(); t.onClose = function (t, i, u) { y[0].style.visibility = "visible"; window.setTimeout(function () { var l, f, h, w, c, b; if (ii = i, si = u, l = n.Env.getCtx().getContext("#AD_Session_ID"), t && t.length > 0) for (f in t) { var a = "", y = "", e = 0, o = 0, s = t[f].VAICNT_Quantity, p = t[f].M_Product_ID, k = t[f].Value; e = t[f].M_AttributeSetInstance_ID; h = t[f].Description; w = t[f].VAICNT_InventoryCountLine_ID; a = t[f].Name; y = t[f].UOM; o = t[f].C_UOM_ID; c = t[f].LineID; s > 0 && (v.length > 0 ? (b = v.map(function (n) { return n._prdID == p && n._Attribute == e && n._uom == o && n._refLineID == c }).indexOf(!0), b > -1 ? v[b]._prodQty += s : v.push({ _prodQty: s, _prdID: p, _prdName: a, _value: k, _uom: o, _uomName: y, _AD_Session_ID: l, _windowNo: r, _RefNo: "", _Attribute: e, _AttributeName: h, _Locator_ID: 0, _IsLotSerial: "N", _countID: w, _refLineID: c })) : v.push({ _prodQty: s, _prdID: p, _prdName: a, _value: k, _uom: o, _uomName: y, _AD_Session_ID: l, _windowNo: r, _RefNo: "", _Attribute: e, _AttributeName: h, _Locator_ID: 0, _IsLotSerial: "N", _countID: w, _refLineID: c }), gr[e] = h) } yu() }, 200) } } function ve() { var f, i, u; for (nt != null && (nt.destroy(), nt = null), f = [], i = 0; i < p.length; i++)u = {}, u.Product = p[i].Product, u.Value = p[i].Value, u.QtyEntered = p[i].QtyEntered, u.UOM = p[i].UOM, u.Attribute = p[i].Attribute, u.ProdID = p[i].M_Product_ID1, u.recid = i + 1, f[i] = u; l = "gridsavedprd" + Math.random(); l = l.replace(".", ""); w2utils.encodeTags(f); nt = t(ri).w2grid({ name: l, recordHeight: 40, show: { toolbar: !0, columnHeaders: !0, lineNumbers: !1, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: [{ field: "Value", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "Value") + "<\/span><\/div>", sortable: !1, size: "120px", min: 100, hidden: !1 }, { field: "Product", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "Product") + "<\/span><\/div>", sortable: !1, size: "20%", min: 150, hidden: !1 }, { field: "QtyEntered", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "QtyEntered") + "<\/span><\/div>", sortable: !1, size: "70px", min: 60, hidden: !1, editable: { type: "float" }, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.QtyEntered); return i.toLocaleString() } }, { field: "UOM", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "UOM") + "<\/span><\/div>", sortable: !1, size: "70px", min: 60, hidden: !1 }, { field: "Attribute", caption: n.Msg.translate(n.Env.getCtx(), "Attribute"), sortable: !1, size: "20%", min: 150, hidden: !1, editable: { type: "custom", ctrl: du, showAll: !0 }, render: function (n) { var r = hu, t = n.Attribute, i = gr[t]; return !i && t > 0 && (i = r.getDisplay(t, !0), gr[t] = i), i } }, { field: "Delete", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "DeleteActivity") + "<\/span><\/div>", sortable: !1, size: "60px", min: 40, hidden: !1, render: function () { return '<div class="vis-info-grid-icowrap"><i class="vis vis-delete title="Delete record" style="opacity: 1;"><\/i><\/div>' } }, { field: "Copy", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "Copy") + "<\/span><\/div>", sortable: !1, size: "60px", min: 40, hidden: !1, render: function () { return '<div class="vis-info-grid-icowrap"><i class="vis vis-new title="Copy record" style="opacity: 1;"><\/i><\/div>' } }, { field: "ProdID", caption: '<div style="text-align: center;" ><span>' + n.Msg.translate(n.Env.getCtx(), "ProdID") + "<\/span><\/div>", sortable: !1, size: "20%", min: 150, hidden: !0 }], records: f, onChange: function (n) { n.column == 2 ? (w2ui[l].records[n.index].QtyEntered = n.value_new, v[n.index]._prodQty = n.value_new, p[n.index].QtyEntered = n.value_new) : n.column == 4 && (w2ui[l].records[n.index].Attribute = n.value_new, v[n.index]._Attribute = n.value_new, p[n.index].Attribute = n.value_new) }, onClick: function (t) { t.column == 5 && nt.records.length > 0 ? (y[0].style.visibility = "visible", v.splice(t.recid - 1, 1), p.splice(t.recid - 1, 1), ff()) : t.column == 6 && nt.records.length > 0 ? (y[0].style.visibility = "visible", p.push({ SrNo: p.length, Product: p[t.recid - 1].Product, Value: p[t.recid - 1].Value, QtyEntered: p[t.recid - 1].QtyEntered, UOM_ID: p[t.recid - 1].UOM_ID, UOM: p[t.recid - 1].UOM, M_Product_ID1: p[t.recid - 1].M_Product_ID1, Attribute: "", AttributeName: "", RefNo: p[t.recid - 1].RefNo }), v[v.length] = { _prodQty: p[p.length - 1].QtyEntered, _prdID: p[p.length - 1].M_Product_ID1, _prdName: p[p.length - 1].Product, _value: p[p.length - 1].Value, _uom: p[p.length - 1].UOM_ID, _uomName: p[p.length - 1].UOM, _AD_Session_ID: n.Env.getCtx().getContext("#AD_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: 0, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 }, ff()) : t.column == 4 && nt.records.length > 0 && n.Env.getCtx().setContext(r, "M_Product_ID", n.Utility.Util.getValueOfInt(p[t.recid - 1].M_Product_ID1)) } }); y[0].style.visibility = "hidden" } function ff() { var i, n, t; for (nt.clear(), i = [], n = 0; n < p.length; n++)t = {}, t.Product = p[n].Product, t.Value = p[n].Value, t.QtyEntered = p[n].QtyEntered, t.UOM = p[n].UOM, t.Attribute = p[n].Attribute, t.ProdID = p[n].M_Product_ID1, t.recid = n + 1, i[n] = t; i.length > 0 && (w2utils.encodeTags(i), nt.add(i)); y[0].style.visibility = "hidden" } function li(t, i, r) { y[0].style.visibility = "hidden"; t && (su = !0); lt.onClose != null && lt.onClose(); ru(); var u = n.Msg.getMsg("RecSaved"); t || (u = r > 0 ? r + " " + n.Msg.getMsg("RecordsNotSaved") : n.Msg.getMsg("ErrorInSaving")); i && i != "" && (u += ", " + i); n.ADialog.info("", !0, u) } function sf() { var b = 0, f = "", k = 0, nt = "", d = 0, c = 0, l = 0, u = 0, a = 0, g = 0, i; d = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "M_Locator_ID", !0)); b = n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 0, "KeyColumnName")); f = n.context.getWindowTabContext(r, 0, "KeyColumnName"); k = n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 1, "KeyColumnName")); nt = n.context.getWindowTabContext(r, 1, "KeyColumnName"); a = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "M_ProductContainer_ID", !0)); dt == 170 && (c = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "M_LocatorTo_ID", !0)), g = n.Utility.Util.getValueOfInt(n.context.getWindowContext(r, "Ref_M_ProductContainerTo_ID", !0))); dt == 146 && (b = n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 1, "KeyColumnName")), k = 0); l = n.Utility.Util.getValueOfInt(b); u = n.Utility.Util.getValueOfInt(k); var e = [], o = [], s = [], p = [], h = [], w = []; if (v.length > 0 && ut.css("display") == "none") { for (i in v) if (e.push(v[i]._prdID), o.push(v[i]._prodQty), p.push(v[i]._RefNo), h.push(v[i]._Attribute), s.push(v[i]._uom), w.push(v[i]._countID), u != 0) break; hi = v.length } else { for (i in ht) if (e.push(ht[i]._prdID), o.push(ht[i]._prodQty), p.push(ht[i]._RefNo), h.push(ht[i]._Attribute), s.push(ht[i]._uom), w.push(ht[i]._countID), u != 0) break; hi = ht.length } iu = hi % et == 0 ? hi / et : Math.ceil(hi / et); iu == 1 ? f == "SAP001_StockTransfer_ID" ? t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/SaveStockTfr", dataType: "json", data: { id: l, keyColumn: f, AD_Table_ID: n.context.getWindowTabContext(r, 1, "AD_Table_ID"), prod: JSON.stringify(e), C_UOM_ID: JSON.stringify(s), listAst: JSON.stringify(h), qty: JSON.stringify(o), locatorTo: c, lineID: u, ContainerID: a }, success: function (n) { var t = n.result; t }, error: function (n, t) { y[0].style.visibility = "hidden"; console.log(t); returnValue } }) : t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/Save", dataType: "json", data: { id: l, keyColumn: f, prod: JSON.stringify(e), C_UOM_ID: JSON.stringify(s), listAst: JSON.stringify(h), qty: JSON.stringify(o), locatorTo: c, lineID: u, InvCountID: JSON.stringify(w), ReferenceNo: JSON.stringify(p), Locator_ID: d, WindowID: dt, ContainerID: a, ContainerToID: g }, success: function (t) { var i = JSON.parse(t); if (i.count == 0) { if (ii) try { n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/DeleteCart", { invCount_ID: si }, null) } catch (r) { console.log(r); li(!0, r.message) } li(!0); return } pu(i); li(!1, cf(), i.count); return }, error: function (n, t) { y[0].style.visibility = "hidden"; console.log(t) } }) : hf(l, f, u, e, o, [], s, p, h, d, c, [], w, a, g) } function hf(i, u, f, e, o, s, h, c, l, a, v, p, w, b, k) { var d = ft.find(".filestatuscounter"); d.text() != "" ? iu == cr ? d.text(hi + " Records Inserted..Please Wait..!!") : d.text(cr * et - lr + " Records Inserted..Please Wait..!!") : de(cr * et); u == "SAP001_StockTransfer_ID" ? t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/SaveStockTfr", dataType: "json", data: { id: i, keyColumn: u, AD_Table_ID: n.context.getWindowTabContext(r, 1, "AD_Table_ID"), prod: JSON.stringify(e.splice(0, et)), C_UOM_ID: JSON.stringify(h.splice(0, et)), listAst: JSON.stringify(l.splice(0, et)), qty: JSON.stringify(o.splice(0, et)), locatorTo: v, lineID: f, ContainerID: b }, success: function (n) { var t = n.result; t }, error: function (n, t) { y[0].style.visibility = "hidden"; console.log(t); returnValue } }) : t.ajax({ type: "POST", url: n.Application.contextUrl + "InfoProduct/Save", dataType: "json", data: { id: i, keyColumn: u, prod: JSON.stringify(e.splice(0, et)), C_UOM_ID: JSON.stringify(h.splice(0, et)), listAst: JSON.stringify(l.splice(0, et)), qty: JSON.stringify(o.splice(0, et)), locatorTo: v, lineID: f, InvCountID: JSON.stringify(w.splice(0, et)), ReferenceNo: c, Locator_ID: a, WindowID: dt, ContainerID: b, ContainerToID: k }, success: function (t) { var r = JSON.parse(t); if (cr++, iu == cr) { if (lr == 0) { if (ii) try { n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/DeleteCart", { invCount_ID: si }, null) } catch (y) { console.log(y); li(!0, y.message) } li(!0); return } pu(r); lr += r.count; li(!1, cf(), lr); return } r.count == 0 || (pu(r), lr += r.count); hf(i, u, f, e, o, s, h, c, l, a, v, p, w, b, k) }, error: function (n, t) { y[0].style.visibility = "hidden"; console.log(t) } }) } function cf() { var t = "", n; if (wt.length > 0) for (n = 0; n < wt.length; n++)n != 0 && (t += " ::: "), t += wt[n] + " --> " + ci[n]; return wt = [], ci = [], t } function pu(n) { var t, i; if (n.errorKeys.length > 0) if (wt.length > 0) for (t = 0; t < n.errorKeys.length; t++)i = wt.indexOf(n.errorKeys[t]), i >= 0 ? ci[i] = ci[i] + ", " + n.errorProds[t] : (wt.push(n.errorKeys[t]), ci.push(n.errorProds[t])); else wt = n.errorKeys, ci = n.errorProds; else wt.push(n.error) } function ye() { lt.onClose != null && lt.onClose(); ru() } function de(n) { tu = t("<div class='filestatus'> <label class='filestatuscounter'>" + n + " Records Inserted..Please Wait..!!<\/lable><\/div>"); tu.css({ position: "absolute", width: "98%", height: "97%", "text-align": "center", "z-index": "999" }); tu[0].style.visibility = "visible"; ft.append(tu) } function ge() { lu = t('<ul class="vis-statusbar-ul">'); au = t('<li class="flex-fill"><div class="vis-ad-w-p-s-result"><span><\/span><\/div><\/li>'); at = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="' + n.Msg.getMsg("FirstPage") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); vt = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.getMsg("PageUp") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); g = t("<select>"); nu = t("<li>").append(g); yt = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.getMsg("PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); pt = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="' + n.Msg.getMsg("LastPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); gu = au.find(".vis-ad-w-p-s-result").find("span"); lu.append(au).append(at).append(vt).append(nu).append(yt).append(pt); no() } function no() { at.on("click", function () { if (t(this).css("opacity") == "1" && (y[0].style.visibility = "visible", h && !st && ut.show(), ct(!0, 1), w.length > 0)) { for (var n = 0; n < w.length; n++)w2ui["subgrid-" + w[n]].destroy(); w = [] } }); vt.on("click", function () { if (t(this).css("opacity") == "1" && (y[0].style.visibility = "visible", h && !st && ut.show(), ct(!0, parseInt(g.val()) - 1), w.length > 0)) { for (var n = 0; n < w.length; n++)w2ui["subgrid-" + w[n]].destroy(); w = [] } }); yt.on("click", function () { if (t(this).css("opacity") == "1" && (y[0].style.visibility = "visible", h && !st && ut.show(), ct(!0, parseInt(g.val()) + 1), w.length > 0)) { for (var n = 0; n < w.length; n++)w2ui["subgrid-" + w[n]].destroy(); w = [] } }); pt.on("click", function () { if (t(this).css("opacity") == "1" && (y[0].style.visibility = "visible", h && !st && ut.show(), ct(!0, parseInt(g.find("Option:last").val())), w.length > 0)) { for (var n = 0; n < w.length; n++)w2ui["subgrid-" + w[n]].destroy(); w = [] } }); g.on("change", function () { if (y[0].style.visibility = "visible", h && !st && ut.show(), ct(!0, g.val()), w.length > 0) { for (var n = 0; n < w.length; n++)w2ui["subgrid-" + w[n]].destroy(); w = [] } }) } function to(n) { var i, o; g = null; nu.find("select").remove(); g = t("<select>"); nu.append(g); g.on("change", function () { y[0].style.visibility = "visible"; h && !st && ut.show(); ct(!0, g.val()) }); if (n.TotalPage > 0) { for (i = 0; i < n.TotalPage; i++)g.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); g.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (yt.css("opacity", "1"), pt.css("opacity", "1")) : (yt.css("opacity", "0.6"), pt.css("opacity", "0.6")); n.CurrentPage > 1 ? (at.css("opacity", "1"), vt.css("opacity", "1")) : (at.css("opacity", "0.6"), vt.css("opacity", "0.6")); n.TotalPage == 1 && (at.css("opacity", "0.6"), vt.css("opacity", "0.6"), yt.css("opacity", "0.6"), pt.css("opacity", "0.6")) } else at.css("opacity", "0.6"), vt.css("opacity", "0.6"), yt.css("opacity", "0.6"), pt.css("opacity", "0.6"); var s = n.CurrentPage, e = n.PageSize, r = n.TotalRecords, u = (s - 1) * e, f = u + e; f > r && (f = r); r == 0 && (u -= 1); o = bf + " " + (u + 1) + "-" + f + " " + kf + " " + r; gu.text(o) } function io(i) { var r; if (i != null) { var u = 0, f = n.Utility.Util.getValueOfInt(w2ui[l].records[i.recid - 1].M_PRODUCT_ID), e = n.Utility.Util.getValueOfInt(w2ui[l].records[i.recid - 1].M_WAREHOUSE_ID), o = ""; for (r = 0; r < b.length; r++)b[r].Ctrl.colName == "M_AttributeSetInstance_ID" && (u = n.Utility.Util.getValueOfInt(b[r].Ctrl.value)); for (r = 0; r < b.length; r++)b[r].Ctrl.colName == "AttributeCode" && (o = b[r].Ctrl.getValue()); f > 0 && e > 0 && t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetVariants", dataType: "json", type: "POST", async: !1, data: { M_Product_ID: f, M_Warehouse_ID: e, ParentRec_ID: i.recid, M_AttributeSetInstance_ID: u, AttributeCode: o }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); y[0].style.visibility = "hidden"; return }, success: function (n) { var t = JSON.parse(n); ro(t) } }) } } function ro(n) { n != null && (nf = n) } var rf, ar, ef, of; this.onClose = null; var ft = t("<div>"), lf = !0, ai = t("<div class='vis-info-subroot'>"), af = null, vf = null, yf = null, vi = null, yi = null, ri = null, ui = null, pi = null, vr = null, yr = null, pr = null, wr = null, fi = null, ei = null, bt = null, br = null, kr = null, kt = null, wi = null, ut = null, bi = null, ki = null, dr = null, di = null, y = null, pf = null, b = [], it = null, nt = null, lt = this, gi = "", dt = 0, a = [], gr = [], wf = null, l = null, nr = null, tr = null, ir = null, rr = null, ur = null, fr = null, er = null, or = null, sr = null, gt = null, ni = null, uu = null, fu = [], w = [], eu = n.DisplayType.GetNumberFormat(n.DisplayType.Amount), hr = n.Env.isDecimalPoint(), tt = null, rt = null, ti = null, oi = null, ot = t("<table>"), k = null, wu = null, bu = null, ou = null, v = [], p = [], su = !1, st = !1, ku = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()), ii = !1, si = 0, d = null, du = null, hu = null, cu, lu, at, vt, nu, yt, pt, g, au, gu = null, bf = n.Msg.getMsg("ShowingResult"), kf = n.Msg.getMsg("of"), tu, hi = 0, iu = 0, cr = 0, lr = 0, et = 500, wt = [], ci = [], nf = [], df = [], ht = []; gf(); te(u, f); rf = n.context.getWindowTabContext(r, 0, "AD_Tab_ID"); dt = n.dataContext.getJSONRecord("InfoProduct/GetWindowID", rf.toString()); dt == 146 || n.context.getContextAsInt(r, n.context.getWindowTabContext(r, 1, "KeyColumnName")) != 0 && (st = !0); (!h || st) && (ut.hide(), kt.hide(), kr.hide(), wi.hide()); ar = "M_Product p LEFT OUTER JOIN M_ProductPrice pr ON (p.M_Product_ID=pr.M_Product_ID AND pr.IsActive='Y') LEFT OUTER JOIN M_PriceList_Version plv ON (pr.M_PriceList_Version_ID=plv.M_PriceList_Version_ID) LEFT OUTER JOIN M_AttributeSet pa ON (p.M_AttributeSet_ID=pa.M_AttributeSet_ID) LEFT OUTER JOIN C_UOM c ON (p.C_UOM_ID=c.C_UOM_ID)"; ne(); var le = function () { ii = !1; si = 0; var t = new n.InfoScanForm(r, !1); t.showDialog(); t.onClose = function (t, i, u) { var l, f, e, c, k; if (y[0].style.visibility = "visible", ii = i, si = u, l = n.Env.getCtx().getContext("#AD_Session_ID"), t && t.length > 0) for (f in t) { var a = "", p = "", o = 0, s = t[f].M_AttributeSetInstance_ID, w = t[f].Description, d = t[f].VAICNT_InventoryCountLine_ID, h = t[f].VAICNT_Quantity, b = t[f].M_Product_ID, g = t[f].Value; a = t[f].Name; p = t[f].UOM; o = t[f].C_UOM_ID; e = t[f].VAICNT_ReferenceNo; e == "" && (e = "null"); c = t[f].LineID; h > 0 && (v.length > 0 ? (k = v.map(function (n) { return n._prdID == b && n._Attribute == s && n._uom == o && n._refLineID == c }).indexOf(!0), k > -1 ? v[k]._prodQty += h : v.push({ _prodQty: h, _prdID: b, _prdName: a, _value: g, _uom: o, _uomName: p, _AD_Session_ID: l, _windowNo: r, _RefNo: e, _Attribute: s, _AttributeName: w, _Locator_ID: 0, _IsLotSerial: "N", _countID: d, _refLineID: c })) : v.push({ _prodQty: h, _prdID: b, _prdName: a, _value: g, _uom: o, _uomName: p, _AD_Session_ID: l, _windowNo: r, _RefNo: e, _Attribute: s, _AttributeName: w, _Locator_ID: 0, _IsLotSerial: "N", _countID: d, _refLineID: c }), gr[s] = w) } yu() } }, ae = function () { if (y[0].style.visibility = "visible", be(), ct(!0, g.val()), w.length > 0) { for (var n = 0; n < w.length; n++)w2ui["subgrid-" + w[n]].destroy(); w = [] } v.length > 0 ? kt.prop("disabled", !1) : kt.prop("disabled", !0); a = [] }, yu = function () { var i = [], r = [], u = [], f = [], e = [], o = [], s = [], h = [], c = [], t, n; p = []; ut.hide(); for (t in v) i.push(v[t]._prdID), f.push(v[t]._prdName), r.push(v[t]._value), u.push(v[t]._prodQty), c.push(v[t]._RefNo), s.push(v[t]._Attribute), h.push(v[t]._AttributeName), e.push(v[t]._uom), o.push(v[t]._uomName); if (i.length > 0) { for (n = 0; n < i.length; n++)p.push({ SrNo: n, Product: f[n], Value: r[n], QtyEntered: u[n], UOM_ID: e[n], UOM: o[n], M_Product_ID1: i[n], Attribute: s[n], AttributeName: h[n], RefNo: c[n] }); ve() } y[0].style.visibility = "hidden" }; ef = function () { var n, r, i, f, e, u; if (y[0].style.visibility = "visible", h && v.length > 0 && ut.css("display") == "none") { if (a = [], n = w2ui[l].getSelection(), r = v, n.length > 0) { for (r = [], i = 0; i < n.length; i++)f = w2ui[l].records[n[i] - 1].ProdID, e = w2ui[l].records[n[i] - 1].Attribute, r.push(t.grep(v, function (n) { return n._prdID == f && n._Attribute == e })[0]); v = r } sf(v) } else if (h && w2ui[l].getSelection().length > 1 && ut.css("display") == "block") ht = of(), sf(ht); else { a = []; u = w2ui[l].getSelection(); for (item in u) a.indexOf(w2ui[l].get(u[item])[gi]) == -1 && a.push(w2ui[l].get(u[item])[gi]); y[0].style.visibility = "hidden"; lt.onClose != null && lt.onClose(); ru() } }; of = function () { var i = w2ui[l].getSelection(), u, t, e, o, f; if (i.length > 0) for (u = [], t = 0; t < i.length; t++)w2ui[l].records[i[t] - 1].QTYENTERED > 0 && (e = w2ui[l].records[i[t] - 1].M_PRODUCT_ID, o = w2ui[l].records[i[t] - 1].M_AttributeSetInstance_ID, u.length > 0 ? (f = u.map(function (n) { return n._prdID == e && n._Attribute == o }).indexOf(!0), f > -1 ? u[f]._prodQty += qty : u.push({ _prodQty: w2ui[l].records[i[t] - 1].QTYENTERED, _prdID: w2ui[l].records[i[t] - 1].M_PRODUCT_ID, _prdName: w2ui[l].records[i[t] - 1].NAME, _value: w2ui[l].records[i[t] - 1].NAME, _uom: w2ui[l].records[i[t] - 1].C_UOM_ID, _uomName: w2ui[l].records[i[t] - 1].UOM, _AD_Session_ID: n.Env.getCtx().getContext("#AD_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: w2ui[l].records[i[t] - 1].M_AttributeSetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })) : u.push({ _prodQty: w2ui[l].records[i[t] - 1].QTYENTERED, _prdID: w2ui[l].records[i[t] - 1].M_PRODUCT_ID, _prdName: w2ui[l].records[i[t] - 1].NAME, _value: w2ui[l].records[i[t] - 1].NAME, _uom: w2ui[l].records[i[t] - 1].C_UOM_ID, _uomName: w2ui[l].records[i[t] - 1].UOM, _AD_Session_ID: n.Env.getCtx().getContext("#AD_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: w2ui[l].records[i[t] - 1].M_AttributeSetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })); return u }; this.show = function () { t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetInfoColumns", dataType: "json", error: function () { alert(n.Msg.getMsg("ERRORGettingSearchCols")); y[0].style.visibility = "hidden" }, success: function (t) { if (it = jQuery.parseJSON(t), it == null) { alert(n.Msg.getMsg("ERRORGettingSearchCols")); y[0].style.visibility = "hidden"; return } ft.dialog({ width: 1020, height: 500, title: n.Msg.translate(n.Env.getCtx(), "InfoProduct"), resizable: !1, modal: !0, closeText: n.Msg.getMsg("close"), close: ye }); c != null && c.length > 0 && (d = n.Env.parseContext(n.Env.getCtx(), r, c, !1, !1)); ct(!0, g.val()) } }) }; var ct = function (i, r) { var p, e, f, g, nt; if (h && w2ui[l]) { p = w2ui[l].getSelection(); for (e in p) a.indexOf(w2ui[l].get(p[e])[gi]) == -1 && a.push(w2ui[l].get(p[e])) } we(); var c = "SELECT ", v = "", w = 0, tt = t.makeArray(it).length; for (e in it) w = it[e].AD_Reference_ID, c += w == n.DisplayType.YesNo ? " ( CASE " + it[e].ColumnSQL + " WHEN 'Y' THEN  'True' ELSE 'False'  END ) " + it[e].ColumnName : it[e].ColumnSQL + " ", w == n.DisplayType.ID && it[e].ColumnName.toUpperCase() == "M_PRODUCT_ID" && (gi = it[e].ColumnName.toUpperCase()), tt - 1 == e || (c += ", "); if (i == !0) { var s = " w.AD_Client_ID = " + n.context.getAD_Client_ID(), u = null, k = !1; for (ar = "M_Product p LEFT OUTER JOIN M_ProductPrice pr ON (p.M_Product_ID=pr.M_Product_ID AND pr.IsActive='Y') LEFT OUTER JOIN M_PriceList_Version plv ON (pr.M_PriceList_Version_ID=plv.M_PriceList_Version_ID) LEFT OUTER JOIN M_AttributeSet pa ON (p.M_AttributeSet_ID=pa.M_AttributeSet_ID) LEFT OUTER JOIN C_UOM c ON (p.C_UOM_ID=c.C_UOM_ID)", f = 0; f < b.length; f++)(u = b[f].Ctrl.getValue(), u != null && u.length != 0 && u != 0) && (b[f].Ctrl.displayType == 10 && (u = String(u).indexOf("%") == 0 ? String(u).replace("%", "") : "" + u, String(u).lastIndexOf("") == String(u).length || (u = u + ""), u = n.DB.to_string(u)), b[f].Ctrl.colName == "Value" ? s += " AND UPPER(p." + b[f].ColumnName + ") LIKE " + u.toUpperCase() : b[f].Ctrl.colName == "Name" ? s += " AND UPPER(p." + b[f].ColumnName + ") LIKE " + u.toUpperCase() : b[f].Ctrl.colName == "UPC" ? (k = !0, s += " AND (UPPER(patr.UPC) LIKE " + u.toUpperCase() + " OR UPPER(p.UPC) LIKE " + u.toUpperCase() + " OR UPPER(mr.UPC) LIKE " + u.toUpperCase() + " OR UPPER(uc.UPC) LIKE " + u.toUpperCase() + ")") : b[f].Ctrl.colName == "SKU" ? s += " AND UPPER(p." + b[f].ColumnName + ") LIKE " + u.toUpperCase() : b[f].Ctrl.colName == "M_Warehouse_ID" ? n.Utility.Util.getValueOfInt(u) != 0 && (s += " AND w.M_Warehouse_ID=" + n.Utility.Util.getValueOfInt(u)) : b[f].Ctrl.colName == "M_PriceList_Version_ID" ? n.Utility.Util.getValueOfInt(u) != 0 && (s += " AND pr.M_PriceList_Version_ID=" + n.Utility.Util.getValueOfInt(u)) : b[f].Ctrl.colName == "M_AttributeSet_ID" ? n.Utility.Util.getValueOfInt(u) != 0 && (s += " AND p.M_AttributeSet_ID=" + n.Utility.Util.getValueOfInt(u)) : b[f].Ctrl.colName == "AttributeCode" && (s += " AND p.M_Product_ID in (SELECT distinct M_Product_ID from M_ProductAttributes WHERE UPPER(UPC) LIKE '" + u.toUpperCase() + "')")); k && (ar += " LEFT OUTER JOIN M_manufacturer mr ON (p.M_Product_ID=mr.M_Product_ID) LEFT OUTER JOIN M_ProductAttributes patr ON (p.M_Product_ID=patr.M_Product_ID) LEFT OUTER JOIN C_UOM_Conversion uc ON (p.M_Product_ID=uc.M_Product_ID)"); c += " FROM " + ar + " JOIN M_Warehouse w ON (1=1)"; dt == 181 && d != null && d.length > 0 && (d += " AND (p.Discontinued = 'N' OR p.DiscontinuedBy > sysdate )"); s.length > 1 ? (v += " WHERE " + s, d != null && d.length > 0 && (v += " AND " + d.replace(/M_Product\./g, "p."))) : d != null && d.length > 0 && (v += " WHERE " + d.replace(/M_Product\./g, "p.")) } else c += " FROM " + ar + " JOIN M_Warehouse w ON (1=1)", v += d != null && d.length > 0 && d.trim().toUpperCase().startsWith("WHERE") ? " " + d.replace(/M_Product\./g, "p.") + " AND " + o + "_ID=-1" : d != null && d.length > 0 ? " WHERE p." + o + "_ID=-1 AND " + d.replace(/M_Product\./g, "p.") : " WHERE p." + o + "_ID=-1"; r || (r = 1); g = n.secureEngine.encrypt(c); nt = n.secureEngine.encrypt(v); t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetData", dataType: "json", type: "POST", data: { sql: g, where: nt, tableName: o, pageNo: r, ForMobile: ku }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); y[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { y[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); y[0].style.visibility = "hidden"; return } to(i.pSetting); pe(i.data) } }) }, pe = function (i) { var r, o, s, f; if (i == null) { alert(n.Msg.getMsg("NoDataFound")); y[0].style.visibility = "hidden"; return } var e = [], c = [], u = null; for (f in i) r = { resizable: !0 }, u = it[f].AD_Reference_ID, r.caption = it[f].Name, r.field = it[f].ColumnName.toUpperCase(), r.columnName = it[f].ColumnName.toUpperCase(), r.sortable = !0, r.hidden = !1, r.size = "100px", n.DisplayType.IsNumeric(u) ? (r.render = u == n.DisplayType.Integer ? "int" : function (t, i, r) { var u = n.Utility.Util.getValueOfDecimal(t[e[r].field]); return u.toLocaleString(undefined, { minimumFractionDigits: 2 }) }, it[f].ColumnName.toUpperCase() == "QTYENTERED" && h && !st && (r.editable = { type: "number" }, r.render = function (n, t, i) { var r = n[e[i].field]; return r = uf(event, r), parseFloat(r).toLocaleString(undefined, { minimumFractionDigits: 2 }) })) : n.DisplayType.IsDate(u) ? r.render = function (n, t, i) { var r = n[e[i].field]; return r ? new Date(r).toLocaleDateString() : "" } : u == n.DisplayType.Location || u == n.DisplayType.Locator ? r.render = "int" : u == n.DisplayType.Account ? r.render = "int" : u == n.DisplayType.PAttribute ? r.render = "int" : u == n.DisplayType.Button ? r.render = function () { return "<div>button<\/div>" } : u == n.DisplayType.Image ? r.render = function () { return "<div>Image<\/div>" } : n.DisplayType.IsLOB(u) && (r.render = function () { return "<div>[Lob-blob]<\/div>" }), e[f] = r; for (e[e.length] = { field: "M_AttributeSetInstance_ID", caption: "M_AttributeSetInstance_ID", size: "150px", hidden: !0 }, o = 0; o < i[0].RowCount; o++) { s = {}; for (f in i) s[i[f].ColumnName.toUpperCase()] = i[f].Values[o]; s.M_AttributeSetInstance_ID = 0; s.recid = o + 1; c[o] = s } l = "gridPrdInfodata" + Math.random(); l = l.replace(".", ""); w2utils.encodeTags(c); nt = t(ri).w2grid({ name: l, recordHeight: 40, show: { toolbar: !0, columnHeaders: !0, lineNumbers: !1, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: e, records: c, onExpand: function (n) { y[0].style.visibility = "visible"; io(n); w2ui.hasOwnProperty("subgrid-" + n.recid) && w2ui["subgrid-" + n.recid].destroy(); w.indexOf(n.recid) == -1 && w.push(n.recid); t("#" + n.box_id).css({ margin: "0px", padding: "0px", width: "100%", height: "105px" }); setTimeout(function () { t("#" + n.box_id).w2grid({ name: "subgrid-" + n.recid, show: { columnHeaders: !0, selectColumn: !0 }, fixedBody: !0, columns: fu, records: nf, onChange: function (n) { var u = -1, f = w2ui[n.target].records[n.index].ParentRec_ID, r, i, t; if (a.length > 0) { for (r in a) if (a[r].M_PRODUCT_ID == w2ui[l].records[f - 1].M_PRODUCT_ID && a[r].M_AttributeSetInstance_ID == w2ui[n.target].records[n.index].M_AttributeSetInstance_ID) { u = r; break } u > -1 ? a[u].QTYENTERED = n.value_new : (i = w2ui[l].records[f - 1], t = JSON.parse(JSON.stringify(i)), t.M_AttributeSetInstance_ID = w2ui[n.target].records[n.index].M_AttributeSetInstance_ID, t.QTYENTERED = n.value_new, a.push(t)) } else i = w2ui[l].records[f - 1], t = JSON.parse(JSON.stringify(i)), t.M_AttributeSetInstance_ID = w2ui[n.target].records[n.index].M_AttributeSetInstance_ID, t.QTYENTERED = n.value_new, a.push(t) } }); w2ui["subgrid-" + n.recid].resize(); y[0].style.visibility = "hidden" }, 500) }, onEditField: function (n) { if (id = n.recid, n.column == 5) { w2ui[l].records[n.index].QTYENTERED = uf(n, w2ui[l].records[n.index].QTYENTERED); var i = eu.GetFormatAmount(w2ui[l].records[n.index].QTYENTERED, "init", hr); w2ui[l].records[n.index].QTYENTERED = eu.GetConvertedString(i, hr); t("#grid_" + nt.name + "_rec_" + id).keydown(function (n) { if (hr || n.keyCode != 190 && n.keyCode != 110) { if (hr && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) ? n.target.value.indexOf(".") > -1 && (n.target.value = n.target.value.replace(".", "")) : n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && n.target.value.indexOf(",") > -1 && (n.target.value = n.target.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } }, onChange: function (n) { var i = -1, r = eu.GetConvertedNumber(n.value_new, hr), t; if (w2ui[l].records[n.index].QTYENTERED = r.toFixed(2), a.length > 0) { for (t in a) if (a[t].M_PRODUCT_ID == w2ui[l].records[n.index].M_PRODUCT_ID && a[t].M_AttributeSetInstance_ID == 0) { i = t; break } i > -1 ? a[i].QTYENTERED = r.toFixed(2) : a.push(w2ui[l].records[n.index]) } else a.push(w2ui[l].records[n.index]) } }); w2ui[l].hideColumn("M_PRODUCT_ID"); w2ui[l].hideColumn("C_UOM_ID"); w2ui[l].hideColumn("UOM"); w2ui[l].hideColumn("M_WAREHOUSE_ID"); w2ui[l].hideColumn("M_PRICELIST_VERSION_ID"); (!h || st) && w2ui[l].hideColumn("QTYENTERED"); y[0].style.visibility = "hidden" }, we = function () { nt != null && nt.destroy(); nt = null }; this.getSelectedValues = function () { return a }; this.getRefreshStatus = function () { return su }; var be = function () { if (h && (a.length > 0 || w2ui[l].getSelection().length > 0)) ke(); else return }, ke = function () { var u, y, f, o, s, h, e, t, c, i; if (w2ui[l].getSelection().length > 0) { u = w2ui[l].getSelection(); for (t in u) if (y = w2ui[l].get(u[t]).M_PRODUCT_ID, f = "subgrid-" + w2ui[l].get(u[t]).recid, w2ui[f] != undefined) if (w2ui[f].getSelection().length > 0) { o = w2ui[f].getSelection(); for (s in o) if (a.length > 0) if (i = a.map(function (n) { return n.M_PRODUCT_ID == y && n.M_AttributeSetInstance_ID == w2ui[f].records[o[s] - 1].M_AttributeSetInstance_ID }).indexOf(!0), i > -1) continue; else h = w2ui[l].get(u[t]), e = JSON.parse(JSON.stringify(h)), e.M_AttributeSetInstance_ID = w2ui[f].records[o[s] - 1].M_AttributeSetInstance_ID, e.QTYENTERED = w2ui[f].records[o[s] - 1].Quantity, a.push(e); else h = w2ui[l].get(u[t]), e = JSON.parse(JSON.stringify(h)), e.M_AttributeSetInstance_ID = w2ui[f].records[o[s] - 1].M_AttributeSetInstance_ID, e.QTYENTERED = w2ui[f].records[o[s] - 1].Quantity, a.push(e) } else if (a.length > 0) if (i = a.map(function (n) { return n.M_PRODUCT_ID == y && n.M_AttributeSetInstance_ID == 0 }).indexOf(!0), i > -1) continue; else a.push(w2ui[l].get(u[t])); else a.push(w2ui[l].get(u[t])); else if (a.length > 0) if (i = a.map(function (n) { return n.M_PRODUCT_ID == y && n.M_AttributeSetInstance_ID == 0 }).indexOf(!0), i > -1) continue; else a.push(w2ui[l].get(u[t])); else a.push(w2ui[l].get(u[t])) } if (a.length > 0) for (t in a) c = a[t].QTYENTERED, c > 0 && (v.length > 0 ? (i = v.map(function (n) { return n._prdID == a[t].M_PRODUCT_ID && n._Attribute == a[t].M_AttributeSetInstance_ID }).indexOf(!0), i > -1 ? v[i]._prodQty += c : v.push({ _prodQty: c, _prdID: a[t].M_PRODUCT_ID, _prdName: a[t].NAME, _value: a[t].VALUE, _uom: a[t].C_UOM_ID, _uomName: a[t].UOM, _AD_Session_ID: n.Env.getCtx().getContext("#AD_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: a[t].M_AttributeSetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })) : v.push({ _prodQty: c, _prdID: a[t].M_PRODUCT_ID, _prdName: a[t].NAME, _value: a[t].VALUE, _uom: a[t].C_UOM_ID, _uomName: a[t].UOM, _AD_Session_ID: n.Env.getCtx().getContext("#AD_Session_ID"), _windowNo: r, _RefNo: "", _Attribute: a[t].M_AttributeSetInstance_ID, _AttributeName: "", _Locator_ID: 0, _IsLotSerial: "N", _countID: 0 })) }, ru = function () { if (ft.off("keyup"), bi.off("click"), ki.off("click"), di.off("click"), at.off("click"), vt.off("click"), yt.off("click"), pt.off("click"), g.off("change"), at = vt = yt = pt = g = null, ri = null, yi = null, nt != null && nt.destroy(), nt = null, lf = null, ai = null, af = null, vf = null, yf = null, vi = null, yi = null, ri = null, ui = null, pi = null, fi = null, ei = null, bt = null, bi = null, ki = null, dr = null, di = null, wi = null, y = null, pf = null, b = null, it = null, nt = null, lt = null, gi = null, a = null, wf = null, v = null, p = null, su = !1, ku = null, ii = null, ft != null && (ft.dialog("destroy"), ft.remove()), ft = null, this.btnOKClick = null, this.displaySearchCol = null, this.displayData = null, this.loadData = null, this.disposeComponent = null, this.disposeDataSec = null, this.getSelectedValues = null, this.refreshUI = null, w.length > 0) { for (var n = 0; n < w.length; n++)w2ui["subgrid-" + w[n]].destroy(); w = [] } } } n.infoProduct = i }(VIS, jQuery), function (n, t) { function i(i, r) { function ui() { var r, l; s.css("width", "100%"); s.css("height", "100%"); s.css("position", "relative"); ot.css("width", "100%"); it = t("<div class='vis-info-l-s-wrap vis-pad-0 vis-leftsidebarouterwrap'>"); yt = t("<div class='vis-info-l-s-content'>"); it.append(yt); pt = t("<div class='vis-info-datasec'>"); g = t("<div class='vis-info-btnsec vis-just-cont-end'>"); st.append(it); st.append(pt); st.append(g); lt = n.Msg.translate(n.Env.getCtx(), "Name"); lt.indexOf("&") > -1 && (lt = lt.replace("&", "")); wt = n.Msg.translate(n.Env.getCtx(), "ReferenceNo"); wt.indexOf("&") > -1 && (wt = lblUPCtxt.replace("&", "")); at = n.Msg.translate(n.Env.getCtx(), "FromDate"); at.indexOf("&") > -1 && (at = at.replace("&", "")); vt = n.Msg.translate(n.Env.getCtx(), "ToDate"); vt.indexOf("&") > -1 && (vt = vt.replace("&", "")); ut = n.Msg.getMsg("Cancel"); ut.indexOf("&") > -1 && (ut = ut.replace("&", "")); rt = n.Msg.getMsg("Search"); rt.indexOf("&") > -1 && (rt = rt.replace("&", "")); ft = n.Msg.getMsg("Ok"); ft.indexOf("&") > -1 && (ft = ft.replace("&", "")); v = t("<div class='vis-info-btnswrap'>"); ht = t("<div class='vis-info-ls-btnswrap'>"); c = t("<tr>"); ot.append(c); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(lt); c.append(f); f.append(o); o.append(u); r = {}; h = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 100, null, null, !1); r.Ctrl = h; r.AD_Reference_ID = 10; r.ColumnName = "Name"; l = t("<td>"); u.append(h.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); a.push(r); c = t("<tr>"); ot.append(c); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(wt); c.append(f); f.append(o); o.append(u); r = {}; h = new n.Controls.VTextBox("Reference", !1, !1, !0, 50, 100, null, null, !1); r.Ctrl = h; r.AD_Reference_ID = 10; r.ColumnName = "Reference"; l = t("<td>"); u.append(h.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); a.push(r); c = t("<tr>"); ot.append(c); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(at); c.append(f); f.append(o); o.append(u); r = {}; h = new n.Controls.VDate("TrxFromDate", !1, !1, !0, n.DisplayType.Date, n.Msg.translate("FromDate")); r.Ctrl = h; r.AD_Reference_ID = 10; r.ColumnName = "TrxFromDate"; l = t("<td>"); u.append(h.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); a.push(r); c = t("<tr>"); ot.append(c); var f = t("<td>"), o = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'); nt = t("<label class='VIS_Pref_Label_Font'>").append(vt); c.append(f); f.append(o); o.append(u); r = {}; h = new n.Controls.VDate("TrxToDate", !1, !1, !0, n.DisplayType.Date, n.Msg.translate("ToDate")); r.Ctrl = h; r.AD_Reference_ID = 10; r.ColumnName = "TrxToDate"; l = t("<td>"); u.append(h.getControl().attr("data-placeholder", "").attr("placeholder", " ")); u.append(nt); a.push(r); yt.append(ot); et = t("<button class='VIS_Pref_btn-2'>").append(ut); tt = t("<button class='VIS_Pref_btn-2'>").append(ft); ct = t("<button class='VIS_Pref_btn-2'>").append(rt); v.append(et); v.append(tt); v.append(t('<div><input type="checkbox" id="chkDelCart_' + i + '" ><span>' + n.Msg.getMsg("DeleteCart") + "<\/span>")); ht.append(ct); it.append(ht); g.append(v); dt = t('<div class="vis-info-pagingwrp">'); si(); dt.append(gt); v.append(et); v.append(tt); ht.append(ct); it.append(ht); g.append(ni); g.append(dt); g.append(v); e = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); e[0].style.visibility = "visible"; kt = g.find("#chkDelCart_" + i); s.append(st); s.append(e) } function fi() { if (!n.Application.isMobile) s.on("keyup", function (n) { n.keyCode === 13 && (e[0].style.visibility = "visible", o = [], u.selectNone(), d(!0, f.val())) }); et.on("click", function () { l.dispose() }); tt.on("click", function () { oi() }); ct.on("click", function () { e[0].style.visibility = "visible"; o = []; u.selectNone(); d(!0, 1) }) } function si() { gt = t('<ul class="vis-statusbar-ul">'); p = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="First Page" style="opacity: 0.6;"><\/i><\/div><\/li>'); w = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="Page Up" style="opacity: 0.6;"><\/i><\/div><\/li>'); f = t("<select>"); bt = t("<li>").append(f); b = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="Page Down" style="opacity: 0.6;"><\/i><\/div><\/li>'); k = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="Last Page" style="opacity: 0.6;"><\/i><\/div><\/li>'); gt.append(p).append(w).append(bt).append(b).append(k); hi() } function hi() { p.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, 1)) }); w.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, parseInt(f.val()) - 1)) }); b.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, parseInt(f.val()) + 1)) }); k.on("click", function () { t(this).css("opacity") == "1" && (e[0].style.visibility = "visible", d(!0, parseInt(f.find("Option:last").val()))) }); f.on("change", function () { e[0].style.visibility = "visible"; d(!0, f.val()) }) } function ci(n) { f = null; bt.find("select").remove(); f = t("<select>"); bt.append(f); f.on("change", function () { e[0].style.visibility = "visible"; d(!0, f.val()) }); if (n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)f.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); f.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (b.css("opacity", "1"), k.css("opacity", "1")) : (b.css("opacity", "0.6"), k.css("opacity", "0.6")); n.CurrentPage > 1 ? (p.css("opacity", "1"), w.css("opacity", "1")) : (p.css("opacity", "0.6"), w.css("opacity", "0.6")); n.TotalPage == 1 && (p.css("opacity", "0.6"), w.css("opacity", "0.6"), b.css("opacity", "0.6"), k.css("opacity", "0.6")) } else p.css("opacity", "0.6"), w.css("opacity", "0.6"), b.css("opacity", "0.6"), k.css("opacity", "0.6") } this.onClose = null; this.arrListColumns = []; var s = t("<div>"), ti = !0, st = t("<div class='vis-info-subroot'>"), it = null, yt = null, pt = null, g = null, rt = null, ut = null, ft = null, v = null, ht = null, et = null, tt = null, ct = null, kt = null, ni = null, e = null, u = null, l = this, y = 0, lt = null, wt = null, at = null, vt = null, nt = null, h = null, ot = t("<table>"), c = null, ii = !1, a = [], dt, gt, p, w, bt, b, k, f, o = [], li = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()), ri = n.context.getWindowTabContext(i, 0, "AD_Tab_ID"); y = n.dataContext.getJSONRecord("InfoProduct/GetWindowID", ri.toString()); ui(); fi(); var d = function (f, s) { var p, c, l, v, g; if (u) { p = u.getSelection(); for (item in p) o.indexOf(u.get(p[item]).count_ID) == -1 && o.push(u.get(p[item]).count_ID) } var h = "", b = 0, k = 0, w = 0, d = 0; if (f == !0) { for (c = null, l = 0; l < a.length; l++)(c = a[l].Ctrl.getValue(), c != null && c.length != 0 && c != 0) && (a[l].Ctrl.colName == "Name" ? h += " AND upper(VAICNT_ScanName) LIKE '%" + c.toUpperCase() + "%' " : a[l].Ctrl.colName == "Reference" ? h += " AND upper(VAICNT_ReferenceNo) LIKE '%" + c.toUpperCase() + "%' " : a[l].Ctrl.colName == "TrxFromDate" ? (v = n.DB.to_date(c, !0), h += " AND DateTrx >= " + v) : a[l].Ctrl.colName == "TrxToDate" && (v = n.DB.to_date(c, !0), h += " AND DateTrx <= " + v)); r ? h += " AND VAICNT_TransactionType = 'OT' " : y == 184 ? h += " AND VAICNT_TransactionType = 'MR' and VAICNT_ReferenceNo in (SELECT DocumentNo from C_Order WHERE C_BPartner_ID = " + n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(i, 0, "C_BPartner_ID")) + " AND DocStatus IN ('CO', 'CL'))" : y == 319 || y == 170 ? (h += " AND VAICNT_TransactionType = 'IM' ", b = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "M_Locator_ID", !0)), k = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "M_LocatorTo_ID", !0)), w = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "DTD001_MWarehouseSource_ID", !0)), d = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "M_Warehouse_ID", !0))) : y == 168 ? (h += " AND VAICNT_TransactionType = 'PI' ", w = n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "M_Warehouse_ID", !0))) : h += y == 169 ? " AND VAICNT_TransactionType = 'SH' and VAICNT_ReferenceNo in (SELECT DocumentNo from C_Order WHERE  C_BPartner_ID = " + n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(i, 0, "C_BPartner_ID")) + " AND DocStatus IN ('CO'))" : y == 341 ? " AND VAICNT_TransactionType = 'IU' AND VAICNT_ReferenceNo IN (SELECT DocumentNo FROM M_Requisition WHERE IsActive = 'Y' AND M_Warehouse_ID = " + n.Utility.Util.getValueOfInt(n.context.getWindowContext(i, "M_Warehouse_ID", !0)) + " AND DocStatus IN ('CO'))" : " AND VAICNT_TransactionType = 'OT' " } else h += " AND VAICNT_InventoryCount_ID = -1"; sql = "SELECT VAICNT_ScanName,VAICNT_ReferenceNo,DateTrx,VAICNT_InventoryCount_ID FROM VAICNT_InventoryCount WHERE IsActive='Y' AND AD_Client_ID = " + n.Utility.Util.getValueOfInt(n.context.getAD_Client_ID()) + h; g = n.secureEngine.encrypt(sql); s || (s = 1); t.ajax({ url: n.Application.contextUrl + "InfoProduct/GetCart", dataType: "json", data: { sql: g, pageNo: s, isCart: r, windowID: y, WarehouseID: w, WarehouseToID: d, LocatorID: b, LocatorToID: k }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); e[0].style.visibility = "hidden"; return }, success: function (t) { var i = JSON.parse(t); if (i == null) { e[0].style.visibility = "hidden"; return } if (i.Error) { n.ADialog.error(i.Error); e[0].style.visibility = "hidden"; return } ci(i.pSetting); ei(i.data) } }) }, ei = function (i) { if (i == null) { e[0].style.visibility = "hidden"; return } u != null && (u.destroy(), u = null); u = null; l.arrListColumns = []; l.arrListColumns.push({ field: "Name", caption: n.Msg.translate(n.Env.getCtx(), "Name"), sortable: !0, size: "16%", min: 150, hidden: !1 }); l.arrListColumns.push({ field: "Reference", caption: n.Msg.translate(n.Env.getCtx(), "ReferenceNo"), sortable: !0, size: "16%", min: 150, hidden: !1 }); l.arrListColumns.push({ field: "TrxDate", caption: n.Msg.translate(n.Env.getCtx(), "DateTrx"), sortable: !0, size: "16%", min: 150, hidden: !1, render: "date" }); l.arrListColumns.push({ field: "count_ID", caption: n.Msg.translate(n.Env.getCtx(), "ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }); var r = "gridPrdInfodata" + Math.random(); r = r.replace(".", ""); w2utils.encodeTags(i); u = t(pt).w2grid({ name: r, recordHeight: 30, show: { columnHeaders: !0, lineNumbers: !0, selectColumn: !0 }, columns: l.arrListColumns, records: i, onClick: function () { u.records.length > 0 && tt.removeAttr("disabled") } }); u.selectNone(); for (itm in o) for (item in u.records) u.records[item].count_ID == o[itm] && u.select(parseInt(item) + 1); u.on("unselect", function (n) { if (n.all) n.onComplete = function () { for (item in u.records) { var n = u.records[item].count_ID; o.indexOf(n) > -1 && o.splice(o.indexOf(n), 1) } }; else { var t = u.records[n.index].count_ID; o.indexOf(t) > -1 && o.splice(o.indexOf(t), 1) } }); e[0].style.visibility = "hidden" }, oi = function () { var t = "", i, r, f; if (u != null) { if (i = u.getSelection(), i.length > 0) for (r in i) o.indexOf(u.get(i[r]).count_ID) == -1 && o.push(u.get(i[r]).count_ID); if (o.length > 0) { for (r in o) t += o[r] + ","; if (t = t.substr(0, t.length - 1), f = n.dataContext.getJSONData(n.Application.contextUrl + "InfoProduct/GetCartData", { invCount_ID: t, WindowID: y }, null), l.onClose) l.onClose(f, kt.prop("checked"), t); s.dialog("close") } else alert("Please Select a Record") } }; this.showDialog = function () { s.dialog({ modal: !0, title: n.Msg.translate(n.Env.getCtx(), "Info Scan"), width: 800, height: 450, resizable: !1, close: function () { l.dispose() } }); d(!1, f.val()) }; this.disposeComponent = function () { s.off("keyup"); et.off("click"); tt.off("click"); ct.off("click"); pt = null; yt = null; p.off("click"); w.off("click"); b.off("click"); k.off("click"); f.off("change"); p = w = b = k = f = null; u != null && u.destroy(); u = null; ti = null; st = null; it = null; g = null; rt = null; ut = null; ft = null; v = null; et = null; tt = null; kt = null; ni = null; e = null; a = null; l = null; ii = !1; s != null && (s.dialog("destroy"), s.remove()); s = null; this.displayData = null; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.InfoScanForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h) { function fi() { d.empty(); d = null; wt.empty(); wt = null; g.empty(); g = null; c = null; v = null; y = null; p = null; w = null; ot = null; ut = null; ft = null; nt = null; tt = null; it = null; rt = null; a = null; ot = null; b = null; progresBar = null; k = null; et != null && (et.dialog("destroy"), et.remove()); et = null } function li() { st.onClose && st.onClose(); fi() } function ei() { ui || (a[0].style.visibility = "visible", t.ajax({ url: n.Application.contextUrl + "Attachment/GetAttachment", dataType: "json", data: { AD_Table_ID: u, Record_ID: f }, error: function () { n.ADialog.info("ERRORGettingAttachment"); a[0].style.visibility = "hidden" }, success: function (i) { var u = i.result.FLocation, f = i.result.Attachment, e, l, v, ot, ri, o, h, y, p, w, c, tt, ht, it, ct, rt, lt, ut, yt, bt, kt, dt, ft, gt, ni; if (u == null) { n.ADialog.info("ERRORGettingAttachment"); a[0].style.visibility = "hidden"; return } e = t("<div class='vis-latest-attachments'>"); nt.append(e); l = t("<div class='vis-attach-top'>"); e.append(l); var ti = t("<div class='vis-attach-file-location'>"), ii = t("<div class='input-group vis-input-wrap' style='margin-bottom: 0;'>"), et = t("<div class='vis-control-wrap'>"); l.append(ti); ti.append(ii); ii.append(et); at = t('<select class="vis-custom-select">'); at.attr("disabled", !0); for (v in u.values) ot = t("<option value=" + u.values[v].Key + ">"), ot.append(u.values[v].Name), at.append(ot), u.selectedvalue == u.values[v].Key && at.val(u.selectedvalue); et.append(at); ri = t("<label>").append(n.Msg.getMsg("FileLocation")); et.append(ri); o = t("<div class='vis-attach-top-btns'>"); l.append(o); h = t("<input type='file' multiple='true' style='display:none;'>"); o.append(h); h.change(function () { vi(this) }); h.click(function () { this.value = null }); y = t("<a title='" + n.Msg.getMsg("SelectFile") + "' class='vis-attach-ico'><i class='fa fa-paperclip' aria-hidden='true'><\/i><\/a>"); o.append(y); y.on("click", function () { h.trigger("click") }); s && y.hide(); p = t("<div class='vis-dropdown pull-left'>"); o.append(p); w = t("<a class='vis-btn vis-btn-arrange vis-dropdown-toggle' type='button' data-toggle='dropdown' style='color: #fff;display:none;'>"); w.append(n.Msg.getMsg("Arrange")); w.append(t("<span class='vis-caret'>")); p.append(w); c = t("<ul class='dropdown-menu' role='menu' aria-labelledby='dropdownMenu1' id='dropdownMenu' style='margin-left: -33px;'>"); p.append(c); tt = t("<li role='presentation'>"); ht = t("<a role='menuitem' tabindex='-1' href='#'>"); ht.append(n.Msg.getMsg("Type")); tt.append(ht); tt.on("click", function () { }); c.append(tt); it = t("<li role='presentation'>"); ct = t("<a role='menuitem' tabindex='-1' href='#'>"); ct.append(n.Msg.getMsg("Size")); it.append(ct); it.on("click", function () { }); c.append(it); rt = t("<li role='presentation'>"); lt = t("<a role='menuitem' tabindex='-1' href='#'>"); lt.append(n.Msg.getMsg("Name")); rt.append(lt); rt.on("click", function () { }); c.append(rt); d = t("<div class='vis-attach-content-wrap' style='display:none;'>"); e.append(d); e.append(vt); ut = t("<div class='vis-pull-right'>"); vt.append(ut); yt = t("<a title='" + n.Msg.getMsg("Upload") + "' href='javascript:void(0)'  class='vis-attach-ico'><i class='fa fa-upload' aria-hidden='true'><\/i><\/a>"); ut.append(yt); yt.on("click", function () { yi() }); bt = t("<a title='" + n.Msg.getMsg("Cancel") + "' href='javascript:void(0)'  class='vis-attach-ico'><i class='fa fa-times-circle-o' aria-hidden='true'><\/i><\/a>"); ut.append(bt); bt.on("click", function () { d.empty(); pt = []; b = []; d.hide(); vt.hide(); g.css("height", "353px") }); if (wt = t("<div class='vis-old-attachments'>"), nt.append(wt), g = t("<div class='vis-attach-content-wrap' style='height: 353px;'>"), wt.append(g), f != null && (r = f.AD_Attachment_ID), f != null && f._lines != null) { r = f.AD_Attachment_ID; for (kt in f._lines) oi(f._lines[kt], kt) } dt = t("<div class='vis-attach-footer'>"); nt.append(dt); ft = t("<div class='vis-attach-btns pull-right' style='margin-top: 5px;'>"); dt.append(ft); gt = t('<a  title="' + n.Msg.getMsg("DeleteAll") + '" class="vis-btn">').append(n.Msg.getMsg("DeleteAll")); ft.append(gt); gt.on("click", function () { k.length == 0 || s || n.ADialog.confirm("DeleteRecord?", !0, "", "Confirm", function (i) { var r, u; if (i) { r = ""; for (u in k) r += k[u].Line_ID + ","; a[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Attachment/DeleteAttachment", dataType: "json", data: { AttachmentLines: r }, error: function () { n.ADialog.info("ERRORDeletingFile"); a[0].style.visibility = "hidden" }, success: function (t) { t.result == -1 ? n.ADialog.info("ErrorDeletingFile") : (g.empty(), k = []); a[0].style.visibility = "hidden" } }) } }) }); ni = t('<a title="' + n.Msg.getMsg("Cancel") + '" class="vis-btn">').append(n.Msg.getMsg("Cancel")); ni.on("click", function () { st.onClose && st.onClose(); fi() }); ft.append(ni); ui = !0; a[0].style.visibility = "hidden" } })) } var ui = !1, r, st, et, ot, c, v, y, p, w, ft, nt, tt, it, rt, ut, a, gt, bt, ht, kt, ni, l; this.isWindowAction = !1; var d = null, wt = null, g = null, at = null; this.windowNo = i; r = 0; o || (o = 0); h || (h = !1); s || (s = !1); this.onClose = null; st = this; et = null; et = n.Application.isRTL ? t("<div style='overflow:hidden;width:100%;height:100%;'>") : t("<div style='overflow:hidden;width:100%;height:100%;'>"); ot = t("<ul style='height:30px;display:none;list-style:none;width:97%;margin-left:-41px'>"); c = t("<li>"); c.css("float", "left"); c.css("margin", "1px"); c.css("padding", "5px"); c.css("display", "block"); c.css("position", "relative"); c.css("font-weight", "700"); c.css("border", "0px"); c.css("border-bottom", "none"); c.css("border-width", "1px"); c.css("color", "#999"); c.css("cursor", "default"); c.css("height", "35px"); c.css("margin-bottom", "-1px"); c.css("margin-right", "5px"); c.css("border-top-left-radius", "3px"); c.css("border-top-right-radius", "3px"); c.append(n.Msg.getMsg("FileAttachment")); ot.append(c); v = t("<li>"); v.css("float", "left"); v.css("margin", "1px"); v.css("padding", "5px"); v.css("display", "block"); v.css("position", "relative"); v.css("font-weight", "700"); c.css("border", "0px"); v.css("border-bottom", "none"); v.css("border-width", "1px"); v.css("color", "#999"); v.css("cursor", "default"); v.css("height", "35px"); v.css("margin-bottom", "-1px"); v.css("margin-right", "5px"); v.css("border-top-left-radius", "3px"); v.css("border-top-right-radius", "3px"); v.append(n.Msg.getMsg("InboxMailAttachment")); ot.append(v); y = t("<li>"); y.css("float", "left"); y.css("margin", "1px"); y.css("padding", "5px"); y.css("display", "block"); y.css("position", "relative"); y.css("font-weight", "700"); c.css("border", "0px"); y.css("border-bottom", "none"); y.css("border-width", "1px"); y.css("color", "#999"); y.css("cursor", "default"); y.css("height", "35px"); y.css("margin-bottom", "-1px"); y.css("margin-right", "5px"); y.css("border-top-left-radius", "3px"); y.css("border-top-right-radius", "3px"); y.append(n.Msg.getMsg("SentMailAttachment")); ot.append(y); p = t("<li>"); p.css("float", "left"); p.css("margin", "1px"); p.css("padding", "5px"); p.css("display", "block"); p.css("position", "relative"); p.css("font-weight", "700"); c.css("border", "0px"); p.css("border-bottom", "none"); p.css("border-width", "1px"); p.css("color", "#999"); p.css("cursor", "default"); p.css("height", "35px"); p.css("margin-bottom", "-1px"); p.css("margin-right", "5px"); p.css("border-top-left-radius", "3px"); p.css("border-top-right-radius", "3px"); p.append(n.Msg.getMsg("Letter")); ot.append(p); w = t("<li>"); w.css("float", "left"); w.css("margin", "1px"); w.css("padding", "5px"); w.css("display", "block"); w.css("position", "relative"); w.css("font-weight", "700"); c.css("border", "0px"); w.css("border-bottom", "none"); w.css("border-width", "1px"); w.css("color", "#999"); w.css("cursor", "default"); w.css("height", "35px"); w.css("margin-bottom", "-1px"); w.css("margin-right", "5px"); w.css("border-top-left-radius", "3px"); w.css("border-top-right-radius", "3px"); w.append(n.Msg.getMsg("Appointments")); ot.append(w); et.append(ot); ft = t("<div class='vis-pu-outerwrap'>"); nt = t("<div class='vis-pu-innerwrap'>"); ft.append(nt); tt = t("<div>"); tt.append("Inbox Mail Att"); tt.css("width", "100%"); tt.css("height", "100%"); tt.css("position", "absolute"); ft.append(tt); it = t("<div>"); it.append("SENT MAIL Att"); it.css("width", "100%"); it.css("height", "100%"); it.css("position", "absolute"); ft.append(it); rt = t("<div>"); rt.append("Leter Att"); rt.css("width", "100%"); rt.css("height", "100%"); rt.css("position", "absolute"); ft.append(rt); ut = t("<div>"); ut.append("Appointment Att"); ut.css("width", "100%"); ut.css("height", "100%"); ut.css("position", "absolute"); ft.append(ut); a = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); ft.append(a); gt = t("<div style='width: 100%;height: 100%;background:black;opacity: .1;display:none; position:absolute;top:0;left:0'>"); ft.append(gt); bt = t("<div style='width: 100%;height: 100%;background:transparent;text-align: center;display:none ;vertical-align: middle;position:absolute;top:0;left:0'>"); ft.append(bt); ht = null; ht = n.Application.isRTL ? t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:41%;width: 80%;right: 9%;'>") : t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:41%;width: 80%;left: 9%;'>"); kt = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute'>"); ni = t("<span class='vis-ui-label'  style='position:absolute'>").append("0%"); kt.append(ni); ht.append(kt); bt.append(ht); et.append(ft); nt[0].style.visibility = "visible"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; a[0].style.visibility = "hidden"; c.css("background", "#fff"); c.css("color", "#0088CC"); l = function (n, t) { t ? (n.css("background", "#fff"), n.css("color", "#0088CC")) : (n.css("background", "#eee"), n.css("color", "#999")) }; c.on("click", function () { nt[0].style.visibility = "visible"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; a[0].style.visibility = "hidden"; l(c, !0); l(v, !1); l(y, !1); l(p, !1); l(w, !1); ei() }); v.on("click", function () { nt[0].style.visibility = "hidden"; tt[0].style.visibility = "visible"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; a[0].style.visibility = "hidden"; l(c, !1); l(v, !0); l(y, !1); l(p, !1); l(w, !1) }); y.on("click", function () { nt[0].style.visibility = "hidden"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "visible"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; a[0].style.visibility = "hidden"; l(c, !1); l(v, !1); l(y, !0); l(p, !1); l(w, !1) }); p.on("click", function () { nt[0].style.visibility = "hidden"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "visible"; ut[0].style.visibility = "hidden"; a[0].style.visibility = "hidden"; l(c, !1); l(v, !1); l(y, !1); l(p, !0); l(w, !1) }); w.on("click", function () { nt[0].style.visibility = "hidden"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "visible"; a[0].style.visibility = "hidden"; l(c, !1); l(v, !1); l(y, !1); l(p, !1); l(w, !0) }); this.show = function () { nt[0].style.visibility = "visible"; tt[0].style.visibility = "hidden"; it[0].style.visibility = "hidden"; rt[0].style.visibility = "hidden"; ut[0].style.visibility = "hidden"; a[0].style.visibility = "hidden"; l(c, !0); l(v, !1); l(y, !1); l(p, !1); l(w, !1); ei(); et.dialog({ width: 841, height: 502, title: n.Msg.getMsg("Attachment"), resizable: !1, modal: !0, close: li }) }; var vt = t("<div class='vis-pu-uploadsbtnswrap'>"), b = []; var ai = function () { t.ajax({ url: n.Application.contextUrl + "Attachment/GetAttachment", dataType: "json", data: { AD_Table_ID: u, Record_ID: f }, error: function () { n.ADialog.info("ERRORGettingAttachment"); a[0].style.visibility = "hidden" }, success: function (n) { var t = n.result.Attachment, i; if (t != null && (r = t.AD_Attachment_ID), t != null && t._lines != null) { r = t.AD_Attachment_ID; for (i in t._lines) oi(t._lines[i], i) } a[0].style.visibility = "hidden" } }) }, vi = function (i) { for (var r = [], u, l, o, a, v, s, y, nt, w, c, f, it, e = 0; e < i.files.length; e++) { if (file = i.files[e], file == undefined) return; if (file.name.indexOf("&") > -1 || file.name.indexOf("?") > -1 || file.name.indexOf("#") > -1 || file.name.indexOf("/") > -1 || file.name.indexOf("\\") > -1) { r.push(file.name); continue } for (u in b) if (file.name == b[u].name) { window.setTimeout(function () { n.ADialog.info("AlreadyExists") }, 20); return } if (k != null) for (u in k) if (file.name == k[u].Name && !k[u].IsDeleted) { window.setTimeout(function () { n.ADialog.info("AlreadyExists") }, 20); return } l = {}; o = t("<div class='vis-attach-file-wrapla'>"); d.append(o); a = t("<div class='vis-attach-file-top'>"); v = t("<a class='vis-file-close-ico'><i class='fa fa-times' aria-hidden='true'><\/i><\/a>"); a.append(v); o.append(a); d.show(); vt.show(); v.on("click", function () { var n = t(t(this).parent()).parent(), r, i; n.css("display", "none"); r = n.html(); n.empty(); n = null; for (i in b) if (String(r).indexOf(b[i].name) > -1) { b.splice(i, 1); break } b.length > 4 ? (d.css("height", "153px"), g.css("height", "153px")) : (d.css("height", "97px"), g.css("height", "209px")); b.length == 0 && (d.hide(), vt.hide(), d.css("height", "0px"), g.css("height", "353px")) }); s = t("<div class='vis-attach-file-content'>"); o.append(s); y = t("<div class='vis-attach-file-icon'>"); nt = ci(file.name); y.append(t("<img src='" + nt + "'>")); s.append(y); var p = t("<div class='vis-attach-file-text' style='margin-bottom:10px'>"), tt = "", h = t("<p>"); file.name.length > 17 ? (tt = file.name.toString().substr(0, 17), h.append(tt), w = t("<a href='#' class='VIS_Pref_tooltip'>").append("..."), c = t("<span style='width: inherit;'>"), c.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), c.append(t("<label class='VIS_Pref_Label_Font'>").append(file.name)), w.append(c), h.append(w)) : h.append(file.name); p.append(h); p.append(t("<p>").append((Number(file.size) / 1024).toFixed(2) + "KB")); s.append(p); l.Name = file.name; l.Size = file.size; b.push(file); b.length > 4 ? (d.css("height", "153px"), g.css("height", "153px")) : (d.css("height", "97px"), g.css("height", "209px")) } if (r.length > 0) { f = ""; for (it in r) f += r[it].toString() + "\n"; f += r.length == 1 ? "File has" : "Files have"; f += " invalid name. Please change the file name and try again."; n.ADialog.info(f) } }, k = [], oi = function (i, r) { var c = t("<div class='vis-attach-file-wrap'>"), u, f, l, y, o, h, p, w; g.append(c); u = {}; f = t("<div class='vis-attach-file-content'>"); c.append(f); l = t("<div class='vis-attach-file-icon'>"); l.append(t("<img src='" + ci(i.FileName) + "'>")); f.append(l); var v = t("<div class='vis-attach-file-text'>"), b = "", e = t("<p>"); i.FileName.length > 17 ? (b = i.FileName.toString().substr(0, 17), e.append(b), y = t("<a href='#' class='VIS_Pref_tooltip'>").append("..."), o = t("<span style='width: inherit;'>"), o.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), o.append(t("<label class='VIS_Pref_Label_Font'>").append(i.FileName)), y.append(o), e.append(y)) : e.append(i.FileName); v.append(e); v.append(t("<p>").append((Number(i.Size) / 1024).toFixed(2) + "KB")); f.append(v); h = t("<div class='vis-attach-BottomRight'>"); p = t("<a href='javascript:void(0)'  class='vis-attach-ico' data-id='" + r + "'><i class='fa fa-long-arrow-down' aria-hidden='true'><\/i><\/a>"); h.append(p); p.on("click", function () { var n = t(this).data("id"); k[n].HaveSource ? window.open(k[r].Source, "_blank") : pi(n, this) }); w = t("<a class='vis-attach-ico' data-id='" + r + "'><i class='vis vis-delete' aria-hidden='true'><\/i><\/a>"); h.append(w); w.on("click", function () { if (s) return !1; var i = t(this); n.ADialog.confirm("DeleteRecord?", !0, "", "Confirm", function (r) { if (r) { var u = i.data("id"); a[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Attachment/DeleteAttachment", dataType: "json", data: { AttachmentLines: k[u].Line_ID }, error: function () { n.ADialog.info("ERRORDeletingFile"); a[0].style.visibility = "hidden" }, success: function (t) { if (t.result == -1) n.ADialog.info("ErrorDeletingFile"); else { var r = i.parent().parent(); r.css("display", "none"); r.empty(); r = null; k[u].IsDeleted = !0 } a[0].style.visibility = "hidden" } }) } }) }); c.append(h); u.Name = i.FileName; u.Size = i.Size; u.Line_ID = i.Line_ID; u.HaveSource = !1; u.Source = null; u.IsDeleted = !1; k.push(u) }, ti = 0, ct = 0, si = Date.now().toString(), lt = 1048576, ii = 0, yt = 0, pt = [], yi = function () { var n = null, t, r, i; dt(!0); t = 0; r = 0; for (i in b) t = parseInt(b[i].size / lt), file.size % lt > 0 && t++, ii += t, n = {}, n.Name = b[i].name, n.Size = b[i].size, pt.push(n); hi() }, hi = function () { var i, e, s; if (b == null || b.length == 0) { dt(!1); n.ADialog.info("NothingToUpload"); return } if (ct >= b.length) { t.ajax({ url: n.Application.contextUrl + "Attachment/SaveAttachmentEntries", dataType: "json", type: "POST", data: { files: JSON.stringify(pt), AD_Attachment_ID: r, folderKey: si, AD_Table_ID: u, Record_ID: f, fileLocation: at.val(), NewRecord_ID: o, IsDMSAttachment: h }, error: function () { dt(!1); pt = []; a[0].style.visibility = "hidden" }, success: function (i) { var f = i.result.Error, r, e, u; f == "" ? (h && (r = t(".vis-old-attachments").find(".vis-attach-file-wrap"), r.length > 1 && t(r[0]).remove()), ri(100), window.setTimeout(function () { dt(!1) }, 500), pt = [], e = "transfer", u = {}, u = { to: g, className: "vis-Att-ui-effects-transfer" }, d.effect(e, u, 500, function () { window.setTimeout(function () { k = []; g.empty(); ai(); b = []; d.empty(); d.hide(); vt.hide(); d.css("height", "0px"); g.css("height", "353px"); kt.css("width", "O%") }, 500) })) : (pt = [], dt(!1), n.ADialog.info(f)); ti = 0; ct = 0; ii = 0; yt = 0; a[0].style.visibility = "hidden" } }); return } i = new XMLHttpRequest; e = new FormData; e.append("file", b[ct].slice(yt * lt, yt * lt + Number(lt))); i.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + b[ct].name + "&folderKey=" + si, !1); i.send(e); ti++; yt++; s = parseInt(b[ct].size / lt); b[ct].size % lt > 0 && s++; yt == s && (ct++, yt = 0); ti <= ii && ri(parseInt(ti / ii * 80)); window.setTimeout(function () { hi() }, 2) }, dt = function (n) { n ? (gt.show(), ht.show(), bt.show()) : (gt.hide(), ht.hide(), bt.hide()) }, wi = function (t, i, r, u, f) { var o, c, e, s, h; for (progresBar.attr("value", 0), o = parseInt(t.size / r), t.size % r > 0 && o++, c = !1, e = 0; e < o; e++)e == o - 1 && t.size % r > 0 && (r = t.size % r), c = !0, s = new XMLHttpRequest, h = new FormData, h.append("file", t.slice(e * r, e * r + Number(r))), s.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + t.name + "&folderKey=" + i, !1), s.send(h), u++, ri(parseInt(u / f * 80)) }, pi = function (i) { var e = n.ProcessCtl.prototype.ORIGIN_WINDOW; st.isWindowAction || (e = n.ProcessCtl.prototype.ORIGIN_FORM); a[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Attachment/DownloadAttachment", dataType: "json", data: { fileName: k[i].Name, AD_Attachment_ID: r, AD_AttachmentLine_ID: k[i].Line_ID, actionOrigin: e, originName: n.context.getWindowContext(st.windowNo, "WindowName"), AD_Table_ID: u, recordID: f }, error: function () { n.ADialog.info("ERRORGettingFile"); a[0].style.visibility = "hidden" }, success: function (t) { var u = new Date, f = t.result, r = n.Application.contextUrl + "TempDownload/" + f + "/" + k[i].Name + "?" + u.getTime(), e = k[i].Name; k[i].HaveSource = !0; a[0].style.visibility = "hidden"; window.open(r, "_blank"); k[i].Source = r } }) }, bi = function () { iFrame != null && (iFrame.css("visibility", "visible"), viewer.css("visibility", "visible"), nt.css("visibility", "collapse")) }, ri = function (n) { kt.css("width", n + "%"); ni.empty(); ni.append(n + "%") }, ki = function (n) { return ht.each(function () { t(this).animate({ width: n + "%" }, { duration: 2e3, easing: "swing", step: function (n) { var i = t(".ui-label", this), r = t(".value", i); Math.ceil(n) < 20 && t(".ui-label", this).is(":visible") ? i.hide() : i.is(":hidden") && i.fadeIn(); Math.ceil(n) == 100 ? (i.text("Done"), setTimeout(function () { i.fadeOut() }, 1e3)) : r.text(Math.ceil(n) + "%") } }) }) }, ci = function (t) { var r, u, i; return t == null || t.length == 0 ? "" : (r = t.lastIndexOf("."), u = n.Application.contextUrl + "Areas/VIS/Images/", r < 1) ? u + "defult.png" : (i = t.substr(r, t.length - r), u + (i == ".xlsx" || i == ".xls" ? "excel.png" : i == ".html" || i == ".htm" ? "html.png" : i == ".pdf" ? "pdf.png" : i == ".ppt" ? "ppt.png" : i == ".txt" ? "text.png" : i == ".docx" || i == ".doc" ? "word.png" : i == ".xml" ? "xml.png" : i == ".jpg" || i == ".gif" || i == ".png" ? "image.png" : i == ".mp3" ? "audio.png" : i == ".zip" || i == ".rar" ? "compresed.png" : "defult.png")) } } i.prototype.setIsWindowAction = function (n) { this.isWindowAction = n }; n.attachmentForm = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e) { function ri(i) { var r, u, f, s; i || (lt = t('<div class="wfactivity-homepage-parentdiv"><\/div>'), r = t(' <div class="frm-data-col-wrap frm-data-col-2" style="padding-right: 10px;"> <div class="frm-data-search-wrap"><input class="frm-data-col-searchinput" id="homeSearchWorkflow" type="text" placeholder="' + n.Msg.getMsg("Search") + '"><button id="btnWorkflowSearch" class="vis-wfSearch-btn"><i class="fa fa-search" aria-hidden="true"><\/i><\/button><\/div><\/div>'), tt = r.find("#homeSearchWorkflow"), dt = r.find("#btnWorkflowSearch"), u = t(' <div class="frm-data-col-wrap frm-data-col-2" style="padding-left: 7px"> <div class="frm-data-search-wrap"><select class="vis-custom-select"><\/select><\/div><\/div>'), v = u.find("select"), f = t('<div style="display:none;padding-left: 7px" class="frm-data-col-wrap frm-data-col-2"> <label>' + n.Msg.getMsg("FromDate") + '<\/label><input type="date" placeholder="date"><\/div>'), w = f.find("input"), s = t('<div  style="display:none;padding-right:10px" class="frm-data-col-wrap frm-data-col-2"><label>' + n.Msg.getMsg("ToDate") + '<\/label><input type="date" placeholder="date"><\/div>'), l = s.find("input"), lt.append(u).append(r).append(f).append(s), g = t('<div class="frm-select-all-check"  style="display:none"><\/div>'), h = t('<input type="checkbox">'), g.append("<label>" + n.Msg.getMsg("SelectAll") + "<\/label>"), g.append(h), e.addClass("vis-eye-plus"), e.removeClass("vis-eye-minus"), e.attr("title", n.Msg.getMsg("ShowSearch"))); pt(); o = t('<div class="wfactivity-homepage-activites" style="padding-right:0px"><\/div>') } function pt(i) { t.ajax({ url: n.Application.contextUrl + "WFActivity/GetWorkflowWindows", dataType: "json", type: "POST", error: function () { return }, success: function (t) { var u, r; if (t) if (t = JSON.parse(t), v.empty(), v.append('<option value="0_0">' + n.Msg.getMsg("SelectWindow") + "<\/option>"), t && t.length > 0) { for (u = !1, r = 0; r < t.length; r++)v.append('<option value="' + t[r].AD_Window_ID + "_" + t[r].AD_Node_ID + '">' + t[r].WindowName + "<\/option>"), t[r].AD_Window_ID + "_" + t[r].AD_Node_ID == rt && (u = !0); rt && u ? v.val(rt) : (rt = "0_0", v.val("0_0")) } else rt = "0_0", v.val("0_0"); i && ct() } }) } function ui(i) { v.off("change"); v.on("change", ei); o.on("scroll", oi); if (!i) { dt.on("click", function () { b && (b = !1, ct()) }); tt.on("keydown", function (n) { n.keyCode == 13 && b && (b = !1, ct()) }); w.on("focusout", function () { w.val() != "" && l.val() != "" && w.val() > l.val() && l.val("") }); l.on("focusout", function () { w.val() != "" && l.val() != "" && w.val() > l.val() && (l.val(""), n.ADialog.info("ToDateMustGreater")) }); e.on("click", function () { l.is(":visible") ? (t(w.parent()).css("display", "none"), t(l.parent()).css("display", "none"), w.val(""), l.val(""), e.attr("title", n.Msg.getMsg("ShowSearch")), e.addClass("vis-eye-plus"), e.removeClass("vis-eye-minus"), h.is(":visible") ? o.css("top", "65px") : o.css("top", "47px")) : (t(w.parent()).css("display", "block"), t(l.parent()).css("display", "block"), e.attr("title", n.Msg.getMsg("HideSearch")), e.removeClass("vis-eye-plus"), e.addClass("vis-eye-minus"), h.is(":visible") ? o.css("top", "118px") : o.css("top", "98px")) }); h.on("click", fi) } } function fi() { var i = o.find(".wfActivity-selectchk"), n; for (h.prop("checked") == !1 && (yt = !0), h.prop("checked") == !0 && (ht = !0), n = 0; n < i.length; n++)h.prop("checked") == !0 ? t(i[n]).prop("checked") == !1 && t(i[n]).trigger("click") : t(i[n]).prop("checked") == !0 && t(i[n]).trigger("click"); yt = !1; h.prop("checked") == !1 && t(o.find(".vis-activityContainer")[0]).trigger("click") } function ei() { ft.hide(); r.empty(); v.val() == "0_0" ? (g.hide(), h.prop("checked") == !0 && h.trigger("click"), l.is(":visible") ? o.css("top", "98px") : o.css("top", "47px")) : (g.hide(), l.is(":visible") ? o.css("top", "118px") : o.css("top", "67px")); rt = v.val(); ct() } function ct() { it = 1; ot = 10; ft.hide(); r.empty(); o.empty(); s = []; s.length = 0; kt.AppendRecord(it, ot, !0) } function oi() { t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight * .75 && et && (et = !1, at = parseInt(k.html()), vt = it * ot, vt <= at ? (it += 1, kt.AppendRecord(it, ot)) : et = !0) } function bt() { var n = o.find('input[class="wfActivity-selectchk"]:checked').length, t = o.find(".wfActivity-selectchk").length; t == n && h.prop("checked", !0) } var c = null, a = [], nt = [], kt = this, lt = null, g = null, tt = null, dt = null, w = null, l = null, o = null, v = null, h = null, it = 1, ot = 10, at = 0, vt = 0, y = 0, rt = "0_0", st = 0, b = !0, ht = !1, yt = !1, s = [], p = t("#divTabMenuDataLoder"), ut = t("#hAlrtTxtTypeCount"), k = t("#divfActivity"), ft = t("#workflowActivity"), et, wt, gt; this.Load = function (r) { h && h.prop("checked") == !1 && ft.hide(); i.children().last().remove(); p.show(); it = 1; ot = 10; at = 0; vt = 0; ri(r); s = []; r ? (i.find(".wfactivity-homepage-activites").remove(), i.append(o)) : i.append(lt).append(g).append(o); ui(r); y = v.val(); y && y != "0_0" ? (st = y.split("_")[1], y = y.split("_")[0], l.is(":visible") ? i.find(".wfactivity-homepage-activites").css("top", "118px") : i.find(".wfactivity-homepage-activites").css("top", "68px")) : (st = 0, y = 0, l.is(":visible") ? i.find(".wfactivity-homepage-activites").css("top", "98px") : i.find(".wfactivity-homepage-activites").css("top", "47px")); t.ajax({ url: n.Application.contextUrl + "WFActivity/GetActivities", data: { pageNo: 1, pageSize: 10, refresh: !0, searchText: tt.val(), AD_Window_ID: y, dateFrom: w.val(), dateTo: l.val(), AD_Node_ID: st }, dataType: "json", type: "POST", error: function () { p.hide(); n.HomeMgr.BindMenuClick(); return }, success: function (t) { tt.val(""); window.setTimeout(function () { n.HomeMgr.BindMenuClick(); var u = n.HomeMgr.getActiveTab(); if (u.activeTabType == 3) { if (t.result == null || t.result.LstInfo == null) { p.hide(); k.empty(); k.append(0); k.show(); ut.empty(); ut.append(0); str = "<p  id='pnorecFound' style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>"; i.find("#pnorecFound").remove(); o.empty(); i.append(str); return } c = t.result.LstInfo; o.empty(); r == !0 && (nt = [], a = []); k.empty(); k.append(t.result.count); k.show(); ut.empty(); ut.append(t.result.count); wt(0); n.HomeMgr.adjustDivSize() } else return }, 100) } }) }; et = !0; this.AppendRecord = function (r, u, f) { f || (f = !1); p.show(); y = v.val(); st = y.split("_")[1]; y = y.split("_")[0]; t.ajax({ url: n.Application.contextUrl + "WFActivity/GetActivities", data: { pageNo: r, pageSize: u, refresh: f, searchText: tt.val(), AD_Window_ID: y, dateFrom: w.val(), dateTo: l.val(), AD_Node_ID: st }, dataType: "json", type: "POST", error: function () { p.hide(); n.HomeMgr.BindMenuClick(); b = !0; et = !0 }, success: function (t) { var u, e; tt.val(""); n.HomeMgr.BindMenuClick(); u = n.HomeMgr.getActiveTab(); u.activeTabType == 3 ? (c = t.result ? t.result.LstInfo : null, f == !0 && (nt = [], a = [], k.empty(), o.empty(), t.result ? (i.find("#pnorecFound").remove(), k.append(t.result.count)) : (ut.empty(), ut.append(0), e = "<p id='pnorecFound' style=' margin-top:200px;text-align: center'>" + n.Msg.getMsg("NoRecordFound") + "<\/p>", i.find("#pnorecFound").remove(), i.append(e), k.append(0))), wt(r - 1), n.HomeMgr.adjustDivSize()) : b = !0; et = !0 } }) }; wt = function (i) { var u = null, r, f, w, e, ft, tt; if (c == null || c.length == 0) { p.hide(); g.hide(); h.prop("checked", !1); b = !0; return } v.val() != "0_0" ? (l.is(":visible") ? o.css("top", "118px") : o.css("top", "67px"), g.show()) : (l.is(":visible") ? o.css("top", "98px") : o.css("top", "47px"), g.hide(), h.prop("checked", !1)); for (r in c) { a.push(c[r]); f = {}; u = t("<div class='vis-activityContainer' data-id='" + (Number(10 * i) + Number(r)) + "'>"); u.on("click", function (n) { var u, i, r, f; if (t(".vis-activityContainer").removeClass("vis-activeFeed"), t(this).addClass("vis-activeFeed"), u = t(n.target).data("viswfazoom"), u == "wfZoom") { t(this).addClass("vis-activeFeed"); i = t(n.target).data("index"); ii(i); b = !0; return } (i = t(this).data("id"), r = !0, s.length <= 1 && h.prop("checked") == !0 && (r = !1), f = t(this).find(".wfActivity-selectchk").data("ids"), s.length != 1 || f == s[0]) && (si(nt[i].wfActivityID, i, this, r), b = !0) }); var y = t("<div class='vis-feedTitleBar'>"), k = t('<input class="wfActivity-selectchk" type="checkbox" style="float:left;margin-right:5px" data-ids="' + c[r].AD_Window_ID + "_" + c[r].AD_Node_ID + "_" + c[r].AD_WF_Activity_ID + '" ><\/input>'), d = t("<h3>"); d.css("font-weight", "normal"); d.append(n.Utility.encodeText(c[r].NodeName)); v && v.val() != "0_0" && y.append(k); y.append(d); var it = t("<div class='vis-feedTitleBar-buttons'>"), rt = t("<ul>"), ut = t("<li>"), et = t("<a href='javascript:void(0)'  data-index='" + (Number(10 * i) + Number(r)) + "' data-viswfazoom='wfZoom' >").append('<i class="vis vis-find" data-index="' + (Number(10 * i) + Number(r)) + '" data-viswfazoom="wfZoom"><\/i>'); ut.append(et); rt.append(ut); it.append(rt); y.append(it); u.append(y); w = t("<div class='vis-feedDetails'>"); e = t("<pre>"); c[r].DocumentNameValue == undefined || c[r].DocumentNameValue == "" ? e.append(n.Utility.encodeText(c[r].Summary)) : e.append(n.Utility.encodeText(c[r].DocumentNameValue + " - " + c[r].Summary)); ft = t("<br>"); e.append(ft); e.append(n.Utility.encodeText(n.Msg.getMsg("Priority") + " " + c[r].Priority)); w.append(e); k.on("click", function (n) { var i = t(n.target); gt(i, n) }); tt = t("<div class='vis-feedDateTime'>"); tt.append(t("<br>")).append(Globalize.format(new Date(c[r].Created), "d")); w.append(tt); u.append(w); o.append(u); f.ctrl = u; f.index = r; f.recordID = c[r].Record_ID; f.wfActivityID = c[r].AD_WF_Activity_ID; nt.push(f); h.prop("checked") == !0 && (k.trigger("click"), a.length == 1) } b = !0; p.hide() }; gt = function (n, i) { var f = n.data("ids"), e, c, u, r; if (n.prop("checked") == !1 && (h.prop("checked", !1), ht = !1), n.prop("checked") == !0) if (s.length == 0) s.push(n.data("ids")), ht = !1, bt(); else if (e = s[0].split("_"), c = f.split("_"), e[0] + "-" + e[1] == c[0] + "-" + c[1]) s.push(f), h.prop("checked") != !0 || ht || i.stopPropagation(), ht = !1, bt(); else return bt(), i.preventDefault(), !1; else { if (s = jQuery.grep(s, function (n) { return n != f }), s.length == 1 && !yt) for (u = o.find(".wfActivity-selectchk"), r = 0; r < u.length; r++)if (t(u[r]).prop("checked") == !0) { t(u[r]).parent().trigger("click"); i.stopPropagation(); return } if (s.length >= 0 || h.prop("checked") == !0) return i.stopPropagation(), !1 } n.prop("checked") == !0 }; var ni = function () { var i = t(window).width(), r = t(".row.scrollerHorizontal > div").length, u, n, f; r = r - 1; t(".scrollerHorizontal").width(i); u = i / r - 20; n = parseInt(u); i >= 1366 && (ft.css("display") == "none" ? (t("#fllupsScreen").css("left", n + 20), t("#favLinks").css("left", n * 2 + 40), t("#welcomeScreen,#fllupsScreen,#favLinks").width(n)) : ft.css("display") == "block" && (f = i + n + 20, t(".scrollerHorizontal").width(f), t("#workflowActivity").css("left", n + 20), t("#fllupsScreen").css("left", n * 2 + 40), t("#favLinks").css("left", n * 3 + 60), t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(n))) }, d = [], si = function (i, u, f, e) { p.show(); t.ajax({ url: n.Application.contextUrl + "WFActivity/GetActivityInfo", dataType: "json", type: "POST", async: e, data: { activityID: i, nodeID: a[u].AD_Node_ID, wfProcessID: a[u].AD_WF_Process_ID }, error: function () { p.hide(); return }, success: function (e) { if (s.length <= 1 || h.prop("checked") == !0) { ft.show(); n.HomeMgr.adjustDivSize(); var c = "transfer", o = {}; o = { to: r, className: "wsp-ui-effects-transfer" }; window.setTimeout(function () { ti(i, u, e.result); t(f).effect(c, o, 500, function () { }) }, 400) } else s.length <= 2 && ti(i, u, e.result), p.hide() } }) }, ti = function (i, u, f) { var e = {}, nt, ut, yt, oi, wt, si, lt, et, ot, bt, st, ht, c, kt, dt, gt, ti, at, l, g, y, ai, ft, v, ri, h, ct, ui, fi, tt, ei, w, vt, b, it, k, rt; if (d = [], e.Index = u, r.empty(), ut = t("<div class='vis-workflowActivityDetails-Heading'>"), r.append(ut), yt = t("<h3>"), yt.append(n.Msg.getMsg("Detail")), ut.append(yt), s.length <= 1) if (f.ColName == "VADMS_SignStatus") { nt = a[u].DocumentNameValue.split("_"); oi = { DocumentNo: parseInt(nt[nt.length - 1]) }; wt = ""; t.post(n.Application.contextUrl + "VADMS/Document/GetFolderID", oi, function (t) { !t || t.result == "" || t.result.contains("ERR-") || t.result.contains("F") ? n.ADialog.error(n.Msg.getMsg("VA055_FolderNotFound")) : wt = parseInt(t.result) }, "json").fail(function (t, i) { n.ADialog.error(i) }); si = { FromName: "VADMS_Document" }; lt = ""; t.post(n.Application.contextUrl + "VADMS/Document/GetFormID", si, function (t) { t && t.result != "" ? lt = t.result : n.ADialog.error(n.Msg.getMsg("VA055_FormNotFound")) }, "json").fail(function (t, i) { n.ADialog.error(i) }); et = t("<a href='javascript:void(0)' class='vis-btn-zoom' style='margin-left:10px;' data-id='" + nt[nt.length - 1] + "'>"); et.append(t("<span class='vis-btn-ico vis-btn-zoom-bg vis-btn-zoom-border'>")); et.append(n.Msg.getMsg("Zoom")); ut.append(et); et.on(n.Events.onTouchStartOrClick, function () { var i = t(this).data("id"), r = { DocNo: i, DocFolderID: wt }; lt > 0 && n.viewManager.startForm(lt, r) }) } else { ot = t("<a href='javascript:void(0)' class='vis-btn-zoom' data-id='" + u + "'>"); ot.append(t("<span class='vis-btn-ico vis vis-find vis-btn-zoom-border'>")); ot.append(n.Msg.getMsg("Zoom")); ut.append(ot); ot.on(n.Events.onTouchStartOrClick, function () { var n = t(this).data("id"); ii(n) }) } if (ut.append(t("<div class='clearfix'>")), bt = t("<ul class='vis-IIColumnContent'>"), r.append(bt), st = t("<li>"), st.css("width", "100%"), ht = t("<p>"), ht.append(n.Msg.getMsg("Node")), ht.append(t("<br>")), ht.append(n.Utility.encodeText(a[u].NodeName)), st.append(ht), bt.append(st), s.length <= 1 && (c = t("<pre>"), c.css("margin-top", "10px"), c.css("margin-bottom", "0px"), c.css("font-size", "14px"), c.css("font-family", "NoirPro-Regular"), c.append(n.Msg.getMsg("Summary")), c.append(t("<br>")), c.append(n.Utility.encodeText(a[u].Summary)), st.append(c)), r.append(t("<div class='clearfix'>")), kt = t("<h4>"), kt.append(n.Msg.getMsg("Description")), r.append(kt), dt = t("<p>"), dt.append(n.Utility.encodeText(a[u].Description)), r.append(dt), r.append(t("<div class='clearfix'>")), gt = t("<h4>"), gt.append(n.Msg.getMsg("Help")), r.append(gt), ti = t("<p>"), ti.append(n.Utility.encodeText(a[u].Help)), r.append(ti), r.append(t("<h3>").append(n.Msg.getMsg("Action"))), r.append(t("<div class='clearfix'>")), at = t("<ul class='vis-IIColumnContent'>"), l = t("<li>"), at.append(l), l.append(t("<p style='margin-bottom: 0'>").append(n.Msg.getMsg("Answer"))), f.NodeAction == "C") g = ci(f, i), e.AnswerCtrl = g, g != null && (g.getBtnCount() > 0 ? (v = t("<div class='vis-wforwardwrap'>"), v.append(g.getControl()), v.append(g.getBtn(0)), l.append(v)) : l.append(g.getControl()), e.AnswerCtrl = g), e.Action = "C"; else if (f.NodeAction == "W") { y = t('<button style="margin-bottom:10px;margin-top: 0px;width: 100%;" class="VIS_Pref_pass-btn" data-id="' + u + '" data-window="' + f.AD_Window_ID + '" data-col="' + f.KeyCol + '">').append(f.NodeName); e.AnswerCtrl = y; l.append(y); y.on("click", function () { li(t(this).data("id"), t(this).data("window"), t(this).data("col")) }); e.Action = "W" } else if (f.NodeAction == "X") { y = t('<button style="margin-bottom:10px;margin-top: 0px;width: 100%;" class="VIS_Pref_pass-btn" data-id="' + u + '" data-form="' + f.AD_Form_ID + '" data-col="' + f.KeyCol + '">').append(f.NodeName); e.AnswerCtrl = y; l.append(y); y.on("click", function () { n.viewManager.startForm(t(this).data("form")) }); e.Action = "X" } l.append(t("<p style='margin-bottom: 0'>").append(n.Msg.getMsg("Forward"))); ai = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.Search, "AD_User_ID", 0, !1, null); ft = new n.Controls.VTextBoxButton("AD_User_ID", !1, !1, !0, n.DisplayType.Search, ai); e.FwdCtrl = ft; ft.getBtn(); ft.getBtnCount() == 2 && (v = t("<div class='vis-wforwardwrap'>"), v.append(ft.getControl()), v.append(ft.getBtn(0)), l.append(v)); ri = t("<li>"); h = t("<a href='javascript:void(0)' class='vis-btn vis-btn-done vis-icon-doneButton vis-workflowActivityIcons' data-clicked='N' data-id='" + u + "'>"); h.append(t("<span class='vis-btn-ico vis-btn-done-bg vis-btn-done-border'>")); h.append(n.Msg.getMsg("Done")); ri.append(h); h.on(n.Events.onTouchStartOrClick, function () { var i, r; if (h.data("clicked") != "Y") if (h.data("clicked", "Y"), window.VA055 && window.VADMS && f.ColName == "VADMS_SignStatus") { if (i = { documentNo: nt[nt.length - 1], defaultReasonKey: t('[name="VADMS_SignStatus"]').children("option:selected").val(), defaultReason: t('[name="VADMS_SignStatus"]').children("option:selected").text() }, i.defaultReasonKey == undefined || i.defaultReasonKey == "" || i.defaultReason == undefined || i.defaultReason == "") { h.data("clicked", "N"); n.ADialog.info("VA055_ChooseStatus"); return } t.post(n.Application.contextUrl + "VADMS/Document/SignatureUsingWorkflow", i, function (i) { i && i != "null" && i.result == "success" ? (t("#divfeedbsy")[0].style.visibility = "hidden", o.empty(), ni(), d = [], s = [], p.show(), window.setTimeout(function () { pt(!0) }, 5e3)) : (h.data("clicked", "N"), n.ADialog.error(i.result)) }, "json").fail(function (t, i) { h.data("clicked", "N"); n.ADialog.error(i) }) } else r = t(this).data("id"), hi(r, h) }); if (at.append(ri), r.append(at), r.append(t("<div class='clearfix'>")), r.append(t("<p style='margin-bottom: 0'>").append(n.Msg.getMsg("Message"))), r.append(t("<div class='clearfix'>")), ct = t("<div class='vis-sendMessage'>"), ui = t("<input type='text' placeholder='" + n.Msg.getMsg("TypeMessage") + "....'>"), e.MsgCtrl = ui, ct.append(ui), ct.append(t("<button class='vis vis-sms'><\/button>")), ct.append(t("<div class='clearfix'>")), r.append(ct), d.push(e), s.length <= 1 && (r.append(t("<h3>").append(n.Msg.getMsg("History"))), r.append(t("<div class='clearfix'>")), fi = t("<div class='vis-history-wrap'>"), r.append(fi), f.Node != null)) { tt = t("<div style='margin-top:15px;margin-bottom:15px'>"); for (node in f.Node) if (f.Node[node].History != null) { for (hNode in f.Node[node].History) f.Node[node].History[hNode].State == "CC" && node < f.Node.length - 1 ? (tt.append(t("<div class='vis-vertical-img'>").append(t("<img src='" + n.Application.contextUrl + "Areas/VIS/Images/home/4.jpg'>"))), w = t("<div class='vis-approved_wrap'>"), ei = "", ei = f.Node[node].Name, b = t("<div class='vis-left-part'>"), f.Node[node].History[hNode].TextMsg.length > 0 && (it = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip' style='margin-right:5px'>").append(t("<img class='VIS_Pref_img-i'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/i.png")), k = t("<span>"), k.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), k.append(t("<label class='VIS_Pref_Label_Font'>").append(n.Utility.encodeText(f.Node[node].History[hNode].TextMsg))), it.append(k), b.append(it)), b.append(ei), w.append(b), rt = t("<div class='vis-right-part'>"), rt.append(n.Msg.getMsg("CompletedBy")).append(t("<span class='vis-app_by'>").append(f.Node[node].History[hNode].ApprovedBy)), w.append(rt), tt.append(w)) : node < f.Node.length - 1 || f.Node.length == 1 ? (w = t("<div class='vis-pending_wrap' style='margin-top:-2px'>"), w.append(t("<div class='vis-left-part'>").append(f.Node[node].Name)), w.append(t("<div class='vis-right-part'>").append(n.Msg.getMsg("Pending"))), tt.append(w)) : (tt.append(t("<div class='vis-vertical-img'>").append(t("<img src='" + n.Application.contextUrl + "Areas/VIS/Images/home/4.jpg'>"))), vt = t("<div class='vis-start_wrap' style='margin-bottom:-8px'>"), b = t("<div class='vis-left-part'>"), f.Node[node].History[hNode].TextMsg.length > 0 && (it = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip' style='margin-right:5px'>").append(t("<img class='VIS_Pref_img-i'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/i.png")), k = t("<span >"), k.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), k.append(t("<label class='VIS_Pref_Label_Font'>").append(n.Utility.encodeText(f.Node[node].History[hNode].TextMsg))), it.append(k), b.append(it)), b.append(f.Node[node].Name), vt.append(b), rt = t("<div class='vis-right-part'>"), rt.append(n.Msg.getMsg("CompletedBy")).append(t("<span class='vis-app_by'>").append(f.Node[node].History[hNode].ApprovedBy)), vt.append(rt), tt.append(vt)); fi.append(tt) } } p.hide() }, ii = function (t) { n.AEnv.wfzoom(a[t].AD_Table_ID, a[t].Record_ID, a[t].AD_WF_Activity_ID) }, hi = function (i, r) { var r = r; t("#divfeedbsy")[0].style.visibility = "visible"; window.setTimeout(function () { var u, h, f, e; for (u in d) try { if (i === d[u].Index) { var c = d[u].FwdCtrl.getValue(), l = n.Utility.encodeText(d[u].MsgCtrl.val()), h = null; if (d[u].Action == "C" && (h = d[u].AnswerCtrl.getValue()), f = "", s && s.length > 0) for (e = 0; e < s.length; e++)f.length > 0 && (f += ","), f += s[e].split("_")[2]; else f = a[i].AD_WF_Activity_ID; y = a[i].AD_Window_ID; n.dataContext.getJSONData(n.Application.contextUrl + "WFActivity/ApproveIt", { activityID: f, nodeID: a[i].AD_Node_ID, txtMsg: l, fwd: c, answer: h, AD_Window_ID: y }, function (i) { i.result == "" ? (t("#divfeedbsy")[0].style.visibility = "hidden", r.data("clicked", "N"), o.empty(), ni(), d = [], s = [], p.show(), pt(!0)) : (alert(n.Msg.getMsg(i.result)), r.data("clicked", "N"), t("#divfeedbsy")[0].style.visibility = "hidden") }); break } } catch (w) { alert("FillManadatory"); r.data("clicked", "N"); t("#divfeedbsy")[0].style.visibility = "hidden" } r.data("clicked", "N") }, 2) }, ci = function (i, r) { var f, e, u; return i.ColID == 0 ? null : i.ColReference == n.DisplayType.YesNo ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.List, i.ColName, 319, !1, null), new n.Controls.VComboBox(i.ColName, !1, !1, !0, u, 50)) : i.ColReference == n.DisplayType.List ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.List, i.ColName, i.ColReferenceValue, !1, null), new n.Controls.VComboBox(i.ColName, !1, !1, !0, u, 50)) : i.ColName.toUpperCase() == "C_GENATTRIBUTESETINSTANCE_ID" ? (f = null, e = new n.MGAttributeLookup(n.context, 0), t.ajax({ url: n.Application.contextUrl + "WFActivity/GetRelativeData", async: !1, data: { activityID: r }, dataType: "json", success: function (t) { t.result && (f = new n.Controls.VPAttribute("C_GenAttributeSetInstance", !0, !1, !0, n.DisplayType.PAttribute, e, 0, !0, !1, !1, !1), f.SetC_GenAttributeSet_ID(t.result.GenAttributeSetID)) } }), f) : i.ColReference == n.DisplayType.TableDir ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.TableDir, i.ColName, i.ColReferenceValue, !1, null), new n.Controls.VComboBox(i.ColName, !1, !1, !0, u, 50)) : i.ColReference == n.DisplayType.Search ? (u = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.Search, i.ColName, i.ColReferenceValue, !1, null), new n.Controls.VTextBoxButton(i.ColName, !1, !1, !0, n.DisplayType.Search, u)) : new n.Controls.VTextBox(i.ColName, !1, !1, !0, 50, 100, null, null, !1) }, li = function (t, i, r) { var u = new n.Query; u.addRestriction(r, n.Query.prototype.EQUAL, a[t].Record_ID); n.viewManager.startWindow(i, u) }; this.clear = function () { for (var n in nt) nt[n] = null } } n.wfActivity = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { function rt() { st(); ht(); ut(); ft(u) } function ut() { var f, c, i, l, t; f = n.Env.isBaseLanguage(v, "AD_Ref_List") ? "SELECT Value, Name, Description FROM AD_Ref_List WHERE AD_Reference_ID=135 ORDER BY Name" : "SELECT l.Value, t.Name, t.Description FROM AD_Ref_List l, AD_Ref_List_Trl t WHERE l.AD_Ref_List_ID=t.AD_Ref_List_ID AND t.AD_Language='" + n.Env.getAD_Language(v) + "' AND l.AD_Reference_ID=135 ORDER BY t.Name"; var u = [], e = [], o = []; try { if (c = n.secureEngine.encrypt(f), i = n.dataContext.getJSONData(n.Application.contextUrl + "DocAction/GetReference", { RefQry: c }, null), i != null) for (t in i) { var y = i[t].Value, p = i[t].Name, r = i[t].Description; (r == null || r == "undefined") && (r = ""); u.push(y); e.push(p); o.push(r) } } catch (w) { console.log(w) } for (l = u.length, s = [], h = [], a = [], t = 0; t < l; t++)s.push(u[t]), h.push(e[t]), a.push(o[t]) } function ft(u) { var e, f, o, c; y = r.getValue("DocStatus"); e = r.getValue("DocAction"); f = r.getValue("Processing"); f = f != "N" && f ? !0 : !1; o = v.getWindowContext(i, "OrderType"); c = v.isSOTrx(i); t.ajax({ url: n.Application.contextUrl + "DocAction/GetDocActions", type: "POST", dataType: "Json", data: { AD_Table_ID: d, Record_ID: u, docStatus: y, processing: f, orderType: o, isSOTrx: c, docAction: e, tableName: r.getTableName(), values: JSON.stringify(s), names: JSON.stringify(h), C_DocType_ID: r.getValue("C_DocType_ID"), C_DocTypeTarget_ID: r.getValue("C_DocTypeTarget_ID") }, success: function (n) { var t = JSON.parse(n); et(t); ot(t) } }) } function et(t) { if (k(!1), y = t.DocStatus, t.Error != null && t.Error != "" && t.Error != "undefined") { n.ADialog.error(t.Error); return } if (t.DocStatus == null) { p.text("*** ERROR ***"); return } } function ot(t) { for (var u, i, r = 0; r < t.Index; r++)for (u = !1, i = 0; i < s.length && !u; i++)t.Options[r].equals(s[i]) && (o.append("<option >" + h[i] + "<\/option>"), u = !0); if (t.DefaultV != null && t.DefaultV != "" && t.DefaultV != "undefined" && o.val(t.DefaultV).change(), c.prop("disable", !1), e.getNumberOfOptions() == 0) { n.ADialog.info("InfoDocActionNoOptions", ""); e.log.info("DocAction - No Options"); f.close(); return } } function st() { var u = t("<tr>"), e = t("<tr>"), s = t("<tr>"), h = t("<td>"), v = t("<td>"), a = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), r; h.append(a); a.append(i); i.append(o); i.append("<label >" + n.Msg.getMsg("DocAction") + "<\/label>"); u.append(h); r = t("<td>"); r.append(p); e.append(r); $td31 = t("<td>"); $td32 = t('<td style="text-align:right">'); s.append($td31).append($td32); l.append(u).append(e).append(s); c.append(l); k(!0); c.append(w).append(b); f = new n.ChildDialog } function ht() { o.on("change", function () { var n = g(); n != -1 && a.length > 0 && p.text(a[n]) }); f.onOkClick = function () { ct() && (e.isOKPressed = !0, e.onClose && e.onClose()) }; f.onCancelClick = function () { e.onClose && e.onClose() } } function k(n) { n ? (w.show(), b.show(), c.find("button").prop("disabled", !0)) : (w.hide(), b.hide(), c.find("button").prop("disabled", !1)) } function g() { var t = -1, i, n; if (o.val() == null) return t; for (i = o.val(), n = 0; n < h.length && t == -1; n++)if (i.equals(h[n])) { t = n; break } return t } function ct() { k(!0); var n = g(); return n == -1 ? (k(!1), !1) : (r.setValue("DocAction", s[n]), !0) } var v = n.Env.getCtx(), d = r.getAD_Table_ID(), s = [], h = [], a = [], y = null, nt = 0, tt = "", l, f, w, b; this.log = n.Logging.VLogger.getVLogger("VDocAction"); var it, o = t('<select class="vis-select-docAction"><\/select>'), p = t('<p style="font-size:12px;margin-bottom:-5px"><\/p>'), c = t('<div style="margin-bottom:-5px"><\/div>'), e = this; this.batch = !1; this.isOKPressed = !1; l = t('<table style="width:360px;margin-bottom:9px">'); f = null; this.onClose = null; w = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); b = t("<label>" + n.Msg.getMsg("Loading") + "<\/label>"); n.Application.isRTL; rt(); this.getNumberOfOptions = function () { return o.children("option").length }; this.isStartProcess = function () { return this.isOKPressed }; this.isBatch = function () { return this.batch }; this.show = function () { f.setContent(c); f.setTitle(n.Msg.getMsg("DocAction")); f.setModal(!0); f.show() }; f.onClose = function () { e.dispose() }; this.dispose = function () { f.close(); f = null; d = null; s = null; h = null; a = null; y = null; nt = 0; tt = null; it = null; o = null; p = null; c = null; e = null; l && l.empty(); l = null } } function r() { this.ACTION_COMPLETE = "CO"; this.ACTION_WAITCOMPLETE = "WC"; this.ACTION_APPROVE = "AP"; this.ACTION_REJECT = "RJ"; this.ACTION_POST = "PO"; this.ACTION_VOID = "VO"; this.ACTION_CLOSE = "CL"; this.ACTION_REVERSE_CORRECT = "RC"; this.ACTION_REVERSE_ACCRUAL = "RA"; this.ACTION_REACTIVATE = "RE"; this.ACTION_NONE = "--"; this.ACTION_PREPARE = "PR"; this.ACTION_UNLOCK = "XL"; this.ACTION_INVALIDATE = "IN"; this.ACTION_REOPEN = "OP"; this.STATUS_DRAFTED = "DR"; this.STATUS_COMPLETED = "CO"; this.STATUS_APPROVED = "AP"; this.STATUS_INVALID = "IN"; this.STATUS_NOTAPPROVED = "NA"; this.STATUS_VOIDED = "VO"; this.STATUS_REVERSED = "RE"; this.STATUS_CLOSED = "CL"; this.STATUS_UNKNOWN = "??"; this.STATUS_INPROGRESS = "IP"; this.STATUS_WAITINGPAYMENT = "WP"; this.STATUS_WAITINGCONFIRMATION = "WC" } n.VDocAction = i; n.DocumentEngine = r }(VIS, jQuery), function (n, t) { function i() { function n(n, i, r, u, f, e) { if (window.WSP) { var o = t("<div id='divAptBusy' class='wsp-busy-indicater'><\/div>"); t("body").append(o); f == !1 ? (o.show(), WSP.AppointmentsForm.init(n, i, r, u, o, e)) : (o.show(), WSP.TaskForm.init(n, i, r, u, o, e)) } else alert("please download WSP !!!") } return { init: n } } n.AppointmentsForm = i() }(VIS, jQuery), function (n, t) { function i(i, r, u) { function uu() { var ii = t('<div class="input-group vis-input-wrap"><\/div>'), e = t('<div class="vis-control-wrap"><\/div>'), ri = null, u, a, v, y, b, ft, vt, yt, dt, gt; ri = t('<label class="vis-payment-spanPayment"> ' + n.Msg.translate(f, "PaymentMethod") + " <\/label>"); ii.append(e); p = t('<select class="vis-payment-cmbPayment"><\/select>'); p.appendTo(e); ri.appendTo(e); ii.appendTo(k); lt = t('<table class="vis-payment-table"><\/table>'); u = t("<tr><\/tr>"); lt.append(u); gi = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "CreditCardType") + "<\/label>"); nr = t('<label class="vis-payment-span">' + n.Msg.translate(f, "CreditCardNumber") + "<\/label>"); tr = t('<label class="vis-payment-span">' + n.Msg.translate(f, "Expires") + "<\/label>"); rr = t('<label class="vis-payment-span">' + n.Msg.translate(f, "VoiceAuthCode") + "<\/label>"); pt = t('<label class="vis-payment-span">' + n.Msg.translate(f, "Online") + "<\/label>"); pi = t('<label class="vis-payment-span"><\/label>'); s = t('<table class="vis-payment-table"><\/table>'); a = t("<tr><\/tr>"); s.append(a); ut = t('<table class="vis-payment-table"><\/table>'); a.append(ut); u.append(s); g = t('<select  class="vis-payment-cmb"><\/select>'); var hi = t("<tr><\/tr>"), ci = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(g); i.append(gi); hi.append(ci); ci.append(r); r.append(i); ut.append(hi); d = t('<input class="vis-payment-inputs" type="text" placeholder=" " data-placeholder="" >'); var li = t("<tr><\/tr>"), ai = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(d); i.append(nr); li.append(ai); ai.append(r); r.append(i); ut.append(li); wt = t('<input class="vis-payment-inputs"  type="text" placeholder=" " data-placeholder="" >'); var vi = t("<tr><\/tr>"), yi = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(wt); i.append(tr); vi.append(yi); yi.append(r); r.append(i); ut.append(vi); bt = t('<input class="vis-payment-inputs"  type="text" placeholder=" " data-placeholder="" >'); var lr = t("<tr><\/tr>"), ar = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(bt); i.append(rr); lr.append(ar); ar.append(r); r.append(i); ut.append(lr); pt = t('<button class="vis-payment-inputs-buttons"  type="button">' + n.Msg.translate(f, "Online") + "<\/button>"); v = t("<tr><\/tr>"); y = t("<td><\/td>"); y.append(pt); v.append(y); ut.append(v); ir = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_BP_BankAccount_ID") + "<\/label>"); wi = t('<p class="vis-payment-span"> <\/p>'); h = t('<table class="vis-payment-table"><\/table>'); b = t("<tr><\/tr>"); si = t('<table class="vis-payment-table"><\/table>'); h.append(b); b.append(si); u.append(h); et = t('<select class="vis-payment-cmb"><\/select>'); var vr = t("<tr><\/tr>"), yr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(et); i.append(ir); vr.append(yr); yr.append(r); r.append(i); si.append(vr); hr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_BankAccount_ID") + "<\/label>"); di = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "Amount") + "<\/label>"); ti = t('<label class="vis-payment-span vis-payment-AmountField"> <\/label>'); fr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "RoutingNo") + "<\/label>"); ur = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "AccountNo") + "<\/label>"); sr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "CheckNo") + "<\/label>"); ui = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_Currency_ID") + "<\/label>"); bi = t('<p class="vis-payment-span"> <\/p>'); ei = t('<button class="vis-payment-inputs-buttons"  type="button">' + n.Msg.translate(f, "Online") + "<\/button>"); c = t('<table class="vis-payment-table"><\/table>'); ft = t("<tr><\/tr>"); w = t('<table class="vis-payment-table"><\/table>'); ft.append(w); c.append(ft); u.append(c); nt = t('<select class="vis-payment-cmb"><\/select>'); var pr = t("<tr><\/tr>"), wr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(nt); i.append(hr); pr.append(wr); wr.append(r); r.append(i); w.append(pr); ti = t('<input type="text" readonly class="vis-payment-span vis-payment-AmountField">'); var br = t("<tr><\/tr>"), kr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ti); i.append(di); br.append(kr); kr.append(r); r.append(i); w.append(br); it = t('<input class="vis-payment-inputs" type="text" placeholder=" " data-placeholder="" >'); var dr = t("<tr><\/tr>"), gr = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(it); i.append(fr); dr.append(gr); gr.append(r); r.append(i); w.append(dr); tt = t('<input class="vis-payment-inputs" type="text" placeholder=" " data-placeholder="" >'); var nu = t("<tr><\/tr>"), tu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(tt); i.append(ur); nu.append(tu); tu.append(r); r.append(i); w.append(nu); rt = t('<input class="vis-payment-inputs"  type="text" placeholder=" " data-placeholder="" >'); var iu = t("<tr><\/tr>"), ru = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(rt); i.append(sr); iu.append(ru); ru.append(r); r.append(i); w.append(iu); ot = t('<select class="vis-payment-cmb"><\/select>'); var uu = t("<tr><\/tr>"), fu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ot); i.append(ui); uu.append(fu); fu.append(r); r.append(i); w.append(uu); ei = t('<button class="vis-payment-inputs-buttons"  type="button">' + n.Msg.translate(f, "Online") + "<\/button>"); vt = t("<tr><\/tr>"); yt = t('<td colspan="2"><\/td>'); yt.append(ei); vt.append(yt); w.append(vt); er = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_PaymentTerm_ID") + "<\/label>"); l = t('<table  class="vis-payment-table"><\/table>'); dt = t("<tr><\/tr>"); oi = t('<table  class="vis-payment-table"><\/table>'); dt.append(oi); l.append(dt); u.append(l); ht = t('<select class="vis-payment-cmb"><\/select>'); var eu = t("<tr><\/tr>"), ou = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ht); i.append(er); eu.append(ou); ou.append(r); r.append(i); oi.append(eu); cr = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_CashBook_ID") + "<\/label>"); fi = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "C_Currency_ID") + "<\/label>"); ki = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "Amount") + "<\/label>"); ni = t('<label class="vis-payment-span vis-payment-AmountField"> <\/label>'); or = t('<label class="vis-payment-span"> ' + n.Msg.translate(f, "DateAcct") + "<\/label>"); o = t('<table class="vis-payment-table"><\/table>'); gt = t("<tr><\/tr>"); at = t('<table class="vis-payment-table"><\/table>'); gt.append(at); o.append(gt); u.append(o); st = t('<select class="vis-payment-cmb"><\/select>'); var su = t("<tr><\/tr>"), hu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(st); i.append(fi); su.append(hu); hu.append(r); r.append(i); at.append(su); ct = t('<select class="vis-payment-cmb"><\/select>'); var cu = t("<tr><\/tr>"), lu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ct); i.append(cr); cu.append(lu); lu.append(r); r.append(i); at.append(cu); kt = t('<input class="vis-payment-inputs vis-payment-date" type="date" placeholder=" " data-placeholder="" >'); var au = t("<tr><\/tr>"), vu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(kt); i.append(or); au.append(vu); vu.append(r); r.append(i); at.append(au); ni = t('<input type="text" readonly class="vis-payment-span vis-payment-AmountField"> '); var yu = t("<tr><\/tr>"), pu = t('<td class="vis-payment-td2"><\/td>'), r = t('<div class="input-group vis-input-wrap">'), i = t('<div class="vis-control-wrap">'); i.append(ni); i.append(ki); yu.append(pu); pu.append(r); r.append(i); at.append(yu); k.append(lt) } function fu(i) { var f = !1; return (y = r.getValue("DocStatus"), r.getValue("C_BPartner_ID") == null) ? (n.ADialog.error("0", !0, n.Msg.getMsg("SaveErrorRowNotFound")), f = !1) : (y = r.getValue("DocStatus"), y == null && (y = ""), y.equals("RE") || y.equals("VO") || y.equals("CL")) ? f = !1 : (b = y.equals("CO") || y.equals("WP") ? !1 : !0, b || ii || r.getValue("M_Warehouse_ID") == null || (b = !0), b ? lt.hide() : lt.show(), _Amount = r.getValue("GrandTotal"), !b && _Amount == 0) ? (n.ADialog.error("", !0, n.Msg.getMsg("PaymentZero")), f = !1) : (vr = parseInt(r.getValue("AD_Client_ID")), yr = parseInt(r.getValue("AD_Org_ID")), pr = parseInt(r.getValue("C_BPartner_ID")), a = r.getValue("PaymentRule"), ri = parseInt(r.getValue("C_Currency_ID")), yt = r.getValue("DateAcct"), (r.getValue("C_PaymentTerm_ID") != null || r.getValue("C_PaymentTerm_ID") != {}) && (ft = parseInt(r.getValue("C_PaymentTerm_ID"))), r.getValue("C_Payment_ID") != null && r.getValue("C_Payment_ID") != {} && (li = parseInt(r.getValue("C_Payment_ID"))), r.getValue("C_CashLine_ID") != null && r.getValue("C_CashLine_ID") != {} && (ai = parseInt(r.getValue("C_CashLine_ID"))), e = { _DocStatus: y, _isSOTrx: ii, _AD_Client_ID: vr, _AD_Org_ID: yr, _C_BPartner_ID: pr, _PaymentRule: a, _C_Currency_ID: ri, _DateAcct: yt, _C_PaymentTerm_ID: ft, _C_Payment_ID: li, _C_CashLine_ID: ai, values: JSON.stringify(i), _Amount: _Amount }, t.ajax({ url: n.Application.contextUrl + "PaymentRule/LoadPaymentMethodDetails", type: "POST", async: !1, dataType: "Json", data: e, success: function (n) { var i, v, e, r; lr(!1); i = JSON.parse(n); ar = i.CCType; b ? lt.hide() : lt.show(); ni.val(_Amount); ti.val(_Amount); d.val(i.strKNumber); wt.val(i.strKExp); bt.val(i.strKApproval); pi.val(i.strKStatus); i.canChange && (g.attr("disable", !1), d.attr("disable", !1), wt.attr("disable", !1), bt.attr("disable", !1), pt.attr("disable", !1)); it.val(i.StrSRouting); tt.val(i.StrSNumber); rt.val(i.StrSCheck); bi.text(i.StrSStatus); wi.text(i.StrTStatus); yt != null && (kt.Value = yt); v = ri; i._Currencies != null && i._Currencies != undefined && i._Currencies[ri] ? (t.each(i._Currencies, function (n, i) { ot.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), t.each(i._Currencies, function (n, i) { st.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) })) : (fi.hide(), st.hide(), ui.hide(), ot.hide()); a == null && (a = ""); for (e in u.values) { if (r = e, dt.equals(r) && !ii) continue; else if (gt.equals(r) && ii) continue; p.append(t('<option value="' + r + '">' + u.values[e] + "<\/option>")); r.equals(a) && p.val(r) } return i.loadPaymentTerms != null && i.loadPaymentTerms != undefined && (t.each(i.loadPaymentTerms, function (n, i) { ht.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), ft != null && ft != undefined && ht.val(ft)), i.loadAccounts != null && i.loadAccounts != undefined && (t.each(i.loadAccounts, function (n, i) { et.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.kp != null && et.val(i.kp)), i.ccs != null && i.ccs != undefined && (t.each(i.ccs, function (n, i) { g.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.CCType != null && g.val(i.CCType)), i.loadBankAccounts != null && i.loadBankAccounts != undefined && (t.each(i.loadBankAccounts, function (n, i) { nt.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.kp != null && nt.val(i.kp)), i.Checkbook_ID != null && nt.val(i.Checkbook_ID), i.loadCashBooks != null && i.loadCashBooks != undefined && t.each(i.loadCashBooks, function (n, i) { ct.append(t("<option><\/option>").attr("value", i.Key).text(i.Name)) }), i.Checkbook_ID != null && (ct.val(i.Checkbook_ID), vi == 0 && (vi = i.Checkbook_ID)), a == "B" ? (s.hide(), l.hide(), o.show(), h.hide(), c.hide()) : a == "K" ? (s.show(), l.hide(), o.hide(), h.hide(), c.hide()) : a == "D" ? (s.hide(), l.hide(), o.hide(), h.show(), c.hide()) : a == "P" ? (s.hide(), l.show(), o.hide(), h.hide(), c.hide()) : a == "S" && (s.hide(), l.hide(), o.hide(), h.hide(), c.show()), f = !0 } }), f) } function eu(n) { if (n != undefined && !n) { v.close(); return } p.on("change", ou); ot.on("change", su); st.on("change", hu); pt.on("click", cu); v.onOkClick = function () { lr(!0); var n = lu(); n && (vt.isOKPressed = !0, vt.onClose && vt.onClose()) }; v.onCancelClick = function () { vt.onClose && vt.onClose() }; v.onClose = function () { vt.dispose() } } function ou() { var n = p.val(), t; n != null && (t = n.toLower(), (dt == t.toLower() || dt == t.toUpper()) && (t = gt.toLower()), t += "Panel", n.equals("K") ? (s.show(), l.hide(), o.hide(), h.hide(), c.hide()) : n.equals("B") ? (s.hide(), l.hide(), o.show(), h.hide(), c.hide()) : n.equals("D") ? (s.hide(), l.hide(), o.hide(), h.show(), c.hide()) : n.equals("P") ? (s.hide(), l.show(), o.hide(), h.hide(), c.hide()) : n.equals("S") ? (s.hide(), l.hide(), o.hide(), h.hide(), c.show()) : n.equals("T") && (s.hide(), l.hide(), o.hide(), h.hide(), c.hide())) } function su() { } function hu() { } function cu() { } function lu() { var o = !0, s = au(), u; return s ? (u = p.val(), u == null) ? void 0 : b && u ? (u.equals(a) || r.setValue("PaymentRule", u), o = !0) : (e.cmbPayment = p.val(), u.equals(wr) ? (e.cmbBCurrency = st.val(), e.cmbBCashBook = ct.val(), e.bDateField = kt.val()) : u.equals(br) ? (e.cmbKType = g.val(), e.txtKNumber = d.val(), e.txtKExp = wt.val(), e.txtKApproval = bt.val()) : u.equals(gt) ? e.cmbTAccount = et.val() : u.equals(kr) ? e.cmbPTerm = ht.val() : u.equals(yi) && (e.cmbSBankAccount = nt.val(), e.txtSRouting = it.val(), e.txtSNumber = tt.val(), e.txtSCheck = rt.val(), e.cmbSCurrency = ot.val()), e.C_Order_ID = f.getContextAsInt(i, "C_Order_ID"), e.C_Invoice_ID = f.getContextAsInt(i, "C_Invoice_ID"), t.ajax({ url: n.Application.contextUrl + "PaymentRule/SaveChanges", type: "POST", async: !1, dataType: "Json", data: e, success: function (n) { var t = JSON.parse(n); return t.ErrorMsg != null && t.ErrorMsg != "" && t.ErrorMsg != undefined && alert(t.ErrorMsg), t.SucessMsg != null && t.SucessMsg != "" && t.SucessMsg != undefined && alert(t.SucessMsg), t.newPaymentRule == null || t.newPaymentRule == undefined || t.newPaymentRule.equals(a) || r.setValue("PaymentRule", t.newPaymentRule), t.newDateAcct == null || t.newDateAcct == undefined || t.newDateAcct.equals(yt) || r.setValue("DateAcct", t.newDateAcct), t.newC_PaymentTerm_ID != ft && t.newC_PaymentTerm_ID > 0 && r.setValue("C_PaymentTerm_ID", t.newC_PaymentTerm_ID), t._C_Payment_ID != li && (t._C_Payment_ID == 0 ? r.setValue("C_Payment_ID", null) : r.setValue("C_Payment_ID", t._C_Payment_ID)), t._C_CashLine_ID != ai && (t._C_CashLine_ID == 0 ? r.setValue("C_CashLine_ID", null) : r.setValue("C_CashLine_ID", t._C_CashLine_ID)), o = !0 }, error: function () { return o = !1 } }), o) : o = !1 } function au() { var i = !0, u, t, s, r, f; try { if (u = p.val(), u == null || u == undefined) return !1; if (t = u, b) return !0; var h = yt, o = ft, c = vi, l = ar, e = 0; if (t.equals(wr)) c = ct.val(), h = kt.val(); else if (t.equals(br)) l = g.val(), (d.val() == null || d.val() == "" || d.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("CreditCardNumberError")), i = !1); else if (t.equals(gt) || t.equals(dt)) s = et.val(), s == null && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBPBankNotFound")), i = !1); else if (t.equals(kr)) o = ht.val(), r != null && (o = r); else if (t.equals(yi)) r = nt.val(), r != null && (e = r), (it.val() == null || it.val() == "" || it.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBankRoutingNotValid")), i = !1), (tt.val() == null || tt.val() == "" || tt.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBankAccountNotValid")), i = !1), (rt.val() == null || rt.val() == "" || rt.val() == undefined) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentBankCheckNotValid")), i = !1); else return !1; "KTSD".indexOf(t) != -1 && e == 0 && (f = gr, t.equals(gt) ? f = dr : t.equals(dt) ? f = nu : t.equals(yi) && (f = tu), e == 0 && "S".equals(t) && (n.ADialog.error("", !0, n.Msg.getMsg("PaymentNoProcessor")), i = !1)) } catch (a) { log.Severe(a.ToString()) } return i } function lr(n) { n ? (hi.show(), k.find("button").prop("disabled", !0)) : (hi.hide(), k.find("button").prop("disabled", !1)) } var vt = this, f = n.Env.getCtx(), ci = !1, ii = n.context.isSOTrx(i), y = null, a = "", ri = 0, yt = null, ft = 0, li = 0, ai = 0, vi = 0, ar = "", pi, wi, bi, ki, ni, di, ti, iu, gi, nr, tr, ir, rr, ur, fr, ui, fi, er, or, sr, hr, cr, p, g, et, ot, st, ht, nt, ct, pt, ei, d, wt, bt, tt, it, rt, kt, lt, at, oi, ru, ut, si, w, hi; this.log = n.Logging.VLogger.getVLogger("vPayment"); var vr = 0, yr = 0, pr = 0, e = {}, wr = "B", dt = "D", br = "K", kr = "P", yi = "S", gt = "T", dr = "A", gr = "C", nu = "D", tu = "K", b = !1, k, v = null, o, s, h, c, l; this.onClose = null; hi = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><label>' + n.Msg.getMsg("Loading") + "<\/label><\/div><\/div>"); this.init = function () { uu(); ci = fu(u.values); eu(ci) }; this.isInitOK = function () { return ci }; this.show = function () { v = new n.ChildDialog; k = t('<div class="vis-formouterwrpdiv"><\/div>'); k.append(hi); lr(!0); v.setContent(k); v.setWidth(360); v.setTitle(n.Msg.getMsg("Payment")); v.setModal(!0); v.show() }; this.onClose = null; this.dispose = function () { k != null && (k = null); v = null; o = null; s = null; h = null; c = null; l = null; this.onClose = null; pi = null; wi = null; bi = null; ki = null; ni = null; di = null; ti = null; iu = null; gi = null; nr = null; tr = null; ir = null; rr = null; ur = null; fr = null; ui = null; fi = null; er = null; or = null; sr = null; hr = null; cr = null; p = null; g = null; et = null; ot = null; st = null; ht = null; nt = null; ct = null; pt = null; ei = null; d = null; wt = null; bt = null; tt = null; it = null; rt = null; kt = null; at = null; oi = null; ru = null; ut = null; si = null; w = null } } n.VPayment = i }(VIS, jQuery), function (n, t) { n.TestForm = function () { function o() { i = t("<div>"); f = t("<input type='text'>"); r = t("<input type='button'>").val("Show"); u = t("<input type='button'>").val("Close"); i.append(f).append(r).append(u) } var i, f, r, u, e; this.frame; this.windowNo; o(); e = this; r.on(n.Events.onTouchStartOrClick, function () { alert("Test From has value :==> " + f.val()) }); u.on(n.Events.onTouchStartOrClick, function () { confirm("wanna close this form???") && e.dispose() }); this.getRoot = function () { return i }; this.disposeComponent = function () { e = null; i && i.remove(); i = null; r && r.off(n.Events.onTouchStartOrClick); u && u.off(n.Events.onTouchStartOrClick); f = r = u = null; this.getRoot = null; this.disposeComponent = null } }; n.TestForm.prototype.init = function (n, t) { this.frame = t; this.frame.getContentGrid().append(this.getRoot()) }; n.TestForm.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.TestMsgForm = function () { function s() { u = t("<div>"); f = t("<input type='text'>"); i = t("<input type='button'>").val("Start"); r = t("<input type='button' disable>").val("Stop"); u.append(f).append(i).append(r) } function o(n, t) { n ? (r.hide(), i.show(), f.css("color", "red")) : (r.show(), i.hide(), f.css("color", "green")); f.val(t) } var u, f, i, r, e; this.frame; this.windowNo; s(); e = this; i.on(n.Events.onTouchStartOrClick, function () { e.sendRequest(!1); o(!1, "started") }); r.on(n.Events.onTouchStartOrClick, function () { e.sendRequest(!0); o(!0, "Stopped") }); this.getRoot = function () { return u }; this.onmessage = function (n) { n.Event == "DEMOS" ? o(!1, n.Message) : n.Event == "DEMOE" && o(!0, n.Message) }; this.disposeComponent = function () { e = null; u && u.remove(); u = null; i && i.off(n.Events.onTouchStartOrClick); r && r.off(n.Events.onTouchStartOrClick); f = i = r = null; this.getRoot = null; this.disposeComponent = null } }; n.TestMsgForm.prototype.init = function (t, i) { this.frame = i; this.frame.getContentGrid().append(this.getRoot()); n.sseManager.register(this) }; n.TestMsgForm.prototype.sendRequest = function (t) { n.dataContext.postJSONData(n.Application.contextUrl + "Message/Demo", { IsStop: t }, function () { }) }; n.TestMsgForm.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null; n.sseManager.unregister(this) } }(VIS, jQuery), function (n, t) { function i(i) { var o, s, h, u, f; this.onClose = null; this.dGrid = null; o = "SelectDeselectAll"; s = !0; this.arrListColumns = []; this.log = n.Logging.VLogger.getVLogger("VCreateFrom"); this.divPaging = null; this.ulPaging = null; this.liFirstPage = null; this.liPrevPage = null; this.liCurrPage = null; this.liNextPage = null; this.liLastPage = null; this.cmbPage = null; h = []; this.multiValues = []; this.editedItems = []; this.NonEditableRecord = []; var r = this, e = n.Application.contextUrl, c = e + "JsonData/JDataSet", l = e + "JsonData/ExecuteNonQuer"; this.$root = t("<div style='position:relative'>"); this.log = n.Logging.VLogger.getVLogger("VCreateFrom"); this.$busyDiv = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); this.topDiv = t("<div class='vis-locatormainwrap vis-formouterwrpdiv'>"); this.middelDiv = t("<div class='vis-crtfrm-datawrp'>"); this.bottomDiv = t("<div class='vis-ctrfrm-btnwrp'>"); this.divPaging = t("<div>"); this.record_ID = 0; this.windowNo = i.getWindowNo(); this.mTab = i; this.initOK = !1; this.isApplied = !1; u = "btnOk_" + this.windowNo; this.Okbtn = t("<input id='" + u + "' class='VIS_Pref_btn-2' type='button' value='" + n.Msg.getMsg("OK") + "'>"); u = "btnCancel_" + this.windowNo; this.cancelbtn = t("<input id='" + u + "' class='VIS_Pref_btn-2' type='button' value='" + n.Msg.getMsg("Cancel") + "'>"); u = "btnDelete_" + this.windowNo; f = n.Application.contextUrl + "Areas/VIS/Images/base/uncheck-icon.png"; this.selectAllButton = t("<button type='button' id='" + u + "' style='margin-bottom:0px;margin-top:0px;display: none;float: left;padding: 0px;border: 0px;' value='Ok' role='button' aria-disabled='false'><img src='" + f + "'><\/button>"); u = "btnRefresh_" + this.windowNo; f = n.Application.contextUrl + "Areas/VIS/Images/base/Refresh24.png"; this.btnRefresh = t("<button id='" + u + "' style='margin-bottom: 1px; margin-top: 0px;display: none; float: left; margin-left: 0px;height: 38px; ' class='VIS_Pref_btn-2'><img src='" + f + "'><\/button>"); u = "btnApply_" + this.windowNo; this.Applybtn = t("<input id='" + u + "' class='VIS_Pref_btn-2' style='display: none;' type='button' value='" + n.Msg.getMsg("Apply") + "'>"); this.lblBankAccount = new n.Controls.VLabel; this.lblBPartner = new n.Controls.VLabel; this.lblOrder = new n.Controls.VLabel; this.lblInvoice = new n.Controls.VLabel; this.lblShipment = new n.Controls.VLabel; this.lblLocator = new n.Controls.VLabel; this.lblDeliveryDate = new n.Controls.VLabel; this.lblProduct = new n.Controls.VLabel; this.lblDocumentNoRef = new n.Controls.VLabel; this.lblDocumentNo = new n.Controls.VLabel; this.lblDate = new n.Controls.VLabel; this.lblAmount = new n.Controls.VLabel; this.lblDepositSlip = new n.Controls.VLabel; this.lblAuthCode = new n.Controls.VLabel; this.lblCheckNo = new n.Controls.VLabel; this.lblContainer = null; f = n.Application.contextUrl + "Areas/VIS/Images/pallet-icon.png"; this.ContainerTree = t("<button class='input-group-text VIS_Tree-Container-disabled'><i id='ContainerTree_" + this.windowNo + "' class='fa fa-cubes'><\/i><\/button>"); this.lblProvisionalInvoice = new n.Controls.VLabel; this.cmbProvisionalInvoice = new n.Controls.VComboBox("", !1, !1, !0); this.DocumentNo = null; this.Date = null; this.Amount = null; this.DepositSlip = null; this.AuthCode = null; this.CheckNo = null; this.fromInvoice = !1; this.ProvisionalInvoice = !1; this.deliveryDate = null; this.cmbOrder = new n.Controls.VComboBox("", !1, !1, !0); this.cmbInvoice = new n.Controls.VComboBox("", !1, !1, !0); this.cmbShipment = new n.Controls.VComboBox("", !1, !1, !0); this.cmbContainer = null; this.DocumentNoRef = null; this.vProduct = null; this.cmbBankAccount = null; this.vBPartner = null; this.locatorField = null; this.child = null; this.relatedToOrg = new n.Controls.VCheckBox("Related To My Organization", !1, !1, !0, "Related To My Organization", null); this.pattrLookup = new n.MPAttributeLookup(n.context, r.windowNo); this.$productAttribute = new n.Controls.VPAttribute("M_AttributeSetInstance_ID", !1, !1, !0, n.DisplayType.PAttribute, r.pattrLookup, r.windowNo, !1, !1, !1, !0); this.title = ""; this.vetoablechange = function (t) { var e; if (t.propertyName == "M_Product_ID") { r.isApplied = !1; r.setBusy(!0); r.multiValues = []; r.dGrid != null && (r.dGrid.destroy(), r.dGrid = null); var u = r.cmbOrder.getControl().find("option:selected").val(), o = r.cmbInvoice.getControl().find("option:selected").val(), f = r.cmbShipment.getControl().find("option:selected").val(), s = r.cmbProvisionalInvoice.getControl().find("option:selected").val(), i = r.vProduct.getValue(), h = r.deliveryDate.getValue(); u != null ? r.locatorField != null ? r.loadOrders(u, i, h, !1, 1) : r.loadOrders(u, i, h, !0, 1) : o != null ? n.VCreateFromShipment.prototype.loadInvoices(o, i, 1) : f != null ? r.mTab.keyColumnName == "C_ProvisionalInvoice_ID" ? n.VCreateFormProvisionalInvoice.prototype.loadShipments(f, i, 1) : n.VCreateFromInvoice.prototype.loadShipments(f, i, 1) : s != null ? n.VCreateFromInvoice.prototype.loadProvisionalInvoices(s, i, 1) : r.setBusy(!1) } else if (t.propertyName == "C_BPartner_ID") { r.setBusy(!0); r.multiValues = []; r.dGrid != null && (r.dGrid.destroy(), r.dGrid = null); var c = r.cmbBankAccount.getControl().find("option:selected").val(), l = r.Date.getValue(), a = r.vBPartner.getValue(), v = r.DepositSlip.getValue(), y = r.DocumentNo.getValue(), p = r.AuthCode.getValue(), w = r.CheckNo.getValue(), b = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(c, a, l, y, v, p, w, b, 1) } else t.propertyName == "M_Locator_ID" ? r.locatorField != null && (r.isApplied = !1, e = parseInt(r.locatorField.getValue()), e > 0 && n.VCreateFromShipment.prototype.initContainerDetails(e)) : this.locatorField.setBackground("") }; this.createPageSettings = function () { this.ulPaging = t('<ul class="vis-statusbar-ul">'); this.liFirstPage = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="First Page" style="opacity: 0.6;"><\/i><\/div><\/li>'); this.liPrevPage = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="Page Up" style="opacity: 0.6;"><\/i><\/div><\/li>'); this.cmbPage = t("<select>"); this.liCurrPage = t("<li>").append(this.cmbPage); this.liNextPage = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="Page Down" style="opacity: 0.6;"><\/i><\/div><\/li>'); this.liLastPage = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="Last Page" style="opacity: 0.6;"><\/i><\/div><\/li>'); this.ulPaging.append(this.liFirstPage).append(this.liPrevPage).append(this.liCurrPage).append(this.liNextPage).append(this.liLastPage); this.pageEvents() }; this.pageEvents = function () { this.liFirstPage.on("click", function () { var i, u; if (t(this).css("opacity") == "1") { r.setBusy(!0); var f = r.cmbOrder.getControl().find("option:selected").val(), s = r.cmbInvoice.getControl().find("option:selected").val(), e = r.cmbShipment.getControl().find("option:selected").val(), h = r.cmbProvisionalInvoice.getControl().find("option:selected").val(), o = null; if (r.cmbBankAccount != null && (o = r.cmbBankAccount.getControl().find("option:selected").val()), i = null, u = null, r.vProduct != null && (i = r.vProduct.getValue()), r.deliveryDate != null && (u = r.deliveryDate.getValue()), f != null) r.locatorField != null ? r.loadOrders(f, i, u, !1, 1) : r.loadOrders(f, i, u, !0, 1); else if (s != null) n.VCreateFromShipment.prototype.loadInvoices(s, i, 1); else if (e != null) r.mTab.keyColumnName == "C_ProvisionalInvoice_ID" ? n.VCreateFormProvisionalInvoice.prototype.loadShipments(e, i, 1) : n.VCreateFromInvoice.prototype.loadShipments(e, i, 1); else if (o != null) { var c = r.Date.getValue(), l = r.vBPartner.getValue(), a = r.DepositSlip.getValue(), v = r.DocumentNo.getValue(), y = r.AuthCode.getValue(), p = r.CheckNo.getValue(), w = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(o, l, c, v, a, y, p, w, 1) } else h != null && n.VCreateFromInvoice.prototype.loadProvisionalInvoices(h, i, 1) } }); this.liPrevPage.on("click", function () { var i, u; if (t(this).css("opacity") == "1") { r.setBusy(!0); var f = r.cmbOrder.getControl().find("option:selected").val(), s = r.cmbInvoice.getControl().find("option:selected").val(), e = r.cmbShipment.getControl().find("option:selected").val(), h = r.cmbProvisionalInvoice.getControl().find("option:selected").val(), o = null; if (r.cmbBankAccount != null && (o = r.cmbBankAccount.getControl().find("option:selected").val()), i = null, u = null, r.vProduct != null && (i = r.vProduct.getValue()), r.deliveryDate != null && (u = r.deliveryDate.getValue()), f != null) r.locatorField != null ? r.loadOrders(f, i, u, !1, parseInt(r.cmbPage.val()) - 1) : r.loadOrders(f, i, u, !0, parseInt(r.cmbPage.val()) - 1); else if (s != null) n.VCreateFromShipment.prototype.loadInvoices(s, i, parseInt(r.cmbPage.val()) - 1); else if (e != null) r.mTab.keyColumnName == "C_ProvisionalInvoice_ID" ? n.VCreateFormProvisionalInvoice.prototype.loadShipments(e, i, parseInt(r.cmbPage.val()) - 1) : n.VCreateFromInvoice.prototype.loadShipments(e, i, parseInt(r.cmbPage.val()) - 1); else if (o != null) { var c = r.Date.getValue(), l = r.vBPartner.getValue(), a = r.DepositSlip.getValue(), v = r.DocumentNo.getValue(), y = r.AuthCode.getValue(), p = r.CheckNo.getValue(), w = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(o, l, c, v, a, y, p, w, parseInt(r.cmbPage.val()) - 1) } else h != null && n.VCreateFromInvoice.prototype.loadProvisionalInvoices(h, i, parseInt(r.cmbPage.val()) - 1) } }); this.liNextPage.on("click", function () { var i, u; if (t(this).css("opacity") == "1") { r.setBusy(!0); var f = r.cmbOrder.getControl().find("option:selected").val(), s = r.cmbInvoice.getControl().find("option:selected").val(), e = r.cmbShipment.getControl().find("option:selected").val(), h = r.cmbProvisionalInvoice.getControl().find("option:selected").val(), o = null; if (r.cmbBankAccount != null && (o = r.cmbBankAccount.getControl().find("option:selected").val()), i = null, u = null, r.vProduct != null && (i = r.vProduct.getValue()), r.deliveryDate != null && (u = r.deliveryDate.getValue()), f != null) r.locatorField != null ? r.loadOrders(f, i, u, !1, parseInt(r.cmbPage.val()) + 1) : r.loadOrders(f, i, u, !0, parseInt(r.cmbPage.val()) + 1); else if (s != null) n.VCreateFromShipment.prototype.loadInvoices(s, i, parseInt(r.cmbPage.val()) + 1); else if (e != null) r.mTab.keyColumnName == "C_ProvisionalInvoice_ID" ? n.VCreateFormProvisionalInvoice.prototype.loadShipments(e, i, parseInt(r.cmbPage.val()) + 1) : n.VCreateFromInvoice.prototype.loadShipments(e, i, parseInt(r.cmbPage.val()) + 1); else if (o != null) { var c = r.Date.getValue(), l = r.vBPartner.getValue(), a = r.DepositSlip.getValue(), v = r.DocumentNo.getValue(), y = r.AuthCode.getValue(), p = r.CheckNo.getValue(), w = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(o, l, c, v, a, y, p, w, parseInt(r.cmbPage.val()) + 1) } else h != null && n.VCreateFromInvoice.prototype.loadProvisionalInvoices(h, i, parseInt(r.cmbPage.val()) + 1) } }); this.liLastPage.on("click", function () { var i, u; if (t(this).css("opacity") == "1") { r.setBusy(!0); var f = r.cmbOrder.getControl().find("option:selected").val(), s = r.cmbInvoice.getControl().find("option:selected").val(), e = r.cmbShipment.getControl().find("option:selected").val(), h = r.cmbProvisionalInvoice.getControl().find("option:selected").val(), o = null; if (r.cmbBankAccount != null && (o = r.cmbBankAccount.getControl().find("option:selected").val()), i = null, u = null, r.vProduct != null && (i = r.vProduct.getValue()), r.deliveryDate != null && (u = r.deliveryDate.getValue()), f != null) r.locatorField != null ? r.loadOrders(f, i, u, !1, parseInt(r.cmbPage.find("Option:last").val())) : r.loadOrders(f, i, u, !0, parseInt(r.cmbPage.find("Option:last").val())); else if (s != null) n.VCreateFromShipment.prototype.loadInvoices(s, i, parseInt(r.cmbPage.find("Option:last").val())); else if (e != null) r.mTab.keyColumnName == "C_ProvisionalInvoice_ID" ? n.VCreateFormProvisionalInvoice.prototype.loadShipments(e, i, parseInt(r.cmbPage.find("Option:last").val())) : n.VCreateFromInvoice.prototype.loadShipments(e, i, parseInt(r.cmbPage.find("Option:last").val())); else if (o != null) { var c = r.Date.getValue(), l = r.vBPartner.getValue(), a = r.DepositSlip.getValue(), v = r.DocumentNo.getValue(), y = r.AuthCode.getValue(), p = r.CheckNo.getValue(), w = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(o, l, c, v, a, y, p, w, parseInt(r.cmbPage.find("Option:last").val())) } else h != null && n.VCreateFromInvoice.prototype.loadProvisionalInvoices(h, i, parseInt(r.cmbPage.find("Option:last").val())) } }); this.cmbPage.on("change", function () { var t, i; r.setBusy(!0); var u = r.cmbOrder.getControl().find("option:selected").val(), o = r.cmbInvoice.getControl().find("option:selected").val(), f = r.cmbShipment.getControl().find("option:selected").val(), s = r.cmbProvisionalInvoice.getControl().find("option:selected").val(), e = null; if (r.cmbBankAccount != null && (e = r.cmbBankAccount.getControl().find("option:selected").val()), t = null, i = null, r.vProduct != null && (t = r.vProduct.getValue()), r.deliveryDate != null && (i = r.deliveryDate.getValue()), u != null) r.locatorField != null ? r.loadOrders(u, t, i, !1, r.cmbPage.val()) : r.loadOrders(u, t, i, !0, r.cmbPage.val()); else if (o != null) n.VCreateFromShipment.prototype.loadInvoices(o, t, r.cmbPage.val()); else if (f != null) r.mTab.keyColumnName == "C_ProvisionalInvoice_ID" ? n.VCreateFormProvisionalInvoice.prototype.loadShipments(f, t, r.cmbPage.val()) : n.VCreateFromInvoice.prototype.loadShipments(f, t, r.cmbPage.val()); else if (e != null) { var h = r.Date.getValue(), c = r.vBPartner.getValue(), l = r.DepositSlip.getValue(), a = r.DocumentNo.getValue(), v = r.AuthCode.getValue(), y = r.CheckNo.getValue(), p = r.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(e, c, h, a, l, v, y, p, r.cmbPage.val()) } else s != null && n.VCreateFromInvoice.prototype.loadProvisionalInvoices(s, t, r.cmbPage.val()) }) }; this.resetPageCtrls = function (n) { if (this.cmbPage.empty(), n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)this.cmbPage.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); this.cmbPage.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (this.liNextPage.css("opacity", "1"), this.liLastPage.css("opacity", "1")) : (this.liNextPage.css("opacity", "0.6"), this.liLastPage.css("opacity", "0.6")); n.CurrentPage > 1 ? (this.liFirstPage.css("opacity", "1"), this.liPrevPage.css("opacity", "1")) : (this.liFirstPage.css("opacity", "0.6"), this.liPrevPage.css("opacity", "0.6")); n.TotalPage == 1 && (this.liFirstPage.css("opacity", "0.6"), this.liPrevPage.css("opacity", "0.6"), this.liNextPage.css("opacity", "0.6"), this.liLastPage.css("opacity", "0.6")) } else this.liFirstPage.css("opacity", "0.6"), this.liPrevPage.css("opacity", "0.6"), this.liNextPage.css("opacity", "0.6"), this.liLastPage.css("opacity", "0.6") }; this.setBusy = function (n) { this.$busyDiv.css("display", n ? "block" : "none") }; this.MergeItemsForSave = function () { var f = r.cmbOrder.getControl().find("option:selected").val(), e = r.cmbInvoice.getControl().find("option:selected").val(), o = r.cmbShipment.getControl().find("option:selected").val(), n, i, u; if (r.editedItems.length > 0) for (n in r.editedItems) i = r.editedItems[n].M_Product_ID_K, u = t.grep(r.multiValues, function (t) { return f != null ? t.M_Product_ID_K == i && t.C_Order_ID_K == r.editedItems[n].C_Order_ID_K : e != null ? t.M_Product_ID_K == i && t.C_Invoice_ID_K == r.editedItems[n].C_Invoice_ID_K : o != null ? t.M_Product_ID_K == i && t.M_InOut_ID_K == r.editedItems[n].M_InOut_ID_K : t.C_Payment_ID_K == r.editedItems[n].C_Payment_ID_K }), u.length > 0 || r.multiValues.push(r.editedItems[n]) }; this.showDialog = function () { this.locatorField && (this.locatorField.setBackground(!1), this.locatorField.addVetoableChangeListener(this)); this.vProduct && this.vProduct.addVetoableChangeListener(this); this.vBPartner && this.vBPartner.addVetoableChangeListener(this); var n = this; this.$root.append(this.$busyDiv); this.setBusy(!1); this.$root.dialog({ modal: !0, title: this.title, width: 900, height: 600, resizable: !1, position: { at: "center top", of: window }, close: function () { n.dispose(); n.dGrid != null && n.dGrid.destroy(); r = null; n.$root.dialog("destroy"); n.$root = null } }) }; this.checkcommaordot = function (t, i) { var f = !1, u, r; if (t.value_new = n.Utility.Util.getValueOfString(i), t.value_new.contains(".")) { for (f = !0, u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "." && u.push(r); u.length > 1 && (t.value_new = removeAllButLast(t.value_new, ".")) } if (t.value_new.contains(",")) if (f) t.value_new = removeAllButLast(t.value_new, ","); else { for (u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "," && u.push(r); t.value_new = u.length > 1 ? removeAllButLast(t.value_new, ",") : t.value_new.replace(",", ".") } return t.value_new == "" && (t.value_new = "0"), t.value_new }; this.removeAllButLast = function (n, t) { var i = n.split(t); return n = i.slice(0, -1).join("") + "." + i.slice(-1), n.indexOf(".") == n.length - 1 && (n = n.replace(".", "")), n }; this.disposeComponent = function () { r = null; this.Okbtn && this.Okbtn.off("click"); this.cancelbtn && this.cancelbtn.off("click"); this.selectAllButton && this.selectAllButton.off("click"); this.btnRefresh && this.btnRefresh.off("click"); this.Applybtn && this.Applybtn.off("click"); this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; i.prototype.create = function (t) { var r = n.Env.getCtx().getContextAsInt(t.getWindowNo(), "BaseTable_ID"), i = null; if (r == 392) i = new n.VCreateFromStatement(t); else if (r == 318) i = new n.VCreateFromInvoice(t); else if (r == 319) i = new n.VCreateFromShipment(t); else { if (r == 426) return null; if (t.keyColumnName == "C_ProvisionalInvoice_ID") i = new n.VCreateFormProvisionalInvoice(t); else return null } return i }; i.prototype.initBPDetails = function (n) { return n }; i.prototype.initBPartner = function (t) { var r = n.MLookupFactory.getMLookUp(n.Env.getCtx(), this.windowNo, 3499, n.DisplayType.Search), i; return this.vBPartner = new n.Controls.VTextBoxButton("C_BPartner_ID", !0, !1, !0, n.DisplayType.Search, r), i = n.Env.getCtx().getContextAsInt(this.windowNo, "C_BPartner_ID"), this.vBPartner.setValue(i), this.initBPartnerOIS(i, t) }; i.prototype.initBPartnerOIS = function (i, r) { var o = this.cmbOrder, u, f, e; return t(o).html(""), u = !1, r ? (f = n.dataContext.getJSONRecord("MDocType/GetDocType", n.Env.getCtx().getContextAsInt(this.windowNo, "C_DocTypeTarget_ID").toString()), u = n.Utility.Util.getValueOfBoolean(f.IsReturnTrx), e = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsSOTrx")), u || e || this.getProvisionlInvoices(n.Env.getCtx(), i, u)) : u = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsReturnTrx")), this.getOrders(n.Env.getCtx(), i, u, r), this.initBPDetails(i) }; i.prototype.initBPartnerForProvisional = function () { var f = n.MLookupFactory.getMLookUp(n.Env.getCtx(), this.windowNo, 3499, n.DisplayType.Search), i, r, u; return this.vBPartner = new n.Controls.VTextBoxButton("C_BPartner_ID", !0, !1, !0, n.DisplayType.Search, f), i = n.Env.getCtx().getContextAsInt(this.windowNo, "C_BPartner_ID"), this.vBPartner.setValue(i), r = this.cmbOrder, t(r).html(""), u = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsReturnTrx")), this.getOrdersForProvisional(n.Env.getCtx(), i, u), this.initBPDetails(i) }; i.prototype.getOrders = function (i, r, u, f) { var o = "o.DocumentNo||' - ' ||".concat(n.DB.to_char("o.DateOrdered", n.DisplayType.Date, n.Env.getAD_Language(i))).concat("||' - '||").concat(n.DB.to_char("o.GrandTotal", n.DisplayType.Amount, n.Env.getAD_Language(i))), e = "m.M_InOutLine_ID"; f && (e = "m.C_InvoiceLine_ID"); var s = n.Env.getCtx().getContextAsInt(this.windowNo, "AD_Org_ID"), h = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsDropShip")), c = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsSOTrx")), l = n.context.getWindowContextAsInt(this.windowNo, "C_Invoice_ID", !0); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/VCreateGetOrders", type: "POST", data: { displays: o, columns: e, C_BPartner_IDs: r, isReturnTrxs: u, OrgIds: s, IsDrop: h, IsSOTrx: c, forInvoices: f, recordID: l }, success: function (t) { var r = t.result, u, f, i; if (r && r.length > 0) try { for (i = 0; i < r.length; i++)u = n.Utility.Util.getValueOfInt(r[i].key), f = n.Utility.encodeText(r[i].value), i == 0 && $self.cmbOrder.getControl().append(" <option value=0> <\/option>"), $self.cmbOrder.getControl().append(" <option value=" + u + ">" + f + "<\/option>"); $self.cmbOrder.getControl().prop("selectedIndex", 0) } catch (e) { } }, error: function (n) { $self.log.info(n) } }) }; i.prototype.getProvisionlInvoices = function (i, r, u) { var f = "i.DocumentNo||' - ' ||".concat(n.DB.to_char("i.DateInvoiced", n.DisplayType.Date, n.Env.getAD_Language(i))).concat("||' - '||").concat(n.DB.to_char("i.GrandTotal", n.DisplayType.Amount, n.Env.getAD_Language(i))), e = n.Env.getCtx().getContextAsInt(this.windowNo, "AD_Org_ID"), o = n.context.getWindowContextAsInt(this.windowNo, "C_Invoice_ID", !0); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/VCreateGetProvisionalInvoices", type: "POST", data: { displays: f, C_BPartner_IDs: r, isReturnTrxs: u, OrgIds: e, recordID: o }, success: function (t) { var r = t.result, u, f, i; if (r && r.length > 0) try { for (i = 0; i < r.length; i++)u = n.Utility.Util.getValueOfInt(r[i].key), f = n.Utility.encodeText(r[i].value), i == 0 && $self.cmbProvisionalInvoice.getControl().append(" <option value=0> <\/option>"), $self.cmbProvisionalInvoice.getControl().append(" <option value=" + u + ">" + f + "<\/option>"); $self.cmbProvisionalInvoice.getControl().prop("selectedIndex", 0) } catch (e) { } }, error: function (n) { $self.log.info(n) } }) }; i.prototype.getOrdersForProvisional = function (i, r, u) { var f = "o.DocumentNo||' - ' ||".concat(n.DB.to_char("o.DateOrdered", n.DisplayType.Date, n.Env.getAD_Language(i))).concat("||' - '||").concat(n.DB.to_char("o.GrandTotal", n.DisplayType.Amount, n.Env.getAD_Language(i))), e = n.Env.getCtx().getContextAsInt(this.windowNo, "AD_Org_ID"), o = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsDropShip")), s = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsSOTrx")), h = n.context.getWindowContextAsInt(this.windowNo, "C_ProvisionalInvoice_ID", !0); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/VCreateGetOrders", type: "POST", data: { displays: f, columns: "m.C_InvoiceLine_ID", C_BPartner_IDs: r, isReturnTrxs: u, OrgIds: e, IsDrop: o, IsSOTrx: s, forInvoices: !1, recordID: h }, success: function (t) { var r = t.result, u, f, i; if (r && r.length > 0) try { for (i = 0; i < r.length; i++)u = n.Utility.Util.getValueOfInt(r[i].key), f = n.Utility.encodeText(r[i].value), i == 0 && $self.cmbOrder.getControl().append(" <option value=0> <\/option>"), $self.cmbOrder.getControl().append(" <option value=" + u + ">" + f + "<\/option>"); $self.cmbOrder.getControl().prop("selectedIndex", 0) } catch (e) { } }, error: function (n) { $self.log.info(n) } }) }; i.prototype.jbInit = function () { this.init(); this.lblBankAccount.getControl().text(n.Msg.getMsg("BankAcctCurrency")); this.lblBPartner.getControl().text(n.Msg.getMsg("BusinessPartner")); this.lblOrder.getControl().text(n.Msg.getMsg("Order")); this.lblInvoice.getControl().text(n.Msg.getMsg("Invoice")); this.lblShipment.getControl().text(n.Msg.getMsg("Shipment/Receipt")); this.lblLocator.getControl().text(n.Msg.getMsg("M_Locator_ID")); this.lblDeliveryDate.getControl().text(n.Msg.getMsg("DeliveryDate")); this.lblProduct.getControl().text(n.Msg.getMsg("ProductName")); this.lblDocumentNoRef.getControl().text(n.Msg.getMsg("DocumentNo")); this.lblDocumentNo.getControl().text(n.Msg.getMsg("DocumentNo")); this.lblDate.getControl().text(n.Msg.getMsg("DateAcct")); this.lblAmount.getControl().text(n.Msg.getMsg("Amount")); this.lblDepositSlip.getControl().text(n.Msg.getMsg("DepositSlipNo")); this.lblAuthCode.getControl().text(n.Msg.getMsg("AuthCode")); this.lblCheckNo.getControl().text(n.Msg.getMsg("CheckNo")); this.lblProvisionalInvoice.getControl().text(n.Msg.getMsg("ProvisionalInvoice")); var f = t("<div class='VIS_Pref_show'>"), u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>"); this.topDiv.append(f); f.append(u); u.append(r); r.append(i); r.append(e); this.vBPartner != null && (this.cmbBankAccount != null ? (i.append(this.vBPartner.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")), e.append(this.vBPartner.getBtn(0)), e.append(this.vBPartner.getBtn(1))) : (i.append(this.vBPartner.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")), e.append(this.vBPartner.getBtn(0))), i.append(this.lblBPartner.getControl().addClass("VIS_Pref_Label_Font"))); u = t("<div class='VIS_Pref_dd'>"); r = t("<div class='input-group vis-input-wrap'><\/div>"); i = t("<div class='vis-control-wrap'><\/div>"); e = t("<div class='input-group-append'>"); f.append(u); u.append(r); r.append(i); r.append(e); this.cmbBankAccount != null ? (i.append(this.cmbBankAccount.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblBankAccount.getControl().addClass("VIS_Pref_Label_Font"))) : this.DocumentNoRef != null ? (i.append(this.DocumentNoRef.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblDocumentNoRef.getControl().addClass("VIS_Pref_Label_Font"))) : this.cmbProvisionalInvoice != null && $self.mTab.keyColumnName == "C_Invoice_ID" && "N".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsSOTrx")) && (i.append(this.cmbProvisionalInvoice.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblProvisionalInvoice.getControl().addClass("VIS_Pref_Label_Font"))); f = t("<div class='VIS_Pref_show'>"); this.Amount != null ? (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>")) : (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>")); this.topDiv.append(f); f.append(u); u.append(r); r.append(i); this.DocumentNo != null && (u.append(r), i.append(this.DocumentNo.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblDocumentNo.getControl().addClass("VIS_Pref_Label_Font"))); this.cmbOrder != null && (u.append(r), i.append(this.cmbOrder.getControl()), i.append(this.lblOrder.getControl().addClass("VIS_Pref_Label_Font"))); this.Amount != null && (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), f.append(u), u.append(r), r.append(i), i.append(this.Amount.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblAmount.getControl().addClass("VIS_Pref_Label_Font"))); this.Amount != null ? (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>")) : (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>")); f.append(u); u.append(r); r.append(i); this.cmbInvoice != null && (i.append(this.cmbInvoice.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblInvoice.getControl().addClass("VIS_Pref_Label_Font"))); this.cmbShipment != null && (i.append(this.cmbShipment.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblShipment.getControl().addClass("VIS_Pref_Label_Font"))); this.Date != null && (i.append(this.Date.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblDate.getControl().addClass("VIS_Pref_Label_Font"))); (this.locatorField != null || this.cmbContainer != null) && (this.middelDiv.css("height", "48.5%"), f = t("<div class='VIS_Pref_show'>"), u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>"), this.topDiv.append(f), f.append(u), u.append(r), r.append(i), r.append(e), this.locatorField != null && (i.append(this.locatorField.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")), e.append(this.locatorField.getBtn(0)), i.append(this.lblLocator.getControl().addClass("VIS_Pref_Label_Font"))), u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>"), f.append(u), u.append(r), r.append(i), r.append(e), this.cmbContainer != null && (u.css("visibility", "hidden"), n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"] != undefined && n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y", !0) && (u.css("visibility", "visible"), this.ContainerTree.removeClass("VIS_Tree-Container-disabled")), i.append(this.cmbContainer.getControl().attr("disabled", !0).attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")), e.append(this.ContainerTree), i.append(this.lblContainer.getControl().addClass("VIS_Pref_Label_Font")))); f = t("<div class='VIS_Pref_show'>"); this.CheckNo != null ? (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>")) : (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>")); $self.mTab.keyColumnName == "C_ProvisionalInvoice_ID" && this.middelDiv.css("height", "64%"); this.topDiv.append(f); f.append(u); u.append(r); r.append(i); r.append(e); this.DepositSlip != null && (i.append(this.DepositSlip.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblDepositSlip.getControl().addClass("VIS_Pref_Label_Font"))); this.deliveryDate != null && (i.append(this.deliveryDate.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblDeliveryDate.getControl().addClass("VIS_Pref_Label_Font"))); this.CheckNo != null && (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), f.append(u), u.append(r), r.append(i), i.append(this.CheckNo.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblCheckNo.getControl().addClass("VIS_Pref_Label_Font"))); this.CheckNo != null ? (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>")) : (u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), e = t("<div class='input-group-append'>")); f.append(u); u.append(r); r.append(i); r.append(e); this.vProduct != null && (i.append(this.vProduct.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")), e.append(this.vProduct.getBtn(0)), e.append(this.vProduct.getBtn(1)), i.append(this.lblProduct.getControl().addClass("VIS_Pref_Label_Font"))); this.AuthCode != null && (i.append(this.AuthCode.getControl().attr("data-placeholder", "").attr("placeholder", " ")), i.append(this.lblAuthCode.getControl().addClass("VIS_Pref_Label_Font"))); this.relatedToOrg != null && (f = t("<div class='VIS_Pref_show'>"), u = t("<div class='VIS_Pref_dd'>"), r = t("<div class='input-group vis-input-wrap'><\/div>"), i = t("<div class='vis-control-wrap'><\/div>"), this.topDiv.append(f), f.append(u), u.append(r), r.append(i), i.append(this.relatedToOrg.getControl())) }; i.prototype.init = function () { this.createPageSettings(); this.divPaging.append(this.ulPaging); this.$root.append(this.topDiv).append(this.middelDiv).append(this.divPaging).append(this.bottomDiv); this.bottomDiv.append(this.selectAllButton); this.bottomDiv.append(this.btnRefresh); this.bottomDiv.append(this.cancelbtn); this.bottomDiv.append(this.Applybtn); this.bottomDiv.append(this.Okbtn); this.bottomDiv.append(this.divPaging); this.middelDiv.append(this.dGrid); $self = this; this.Okbtn.on("click", function () { var r; if ($self.isApplied) { $self.$root.dialog("close"); return } $self.setBusy(!0); var u = $self.cmbOrder.getControl().find("option:selected").val(), f = $self.cmbInvoice.getControl().find("option:selected").val(), e = $self.cmbShipment.getControl().find("option:selected").val(), o = $self.cmbProvisionalInvoice.getControl().find("option:selected").val(), i = null; if ($self.dGrid != null && (i = $self.dGrid.getSelection()), i == null || i.length == 0) { n.ADialog.info("RecordSelectionRequired"); $self.setBusy(!1); return } if ($self.locatorField != null) { if ($self.dGrid != null && u != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.M_Product_ID_K == $self.dGrid.get(i[item]).M_Product_ID_K && n.C_Order_ID_K == $self.dGrid.get(i[item]).C_Order_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); else if ($self.dGrid != null && f != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.M_Product_ID_K == $self.dGrid.get(i[item]).M_Product_ID_K && n.C_Invoice_ID_K == $self.dGrid.get(i[item]).C_Invoice_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); $self.MergeItemsForSave(); n.VCreateFromShipment.prototype.saveMInOut(!1) } else if ($self.cmbBankAccount != null) { if ($self.dGrid != null) for (item in i) { if ($self.dGrid.get(i[item]).Date == "") return n.ADialog.error("VIS_PLAccountDate"), !1; r = t.grep($self.multiValues, function (n) { return n.C_Payment_ID_K == $self.dGrid.get(i[item]).C_Payment_ID_K }); r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])) } n.VCreateFromStatement.prototype.saveStatment(); $self.middelDiv.css("height", "61%") } else { if ($self.dGrid != null && u != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.M_Product_ID_K == $self.dGrid.get(i[item]).M_Product_ID_K && n.C_Order_ID_K == $self.dGrid.get(i[item]).C_Order_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); if ($self.dGrid != null && e != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.M_Product_ID_K == $self.dGrid.get(i[item]).M_InOut_ID_K && n.M_InOut_ID_K == $self.dGrid.get(i[item]).M_InOut_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); if ($self.dGrid != null && o != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.M_Product_ID_K == $self.dGrid.get(i[item]).M_Product_ID_K && n.C_Invoice_ID_K == $self.dGrid.get(i[item]).C_Invoice_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); $self.mTab.keyColumnName == "C_ProvisionalInvoice_ID" ? n.VCreateFormProvisionalInvoice.prototype.saveProvisionalInvoice() : n.VCreateFromInvoice.prototype.saveInvoice() } }); this.Applybtn.on("click", function () { var r; $self.setBusy(!0); var u = $self.cmbOrder.getControl().find("option:selected").val(), f = $self.cmbInvoice.getControl().find("option:selected").val(), e = $self.cmbShipment.getControl().find("option:selected").val(), i = null; if ($self.dGrid != null && (i = $self.dGrid.getSelection()), i == null || i.length == 0) { n.ADialog.info("RecordSelectionRequired"); $self.setBusy(!1); return } if ($self.locatorField != null) { if ($self.dGrid != null && u != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.M_Product_ID_K == $self.dGrid.get(i[item]).M_Product_ID_K && n.C_Order_ID_K == $self.dGrid.get(i[item]).C_Order_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); else if ($self.dGrid != null && f != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.M_Product_ID_K == $self.dGrid.get(i[item]).M_Product_ID_K && n.C_Invoice_ID_K == $self.dGrid.get(i[item]).C_Invoice_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); $self.MergeItemsForSave(); n.VCreateFromShipment.prototype.saveMInOut(!0) } else if ($self.cmbBankAccount != null) { if ($self.dGrid != null) for (item in i) { if ($self.dGrid.get(i[item]).Date == "") return n.ADialog.error("VIS_PLAccountDate"), !1; r = t.grep($self.multiValues, function (n) { return n.C_Payment_ID_K == $self.dGrid.get(i[item]).C_Payment_ID_K }); r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])) } n.VCreateFromStatement.prototype.saveStatment(); $self.middelDiv.css("height", "61%") } else { if ($self.dGrid != null && u != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.M_Product_ID_K == $self.dGrid.get(i[item]).M_Product_ID_K && n.C_Order_ID_K == $self.dGrid.get(i[item]).C_Order_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); if ($self.dGrid != null && e != null) for (item in i) r = t.grep($self.multiValues, function (n) { return n.M_Product_ID_K == $self.dGrid.get(i[item]).M_InOut_ID_K && n.M_InOut_ID_K == $self.dGrid.get(i[item]).M_InOut_ID_K }), r.length > 0 || $self.multiValues.push($self.dGrid.get(i[item])); n.VCreateFromInvoice.prototype.saveInvoice() } }); i.prototype.callBackSave = function (t) { if (t == !1) $self.setBusy(!1); else { $self.isApplied = !0; n.ADialog.info("VIS_SuccessFullyInserted", null, null, null); var i = $self.cmbOrder.getControl().find("option:selected").val(), r = $self.cmbInvoice.getControl().find("option:selected").val(), e = $self.cmbShipment.getControl().find("option:selected").val(), u = $self.vProduct.getValue(), f = $self.deliveryDate.getValue(); (i > 0 || r > 0) && ($self.locatorField != null ? ($self.dGrid.selectNone(), i > 0 && ($self.multiValues = [], $self.loadOrders(i, u, f, !1, 1)), r > 0 && ($self.multiValues = [], n.VCreateFromShipment.prototype.loadInvoices(r, u, 1)), $self.dGrid.selectNone(), $self.editedItems = []) : ($self.dGrid.selectNone(), i > 0 && ($self.multiValues = [], $self.loadOrders(i, u, f, !0, 1)), r > 0 && ($self.multiValues = [], n.VCreateFromShipment.prototype.loadInvoices(r, u, 1)), $self.dGrid.selectNone(), $self.editedItems = [])) } }; this.cancelbtn.on("click", function () { $self.setBusy(!1); $self.$root.dialog("close") }); this.selectAllButton.on("click", function () { }); if (this.relatedToOrg) this.relatedToOrg.getControl().on("click", function () { var i, r, u, t; $self.isApplied = !1; $self.setBusy(!0); $self.multiValues = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); i = $self.cmbOrder.getControl().find("option:selected").val(); r = $self.cmbProvisionalInvoice.getControl().find("option:selected").val(); i != null ? ($self.cmbInvoice.getControl().prop("selectedIndex", -1), $self.cmbShipment.getControl().prop("selectedIndex", -1), t = $self.vProduct.getValue(), u = $self.deliveryDate.getValue(), $self.loadOrders(i, t, u, !1, 1)) : r != null ? ($self.cmbOrder.getControl().prop("selectedIndex", -1), $self.cmbInvoice.getControl().prop("selectedIndex", -1), $self.cmbShipment.getControl().prop("selectedIndex", -1), t = $self.vProduct.getValue(), n.VCreateFromInvoice.prototype.loadProvisionalInvoices(r, t, 1)) : $self.setBusy(!1) }); if (this.btnRefresh) this.btnRefresh.on("click", function () { var t; if ($self.cmbBankAccount != null && ($self.setBusy(!0), t = $self.cmbBankAccount.getControl().find("option:selected").val(), t)) { var i = $self.Date.getValue(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(t, r, i, f, u, e, o, s, $self.cmbPage.val()) } }); if (this.cmbOrder && this.cmbOrder.getControl().change(function () { var n, t, i; $self.isApplied = !1; $self.setBusy(!0); $self.editedItems = []; $self.multiValues = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); n = $self.cmbOrder.getControl().find("option:selected").val(); $self.cmbInvoice.getControl().prop("selectedIndex", -1); $self.cmbShipment.getControl().prop("selectedIndex", -1); $self.cmbProvisionalInvoice.getControl().prop("selectedIndex", -1); $self.lblDeliveryDate.setVisible(!0); $self.deliveryDate.setVisible(!0); t = $self.vProduct.getValue(); i = $self.deliveryDate.getValue(); $self.locatorField != null ? $self.loadOrders(n, t, i, !1, 1) : $self.loadOrders(n, t, i, !0, 1) }), this.cmbBankAccount && this.cmbBankAccount.getControl().change(function () { var t; if ($self.editedItems = [], $self.setBusy(!0), t = $self.cmbBankAccount.getControl().find("option:selected").val(), t) { n.VCreateFromStatement.prototype.initBPartner(t); $self.Date.setValue(""); $self.DepositSlip.setValue(""); $self.DocumentNo.setValue(""); $self.AuthCode.setValue(""); var i = $self.vBPartner.getValue(), r = $self.Date.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(t, i, r, f, u, e, o, s, 1) } }), this.Date && this.Date.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.DocumentNo && this.DocumentNo.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.DepositSlip && this.DepositSlip.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.AuthCode && this.AuthCode.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.CheckNo && this.CheckNo.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.Amount && this.Amount.getControl().change(function () { $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.Date.getValue(), i = $self.cmbBankAccount.getControl().find("option:selected").val(), r = $self.vBPartner.getValue(), u = $self.DepositSlip.getValue(), f = $self.DocumentNo.getValue(), e = $self.AuthCode.getValue(), o = $self.CheckNo.getValue(), s = $self.Amount.getValue(); n.VCreateFromStatement.prototype.loadBankAccounts(i, r, t, f, u, e, o, s, 1) }), this.cmbInvoice && this.cmbInvoice.getControl().change(function () { $self.isApplied = !1; $self.setBusy(!0); $self.editedItems = []; $self.multiValues = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.cmbInvoice.getControl().find("option:selected").val(), i = $self.vProduct.getValue(); $self.cmbOrder.getControl().prop("selectedIndex", -1); $self.cmbShipment.getControl().prop("selectedIndex", -1); $self.cmbProvisionalInvoice.getControl().prop("selectedIndex", -1); $self.lblDeliveryDate.setVisible(!1); $self.deliveryDate.setVisible(!1); n.VCreateFromShipment.prototype.loadInvoices(t, i, 1) }), this.cmbShipment && this.cmbShipment.getControl().change(function () { $self.setBusy(!0); $self.editedItems = []; $self.multiValues = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.cmbShipment.getControl().find("option:selected").val(), i = $self.vProduct.getValue(); $self.cmbOrder.getControl().prop("selectedIndex", -1); $self.cmbInvoice.getControl().prop("selectedIndex", -1); $self.cmbProvisionalInvoice.getControl().prop("selectedIndex", -1); $self.lblDeliveryDate.setVisible(!1); $self.deliveryDate.setVisible(!1); $self.mTab.keyColumnName == "C_ProvisionalInvoice_ID" ? n.VCreateFormProvisionalInvoice.prototype.loadShipments(t, i, 1) : n.VCreateFromInvoice.prototype.loadShipments(t, i, 1) }), this.deliveryDate && this.deliveryDate.getControl().change(function () { $self.isApplied = !1; $self.setBusy(!0); $self.multiValues = []; $self.editedItems = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var n = $self.cmbOrder.getControl().find("option:selected").val(), t = $self.vProduct.getValue(), i = $self.deliveryDate.getValue(); $self.locatorField != null ? $self.loadOrders(n, t, i, !1, 1) : $self.loadOrders(n, t, i, !0, 1) }), this.cmbProvisionalInvoice && this.cmbProvisionalInvoice.getControl().change(function () { $self.isApplied = !1; $self.setBusy(!0); $self.editedItems = []; $self.multiValues = []; $self.dGrid != null && ($self.dGrid.destroy(), $self.dGrid = null); var t = $self.cmbProvisionalInvoice.getControl().find("option:selected").val(), i = $self.vProduct.getValue(); $self.cmbOrder.getControl().prop("selectedIndex", -1); $self.cmbShipment.getControl().prop("selectedIndex", -1); $self.cmbInvoice.getControl().prop("selectedIndex", -1); $self.lblDeliveryDate.setVisible(!1); $self.deliveryDate.setVisible(!1); n.VCreateFromInvoice.prototype.loadProvisionalInvoices(t, i, 1) }), this.ContainerTree) this.ContainerTree.on("click", function () { var i, t; (n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"] == undefined || n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y", !0)) && (i = $self.locatorField.getValue(), i > 0 && (t = new n.productContainerTree(0, i, 0), t != null && (t.showDialog(), t.onClosing = function (n, t) { $self.cmbContainer.getControl().empty(); $self.cmbContainer.getControl().append(" <option value=" + n + ">" + t + "<\/option>") }), t = null), i = null) }) }; i.prototype.isInitOK = function () { return this.initOK }; i.prototype.loadOrders = function (t, i, r, u, f) { var e = this.getOrdersData(n.Env.getCtx(), t, i, r, u, f) }; i.prototype.getOrdersData = function (i, r, u, f, e, o) { var h, v, p, s; if ($self.dGrid != null) { h = $self.dGrid.getSelection(); for (item in h) v = t.grep($self.multiValues, function (n) { return n.M_Product_ID_K == $self.dGrid.get(h[item]).M_Product_ID_K && n.C_Order_ID_K == $self.dGrid.get(h[item]).C_Order_ID_K }), v.length > 0 || $self.multiValues.push($self.dGrid.get(h[item])) } if ($self.mTab.keyColumnName == "M_InOut_ID" ? $self.record_ID = $self.mTab.getValue("M_InOut_ID") : $self.mTab.keyColumnName == "C_Invoice_ID" ? $self.record_ID = $self.mTab.getValue("C_Invoice_ID") : $self.mTab.keyColumnName == "C_ProvisionalInvoice_ID" && ($self.record_ID = $self.mTab.getValue("C_ProvisionalInvoice_ID")), $self.relatedToOrg != null && $self.relatedToOrg.getValue()) { var c = "", l = "", a = "", y = ""; o || (o = 1); c = n.Env.isBaseLanguage(i, "C_UOM") ? " LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)" : " LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='" + n.Env.getAD_Language(i).concat("')"); u != null && (l = " AND l.M_Product_ID=" + u); f != null && (s = n.DB.to_date(f, !0), y = s, a = " AND l.DatePromised <= " + s); p = $self.mTab.getValue("AD_Org_ID"); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetOrdersDataCommon", dataType: "json", type: "POST", data: { keyColumnName: $self.mTab.keyColumnName, tableName: "C_OrderLine", recordID: $self.record_ID, pageNo: o, forInvoicees: e, C_Ord_IDs: r, isBaseLangess: c, MProductIDss: l, DelivDates: a, adOrgIDSs: p }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); $self.setBusy(!1); $self.log.info(t); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); $self.setBusy(!1); return } $self.resetPageCtrls(i.pSetting); $self.loadGrid(i.data); $self.setBusy(!1) } }) } else { var c = "", l = "", a = "", y = ""; c = n.Env.isBaseLanguage(i, "C_UOM") ? " LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)" : " LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='" + n.Env.getAD_Language(i) + "') INNER JOIN C_UOM uom1 ON uom1.C_UOM_ID = uom.C_UOM_ID "; u > 0 && (l = " AND l.M_Product_ID=" + u); f != null && (s = n.DB.to_date(f, !0), a = " AND l.DatePromised <= " + s); o || (o = 1); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetOrdersDataCommonOrg", dataType: "json", type: "POST", data: { keyColumnName: $self.mTab.keyColumnName, tableName: "C_OrderLine", recordID: $self.record_ID, pageNo: o, forInvoicees: e, C_Ord_IDs: r, isBaseLangess: c, MProductIDss: l, DelivDates: a }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); $self.setBusy(!1); $self.log.info(t); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); $self.setBusy(!1); return } $self.resetPageCtrls(i.pSetting); $self.loadGrid(i.data); $self.setBusy(!1) } }) } return [] }; i.prototype.loadOrder = function (t, i) { var r = null; r = this.getOrderData(n.Env.getCtx(), t, i); this.loadGrid(r) }; i.prototype.getOrderData = function (i, r, u) { var o = [], s, f, e; return $self.relatedToOrg.getValue() ? (f = "", f = n.Env.isBaseLanguage(i, "C_UOM") ? " LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)" : " LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='" + n.Env.getAD_Language(i) + "')", s = $self.mTab.getValue($self.windowNo, "AD_Org_ID"), e = n.Env.getAD_Language(i), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetOrderDataCommons", dataType: "json", type: "POST", async: !1, data: { forInvoices: u, isBaseLangs: f, C_OrderID: r, orggetVals: s, langs: e }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); $self.setBusy(!1); $self.log.info(t); return }, success: function (n) { var i = JSON.parse(n), u, r, t; if (i && i != null && i.length > 0) for (u = 1, r = 0; r < i.length; r++)t = {}, t.Quantity = i[r].quantity, t.QuantityEntered = i[r].quantityentered, t.C_UOM_ID = i[r].c_uom_id, t.M_Product_ID = i[r].m_product_id, t.M_AttributeSetInstance_ID = i[r].m_attributesetinstance_id, t.C_Order_ID = i[r].c_order_id, t.M_InOut_ID = null, t.C_Invoice_ID = null, t.C_UOM_ID_K = i[r].c_uom_id_k, t.M_Product_ID_K = i[r].m_product_id_k, t.M_AttributeSetInstance_ID_K = i[r].m_attributesetinstance_id_k, t.C_Order_ID_K = i[r].c_order_id_k, t.M_InOut_ID_K = null, t.C_Invoice_ID_K = null, t.C_PaymentTerm_ID = i[r].C_PaymentTerm_ID, t.PaymentTermName = i[r].PaymentTermName, t.IsAdvance = i[r].IsAdvance, t.C_InvoicePaymentTerm_ID = i[r].C_InvoicePaymentTerm_ID, t.IsInvoicePTAdvance = i[r].IsInvoicePTAdvance, t.recid = u, o.push(t); $self.setBusy(!1) } }), o) : (f = "", f = n.Env.isBaseLanguage(i, "C_UOM") ? " LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)" : " LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='" + n.Env.getAD_Language(i) + "')", e = n.Env.getAD_Language(i), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetOrderDataCommonsNotOrg", dataType: "json", type: "POST", async: !1, data: { forInvoices: u, isBaseLangs: f, C_OrderID: r, langs: e }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); $self.setBusy(!1); $self.log.info(t); return }, success: function (n) { var i = JSON.parse(n), u, r, t; if (i && i != null && i.length > 0) for (u = 1, r = 0; r < i.length; r++)t = {}, t.Quantity = i[r].quantity, t.QuantityEntered = i[r].quantityentered, t.C_UOM_ID = i[r].c_uom_id, t.M_Product_ID = i[r].m_product_id, t.M_AttributeSetInstance_ID = i[r].m_attributesetinstance_id, t.C_Order_ID = i[r].c_order_id, t.M_InOut_ID = null, t.C_Invoice_ID = null, t.C_UOM_ID_K = i[r].c_uom_id_k, t.M_Product_ID_K = i[r].m_product_id_k, t.M_AttributeSetInstance_ID_K = i[r].m_attributesetinstance_id_k, t.C_Order_ID_K = i[r].c_order_id_k, t.M_InOut_ID_K = null, t.C_Invoice_ID_K = null, t.C_PaymentTerm_ID = i[r].C_PaymentTerm_ID, t.PaymentTermName = i[r].PaymentTermName, t.IsAdvance = i[r].IsAdvance, t.C_InvoicePaymentTerm_ID = i[r].C_InvoicePaymentTerm_ID, t.IsInvoicePTAdvance = i[r].IsInvoicePTAdvance, $self.mTab.keyColumnName == "C_ProvisionalInvoice_ID" && (t.POPrice = i[r].POPrice, t.ProvisionalPrice = i[r].ProvisionalPrice), t.recid = u, o.push(t); $self.setBusy(!1) } }), o) }; i.prototype.loadGrid = function (i) { function a() { for (var n = 0; n < $self.dGrid.records.length; n++)$self.NonEditableRecord.indexOf(n + 1) >= 0 && ($self.dGrid.unselect(n + 1), t("#grid_" + $self.dGrid.name + "_rec_" + (n + 1) + "  input").attr("disabled", !0)) } function s(n, i) { var u = $self.dGrid.records[i].M_Product_ID_K, s = t.grep($self.editedItems, function (n) { return e != null ? n.M_Product_ID_K == u && n.C_Order_ID_K == $self.dGrid.records[i].C_Order_ID_K : o != null ? n.M_Product_ID_K == u && n.C_Invoice_ID_K == $self.dGrid.records[i].C_Invoice_ID_K : c != null ? n.M_Product_ID_K == u && n.M_InOut_ID_K == $self.dGrid.records[i].M_InOut_ID_K : n.C_Payment_ID_K == $self.dGrid.records[item].C_Payment_ID_K }), f, r; if (s.length > 0) $self.editedItems.splice($self.editedItems.indexOf(s[0]), 1), $self.editedItems.push($self.dGrid.records[i]); else { for (f = 0, r = 0; r < $self.editedItems.length; r++)if ($self.editedItems[r].recid == $self.dGrid.records[i].recid) { f = 1; break } f == 0 && $self.editedItems.push($self.dGrid.records[i]) } } function w(n, i, r) { var u = null; return t.ajax({ url: p, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } var f = n.DisplayType.GetNumberFormat(n.DisplayType.Amount), r = n.Env.isDecimalPoint(), l, h, v, u; this.dGrid != null && (this.dGrid.destroy(), this.dGrid = null); l = "Y".equals(n.Env.getCtx().getWindowContext(this.windowNo, "IsSOTrx")); this.arrListColumns.length != 0 && ($self.mTab.keyColumnName != "C_Invoice_ID" || l) || (this.arrListColumns = [], this.arrListColumns.push({ field: "Select", caption: n.Msg.getMsg("Select"), sortable: !1, size: "50px", hidden: !1, render: function () { return '<div><input type=checkbox disabled="true"><\/div>' } }), this.arrListColumns.push({ field: "Quantity", caption: n.Msg.getMsg("QtyPending"), sortable: !1, size: "150px", hidden: !1, render: function (n) { var t = n.Quantity; return parseFloat(t).toLocaleString(undefined, { minimumFractionDigits: 4 }) } }), this.arrListColumns.push({ field: "QuantityPending", caption: n.Msg.getMsg("Quantity"), sortable: !1, size: "150px", render: "number:4", hidden: !0 }), $self.cmbProvisionalInvoice.getControl().find("option:selected").val() > 0 && !l ? (this.arrListColumns.push({ field: "QuantityEntered", caption: n.Msg.getMsg("QtyEntered"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "POPrice", caption: n.Msg.getMsg("POPrice"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "ProvisionalPrice", caption: n.Msg.getMsg("ProvisionalPrice"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "InvoicePrice", caption: n.Msg.getMsg("InvoicePrice"), editable: { type: "number", style: "background-color: #f8f8f8;" }, sortable: !1, size: "150px", hidden: !1, render: function (n) { var t = n.InvoicePrice; return t = $self.checkcommaordot(event, t), parseFloat(t).toLocaleString(undefined, { minimumFractionDigits: 4 }) }, style: "background-color: #d1d1d14a" })) : this.arrListColumns.push({ field: "QuantityEntered", caption: n.Msg.getMsg("QtyEntered"), editable: { type: "number", style: "background-color: #f8f8f8;" }, sortable: !1, size: "150px", hidden: !1, render: function (n) { var t = n.QuantityEntered; return t = $self.checkcommaordot(event, t), parseFloat(t).toLocaleString(undefined, { minimumFractionDigits: 4 }) }, style: "background-color: #d1d1d14a" }), this.arrListColumns.push({ field: "C_UOM_ID", caption: n.Msg.getMsg("UomName"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "M_Product_SearchKey", caption: n.Msg.getMsg("ProductSearchKey"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "M_Product_ID", caption: n.Msg.getMsg("ProductName"), sortable: !0, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "M_AttributeSetInstance_ID", caption: n.Msg.getMsg("ASI"), sortable: !1, size: "150px", editable: { type: "custom", ctrl: $self.$productAttribute, showAll: !0, style: "background-color: #f8f8f8;" }, render: function (n) { var t = $self.pattrLookup, i = n.M_AttributeSetInstance_ID, r; return n.changes && typeof n.changes.M_AttributeSetInstance_ID != "undefined" && (i = n.changes.M_AttributeSetInstance_ID), t && (r = t.getDisplay(i, !0)), r }, style: "background-color: #d1d1d14a" }), this.arrListColumns.push({ field: "C_PaymentTerm_ID", caption: n.Msg.getMsg("C_PaymentTerm_ID"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "PaymentTermName", caption: n.Msg.getMsg("PaymentTermName"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "IsAdvance", caption: n.Msg.getMsg("IsAdvance"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "C_InvoicePaymentTerm_ID", caption: n.Msg.getMsg("C_InvoicePaymentTerm_ID"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "IsInvoicePTAdvance", caption: n.Msg.getMsg("IsInvoicePTAdvance"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "C_Order_ID", caption: n.Msg.getMsg("OrderLine"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "M_InOut_ID", caption: n.Msg.getMsg("Shipment/Receipt"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "C_Invoice_ID", caption: n.Msg.getMsg("Invoice"), sortable: !1, size: "150px", hidden: !1 }), this.arrListColumns.push({ field: "C_UOM_ID_K", caption: n.Msg.getMsg("UomName"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "M_Product_ID_K", caption: n.Msg.getMsg("ProductName"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "C_Order_ID_K", caption: n.Msg.getMsg("Order"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "M_InOut_ID_K", caption: n.Msg.getMsg("Shipment/Receipt"), sortable: !1, size: "150px", hidden: !0 }), this.arrListColumns.push({ field: "C_Invoice_ID_K", caption: n.Msg.getMsg("Invoice"), sortable: !1, size: "150px", hidden: !0 })); w2utils.encodeTags(i); h = "gridCreateForm" + this.windowNo; h = h.replace(".", ""); this.dGrid = t(this.middelDiv).w2grid({ name: h, recordHeight: 30, show: { selectColumn: !0 }, multiSelect: !0, columns: this.arrListColumns, records: i, onSelect: function (n) { n.onComplete = function () { a() } }, onEditField: function (n) { var i; id = n.recid; n.column == 3 && ($self.dGrid.records[n.index].QuantityEntered = $self.checkcommaordot(n, $self.dGrid.records[n.index].QuantityEntered), i = f.GetFormatAmount($self.dGrid.records[n.index].QuantityEntered, "init", r), $self.dGrid.records[n.index].QuantityEntered = f.GetConvertedString(i, r), t("#grid_" + $self.dGrid.name + "_rec_" + id).keydown(function (n) { if (r || n.keyCode != 190 && n.keyCode != 110) { if (r && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) ? n.target.value.indexOf(".") > -1 && (n.target.value = n.target.value.replace(".", "")) : n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && n.target.value.indexOf(",") > -1 && (n.target.value = n.target.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 })); n.column == 4 && $self.dGrid.columns[n.column].field == "ProvisionalPrice" && ($self.dGrid.records[n.index].ProvisionalPrice = $self.checkcommaordot(n, $self.dGrid.records[n.index].ProvisionalPrice), i = f.GetFormatAmount($self.dGrid.records[n.index].ProvisionalPrice, "init", r), $self.dGrid.records[n.index].ProvisionalPrice = f.GetConvertedString(i, r), $self.dGrid.refreshRow(n.index + 1), t("#grid_" + $self.dGrid.name + "_rec_" + id).keydown(function (n) { if (r || n.keyCode != 190 && n.keyCode != 110) { if (r && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) ? n.target.value.indexOf(".") > -1 && (n.target.value = n.target.value.replace(".", "")) : n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && n.target.value.indexOf(",") > -1 && (n.target.value = n.target.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 })); n.column == 6 && $self.dGrid.columns[n.column].field == "InvoicePrice" && ($self.dGrid.records[n.index].InvoicePrice = $self.checkcommaordot(n, $self.dGrid.records[n.index].InvoicePrice), i = f.GetFormatAmount($self.dGrid.records[n.index].InvoicePrice, "init", r), $self.dGrid.records[n.index].InvoicePrice = f.GetConvertedString(i, r), $self.dGrid.refreshRow(n.index + 1), t("#grid_" + $self.dGrid.name + "_rec_" + id).keydown(function (n) { if (r || n.keyCode != 190 && n.keyCode != 110) { if (r && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) ? n.target.value.indexOf(".") > -1 && (n.target.value = n.target.value.replace(".", "")) : n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && n.target.value.indexOf(",") > -1 && (n.target.value = n.target.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 })) }, onChange: function (i) { window.setTimeout(function () { if ($self.dGrid.getChanges(i.recid) != undefined && i.column == 0 && $self.dGrid.columns[i.column].field == "Date") { var r = n.context.getContextAsInt($self.windowNo, "AD_Org_ID"), u = $self.dGrid.records[i.index].Amount, f = $self.dGrid.records[i.index].C_Currency_ID_K, e = $self.dGrid.records[i.index].C_ConversionType_ID, o = $self.dGrid.records[i.index].Date, s = $self.dGrid.records[i.index].Type, h = $self.dGrid.records[i.index].C_Payment_ID_K; t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetConvertedAmount", dataType: "json", type: "POST", data: { _paymentId: h, amount: u, currencyId: f, convsion_Id: e, date: o, paymentType: s, _org_id: r }, error: function () { n.ADialog.info("ErrorWhileGettingData", null, "", ""); self.$super.setBusy(!1); return }, success: function (t) { t = JSON.parse(t); n.Utility.Util.getValueOfString(t._message) == "Success" ? (_convertedAmt = n.Utility.Util.getValueOfDecimal(t.convtAmt), $self.dGrid.records[i.index].changes.ConvertedAmount = _convertedAmt, $self.dGrid.records[i.index].ConvertedAmount = _convertedAmt, $self.dGrid.refreshRow(i.index + 1)) : n.ADialog.info(t._message, null, "", "") } }) } }, 100) } }); this.dGrid.selectNone(); var e = $self.cmbOrder.getControl().find("option:selected").val(), o = $self.cmbInvoice.getControl().find("option:selected").val(), c = $self.cmbShipment.getControl().find("option:selected").val(); for (itm in $self.multiValues) for (item in $self.dGrid.records) v = t.grep($self.multiValues, function (n) { return e != null ? n.M_Product_ID_K == $self.dGrid.records[item].M_Product_ID_K && n.C_Order_ID_K == $self.dGrid.records[item].C_Order_ID_K : o != null ? n.M_Product_ID_K == $self.dGrid.records[item].M_Product_ID_K && n.C_Invoice_ID_K == $self.dGrid.records[item].C_Invoice_ID_K : c != null ? n.M_Product_ID_K == $self.dGrid.records[item].M_Product_ID_K && n.M_InOut_ID_K == $self.dGrid.records[item].M_InOut_ID_K : n.C_Payment_ID_K == $self.dGrid.records[item].C_Payment_ID_K }), v.length > 0 && $self.dGrid.select(parseInt(item) + 1); if (this.dGrid.records.length > 0) for ($self.NonEditableRecord = [], u = 0; u < $self.dGrid.records.length; u++)t(t("#grid_" + $self.dGrid.name + "_rec_" + (u + 1)).find("input[type=checkbox]")[1]).prop("checked", i[u].Select), $self.dGrid.records[u].C_InvoicePaymentTerm_ID == $self.dGrid.records[u].C_PaymentTerm_ID || $self.dGrid.records[u].C_InvoicePaymentTerm_ID == 0 || $self.dGrid.records[u].C_InvoicePaymentTerm_ID != $self.dGrid.records[u].C_PaymentTerm_ID && $self.dGrid.records[u].IsAdvance == !1 && $self.dGrid.records[u].IsInvoicePTAdvance == !1 || (t("#grid_" + $self.dGrid.name + "_rec_" + (u + 1) + "  input").attr("disabled", !0), $self.NonEditableRecord.push(u + 1)); this.dGrid.on("change", function (t) { var i; if (a(), $self.dGrid.columns[t.column].field == "QuantityEntered") { if (i = f.GetConvertedNumber(t.value_new, r), $self.fromInvoice) { if ($self.dGrid.records[t.index].QuantityPending < i.toFixed(4)) { n.ADialog.error("InvoiceQtyGreater"); t.value_new = t.value_original; return } } else if ($self.dGrid.records[t.index].QuantityPending < i.toFixed(4)) { n.ADialog.error("QtyCanNotbeGreater"); t.value_new = t.value_original; return } $self.dGrid.records[t.index].QuantityEntered = i.toFixed(4); (e > 0 || o > 0) && s("QuantityEntered", t.index, i.toFixed(4)) } if ($self.dGrid.columns[t.column].field == "ProvisionalPrice") { if (i = f.GetConvertedNumber(t.value_new, r), i < 0) { n.ADialog.error("PriceCantNegative"); t.value_new = t.value_original; return } $self.dGrid.records[t.index].ProvisionalPrice = i.toFixed(4); s("ProvisionalPrice", t.index, i.toFixed(4)) } else if ($self.dGrid.columns[t.column].field == "InvoicePrice") { if (i = f.GetConvertedNumber(t.value_new, r), i < 0) { n.ADialog.error("PriceCantNegative"); t.value_new = t.value_original; return } $self.dGrid.records[t.index].InvoicePrice = i.toFixed(4); s("InvoicePrice", t.index, i.toFixed(4)) } else $self.dGrid.columns[t.column].field == "M_AttributeSetInstance_ID" ? ($self.dGrid.records[t.index].M_AttributeSetInstance_ID = t.value_new, (e > 0 || o > 0) && s("M_AttributeSetInstance_ID", t.index, t.value_new)) : $self.dGrid.columns[t.column].field == "Date" && (t.value_new != "" ? $self.dGrid.records[t.index].Date = t.value_new : t.value_previous != "" ? $self.dGrid.records[t.index].Date = t.value_previous : t.value_original != "" && ($self.dGrid.records[t.index].Date = t.value_original), $self.dGrid.records[t.index].Date != "" && s("Date", t.index, $self.dGrid.records[t.index].Date)) }); this.dGrid.on("click", function (t) { t.preventDefault; a(); n.Env.getCtx().setContext($self.windowNo, "M_Product_ID", n.Utility.Util.getValueOfInt($self.dGrid.records[t.recid - 1].M_Product_ID_K)) }); var b = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return w(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, y = n.Application.contextUrl, p = y + "JsonData/JDataSet", k = y + "JsonData/ExecuteNonQuer"; this.dGrid.on("unselect", function (n) { if (n.all) n.onComplete = function () { for (item in $self.dGrid.records) { var n = t.grep($self.multiValues, function (n) { return e != null ? n.M_Product_ID_K == $self.dGrid.records[item].M_Product_ID_K && n.C_Order_ID_K == $self.dGrid.records[item].C_Order_ID_K : o != null ? n.M_Product_ID_K == $self.dGrid.records[item].M_Product_ID_K && n.C_Invoice_ID_K == $self.dGrid.records[item].C_Invoice_ID_K : c != null ? n.M_Product_ID_K == $self.dGrid.records[item].M_Product_ID_K && n.M_InOut_ID_K == $self.dGrid.records[item].M_InOut_ID_K : n.C_Payment_ID_K == $self.dGrid.records[item].C_Payment_ID_K }); n.length > 0 && $self.multiValues.splice($self.multiValues.indexOf(n[0]), 1) } }; else { var i = w2ui[n.target].records[n.index].M_Product_ID_K, r = t.grep($self.multiValues, function (t) { return e != null ? t.M_Product_ID_K == i && t.C_Order_ID_K == w2ui[n.target].records[n.index].C_Order_ID_K : o != null ? t.M_Product_ID_K == i && t.C_Invoice_ID_K == w2ui[n.target].records[n.index].C_Invoice_ID_K : c != null ? t.M_Product_ID_K == i && t.M_InOut_ID_K == w2ui[n.target].records[n.index].M_InOut_ID_K : t.C_Payment_ID_K == $self.dGrid.records[item].C_Payment_ID_K }); r.length > 0 && $self.multiValues.splice($self.multiValues.indexOf(r[0]), 1) } }) }; n.VCreateFrom = i }(VIS, jQuery), function (n, t) { function i(i) { function e() { var t, i; return r.title = n.Msg.getMsg("Invoice") + " .. " + n.Msg.getMsg("CreateFrom"), r.lblInvoice != null && r.lblInvoice.getControl().css("display", "none"), r.cmbInvoice != null && r.cmbInvoice.getControl().css("display", "none"), r.lblLocator != null && r.lblLocator.getControl().css("display", "none"), r.locatorField != null && r.locatorField.getControl().css("display", "none"), r.deliveryDate = new n.Controls.VDate("DeliveryDate", !1, !1, !0, n.DisplayType.Date, "DeliveryDate"), t = n.MLookupFactory.getMLookUp(n.Env.getCtx(), r.windowNo, 2221, n.DisplayType.Search), r.vProduct = new n.Controls.VTextBoxButton("M_Product_ID", !0, !1, !0, n.DisplayType.Search, t), i = r.initBPartner(!0), r.vBPartner.setReadOnly(!0), s(i), r.fromInvoice = !0, !0 } function o(i, f) { var e = "s.DocumentNo||' - '||".concat(n.DB.to_char("s.MovementDate", n.DisplayType.Date, n.Env.getAD_Language(n.Env.getCtx()))), o = "Y".equals(n.Env.getCtx().getWindowContext(u.windowNo, "IsDropShip")), s = "Y".equals(n.Env.getCtx().getWindowContext(u.windowNo, "IsSOTrx")), h = n.dataContext.getJSONRecord("MDocType/GetDocType", n.Env.getCtx().getContextAsInt(u.windowNo, "C_DocTypeTarget_ID").toString()), c = n.Utility.Util.getValueOfBoolean(h.IsReturnTrx); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetShipmentsData", type: "POST", data: { displays: e, CBPartnerIDs: f, IsDrop: o, IsSOTrx: s, isReturnTrxs: c, isProvisionlInvoices: !1 }, success: function (t) { var u = JSON.parse(t), f, e, i; if (u && u.length > 0) { for (i = 0; i < u.length; i++)f = n.Utility.Util.getValueOfInt(u[i].key), e = n.Utility.encodeText(u[i].value), i == 0 && r.cmbShipment.getControl().append(" <option value=0> <\/option>"), r.cmbShipment.getControl().append(" <option value=" + f + ">" + e + "<\/option>"); r.cmbShipment.getControl().prop("selectedIndex", 0) } }, error: function (n) { u.log.info(n) } }) } function s(t) { r.cmbShipment.getControl().html(""); o(n.Env.getCtx(), t) } var r = this.$super, u, f; r.constructor(i); u = this; e(); r.jbInit(); r.initOK = !0; f = i.getWindowNo(); this.log = n.Logging.VLogger.getVLogger("VCreateFromInvoice"); this.disposeComponent = function () { r = null; u = null; this.disposeComponent = null } } n.Utility.inheritPrototype(i, n.VCreateFrom); i.prototype.saveInvoice = function () { var r, n, t; if (this.$super.dGrid == null || (r = {}, n = this.$super.multiValues, n == null) || n.length <= 0) return !1; for (t = 0; t < n.length; t++)r[t] = n[t]; var u = this.$super.mTab.getValue("C_Invoice_ID"), f = this.$super.cmbOrder.getControl().find("option:selected").val(), e = this.$super.cmbShipment.getControl().find("option:selected").val(), i = this.$super.cmbProvisionalInvoice.getControl().find("option:selected").val(); return (i == undefined || i == "") && (i = 0), this.saveData(r, "", f, e, u, i) }; i.prototype.loadShipments = function (t, i, r) { var u = this.getShipmentsData(n.Env.getCtx(), t, i, r) }; i.prototype.getShipmentsData = function (i, r, u, f) { var e = this, o, c, s, h; if (this.$super.record_ID = $self.mTab.getValue("C_Invoice_ID"), e.$super.dGrid != null) { o = e.$super.dGrid.getSelection(); for (item in o) c = t.grep(e.$super.multiValues, function (n) { return n.M_Product_ID_K == e.$super.dGrid.get(o[item]).M_Product_ID_K && n.M_InOut_ID_K == e.$super.dGrid.get(o[item]).M_InOut_ID_K }), c.length > 0 || e.$super.multiValues.push(e.$super.dGrid.get(o[item])) } return s = "", h = "", s = n.Env.isBaseLanguage(i, "C_UOM") ? "FROM C_UOM uom INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID) " : "FROM C_UOM_Trl uom Left join C_UOM uom1 on (uom1.C_UOM_ID=uom.C_UOM_ID)  INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='" + n.Env.getAD_Language(i) + "') ", u != null && (h = " AND l.M_Product_ID=" + u), f || (f = 1), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetDataVCreateFrom", dataType: "json", type: "POST", data: { keyColumnName: e.$super.mTab.keyColumnName, tableName: "M_InOutLine", recordID: e.$super.record_ID, pageNo: f, mInOutId: r, isBaseLanguages: s, mProductIDD: h }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); e.$super.setBusy(!1); selfChild.log.info(t); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); e.$super.setBusy(!1); return } e.$super.resetPageCtrls(i.pSetting); e.$super.loadGrid(i.data); e.$super.setBusy(!1) } }), [] }; i.prototype.loadShipment = function (t) { var i = this.getShipmentData(n.Env.getCtx(), t); this.$super.loadGrid(i) }; i.prototype.getShipmentData = function (i, r) { var u = ""; return u = n.Env.isBaseLanguage(i, "C_UOM") ? "FROM C_UOM uom INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID) " : "FROM C_UOM_Trl uom INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='" + n.Env.getAD_Language(i) + "') ", t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetShipmentDatas", type: "POST", async: !1, data: { MInOutIDs: r, isBaseLanguageUmos: u }, success: function (n) { var i = JSON.parse(n), r, u; if (i && i.length > 0) for (r = 1, u = 0; u < i.length; u++) { var t = {}, f = dr.getDecimal(0), e = dr.getDecimal(1); t.Quantity = f; t.QuantityEntered = e; t.C_UOM_ID = dr.getString(3); t.M_Product_ID = dr.getString(5); t.C_Order_ID = "."; t.M_InOut_ID = dr.getString(7); t.C_Invoice_ID = null; t.C_UOM_ID_K = dr.getString(2); t.M_Product_ID_K = dr.getInt(4); t.C_Order_ID_K = dr.getInt(8); t.M_InOut_ID_K = dr.getInt(6); t.C_Invoice_ID_K = null; t.recid = r; r++; n.push(t) } }, error: function () { } }), [] }; i.prototype.loadProvisionalInvoices = function (t, i, r) { var u = this.getProvisionalInvoicesData(n.Env.getCtx(), t, i, r) }; i.prototype.getProvisionalInvoicesData = function (i, r, u, f) { var e = this, o, l, s, h, c; if (this.$super.record_ID = $self.mTab.getValue("C_Invoice_ID"), e.$super.dGrid != null) { o = e.$super.dGrid.getSelection(); for (item in o) l = t.grep(e.$super.multiValues, function (n) { return n.M_Product_ID_K == e.$super.dGrid.get(o[item]).M_Product_ID_K && n.C_Invoice_ID_K == e.$super.dGrid.get(o[item]).C_Invoice_ID_K }), l.length > 0 || e.$super.multiValues.push(e.$super.dGrid.get(o[item])) } return s = "", h = "", s = n.Env.isBaseLanguage(i, "C_UOM") ? "FROM C_UOM uom INNER JOIN C_ProvisionalInvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID) " : "FROM C_UOM_Trl uom Left join C_UOM uom1 on (uom1.C_UOM_ID=uom.C_UOM_ID) INNER JOIN C_ProvisionalInvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='" + n.Env.getAD_Language(i) + "') ", u != null && (h = " AND l.M_Product_ID = " + u), f || (f = 1), c = null, e.$super.relatedToOrg != null && e.$super.relatedToOrg.getValue() && (c = e.$super.mTab.getValue("AD_Org_ID")), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetProvisionalInvoicesDataVCreate", dataType: "json", type: "POST", data: { keyColumnName: e.$super.mTab.keyColumnName, tableName: "C_ProvisionalInvoiceLine", recordID: e.$super.record_ID, pageNo: f, isBaseLangss: s, cInvoiceID: r, mProductIDs: h, orgId: c }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); selfChild.log.info(t); e.$super.setBusy(!1); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); e.$super.setBusy(!1); return } e.$super.resetPageCtrls(i.pSetting); e.$super.loadGrid(i.data); e.$super.setBusy(!1) } }), [] }; i.prototype.saveData = function (i, r, u, f, e, o) { var s = this; t.ajax({ type: "POST", url: n.Application.contextUrl + "Common/SaveInvoice", dataType: "json", data: { model: i, selectedItems: r, C_Order_ID: u, C_Invoice_ID: e, M_inout_id: f, C_ProvisionalInvoice_ID: o }, success: function (n) { if (returnValue = n.result, returnValue) { s.dispose(); s.$super.$root.dialog("close"); s.$super.setBusy(!1); return } s.$super.setBusy(!1); alert(returnValue) }, error: function (n, t, i) { console.log(t); s.$super.setBusy(!1); alert(i) } }) }; i.prototype.dispose = function () { this.disposeComponent != null && this.disposeComponent() }; n.VCreateFromInvoice = i }(VIS, jQuery), function (n, t) { function i(i) { function e() { var t, i; return r.title = n.Msg.getMsg("ProvisionalInvoice") + " .. " + n.Msg.getMsg("CreateFrom"), r.relatedToOrg = null, r.fromInvoice = !1, r.ProvisionalInvoice = !0, r.lblInvoice != null && r.lblInvoice.getControl().css("display", "none"), r.cmbInvoice != null && r.cmbInvoice.getControl().css("display", "none"), r.lblLocator != null && r.lblLocator.getControl().css("display", "none"), r.locatorField != null && r.locatorField.getControl().css("display", "none"), r.deliveryDate = new n.Controls.VDate("DeliveryDate", !1, !1, !0, n.DisplayType.Date, "DeliveryDate"), t = n.MLookupFactory.getMLookUp(n.Env.getCtx(), r.windowNo, 2221, n.DisplayType.Search), r.vProduct = new n.Controls.VTextBoxButton("M_Product_ID", !0, !1, !0, n.DisplayType.Search, t), i = r.initBPartnerForProvisional(), r.vBPartner.setReadOnly(!0), o(i), u.getTableFieldVOs(), !0 } function o(t) { r.cmbShipment.getControl().html(""); s(n.Env.getCtx(), t) } function s(i, f) { var e = "s.DocumentNo||' - '||".concat(n.DB.to_char("s.MovementDate", n.DisplayType.Date, n.Env.getAD_Language(n.Env.getCtx()))), o = "Y".equals(n.Env.getCtx().getWindowContext(u.windowNo, "IsDropShip")), s = "Y".equals(n.Env.getCtx().getWindowContext(u.windowNo, "IsSOTrx")), h = n.dataContext.getJSONRecord("MDocType/GetDocType", n.Env.getCtx().getContextAsInt(u.windowNo, "C_DocType_ID").toString()), c = n.Utility.Util.getValueOfBoolean(h.IsReturnTrx); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetShipmentsData", type: "POST", data: { displays: e, CBPartnerIDs: f, IsDrop: o, IsSOTrx: s, isReturnTrxs: c, isProvisionlInvoices: !0 }, success: function (t) { var u = JSON.parse(t), f, e, i; if (u && u.length > 0) { for (i = 0; i < u.length; i++)f = n.Utility.Util.getValueOfInt(u[i].key), e = n.Utility.encodeText(u[i].value), i == 0 && r.cmbShipment.getControl().append(" <option value=0> <\/option>"), r.cmbShipment.getControl().append(" <option value=" + f + ">" + e + "<\/option>"); r.cmbShipment.getControl().prop("selectedIndex", 0) } }, error: function (n) { u.log.info(n) } }) } var r = this.$super, u, f; r.constructor(i); u = this; e(); r.jbInit(); r.initOK = !0; f = i.getWindowNo(); this.log = n.Logging.VLogger.getVLogger("VCreateFormProvisionalInvoice"); this.disposeComponent = function () { r = null; u = null; this.disposeComponent = null } } n.Utility.inheritPrototype(i, n.VCreateFrom); i.prototype.getTableFieldVOs = function () { var t = this.$super, i = this; t.arrListColumns = []; t.arrListColumns.push({ field: "Quantity", caption: n.Msg.getMsg("QtyPending"), sortable: !1, size: "150px", hidden: !1, render: function (n) { var t = n.Quantity; return parseFloat(t).toLocaleString(undefined, { minimumFractionDigits: 4 }) } }); t.arrListColumns.push({ field: "QuantityPending", caption: n.Msg.getMsg("Quantity"), sortable: !1, size: "150px", render: "number:4", hidden: !0 }); t.arrListColumns.push({ field: "QuantityEntered", caption: n.Msg.getMsg("QtyEntered"), sortable: !1, size: "150px", hidden: !1, render: function (n) { var i = n.QuantityEntered; return i = t.checkcommaordot(event, i), parseFloat(i).toLocaleString(undefined, { minimumFractionDigits: 4 }) } }); t.arrListColumns.push({ field: "POPrice", caption: n.Msg.getMsg("POPrice"), sortable: !1, size: "150px", hidden: !1, render: function (n) { var t = n.POPrice; return parseFloat(t).toLocaleString(undefined, { minimumFractionDigits: 4 }) } }); t.arrListColumns.push({ field: "ProvisionalPrice", caption: n.Msg.getMsg("ProvisionalPrice"), editable: { type: "number", style: "background-color: #f8f8f8;" }, sortable: !1, size: "150px", hidden: !1, render: function (n) { var i = n.ProvisionalPrice; return i = t.checkcommaordot(event, i), parseFloat(i).toLocaleString(undefined, { minimumFractionDigits: 4 }) }, style: "background-color: #d1d1d14a" }); t.arrListColumns.push({ field: "C_UOM_ID", caption: n.Msg.getMsg("UomName"), sortable: !1, size: "150px", hidden: !1 }); t.arrListColumns.push({ field: "M_Product_SearchKey", caption: n.Msg.getMsg("ProductSearchKey"), sortable: !1, size: "150px", hidden: !1 }); t.arrListColumns.push({ field: "M_Product_ID", caption: n.Msg.getMsg("ProductName"), sortable: !0, size: "150px", hidden: !1 }); t.arrListColumns.push({ field: "M_AttributeSetInstance_ID", caption: n.Msg.getMsg("ASI"), sortable: !1, size: "150px", editable: { type: "custom", ctrl: i.$productAttribute, showAll: !0, style: "background-color: #f8f8f8;" }, render: function (n) { var t = i.pattrLookup, r = n.M_AttributeSetInstance_ID, u; return n.changes && typeof n.changes.M_AttributeSetInstance_ID != "undefined" && (r = n.changes.M_AttributeSetInstance_ID), t && (u = t.getDisplay(r, !0)), u }, style: "background-color: #d1d1d14a" }); t.arrListColumns.push({ field: "C_PaymentTerm_ID", caption: n.Msg.getMsg("C_PaymentTerm_ID"), sortable: !1, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "PaymentTermName", caption: n.Msg.getMsg("PaymentTermName"), sortable: !1, size: "150px", hidden: !1 }); t.arrListColumns.push({ field: "IsAdvance", caption: n.Msg.getMsg("IsAdvance"), sortable: !1, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "C_InvoicePaymentTerm_ID", caption: n.Msg.getMsg("C_InvoicePaymentTerm_ID"), sortable: !1, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "IsInvoicePTAdvance", caption: n.Msg.getMsg("IsInvoicePTAdvance"), sortable: !1, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "C_Order_ID", caption: n.Msg.getMsg("OrderLine"), sortable: !1, size: "150px", hidden: !1 }); t.arrListColumns.push({ field: "M_InOut_ID", caption: n.Msg.getMsg("Shipment/Receipt"), sortable: !1, size: "150px", hidden: !1 }); t.arrListColumns.push({ field: "C_Invoice_ID", caption: n.Msg.getMsg("Invoice"), sortable: !1, size: "150px", hidden: !1 }); t.arrListColumns.push({ field: "C_UOM_ID_K", caption: n.Msg.getMsg("UomName"), sortable: !1, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "M_Product_ID_K", caption: n.Msg.getMsg("ProductName"), sortable: !1, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "C_Order_ID_K", caption: n.Msg.getMsg("Order"), sortable: !1, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "M_InOut_ID_K", caption: n.Msg.getMsg("Shipment/Receipt"), sortable: !1, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "C_Invoice_ID_K", caption: n.Msg.getMsg("Invoice"), sortable: !1, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "Select", caption: n.Msg.getMsg("Select"), sortable: !1, size: "50px", hidden: !0, render: function () { return '<div><input type=checkbox disabled="true"><\/div>' } }) }; i.prototype.saveProvisionalInvoice = function () { var i, n, t; if (this.$super.dGrid == null || (i = {}, n = this.$super.multiValues, n == null) || n.length <= 0) return !1; for (t = 0; t < n.length; t++)i[t] = n[t]; var r = this.$super.mTab.getValue("C_ProvisionalInvoice_ID"), u = this.$super.cmbOrder.getControl().find("option:selected").val(), f = this.$super.cmbShipment.getControl().find("option:selected").val(); return this.saveData(i, "", u, f, r) }; i.prototype.saveData = function (i, r, u, f, e) { var o = this; t.ajax({ type: "POST", url: n.Application.contextUrl + "Common/SaveProvisionalInvoice", dataType: "json", data: { model: i, selectedItems: r, C_Order_ID: u, C_ProvisionalInvoice_ID: e, M_inout_id: f }, success: function (n) { if (returnValue = n.result, returnValue) { o.dispose(); o.$super.$root.dialog("close"); o.$super.setBusy(!1); return } o.$super.setBusy(!1); alert(returnValue) }, error: function (n, t, i) { console.log(t); o.$super.setBusy(!1); alert(i) } }) }; i.prototype.loadShipments = function (t, i, r) { var u = this.getShipmentsData(n.Env.getCtx(), t, i, r) }; i.prototype.getShipmentsData = function (i, r, u, f) { var e = this, o, c, s, h; if (this.$super.record_ID = $self.mTab.getValue("C_ProvisionalInvoice_ID"), e.$super.dGrid != null) { o = e.$super.dGrid.getSelection(); for (item in o) c = t.grep(e.$super.multiValues, function (n) { return n.M_Product_ID_K == e.$super.dGrid.get(o[item]).M_Product_ID_K && n.M_InOut_ID_K == e.$super.dGrid.get(o[item]).M_InOut_ID_K }), c.length > 0 || e.$super.multiValues.push(e.$super.dGrid.get(o[item])) } return s = "", h = "", s = n.Env.isBaseLanguage(i, "C_UOM") ? "FROM C_UOM uom INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID) " : "FROM C_UOM_Trl uom Left join C_UOM uom1 on (uom1.C_UOM_ID=uom.C_UOM_ID)  INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='" + n.Env.getAD_Language(i) + "') ", u != null && (h = " AND l.M_Product_ID=" + u), f || (f = 1), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetDataVCreateFrom", dataType: "json", type: "POST", data: { keyColumnName: e.$super.mTab.keyColumnName, tableName: "M_InOutLine", recordID: e.$super.record_ID, pageNo: f, mInOutId: r, isBaseLanguages: s, mProductIDD: h }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); e.$super.setBusy(!1); selfChild.log.info(t); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); e.$super.setBusy(!1); return } e.$super.resetPageCtrls(i.pSetting); e.$super.loadGrid(i.data); e.$super.setBusy(!1) } }), [] }; i.prototype.dispose = function () { this.disposeComponent != null && this.disposeComponent() }; n.VCreateFormProvisionalInvoice = i }(VIS, jQuery), function (n, t) { function i(i) { function f() { var e, t, i, u, f; r.title = n.Msg.getElement(n.Env.getCtx(), "M_InOut_ID", !1) + " .. " + n.Msg.translate(n.Env.getCtx(), "CreateFrom"); r.lblShipment != null && r.lblShipment.getControl().css("display", "none"); r.cmbShipment != null && r.cmbShipment.getControl().css("display", "none"); r.Applybtn && r.Applybtn.css("display", "block"); e = 3537; t = new n.MLocatorLookup(n.Env.getCtx(), r.windowNo); r.locatorField = new n.Controls.VLocator("M_Locator_ID", !0, !1, !0, n.DisplayType.Locator, t); r.deliveryDate = new n.Controls.VDate("DeliveryDate", !1, !1, !0, n.DisplayType.Date, "DeliveryDate"); i = n.MLookupFactory.getMLookUp(n.Env.getCtx(), r.windowNo, 2221, n.DisplayType.Search); r.vProduct = new n.Controls.VTextBoxButton("M_Product_ID", !0, !1, !0, n.DisplayType.Search, i); r.DocumentNoRef = new n.Controls.VTextBox("DocumentNo", !1, !0, !0, 50, 100, null, null, !1); r.lblContainer = new n.Controls.VLabel; r.cmbContainer = new n.Controls.VComboBox("", !1, !1, !0); r.lblContainer.getControl().text(n.Msg.getMsg("VIS_Container")); r.lblContainer != null && r.lblContainer.getControl().css("display", "block"); r.cmbContainer != null && r.cmbContainer.getControl().css("display", "block"); u = n.Env.getCtx().getContext(r.windowNo, "DocumentNo"); r.DocumentNoRef.setValue(u); f = r.initBPartner(!1); r.vBPartner.setReadOnly(!0); o(f) } function e(i, f, e) { var o = "i.DocumentNo||' - '||".concat(n.DB.to_char("DateInvoiced", n.DisplayType.Date, n.Env.getAD_Language(i))).concat("|| ' - ' ||").concat(n.DB.to_char("GrandTotal", n.DisplayType.Amount, n.Env.getAD_Language(i))), s = "Y".equals(n.Env.getCtx().getWindowContext(u.windowNo, "IsDropShip")); t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetInvoicesVCreate", type: "POST", data: { displays: o, cBPartnerId: f, isReturnTrxs: e, IsDrops: s }, success: function (t) { var u = JSON.parse(t), f, e, i; if (u && u.length > 0) try { for (i = 0; i < u.length; i++)f = n.Utility.Util.getValueOfInt(u[i].key), e = n.Utility.encodeText(u[i].value), i == 0 && r.cmbInvoice.getControl().append(" <option value=0> <\/option>"), r.cmbInvoice.getControl().append(" <option value=" + f + ">" + e + "<\/option>"); r.cmbInvoice.getControl().prop("selectedIndex", 0) } catch (o) { } }, error: function (n) { u.log.info(n) } }) } function o(t) { r.cmbInvoice.getControl().html(""); var i = "Y".equals(n.Env.getCtx().getWindowContext(r.windowNo, "IsReturnTrx")); e(n.Env.getCtx(), t, i) } var r = this.$super, u; r.constructor(i); u = this; f(); r.jbInit(); r.initOK = !0; this.log = n.Logging.VLogger.getVLogger("VCreateFromShipment"); this.disposeComponent = function () { r = null; u = null; this.disposeComponent = null } } n.Utility.inheritPrototype(i, n.VCreateFrom); i.prototype.saveMInOut = function (t) { var u, i, r, f, e; if (this.$super.dGrid == null || (u = {}, i = this.$super.multiValues, i == null) || i.length <= 0) return this.$super.setBusy(!1), !1; for (r = 0; r < i.length; r++)u[r] = i[r]; if (f = this.$super.locatorField.getValue(), f == null || f == 0) return n.ADialog.info("Error", !0, n.Msg.translate(n.Env.getCtx(), "VIS_locfieldMandatory"), ""), this.$super.setBusy(!1), !1; if (u.length == 0) return this.$super.setBusy(!1), !1; e = this.$super.cmbContainer.getValue(); e === undefined && (e = 0); var o = f, s = this.$super.mTab.getValue("M_InOut_ID"), h = this.$super.cmbInvoice.getControl().find("option:selected").val(), c = this.$super.cmbOrder.getControl().find("option:selected").val(); return this.saveData(u, "", c, h, o, s, e, t) }; i.prototype.loadInvoices = function (t, i, r) { var u = this.getInvoicesData(n.Env.getCtx(), t, i, r) }; i.prototype.getInvoicesData = function (i, r, u, f) { var e = this, o, c, s, h; if (this.$super.record_ID = $self.mTab.getValue("M_InOut_ID"), e.$super.dGrid != null) { o = e.$super.dGrid.getSelection(); for (item in o) c = t.grep(e.$super.multiValues, function (n) { return n.M_Product_ID_K == e.$super.dGrid.get(o[item]).M_Product_ID_K && n.C_Invoice_ID_K == e.$super.dGrid.get(o[item]).C_Invoice_ID_K }), c.length > 0 || e.$super.multiValues.push(e.$super.dGrid.get(o[item])) } return s = "", h = "", s = n.Env.isBaseLanguage(i, "C_UOM") ? "FROM C_UOM uom INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID) " : "FROM C_UOM_Trl uom Left join C_UOM uom1 on (uom1.C_UOM_ID=uom.C_UOM_ID) INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='" + n.Env.getAD_Language(i) + "') ", u != null && (h = " AND l.M_Product_ID = " + u), f || (f = 1), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetInvoicesDataVCreate", dataType: "json", type: "POST", data: { keyColumnName: e.$super.mTab.keyColumnName, tableName: "C_InvoiceLine", recordID: e.$super.record_ID, pageNo: f, isBaseLangss: s, cInvoiceID: r, mProductIDs: h }, error: function (t) { alert(n.Msg.getMsg("ErrorWhileGettingData")); selfChild.log.info(t); e.$super.setBusy(!1); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); e.$super.setBusy(!1); return } e.$super.resetPageCtrls(i.pSetting); e.$super.loadGrid(i.data); e.$super.setBusy(!1) } }), [] }; i.prototype.initContainerDetails = function () { this.$super.cmbContainer.getControl().html("") }; i.prototype.loadInvoice = function (t) { var i = this.getInvoiceData(n.Env.getCtx(), t); this.$super.loadGrid(i) }; i.prototype.getInvoiceData = function (t, i) { var o = [], f = "SELECT round((l.QtyInvoiced-SUM(COALESCE(mi.Qty,0))) * (CASE WHEN l.QtyInvoiced=0 THEN 0 ELSE l.QtyEntered/l.QtyInvoiced END ),2) as QUANTITY,round((l.QtyInvoiced-SUM(COALESCE(mi.Qty,0))) * (CASE WHEN l.QtyInvoiced=0 THEN 0 ELSE l.QtyEntered/l.QtyInvoiced END ),2) as QTYENTER, l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name), l.M_Product_ID,p.Name, l.C_InvoiceLine_ID,l.Line, l.C_OrderLine_ID ", u, e; f = n.Env.isBaseLanguage(t, "C_UOM") ? f.concat("FROM C_UOM uom ").concat("INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID) ") : f.concat("FROM C_UOM_Trl uom ").concat("INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='").concat(n.Env.getAD_Language(t)).concat("') "); f = f.concat("INNER JOIN M_Product p ON (l.M_Product_ID=p.M_Product_ID) ").concat("LEFT OUTER JOIN M_MatchInv mi ON (l.C_InvoiceLine_ID=mi.C_InvoiceLine_ID) ").concat("WHERE l.C_Invoice_ID=" + i + " GROUP BY l.QtyInvoiced,l.QtyEntered,l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name),l.M_Product_ID,p.Name, l.C_InvoiceLine_ID,l.Line,l.C_OrderLine_ID ORDER BY l.Line"); u = null; try { for (u = n.DB.executeReader(f.toString(), null, null), e = 1; u.read();) { var r = {}, s = u.getDecimal(0), h = u.getDecimal(1); r.Quantity = s; r.QuantityEntered = h; r.C_UOM_ID = u.getString(3); r.M_Product_ID = u.getString(5); r.C_Order_ID = "."; r.M_InOut_ID = null; r.C_Invoice_ID = u.getString(7); r.C_UOM_ID_K = u.getString(2); r.M_Product_ID_K = u.getInt(4); r.C_Order_ID_K = u.getInt(8); r.M_InOut_ID_K = null; r.C_Invoice_ID_K = u.getInt(6); r.recid = e; e++; o.push(r) } u.close() } catch (c) { } return o }; i.prototype.saveData = function (i, r, u, f, e, o, s, h) { var c = this; console.log(e); t.ajax({ type: "POST", url: n.Application.contextUrl + "Common/SaveShipment", dataType: "json", data: { model: i, selectedItems: r, C_Order_ID: u, C_Invoice_ID: f, M_Locator_ID: e, M_InOut_ID: o, Container_ID: s }, success: function (n) { if (returnValue = n.result, returnValue) { h ? c.$super.callBackSave(returnValue) : (c.dispose(), c.$super.setBusy(!1), c.$super.$root.dialog("close")); return } }, error: function (n, t, i) { console.log(t); c.$super.setBusy(!1); alert(i) } }) }; i.prototype.dispose = function () { this.disposeComponent != null && this.disposeComponent() }; n.VCreateFromShipment = i }(VIS, jQuery), function (n, t) { function i(t) { function f() { var f, e, t; return i.mTab.getValue("C_BankStatement_ID") == null ? (n.ADialog.error(n.Msg.getMsg("SaveErrorRowNotFound", !0)), !1) : (i.title = n.Msg.getElement(n.Env.getCtx(), "C_BankStatement_ID", !1) + " .. " + n.Msg.getMsg("CreateFrom"), i.relatedToOrg = null, i.lblOrder != null && i.lblOrder.getControl().css("display", "none"), i.cmbOrder != null && i.cmbOrder.getControl().css("display", "none"), i.lblShipment != null && i.lblShipment.getControl().css("display", "none"), i.cmbShipment != null && i.cmbShipment.getControl().css("display", "none"), i.lblInvoice != null && i.lblInvoice.getControl().css("display", "none"), i.cmbInvoice != null && i.cmbInvoice.getControl().css("display", "none"), f = 4917, e = n.MLookupFactory.getMLookUp(n.Env.getCtx(), u, f, n.DisplayType.TableDir), i.cmbBankAccount = new n.Controls.VComboBox("C_BankAccount_ID", !0, !0, !0, e, 150, n.DisplayType.TableDir, 0), i.Date = new n.Controls.VDate("Date", !1, !1, !0, n.DisplayType.Date, "Date"), i.DocumentNo = new n.Controls.VTextBox("DocumentNo", !1, !1, !0, 50, 100, null, null, !1), i.Amount = new n.Controls.VAmountTextBox("Amount", !1, !1, !0, 50, 100, n.DisplayType.Amount, n.Msg.getMsg("Amount")), i.DepositSlip = new n.Controls.VTextBox("DepositSlip", !1, !1, !0, 50, 100, null, null, !1), i.AuthCode = new n.Controls.VTextBox("AuthCode", !1, !1, !0, 50, 100, null, null, !1), i.CheckNo = new n.Controls.VTextBox("CheckNo", !1, !1, !0, 50, 100, null, null, !1), i.cmbBankAccount.getControl().prop("selectedIndex", 0), t = n.Env.getCtx().getContextAsInt(u, "C_BankAccount_ID"), i.cmbBankAccount.setValue(t), r.initBPartner(t), r.loadBankAccounts(t, 0, "", "", "", "", "", "0", 1), i.btnRefresh && i.btnRefresh.css("display", "black"), !0) } var i = this.$super, r, u; i.constructor(t); r = this; u = t.getWindowNo(); f(); i.jbInit(); i.initOK = !0; i.middelDiv.css("height", "61%"); this.disposeComponent = function () { this.disposeComponent = null } } function u(n, i, r) { var u = null; return t.ajax({ url: e, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } var f, o; n.Utility.inheritPrototype(i, n.VCreateFrom); i.prototype.initBPartner = function (t) { var i = this.$super, r = " C_BPartner.C_BPartner_ID IN (SELECT  p.C_BPartner_ID as C_BPartner_ID FROM C_Payment p WHERE p.Processed='Y' AND p.IsReconciled='N' AND p.DocStatus IN ('CO','CL','RE','VO') AND p.PayAmt<>0 AND p.C_BankAccount_ID = " + t + " AND NOT EXISTS (SELECT * FROM C_BankStatementLine l WHERE p.C_Payment_ID=l.C_Payment_ID AND l.StmtAmt <> 0) )", u = n.MLookupFactory.get(n.Env.getCtx(), this.windowNo, 5398, n.DisplayType.Search, "C_BPartner_ID", 0, !1, r); i.vBPartner = new n.Controls.VTextBoxButton("C_BPartner_ID", !0, !1, !0, n.DisplayType.Search, u) }; i.prototype.getTableFieldVOs = function () { var t = this.$super, i; t.arrListColumns = []; t.arrListColumns.push({ field: "Date", caption: n.Msg.getMsg("DateAcct"), sortable: !0, size: "100px", hidden: !1, editable: { type: "date" }, render: function (n) { var t = n.Date; return new Date(t).toLocaleDateString() } }); t.arrListColumns.push({ field: "C_Payment_ID", caption: n.Msg.getMsg("Payment"), sortable: !0, size: "100px", hidden: !1 }); t.arrListColumns.push({ field: "C_Currency_ID", caption: n.Msg.getMsg("Currency"), sortable: !0, size: "80px", hidden: !1 }); i = n.Utility.Util.getValueOfInt(f("VIS_145")); i > 0 && t.arrListColumns.push({ field: "VA034_DepositSlipNo", caption: n.Msg.getMsg("DepositSlipNo"), sortable: !0, size: "100px", hidden: !1 }); t.arrListColumns.push({ field: "AuthCode", caption: n.Msg.getMsg("AuthCode"), sortable: !0, size: "100px", hidden: !1 }); t.arrListColumns.push({ field: "CheckNo", caption: n.Msg.getMsg("CheckNo"), sortable: !0, size: "80px", hidden: !1 }); t.arrListColumns.push({ field: "Amount", caption: n.Msg.getMsg("Amount"), sortable: !0, size: "80px", hidden: !1, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.Amount); return i.toLocaleString() } }); t.arrListColumns.push({ field: "ConvertedAmount", caption: n.Msg.getMsg("ConvertedAmount"), sortable: !0, size: "80px", hidden: !1, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.ConvertedAmount); return i.toLocaleString() } }); t.arrListColumns.push({ field: "Description", caption: n.Msg.getMsg("Description"), sortable: !0, size: "250px", hidden: !1 }); t.arrListColumns.push({ field: "C_BPartner_ID", caption: n.Msg.getMsg("BusinessPartner"), sortable: !0, size: "150px", hidden: !1 }); t.arrListColumns.push({ field: "Type", caption: n.Msg.getMsg("Type"), sortable: !0, size: "80px", hidden: !0 }); t.arrListColumns.push({ field: "C_Payment_ID_K", caption: n.Msg.getMsg("Payment"), sortable: !0, size: "150px", hidden: !0 }); t.arrListColumns.push({ field: "C_Currency_ID_K", caption: n.Msg.getMsg("Currency"), sortable: !0, size: "150px", hidden: !0 }) }; i.prototype.loadBankAccounts = function (t, i, r, u, f, e, o, s, h) { var c = this.$super, l = c.mTab.getValue("StatementDate"), a = this.getBankAccountsData(n.Env.getCtx(), t, i, r, l, u, f, e, o, s, h); this.getTableFieldVOs() }; i.prototype.getBankAccountsData = function (i, r, u, f, e, o, s, h, c, l, a) { var v = this, y, p, nt, tt; if (v.$super.dGrid != null) { y = v.$super.dGrid.getSelection(); for (item in y) p = t.grep(v.$super.multiValues, function (n) { return n.C_Payment_ID_K == v.$super.dGrid.get(y[item]).C_Payment_ID_K }), p.length > 0 || v.$super.multiValues.push(v.$super.dGrid.get(y[item])) } e == null && (e = DateTime.Today.Date); var it = n.DB.to_date(e, !0), w = "", b = "", k = "0", d = "", g = ""; return u > 0 && (k = " AND p.C_BPartner_ID = " + u), o != "" && (d = " AND p.DocumentNo LIKE '" + o + "'"), f != "" && f != null && (nt = n.DB.to_date(f, !0), w = " AND p.DateAcct = " + nt), o != "" && (g = " AND cs.DocumentNo LIKE '" + o + "'"), f != "" && f != null && (tt = n.DB.to_date(f, !0), b = " AND cs.DateAcct = " + tt), a || (a = 1), t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetBankAccountsData", dataType: "json", type: "POST", data: { pageNo: a, dates: it, trxDatess: w, trxDatesUnions: b, cBPartnerIDs: k, DocumentNos: d, DocumentNoUnions: g, DepositSlips: s, AuthCodes: h, CheckNos: c, Amounts: l, cBankAccountId: r }, error: function () { alert(n.Msg.getMsg("ErrorWhileGettingData")); v.$super.setBusy(!1); return }, success: function (t) { var i = JSON.parse(t); if (i.Error) { n.ADialog.error(i.Error); v.$super.setBusy(!1); return } v.$super.resetPageCtrls(i.pSetting); v.$super.loadGrid(i.data); v.$super.setBusy(!1) } }), [] }; i.prototype.loadBankAccount = function (t) { var i = this.$super, r = i.mTab.getValue("StatementDate"), u = this.getBankAccountData(n.Env.getCtx(), t, r); this.getTableFieldVOs(); setTimeout(function () { i.loadGrid(u) }, 10) }; i.prototype.getBankAccountData = function (i, r, u) { var s = [], f, o, e; try { for (u == null && (u = DateTime.Today.Date), f = null, t.ajax({ url: n.Application.contextUrl + "Form/GetBankAccontData", async: !1, data: { C_BankAccount_ID: r, ts: u } }).done(function (t) { f = (new n.DB.DataReader).toJson(t) }), o = 1; f.read();)e = {}, e.Date = f.getString(0), e.C_Payment_ID = f.getString(2), e.C_Currency_ID = f.getString(4), e.Amount = f.getDecimal(5), e.ConvertedAmount = f.getDecimal(6), e.C_BPartner_ID = f.getString(7), e.Type = f.getString(8), e.C_Payment_ID_K = f.getString(1), e.C_Currency_ID_K = f.getInt(3), e.recid = o, o++, s.push(e) } catch (h) { } return s }; var r = n.Application.contextUrl, e = r + "JsonData/JDataSetWithCode", s = r + "JsonData/ExecuteNonQuer"; f = function (t, i, r) { var e = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, f = null; return u(o, e, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); f = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; e && r(f) }), f }; o = function (t, i, r) { var o = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, f; return i && (e.param = i), f = null, u(e, o, function (t) { f = (new n.DB.DataReader).toJson(t); r && r(f) }), f }; i.prototype.saveStatment = function () { var n; if (this.$super.dGrid == null) return !1; var r = this.$super.mTab.getValue("C_BankStatement_ID"), i = {}, t = this.$super.multiValues; if (t == null || t.length <= 0) return !1; for (n = 0; n < t.length; n++)i[n] = t[n]; return this.saveData(i, "", r) }; i.prototype.saveData = function (i, r, u) { var f = this; t.ajax({ type: "POST", url: n.Application.contextUrl + "Common/SaveStatment", dataType: "json", data: { model: i, selectedItems: r, C_BankStatement_ID: u }, success: function (n) { if (returnValue = n.result, returnValue) { f.dispose(); f.$super.$root.dialog("close"); f.$super.setBusy(!1); return } f.$super.setBusy(!1); alert(returnValue) }, error: function (n, t, i) { console.log(t); f.$super.setBusy(!1); alert(i) } }) }; i.prototype.dispose = function () { this.disposeComponent != null && this.disposeComponent() }; n.VCreateFromStatement = i }(VIS, jQuery), function (n, t) { function i() { function c() { var t = '<div style="width: 400px;margin: 20px auto;vertical-align: middle;"><div style="width: 400px;float: left;"><div style="width: 100px;float: left;   margin-top: 8px;"><span>' + n.Msg.getMsg("VISPRO_SelectTable") + '<\/span><\/div><div style="width: 300px;float: left;"><select style="width: 100%;float: left;" class="VIS_Pref_pass" id="cmbAllTable_@windowNo"><\/select><\/div><\/div><div style="float: left;margin-left: 5px;margin-top: 7px; display: none;"><input id="chkAllTable_@windowNo" type="checkbox" /><span>' + n.Msg.getMsg("VISPRO_AllTable") + '<\/span><\/div><div style="width: 400px;float: left; display: none;"><div style="width: 100px;float: left;"><span>' + n.Msg.getMsg("VISPRO_Path") + '<\/span><\/div><div style="width: 300px;float: left;"><input style="width: 81%;float: left;" class="VIS_Pref_pass" type="text" id="txtpath_@windowNo" /><input type="file" multiple="" webkitdirectory="" style="height: -1px; width:30px "><\/div><\/div><div style="width: 400px;float: left; display: none;"><div style="width: 100px;float: left;"><span>' + n.Msg.getMsg("VISPRO_EntityType") + '<\/span><\/div><div style="width: 300px;float: left;"><input id="chkClassType_@windowNo" type="checkbox" /><span>' + n.Msg.getMsg("VISPRO_ClassType") + '<\/span><\/div><\/div><div class="VIS-locator-DivStyle" style="text-align: right"><input type="button" id="btnCancel_@windowNo" style="margin-bottom:0px;margin-top:0px; float:right " value="' + n.Msg.getMsg("Cancel") + '" class="VIS_Pref_btn-2" /><input type="button" id="btnOk_@windowNo" style="margin-bottom:0px;margin-top:0px; float:right; margin-right:10px" class="VIS_Pref_btn-2" value="' + n.Msg.getMsg("VIS_Genrate") + '" /><a href="javascript:void(0)" class="VIS_Pref_pass-btn" style="display: none; margin-bottom: 0px; margin-top: 0px;float: right; margin-right: 10px;" id="btnOkA_@windowNo" >' + n.Msg.getMsg("VIS_Download") + "<\/a><\/div><\/div>"; t = t.replaceAll("@windowNo", i.windowNo); r.html(t); r.append(s); u = r.find("#btnOk_" + i.windowNo); e = r.find("#btnCancel_" + i.windowNo); f = r.find("#btnOkA_" + i.windowNo); h = r.find("#cmbAllTable_" + i.windowNo); chkAllTable = r.find("#chkAllTable_" + i.windowNo); txtpath = r.find("#txtpath_" + i.windowNo); chkClassType = r.find("#chkClassType_" + i.windowNo) } function l() { y() } function a() { if (u != null) u.on(n.Events.onTouchStartOrClick, function () { o(!0); v(); o(!1) }); if (f != null) f.on(n.Events.onTouchStartOrClick, function () { f.css("display", "none"); u.css("display", "block") }); if (e != null) e.on(n.Events.onTouchStartOrClick, function () { i.dispose() }) } function v() { var e = i, r = h.find("option:selected").val(); t.ajax({ url: n.Application.contextUrl + "Common/GenerateXClasses", dataType: "json", data: { directory: "", chkStatus: !1, tableId: r, classType: "" }, success: function (t) { if (t.contant != null) { var i = "data:text/csv;charset=utf-8," + encodeURIComponent(t.contant); f.attr("download", t.fileName).attr("href", i).attr("target", "_blank"); n.ADialog.info(t.msg); f.css("display", "block"); u.css("display", "none") } o(!1) } }) } function y() { t.ajax({ url: n.Application.contextUrl + "GenerateXModel/GenXModelGetTable", type: "POST", async: !1, success: function (t) { var r = t.result, i; if (r) for (i = 0; i < r.length; i++)h.append("<option value='" + r[i].AD_Table_ID + "'>" + n.Utility.encodeText(r[i].Name) + "<\/option>") }, error: function (n) { i.log.info(n) } }) } function k(n, i, r) { var u = null; return t.ajax({ url: w, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function o(n) { s.css("display", n ? "block" : "none") } this.frame; this.windowNo; this.log = n.Logging.VLogger.getVLogger("GenerateXModel"); var i = this, r = t("<div style='width: 100%; height: 100%; background-color: white;'>"), s = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), u = null, f = null, e = null, h = null; varchkAllTable = null; vartxtpath = null; varchkClassType = null; var p = n.Application.contextUrl, w = p + "JsonData/JDataSet", b = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, k(f, e, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; this.Initialize = function () { c(); l(); a(); o(!1) }; this.getRoot = function () { return r }; this.disposeComponent = function () { u && u.off(n.Events.onTouchStartOrClick); e && e.off(n.Events.onTouchStartOrClick); i = null; this.windowNo = null; r = null; s = null; this.getRoot = null; this.disposeComponent = null } } n.AForms = n.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; try { this.Initialize() } catch (i) { } this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.AForms.GenerateXModel = i }(VIS, jQuery), function (n, t) { function i(i, r, u) { var f, e; this.windowNo = i; this.AD_Client_ID = r; this.AD_Org_ID = 0; this.DateFrom = null; this.DateTo = null; f = this; this.ASchemas = []; this.ASchema = []; this.log = n.Logging.VLogger.getVLogger("AccountViewer"); this.dataByData = null; this._elements = []; this.documentQuery = !1; this.C_AcctSchema_ID = 0; this.PostingType = ""; this.AD_Table_ID = u; this.Record_ID = 0; this.whereInfo = []; this.tableInfo = []; this.displayQty = !1; this.displaySourceAmt = !1; this.displayDocumentInfo = !1; this.sortBy1 = ""; this.sortBy2 = ""; this.sortBy3 = ""; this.sortBy4 = ""; this.group1 = !1; this.group2 = !1; this.group3 = !1; this.group4 = !1; this._leadingColumns = 0; this._ref1 = null; this._ref2 = null; this.TABLE_ALIAS = "zz"; this.FUNCTION_COUNT = "Count"; this.FUNCTION_SUM = "Sum"; this.onLoaded = null; this.HasOrgUnit = null; this.AD_Client_ID == 0 && (this.AD_Client_ID = n.Env.getCtx().getContextAsInt(this.windowNo, "AD_Client_ID")); this.AD_Client_ID == 0 && (this.AD_Client_ID = n.Env.getCtx().ctx.AD_Client_ID); this.AD_Org_ID == 0 && (this.AD_Org_ID = Number(n.context.getWindowTabContext(this.windowNo, 0, "AD_Org_ID"))); e = ["AmtAcctCr", "AmtAcctDr", "AmtSourceCr", "AmtSourceDr",]; n.translatedTexts = n.Msg.translate(n.Env.getCtx(), e, !0); this.ELEMENTTYPE_AD_Reference_ID = 181; this.ELEMENTTYPE_Account = "AC"; this.ELEMENTTYPE_Activity = "AY"; this.ELEMENTTYPE_BPartner = "BP"; this.ELEMENTTYPE_LocationFrom = "LF"; this.ELEMENTTYPE_LocationTo = "LT"; this.ELEMENTTYPE_Campaign = "MC"; this.ELEMENTTYPE_Organization = "OO"; this.ELEMENTTYPE_OrgTrx = "OT"; this.ELEMENTTYPE_Project = "PJ"; this.ELEMENTTYPE_Product = "PR"; this.ELEMENTTYPE_SubAccount = "SA"; this.ELEMENTTYPE_SalesRegion = "SR"; this.ELEMENTTYPE_UserList1 = "U1"; this.ELEMENTTYPE_UserList2 = "U2"; this.ELEMENTTYPE_UserElement1 = "X1"; this.ELEMENTTYPE_UserElement2 = "X2"; this.getClientAcctSchema = function (i, r) { var e = [], u = this; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/GetClientAcctSchema", type: "POST", async: !0, data: { ad_client_id: i, ad_org_id: r }, success: function (t) { var r, f, o, i, s; if (t.result && t.result.AcctSchemas) for (r = t.result.AcctSchemas, i = 0; i < r.length; i++)f = {}, c_acctschema_id = r[i].Key, f.Key = c_acctschema_id, f.Name = n.Utility.encodeText(r[i].Name), e.push(f); if (t.result && t.result.OtherAcctSchemas) for (o = t.result.OtherAcctSchemas, i = 0; i < o.length; i++)s = {}, s.Key = o[i].Key, s.Name = n.Utility.encodeText(o[i].Name), e.push(s); u.ASchemas = e; u.ASchema = e[0]; u.onLoaded && u.onLoaded() }, error: function (n) { f.log.info(n); u.onLoaded && u.onLoaded() } }), e }; this.getClientAcctSchema(this.AD_Client_ID, this.AD_Org_ID) } function r(r, u, f, e, o) { function wf() { uf.getControl().text(n.Msg.getMsg("Selection")); wr.getControl().text(n.Msg.translate(n.Env.getCtx(), cr)); li.getControl().text(n.Msg.translate(n.Env.getCtx(), cr)); br.getControl().text(n.Msg.translate(n.Env.getCtx(), yu)); et.find("label").text(n.Msg.getMsg(pu)); gr.getControl().text(n.Msg.translate(n.Env.getCtx(), lr)); nu.getControl().text(n.Msg.translate(n.Env.getCtx(), wi)); kr.getControl().text(n.Msg.translate(n.Env.getCtx(), wu)); dr.getControl().text(n.Msg.translate(n.Env.getCtx(), "AcctDateTo")); tu.getControl().text(n.Msg.translate(n.Env.getCtx(), vr)); iu.getControl().text(n.Msg.translate(n.Env.getCtx(), yr)); ru.getControl().text(n.Msg.translate(n.Env.getCtx(), "Project")); ku.getControl().text(n.Msg.translate(n.Env.getCtx(), pr)); rf.getControl().text(n.Msg.translate(n.Env.getCtx(), "OrganizationUnit")); ff.getControl().text(n.Msg.getMsg("Display")); tr.find("label").text(n.Msg.getMsg("DisplayQty")); ur.find("label").text(n.Msg.getMsg("DisplaySourceInfo")); rr.find("label").text(n.Msg.getMsg("DisplayDocumentInfo")); uu.getControl().text(n.Msg.getMsg("SortBy")); fu.getControl().text(n.Msg.getMsg("GroupBy")); lt.getControl().css("color", "rgba(var(--v-c-primary), 1)"); v.text(n.Msg.getMsg("RePost")); notShowPosted ? (v.hide(), tt.find("label").text(n.Msg.getMsg("Force")), tt.hide()) : (v.show(), tt.find("label").text(n.Msg.getMsg("Force")), tt.show()) } function cu() { hi.css("color", "rgba(var(--v-c-on-secondary), 1)"); si.css("font-size", "1rem").css("color", "rgba(var(--v-c-primary), 1)"); wt.show(); b.show(); ulPaging.css("display", "none"); divPaging.css("display", "none"); ii.css("display", "none"); v.hide(); tt.hide(); it.show(); lt.getControl().show(); ir.hide(); li.getControl().hide(); nt.getControl().hide(); b.find("#btnSelctDoc_" + h).attr("name", b.find("#btnSelctDoc_" + h).parent().find("select").val() + "_ID"); b.find("#btnSelctDocClear_" + h).attr("name", b.find("#btnSelctDocClear_" + h).parent().find("select").val() + "_ID") } function or() { si.css("color", "rgba(var(--v-c-on-secondary), 1)"); hi.css("font-size", "1rem").css("color", "rgba(var(--v-c-primary), 1)"); wt.hide(); b.hide(); ulPaging.css("display", "block"); divPaging.css("display", "block"); ir.show(); it.hide(); lt.getControl().hide(); divPaging.append(ulPaging); at.append(divPaging); ii.css("display", "block"); notShowPosted ? (v.hide(), tt.hide()) : (v.show(), tt.show()); li.getControl().show(); nt.getControl().show() } function bf() { divPaging = t('<div class="vis-info-pagingwrp" style="text-align: right; flex: 1;">'); ulPaging = t('<ul class="vis-statusbar-ul">'); liFirstPage = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" title="' + n.Msg.getMsg("FirstPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); liPrevPage = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.getMsg("PageUp") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); cmbPage = t("<select>"); liCurrPage = t("<li>").append(cmbPage); liNextPage = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.getMsg("PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); liLastPage = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" title="' + n.Msg.getMsg("LastPage") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); ulPaging.append(liFirstPage).append(liPrevPage).append(liCurrPage).append(liNextPage).append(liLastPage); kf() } function kf() { liFirstPage.on("click", function () { t(this).css("opacity") == "1" && (l(!0), s.Query(r, ri, ui, 1)) }); liPrevPage.on("click", function () { t(this).css("opacity") == "1" && (l(!0), s.Query(r, ri, ui, parseInt(cmbPage.val()) - 1)) }); liNextPage.on("click", function () { t(this).css("opacity") == "1" && (l(!0), s.Query(r, ri, ui, parseInt(cmbPage.val()) + 1)) }); liLastPage.on("click", function () { t(this).css("opacity") == "1" && (l(!0), s.Query(r, ri, ui, parseInt(cmbPage.find("Option:last").val()))) }); cmbPage.on("change", function () { l(!0); s.Query(r, ri, ui, cmbPage.val()) }) } function l(n) { hr.css("display", n ? "block" : "none") } function df(i) { var e, s, o, u, f, r, l; for (c.dGrid != null && (c.dGrid.destroy(), c.dGrid = null), c.arrListColumns = [], e = [], s = 1, o = 0; o < i.Data.length; o++) { for (u = i.Data[o], ir.text(i.DebitandCredit), f = {}, r = 0; r < i.Columns.length; r++)c.arrListColumns.length != i.Columns.length && (u[r] != null && typeof u[r] == "number" && (n.translatedTexts.AmtAcctCr == i.Columns[r] || n.translatedTexts.AmtAcctDr == i.Columns[r] || n.translatedTexts.AmtSourceCr == i.Columns[r] || n.translatedTexts.AmtSourceDr == i.Columns[r]) ? c.arrListColumns.push({ field: i.Columns[r], caption: n.Msg.translate(n.Env.getCtx(), i.Columns[r]), sortable: !0, size: "16%", hidden: !1, style: "text-align: right" }) : c.arrListColumns.push({ field: i.Columns[r], caption: n.Msg.translate(n.Env.getCtx(), i.Columns[r]), sortable: !0, size: "16%", hidden: !1 })), u[r] != null && typeof u[r] == "object" ? f[i.Columns[r]] = u[r].Name : u[r] != null && i.Columns[r].indexOf("Date") > 0 ? u[r] != "" && (l = new Date(parseInt(u[r].substr(6))), e != null && (f[i.Columns[r]] = l.toLocaleDateString())) : f[i.Columns[r]] = u[r] != null && typeof u[r] == "number" && (n.translatedTexts.AmtAcctCr == i.Columns[r] || n.translatedTexts.AmtAcctDr == i.Columns[r] || n.translatedTexts.AmtSourceCr == i.Columns[r] || n.translatedTexts.AmtSourceDr == i.Columns[r]) ? parseFloat(u[r]).toLocaleString() : u[r]; f.recid = s; s++; e.push(f) } setTimeout(10); w2utils.encodeTags(e); c.dGrid = t(ii).w2grid({ name: "gridAccViewer" + h, recordHeight: 37, columns: c.arrListColumns, records: e }) } function vt(n) { var i = n.attr("name"), t; return n.find("span").text(" "), s.whereInfo.length > 0 && (t = s.whereInfo.map(function (n) { return n.Key == i }).indexOf(!0), s.whereInfo.splice(t, 1)), n.width = 44, 0 } function gf() { if (si != null) si.on(n.Events.onTouchStartOrClick, function () { cu() }); if (hi != null) hi.on(n.Events.onTouchStartOrClick, function () { c.dGrid.refresh(); or() }); if (yt != null && yt.getControl().change(function () { ef() }), nt != null && nt.getControl().change(function () { l(!0); s.C_AcctSchema_ID = nt.getControl().find("option:selected").val(); setTimeout(function () { s.Query(r, ri, ui, 1) }, 2) }), it != null) it.on("click", function () { l(!0); nt.setValue(yt.getControl().find("option:selected").val()); sr(); l(!1) }); if (et != null && et.change(function () { of() }), pt != null && pt.getControl().change(function () { sf(); s.Record_ID = f; s.AD_Table_ID }), v != null) v.on("click", function () { l(!0); var n = re(); setTimeout(function () { n ? ne(s.Record_ID) : l(!1) }, 5) }); if (a != null) a.on("click", function () { fi(a) }); if (k != null) k.on("click", function () { fi(k) }); if (y != null) y.on("click", function () { fi(y) }); if (p != null) p.on("click", function () { fi(p) }); if (w != null) w.on("click", function () { fi(w) }); if (d != null) d.on("click", function () { fi(d) }); if (g != null) g.on("click", function () { fi(g) }); if (ot != null) ot.on("click", function () { vt(a) }); if (st != null) st.on("click", function () { vt(k) }); if (rt != null) rt.on("click", function () { vt(y) }); if (ut != null) ut.on("click", function () { vt(p) }); if (ft != null) ft.on("click", function () { vt(w) }); if (ht != null) ht.on("click", function () { vt(d) }); if (ct != null) ct.on("click", function () { vt(g) }) } function ne(i) { t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerRePost", type: "POST", async: !0, data: { dataRecID: i }, success: function () { }, error: function (n) { $selfObj.log.info(n); l(!1) } }) } function te() { var u, f; notShowPosted = n.Env.getCtx().getContext("#SHOW_REPOST").equals("N"); fr = t("<div id='topDiv_" + h + "' style='float: left; width: 100%;'><div id='queryDiv_" + h + "'style='display: inline-block; margin-right: 15px; margin-top: 5px' ><label id='lblquery_" + h + "' class='VIS_Pref_Label_Font' style='cursor: pointer;font-size: 1rem;color: rgba(var(--v-c-primary), 1);'>" + n.Msg.getMsg("ViewerQuery") + "<\/label><\/div><div id='resulttopDiv_" + h + "' style='display: inline-block; width: 160px;'><label id='lblresult_" + h + "' class='VIS_Pref_Label_Font' style='vertical-align: middle; cursor: pointer;'>" + n.Msg.getMsg("ViewerResult") + "<\/label><\/div><\/div><\/div>"); var l = t("<div id='resultTopFilterDiv_" + h + "' style='float: right;width: 50%;'>"), d = t('<div class="input-group vis-input-wrap">'), ht = t('<div class="vis-control-wrap">'); l.append(d); d.append(ht); ht.append(nt.getControl()).append(li.getControl()); fr.append(l); b = t("<div class='vis-leftsidebarouterwrap' id='leftSideDiv_" + h + "' style='float: left;background-color: rgba(var(--v-c-secondary), 1);overflow: auto;padding: 10px;'>"); n.Application.isRTL && b.css("float", "right"); b.css("width", "50%"); b.css("height", er); ti = t("<div style='float: left;width: 100%;height: 100%;' id='parameterLeftDiv_" + h + "'>"); b.append(ti); var e = t("<table style='width: 100%;height: 100%;'>"), r = t("<tr>"), i = t("<td>"), u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'); ti.append(e); e.append(r); r.append(i); i.append(u); u.append(f); f.append(yt.getControl()).append(wr.getControl()); r = t("<tr>"); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); f.append(bi.getControl()).append(br.getControl()); r = t("<tr>"); i = t("<td>"); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); e.append(r); r.append(i); i.append(u); u.append(f); f.append(et); r = t("<tr>"); i = t("<td>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'); e.append(r); r.append(i); i.append(u); u.append(f); u.append(o); f.append(pt.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")); o.append(a).append(ot); r = t("<tr>"); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); f.append(ai).append(kr.getControl()); r = t("<tr>"); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); f.append(vi).append(dr.getControl()); r = t("<tr>"); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); f.append(oi.getControl()).append(gr.getControl()); r = t("<tr>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'), s = t('<input type="text" readonly data-hasbtn=" ">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); u.append(o); f.append(s).append(nu.getControl()); o.append(k).append(st); r = t("<tr>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'), s = t('<input type="text" readonly data-hasbtn=" ">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); u.append(o); f.append(s).append(rf.getControl()); o.append(g).append(ct); r = t("<tr>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'), s = t('<input type="text" readonly data-hasbtn=" ">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); u.append(o); f.append(s).append(tu.getControl()); o.append(y).append(rt); r = t("<tr>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'), s = t('<input type="text" readonly data-hasbtn=" ">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); u.append(o); f.append(s).append(iu.getControl()); o.append(p).append(ut); r = t("<tr>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'), s = t('<input type="text" readonly data-hasbtn=" ">'); e.append(r); i = t("<td>"); r.append(i); i.append(u); u.append(f); u.append(o); f.append(s).append(ru.getControl()); o.append(w).append(ft); wt = t("<div id='rightSideDiv_" + h + "' style='float: right;margin-bottom: 3px; margin-right: 0px; '>"); wt.css("width", "50%"); wt.css("height", er); ti = t("<div style='float: left;width: 100%;height: 100%;' id='parameterRightDiv_" + h + "'>"); wt.append(ti); e = t("<table style='width: 100%;height: 100%;'>"); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); ti.append(e); e.append(r); r.append(i); i.append(rr); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(ur); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(tr); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(uu.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); i = t("<td style='padding: 0px 15px 0px;'>"); r.append(i); i.append(fu.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(kt.getControl().css("display", "inline-block").css("width", "100%").css("height", "32px")); i = t("<td style='padding: 0px 15px 0px;'>"); r.append(i); i.append(eu); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(dt.getControl().css("display", "inline-block").css("width", "100%").css("height", "32px")); i = t("<td style='padding: 0px 15px 0px;'>"); r.append(i); i.append(ou); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(gt.getControl().css("display", "inline-block").css("width", "100%").css("height", "32px")); i = t("<td style='padding: 0px 15px 0px;'>"); r.append(i); i.append(su); r = t("<tr>"); i = t("<td style='padding: 0px 15px 0px;'>"); e.append(r); r.append(i); i.append(ni.getControl().css("display", "inline-block").css("width", "100%").css("height", "32px")); i = t("<td style='padding: 0px 15px 0px;'>"); r.append(i); i.append(hu); at = t("<div class='vis-acctviewerbottdiv'>"); c.getIsMenu() || (at.append(v), at.append(tt).append(ir)); at.append(lt.getControl().addClass("VIS_Pref_Label_Font")); at.append(it); at.append(ci); ii = t("<div id='resultDiv_" + h + "' style='float: left; width: 100%; display: none;'>"); ii.css("height", er); bt.append(fr).append(b).append(wt).append(ii).append(at); bt.append(hr) } function ie(t, u) { s = new i(h, r, t); s.onLoaded = function () { pi(yt.getControl(), s.getAcctSchema()); nt.getControl().append("<option value='-1' ><\/option>"); pi(nt.getControl(), s.getAcctSchema()); ef(); pi(pt.getControl(), s.getTable()); pi(bi.getControl(), s.getPostingType()); pi(oi.getControl(), s.getOrg()); a.find("span").text(""); k.attr("Name", wi); st.attr("Name", wi); k.find("span").text(""); y.attr("Name", vr); rt.attr("Name", vr); y.find("span").text(""); p.attr("Name", yr); ut.attr("Name", yr); p.find("span").text(""); w.attr("Name", bu); ft.attr("Name", bu); w.find("span").text(""); d.attr("Name", pr); ht.attr("Name", pr); d.find("span").text(""); g.attr("Name", ar); ct.attr("Name", ar); g.find("span").text(""); var i = t != 0 && u != 0; i && et.find("input").prop("checked", !0); of(); sf(); lt.getControl().text(n.Msg.getMsg("VIS_EnterSelctionAndDisplayToQueryFind")); lt.getControl().css("color", "rgba(var(--v-c-primary), 1)"); i && (s.AD_Table_ID = t, s.Record_ID = u); sr() } } function ef() { var o = yt.getControl().find("option:selected").val(), e, r, t, i, u; if (o != null) { for (s.C_AcctSchema_ID = o, e = s.getAcctSchemaElements(s.C_AcctSchema_ID), kt.getControl().empty(), dt.getControl().empty(), gt.getControl().empty(), ni.getControl().empty(), yi({ Key: "", Name: "" }), yi({ Key: "DateAcct", Name: n.Msg.translate(n.Env.getCtx(), "DateAcct") }), yi({ Key: "DateTrx", Name: n.Msg.translate(n.Env.getCtx(), "DateTrx") }), yi({ Key: "C_Period_ID", Name: n.Msg.translate(n.Env.getCtx(), "C_Period_ID") }), r = [], r.push(du), r.push(gu), r.push(nf), r.push(tf), t = [], t.push(y), t.push(p), t.push(w), t.push(d), t.push(rt), t.push(ut), t.push(ft), t.push(ht), t.push(ki), t.push(di), t.push(gi), t.push(nr), t.push(g), t.push(ct), i = 0, u = 0; u < e.length && i < r.length; u++) { var f = e[u][0], h = s.getColumnName(f.elementtype), c = s.getColumnName(f.elementtype); yi({ Key: h, Name: n.Msg.translate(n.Env.getCtx(), c) }); f.elementtype == "OO" || f.elementtype == "AC" || (r[i].getControl().text(n.Msg.translate(n.Env.getCtx(), c)), r[i].getControl().show(), t[i].attr("Name", h), t[i].find("span").text(""), t[i].show(), i++) } while (i < r.length) r[i].getControl().hide(), i++; kt.getControl().prop("selectedIndex", 0); dt.getControl().prop("selectedIndex", 0); gt.getControl().prop("selectedIndex", 0); ni.getControl().prop("selectedIndex", 0) } } function yi(n) { kt.getControl().append(" <option selected value='" + n.Key + "' >" + n.Name + "<\/option>"); dt.getControl().append(" <option selected value='" + n.Key + "' >" + n.Name + "<\/option>"); gt.getControl().append(" <option selected value='" + n.Key + "' >" + n.Name + "<\/option>"); ni.getControl().append(" <option selected value='" + n.Key + "' >" + n.Name + "<\/option>") } function sr() { var t = "", i, u, f, e; if (s.C_AcctSchema_ID = 0, s.AD_Org_ID = 0, i = yt.getControl().find("option:selected").val(), i != null && (s.C_AcctSchema_ID = i), t = t.concat("C_AcctSchema_ID=").concat(s.C_AcctSchema_ID), i = bi.getControl().find("option:selected").val(), i != null && i != "0" && (s.PostingType = i), t = t.concat(", PostingType=").concat(s.PostingType), s.documentQuery = et.find("input").prop("checked"), t = t.concat(", DocumentQuery=").concat(s.documentQuery), et.find("input").prop("checked")) { if (s.AD_Table_ID == 0 || s.Record_ID == 0) return; t = t.concat(", AD_Table_ID=").concat(s.AD_Table_ID).concat(", Record_ID=").concat(s.Record_ID) } else if (s.DateFrom = ai.val(), s.DateFrom != "" && (t = t.concat(", DateFrom=").concat(s.DateFrom)), s.DateTo = vi.val(), s.DateTo != "" && (t = t.concat(", DateTo=").concat(s.DateTo)), i = oi.getControl().find("option:selected").val(), i != null && (s.AD_Org_ID = i), t = t.concat(", AD_Org_ID=").concat(s.AD_Org_ID), u = s.whereInfo, u != null) for (f = 0; f < u.length; f++)t = t.concat(", ").concat(u[f].Value); s.displayQty = tr.prop("checked"); t = t.concat(", - Display Qty=").concat(s.displayQty); s.displaySourceAmt = ur.prop("checked"); t = t.concat(", Source=").concat(s.displaySourceAmt); s.displayDocumentInfo = rr.prop("checked"); t = t.concat(", Doc=").concat(s.displayDocumentInfo); kt.getControl().find("option:selected").val() != null && (s.sortBy1 = kt.getControl().find("option:selected").val()); s.group1 = eu.prop("checked"); t = t.concat(" - Sorting: ").concat(s.sortBy1).concat("/").concat(s.group1); dt.getControl().find("option:selected").val() != null && (s.sortBy2 = dt.getControl().find("option:selected").val()); s.group2 = ou.prop("checked"); t = t.concat(", ").concat(s.sortBy2).concat("/").concat(s.group2); gt.getControl().find("option:selected").val() != null && (s.sortBy3 = gt.getControl().find("option:selected").val()); s.group3 = su.prop("checked"); t = t.concat(", ").concat(s.sortBy3).concat("/").concat(s.group3); ni.getControl().find("option:selected").val() != null && (s.sortBy4 = ni.getControl().find("option:selected").val()); s.group4 = hu.prop("checked"); t = t.concat(", ").concat(s.sortBy4).concat("/").concat(s.group4); it.Enabled = !1; lt.getControl().text(n.Msg.translate(n.Env.getCtx(), "Processing")); c.getIsMenu() ? vu ? (c.dGrid.refresh(), or()) : cu() : or(); vu = !0; e = 1; s.Query(r, ri, ui, e); s.C_AcctSchema_ID > 0 && nt.setValue(s.C_AcctSchema_ID); it.Enabled = !0; lt.getControl().text(n.Msg.getMsg("VIS_EnterSelctionAndDisplayToQueryFind")) } function ri(n) { n != null && df(n); l(!1) } function ui(n) { if (cmbPage.empty(), n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)cmbPage.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); cmbPage.val(n.CurrentPage); n.TotalPage > n.CurrentPage ? (liNextPage.css("opacity", "1"), liLastPage.css("opacity", "1")) : (liNextPage.css("opacity", "0.6"), liLastPage.css("opacity", "0.6")); n.CurrentPage > 1 ? (liFirstPage.css("opacity", "1"), liPrevPage.css("opacity", "1")) : (liFirstPage.css("opacity", "0.6"), liPrevPage.css("opacity", "0.6")); n.TotalPage == 1 && (liFirstPage.css("opacity", "0.6"), liPrevPage.css("opacity", "0.6"), liNextPage.css("opacity", "0.6"), liLastPage.css("opacity", "0.6")) } else liFirstPage.css("opacity", "0.6"), liPrevPage.css("opacity", "0.6"), liNextPage.css("opacity", "0.6"), liLastPage.css("opacity", "0.6") } function of() { var n = et.find("input").prop("checked"); n ? (pt.getControl().removeAttr("disabled"), a.removeAttr("disabled"), ot.removeAttr("disabled"), ai.attr("disabled", "disabled"), vi.attr("disabled", "disabled"), oi.getControl().attr("disabled", "disabled"), k.attr("disabled", "disabled"), y.attr("disabled", "disabled"), p.attr("disabled", "disabled"), w.attr("disabled", "disabled"), d.attr("disabled", "disabled"), g.attr("disabled", "disabled"), st.attr("disabled", "disabled"), rt.attr("disabled", "disabled"), ut.attr("disabled", "disabled"), ft.attr("disabled", "disabled"), ht.attr("disabled", "disabled"), ct.attr("disabled", "disabled"), ki.attr("disabled", "disabled"), di.attr("disabled", "disabled"), gi.attr("disabled", "disabled"), nr.attr("disabled", "disabled")) : (pt.getControl().attr("disabled", "disabled"), a.attr("disabled", "disabled"), ot.attr("disabled", "disabled"), ai.removeAttr("disabled"), vi.removeAttr("disabled"), oi.getControl().removeAttr("disabled"), k.removeAttr("disabled"), y.removeAttr("disabled"), p.removeAttr("disabled"), w.removeAttr("disabled"), d.removeAttr("disabled"), g.removeAttr("disabled"), st.removeAttr("disabled"), rt.removeAttr("disabled"), ut.removeAttr("disabled"), ft.removeAttr("disabled"), ht.removeAttr("disabled"), ct.removeAttr("disabled"), ki.removeAttr("disabled"), di.removeAttr("disabled"), gi.removeAttr("disabled"), nr.removeAttr("disabled")) } function sf() { var n = pt.getControl().find("option:selected").val(); n != null && jQuery.grep(s.tableInfo, function (t) { return t.Name == n })[0] != null && (s.AD_Table_ID = jQuery.grep(s.tableInfo, function (t) { return t.Name == n })[0].Key); a.find("span").text(""); a.attr("Name", n + "_ID"); ot.attr("Name", n + "_ID") } function fi(t) { var r, o, f; s.HasOrgUnit == null && fe(); var u = t.attr("name"), e = "IsSummary='N'", i = u; u.equals("Account_ID") ? (i = "C_ElementValue_ID", r = s.getAcctSchemaElement("AC"), r != null && (e += " AND C_Element_ID=" + r.c_element_id)) : u.equals("User1_ID") ? (i = "C_ElementValue_ID", r = s.getAcctSchemaElement("U1"), r != null && (e += " AND C_Element_ID=" + r.c_element_id)) : u.equals("User2_ID") ? (i = "C_ElementValue_ID", r = s.getAcctSchemaElement("U2"), r != null && (e += " AND C_Element_ID=" + r.c_element_id)) : et.find("input").prop("checked") && (e = ""); o = i.substring(0, i.length - 3); u == "M_Product_ID" ? f = new n.InfoWindow(101, "", s.windowNo, "", !1) : u == "C_BPartner_ID" ? f = new n.InfoWindow(100, "", s.windowNo, "", !1) : u == ar ? (i = lr, o = i.substring(0, i.length - 3), s.HasOrgUnit && (e += " AND (IsCostCenter='Y' OR IsProfitCenter='Y')"), f = new n.infoGeneral(!0, s.windowNo, "", o, i, !1, e)) : f = new n.infoGeneral(!0, s.windowNo, "", o, i, !1, e); f.onClose = function () { var r = null, n = f.getSelectedValues(); return (n != null && n.length > 0 && (r = i + "=" + n.toString()), f = null, r == null || r.length == 0 || n.length == 0) ? (vt(t), 0) : (t == a ? s.Record_ID = n : (vt(t), s.whereInfo.push({ Key: u, Value: u + "=" + n })), t.find("span").text(s.getButtonText(o, i, r)), t.find("span").text() != "" ? t.AutoSize = !0 : t.Width = 44, n) }; f.show() } function re() { if (n.ADialog.ask("PostImmediate?")) { if (s.documentQuery && s.AD_Table_ID != 0 && s.Record_ID != 0) { var i = tt.prop("checked"); ue(function (r) { var u = !1, f, e; r == "Yes" && (u = !0); window.FRPT && u ? (f = Number(n.context.getWindowTabContext(h, 0, "AD_Org_ID")), e = Number(n.context.getWindowTabContext(h, 0, "C_DocType_ID")), t.ajax({ url: n.Application.contextUrl + "FRPT/PostingLogicFRPT/PostImediateFRPT", dataType: "json", async: !0, data: { AD_Client_ID: s.AD_Client_ID, AD_Table_ID: s.AD_Table_ID, Record_ID: s.Record_ID, force: i, OrgID: f, AD_Window_ID: cf, DocTypeID: e }, error: function () { l(!1); n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer")) }, success: function (n) { n.result && sr() } })) : t.ajax({ url: n.Application.contextUrl + "Posting/PostImmediate", dataType: "json", data: { AD_Client_ID: s.AD_Client_ID, AD_Table_ID: s.AD_Table_ID, Record_ID: s.Record_ID, force: i }, error: function () { l(!1); n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer")) }, success: function (n) { n.result == "OK" && sr() } }) }) } return !0 } return l(!1), !1 } function ue(i) { t.ajax({ url: n.Application.contextUrl + "Posting/PostByNewLogic", dataType: "json", async: !0, data: { AD_Client_ID: n.context.getAD_Client_ID() }, error: function () { alert(n.Msg.getMsg("ERRORGettingPostingServer")) }, success: function (n) { i && i(n.result) } }) } function fe() { t.ajax({ url: n.Application.contextUrl + "AcctViewerData/HasOrganizationUnit", dataType: "json", async: !1, error: function () { alert(n.Msg.getMsg("ERROR")) }, success: function (n) { n != null && (s.HasOrgUnit = n.result) } }) } function pi(t, i) { for (var r = 0; r < i.length; r++)t.append(" <option selected value='" + i[r].Key + "' >" + n.Utility.decodeText(i[r].Name) + "<\/option>"); t.prop("selectedIndex", 0) } var bt = t("<div style='position:relative;'>"), hr = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), c = this, hf = r, lu = u, au = f, h = e, cf = o; this.arrListColumns = []; this.dGrid = null; this.menuForm = !1; var vu = !1, cr = "C_AcctSchema_ID", lf = "DocumentType", yu = "PostingType", lr = "AD_Org_ID", ar = "AD_OrgTrx_ID", wi = "Account_ID", pu = "SelectDocument", wu = "AcctDateFrom", vr = "M_Product_ID", yr = "C_BPartner_ID", bu = "C_Project_ID", pr = "C_Campaign_ID", ei = n.Application.contextUrl + "Areas/VIS/Images/base/Find24.gif", ee = n.Application.contextUrl + "Areas/VIS/Images/cancel-18.png", af = n.Application.contextUrl + "Areas/VIS/Images/base/Refresh24.png", vf = n.Application.contextUrl + "Areas/VIS/Images/base/Print24.PNG", it = t("<button id='btnRefresh_" + h + "'style='margin-top: 0;' class='VIS_Pref_btn-2'><i class='vis vis-refresh'><\/i><\/button>"), ci = t("<button class='VIS_Pref_btn-2' id='btnPrint_" + h + "' style='margin-top: 0px; margin-left: 10px;'><i class='vis vis-print'><\/button>"), v = t("<button class='VIS_Pref_btn-2' id='btnRePost_" + h + "' style='margin-top: 10px;'><img src='" + ei + "'/><\/button>"), a = t("<button class='input-group-text' Name='btnSelctDoc' id='btnSelctDoc_" + h + "'><i class='vis vis-find'><\/i><\/button>"), k = t("<button class='input-group-text' Name='btnAccount' id='btnAccount_" + h + "'><i class='vis vis-find'><\/i><\/button>"), y = t("<button class='input-group-text' Name='btnProduct' id='btnProduct_" + h + "'><i class='vis vis-find'><\/i><\/button>"), p = t("<button class='input-group-text' Name='btnBPartner' id='btnBPartner_" + h + "'><i class='vis vis-find'><\/i><\/button>"), w = t("<button class='input-group-text'Name='btnProject' id='btnProject_" + h + "'><i class='vis vis-find'><\/i><\/button>"), d = t("<button class='input-group-text' Name='btnCampaning' id='btnCampaning_" + h + "'><i class='vis vis-find'><\/i><\/button>"), g = t("<button class='input-group-text' Name='btnOrgUnit' id='btnOrgUnit_" + h + "'><i class='vis vis-find'><\/i><\/button>"), ot = t("<button Name='btnSelctDocClear' id='btnSelctDocClear_" + h + "' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), st = t("<button  Name='btnAccountClear' id='btnAccountClear_" + h + "'   class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), rt = t("<button  Name='btnProductClear' id='btnProductClear_" + h + "'   class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), ut = t("<button Name='btnBPartnerClear' id='btnBPartnerClear_" + h + "' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), ft = t("<button  Name='btnProjectClear' id='btnProjectClear_" + h + "'   class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), ht = t("<button Name='btnCampaningClear' id='btnCampaningClear_" + h + "' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), ct = t("<button Name='btnOrgUnitClear' id='btnOrgUnitClear_" + h + "' class='input-group-text'><i class='vis vis-mark'><\/i><\/button>"), yt = new n.Controls.VComboBox("", !1, !1, !0), nt = new n.Controls.VComboBox("", !1, !1, !0), bi = new n.Controls.VComboBox("", !1, !1, !0), oi = new n.Controls.VComboBox("", !1, !1, !0), pt = new n.Controls.VComboBox("", !1, !1, !0), kt = new n.Controls.VComboBox("", !1, !1, !0), dt = new n.Controls.VComboBox("", !1, !1, !0), gt = new n.Controls.VComboBox("", !1, !1, !0), ni = new n.Controls.VComboBox("", !1, !1, !0), wr = new n.Controls.VLabel, li = new n.Controls.VLabel, br = new n.Controls.VLabel, kr = new n.Controls.VLabel, dr = new n.Controls.VLabel, gr = new n.Controls.VLabel, nu = new n.Controls.VLabel, tu = new n.Controls.VLabel, iu = new n.Controls.VLabel, ru = new n.Controls.VLabel, ku = new n.Controls.VLabel, uu = new n.Controls.VLabel, fu = new n.Controls.VLabel, du = new n.Controls.VLabel, gu = new n.Controls.VLabel, nf = new n.Controls.VLabel, tf = new n.Controls.VLabel, rf = new n.Controls.VLabel, ki = t("<button id='btnSel5_" + h + "' style='border: 0px;background-color: transparent; padding: 0px;'><img src='" + ei + "' /><span><\/span><\/button>"), di = t("<button id='btnSel6_" + h + "' style='border: 0px;background-color: transparent; padding: 0px;'><img src='" + ei + "' /><span><\/span><\/button>"), gi = t("<button id='btnSel7_" + h + "' style='border: 0px;background-color: transparent; padding: 0px;'><img src='" + ei + "' /><span><\/span><\/button>"), nr = t("<button id='btnSel8_" + h + "' style='border: 0px;background-color: transparent; padding: 0px;'><img src='" + ei + "' /><span><\/span><\/button>"), lt = new n.Controls.VLabel, uf = new n.Controls.VLabel, ff = new n.Controls.VLabel, si = null, hi = null, et = t("<label id='lblSelectDoc_" + h + "' class='VIS_Pref_Label_Font vis-ec-col-lblchkbox'><input id='chkSelectDoc_" + h + "' type='checkbox' checked class='VIS_Pref_automatic'>SelectDoc<\/label>"), tr = t("<input id='chkQty_" + h + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblQty_" + h + "' class='VIS_Pref_Label_Font'>chkQty<\/label><\/span>"), tt = t("<input id='chkforcePost_" + h + "' type='checkbox' class='VIS_Pref_automatic' style='display: inline-block;margin-left: 20px; margin-top: 0;'><span><label id='lblforcePost_" + h + "' class='VIS_Pref_Label_Font'>chkforcePost<\/label><\/span>"), ir = t("<span style='margin-left: 20px;'><label id='lblDrAndCR_" + h + "' class='VIS_Pref_Label_Font'><\/label><\/span>"), rr = t("<input id='chkDisDocinfo_" + h + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblDisDocinfo_" + h + "' class='VIS_Pref_Label_Font'>chkDisDocinfo<\/label><\/span>"), ur = t("<input id='chkDisSouce_" + h + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblDisSouce_" + h + "' class='VIS_Pref_Label_Font'>chkDisSouce<\/label><\/span>"), eu = t("<input id='chkSumriz1_" + h + "' type='checkbox' class='VIS_Pref_automatic'>"), ou = t("<input id='chkSumriz2_" + h + "' type='checkbox' class='VIS_Pref_automatic'>"), su = t("<input id='chkSumriz3_" + h + "' type='checkbox' class='VIS_Pref_automatic'>"), hu = t("<input id='chkSumriz4_" + h + "' type='checkbox' class='VIS_Pref_automatic'>"), ai = t("<input id='vdtpkAccDateFrom_" + h + "' type='date' name='DateOrdered'>"), vi = t("<input id='vdtpkAccDateTo_" + h + "' type='date' name='DateOrdered'>"), fr = null, b = null, wt = null, ti = null, at = null, ii = null, yf = t(window).width() / 2, pf = t(window).width() / 2, er = t(window).height() - 200, s = null; bf(); this.showDialog = function () { te(); l(!0); si = bt.find("#lblquery_" + h); hi = bt.find("#lblresult_" + h); c.getIsMenu() ? cu() : or(); v.hide(); tt.hide(); ci.hide(); wf(); gf(); ie(lu, au); bt.dialog({ modal: !0, resizable: !1, title: n.Msg.getMsg("AcctViewer"), width: t(window).width() / 2 + t(window).width() / 4, position: { at: "center top", of: window }, close: function () { c.dGrid != null && (c.dGrid.destroy(), c.dGrid = null); c.dispose(); c = null; bt.dialog("destroy"); bt = null } }) }; this.disposeComponent = function () { it && it.off("click"); ci && ci.off("click"); v && v.off("click"); a && a.off("click"); k && k.off("click"); y && y.off("click"); p && p.off("click"); w && w.off("click"); d && d.off("click"); ot && ot.off("click"); st && st.off("click"); rt && rt.off("click"); ut && ut.off("click"); ft && ft.off("click"); ht && ht.off("click"); ct && ct.off("click"); g && g.off("click"); hf = null; lu = null; au = null; h = null; this.arrListColumns = null; this.dGrid = null; cr = null; lf = null; yu = null; lr = null; wi = null; pu = null; wu = null; ei = null; af = null; vf = null; it = null; ci = null; v = null; a = null; k = null; y = null; p = null; w = null; d = null; ot = null; st = null; rt = null; ut = null; ft = null; ht = null; yt = null; nt = null; bi = null; oi = null; pt = null; kt = null; dt = null; gt = null; ni = null; wr = null; li = null; br = null; kr = null; dr = null; gr = null; nu = null; tu = null; iu = null; ru = null; ku = null; uu = null; fu = null; du = null; gu = null; nf = null; tf = null; ki = null; di = null; gi = null; nr = null; lt = null; uf = null; ff = null; si = null; hi = null; et = null; tr = null; tt = null; rr = null; ur = null; eu = null; ou = null; su = null; hu = null; ai = null; vi = null; fr = null; b = null; wt = null; ti = null; at = null; ii = null; yf = null; pf = null; er = null; s = null; hr = null; this.disposeComponent = null } } i.prototype.getAcctSchema = function () { return this.ASchemas }; i.prototype.getTable = function () { var i = [], r = null, u = this; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerGetTabelData", type: "POST", async: !1, success: function (t) { var o, f; if ((this.tableInfo == undefined || this.tableInfo == null) && (this.tableInfo = []), t.result) for (i.push({ Key: "", Name: "" }), o = t.result, f = 0; f < o.length; f++) { var s = o[f].AD_Table_ID, e = n.Utility.encodeText(o[f].TableName), h = ""; h = e == "C_Order" ? n.Msg.getMsg("Order") : n.Msg.translate(n.Env.getCtx(), e + "_ID"); i.push({ Key: e, Name: h }); u.tableInfo.push({ Key: s, Name: e }); s == this.AD_Table_ID && (r = e) } }, error: function (n) { $selfObj.log.info(n) } }), i }; i.prototype.getOrg = function () { var i = [], r = this.AD_Client_ID; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerGetOrgData", type: "POST", async: !1, data: { client_id: r }, success: function (t) { var u = t.result, r; if (u) for (i.push({ Key: 0, Name: "" }), r = 0; r < u.length; r++)i.push({ Key: u[r].AD_Org_ID, Name: n.Utility.encodeText(u[r].OrgName) }) }, error: function (n) { $selfObj.log.info(n) } }), i }; i.prototype.getPostingType = function () { var i = []; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerGetPostingType", type: "POST", async: !1, data: { reference_id: 125 }, success: function (t) { var u = t.result, r; if (u) for (i.push({ Key: 0, Name: "" }), r = 0; r < u.length; r++)i.push({ Key: u[r].PostingValue, Name: n.Utility.encodeText(u[r].PostingName) }) }, error: function (n) { $selfObj.log.info(n) } }), i }; i.prototype.getAcctSchemaElements = function (i) { this._elements = []; var r = this._elements; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerGetAcctSchElements", type: "POST", async: !0, data: { keys: i }, success: function (t) { var u = t.result, i, f; if (u) for (i = 0; i < u.length; i++)f = [], f.push({ c_acctschema_element_id: u[i].C_AcctSchema_Element_ID, name: n.Utility.encodeText(u[i].ElementName), elementtype: u[i].ElementType, c_elementvalue_id: u[i].C_ElementValue_ID, seqno: u[i].SeqNo, detail: u[i].Detail, c_element_id: u[i].C_Element_ID }), r.push(f) }, error: function (n) { $selfObj.log.info(n) } }), r }; i.prototype.getAcctSchemaElement = function (n) { var t, i; for (this._elements == null && this.getAcctSchemaElements(), t = 0; t < this._elements.length; t++)if (i = this._elements[t][0], i.elementtype.equals(n)) return i; return null }; i.prototype.getColumnName = function (n) { return n.equals(this.ELEMENTTYPE_Organization) ? "AD_Org_ID" : n.equals(this.ELEMENTTYPE_Account) ? "Account_ID" : n.equals(this.ELEMENTTYPE_BPartner) ? "C_BPartner_ID" : n.equals(this.ELEMENTTYPE_Product) ? "M_Product_ID" : n.equals(this.ELEMENTTYPE_Activity) ? "C_Activity_ID" : n.equals(this.ELEMENTTYPE_LocationFrom) ? "C_LocFrom_ID" : n.equals(this.ELEMENTTYPE_LocationTo) ? "C_LocTo_ID" : n.equals(this.ELEMENTTYPE_Campaign) ? "C_Campaign_ID" : n.equals(this.ELEMENTTYPE_OrgTrx) ? "AD_OrgTrx_ID" : n.equals(this.ELEMENTTYPE_Project) ? "C_Project_ID" : n.equals(this.ELEMENTTYPE_SalesRegion) ? "C_SalesRegion_ID" : n.equals(this.ELEMENTTYPE_UserList1) ? "User1_ID" : n.equals(this.ELEMENTTYPE_UserList2) ? "User2_ID" : n.equals(this.ELEMENTTYPE_UserElement1) ? "UserElement1_ID" : n.equals(this.ELEMENTTYPE_UserElement2) ? "UserElement2_ID" : "" }; i.prototype.getButtonText = function (i, r, u) { var e = n.Env.getAD_Language(n.Env.getCtx()), o = n.MLookupFactory.getLookup_TableDirEmbed(e, r, "avd", r), f = "<" + u + ">"; return t.ajax({ url: n.Application.contextUrl + "AcctViewerData/AcctViewerGetButtonText", type: "POST", async: !1, data: { lookupDirEmbeded: o, tName: i, wheres: " avd WHERE avd.", selectSQLs: u }, success: function (n) { var t = n.result; t != "" && (f = t) }, error: function (n) { $selfObj.log.info(n) } }), f }; i.prototype.Query = function (t, i, r, u) { var f = "", o, s, h, e; if (this.C_AcctSchema_ID != 0 && (f = f.concat(this.TABLE_ALIAS).concat(".C_AcctSchema_ID=").concat(this.C_AcctSchema_ID)), this.PostingType != null && this.PostingType.length > 0 && (f.length > 0 && (f = f.concat(" AND ")), f = f.concat(this.TABLE_ALIAS).concat(".PostingType='").concat(this.PostingType).concat("'")), this.documentQuery) f.length > 0 && (f = f.concat(" AND ")), f = f.concat(this.TABLE_ALIAS).concat(".AD_Table_ID=").concat(this.AD_Table_ID).concat(" AND ").concat(this.TABLE_ALIAS).concat(".Record_ID=").concat(this.Record_ID); else { if (o = this.whereInfo, o != null) for (s = 0; s < o.length; s++)h = o[s].Value, h != null && h.length > 0 && (f.length > 0 && (f = f.concat(" AND ")), f = f.concat(this.TABLE_ALIAS).concat(".").concat(h)); (!this.DateFrom != null || this.DateTo != null) && (f.length > 0 && (this.DateFrom != "" || this.DateTo != "") && (f = f.concat(" AND ")), this.DateFrom != "" && this.DateTo != "" ? f = f.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') BETWEEN ").concat(n.DB.to_date(this.DateFrom)).concat(" AND ").concat(n.DB.to_date(this.DateTo)) : this.DateFrom != "" ? f = f.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') >= ").concat(n.DB.to_date(this.DateFrom)) : this.DateTo != "" && (f = f.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') <= ").concat(n.DB.to_date(this.DateTo)))); this.AD_Org_ID != 0 && (f.length > 0 && (f = f.concat(" AND ")), f = f.concat(this.TABLE_ALIAS).concat(".AD_Org_ID=").concat(this.AD_Org_ID)) } e = ""; this.sortBy1.length > 0 && (e = e.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy1)); this.sortBy2.length > 0 && (e.length > 0 && (e = e.concat(",")), e = e.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy2)); this.sortBy3.length > 0 && (e.length > 0 && (e = e.concat(",")), e = e.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy3)); this.sortBy4.length > 0 && (e.length > 0 && (e = e.concat(",")), e = e.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy4)); e.length == 0 && (e = e.concat(this.TABLE_ALIAS).concat(".Fact_Acct_ID")); u || (u = 1); this.getDataModel(t, f, e, this.group1, this.group2, this.group3, this.group4, this.sortBy1, this.sortBy2, this.sortBy3, this.sortBy4, this.displayDocumentInfo, this.displaySourceAmt, this.displayQty, i, r, u) }; i.prototype.getDataModel = function (i, r, u, f, e, o, s, h, c, l, a, v, y, p, w, b, k) { var d = this; t.ajax({ url: n.Application.contextUrl + "Common/GetDataQuery", async: !0, dataType: "json", type: "POST", data: { AD_Client_ID: i, whereClause: r, orderClause: u, gr1: f, gr2: e, gr3: o, gr4: s, sort1: h, sort2: c, sort3: l, sort4: a, displayDocInfo: v, displaySrcAmt: y, displayqty: p, pageNo: k }, success: function (n) { d.dataByData = n.result; b(n.result.pSetting); w(n.result) } }) }; r.prototype.dispose = function () { this.disposeComponent() }; r.prototype.setIsMenu = function (n) { n != null && n != undefined && (this.menuForm = n) }; r.prototype.getIsMenu = function () { return this.menuForm }; n.AcctViewer = r }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { n.AcctViewerMenu = function () { function e() { r.on("click", function () { i.frame.dispose() }) } this.frame; this.windowNo; var f, i = this, r = "", u = t("<div>"); this.initalize = function () { u.append('<a id="VIS_btnResult_' + i.windowNo + '">button<\/a>'); r = u.find("#VIS_btnResult_" + i.windowNo); e() }; this.openAccountViewer = function () { var t = new n.AcctViewer(n.context.getAD_Client_ID(), 1, 1, this.windowNo, 1); t != null && (t.setIsMenu(!0), t.showDialog()); r.trigger("click") }; this.getRoot = function () { return u } }; n.AcctViewerMenu.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.initalize(); this.openAccountViewer(); this.frame.getContentGrid().append(this.getRoot()) }; n.AcctViewerMenu.prototype.dispose = function () { this.disposeComponent(); this.frame = null } }(VIS, jQuery), function (n, t) { function i() { function g() { var rt = "topDiv_" + i.windowNo, p = "btnSpaceDiv_" + i.windowNo, ut = "btnSpace_" + i.windowNo, ft = "spnSelect_" + i.windowNo, et = "spnGenerate_" + i.windowNo, w = "lblGenerate_" + i.windowNo, b = "lblSelect_" + i.windowNo, k, d, u, f, g, nt, tt, a, it, v, y; o = t('<div class="input-group-append"><button id = "btnClearBP_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" tabindex="-1" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button><\/div>'); s = t('<div class="input-group-append"><button id = "btnClearOrd_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" tabindex="-1" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button><\/div>'); i.topDiv = t("<div id='" + rt + "' class='vis-archive-l-s-head vis-frm-ls-top' style='padding: 0;'><div id='" + p + "' class='vis-l-s-headwrp'><button id='" + ut + "'  class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><div id='" + ft + "'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='" + b + "' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 28px;color: rgba(var(--v-c-primary), 1);'>" + n.Msg.translate(n.Env.getCtx(), "Select") + "<\/label><\/div><div id='" + et + "' style='display: inline-block; width: 160px;'><label id='" + w + "' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 17px;'>" + n.Msg.translate(n.Env.getCtx(), "Generate") + "<\/label><\/div><\/div>"); k = "sideDiv_" + i.windowNo; d = "parameterDiv_" + i.windowNo; i.btnSpaceDiv = i.topDiv.find("#" + p); this.lblGenrate = i.topDiv.find("#" + w); this.lblSelect = i.topDiv.find("#" + b); i.sideDiv = t("<div id='" + k + "' class='vis-archive-l-s-content vis-leftsidebarouterwrap'>"); i.sideDiv.css("width", r); i.sideDiv.css("height", "calc(100% - 103px)"); i.div = t("<div class='vis-archive-l-s-content-inner' id='" + d + "'>"); i.sideDiv.append(i.div); var l = t("<table style='width: 100%;'>"), e = t("<tr>"), h = t("<td style='padding: 10px 10px 0px;'>"); i.div.append(l); u = t('<div class="input-group vis-input-wrap">'); f = t('<div class="vis-control-wrap">'); l.append(e); e.append(h); h.append(u); u.append(f); f.append(i.cmbWarehouse.getControl()); f.append(i.lblWarehouse.getControl().addClass("VIS_Pref_Label_Font")); e = t("<tr>"); h = t("<td style='padding: 0px 10px 0px;'>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), c = t('<div class="input-group-append">'); l.append(e); e.append(h); h.append(u); u.append(f); f.append(i.vSearchBPartner.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); f.append(i.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")); u.append(c); c.append(i.vSearchBPartner.getBtn(0)); u.append(o); g = n.Msg.translate(n.Env.getCtx(), "SalesOrder_No"); e = t("<tr>"); h = t("<td style='padding: 0px 10px 0px;'>"); var u = t('<div class="input-group vis-input-wrap">'), f = t('<div class="vis-control-wrap">'), c = t('<div class="input-group-append">'); l.append(e); e.append(h); h.append(u); u.append(f); f.append(i.vSearchOrder.getControl(0).attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); f.append("<label>" + g + "<\/label>"); u.append(c); c.append(i.vSearchOrder.getBtn(0)); u.append(s); nt = "gridSelectDiv_" + i.windowNo; tt = "gridGenerateDiv_" + i.windowNo; i.gridSelectDiv = t("<div id='" + nt + "' class='vis-frm-grid-outerwrp'>"); i.gridGenerateDiv = t("<div id='" + tt + "' style='height: 85%; float: right; display: none; background-color: rgba(var(--v-c-secondary), .8); margin-left: 15px;margin-right: 15px;'>"); i.gridGenerateDiv.css("width", t(window).width() - 30); a = "btnOk_" + i.windowNo; i.okBtn = t("<input id='" + a + "' class='VIS_Pref_btn-2' style='margin-top: 0px;width: 70px;height: 38px;' type='button' value='Ok'>"); a = "btnRefresh_" + i.windowNo; i.btnRefresh = t("<button id='" + a + "' style='margin-top: 0px;' class='VIS_Pref_btn-2'><i class='vis vis-refresh'><\/i><\/button>"); it = "discriptionDiv_" + i.windowNo; i.bottumDiv = t("<div class='vis-info-btmcnt-wrap vis-p-t-10'>"); v = t("<div id='" + it + "' style='flex: 1;padding: 0 10px;'>"); v.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font")); y = t("<div>"); y.append(i.okBtn); i.bottumDiv.append(i.btnRefresh).append(v).append(y); i.$root.append(i.$busyDiv); i.$busyDiv[0].style.visibility = "hidden"; i.$root.append(i.topDiv).append(i.sideDiv).append(i.gridSelectDiv).append(i.gridGenerateDiv).append(i.bottumDiv) } function nt() { i.lblWarehouse.getControl().text(n.Msg.translate(n.Env.getCtx(), "M_Warehouse_ID")); i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); i.tabSelect.getControl().text(n.Msg.getMsg("Select", !1, !1)); i.tabGenrate.getControl().text(n.Msg.getMsg("Generate", !1, !1)); i.lblStatusInfo.getControl().text(n.Msg.getMsg("VIS_OrderGenShip", !1, !1)) } function tt() { var u = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 2223, n.DisplayType.TableDir, "M_Warehouse_ID", 0, !1, "M_Warehouse.IsActive='Y'"), t, r; i.cmbWarehouse = new n.Controls.VComboBox("M_Warehouse_ID", !0, !1, !0, u, 150, n.DisplayType.TableDir, 0); t = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 2762, n.DisplayType.Search, "C_BPartner_ID", 0, !1, "C_BPartner.IsActive ='Y' And C_Bpartner.Issummary ='N'"); i.vSearchBPartner = new n.Controls.VTextBoxButton("C_BPartner_ID", !0, !1, !0, n.DisplayType.Search, t); r = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 2161, n.DisplayType.Search, "C_Order_ID", 0, !1, "DocStatus='CO'"); i.vSearchOrder = new n.Controls.VTextBoxButton("C_Order_ID", !0, !1, !0, n.DisplayType.Search, r) } function p(r) { i.dGrid != null && (i.dGrid.destroy(), i.dGrid = null); i.arrListColumns.length == 0 && (i.arrListColumns.push({ field: "AD_Org_ID", caption: n.Msg.translate(n.Env.getCtx(), "AD_Org_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "C_DocType_ID", caption: n.Msg.translate(n.Env.getCtx(), "C_DocType_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "DocumentNo", caption: n.Msg.getElement(n.Env.getCtx(), "DocumentNo"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "C_BPartner_ID", caption: n.Msg.getElement(n.Env.getCtx(), "C_BPartner_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "DateOrdered", caption: n.Msg.getElement(n.Env.getCtx(), "DateOrdered"), sortable: !0, size: "16%", min: 150, hidden: !1, render: function (n) { var t; return t = n.changes == undefined || n.changes.DateOrdered == undefined ? n.DateOrdered : n.changes.DateOrdered, new Date(t).toLocaleDateString() } }), i.arrListColumns.push({ field: "C_Order_ID", caption: n.Msg.translate(n.Env.getCtx(), "C_UOM_ID"), sortable: !0, size: "150px", hidden: !0 })); setTimeout(10); w2utils.encodeTags(r); i.dGrid = t(i.gridSelectDiv).w2grid({ name: "gridGenShipForm" + i.windowNo, recordHeight: 40, show: { selectColumn: !0 }, multiSelect: !0, columns: i.arrListColumns, records: r }) } function y() { var r = [], s = n.Env.getCtx().getAD_Client_ID(), u = "", f = "", o = ""; e != null && e.toString() != "-1" && (u = " AND ic.M_Warehouse_ID=" + e); l != null && (f = " AND ic.C_BPartner_ID=" + l); v != null && (o = " AND C_Order_ID=" + v); t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "VCreateFrom/ExecuteQueryVinoutgen", type: "POST", data: { adClientID: s, mWarehouseIDs: u, cBPartnerIDs: f, cOrderIDSearchs: o }, success: function (u) { var f = JSON.parse(u), s, e, o; if (f && f.length > 0) try { for (s = 1, e = 0; e < f.length; e++)o = {}, o.C_Order_ID = f[e].c_order_id, o.AD_Org_ID = f[e].ord, o.C_DocType_ID = f[e].doctype, o.DocumentNo = n.Utility.encodeText(f[e].documentno), o.C_BPartner_ID = f[e].bpname, o.DateOrdered = f[e].dateordered, o.recid = s, s++, r.push(o) } catch (h) { } else n.ADialog.info("NoDataFound"), i.okBtn.attr("disabled", "disabled"); p(r); t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "hidden" }, error: function () { t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "hidden" } }) } function it() { var r, u, f, e, t, n; if (i.dGrid == null) return !1; if ((r = [], u = i.dGrid.getSelection(), u != null) && !(u.length <= 0)) { for (f = u.toString().split(","), n = 0; n < f.length; n++)r[n] = i.dGrid.get(f[n]).C_Order_ID; if (r.length == 0) return ""; for (e = "C_Order_ID", t = e, t = r.length > 1 ? t.concat(" IN (") : t.concat("="), n = 0; n < r.length; n++)n > 0 && (t = t.concat(",")), t = e.endsWith("_ID") ? t.concat(r[n].toString()) : t.concat("'").concat(r[n].toString()); return r.length > 1 && (t = t.concat(")")), t.toString() } } function rt(r) { var u = i; i.$busyDiv[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Common/GenerateShipments", dataType: "json", data: { whereClause: r, M_Warehouse_ID: e }, success: function (r) { r.DocumentText != null && (ut(!0), u.gridGenerateDiv.html(r.DocumentText), u.lblStatusInfo.getControl().text(r.lblStatusInfo)); r.ErrorMsg != null && n.ADialog.info("", null, r.ErrorMsg, null); u.$busyDiv[0].style.visibility = "hidden"; t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv") }, error: function () { u.$busyDiv[0].style.visibility = "hidden"; t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv") } }) } function ut(n) { n && (i.btnRefresh.hide(), i.okBtn.hide(), i.btnToggel.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), n = !1, i.gridSelectDiv.animate({ width: f }, "fast"), i.sideDiv.animate({ width: "toggle", height: "toggle" }, "slow")); i.gridSelectDiv.css("display", "none"); i.sideDiv.css("display", "none"); i.gridGenerateDiv.css("display", "block"); i.btnToggel.hide(); lblSelect.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary), 1)"); lblGenrate.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)") } var i; this.frame; this.windowNo; i = this; this.arrListColumns = []; this.dGrid = null; var c = null, e = null, l = null, w = !1, b = !1, u = !1, v = null; this.lblWarehouse = new n.Controls.VLabel; this.lblBPartner = new n.Controls.VLabel; this.lblStatusInfo = new n.Controls.VLabel; this.tabSelect = new n.Controls.VLabel; this.tabGenrate = new n.Controls.VLabel; this.cmbWarehouse = new n.Controls.VComboBox("", !1, !1, !0); this.vSearchBPartner = null; this.vSearchOrder = null; this.$root = t("<div style='width: 100%; height: 100%; background-color: white;'>"); this.$busyDiv = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); this.topDiv = null; this.sideDiv = null; this.gridSelectDiv = null; this.gridGenerateDiv = null; this.bottumDiv = null; this.div = null; this.okBtn = null; this.cancelBtn = null; this.btnRefresh = null; this.btnToggel = null; this.spnSelect = null; this.spnGenerate = null; this.btnSpaceDiv = null; this.lblGenrate = null; this.lblSelect = null; var o = null, s = null, r = 260, h = 50, f = t(window).width() - (r + 20), a = t(window).width() - (20 + h), k = f + r + 5, d = t(window).height() - 210; this.vetoablechange = function () { l = i.vSearchBPartner.getValue(); v = i.vSearchOrder.getValue(); i.okBtn.removeAttr("disabled"); y() }; this.sizeChanged = function (n, t) { f = t - (r + 20); a = t - (20 + h); u == !0 ? (i.btnSpaceDiv.animate({ width: h }, "slow"), i.sideDiv.animate({ width: h }, "slow"), i.div.css("display", "none"), i.gridSelectDiv.animate({ width: a }, "slow", null, function () { i.dGrid.resize() })) : (i.btnSpaceDiv.animate({ width: r }, "slow"), i.gridSelectDiv.animate({ width: f }, "slow"), i.div.css("display", "block"), i.sideDiv.animate({ width: r }, "slow", null, function () { i.dGrid.resize() })) }; this.Initialize = function () { if (tt(), nt(), g(), this.btnToggel = this.$root.find("#btnSpace_" + i.windowNo), this.spnSelect = this.$root.find("#spnSelect_" + i.windowNo), this.spnGenerate = this.$root.find("#spnGenerate_" + i.windowNo), this.okBtn != null) this.okBtn.on(n.Events.onTouchStartOrClick, function () { var r = i; if (i.cmbWarehouse.getControl().find("option:selected").val() == undefined) { n.ADialog.error("SelectWarehouseFirst"); return } i.$busyDiv[0].style.visibility = "visible"; t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv"); i.okBtn.attr("disabled", "disabled"); c = it(); c != null && c.length > 0 ? rt(c) : (n.ADialog.error("PlzSelectatLeast1Inv"), i.$busyDiv[0].style.visibility = "hidden"); i.okBtn.removeAttr("disabled") }); if (this.cancelBtn != null) this.cancelBtn.on(n.Events.onTouchStartOrClick, function () { i.$root.dialog("close") }); if (this.btnRefresh != null) this.btnRefresh.on(n.Events.onTouchStartOrClick, function () { i.okBtn.removeAttr("disabled"); e = i.cmbWarehouse.getControl().find("option:selected").val(); l = i.vSearchBPartner.getValue(); y() }); if (this.btnToggel != null) this.btnToggel.on(n.Events.onTouchStartOrClick, function () { var e = 0; u ? (e = n.Application.isRTL ? 180 : 0, i.btnToggel.animate({ borderSpacing: e }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !1, i.btnSpaceDiv.animate({ width: r }, "slow"), i.gridSelectDiv.animate({ width: f }, "slow"), i.div.css("display", "block"), i.sideDiv.animate({ width: r }, "slow", null, function () { i.dGrid.resize() })) : (e = n.Application.isRTL ? 0 : 180, i.btnToggel.animate({ borderSpacing: e }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !0, i.btnSpaceDiv.animate({ width: h }, "slow"), i.sideDiv.animate({ width: h }, "slow"), i.div.css("display", "none"), i.gridSelectDiv.animate({ width: a }, "slow", null, function () { i.dGrid.resize() })) }); if (this.spnGenerate != null) this.spnGenerate.on(n.Events.onTouchStartOrClick, function () { i.btnRefresh.hide(); i.okBtn.hide(); u && (i.btnToggel.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !1, i.gridSelectDiv.animate({ width: f }, "fast"), i.sideDiv.animate({ width: r }, "fast"), i.btnSpaceDiv.animate({ width: r }, "fast")); i.gridSelectDiv.css("display", "none"); i.sideDiv.css("display", "none"); i.gridGenerateDiv.css("display", "block"); i.btnToggel.hide(); lblSelect.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary), 1)"); lblGenrate.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)") }); if (this.spnSelect != null) this.spnSelect.on(n.Events.onTouchStartOrClick, function () { u || (i.btnRefresh.show(), i.okBtn.show(), i.gridGenerateDiv.css("display", "none"), i.gridSelectDiv.css("display", "block"), i.sideDiv.css("display", "block"), i.div.css("display", "block"), i.gridSelectDiv.animate({ width: f }, "fast"), i.btnToggel.show(), lblSelect.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)"), lblGenrate.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary), 1)")) }); if (this.cmbWarehouse != null && this.cmbWarehouse.getControl().change(function () { i.okBtn.removeAttr("disabled"); e = i.cmbWarehouse.getControl().find("option:selected").val(); y() }), this.vSearchBPartner != null && this.vSearchBPartner.addVetoableChangeListener(this), this.vSearchOrder != null && this.vSearchOrder.addVetoableChangeListener(this), o != null) o.on(n.Events.onTouchStartOrClick, function () { i.vSearchBPartner.isReadOnly || i.vSearchBPartner.setValue(null, !1, !0) }); if (s != null) s.on(n.Events.onTouchStartOrClick, function () { i.vSearchOrder.isReadOnly || i.vSearchOrder.setValue(null, !1, !0) }) }; this.display = function () { p(null) }; this.getRoot = function () { return this.$root }; this.disposeComponent = function () { this.okBtn && this.okBtn.off(n.Events.onTouchStartOrClick); this.cancelBtn && this.cancelBtn.off(n.Events.onTouchStartOrClick); o && o.off(n.Events.onTouchStartOrClick); s && s.off(n.Events.onTouchStartOrClick); i = null; this.frame = null; this.windowNo = null; this.arrListColumns = null; this.dGrid = null; c = null; e = null; l = null; w = null; b = null; u = null; this.lblWarehouse = null; this.lblBPartner = null; this.lblStatusInfo = null; this.tabSelect = null; this.tabGenrate = null; this.cmbWarehouse = null; this.vSearchBPartner = null; this.$root = null; this.$busyDiv = null; this.topDiv = null; this.sideDiv = null; this.gridSelectDiv = null; this.gridGenerateDiv = null; this.bottumDiv = null; this.okBtn = null; this.cancelBtn = null; this.btnRefresh = null; this.btnToggel = null; this.spnSelect = null; this.spnGenerate = null; r = null; f = null; a = null; k = null; d = null; this.getRoot = null; this.disposeComponent = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (t, i) { this.frame = i; this.windowNo = t; n.Env.getCtx().setContext(this.windowNo, "IsSOTrx", "Y"); try { var r = this.Initialize() } catch (u) { } this.frame.getContentGrid().append(this.getRoot()); this.display(); this.cmbWarehouse.getControl().focus() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VInOutGen = i }(VIS, jQuery), function (n, t) { function i() { function g() { var it = "topDiv_" + i.windowNo, y = "btnSpaceDiv_" + i.windowNo, rt = "btnSpace_" + i.windowNo, ut = "spnSelect_" + i.windowNo, ft = "spnGenerate_" + i.windowNo, p = "lblGenerate_" + i.windowNo, w = "lblSelect_" + i.windowNo, b, k, h, f, u, d, g, nt, c, l, tt, a, v; o = t('<button id = "btnClearBP_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button>'); s = t('<button id = "btnClearOrd_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button>'); l = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; i.topDiv = t("<div id='" + it + "' class='vis-archive-l-s-head vis-frm-ls-top' style='padding: 0;'><div id='" + y + "' class='vis-l-s-headwrp'><button id='" + rt + "' class='vis-archive-sb-t-button' ><i class='vis vis-arrow-left'><\/i><\/button><\/div><div id='" + ut + "'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='" + w + "' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 28px;color: rgba(var(--v-c-primary), 1);'>" + n.Msg.translate(n.Env.getCtx(), "Select") + "<\/label><\/div><div id='" + ft + "' style='display: inline-block; width: 160px;'><label id='" + p + "' class='VIS_Pref_Label_Font' style='vertical-align: middle; font-size: 17px;'>" + n.Msg.translate(n.Env.getCtx(), "Generate") + "<\/label><\/div><\/div>"); b = "sideDiv_" + i.windowNo; k = "parameterDiv_" + i.windowNo; i.btnSpaceDiv = i.topDiv.find("#" + y); this.lblGenrate = i.topDiv.find("#" + p); this.lblSelect = i.topDiv.find("#" + w); i.sideDiv = t("<div id='" + b + "' class='vis-archive-l-s-content vis-leftsidebarouterwrap'>"); i.sideDiv.css("width", r); i.sideDiv.css("height", "calc(100% - 103px)"); i.div = t("<div class='vis-archive-l-s-content-inner' id='" + k + "'>"); i.sideDiv.append(i.div); h = t("<table style='width: 100%;'>"); i.div.append(h); tr = t("<tr>"); td = t("<td style='padding: 10px 10px 0px;'>"); f = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); h.append(tr); tr.append(td); td.append(f); f.append(u); u.append(i.cmbOrg.getControl()); u.append(i.lblOrg.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); var f = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'), e = t('<div class="input-group-append">'); h.append(tr); tr.append(td); td.append(f); f.append(u); u.append(i.vSearchBPartner.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); e.append(i.vSearchBPartner.getBtn(0)); e.append(o); u.append(i.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")); f.append(e); d = n.Msg.translate(n.Env.getCtx(), "DocumentNo"); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); var f = t('<div class="input-group vis-input-wrap">'), u = t('<div class="vis-control-wrap">'), e = t('<div class="input-group-append">'); h.append(tr); tr.append(td); td.append(f); f.append(u); u.append(i.vSearchOrderShipment.getControl(0).attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); e.append(i.vSearchOrderShipment.getBtn(0)); e.append(s); u.append("<label>" + d + "<\/label>"); f.append(e); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;font-size:12px;'>"); h.append(tr); tr.append(td); td.append("(" + n.Msg.getMsg("SalesOrderNo", !1, !1) + ")"); g = "gridSelectDiv_" + i.windowNo; nt = "gridGenerateDiv_" + i.windowNo; i.gridSelectDiv = t("<div id='" + g + "' class='vis-frm-grid-outerwrp'>"); i.gridGenerateDiv = t("<div id='" + nt + "' style='height: 85%; float: right; display: none; background-color: #F1F1F1; margin-left: 15px;;margin-right: 15px;'>"); i.gridGenerateDiv.css("width", t(window).width() - 30); c = "btnOk_" + i.windowNo; i.okBtn = t("<input id='" + c + "' class='VIS_Pref_btn-2' style='margin-top: 0px; float: right;width: 70px;height: 38px;' type='button' value='Ok'>"); c = "btnRefresh_" + i.windowNo; l = n.Application.contextUrl + "Areas/VIS/Images/base/Refresh24.png"; i.btnRefresh = t("<button id='" + c + "' style='margin-top: 0px; float: left;height: 38px; ' class='VIS_Pref_btn-2'><i class='vis vis-refresh'><\/i><\/button>"); tt = "discriptionDiv_" + i.windowNo; i.bottumDiv = t("<div class='vis-info-btmcnt-wrap vis-p-t-10'>"); a = t("<div id='" + tt + "' style='flex: 1;padding: 0 10px;'>"); a.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font")); v = t("<div>"); v.append(i.okBtn); i.bottumDiv.append(i.btnRefresh).append(a).append(v); i.$root.append(i.$busyDiv); i.$busyDiv[0].style.visibility = "hidden"; i.$root.append(i.topDiv).append(i.sideDiv).append(i.gridSelectDiv).append(i.gridGenerateDiv).append(i.bottumDiv) } function nt() { i.lblOrg.getControl().text(n.Msg.translate(n.Env.getCtx(), "AD_Org_ID")); i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); i.tabSelect.getControl().text(n.Msg.getMsg("Select", !1, !1)); i.tabGenrate.getControl().text(n.Msg.getMsg("Generate", !1, !1)); i.lblStatusInfo.getControl().text(n.Msg.getMsg("VIS_OrderGenInv", !1, !1)) } function tt() { var u = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 2163, n.DisplayType.TableDir, "AD_Org_ID", 0, !1, "AD_Org.AD_Org_ID <> 0 AND AD_Org.IsSummary='N' AND AD_Org.IsActive='Y' AND AD_Org.IsCostCenter='N' AND AD_Org.IsProfitCenter='N' "), t, r; i.cmbOrg = new n.Controls.VComboBox("AD_Org_ID", !0, !1, !0, u, 150, n.DisplayType.TableDir, 0); t = n.MLookupFactory.getMLookUp(n.Env.getCtx(), i.windowNo, 2762, n.DisplayType.Search); i.vSearchBPartner = new n.Controls.VTextBoxButton("C_BPartner_ID", !0, !1, !0, n.DisplayType.Search, t, 0); r = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 2161, n.DisplayType.Search, "C_Order_ID", 0, !1, "DocStatus='CO'"); i.vSearchOrderShipment = new n.Controls.VTextBoxButton("C_Order_ID", !0, !1, !0, n.DisplayType.Search, r, 0) } function p(r) { i.dGrid != null && (i.dGrid.destroy(), i.dGrid = null); i.arrListColumns.length == 0 && (i.arrListColumns.push({ field: "AD_Org_ID", caption: n.Msg.translate(n.Env.getCtx(), "AD_Org_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "C_DocType_ID", caption: n.Msg.translate(n.Env.getCtx(), "C_DocType_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "DocumentNo", caption: n.Msg.getElement(n.Env.getCtx(), "DocumentNo"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "C_BPartner_ID", caption: n.Msg.getElement(n.Env.getCtx(), "C_BPartner_ID"), sortable: !0, size: "16%", min: 150, hidden: !1 }), i.arrListColumns.push({ field: "DateOrdered", caption: n.Msg.getElement(n.Env.getCtx(), "DateOrdered"), sortable: !0, size: "16%", min: 150, hidden: !1, render: function (n) { var t; return t = n.changes == undefined || n.changes.DateOrdered == undefined ? n.DateOrdered : n.changes.DateOrdered, new Date(t).toLocaleDateString() } }), i.arrListColumns.push({ field: "TotalLines", caption: n.Msg.getElement(n.Env.getCtx(), "TotalLines"), sortable: !0, size: "20%", min: 150, hidden: !1, align: "right", render: function (n) { var t = n.TotalLines; return parseFloat(t).toLocaleString() } }), i.arrListColumns.push({ field: "C_Order_ID", caption: n.Msg.translate(n.Env.getCtx(), "C_UOM_ID"), sortable: !0, size: "150px", hidden: !0 })); w2utils.encodeTags(r); i.dGrid = t(i.gridSelectDiv).w2grid({ name: "gridGenForm" + i.windowNo, recordHeight: 40, show: { selectColumn: !0 }, multiSelect: !0, columns: i.arrListColumns, records: r }) } function y() { var r = [], s = n.Env.getCtx().getAD_Client_ID(), u = "", f = "", o = ""; e != null && e.toString() != "-1" && (u = " AND ic.AD_Org_ID=" + e); l != null && (f = " AND ic.C_BPartner_ID=" + l); a != null && (o = " AND C_Order_ID=" + a); t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "VCreateFrom/ExecuteQueryVInvoiceGen", type: "POST", data: { adClientID: s, adOrgIDs: u, cBPartnerIDs: f, ordShipmentids: o }, success: function (u) { var f = JSON.parse(u), s, e, o; if (f && f.length > 0) try { for (s = 1, e = 0; e < f.length; e++)o = {}, o.C_Order_ID = f[e].c_order_id, o.AD_Org_ID = f[e].ord, o.C_DocType_ID = f[e].doctype, o.DocumentNo = f[e].documentno, o.C_BPartner_ID = f[e].bpname, o.DateOrdered = f[e].dateordered, o.TotalLines = f[e].tLines, o.recid = s, s++, r.push(o) } catch (h) { } else n.ADialog.info("NoDataFound"), i.okBtn.attr("disabled", "disabled"); p(r); t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "hidden" }, error: function () { t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv"); i.$busyDiv[0].style.visibility = "hidden" } }) } function it() { var r, u, f, t, n; if (i.dGrid == null) return !1; if ((r = [], u = i.dGrid.getSelection(), u != null) && !(u.length <= 0)) { for (f = u.toString().split(","), n = 0; n < f.length; n++)r[n] = i.dGrid.get(f[n]).C_Order_ID; if (r.length == 0) return ""; for (t = "", n = 0; n < r.length; n++)n > 0 && (t = t.concat(",")), t = t.concat(r[n].toString()); return t.toString() } } function rt(r) { var u = i; i.$busyDiv[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Common/GenerateInvoices", dataType: "json", data: { whereClause: r }, success: function (r) { r.DocumentText != null && (ut(!0), u.gridGenerateDiv.html(r.DocumentText), u.lblStatusInfo.getControl().text(r.lblStatusInfo)); r.ErrorMsg != null && n.ADialog.info("", null, r.ErrorMsg, null); u.$busyDiv[0].style.visibility = "hidden"; t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv") }, error: function () { u.$busyDiv[0].style.visibility = "hidden"; t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv") } }) } function ut(n) { n && (i.btnRefresh.hide(), i.okBtn.hide(), i.btnToggel.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), n = !1, i.gridSelectDiv.animate({ width: f }, "fast"), i.sideDiv.animate({ width: "toggle", height: "toggle" }, "slow")); i.gridSelectDiv.css("display", "none"); i.sideDiv.css("display", "none"); i.gridGenerateDiv.css("display", "block"); i.btnToggel.hide(); lblSelect.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary),1)"); lblGenrate.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)") } var i, a; this.frame; this.windowNo; i = this; this.arrListColumns = []; this.dGrid = null; var c = null, e = null, l = null, w = !1, b = !1, u = !1; this.lblOrg = new n.Controls.VLabel; this.lblBPartner = new n.Controls.VLabel; this.lblStatusInfo = new n.Controls.VLabel; this.tabSelect = new n.Controls.VLabel; this.tabGenrate = new n.Controls.VLabel; this.cmbOrg = new n.Controls.VComboBox("", !1, !1, !0); this.vSearchBPartner = null; this.vSearchOrderShipment = null; a = null; this.$root = t("<div style='width: 100%; height: 100%; background-color: white;'>"); this.$busyDiv = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); this.topDiv = null; this.sideDiv = null; this.gridSelectDiv = null; this.gridGenerateDiv = null; this.bottumDiv = null; this.div = null; this.okBtn = null; this.cancelBtn = null; this.btnRefresh = null; this.btnToggel = null; this.spnSelect = null; this.spnGenerate = null; this.btnSpaceDiv = null; this.lblGenrate = null; this.lblSelect = null; var o = null, s = null, r = 260, h = 50, f = t(window).width() - (r + 20 + 5), v = t(window).width() - (20 + h), k = f + r + 5, d = t(window).height() - 210; this.vetoablechange = function () { l = i.vSearchBPartner.getValue(); a = i.vSearchOrderShipment.getValue(); i.okBtn.removeAttr("disabled"); y() }; this.sizeChanged = function (n, t) { f = t - (r + 20); v = t - (20 + h); u == !0 ? (i.btnSpaceDiv.animate({ width: h }, "slow"), i.sideDiv.animate({ width: h }, "slow"), i.div.css("display", "none"), i.gridSelectDiv.animate({ width: v }, "slow", null, function () { i.dGrid.resize() })) : (i.btnSpaceDiv.animate({ width: r }, "slow"), i.gridSelectDiv.animate({ width: f }, "slow"), i.div.css("display", "block"), i.sideDiv.animate({ width: r }, "slow", null, function () { i.dGrid.resize() })) }; this.Initialize = function () { if (tt(), nt(), g(), this.btnToggel = this.$root.find("#btnSpace_" + i.windowNo), this.spnSelect = this.$root.find("#spnSelect_" + i.windowNo), this.spnGenerate = this.$root.find("#spnGenerate_" + i.windowNo), this.okBtn != null) this.okBtn.on(n.Events.onTouchStartOrClick, function () { i.$busyDiv[0].style.visibility = "visible"; t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot"); t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv"); i.okBtn.attr("disabled", "disabled"); c = it(); c != null && c.length > 0 ? rt(c) : (i.$busyDiv[0].style.visibility = "hidden", n.ADialog.error("PlzSelectatLeast1Inv")); i.okBtn.removeAttr("disabled") }); if (this.cancelBtn != null) this.cancelBtn.on(n.Events.onTouchStartOrClick, function () { i.$root.dialog("close") }); if (this.btnRefresh != null) this.btnRefresh.on(n.Events.onTouchStartOrClick, function () { i.okBtn.removeAttr("disabled"); e = i.cmbOrg.getControl().find("option:selected").val(); l = i.vSearchBPartner.getValue(); y() }); if (this.btnToggel != null) var a = 0; this.btnToggel.on(n.Events.onTouchStartOrClick, function () { u ? (a = n.Application.isRTL ? 180 : 0, i.btnToggel.animate({ borderSpacing: a }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !1, i.btnSpaceDiv.animate({ width: r }, "slow"), i.gridSelectDiv.animate({ width: f }, "slow"), i.div.css("display", "block"), i.sideDiv.animate({ width: r }, "slow", null, function () { i.dGrid.resize() })) : (a = n.Application.isRTL ? 0 : 180, i.btnToggel.animate({ borderSpacing: a }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !0, i.btnSpaceDiv.animate({ width: h }, "slow"), i.sideDiv.animate({ width: h }, "slow"), i.div.css("display", "none"), i.gridSelectDiv.animate({ width: v }, "slow", null, function () { i.dGrid.resize() })) }); if (this.spnGenerate != null) this.spnGenerate.on(n.Events.onTouchStartOrClick, function () { i.btnRefresh.hide(); i.okBtn.hide(); u && (i.btnToggel.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), u = !1, i.gridSelectDiv.animate({ width: f }, "fast"), i.sideDiv.animate({ width: r }, "fast"), i.btnSpaceDiv.animate({ width: r }, "fast")); i.gridSelectDiv.css("display", "none"); i.sideDiv.css("display", "none"); i.gridGenerateDiv.css("display", "block"); i.btnToggel.hide(); lblSelect.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary),1)"); lblGenrate.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)") }); if (this.spnSelect != null) this.spnSelect.on(n.Events.onTouchStartOrClick, function () { u || (i.btnRefresh.show(), i.okBtn.show(), i.gridGenerateDiv.css("display", "none"), i.gridSelectDiv.css("display", "block"), i.sideDiv.css("display", "block"), i.div.css("display", "block"), i.gridSelectDiv.animate({ width: f }, "fast"), i.btnToggel.show(), lblSelect.css("font-size", "28px").css("color", "rgba(var(--v-c-primary), 1)"), lblGenrate.css("font-size", "17px").css("color", "rgba(var(--v-c-on-secondary),1)")) }); if (this.cmbOrg != null && this.cmbOrg.getControl().change(function () { i.okBtn.removeAttr("disabled"); e = i.cmbOrg.getControl().find("option:selected").val(); y() }), this.vSearchBPartner != null && this.vSearchBPartner.addVetoableChangeListener(this), this.vSearchOrderShipment != null && this.vSearchOrderShipment.addVetoableChangeListener(this), o != null) o.on(n.Events.onTouchStartOrClick, function () { i.vSearchBPartner.isReadOnly || i.vSearchBPartner.setValue(null, !1, !0) }); if (s != null) s.on(n.Events.onTouchStartOrClick, function () { i.vSearchOrderShipment.isReadOnly || i.vSearchOrderShipment.setValue(null, !1, !0) }) }; this.display = function () { p(null) }; this.getRoot = function () { return this.$root }; this.disposeComponent = function () { this.okBtn && this.okBtn.off(n.Events.onTouchStartOrClick); this.cancelBtn && this.cancelBtn.off(n.Events.onTouchStartOrClick); o && o.off(n.Events.onTouchStartOrClick); s && s.off(n.Events.onTouchStartOrClick); i = null; this.frame = null; this.windowNo = null; this.arrListColumns = null; this.dGrid = null; c = null; e = null; l = null; w = null; b = null; u = null; this.lblOrg = null; this.lblBPartner = null; this.lblStatusInfo = null; this.tabSelect = null; this.tabGenrate = null; this.cmbOrg = null; this.vSearchBPartner = null; this.$root = null; this.$busyDiv = null; this.topDiv = null; this.sideDiv = null; this.gridSelectDiv = null; this.gridGenerateDiv = null; this.bottumDiv = null; this.okBtn = null; this.cancelBtn = null; this.btnRefresh = null; this.btnToggel = null; this.spnSelect = null; this.spnGenerate = null; r = null; f = null; v = null; k = null; d = null; this.getRoot = null; this.disposeComponent = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (t, i) { this.frame = i; this.windowNo = t; n.Env.getCtx().setContext(this.windowNo, "IsSOTrx", "Y"); try { var r = this.Initialize() } catch (u) { } this.frame.getContentGrid().append(this.getRoot()); this.display(); this.cmbOrg.getControl().focus() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VInvoiceGen = i }(VIS, jQuery), function (n, t) { function i() { function ci() { var tt = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png", e, f, u, r, h; d = t('<button id = "btnClearBP_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button>'); g = t('<button id = "btnClearOrd_' + i.windowNo + '" tabindex="-1" class="vis-controls-txtbtn-table-td2 input-group-text"><i class="fa fa-arrow-left" title="' + n.Msg.getMsg("Clear", !1, !1) + '"><\/i><\/button>'); i.topDiv = t("<div id='topDiv_" + i.windowNo + "'  class='vis-archive-l-s-head vis-frm-ls-top' style='padding: 0;'><div id='btnSpaceDiv_" + i.windowNo + "' class='vis-l-s-headwrp'><button id='btnToggelDiv_" + i.windowNo + "' class='vis-archive-sb-t-button' ><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>"); e = t("<div class='vis-frm-contenthead'>"); e.append(i.lblInvoice.getControl().addClass("VIS_Pref_Label_Font")); e.append(chkSameBPartnerDiv); e.append(chkSameProductDiv); e.append(chkSameQtyDiv); i.topDiv.append(e); i.invoiceTopDiv = e; i.btnSpaceDiv = i.topDiv.find("#btnSpaceDiv_" + i.windowNo); i.sideDiv = t("<div id='sideDiv_" + i.windowNo + "' class='vis-archive-l-s-content vis-mi-ls-wrp vis-leftsidebarouterwrap'>"); i.sideDiv.css("width", v); i.div = t("<div class='vis-archive-l-s-content-inner' id='parameterDiv_" + i.windowNo + "'>"); i.sideDiv.append(i.div); f = t("<table style='width: 100%;height: 100%;'>"); i.div.append(f); tr = t("<tr>"); td = t("<td style='padding: 10px 10px 0px;'>"); u = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.cmbMatchFrom.getControl()); r.append(i.lblMatchFrom.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); u = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.cmbMatchTo.getControl()); r.append(i.lblMatchTo.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); u = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.cmbMatchMode.getControl()); r.append(i.lblMatchMode.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); var u = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.onlyVendor.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); r.append(i.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")); o.append(i.onlyVendor.getBtn(0)); o.append(d); u.append(o); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); var u = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'), o = t('<div class="input-group-append">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.onlyProduct.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); r.append(i.lblProduct.getControl().addClass("VIS_Pref_Label_Font")); o.append(i.onlyProduct.getBtn(0)); o.append(g); u.append(o); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); u = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.dtpFrom); r.append(i.lblDateFrom.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); u = t('<div class="input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); f.append(tr); tr.append(td); td.append(u); u.append(r); r.append(i.dtpTo); r.append(i.lblDateTo.getControl().addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); f.append(tr); tr.append(td); td.append(chkIsReturnTrxDiv); i.divForGrid = t("<div id='divForGrid_" + i.windowNo + "' class='vis-mi-main-contntwrp'>"); i.gridInvoiceDiv = t("<div id='gridInvoiceDiv_" + i.windowNo + "' style='width: 100%;flex: 1; '>"); i.invoicegrd = t("<div style='float: left; width: 100%;height: 100%;'>"); i.gridInvoiceDiv.append(i.invoicegrd); i.gridReciptDiv = t("<div id='gridReciptDiv_" + i.windowNo + "' style='width: 100%;flex: 1;'>"); h = t("<div style='float: left; width: 100%; margin-top: 0px;'>"); h.append(i.lblReceipt.getControl().css("display", "inline-block").css("font-size", "24px").css("color", "rgba(var(--v-c-primary), 1)").addClass("VIS_Pref_Label_Font")); i.reciptgrd = t("<div style='float: left; width: 100%;height: 100%;'>"); i.gridReciptDiv.append(i.reciptgrd); var s = t("<div class='vis-info-btnfileds-wrap'>"), y = t("<div class='vis-info-botdatafield'>"), p = t("<div class='input-group vis-input-wrap'>"), c = t("<div class='vis-control-wrap'>"); y.append(p); p.append(c); c.append(i.txtMatched.getControl()); c.append(i.lblMatched.getControl().addClass("VIS_Pref_Label_Font")); s.append(y); var w = t("<div class='vis-info-botdatafield' style='padding-left: 15px;'>"), b = t("<div class='input-group vis-input-wrap'>"), l = t("<div class='vis-control-wrap'>"); w.append(b); b.append(l); l.append(i.txtMatchedTo.getControl()); l.append(i.lblMatchedTo.getControl().addClass("VIS_Pref_Label_Font")); s.append(w); var k = t("<div class='vis-info-botdatafield' style='padding-left: 15px;'>"), nt = t("<div class='input-group vis-input-wrap'>"), a = t("<div class='vis-control-wrap'>"); k.append(nt); nt.append(a); a.append(i.txtDifference.getControl()); a.append(i.lblDifference.getControl().addClass("VIS_Pref_Label_Font")); s.append(k); i.bottumButtonDiv = t("<div class='vis-info-btmcnt-wrap'>"); i.searchBtnWrap = t("<div class='vis-info-searchbtn-wrap'>"); i.bottumButtonDiv.append(i.searchBtnWrap); i.searchBtnWrap.append(i.btnSearch); i.bottumButtonDiv.append(s); i.bottumButtonDiv.append(i.btnProcess); i.bottumDiv = t("<div class='vis-mi-bot-div'>"); i.bottumDiv.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font")); i.bottumDiv.append(i.lblStatusCount.getControl().css("float", "right").addClass("VIS_Pref_Label_Font")); i.divForGrid.append(i.gridInvoiceDiv).append(h).append(i.gridReciptDiv); i.$root.append(i.topDiv).append(i.sideDiv).append(i.divForGrid).append(i.bottumButtonDiv).append(i.bottumDiv); i.$root.append(i.$busyDiv) } function li() { var r = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; i.dtpFrom = t("<input id='dateFrom_" + i.windowNo + "' type='date' name='DateOrdered'>"); i.dtpTo = t("<input id='dateTo_" + i.windowNo + "' type='date' name='DateOrdered'>"); this.chkIsReturnTrxDiv = t("<div>"); i.chkIsReturnTrx = t("<input id='chkIsReturnTrx_" + i.windowNo + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblIsReturnTrx_" + i.windowNo + "' class='VIS_Pref_Label_Font'>Return Transaction<\/label><\/span>"); this.chkIsReturnTrxDiv.append(i.chkIsReturnTrx); this.chkSameBPartnerDiv = t("<div class='vis-matchpoTopcheckwrap'>"); i.chkSameBPartner = t("<input id='chkSameBPartner_" + i.windowNo + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameBPartner_" + i.windowNo + "' class='VIS_Pref_Label_Font'>Same BPartner<\/label><\/span>"); this.chkSameBPartnerDiv.append(i.chkSameBPartner); this.chkSameProductDiv = t("<div class='vis-matchpoTopcheckwrap'>"); i.chkSameProduct = t("<input id='chkSameProduct_" + i.windowNo + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameProduct_" + i.windowNo + "' class='VIS_Pref_Label_Font'>Same Product<\/label><\/span>"); this.chkSameProductDiv.append(i.chkSameProduct); this.chkSameQtyDiv = t("<div class='vis-matchpoTopcheckwrap'>"); i.chkSameQty = t("<input id='chkSameQty_" + i.windowNo + "' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameQty_" + i.windowNo + "' class='VIS_Pref_Label_Font'>Same Quantity<\/label><\/span>"); this.chkSameQtyDiv.append(i.chkSameQty); i.btnSearch = t("<input id='btnSearch_" + i.windowNo + "' class='VIS_Pref_btn-2' style='margin-top: 0px;' type='button' value='Search'>"); i.btnProcess = t("<Button id='btnProcess_" + i.windowNo + "' style='margin-top: 0px;' class='VIS_Pref_btn-2'>" + n.Msg.getMsg("Match") + "<\/Button>"); i.lblInvoice.getControl().text(n.Msg.translate(n.Env.getCtx(), "Invoice")); i.lblReceipt.getControl().text(n.Msg.translate(n.Env.getCtx(), "Receipt")); i.lblMatchFrom.getControl().text(n.Msg.translate(n.Env.getCtx(), "MatchFrom")); i.lblMatchTo.getControl().text(n.Msg.translate(n.Env.getCtx(), "MatchTo")); i.lblMatchMode.getControl().text(n.Msg.translate(n.Env.getCtx(), "MatchMode")); i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID")); i.lblProduct.getControl().text(n.Msg.translate(n.Env.getCtx(), "M_Product_ID")); i.lblDateFrom.getControl().text(n.Msg.translate(n.Env.getCtx(), "DateFrom")); i.lblDateTo.getControl().text(n.Msg.translate(n.Env.getCtx(), "DateTo")); i.lblMatched.getControl().text(n.Msg.translate(n.Env.getCtx(), "ToBeMatched")); i.lblMatchedTo.getControl().text(n.Msg.translate(n.Env.getCtx(), "Matching")); i.lblDifference.getControl().text(n.Msg.translate(n.Env.getCtx(), "Difference")); i.chkIsReturnTrx.prop("checked", !1); i.btnProcess.attr("disabled", "disabled"); i.chkSameProduct.prop("checked", !0); i.chkSameBPartner.prop("checked", !0); i.chkSameQty.prop("checked", !1); i.chkIsReturnTrx.next("label").text(n.Msg.translate(n.Env.getCtx(), "isReturnTrx")); i.chkSameProduct.next("label").text(n.Msg.translate(n.Env.getCtx(), "SameProduct")); i.chkSameBPartner.next("label").text(n.Msg.translate(n.Env.getCtx(), "SameBPartner")); i.chkSameQty.next("label").text(n.Msg.translate(n.Env.getCtx(), "SameQty")); i.lblSearch.getControl().text(n.Msg.translate(n.Env.getCtx(), "Search")); i.btnSearch.text(n.Msg.translate(n.Env.getCtx(), "Search")) } function wt() { ri(); bt(); i.lblStatusInfo.getControl().text(""); i.lblStatusCount.getControl().text(0) } function ai() { var t = n.MLookupFactory.getMLookUp(n.Env.getCtx(), i.windowNo, 3499, n.DisplayType.Search); i.onlyVendor = new n.Controls.VTextBoxButton("C_BPartner_ID", !0, !1, !0, n.DisplayType.Search, t); t = n.MLookupFactory.getMLookUp(n.Env.getCtx(), i.windowNo, 3840, n.DisplayType.Search); i.onlyProduct = new n.Controls.VTextBoxButton("M_Product_ID", !0, !1, !0, n.DisplayType.Search, t) } function bt() { i.cmbMatchTo.getControl().empty(); var n = null; i.cmbMatchFrom.getControl().find("option").length > 0 && (n = i.cmbMatchFrom.getControl().find("option:selected").val(), n.equals(r[o]) ? i.cmbMatchTo.getControl().append(" <option value='" + r[f] + "'>" + r[f] + "<\/option>") : n.equals(r[u]) ? i.cmbMatchTo.getControl().append(" <option value='" + r[f] + "'>" + r[f] + "<\/option>") : (i.cmbMatchTo.getControl().append(" <option value='" + r[o] + "'>" + r[o] + "<\/option>"), i.cmbMatchTo.getControl().append(" <option value='" + r[u] + "'>" + r[u] + "<\/option>")), i.cmbMatchTo.getControl().prop("selectedIndex", 0), i.lblInvoice.getControl().text(n)); kt() } function kt() { selection = i.cmbMatchTo.getControl().find("option:selected").val(); i.lblReceipt.getControl().text(selection) } function et() { var v = i.cmbMatchFrom.getControl()[0].selectedIndex, c = i.cmbMatchTo.getControl().find("option:selected").val(), h = o, l, a, t, e; c.equals(r[f]) ? h = f : c.equals(r[u]) && (h = u); yt = h; ti(v, h); ft = ""; i.vdgvReceipt != null && i.vdgvReceipt.clear(); i.onlyProduct.getValue() != null && (l = i.onlyProduct.getValue(), at = " AND lin.M_Product_ID=" + l); i.onlyVendor.getValue() != null && (a = i.onlyVendor.getValue(), vt = " AND hdr.C_BPartner_ID=" + a); t = i.dtpFrom.val(); e = i.dtpTo.val(); t != "" && e != "" ? ht = " AND " + s + " BETWEEN " + n.DB.to_date(t) + " AND " + n.DB.to_date(e) : t != "" ? ct = " AND " + s + " >= " + n.DB.to_date(t) : e != "" && (lt = " AND " + s + " <= " + n.DB.to_date(e)); ii(i.vdgvInvoice); i.txtMatched.getControl().val(0); i.lblStatusInfo.getControl().text(i.cmbMatchFrom.getControl().find("option:selected").val() + "# = " + i.vdgvInvoice.records.length + " -" + i.cmbMatchTo.getControl().find("option:selected").val() + "# = " + i.vdgvReceipt.records.length); i.lblStatusCount.getControl().text(0) } function c(n) { var t, s, h, e, c, v, p, a, w; nt = ""; tt = ""; it = ""; t = -1; n != null ? t = n : i.vdgvInvoice.getSelection().length > 0 && (t = Number(i.vdgvInvoice.getSelection().toString())); s = 0; t < 0 ? i.$busyDiv[0].style.visibility = "hidden" : (h = i.cmbMatchTo.getControl().find("option:selected").val(), e = o, h.equals(r[f]) ? e = f : h.equals(r[u]) && (e = u), c = i.cmbMatchFrom.getControl()[0].selectedIndex, yt = c, ti(e, c), v = { key: i.vdgvInvoice.get(t).C_BPartner_ID_K, value: i.vdgvInvoice.get(t).C_BPartner_ID }, p = { key: i.vdgvInvoice.get(t).M_Product_ID_K, value: i.vdgvInvoice.get(t).M_Product_ID }, i.chkSameBPartner.prop("checked") && (nt = " AND hdr.C_BPartner_ID=" + v.key), i.chkSameProduct.prop("checked") && (tt = " AND lin.M_Product_ID=" + p.key), a = i.vdgvInvoice.get(t).Qty, w = i.vdgvInvoice.get(t).Matched, s = a - w, i.chkSameQty.prop("checked") && (it = " AND " + y + "=" + a), ft = i.vdgvInvoice.get(t).Line_K, ii(i.vdgvReceipt)); l = s; i.txtMatched.setValue(l); i.txtMatchedTo.setValue(0); i.txtDifference.setValue(l); i.lblStatusInfo.getControl().text(i.cmbMatchFrom.getControl().find("option:selected").val() + "# = " + i.vdgvInvoice.records.length + " -" + i.cmbMatchTo.getControl().find("option:selected").val() + "# = " + i.vdgvReceipt.records.length); i.lblStatusCount.getControl().text(0) } function vi() { var n = -1, o, h, c; if (i.vdgvInvoice.getSelection().length > 0 && (n = Number(i.vdgvInvoice.getSelection().toString())), n < 0) { e = !1; i.$busyDiv[0].style.visibility = "hidden"; return } var b = { key: i.vdgvInvoice.get(n).C_BPartner_ID_K, value: i.vdgvInvoice.get(n).C_BPartner_ID }, a = { key: i.vdgvInvoice.get(n).Line_K, value: i.vdgvInvoice.get(n).Line }, v = { key: i.vdgvInvoice.get(n).M_Product_ID_K, value: i.vdgvInvoice.get(n).M_Product_ID }, y = l, k = i.vdgvInvoice.get(n).Matched, f = i.vdgvReceipt.getSelection().toString(); if (f == null) { e = !1; i.$busyDiv[0].style.visibility = "hidden"; return } if (f.length <= 0) { e = !1; i.$busyDiv[0].style.visibility = "hidden"; return } o = !0; (i.cmbMatchFrom.getControl().find("option:selected").val().equals(r[u]) || i.cmbMatchTo.getControl().find("option:selected").val().equals(r[u])) && (o = !1); var p = i.cmbMatchMode.getControl()[0].selectedIndex, w = i.cmbMatchFrom.getControl()[0].selectedIndex, s = [], t = f.toString().split(","); for (n = 0; n < t.length; n++)if (h = i.vdgvReceipt.get(t[n])._ID, h != null) { if (c = { key: i.vdgvReceipt.get(t[n]).M_Product_ID_K, value: i.vdgvReceipt.get(t[n]).M_Product_ID }, v.key != c.key) continue; s.push(i.vdgvReceipt.get(t[n])) } else continue; if (s.length > 0) yi(o, p, w, a.key, y, s); else { e = !1; i.$busyDiv[0].style.visibility = "hidden"; return } } function ti(n) { nt = ""; tt = ""; it = ""; ht = ""; ct = ""; lt = ""; at = ""; vt = ""; ni = i.cmbMatchMode.getControl()[0].selectedIndex == pt; ot = ""; dt = i.chkIsReturnTrx.prop("checked"); st = ""; gt = !1; matchToTypeMATCH_ORDER = "matchToTypeMATCH_ORDER"; n == o ? (ot = "displayMATCH_INVOICE", s = "hdr.DateInvoiced", y = "lin.QtyInvoiced") : n == u ? (st = "displayMATCH_ORDER", s = "hdr.DateOrdered", y = "lin.QtyOrdered") : (s = "hdr.MovementDate", y = "lin.MovementQty") } function ii(r) { var e = [], o = { displayMATCH_INVOICEs: ot, chkIsReturnTrxProps: dt, displayMATCH_ORDERs: st, matchToTypeMATCH_SHIPMENTs: gt, matchedsss: ni, chkSameBPartnerss: nt, chkSameProductss: tt, chkSameQtyss: it, from_ss: ht, fromIfs: ct, to_Dats: lt, matchToTypes: yt, MATCH_SHIPMENTs: f, MATCH_ORDERs: u, onlyProduct_ss: at, onlyVendor_ss: vt, MatchToID: ft }; t.ajax({ url: n.Application.contextUrl + "VCreateFrom/GetTableLoadVmatch", dataType: "json", data: o, success: function (n) { var t = JSON.parse(n), o, u, f, s, h; if (t && t != null) for (o = 1, u = 0; u < t.length; u++)f = {}, f._ID = t[u]._ID, f.DocumentNo = t[u].DocNo, s = t[u].Date, h = new Date(s), t[u].Date = h.toLocaleDateString(), f.Date = t[u].Date, f.C_BPartner_ID = t[u].CBPartnerIDK, f.C_BPartner_ID_K = t[u].CBPartnerID, f.Line = t[u].Line, f.Line_K = t[u].Line_K, f.M_Product_ID = t[u].MProductIDK, f.M_Product_ID_K = t[u].MProductID, f.Qty = t[u].Qty, f.Matched = t[u].Matched, f.recid = o, o++, e.push(f); e.length < 1 ? (ri(r.name.contains("vdgvReceipt")), i.$busyDiv[0].style.visibility = "hidden") : r.name.contains("vdgvReceipt") ? (wi(i.arrListColumns, e), i.$busyDiv[0].style.visibility = "hidden") : r.name.contains("vdgvInvoice") && (pi(i.arrListColumns, e), c()) }, error: function (n) { console.log(n); i.$busyDiv[0].style.visibility = "hidden" } }) } function yi(r, u, f, o, s, h) { var c = i; t.ajax({ url: n.Application.contextUrl + "Common/CreateMatchRecord", dataType: "json", data: { invoice: r, MatchMode: u, MatchFrom: f, LineMatched: o, ToMatchQty: s, SelectedItems: JSON.stringify(h) }, success: function (t) { et(); i.vdgvReceipt.delete(!0); var r = JSON.parse(t); r.Msg != "" ? n.ADialog.info("", null, r.Msg, null) : r.MatchedPO_ID > 0 ? n.ADialog.info("Matched", null, n.Msg.getMsg("PurchaseOrder") + " - " + r.MatchedPO_ID, null) : r.MatchedInv_ID > 0 && n.ADialog.info("Matched", null, n.Msg.getMsg("Invoice") + " - " + r.MatchedInv_ID, null); e = !1; i.$busyDiv[0].style.visibility = "hidden" }, error: function (n, t) { console.log(t); e = !1; i.$busyDiv[0].style.visibility = "hidden" } }) } function ri(r) { i.arrListColumns.length == 0 && (i.arrListColumns.push({ field: "_ID", caption: "_ID", sortable: !0, size: "11%", hidden: !0 }), i.arrListColumns.push({ field: "DocumentNo", caption: n.Msg.translate(n.Env.getCtx(), "DocumentNo"), sortable: !0, size: "11%", hidden: !1 }), i.arrListColumns.push({ field: "Date", caption: n.Msg.translate(n.Env.getCtx(), "Date"), sortable: !0, size: "11%", hidden: !1 }), i.arrListColumns.push({ field: "C_BPartner_ID", caption: n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID"), sortable: !0, size: "11%", hidden: !1 }), i.arrListColumns.push({ field: "C_BPartner_ID_K", caption: n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID"), sortable: !0, size: "11%", hidden: !0 }), i.arrListColumns.push({ field: "Line", caption: n.Msg.translate(n.Env.getCtx(), "Line"), sortable: !0, size: "11%", hidden: !1 }), i.arrListColumns.push({ field: "Line_K", caption: n.Msg.translate(n.Env.getCtx(), "Line"), sortable: !0, size: "11%", hidden: !0 }), i.arrListColumns.push({ field: "M_Product_ID", caption: n.Msg.translate(n.Env.getCtx(), "M_Product_ID"), sortable: !0, size: "11%", hidden: !1 }), i.arrListColumns.push({ field: "M_Product_ID_K", caption: n.Msg.translate(n.Env.getCtx(), "M_Product_ID"), sortable: !0, size: "11%", hidden: !0 }), i.arrListColumns.push({ field: "Qty", caption: n.Msg.translate(n.Env.getCtx(), "Qty"), sortable: !0, size: "11%", hidden: !1, render: function (t) { var i = n.Utility.Util.getValueOfDecimal(t.Qty); return i.toLocaleString() } }), i.arrListColumns.push({ field: "Matched", caption: n.Msg.translate(n.Env.getCtx(), "Matched"), sortable: !0, size: "11%", hidden: !1 })); r == null ? (i.vdgvInvoice != null && (i.vdgvInvoice.destroy(), i.vdgvInvoice = null), i.vdgvInvoice = t(i.invoicegrd).w2grid({ name: "vdgvInvoice" + i.windowNo, recordHeight: 30, show: { selectColumn: !1 }, onSelect: function (n) { c(n.recid) }, multiSelect: !1, columns: i.arrListColumns, records: null }), i.vdgvReceipt != null && (i.vdgvReceipt.destroy(), i.vdgvReceipt = null), i.vdgvReceipt = t(i.reciptgrd).w2grid({ name: "vdgvReceipt" + i.windowNo, recordHeight: 30, show: { selectColumn: !0 }, onSelect: function (n) { this.multiSelect = !0; a(n.recid, !0) }, onUnselect: function (n) { a(n.recid, !1) }, multiSelect: !1, columns: i.arrListColumns, records: null })) : r ? r && (i.vdgvReceipt != null && (i.vdgvReceipt.destroy(), i.vdgvReceipt = null), i.vdgvReceipt = t(i.reciptgrd).w2grid({ name: "vdgvReceipt" + i.windowNo, recordHeight: 30, show: { selectColumn: !0 }, onSelect: function (n) { this.multiSelect = !0; a(n.recid, !0) }, onUnselect: function (n) { a(n.recid, !1) }, multiSelect: !1, columns: i.arrListColumns, records: null })) : (i.vdgvInvoice != null && (i.vdgvInvoice.destroy(), i.vdgvInvoice = null), i.vdgvInvoice = t(i.invoicegrd).w2grid({ name: "vdgvInvoice" + i.windowNo, recordHeight: 30, show: { selectColumn: !1 }, onSelect: function (n) { c(n.recid) }, multiSelect: !1, columns: i.arrListColumns, records: null })) } function pi(n, r) { i.vdgvInvoice != null && (i.vdgvInvoice.destroy(), i.vdgvInvoice = null); w2utils.encodeTags(r); i.vdgvInvoice = t(i.invoicegrd).w2grid({ name: "vdgvInvoice" + i.windowNo, recordHeight: 30, show: { selectColumn: !1 }, onSelect: function (n) { c(n.recid) }, multiSelect: !1, columns: n, records: r }) } function wi(n, r) { i.vdgvReceipt != null && (i.vdgvReceipt.destroy(), i.vdgvReceipt = null); w2utils.encodeTags(r); i.vdgvReceipt = t(i.reciptgrd).w2grid({ name: "vdgvReceipt" + i.windowNo, recordHeight: 30, show: { selectColumn: !0 }, onSelect: function (n) { this.multiSelect = !0; a(n.recid, !0) }, onUnselect: function (n) { a(n.recid, !1) }, multiSelect: !1, columns: n, records: r }) } function a(n, t) { var o, s, r, u, c, a; if (!(i.vdgvInvoice.records.length < 1)) { if (!i.chkSameProduct.prop("checked")) { setTimeout(function () { i.vdgvReceipt.unselect(Number(n)) }, 10); return } o = -1; s = null; i.vdgvInvoice.getSelection().length > 0 && (o = Number(i.vdgvInvoice.getSelection().toString()), s = { key: i.vdgvInvoice.get(o).M_Product_ID_K, value: i.vdgvInvoice.get(o).M_Product_ID }); var f = 0, h = 0, e = n + "," + i.vdgvReceipt.getSelection().toString().replace(n, ""); if (t && e != null && e.length > 0) for (e = e.replace(/,$/, ""), r = e.toString().split(","), u = 0; u < r.length; u++)if (c = i.vdgvReceipt.get(r[0])._ID, c != null) { if (a = { key: i.vdgvReceipt.get(r[u]).M_Product_ID_K, value: i.vdgvReceipt.get(r[u]).M_Product_ID }, s.key != a.key) { setTimeout(function () { i.vdgvReceipt.unselect(Number(n)) }, 10); return } i.cmbMatchMode.getControl()[0].selectedIndex == b && (f = f + Number(i.vdgvReceipt.get(r[u]).Qty)); f = f - Number(i.vdgvReceipt.get(r[u]).Matched); h++ } k = f; i.txtMatchedTo.setValue(k.toString()); i.txtDifference.setValue(l - k); h <= 0 && i.btnProcess.removeAttr("disabled"); i.lblStatusCount.getControl().text(h) } } var i, h; this.frame; this.windowNo; i = this; this.arrListColumns = []; this.vdgvInvoice = null; this.vdgvReceipt = null; this.lblMatchFrom = new n.Controls.VLabel; this.lblMatchTo = new n.Controls.VLabel; this.lblMatchMode = new n.Controls.VLabel; this.lblBPartner = new n.Controls.VLabel; this.lblProduct = new n.Controls.VLabel; this.lblDateFrom = new n.Controls.VLabel; this.lblDateTo = new n.Controls.VLabel; this.lblInvoice = new n.Controls.VLabel; this.lblReceipt = new n.Controls.VLabel; this.lblMatched = new n.Controls.VLabel; this.lblMatchedTo = new n.Controls.VLabel; this.lblDifference = new n.Controls.VLabel; this.lblStatusInfo = new n.Controls.VLabel; this.lblStatusCount = new n.Controls.VLabel; this.lblSearch = new n.Controls.VLabel; this.cmbMatchFrom = new n.Controls.VComboBox("", !1, !1, !0); this.cmbMatchTo = new n.Controls.VComboBox("", !1, !1, !0); this.cmbMatchMode = new n.Controls.VComboBox("", !1, !1, !0); this.chkIsReturnTrx = null; this.chkSameBPartner = null; this.chkSameProduct = null; this.chkSameQty = null; this.onlyVendor = null; this.onlyProduct = null; this.dtpFrom = null; this.dtpTo = null; this.btnSearch = null; this.btnProcess = null; this.btnToggel = null; this.txtMatched = new n.Controls.VTextBox("", !1, !0, !1); this.txtMatchedTo = new n.Controls.VTextBox("", !1, !0, !1); this.txtDifference = new n.Controls.VTextBox("", !1, !0, !1); this.$root = t("<div style='width: 100%; height: 100%; background-color: white;'>"); this.$busyDiv = t("<div id='testBesy' class='vis-busyindicatorouterwrap'><div class='vis-busyindicatorinnerwrap'><i class='vis-busyindicatordiv'><\/i><\/div><\/div>"); this.sideDiv = null; this.gridSelectDiv = null; this.gridInvoiceDiv = null; this.gridReciptDiv = null; this.processlDiv = null; this.bottumDiv = null; this.bottumButtonDiv = null; this.btnSpaceDiv = null; this.topDiv = null; this.div = null; this.divForGrid = null; this.invoicegrd = null; this.reciptgrd = null; this.invoiceTopDiv = null; var p = !1, v = 260, w = 50, rt = t(window).width() - v, ut = t(window).width() - w, ui = t(window).height() - 240, fi = n.Env.getCtx().getAD_Client_ID(), ei = n.Env.getCtx().getAD_Org_ID(), oi = n.Env.getCtx().getAD_User_ID(), o = 0, f = 1, u = 2, b = 0, pt = 1, si = null, s = "", y = "", hi = "", l = 0, k = 0, ft = "", d = null, g = null, e = !1, r = []; r.push(n.Msg.getElement3(n.Env.getAD_Language(n.Env.getCtx()), "C_Invoice_ID", !1)); r.push(n.Msg.getElement3(n.Env.getAD_Language(n.Env.getCtx()), "M_InOut_ID", !1)); r.push(n.Msg.getElement3(n.Env.getAD_Language(n.Env.getCtx()), "C_Order_ID", !1)); h = []; h.push(n.Msg.getMsg("NotMatched")); h.push(n.Msg.getMsg("Matched")); var ot = "", dt = "", st = "", gt = !1, ni = "", nt = "", tt = "", it = "", ht = "", ct = "", lt = "", at = "", vt = "", yt = ""; this.Initialize = function () { for (var u = 0; u < r.length; u++)this.cmbMatchFrom.getControl().append(" <option value='" + r[u] + "'>" + r[u] + "<\/option>"); for (u = 0; u < h.length; u++)this.cmbMatchMode.getControl().append(" <option value='" + h[u] + "'>" + h[u] + "<\/option>"); if (this.cmbMatchFrom.getControl().prop("selectedIndex", 0), this.cmbMatchMode.getControl().prop("selectedIndex", 0), ai(), li(), ci(), this.btnToggel = this.$root.find("#btnToggelDiv_" + i.windowNo), this.gridSelectDiv = this.$root.find("#divForGrid_" + i.windowNo), this.cmbMatchFrom.getControl() != null && this.cmbMatchFrom.getControl().change(function () { i.$busyDiv[0].style.visibility = "visible"; wt(); bt(); i.$busyDiv[0].style.visibility = "hidden" }), this.cmbMatchTo.getControl() != null && this.cmbMatchTo.getControl().change(function () { i.$busyDiv[0].style.visibility = "visible"; kt(); i.$busyDiv[0].style.visibility = "hidden" }), this.cmbMatchMode.getControl() != null && this.cmbMatchMode.getControl().change(function () { i.cmbMatchMode.getControl()[0].selectedIndex == b ? i.btnProcess.text(n.Msg.getMsg("Match")) : i.btnProcess.text(n.Msg.getMsg("Unmatch")) }), this.btnSearch != null) this.btnSearch.on(n.Events.onTouchStartOrClick, function () { i.$busyDiv[0].style.visibility = "visible"; et() }); if (this.btnProcess != null) this.btnProcess.on(n.Events.onTouchStartOrClick, function () { e || (i.$busyDiv[0].style.visibility = "visible", e = !0, vi()) }); if (this.btnToggel != null) this.btnToggel.on(n.Events.onTouchStartOrClick, function () { p ? (i.btnToggel.animate({ borderSpacing: 0 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), p = !1, i.btnSpaceDiv.animate({ width: v }, "slow"), i.gridSelectDiv.animate({ width: rt }, "slow"), i.invoiceTopDiv.animate({ width: rt }, "slow"), i.div.css("display", "block"), i.sideDiv.animate({ width: v }, "slow", null, function () { i.vdgvInvoice.resize(); i.vdgvReceipt.resize() })) : (i.btnToggel.animate({ borderSpacing: 180 }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), p = !0, i.btnSpaceDiv.animate({ width: w }, "slow"), i.sideDiv.animate({ width: w }, "slow"), i.div.css("display", "none"), i.invoiceTopDiv.animate({ width: ut }, "slow"), i.gridSelectDiv.animate({ width: ut }, "slow", null, function () { i.vdgvInvoice.resize(); i.vdgvReceipt.resize() })) }); if (this.chkSameBPartner.change(function () { i.$busyDiv[0].style.visibility = "visible"; c() }), this.chkSameQty.change(function () { i.$busyDiv[0].style.visibility = "visible"; c() }), this.chkSameProduct.change(function () { i.$busyDiv[0].style.visibility = "visible"; c() }), d != null) d.on(n.Events.onTouchStartOrClick, function () { i.onlyVendor.isReadOnly || i.onlyVendor.setValue(null, !1, !0) }); if (g != null) g.on(n.Events.onTouchStartOrClick, function () { i.onlyProduct.isReadOnly || i.onlyProduct.setValue(null, !1, !0) }); i.$busyDiv[0].style.visibility = "hidden" }; this.display = function () { wt() }; this.getRoot = function () { return this.$root }; this.callConsolidate = function () { t.ajax({ url: n.Application.contextUrl + "Common/Consolidate", dataType: "json", async: !0, success: function () { } }); i.vdgvReceipt.multiSelect = !0; var r = "vdgvReceipt" + i.windowNo; w2ui[r].multiSelect = !0 }; this.disposeComponent = function () { this.btnSearch && this.btnSearch.off(n.Events.onTouchStartOrClick); this.btnProcess && this.btnProcess.off(n.Events.onTouchStartOrClick); this.btnToggel && this.btnToggel.off(n.Events.onTouchStartOrClick); this.frame = null; this.windowNo = null; this.arrListColumns = null; this.vdgvInvoice = null; this.vdgvReceipt = null; this.lblMatchFrom = null; this.lblMatchTo = null; this.lblMatchMode = null; this.lblBPartner = null; this.lblProduct = null; this.lblDateFrom = null; this.lblDateTo = null; this.lblInvoice = null; this.lblReceipt = null; this.lblMatched = null; this.lblMatchedTo = null; this.lblDifference = null; this.lblStatusInfo = null; this.lblStatusCount = null; this.lblSearch = null; this.cmbMatchFrom = null; this.cmbMatchTo = null; this.cmbMatchMode = null; this.chkIsReturnTrx = null; this.chkSameBPartner = null; this.chkSameProduct = null; this.chkSameQty = null; this.onlyVendor = null; this.onlyProduct = null; this.dtpFrom = null; this.dtpTo = null; this.btnSearch = null; this.btnProcess = null; this.btnToggel = null; this.txtMatched = null; this.txtMatchedTo = null; this.txtDifference = null; this.$root = null; this.$busyDiv = null; this.sideDiv = null; this.gridSelectDiv = null; this.gridInvoiceDiv = null; this.gridReciptDiv = null; this.processlDiv = null; this.bottumDiv = null; this.btnSpaceDiv = null; p = null; v = null; w = null; rt = null; ut = null; ui = null; fi = null; ei = null; oi = null; o = null; f = null; u = null; b = null; pt = null; si = null; s = null; y = null; hi = null; l = null; k = null; i = null; r = null; h = null; this.disposeComponent = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (t, i) { this.frame = i; this.windowNo = t; n.Env.getCtx().setContext(this.windowNo, "IsSOTrx", "Y"); try { var r = this.Initialize() } catch (u) { } this.frame.getContentGrid().append(this.getRoot()); this.display(); this.callConsolidate() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VMatch = i }(VIS, jQuery), function (n, t) { function i() { function dt() { var g, w, s, d; setBusy(!0); v.setValue(!0); g = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; u = t("<div id='sideDiv_" + i.windowNo + "' class='vis-archive-left-sidebar vis-leftsidebarouterwrap'>"); ht = t("<div id='btnSpaceDiv_" + i.windowNo + "' class='vis-archive-l-s-head'><button id='btnSpace_" + i.windowNo + "' class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>"); p = t("<div class='vis-archive-l-s-content' id='parameterDiv_" + i.windowNo + "'>"); u.append(ht).append(p); g = n.Application.contextUrl + "Areas/VIS/Images/base/Refresh24.png"; e = t("<button id='btnRefresh_" + i.windowNo + "' style='margin-left: 12px;' class='VIS_Pref_btn-2 vis-frm-button vis-pull-left'><i class='vis vis-refresh'><\/i><\/button>"); y = t("<input id='btnCreateCharge_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' type='button' value='" + n.Msg.getMsg("CreateNew", !1, !1) + "'>"); a = t("<input id='btnCancel_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' type='button' value='" + n.Msg.getMsg("Cancel", !1, !1) + "'>"); l = t("<input id='btnAccount_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' type='button' value='" + n.Msg.getMsg("ChargeFromAccount", !1, !1) + "'>"); var b = t("<table style='width: 100%;'>"), r = t("<tr>"), o = t("<td style='padding: 0px 10px 0px;'>"); p.append(b); r = t("<tr>"); o = t("<td style='padding: 0px 10px 0px;'>"); w = t('<div class="input-group vis-input-wrap">'); s = t('<div class="vis-control-wrap">'); b.append(r); r.append(o); o.append(w); w.append(s); s.append(h.getControl().attr("data-placeholder", "").attr("placeholder", " ")); s.append(tt.getControl().addClass("VIS_Pref_Label_Font")); r = t("<tr>"); o = t("<td style='padding: 0px 10px 0px;'>"); w = t('<div class="input-group vis-input-wrap">'); s = t('<div class="vis-control-wrap">'); b.append(r); r.append(o); o.append(w); w.append(s); s.append(c.getControl().attr("data-placeholder", "").attr("placeholder", " ")); s.append(it.getControl().addClass("VIS_Pref_Label_Font")); r = t("<tr>"); o = t("<td style='padding: 0px 10px 0px;'>"); b.append(r); r.append(o); o.append(v.getControl()); ut = t("<div class='vis-frm-bot-btn-wrp'>"); d = t("<div class='vis-frm-bttsec'>"); d.append(l).append(a); ut.append(y).append(e); f = t("<div id='rightSideGridDiv_" + i.windowNo + "' class='vis-frm-grid-wrap'>"); rt = t("<div id='gridDiv_" + i.windowNo + "' class='vis-frm-grid-inn'>"); f.append(rt); f.append(d); u.append(ut); k.append(st); k.append(u).append(f) } function gt(u) { r != null && (r.destroy(), r = null); s.length == 0 && (s.push({ field: "C_ElementValue_ID", caption: n.Msg.getMsg("C_ELEMENTVALUE_ID"), sortable: !0, size: "16%", min: 150, hidden: !0 }), s.push({ field: "Value", caption: n.Msg.getMsg("SearchKey"), sortable: !0, size: "25%", min: 150, hidden: !1 }), s.push({ field: "Name", caption: n.Msg.getMsg("Name"), sortable: !0, size: "25%", min: 150, hidden: !1 }), s.push({ field: "Expense", caption: n.Msg.getMsg("Expense"), sortable: !0, size: "25%", min: 150, hidden: !1, editable: { type: "checkbox" } })); w2utils.encodeTags(u); r = t(rt).w2grid({ name: "gridAccountElement" + i.windowNo, recordHeight: 40, show: { selectColumn: !0 }, multiSelect: !0, columns: s, records: u }) } function at() { var r = []; nt = n.Env.getCtx().getContextAsInt("$C_AcctSchema_ID"); ct = n.Env.getCtx().getAD_Client_ID(); lt = n.Env.getCtx().getAD_Org_ID(); t.ajax({ url: n.Application.contextUrl + "VCharge/VChargeLodGrideData", dataType: "json", data: { mcAcctSchemaID: nt, mADClientId: ct }, success: function (n) { var e, u, f, t, i; if (n.result.meID != 0) { if (n.result && n.result.VchargeMCElemTaxCatID) { if (e = n.result.VchargeMCElemTaxCatID, et = n.result.VchargeMCElemTaxCatID[0].mCElementID, et == 0) return; ot = n.result.VchargeMCElemTaxCatID[0].mCTaxCategoryID } if (n.result && n.result.VchargeCElementValue) { for (u = n.result.VchargeCElementValue, f = 1, t = 0; t < u.length; t++)i = {}, i.C_ElementValue_ID = u[t].C_ElementValue_ID, i.Value = u[t].Value, i.Name = u[t].Name, i.Expense = u[t].Expense == "false" ? !1 : !0, i.recid = f, f++, r.push(i); gt(r); setBusy(!1) } } }, error: function (n) { setBusy(!1); i.log.info(n) } }) } function ni(i, r, u, f, e) { t.ajax({ url: n.Application.contextUrl + "VCharge/CreateCharge", dataType: "json", data: { m_C_AcctSchema_ID: i, m_C_TaxCategory_ID: r, name: u, C_ElementValue_ID: f, expense: e }, success: function (t) { if (t.ID == 0) { n.ADialog.info("ChargeNotCreated", !0, null); setBusy(!1); return } h.ctrl.val(""); c.ctrl.val(""); var i = t.ID; n.ADialog.info("ChargeCreated", !0, null); at() } }) } function ti(i, r, u, f, e) { t.ajax({ url: n.Application.contextUrl + "VCharge/CreateChargeByList", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ AcctSchemaID: i, TaxCategoryID: r, namepara: u, ElementValuID: f, expense: e }), success: function (t) { t.listCreatedP && n.ADialog.info("ChargeCreated", !0, null); t.listRejectedP && n.ADialog.info("ChargeNotCreated", !0, null); setBusy(!1) } }) } this.frame; this.windowNo; var i = this, s = [], r = null; this.log = n.Logging.VLogger.getVLogger("VCharge"); var vt = !1, yt = !1, b = !1, tt = new n.Controls.VLabel(n.Msg.getMsg("SearchKey", !1, !1), "SearchKey", !1, !0), it = new n.Controls.VLabel(n.Msg.getMsg("Name", !1, !1), "Name", !1, !0), h = new n.Controls.VTextBox("SearchKey", !0, !1, !0, 50, 100, null, null, !1), c = new n.Controls.VTextBox("Name", !1, !1, !0, 50, 100, null, null, !1), v = new n.Controls.VCheckBox("Expense", !1, !1, !0, n.Msg.getMsg("Expense", !1, !1), null), pt = new n.Controls.VCheckBox("SelectAll", !1, !1, !0, n.Msg.getMsg("SelectAll", !1, !1), null), y = null, l = null, wt = new n.Controls.VLabel; this.log = n.Logging.VLogger.getVLogger("VCharge"); var k = t("<div style='width: 100%; height: 100%; background-color: white; '>"), st = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), u = null, f = null, ht = null, p = null, rt = null, ut = null, a = null, e = null, o = null, w = 260, d = 50, g = t(window).width() - (w + 20 + 5), ft = t(window).width() - (20 + d), bt = g + w + 5, kt = t(window).height() - 210, et = 0, nt = 0, ot = 0, ct = 0, lt = 0; setBusy = function (n) { st.css("display", n ? "block" : "none") }; this.Initialize = function () { if (dt(), o = k.find("#btnSpace_" + i.windowNo), a != null) a.on(n.Events.onTouchStartOrClick, function () { i.dispose() }); if (e != null) e.on(n.Events.onTouchStartOrClick, function () { h.ctrl.val(""); c.ctrl.val(""); setBusy(!0); at() }); if (o != null) o.on(n.Events.onTouchStartOrClick, function () { var i = 0; b ? (i = n.Application.isRTL ? 180 : 0, y.show(), e.show(), tt.getControl().show(), it.getControl().show(), h.getControl().show(), c.getControl().show(), v.getControl().show(), o.animate({ borderSpacing: i }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), b = !1, f.animate({ width: g }, "slow"), p.css("display", "block"), u.animate({ width: w }, "slow", null, function () { r.resize() })) : (i = n.Application.isRTL ? 0 : 180, y.hide(), e.hide(), tt.getControl().hide(), it.getControl().hide(), h.getControl().hide(), c.getControl().hide(), v.getControl().hide(), o.animate({ borderSpacing: i }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), b = !0, u.animate({ width: d }, "slow"), p.css("display", "none"), f.animate({ width: ft }, "slow", null, function () { r.resize() })) }); if (this.sizeChanged = function (n, t) { g = t - (w + 1); ft = t - (d + 1); b == !0 ? (u.animate({ width: d }, "slow"), f.animate({ width: ft }, "slow", null, function () { r.resize() })) : (f.animate({ width: g }, "slow"), u.animate({ width: w }, "slow", null, function () { r.resize() })) }, l != null) l.on(n.Events.onTouchStartOrClick, function () { var i, t, n; setBusy(!0); var u = [], f = [], e = []; if (r) { if (i = r.getSelection(), !i) { setBusy(!1); return } if (i.length <= 0) { setBusy(!1); return } for (t = i.toString().split(","), n = 0; n < t.length; n++)u[n] = r.get(t[n]).C_ElementValue_ID, f[n] = r.get(t[n]).Name, e[n] = r.get(t[n]).Expense; if (u.length == 0) return setBusy(!1), ""; ti(nt, ot, f, u, e) } }); if (y != null) y.on(n.Events.onTouchStartOrClick, function () { var u, f, r; if (setBusy(!0), u = v.getValue(), f = h.getValue().trim(), f.length == 0) { n.ADialog.warn("SearchKeyMandatory", !0, null); setBusy(!1); return } if (r = c.getValue().trim(), r.length == 0) { n.ADialog.warn("NameMandatory", !0, null); setBusy(!1); return } t.ajax({ url: n.Application.contextUrl + "VCharge/CreateElementValue", dataType: "json", data: { m_AD_Org_ID: lt, value: f, name: r, expense: u, m_C_Element_ID: et }, success: function (t) { if (t.ID == 0) { i.log.saveError("ChargeNotCreated", t.Msg); n.ADialog.warn(t.Msg, !0, null); setBusy(!1); return } ni(nt, ot, r, t.ID, u) } }) }) }; this.display = function () { setTimeout(at(), 5) }; this.getRoot = function () { return k }; this.disposeComponent = function () { a && a.off(n.Events.onTouchStartOrClick); e && e.off(n.Events.onTouchStartOrClick); o && o.off(n.Events.onTouchStartOrClick); l && l.off(n.Events.onTouchStartOrClick); i.windowNo = null; s = null; r = null; vt = null; yt = null; b = null; tt = null; it = null; h = null; c = null; v = null; pt = null; btnCreateCharg = null; l = null; wt = null; i.log = null; k = null; st = null; u = null; f = null; ht = null; p = null; rt = null; ut = null; a = null; e = null; o = null; w = null; d = null; g = null; ft = null; bt = null; kt = null; et = null; nt = null; ot = null; ct = null; lt = null; i = null; this.getRoot = null; this.disposeComponent = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.display() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VCharge = i }(VIS, jQuery), function (n, t) { function i() { function ti() { var k, y, o, u, p; setBusy(!0); k = n.Application.contextUrl + "Areas/VIS/Images/base/arrow-left.png"; s = t("<div id='sideDiv_" + i.windowNo + "' class='vis-archive-left-sidebar'>"); v = t("<div id='btnSpaceDiv_" + i.windowNo + "'  class='vis-archive-l-s-head'><button id='btnSpace_" + i.windowNo + "' class='vis-archive-sb-t-button'><i class='vis vis-arrow-left'><\/i><\/button><\/div><\/div>"); l = t("<div class='vis-archive-l-s-content vis-leftsidebarouterwrap' id='parameterDiv_" + i.windowNo + "'>"); s.append(v).append(l); k = n.Application.contextUrl + "Areas/VIS/Images/base/Refresh24.png"; f = t("<button id='btnRefresh_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button'><i class='vis vis-refresh'><\/i><\/button>"); c = t("<input id='btnOk_" + i.windowNo + "' class='VIS_Pref_btn-2 vis-frm-button' style='min-width: 70px;' type='button' value='" + n.Msg.getMsg("OK", !1, !1) + "'>"); y = t("<table style='width: 100%;'>"); l.append(y); tr = t("<tr>"); td = t("<td style='padding: 10px 10px 0px'>"); o = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); y.append(tr); tr.append(td); td.append(o); o.append(u); u.append(b.getControl().css("display", "inline-block")); u.append(r.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px;'>"); o = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); y.append(tr); tr.append(td); td.append(o); o.append(u); u.append(it.getControl().css("display", "inline-block")); u.append(w.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px'>"); o = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); y.append(tr); tr.append(td); td.append(o); o.append(u); u.append(rt.getControl().css("display", "inline-block")); u.append(kt.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); tr = t("<tr>"); td = t("<td style='padding: 0px 10px 0px'>"); o = t('<div class="input-group vis-input-wrap">'); u = t('<div class="vis-control-wrap">'); y.append(tr); tr.append(td); td.append(o); o.append(u); u.append(ut.getControl().css("display", "inline-block")); u.append(dt.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")); g = t("<div class='vis-frm-bot-btn-wrp'>"); p = t("<div class='vis-frm-bot-btn-wrp'>"); p.append(c); g.append(f); h = t("<div id='rightSideGridDiv_" + i.windowNo + "' class='vis-frm-grid-wrap'>"); d = t("<div id='gridDiv_" + i.windowNo + "' class='vis-frm-grid-inn'>"); d.append(e); h.append(d); h.append(p); s.append(g); a.append(ft); a.append(s).append(h) } function ii() { st.push({ Key: "0", Name: n.Msg.getMsg("ModeView", !1, !1) }); ui(); ri() } function ri() { t.ajax({ url: n.Application.contextUrl + "Common/GetDataQueryAttribute", type: "GET", dataType: "json", async: !1, success: function (n) { if (n.lst) { u = n.lst; for (var t = 0; t < u.length; t++)at(b.getControl(), u[t].GetKeyNamePair, t), at(it.getControl(), u[t].GetKeyNamePair, t) } n.priceList && ot(rt.getControl(), n.priceList); n.whList && ot(ut.getControl(), n.whList); setBusy(!1) } }) } function ui() { ot(k.getControl(), st) } function ot(n, t) { for (var i = 0; i < t.length; i++)n.append(" <option selected value='" + t[i].Key + "' >" + t[i].Name + "<\/option>"); n.prop("selectedIndex", 0) } function at(n, t, i) { i == 0 && n.append(" <option selected value='0' ><\/option>"); n.append(" <option selected value='" + t.Key + "' >" + t.Name + "<\/option>"); n.prop("selectedIndex", 0) } function fi(i, r) { var s, h, o, f, u; for (r = r < 2 ? 2 : r, i += 1, row = 0; row < i; row++)for (s = t("<tr id='row_" + row + "' >"), e.append(s), col = 0; col < r; col++)h = t("<td id='col_" + col + "'  style='padding: 4px 15px 2px;'>"), s.append(h); o = new n.Controls.VLabel; o.getControl().text("Mode"); f = e.find("#row_0"); r == 2 ? (u = f.find("#col_" + (r - 1)), u.append(k.getControl().css("display", "inline-block").css("width", "236px").css("height", "30px")), u = f.find("#col_" + (r - 2)), u.append(o.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))) : (u = f.find("#col_2"), u.append(k.getControl().css("display", "inline-block").css("width", "236px").css("height", "30px")), u = f.find("#col_1"), u.append(o.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))) } function ei(r, u) { var f = 0, e = 0, o = 0, s = 0; r && (f = r.GetM_Attribute_ID, e = r.GetM_AttributeValue_ID); u && (o = u.GetM_Attribute_ID, s = u.GetM_AttributeValue_ID); t.ajax({ url: n.Application.contextUrl + "Common/GetGridElement", dataType: "json", data: { xM_Attribute_ID: f, xM_AttributeValue_ID: e, yM_Attribute_ID: o, yM_AttributeValue_ID: s, M_PriceList_Version_ID: ht, M_Warehouse_ID: ct, windowNo: i.windowNo }, async: !1, success: function () { setBusy(!1) } }) } function oi() { var h, c, a, t, f, p, w; if (b != null && !tt) { if (h = b.getControl()[0].selectedIndex, c = it.getControl()[0].selectedIndex, h == c) { i.log.warning("Same Attribute Selected"); return } tt = !0; ht = rt.getControl().find("option:selected").val(); ct = ut.getControl().find("option:selected").val(); var v = 2, o = [], s = [], l = null, y = null; for (h > 0 && (o = u[h - 1].GetMAttributeValues), o != null && (v = o.length + 1, i.log.info("X - " + u[h - 1].GetName + " #" + o.length)), a = 2, c > 0 && (s = u[c - 1].GetMAttributeValues), s.length > 0 && (a = s.length + 1, i.log.info("Y - " + u[c - 1].GetName + " #" + s.length)), i.log.info("Rows=" + a + " - Cols=" + v), fi(a, v), t = null, f = null, row = 0; row < a; row++)for (col = 0; col < v; col++)o != null && (l = o[col]), s != null && (y = s[row]), row == 0 && col == 0 ? (p = new n.Controls.VLabel, w = new n.Controls.VLabel, o != null && (p.getControl().text(u[h - 1].GetName), t = e.find("#row_1"), f = t.find("#col_" + col), f.append(p.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))), s.length > 0 && (w.getControl().text(u[c - 1].GetName), t = e.find("#row_1"), f = t.find("#col_" + col), f.append(w.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))), l != null && (r = new n.Controls.VLabel, r.getControl().text(l.Name), t = e.find("#row_1"), f = t.find("#col_" + (col + 1)), f.append(r.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font")))) : row == 0 ? l != null && (r = new n.Controls.VLabel, r.getControl().text(l.Name), t = e.find("#row_1"), f = t.find("#col_" + (col + 1)), f.append(r.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))) : col == 0 ? y != null && (r = new n.Controls.VLabel, r.getControl().text(y.Name), t = e.find("#row_" + row + 1), f = t.find("#col_" + col), f.append(r.getControl().css("display", "inline-block").addClass("VIS_Pref_Label_Font"))) : ei(l, y, col, row + 1); tt = !1 } } function si() { var n = k.getControl().find("option:selected").val(); n != wt && n != bt && n == pt } this.frame; this.windowNo; var i = this, vt = !1, yt = !1, p = !1, tt = !1, st = [], pt = 0, wt = 0, bt = 0, ht = 0, ct = 0, u = [], r = new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(), "M_Attribute_ID"), "M_Attribute_ID", !1, !0), w = new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(), "M_Attribute_ID"), "M_Attribute_ID", !1, !0), kt = new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(), "M_PriceList_ID"), "M_PriceList_ID", !1, !0), dt = new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(), "M_Warehouse_ID"), "M_Warehouse_ID", !1, !0), hi = new n.Controls.VLabel(n.Msg.getMsg("Mode", !1, !1), "Mode", !1, !0), b = new n.Controls.VComboBox("", !1, !1, !0), it = new n.Controls.VComboBox("", !1, !1, !0), rt = new n.Controls.VComboBox("", !1, !1, !0), ut = new n.Controls.VComboBox("", !1, !1, !0), k = new n.Controls.VComboBox("", !1, !1, !0); this.log = n.Logging.VLogger.getVLogger("VAttributeGrid"); var a = t("<div class='vis-forms-container' style='width: 100%; height: 100%; background-color: white; '>"), ft = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), s = null, h = null, v = null, l = null, d = null, g = null, c = null, f = null, o = null, y = 260, nt = 50, et = t(window).width() - y, lt = t(window).width() - nt, gt = et + y + 5, ni = t(window).height() - 210, e = t("<table style='width: 100%;'>"); setBusy = function (n) { ft.css("display", n ? "block" : "none") }; this.Initialize = function () { if (ti(), o = a.find("#btnSpace_" + i.windowNo), c != null) c.on(n.Events.onTouchStartOrClick, function () { si(); i.dispose() }); if (f != null) f.on(n.Events.onTouchStartOrClick, function () { setBusy(!0); e.empty(); oi(); setBusy(!1) }); if (o != null) var u = 0; o.on(n.Events.onTouchStartOrClick, function () { p ? (f.show(), r.getControl().show(), w.getControl().show(), u = n.Application.isRTL ? 180 : 0, o.animate({ borderSpacing: u }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), p = !1, h.animate({ width: et }, "slow"), l.css("display", "block"), v.animate({ width: y }, "slow"), s.animate({ width: y }, "slow")) : (u = n.Application.isRTL ? 0 : 180, f.hide(), r.getControl().hide(), w.getControl().hide(), o.animate({ borderSpacing: u }, { step: function (n) { t(this).css("-webkit-transform", "rotate(" + n + "deg)"); t(this).css("-moz-transform", "rotate(" + n + "deg)"); t(this).css("transform", "rotate(" + n + "deg)") }, duration: "slow" }, "linear"), p = !0, h.animate({ width: lt }, "slow"), s.animate({ width: nt }, "slow"), v.animate({ width: nt }, "slow"), l.css("display", "none")) }) }; this.display = function () { setTimeout(ii(), 5) }; this.getRoot = function () { return a }; this.disposeComponent = function () { c && c.off(n.Events.onTouchStartOrClick); f && f.off(n.Events.onTouchStartOrClick); o && o.off(n.Events.onTouchStartOrClick); i.windowNo = null; vt = null; yt = null; p = null; r = null; w = null; i.log = null; a = null; ft = null; s = null; h = null; v = null; l = null; d = null; g = null; c = null; f = null; o = null; y = null; nt = null; et = null; lt = null; gt = null; ni = null; i = null; this.getRoot = null; this.disposeComponent = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.display() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VAttributeGrid = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function r() { function dt() { w = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); w[0].style.visibility = "hidden"; b.append(w) } function o(n) { w[0].style.visibility = n ? "visible" : "hidden" } function gt() { var f = t(window).height() * (94 / 100), i, u; k = t("<div class='vis-mainContainer'>"); i = " <div class='vis-pSelectInfo vis-leftsidebarouterwrap'><div class='vis-pSelectInner'> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <select id='VIS_cmbBankAccount_" + r.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "C_BankAccount_ID") + " <\/label><\/div><\/div> <\/div> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrentBal_" + r.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.getMsg("CurrentBalance") + ' <\/label><\/div><\/div>  <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbbusinessPartner_' + r.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "C_BPartner_ID") + ' <\/label><\/div><\/div>  <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <input  id=\'VIS_cmbPayDate_' + r.windowNo + "'type='date' data-placeholder='' placeholder=' '> <label>" + n.Msg.translate(n.Env.getCtx(), "PayDate") + ' <\/label><\/div><\/div>  <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbPaymentMethod_' + r.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "PaymentRule") + " <\/label><\/div><\/div>  <\/div> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='number' id='VIS_txtPaymentAmount_" + r.windowNo + "' disabled MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.getMsg("PaymentAmount") + " <\/label><\/div><\/div>  <\/div> <div class='vis-paymentselect-field'> <input type='checkbox' id='VIS_chkOnlyDue_" + r.windowNo + "' data-placeholder='' placeholder=' '> <label for='VIS_chkOnlyDue_" + r.windowNo + "'>" + n.Msg.getMsg("OnlyDue") + " <\/label>  <\/div> <div class='vis-paymentselect-field'> <label for='VIS_lblShowDetail_" + r.windowNo + "'><\/label> <\/div> <\/div> <div class='vis-paymentselect-field'> <button class='VIS_Pref_btn-2' disabled id='VIS_btnRefresh_" + r.windowNo + "' style='margin-top: 0px;'><i class='vis vis-refresh'><\/i><\/button> <\/div> <\/div>"; d = t("<div class='vis-pSelectIionGrid'>"); u = " <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_" + r.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("Cancel") + "' ><\/input> <input id='VIS_btnOK_" + r.windowNo + "' disabled class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("OK") + "' ><\/input> <\/div> <\/div>"; k.append(t(i)).append(d).append(t(u)); b.append(k); ni() } function ni() { f = t("#VIS_cmbBankAccount_" + r.windowNo); s = t("#VIS_cmbbusinessPartner_" + r.windowNo); h = t("#VIS_cmbPaymentMethod_" + r.windowNo); tt = t("#VIS_txtCurrentBal_" + r.windowNo); y = t("#VIS_chkOnlyDue_" + r.windowNo); a = t("#VIS_txtPaymentAmount_" + r.windowNo); ut = t("#VIS_lblShowDetail_" + r.windowNo); p = t("#VIS_btnRefresh_" + r.windowNo); v = t("#VIS_cmbPayDate_" + r.windowNo); g = t("#VIS_btnOK_" + r.windowNo); it = t("#VIS_btnCancel_" + r.windowNo); var n = new Date, i = ("0" + n.getDate()).slice(-2), u = ("0" + (n.getMonth() + 1)).slice(-2), e = n.getFullYear() + "-" + u + "-" + i; v.val(e); ft(); ti(); ri(); l.BankAccount.length > 0 && et() } function ti() { p.on("click", function () { o(!0); ei() && window.setTimeout(function () { ii(); o(!1) }, 20) }); g.on("click", function () { var t, i; if (e.getSelection().length <= 0) return n.ADialog.info("PleaseSelectRecord"), !1; if (t = e.getSelection(), t.length > 0) { for (i = 0; i < t.length; i++)rt[t[i]].SELECT = !0; o(!0); window.setTimeout(function () { oi() }, 20) } }); it.on("click", function () { r.dispose() }); f.on("change", function () { o(!0); window.setTimeout(function () { fi(); et(); o(!1) }, 20) }); y.on("click", function () { p.trigger("click") }) } function ft() { try { e != null && (e.destroy(), e = null) } catch (t) { } u.length == 0 && (u.push({ field: "SELECT", caption: n.Msg.getMsg("SELECT"), sortable: !0, size: "100px", hidden: !0 }), u.push({ field: "C_INVOICE_ID", caption: n.Msg.getMsg("Invoice"), sortable: !0, size: "100px" }), u.push({ field: "DUEDATE", caption: n.Msg.getMsg("DueDate"), sortable: !0, size: "100px", render: function (n) { var t; return t = n.changes == undefined || n.changes.DUEDATE == undefined ? n.DUEDATE : n.changes.DUEDATE, new Date(t).toLocaleDateString() } }), u.push({ field: "BUSINESSPARTNER", caption: n.Msg.getMsg("BusinessPartner"), sortable: !0, size: "100px" }), u.push({ field: "DOCUMENTNO", caption: n.Msg.getMsg("Document_No"), sortable: !0, size: "100px" }), u.push({ field: "CURRENCY", caption: n.Msg.getMsg("Currency"), sortable: !0, size: "100px" }), u.push({ field: "GRANDTOTAL", caption: n.Msg.getMsg("GrandTotal"), sortable: !0, size: "100px", render: function (n) { var t = n.GRANDTOTAL; return parseFloat(t).toLocaleString() } }), u.push({ field: "DISCOUNTAMOUNT", caption: n.Msg.getMsg("DiscountAmt"), sortable: !0, size: "100px", render: function (n) { var t = n.DISCOUNTAMOUNT; return parseFloat(t).toLocaleString() } }), u.push({ field: "DISCOUNTDATE", caption: n.Msg.getMsg("DiscountDate"), sortable: !0, size: "100px", render: function (n) { var t; return t = n.changes == undefined || n.changes.DISCOUNTDATE == undefined ? n.DISCOUNTDATE : n.changes.DISCOUNTDATE, new Date(t).toLocaleDateString() } }), u.push({ field: "AMOUNTDUE", caption: n.Msg.getMsg("AmountDue"), sortable: !0, size: "100px", render: function (n) { var t = n.AMOUNTDUE; return parseFloat(t).toLocaleString() } }), u.push({ field: "PAYMENTAMOUNT", caption: n.Msg.getMsg("PaymentAmount"), sortable: !0, size: "100px", render: function (n) { var t = n.PAYMENTAMOUNT; return parseFloat(t).toLocaleString() } })); e = d.w2grid({ name: "gridPaymentSelection_" + r.windowNo, recordHeight: 40, show: { selectColumn: !0 }, multiSelect: !0, columns: u, records: c }); e.on("select", function (t) { nt += n.Utility.Util.getValueOfDecimal(c[t.index].PAYMENTAMOUNT); a.val(nt); var i = e.getSelection(); g.removeAttr("disabled") }); e.on("unselect", function (t) { nt -= n.Utility.Util.getValueOfDecimal(c[t.index].PAYMENTAMOUNT); a.val(nt); var i = e.getSelection() }) } function ii() { var u, r, e; c = []; u = 0; r = []; r.push(f.val()); l != null ? (e = jQuery.grep(l.BankAccount, function (t) { return t.ID == n.Utility.Util.getValueOfInt(f.val()) }), e.length > 0 ? r.push(e[0].Currency_ID) : r.push(0)) : r.push(0); r.push(s.val()); r.push(v.val()); r.push(h.val()); r.push(a.val()); r.push(y.prop("checked")); t.ajax({ url: n.Application.contextUrl + "VPaySelect/GetGridRecords", async: !1, datatype: "Json", type: "POST", cache: !1, contentType: "application/json; charset=utf-8", data: JSON.stringify(r), success: function (n) { var t = JSON.parse(n), r; if (c = [], t != null || t != undefined) for (rt = t, i = 0; i < t.length; i++)r = {}, r.SELECT = t[i].SELECT, r.C_INVOICE_ID = t[i].C_INVOICE_ID, r.DUEDATE = t[i].DUEDATE, r.BUSINESSPARTNER = t[i].BUSINESSPARTNER, r.DOCUMENTNO = t[i].DOCUMENTNO, r.CURRENCY = t[i].CURRENCY, r.GRANDTOTAL = t[i].GRANDTOTAL, r.DISCOUNTAMOUNT = t[i].DISCOUNTAMOUNT, r.DISCOUNTDATE = t[i].DISCOUNTDATE, r.AMOUNTDUE = t[i].AMOUNTDUE, r.PAYMENTAMOUNT = t[i].PAYMENTAMOUNT, r.recid = u, u++, c.push(r) }, error: function (n) { console.log(n) } }); ft() } function ri() { t.ajax({ url: n.Application.contextUrl + "VPaySelect/GetDetail", async: !1, datatype: "Json", type: "GET", cache: !1, success: function (n) { var t = JSON.parse(n); l = t; (t != null || t != undefined) && t.BankAccount.length > 0 && (p.removeAttr("disabled"), ui(t)); o(!1) }, error: function (n) { console.log(n); o(!1) } }) } function ui(n) { var i; if (n.BankAccount != null || n.BankAccount.length > 0) { f.empty(); for (i in n.BankAccount) f.append(t('<Option value="' + n.BankAccount[i].ID + '">' + n.BankAccount[i].Value + "<\/option>")) } if (n.BusinessPartner != null || n.BusinessPartner.length > 0) { s.empty(); s.append(t('<Option value="-1"><\/option>')); for (i in n.BusinessPartner) s.append(t('<Option value="' + n.BusinessPartner[i].ID + '">' + n.BusinessPartner[i].Value + "<\/option>")) } if (n.PaymentMethod != null || n.PaymentMethod.length > 0) { h.empty(); for (i in n.PaymentMethod) h.append(t('<Option value="' + n.PaymentMethod[i].ID + '">' + n.PaymentMethod[i].Value + "<\/option>")) } o(!1) } function fi() { t.ajax({ url: n.Application.contextUrl + "VPaySelect/GetPaymentMethod", async: !1, datatype: "Json", type: "GET", cache: !1, data: { C_BankAccount_ID: parseInt(f.val()) }, success: function (n) { var i = JSON.parse(n), r; if ((i != null || i != undefined) && (i != null || i.length > 0)) { h.empty(); for (r in i) h.append(t('<Option value="' + i[r].ID + '">' + i[r].Value + "<\/option>")) } }, error: function (n) { console.log(n) } }) } function et() { var t = jQuery.grep(l.BankAccount, function (t) { return t.ID == n.Utility.Util.getValueOfInt(f.val()) }); t.length > 0 && tt.val(t[0].CurrentBalance + " " + t[0].ISOCode) } function ei() { return s != null && s.val() <= 0 ? (n.ADialog.info("SelectBusinessPartnerFirst"), o(!1), !1) : !0 } function oi() { var i = [], u; i.push(f.val()); l != null ? (u = jQuery.grep(l.BankAccount, function (t) { return t.ID == n.Utility.Util.getValueOfInt(f.val()) }), i.push(u[0].Currency_ID)) : i.push(0); i.push(s.val()); i.push(v.val()); i.push(h.val()); i.push(a.val()); i.push(y.prop("checked")); i.push(JSON.stringify(rt)); t.ajax({ url: n.Application.contextUrl + "VPaySelect/GeneratePaymentSelection", async: !1, datatype: "Json", type: "POST", cache: !1, contentType: "application/json; charset=utf-8", data: JSON.stringify(i), success: function (t) { var f = JSON.parse(t), i, u; (f != null || f != undefined) && (r.dispose(), i = new n.CFrame, u = new n.Apps.AForms.VPayPrint, i.setName(n.Msg.getMsg("Payment Print/Export")), i.setTitle(n.Msg.getMsg("Payment Print/Export")), i.hideHeader(!1), i.setContent(u), i.show(), u.initialize()) }, error: function (n) { console.log(n) } }) } this.windowNo; var b = t("<div style='width: 100%; height: 100%; background-color: white;'>"), r = this, k = null, ot = null, st = null, ht = null, ct = null, lt = null, at = null, vt = null, d = null, yt = null, pt = null, wt = null, bt = null, f = null, s = null, h = null, v = null, kt = null, y = null, tt = null, ut = null, a = null, u = [], e = null, p = null, g = null, it = null, c = [], rt = null, l = null, nt = 0, w = null; this.initialize = function () { dt(); o(!0); window.setTimeout(function () { gt() }, 20) }; this.getRoot = function () { return b }; this.disposeComponent = function () { windowNo = null; b = null; r = this; k = null; ot = null; st = null; ht = null; ct = null; lt = null; at = null; vt = null; d = null; yt = null; pt = null; wt = null; bt = null; f = null; s = null; h = null; v = null; kt = null; y = null; tt = null; ut = null; a = null; u = null; e = null; p = null; g = null; it = null; c = null } } n.Apps.AForms = n.Apps.AForms || {}; r.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.frame.getContentGrid().append(this.getRoot()); this.initialize() }; r.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VPaySelect = r }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function i() { function ut() { h = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); h[0].style.visibility = "hidden"; c.append(h) } function r(n) { h[0].style.visibility = n ? "visible" : "hidden" } function ft() { a = t("<div class='vis-mainContainer vis-formouterwrpdiv'>"); var r = " <div class='vis-pPrintInfo'> <div class='vis-paymentselect-field' style='margin-top: 8px;'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <div class='vis-paymentPrintChk-field'> <input type='checkbox' id='VIS_chkShowPrintPayment_" + i.windowNo + "' data-placeholder='' placeholder=' '> <label for='VIS_chkOnlyDue_" + i.windowNo + "'>" + n.Msg.getMsg("ShowPrintedPayments") + " <\/label> <\/div> <select id='VIS_PaySelection_" + i.windowNo + "'><\/select> <label style='top: 11px;'>" + n.Msg.translate(n.Env.getCtx(), "C_PaySelection_ID") + " <\/label><\/div><\/div> <\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' name='vis-name vis-fieldreadonly' class='vis-fieldreadonly' disabled id='VIS_txtBankAccount_" + i.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.translate(n.Env.getCtx(), "C_BankAccount_ID") + " <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrentBal_" + i.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.getMsg("CurrentBalance") + " <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <select name='vis-name' id='VIS_cmbPaymentMethod_" + i.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "PaymentRule") + " <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrency_" + i.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.translate(n.Env.getCtx(), "C_Currency_ID") + " <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='number' name='vis-name'  id='VIS_txtCheckNo_" + i.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.getMsg("CheckNo") + " <\/label> <\/div><\/div><\/div> <div class='vis-paymentPrint-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtNoOfPayments_" + i.windowNo + "' MaxLength='50' data-placeholder='' placeholder=' '> <label>" + n.Msg.getMsg("NoOfPayments") + " <\/label> <\/div><\/div><\/div> <\/div>", u = " <div class='vis-pPrintProcess'> <div class='vis-paymentPrint-field'> <input id='VIS_btnCancel_" + i.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("Cancel") + "' > <input id='VIS_btnPrint_" + i.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("Print") + "' ><\/input> <\/div> <\/div>"; a.append(t(r)).append(t(u)); c.append(a); ut(); et() } function et() { u = t("#VIS_PaySelection_" + i.windowNo); p = t("#VIS_txtBankAccount_" + i.windowNo); w = t("#VIS_txtCurrentBal_" + i.windowNo); f = t("#VIS_cmbPaymentMethod_" + i.windowNo); b = t("#VIS_txtCurrency_" + i.windowNo); e = t("#VIS_txtCheckNo_" + i.windowNo); v = t("#VIS_txtNoOfPayments_" + i.windowNo); l = t("#VIS_chkShowPrintPayment_" + i.windowNo); l.attr("disabled", !0); k = t("#VIS_btnPrint_" + i.windowNo); d = t("#VIS_btnExport_" + i.windowNo); g = t("#VIS_btnCancel_" + i.windowNo); y(!0); st() } function y(i) { var f = null; f = i ? 0 : u.val(); r(!0); t.ajax({ url: n.Application.contextUrl + "VPayPrint/GetDetail", async: !1, datatype: "Json", type: "GET", cache: !1, data: { showPrintedPayment: l.prop("checked"), C_PaymentSelect_ID: f, isFirstTime: i }, success: function (n) { var t = JSON.parse(n); controlsData = t; (t != null || t != undefined) && (ot(t), nt(), r(!1)) }, error: function (n) { r(!1); console.log(n) } }) } function nt() { t.ajax({ url: n.Application.contextUrl + "VPayPrint/LoadPaymentRuleInfo", async: !1, datatype: "Json", type: "GET", cache: !1, data: { paymentMethod_ID: f.val(), C_PaySelection_ID: u.val(), m_C_BankAccount_ID: o, PaymentRule: f.text() }, success: function (n) { var t = JSON.parse(n); r(!1); (t != null || t != undefined) && (e.val(t.CheckNo), v.val(t.NoOfPayments)) }, error: function (n) { console.log(n) } }) } function ot(i) { var c, l, y, a, h; try { if (c = u.val(), l = 0, i.PaymentSelection != null || i.PaymentSelection.length > 0) { u.empty(); for (h in i.PaymentSelection) u.append(t('<Option value="' + i.PaymentSelection[h].ID + '">' + i.PaymentSelection[h].Value + "<\/option>")) } if (c > 0 && (u.val(c), y = "VIS_135", a = [], a[0] = new n.DB.SqlParam("@pSelectID", c), l = n.Utility.Util.getValueOfInt(s(y, a))), i.PaymentMethod != null || i.PaymentMethod.length > 0) { f.empty(); for (h in i.PaymentMethod) f.append(t('<Option value="' + i.PaymentMethod[h].ID + '">' + i.PaymentMethod[h].Value + "<\/option>")) } l > 0 && f.val(l); (i.PSelectInfo != null || i.PSelectInfo.length > 0) && (p.val(i.PSelectInfo[0].BankAccount), e.val(i.PSelectInfo[0].CheckNo), w.val(parseFloat(i.PSelectInfo[0].CurrentBalance).toLocaleString()), b.val(i.PSelectInfo[0].Currency), v.val(i.PSelectInfo[0].NoOfPayments), o = i.PSelectInfo[0].BankAccount_ID) } catch (k) { return n.ADialog.info("VPayPrintNoRecords"), r(!1), !1 } if (u.val() == null) return n.ADialog.info("VPayPrintNoRecords"), !1 } function st() { k.on("click", function () { tt() && ht() }); d.on("click", function () { tt() && vt() }); g.on("click", function () { i.dispose() }); u.on("change", function () { r(!0); window.setTimeout(function () { y(!1); r(!1) }, 20) }); f.on("change", function () { r(!0); window.setTimeout(function () { nt(); r(!1) }, 20) }); l.on("click", function () { r(!0); window.setTimeout(function () { y(!1); r(!1) }, 20) }) } function tt() { try { if (u == null || u.val() <= -1 || o <= -1 || f.val() <= -1 || e.val().length <= 0) return n.ADialog.info("VPayPrintNoRecords"), !1 } catch (t) { return n.ADialog.info("VPayPrintNoRecords"), !1 } return !0 } function ht() { r(!0); t.ajax({ url: n.Application.contextUrl + "VPayPrint/Cmd_Print", async: !1, datatype: "Json", type: "GET", cache: !1, data: { paymentMethod_ID: f.val(), C_PaySelection_ID: u.val(), m_C_BankAccount_ID: o, PaymentRule: f.text(), checkNo: e.val() }, success: function (t) { r(!1); var u = JSON.parse(t); if (u != null || u != undefined) n.ADialog.confirm("ContinueCheckPrint?", !0, "", "Confirm", function (n) { n ? (r(!0), window.setTimeout(function () { ct(u) }, 20)) : i.dispose() }); else return n.ADialog.info("VPayPrintNoRecords"), !1 }, error: function (n) { console.log(n) } }) } function ct(h) { var l = h.check_ID[0], c = []; c.push(f.val()); c.push(u.val()); c.push(o); c.push(f.text()); c.push(e.val()); c.push(JSON.stringify(h.check_ID)); c.push(JSON.stringify(h.m_batch)); c.push(JSON.stringify(h.m_checks)); t.ajax({ url: n.Application.contextUrl + "VPayPrint/ContinueCheckPrint", async: !1, datatype: "Json", type: "POST", contentType: "application/json; charset=utf-8", data: JSON.stringify(c), success: function (t) { var h = "VIS_152", c = [], l, a, v, e, y, f; c[0] = new n.DB.SqlParam("@BankAcct_ID", o); l = s(h, c); h = "VIS_150"; a = s(h); v = new n.APrint(l, a, parseInt(u.val()), i.windowNo); v.startPdf(null); r(!1); e = JSON.parse(t); (e != null || e != undefined) && (y = e.join(), f = lt(y), f = f != null ? n.Msg.getMsg("VIS_PaymentCreated") + f : f, n.ADialog.confirm("VPayPrintPrintRemittance?", !0, f, "Confirm", function (n) { n ? (r(!0), window.setTimeout(function () { at(t) }, 20)) : i.dispose() })) }, error: function (n) { r(!1); console.log(n) } }) } function lt(i) { var r = null; return t.ajax({ url: n.Application.contextUrl + "VPayPrint/GetDocumentNo", async: !1, datatype: "Json", type: "GET", contentType: "application/json; charset=utf-8", data: { paymentId: i }, success: function (n) { r = JSON.parse(n); r = r != null ? r.join() : r }, error: function (n) { console.log(n) } }), r } function at(f) { var e = JSON.parse(f); t.ajax({ url: n.Application.contextUrl + "VPayPrint/VPayPrintRemittance", async: !1, datatype: "Json", type: "POST", contentType: "application/json; charset=utf-8", data: f, success: function (t) { var l, f, o, h, c; r(!1); l = JSON.parse(t); e != null || e != undefined ? (f = "VIS_151", o = s(f), f = "VIS_150", h = s(f), c = new n.APrint(o, h, parseInt(u.val()), i.windowNo), c.startPdf(null), i.dispose()) : n.ADialog.info("PaymentNotProcessed") }, error: function (n) { console.log(n) } }) } function vt() { r(!0); t.ajax({ url: n.Application.contextUrl + "VPayPrint/Cmd_Export", async: !1, datatype: "Json", type: "POST", cache: !1, data: { paymentMethod_ID: f.val(), C_PaySelection_ID: u.val(), m_C_BankAccount_ID: o, PaymentRule: f.text(), checkNo: e.val() }, success: function (t) { r(!1); var i = JSON.parse(t); if (i != null || i != undefined) n.ADialog.confirm("VPayPrintSuccess?", !0, "", "Confirm", function (t) { if (t) { r(!0); window.setTimeout(function () { yt(i) }, 20); var u = n.Application.contextUrl + "TempDownload/" + i.filepath; window.open(u, "_blank") } }); else return n.ADialog.info("VPayPrintNoRecords"), !1 }, error: function (n) { console.log(n) } }) } function yt(i) { var u = []; u.push(JSON.stringify(i.check_ID)); u.push(JSON.stringify(i.m_batch)); u.push(JSON.stringify(i.m_checks)); t.ajax({ url: n.Application.contextUrl + "VPayPrint/VPayPrintSuccess", async: !1, datatype: "Json", type: "POST", contentType: "application/json; charset=utf-8", data: JSON.stringify(u), success: function (n) { r(!1); var t = JSON.parse(n); t != null || t != undefined }, error: function (n) { console.log(n) } }) } function pt(n, i, r) { var u = null; return t.ajax({ url: rt, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } var s; this.windowNo = n.Env.getWindowNo(); var c = t("<div style='width: 100%; height: 100%; background-color: white;'>"), i = this, a = null, u = null, p = null, w = null, f = null, b = null, e = null, v = null, l = null, k = null, d = null, g = null, o = null, h = null, it = n.Application.contextUrl, rt = it + "JsonData/JDataSetWithCode"; this.initialize = function () { ft() }; this.getRoot = function () { return c }; s = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return i && (e.param = i), pt(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; this.lockUI = function () { }; this.unlockUI = function () { }; this.disposeComponent = function () { windowNo = null; c = null; i = this } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.frame.getContentGrid().append(this.getRoot()); this.initialize() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VPayPrint = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function i() { function ut() { l = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); l[0].style.visibility = "hidden"; v.append(l) } function h(n) { l[0].style.visibility = n ? "visible" : "hidden" } function ft() { var e = t(window).height() * (92 / 100), u, f; y = t("<div class='vis-mainContainer'>"); u = " <div class='vis-pSelectInfo vis-leftsidebarouterwrap'><div class='vis-pSelectInner'> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <select id='VIS_cmbProduct_" + i.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "M_Product_ID") + ' <\/label><\/div><\/div> <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbinvoice_' + i.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "C_Invoice_ID") + ' <\/label><\/div><\/div> <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbOrder_' + i.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "C_Order_ID") + ' <\/label><\/div><\/div> <\/div> <div class=\'vis-paymentselect-field\'><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select id=\'VIS_cmbOpportunity_' + i.windowNo + "'><\/select> <label>" + n.Msg.translate(n.Env.getCtx(), "C_Project_ID") + " <\/label><\/div><\/div> <\/div> <div class='vis-paymentselect-field'><div class=\"input-group vis-input-wrap\"><div class=\"vis-control-wrap\"> <input data-placeholder='' placeholder=' ' type='number' id='VIS_txtQuantity_" + i.windowNo + "' min='0' MaxLength='50'> <label>" + n.Msg.translate(n.Env.getCtx(), "Qty") + "<\/label><\/div><\/div> <\/div> <\/div> <div class='vis-paymentselect-field'> <button class='VIS_Pref_btn-2'  id='VIS_btnRefresh_" + i.windowNo + "' style='margin-top: 0px;'><i class='vis vis-refresh'><\/i><\/button> <\/div> <\/div>"; r = t("<div class='vis-pSelectIionGrid'>"); f = " <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_" + i.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("Cancel") + "' ><\/input> <input id='VIS_btnOK_" + i.windowNo + "' disabled class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("OK") + "' ><\/input> <\/div> <\/div>"; y.append(t(u)).append(r).append(t(f)); v.append(y); et() } function et() { u = t("#VIS_cmbProduct_" + i.windowNo); f = t("#VIS_cmbinvoice_" + i.windowNo); e = t("#VIS_cmbOrder_" + i.windowNo); o = t("#VIS_cmbOpportunity_" + i.windowNo); a = t("#VIS_txtQuantity_" + i.windowNo); p = t("#VIS_btnCancel_" + i.windowNo); s = t("#VIS_btnOK_" + i.windowNo); w = t("#VIS_btnRefresh_" + i.windowNo); b(); ot() } function ot() { w.on("click", function () { h(!0); r.empty(); window.setTimeout(function () { b(); h(!1) }, 20) }); s.on("click", function () { lt() }); p.on("click", function () { i.dispose() }); u.on("change", function () { u.val() > 0 ? s.removeAttr("disabled") : s.attr("disabled", !0); h(!0); window.setTimeout(function () { ht() }, 20) }); f.on("change", function () { f.val() > 0 ? (u.val() > 0 && s.removeAttr("disabled"), e.attr("disabled", !0), o.attr("disabled", !0)) : (s.attr("disabled", !0), e.removeAttr("disabled"), o.removeAttr("disabled")) }); e.on("change", function () { e.val() > 0 ? (u.val() > 0 && s.removeAttr("disabled"), f.attr("disabled", !0), o.attr("disabled", !0)) : (s.attr("disabled", !0), f.removeAttr("disabled"), o.removeAttr("disabled")) }); o.on("change", function () { o.val() > 0 ? (u.val() > 0 && s.removeAttr("disabled"), e.attr("disabled", !0), f.attr("disabled", !0)) : (s.attr("disabled", !0), e.removeAttr("disabled"), f.removeAttr("disabled")) }); a.on("change", function () { for (var i, n = 0; n < t(r[0]).children().length; n++)i = c[n].BOMQty, t(t(t(t(r[0]).children()[n]).children()[0]).children()[1]).attr("Value", i * a.val()) }) } function b() { t.ajax({ url: n.Application.contextUrl + "VBOMDrop/GetDetail", async: !1, datatype: "Json", type: "GET", cache: !1, success: function (n) { var t = JSON.parse(n); controlsData = t; (t != null || t != undefined) && st(t); h(!1) }, error: function (n) { console.log(n); h(!1) } }) } function st(n) { var i; if (n.Product != null || n.Product.length > 0) { u.empty(); u.append(t('<Option value="-1"><\/option>')); for (i in n.Product) u.append(t('<Option value="' + n.Product[i].ID + '">' + n.Product[i].Value + "<\/option>")) } if (n.Invoice != null || n.Invoice.length > 0) { f.empty(); f.append(t('<Option value="-1"><\/option>')); for (i in n.Invoice) f.append(t('<Option value="' + n.Invoice[i].ID + '">' + n.Invoice[i].Value + "<\/option>")) } if (n.Order != null || n.Order.length > 0) { e.empty(); e.append(t('<Option value="-1"><\/option>')); for (i in n.Order) e.append(t('<Option value="' + n.Order[i].ID + '">' + n.Order[i].Value + "<\/option>")) } if (n.Opportunity != null || n.Opportunity.length > 0) { o.empty(); o.append(t('<Option value="-1"><\/option>')); for (i in n.Opportunity) o.append(t('<Option value="' + n.Opportunity[i].ID + '">' + n.Opportunity[i].Value + "<\/option>")) } h(!1) } function ht() { a.val(""); t.ajax({ url: n.Application.contextUrl + "VBOMDrop/GetBOMLines", async: !1, datatype: "Json", type: "GET", cache: !1, data: { productID: parseInt(u.val()) }, success: function (n) { var t = JSON.parse(n); controlsData = t; t != null || t != undefined ? ct(t) : r.empty(); h(!1) }, error: function (n) { console.log(n); h(!1) } }) } function ct(n) { var e = "", i; r.empty(); var u = "", f = ""; for (c = n, i = 0; i < n.length; i++) { e = ""; n[i].BOMType == "P" ? (u = "<input type='checkbox' checked disabled id='VIS_chkBOMLine_" + i + "' style='height: 15px;width: auto;'><\/input>", f = "<input type='number' id='VIS_qtyBOMLine_" + i + "' style='background: pink;width:200%;' min='0' value='" + n[i].BOMQty + "'><\/input>") : n[i].BOMType == "O" ? (u = "<input type='checkbox' id='VIS_chkBOMLine_" + i + "' style='height: 15px;width: auto;'><\/input>", f = "<input type='number' disabled id='VIS_qtyBOMLine_" + i + "' style='background: #FFF5FF;width:200%;'  min='0' value='" + n[i].BOMQty + "'><\/input>") : (u = " <input type='radio' name='vis-radiolist' checked id='VIS_chkBOMLine_" + i + "' style='height: 15px;width: auto;'><\/input>", f = "<input type='number' id='VIS_qtyBOMLine_" + i + "' style='background: pink;width:200%;' min='0' value='" + n[i].BOMQty + "'><\/input>"); e += "<div class='vis-bomlinesdata'> <div style='float:left;width: 50%;'> <label style='margin: 5px;width:100%;'>" + n[i].ProductName + "<\/label>" + f + " <\/div> <div style='float:right;'>" + u + " <label style='margin-right:5px;'>" + n[i].BOMTypeName + "<\/label> <\/div> <\/div>"; r.append(t(e)); t("#VIS_chkBOMLine_" + i).on("click", function () { var n = t(t(t(t(this).parent()).parent().children()[0]).children()[1]); t(this).prop("checked") ? (n.css("background", "pink"), n.removeAttr("disabled")) : (n.css("background", "#FFF5FF"), n.attr("disabled", !0)) }) } } function lt() { var l = [], s, a; for (l.push(u.val()), l.push(f.val()), l.push(e.val()), l.push(o.val()), s = 0; s < t(r[0]).children().length; s++)a = t(t(t(t(r[0]).children()[s]).children()[1]).children()[0]).prop("checked"), a ? (c[s].IsSelected = !0, c[s].BOMQty = t(t(t(t(r[0]).children()[s]).children()[0]).children()[1]).val()) : c[s].IsSelected = !1; l.push(JSON.stringify(c)); t.ajax({ url: n.Application.contextUrl + "VBOMDrop/SaveRecord", async: !1, datatype: "Json", type: "POST", cache: !1, contentType: "application/json; charset=utf-8", data: JSON.stringify(l), success: function (t) { JSON.parse(t) ? i.dispose() : n.ADialog.info("RecordNotSaved") }, error: function (n) { console.log(n); h(!1) } }) } this.windowNo = null; var v = t("<div style='width: 100%; height: 100%; background-color: white;'>"), i = this, y = null, k = null, r = null, d = null, g = null, nt = null, tt = null, it = null, rt = null, u = null, f = null, e = null, o = null, a = null, s = null, p = null, l = null, c = [], w = null; this.initialize = function () { ut(); h(!0); window.setTimeout(function () { ft() }, 20) }; this.getRoot = function () { return v }; this.disposeComponent = function () { v = null; i = null; y = null; k = null; r = null; d = null; g = null; nt = null; tt = null; it = null; rt = null; u = null; f = null; e = null; o = null; a = null; s = null; p = null; l = null; c = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.frame.getContentGrid().append(this.getRoot()); this.initialize() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VBOMDrop = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function i() { function at() { e = t('<div class="vis-busyindicatorouterwrap" style="visibility: hidden;"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); e[0].style.visibility = "hidden"; o.append(e) } function l(n) { e[0].style.visibility = n ? "visible" : "hidden" } function vt() { var ti = t(window).height() * (96 / 100), dt = n.MLookupFactory.get(n.Env.getCtx(), 0, 0, n.DisplayType.TableDir, "AD_Org_ID", 0, !1, " AD_Org.AD_Org_ID <> 0 AND AD_Org.IsSummary='N' AND AD_Org.IsActive='Y' AND AD_Org.IsCostCenter='N' AND AD_Org.IsProfitCenter='N' "), et, e, r, nt, tt, ut, ft, kt; a = new n.Controls.VComboBox("AD_Org_ID", !1, !1, !0, dt, 50); et = n.MLookupFactory.get(n.Env.getCtx(), 0, 0, n.DisplayType.List, "MovementType", 189, !1, null); v = new n.Controls.VComboBox("MovementType", !1, !1, !0, et, 29); var c = t("<div class='input-group vis-input-wrap'>"), y = t("<div class='vis-control-wrap'>"), p = t("<div class='input-group-append'>"), gt = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.Search, "M_Locator_ID", 0, !1, ""); u = new n.Controls.VTextBoxButton("M_Locator_ID", !1, !1, !0, n.DisplayType.Search, gt); c.append(y); y.append(u.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); c.append(p); p.append(u.getBtn(0)); p.append(u.getBtn(1)); u.getBtn(0).addClass("vis-lookupButtons"); u.getBtn(1).addClass("vis-lookupButtons"); var w = t("<div class='input-group vis-input-wrap'>"), b = t("<div class='vis-control-wrap'>"), k = t("<div class='input-group-append'>"), ni = n.MLookupFactory.get(n.context, 0, 0, n.DisplayType.Search, "M_Product_ID", 0, !1, ""); f = new n.Controls.VTextBoxButton("M_Product_ID", !1, !1, !0, n.DisplayType.Search, ni); w.append(b); b.append(f.getControl().attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")); w.append(k); k.append(f.getBtn(0)); k.append(f.getBtn(1)); f.getBtn(0).addClass("vis-lookupButtons"); f.getBtn(1).addClass("vis-lookupButtons"); s = t("<div class='vis-mainContainer'>"); e = t("<div class='vis-pSelectInfo vis-leftsidebarouterwrap'>"); r = t("<div class='vis-pSelectInner'>"); e.append(r); var ot = t("<div class='vis-paymentselect-field'>"), st = t("<div class='input-group vis-input-wrap'>"), d = t("<div class='vis-control-wrap'>"); ot.append(st); st.append(d); d.append(a.getControl()); d.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "AD_Org_ID") + " <\/label>")); r.append(ot); var ht = t("<div class='vis-paymentselect-field'>"), ct = t("<div class='input-group vis-input-wrap'>"), g = t("<div class='vis-control-wrap'>"); ht.append(ct); ct.append(g); g.append(v.getControl()); g.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "MovementType") + " <\/label>")); r.append(ht); nt = t("<div class='vis-paymentselect-field'>"); nt.append(c); y.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_Locator_ID") + " <\/label>")); r.append(nt); tt = t("<div class='vis-paymentselect-field'>"); tt.append(w); b.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "Product") + " <\/label>")); r.append(tt); var lt = t("<div class='vis-paymentselect-field'>"), at = t("<div class='input-group vis-input-wrap'>"), it = t("<div class='vis-control-wrap'>"); it.append(t("<input  id='VIS_dtpFromDate" + i.windowNo + "'type='date'>")); it.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "DateFrom") + " <\/label>")); lt.append(at); at.append(it); r.append(lt); var vt = t("<div class='vis-paymentselect-field'>"), bt = t("<div class='input-group vis-input-wrap'>"), rt = t("<div class='vis-control-wrap'>"); rt.append(t("<input  id='VIS_dtpToDate" + i.windowNo + "'type='date'>")); rt.append(t("<label>" + n.Msg.translate(n.Env.getCtx(), "DateTo") + " <\/label>")); vt.append(bt); bt.append(rt); r.append(vt); ut = t("<div class='vis-paymentselect-field'>"); ut.append(t("<button class='VIS_Pref_btn-2' id='VIS_btnRefresh_" + i.windowNo + "' style='margin-top: 0px;'><i class='vis vis-refresh'><\/i><\/button>")); e.append(ut); ft = t("<div class='vis-paymentselect-field'>"); ft.append(t("<button class='VIS_Pref_btn-2' id='VIS_btnZoom_" + i.windowNo + "' style='margin-top: 0px;'><i class='vis vis-find'><\/i><\/button>")); e.append(ft); h = t("<div class='vis-pSelectIionGrid'>"); kt = " <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_" + i.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("Cancel") + "' ><\/input> <input id='VIS_btnOK_" + i.windowNo + "' class='vis-frm-btn' type='submit' value='" + n.Msg.getMsg("OK") + "' ><\/input> <\/div> <\/div>"; s.append(e).append(h).append(t(kt)); o.append(s); yt(); window.setTimeout(function () { wt() }, 20); pt(); l(!0) } function yt() { k = t("#VIS_dtpFromDate" + i.windowNo); d = t("#VIS_dtpToDate" + i.windowNo); y = t("#VIS_btnRefresh_" + i.windowNo); g = t("#VIS_btnZoom_" + i.windowNo); p = t("#VIS_btnOK_" + i.windowNo); w = t("#VIS_btnCancel_" + i.windowNo); var n = new Date, r = ("0" + n.getDate()).slice(-2), u = ("0" + (n.getMonth() + 1)).slice(-2), f = n.getFullYear() + "-" + u + "-" + r } function pt() { y.on("click", function () { nt() }); g.on("click", function () { bt() }); p.on("click", function () { nt() }); w.on("click", function () { i.dispose() }) } function wt() { n.AEnv.getGridWindow(i.windowNo, 223, function (u) { var e, f; if (u.error != null) { n.ADialog.error(u.error); self.dispose(); self = null; return } (e = t.parseJSON(u.result), n.context.setContextOfWindow(t.parseJSON(u.wCtx), i.windowNo), f = new n.GridWindow(e), f != null) && (b = f.getTabs()[0], r = new n.GridController(!1), r.initGrid(!0, i.windowNo, i, b), r.setVisible(!0), window.innerHeight > 700 ? r.sizeChanged(window.innerHeight - 230, window.innerWidth) : r.sizeChanged(window.innerHeight - 215, window.innerWidth), h.append(r.getRoot()), r.activate(), c = new n.Query, c.addRestriction("AD_Client_ID", n.Query.prototype.EQUAL, n.context.getAD_Client_ID())) }) } function nt() { var e = null, t, i; e = c != null ? jQuery.extend(!0, {}, c) : new n.Query; t = a.getValue(); (t == null || t.toString() == "-1" || t.toString().trim().length == 0) && (t = null); t != null && t.toString().length > 0 && e.addRestriction("AD_Org_ID", n.Query.prototype.EQUAL, t); t = u.getValue(); t != null && t.toString().length > 0 && e.addRestriction("M_Locator_ID", n.Query.prototype.EQUAL, t); t = f.getValue(); t != null && t.toString().length > 0 && e.addRestriction("M_Product_ID", n.Query.prototype.EQUAL, t); t = v.getValue(); (t == null || t.toString() == "-1" || t.toString().trim().length == 0) && (t = null); t != null && t.toString().length > 0 && e.addRestriction("MovementType", n.Query.prototype.EQUAL, t); i = k.val().toString(); i != null && i.length > 0 && (i = new Date(i), e.addRestriction("TRUNC(MovementDate,'DD')", n.Query.prototype.GREATER_EQUAL, i)); i = d.val().toString(); i != null && i.length > 0 && (i = new Date(i), e.addRestriction("TRUNC(MovementDate,'DD')", n.Query.prototype.LESS_EQUAL, i)); b.setQuery(e); r.query(0, 0, !1) } function bt() { var u = 0, f = null, e = null, o = [], t = n.context.getContextAsInt(i.windowNo, "M_InOutLine_ID"), s, h; if (t != 0 ? (n.context.getContext(i.windowNo, "MovementType").equals("C-") ? u = 169 : n.context.getContext(i.windowNo, "MovementType").equals("C+") ? u = 409 : n.context.getContext(i.windowNo, "MovementType").equals("V+") ? u = 184 : n.context.getContext(i.windowNo, "MovementType").equals("V-") && (u = 411), f = "M_InOut_ID", e = "VIS_140", o[0] = new n.DB.SqlParam("@lineID", t)) : (t = n.context.getContextAsInt(i.windowNo, "M_InventoryLine_ID"), t != 0 ? (u = 168, f = "M_Inventory_ID", e = "VIS_141", o[0] = new n.DB.SqlParam("@lineID", t)) : (t = n.context.getContextAsInt(i.windowNo, "M_MovementLine_ID"), t != 0 ? (u = 170, f = "M_Movement_ID", e = "VIS_142", o[0] = new n.DB.SqlParam("@lineID", t)) : (t = n.context.getContextAsInt(i.windowNo, "M_ProductionLine_ID"), t != 0 && (u = 191, f = "M_Production_ID", e = "VIS_143", o[0] = new n.DB.SqlParam("@lineID", t))))), u != 0) if (s = 0, h = 0, h = r.getSelectedRows(), h.length > 0) s = n.Utility.Util.getValueOfInt(tt(e, null, null)), dt(f, t, u, s); else return alert(n.Msg.getMsg("NoRecordSelected")) } function kt(n, i, r) { var u = null; return t.ajax({ url: lt, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function dt(t, i, r, u) { var f = new n.Query; f.addRestriction(t, n.Query.prototype.EQUAL, u); n.viewManager.startWindow(r, f) } var tt; this.windowNo = null; var o = t("<div style='width: 100%; height: 100%; background-color: white;'>"), i = this, s = null, it = null, h = null, rt = null, ut = null, ft = null, et = null, a = null, v = null, k = null, d = null, ot = [], st = null, y = null, g = null, p = null, w = null, ht = [], e = null, u = null, f = null, r = null, c = null, b = null, ct = n.Application.contextUrl, lt = ct + "JsonData/JDataSetWithCode"; this.initialize = function () { at(); l(!0); window.setTimeout(function () { vt(); l(!1) }, 20) }; tt = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return kt(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; this.getRoot = function () { return o }; this.dataStatusChanged = function () { }; this.setBusy = function (n) { l(n) }; this.disposeComponent = function () { windowNo = null; o = null; i = this; s = null; it = null; $divBankAccount = null; $divCurrentBalance = null; $divBusinessPartner = null; $divOnlyDueInvoice = null; $divPaymentDate = null; $divPaymentMethod = null; h = null; rt = null; ut = null; ft = null; et = null; $cmbBankAccount = null; $cmbBusinessPartner = null; $cmbPaymentMethod = null; $cmbPaymentDate = null; $lblCurrentBal = null; $chkOnlyDueInvoice = null; $txtCurrentBal = null; $lblMsg = null; $txtPaymentAmount = null; ot = null; st = null; y = null; p = null; w = null; ht = null } } n.Apps.AForms = n.Apps.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.frame.getContentGrid().append(this.getRoot()); this.initialize() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VTrxMaterial = i }(VIS, jQuery), function (n, t) { function r(r, u, f) { function gr() { var i = "", t = '<div class="vis-advancedSearch-contentWrap"> <div class="vis-advancedSearchContentArea vis-pull-left" style="' + i + '"> <div class="vis-advancedSearchContentArea-up"> <div class="vis-advanedSearch-InputsWrap"><div class="vis-as-topfieldswrap"><div style="display:none" class="vis-form-group vis-advancedSearchInput vis-adsearchgroup1"><input readonly id="txtQryName_' + r + '" type="text" name="QueryName" maxlength="60"><label id="lblQryName_' + r + '" for="QueryName">' + n.Msg.getMsg("AddNameToSaveSearch") + '<\/label><\/div> <div  class="vis-form-group vis-advancedSearchInput vis-adsearchgroup2"><label id="lblSavedQry_' + r + '" for="GetSavedQuery">' + n.Msg.getMsg("GetSavedSearch") + '<\/label><select id="drpSavedQry_' + r + '"><\/select><\/div> <div class="vis-advancedSearch-Icons vis-pull-left vis-adsearchgroup2">   <ul>   <li class="vis-pull-left"><button disabled id="btnDelete_' + r + '" class="vis-advancedSearchActionIcon vis-advancedSearch-delIcon"><i class="vis vis-delete" aria-hidden="true"><\/i><\/button><\/li><\/ul><\/div><\/div><div class="vis-advanedSearch-AddFilterWrap vis-pull-left"><label id="spnAddFilter_' + r + '" class="vis-advancedSearch-AddFilter">' + n.Msg.getMsg("AddFilter") + '<\/label><\/div>  <div class="vis-as-backbtn"><button id="btnArowBack_' + r + '" class="vis-ads-icon"><i class="fa fa-arrow-left" aria-hidden="true"><\/i><\/button><\/div> <\/div><div class="vis-advanedSearch-InputsWrap vis-advs-inputwraps vis-pull-left" data-show="N" style="display:none">  <div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v">    <label id="lblColumn_' + r + '"  for="Column">' + n.Msg.getMsg("Column") + '<\/label>  <select id="drpColumn_' + r + '"><\/select><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-op"><label id="lblOperator_' + r + '" for="Oprator">' + n.Msg.getMsg("Operator") + '<\/label><select id="drpOperator_' + r + '"><\/select><\/div> <div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" id="divValue1_' + r + '">   <label  id="lblQryValue_' + r + '" for="QueryValue">' + n.Msg.getMsg("QueryValue") + '<\/label> <input  id="txtQryValue_' + r + '" type="text" name="QueryValue"><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" id="divValue2_' + r + '"><label for="QueryName"  id="lblToQryValue_' + r + '">' + n.Msg.getMsg("ToQueryValue") + '<\/label><input  id="txtToQryValue_' + r + '" type="text" name="QueryName"><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" style="display:none;" id="divFullDay_' + r + '"><input style="width: auto;float: left;" id="checkFullDay_' + r + '" type="checkbox" name="QueryName"><label for="QueryName"  id="lblToQryValue_' + r + '">' + n.Msg.getMsg("FullDay") + '<\/label><\/div><div class="vis-advancedSearch-calender-Icon vis-pull-left"><ul><li class="vis-pull-left"><button id="btnSave_' + r + '" disabled class="vis-ads-icon"><i class="vis vis-plus" aria-hidden="true"><\/i><\/button><\/li><\/ul><\/div><\/div><div id="divDynamic_' + r + '"><div class="vis-advanedSearch-InputsWrap vis-advancedSearchMrgin"><div class="vis-form-group vis-advancedSearchInput1"><input type="checkbox"  id="chkDynamic_' + r + '"  name="IsDynamic" class="vis-pull-left"><label for="IsDynamic" >' + n.Msg.getMsg("IsDynamic") + '<\/label><\/div><div class="vis-form-group vis-advancedSearchInput"><select id="drpDynamicOp_' + r + '" disabled><option>' + n.Msg.getMsg("Today") + "<\/option><option>" + n.Msg.getMsg("lastxDays") + "<\/option><option>" + n.Msg.getMsg("lastxMonth") + "<\/option><option>" + n.Msg.getMsg("lastxYears") + '<\/option><\/select><\/div><div class="vis-form-group vis-advancedSearchHorigontal vis-pull-left" id="divYear_' + r + '"><input id="txtYear_' + r + '" type="number" min="1" max="99" /><label for="Year">' + n.Msg.getMsg("Year") + '<\/label><\/div><div class="vis-form-group vis-advancedSearchHorigontal vis-pull-left" id="divMonth_' + r + '"><input id="txtMonth_' + r + '" type="number" min="0" max="12" /><label for="Month">' + n.Msg.getMsg("Month") + '<\/label><\/div><div class="vis-form-group vis-advancedSearchHorigontal vis-pull-left" id="divDay_' + r + '"><input id="txtDay_' + r + '" type="number" min="0" max="31" /> <label for="Day">' + n.Msg.getMsg("Day") + '<\/label><\/div><\/div><\/div><\/div><div class="vis-advancedSearchContentArea-down"><div class="vis-advancedSearchTableWrap vis-table-responsive vis-pull-left"><table id="tblQry_' + r + '" class="vis-advancedSearchTable"><thead><tr class="vis-advancedSearchTableHead"><th>' + n.Msg.translate(n.Env.getCtx(), "AD_Column_ID") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "KEYVALUE") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "OperatorName") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "QueryValue") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "VALUE1VALUE") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "QueryValue2") + "<\/th><th>" + n.Msg.getMsg("FullDay") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "VALUE2VALUE") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "AD_USERQUERYLINE_ID") + '<\/th><th style="display:none">' + n.Msg.translate(n.Env.getCtx(), "Operator") + "<\/th><th>" + n.Msg.translate(n.Env.getCtx(), "Action") + '<\/th><\/tr><\/thead><tbody class="vis-advancedSearchTableBody"><\/tbody><\/table><\/div><\/div><div class="vis-advancedSearchContentArea-button"><div class="vis-advcedfooterBtn">'; i = "float:left"; t += '<button id="btnRefresh_' + r + '" class="ui-button ui-corner-all ui-widget">' + n.Msg.getMsg("Refresh") + '<\/button><div class="vis-pull-right"><button id="btnOk_' + r + '" class="ui-button ui-corner-all ui-widget" >' + n.Msg.getMsg("Apply") + '<\/button>  <button id="btnCancel_' + r + '" class="ui-button ui-corner-all ui-widget"  style="margin: 0 10px;">' + n.Msg.getMsg("close") + '<\/button><\/div><\/div><\/div><\/div><div class="vis-advancedSearch-RecentRecords">  <div class="vis-RecentRecords-Heading">'; t += "<h4>" + n.Msg.getMsg("VHistory") + '<\/h4><\/div><div class="vis-RecentRecords-listWrap"> <ul id="ulQry_' + r + '" ><li data-value="0" title="' + n.Msg.getMsg("All") + '" >' + n.Msg.getMsg("All") + '<\/li><li data-value="365" title="' + n.Msg.getMsg("YearAll") + '">' + n.Msg.getMsg("YearAll") + '<\/li><li data-value="365 | C" title="' + n.Msg.getMsg("YearCreated") + '">' + n.Msg.getMsg("YearCreated") + '<\/li><li data-value="31" title="' + n.Msg.getMsg("MonthAll") + '">' + n.Msg.getMsg("MonthAll") + '<\/li><li data-value="31 | C" title="' + n.Msg.getMsg("MonthCreated") + '">' + n.Msg.getMsg("MonthCreated") + '<\/li><li data-value="7" title="' + n.Msg.getMsg("WeekAll") + '">' + n.Msg.getMsg("WeekAll") + '<\/li><li data-value="7 | C" title="' + n.Msg.getMsg("WeekCreated") + '">' + n.Msg.getMsg("WeekCreated") + '<\/li><li data-value="1" title="' + n.Msg.getMsg("DayAll") + '">' + n.Msg.getMsg("DayAll") + '<\/li><li data-value="1 | C" title="' + n.Msg.getMsg("DayCreated") + '">' + n.Msg.getMsg("DayCreated") + '<\/li><\/ul><\/div><div class="vis-advancedSearchFooter vis-pull-right"> <p id="pstatus_' + r + '" >16 / 16<\/p><\/div><\/div><\/div><div class="vis-apanel-busy vis-advancedSearchbusy" id="divBusy_' + r + '" ><p style="text-align:center"> ' + n.Msg.getMsg("Loading") + "<\/p><\/div>"; e.append(t); nu(); tu(); iu() } function nu() { ot = e.find("#ulQry_" + r); a = e.find("#drpSavedQry_" + r); k = e.find("#drpColumn_" + r); v = e.find("#drpOperator_" + r); ut = e.find("#divValue1_" + r); nr = e.find("#lblQryValue_" + r); it = e.find("#divValue2_" + r); sr = e.find("#divFullDay_" + r); s = e.find("#txtQryName_" + r); ht = e.find("#btnOk_" + r); ct = e.find("#btnCancel_" + r); yt = e.find("#btnSave_" + r); vt = e.find("#btnDelete_" + r); gt = e.find("#btnRefresh_" + r); lt = e.find("#divDynamic_" + r); p = e.find("#chkDynamic_" + r); y = e.find("#drpDynamicOp_" + r); ni = e.find("#txtYear_" + r); et = e.find("#txtMonth_" + r); d = e.find("#txtDay_" + r); tt = e.find("#divYear_" + r); st = e.find("#divMonth_" + r); rt = e.find("#divDay_" + r); pt = e.find("#checkFullDay_" + r); ei = e.find("#spnAddFilter_" + r); ti = e.find("#btnArowBack_" + r); g = t(e.find(".vis-advs-inputwraps")[0]); tt.hide(); st.hide(); rt.hide(); lt.hide(); oi = e.find("#tblQry_" + r); ii = oi.find("tbody"); or = e.find("#pstatus_" + r); er = e.find("#divBusy_" + r) } function tu() { var l, c, f, o, t, s, u, e; for (h = yi(null, !1), l = i.getData(n.context, di, gi, "Code"), pr(h), ci = ot.html(), ar(l), c = '<option value="-1"> <\/option>', f = [], o = 0; o < fi.length; o++)(t = fi[o], t.getIsEncrypted()) || (s = t.getColumnName(), t.getDisplayType() == n.DisplayType.Button && (t.getAD_Reference_Value_ID() == 0 ? t.setDisplayType(n.DisplayType.String) : s.endsWith("_ID") ? t.setDisplayType(n.DisplayType.Table) : (t.setDisplayType(n.DisplayType.List), t.lookup = new n.MLookupFactory.getMLookUp(n.context, r, t.getAD_Column_ID(), n.DisplayType.List))), u = t.getHeader(), u != null && u.length != 0 || (u = n.Msg.getElement(n.context, s), u != null && u.Length != 0)) && (t.getIsKey() && (u += " (ID)"), f.push({ value: s, text: u })); for (f.sort(function (n, t) { var i = n.text.toUpperCase(), r = t.text.toUpperCase(); return i > r ? 1 : i < r ? -1 : 0 }), e = 0; e < f.length; e++)c += '<option value="' + f[e].value + '">' + f[e].text + "<\/option>"; k.html(c); b(!1) } function iu() { ct.on("click", function () { nt || (o.okBtnPressed = !1, l.close()) }); p.on("change", function () { var n = p.prop("checked"); y.prop("disabled", !n); v.prop("disabled", n); vr(!n); ui(!n); ou(n); n ? li(o.getIsUserColumn(k.val())) : (tt.hide(), st.hide(), rt.hide()) }); y.on("change", function () { li() }); k.on("change", function () { var t, r, s, i, f; nt || (p.prop("disabled", !0), p.prop("checked", !1), p.trigger("change"), lt.hide(), t = k.val(), bi(!0), t && t != "-1" ? (r = null, s = null, r = t.endsWith("_ID") || t.endsWith("_Acct") || t.endsWith("_ID_1") || t.endsWith("_ID_2") || t.endsWith("_ID_3") ? o.getOperatorsQuery(n.Query.prototype.OPERATORS_ID) : t.startsWith("Is") ? o.getOperatorsQuery(n.Query.prototype.OPERATORS_YN) : o.getOperatorsQuery(n.Query.prototype.OPERATORS), i = u.getField(t), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 150px)"), i != null && n.DisplayType.IsDate(i.getDisplayType()) ? (y.html(o.getOperatorsQuery(n.Query.prototype.OPERATORS_DATE_DYNAMIC, !0)), lt.show(), p.prop("disabled", !1), li(), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 195px)"), i.getDisplayType() == n.DisplayType.DateTime && (kt(!1), dt(!0))) : o.getIsUserColumn(t) && (y.html(o.getOperatorsQuery(n.Query.prototype.OPERATORS_DYNAMIC_ID, !0)), lt.show(), e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 195px)"), p.prop("disabled", !1), li(!0)), i.getDisplayType() != n.DisplayType.DateTime && (kt(!0), dt(!1)), i.getDisplayType() == n.DisplayType.YesNo ? nr.hide() : nr.show(), v.html(r), v[0].SelectedIndex = 0, f = pi(t), yr(!0, f), ai(yt, !0), v.prop("disabled", !1)) : (dt(!1), kt(!0)), vr(!0), ui(!1)) }); v.on("change", function () { var t, i, r; nt || (t = v.val(), t || (t = ""), i = k.val(), r = pi(i), t && t != "0" ? n.Query.prototype.BETWEEN.equals(t) ? (yr(!1, r), ui(!0)) : (i = k.val(), r = pi(i), r.getDisplayType() == n.DisplayType.DateTime && n.Query.prototype.EQUAL.equals(t) ? (kt(!1), dt(!0)) : (kt(!0), dt(!1), ui(!1))) : (ai(yt, !1), ui(!1), bi(!0))) }); a.on("change", function () { if (!nt) { var t = a.val(); tr && ii.find(".vis-advancedSearchTableRow").length > 0 ? n.ADialog.confirm("SaveSearch?", !0, "", "Confirm", function (n) { n ? a.val(o.saveQueryID) : lr(t) }) : lr(t) } }); oi.on("click", function (n) { if (!nt && t(n.target).hasClass("vis-delete")) { var r = t(n.target).data("index"); c.splice(r, 1); i.deleteLines(t(n.target).data("userquery")); vi(c); ir--; ir == 0 && (s.prop("readonly", !0), s.val("")) } }); ot.on("click", "LI", function () { var i, r; nt || (i = t(this).data("value"), i != null ? (b(!0), r = t(this).index(), setTimeout(function () { var u, f, t; r < 9 ? (u = i.toString().split("|"), f = u.length, o.created = f == 1 ? !1 : !0, o.days = parseInt(u[0]), i = "") : o.days = 0; w = new n.Query(ft); w.addRestriction(i); t = 0; t = yi(w, !0); w.setRecordCount(t); b(!1); t != 0 && (o.okBtnPressed = !0, l.close()) }, 10)) : (o.okBtnPressed = !1, l.close())) }); yt.on("click", rr); vt.on("click", function () { if (!nt) { var t = a.val(); t == null || t.toString() == "" || parseInt(t) < 1 || n.ADialog.confirm("DeleteConfirm", !0, "", "Confirm", function (r) { if (r) { b(!0); window.setTimeout(function () { var e = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetQueryDefault", { UserQuery_ID: t }, null), r, f; if (e > 0) { n.ADialog.warn("QueryDefaultForOther"); b(!1); return } u.userQueryID == t && (o.needRefreshWindow = !0); r = a.find("option:selected").text(); i.deleteUserQuery(t) ? (f = i.getData(n.context, di, gi, "Code"), ot.empty(), ot.html(ci), ar(f), a[0].selectedIndex = 0, n.ADialog.info("Deleted", !0, r, ""), s.val(""), s.prop("readony", !0), b(!1), a.trigger("change")) : n.ADialog.info("DeleteError", !0, r, ""); b(!1) }, 10) } else b(!1) }) } }); ht.on("click", function () { nt || (o.okPressed = !0, o.okBtnPressed = !0, su()) }); gt.on("click", function () { if (!nt) { rr(); var t = kr(), n = 0; n = yi(t, !0); pr(n) } }); ei.on("click", function () { g && g.data("show") == "N" && (g.data("show", "Y"), t(this).hide(), g.show(), ti.show(), t(".vis-adsearchgroup2").hide(), t(".vis-adsearchgroup1").show(), t(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 150px)")) }); ti.on("click", function () { g.data("show", "N"); g.hide(); ei.show(); ti.hide(); cr(); t(".vis-adsearchgroup1").hide(); t(".vis-adsearchgroup2").show(); a[0].selectedIndex = 0; ii.empty(); c = []; s.val("") }); s.on("input", function () { s.length > 0 ? ht.text(n.Msg.getMsg("SaveAndApply")) : ht.text(n.Msg.getMsg("Apply")) }) } function cr() { k[0].selectedIndex = 0; v[0].selectedIndex = 0; bi(); bi(!0); dt(!1); kt(!0); p.prop("checked", !1); pt.prop("checked", !1); lt.hide(); e.find(".vis-advancedSearchContentArea-down").css("height", "calc(100% - 100px)") } function ru() { ct && (ct.off("click"), p.off("change"), y.off("change"), k.off("change"), v.off("change"), a.off("change"), oi.off("click"), ot.off("click"), yt.off("click"), vt.off("click"), ht.off("click"), gt.off("click")) } function lr(n) { if (o.saveQueryID = n, tr = !1, n && n != "-1") c = i.getQueryLines(n), vi(c), s.val(a.find("option:selected").text()), s.prop("readonly", !1), ai(vt, !0); else ai(vt, !1), s.val(""), s.prop("readonly", !0), c = null, vi(null) } function ar(t) { var u = "", e = "", r, i, f; if (t != null) for (r in t) i = n.Utility.encodeText(t[r].Name), f = i, i.length > 25 && (i = i.substr(0, 25) + "..."), u += '<li data-value="' + t[r].Code + '" title="' + f + '">' + i + "<\/li>", e += '<option value="' + t[r].AD_UserQuery_ID + '" title="' + f + '">' + i + "<\/option>"; u.length > 0 && ot.append(u); a.html("<option value='-1' > <\/option>" + e) } function li(n) { var t = y[0].selectedIndex; if (n) { tt.hide(); st.hide(); rt.hide(); return } tt.show(); st.show(); p.is(":checked") ? rt.show() : rt.hide(); d.prop("readonly", !1); et.prop("min", 1); t == 3 || t == 6 ? (et.prop("min", 0), d.val(0), et.val(0), ni.val(1)) : t == 2 || t == 5 ? (tt.hide(), ni.val(""), et.val(1), d.val(0)) : t == 1 || t == 4 ? (tt.hide(), st.hide(), d.val(0)) : t == 0 && (d.prop("readonly", !0), tt.hide(), st.hide(), d.val(0)) } function uu() { return rt.is(":visible") || tt.is(":visible") || rt.is(":visible") } function fu(n) { var t = "", i; return n == 3 || n == 6 ? (i = Math.round(ri(n) / 365, 1), t = "Last " + i.toString() + " Years") : n == 2 || n == 5 ? (i = Math.round(ri(n) / 31, 1), t = "Last " + i.toString() + " Month") : t = ri() != 0 ? "Last " + ri() + " Days" : "This Day", t } function eu(n) { return " adddays(sysdate, - " + ri(n) + ") " } function ri(n) { var u = 0, i, t; if (n == 3 || n == 6) { var r = ni.val(), i = et.val(), t = d.val(); r = r && r != "" ? parseInt(r) : 0; i = i && i != "" ? parseInt(i) : 0; t = t && t != "" ? parseInt(t) : 0; u = r * 365 + i * 31 + t } else n == 2 || n == 5 ? (i = et.val(), t = d.val(), i = i && i != "" ? parseInt(i) : 0, t = t && t != "" ? parseInt(t) : 0, u = i * 31 + t) : (t = t = d.val(), t = t && t != "" ? parseInt(t) : 0, u = t); return u } function vr(n) { var r = ut.children()[1], i = null; ut.children().length > 2 && (i = ut.children()[2]); i ? t(i).prop("disabled", !n).prop("readonly", !n) : r != null && t(r).prop("disabled", !n).prop("readonly", !n) } function ui(n) { var r = it.children()[1], i = null; it.children().length > 2 && (i = it.children()[2]); i ? t(i).prop("disabled", !n).prop("readonly", !n) : r != null && t(r).prop("disabled", !n).prop("readonly", !n) } function kt(n) { it.css("display", n ? "block" : "none") } function dt(n) { sr.css("display", n ? "flex" : "none") } function ou(n) { n ? pt.prop("disabled", !0) : pt.prop("disabled", !1) } function ai(n, t) { n.prop("disabled", !t) } function yr(i, r) { var e, o, u, f; i && (wt = null); bt = null; e = null; o = null; i ? (e = ut.children()[1], ut.children().length > 2 && (o = ut.children()[2])) : (e = it.children()[1], it.children().length > 2 && (o = it.children()[2])); e != null && (t(e).remove(), o != null && t(o).remove(), e = null); u = null; u = r != null ? r.getIsKey() ? new n.Controls.VNumTextBox(r.getColumnName(), !1, !1, !0, r.getDisplayLength(), r.getFieldLength(), r.getColumnName()) : n.VControlFactory.getControl(null, r, !0, !0, !1) : new n.Controls.VTextBox("columnName", !1, !0, !1, 20, 20, "format", "GetObscureType", !1); u != null && (u.setReadOnly(!1), r.getDisplayType() == n.DisplayType.AmtDimension && (u.hideButton(!1), u.setReadOnlyTextbox(!1)), n.DisplayType.Text == r.getDisplayType() || n.DisplayType.TextLong == r.getDisplayType() ? (u.getControl().attr("rows", "1"), u.getControl().css("width", "100%")) : n.DisplayType.YesNo == r.getDisplayType() ? u.getControl().css("clear", "both") : n.DisplayType.IsDate(r.getDisplayType()) && u.getControl().css("line-height", "1"), f = null, u.getBtnCount() > 0 && !(u instanceof n.Controls.VComboBox) && (f = u.getBtn(0)), i ? (ut.append(u.getControl()), wt = u, f && (ut.append(f), u.getControl().css("width", "calc(100% - 30px)"), f.css("max-width", "30px"))) : (it.append(u.getControl()), bt = u, f && (it.append(f), u.getControl().css("width", "calc(100% - 30px)"), f.css("max-width", "30px"))), r.getDisplayType() == n.DisplayType.AmtDimension && u.getControl().css("width", "100%")) } function vi(n) { var i, f; ii.empty(); var u = "", r = "", t = null; if (n) for (i = 0, f = n.length; i < f; i++)r = '<tr class="vis-advancedSearchTableRow">', t = n[i], r += "<td>" + t.KEYNAME + '<\/td><td style="display:none">' + t.KEYVALUE + "<\/td><td>" + t.OPERATORNAME + "<\/td><td>" + t.VALUE1NAME + '<\/td><td style="display:none">' + t.VALUE1VALUE + "<\/td><td>" + t.VALUE2NAME + '<\/td><td style="display:none">' + t.VALUE2VALUE + "<\/td><td>" + t.FULLDAY + '<\/td><td style="display:none">' + t.AD_USERQUERYLINE_ID + '<\/td><td style="display:none">' + t.OPERATOR + '<\/td><td><i style="cursor:pointer" data-userQuery="' + t.AD_USERQUERYLINE_ID + '" data-index = "' + i + '" class="vis vis-delete"><\/i><\/td>', r += "<\/tr>", u += r; ii.html(u) } function yi(t, i) { var u = "SELECT COUNT(*) FROM ", e, f, c, s; u += ft; e = !1; at != null && at.length > 0 && (u += at.indexOf("@") == -1 ? " WHERE " + at : " WHERE " + n.Env.parseContext(n.context, r, at, !1), e = !0); t != null && t.getIsActive() && (u += e ? " AND " : " WHERE ", u += n.Env.parseContext(n.context, r, t.getWhereClause(!0), !1)); f = n.MRole.getDefault().addAccessSQL(u.toString(), ft, n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RO); n.context.setContext(r, dr, "FindSQL", f); h = 999999; try { c = n.secureEngine.encrypt(f); h = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetNoOfRecrds", { RecQuery: c }, null) } catch (l) { hi.Log(n.Level.SEVERE, f, l) } return s = n.MRole.getDefault(), o.okPressed = !1, h == 0 || h == null ? (h = 0, i && n.ADialog.info("FindZeroRecords", !0, "")) : t != null && s.getIsQueryMax(h) ? n.ADialog.error("FindOverMax", !0, h + " > " + s.getMaxQueryRecords()) : o.okPressed = !0, t != null, h } function pr(n) { var t = " " + n + " / " + h + " "; if (or.text(t), h < f) { hr = !0; return } } function pi(n) { var t, i; if (n == null || n.length == 0) return null; for (t = 0; t < fi.length; t++)if (i = fi[t], n.equals(i.getColumnName())) return i; return null } function rr() { var r = k.val(), n, i, c, h, l; if (!r || r == "-1" || (n = k.find("option:selected").text(), i = "", n == null || n.trim().length == 0)) return !1; if (i = r.toString(), tr = !0, c = p.prop("checked"), c) if (uu()) { var u = ">=", f = " >= ", e = fu(y[0].selectedIndex), o = eu(y[0].selectedIndex); wi(n, i, f, u, e, o, null, null, ur()) } else { var u = "=", f = " = ", e = y.find("option:selected").text(), o = y.val(); wi(n, i, f, u, e, o, null, null, ur()) } else h = v.val(), v[0].selectedIndex > -1 && (h = y.find("option:selected").text()), l = v.val(), wi(n, i, h, l, br(!0), wr(!0), br(!1), wr(!1), ur()); return s.prop("readonly", !1), cr(), ir++, g && g.data("show") == "Y" && (g.data("show", "N"), g.hide(), ei.show(), ti.hide(), t(".vis-adsearchgroup2").hide(), t(".vis-adsearchgroup1").show()), !0 } function wr(t) { var i = null; return (i = t ? wt : bt, i != null) ? i.getDisplayType() == n.DisplayType.YesNo ? i.getValue().toString().toLowerCase() == "true" ? "Y" : "N" : i.displayType == n.DisplayType.AmtDimension ? i.getText() : i.getValue() : "" } function br(t) { var i = null; return (i = t ? wt : bt, i != null) ? i.displayType == n.DisplayType.AmtDimension ? i.getText() : i.getDisplay() : "" } function ur() { if (pt) return pt.is(":checked") ? "Y" : "N" } function wi(t, i, r, u, f, e, o, s, h) { c == null && (c = []); var l = {}; l.KEYNAME = t; l.KEYVALUE = i; l.OPERATORNAME = u; l.VALUE1NAME = n.Utility.encodeText(f); l.FULLDAY = h; l.VALUE1VALUE = f == "" ? "" : e == null ? "NULL" : n.Utility.encodeText(n.Utility.Util.getValueOfString(e)); l.VALUE2NAME = n.Utility.encodeText(o); l.VALUE2VALUE = s == null ? "NULL" : n.Utility.encodeText(n.Utility.Util.getValueOfString(s)); l.AD_USERQUERYLINE_ID = 0; l.OPERATOR = r; c.push(l); vi(c) } function bi(n) { var t = null; t = n ? bt : wt; t != null && t.setValue(null) } function kr() { var l = new n.Query(ft), b, p, tt, h, o, k, w, t; if (c) for (b = 0; b < c.length; b++) { var s = c[b], nt = s.KEYNAME.toString(), a = s.KEYVALUE.toString(), f = pi(a), y = f.getColumnSQL(), u = s.OPERATORNAME.toString(), e = s.VALUE1VALUE, i = null; if (e != null && e.toString().trim().startsWith("adddays") || e.toString().trim().startsWith("@") || (i = fr(f, e)), p = null, e == null || e.toString().length < 1) { if (n.Query.prototype.BETWEEN.equals(u)) continue; i = n.Env.NULLString; p = "NULL" } else p = s.VALUE1NAME.toString(); if (tt = s.FULLDAY.toString(), f.getIsVirtualColumn()) if (y = f.vo.ColumnSQL, a = f.vo.ColumnSQL, n.Query.prototype.BETWEEN.equals(u)) { if (h = s.VALUE2VALUE.toString(), h == null || h.toString().trim().length < 1) continue; if (o = fr(f, h), k = s.VALUE2NAME.toString(), o == null) continue; t = ki(i, o, a, u, !0, !0); where = n.Env.parseContext(n.context, r, t, !1); l.addRestriction(t) } else t = ki(i, o, a, u, !0, !0), where = n.Env.parseContext(n.context, r, t, !1), l.addRestriction(t); else { var d = "C_DimAmt", it = "IsActive", rt = "Amount", ut = "S", v = "E", et = "L", ot = "ECT", st = "F", g = "R", ht = "OM", ct = "WH"; if (f.getDisplayType() == n.DisplayType.DateTime && n.Query.prototype.EQUAL.equals(u) && i && tt == "Y") { var lt = i.getFullYear(), at = i.getMonth(), vt = i.getDate(); o = new Date(lt, at, vt, 24, 00, 00); i = new Date(lt, at, vt, 00, 00, 00); s.VALUE2VALUE = o.toUTCString(); u = n.Query.prototype.BETWEEN } if (n.Query.prototype.BETWEEN.equals(u)) { if (h = s.VALUE2VALUE.toString(), h == null || h.toString().trim().length < 1) continue; if (f.getDisplayType() == n.DisplayType.AmtDimension && (w = ut + v + et + ot + " " + d + "_ID " + st + g + ht + " " + d + " " + ct + v + g + v + " " + it + "='Y' AND " + rt + " " + u + e + " AND " + h, i = n.MRole.getDefault().addAccessSQL(w.toString(), "C_DimAmt", n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RO), u = n.Query.prototype.IN), f.getDisplayType() == n.DisplayType.AmtDimension) t = ki(i, o, y, u, !1, !1), where = n.Env.parseContext(n.context, r, t, !1), l.addRestriction(t); else { if (o = fr(f, h), k = s.VALUE2NAME.toString(), o == null) continue; l.addRangeRestriction(y, i, o, nt, p, k) } } else f.getDisplayType() == n.DisplayType.AmtDimension && (w = ut + v + et + ot + " " + d + "_ID " + st + g + ht + " " + d + " " + ct + v + g + v + " " + it + "='Y' AND " + rt + " " + u + e, i = n.MRole.getDefault().addAccessSQL(w.toString(), "C_DimAmt", n.MRole.SQL_NOTQUALIFIED, n.MRole.SQL_RO), u = n.Query.prototype.IN), i == null && e != null && (e.toString().trim().startsWith("adddays") || e.toString().trim().startsWith("@")) ? (t = ft + "." + a + u + e, f.getDisplayType() == n.DisplayType.AmtDimension && (t = a + n.Query.prototype.IN + "(" + i + ")"), where = n.Env.parseContext(n.context, r, t, !1), l.addRestriction(t)) : f.getDisplayType() == n.DisplayType.AmtDimension ? (t = ki(i, o, y, u, !1, !1), where = n.Env.parseContext(n.context, r, t, !1), l.addRestriction(t)) : l.addRestriction(y, u, i, nt, p) } } return l } function ki(t, i, r, u, f, e) { var o = "", s = /(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})/; return typeof t == "string" && (o += " UPPER( "), e || (o += ft + "."), o += r, typeof t == "string" && (o += " ) "), t == null || "NULL".equals(t.toString().toUpper()) || "NullValue".toUpper().equals(t.toString().toUpper()) ? o += u.equals(n.Query.prototype.EQUAL) ? " IS NULL " : " IS NOT NULL " : (o += u, (n.Query.prototype.IN.equals(u) || n.Query.prototype.NOT_IN.equals(u)) && (o += "("), t instanceof Date || t && s.test(t.toString()) ? o += n.DB.to_date(tcode, !1) : "string" == typeof t ? f ? (o += " UPPER( ", o += n.DB.to_string(t.toString()), o += " ) ") : o += t.toString() : o += t, n.Query.prototype.BETWEEN.equals(u) ? (o += " AND ", i instanceof Date || i && s.test(i.toString()) ? o += n.DB.to_date(i, !1) : typeof i == "string" ? (o += " UPPER( ", o += n.DB.to_string(i.toString()), o += " ) ") : o += i) : (n.Query.prototype.IN.equals(u) || n.Query.prototype.NOT_IN.equals(u)) && (o += ")")), o } function fr(t, i) { var u, r, e, f, o; if (i == null || (u = t.getDisplayType(), r = i.toString(), r == null || r.equals(n.Env.NULLString) || r == "" || r.toUpper() == "NULL")) return null; try { if (u == n.DisplayType.Integer || n.DisplayType.IsID(u) && t.getColumnName().endsWith("_ID")) return parseInt(r); if (n.DisplayType.IsNumeric(u)) return parseFloat(r); if (n.DisplayType.IsDate(u)) { e = ""; try { return new Date(r) } catch (h) { e = "" } try { return Date.Parse(e) } catch (c) { return null } } } catch (s) { return f = s.message, (f == null || f.length == 0) && (f = s.toString()), o = "", o += t.getColumnName() + " = " + r + " - " + f, n.ADialog.error("ValidationError", !0, o.toString()), null } return r } function su() { var f, r; if (b(!0), rr(), w = kr(), w.getRestrictionCount() == 0) { b(!1); l.close(); return } f = w.getWhereClause(!0); r = n.Utility.encodeText(s.val()); r != null && r.trim().length == 0 ? r = null : o.needRefreshWindow = !0; var t = a.val(), u = ""; t = t != null && t.toString() != "-1" && parseInt(t) > 0 ? t : 0; window.setTimeout(function () { if (t != 0 || r != null) if (i.insertOrUpdate(t, r, f, di, gi, c, o.getID)) si = !1, u = t > 0 ? "Updated" : "Saved", o.saveQueryID = i.id; else { if (i.alreadyExist) { n.ADialog.error("SearchExist"); b(!1); si = !0; return } si = !0; u = t > 0 ? "UpdatedError" : "SaveError" } var e = !1; yi(w, !0) != 0 && (e = !0); b(!1); u != "" && n.ADialog.info("", !0, n.Msg.getMsg(u) + " " + r, null); e && l.close() }, 10) } function b(n) { nt = n; er.css("visibility", nt ? "visible" : "hidden"); ht.prop("disabled", n); ct.prop("disabled", n); gt.prop("disabled", n) } var hu = u.getName(), di = u.getAD_Tab_ID(), gi = u.getAD_Table_ID(), ft = u.getTableName(), at = u.getWhereClause(), fi = u.getFields(), wt, bt, ci; this.btnfields = []; var e = t("<div  class='vis-forms-container' style='height:100%'>"), er = null, o = this, l = null, ht, ct, vt, yt, gt, s, a, k, v, y, p, ni, et, d, or, pt, ei, ti, ot, lt, tt, st, rt, ut, it, oi, ii, sr, g, nr, dr = 99, h = 0, hr = !1, si = !1, nt = !1, c = null, hi = n.Logging.VLogger.getVLogger("Find"); this.onClose = null; this.created = !1; this.days = 0; this.okPressed = !1; this.okBtnPressed = !1; this.needRefreshWindow = !1; ci = ""; this.saveQueryID = -1; var tr = !1, ir = 0, w = new n.Query(ft); w.addRestriction(at); gr(); wi; this.getID = function (n) { this.saveQueryID = n }; this.getSavedID = function () { return this.saveQueryID }; this.show = function () { l = new n.ChildDialog; l.setHeight(550); l.setWidth(860); l.setTitle(n.Msg.getMsg("Find")); l.setModal(!0); l.onClose = function () { o.onClose && o.onClose(); o.dispose() }; l.show(); l.setContent(e); l.hideButtons(); b(!1); ct.focus() }; this.getSavedQueryName = function () { return s.val() ? n.Utility.encodeText(s.val()) : "" }; this.getQuery = function () { var t = n.MRole.getDefault(); return t.getIsQueryMax(h) ? (w = n.Query.prototype.getNoRecordQuery(ft, !1), h = 0, hi.warning("Query - over max")) : hi.info("Query=" + w), w }; this.disposeComponent = function () { ru(); ht = ct = vt = yt = gt = null; s = a = k = v = y = p = ni = et = d = null; ot = lt = tt = st = rt = null; e && e.remove(); e = null; h = hr = si = null; c = null; hi = null; this.created = this.days = 0; this.okPressed = this.okBtnPressed = null; wt = bt = ci = null; w = null } } var u = n.Application.contextUrl, f = u + "JsonData/ExecuteNonQuer", e = function (n, i, r) { var e = r ? !0 : !1, u = null, o = { sql: n, param: i }; return t.ajax({ url: f + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: e, data: JSON.stringify(o) }).done(function (n) { u = n; r && r(n) }), u }, i = { alreadyExist: !1, id: 0, getData: function (t, i, r, u) { var o = t.getAD_Client_ID(), f = null; try { f = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetData", { ColumnName: u, Tab_ID: i, Table_ID: r }, null) } catch (e) { console.log(e) } return f }, getQueryLines: function (t) { var i = null, o = [], f, e, u, r; try { if (i = n.dataContext.getJSONData(n.Application.contextUrl + "ASearch/GetQueryLines", { UserQuery_ID: t }, null), f = "", e = "", i != null) for (u in i) r = {}, r.KEYNAME = i[u].KEYNAME, r.KEYVALUE = i[u].KEYVALUE, r.OPERATORNAME = i[u].OPERATORNAME, r.VALUE1NAME = i[u].VALUE1NAME, r.VALUE1VALUE = i[u].VALUE1VALUE, r.VALUE2NAME = i[u].VALUE2NAME, r.VALUE2VALUE = i[u].VALUE2VALUE, r.AD_USERQUERYLINE_ID = i[u].AD_USERQUERYLINE_ID, r.FULLDAY = i[u].FULLDAY, f = i[u].OPERATORNAME, e = n.Query.prototype.OPERATORS[f], r.OPERATOR = e, o.push(r) } catch (s) { } return o }, deleteLines: function (t) { var i = [], r; return i[0] = new n.DB.SqlParam("@AD_UserQuery_ID", t), r = e("VIS_147", i, null), r >= 0 }, deleteUserQuery: function (i) { var r = -1; return t.ajax({ url: n.Application.contextUrl + "ASearch/DeleteQuery", type: "POST", datatype: "json", async: !1, data: { id: i } }).done(function (n) { r = parseInt(n) }), r >= 0 }, insertOrUpdate: function (r, u, f, e, o, s) { var h = -1; return t.ajax({ url: n.Application.contextUrl + "ASearch/InsertOrUpdateQuery", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: !1, data: JSON.stringify({ id: r, name: u, where: f, tabid: e, tid: o, qLines: s }) }).done(function (n) { h = parseInt(n); h == -5 && (i.alreadyExist = !0) }), h > 0 && (i.id = h), h >= 0 } }; r.prototype.getOperatorsQuery = function (t, i) { var f = "", r = "", u; for (u in t) r = t[u], i && (r = n.Msg.getMsg(r)), f += '<option value="' + u + '">' + r + "<\/option>"; return f }; r.prototype.getIsUserColumn = function (n) { return n.endsWith("atedBy") || n.equals("AD_User_ID") ? !0 : n.equals("SalesRep_ID") ? !0 : !1 }; r.prototype.getCurrentDays = function () { return this.days }; r.prototype.getIsCreated = function () { return this.created }; r.prototype.getIsOKPressed = function () { return this.okPressed && this.okBtnPressed }; r.prototype.needRefresh = function () { return this.needRefreshWindow }; r.prototype.dispose = function () { this.disposeComponent() }; n.Find = r }(VIS, jQuery), function (n, t) { function i(n, i, r) { var f = null; return t.ajax({ url: u, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; r && r(n) }), f } function f(i, r, u, f, e, o, s, h) { this.init = function () { l() }; var c = [], l = function () { var i = null, l, w, b, v, k, y, p, e, a; if (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetZoomTargets", data: { tableName: r }, success: function (n) { i = JSON.parse(n) } }), i != null && i.length > 0) for (l = 0; l < i.length; l++)if (w = i[l], t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetZoomTarget", data: { targetTableName: w, curWindow_ID: f, targetWhereClause: u.getWhereClause() }, success: function (n) { zoomList = JSON.parse(n) } }), zoomList != null) for (e in zoomList) { b = zoomList[e]; v = !0; for (k in c) if (c[k].Key == zoomList[e].Key) { v = !1; break } v && c.push(b) } if (i = null, c.length == 0) n.ADialog.info("NoZoomTarget"); else { y = t("<div>"); p = t("<ul class=vis-apanel-rb-ul>"); y.append(p); for (e in c) { a = t("<li data-id='" + c[e].Key + "'>"); a.append(c[e].Name); a.on("click", function (i) { var f, r, u; i.stopImmediatePropagation(); f = t(this).data("id"); r = new n.Query; r.addRestriction(s, n.Query.prototype.EQUAL, h); n.viewManager.startWindow(f, r); u = t("#w2ui-overlay-main"); u.hide(); u = null }); p.append(a) } o.w2overlay(y.clone(!0), { css: { height: "200px" } }) } }, a = function (n, t) { var i; if (t != null && t.Length != 0 && (i = t, !(i.indexOf(" EXISTS ") > 0) && !(i.indexOf(" IN ") > 0) && !(i.indexOf("(") > 0) && !(i.indexOf(")") > 0))) while (i.indexOf("=") != -1) { var f = i.indexOf("="), u = i.lastIndexOf(" ", f), e = f - (u + 1), r = i.substr(u + 1, e); r.indexOf(".") != -1 && (u = r.indexOf(".") + 1, e = f - u, r = r.substr(u, e)); n.indexOf(r) < 0 && n.push(r); i = i.substr(f + 1) } }, v = function (t, i) { var r, o, s; if (i == null || i.Length == 0) return !0; if (r = i, o = !0, r.indexOf(" EXISTS ") > 0 || r.indexOf(" IN ") > 0 || r.indexOf("(") > 0 || r.indexOf(")") > 0) return !1; while (r.indexOf("=") != -1) { var u = r.indexOf("="), f = r.lastIndexOf(" ", u), e = r.substr(f + 1, u - (f + 1)), h = "", c = ""; e.indexOf(".") != -1 && (f = e.indexOf("."), e = e.substr(f, u)); for (s in t) if (e == t[s].columnName) { h = "'" + t[s].columnValue + "'"; break } if (r = r.substr(u + 1), f = 0, u = r.indexOf(" "), c = u == -1 ? r.substr(f) : r.substr(f, u), !n.Evaluator.evaluateLogicTuple(h, "=", c)) { o = !1; break } } return o } } var r = n.Application.contextUrl, u = r + "JsonData/JDataSetWithCode", e = function (t, r, u) { var o = u ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, f; return r && (e.param = r), f = null, i(e, o, function (t) { f = (new n.DB.DataReader).toJson(t); u && u(f) }), f }, o = function (t, r, u) { var o = u ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, f; return r && (e.param = r), f = null, i(e, o, function (t) { f = (new n.DB.DataSet).toJson(t); u && u(f) }), f }; n.AZoomAcross = f }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function ui() { w = f; w || (at = i.gridTable.AD_Table_ID, o = r.getSelectedRows(), l = i.getRecords()[i.getCurrentRow()]); v = t('<ul class="vis-sms-ul" ><\/ul>'); y = t("<div>"); y.css("position", "absolute"); y.css("bottom", "0"); y.css("background", "url('" + n.Application.contextUrl + "Areas/VIS/Images/LoadingCircle.gif') no-repeat"); y.css("background-position", "center center"); y.css("width", "100%"); y.css("height", "100%"); y.css("text-align", "center"); y.css("opacity", ".1"); y[0].style.visibility = "hidden" } function fi() { var i = '         <div class="contentArea" style="width: 100%; float: left;">', r; i += ' <div class="vis-sms-leftDiv"><\/div>'; i += '   <div class="vis-sms-ContentWrap"><div class="vis-sms-ContentArea"><div class="vis-sms-leftWrap"><div class="vacom-form-horizontal">'; i += '   <div class="vis-sms-inputWrap"><div class="vis-sms-form-data-sub">'; i += '         <input type="text"  id="' + s.windowNo + '_emailMoblie"  placeholder="' + n.Msg.getMsg("EnterMobileNumber") + '">'; i += "<\/div>"; i += "  <\/div>"; i += '  <\/div><div class="vis-sms-textarea-div" style="width: 100%; float: left;">'; i += ' <textarea  ondrop="return false;" id="' + s.windowNo + '_vis-sms-textarea" style="width: 100%; height:100%;resize:none" placeholder="' + n.Msg.getMsg("WriteMsgHere") + '"><\/textarea><\/div>'; i += ' <div class="vis-sms-leftFooter">'; i += '<div ><p class="vis-sms-counter" id=' + s.windowNo + '_acCount><\/p> <p  class="vis-sms-counter"   id=' + s.windowNo + '_oper><\/p> <p  class="vis-sms-counter"   id=' + s.windowNo + "_maxCount >160<\/p> <\/div>"; i += ' <input id="' + s.windowNo + '_dyndis" type="checkbox"><label  id="' + s.windowNo + '_dyndislbl"  for="' + s.windowNo + '_dyndis" >' + n.Msg.getMsg("DynamicSms") + "<\/label><\/div><\/div>"; i += '  <div class="vis-sms-divider"><\/div>'; i += ' <div class="vis-sms-rytWrap"><div class="vis-sms-rytContent">'; i += ' <div class="vis-sms-rytBcc"><div class="vis-email-rytBcc-header"><h4>' + n.Msg.getMsg("Mobile") + "<\/h4>"; i += ' <i id="' + s.windowNo + '_SmsRefresh" title="' + n.Msg.getMsg("Refresh") + '" class="vis vis-refresh"><\/i>'; i += '   <\/div><div class="vis-sms-BccList">'; i += " <\/div><\/div><\/div><\/div>  <\/div><\/div>"; e.append(t(i)); r = 0; k = e.find("#" + s.windowNo + "_dyndis"); e.find(".contentArea").css("height", e.height() - 42); e.find(".vis-sms-leftDiv").height(e.height() - 42); a = e.find(".vis-sms-leftDiv"); et = e.find(".vis-sms-BccList"); c = e.find("#" + s.windowNo + "_emailMoblie"); pt = e.find("#" + s.windowNo + "_SmsRefresh"); c.css("margin-top", "10px"); h = e.find("#" + s.windowNo + "_vis-sms-textarea"); $leftfootArea = e.find(".vis-sms-leftFooter"); rt = e.find("#" + s.windowNo + "_acCount"); ut = e.find("#" + s.windowNo + "_oper"); ot = e.find("#" + s.windowNo + "_maxCount"); e.find(".vis-sms-textarea-div").css("margin-top", "10px"); e.find(".vis-sms-rytBcc").height(e.find(".vis-sms-rytContent").height() - 10); w ? (e.find(".vis-sms-leftDiv").hide(), e.find(".vis-sms-rytWrap").hide(), e.find(".vis-sms-textarea-div").height(e.height() - 150), e.find(".vis-sms-leftWrap").css("width", "100%"), e.find("#" + s.windowNo + "_dyndislbl").hide(), r = e.width() - 40, k.prop("checked", !1), k.hide()) : (e.find(".vis-sms-textarea-div").height(e.height() - 150), r = e.width() - 240, e.find(".vis-sms-leftWrap").width(r - 345)); b = e.find(".vis-sms-ContentWrap"); b.css("width", r); yt = !0; e.find(".vis-sms-BccList").height(e.find(".vis-sms-rytContent").height() - 70) } function ei() { var s, u, h, f, e, r; for (nt = t('<i class="fa fa-bars"><\/i>'), s = t('<div class="vis-apanel-lb-toggle" style="overflow-x:hidden;overflow-y:hidden"><\/div>'), s.append(nt), a.append(s), p = t('<ul class="vis-apanel-lb-ul"><\/ul>'), p.css({ height: "calc(100% - 54px)", overflow: "auto", "white-space": "nowrap", width: "100%" }), u = 0; u < i.gridTable.getFields().length; u++)if (h = i.gridTable.getFields(0)[u].getColumnName().toUpper() == i.getKeyColumnName().toUpper(), i.gridTable.getFields(0)[u].getIsDisplayed() || h) { if (h || p.append(t("<li>" + i.gridTable.getFields(0)[u].getHeader() + "<\/li>")), f = [], e = [], i.gridTable.getFields(0)[u].getColumnName().toUpper().equals(g)) for (r = 0; r < o.length; r++)n.DisplayType.IsLookup(i.getField(g).getDisplayType()) ? o[r][g.toLower()] != null && (f.push(o[r][g.toLower()]), e.push(o[r][i.getKeyColumnName().toLower()])) : o[r][g.toLower()] != null && (f.push(o[r][g.toLower()]), e.push(o[r][i.getKeyColumnName().toLower()])); si(f, e) } a.append(p) } function wt(n) { var t, u; if (n && (v.empty(), o = r.getSelectedRows(), l = i.getRecords()[i.getCurrentRow()]), r.singleRow) bt(); else if (o.length > 0) for (t = 0; t < o.length; t++)o[t].mobile != null && (u = o[t][i.getKeyColumnName().toLower()], v.append('<li class="vis-sms-list-li-bcc"  data-mobile="' + o[t].mobile + '"><input id="' + s.windowNo + "_" + o[t].mobile + '_CheckBoxList1" type="checkbox" value="' + o[t].mobile + '" checked/><label class="vis-sms-chcklist-label"  for="' + s.windowNo + "_" + o[t].mobile + '_CheckBoxList1">' + o[t].mobile + "(" + u + ")<\/label><\/li>")); else bt(); n || et.append(v); v.children().length > 1 && k.prop("checked") == !0 && (c.val(""), c.prop("disabled", !0)) } function bt() { if (l.mobile != null) { var n = l[i.getKeyColumnName().toLower()]; v.append('<li class="vis-sms-list-li-bcc" data-mobile="' + l.mobile + '"><input id="' + s.windowNo + "_" + l.mobile + '_CheckBoxList1" type="checkbox" value="' + l.mobile + '" checked /><label class="vis-sms-chcklist-label"  for="' + s.windowNo + "_" + l.mobile + '_CheckBoxList1">' + l.mobile + "(" + n + ")<\/label><\/li>") } } function oi() { it = t('<i class="vis-email-sendbtn vis vis-paper-plane vis-Sms-sendButton" title="' + n.Msg.getMsg("SendSms").replace("&", "") + '" ><\/i>'); ht.append(it); w || (tt = t('<i class="vis-email-btns vis vis-viewdocument vis-sms-preview-btn" title="' + n.Msg.getMsg("Preview").replace("&", "") + '"><\/i>'), ht.append(tt)) } function si(i, r) { for (var u, o, f, e = 0; e < i.length; e++)if (u = n.dataContext.getJSONData(n.Application.contextUrl + "Sms/GetUser", { BPartner_ID: i[e] }, null), o = !1, u != null) for (f in u) if (u[f].ISSMS != null && u[f].ISSMS.toString().equals("Y")) { if (u[f].MOBILE == null || u[f].MOBILE == "") continue; if (t(v.children("li").data(u[f].MOBILE + r[e])).length > 0) continue; v.append('<li  class="vis-sms-list-li-bcc"><input id="' + s.windowNo + "_" + u[f].MOBILE + '_CheckBoxList1" type="checkbox"  value="' + u[f].MOBILE + r[e] + '" checked/><label class="vis-sms-chcklist-label" for="' + s.windowNo + "_" + u[f].MOBILE + '_CheckBoxList1">' + u[f].MOBILE + "(" + r[e] + ")<\/label><\/li>") } } function hi() { it.on("click", bi); h.on("keyup", kt); if (!w) { nt.on("click", ci); k.on("click", li); p.children("li").on("click", ai); tt.on("click", vi); nt.trigger("click"); pt.on("click", yi) } } function ci() { k.prop("checked") == !0 ? a.width() == 40 ? (a.css("width", "200px"), a.find("ul").show(), b.width(b.width() - 160), e.find(".vis-sms-leftWrap").width(e.find(".vis-sms-leftWrap").width() - 160)) : ct() : a.width() != 40 && ct() } function ct() { a.css({ width: "40px" }); a.find("ul").hide(); b.width(b.width() + 160); e.find(".vis-sms-leftWrap").width(e.find(".vis-sms-leftWrap").width() + 160) } function li() { this.checked ? (a.width() != 40 && a.find("ul").show(), r.singleRow == !1 && o.length > 1 && (c.val(""), c.prop("disabled", !0))) : (a.width() != 40 && ct(), c.prop("disabled", !1)) } function ai() { var r = h[0], f = "@@" + t(this).text() + "@@", s = r.scrollTop, n = 0, u = r.selectionStart || r.selectionStart == "0" ? "ff" : document.selection ? "ie" : !1, e, o, i; u == "ie" ? (h.focus(), i = document.selection.createRange(), i.moveStart("character", -h.val().length), n = i.text.length) : u == "ff" && (n = r.selectionStart); e = h.val().substring(0, n); o = h.val().substring(n, h.val().length); h.val(e + f + o); n = n + f.length; u == "ie" ? (h.focus(), i = document.selection.createRange(), i.moveStart("character", -h.val().length), i.moveStart("character", n), i.moveEnd("character", 0), i.select()) : u == "ff" && (r.selectionStart = n, r.selectionEnd = n, h.focus()); r.scrollTop = s; r = null; kt() } function vi() { var f = h.val(), e = "", u, i; e = r.singleRow == !1 && o.length > 0 ? dt(f, 0) : gt(f); u = t("<div><\/div>"); u.append(n.Utility.encodeText(e)); i = new n.ChildDialog; i.setHeight(420); i.setWidth(850); i.setTitle(n.Msg.getMsg("Preview")); i.setModal(!0); i.setContent(u); i.show(); i.hidebuttons() } function yi() { wt(!0) } function kt() { rt.text(h.val().length); parseInt(rt.text()) > parseInt(ot.text()) ? (ut.text(">"), lt("#ED0000")) : parseInt(rt.text()) == parseInt(ot.text()) ? (ut.text("="), lt("#000000")) : (ut.text("<"), lt("#000000")) } function lt(n) { ut.css("color", n); rt.css("color", n); ot.css("color", n) } function pi(t, u) { for (var l = t, h = {}, f = t; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var c = f.substring(0, f.indexOf("@@")), s = null, e = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === c })[0]; n.DisplayType.IsLookup(i.getField(e).getDisplayType()) || n.DisplayType.Location == i.getField(e).getDisplayType() ? o[u][e.toLower()] != null && o[u][e.toLower()] != undefined && (s = i.getField(e.toLower()).lookup.getDisplay(o[u][e.toLower()])) : n.DisplayType.IsDate(i.getField(e).getDisplayType()) ? (s = i.getField(e).value, s = new Date(s)) : s = o[u][e.toLower()]; f = f.substring(f.indexOf("@@") + 2); h["@@" + c + "@@"] = s } return h } function wi(t) { for (var u = t, o = {}; u.indexOf("@@") > -1;) { u = u.substring(u.indexOf("@@") + 2); var s = u.substring(0, u.indexOf("@@")), e = null, f = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === s })[0]; n.DisplayType.IsLookup(i.getField(f).getDisplayType()) || n.DisplayType.Location == i.getField(f).getDisplayType() ? l[f.toLower()] != null && l[f.toLower()] != undefined && (e = i.getField(f.toLower()).lookup.getDisplay(l[f.toLower()])) : n.DisplayType.IsDate(i.getField(f).getDisplayType()) ? (e = i.getField(f).value, e = new Date(e)) : e = l[f.toLower()]; u = u.substring(u.indexOf("@@") + 2); o["@@" + s + "@@"] = e } return o } function dt(t, u) { for (var h = t, f = t; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var c = f.substring(0, f.indexOf("@@")), s = null, e = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === c })[0]; n.DisplayType.IsLookup(i.getField(e).getDisplayType()) || n.DisplayType.Location == i.getField(e).getDisplayType() ? o[u][e.toLower()] != null && o[u][e.toLower()] != undefined && (s = i.getField(e.toLower()).lookup.getDisplay(o[u][e.toLower()])) : n.DisplayType.IsDate(i.getField(e).getDisplayType()) ? (s = i.getField(e).value, s = new Date(s)) : s = o[u][e.toLower()]; f = f.substring(f.indexOf("@@") + 2); h = h.replace("@@" + c + "@@", s) } return h } function gt(t) { for (var f = t; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var o = f.substring(0, f.indexOf("@@")), e = null, u = Object.keys(r.getColumnNames()).filter(function (n) { return r.getColumnNames()[n] === o })[0]; n.DisplayType.IsLookup(i.getField(u).getDisplayType()) || n.DisplayType.Location == i.getField(u).getDisplayType() ? l[u.toLower()] != null && l[u.toLower()] != undefined && (e = i.getField(u.toLower()).lookup.getDisplay(l[u.toLower()])) : n.DisplayType.IsDate(i.getField(u).getDisplayType()) ? (e = i.getField(u).value, e = new Date(e)) : e = r.singleRow == !0 ? i.getField(u).value : l[u.toLower()]; f = f.substring(f.indexOf("@@") + 2); t = t.replace("@@" + o + "@@", e) } return t } function bi(t) { var i = h.val(), r = !0; (i == null || i == "" || i.trim().length == 0) && (r = !1, n.ADialog.confirm("SendWithoutBody", !0, "", "Confirm", function (n) { n && ni(t, i) })); r && ni(t, i) } function ni() { var s, p, i, f, u, a, w, b, d, g; if (ft = [], s = "", p = [], k.prop("checked") == !1) { if (i = {}, i.MobileNumbers = [], c.val().contains(";")) for (f = c.val().split(";"), u = 0; u < f.length; u++)f[u] != null && f[u] != "" && (ii(f[u]) ? i.MobileNumbers.push(f[u]) : s += f[u] + ","); else c.val() != null && c.val() != "" && (ii(c.val()) ? i.MobileNumbers.push(c.val()) : s += c.val() + ","); if (v != null && v != undefined) if (selectedValues = [], e.find("[id*=CheckBoxList1]:checked").each(function () { selectedValues.push(t(this).val()) }), selectedValues.length > 0) for (a = 0; a < selectedValues.length; a++)selectedValues[a] ? i.MobileNumbers.push(selectedValues[a]) : s += selectedValues[a] + ","; else if (c.val().trim().length == 0) { window.setTimeout(function () { n.ADialog.info("NoNumberFound") }, 2); return } if (s != "") { window.setTimeout(function () { n.ADialog.info("InvalidMobileNumbers", " ", n.Msg.getMsg("MobileNo") + s) }, 2); return } if (i.Body = {}, i.MobileNumbers.length > 0) for (w = 0; w < i.MobileNumbers.length; w++)ft.push({ num: i.MobileNumbers[w], info: '"' + i.MobileNumbers[w] + '","' + h.val() + '","' + new Date + '","@@response@@"' }); p.push(i) } else if (selectedValues = [], t("[id*=CheckBoxList1]:checked").each(function () { selectedValues.push(t(this).val()) }), r.singleRow == !0 && o.length > 0) p.push(ti(l, 0)); else for (b = 0; b < o.length; b++)p.push(ti(o[b], b)); d = JSON.stringify(p); y[0].style.visibility = "visible"; g = { sms: d, format: h.val() }; t.ajax({ url: n.Application.contextUrl + "Sms/SendSms", data: g, datatype: "json", type: "post", cache: !1, success: function (i) { var r = JSON.parse(i), e, o, u, s, h, c, f; if (y[0].style.visibility = "hidden", r.ResultMessage == "SmsConfigurationNotFound") { window.setTimeout(function () { n.ADialog.info("SmsConfigurationNotFound") }, 2); return } for (e = t('<div style="max-height: 300px;overflow:auto"><\/div>'), o = t("<table><\/table>"), u = 0; u < r.Response.length; u++)s = t("<tr><\/tr>"), h = t("<td><\/td>"), h.append(r.Response[u].mobileNumber + " - " + r.Response[u].response), s.append(h), o.append(s); e.append(o); c = t('<a style="float:right" href="javascript:void(0)" ><i title="' + n.Msg.getMsg("SaveSmsLog") + '" class="vis vis-save"><\/i><\/a>'); e.append(c); _SmsRefresh; f = new n.ChildDialog; f.setTitle(n.Msg.getMsg("Information")); f.setContent(e); f.show(); f.hidebuttons(); c.on("click", function () { for (var i = "", u, f, e, n = 0; n < r.Response.length; n++)u = t.grep(ft, function (t) { return t.num == r.Response[n].mobileNumber }), i += u[0].info.replace("@@response@@", r.Response[n].response) + "\n"; f = (new Date).toISOString().slice(0, 19).replace(/-/g, ""); e = "data:text/csv;base64," + window.btoa(i); t(this).attr("href", e).attr("download", "file-" + f + ".csv") }) }, error: function (t) { console.log(t); n.ADialog.error("MessageSendingFailed"); y[0].style.visibility = "hidden" } }) } function ti(n, t) { var i = {}, u, t, e, f; if (i.MobileNumbers = [], c.val().contains(";")) for (u = c.val().split(";"), t = 0; t < u.length; t++)u[t] != null && u[t] != "" && i.MobileNumbers.push(u[t]); else c.val() != null && c.val() != "" && i.MobileNumbers.push(c.val()); if (v != null && v != undefined && Object.keys(n).indexOf("mobile") > -1 && selectedValues.indexOf(n.mobile) > -1 && i.MobileNumbers.push(n.mobile), e = "", r.singleRow == !1 ? (i.Body = pi(h.val(), t), e = dt(h.val(), t)) : (i.Body = wi(h.val()), e = gt(h.val())), i.MobileNumbers.length > 0) for (f = 0; f < i.MobileNumbers.length; f++)ft.push({ num: i.MobileNumbers[f], info: '"' + i.MobileNumbers[f] + '","' + e + '","' + new Date + '","@@response@@"' }); return i } function ii(n) { var i = !0, t, r; if (n.indexOf("(") > -1 && (n = n.substring(0, n.toString().indexOf("("))), n.length < 10 || n.length > 17) i = !1; else { for (r = n.length, t = 0; t < r; t++)isNaN(n[t]) && (/\s+$/.test(n[t]) || n[t] != "(" && n[t] != ")" && (i = !1)); n.indexOf("(") > -1 && !n.indexOf(")") > -1 && (i = !1) } return i } function ki() { e.height(vt); e.width(st); var n = 0; e.find(".contentArea").css("height", e.height() - 42); e.find(".vis-sms-leftDiv").height(e.height() - 42); e.find(".vis-sms-textarea-div").css("margin-top", "10px"); e.find(".vis-sms-rytBcc").height(e.find(".vis-sms-rytContent").height() - 10); w ? (e.find(".vis-sms-leftDiv").hide(), e.find(".vis-sms-rytWrap").hide(), e.find(".vis-sms-textarea-div").height(e.height() - 150), e.find(".vis-sms-leftWrap").css("width", "100%"), n = e.width() - 40, k.prop("checked", !1), k.hide()) : (e.find(".vis-sms-textarea-div").height(e.height() - 150), n = st - (e.find(".vis-sms-leftDiv").width() + 30), e.find(".vis-sms-leftWrap").width(n - 345)); b = e.find(".vis-sms-ContentWrap"); b.css("width", n) } this.frame = null; this.windowNo = n.Env.getWindowNo(); var ri = n.Env.getCtx(), d = null, w = !1, g = "C_BPARTNER_ID", o = null, l = null, at = 0, ft = [], s = this, vt = 0, st = 0, p = null, e = t('<div class="vis-sms-rootDiv vis-forms-container"><\/div>'), ht = t('<div class="vis-awindow-header vis-menuTitle">'), a = null, b = null, et = null, nt = null, h = null, v = null, c = null, p = null, rt, ut, ot, it, tt, yt = !1, y, pt = null, k = null; ui(); this.initializeComponent = function () { var i = t('<a href="javascript:void(0)"  class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/a>'), u = ""; u = w ? t("<p>" + n.Msg.getMsg("Sms") + " (" + n.Msg.getMsg("Contacts") + ") <\/p>") : t("<p>" + n.Msg.getMsg("Sms") + " (" + r.aPanel.$parentWindow.getName() + ") <\/p>"); e.append(ht.append(i).append(u)); e.append(y); i.click(function (n) { s.dispose(); s = null; n.stopPropagation() }); fi(); oi(); w || (ei(), wt(!1)); hi() }; this.disposeComponent = function () { it.off("click"); w || (nt.off("click"), p.children("li").off("click"), p.remove(), nt.remove()); k.off("click"); tt != undefined && (tt.off("click"), tt.remove()); h.off("keyup"); e.find(".vis-sms-CcBcc").off("click"); ri = null; d = null; w = !1; g = ""; o = null; l = null; at = 0; p = null; e.remove(); e = null; a.remove(); a = null; b.remove(); b = null; et.remove(); et = null; nt = null; v.remove(); v = null; c.remove(); c = null; p != null && p.remove(); p = null; it.remove(); it = null; tt = null; s = null }; this.show = function () { d = new n.ChildDialog; d.setHeight(800); d.setWidth(1600); d.setTitle(n.Msg.getMsg("Sms")); d.setModal(!0); d.show(); e = t('<div class="vis-sms-rootDiv"><\/div>'); d.setContent(e); initializeComponent() }; this.getRoot = function () { return e }; this.sizeChanged = function (n, t) { vt = n; st = t; yt == !0 && ki() } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; t.hideHeader(!0); this.initializeComponent(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Sms = i }(VIS, jQuery), function (n, t) { function f(n, i, u) { var f = null; return t.ajax({ url: r, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; u && u(n) }), f } function e(i, r, f, e, o, s) { var a = 232, c = "", l = null, h = null; this.getRequests = function () { for (var e = u("VIS_72", null), h, l, a, o, i; e.read();)if (parseInt(e.getString(0)) == 0) { n.ADialog.error("VIS_NotSupported"); return } for (c = "(AD_Table_ID=" + r + " AND Record_ID=" + f + ")", r == 114 ? c += " OR AD_User_ID=" + f + " OR SalesRep_ID=" + f : r == 291 ? c += " OR C_BPartner_ID=" + f : r == 259 ? c += " OR C_Order_ID=" + f : r == 318 ? c += " OR C_Invoice_ID=" + f : r == 335 ? c += " OR C_Payment_ID=" + f : r == 208 ? c += " OR M_Product_ID=" + f : r == 203 ? c += " OR C_Project_ID=" + f : r == 539 && (c += " OR A_Asset_ID=" + f), e = null, t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetProcessedRequest", data: { AD_Table_ID: r, Record_ID: f }, success: function (t) { e = (new n.DB.DataReader).toJson(t) } }), h = 0, l = 0; e.read();)"Y" == e.getString(0) ? h = e.getString(1) : l += e.getString(1); a = t("<div>"); o = t("<ul class=vis-apanel-rb-ul>"); a.append(o); i = t("<li data-id='RequestCreate'>"); i.append(n.Msg.getMsg("RequestNew")); i.on("click", function (n) { v(n) }); if (o.append(i), l > 0) { i = t("<li data-id='RequestActive'>"); i.append(n.Msg.getMsg("RequestActive")); i.on("click", function (n) { y(n) }); o.append(i) } if (h > 0) { i = t("<li data-id='RequestActive'>"); i.append(n.Msg.getMsg("RequestAll")); i.on("click", function (n) { p(n) }); o.append(i) } s.w2overlay(a.clone(!0), { css: { height: "200px" } }) }; var v = function (i) { i.stopImmediatePropagation(); l = n.viewManager.startWindow(a, null); l.onLoad = function () { var n = l.cPanel.curGC; n.onRowInserting = function () { l.cPanel.cmd_new(!1) }; n.onRowInserted = function () { h = l.cPanel.curTab; h.setValue("AD_Table_ID", r); h.setValue("Record_ID", f); e != null && e > 0 && h.setValue("C_BPartner_ID", e); r == 291 ? h.setValue("C_BPartner_ID", f) : r == 114 ? h.setValue("AD_User_ID", f) : r == 203 ? h.setValue("C_Project_ID", f) : r == 539 ? h.setValue("A_Asset_ID", f) : r == 259 ? h.setValue("C_Order_ID", f) : r == 318 ? h.setValue("C_Invoice_ID", f) : r == 208 ? h.setValue("M_Product_ID", f) : r == 335 ? h.setValue("C_Payment_ID", f) : r == 319 && h.setValue("M_InOut_ID", f) } }; var u = t("#w2ui-overlay"); u.hide(); u = null }, y = function (i) { var r, u; i.stopImmediatePropagation(); r = new n.Query; r.addRestriction("(" + c + ") AND Processed='N'"); n.viewManager.startWindow(a, r); u = t("#w2ui-overlay"); u.hide(); u = null }, p = function (i) { var r, u; i.stopImmediatePropagation(); r = new n.Query; r.addRestriction(c); n.viewManager.startWindow(a, r); u = t("#w2ui-overlay"); u.hide(); u = null } } var i = n.Application.contextUrl, r = i + "JsonData/JDataSetWithCode", u = function (t, i, r) { var o = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, f(e, o, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }; n.ARequest = e }(VIS, jQuery), function (n, t) { function i() { var c = n.Application.contextFullUrl, a, i; if (c || (c = n.Application.contextUrl), c && c.toString().toLowerCase().indexOf("softwareonthecloud.com") > -1) { n.ADialog.info("VIS_GotoControlPanel", !0, "", ""); return } var l = t("<div class='vis-forms-container' style='height:100%'>"), et = t("<div class='vis-its-main-wrap vis-pull-left'>"), ut = t("<div style='height:100%'>"); l.append(ut); ut.append(et); a = t("<div class='vis-its-ryt-panel vis-pull-right' >"); i = t("<div class='vis-its-ryt-panel-inner vis-pull-left' >"); ut.append(a); a.append(i); i.append(t("<h3>").append(n.Msg.getMsg("Result"))); var r = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), pt = n.Env.getWindowNo(), v = null, y = null, p = null, w = null, f = null, e = null, b = null, o = null, k = null, d = null, g = null, nt = null, tt = null, s = null, st = null, it = null, rt = null, ft = null, u = null, h = null, ot = null; this.load = function () { var ri = t("<div class='vis-graywrap'>"), i, ui, a, fi, ut, ei, ft, oi, st, si, yt, hi, pt, ci, wt, li, bt, ai, u, kt, dt, gt, ni, ti, c, ii; et.append(ri); i = t("<div class='initial-client-form'>"); ri.append(i); i.append(t("<h3 class='VIS_Pref_change-pass'>").append(t("<label class='VIS_Pref_Label_Font'>").append(n.Msg.getMsg("TenantHeaderComment")))); ui = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); a = t("<div class='vis-control-wrap'><\/div>"); v = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("Tenant") + '">'); ui.append(a); a.append(v); a.append(t("<label>").append(n.Msg.translate(n.context, "AD_Client_ID"))); i.append(ui); fi = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); ut = t("<div class='vis-control-wrap'><\/div>"); y = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("Org") + '">'); fi.append(ut); ut.append(y); ut.append(t("<label>").append(n.Msg.translate(n.context, "AD_Org_ID"))); i.append(fi); ei = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); ft = t("<div class='vis-control-wrap'><\/div>"); p = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("TenantAdmin") + '">'); ei.append(ft); ft.append(p); ft.append(t("<label>").append(n.Msg.parseTranslation(n.context, "@AD_User_ID@ @AD_Client_ID@"))); i.append(ei); oi = t("<div class='input-group vis-input-wrap vis-intial-form-data'>"); st = t("<div class='vis-control-wrap'><\/div>"); w = t('<input type="text" name="tenant" placeholder="' + n.Msg.getMsg("TenantUser") + '">'); oi.append(st); st.append(w); st.append(t("<label>").append(n.Msg.parseTranslation(n.context, "@AD_User_ID@ @AD_Org_ID@"))); i.append(oi); si = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo'>"); yt = t("<div class='vis-control-wrap'><\/div>"); f = t('<select placeholder="Currency">'); si.append(yt); yt.append(f); yt.append(t("<label>").append(n.Msg.translate(n.context, "C_Currency_ID"))); i.append(si); hi = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo'>"); pt = t("<div class='vis-control-wrap'><\/div>"); e = t('<select placeholder="Country">'); hi.append(pt); pt.append(e); pt.append(t("<label>").append(n.Msg.translate(n.context, "C_Country_ID"))); i.append(hi); ci = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo'>"); wt = t("<div class='vis-control-wrap'><\/div>"); b = t('<input type="text" placeholder="' + n.Msg.getMsg("City") + '" style="width:100%;">'); ci.append(wt); wt.append(b); wt.append(t("<label>").append(n.Msg.translate(n.context, "City"))); i.append(ci); li = t("<div class='input-group vis-input-wrap vis-intial-form-dataCombo' >"); bt = t("<div class='vis-control-wrap'><\/div>"); o = t('<select placeholder="Region">'); bt.append(o); bt.append(t("<label>").append(n.Msg.translate(n.context, "C_Region_ID"))); li.append(bt); i.append(li); i.append(t('<div style="width:100%;float:left;">').append(t("<label  class='vis-cs-op-lbl' class='vis-pull-left'>").append(n.Msg.getMsg("Optional")))); ai = t('<div class="vis-fieldset-wrap">'); u = t("<div class='vis-intial-form-data vis-fieldset-inn'>"); ai.append(u); i.append(ai); kt = t('<div class="vis-initial-form-checkbox" >'); k = t('<input type="checkbox">'); kt.append(k); kt.append(t("<label>").append(n.Msg.translate(n.context, "C_Project_ID"))); u.append(kt); dt = t('<div class="vis-initial-form-checkbox">'); d = t('<input type="checkbox">'); dt.append(d); dt.append(t("<label>").append(n.Msg.translate(n.context, "C_SalesRegion_ID"))); u.append(dt); gt = t('<div class="vis-initial-form-checkbox">'); g = t('<input type="checkbox" checked disabled>'); gt.append(g); gt.append(t("<label>").append(n.Msg.translate(n.context, "M_Product_ID"))); u.append(gt); ni = t('<div class="vis-initial-form-checkbox">'); nt = t('<input type="checkbox">'); ni.append(nt); ni.append(t("<label>").append(n.Msg.translate(n.context, "C_Campaign_ID"))); u.append(ni); ti = t('<div class="vis-initial-form-checkbox">'); tt = t('<input type="checkbox" checked disabled>'); ti.append(tt); ti.append(t("<label>").append(n.Msg.translate(n.context, "C_BPartner_ID"))); u.append(ti); c = t("<div class='vis-initial-btn-left vis-pull-right'>"); ri.append(c); ii = t('<div style="display: inline;">'); c.append(ii); h = t('<input type="checkbox" style="margin-right: 5px;margin-left: 10px;margin-top: 5px;display:none">'); h.prop("checked", !0); h.on("click", function () { h.prop("checked") ? s.css("display", "none") : s.css("display", "initial") }); ii.append(h); ot = t("<label style='margin-right: 10px;font-size: 14px;color: #666;font-weight: normal;display:none'>").append(n.Msg.getMsg("UseDefault")); ii.append(ot); s = t("<a class='vis-initial-btn vis-initial-btn-blue' style='margin-right:10px;display:none;'>").append(n.Msg.getMsg("LoadAccountingValues")); s.on("click", function () { rt.trigger("click") }); c.append(s); rt = t("<input type='file' style='display:none;' accept='.csv*'>"); rt.change(function () { at(this) }); c.append(rt); it = t("<a class='vis-initial-btn' style='margin-right: 15px;'>").append(n.Msg.getMsg("Done")); it.on("click", function () { vt() }); c.append(it); l.append(r); r[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "VSetup/GetInitialData", dataType: "json", error: function () { n.ADialog.error(n.Msg.getMsg("ERRORGettingInitialData")); r[0].style.visibility = "hidden" }, success: function (t) { var i = t.result; if (i == null) { n.ADialog.error(n.Msg.getMsg("ERRORGettingInitialData")); r[0].style.visibility = "hidden"; return } ht(i.currency); ct(i.country); lt(i.region); r[0].style.visibility = "hidden" } }) }; var ht = function (n) { if (n != null) for (var i in n) f.append(t('<option value="' + n[i].ID + '">').append(n[i].Name)) }, ct = function (n) { if (n != null) for (var i in n) e.append(t('<option value="' + n[i].ID + '">').append(n[i].Name)) }, lt = function (n) { if (n != null) for (var i in n) o.append(t('<option value="' + n[i].ID + '">').append(n[i].Name)) }, at = function (t) { u = t.files[0].name; r[0].style.visibility = "visible"; window.setTimeout(function () { ft = Date.now().toString(); var i = new XMLHttpRequest, f = new FormData; f.append("file", t.files[0]); i.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + u + "&folderKey=" + ft, !1); i.send(f); r[0].style.visibility = "hidden" }, 2) }, vt = function () { var l, a, s, c, it, ot, rt, st, ut, ht, et; if (i.empty(), l = v.val(), l == null || l.length == 0 || l.trim().length == 0) { n.ADialog.error("FillTenantName"); return } if (a = y.val(), a == null || a.length == 0 || a.trim().length == 0) { n.ADialog.error("FillOrgName"); return } if (s = p.val(), s == null || s.length == 0 || s.trim().length == 0) { n.ADialog.error("FillUserClient"); return } if (c = w.val(), c == null || c.length == 0 || c.trim().length == 0) { n.ADialog.error("FillUserOrg"); return } if (it = b.val(), it == null || it.length == 0 || it.trim().length == 0) { n.ADialog.error("FillCity"); return } if (ot = f.val(), rt = f.find("option:selected").text(), rt == null || rt.length == 0 || rt.trim().length == 0) { n.ADialog.error("FillCurrency"); return } if (st = e.val(), ut = e.find("option:selected").text(), ut == null || ut.length == 0 || ut.trim().length == 0) { n.ADialog.error("FillCountry"); return } if (ht = o.val(), et = o.find("option:selected").text(), et == null || et.length == 0 || et.trim().length == 0) { n.ADialog.error("FillRegion"); return } if (h.prop("checked")) u = null; else if (u == null || u.length == 0 || u.trim().length == 0) { n.ADialog.error("SelectFile"); return } if (s == c) { n.ADialog.error("UsernameMustBeDifferent"); return } var ct = g.prop("checked"), lt = tt.prop("checked"), at = k.prop("checked"), vt = nt.prop("checked"), pt = d.prop("checked"); r[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "VSetup/InitailizeClientSetup", type: "POST", dataType: "json", data: { clientName: l, orgName: a, userClient: s, userOrg: c, city: it, currencyID: ot, currencyName: rt, countryID: st, countryName: ut, regionID: ht, regionName: et, cfProduct: ct, cfBPartner: lt, cfProject: at, cfMCampaign: vt, cfSRegion: pt, fileName: u, folderKey: ft }, error: function () { n.ADialog.error("ErrorCreatingTenant"); r[0].style.visibility = "hidden" }, success: function (n) { var t = n.result; r[0].style.visibility = "hidden"; yt(t) } }) }, yt = function (r) { r.Log != null && r.Log.trim().length > 0 && (i.append(t('<div style="margin-bottom:10px">').append(" Error - " + r.Log)), i.append(t('<div style="margin-bottom:10px">').append(n.Msg.getMsg("VIS_TenantErrorMsg")))); i.append(t('<div style="margin-bottom:10px">').append(" Tenant Name - " + r.TenantName)); i.append(t('<div style="margin-bottom:10px">').append(" Organization Name - " + r.OrgName)); i.append(t('<div style="margin-bottom:10px">').append(" Admin Role - " + r.AdminRole)); i.append(t('<div style="margin-bottom:10px">').append(" User Role - " + r.UserRole)); i.append(t('<div style="margin-bottom:10px">').append(" Admin Username - " + r.AdminUser)); i.append(t('<div style="margin-bottom:10px">').append(" Admin User Password - " + r.AdminUserPwd)); i.append(t('<div style="margin-bottom:10px">').append(" Org Username - " + r.OrgUser)); i.append(t('<div style="margin-bottom:10px">').append(" Org User Password - " + r.OrgUserPwd)); var u = t('<a href="javascript:void(o)" class="vis-initial-btn vis-initial-btn-blue">').append(t("<i class='vis vis-save'><\/i>")); u.on("click", function () { var n = "", i, u; n += " Tenant Name - " + r.TenantName + "\t\n"; n += " Organization Name - " + r.OrgName + "\t\n"; n += " Admin Role - " + r.AdminRole + "\t\n"; n += " User Role - " + r.UserRole + "\t\n"; n += " Admin Username - " + r.AdminUser + "\t\n"; n += " Admin User Password - " + r.AdminUserPwd + "\t\n"; n += " Org Username - " + r.OrgUser + "\t\n"; n += " Org User Password - " + r.OrgUserPwd + "\t\n"; i = (new Date).toISOString().slice(0, 19).replace(/-/g, ""); u = "data:text/csv;base64," + window.btoa(n); t(this).attr("href", u).attr("download", "file-" + i + ".txt"); divLog.dialog("close"); divLog = null }); a.append(u) }; this.disposeComponent = function () { v = null; y = null; p = null; w = null; f = null; e = null; b = null; o = null; k = null; d = null; g = null; nt = null; tt = null; s = null; st = null; it = null; r = null; l = null }; this.getRoot = function () { return l } } n.Apps = n.Apps || {}; n.Apps.AForms = n.Apps.AForms || {}; i.prototype.sizeChanged = function () { }; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.load(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VSetup = i }(VIS, jQuery), function (n, t) { function i() { function s(o) { e = o; u = e.find("#vis_favScroll"); h(); f = t("#userFav-Tab"); i = t('<ul class="vis-userFavourites-ListMenu">'); i.on("click", function (u) { var f = t(u.target), e; f.data("btn") == "action" ? n.viewManager.startAction(f.data("action"), f.data("id")) : f.data("btn") == "zoom" ? n.viewManager.startActionInNewTab(f.data("action"), f.data("id")) : f.data("btn") == "remove" && (a(f.data("id")), e = t(f).parent().parent(), e.empty(), e.remove(), r(i.find("li").length)) }) } function h() { t.ajax({ url: n.Application.contextUrl + "Home/GetFavouriteNode", dataType: "json", error: function () { alert(n.Msg.getMsg("ERRORGetFavouriteNode")) }, success: function (n) { if (u.empty(), n.result) for (var t = 0, f = n.result.length; t < f; t++)o(n.result[t]); r(i.find("li").length); u.append(i) } }) } function c(n) { o(n); r(i.find("li").length) } function o(r) { var e, u, l, f, c, s; if (i != null) { e = t('<li data-nodeid="' + r.NodeID + '" >'); u = 0; r.Action == "W" ? u = r.WindowID : r.Action == "X" ? u = r.FormID : r.Action == "P" ? u = r.ProcessID : r.Action == "R" && (u = r.ProcessID); var o = t('<a href="#" data-id="' + u + '" data-action="' + r.Action + '" data-nodeid="' + r.NodeID + '" data-btn="action" style="overflow: auto;" >'), h = t('<div class="vis-favboxtopico">'), a = t("<a href='javascript:void(0)' data-id='" + r.NodeID + "'  data-btn='remove' class='vis vis-removefav'>"); h.append(a); l = t("<a href='javascript:void(0)' data-id='" + u + "' data-action='" + r.Action + "' data-btn='zoom' class='vis vis-new-tab'>"); h.append(l); e.append(h); e.append(o); f = r.Name; f.length > 27 ? (f = f.substr(0, 27), o.append(f), c = t("<a href='#' class='VIS_Pref_tooltip' style='display: inline-block;'>").append("..."), s = t("<span style='width: inherit;'>"), s.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/ccc.png").append("ToolTip Text")), s.append(t("<label class='VIS_Pref_Label_Font'>").append(r.Name)), c.append(s), o.append(c)) : o.append(r.Name); i.append(e) } } function l(n) { var f, u, e, o; if (i != null) { for (f = i.find("li"), u = null, e = 0, o = f.length; e < o; e++)u = t(f[e]), u.data("nodeid") === n && u.remove(); f = u = null; r(i.find("li").length) } } function a(i) { n.FavouriteHelper.removeFavourite(i); t.ajax({ url: n.Application.contextUrl + "Home/RemoveNodeFavourite/?nodeID=" + i, dataType: "json" }) } function r(t) { f.empty(); f.html("<span><i class='vis vis-favourite'><\/i><\/span><span class='favouriteTabLabel-Large'>" + n.Msg.getMsg("Favourites") + " - <\/span><strong>" + t + "<\/strong>") } var e, u, i, f; return { init: s, addFavourite: c, removeFavourite: l } } n.favMgr = i() }(VIS, jQuery), function (n, t) { function h(i, r) { var u = null, f = ""; url = n.Application.contextUrl + "WSP/Contacts/GetBPLocation?WinNo=" + r.windowNo + "&bpartnerID=" + i; t.ajax({ type: "GET", async: !1, url: url, dataType: "json", success: function (n) { u = JSON.parse(n); for (var t = 0; t < u.lstBPLocation.length; t++)f += "<option value='" + u.lstBPLocation[t].ID + "'>" + u.lstBPLocation[t].Name + "<\/option>"; o.empty(); o.append(f) } }) } function c(t, i, r, f, e, o) { u = new n.ChildDialog; u.setContent(t); i == "Customer" ? u.setTitle(n.Msg.getMsg("Customer")) : i == "Employee" ? u.setTitle(n.Msg.getMsg("Employee")) : i == "Vendor" ? u.setTitle(n.Msg.getMsg("Vendor")) : i == "Prospect" && u.setTitle(n.Msg.getMsg("Prospect")); u.setEnableResize(!1); u.setModal(!0); u.show(); l(e, i, o); r.on("change", function () { h(r.val(), f) }) } function l(e, o, s) { u.onOkClick = function () { var l = t("#divBPartner_" + i.windowNo).find("img"), rt = t(window).height() * (50 / 100), ut = t(window).width() * (50 / 100), u; e.css("margin-top", rt); e.css("margin-left", ut); s.show(); l.css("visibility", "visible"); var h = t("#txtName_" + i.windowNo).val(), c = t("#txtSearchKey_" + i.windowNo).val(), a = t("#ddlGreeting1_" + i.windowNo).val(), ft = t("#txtName2_" + i.windowNo).val(), v = t("#ddlBPGroup_" + i.windowNo).val(), y = t("#ddlBPRelation_" + i.windowNo).val(), p = t("#ddlBPLoaction_" + i.windowNo).val(), w = t("#txtContact_" + i.windowNo).val(), b = t("#ddlGreeting_" + i.windowNo).val(), k = t("#txtTitle_" + i.windowNo).val(), d = t("#txtEmail_" + i.windowNo).val(), g = r.getValue(), nt = t("#txtPhone_" + i.windowNo).val(), tt = t("#txtPhone2_" + i.windowNo).val(), it = t("#txtFax_" + i.windowNo).val(); if (h.trim() == "" || c.trim() == "") { n.ADialog.info("NameMandatory"); s.hide(); l.css("visibility", "collapse"); return } u = null; o == "Customer" ? u = n.Msg.getMsg("Customer") : o == "Employee" ? u = n.Msg.getMsg("Employee") : o == "Vendor" ? u = n.Msg.getMsg("Vendor") : o == "Prospect" && (u = n.Msg.getMsg("Prospect")); url = n.Application.contextUrl + "WSP/Contacts/AddBPartnerInfo"; v == "0" && (v = undefined); y == "0" && (y = undefined); p == "0" && (p = undefined); b == "0" && (b = undefined); a == "0" && (a = undefined); g == null && (g = undefined); nt == "" && (nt = undefined); tt == "" && (tt = undefined); w == "" && (w = undefined); h == null && (h = undefined); it == "" && (it = undefined); c == "" && (c = undefined); k == "" && (k = undefined); d == "" && (d = undefined); u == "" && (u = undefined); t.ajax({ type: "Post", async: !1, url: url, dataType: "json", data: { searchKey: c, name: h, name2: ft, greeting: b, bpGroup: v, bpRelation: y, bpLocation: p, contact: w, greeting1: a, title: k, email: d, address: g, phoneNo: nt, phoneNo2: tt, fax: it, windowNo: i.windowNo, BPtype: u }, success: function (n) { s.hide(); l.css("visibility", "collapse"); alert(n); f.empty() } }) } } function a(i, u, o, s, h, l, a) { var y = null, p = "", w = "", b = "", k = "", g = new n.MLocationLookup(n.context.ctx, i.windowNo), nt, d; r = new n.Controls.VLocation("C_Location_ID", !0, !1, !0, n.DisplayType.Location, g); nt = r.getBtnCount(); f = t("<div id='divBPartner_" + i.windowNo + "' style='width:auto;height:auto;margin-right:5px'> <img src='/ViennaAdvantageWeb1/Areas/VIS/Images/busy.gif' style=' margin-top: 120px; margin-left: 327px; z-index:9999;position:absolute;visibility:collapse'>"); d = n.Application.contextUrl + "WSP/Contacts/AddBusinessPartner?WinNo=" + i.windowNo + "&UserID=" + u; t.ajax({ type: "GET", async: !1, url: d, dataType: "json", success: function (n) { for (var i = JSON.parse(n), t = 0; t < i.lstGreeting.length; t++)p += "<option value='" + i.lstGreeting[t].ID + "'>" + i.lstGreeting[t].Name + "<\/option>"; for (t = 0; t < i.lstBPGroup.length; t++)w += "<option value='" + i.lstBPGroup[t].ID + "'>" + i.lstBPGroup[t].Name + "<\/option>"; for (t = 0; t < i.lstBPRelation.length; t++)b += "<option value='" + i.lstBPRelation[t].ID + "'>" + i.lstBPRelation[t].Name + "<\/option>"; for (t = 0; t < i.lstBPLocation.length; t++)k += "<option value='" + i.lstBPLocation[t].ID + "'>" + i.lstBPLocation[t].Name + "<\/option>"; y = v(p, w, k, b, o, s) } }); f.append(y); f.load(); c(f, h, e, i, l, a) } function v(u, f, c, l, a, v) { var y = t("<table id='tableBPartner_" + i.windowNo + "'><tr><td><div style='margin-top: 0px; float: right' class='wsp-BPartner'>" + n.Msg.getMsg("SearchKey") + " <\/div><\/td><td style='width:300px'><div style='margin-top: 0px;width:100%' class='wsp-BPartner'><input id='txtSearchKey_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><td style='width:50px'><\/td> <td style='margin-left:10px'><div style='margin-top: 0px; float: right;margin-right: 5px' class='wsp-BPartner'>" + n.Msg.getMsg("Greeting") + "  <\/div><\/td><td style='width:300px'><div style='margin-top: 0px;margin-right:5px' class='wsp-BPartner'><select id='ddlGreeting1_" + i.windowNo + "' style='width:100%'>" + u + "<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Name") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtName_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Name2") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtName2_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><td style='width:50px'> <\/td> <td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("BPGroup") + "  <\/div><\/td><td style='width:300px'><div style='margin-right: 5px' class='wsp-BPartner'><select id='ddlBPGroup_" + i.windowNo + "' style='width: 100%'>" + f + "<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("BPRelation") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><select style='width:100%' id='ddlBPRelation_" + i.windowNo + "' >" + l + "<\/select><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("BPLoaction") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><select id='ddlBPLoaction_" + i.windowNo + "' style='width:100%'><\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Contact") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtContact_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Greeting") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><select id='ddlGreeting_" + i.windowNo + "' style='width: 100%'>" + u + "<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Title") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtTitle_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("EmailAddress") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><input id='txtEmail_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Address") + "  <\/div><\/td><td style='width:300px'><div style='width:100%' id='divAddress_" + i.windowNo + "' class='wsp-BPartner' ><\/div> <\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Phone") + "  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><input id='txtPhone_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("2ndPhone") + "  <\/div><\/td><td style='width:300px'><div class='wsp-BPartner' style='width:100%;'><input id='txtPhone2_" + i.windowNo + "' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>" + n.Msg.getMsg("Fax") + "  <\/div><\/td><td style='width:300px' ><div style='margin-bottom:7px;margin-right: 5px' class='wsp-BPartner' ><input id='txtFax_" + i.windowNo + "' style='height: 25px;width:100%;' type='text'><\/div><\/td><\/tr><\/table>"), p = y.find("#divAddress_" + i.windowNo); return y.find("#ddlBPRelation_" + i.windowNo).val(a), e = y.find("#ddlBPRelation_" + i.windowNo), o = y.find("#ddlBPLoaction_" + i.windowNo), s = y.find("#ddlBPGroup_" + i.windowNo).val(v), h(a, i), r.getBtn(0).css("width", "10%"), r.getBtn(0).css("height", "10%"), r.getBtn(0).css("padding", "0px"), r.getBtn(1).css("width", "10%"), r.getBtn(1).css("height", "10%"), r.getBtn(1).css("padding", "0px"), p.append(r.getControl().css("width", "80%")).append(r.getBtn(0)).append(r.getBtn(1)), y } var u = null, f = null, i = null, r = null, e = null, o = null, s = null; n.BPartner = function (n, t, r, u, e, o, s) { f != null && f.empty(); i = n; a(i, t, r, u, e, o, s) }; n.AddUpdateBPartner = function (i, h, c, l, a, v) { function ti(n, t, i) { ii(n, t, i) } function ii(i, e, o) { var s = null, h = "", c = "", a = "", v = "", p = new n.MLocationLookup(n.context.ctx, i), w, l; r = new n.Controls.VLocation("C_Location_ID", !0, !1, !0, n.DisplayType.Location, p); w = r.getBtnCount(); f = t("<div id='divBPartner_" + i + "' style='width:auto;height:auto;margin-right:5px'> <img src='/ViennaAdvantageWeb1/Areas/VIS/Images/busy.gif' style=' margin-top: 120px; margin-left: 327px; z-index:9999;position:absolute;visibility:collapse'>"); ei(f, i, e, o); l = n.Application.contextUrl + "BPartner/InitBP?WinNo=" + i + "&bPartnerID=" + e + "&bpType=" + o; t.ajax({ type: "GET", async: !1, url: l, dataType: "json", success: function (t) { for (var u = JSON.parse(t), r = 0; r < u.lstGreeting.length; r++)h += "<option value='" + u.lstGreeting[r].ID + "'>" + n.Utility.encodeText(u.lstGreeting[r].Name) + "<\/option>"; for (r = 0; r < u.lstBPGroup.length; r++)c += "<option value='" + u.lstBPGroup[r].ID + "'>" + n.Utility.encodeText(u.lstBPGroup[r].Name) + "<\/option>"; s = ri(i, e, o, u, h, c, v, a) } }); window.setTimeout(function () { u != null && (f.append(s), f.load(), t(".vis-apanel-busy").css("visibility", "hidden"), t(".vis-apanel-busy").css("height", "460px"), t(".vis-apanel-busy").css("z-index", "99"), y != null && y.hide()) }, 500) } function ri(i, u, f, h, c, l) { var a = t("<DIV class='vis-MainDivBPartnerPopUp'><DIV class='vis-DivBPartnerLeft' ><DIV class='vis-FirstDivBPartnerPopUp' > <\/DIV>" + kt("50%", "Phone Number", 5) + kt("50%", "Internet", 100) + "<DIV class='vis-SecondDivBPartnerPopUp'> <\/DIV>" + kt("100%", "Address", 5) + "<DIV class='vis-ThirdDivBPartnerPopUp'> <\/DIV> <\/DIV><DIV class='vis-FourthDivBPartnerPopUp'> <\/DIV> <\/DIV>"), v; a.find(".vis-FirstDivBPartnerPopUp").append("<DIV class='vis-FirstDivCotrol' ><\/DIV>"); a.find(".vis-FirstDivBPartnerPopUp").append("<DIV class='vis-DivBPartnerRight' > <\/DIV>"); a.find(".vis-SecondDivBPartnerPopUp").append("<DIV class='vis-SecondDivCotrol' ><\/DIV> "); a.find(".vis-SecondDivBPartnerPopUp").append("<DIV class='vis-SecondDivImgCotrol'><\/DIV> "); a.find(".vis-ThirdDivBPartnerPopUp").append("<DIV class='vis-ThirdDivCotrol' ><\/DIV>"); a.find(".vis-FourthDivBPartnerPopUp").append("<DIV class='vis-FourthDivHeader' > " + n.Msg.getMsg("BPType") + " <\/DIV> <DIV class='vis-FourthDivControl'><\/DIV>"); a.find(".vis-DivBPartnerRight").append("<div class='image-upload' style='float: right; position: absolute; z-index: 999; top:40px;overflow:hidden;right:20px'><label for='file-input' class='vis-file-label-bp'><span style='margin-right:8px' class='vis-change-picture-ico vis vis-pencil'><\/span><\/label><input type='file' id='VISFileDialog_" + i + "' accept='image/*' class='wsp-file-input' value='Add Pic' style='opacity: 0; width: 100%; margin-top: 0px; float: right; z-index: 999; position: absolute; right: 0px; cursor: pointer;'><\/div>"); a.find(".vis-DivBPartnerRight").append("<DIV class='vis-FirstDivImgCotrol'><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("SearchKeyValue") + "  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory'  id='txtSearchKey_" + i + "' style='height: 25px;width:100%' type='text'><\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Greeting") + "  <\/div> <div class='vis-all-control'><select id='ddlGreeting_" + i + "' style='width: 100%'>" + c + "<\/select><\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("ContactName") + "  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory' id='txtContact_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("CompanyName") + "  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory' id='txtName_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("BusinessPartnerGroup") + "  <\/div> <div class='vis-all-control'><select class='vis-gc-vpanel-table-mandatory' id='ddlBPGroup_" + i + "' style='width: 100%;float:left'>" + l + "<\/select> <\/div><\/DIV>"); a.find(".vis-FirstDivImgCotrol").append("<DIV class='vis-FirstDivCotrolChild' >  <div style='float: left;width:100%;height:242px;line-height:236px;background: none repeat scroll 0% 0% #EEE;padding:0px;text-align:center;margin-top:20px' ><img id='imgBPartner_" + i + "' /><\/div> "); a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Phone") + "  <\/div> <div class='vis-all-control'><input id='txtPhone_" + i + "' style='height: 25px;width:100%' type='text'><\/div><\/DIV>"); a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Mobile") + "  <\/div> <div class='vis-all-control'><input id='txtMobile_" + i + "' style='height: 25px;width:100%' type='text'><\/div><\/DIV>"); a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Fax") + "  <\/div> <div class='vis-all-control'><input id='txtFax_" + i + "' style='height: 25px;width:100%;' type='text'> <\/div><\/DIV>"); a.find(".vis-SecondDivImgCotrol").append("<DIV class='vis-SecondDivCotrolChild' > <div class='vis-all-lable'>" + n.Msg.getMsg("EmailAddress") + "  <\/div> <div class='vis-all-control'><input id='txtEmail_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-SecondDivImgCotrol").append("<DIV class='vis-SecondDivCotrolChild' > <div class='vis-all-lable'>" + n.Msg.getMsg("WebUrl") + "  <\/div> <div class='vis-all-control'><input id='txtWebUrl_" + i + "' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>"); a.find(".vis-ThirdDivCotrol").append("<DIV class='vis-ThirdDivCotrolChild'> <div class='vis-all-lable'>" + n.Msg.getMsg("Address") + "  <\/div> <div id='divAddress_" + i + "' class='vis-all-control'><\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkCustomer_" + i + "' type='checkbox'> " + n.Msg.getMsg("Customer") + "<\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkVendor_" + i + "' type='checkbox'>  " + n.Msg.getMsg("Vendor") + " <\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkProspect_" + i + "' type='checkbox'> " + n.Msg.getMsg("Prospect") + "<\/div><\/DIV>"); a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkEmployee_" + i + "' type='checkbox'> " + n.Msg.getMsg("Employee") + "<\/div><\/DIV>"); v = a.find("#divAddress_" + i); e = a.find("#ddlBPRelation_" + i); o = a.find("#ddlBPLoaction_" + i); s = a.find("#ddlBPGroup_" + i); p = a.find("#txtName_" + i); w = a.find("#txtSearchKey_" + i); d = a.find("#ddlGreeting1_" + i); st = a.find("#txtName2_" + i); b = a.find("#txtContact_" + i); k = a.find("#ddlGreeting_" + i); g = a.find("#txtTitle_" + i); tt = a.find("#txtEmail_" + i); nt = a.find("#txtPhone_" + i); ht = a.find("#txtPhone2_" + i); it = a.find("#txtFax_" + i); ft = a.find("#chkCustomer_" + i); et = a.find("#chkVendor_" + i); vt = a.find("#chkProspect_" + i); ot = a.find("#chkEmployee_" + i); r.setValue(h.location); yt = a.find("#VISFileDialog_" + i); pt = a.find("#imgBPartner_" + i); wt = a.find("#txtMobile_" + i); bt = a.find("#txtWebUrl_" + i); ui(); u > 0 ? (e.val(h.bpRelationID), s.val(h.bpGroupID), o.val(h.bpLocationID), p.val(n.Utility.decodeText(h.name)), w.val(n.Utility.decodeText(h.searchKey)), d.val(), st.val(n.Utility.decodeText(h.name2)), pt.removeAttr("src").attr("src", h.userImage), b.val(n.Utility.decodeText(h.contact)), k.val(), g.val(n.Utility.decodeText(h.title)), tt.val(n.Utility.decodeText(h.email)), nt.val(n.Utility.decodeText(h.phoneNo)), ht.val(n.Utility.decodeText(h.phoneNo2)), it.val(n.Utility.decodeText(h.fax)), k.val(h.greeting), d.val(h.greeting1), r.setValue(h.location), wt.val(h.mobile), bt.val(h.WebUrl), h.isCustomer && ft.attr("checked", "checked"), h.isVendor && et.attr("checked", "checked"), h.isEmployee && ot.attr("checked", "checked"), dt(n.Utility.Util.getValueOfInt(e.val()), i, h.bpLocationID)) : lt > 0 && at > 0 && (a.find("#ddlBPRelation_" + i).val(lt), a.find("#ddlBPGroup_" + i).val(at), dt(n.Utility.Util.getValueOfInt(e.val()), i, h.bpLocationID)); r.getBtn(0).css("width", "10%"); r.getBtn(0).css("height", "30px"); r.getBtn(0).css("padding", "0px"); r.getBtn(1).css("width", "10%"); r.getBtn(1).css("height", "30px"); r.getBtn(1).css("padding", "0px"); v.append(r.getControl().css("width", "80%")).append(r.getBtn(0)).append(r.getBtn(1)); rt = a.find("#divAddress_" + i).find("Input"); ct = a.find("#divAddress_" + i).find("Button").eq(1); oi(i, f, u); e.on("change", function () { dt(n.Utility.Util.getValueOfInt(e.val()), i) }); w.on("focusout", function () { w.val() == "" ? t("#divSearchKey").css("visibility", "visible") : t("#divSearchKey").css("visibility", "collapse ") }); p.on("focusout", function () { p.val() == "" ? t("#divName").css("visibility", "visible") : t("#divName").css("visibility", "collapse") }); s.on("focusout", function () { s.val() == "0" || s.val() == "" ? t("#divBPGroup").css("visibility", "visible") : t("#divBPGroup").css("visibility", "collapse ") }); rt.on("focusout", function () { r.getValue() <= 0 ? t("#divAddressValidate_" + i).css("visibility", "visible") : t("#divAddressValidate_" + i).css("visibility", "collapse ") }); ct.on("focusout", function () { r.getValue() <= 0 ? t("#divAddressValidate_" + i).css("visibility", "visible") : t("#divAddressValidate_" + i).css("visibility", "collapse ") }); b.on("focusout", function () { b.val() == "" ? t("#divContact_" + i).css("visibility", "visible") : t("#divContact_" + i).css("visibility", "collapse") }); return a } function kt(n, t, i) { return "<DIV class='vis-BPsplitter' style='width:" + n + "'><span style='background-color: white; position: relative;top: -0.8em;margin-left: " + i + "px;'> " + t + " <\/span><\/DIV>" } function ui() { yt.on("change", function () { ni = Date.now().toString(); var t = new XMLHttpRequest, i = new FormData; i.append("file", yt[0].files[0]); i.append("fileKey", ni); t.open("POST", n.Application.contextUrl + "BPartner/SaveImageAsByte", !0); t.setRequestHeader("Cache-Control", "no-cache"); t.setRequestHeader("Pragma", "no-cache"); t.send(i); t.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i), t = JSON.parse(r); pt.removeAttr("src").attr("src", "data:image/jpg;base64," + t[0]); gt = t[1] }, !1) }) } function fi() { w.off("focusout"); p.off("focusout"); s.off("focusout"); rt.off("focusout"); ct.off("focusout"); b.off("focusout"); r.dispose(); r = null; p = null; st = null; rt = null; b = null; tt = null; it = null; k = null; d = null; nt = null; ht = null; w = null; g = null; c = null; f.remove(); f.empty() } function ei(i) { u = new n.ChildDialog; u.setContent(i); u.onClose = function () { fi() }; var r = t(window).width(); r >= 1366 ? (u.setHeight(620), u.setWidth(870)) : (u.setHeight(520), u.setWidth(670)); u.setTitle(n.Msg.getMsg("BusinessPartner")); u.setEnableResize(!1); u.setModal(!0); u.show(); u.getRoot().dialog({ position: [200, 130] }) } function oi(i, f, h) { u.onOkClick = function () { var l, a, u; if (y != null ? (y.show(), l = t(window).height() * (50 / 100), a = t(window).width() * (50 / 100)) : t(".vis-apanel-busy").css("visibility", "visible"), ut = r.getValue(), w.val().trim() == "") return n.ADialog.info("SearchKeyMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (p.val().trim() == "") return n.ADialog.info("NameMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (s.val().trim() == "0") return n.ADialog.info("BPGroupMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (b.val().trim() == "") return n.ADialog.info("ContactMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (ut <= 0 || ut == null) return n.ADialog.info("AddressMandatory"), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; if (ft.is(":checked") == !1 && et.is(":checked") == !1 && vt.is(":checked") == !1 && ot.is(":checked") == !1) return alert(n.Msg.getMsg("PleaseSelectBusinessType")), y != null && y.hide(), t(".vis-apanel-busy").css("visibility", "hidden"), !1; u = null; u = f; url = n.Application.contextUrl + "BPartner/AddBPartnerInfo"; var v = w.val(), rt = p.val(), st = p.val(), c = k.val(), ht = s.val(), ct = e.val(), lt = o.val(), at = b.val(), oi = d.val(), yt = g.val(), pt = tt.val(), kt = nt.val(), dt = nt.val(), ni = it.val(), ti = ft.is(":checked"), ii = et.is(":checked"), ri = vt.is(":checked"), ui = ot.is(":checked"), fi = wt.val(), ei = bt.val(); window.setTimeout(function () { t.ajax({ type: "Post", async: !1, url: url, dataType: "json", data: { C_BPartner_ID: h, searchKey: v, name: rt, name2: st, greeting: c, bpGroup: ht, bpRelation: ct, bpLocation: lt, contact: at, greeting1: c, title: yt, email: pt, address: ut, phoneNo: kt, phoneNo2: dt, fax: ni, windowNo: i, BPtype: u, isCustomer: ti, isVendor: ii, isProspect: ri, fileName: gt, mobile: fi, webUrl: ei, isEmployee: ui }, success: function (i) { n.ADialog.info("", "", JSON.parse(i)); y != null && y.hide(); t(".vis-apanel-busy").css("visibility", "hidden") } }) }, 2) } } function dt(i, r, u) { var f = null, e = ""; url = n.Application.contextUrl + "BPartner/GetBPLocation?WinNo=" + r + "&bpartnerID=" + i; t.ajax({ type: "GET", async: !1, url: url, dataType: "json", success: function (t) { f = JSON.parse(t); for (var i = 0; i < f.lstBPLocation.length; i++)e += "<option value='" + f.lstBPLocation[i].ID + "'>" + n.Utility.encodeText(f.lstBPLocation[i].Name) + "<\/option>"; o.empty(); o.append(e); o.val(u) } }) } var p = null, w = null, k = null, st = null, b = null, d = null, g = null, tt = null, nt = null, ht = null, it = null, g = null, rt = null, ct = null, y = null, lt = 0, at = 0, ut = null, ft = null, et = null, vt = null, ot = null, yt = null, gt = null, ni = "", pt = null, wt = null, bt = null; l == null && (t(".vis-apanel-busy").css("visibility", "visible"), t(".vis-apanel-busy").css("z-index", "9999999")); y = l; f != null && f.empty(); lt = a; at = v; ti(i, h, c) } }(VIS, jQuery), function (n, t) { function y() { r = null; f = null; s = null; $mainUserInfo = null; a = 800; c = 1048576; l = 10; r = t(" <div id='mainUserInfoDiv_" + i + "'><div class='vis-view_left_part'><input type='hidden' value='0' id='userID_" + i + "'><\/input> <p id='hduserName_" + i + "' style='display: none;'><\/p>  <p id='userName_" + i + "' class='vis-view_profile_name'><\/p> <a id='dotImg_" + i + "' href='javascript:void(0)' style='display: none;'><\/a><div id='popUpDiv_" + i + "' style='display: none;'><\/div><input type='hidden' value='0' id='BPID_" + i + "'><\/input><input type='hidden' value='0' id='BPGroupID_" + i + "'><\/input><input type='hidden' value='' id='userTableID_" + i + "'><p id='companyName_" + i + "' class='vis-view_profile_possession'><\/p><p class='vis-view_profile_possession' style='border-bottom: 1px solid rgba(var(--v-c-secondary), 1); padding-bottom: 10px;' id='pContactTypeCategory_" + i + "'><\/p><div class='vis-profile_big_img_mobile'><span id='editMobileImage_" + i + "' class='mobilespan' style='width:24px;float:right;'><input type='file' id='vis-fileinput_" + i + "' class='vis-file-input' value='Add Pic' style='opacity: 0; width: 7%; margin-top: -6px; float: left; z-index: 999; position: absolute; cursor: pointer;'><img src='" + n.Application.contextUrl + "Areas/WSP/Images/Edit-icon.png' style='z-index: 100; position: absolute;'><\/span><img id='mobileImg_" + i + "' width='100%' alt='Image is not available' src='Areas/VIS/Images/home/User.png'><\/div><div id='divTeam_" + i + "' class='vis-view_team'><\/div><div id='divContactDetails_" + i + "' class='vis-view_team'><\/div><div id='divcompanyDetails_" + i + "' class='vis-view_team'><\/div><div id='divRole_" + i + "' class='vis-view_team'><\/div><\/div><div class='vis-view_right_part'  style='float:left;width: 55%;' id='WSP_view_right_part_" + i + "'><div id='userBigImg_" + i + "' class='vis-profile_big_img' style='width: 322px;'><div class='vis-image-upload'> <label for='file-input' class='vis-fileupload-label'><i class='vis vis-pencil'><\/i><\/label><input type='file' id='vis-file-input_" + i + "' class='vis-file-input' value='Add Pic' style='opacity: 0; width: 30%; margin-top: 0px; float: right; z-index: 999; position: absolute; right: 0px; cursor: pointer;'><\/div><div class='vis-bigimg'> <i id='bigUserImage_" + i + "' class='vis vis-user'><\/i><\/div><\/div><div class='vis-actionswrp'><table id='actionTable_" + i + "' class='vis-tableRightContent'><tbody><tr style='height:30px'> <td class='vis-tdactionlist'><a id='edit_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'> <i class='vis vis-edit'><\/i><\/span> <p>Edit <\/p> <\/a> <\/td> <td class='vis-tdactionlist'> <a id='sendSMS_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'> <i class='vis vis-sms'><\/i><\/span> <p> Send Sms <\/p> <\/a> <\/td> <\/tr>  <tr style='height:30px'>       <td class='vis-tdactionlist'><a id='email_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon email_icon'>           <i class='vis vis-email'><\/i><\/span>           <p>Email <\/p>       <\/a>       <\/td>       <td class='vis-tdactionlist'><a id='appointment_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'>           <i class='vis vis-appointment'><\/i><\/span>           <p>Appointment <\/p>       <\/a>       <\/td>   <\/tr>   <tr style='height:30px'>       <td class='vis-tdactionlist'><a id='activity_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'>            <i class='vis vis-cog'><\/i><\/span>           <p>Activity<\/p>       <\/a>       <\/td>        <td class='vis-tdactionlist'><a id='createOrder_" + i + "' href='javascript:void(0)' class='vis-tableaction'><span class='vis-left_icon'>           <i class='vis vis-createdocument'><\/i><\/span>           <p>Create Order<\/p>       <\/a>        <\/td>    <\/tr>   <tr style='height:30px'>       <td class='vis-tdactionlist'><a id='BPInfo_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'>           <i class='vis vis-info'><\/i><\/span>           <p>BP Info<\/p>       <\/a>        <\/td>        <td class='vis-tdactionlist'><a id='addBPartner_" + i + "' href='javascript:void(0)' class='vis-tableaction'><span class='vis-left_icon'>           <i class='vis vis-addbp'><\/i><\/span>           <p style=''>Add BPartner <\/p>       <\/a>       <\/td>   <\/tr> <tr style='height:30px'><td class='vis-tdactionlist'><a id='History_" + i + "' class='vis-tableaction' href='javascript:void(0)'><span class='vis-left_icon'><i class='vis vis-history'><\/i><\/span><p>" + n.Msg.getMsg("History") + "<\/p><\/a><\/td><\/tr>   <tr>   <\/tr><\/tbody><\/table><\/div><div id='divBirthday_" + i + "' class='vis-birthday_container' style='display: none;'><\/div><\/div><\/div>") } var i = 0, o = t(document).width(), v = t(document).height(), r = null, h = 0, e = null, f = null, s = null, a = null, c = null, l = null, u = null, o = t(document).width(), v = t(document).height(); n.ContactInfo = function (v, p) { for (var w = n.DB.executeReader("SELECT COUNT(*) FROM AD_Table WHERE TableName='C_BPartner'", null); w.read();)if (parseInt(w.getString(0)) == 0) { n.ADialog.error("VIS_NotSupported"); self.dispose(); return } h = v; i = p; t(".vis-apanel-busy").css("visibility", "visible"); e = n.Application.contextUrl + "WSP/Contacts/UserContactInfo?WinNo=" + i + "&userID=" + h + "&isPartialViewLoad=true"; y(h, e); this.show = function () { if (!window.WSP) { alert("please download WSP !!!"); t(".vis-apanel-busy").css("visibility", "hidden"); return } window.setTimeout(function () { u = new n.ChildDialog; u.setContent(r); u.setWidth(610); u.setTitle(n.Msg.getMsg("ContactInfo")); u.setEnableResize(!1); u.setModal(!0); u.show(); u.getRoot().dialog({ position: [400, 0] }); u.onClose = function () { dispose() }; t.ajax({ type: "GET", async: !1, url: e, dataType: "json", success: function (h) { function ri(i, r, f) { f.stopPropagation(); t.ajax({ type: "GET", async: !1, url: i, dataType: "json", success: function (t) { var i = JSON.parse(t), f = new n.Query; r ? (f.addRestriction("C_BPartner_ID", n.Query.prototype.EQUAL, i[1]), n.viewManager.startWindow(i[0], f), k.find("p").removeAttr("style"), u.close()) : (f.addRestriction("C_Order_ID", n.Query.prototype.EQUAL, i[1]), win = n.viewManager.startWindow(i[0], f), win.onLoad = function () { var n = win.cPanel.curGC; n.onRowInserting = function () { win.cPanel.cmd_new(!1) }; n.onRowInserted = function () { tab = win.cPanel.curTab; tab.setValue("C_BPartner_ID", et.text()) } }, st.find("p").removeAttr("style"), u.close()) } }) } var v = JSON.parse(h), p = "", y, wt, nt, d; v[0].Customer != "" && (p += v[0].Customer); v[0].Vendor != "" && (v[0].Customer != "" && (p += ","), p += v[0].Vendor); v[0].Employee != "" && ((v[0].Customer != "" || v[0].Vendor != "") && (p += ","), p += v[0].Employee); v[0].Prospect != "" && ((v[0].Customer != "" || v[0].Vendor != "" || v[0].Employee != "") && (p += ","), p += v[0].Prospect); var ht = r.find("#divRole_" + i), ct = r.find("#divTeam_" + i), b = r.find("#divContactDetails_" + i), it = r.find("#dotImg_" + i), w = r.find("#userID_" + i), lt = r.find("#userTableID_" + i), rt = r.find("#hduserName_" + i), ft = r.find("#userName_" + i), et = r.find("#BPID_" + i), bt = r.find("#BPGroupID_" + i), ui = r.find("#companyName_" + i), fi = r.find("#pContactTypeCategory_" + i), ai = r.find("#mobileImg_" + i), ur = r.find("#team_" + i), fr = r.find("#teamNotFound_" + i), vi = r.find("#address_" + i), yi = r.find("#country_" + i), pi = r.find("#postal_" + i), wi = r.find("#phone_" + i), bi = r.find("#userEmail_" + i), er = r.find("#emailNotFound_" + i), kt = r.find("#divcompanyDetails_" + i), ei = r.find("#companyNotFound" + i), or = r.find("#role_" + i), ki = r.find("#roleNotFound_" + i), at = r.find("#bigUserImage_" + i), ot = r.find("#divBirthday_" + i), sr = r.find("#userBigImg_" + i), k = r.find("#edit_" + i); s = r.find("#WSP_dots_" + i); var dt = r.find("#sendSMS_" + i), gt = r.find("#email_" + i), g = r.find("#BPInfo_" + i), st = r.find("#createOrder_" + i), vt = r.find("#addBPartner_" + i), di = r.find("#History_" + i), yt = r.find("#appointment_" + i), pt = r.find("#activity_" + i), gi = r.find("#ImportContacts_" + i), tt = r.find("#wsp-file-input_" + i), oi = r.find("#wsp-fileinput_" + i), hr = r.find(".WSP_profile_big_img"), nr = r.find(".WSP_profile_big_img_mobile"), si = null, tr = r.find("#mainUserInfoDiv_" + i), ni = !1, ut = !1, ti = !1, v = JSON.parse(h), hi = "", ii = ""; for (w.empty(), w.append(v[0].UserID), rt.empty(), rt.append(v[0].FirstName), rt.hide(), ft.empty(), it.empty(), p == "" || p == null ? (k.removeAttr("href"), k.css("cursor", "auto"), k.find("p").css("color", "black"), g.removeAttr("href"), g.css("cursor", "auto"), g.find("p").css("color", "black")) : (k.attr("href", "javascript:void(0)"), k.css("cursor", "pointer"), k.removeAttr("style"), g.attr("href", "javascript:void(0)"), g.css("cursor", "pointer"), g.removeAttr("style")), o >= 1e3 && o <= 1024 ? v[0].FirstName.length > 15 ? (it.show(), ft.append(v[0].FirstName.substring(0, 15)).append(it.append("..."))) : ft.append(v[0].FirstName) : v[0].FirstName.length > 20 ? (it.show(), ft.append(v[0].FirstName.substring(0, 20)).append(it.append("..."))) : ft.append(v[0].FirstName), et.empty(), et.append(v[0].BPartnerID), lt.append(v[0].TableID), bt.empty(), bt.append(v[0].BPGroupID), ui.empty(), ui.append(v[0].CompanyName), fi.empty(), fi.append(p), ai.removeAttr("src").attr("src", v[0].Image), ct.empty(), ct.append("<p>" + n.Msg.getMsg("Teams") + "<\/p>"), y = 0; y < v.length; y++)v[y].Team != "" && v[y].Team != null && (ni = !0, ii += y == 0 || ii == "" ? v[y].Team : ", " + v[y].Team); for (ni || ct.append(" <p  id='teamNotFound_" + i + "' style='word-break: break-all; font-style: italic;'>" + n.Msg.getMsg("NotFound") + "<\/p>"), ni && ct.append(" <p id='team_" + i + "' >" + ii + "<\/p>"), vi.empty(), b.empty(), b.append("<p style='word-break: break-all;'> " + n.Msg.getMsg("ContactDetails") + " <a href='javascript:void(0)'> <i id='showAddressOnGoogleMap_" + i + "' class='vis vis-location'><\/i> <\/a><\/p> "), y = 0; y < v.length; y++)v[y].FirstName == "" && v[y].Address != "" && v[y].Address != null && (ut = !0, b.append("<p id='address_" + i + "' style='word-break: break-all'>" + v[y].Address + "<\/p>")); for (yi.empty(), v[0].CountryName != "" && v[0].CountryName != null && (ut = !0, b.append("<p id='country_" + i + "' style='word-break: break-all'>" + v[0].City + "(" + v[0].CountryName + ")<\/p> ")), pi.empty(), v[0].Postal != "" && v[0].Postal != null && (ut = !0, b.append("<p id='postal_" + i + "' style='word-break: break-all'>" + n.Msg.getMsg("ZipCode") + ": " + v[0].Postal + "<\/p>")), wi.empty(), y = 0; y < v.length; y++)v[y].FirstName == "" && v[y].PhoneNo != "" && v[y].PhoneNo != null && (ut = !0, o <= 1024 ? b.append("<a href='tel:" + v[y].PhoneNo + "'><p id='phone_" + i + "' style='word-break: break-all'><span class='vis-caller'><i class='fa fa-phone'><\/i><\/span>" + v[y].PhoneNo + "<\/p><\/a>") : b.append("<p id='phone_" + i + "' style='word-break: break-all'><span class='vis-caller'><i class='fa fa-phone'><\/i><\/span>" + v[y].PhoneNo + "<\/p>")); for (bi.empty(), v[0].Email != "" && v[0].Email != null && (ut = !0, b.append("<p id='userEmail_" + i + "' style='word-break: break-all;display: inline-flex;margin-top: 0;'> <span class='vis-caller'><i class='vis vis-email'><\/i><\/span>" + v[0].Email + "<\/p>")), !ut, kt.empty(), kt.append("<p>" + n.Msg.getMsg("Company") + "<\/p>"), kt.append("<p id='companyDetails_" + i + "' style='word-break: break-all'>" + v[0].CompanyName + "<\/p>"), ei.empty(), v[0].CompanyName != "" && v[0].CompanyName != null && ei.append(n.Msg.getMsg("NotFound")), ht.empty(), ht.append("<p>" + n.Msg.getMsg("RoleAssign") + "<\/p>"), y = 0; y < v.length; y++)v[y].Role != "" && v[y].Role != null && (ti = !0, hi += y == 0 ? v[y].Role : ", " + v[y].Role); ti && ht.append("<p id='role_" + i + "'>" + hi + "<\/p>"); ki.empty(); ti || ht.append("<p id='roleNotFound_" + i + "' style='word-break: break-all; font-style: italic;'>" + n.Msg.getMsg("NotFound") + "<\/p>"); v[0].Image.indexOf("User") > 0 ? at.removeAttr("src").attr("src", n.Application.contextUrl + "Areas/VIS/Images/home/User.png") : at.removeAttr("src").attr("src", v[0].Image); ot.empty(); var ci = new Date, li = new Date(v[0].Birthday), ir = ci.getMonth() + 1 + "/" + ci.getDate(), rr = li.getMonth() + 1 + "/" + li.getDate(); v[0].Birthday != "" ? (ot.show(), ot.css("border", "1px solid #1886BF"), wt = t("<div class='vis-birthdat_text'>"), rr == ir && wt.append("<p> " + n.Msg.getMsg("Today") + " " + n.Msg.getMsg("is") + " <span class='vis-birthday_text_highlight'>" + v[0].FirstName + "<\/span> " + n.Msg.getMsg("Birthday") + "<\/p>"), wt.append("<p>" + v[0].FirstName + " " + n.Msg.getMsg("Birthday") + " " + n.Msg.getMsg("on") + "  <span class='vis-birthday_text_highlight'>" + v[0].Birthday + "<\/span><\/p> <\/div>"), ot.append(wt)) : ot.hide(); it.on("click", function (n) { $popUp.show(); var t = r.find("<div class='arrow_box'> <p style='margin-left:5px;margin-top:5px;margin-right:5px'>" + rt.text() + "<\/p><\/div>"); $popUp.append(t); $popUp.delay(2e3).fadeOut(); n.stopPropagation() }); if (s != null) s.on("click", function (n) { tr.animate({ right: "-1000px" }, a); n.stopPropagation() }); t(".ui-dialog-content").on("click", function (n) { t("#w2ui-overlay").hide(); n.stopPropagation() }); nt = t("<ul id='ulEditOption' class='vis-apanel-rb-ul'>"); d = t("<ul id='ulCreateOrder' class='vis-apanel-rb-ul'>"); k.on("click", function (r) { var u, h, e; if (p == "" || p == null) return r.preventDefault(), !1; k.find("p").css("background-color", "#e0e0e0"); r.stopPropagation(); var o = w.text(), s = p.split(","); if (s.length > 1) { for (t("#w2ui-overlay").show(), nt != null && nt.empty(), u = t("<div/>"), u.css("width", "auto"), u.css("height", "100%"), nt.css("width", "auto"), nt.css("height", "100%"), h = "", e = 0; e < s.length; e++)h += "<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' id='" + s[e].trim() + "_" + i + "'>" + n.Msg.getMsg(s[e].trim()) + "<\/li>"; nt.append(h); u.append(nt); k.w2overlay(u.clone(!0), { css: { height: "300px" } }); u.css("top", "395px"); nt.load() } else p == n.Msg.getMsg("Employee") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Employee Master&userID=" + o), p == n.Msg.getMsg("Customer") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Customer Master&userID=" + o), p == n.Msg.getMsg("Vendor") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Vendor Master&userID=" + o), p == n.Msg.getMsg("Prospect") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Prospects&userID=" + o), ri(f, !0, r) }); nt.on("click", "LI", function (i) { t("#w2ui-overlay").hide(); var r = t(this).text(); r == n.Msg.getMsg("Employee") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Employee Master&userID=" + w.text()); r == n.Msg.getMsg("Customer") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Customer Master&userID=" + w.text()); r == n.Msg.getMsg("Vendor") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Vendor Master&userID=" + w.text()); r == n.Msg.getMsg("Prospect") && (f = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Prospects&userID=" + w.text()); ri(f, !0, i); i.stopPropagation() }); dt.on("click", function (i) { dt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); i.stopPropagation(); window.setTimeout(function () { var r = new n.Sms(null, null, 0, !0), i = new n.CFrame; i.setName(n.Msg.getMsg("Sms")); i.setTitle(n.Msg.getMsg("Sms")); i.hideHeader(!0); i.setContent(r); i.show(); r.initializeComponent(); t(".vis-apanel-busy").css("visibility", "hidden"); u.close() }, 2) }); gt.on("click", function (r) { gt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); r.stopPropagation(); window.setTimeout(function () { var f = new n.Email(t("#userEmail_" + i).text(), null, null, w.text(), !0, !0, lt.text()), r = new n.CFrame; r.setName(n.Msg.getMsg("EMail")); r.setTitle(n.Msg.getMsg("EMail")); r.hideHeader(!0); r.setContent(f); r.show(); f.initializeComponent(); t(".vis-apanel-busy").css("visibility", "hidden"); u.close() }, 2) }); g.on("click", function (i) { if (p == "" || p == null) return i.preventDefault(), !1; g.find("p").css("background-color", "#e0e0e0"); window.setTimeout(function () { var r = w.text(), i = ""; i = n.Application.contextUrl + "WSP/Contacts/GetWindowID?windowName=Business Partner Info&userID=" + r; t.ajax({ type: "GET", async: !1, url: i, dataType: "json", success: function (t) { var i = JSON.parse(t), r = new n.Query; r.addRestriction("C_BPartner_ID", n.Query.prototype.EQUAL, i[1]); n.viewManager.startWindow(i[0], r); g.find("p").removeAttr("style"); u.close() } }) }, 500) }); st.on("click", function (r) { var u, f; st.find("p").css("background-color", "#e0e0e0"); t("#w2ui-overlay").show(); t("#w2ui-overlay").find("div").empty(); d != null && d.empty(); u = t("<div/>"); u.css("width", "auto"); u.css("height", "100%"); d.css("width", "auto"); d.css("height", "100%"); f = t("<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' id='SaleOrder_" + i + "'>" + n.Msg.getMsg("Sales Order") + "<\/li> <li  style='margin-top:10px;margin-left:10px;margin-right:13px;font-size: 15px' id='PurchaseOrder_" + i + "' >" + n.Msg.getMsg("PurchaseOrder") + "<\/li>"); d.append(f); u.append(d); st.w2overlay(u.clone(!0), { css: { height: "300px" } }); u.css("top", "395px"); r.stopPropagation(); d.load() }); d.on("click", "LI", function (i) { t("#w2ui-overlay").hide(); var r = t(this).text(); e = n.Application.contextUrl + "WSP/Contacts/GetWindowAndOrderID?windowName=" + r + "&userID=" + w.text(); ri(e, !1, i); i.stopPropagation() }); vt.on("click", function (t) { vt.find("p").css("background-color", "#e0e0e0"); t.stopPropagation(); $saleOrder = null; $purchaseOrder = null; n.AddUpdateBPartner(i, 0, p, null, et.text(), bt.text()); vt.find("p").removeAttr("style") }); di.on("click", function () { var t = new n.AttachmentHistory(lt.val(), w.text(), et.text(), 0, "AD_User_ID"); t.show() }); yt.on("click", function (r) { r.stopPropagation(); yt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); window.setTimeout(function () { n.AppointmentsForm.init(lt.text(), t("#userID_" + i).text(), n.context.getAD_User_ID(), rt.text(), !1); yt.find("p").removeAttr("style"); t(".vis-apanel-busy").css("visibility", "hidden"); u.close() }, 500) }); gi.on("click", function (n) { n.stopPropagation(); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); window.setTimeout(function () { WSP.importcontacts(self); t(".vis-apanel-busy").css("visibility", "hidden") }, 50) }); pt.on("click", function (r) { r.stopPropagation(); pt.find("p").css("background-color", "#e0e0e0"); t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); window.setTimeout(function () { n.AppointmentsForm.init(0, t("#userID_" + i).text(), n.context.getAD_User_ID(), rt.text(), !0); pt.find("p").removeAttr("style"); t(".vis-apanel-busy").css("visibility", "hidden") }, 500) }); tt.on("change", function () { t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); var f = w.text(), i = new XMLHttpRequest, r = new FormData, u = tt; if (r.append("file", u[0].files[0]), r.append("userID", f), u[0].files[0].size / c > l) { alert(n.Msg.getMsg("UploadedFileSizeLimit")); tt.replaceWith(tt.val("").clone(!0)); return } i.open("POST", n.Application.contextUrl + "WSP/Contacts/SaveImageAsByte", !0); i.setRequestHeader("Cache-Control", "no-cache"); i.setRequestHeader("Pragma", "no-cache"); i.send(r); i.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i); image = JSON.parse(r); at.removeAttr("src").attr("src", "data:image/jpg;base64," + image[1]); t(".vis-apanel-busy").css("visibility", "hidden") }, !1); tt.val("") }); oi.on("change", function () { t(".vis-apanel-busy").css("visibility", "visible"); t(".vis-apanel-busy").css("z-index", "999999999999"); var f = w.text(), i = new XMLHttpRequest, r = new FormData, u = tt; if (r.append("file", u[0].files[0]), r.append("userID", f), u[0].files[0].size / c > l) { alert(n.Msg.getMsg("UploadedFileSizeLimit")); return } i.open("POST", n.Application.contextUrl + "WSP/Contacts/SaveImageAsByte", !0); i.setRequestHeader("Cache-Control", "no-cache"); i.setRequestHeader("Pragma", "no-cache"); i.send(r); i.addEventListener("load", function (n) { var i = n.target.response, r = JSON.parse(i); image = JSON.parse(r); at.removeAttr("src").attr("src", "data:image/jpg;base64," + image[1]); nr.removeAttr("src").attr("src", "data:image/jpg;base64," + image[1]); t(".vis-apanel-busy").css("visibility", "hidden") }, !1) }); si = b.find("#showAddressOnGoogleMap_" + i); si.on("click", function () { var n = b.find("#address_" + i).text() + b.find("#country_" + i).text(), t = "http://local.google.com/maps?q=" + n; window.open(t) }); t(".vis-apanel-busy").css("visibility", "hidden") } }) }, 2) } } }(VIS, jQuery), function (n, t) { function i() { function b() { h = t('<div style="width:100%;height:100%">'); u = t("<ul class='vis-apanel-rb-ul' style='width:100%;height:100%'>"); e = t("<li data-isfav='no' data-id='favaction'>").append(n.Msg.getMsg("AddFav")); o = t("<li data-isfav='yes' data-id='favaction'>").append(n.Msg.getMsg("RemoveFav")); l = t("<li data-isfav='" + i.data("isfav") + "' data-id='favaction'>").append(n.Msg.getMsg("OpenNewTab")); u.append(e); u.append(o); u.append(l); h.append(u); d() } function k(n) { i = n; f = i.data("value"); a = i.data("action"); s = i.data("actionid"); y = i.data("name"); v = i.attr("data-isfav"); p || (b(), p = !0); v == "yes" ? (e.css("display", "none"), o.css("display", "block")) : (e.css("display", "block"), o.css("display", "none")); i.w2overlay(h.clone(!0), { css: { height: "300px" } }) } function d() { e.on("click", w); o.on("click", w); l.on("click", g) } function w() { var u; v == "yes" ? (i.find("span").remove(), u = t("#vis_divTree").find('[data-value="' + i.data("value") + '"]'), u && u.length > 0 && (t(u[1]).find("span.fa.fa-star").length > 0 && (t(u[1]).attr("data-isfav", "no"), t(u[1]).find("span.fa.fa-star").remove()), n.Application.isMobile || n.Application.isIOS ? t(u[5]) && (t(u[5]).attr("data-isfav", "no"), t(u[5]).find("span.fa.fa-star").remove()) : t(u[3]) && (t(u[3]).attr("data-isfav", "no"), t(u[3]).find("span.fa.fa-star").remove())), i.attr("data-isfav", "no"), tt(f), n.favMgr.removeFavourite(f)) : (r = {}, r.Action = a, r.WindowID = s, r.FormID = s, r.ProcessID = s, r.NodeID = f, r.Name = y, i.attr("data-isfav", "yes"), i.prepend('<span class="fa fa-star"><\/span>'), u = t("#vis_divTree").find('[data-value="' + i.data("value") + '"]'), u && u.length > 2 && (t(u[1]).find("span.fa.fa-star").length == 0 ? (t(u[1]).prepend('<span class="fa fa-star"><\/span>'), t(u[1]).attr("data-isfav", "yes")) : n.Application.isMobile || n.Application.isIOS ? (t(u[5]).prepend('<span class="fa fa-star"><\/span>'), t(u[5]).attr("data-isfav", "yes")) : (t(u[3]).prepend('<span class="fa fa-star"><\/span>'), t(u[3]).attr("data-isfav", "yes"))), nt(f), n.favMgr.addFavourite(r)) } function g() { n.viewManager.startActionInNewTab(a, s) } function nt(i) { t.ajax({ url: n.Application.contextUrl + "Home/SetNodeFavourite/?nodeID=" + i, dataType: "json" }) } function tt(i) { t.ajax({ url: n.Application.contextUrl + "Home/RemoveNodeFavourite/?nodeID=" + i, dataType: "json" }) } function it(n) { c || (c = t("#vis_divTree")); var r = c.children(0).find("[data-value='" + n + "']"), i = t(r.children()[1]); i.removeClass("vis-favitmchecked"); i.addClass("vis-favitmunchecked"); i.data("isfav", "no") } var h = null, u = null, f = null, i = null, r = null, c = null, e = null, o = null, l = null, a, s, y, v, p = !1; return { removeFavourite: it, showOverlay: k } } n.FavouriteHelper = i() }(VIS, jQuery), function (n, t) { function i(i, r, u, f, e, o, s, h, c, l) { function df() { d = o; d ? s != null && s != undefined && (vi = s) : (vi = r.gridTable.AD_Table_ID, v = u.getSelectedRows(), w = r.getRecords()[r.getCurrentRow()]); ot = t('<ul class="vis-email-ul" ><\/ul>'); ut = t("<div>"); ut.css("position", "absolute"); ut.css("bottom", "0"); ut.css("background", "url('" + n.Application.contextUrl + "Areas/VIS/Images/LoadingCircle.gif') no-repeat"); ut.css("background-position", "center center"); ut.css("width", "98%"); ut.css("height", "98%"); ut.css("text-align", "center"); ut.css("opacity", ".1"); ut[0].style.visibility = "hidden" } function gf() { e ? (gt = t('<i class="vis-email-sendbtn vis vis-paper-plane"  title="' + n.Msg.getMsg("SendMail").replace("&", "") + '"><\/i>'), ui.append(gt)) : (gt = t('<i class="vis-email-saveAttachbtn vis vis-save-attach"  title="' + n.Msg.getMsg("SaveAttachment").replace("&", "") + '" ><\/i>'), ui.append(gt)); d || (pi = t('<i class="vis-email-btns vis vis-viewdocument"  title="' + n.Msg.getMsg("Preview").replace("&", "") + '" ><\/i>'), ui.append(pi), bi = t('<i class="vis-email-btns vis vis-save-as" title="' + n.Msg.getMsg("SaveAs").replace("&", "") + '" ><\/i>'), ui.append(bi), ct = t('<i class="vis-email-btns vis vis-save" title="' + n.Msg.getMsg("Save").replace("&", "") + '"><\/i>'), ui.append(ct), wi = t('<i class="vis-email-btns vis vis-open-file" title="' + n.Msg.getMsg("Open").replace("&", "") + '" ><\/i>'), ui.append(wi)); e || (ou = t('<i class="vis-email-btns vis vis-save-pdf" title="' + n.Msg.getMsg("SavePdf").replace("&", "") + '"><\/i>'), su = t('<i class="vis-email-btns vis vis-new" title="' + n.Msg.getMsg("NewLetter").replace("&", "") + '" ><\/i>'), ui.append(ou).append(su)) } function ne() { var i = { windowNo: p.windowNo, language: n.Env.getAD_Language(n.Env.getCtx()) }; t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Email/Init", data: i, success: function (n) { te(n) } }) } function te(n) { var r, u; a.append(t(n)); r = 0; ht = a.find("#" + p.windowNo + "_dyndis"); bt = a.find("#" + p.windowNo + "_dynPF"); ii = a.find("#" + p.windowNo + "_dynPFType"); a.find(".vis-email-attachmentContainer").hide(); g = a.find(".vis-email-leftDiv"); gi = a.find(".vis-Email-BccList"); nt = a.find("#" + p.windowNo + "_emailSubject"); cr = a.find(".vis-DMSAttachDocList"); rr = a.find(".vis-dmsdocumentheader"); window.VADMS || (cr.css("display", "none"), rr.css("display", "none")); c != undefined && c != null && nt.val(c); ar = a.find("#" + p.windowNo + "_vis-email-attacImg"); yi = a.find("#" + p.windowNo + "_vis-Email-textarea"); vr = a.find(".vis-Email-leftFooter"); a.find(".contentArea").css("height", a.height() - 44); a.find(".vis-Email-textarea-div").css({ "margin-top": "10px" }); u = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); u == !0 && a.find(".vis-Email-textarea-div").css({ overflow: "auto" }); a.find(".vis-email-leftDiv").height(a.find(".contentArea").height()); d ? (a.find(".vis-form-data-sub").css("margin-top", "0px"), a.find(".vis-email-leftDiv").hide(), a.find(".vis-Email-rytWrap").hide(), st = a.find("#" + p.windowNo + "_emailToTop"), k = a.find("#" + p.windowNo + "_emailBccTop"), rt = a.find("#" + p.windowNo + "_eamilCcTop"), ur != undefined && ur != null && ur != "" ? rt.val(ur) : rt.hide(), fr != undefined && fr != null && fr != "" ? k.val(fr) : k.hide(), a.find(".vis-Email-textarea-div").height(a.height() - 180), a.find(".vis-Email-leftWrap").css("width", "100%"), a.find(".vis-Email-leftFooter").hide(), r = a.width() - 40, ht.prop("checked", !1), a.find(".vis-Email-topinputWrap").css("overflow", "auto"), ht.hide(), bt.prop("checked", !1), bt.parent().hide(), ii.prop("checked", !1), ii.parent().hide(), i != undefined && i != null && st.val(i), a.find(".vis-form-data-sub").width(a.width() - 85)) : e ? (a.find(".vis-Email-topinputWrap").hide(), st = a.find("#" + p.windowNo + "_emailTo"), k = a.find("#" + p.windowNo + "_emailBcc"), rt = a.find("#" + p.windowNo + "_eamilCc"), a.find(".vis-Email-textarea-div").height(a.height() - 145), lr = a.find("#" + p.windowNo + "_emailRefresh"), r = a.width() - 90, a.find(".vis-Email-leftWrap").width(r - 350), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 60)) : (a.find(".vis-Email-rytWrap").hide(), a.find(".vis-Email-topinputWrap").hide(), ar.hide(), a.find(".vis-Email-textarea-div").height(a.height() - 142), a.find(".vis-Email-leftWrap").css("margin-right", "20px"), r = a.width() - 240, a.find(".vis-Email-leftWrap").width(r - 25), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 60)); window.VADMS ? a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 70) - 520) : a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 70) - 280); at = a.find(".vis-Email-ContentWrap"); at.css("width", r); y != null && y != undefined && (y.body.style.width = r - 370 + "px"); gu = !0 } function ie() { try { yi.kendoEditor({ tools: ["bold", "italic", "underline", "strikethrough", "justifyLeft", "justifyCenter", "justifyRight", "justifyFull", "insertUnorderedList", "insertOrderedList", "indent", "outdent", "createLink", "unlink", "insertImage", "insertFile", "subscript", "superscript", "createTable", "addRowAbove", "addRowBelow", "addColumnLeft", "addColumnRight", "deleteRow", "deleteColumn", "viewHtml", "formatting", "cleanFormatting", "fontName", { name: "fontSize", items: [].concat([{ text: "8px", value: "8px" }], [{ text: "12px", value: "12px" }], [{ text: "16px", value: "16px" }], [{ text: "20px", value: "20px" }], [{ text: "24px", value: "24px" }]) }, "foreColor", "backColor"], keyup: tf, encoded: !1 }); y = yi.data("kendoEditor"); y.value(""); h != undefined && h != null && y.value(h) } catch (t) { return console.log(t), n.ADialog.error("PleaseInstallKendoUIModule"), p.dispose(), p = null, !1 } return !0 } function tf() { (y.value() != "" || nt.val() != "") && (lt = 1) } function rf(n) { var i, t, f; if (n == !0 && (v = u.getSelectedRows(), w = r.getRecords()[r.getCurrentRow()]), u.singleRow && v.length == 0) uf(); else if (v.length > 0) { for (i = "", t = 0; t < v.length; t++)e && v[t].email != null && (e = !0, f = v[t][r.getKeyColumnName().toLower()], i += '<li class="vis-list-li-bcc"  data-email="' + v[t].email + '"><input data-currentrec="Y" data-recID="' + f + '" id="' + p.windowNo + "_" + v[t].email + '_CheckBoxList1" type="checkbox" value="' + v[t].email + '" checked/><label class="vis-chcklist-label"  for="' + p.windowNo + "_" + v[t].email + '_CheckBoxList1">' + v[t].email + "(" + f + ")<\/label><\/li>"); ot.append(i); i = null } else uf(); n || gi.append(ot) } function uf() { if (e && w.email != null) { e = !0; var n = w[r.getKeyColumnName().toLower()]; ot.append('<li class="vis-list-li-bcc" data-email="' + w.email + '"><input id="' + p.windowNo + "_" + w.email + '_CheckBoxList1" type="checkbox" value="' + w.email + '" checked /><label class="vis-chcklist-label" for="' + p.windowNo + "_" + w.email + '_CheckBoxList1">' + w.email + "(" + n + ")<\/label><\/li>") } } function ff(i) { var h, f, e, o, s, u; for (i ? it.empty() : (nr = t('<div class="vis-apanel-lb-toggle">'), dt = t('<i class="fa fa-bars"><\/i>'), ni = t('<div class="vis-apanel-lb-toggle" style="border:none;height:100%;overflow-x:hidden;overflow-y: hidden;"><\/div>'), oi = t("<div class='vis-apanel-lb-oflow' style='border-top:0;display:none' >"), oi.html("<a data-dir='u' href='javascript:void(0)'><i class='vis vis-arrow-up' data-dir='u'><\/i><\/a><a data-dir='d' href='javascript:void(0)' ><i class='vis vis-arrow-down' data-dir='d'><\/i><\/a>"), tr = t('<div class="vis-apanel-lb-toggle" style="padding: 5px 10px;overflow-x:hidden;overflow-y: hidden;"><\/div>'), tr.append(oi), nr.append(dt), g.append(nr), g.append(ni), g.append(tr), it = t('<ul class="vis-apanel-lb-ul"><\/ul>'), it.css({ overflow: "auto", "overflow-x": "hidden", "white-space": "nowrap", width: "100%" })), h = "", f = 0; f < r.gridTable.getFields().length; f++)if (e = r.gridTable.getFields(0)[f].getColumnName().toUpper() == r.getKeyColumnName().toUpper(), r.gridTable.getFields(0)[f].getIsDisplayed() || e) { if (e || (h += "<li>" + r.gridTable.getFields(0)[f].getHeader() + "<\/li>"), o = [], s = [], r.gridTable.getFields(0)[f].getColumnName().toUpper().equals(si)) for (u = 0; u < v.length; u++)n.DisplayType.IsLookup(r.getField(si).getDisplayType()) ? v[u][si.toLower()] != null && (o.push(v[u][si.toLower()]), s.push(v[u][r.getKeyColumnName().toLower()])) : v[u][si.toLower()] != null && (o.push(v[u][si.toLower()]), s.push(v[u][r.getKeyColumnName().toLower()])); re(o, s) } e || it.append(h); i || ni.append(it); it.children("li").on("click", ae) } function ef() { if (!d) if (it.height() > t(it.parent()).height()) { ni.css("border-bottom", "1px solid rgba(var(--v-c-secondary), 1)"); oi.css("display", "block"); var n = tr.height() + nr.height() + 37; ni.height(g.height() - n); g.css("overflow", "hidden"); ni.css({ "overflow-x": "hidden", width: "100%", "overflow-y": "visible" }) } else ni.css("border-bottom", "none"), oi.css("display", "none") } function re(i, r) { for (var f, e = 0; e < i.length; e++) { var u = n.dataContext.getJSONData(n.Application.contextUrl + "Email/GetUser", { BPartner_ID: i[e] }, null), o = ""; if (u != null) for (f in u) if (u[f].Email != null) { if (u[f].Email == null || u[f].Email == "") continue; if (t(ot.children("li").data(u[f].Email + r[e])).length > 0) continue; o += '<li  class="vis-list-li-bcc"><input data-currentrec="N" data-recid="' + r[e] + '" id="' + p.windowNo + "_" + u[f].Email + '_CheckBoxList1" type="checkbox"  value="' + u[f].Email + '" checked/><label class="vis-chcklist-label"  for="' + p.windowNo + "_" + u[f].Email + '_CheckBoxList1">' + u[f].Email + "(" + r[e] + ")<\/label><\/li>" } ot.append(o); o = null } } function ue() { nt.on("change", tf); if (!d) oi.on("click", function (n) { var r, e; if (n.stopPropagation(), r = t(n.target).data("dir"), r) { var o = it.parent().height(), s = it.height(), u = it.parent().scrollTop(), f = Math.ceil(o / 2), i = 0; if (r == "d") { if (u + f >= s - f) return; e = s - o; i = u + f; it.parent().animate({ scrollTop: i > e ? e : i }, 1e3) } else if (r == "u") { if (u == 0) return; i = u - f; it.parent().animate({ scrollTop: i < 0 ? 0 : i }, 1e3) } } }); ar.on("click", function () { fe() }); ei.on("click", "li", function (i) { var u, r; if (i.stopPropagation(), u = t(this).attr("value"), parseInt(u) == 0) oe(i); else if (parseInt(u) == 1) { if (t("#w2ui-overlay").hide(), pt != null && pt.GetDmsCloseOrNot()) { n.ADialog.info("DMSAlreadyOpen"); return } r = new n.CFrame; pt = new VADMS.DocumentManagementSystem; r.setName(n.Msg.getMsg("VADMS_Document")); r.setTitle(n.Msg.getMsg("VADMS_Document")); r.hideHeader(!0); pt.setWindowNo(p.windowNo); pt.OpenFromEmail(!0); r.setContent(pt); pt.initialize(); r.show() } }); if (e) { gt.on("click", ye); if (lr != null && lr != undefined) lr.on("click", de) } else gt.on("click", pe); if (!e) { ou.on("click", we); su.on("click", be) } if (d) a.find(".vis-Email-CcBcc").on("click", ge); else { dt.on("click", ee); ht.on("click", he); pi.on("click", ve); wi.on("click", af); bi.on("click", vf); ct.on("click", bu); dt.trigger("click"); bt.on("click", ce) } pf(); e || nt.keyup(function () { lt = nt.val() != "" ? y.value() != "" ? 1 : 0 : 0 }) } function fe() { var i, r; ei != null && ei.empty(); i = t("<div/>"); i.css("width", "auto"); i.css("height", "100%"); ei.css("width", "auto"); ei.css("height", "100%"); r = "<li class='vis-filesystem' value='0'>" + n.Msg.getMsg("FileSystem") + "<\/li> "; window.VADMS && (r += "<li class='vis-dms' value='1'>" + n.Msg.getMsg("DMS") + "<\/li>"); ei.append(r); i.append(ei); ar.w2overlay(i.clone(!0), { css: { height: "300px" } }); i.css("top", "395px"); ei.load() } function ee(n) { ht.prop("checked") == !0 ? g.width() == 40 ? (e ? (middleDivWidth = fi - (a.find(".vis-email-leftDiv").width() + 200), a.find(".vis-Email-leftWrap").width(middleDivWidth - 355), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 45), at.width(middleDivWidth)) : (middleDivWidth = fi - (a.find(".vis-email-leftDiv").width() + 200), a.find(".vis-Email-leftWrap").width(middleDivWidth - 15), a.find(".vis-form-data-sub").width(middleDivWidth - 40), at.width(middleDivWidth)), g.css("width", "200px"), g.find("ul").show(), ef(), y != null && y != undefined && (y.body.style.width = y.body.style.width - 160)) : (yu(), ni.css("border-bottom", "none"), d || oi.css("display", "none")) : g.width() != 40 && yu(); n.stopPropagation() } function yu() { g.css({ width: "40px" }); g.find("ul").hide(); e ? (middleDivWidth = fi - (a.find(".vis-email-leftDiv").width() + 40), a.find(".vis-Email-leftWrap").width(middleDivWidth - 355), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 45), at.width(middleDivWidth)) : (middleDivWidth = fi - (a.find(".vis-email-leftDiv").width() + 40), a.find(".vis-Email-leftWrap").width(middleDivWidth - 15), a.find(".vis-form-data-sub").width(middleDivWidth - 40), at.width(middleDivWidth)); y != null && y != undefined && (y.body.style.width = y.body.style.width + 160) } function oe() { var n; if (ru == !1) { if (a.find(".vis-email-attachmentContainer").is(":visible")) a.find(".vis-email-attachmentContainer").hide(), a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height() + (a.find(".vis-email-attachmentContainer").height() + 13)); else if (n = a.find(".vis-Email-ContentArea").height(), a.find(".vis-email-attachmentContainer").show(), a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height() - (a.find(".vis-email-attachmentContainer").height() + 13)), et == null || et == undefined) { of(); et = a.find("<input type='file' multiple='true' style='display:none;'>"); uu.append(et); yr.on("click", function () { et.trigger("click") }); et.change(function () { pu(this) }) } } else a.find(".vis-email-attachmentContainer").is(":visible") || (n = a.find(".vis-Email-ContentArea").height(), (et == null || et == undefined) && (of(), et = t("<input type='file' multiple='true' style='display:none;'>"), et.change(function () { this.files.length < 1 || (a.find(".vis-email-attachmentContainer").show(), pu(this), d ? a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-ContentArea").height() - (a.find(".vis-form-horizontal").height() + 30)) : a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-ContentArea").height() - (a.find(".vis-form-horizontal").height() + 50)), cf()) }))), et.trigger("click") } function of() { uu = t("<div><\/div>"); var n = t("<div><\/div>"); if (a.find(".vis-email-attachmentContainer").append(n), ru == !1 && (yr = t('<a class="vis-attach-ico browse-ico" style="margin-right:8px;float:right;height:30px;width:30px;margin-top:6px;"><\/a>'), uu.append(yr), n.append(yr)), fu = t("<div><\/div>"), n.append(fu), ci = t("<div class='vis-attach-content-wrap' style='height:83px;border-bottom:2px solid rgba(var(--v-c-secondary), 1);padding-bottom:0px'>"), ci.append(t('<div style="height:auto;overflow:auto" ><\/div>')), fu.append(ci), a.find(".vis-email-attachmentContainer").append(pr), ru == !1) { eu = t("<div><\/div>"); n.append(eu); hu = t('<a href="javascript:void(0)" class="vis-attach-ico uploadall-ico" style="height:30px;width:30px;margin-right: 7px;float:right"><\/a>'); eu.append(hu); hu.on("click", function () { cf() }) } } function sf() { return ci.children(0).height() < 75 ? !1 : !0 } function he() { this.checked ? (g.width() != 40 && g.find("ul").show(), e == !0 && u.singleRow == !1 && v.length > 1 && (st.val(""), st.prop("disabled", !0), rt.val(""), rt.prop("disabled", !0), k.val(""), k.prop("disabled", !0)), lu = !0) : (g.width() != 40 && yu(), e == !0 && u.singleRow == !1 && v.length > 1 && bt.prop("checked") == !1 && (st.prop("disabled", !1), rt.prop("disabled", !1), k.prop("disabled", !1)), lu = !1, ni.css("border-bottom", "none"), d || oi.css("display", "none")) } function ce() { this.checked ? (ii.parent().show(), e == !0 && u.singleRow == !1 && v.length > 1 && (st.val(""), st.prop("disabled", !0), rt.val(""), rt.prop("disabled", !0), k.val(""), k.prop("disabled", !0))) : (ii.parent().hide(), e == !0 && u.singleRow == !1 && v.length > 1 && ht.prop("checked") == !1 && (st.prop("disabled", !1), rt.prop("disabled", !1), k.prop("disabled", !1))) } function le() { t.ajax({ url: n.Application.contextUrl + "JsonData/GetReportFileTypes", datatype: "json", type: "post", cache: !1, data: { AD_Process_ID: r.getAD_Process_ID() }, success: function (n) { var i, r; if (n != null && (i = jQuery.parseJSON(n), i.length != 0)) for (r = 0; r < i.length; r++)ii.append(t("<option value=" + i[r].Key + ">" + i[r].Name + "<\/option>")) } }) } function ae() { y.paste("@@" + t(this).text() + "@@") } function ve() { var f = y.value(), e = "", r, i; e = u.singleRow == !1 || v.length > 0 ? no(f, 0) : to(f); r = t("<div><\/div>"); r.append(e); t(r.find("table")).css({ width: "100%", border: "1px solid Black" }); t(r.find("td")).css({ border: "1px solid Black" }); i = new n.ChildDialog; i.setHeight(420); i.setWidth(850); i.setTitle(n.Msg.getMsg("Preview")); i.setModal(!0); i.setContent(r); i.show(); i.hidebuttons() } function ye(t) { var i = nt.val(), r = y.value(), u = !0; if ((i == null || i == "" || i.trim().length == 0) && (r == null || r == "" || r.trim().length == 0)) { u = !1; n.ADialog.confirm("SendWithoutSubjectandBody", !0, "", "Confirm", function (n) { n && dr(t, i, r) }); return } if (i == null || i == "" || i.trim().length == 0) { u = !1; n.ADialog.confirm("SendWithoutSubject", !0, "", "Confirm", function (n) { n && dr(t, i, r) }); return } if (r == null || r == "" || r.trim().length == 0) { u = !1; n.ADialog.confirm("SendWithoutBody", !0, "", "Confirm", function (n) { n && dr(t, i, r) }); return } u && dr(t, i, r) } function dr(i, e) { var d, ft, l, s, o, et, ct, lt, a, it, c, h; yt = !1; var g = st.val(), b = k.val(), nt = rt.val(); if (g.trim().length > 0) if (g.contains(";")) { for (s = g.split(";"), o = 0; o < s.length; o++)if (s[o] != null && s[o] != "") if (kt(s[o].trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + s[o]) }, 2); return } } else if (kt(g.trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + g) }, 2); return } if (nt.trim().length > 0) if (nt.contains(";")) { for (s = nt.split(";"), o = 0; o < s.length; o++)if (s[o] != null && s[o] != "") if (kt(s[o].trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + s[o]) }, 2); return } } else if (kt(nt.trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + nt) }, 2); return } if (b.trim().length > 0) if (b.contains(";")) { for (s = b.split(";"), o = 0; o < s.length; o++)if (s[o] != null && s[o] != "") if (kt(s[o].trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + s[o]) }, 2); return } } else if (kt(b.trim())) yt = !0; else { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + b) }, 2); return } if (d = [], ht.prop("checked") == !1 && bt.prop("checked") == !1) { if (ft = !1, l = {}, l.To = g, l.Cc = nt, l.Bcc = [], b.contains(";")) for (s = b.split(";"), o = 0; o < s.length; o++)s[o] != null && s[o] != "" && l.Bcc.push(s[o]); else b != null && b != "" && l.Bcc.push(b); if (ot != null && ot != undefined && (tt = [], t("[id*=CheckBoxList1]:checked").each(function () { tt.push(t(this).val()) }), tt.length > 0)) for (a = 0; a < tt.length; a++) { if (!kt(tt[a])) { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + tt[a]) }, 2); return } ft = !0; l.Bcc.push(tt[a]) } if (l.Subject = e, l.TableID = vi, l.Recordids = "", w != null) if (u.singleRow == !1 || v.length > 0) { for (et = "", c = 0; c < v.length; c++)et += v[c][r.keyColumnName.toLower()] + ","; l.Recordids = et } else l.Recordids = f > 0 ? f : u.singleRow == !0 ? r.getField(r.keyColumnName.toLower()).value : w[r.keyColumnName.toLower()]; else f > 0 && (l.Recordids = f); if (l.AttachmentFolder = br, !ft && !yt) { window.setTimeout(function () { n.ADialog.info("NoEmailAddressFound") }, 2); return } d.push(l) } else if (tt = [], ct = [], lt = [], t("[id*=CheckBoxList1]:checked").each(function () { tt.push(t(this).val()); ct.push(t(this).data("recid")); lt.push(t(this).data("currentrec")) }), tt.length > 0) { for (a = 0; a < tt.length; a++)if (!kt(tt[a])) { window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + tt[a]) }, 2); return } for (it = 0; it < tt.length; it++)if (u.singleRow == !0 && v.length == 0) { if (h = sr(w, 0), h == null || h == undefined) return; d.push(h) } else for (c = 0; c < v.length; c++)if (ct[it] == v[c][r.getKeyColumnName().toLower()]) { if (h = null, h = lt[it] == "N" ? sr(v[c], c, tt[it]) : sr(v[c], c), h == null || h == undefined) continue; d.push(h) } } else if (yt) if (u.singleRow == !0 && v.length == 0) { if (h = sr(w, 0), h == null || h == undefined) return; d.push(h) } else for (c = 0; c < v.length; c++)(h = sr(v[c], c), h != null && h != undefined) && d.push(h); if (d.length == 0) { window.setTimeout(function () { n.ADialog.info("NoEmailAddressFound") }, 2); return } var dt = JSON.stringify(d), at = !1, wt = "X"; bt.prop("checked") && (wt = ii.val()); n.ADialog.confirm("WantAlertMessage", !0, "", "Confirm", function (i) { i && (at = !0); ut[0].style.visibility = "visible"; var u = { mails: n.Utility.encodeText(dt), AD_User_ID: vt.getAD_User_ID(), AD_Client_ID: vt.getAD_Client_ID(), AD_Org_ID: vt.getAD_Org_ID(), attachment_ID: iu, fileNamesFornNewAttach: JSON.stringify(di), fileNamesForopenFormat: JSON.stringify(li), mailFormat: n.Utility.encodeText(y.value()), notify: at, strDocAttach: n.context.getContext("DocumentAttachViaEmail_" + p.windowNo), AD_Process_ID: r != null ? r.getAD_Process_ID() : 0, printformatfileType: wt }; t.ajax({ url: n.Application.contextUrl + "Email/SendMail", data: u, datatype: "json", type: "post", cache: !1, async: !0, success: function (t) { ut[0].style.visibility = "hidden"; var i = JSON.parse(t); i == "" ? (p.dispose(), p = null, pt != null && pt.dispose(), pt = null) : window.setTimeout(function () { n.ADialog.info(i); i.contains("MailSent") && n.context.setContext("DocumentAttachViaEmail_" + p.windowNo, "") }, 2) } }) }) } function kt(n) { return /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n) } function pe() { var e, i, h, o, s; if (e = nt.val(), e == null || e == "" || e.trim().length == 0) { n.ADialog.info("PleaseAddSubject"); return } if (i = y.value(), i != null && i != "" && i != undefined && !(i.trim().length < 1)) { if (h = "", o = {}, v = u.getSelectedRows(), w = r.getRecords()[r.getCurrentRow()], u.singleRow == !1 || v.length > 0) for (s = 0; s < v.length; s++)o[v[s][r.keyColumnName.toLower()]] = ku(i, s); else f > 0 ? o[f] = nu(i) : o[w[r.keyColumnName.toLower()]] = nu(i); ut[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Email/SaveAttachment", datatype: "json", type: "post", cache: !1, data: { subject: e, AD_Table_ID: vi, html: n.Utility.encodeText(i), values: JSON.stringify(o) }, success: function () { ut[0].style.visibility = "hidden"; n.ADialog.info("Saved") }, error: function (n) { console.log(n) } }) } } function we() { var i = y.value(), o, f, e; if (i != null && i != "" && i != undefined && !(i.trim().length < 1)) { if (o = "", f = [], v = u.getSelectedRows(), w = r.getRecords()[r.getCurrentRow()], u.singleRow == !1 || v.length > 0) for (e = 0; e < v.length; e++)f.push(ku(i, e)); else f.push(nu(i)); ut[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Email/InsertAttachmentText", datatype: "json", type: "post", cache: !1, data: { html: n.Utility.encodeText(i), values: JSON.stringify(f) }, success: function (t) { var i, r; ut[0].style.visibility = "hidden"; i = JSON.parse(t); nf = i; r = nf; window.open(n.Application.contextUrl + r); return } }) } } function be(t) { or = !1; er = 0; lt == 1 ? (y.value() != "" || nt.val() != "") && n.ADialog.confirm("DoYouWantToSave", !0, "", "Confirm", function (n) { n ? (bu(t), lt = 0, er = 1) : (nt.val(""), y.value(""), hi = 0, ct.css("opacity", "1"), lt = 0) }) : (nt.val(""), y.value(""), hi = 0, ct.css("opacity", "1"), lt = 0) } function af(t) { var r = 0, i; wu = 0; i = new n.Openmailformat(u.gTab.getAD_Window_ID(), e); ke = i; e || (er = 0, y.value() != "" && nt.val() != "" && lt == 1 && (n.ADialog.confirm("DoYouWantToSave", !0, "", "Confirm", function (n) { n ? (bu(t), wu = 1, or = !0) : (hi = 0, ct.css("opacity", "1"), lt = 0, i.show()) }), r = 1)); r == 0 && i.show(); i.onClose = function () { lt = 0; var n = i.getSelectedRow(); n != null && n != undefined && (hi = n.AD_TEXTTEMPLATE_ID, gr = n.AD_CLIENT_ID, nt.val(n.SUBJECT), gr != vt.getAD_Client_ID() ? ct.css("opacity", "0.4") : ct.css("opacity", "1"), n.ISDYNAMICCONTENT == "Y" ? ht.prop("checked", !1).trigger("click") : ht.prop("checked", !0).trigger("click"), hr = n.AD_Window_ID != null && n.AD_Window_ID != undefined && n.AD_Window_ID > 0 ? !1 : !0, tu = n.NAME, y.value(n.MAILTEXT)); or = !1 } } function vf() { var i = y.value(), t; i != null && i.trim() != "" && i != undefined && (t = new n.Newmailformat(e), t.show(), t.onClose = function () { tu = t.getName(); hr = t.saveForAll(); yf(0) }) } function bu() { if (gr == vt.getAD_Client_ID()) { var n = y.value(); n != null && n != "" && n != undefined && (hi > 0 ? yf(hi) : vf()) } } function de() { ot.empty(); rf(!0); ff(!0) } function yf(i) { var u = { id: i, AD_Client_ID: vt.getAD_Client_ID(), AD_Org_ID: vt.getAD_Org_ID(), name: n.Utility.encodeText(tu), isDynamic: ht.prop("checked"), subject: n.Utility.encodeText(nt.val()), text: n.Utility.encodeText(y.value()), saveforAll: hr, AD_Window_ID: r.getAD_Window_ID(), folderName: br, attachmentID: iu }; t.ajax({ type: "POST", url: n.Application.contextUrl + "Email/SaveFormats", data: u, success: function (n) { hi = parseInt(n); gr = vt.getAD_Client_ID(); ct.css("opacity", "1"); lt = 0; e || (er == 1 && (nt.val(""), y.value("")), or == !0 && window.setTimeout(function () { wu == 1 && (af(), or = !1) }, 200)) } }) } function ge() { k.is(":visible") ? (k.hide(), rt.hide(), a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - 365) : a.find(".vis-Email-textarea-div").height(a.height() - 180)) : (k.show(), rt.show(), a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - 440) : a.find(".vis-Email-textarea-div").height(a.height() - 255)) } function sr(t, i, e) { var c = !1, o = {}, s, i, h; if (o.To = st.val(), o.Cc = rt.val(), o.Bcc = [], k.val().contains(";")) for (s = k.val().split(";"), i = 0; i < s.length; i++)s[i] != null && s[i] != "" && o.Bcc.push(s[i]); else k.val() != null && k.val() != "" && o.Bcc.push(k.val()); if (e) kt(e) || window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + e); return }, 2), o.Bcc.push(e), c = !0; else if (ot != null && ot != undefined) if (Object.keys(t).indexOf("email") > -1 && tt.indexOf(t.email) > -1) kt(t.email) || window.setTimeout(function () { n.ADialog.info("NotValidEmail", !0, ":" + t.email); return }, 2), o.Bcc.push(t.email), c = !0; else if ((!u.singleRow != !1 || v.length != 1) && (!u.singleRow == !1 || v.length > 1)) return; if (h = nt.val(), h.trim().length == 0 && (h = "  "), o.Subject = h, o.TableID = vi, o.Recordids = u.singleRow == !0 && v.length == 0 ? f : t[r.keyColumnName.toLower()], o.Body = u.singleRow == !1 ? ku(y.value(), i) : nu(y.value()), o.AttachmentFolder = br, u.singleRow != !0 && v.length != 1 || c || yt) return o } function ku(t, i) { for (var e = t, h = {}, s; e.indexOf("@@") > -1;) { e = e.substring(e.indexOf("@@") + 2); var c = e.substring(0, e.indexOf("@@")), o = null, f = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === c })[0]; f != undefined && f != null && (n.DisplayType.IsLookup(r.getField(f).getDisplayType()) || n.DisplayType.Location == r.getField(f).getDisplayType() ? v[i][f.toLower()] != null && v[i][f.toLower()] != undefined && (o = r.getField(f.toLower()).lookup.getDisplay(v[i][f.toLower()])) : n.DisplayType.IsDate(r.getField(f).getDisplayType()) ? (s = r.getField(f).getDisplayType(), o = r.getField(f).value, o = n.DisplayType.Date == s ? new Date(o).toLocaleDateString() : n.DisplayType.Time == s ? new Date(o).toLocaleTimeString() : new Date(o).toLocaleString()) : o = v[i][f.toLower()]); e = e.substring(e.indexOf("@@") + 2); h["@@" + c + "@@"] = o } return h } function nu(t) { for (var f = t, s = {}, o; f.indexOf("@@") > -1;) { f = f.substring(f.indexOf("@@") + 2); var h = f.substring(0, f.indexOf("@@")), e = null, i = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === h })[0]; i != undefined && i != null && (n.DisplayType.IsLookup(r.getField(i).getDisplayType()) || n.DisplayType.Location == r.getField(i).getDisplayType() ? v.length > 0 && v[0][i.toLower()] != null && v[0][i.toLower()] != undefined ? e = r.getField(i.toLower()).lookup.getDisplay(v[0][i.toLower()]) : w[i.toLower()] != null && w[i.toLower()] != undefined && (e = r.getField(i.toLower()).lookup.getDisplay(w[i.toLower()])) : n.DisplayType.IsDate(r.getField(i).getDisplayType()) ? (o = r.getField(i).getDisplayType(), e = r.getField(i).value, e = n.DisplayType.Date == o ? new Date(e).toLocaleDateString() : n.DisplayType.Time == o ? new Date(e).toLocaleTimeString() : new Date(e).toLocaleString()) : e = u.singleRow == !0 && v.length == 0 ? r.getField(i).value : v && v.length > 0 ? v[0][i.toLower()] : w[i.toLower()]); f = f.substring(f.indexOf("@@") + 2); s["@@" + h + "@@"] = e } return s } function no(t, i) { for (var s = t, o = t, c; o.indexOf("@@") > -1;) { o = o.substring(o.indexOf("@@") + 2); var h = o.substring(0, o.indexOf("@@")), e = null, f = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === h })[0]; f != undefined && f != null && (n.DisplayType.IsLookup(r.getField(f).getDisplayType()) || n.DisplayType.Location == r.getField(f).getDisplayType() ? v[i][f.toLower()] != null && v[i][f.toLower()] != undefined && (e = r.getField(f.toLower()).lookup.getDisplay(v[i][f.toLower()])) : n.DisplayType.IsDate(r.getField(f).getDisplayType()) ? (c = r.getField(f).getDisplayType(), e = r.getField(f).value, e = n.DisplayType.Date == c ? new Date(e).toLocaleDateString() : n.DisplayType.Time == c ? new Date(e).toLocaleTimeString() : new Date(e).toLocaleString()) : e = v[i][f.toLower()]); o = o.substring(o.indexOf("@@") + 2); s = e != null && e != undefined ? s.replace("@@" + h + "@@", e) : s.replace("@@" + h + "@@", "") } return s } function to(t) { for (var e = t, o; e.indexOf("@@") > -1;) { e = e.substring(e.indexOf("@@") + 2); var s = e.substring(0, e.indexOf("@@")), f = null, i = Object.keys(u.getColumnNames()).filter(function (n) { return u.getColumnNames()[n] === s })[0]; i != undefined && i != null && (n.DisplayType.IsLookup(r.getField(i).getDisplayType()) || n.DisplayType.Location == r.getField(i).getDisplayType() ? f = w[i.toLower()] != null && w[i.toLower()] != undefined ? r.getField(i.toLower()).lookup.getDisplay(w[i.toLower()]) : "" : n.DisplayType.IsDate(r.getField(i).getDisplayType()) ? (o = r.getField(i).getDisplayType(), f = r.getField(i).value, f = n.DisplayType.Date == o ? new Date(f).toLocaleDateString() : n.DisplayType.Time == o ? new Date(f).toLocaleTimeString() : new Date(f).toLocaleString()) : u.singleRow == !0 && v.length == 0 ? (f = r.getField(i).value, f == null && (f = "")) : f = w[i.toLower()]); e = e.substring(e.indexOf("@@") + 2); t = t.replace("@@" + s + "@@", f) } return t } function pf() { var n = 0; a.height(du); a.width(fi); a.find(".contentArea").css("height", a.height() - 42); a.find(".vis-Email-BccList").height(1); a.find(".vis-email-leftDiv").height(a.find(".contentArea").height()); d ? (a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - 345) : a.find(".vis-Email-textarea-div").height(a.height() - 180), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 85), n = a.width() - 40) : e ? (a.find(".vis-email-attachmentContainer").is(":visible") ? a.find(".vis-Email-textarea-div").height(a.height() - (a.find(".vis-email-attachmentContainer").height() + 150)) : a.find(".vis-Email-textarea-div").height(a.height() - (a.find(".vis-email-attachmentContainer").height() + 70)), n = fi - (a.find(".vis-email-leftDiv").width() + 30), a.find(".vis-Email-leftWrap").width(n - 355), a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width() - 45)) : (a.find(".vis-Email-textarea-div").height(a.height() - 155), y != null && y != undefined, n = fi - (a.find(".vis-email-leftDiv").width() + 30), a.find(".vis-Email-leftWrap").width(n - 15), a.find(".vis-form-data-sub").width(n - 40)); at != null && at.css("width", n - 10); y != null && y != undefined && (y.body.style.width = n - 370 + "px"); d || (window.VADMS ? a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 310)) : a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height() - (a.find(".vis-Email-rytForm").height() + 70))) } var au, wr, kr, pu, er; this.frame = null; this.windowNo = n.Env.getWindowNo(); var vt = n.Env.getCtx(), ri = null, si = "C_BPARTNER_ID", v = null, w = null, hi = 0, tu, hr, b = [], wf = [], ci = null, iu = 0; l && (iu = l); var ru = !0, yt = !1, vi = 0, tt = [], d = !1, li = [], di = [], it = null, a = null, g = null, at = null, gi = null, cr = null, dt = null, ot = null, ht = null, st = null, k = null, rt = null, lr = null, ar = null, nt = null, yi = null, y = null, vr = null, pi = null, gt = null, wi = null, bi = null, ct = null, bf = null, ut, ui = t('<div class="vis-awindow-header vis-menuTitle">'), p = this, uu, yr, fu, eu, ou, su, hu, du = 0, fi = 0, io = p.windowNo; a = t('<div class="vis-email-rootDiv vis-forms-container"><\/div>'); var cu = t('<div class="vis-email-rootDivBusy"><\/div>'), ei = t("<ul id='ulAttachmentOption' class='vis-apanel-rb-ul'>"), pt = null, gu = !1, nr, ni, tr, lu = !1, pr = t("<div style='width: 100%;height: 100%;background:black;opacity: .1;display:none'>"), ki = null; ki = n.Application.isRTL ? t("<div id='progress_bar' class='vis-ui-progress-bar ui-container' style='top:41%;width: 80%;right: 10%;'>") : t("<div id='progress_bar' class='vis-ui-progress-bar ui-container' style='top:41%;width: 80%;left: 9%;'>"); pr.append(ki); au = t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;margin-top:2px'>"); ki.append(au); wr = t("<span class='ui-label' >").append("0%"); ki.append(wr); var vu = 0, ai = 0, br = Date.now().toString(), wt = 1048576, ti = 0, ir = 0, kf = [], nf = "", et = null, ft, rr = null, oi, lt = 0, bt = null, ii = null, ur = "", fr = ""; df(); this.initializeComponent = function () { var i = null, r; (e == !0 ? (i = t('<a href="javascript:void(0)"  class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/a>'), r = d ? t("<p>" + n.Msg.getMsg("EMail") + " (" + n.Msg.getMsg("Contacts") + ") <\/p>") : t("<p>" + n.Msg.getMsg("EMail") + " (" + u.aPanel.$parentWindow.getName() + ") <\/p>")) : (i = t('<a href="javascript:void(0)"  class="vis-icon-menuclose"><i class="vis vis-cross"><\/i><\/a>'), r = d ? t("<p>" + n.Msg.getMsg("Letter") + " (" + n.Msg.getMsg("Contacts") + ") <\/p>") : t("<p>" + n.Msg.getMsg("Letter") + " (" + u.aPanel.$parentWindow.getName() + ") <\/p>")), a.append(ui.append(i).append(r)), i.click(function (n) { p.dispose(); p = null; n.stopPropagation() }), ne(), ie() != !1) && (a.append(ut), gf(), d || e && rf(!1), d || (ff(!1), le()), ue()) }; this.getRoot = function () { return a }; this.leftULsize = function () { if (!d) { var n = tr.height() + nr.height() + 53; t(it.parent()).height(g.height() - n); lu == !0 && ef() } }; kr = function (n) { n ? (pr.show(), ki.show()) : (pr.hide(), ki.hide()) }; pu = function (i) { for (var f, u, c, e, l, v, o, y, k, w, h, r = 0; r < i.files.length; r++) { if (ft = i.files[r], ft == undefined) return; if (ft.size != 0) { for (u in b) if (ft.name == b[u].name) { window.setTimeout(function () { n.ADialog.info("fileAlreadyAttached") }, 2); return } if (li != null) for (f = 0; f < li.length; f++)if (ft.name == li[f]) { window.setTimeout(function () { n.ADialog.info("fileAlreadyAttached") }, 2); return } ti = 0; for (u in b) ti += b[u].size; if (ti + ft.size > wt * 24) { window.setTimeout(function () { n.ADialog.info("MaxFileSize25MB") }, 2); return } if (ft.size > wt * 24) { window.setTimeout(function () { n.ADialog.info("MaxFileSize25MB") }, 2); return } c = {}; e = t("<div style='margin-bottom:3px' class='vis-attach-file-wrapla'>"); ci.children(0).append(e); l = t("<div class='vis-attach-file-top'>"); v = t("<a class='vis-file-close-ico'><i class='vis vis-mark'><\/i><\/a>"); l.append(v); e.append(l); ci.show(); v.on("click", function () { var i = t(t(this).parent()).parent(), r = i.html(), n; i.remove(); i = null; for (n in b) if (String(r).indexOf(b[n].name) > -1) { ti = ti - n.size; b.splice(n, 1); break } di.splice(0, di.length); for (n in b) di.push(b[n].name); sf() || (a.find(".vis-attach-content-wrap").height(83), a.find(".vis-email-attachmentContainer").height(90), d ? a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 30)) : a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 50))); b.length == 0 && (a.find(".vis-email-attachmentContainer").hide(), a.find(".vis-email-attachmentContainer").height(90), a.find(".vis-attach-content-wrap").height(83), d ? a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 30)) : a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height() - (t(".vis-form-horizontal").height() + 50))); ai-- }); o = t("<div class='vis-attach-file-content'>"); e.append(o); y = t("<div class='vis-attach-file-icon'>"); k = hf(ft.name); y.append(t("<img src='" + k + "'>")); o.append(y); var p = t("<div class='vis-attach-file-text' style='margin-bottom:10px'>"), g = "", s = t("<p>"); ft.name.length > 17 ? (g = ft.name.toString().substr(0, 17), s.append(g), w = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip'>").append("..."), h = t("<span style='width: inherit;'>"), h.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/email-ccc.png").append("ToolTip Text")), h.append(t("<label class='VIS_Pref_Label_Font'>").append(ft.name)), w.append(h), s.append(w)) : s.append(ft.name); p.append(s); p.append(t("<p>").append((Number(ft.size) / 1024).toFixed(2) + "KB")); o.append(p); c.Name = ft.name; c.Size = ft.size; b.push(ft); sf() && a.find(".vis-email-attachmentContainer").height() == 90 && (a.find(".vis-email-attachmentContainer").height(155), a.find(".vis-attach-content-wrap").height(145)) } } }; var hf = function (t) { var r, u, i; return t == null || t.length == 0 ? "" : (r = t.lastIndexOf("."), u = n.Application.contextUrl + "Areas/VIS/Images/", r < 1) ? u + "defult.png" : (i = t.substr(r, t.length - r), u + (i == ".xlsx" || i == ".xls" ? "excel.png" : i == ".html" || i == ".htm" ? "html.png" : i == ".pdf" ? "pdf.png" : i == ".ppt" ? "ppt.png" : i == ".txt" ? "text.png" : i == ".docx" || i == ".doc" ? "word.png" : i == ".xml" ? "xml.png" : "defult.png")) }, ro = function (i, r) { var s = t("<div class='vis-attach-file-wrapla'>"), h, c, u, f, l, v, o; ci.append(s); h = t("<div class='vis-attach-file-top'>"); c = t("<a class='vis-file-close-ico'>"); h.append(c); s.append(h); c.on("click", function () { var n = t(t(this).parent()).parent(), r, i; n.css("display", "none"); r = n.html(); n.empty(); n = null; for (i in li) if (String(r).indexOf(li[i]) > -1) { li.splice(i, 1); break } }); u = {}; f = t("<div class='vis-attach-file-content'>"); s.append(f); l = t("<div class='vis-attach-file-icon'>"); l.append(t("<img src='" + hf(i) + "'>")); f.append(l); var a = t("<div class='vis-attach-file-text'  style='margin-bottom:10px'>"), y = "", e = t("<p>"); i.length > 17 ? (y = i.toString().substr(0, 17), e.append(y), v = t("<a href='javascript:void(0)' class='VIS_Pref_tooltip'>").append("..."), o = t("<span style='width: inherit;'>"), o.append(t("<img class='VIS_Pref_callout'>").attr("src", n.Application.contextUrl + "Areas/VIS/Images/email-ccc.png").append("ToolTip Text")), o.append(t("<label class='VIS_Pref_Label_Font'>").append(i)), v.append(o), e.append(v)) : e.append(i); a.append(e); a.append(t("<p>").append((Number(r) / 1024).toFixed(2) + "KB")); f.append(a); u.Name = i; u.Line_ID = 0; u.HaveSource = !1; u.Source = null; u.IsDeleted = !1; wf.push(u) }, cf = function () { var t = null, i = 0, r = 0, n; ti = 0; for (n in b) i = parseInt(b[n].size / wt), ft.size % wt > 0 && i++, ti += i, r += b[n].size, t = {}, di.push(b[n].name), t.Name = b[n].name, t.Size = b[n].size, kf.push(t); r > wt * 24 || (kr(!0), lf()) }, lf = function () { var t, i, r; if ((b == null || b.length == 0) && (kr(!1), a.find(".vis-email-attachmentContainer").hide(), a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height() + (a.find(".vis-email-attachmentContainer").height() + 13)), window.setTimeout(function () { n.ADialog.info("NothingToUpload"); return }, 2)), ai >= b.length) { kr(!1); return } t = new XMLHttpRequest; i = new FormData; i.append("file", b[ai].slice(ir * wt, ir * wt + Number(wt))); t.open("POST", n.Application.contextUrl + "Email/SaveAttachmentinTemp?filename=" + b[ai].name + "&folderKey=" + br, !1); t.send(i); vu++; ir++; r = parseInt(b[ai].size / wt); b[ai].size % wt > 0 && r++; ir == r && (ai++, ir = 0); vu <= ti && se(parseInt(vu / ti * 100)); window.setTimeout(function () { lf() }, 2) }, se = function (n) { au.css("width", n + "%"); wr.empty(); wr.append(n + "%") }; er = 0; var gr = vt.getAD_Client_ID(), or = !1, ke = null, wu = 0; this.showCcBccMails = function (n, t) { n != undefined && n != null && n != "" && (ur = n); t != undefined && t != null && t != "" && (fr = t) }; this.show = function () { ri = new n.ChildDialog; ri.setHeight(800); ri.setWidth(1600); ri.setTitle(n.Msg.getMsg("EMail")); ri.setModal(!0); ri.show(); ri.setContent(a); initializeComponent() }; this.disposeComponent = function () { vt = null; ri = null; si = ""; vi = 0; tt = null; d || (wi != null && wi.off("click"), pi != null && pi.off("click"), ct != null && ct.off("click"), bi != null && bi.off("click"), dt != null && dt.off("click"), it != null && it.remove(), dt != null && dt.remove(), ot != null && ot.remove(), ht != null && ht.remove(), yi != null && yi.remove()); gt != null && gt.off("click"); et != null && et != undefined && (et.off("change"), et.off("click")); it = null; a != null && a.remove(); a = null; g != null && g.remove(); g = null; at != null && at.remove(); at = null; gi != null && gi.remove(); gi = null; dt = null; ot = null; ht = null; e && (st != null && st.remove(), st = null, k != null && k.remove(), k = null, rt != null && rt.remove(), rt = null); nt != null && nt.remove(); nt = null; yi = null; y != null && y != undefined && y.destroy(); y = null; vr != null && vr.remove(); vr = null; pi = null; gt = null; bf = null; wi = null; ct = null; bi = null; bt != null && (bt.off("click"), bt = null); ii != null && (ii = null) }; this.sizeChanged = function (n, t) { du = n; fi = t; gu == !0 && (pf(), this.leftULsize()) }; this.ShowDMSDocumentAttchment = function () { var r = null, f = null, u, i; if (cr.children().remove(), u = t("<ul><\/ul>"), n.context.getContext("DocumentAttachViaEmail_" + p.windowNo) != "") { for (rr.empty(), rr.append(n.Msg.getMsg("Documents")), r = n.context.getContext("DocumentAttachViaEmail_" + p.windowNo).split(","), i = 0; i < r.length; i++)r[i].trim() != "" && (f = r[i].split("-"), u.append("<Li><input type='checkbox' checked value='" + f[0] + "'> " + f[1] + "<\/Li>")); cr.append(u) } else rr.empty(); u.on("click", "input", function () { var r = "", e = t(this).attr("value"), o, u, i, f; if (t(this).is(":checked")) t(this).is(":checked") && (f = e + "-" + t(this).text(), r = n.context.getContext("DocumentAttachViaEmail_" + p.windowNo) + (r != "" ? "," + f : f)); else for (o = n.context.getContext("DocumentAttachViaEmail_" + p.windowNo).split(","), u = jQuery.grep(o, function (n) { if (!n.trim().contains(e.toString().trim())) return n }), i = 0; i < u.length; i++)r += i == 0 ? u[i].trim() : "," + u[i].trim(); n.context.setContext("DocumentAttachViaEmail_" + p.windowNo, r) }) }; this.IsBusy = function (n) { n ? cu.css("display", "block") : cu.css("display", "none"); cu.appendTo(a) } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; t.hideHeader(!0); this.initializeComponent(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.refresh = function () { window.VADMS && this.ShowDMSDocumentAttchment(); this.leftULsize() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Email = i }(VIS, jQuery), function (n, t) { n.Newmailformat = function (i) { function s() { var r; f = t('<div class="vis-forms-container" ><\/div>'); var i = t('<div class="vis-emailsavewrap"><\/div>'), o = t('<div class="input-group vis-input-wrap"><\/div>'), s = t('<div class="vis-control-wrap"><\/div>'), h = t("<label>" + n.Msg.getMsg("Name") + "<\/label>"); u = t('<input type="text" data-placeholder="" placeholder=" ">'); s.append(u).append(h); labelshow = t('<label class="vis-ec-col-lblchkbox"><input type="checkbox">' + n.Msg.getMsg("ForAllWindows") + "<\/label>"); e = t(labelshow.find("input")[0]); r = t('<div style="display: flex"><\/div>'); e; n.Application.isRTL; r.append(labelshow); i.append(o); o.append(s); i.append(r); f.append(i) } function h() { return u.val() == null || u.val() == "" ? (n.ADialog.info("FileNameMendatory"), !1) : (o.onClose(), !0) } function c() { f.remove(); f = null; u.remove(); u = null; e.remove(); e = null; r = null } var f, u, e, r, o = this; s(); this.show = function () { r = new n.ChildDialog; i ? r.setTitle(n.Msg.getMsg("EmailFormats")) : r.setTitle(n.Msg.getMsg("LetterFormats")); r.setModal(!0); r.setContent(f); r.show(); r.onOkClick = h; r.onClose = c }; this.getName = function () { return u.val() }; this.saveForAll = function () { return e.prop("checked") } } }(VIS, jQuery), function (n, t) { n.Openmailformat = function (i, r) { function l() { u = n.dataContext.getJSONData(n.Application.contextUrl + "Email/GetMailFormat", { Window_ID: i }, null) } function a() { var n = w2ui.openformatgrid.getSelection(); return o = w2ui.openformatgrid.get(n), h.onClose(), !0 } function v() { u = null; s = null; f = null; w2ui.openformatgrid != undefined && w2ui.openformatgrid.destroy(); e.remove() } var s, u = null, o = {}, h = this, c = [], e, f; this.onClose = null; l(); this.show = function () { var o, l, i, s, c, h; if (e = t('<div class="vis-forms-container" style="height:304px"><\/div>'), f = new n.ChildDialog, n.Application.isRTL ? f.setHeight(435) : f.setHeight(430), f.setWidth(850), r ? f.setTitle(n.Msg.getMsg("EmailFormats")) : f.setTitle(n.Msg.getMsg("LetterFormat")), f.setModal(!0), f.setContent(e), f.show(), f.onOkClick = a, f.onClose = v, o = [], l = [], u != null) { for (i in u) u[i].name == "NAME" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Name"), size: "20%", hidden: !1 }) : u[i].name == "SUBJECT" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Subject"), size: "20%", hidden: !1 }) : u[i].name == "MAILTEXT" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Mailtext"), size: "20%", hidden: !1 }) : u[i].name == "CREATED" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("Created"), size: "20%", hidden: !1 }) : u[i].name == "ISDYNAMICCONTENT" ? o.push({ field: u[i].name, caption: n.Msg.getMsg("IsDynamicContent"), size: "20%", hidden: !1 }) : o.push({ field: u[i].name, caption: n.Msg.getMsg(u[i].name), size: "100px", hidden: !0 }); for (s = 0; s < u[0].RowCount; s++) { c = {}; c.recid = s; for (h in u) c[u[h].name] = u[h].name == "MAILTEXT" ? u[h].value[s] : n.Utility.encodeText(u[h].value[s]); l.push(c) } } e.w2grid({ name: "openformatgrid", recordHeight: 30, show: { selectColumn: !0 }, multiSelect: !1, columns: o, records: l }) }; this.getSelectedRow = function () { return o }; this.getAttachments = function () { return c } } }(VIS, jQuery), function (n, t) { function e(n, i, r) { var u = null; return t.ajax({ url: o, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function c(i, r, u, f, e, o, s, h) { var a = null, y = o, p = s, w = e.getAD_Window_ID(), i = i, c = new n.ReportViewer(f, e), v, l; s > 0 && c.setNodeID(s); o > 0 && c.setTreeID(o); h || c.showSummary(h); i && c.setAD_Table_ID(i); v = function (i) { var f, e, r; a = n.context.getAD_Client_ID(); r = null; f = null; e = []; try { for (r = null, t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetPrintFormats", data: { AD_Table_ID: i, AD_Tab_ID: u }, success: function (t) { r = (new n.DB.DataReader).toJson(t) } }); r.read();)n.Utility.Util.getValueOfInt(r.get(2).toString()) == a && (f = {}, f.Key = n.Utility.Util.getValueOfInt(r.get(0)), f.Name = r.getString(1), e.push(f)); r.close(); e.length == 0 ? f == null ? l(null, i, i) : l(f, 0, i) : l(e[0], 0, i) } catch (o) { r.close() } }; l = function (i, f, e) { var o = [], s, l; o.push(r.getTableName()); o.push(r.getWhereClause(!0)); u && o.push(u.toString()); s = null; s = i != null ? i.Key : f; l = c.getGenerateReportPara(o, r.getCode(0), f > 0 && u > 0, p, y, h, 0, 1, "", s, w); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: l, type: "POST", success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var f = jQuery.parseJSON(t), u = f.repInfo; if (u.IsError) { n.ADialog.error(u.ErrorText); c.close(); return } u.HTML && u.HTML.length > 0 && (c.show(u.HTML, u.AD_PrintFormat_ID, i, e, o, r.getCode(0), f.pSetting), c.setReportBytes(u.Report), c.setIteration(f.pSetting.TotalPage), (n.context.ctx.$AutoArchive == "1" || n.context.ctx.$AutoArchive == "2") && c.archiveDocument(o, e, u.Report)) } }) }; v(i) } function l(i, r, u) { function ui(n) { var i = t("#reportcreate").find(".progress-bar").width() * 100 / t("#reportcreate").width(); isNaN(i) && (i = 0); i <= n && t("#reportcreate").removeClass("hide").find(".progress-bar").attr("aria-valuenow", n).css({ width: n + "%" }).text(n.toFixed(0) + "%") } function bi() { t("#reportcreateresult").removeClass().text("") } function ki(n) { bi(); t("#reportcreateresult").addClass("alert alert-success").text(n); t("#forreportdownload").removeClass("hide") } function fr() { var n = window.open(), i; n.document.write("<html ><head>"); n.document.write("<\/head><body >"); i = t(vi); t(i.children()).css({ overflow: "hidden" }); n.document.write(i.html()); n.document.write("<\/body><\/html>"); n.print(); n.close() } function er() { hi = t('<ul class="vis-statusbar-ul vis-toppaging">'); v = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" aria-hidden="true" title="' + n.Msg.getMsg("FirstPage") + '"><\/i ><\/div ><\/li > '); y = t('<li style="opacity: 1;"><div><i class="vis vis-arrow-left" aria-hidden="true" title="' + n.Msg.getMsg("PageUp") + '"><\/i><\/div><\/li>'); e = t("<select>"); wi = t("<li>").append(e); p = t('<li style="opacity: 1;"><div><i class="vis vis-arrow-right" aria-hidden="true" title="' + n.Msg.getMsg("PageDown") + '"><\/i><\/div><\/li>'); w = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" aria-hidden="true" title="' + n.Msg.getMsg("LastPage") + '"><\/i><\/div><\/li>'); hi.append(v).append(y).append(wi).append(p).append(w); or() } function or() { v.on("click", function () { t(this).css("opacity") == "1" && ut(1) }); y.on("click", function () { t(this).css("opacity") == "1" && ut(parseInt(e.val()) - 1) }); p.on("click", function () { t(this).css("opacity") == "1" && ut(parseInt(e.val()) + 1) }); w.on("click", function () { t(this).css("opacity") == "1" && ut(parseInt(e.find("Option:last").val())) }); e.on("change", function () { ut(e.val()) }) } function li(n) { if (e.empty(), n.TotalPage > 0) { for (var i = 0; i < n.TotalPage; i++)e.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); e.val(n.CurrentPage); it.setIteration(n.TotalPage); n.TotalPage > n.CurrentPage ? (p.css("opacity", "1"), w.css("opacity", "1")) : (p.css("opacity", "0.6"), w.css("opacity", "0.6")); n.CurrentPage > 1 ? (v.css("opacity", "1"), y.css("opacity", "1")) : (v.css("opacity", "0.6"), y.css("opacity", "0.6")); n.TotalPage == 1 && (v.css("opacity", "0.6"), y.css("opacity", "0.6"), p.css("opacity", "0.6"), w.css("opacity", "0.6")) } else v.css("opacity", "0.6"), y.css("opacity", "0.6"), p.css("opacity", "0.6"), w.css("opacity", "0.6") } var g = t("<div class='vis-reportrootdiv'>"), d = null, wt = null, bt = null, s = null, kt = null, dt = null, gt = null, ni = null, ti = null, ht = null, ct = null, ft = null, et = null, l = null, vi = null, nt = null, ir = null, a = null, tt = null, lt = null, rr = n.Env.getScreenHeight() - 50, ei = t(window).width(), it = this, st, ur, rt, b, ci, di, gi, fi, k, ai; l = new n.CFrame; l.setName(n.Msg.getMsg("Report")); l.setTitle(n.Msg.getMsg("Report")); var oi = null, yi = t("<div>"), ot = t("<ul class='vis-apanel-rb-ul'>"); yi.append(ot); var pi = !1, c = [], ii = null, at = 0, vt = 0, si, hi, v, y, wi, p, w, e, yt = !0, h = null, ri = r.getAD_Window_ID(); this.getGenerateReportPara = function (t, r, u, f, e, o, s, c, l, v, y) { h || (h = new n.ProcessInfo("", 0, a, 0), h.setAD_User_ID(n.context.getAD_User_ID()), h.setAD_Client_ID(n.context.getAD_Client_ID())); h.setTable_ID(a); h.setAD_PInstance_ID(s); h.setPageNo(c); h.setFileType(l); h.set_AD_PrintFormat_ID(v); h.setAD_Window_ID(y); y > 0 ? h.setActionOrigin(n.ProcessCtl.prototype.ORIGIN_WINDOW) : h.setActionOrigin(n.ProcessCtl.prototype.ORIGIN_FORM); h.setOriginName(n.context.getWindowContext(i, "WindowName")); return { processInfo: h.toJson(), queryInfo: JSON.stringify(t), code: r, isCreateNew: u, treeID: e, node_ID: f, IsSummary: o } }; this.setNodeID = function (n) { at = n }; this.setTreeID = function (n) { vt = n }; this.setAD_Table_ID = function (n) { a = n }; this.showSummary = function (n) { yt = n }; this.setAD_Window_ID = function (n) { n = n }; this.setReportBytes = function (n) { ii = n }; st = 0; this.setIteration = function (n) { st = n }; this.archiveDocument = function (i, r, u) { o(!0); t.ajax({ url: n.Application.contextUrl + "JsonData/ArchiveDoc/", dataType: "json", type: "post", data: { AD_Process_ID: 0, Name: i[0], AD_Table_ID: r, Record_ID: 0, C_BPartner_ID: 0, isReport: !0, binaryData: u }, success: function () { n.ADialog.info("Archived", !0, "", ""); o(!1) } }) }; ur = function () { for (var i, r, u, n = 0; n < arguments.length; n++)i = t('<iframe style="visibility: collapse;"><\/iframe>'), t("body").append(i), r = i[0].contentDocument, u = '<form action="' + arguments[n] + '" method="GET"><\/form>', r.write(u), t("form", r).submit(), setTimeout(function (n) { return function () { n.remove() } }(i), 2e3) }; rt = ""; b = 0; this.getRoot = function () { return g }; this.dispose = function () { }; this.show = function (t, i, r, f, e, o, s) { ir = r; a = f; tt = e; nt = i; lt = o; pi = n.MRole.getDefault().getIsCanExport(a); u != !0 && (pi ? (ct.css("display", "inline-flex"), ht.css("display", "inline-flex"), n.context.ctx["#BULK_REPORT_DOWNLOAD"] == "Y" ? (et.css("display", "inline-flex"), ft.css("display", "inline-flex")) : (et.css("display", "none"), ft.css("display", "none"))) : (ct.css("display", "none"), ht.css("display", "none"), et.css("display", "none"), ft.css("display", "none"))); pt(t); s && li(s) }; ci = function () { if (u) { var n = g.children()[1]; n = null } v.off("click"); y.off("click"); p.off("click"); w.off("click"); e.off("change"); g.empty(); g.remove(); s && s.empty(); d.empty(); d.remove(); l && (l.dispose(), l = null); v = y = p = w = e = null; g = null; d = null; wt = null; bt = null; s = null; kt = null; dt = null; gt = null; ni = null; ti = null }; this.close = function () { ci() }; di = function () { d = t("<div class='vis-report-header' style='padding: 0;'>").append(t('<h3 class="vis-report-tittle">').append(n.Msg.getMsg("Report"))); wt = t('<a href="javascript:void(0)" class="vis-icon-menuclose vis vis-cross">'); bt = t('<div class="vis-report-top-icons">'); s = t('<ul class="vis-reporticonsul">'); bt.append(s); oi = t("<li><a  title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("ReportFormat")) + "'  class='vis vis-format'><\/a><\/li>"); s.append(oi); ct = t("<li><a  title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveCSV")) + "' class='vis vis-save-csv'><\/a><\/li>"); s.append(ct); et = t("<li style='display:none'><a  title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveAllRecordCsv")) + "' class='vis vis-csv-all'><\/a><\/li>"); s.append(et); ht = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SavePdf")) + "' class='vis vis-save-pdf'><\/a><\/li>"); s.append(ht); ft = t("<li style='display:none'><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveAllPagePdf")) + "' class='vis vis-pdf-all'><\/a><\/li>"); s.append(ft); kt = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Archive")) + "' class='vis vis-archive'><\/a><\/li>"); s.append(kt); dt = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Requery")) + "' class='vis vis-refresh'><\/a><\/li>"); s.append(dt); gt = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Search")) + "' class='vis vis-find'><\/a><\/li>"); s.append(gt); ni = t("<li><a title='" + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("PrintCustomize")) + "' class='vis vis-customize'><\/a><\/li>"); s.append(ni); ti = t('<li><a title="' + n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Print")) + '" class="vis vis-print"><\/a><\/li>'); s.append(ti); si = t("<div class='vis-report-top-icons'>"); er(); si.append(hi); d.append(si); d.append(bt); d.append(wt); g.append(d); gi() }; gi = function () { wt.on("click", function () { ci() }); ti.on("click", function () { fr() }); ni.on("click", function () { var t = new n.Query; t.addRestriction("AD_PrintFormat_ID", n.Query.prototype.EQUAL, nt); n.viewManager.startWindow(240, t) }); dt.on("click", function () { k.empty(); k.css("width", "0px"); ut(e.val()) }); ht.on("click", function () { nr(e.val(), 0); null }); ct.on("click", function () { tr(e.val(), 0, null) }); ft.on("click", function () { var r, t; for (b = 0, rt = "", r = new n.BulkDownload(i, "PDF"), r.show(), t = 1; t <= st; t++)nr(t, st, r) }); et.on("click", function () { var r, t; for (b = 0, rt = "", r = new n.BulkDownload(i, "CSV"), r.show(), t = 1; t <= st; t++)tr(t, st, r) }); oi.on("click", function () { var i, r, u; for (ot.empty(), i = 0; i < c.length; i++)c[i].ID && (r = c[i].IsDefault == "Y" ? "vis-favitmchecked" : "vis-favitmunchecked", u = t('<li data-isdefbtn="no" data-id="' + c[i].ID + '"><a data-isdefbtn="no" data-id="' + c[i].ID + '">' + c[i].Name + '<\/a><a data-isdefbtn="yes" data-id="' + c[i].ID + '" style="min-height: 16px;display: inline-block;margin-left: 5px;min-width: 16px;margin-top: 0px" class="vis-menufavitm ' + r + '" > <\/a><\/li>'), ot.append(u)); ot.append(t('<li data-isdefbtn="no" data-id="-1"><a data-id="-1">' + n.Msg.getMsg("NewReport") + "<\/a>")); t(this).w2overlay(yi.clone(!0), { css: { height: "300px" } }) }); ot.on("click", "LI", function (i) { var y = t(i.target), s = y.data("id"), h, u, l, v, p; if (s) { if (y.data("isdefbtn") == "yes") { for (h = "VIS_102", u = [], u[0] = new n.DB.SqlParam("@Ad_Table_ID", a), u[1] = new n.DB.SqlParam("@AD_Tab_ID", r.getAD_Tab_ID()), f(h, u), h = "VIS_103", u = [], u[0] = new n.DB.SqlParam("@id", s), f(h, u), l = 0; l < c.length; l++)c[l].IsDefault = c[l].ID == s ? "Y" : "N"; return } nt = s; k.empty(); k.css("width", "0px"); o(!0); v = !1; s == -1 && (s = a, v = !0); p = it.getGenerateReportPara(tt, lt, v, at, vt, yt, 0, e.val(), "", s, ri); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: p, type: "POST", success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var r = jQuery.parseJSON(t), i = r.repInfo; if (i.ErrorText) { n.ADialog.error(i.ErrorText); o(!1); return } pt(i.HTML); ii = i.Report; li(r.pSetting); nt = i.AD_PrintFormat_ID; o(!1) } }) } }); gt.on("click", function () { var t = new n.Find(i, r, 0); t.onClose = function () { if (t.getIsOKPressed()) { var n = t.getQuery(), i = t.getCurrentDays(), r = t.getIsCreated(); t.dispose(); t = null; tt[1] = n.getWhereClause(!0); ut(1) } }; t.show() }); kt.on("click", function () { it.archiveDocument(tt, a, ii) }) }; var ut = function (i) { o(!0); var r = it.getGenerateReportPara(tt, lt, !1, at, vt, yt, 0, i, "", nt, ri); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: r, type: "POST", success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var r = jQuery.parseJSON(t), i = r.repInfo; if (i.ErrorText) { n.ADialog.error(i.ErrorText); o(!1); return } pt(i.HTML); ii = i.Report; li(r.pSetting); o(!1) } }) }, nr = function (i, r, u) { o(!0); var f = it.getGenerateReportPara(tt, lt, !1, at, vt, yt, 0, i, n.ProcessCtl.prototype.REPORT_TYPE_PDF, nt, ri); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: f, type: "POST", success: function (f) { f == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var s = jQuery.parseJSON(f), e = s.repInfo; if (e.ErrorText) { n.ADialog.error(e.ErrorText); o(!1); return } e.HTML && e.HTML.length > 0 ? pt(e.HTML) : r == 0 ? window.open(n.Application.contextUrl + e.ReportFilePath) : (u.setBulkBusy(!1), t("#forreportdownload").addClass("hide"), rt += '<input type="checkbox" data-num="' + i + '"  data-url="' + n.Application.contextUrl + e.ReportFilePath + '" checked />', b += 1, ui(b / r * 100), b == r && setTimeout(function () { ui(100); ki(n.Msg.getMsg("Generated")); t("<form>", { id: "download_form", html: rt, action: "#", Class: "hide" }).appendTo(document.body).submit() }, 1e3)); o(!1) } }) }, tr = function (i, r, u) { o(!0); var f = it.getGenerateReportPara(tt, lt, !1, at, vt, yt, 0, i, n.ProcessCtl.prototype.REPORT_TYPE_CSV, nt, ri); t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateReport/", dataType: "json", data: f, type: "POST", success: function (f) { f == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var s = jQuery.parseJSON(f), e = s.repInfo; if (e.ErrorText) { n.ADialog.error(e.ErrorText); o(!1); return } e.HTML && e.HTML.length > 0 ? pt(e.HTML) : r == 0 ? window.open(n.Application.contextUrl + e.ReportFilePath) : (u.setBulkBusy(!1), t("#forreportdownload").addClass("hide"), rt += '<input type="checkbox" data-num="' + i + '" data-url="' + n.Application.contextUrl + e.ReportFilePath + '" checked />', b += 1, ui(b / r * 100), b == r && setTimeout(function () { ui(100); ki(n.Msg.getMsg("Generated")); t("<form>", { id: "download_form", html: rt, action: "#", Class: "hide" }).appendTo(document.body).submit() }, 1e3)); o(!1) } }) }, pt = function (i) { var e, s, h, b; if (u != !0) { ot.empty(); var f = null, p = [], l = -1; try { for (t.ajax({ type: "Get", async: !1, url: n.Application.contextUrl + "Form/GetShowReportDetails", data: { AD_Table_ID: a, AD_Tab_ID: r.getAD_Tab_ID() }, success: function (t) { f = (new n.DB.DataReader).toJson(t) } }), c = []; f.read();)l = parseInt(l) + 1, e = f.getString(1), p.indexOf(e) > -1 && (e = e + "_" + (parseInt(l) + 1)), s = {}, s.ID = n.Utility.Util.getValueOfInt(f.get(0)), s.Name = e, s.IsDefault = f.getString(3), p.push(f.getString(1)), c.push(s); f.close() } catch (d) { console.log(d) } f = null; k.html(i); k.css("min-width", ei + "px"); vi = i; var w = document.getElementsByClassName("vis-reptabledetect"), v = 0, y = 0; for (h = 0, b = w.length; h < b; h++)y = t(w[h]).width(), y > v && (v = y); k.css("width", v + 50) } o(!1) }, o = function (n) { ai.css("display", n ? "block" : "none") }; di(); fi = t("<div Style='width:" + ei + "px; max-height: " + (rr - 50) + "px;' class='vis-report-a-r-container'>"); k = t("<div Style='width:" + ei + "px;'>"); fi.append(k); ai = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); o(!0); fi.append(ai); u || g.append(fi); l.hideHeader(!0); l.setContent(it); l.show() } function a(u, f, e, o, s, c) { function v(f) { t.ajax({ url: n.Application.contextUrl + "JsonData/GetReportFileTypes/", dataType: "json", data: { AD_Process_ID: u }, success: function (n) { var e, u, o; if (n != null && (e = jQuery.parseJSON(n), e.length != 0)) { for (u = 0; u < e.length; u++)o = "", o = u == 0 ? t("<li tabindex=" + u + " data-val=" + e[u].Key + " class='vis-selected-li-print'>" + e[u].Name + "<\/li>") : t("<li tabindex=" + u + " data-val=" + e[u].Key + ">" + e[u].Name + "<\/li>"), i.append(o), o = null; f.w2overlay(r.clone(!0), { css: { height: "300px" } }) } } }) } function l(i, r, h) { var c = n.ProcessCtl.prototype.ORIGIN_FORM; a > 0 && (c = n.ProcessCtl.prototype.ORIGIN_WINDOW); s && s.length != 0 ? t.ajax({ url: n.Application.contextUrl + "JsonData/GenerateMultiPrint/", dataType: "json", data: { AD_Process_ID: u, Name: "Print", AD_Table_ID: f, RecIDs: s, WindowNo: o, filetype: h, actionOrigin: c, originName: n.context.getWindowContext(o, "WindowName") }, success: function (t) { t == null && alert(n.Msg.getMsg("ERRORGettingRepData")); var i = jQuery.parseJSON(t); if (r && r(), i.IsError) { n.ADialog.error(i.ErrorText); return } i.ReportFilePath && window.open(n.Application.contextUrl + i.ReportFilePath) } }) : t.ajax({ url: n.Application.contextUrl + "JsonData/GeneratePrint/", dataType: "json", data: { AD_Process_ID: u, Name: "Print", AD_Table_ID: f, Record_ID: e, WindowNo: o, filetype: h, actionOrigin: c, originName: n.context.getWindowContext(o, "WindowName") }, success: function (t) { var i, u, e; if (t == null && alert(n.Msg.getMsg("ERRORGettingRepData")), i = jQuery.parseJSON(t), r && r(), i.IsError) { n.ADialog.error("", "", i.Message, null); return } i.ReportFilePath ? window.open(n.Application.contextUrl + i.ReportFilePath) : i.IsTelerikReport ? window.KJS && (u = new KJS.TelerikContainer(i.AD_PInstance_ID, f), u.show(), this.unlock()) : n.context.getIsUseCrystalReportViewer() && (e = new n.ReportViewerContainer(i), e.show()) } }) } var a = c == null ? 0 : c.getAD_Window_ID(); i.off("click"); i.on("click", "LI", function (n) { var i = t(n.target).data("val"); l(!1, null, i) }); this.start = function (f) { function s() { var i = t(t(t(document).find(".w2ui-overlay").find("li"))[0]), n = i.eq(0); t("#w2ui-overlay-main").attr("tabindex", 1); t("#w2ui-overlay-main").focus(); t("#w2ui-overlay-main").keydown(function (r) { if (r.which === 40) n ? (n.hasClass("vis-selected-li-print") && n.removeClass("vis-selected-li-print"), next = n.next(), n = next.length > 0 ? next.addClass("vis-selected-li-print") : i.eq(0).addClass("vis-selected-li-print")) : n = i.eq(0).addClass("vis-selected-li-print"); else if (r.which === 38) n ? (n.hasClass("vis-selected-li-print") && n.removeClass("vis-selected-li-print"), next = n.prev(), n = next.length > 0 ? next.addClass("vis-selected-li-print") : i.last().addClass("vis-selected-li-print")) : n = i.last().addClass("vis-selected-li-print"); else if (r.which === 13) { if (n) { var u = n.data("val"); l(!1, null, u); t("#w2ui-overlay-main").off("keydown"); t("#w2ui-overlay-main").remove() } } else t("#w2ui-overlay-main").off("keydown"), t("#w2ui-overlay-main").remove(); return r.stopPropagation(), !1 }) } var e = [], o; if (e[0] = new n.DB.SqlParam("@AD_Process_ID", u), o = h("VIS_149", e), o == "Y" && n.context.getIsUseCrystalReportViewer()) { l(!1, null, n.ProcessCtl.prototype.REPORT_TYPE_PDF); return } i.find("LI").length > 0 ? (f.w2overlay(r.clone(!0), { css: { height: "300px" } }), window.setTimeout(function () { s() }, 100)) : (v(f), window.setTimeout(function () { s() }, 100)) }; this.startPdf = function (t) { l(!1, t, n.ProcessCtl.prototype.REPORT_TYPE_PDF) }; this.startCsv = function (t) { l(!0, t, n.ProcessCtl.prototype.REPORT_TYPE_CSV) } } function v(i) { var r = t('<div class="vis-reportrootdiv"> '), u = t('<div class="vis-busyindicatorouterwrap bsyCrsyVwr"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), f; this.getRoot = function () { return r }; this.addReport = function () { r.append(u); f(!0); var e = t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"); i.pi && i.pi.getAD_PInstance_ID() ? e.attr("src", n.Application.contextUrl + "Areas/VIS/WebPages/CrystalReprotViewer.aspx?title=rpt&aid=" + i.pi.getAD_PInstance_ID() + "&pid=" + i.pi.getAD_Process_ID() + "&tid=" + i.pi.getTable_ID() + "&rid=" + i.pi.getRecord_ID()) : e.attr("src", n.Application.contextUrl + "Areas/VIS/WebPages/CrystalReprotViewer.aspx?title=rpt&aid=" + i.AD_PInstance_ID + "&pid=" + i.AD_Process_ID + "&tid=" + i.AD_Table_ID + "&rid=" + i.RecordID); r.append(e) }; this.dispose = function () { r.remove(); r = null }; f = function (n) { u.css("display", n ? "block" : "none") }; this.show = function () { var t = new n.CFrame; t.setName(n.Msg.getMsg("Report")); t.setTitle(n.Msg.getMsg("Report")); t.setContent(this); this.addReport(); t.show() } } var r = t('<div class="vis-reportrootdiv">'), i = t("<ul class='vis-apanel-rb-ul'  style='width:100%;height:100%'>"); r.append(i); var u = n.Application.contextUrl, o = u + "JsonData/JDataSetWithCode", s = u + "JsonData/ExecuteNonQuer", y = function (t, i, r) { var o = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, e(f, o, function (t) { u = (new n.DB.DataReader).toJson(t); r && r(u) }), u }, f = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n, param: i }; return t.ajax({ url: s + "yWithCode", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }, h = function (t, i, r) { var f = r ? !0 : !1, o = { sql: t, page: 1, pageSize: 0 }, u; return i && (o.param = i), u = null, e(o, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; n.ReportViewer = l; n.AReport = c; n.APrint = a; n.ReportViewerContainer = v }(VIS, jQuery), function (n, t) { n.AttachmentHistory = function (i, r, u, f, e) { function ye() { o = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); o[0].style.visibility = "hidden"; kr.append(o) } function pe() { kr = t('<div class="vis-forms-container" style="height:100%">'); d = t('<div class="vis-history-inboxDiv">'); yt = t('<div style="display:none" class="vis-history-mainRelatedDiv">'); gi = t('<div style="display:none" class="vis-history-mainRelatedDiv">'); dr = t('<div class="vis-attachhistory-content-wrap">'); yu = t('<div class="vis-attachhistory-left-wrap">'); gr = t('<div class="vis-attachhistory-table-top">'); nr = t('<div class="vis-attachhistory-search-wrap">'); du = t('<div class="vis-attachhistory-search">').append(' <input placeholder="' + n.Msg.getMsg("Search") + '" type="text">').append('<span class="vis-attachhistory-search-icon vis vis-search"><\/span>'); nr.append('<i class="prthistory vis vis-print" title="' + n.Msg.getMsg("Print") + '"><\/i>').append(du); v = t('<div class="vis-attachhistory-right-wrap">'); k = t('<div class="vis-attachhistory-right-wrap">').hide(); bu == !0 ? k.append('<label class="vis-attachhistory-noRecFoundforIP" > ' + n.Msg.getMsg("NoRecordFound") + " <\/label>") : k.append('<label class="vis-attachhistory-noRecFound" > ' + n.Msg.getMsg("NoRecordFound") + " <\/label>"); pu = t('<div class="vis-attachhistory-apanel-tabcontrol">'); tr = t('<ul class="vis-attachhistory-appsaction-ul vis-attachhistory-apanel-tabcontrol-ul">'); tr.append('<li data-type="History" class="vis-attachhistory-apanel-tab-selected" style="opacity: 1;">' + n.Msg.getMsg("History") + '<\/li><li  data-type="RelatedHistory"  style="opacity: 1;">' + n.Msg.getMsg("RelatedHistory") + "<\/li>"); u > 0 && tr.append('<li  data-type="UserHistory"  style="opacity: 1;">' + n.Msg.getMsg("UserHistory") + "<\/li>"); gr.append(pu.append(tr)); wu = t('<div class="vis-attachhistory-table-wrap">').append(d).append(yt).append(gi).append(ou); kr.append(dr.append(yu.append(gr).append(wu))); dr.append(nr).append(v).append(k); ht = nr.find("input"); ve = du.find(".prthistory"); ni = t('<ul class="vis-his-attachs">'); oi = t('<ul class="vis-his-attachs">'); ku = t("<ul class='vis-apanel-rb-ul'>"); ku.append('<li style="display:none" data-type="R"><a><span class="vis-attachhistory-email-icon vis-attachhistory-reply-icon"><\/span>' + n.Msg.getMsg("Reply") + '<\/a><\/li> <li data-type="F"><a><span class="vis-attachhistory-email-icon vis-attachhistory-forword-icon vis vis-undo2"><\/span>' + n.Msg.getMsg("Forward") + "<\/a><\/li>") } function we() { ou = t('<ul style="margin-top:10px" class="vis-statusbar-ul pull-right">'); et = t('<li style="opacity: 1;"><div><i class="vis vis-shiftleft" style="opacity: 0.6;"><\/i><\/div><\/li>'); ot = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" style="opacity: 0.6;"><\/i><\/div><\/li>'); gt = t('<li><select class="vis-statusbar-combo"><\/select><\/li>'); lt = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" style="opacity: 0.6;"><\/i><\/div><\/li>'); ct = t('<li style="opacity: 1;"><div><i class="vis vis-shiftright" style="opacity: 0.6;"><\/i><\/div><\/li>'); ou.append(et).append(ot).append(gt).append(lt).append(ct) } function re(u) { var e, f; for (o[0].style.visibility = "visible", t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadRecordDataCount", datatype: "json", async: !1, type: "get", cache: !1, data: { searchText: u, _AD_Table_ID: i, _Record_ID: r }, success: function (n) { uf = JSON.parse(n) } }), e = parseInt(uf / li), ui = e + (uf % li > 0 ? 1 : 0), it = 1, s = gt.find("select"), s.empty(), f = 1; f <= ui; f++)s.append("<option>" + f + "<\/option>"); et.css("opacity", "0.6"); ot.css("opacity", "0.6") } function sr(u) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadRecordData", datatype: "json", type: "get", async: !1, cache: !1, data: { searchText: u, _AD_Table_ID: i, _Record_ID: r, historyPageNo: it, pageSize: li }, success: function (n) { n = JSON.parse(n); de(n) }, error: function () { } }) } function hr(i) { (i == undefined || i == null) && (i = ""); t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/RelatedHistory", datatype: "json", type: "get", cache: !1, data: { keyColumnID: r, pageSize: li, pageNo: nt, searchText: n.Utility.encodeText(i), keyColName: e }, success: function (n) { var i = JSON.parse(n), r, t; if (ke(i), fu == undefined || fu == 0 || di == !0) { for (fu = i.TotalRecords, r = parseInt(fu / li), nt = 1, fi = r + (fu % li > 0 ? 1 : 0), s = gt.find("select"), s.empty(), t = 1; t <= fi; t++)s.append("<option>" + t + "<\/option>"); et.css("opacity", "0.6"); ot.css("opacity", "0.6"); no() } else to(); o[0].style.visibility = "hidden"; di = !1 }, error: function (n) { console.log(n); o[0].style.visibility = "hidden"; di = !1 } }) } function cr(i) { (i == undefined || i == null) && (i = ""); t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/UserHistory", datatype: "json", type: "get", cache: !1, data: { C_BPartner_ID: u, pageSize: li, pageNo: tt, searchText: n.Utility.encodeText(i) }, success: function (n) { var i = JSON.parse(n), r, t; if (i.RHistory != null && be(i), eu == undefined || eu == 0 || di == !0) { for (eu = i.TotalRecords, r = parseInt(eu / li), tt = 1, ei = r + (eu % li > 0 ? 1 : 0), s = gt.find("select"), s.empty(), t = 1; t <= ei; t++)s.append("<option>" + t + "<\/option>"); et.css("opacity", "0.6"); ot.css("opacity", "0.6"); ge() } else io(); o[0].style.visibility = "hidden"; di = !1 }, error: function (n) { console.log(n); o[0].style.visibility = "hidden"; di = !1 } }) } function be(i) { var u, f, e, r; for (bt = [], vi = [], u = i.RHistory, bt.push({ field: "ID", caption: n.Msg.getMsg("id"), size: "150px", hidden: !0 }), bt.push({ field: "Record_ID", caption: n.Msg.getMsg("record_id"), size: "150px", hidden: !0 }), bt.push({ field: "Created", caption: n.Msg.getMsg("Date"), size: "150px", hidden: !1 }), bt.push({ field: "Type", caption: n.Msg.getMsg("Type"), size: "150px", hidden: !1 }), n.Application.isRTL ? bt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: right", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.AD_Table_ID + '" ><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }) : bt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: left", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.AD_Table_ID + '" ><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }), bt.push({ field: "Subject", caption: n.Msg.getMsg("Subject"), size: "150px", hidden: !1 }), bt.push({ field: "UserName", caption: n.Msg.getMsg("UserName"), size: "150px", hidden: !1 }), u.length > 0 && (y = Object.keys(u[0])), r = 0; r < y.length; r++)if (y[r] == "ID" || y[r] == "Record_ID" || y[r] == "Created" || y[r] == "Type" || y[r] == "TableName" || y[r] == "Subject" || y[r] == "UserName") continue; else bt.push({ field: y[r], caption: n.Msg.getMsg(y[r]), size: "100px", hidden: !0 }); for (f = 0; f < u.length; f++) { for (e = {}, e.recid = f, r = 0; r < y.length; r++)y[r] == "Created" ? e[y[r]] = new Date(u[f][y[r]]).toLocaleString() : y[r] == "Type" ? u[f][y[r]] == "A" ? e[y[r]] = n.Msg.getMsg("Appointment") : u[f][y[r]] == "T" ? e[y[r]] = n.Msg.getMsg("Task") : u[f][y[r]] == "L" ? e[y[r]] = n.Msg.getMsg("Letter") : u[f][y[r]] == "M" ? e[y[r]] = n.Msg.getMsg("SentMail") : (u[f][y[r]] == "Z" || u[f][y[r]] == "I") && (e[y[r]] = n.Msg.getMsg("InboxMail")) : e[y[r]] = n.Utility.encodeText(u[f][y[r]]); vi.push(e) } } function ke(i) { var u, f, e, r; for (dt = [], ai = [], u = i.RHistory, dt.push({ field: "ID", caption: n.Msg.getMsg("id"), size: "150px", hidden: !0 }), dt.push({ field: "Record_ID", caption: n.Msg.getMsg("record_id"), size: "150px", hidden: !0 }), dt.push({ field: "Created", caption: n.Msg.getMsg("Date"), size: "150px", hidden: !1 }), dt.push({ field: "Type", caption: n.Msg.getMsg("Type"), size: "150px", hidden: !1 }), n.Application.isRTL ? dt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: right", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.AD_Table_ID + '"><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }) : dt.push({ field: "TableName", caption: n.Msg.getMsg("Table"), size: "150px", hidden: !1, resizable: !0, style: "text-align: left", render: function (n) { var i = t('<i class="findImg vis vis-find" data-ids="' + n.Record_ID + "-" + n.AD_Table_ID + '"><\/i>'), r = t("<div >").append(i).append(n.TableName); return r.html() } }), dt.push({ field: "Subject", caption: n.Msg.getMsg("Subject"), size: "150px", hidden: !1 }), u.length > 0 && (h = Object.keys(u[0])), r = 0; r < h.length; r++)if (h[r] == "ID" || h[r] == "Record_ID" || h[r] == "Created" || h[r] == "Type" || h[r] == "TableName" || h[r] == "Subject") continue; else dt.push({ field: h[r], caption: n.Msg.getMsg(h[r]), size: "100px", hidden: !0 }); for (f = 0; f < u.length; f++) { for (e = {}, e.recid = f, r = 0; r < h.length; r++)h[r] == "Created" ? e[h[r]] = new Date(u[f][h[r]]).toLocaleString() : h[r] == "Type" ? u[f][h[r]] == "A" ? e[h[r]] = n.Msg.getMsg("Appointment") : u[f][h[r]] == "T" ? e[h[r]] = n.Msg.getMsg("Task") : u[f][h[r]] == "L" ? e[h[r]] = n.Msg.getMsg("Letter") : u[f][h[r]] == "M" ? e[h[r]] = n.Msg.getMsg("SentMail") : u[f][h[r]] == "I" && (e[h[r]] = n.Msg.getMsg("InboxMail")) : e[h[r]] = n.Utility.encodeText(u[f][h[r]]); ai.push(e) } } function de(t) { var i, u, r, f; for (wt = [], si = [], wt.push({ field: "id", caption: n.Msg.getMsg("id"), size: "150px", hidden: !0 }), wt.push({ field: "record_id", caption: n.Msg.getMsg("record_id"), size: "150px", hidden: !0 }), wt.push({ field: "created", caption: n.Msg.getMsg("Date"), size: "150px", hidden: !1 }), wt.push({ field: "type", caption: n.Msg.getMsg("Type"), size: "150px", hidden: !1 }), wt.push({ field: "name", caption: n.Msg.getMsg("CreatedBy"), size: "150px", hidden: !1 }), bu == !0 ? wt.push({ field: "subject", caption: n.Msg.getMsg("Subject"), size: "150px", hidden: !1 }) : wt.push({ field: "subject", caption: n.Msg.getMsg("Subject"), size: "230px", hidden: !1 }), t.length > 0 && (h = Object.keys(t[0])), i = 0; i < t.length; i++) { for (u = {}, u.recid = i, r = 0; r < h.length; r++)f = h[r], u[f] = h[r] == "created" ? new Date(t[i][f]).toLocaleString() : n.Utility.encodeText(t[i][f]); si.push(u) } } function ge() { b != undefined && b != null && (b.destroy(), b = null); b = gi.w2grid({ name: "userhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: bt, records: vi }); b.on("select", br); b.on("search", wr); vi.length > 0 ? (b.select(0), k.hide(), v.show()) : (k.show(), v.hide()); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function no() { p != undefined && p != null && (p.destroy(), p = null); p = yt.w2grid({ name: "realtedhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: dt, records: ai }); p.on("select", br); p.on("search", wr); ai.length > 0 ? (p.select(0), k.hide(), v.show()) : (k.show(), v.hide()); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function yr() { ut.destroy(); ut = null; ut = d.w2grid({ name: "historyinboxgrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: wt, records: si }); ut.on("select", br); ut.on("search", wr); si.length > 0 ? (ut.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; o[0].style.visibility = "hidden" } function to() { p.destroy(); p = null; p = yt.w2grid({ name: "realtedhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: dt, records: ai }); p.on("select", br); p.on("search", wr); ai.length > 0 ? (p.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; t(".findImg").off("click"); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function io() { b.destroy(); b = null; b = gi.w2grid({ name: "userhistorygrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: bt, records: vi }); b.on("select", br); b.on("search", wr); vi.length > 0 ? (b.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; t(".findImg").off("click"); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }) } function ro() { tr.on("click", lo); nr.find("input").on("keydown", fe); nr.find("i").on("click", fo); ni.on("click", po); oi.on("click", wo); v.on("keydown", ce); v.on("click", ce); lt.on("click", eo); ot.on("click", oo); gt.on("change", so); et.on("click", ho); ct.on("click", co); ku.on(n.Events.onTouchStartOrClick, "LI", function (n) { var i = t(this).data("type"); uo(i, n) }) } function uo(t) { var f = null, u; t == "R" || t == "F" && (f = new n.Email("", null, null, r, !0, !0, i, hi.html(), ar.text(), pf)); u = new n.CFrame; u.setName(n.Msg.getMsg("EMail")); u.setTitle(n.Msg.getMsg("EMail")); u.hideHeader(!0); u.setContent(f); u.show(); f.initializeComponent(); kt.close() } function fo() { g != undefined && g.is(":visible") == !0 ? (t(".vis-attachhistory-right-row > ul > li").css("float", "left"), t(".vis-attachhistory-right-row > ul").css("height", "auto"), ue(g.html()), t(".vis-attachhistory-right-row > ul > li").css("float", "none"), t(".vis-attachhistory-right-row > ul").css("height", "45px")) : l != undefined && l.is(":visible") == !0 && (t(".vis-attachhistory-right-row > ul > li").css("float", "left"), t(".vis-attachhistory-right-row > ul").css("height", "auto"), t(t(".vis-attachhistory-to").find("p")).text(t(t(".vis-attachhistory-to").find("p")).text().replace(/;/g, "; ")), t(t(".vis-attachhistory-bcc").find("p")).text(t(t(".vis-attachhistory-bcc").find("p")).text().replace(/;/g, "; ")), t(t(".vis-attachhistory-cc").find("p")).text(t(t(".vis-attachhistory-cc").find("p")).text().replace(/;/g, "; ")), ue(l.html()), t(".vis-attachhistory-right-row > ul > li").css("float", "none"), t(".vis-attachhistory-right-row > ul").css("height", "45px"), t(t(".vis-attachhistory-to").find("p")).text(t(t(".vis-attachhistory-to").find("p")).text().replace(/; /g, ";")), t(t(".vis-attachhistory-bcc").find("p")).text(t(t(".vis-attachhistory-bcc").find("p")).text().replace(/; /g, ";")), t(t(".vis-attachhistory-cc").find("p")).text(t(t(".vis-attachhistory-cc").find("p")).text().replace(/; /g, ";"))) } function ue(t) { var i = window.open(), r = '<link rel="stylesheet" href="' + n.Application.contextUrl + 'Areas/VIS/Content/VIS.all.min.css" />'; i.document.write(r + t); setTimeout(function () { i.print(); i.close() }, 300) } function fe(n) { (n.keyCode == undefined || n.keyCode == 13) && ht != undefined && ht != null && (di = !0, d.is(":visible") ? (o[0].style.visibility = "visible", re(ht.val()), sr(ht.val()), ne = ht.val(), yr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", hr(ht.val()), te = ht.val()) : (o[0].style.visibility = "visible", cr(ht.val()), ie = ht.val())) } function eo() { d.is(":visible") ? (it < ui && (o[0].style.visibility = "visible", it++, s.val(it), sr(), yr()), pr()) : yt.is(":visible") ? nt < fi && (o[0].style.visibility = "visible", nt++, s.val(nt), hr(), lu()) : tt < ei && (o[0].style.visibility = "visible", tt++, s.val(tt), cr(), au()) } function oo() { d.is(":visible") ? (it > 1 && (o[0].style.visibility = "visible", it--, s.val(it), sr(), yr()), pr()) : yt.is(":visible") ? (nt > 1 && (o[0].style.visibility = "visible", nt--, s.val(nt), hr()), lu()) : (tt > 1 && (o[0].style.visibility = "visible", tt--, s.val(tt), cr()), au()) } function so() { d.is(":visible") ? (o[0].style.visibility = "visible", it = s.val(), sr(), yr(), pr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", nt = s.val(), hr(), lu()) : (o[0].style.visibility = "visible", tt = s.val(), cr(), au()) } function ho() { d.is(":visible") ? (o[0].style.visibility = "visible", it = 1, s.val(it), sr(), yr(), pr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", nt = 1, s.val(nt), hr(), lu()) : (o[0].style.visibility = "visible", tt = 1, s.val(tt), cr(), au()) } function co() { d.is(":visible") ? (o[0].style.visibility = "visible", it = ui, s.val(it), sr(), yr(), pr()) : yt.is(":visible") ? (o[0].style.visibility = "visible", nt = fi, s.val(nt), hr(), lu()) : (o[0].style.visibility = "visible", tt = ei, s.val(tt), cr(), au()) } function pr() { it == 1 && it < ui ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "1"), ct.css("opacity", "1")) : it > 1 && it < ui ? (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "1"), ct.css("opacity", "1")) : it == ui && ui == 1 ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) : it == ui && (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) } function lu() { nt == 1 && nt < fi ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "1"), ct.css("opacity", "1")) : nt > 1 && nt < fi ? (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "1"), ct.css("opacity", "1")) : nt == fi && fi == 1 ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) : nt == fi && (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) } function au() { tt == 1 && tt < ei ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "1"), ct.css("opacity", "1")) : tt > 1 && tt < ei ? (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "1"), ct.css("opacity", "1")) : tt == ei && ei == 1 ? (et.css("opacity", "0.6"), ot.css("opacity", "0.6"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) : tt == ei && (et.css("opacity", "1"), ot.css("opacity", "1"), lt.css("opacity", "0.6"), ct.css("opacity", "0.6")) } function lo(i) { var f = t(i.target).data("type"), r; if (f == "History") { for ((ht != "undefined" || ht != null) && ht.val(ne), s = gt.find("select"), s.empty(), r = 1; r <= ui; r++)s.append("<option>" + r + "<\/option>"); pr(); d.show(); gi.hide(); yt.hide(); s.val(it); si.length > 0 ? (ut.select(0), ut.refresh(), k.hide(), v.show()) : (k.show(), v.hide()) } else if (f == "RelatedHistory") { for ((ht != "undefined" || ht != null) && ht.val(te), s = gt.find("select"), s.empty(), r = 1; r <= fi; r++)s.append("<option>" + r + "<\/option>"); p == undefined || p == null ? (o[0].style.visibility = "visible", hr(), s.val(nt)) : (v.find("*").show(), ai.length > 0 && (p.select(0), p.refresh(), s.val(nt))); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }); ai.length > 0 ? (p.select(0), k.hide(), v.show()) : (k.show(), v.hide()); d.hide(); gi.hide(); yt.show() } else if (f == "UserHistory") { if ((ht != "undefined" || ht != null) && ht.val(ie), u == null || u == 0) { n.ADialog.info("BPartnerNotFound"); return } for (s = gt.find("select"), s.empty(), r = 1; r <= ei; r++)s.append("<option>" + r + "<\/option>"); b == undefined || b == null ? (o[0].style.visibility = "visible", cr(), s.val(tt)) : (v.find("*").show(), vi.length > 0 && (b.select(0), b.refresh(), s.val(tt))); t(".findImg").on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[1], r[0]) }); vi.length > 0 ? (b.select(0), k.hide(), v.show()) : (k.show(), v.hide()); d.hide(); yt.hide(); gi.show() } t(i.target).addClass("vis-attachhistory-apanel-tab-selected"); t(i.target).siblings("li").removeClass("vis-attachhistory-apanel-tab-selected") } function wr(n) { n.onComplete = function () { d.is(":visible") ? ut.last.searchIds.length > 0 && ut.select(ut.last.searchIds[0]) : p.last.searchIds.length > 0 && p.select(p.last.searchIds[0]) } } function br(i) { var r; if (o[0].style.visibility = "visible", r = i.target == "historyinboxgrid" ? ut.get(i.recid) : i.target == "realtedhistorygrid" ? p.get(i.recid) : b.get(i.recid), t(".vis-attachhistory-view-comments").text(n.Msg.getMsg("ViewMoreComments")), r.type == n.Msg.getMsg("Appointment") || r.Type == "Appointment" || r.type == n.Msg.getMsg("Task") || r.Type == "Task" ? g != undefined && g.is(":visible") == !1 && (t(st[0].children[0]).hide(), g.show()) : r.type == n.Msg.getMsg("VA048_CallType") || r.Type == "Call" ? rt != undefined && rt.is(":visible") == !1 && (t(at[0].children[0]).hide(), rt.show()) : l != undefined && l.is(":visible") == !1 && (t(ft[0].children[0]).hide(), l.show()), r.type != undefined) switch (r.type) { case n.Msg.getMsg("Appointment"): lr(r.id); window.setTimeout(function () { w = r.id; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Task"): lr(r.id); window.setTimeout(function () { w = r.id; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("SentMail"): ee(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("InboxMail"): oe(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Letter"): se(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("VA048_CallType"): he(r.id); window.setTimeout(function () { w = r.id; c = !1; a = !0; pt(w, c, a) }, 200) } else switch (r.Type) { case n.Msg.getMsg("Appointment"): lr(r.ID); window.setTimeout(function () { w = r.ID; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Task"): lr(r.ID); window.setTimeout(function () { w = r.ID; c = !0; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("SentMail"): ee(r.ID); window.setTimeout(function () { lr(r.ID); w = r.ID; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("InboxMail"): oe(r.ID); window.setTimeout(function () { lr(r.ID); w = r.ID; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("Letter"): se(r.ID); window.setTimeout(function () { lr(r.ID); w = r.ID; c = !1; a = !1; pt(w, c, a) }, 200); break; case n.Msg.getMsg("VA048_CallType"): he(r.ID); window.setTimeout(function () { w = r.ID; c = !1; a = !0; pt(w, c, a) }, 200) } } function lr(t) { var r = "SELECT AI.AppointmentsInfo_ID, AI.Subject,AI.Location,AI.Description,AI.AD_Table_ID, AI.Record_ID,  (  CASE Label    WHEN 1     THEN  '" + n.Msg.getMsg("Important", !0) + "'    WHEN 2    THEN '" + n.Msg.getMsg("Business", !0) + "'    WHEN 3    THEN   '" + n.Msg.getMsg("Personal", !0) + "'    WHEN 4    THEN '" + n.Msg.getMsg("Vacation", !0) + "'    WHEN 5    THEN '" + n.Msg.getMsg("MustAttend", !0) + "'    WHEN 6    THEN '" + n.Msg.getMsg("TravelRequired", !0) + "'    WHEN 7    THEN '" + n.Msg.getMsg("NeedsPreparation", !0) + "'    WHEN 8    THEN '" + n.Msg.getMsg("BirthDay", !0) + "'    WHEN 9    THEN '" + n.Msg.getMsg("Anniversary", !0) + "'    WHEN 10    Then '" + n.Msg.getMsg("PhoneCall", !0) + "'    ELSE '" + n.Msg.getMsg("None", !0) + "'  END ) AS label ,  AI.StartDate , AI.EndDate,  (  CASE AI.AllDay    WHEN 'Y'        THEN '" + n.Msg.getMsg("Yes", !0) + "'        ELSE '" + n.Msg.getMsg("No", !0) + "'  END) AS Allday ,  (  CASE AI.Status    WHEN 1    THEN '" + n.Msg.getMsg("Tentative", !0) + "'     WHEN 2    THEN '" + n.Msg.getMsg("Busy", !0) + "'    WHEN 3    THEN '" + n.Msg.getMsg("OutOfOffice", !0) + "'    Else     '" + n.Msg.getMsg("Free", !0) + "'     End) as Status,      AI.ReminderInfo , nvl( ai.attendeeinfo,ai.Ad_User_ID) as attendeeinfo,  AI.RecurrenceInfo ,      (       CASE AI.IsPrivate        WHEN 'Y'        THEN '" + n.Msg.getMsg("Yes") + "'        ELSE '" + n.Msg.getMsg("No") + "'      END) AS IsPrivate,AI.comments ,ac.Name as caname   FROM AppointmentsInfo ai LEFT OUTER JOIN appointmentcategory AC  ON AI.appointmentcategory_id=ac.appointmentcategory_id WHERE AI.AppointmentsInfo_ID=" + t, s = n.secureEngine.encrypt(r), i = n.dataContext.getJSONData(n.Application.contextUrl + "AttachmentHistory/GetAppointmentData", { AppQry: s }, null), e, u, f; if (i != null) { if (e = 0, e = d.is(":visible") ? 0 : i.AD_Table_ID + "-" + i.Record_ID, r = "", u = i.AttendeeInfo, u != null && u != "" && (names = n.dataContext.getJSONData(n.Application.contextUrl + "AttachmentHistory/GetUser", { UserQry: u }, null), names != null && names.length > 0)) { for (r = "", f = 0; f < names.length; f++)r += names[f] + ", "; r = r.substring(0, r.length - 2) } yo(t, i.Location, i.Description, i.label, i.StartDate, i.EndDate, i.Allday, "", i.comments, e, i.Subject, i.caname, "", i.AppointmentsInfo_ID, r) } else o[0].style.visibility = "hidden" } function ee(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadSentMails", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (n) { var t = JSON.parse(n), r = 0; r = d.is(":visible") ? 0 : t.AD_Table_ID + "-" + t.Record_ID; wf(i, t.Title, t.To, t.From, t.Date, t.Detail, t.Bcc, t.Cc, t.Comments, t.IsMail, t.IsLetter, t.Attach, r, t.ID) } }) } function oe(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadInboxMails", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (n) { var t = JSON.parse(n), r = 0; r = d.is(":visible") ? 0 : t.AD_Table_ID + "-" + t.Record_ID; wf(i, t.Title, t.To, t.From, t.Date, t.Detail, t.Bcc, t.Cc, t.Comments, t.IsMail, t.IsLetter, t.Attach, r, t.ID) } }) } function se(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadLetters", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (n) { var t = JSON.parse(n), r = 0; r = d.is(":visible") ? 0 : t.AD_Table_ID + "-" + t.Record_ID; wf(i, t.Title, "", "", t.Date, t.Detail, "", "", t.Comments, !1, !0, t.Attach, r, t.ID) } }) } function he(i) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/LoadCall", datatype: "json", type: "get", cache: !1, data: { ID: i }, success: function (t) { var r = JSON.parse(t), u = 0; u = d.is(":visible") ? 0 : r.AD_Table_ID + "-" + r.Record_ID; ao(i, r.VA048_IsConference, r.VA048_From, r.VA048_To, r.VA048_Duration, r.VA048_Price, r.VA048_Price_Unit, r.VA048_Status, r.VA048_CallNotes, r.Created, r.AD_Table_ID, r.Record_ID, u, n.Msg.getMsg("VA048_CallType"), "", r.VA048_FullName, r.Attach) } }) } function ao(i, r, u, f, e, s, h, c, l, a, y, p, w, b, k, d, g) { var e, tt, it, ut, et, ot, nt; if (ft != undefined && ft.hide(), st != undefined && st.hide(), e = e >= 60 ? vo(e) : e + " " + n.Msg.getMsg("VA048_Seconds"), ki == undefined || ki == null || ki == "") { if (ki = t("<p>" + n.Utility.encodeText(u) + "<\/p>"), ti = t("<p>" + n.Utility.encodeText(f) + "<\/p>"), ff = t("<p>" + n.Utility.encodeText(e) + "<\/p>"), ef = t("<p>" + n.Utility.encodeText(c) + "<\/p>"), of = t("<p>" + n.Utility.encodeText(s) + "<\/p>"), sf = t("<p>" + n.Utility.encodeText(h) + "<\/p>"), hf = t(" <p>" + n.Utility.encodeText(new Date(a).toLocaleString()) + "<\/p>"), or = t("<p>" + n.Utility.encodeText(b) + "<\/p>"), cf = t('<p style="max-height:120px;overflow-y: scroll;">' + n.Utility.encodeText(l) + "<\/p>"), af = t("<p>" + n.Utility.encodeText(d) + "<\/p>"), lf = t("<p>" + (r == "Y" ? n.Msg.getMsg("VA048_Conference") : n.Msg.getMsg("VA048_CallType")) + "<\/p>"), vt = t('<i class=" vis vis-find" data-ids="' + w + '">'), w == 0 ? vt.hide() : vt.show(), at = t('<div class="vis-attachhistory-right-content">'), rt = t('<div class="vis-attachhistory-grid-data" >'), tt = t('<div style="float:left;width:100%;margin-bottom:10px"><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("Title") + ' <i class="fa fa-phone"><\/i><\/h6>').append(vt)).append(lf)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("User") + "<\/h6> ").append(af)), rt.append(tt), it = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("VA048_From") + "<\/h6>")).append(ki)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("VA048_To") + "<\/h6> ").append(ti)), rt.append(it), ut = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2"> ').append("<h6>" + n.Msg.getMsg("VA048_Duration") + "<\/h6> ").append(ff)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("VA048_Status") + "<\/h6>").append(ef)), rt.append(ut), et = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append("<h6>" + n.Msg.getMsg("VA048_Price") + "<\/h6>").append(of)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("VA048_PriceUnit") + "<\/h6> ").append(sf)), rt.append(et), ot = t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append("<h6>" + n.Msg.getMsg("Created") + "<\/h6>").append(hf)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>" + n.Msg.getMsg("Category") + "<\/h6> ").append(or)), rt.append(ot), rt.append(t('<div class="vis-attachhistory-right-row" style="margin-bottom:20px;margin-right: 4px;">').append("<h6>" + n.Msg.getMsg("VA048_Notes") + "<\/h6> ").append(cf)), rt.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Attachments") + "<\/h6>")), g != undefined && g.length > 0) for (nt = 0; nt < g.length; nt++)oi.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a data-attid="' + g[nt].AttID + '" data-id="' + g[nt].ID + '">' + n.Utility.encodeText(g[nt].Name) + "<\/a><\/li>"); else rt.find(".vis-attachhistory-right-row").last().hide(); rt.find(".vis-attachhistory-right-row").last().append(oi); (bi == undefined || bi == null) && (bi = t('<input type="text" placeholder="' + n.Msg.getMsg("TypeComment") + '"><\/input>')); yf = t('<div class="vis-attachhistory-bottom"><\/div>'); vf = t('<div class="vis-attachhistory-comments vis-feedMessage"><\/div>'); vf.append(bi).append('<span class="vis-attachhistory-comment-icon vis vis-sms"><\/span>'); yf.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(vf).append('<p class="vis-attachhistory-view-comments">' + n.Msg.getMsg("ViewMoreComments") + "<\/p>")); at.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(rt).append(yf); cu = t('<div class="vis-attachhistory-right-row" >'); rt.append(cu); v.append(at); vt.on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[0], r[1]) }) } else { if (at.show(), ki.text(n.Utility.encodeText(u)), ti.text(n.Utility.encodeText(f)), ff.text(n.Utility.encodeText(e)), ef.text(n.Utility.encodeText(c)), of.text(n.Utility.encodeText(s)), sf.text(n.Utility.encodeText(h)), hf.text(n.Utility.encodeText(new Date(a).toLocaleString())), or.text(n.Utility.encodeText(b)), cf.text(n.Utility.encodeText(l)), af.text(n.Utility.encodeText(d)), lf.text(n.Utility.encodeText(r == "Y" ? n.Msg.getMsg("VA048_Conference") : n.Msg.getMsg("VA048_CallType"))), g != undefined && g.length > 0) { for (oi.empty(), nt = 0; nt < g.length; nt++)oi.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a data-attid="' + g[nt].AttID + '" data-id="' + g[nt].ID + '">' + n.Utility.encodeText(g[nt].Name) + "<\/a><\/li>"); t(oi.parent()).show() } else t(oi.parent()).hide(); vt.data("ids", w); w == 0 ? vt.hide() : vt.show(); t(at[0].children[0]).hide() } t(".vis-attachhistory-view-comments").off("click"); t(".vis-attachhistory-view-comments").on("click", function () { bf(i, !1, !0, this) }); k != undefined ? bi.val(n.Utility.encodeText(k)) : bi.val(""); t(".vis-attachhistory-comment-icon").data("ID", i); o[0].style.visibility = "hidden" } function vo(t) { var f = ~~(t / 3600), r = ~~(t % 3600 / 60), u = t % 60, i = ""; return f > 0 && (i += "" + hrs + ":" + (r < 10 ? "0" : "")), i += "" + r + ":" + (u < 10 ? "0" : ""), i += "" + u, i + " " + n.Msg.getMsg("VA048_Minutes") } function wf(i, r, u, f, e, s, h, y, p, w, b, k, d, g) { var nt; if (st != undefined && st.hide(), at != undefined && at.hide(), c = !1, a = !1, rr == undefined || rr == null) { if (ar = t("<p>" + n.Utility.encodeText(r) + "<\/p>"), ti = t("<p>" + n.Utility.encodeText(u) + "<\/p>"), ur = t("<p>" + n.Utility.encodeText(h) + "<\/p>"), fr = t("<p>" + n.Utility.encodeText(y) + "<\/p>"), ir = t(" <p>" + n.Utility.encodeText(f) + "<\/p>"), rr = t("<p>" + n.Utility.encodeText(e) + "<\/p>"), ci = t('<a class="vis-attachhistory-email-dropdown fa fa-ellipsis-v" tabindex=""><\/a>'), (hi == undefined || hi == null) && (hi = t('<p class="vis-attachhistory-detail"><\/p>')), hi.html(s), (ii == undefined || ii == null) && (ii = t('<input type="text" placeholder="' + n.Msg.getMsg("TypeComment") + '"><\/input>')), yi = t('<i class="vis vis-email"><\/i>'), pi = t('<i class="vis vis-find pull-right" data-ids="' + d + '" ><\/i>'), ft = t('<div class="vis-attachhistory-right-content">'), l = t('<div class="vis-attachhistory-grid-data">'), l.append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("Title") + "<\/h6>").append(yi)).append(ar)), l.append(t('<div class="vis-attachhistory-right-row3"><\/div>').append(ci).append(pi)), b == !0 && l.find(".vis-attachhistory-right-row").last().hide(), b == !0 && l.append(t('<div class="vis-attachhistory-right-row3">').append(rr)), d == 0 ? pi.hide() : pi.show(), w == !0 ? yi.removeClass("vis vis-letter").addClass("vis vis-email") : b == !0 && yi.removeClass("vis vis-email").addClass("vis vis-letter"), l.append(t('<div class="vis-attachhistory-right-row vis-attachhistory-to">').append("<h6>" + n.Msg.getMsg("To") + "<\/h6> ").append(ti)), (u == "undefined" || u == null || u == "" || b == !0) && l.find(".vis-attachhistory-right-row").last().hide(), l.append(t('<div value="bccDiv" class="vis-attachhistory-right-row  vis-attachhistory-bcc">').append("<h6>" + n.Msg.getMsg("Bcc") + "<\/h6> ").append(ur)), (h == "undefined" || h == null || h == "" || b == !0) && l.find(".vis-attachhistory-right-row").last().hide(), l.append(t('<div  value="ccDiv"  class="vis-attachhistory-right-row vis-attachhistory-cc">').append("<h6>" + n.Msg.getMsg("Cc") + "<\/h6> ").append(fr)), (y == "undefined" || y == null || y == "" || b == !0) && l.find(".vis-attachhistory-right-row").last().hide(), l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("From") + "<\/h6>").append(ir)), l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Attachments") + "<\/h6>")), k != undefined && k.length > 0) for (nt = 0; nt < k.length; nt++)ni.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a data-IDs="' + k[nt].ID + '">' + n.Utility.encodeText(k[nt].Name) + "<\/a><\/li>"); else l.find(".vis-attachhistory-right-row").last().hide(); l.find(".vis-attachhistory-right-row").last().append(ni); su = t('<div class="vis-attachhistory-right-row">'); l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Details") + "<\/h6>").append(hi)).append(su); nu = t('<div class="vis-attachhistory-bottom"><\/div>'); gu = t('<div class="vis-attachhistory-comments vis-feedMessage"><\/div>'); gu.append(ii).append('<span class="vis-attachhistory-comment-icon vis vis-sms"><\/span>'); nu.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(gu).append('<p class="vis-attachhistory-view-comments" style="float:right;width:auto">' + n.Msg.getMsg("ViewMoreComments") + "<\/p>")); ft.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(l).append(nu); nr.parent() != undefined ? v.append(ft) : v.append(ft); pi.on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[0], r[1]) }) } else { if (ft.show(), t(ft[0].children[0]).hide(), (ci == undefined || ci == null) && (ci = t('<a class="vis-attachhistory-email-dropdown fa fa-ellipsis-v" tabindex=""><\/a>')), w == !0 ? (yi.removeClass("vis vis-letter").addClass("vis vis-email"), ci.show()) : b == !0 && (yi.removeClass("vis vis-email").addClass("vis vis-letter"), ci.hide()), ar.text(n.Utility.encodeText(r)), u == "undefined" || u == null && u == "" || b == !0 ? t(ti.parent()).hide() : (ti.text(n.Utility.encodeText(u)), t(ti.parent()).show()), h == "undefined" || h == null || h == "" || b == !0 ? t(ur.parent()).hide() : (ur.text(n.Utility.encodeText(h)), t(ur.parent()).show()), y == "undefined" || y == null || y == "" || b == !0 ? t(fr.parent()).hide() : (fr.text(n.Utility.encodeText(y)), t(fr.parent()).show()), b == !0 ? t(ir.parent()).hide() : (ir.text(n.Utility.encodeText(f)), t(ir.parent()).show()), pi.data("ids", d), d == 0 ? pi.hide() : pi.show(), rr.text(n.Utility.encodeText(e)), k != undefined && k.length > 0) { for (ni.empty(), nt = 0; nt < k.length; nt++)ni.append('<li><span class="vis-attachhistory-attach-download"><i class="fa fa-long-arrow-down"><\/i><\/span><a  data-IDs="' + k[nt].ID + '">' + n.Utility.encodeText(k[nt].Name) + "<\/a><\/li>"); t(ni.parent()).show() } else t(ni.parent()).hide(); hi.html(s) } t(".vis-attachhistory-view-comments").off("click"); t(".vis-attachhistory-view-comments").on("click", function () { bf(g, !1, !1, this) }); if (w) { pf = g; ci.show(); t(".vis-attachhistory-email-dropdown").off("click"); t(".vis-attachhistory-email-dropdown").on("click", function () { t(this).w2overlay(ku.clone(!0), { css: { height: "300px" } }) }) } else ci.hide(); t(".vis-attachhistory-comment-icon").data("ID", i); p != undefined ? ii.val(n.Utility.encodeText(p)) : ii.val(""); o[0].style.visibility = "hidden" } function yo(i, r, u, f, e, s, h, l, y, p, w, b, k, d, nt) { var tt, it, rt; if (ft != undefined && ft.hide(), at != undefined && at.hide(), c = !0, a = !1, wi == undefined || wi == null) { ru = t("<p>" + n.Utility.encodeText(r) + "<\/p>"); iu = t("<p>" + n.Utility.encodeText(w) + "<\/p>"); er = t("<p>" + n.Utility.encodeText(u) + "<\/p>"); or = t("<p>" + n.Utility.encodeText(b) + "<\/p>"); tf = t("<p>" + n.Utility.encodeText(nt) + "<\/p>"); rf = t("<p>" + n.Utility.encodeText(f) + "<\/p>"); wi = e.indexOf("Z") > 0 ? t("<p>" + n.Utility.encodeText(new Date(e).toLocaleString()) + "<\/p>") : t("<p>" + n.Utility.encodeText(new Date(e + "Z").toLocaleString()) + "<\/p>"); vr = s.indexOf("Z") > 0 ? t(" <p>" + n.Utility.encodeText(new Date(s).toLocaleString()) + "<\/p>") : t(" <p>" + n.Utility.encodeText(new Date(s + "Z").toLocaleString()) + "<\/p>"); uu = t("<p>" + n.Utility.encodeText(h) + "<\/p>"); (ri == undefined || ri == null) && (ri = t('<input type="text" placeholder="' + n.Msg.getMsg("TypeComment") + '"><\/input>')); vt = t('<i class=" vis vis-find" data-ids="' + p + '" >'); st = t('<div class="vis-attachhistory-right-content">'); g = t('<div class="vis-attachhistory-grid-data" >'); tt = t('<div style="float:left;width:100%" ><\/div>'); tt.append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>" + n.Msg.getMsg("Title") + ' <i class="vis vis-appointment"><\/i><\/h6>').append(vt)).append(iu)); p == 0 ? vt.hide() : vt.show(); tt.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>" + n.Msg.getMsg("Location") + "<\/h6> ").append(ru)); (r == "undefined" || r == null && r == "") && g.find(".vis-attachhistory-right-row").last().hide(); g.append(tt); it = t('<div style="float:left;width:100%" ><\/div>'); it.append(t('<div  class="vis-attachhistory-right-row2"> ').append("<h6>" + n.Msg.getMsg("StartDate") + "<\/h6> ").append(wi)); it.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>" + n.Msg.getMsg("EndDate") + "<\/h6>").append(vr)); g.append(it); rt = t('<div style="float:left;width:100%" ><\/div>'); rt.append(t('<div class="vis-attachhistory-right-row2">').append("<h6>" + n.Msg.getMsg("AllDay") + "<\/h6>").append(uu)); rt.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>" + n.Msg.getMsg("Category") + "<\/h6> ").append(or)); g.append(rt); g.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Contacts") + "<\/h6> ").append(tf)); hu = t('<div class="vis-attachhistory-right-row" >'); g.append(t('<div class="vis-attachhistory-right-row">').append("<h6>" + n.Msg.getMsg("Description") + "<\/h6> ").append(er)).append(hu); (u == "undefined" || u == null && u == "") && g.find(".vis-attachhistory-right-row").last().hide(); tu = t('<div class="vis-attachhistory-bottom"><\/div>'); nf = t('<div class="vis-attachhistory-comments vis-feedMessage"><\/div>'); nf.append(ri).append('<span class="vis-attachhistory-comment-icon vis vis-sms"><\/span>'); tu.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(nf).append('<p class="vis-attachhistory-view-comments">' + n.Msg.getMsg("ViewMoreComments") + "<\/p>")); st.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(g).append(tu); v.append(st); vt.on("click", function (i) { var r = t(i.target).data("ids").split("-"); n.AEnv.zoom(r[0], r[1]) }) } else st.show(), iu.text(n.Utility.encodeText(w)), ru.text(n.Utility.encodeText(r)), u == "undefined" || u == null || u == "" ? t(er.parent()).hide() : (er.text(n.Utility.encodeText(u)), t(er.parent()).show()), tf.text(n.Utility.encodeText(nt)), b == "undefined" || b == null || b == "" ? or.text(n.Utility.encodeText("")) : or.text(n.Utility.encodeText(b)), vt.data("ids", p), p == 0 ? vt.hide() : vt.show(), wi.text(n.Utility.encodeText(new Date(e).toLocaleString())), vr.text(n.Utility.encodeText(new Date(s).toLocaleString())), uu.text(n.Utility.encodeText(h)), t(st[0].children[0]).hide(); t(".vis-attachhistory-view-comments").off("click"); t(".vis-attachhistory-view-comments").on("click", function () { bf(d, !0, !1, this) }); y != undefined ? ri.val(n.Utility.encodeText(y)) : ri.val(""); t(".vis-attachhistory-comment-icon").data("ID", i); o[0].style.visibility = "hidden" } function bf(i, r, u, f) { r == !0 ? g.is(":visible") ? (t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var t = JSON.parse(n); kf(t, r, u) }, error: function () { n.ADialog.error("RecordNotSaved") } }), t(f).text(n.Msg.getMsg("HideComments"))) : (g.show(), t(st[0].children[0]).hide(), t(f).text(n.Msg.getMsg("ViewMoreComments"))) : u == !0 ? rt.is(":visible") ? (t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var t = JSON.parse(n); kf(t, r, u) }, error: function () { n.ADialog.error("RecordNotSaved") } }), t(f).text(n.Msg.getMsg("HideComments"))) : (rt.show(), t(at[0].children[0]).hide(), t(f).text(n.Msg.getMsg("ViewMoreComments"))) : l.is(":visible") ? (t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var t = JSON.parse(n); kf(t, r, u) }, error: function () { n.ADialog.error("RecordNotSaved") } }), t(f).text(n.Msg.getMsg("HideComments"))) : (l.show(), t(ft[0].children[0]).hide(), t(f).text(n.Msg.getMsg("ViewMoreComments"))) } function vu(t, i) { return t += '   <div class="vis-attachhistory-comment-data"><div class="vis-attachhistory-comment-detail vis-feedDetails-cmnt">', t += i.UserImage != "NoRecordFound" && i.UserImage != "FileDoesn'tExist" && i.UserImage != null ? '<img  class="userAvatar-Feeds"  src="' + i.UserImage + "?" + new Date + '">' : '<i class="fa fa-user userAvatar-Feeds"><\/i>', t += '<div class="vis-attachhistory-comment-text">', t += i.CreatedBy == n.Env.getCtx().getAD_User_ID() ? "<h6>" + n.Msg.getMsg("Me") + " <\/h6>" : "<h6>" + i.UserName + "<\/h6>", t + (" <p>" + i.CharacterData + '<\/p><\/div><div class="vis-attachhistory-comment-dateTime"><p>' + new Date(i.Created).toLocaleString() + "<\/p><\/div><\/div><\/div>") } function kf(n, i, r) { var u, f; if (n.length > 0) { for (u = ' <div class="vis-attachhistory-comments-container">', f = 0; f < n.length; f++)u = vu(u, n[f]); u += "<\/div>" } r == !0 ? rt.is(":visible") ? (t(at[0].children[0]).show(), t(at[0].children[0]).empty(), t(at[0].children[0]).append(u), rt.hide()) : (rt.show(), t(at[0].children[0]).hide()) : i == !0 ? g.is(":visible") ? (t(st[0].children[0]).show(), t(st[0].children[0]).empty(), t(st[0].children[0]).append(u), g.hide()) : (g.show(), t(st[0].children[0]).hide()) : l.is(":visible") ? (t(ft[0].children[0]).show(), t(ft[0].children[0]).empty(), t(ft[0].children[0]).append(u), l.hide()) : (l.show(), t(ft[0].children[0]).hide()) } function po(i) { var r = i.target, f = "", u = ""; (t(r).is("a") ? (f = t(r).text(), u = t(r).data("ids")) : t(r).is("i") ? (f = t(t(r).parent()).siblings().text(), u = t(t(r).parent()).siblings().data("ids")) : t(r).is("span") && (f = t(r).siblings().text(), u = t(r).siblings().data("ids")), u != null && u != 0) && (o[0].style.visibility = "hidden", t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/DownloadAttachment", datatype: "json", type: "get", cache: !1, data: { ID: u, Name: f }, success: function (t) { var i = JSON.parse(t), r = n.Application.contextUrl + "TempDownload/" + i; window.open(r); o[0].style.visibility = "hidden" } })) } function wo(i) { var r = i.target, f = "", u = "", e = ""; (t(r).is("a") ? (f = t(r).text(), e = t(r).data("attid"), u = t(r).data("id")) : t(r).is("img") ? (f = t(t(r).parent()).siblings().text(), e = t(t(r).parent()).siblings().data("attid"), u = t(t(r).parent()).siblings().data("id")) : t(r).is("span") && (f = t(r).siblings().text(), e = t(r).siblings().data("attid"), u = t(t(r).parent()).siblings().data("id")), u != null && u != 0) && (o[0].style.visibility = "hidden", t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/DownloadAttachmentCall", datatype: "json", type: "get", cache: !1, data: { AttID: e, ID: u, Name: f }, success: function (t) { var i = JSON.parse(t), r; i != null && i != "" ? (r = n.Application.contextUrl + "TempDownload/" + i, window.open(r)) : n.ADialog.error("AttachmentNotFound"); o[0].style.visibility = "hidden" } })) } function ce(i) { var f = i.target, r, u; (i.keyCode == undefined || i.keyCode == 13) && (i.keyCode != undefined || t(f).hasClass("vis-attachhistory-comment-icon")) && (r = 0, r = t(".vis-attachhistory-comment-icon").data("ID"), r != 0) && (u = "", u = c == !0 ? ri.val() : a == !0 ? bi.val() : ii.val(), u.length != 0) && t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/SaveComment", datatype: "json", type: "POST", cache: !1, data: { ID: r, Text: u, isAppointment: c, isCall: a }, success: function (n) { var f = JSON.parse(n), r = !0, i, u; if (a == !0 ? (bi.val(""), rt.is(":visible") && (r = !1)) : c == !0 ? (ri.val(""), g.is(":visible") && (r = !1)) : (ii.val(""), l.is(":visible") && (r = !1)), r == !0) { if (f.length > 0) { for (i = ' <div class="vis-attachhistory-comments-container">', u = 0; u < f.length; u++)i = vu(i, f[u]); i += "<\/div>" } c == !0 ? (t(st[0].children[0]).empty(), t(st[0].children[0]).append(i)) : a == !0 ? (t(at[0].children[0]).empty(), t(at[0].children[0]).append(i)) : (t(ft[0].children[0]).empty(), t(ft[0].children[0]).append(i)) } else pt(w, c, a) }, error: function () { n.ADialog.error("RecordNotSaved") } }) } function pt(i, r, u) { t.ajax({ url: n.Application.contextUrl + "AttachmentHistory/ViewChatonLastHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: i, isAppointment: r, isCall: u }, success: function (n) { var f = JSON.parse(n), t, i; if (f.length > 0) if (r) for (t = '<div style="height:88px"><\/div>', hu.empty(), i = 0; i < f.length; i++)t = vu(t, f[i]), hu.append(t); else if (u) for (t = "<div><\/div>", cu.empty(), i = 0; i < f.length; i++)t = vu(t, f[i]), cu.append(t); else for (t = '<div style="height:120px"><\/div>', su.empty(), i = 0; i < f.length; i++)t = vu(t, f[i]), su.append(t); else u ? cu.empty() : r ? hu.empty() : su.empty() } }) } var le = n.Env.getWindowNo(), ae = n.Env.getCtx(), wt = [], si = [], h = [], dt = [], ai = [], c, bt = [], vi = [], y = [], kt, kr, d, ut, yt, p, b, gi, df = this, dr, yu, du, nr, gr, pu, tr, wu, v, ft, st, g, nu, tu, k, gu, nf, l, ni, ar, ti, ir, gf, hi, rr, ii, ur, fr, yi, ri, pi, vt, ci, iu, ru, er, or, tf, rf, wi, vr, uu, o, li = 50, it, nt, uf, fu, eu, ui, fi, ei, tt, ou, et, ct, lt, ot, gt, s, ht, ve, bu, ne, te, ie, ku, su, hu, at, rt, bi, ff, ef, of, sf, hf, cf, lf, af, vf, yf, a, oi, cu, ki, di, w, pf; this.initializeComponent = function () { bu = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); it = 1; nt = 1; tt = 1; we(); pe(); ye(); re(); sr(); ro() }; this.displayInboxDiv = function () { ut = d.w2grid({ name: "historyinboxgrid", recordHeight: 30, show: { toolbar: !0 }, multiSelect: !1, columns: wt, records: si }); ut.on("select", br); ut.on("search", wr); si.length > 0 ? (ut.select(0), k.hide(), v.show()) : (k.show(), v.hide()); o[0].style.visibility = "hidden"; t(".vis-attachhistory-search-icon").on("click", fe) }; di = !1; w = 0; pf = 0; this.getRoot = function () { return kr }; this.show = function () { kt = new n.ChildDialog; this.initializeComponent(); kt.setContent(kr); bu == !0 ? (kt.setHeight(650), kt.setWidth(800)) : (kt.setHeight(650), kt.setWidth(1e3)); kt.setTitle(n.Msg.getMsg("History")); kt.setModal(!0); kt.show(); kt.hideButtons(); this.displayInboxDiv(); kt.onClose = function () { df.dispose() } }; this.dispose = function () { le = 0; ae = null; wt = []; wt = null; si = []; si = null; h = []; h = null; dr != null && dr.remove(); yu != null && yu.remove(); gr != null && gr.remove(); pu != null && pu.remove(); tr != null && tr.remove(); wu != null && wu.remove(); v != null && v.remove(); ft != null && ft.remove(); st != null && st.remove(); g != null && g.remove(); nu != null && nu.remove(); tu != null && tu.remove(); k != null && k.remove(); l != null && l.remove(); ni != null && ni.remove(); oi != null && oi.remove(); ar != null && ar.remove(); ti != null && ti.remove(); ir != null && ir.remove(); ki != null && ki.remove(); gf != null && gf.remove(); hi != null && hi.remove(); rr != null && rr.remove(); ii != null && ii.remove(); ur != null && ur.remove(); fr != null && fr.remove(); yi != null && yi.remove(); ri != null && ri.remove(); ru != null && ru.remove(); iu != null && iu.remove(); er != null && er.remove(); rf != null && rf.remove(); wi != null && wi.remove(); vr != null && vr.remove(); uu != null && uu.remove(); o != null && o.remove(); ou != null && ou.remove(); et != null && et.remove(); ct != null && ct.remove(); lt != null && lt.remove(); ot != null && ot.remove(); gt != null && gt.remove(); s != null && s.remove(); d != null && d != undefined && d.remove(); d = null; ut != null && ut != undefined && ut.destroy(); ut = null; w2ui.historyinboxgrid != undefined && w2ui.historyinboxgrid.destroy(); p != null && p != undefined && p.destroy(); p = null; w2ui.realtedhistorygrid != undefined && w2ui.realtedhistorygrid.destroy(); b != null && b != undefined && b.destroy(); b = null; w2ui.userhistorygrid != undefined && w2ui.userhistorygrid.destroy(); df = null } } }(VIS, jQuery), function (n, t) { function r() { var k = null, d = null, p = null, ft = null, g = null, w = null, et = null, ot = null, wt = null, bt = null, st = null, kt = null, o = null, s = null, ht = null, h = null, ii = null, ct = null, c = null, ri = null, lt = null, l = null, ui = null, at = null, a = null, fi = null, vt = null, nt = null, tt = null, ei = null, yt = null, it = null, rt = null, e = null, f = null, li = null, ai = null, pt = null, v = null, oi = null, y = null, r = null, u = -1, b = !1; this.Load = function (i, r) { k = i; d = r; et = t("<div class='vis-rad-recordData'>"); e = t("<button  class='vis-rad-navBtn' disabled='disabled'>").append(t("<i class='fa fa-caret-down'><\/i>")); f = t("<button  class='vis-rad-navBtn' disabled='disabled'>").append(t("<i class='fa fa-caret-up'><\/i>")); vt = t("<div class='vis-rad-actionIcons' >"); nt = t("<button  class='vis-rad-actionBtn'>").append(t("<i class='vis vis-plus'><\/i>")); yt = t("<div class='vis-rad-btnWrap' >"); rt = t("<a href = 'javascript:void(0)'  class='vis-rad-buttons VIS_Pref_btn-2'>").append(n.Msg.getMsg("Cancel")); ei = t("<span class='vis-rad-paging'>").append(y); h = t("<input type='checkbox' checked >"); ii = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsActive")); c = t("<input type='checkbox' checked >"); ri = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsExclude")); l = t("<input type='checkbox'>"); ui = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsReadOnly")); a = t("<input type='checkbox'>"); fi = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IsDependentEntities")); v = t("<input type='checkbox'>"); oi = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "IncludeNull")); p = t("<div class='vis-forms-container'>"); ft = t("<div class='vis-forms-container vis-rad-contantWrap'>"); g = t("<div class='vis-rad-contantTop'>"); wt = t("<div class='vis-rad-roleCombo'>"); bt = t("<div class='input-group vis-input-wrap'>"); st = t("<div class='vis-control-wrap'>"); kt = t("<label>").append(n.Msg.translate(n.Env.getCtx(), "AD_Role_ID")); o = t("<select class='vis-custom-select'>"); wt.append(bt); bt.append(st); st.append(o); st.append(kt); s = t("<div class='vis-rad-recordOp'>"); ht = t("<div class='vis-rad-check'>"); ht.append(h); ht.append(ii); s.append(ht); ct = t("<div class='vis-rad-check'>"); ct.append(c); ct.append(ri); s.append(ct); lt = t("<div class='vis-rad-check'>"); lt.append(l); lt.append(ui); s.append(lt); at = t("<div class='vis-rad-check'>"); at.append(a); at.append(fi); s.append(at); pt = t("<div class='vis-rad-check'>"); pt.append(v); pt.append(oi); s.append(pt); et.append(wt); et.append(s); g.append(et); ot = t("<div class='vis-rad-navIcons'>"); ot.append(e); ot.append(f); g.append(ot); w = t("<div class='vis-rad-contantBottom'>"); tt = t("<button  class='vis-rad-actionBtn'>").append(t("<i class='vis vis-delete'><\/i>")); vt.append(nt); vt.append(tt); w.append(vt); y = t("<lable>"); w.append(ei); it = t("<a href = 'javascript:void(0)'  class='vis-rad-buttons VIS_Pref_btn-2'>").append(n.Msg.getMsg("Ok")); yt.append(rt); yt.append(it); w.append(yt); ft.append(g); ft.append(w); p.append(ft); si(); dt(); gt(); p.dialog({ width: 600, height: 232, resizable: !1, title: "Record", modal: !0 }) }; var dt = function () { var t = n.dataContext.getJSONData(n.Application.contextUrl + "RecordAccess/GetRoles", null, null), r = '<option Value="-1"><\/option>'; if (t != null) for (i in t) r += '<option value="' + t[i].AD_Role_ID + '">' + t[i].Name + "<\/option>"; o.append(r); r = null; t = null }, gt = function () { var t, i, f; if (r == null && (r = []), t = n.dataContext.getJSONData(n.Application.contextUrl + "RecordAccess/GetRecordAccess", { Table_ID: k, Record_ID: d }, null), i = null, t != null) for (f in t) i = {}, i.AD_ROLE_ID = t[f].AD_ROLE_ID, i.ISACTIVE = t[f].ISACTIVE, i.ISDEPENDENTENTITIES = t[f].ISDEPENDENTENTITIES, i.ISEXCLUDE = t[f].ISEXCLUDE, i.ISREADONLY = t[f].ISREADONLY, i.ISINCLUDENULL = t[f].ISINCLUDENULL, r.push(i); i = null; t = null; r.length > 0 ? (u = 0, ut()) : b = !0 }, ni = function () { var r = o.val(), i; r != -1 && (i = !1, b || (i = !0), t.ajax({ url: n.Application.contextUrl + "RecordAccess/SaveAccess/", dataType: "json", data: { AD_Role_ID: r, AD_Table_ID: k, Record_ID: d, isActive: h.prop("checked"), isExclude: c.prop("checked"), isReadOnly: l.prop("checked"), isDependentEntities: a.prop("checked"), isIncludeNull: v.prop("checked"), isUpdate: i }, success: function (n) { var t = n.result; t == !0 && ti() } })) }, si = function () { e.on("click", function () { u += 1; ut() }); f.on("click", function () { b ? b = !1 : u -= 1; ut() }); nt.on("click", function () { hi() }); tt.on("click", function () { ci() }); it.on("click", function () { ni() }); rt.on("click", function () { ti() }) }, hi = function () { b = !0; u = r.length - 1; ut(); o.val(-1); h.attr("checked", !0); c.attr("checked", !0); l.attr("checked", !1); v.attr("checked", !1); a.attr("checked", !1); y.empty(); y.append("+" + (r.length + 1) + "/" + (r.length + 1)); r.length > 0 && (f.attr("disabled", !1), f.css("opacity", "1")) }, ut = function () { o.val(r[u].AD_ROLE_ID); h.attr("checked", r[u].ISACTIVE == "Y" ? !0 : !1); c.attr("checked", r[u].ISEXCLUDE == "Y" ? !0 : !1); l.attr("checked", r[u].ISREADONLY == "Y" ? !0 : !1); v.attr("checked", r[u].ISINCLUDENULL == "Y" ? !0 : !1); a.attr("checked", r[u].ISDEPENDENTENTITIES == "Y" ? !0 : !1); y.empty(); y.append(u + 1 + "/" + r.length); r.length > u + 1 ? (e.attr("disabled", !1), e.css("opacity", "1")) : (e.attr("disabled", !0), e.css("opacity", ".5")); u == 0 ? (f.attr("disabled", !0), f.css("opacity", ".5")) : (f.attr("disabled", !1), f.css("opacity", "1")) }, ci = function () { var i = o.val(); i == -1 || b || t.ajax({ url: n.Application.contextUrl + "RecordAccess/DeleteRecord/", dataType: "json", data: { AD_Role_ID: i, AD_Table_ID: k, Record_ID: d, isActive: h.prop("checked"), isExclude: c.prop("checked"), isReadOnly: l.prop("checked"), isIncludeNull: v.prop("checked"), isDependentEntities: a.prop("checked") }, success: function (n) { var t = n.result; t == !0 && ti() } }) }, ti = function () { e.off("click"); f.off("click"); nt.off("click"); tt.off("click"); it.off("click"); rt.off("click"); dt = null; gt = null; ni = null; si = null; hi = null; ut = null; ci = null; k = null; d = null; g = null; w = null; li = null; ai = null; e = null; f = null; nt = null; tt = null; it = null; rt = null; kt = null; o = null; h = null; c = null; l = null; v = null; a = null; y = null; r = null; dt = null; gt = null; ni = null; p.dialog("destroy"); p.remove(); p = null } } n.RecordAccessDialog = r }(VIS, jQuery), function (n, t) { function i() { function fh(n, i, r) { var u = null; return t.ajax({ url: rh, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function eh() { var i, r, u, f; g = tu.getContextAsInt("$C_Currency_ID"); bu = uh("VIS_131"); ah(); bh(); vh(); wh(); yh(); ph(); rc(); ec(); uc(); kh(); dh(); gh(); nc(); tc(); ic(); ge.append(it).append(ot).append(ct).append(yt).append(th); it.css("display", ""); ot.css("display", "none"); iu.append(de.append(et)).append(ge); i = t('<div class="vis-allocation-leftpanel-bottomDiv">'); r = t('<div class="vis-DiffernceWrapDiv">'); i.append(r); r.append('<div class="vis-allocation-leftControls"><span class="vis-allocation-inputLabels">' + n.Msg.getMsg("Difference") + "<\/span>"); r.append('<div class="vis-allocation-leftControls"><span class="vis-allocation-lblCurrnecy" style=" padding: 0 5px; "><\/span><span class="vis-allocation-lbldifferenceAmt"><\/span>'); u = t('<div style="padding-right: 15px;float: right; margin-top: 10px;">'); u.append(' <a class="vis-group-btn vis-group-create vis-group-grayBtn" style="float: right;">' + n.Msg.getMsg("Process") + "<\/a>"); f = t('<div style="padding-right: 15px;float: right; margin-top: 10px;">'); f.append(' <a class="vis-group-create vis-group-grayBtn" id="vis_srchbtn_' + e.windowNo + '" style="float: left;">' + n.Msg.getMsg("Search") + "<\/a>"); de.append(i); i.append(u); i.append(f); iu.append(de.append(et).append(i)).append(ge); eu = iu.find(".vis-group-btn"); eu.css({ "pointer-events": "none", opacity: "0.5" }); hs = iu.find("#vis_srchbtn_" + e.windowNo + ""); fc(); oh(); w(); yt.css("display", "none"); ve = r.find(".vis-allocation-lbldifferenceAmt"); cs = r.find(".vis-allocation-lblCurrnecy"); iu.find(".vis-allocation-resultdiv").css({ width: "100%", margin: "0", bottom: "0", position: "inherit" }); a[0].style.visibility = "hidden" } function oh() { function o() { return wr == !0 && br == !0 && kr == !0 && dr == !0 ? !0 : !1 } function e() { return p.val() == 0 && k.val() == 0 ? (n.ADialog.info("", !0, n.Msg.getMsg("allocationFrom_And_allocationTo"), ""), k.addClass("vis-ev-col-mandatory"), p.addClass("vis-ev-col-mandatory"), !1) : k.val() == 0 ? (n.ADialog.info("", !0, n.Msg.getMsg("selectAllocationFrom"), ""), p.val(0), k.addClass("vis-ev-col-mandatory"), p.addClass("vis-ev-col-mandatory"), !1) : p.val() == 0 ? (n.ADialog.info("", !0, n.Msg.getMsg("selectAllocationTo"), ""), p.addClass("vis-ev-col-mandatory"), !1) : !0 } function h() { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? bi() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), li.setValue(null)) : li.setValue(null) : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), li.setValue(null)) } function c() { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? si() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), ci.setValue(null)) : ci.setValue(null) : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), ci.setValue(null)) } ii.on("change", function () { if (s.is(":checked") && l.val() == "") { w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 || (y.getControl().addClass("vis-ev-col-mandatory"), w()) }); y.fireValueChanged = fl; st.on("change", function () { if (df("C_Currency_ID", st.val()), s.is(":checked") && l.val() == "") { w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 || (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), w()) }); s.on("change", function () { if (df("Date", s.is(":checked")), s.is(":checked") && l.val() == "") { l.val(""); return } n.Utility.Util.getValueOfInt(y.value) > 0 || (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), w()); s.is(":checked") || l.val("") }); fe.on("change", function () { ef.is(":checked") && (t(".vis-allocate-invoicediv").insertBefore(".vis-allocate-gldiv"), it.css("display", "none"), ot.css("display", "none"), yt.css("display", "block"), ct.css("display", "block"), i && i.refresh(), r && r.refresh()); ds() }); hs.on("click", function () { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (b(), cl()) : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), y.getControl().addClass("vis-ev-col-mandatory"), b(), w()) }); ef.on("change", function () { fe.prop("checked", !1); ef.is(":checked") ? (t(".vis-allocate-invoicediv").insertBefore(".vis-allocate-gldiv"), ct.css("display", "block"), yt.css("display", "block"), it.css("display", "none"), ot.css("display", "none"), i && i.refresh(), r && r.refresh()) : (t(".vis-allocate-invoicediv").insertBefore(".vis-allocate-paymentdiv"), ct.css("display", "block"), yt.css("display", "none"), it.css("display", "block"), ot.css("display", "none"), i && i.refresh(), u && u.refresh()) }); re.on("change", function () { }); ft.on("change", function () { if (ks()) { if (new Date(ft.val()) < nr) return n.ADialog.info("", !0, n.Msg.getMsg("SelectMaxDate") + Globalize.format(new Date(nr), "yyyy-MM-dd"), ""), ft.val(Globalize.format(new Date(nr), "yyyy-MM-dd")), !1 } else n.ADialog.info("", !0, n.Msg.getMsg("PleaseSelectRecord"), "") }); eu.on("click", function () { if (n.Utility.Util.getValueOfInt(y.value) == 0) return n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), y.getControl().addClass("vis-ev-col-mandatory"), b(), w(), !1; if (ks()) { if (ft.val().trim() == "") return n.ADialog.info("", !0, n.Msg.getMsg("InvalidDateFormat"), ""), !1; if (ft.val() < Globalize.format(new Date(nr), "yyyy-MM-dd")) return n.ADialog.info("", !0, n.Msg.getMsg("SelectMaxDate") + Globalize.format(new Date(nr), "yyyy-MM-dd"), ""), ft.val(Globalize.format(new Date(nr), "yyyy-MM-dd")), !1; gr ? parseInt(d.val()) > 0 ? gs() : n.ADialog.info("", !0, n.Msg.getMsg("ValidateOrg"), "") : n.ADialog.confirm("ConfirmForDiffOrg", !0, "", "Confirm", function (t) { if (t) parseInt(d.val()) > 0 ? gs() : n.ADialog.info("", !0, n.Msg.getMsg("ValidateOrg"), ""); else return }) } else n.ADialog.info("", !0, n.Msg.getMsg("PleaseSelectRecord"), "") }); ci.fireValueChanged = c; wt.on("change", function () { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? si() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), wt.val(0)) : wt.val(0) : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), wt.val(0)) }); li.fireValueChanged = h; bt.on("change", function () { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? bi() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), bt.val(0)) : bt.val(0) : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), bt.val(0)) }); ni.on("change", function () { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? bi() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), ni.val(0)) : ni.val(0) : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), ni.val(0)) }); gt.on("change", function () { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? si() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), gt.val(0)) : gt.val(0) : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), gt.val(0)) }); dt.on("change", function () { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? nu() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), dt.val(0)) : dt.val(0) : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), dt.val(0)) }); ai.on("blur", function () { var i = Date.parse(ai.val()), t = new Date(parseInt(i)); if (!isNaN(t.getTime()) && t.getTime() < 0) { n.ADialog.warn("VIS_InvalidDate"); return } if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? si() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), ai.val("")) : ai.val("") : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), ai.val("")) }); ui.on("blur", function () { var i = Date.parse(ui.val()), t = new Date(parseInt(i)); if (!isNaN(t.getTime()) && t.getTime() < 0) { n.ADialog.warn("VIS_InvalidDate"); return } if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? si() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), ui.val("")) : ui.val("") : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), ui.val("")) }); ki.on("blur", function () { var i = Date.parse(ki.val()), t = new Date(parseInt(i)); if (!isNaN(t.getTime()) && t.getTime() < 0) { n.ADialog.warn("VIS_InvalidDate"); return } if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? bi() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), ki.val("")) : ki.val("") : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), ki.val("")) }); vi.on("blur", function () { var i = Date.parse(vi.val()), t = new Date(parseInt(i)); if (!isNaN(t.getTime()) && t.getTime() < 0) { n.ADialog.warn("VIS_InvalidDate"); return } if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? bi() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), vi.val("")) : vi.val("") : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), vi.val("")) }); di.on("blur", function () { var i = Date.parse(di.val()), t = new Date(parseInt(i)); if (!isNaN(t.getTime()) && t.getTime() < 0) { n.ADialog.warn("VIS_InvalidDate"); return } if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? nu() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), di.val("")) : di.val("") : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), di.val("")) }); yi.on("blur", function () { var i = Date.parse(yi.val()), t = new Date(parseInt(i)); if (!isNaN(t.getTime()) && t.getTime() < 0) { n.ADialog.warn("VIS_InvalidDate"); return } if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? nu() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), yi.val("")) : yi.val("") : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), yi.val("")) }); gi.on("blur", function () { var i = Date.parse(gi.val()), t = new Date(parseInt(i)); if (!isNaN(t.getTime()) && t.getTime() < 0) { n.ADialog.warn("VIS_InvalidDate"); return } if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? vu() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), gi.val("")) : gi.val("") : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), gi.val("")) }); pi.on("blur", function () { var i = Date.parse(pi.val()), t = new Date(parseInt(i)); if (!isNaN(t.getTime()) && t.getTime() < 0) { n.ADialog.warn("VIS_InvalidDate"); return } if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() ? o() ? vu() : (n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), ""), pi.val("")) : pi.val("") : (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), pi.val("")) }); pu.on("keypress", function (t) { if (t.keyCode == 13) { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? (hu = 1, si()) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") } }); go.on("click", function () { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? (hu = 1, si()) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") }); yu.on("keypress", function (t) { if (t.keyCode == 13) { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? (lu = 1, bi()) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") } }); ko.on("click", function () { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? (lu = 1, bi()) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") }); wu.on("keypress", function (t) { if (t.keyCode == 13) { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? (cu = 1, nu()) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") } }); ns.on("click", function () { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? (cu = 1, nu()) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") }); hf.on("keypress", function (t) { if (t.keyCode == 13) { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? (au = 1, vu()) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") } }); ts.on("click", function () { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? (au = 1, vu()) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") }); wi.on("change", function (n) { var u, r, f; for (a[0].style.visibility = "visible", u = t("#grid_" + i.name + '_records td[col="0"]').find('input[type="checkbox"]'), r = 0; r < u.length; r++) { if (t(u[r]).prop("checked", wi.prop("checked")), !we(u[r], !0, !1, !1, !1)) break; i.editChange.call(i, u[r], r, 0, n); f = { type: "click", phase: "before", target: "grid", recid: r, index: r, isStopped: !1, "isCan//celled": !1, onComplete: null }; i.trigger(f) } wi.prop("checked") == !1 && (ut = []); a[0].style.visibility = "hidden" }); er.on("change", function (n) { var r, i, f; for (a[0].style.visibility = "visible", r = t("#grid_" + u.name + '_records td[col="0"]').find('input[type="checkbox"]'), i = 0; i < r.length; i++) { if (t(r[i]).prop("checked", er.prop("checked")), !we(r[i], !1, !0, !1, !1)) break; u.editChange.call(u, r[i], i, 0, n); f = { type: "click", phase: "before", target: "grid", recid: i, index: i, isStopped: !1, "isCan//celled": !1, onComplete: null }; u.trigger(f) } er.prop("checked") == !1 && (ht = []); a[0].style.visibility = "hidden" }); or.on("change", function (n) { var r, i, u; for (a[0].style.visibility = "visible", r = t("#grid_" + f.name + '_records td[col="0"]').find('input[type="checkbox"]'), i = 0; i < r.length; i++) { if (t(r[i]).prop("checked", or.prop("checked")), !we(r[i], !1, !1, !0, !1)) break; f.editChange.call(f, r[i], i, 0, n); u = { type: "click", phase: "before", target: "grid", recid: i, index: i, isStopped: !1, "isCan//celled": !1, onComplete: null }; f.trigger(u) } or.prop("checked") == !1 && (at = []); a[0].style.visibility = "hidden" }); fi.on("change", function (n) { var u, i, f; for (a[0].style.visibility = "visible", fi.prop("checked") == !1 && (ei = []), u = t("#grid_" + r.name + '_records td[col="0"]').find('input[type="checkbox"]'), i = 0; i < u.length; i++) { if (t(u[i]).prop("checked", fi.prop("checked")), !we(u[i], !1, !1, !1, !0)) break; r.editChange.call(r, u[i], i, 0, n); f = { type: "click", phase: "before", target: "grid", recid: i, index: i, isStopped: !1, "isCan//celled": !1, onComplete: null }; r.trigger(f) } fi.prop("checked") == !1 && (rt = []); a[0].style.visibility = "hidden" }); d.on("change", function () { parseInt(d.val()) > 0 ? d.removeClass("vis-ev-col-mandatory") : d.addClass("vis-ev-col-mandatory") }); l.on("blur", function () { var i = Date.parse(l.val()), t = new Date(parseInt(i)); if (!isNaN(t.getTime()) && t.getTime() < 0) { n.ADialog.warn("VIS_InvalidDate"); return } if (ro = l.val(), s.is(":checked") && l.val() == "") { w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 || (n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), ""), w()) }); ee.on("change", function () { df("Date", ee.is(":checked")); uu = ee.is(":checked") }); oe.on("change", function () { df("Date", oe.is(":checked")); tr = oe.is(":checked") }); fs.on("click", function (t) { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? i && sh(t) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") }); is.on("click", function (t) { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? r && hh(t) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") }); rs.on("click", function (t) { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? f && ch(t) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") }); us.on("click", function (t) { if (s.is(":checked") && l.val() == "") { n.ADialog.warn("VIS_SlctcnvrsnDate"); w(); b(); return } n.Utility.Util.getValueOfInt(y.value) > 0 ? e() && (o() ? u && lh(t) : n.ADialog.info("", !0, n.Msg.getMsg("VIS_Search_Btn"), "")) : n.ADialog.info("", !0, n.Msg.getMsg("SelectBusinessPartnerFirst"), "") }); k.on("change", function (n) { k.val() == 0 ? k.addClass("vis-ev-col-mandatory") : k.removeClass("vis-ev-col-mandatory"); as(n); k.val() == "P" ? (p.find("option[value=C]").hide(), p.find("option[value=P]").show(), p.find("option[value=G]").show()) : k.val() == "C" ? (p.find("option[value=P]").hide(), p.find("option[value=C]").show(), p.find("option[value=G]").show()) : k.val() == "G" ? (p.find("option[value=P]").show(), p.find("option[value=C]").show(), p.find("option[value=G]").hide()) : (p.find("option[value=C]").show(), p.find("option[value=P]").show(), p.find("option[value=G]").show()); p.val(0); p.addClass("vis-ev-col-mandatory"); ls(k.val()); bf(k.val(), p.val()); b() }); p.on("change", function (n) { if (p.val() != 0 && k.val() != 0) { p.removeClass("vis-ev-col-mandatory"); as(n); var t = k.val(), i = p.val(); ls(p.val()); bf(t, i) } else w(), p.addClass("vis-ev-col-mandatory"); b() }) } function b() { dt.val(0); gt.val(0); ni.val(0); bt.val(0); wt.val(0); ci.setValue(null); li.setValue(null); ai.val(""); ui.val(""); ki.val(""); vi.val(""); di.val(""); yi.val(""); gi.val(""); pi.val(""); yu.val(""); pu.val(""); hf.val(""); wu.val(""); at = []; ut = []; ht = []; rt = []; oi.val(Globalize.format(new Date, "yyyy-MM-dd")); yo() } function sh(n) { for (var u = t("#grid_" + i.name + '_records td[col="0"]').find('input[type="checkbox"]'), f, r = 0; r < u.length; r++)t(u[r]).prop("checked", !1), i.editChange.call(i, u[r], r, 0, n), f = { type: "click", phase: "before", target: "grid", recid: r, index: r, isStopped: !1, "isCan//celled": !1, onComplete: null }, i.trigger(f); ut = []; wi.prop("checked", !1); wt.val(0); gt.val(0); ci.setValue(null); pu.val(""); ai.val(""); ui.val(""); si() } function hh(n) { for (var u = t("#grid_" + r.name + '_records td[col="0"]').find('input[type="checkbox"]'), f, i = 0; i < u.length; i++)t(u[i]).prop("checked", !1), r.editChange.call(r, u[i], i, 0, n), f = { type: "click", phase: "before", target: "grid", recid: i, index: i, isStopped: !1, "isCan//celled": !1, onComplete: null }, r.trigger(f); rt = []; fi.prop("checked", !1); hf.val(""); gi.val(""); pi.val(""); vu() } function ch(n) { for (var r = t("#grid_" + f.name + '_records td[col="0"]').find('input[type="checkbox"]'), u, i = 0; i < r.length; i++)t(r[i]).prop("checked", !1), f.editChange.call(f, r[i], i, 0, n), u = { type: "click", phase: "before", target: "grid", recid: i, index: i, isStopped: !1, "isCan//celled": !1, onComplete: null }, f.trigger(u); at = []; or.prop("checked", !1); wu.val(""); dt.val(0); di.val(""); yi.val(""); nu() } function lh(n) { for (var r = t("#grid_" + u.name + '_records td[col="0"]').find('input[type="checkbox"]'), f, i = 0; i < r.length; i++)t(r[i]).prop("checked", !1), u.editChange.call(u, r[i], i, 0, n), f = { type: "click", phase: "before", target: "grid", recid: i, index: i, isStopped: !1, "isCan//celled": !1, onComplete: null }, u.trigger(f); ht = []; er.prop("checked", !1); ni.val(0); bt.val(0); li.setValue(null); yu.val(""); ki.val(""); vi.val(""); bi() } function ls(n) { n == "P" ? u && u.refresh() : n == "C" ? f && f.refresh() : n == "I" ? i && i.refresh() : n == "G" && r && r.refresh() } function bf(n, t) { it.css("display", "none"); ot.css("display", "none"); ct.css("display", "none"); yt.css("display", "none"); ir = !0; su = !0; ru = !0; n == "P" ? (su = !1, it.css("display", "block"), u && u.clear()) : n == "C" ? (ir = !1, ot.css("display", "block"), f && f.clear()) : n == "I" ? (ct.css("display", "block"), i && i.clear()) : n == "G" && (yt.css("display", "block"), ru = !1, r && r.clear()); t == "P" ? (su = !1, it.css("display", "block"), u && u.clear()) : t == "C" ? (ir = !1, ot.css("display", "block"), f && f.clear()) : t == "I" ? (ct.css("display", "block"), i && i.clear()) : t == "G" && (yt.css("display", "block"), ru = !1, r && r.clear()) } function as(n) { var u, r, f; if (i != null) { for (u = t("#grid_" + i.name + '_records td[col="0"]').find('input[type="checkbox"]'), r = 0; r < u.length; r++)t(u[r]).prop("checked", !1), i.editChange.call(i, u[r], r, 0, n), f = { type: "click", phase: "before", target: "grid", recid: r, index: r, isStopped: !1, "isCan//celled": !1, onComplete: null }, i.trigger(f); ut = [] } } function ah() { var t = null, i = n.MLookupFactory.get(tu, ou.windowNo, 0, n.DisplayType.TableDir, "C_Currency_ID", 0, !1, "IsMyCurrency='Y'"), u, r; if (t = i.getData(!0, !0, !1, !1), u = 0, t != null && t != undefined && t.length > 0) { for (r = 0; r < t.length; r++)st.append("<option value=" + t[r].Key + ">" + t[r].Name + "<\/option>"), t[r].Key == g && (st.val(g), u = 1); u == 0 && (st.val(0), st.addClass("vis-ev-col-mandatory")) } i = n.MLookupFactory.getMLookUp(tu, ou.windowNo, 3499, n.DisplayType.Search); y = new n.Controls.VTextBoxButton("C_BPartner_ID", !0, !1, !0, n.DisplayType.Search, i); i = n.MLookupFactory.get(tu, ou.windowNo, 0, n.DisplayType.TableDir, "VA009_PaymentMethod_ID", 0, !1, "VA009_PAYMENTMETHOD.VA009_PAYMENTMETHOD_ID IN (SELECT VA009_PAYMENTMETHOD_ID FROM VA009_PAYMENTMETHOD WHERE VA009_PAYMENTBASETYPE NOT IN ('B','C','P') )"); li = new n.Controls.VComboBox("VA009_PaymentMethod_ID", !1, !1, !0, i, 50); i = n.MLookupFactory.get(tu, ou.windowNo, 0, n.DisplayType.TableDir, "VA009_PaymentMethod_ID", 0, !1, "VA009_PAYMENTMETHOD.IsActive='Y' AND VA009_PAYMENTMETHOD.AD_Client_ID = @AD_Client_ID@"); ci = new n.Controls.VComboBox("VA009_PaymentMethod_ID", !1, !1, !0, i, 50) } function vh() { t.ajax({ type: "POST", url: n.Application.contextUrl + "PaymentAllocation/GetPaymentType", dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (dt.empty(), dt.append("<option value='0'><\/option>"), i = 0; i < r.length; i++)paymentType = n.Utility.Util.getValueOfString(r[i].Name), paymentType_ID = n.Utility.Util.getValueOfString(r[i].Value), dt.append(" <option value=" + paymentType_ID + ">" + paymentType + "<\/option>"); else dt.append("<option value= '0'><\/option>"); dt.prop("selectedIndex", 0) }, error: function (n) { console.log(n) } }) } function yh() { t.ajax({ type: "POST", url: n.Application.contextUrl + "PaymentAllocation/GetDocbaseType", dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (gt.empty(), gt.append("<option value='0'><\/option>"), i = 0; i < r.length; i++)docBaseType = n.Utility.Util.getValueOfString(r[i].DocbaseType), docBaseName = n.Utility.Util.getValueOfString(r[i].Name), gt.append(" <option value=" + docBaseType + ">" + docBaseName + "<\/option>"); else gt.append("<option value= '0'><\/option>"); gt.prop("selectedIndex", 0) }, error: function (n) { console.log(n) } }) } function ph() { t.ajax({ type: "POST", url: n.Application.contextUrl + "PaymentAllocation/GetpayDocbaseType", dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (ni.empty(), ni.append("<option value='0'><\/option>"), i = 0; i < r.length; i++)docbaseType = n.Utility.Util.getValueOfString(r[i].DocbaseType), docBaseName = n.Utility.Util.getValueOfString(r[i].Name), ni.append(" <option value=" + docbaseType + ">" + docBaseName + "<\/option>"); else ni.append("<option value='0'><\/option>"); ni.prop("selectedIndex", 0) }, error: function (n) { console.log(n) } }) } function wh() { t.ajax({ type: "POST", url: n.Application.contextUrl + "PaymentAllocation/GetpayDocType", dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (bt.empty(), bt.append("<option value='0'><\/option>"), i = 0; i < r.length; i++)te = n.Utility.Util.getValueOfString(r[i].DocType), ie = n.Utility.Util.getValueOfInt(r[i].C_DocType_ID), bt.append(" <option value=" + ie + ">" + te + "<\/option>"); else bt.append("<option value= 0><\/option>"); bt.prop("selectedIndex", 0) }, error: function (n) { console.log(n) } }) } function bh() { t.ajax({ type: "POST", url: n.Application.contextUrl + "PaymentAllocation/GetDocType", dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (wt.empty(), wt.append("<option value= 0 ><\/option>"), i = 0; i < r.length; i++)te = n.Utility.Util.getValueOfString(r[i].DocType), ie = n.Utility.Util.getValueOfInt(r[i].C_DocType_ID), wt.append(" <option value=" + ie + ">" + te + "<\/option>"); else wt.append("<option value= 0 ><\/option>"); wt.prop("selectedIndex", 0) }, error: function (n) { console.log(n) } }) } function si() { if (lt > 0) { if (AD_Org_ID = ii.val(), g = st.val(), g == 0) return n.ADialog.info("Message", !0, "select currency", ""); if (v = ai.val(), c = ui.val(), c != "" && v > c) return ui.val(""), n.ADialog.info("Message", !0, n.Msg.getMsg("VIS_FromDateGreater"), ""); a[0].style.visibility = "visible"; ar = 1; hu = 1; vf = 0; kr = !1; vt = 0; var i = s.is(":checked"), r = null; tt = ft.val(); r = tt != null && tt != undefined && tt != "" ? n.DB.to_date(tt) : n.DB.to_date(new Date); ne = gf.val(); ur = wt.val(); docBaseType = gt.val(); fr = n.Utility.Util.getValueOfInt(ci.getValue()); srchText = pu.val(); v != null && v != undefined && v != "" && n.DB.to_date(v); c != null && c != undefined && c != "" && n.DB.to_date(c); t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/GetInvoice", data: { AD_Org_ID: AD_Org_ID, _C_Currency_ID: g, _C_BPartner_ID: lt, isInterBPartner: uu, chk: i, date: r, page: ar, size: ri, docNo: ne, c_docType_ID: ur, docBaseType: docBaseType, PaymentMethod_ID: fr, fromDate: v, toDate: c, conversionDate: ro, srchText: srchText, isInterComp: tr }, async: !0, success: function (n) { var t = JSON.parse(n), r, u; if (t) { if (ar == 1 && t.length > 0 && (vf = t[0].InvoiceRecord, hu = Math.ceil(vf / ri)), ut.length > 0) { for (cr = ut.length, r = 0; r < t.length; r++)u = ut.filter(function (n) { return n.C_InvoicePaySchedule_ID == t[r].C_InvoicePaySchedule_ID }), u.length == 0 && (t[r].recid = ut.length + r, ut.push(t[r])); t = ut; ut = [] } ws(t, i); ce = 9; fu = 10; le = 13; of = 14; uf.find("#grid_openformatgridinvoice_" + e.windowNo + "_records").on("scroll", ao); kr = !0; pe() } }, error: function () { a[0].style.visibility = "hidden" } }) } } function kh() { k.empty(); p.empty(); k.append("<option value=0><\/option>"); p.append("<option value=0><\/option>"); k.append('<option value="C">' + n.translatedTexts.C_Cash_ID + "<\/option>"); p.append('<option value="C">' + n.translatedTexts.C_Cash_ID + "<\/option>"); k.append('<option value="I">' + n.translatedTexts.C_Invoice_ID + "<\/option>"); p.append('<option value="I">' + n.translatedTexts.C_Invoice_ID + "<\/option>"); k.append('<option value="G">' + n.translatedTexts.GL_Journal_ID + "<\/option>"); p.append('<option value="G">' + n.translatedTexts.GL_Journal_ID + "<\/option>"); k.append('<option value="P">' + n.translatedTexts.C_Payment_ID + "<\/option>"); p.append('<option value="P">' + n.translatedTexts.C_Payment_ID + "<\/option>") } function dh() { var o = t('<div class="vis-allocation-leftControls">'), v, f, u; o.append('<div class="input-group vis-input-wrap"><div class="vis-control-wrap"><select class="vis-allocation-currencycmb" id=VIS_Org_' + e.windowNo + '><\/select><label title="View organization" >' + n.translatedTexts.AD_Org_ID + "<\/label>"); var h = t('<div class="vis-allocation-leftControls">'), i = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'), c = t('<div class="input-group-append">'); h.append(i); i.append(r); i.append(c); r.append(y.getControl().addClass("vis-allocation-bpartner").attr("data-placeholder", "").attr("placeholder", " ").attr("data-hasbtn", " ")).append("<label>" + n.translatedTexts.C_BPartner_ID + "<\/label>"); c.append(y.getBtn(0)); var a = t('<div class="vis-allocation-leftControls">'), i = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); a.append(i); i.append(r); r.append(st).append("<label>" + n.translatedTexts.C_Currency_ID + "<\/label>"); et.append(o).append(h).append(a); v = t('<div class="vis-allocation-leftControls"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><label class="vis-ec-col-lblchkbox"><input name="vchkMultiCurrency" class="vis-allocation-multicheckbox" type="checkbox">' + n.Msg.getMsg("MultiCurrency") + '<\/label><\/div><\/div><\/div><div class="vis-allocation-leftControls" id = VIS_cnvrDateDiv_' + e.windowNo + ' ><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input  class="vis-allocation-date" style="display:block;" id=VIS_cmbConversionDate_' + e.windowNo + ' type="date" max="9999-12-31"><label title="View allocation will be created on this date" type="date" >' + n.Msg.getMsg("ConversionDate") + "<\/label><\/div><\/div><\/div>"); et.append(v); var w = t('<div class="vis-allocation-leftControls">'), i = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); w.append(i); i.append(r); r.append(k).append("<label> " + n.Msg.getMsg("AllocationFrom") + "<\/label>"); var b = t('<div class="vis-allocation-leftControls">'), i = t('<div class="input-group vis-input-wrap">'), r = t('<div class="vis-control-wrap">'); b.append(i); i.append(r); r.append(p).append("<label> " + n.Msg.getMsg("AllocationTo") + "<\/label>"); et.append(w).append(b); f = t('<div class="vis-allocation-leftControls" id="cashMaindiv"  style="display: none !important;"><input  class="vis-allocation-cashbox"  type="checkbox"><label>' + n.Msg.getMsg("Cash") + '<\/label><\/div><div class="vis-allocation-leftControls" id="glMaindiv" style="display: none !important;"><input  class="vis-allocation-glvoucher"  type="checkbox"><label>' + n.Msg.getMsg("GL Voucher") + '<\/label><\/div><div class="vis-allocation-leftControls"> <div class= "input-group vis-input-wrap" > <div class="vis-control-wrap"> <label class="vis-ec-col-lblchkbox"><input id=VIS_chkbxICompanyAllocation_' + e.windowNo + ' class="vis-allocation-interComp" type="checkbox">' + n.Msg.getMsg("InterCompanyAllocation") + '<\/label><\/div> <\/div> <\/div><div class="vis-allocation-leftControls"> <div class= "input-group vis-input-wrap" > <div class="vis-control-wrap"><label class="vis-ec-col-lblchkbox"><input id=VIS_chkbxBPAllocation_' + e.windowNo + ' class="vis-allocation-interBP" type="checkbox">' + n.Msg.getMsg("BPAllocation") + "<\/label><\/div><\/div> <\/div>"); et.append(f); f.find(".panel-body").append('<div class="vis-allocation-leftControls"><div class="vis-allocation-leftControls"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input  class="vis-allocation-toDate"  type="date"><label>' + n.Msg.getMsg("VIS_ToDate") + "<\/label><\/div><\/div><\/div>"); s = et.find(".vis-allocation-multicheckbox"); fe = et.find(".vis-allocation-cashbox"); ef = et.find(".vis-allocation-glvoucher"); re = et.find(".vis-allocation-glinvoice"); gf = et.find(".vis-allocation-docNo"); u = t('<div class="vis-allocation-resultdiv">'); u.append('<div class="vis-allocation-leftControls"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"> <select class="vis-allocation-currencycmb" id=VIS_cmbOrg_' + e.windowNo + '><\/select><label title="View allocation will be created in this organization" >' + n.translatedTexts.AD_OrgTrx_ID + "<\/label>"); u.append('<div class="vis-allocation-leftControls"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input  class="vis-allocation-date" disabled  id=VIS_cmbDate_' + e.windowNo + ' type="date"><label title="View allocation will be created on this date" type="date" >' + n.Msg.getMsg("TransactionDate") + "<\/label><\/div><\/div><\/div>"); u.append('<div class="vis-allocation-leftControls"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input  class="vis-allocation-date" disabled id=VIS_cmbAcctDate_' + e.windowNo + ' type="date"><label title="View allocation will be created on this date" type="date" >' + n.Msg.getMsg("DateAcct") + "<\/label><\/div><\/div><\/div>"); et.append(u); ft = et.find("#VIS_cmbDate_" + e.windowNo); ft.val(Globalize.format(new Date, "yyyy-MM-dd")); oi = et.find("#VIS_cmbAcctDate_" + e.windowNo); oi.val(Globalize.format(new Date, "yyyy-MM-dd")); l = et.find("#VIS_cmbConversionDate_" + e.windowNo); se = et.find("#VIS_cnvrDateDiv_" + e.windowNo); se.css("display", "none"); d = et.find("#VIS_cmbOrg_" + e.windowNo); ii = et.find("#VIS_Org_" + e.windowNo); ee = et.find("#VIS_chkbxBPAllocation_" + e.windowNo); oe = et.find("#VIS_chkbxICompanyAllocation_" + e.windowNo) } function gh() { it.append('<div class="d-flex doc-allocation"><div class="vis-doc-AllocOuter-wrap"><div><p>' + n.translatedTexts.C_Payment_ID + '<\/p>  <input type="checkbox" id="paymentselectall" /><p style="margin: 0 4px;"><\/p> <span id="pclrbutton_' + e.windowNo + '" style="cursor: pointer;margin: 2px 0 0;" class="glyphicon glyphicon-refresh" title=' + n.Msg.getMsg("Reset") + '><\/span><\/div><p class="vis-allocate-paymentSum"> 0 ' + n.Msg.getMsg("SelectedLines") + " - " + ti + ' 0.00<\/p><\/div> <div class="vis-allocation-topFields-wrap"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input placeholder="' + n.Msg.getMsg("SearchResults") + '" data-hasbtn=" " type="text" id="paySrch' + e.windowNo + '" /><label>' + n.Msg.getMsg("SearchResults") + '<\/label><\/div><div class="input-group-append"><a class="input-group-text" id="_SrchpBtn_' + e.windowNo + '"><span class="glyphicon glyphicon-search"><\/span><\/a><\/div><\/div><div class="input-group vis-input-wrap" id="docType_' + e.windowNo + '"><\/div><div class="payBaseType input-group vis-input-wrap" id="docbaseType_' + e.windowNo + '"><\/div><div class="payMethod input-group vis-input-wrap" id="payPayMethod_' + e.windowNo + '"><\/div><div class="vis-fdate-allocation input-group vis-input-wrap"><\/div><div class="vis-tdate-allocation input-group vis-input-wrap"><\/div><\/div><\/div> ').append(' <div class= "vis-allocation-payment-grid" ><\/div> '); tf = it.find(".vis-allocation-payment-grid"); fo = it.find(".vis-allocate-paymentSum"); er = it.find("#paymentselectall"); yu = it.find("#paySrch" + e.windowNo + ""); ko = it.find("#_SrchpBtn_" + e.windowNo + ""); it.find("#docType_" + e.windowNo + "").append(t('<div class="vis-control-wrap">').append(bt).append("<label>" + n.translatedTexts.DocType + "<\/label>")); it.find("#docbaseType_" + e.windowNo + "").append(t('<div class="vis-control-wrap">').append(ni).append("<label>" + n.translatedTexts.DocBaseType + "<\/label>")); it.find("#payPayMethod_" + e.windowNo + "").append(t('<div class="vis-control-wrap">').append(li.getControl()).append("<label>" + n.translatedTexts.PaymentMethod + "<\/label>")); it.find(".vis-fdate-allocation").append(t('<div class="vis-control-wrap">').append(ki).append("<label>" + n.translatedTexts.FromDate + "<\/label>")); it.find(".vis-tdate-allocation").append(t('<div class="vis-control-wrap">').append(vi).append("<label>" + n.Msg.getMsg("ToDate") + "<\/label>")); us = it.find("#pclrbutton_" + e.windowNo) } function nc() { ot.append('<div class="d-flex cash-allocation"><div class="vis-doc-AllocOuter-wrap"><div><p>' + n.translatedTexts.C_CashLine_ID + '<\/p> <input type="checkbox" id="cashselectall" /><p style="margin: 0 4px;"><\/p> <span id="cclrbutton_' + e.windowNo + '" style="cursor: pointer;margin: 2px 0 0;" class="glyphicon glyphicon-refresh"  title=' + n.Msg.getMsg("Reset") + '><\/span><\/div><p class="vis-allocate-cashSum"> 0 ' + n.Msg.getMsg("SelectedLines") + " - " + ti + ' 0.00<\/p><\/div><div class="vis-allocation-topFields-wrap"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input placeholder="' + n.Msg.getMsg("SearchResults") + '" data-hasbtn=" " type="text" id="cashSrch' + e.windowNo + '" /><label>' + n.Msg.getMsg("SearchResults") + '<\/label><\/div><div class="input-group-append"><a class="input-group-text" id="_SrchcBtn_' + e.windowNo + '"><span class="glyphicon glyphicon-search"><\/span><\/a><\/div><\/div><div class="input-group vis-input-wrap payType" id="_paymentType' + e.windowNo + '"><\/div><div class="input-group vis-input-wrap vis-fdate-allocation"><\/div><div class="input-group vis-input-wrap vis-tdate-allocation"><\/div><\/div><\/div>').append('<div  class="vis-allocation-cashLine-grid"><\/div>'); rf = ot.find(".vis-allocation-cashLine-grid"); eo = ot.find(".vis-allocate-cashSum"); or = ot.find("#cashselectall"); wu = ot.find("#cashSrch" + e.windowNo + ""); ns = ot.find("#_SrchcBtn_" + e.windowNo + ""); ot.find("#_paymentType" + e.windowNo + "").append(t('<div class="vis-control-wrap">').append(dt).append("<label>" + n.translatedTexts.Payment_Type + "<\/label>")); ot.find(".vis-fdate-allocation").append(t('<div class="vis-control-wrap">').append(di).append("<label>" + n.translatedTexts.FromDate + "<\/label>")); ot.find(".vis-tdate-allocation").append(t('<div class="vis-control-wrap">').append(yi).append("<label>" + n.Msg.getMsg("ToDate") + "<\/label>")); rs = ot.find("#cclrbutton_" + e.windowNo) } function tc() { ct.append('<div class="d-flex in-allocation"><div class="vis-doc-AllocOuter-wrap"><div><span>' + n.translatedTexts.C_Invoice_ID + '<\/span> <input type="checkbox" id="invoiceselectall" /><span style="margin: 0 4px;"><\/span> <span id="clrbutton_' + e.windowNo + '" style="cursor: pointer;margin: 2px 0 0;" class="glyphicon glyphicon-refresh"  title=' + n.Msg.getMsg("Reset") + '><\/span><\/div><p class="vis-allocate-invoiceSum"> 0' + n.Msg.getMsg("SelectedLines") + " - " + ti + ' 0.00<\/p><\/div><div class="vis-allocation-topFields-wrap"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input placeholder="' + n.Msg.getMsg("SearchResults") + '" data-hasbtn=" " type="text" id="invSrch' + e.windowNo + '" /><label>' + n.Msg.getMsg("SearchResults") + '<\/label><\/div><div class="input-group-append"><a class="input-group-text" id="_SrchBtn_' + e.windowNo + '"><span class="glyphicon glyphicon-search"><\/span><\/a><\/div><\/div><div class="input-group vis-input-wrap" id="docType' + e.windowNo + '"><\/div><div class="invBaseType input-group vis-input-wrap" id="invbaseType_' + e.windowNo + '"><\/div><div class="payMethod input-group vis-input-wrap" id="invPayMethod_' + e.windowNo + '"><\/div><div class="vis-fdate-allocation input-group vis-input-wrap"><\/div><div class="vis-tdate-allocation input-group vis-input-wrap"><\/div><\/div><\/div>').append('<div  class="vis-allocation-invoice-grid"><\/div>'); uf = ct.find(".vis-allocation-invoice-grid"); oo = ct.find(".vis-allocate-invoiceSum"); wi = ct.find("#invoiceselectall"); pu = ct.find("#invSrch" + e.windowNo + ""); go = ct.find("#_SrchBtn_" + e.windowNo + ""); ct.find("#docType" + e.windowNo + "").append(t('<div class="vis-control-wrap">').append(wt).append("<label>" + n.translatedTexts.DocType + "<\/label>")); ct.find("#invbaseType_" + e.windowNo + "").append(t('<div class="vis-control-wrap">').append(gt).append("<label>" + n.translatedTexts.DocBaseType + "<\/label>")); ct.find("#invPayMethod_" + e.windowNo + "").append(t('<div class="vis-control-wrap">').append(ci.getControl()).append("<label>" + n.translatedTexts.PaymentMethod + "<\/label>")); ct.find(".vis-fdate-allocation").append(t('<div class="vis-control-wrap">').append(ai).append("<label>" + n.translatedTexts.FromDate + "<\/label>")); ct.find(".vis-tdate-allocation").append(t('<div class="vis-control-wrap">').append(ui).append("<label>" + n.Msg.getMsg("ToDate") + "<\/label>")); fs = ct.find("#clrbutton_" + e.windowNo) } function ic() { yt.append('<div class="d-flex  gl-allocation"><div class="vis-doc-AllocOuter-wrap"><div><span>' + n.translatedTexts.GL_Journal_ID + '<\/span> <input type="checkbox" id="glselectall" /><span style="margin: 0 4px;"><\/span> <span id="gclrbutton_' + e.windowNo + '" style="cursor: pointer;margin: 2px 0 0;" class="glyphicon glyphicon-refresh"  title=' + n.Msg.getMsg("Reset") + '><\/span><\/div><p class="vis-allocate-glSum"> 0' + n.Msg.getMsg("SelectedLines") + " - " + ti + ' 0.00<\/p><\/div><div class="vis-allocation-topFields-wrap"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input placeholder="' + n.Msg.getMsg("SearchResults") + '" data-hasbtn=" " type="text" id="glSrch' + e.windowNo + '" /><label>' + n.Msg.getMsg("SearchResults") + '<\/label><\/div><div class="input-group-append"><a class="input-group-text" id="_SrchglBtn_' + e.windowNo + '"><span class="glyphicon glyphicon-search"><\/span><\/a><\/div><\/div><div class="input-group vis-input-wrap vis-fdate-allocation"><\/div><div class="input-group vis-input-wrap vis-tdate-allocation"><\/div><\/div><\/div>').append('<div  class="vis-allocation-gl-grid"><\/div>'); ff = yt.find(".vis-allocation-gl-grid"); ue = yt.find(".vis-allocate-glSum"); fi = yt.find("#glselectall"); hf = yt.find("#glSrch" + e.windowNo + ""); ts = yt.find("#_SrchglBtn_" + e.windowNo + ""); yt.find(".vis-fdate-allocation").append(t('<div class="vis-control-wrap">').append(gi).append("<label>" + n.translatedTexts.FromDate + "<\/label>")); yt.find(".vis-tdate-allocation").append(t('<div class="vis-control-wrap">').append(pi).append("<label>" + n.Msg.getMsg("ToDate") + "<\/label>")); is = yt.find("#gclrbutton_" + e.windowNo) } function rc() { t.ajax({ type: "POST", url: n.Application.contextUrl + "VIS/PaymentAllocation/GetOrg", dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (ii.empty(), n.Env.getCtx().getAD_Org_ID() != 0 && ii.append("<option value=" + n.Env.getCtx().getAD_Org_ID() + ">" + n.Env.getCtx().ctx["#AD_Org_Name"] + "<\/option>"), i = 0; i < r.length; i++)r[i].Value != n.Env.getCtx().getAD_Org_ID() && (OrgName = n.Utility.Util.getValueOfString(r[i].Name), AD_Org_ID = n.Utility.Util.getValueOfInt(r[i].Value), ii.append(" <option value=" + AD_Org_ID + ">" + OrgName + "<\/option>")); else ii.append("<option value=0><\/option>"); n.context.getContextAsInt("#AD_Org_ID") > 0 ? (ii.val(n.context.getContextAsInt("#AD_Org_ID")), ii.removeClass("vis-ev-col-mandatory")) : ii.prop("selectedIndex", 0) }, error: function (n) { console.log(n) } }) } function uc() { t.ajax({ type: "POST", url: n.Application.contextUrl + "VIS/PaymentAllocation/GetOrganization", dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (d.empty(), d.addClass("vis-ev-col-mandatory"), d.append("<option value=0><\/option>"), i = 0; i < r.length; i++)OrgName = n.Utility.Util.getValueOfString(r[i].Name), AD_Org_ID = n.Utility.Util.getValueOfInt(r[i].Value), d.append(" <option value=" + AD_Org_ID + ">" + OrgName + "<\/option>"); else d.append("<option value=0><\/option>"); n.context.getContextAsInt("#AD_Org_ID") > 0 ? (d.val(n.context.getContextAsInt("#AD_Org_ID")), d.removeClass("vis-ev-col-mandatory")) : d.prop("selectedIndex", 0) }, error: function (n) { console.log(n) } }) } function fc() { a = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); a[0].style.visibility = "hidden"; iu.append(a) } function ku() { var t; if (lt != 0 && g != 0) { y.getControl().removeClass("vis-ev-col-mandatory"); a[0].style.visibility = "visible"; ar = 1; hu = 1; vf = 0; vr = 1; cu = 1; yf = 0; yr = 1; lu = 1; pf = 0; pr = 1; au = 1; wf = 0; lr == !0 ? (wr == !0, br == !0, kr == !0, dr == !0, lr = !1) : (wr = !1, br = !1, kr = !1, dr = !1); vt = 0; t = null; tt = ft.val(); t = tt != null && tt != undefined && tt != "" ? n.DB.to_date(tt) : n.DB.to_date(new Date); var i = s.is(":checked"), r = tu.getAD_Role_ID(), u = tu.getAD_User_ID(), f = n.MRole.getDefault(), e = lt; bi(); nu(); si(); yo(); k.val("P"); k.trigger("change"); p.val("P"); p.trigger("change"); k.val() == 0 && k.val() == 0 ? w() : bf(k.val(), p.val()) } } function bi() { if (AD_Org_ID = ii.val(), g = st.val(), lt != 0 && g != 0) { if (v = ki.val(), c = vi.val(), c != "" && v > c) return vi.val(""), n.ADialog.info("Message", !0, n.Msg.getMsg("VIS_FromDateGreater"), ""); yr = 1; lu = 1; pf = 0; wr = !1; var i = s.is(":checked"); ur = bt.val(); docBaseType = ni.val(); fr = n.Utility.Util.getValueOfInt(li.getValue()); srchText = yu.val(); a[0].style.visibility = "visible"; v != null && v != undefined && v != "" && n.DB.to_date(v); c != null && c != undefined && c != "" && n.DB.to_date(c); t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/GetPayments", data: { AD_Org_ID: AD_Org_ID, _C_Currency_ID: g, _C_BPartner_ID: lt, isInterBPartner: uu, chk: i, page: yr, size: ri, c_docType_ID: ur, docBaseType: docBaseType, PaymentMethod_ID: fr, fromDate: v, toDate: c, srchText: srchText, isInterComp: tr }, async: !0, success: function (n) { var t = JSON.parse(n), r, u; if (t) { if (yr == 1 && t.length > 0 && (pf = t[0].PaymentRecord, lu = Math.ceil(pf / ri)), ht.length > 0) { for (hr = ht.length, r = 0; r < t.length; r++)u = ht.filter(function (n) { return n.CpaymentID == t[r].CpaymentID }), u.length == 0 && (t[r].recid = ht.length + r, ht.push(t[r])); t = ht; ht = [] } ys(t, i); tf.find("#grid_openformatgrid_" + e.windowNo + "_records").on("scroll", co); wr = !0; pe() } }, error: function () { a[0].style.visibility = "hidden" } }) } } function nu() { if (g = st.val(), lt != 0 && g != 0) { if (vr = 1, cu = 1, yf = 0, br = !1, AD_Org_ID = ii.val(), v = di.val(), c = yi.val(), paymentType = dt.val(), srchText = wu.val(), c != "" && v > c) return yi.val(""), n.ADialog.info("Message", !0, n.Msg.getMsg("VIS_FromDateGreater"), ""); var i = s.is(":checked"); v != null && v != undefined && v != "" && n.DB.to_date(v); c != null && c != undefined && c != "" && n.DB.to_date(c); a[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/GetCashJounral", data: { AD_Org_ID: AD_Org_ID, _C_Currency_ID: g, _C_BPartner_ID: lt, isInterBPartner: uu, chk: i, page: vr, size: ri, fromDate: v, toDate: c, paymentType_ID: paymentType, srchText: srchText, isInterComp: tr }, async: !0, success: function (n) { var t = JSON.parse(n), r, u; if (t) { if (vr == 1 && t.length > 0 && (yf = t[0].CashRecord, cu = Math.ceil(yf / ri)), at.length > 0) { for (cf = at.length, r = 0; r < t.length; r++)u = at.filter(function (n) { return n.CcashlineiID == t[r].CcashlineiID }), u.length == 0 && (t[r].recid = at.length + r, at.push(t[r])); t = at; at = [] } ps(t, i); rf.find("#grid_openformatgridcash_" + e.windowNo + "_records").on("scroll", lo); br = !0; pe() } }, error: function () { a[0].style.visibility = "hidden" } }) } } function ec() { t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/GetCurrencyPrecision", data: { _C_Currency_ID: g }, async: !0, success: function (n) { var t = JSON.parse(n); t && (o = t) }, error: function () { } }) } function pe() { a[0].style.visibility = wr == !0 && br == !0 && kr == !0 && dr == !0 ? "hidden" : "visible" } function ho() { t(this).scrollTop() > 0 && (a[0].style.visibility = "visible", t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && pr < au && (pr++, oc(pr, ri)), a[0].style.visibility = "hidden") } function oc(i, r) { var f = s.is(":checked"), u; if (g = st.val(), g == 0) return n.ADialog.info("Message", !0, "select currency", ""); u = null; tt = ft.val(); u = tt != null && tt != undefined && tt != "" ? n.DB.to_date(tt) : n.DB.to_date(new Date); v != null && v != undefined && v != "" && n.DB.to_date(v); c != null && c != undefined && c != "" && n.DB.to_date(c); t.ajax({ url: n.Application.contextUrl + "VIS/PaymentAllocation/GetGLData", dataType: "json", data: { AD_Org_ID: AD_Org_ID, _C_Currency_ID: g, _C_BPartner_ID: lt, page: i, size: r, fromDate: v, toDate: c, srchText: srchText, chk: f, isInterComp: tr }, async: !0, success: function (n) { var t = JSON.parse(n), i, r; if (t) { if (rt.length > 0) { for (sr = rt.length, i = 0; i < t.length; i++)r = rt.filter(function (n) { return n.GL_JOURNALLINE_ID == t[i].GL_JOURNALLINE_ID }), r.length == 0 && (t[i].recid = rt.length + i, rt.push(t[i])); t = rt; rt = [] } lc(t) } }, error: function () { } }) } function co() { t(this).scrollTop() > 0 && (a[0].style.visibility = "visible", t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && yr < lu && (yr++, sc(yr, ri)), a[0].style.visibility = "hidden") } function sc(i, r) { if (g = st.val(), g == 0) return n.ADialog.info("Message", !0, "select currency", ""); var f = s.is(":checked"), e = null; tt = ft.val(); e = tt != null && tt != undefined && tt != "" ? n.DB.to_date(tt) : n.DB.to_date(new Date); ur = bt.val(); docBaseType = ni.val(); fr = n.Utility.Util.getValueOfInt(li.getValue()); srchText = yu.val(); v != null && v != undefined && v != "" && n.DB.to_date(v); c != null && c != undefined && c != "" && n.DB.to_date(c); t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/GetPayments", data: { AD_Org_ID: AD_Org_ID, _C_Currency_ID: g, _C_BPartner_ID: lt, isInterBPartner: uu, chk: f, page: i, size: r, c_docType_ID: ur, docBaseType: docBaseType, PaymentMethod_ID: fr, fromDate: v, toDate: c, srchText: srchText, isInterComp: tr }, async: !0, success: function (n) { var t = JSON.parse(n), f, r, i, e; if (t) { if (f = u.records.length, r = [], ht.length > 0) { for (hr = ht.length, i = 0; i < t.length; i++)e = ht.filter(function (n) { return n.CpaymentID == t[i].CpaymentID }), e.length == 0 && (t[i].recid = f + i, r.push(t[i])); t = r; ht = []; r = [] } ac(t) } }, error: function () { } }) } function lo() { t(this).scrollTop() > 0 && (a[0].style.visibility = "visible", t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && vr < cu && (vr++, hc(vr, ri)), a[0].style.visibility = "hidden") } function hc(i, r) { if (g = st.val(), g == 0) return n.ADialog.info("Message", !0, "select currency", ""); var u = s.is(":checked"), e = null; tt = ft.val(); paymentType = dt.val(); srchText = wu.val(); e = tt != null && tt != undefined && tt != "" ? n.DB.to_date(tt) : n.DB.to_date(new Date); v != null && v != undefined && v != "" && n.DB.to_date(v); c != null && c != undefined && c != "" && n.DB.to_date(c); t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/GetCashJounral", data: { AD_Org_ID: AD_Org_ID, _C_Currency_ID: g, _C_BPartner_ID: lt, isInterBPartner: uu, chk: u, page: i, size: r, fromDate: v, toDate: c, paymentType_ID: paymentType, srchText: srchText, isInterComp: tr }, async: !0, success: function (n) { var t = JSON.parse(n), u, r, i, e; if (t) { if (u = f.records.length, r = [], at.length > 0) { for (cf = at.length, i = 0; i < t.length; i++)e = at.filter(function (n) { return n.CcashlineiID == t[i].CcashlineiID }), e.length == 0 && (t[i].recid = u + i, r.push(t[i])); t = r; at = []; r = [] } vc(t) } }, error: function () { } }) } function ao() { t(this).scrollTop() > 0 && (a[0].style.visibility = "visible", t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && ar < hu && (ar++, cc(ar, ri)), a[0].style.visibility = "hidden") } function cc(r, u) { var e = s.is(":checked"), f = null; if (tt = ft.val(), f = tt != null && tt != undefined && tt != "" ? n.DB.to_date(tt) : n.DB.to_date(new Date), ne = gf.val(), g = st.val(), g == 0) return n.ADialog.info("Message", !0, "select currency", ""); ur = wt.val(); docBaseType = gt.val(); fr = n.Utility.Util.getValueOfInt(ci.getValue()); srchText = pu.val(); v != null && v != undefined && v != "" && n.DB.to_date(v); c != null && c != undefined && c != "" && n.DB.to_date(c); t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/GetInvoice", data: { AD_Org_ID: AD_Org_ID, _C_Currency_ID: g, _C_BPartner_ID: lt, isInterBPartner: uu, chk: e, date: f, page: r, size: u, docNo: ne, c_docType_ID: ur, docBaseType: docBaseType, PaymentMethod_ID: fr, fromDate: v, toDate: c, conversionDate: ro, srchText: srchText, isInterComp: tr }, async: !0, success: function (n) { var t = JSON.parse(n), u, f, r, e; if (t) { if (u = [], f = i.records.length, ut.length > 0) { for (cr = ut.length, r = 0; r < t.length; r++)e = ut.filter(function (n) { return n.C_InvoicePaySchedule_ID == t[r].C_InvoicePaySchedule_ID }), e.length == 0 && (t[r].recid = f + r, u.push(t[r])); t = u; ut = []; u = [] } yc(t); ce = 9; fu = 10; le = 13; of = 14 } }, error: function () { } }) } function lc(i) { var o = [], s = [], a, f, h, c, l, u, v, y; for (i.length > 0 && (s = Object.keys(i[0])), a = 0, r.records.length > 0 && (a = r.records.length), f = 0; f < i.length; f++) { for (h = {}, h.recid = a + f, c = 0; c < s.length; c++)l = s[c], h[l] = l == "SelectRow" ? !1 : n.Utility.encodeText(i[f][l]); o.push(h) } if (w2utils.encodeTags(o), r.add(o), sr > 0) for (u = 0; u < sr; u++)v = t("#grid_" + r.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(v[u]).prop("checked", !0), r.editChange.call(r, v[u], u, 0, event), y = { type: "click", phase: "before", target: "grid", recid: u, index: u, isStopped: !1, "isCan//celled": !1, onComplete: null }, r.trigger(y); sr = 0; o = []; s = []; ff.find("#grid_openformatglgrid_" + e.windowNo + "_records").on("scroll", ho) } function vs(i, u) { var f = [], y, c, h, l, a, v, s, u, p; for (f.push({ field: "SelectRow", caption: n.translatedTexts.VIS_Check, size: "50px", editable: { type: "checkbox" } }), f.push({ field: "AD_Org_ID", caption: n.translatedTexts.AD_Org_ID, size: "85px", hidden: !0 }), f.push({ field: "OrgName", caption: n.translatedTexts.AD_Org_ID, size: "105px", hidden: !1, sortable: !1 }), f.push({ field: "DATEACCT", caption: n.translatedTexts.DateAcct, render: function (n) { var t = n.DATEACCT; return new Date(t).toLocaleDateString() }, size: "105px", hidden: !1, sortable: !1 }), f.push({ field: "DOCUMENTNO", caption: n.translatedTexts.DocumentNo, size: "120px", hidden: !1, sortable: !1 }), f.push({ field: "Account", caption: n.translatedTexts.Account, size: "150px", hidden: !1, sortable: !1 }), f.push({ field: "Isocode", caption: n.translatedTexts.TrxCurrency, size: "105px", hidden: !1 }), f.push({ field: "ConversionName", caption: n.translatedTexts.C_ConversionType_ID, size: "105px", hidden: !1, sortable: !1 }), f.push({ field: "ConvertedAmount", caption: n.Msg.getMsg("Amount"), attr: "align=right", size: "150px", hidden: !1, sortable: !1, render: function (n) { var t = n.ConvertedAmount; return parseFloat(t).toLocaleString(navigator.language, { maximumFractionDigits: o, minimumFractionDigits: o }) } }), f.push({ field: "OpenAmount", caption: n.translatedTexts.OpenAmount, attr: "align=right", size: "150px", hidden: !1, sortable: !1, render: function (n) { var t = n.OpenAmount; return parseFloat(t).toLocaleString(navigator.language, { maximumFractionDigits: o, minimumFractionDigits: o }) } }), f.push({ field: "AppliedAmt", caption: n.translatedTexts.AppliedAmount, size: "150px", attr: "align=right", hidden: !1, sortable: !1, render: function (n) { var t = n.AppliedAmt; return parseFloat(t).toLocaleString(navigator.language, { maximumFractionDigits: o, minimumFractionDigits: o }) } }), f.push({ field: "DATEDOC", caption: n.translatedTexts.Date, render: function (n) { var t = n.DATEDOC; return new Date(t).toLocaleDateString() }, size: "80px", hidden: !0 }), f.push({ field: "GL_JOURNALLINE_ID", caption: n.translatedTexts.GL_JOURNALLINE_ID, size: "150px", hidden: !0 }), f.push({ field: "C_ConversionType_ID", caption: n.translatedTexts.C_ConversionType_ID, size: "85px", hidden: !0 }), f.push({ field: "GL_Journal_ID", caption: n.translatedTexts.C_ConversionType_ID, size: "85px", hidden: !0 }), y = [], c = [], i.length > 0 && (c = Object.keys(i[0])), h = 0; h < i.length; h++) { for (l = {}, l.recid = h, a = 0; a < c.length; a++)v = c[a], l[v] = v == "SelectRow" ? !1 : n.Utility.encodeText(i[h][v]); y.push(l) } if (r != undefined && r != null && (r.destroy(), r = null), r = ff.w2grid({ name: "openformatglgrid_" + e.windowNo, multiSelect: !0, columns: f, records: y, onChange: function (n) { be(n, !1, !1, !1, !0) && il(n) }, onClick: function (n) { nl(n); rr() }, onDblClick: function (n) { n.preventDefault(); return }, onSelect: function (n) { n.all && (n.onComplete = function () { ff.find("#grid_openformatglgrid_" + e.windowNo + "_records").on("scroll", ho) }) }, onEditField: function (n) { n.onComplete = function (n) { id = n.recid; t("#grid_openformatglgrid_" + e.windowNo + "_edit_" + id + "_10").keydown(function (n) { var t = ye.isDecimalSeparatorDot(window.navigator.language); if (t || n.keyCode != 190 && n.keyCode != 110) { if (t && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(".", "")), n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } } }), sr > 0) for (s = 0; s < sr; s++)u = t("#grid_" + r.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(u[s]).prop("checked", !0), r.editChange.call(r, u[s], s, 0, event), p = { type: "click", phase: "before", target: "grid", recid: s, index: s, isStopped: !1, "isCan//celled": !1, onComplete: null }, r.trigger(p); sr = 0; r.autoLoad = !0; t(t(r.box)[0]).find(".w2ui-search-down").css("margin-top", "4px"); t(t(r.box)[0]).find(".w2ui-search-clear").css("margin-top", "4px") } function ys(i, r) { var f = [], y, c, h, l, a, v, s, r, p; for (f.push({ field: "SelectRow", caption: n.translatedTexts.VIS_Check, size: "50px", editable: { type: "checkbox" } }), f.push({ field: "AD_Org_ID", caption: n.translatedTexts.AD_Org_ID, size: "85px", hidden: !0 }), f.push({ field: "OrgName", caption: n.translatedTexts.AD_Org_ID, size: "85px", hidden: !1 }), f.push({ field: "DATEACCT", caption: n.translatedTexts.DateAcct, size: "85px", hidden: !1, render: function (n) { var t = n.DATEACCT; return new Date(t).toLocaleDateString() } }), f.push({ field: "Documentno", caption: n.translatedTexts.DocumentNo, size: "120px", hidden: !1 }), f.push({ field: "DocBaseType", caption: n.translatedTexts.DocBaseType, size: "120px", hidden: !1 }), f.push({ field: "PayName", caption: n.translatedTexts.PaymentMethod, size: "120px", hidden: !1 }), f.push({ field: "Isocode", caption: n.translatedTexts.TrxCurrency, size: "85px", hidden: !1 }), f.push({ field: "ConversionName", caption: n.translatedTexts.C_ConversionType_ID, size: "85px", hidden: !1 }), r ? f.push({ field: "Payment", caption: n.translatedTexts.Amount, size: "150px", attr: "align=right", hidden: !1, render: function (n) { var t = n.Payment; return parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } }) : f.push({ field: "Payment", caption: n.translatedTexts.Amount, size: "150px", hidden: !0 }), f.push({ field: "ConvertedAmount", caption: n.translatedTexts.ConvertedAmount, size: "150px", attr: "align=right", hidden: !1, render: function (n) { var t = n.ConvertedAmount; return parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } }), f.push({ field: "OpenAmt", caption: n.translatedTexts.OpenAmount, size: "150px", attr: "align=right", hidden: !1, render: function (n) { var t = n.OpenAmt; return parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } }), f.push({ field: "Multiplierap", caption: n.translatedTexts.multiplierap, size: "150px", hidden: !0 }), f.push({ field: "AppliedAmt", caption: n.translatedTexts.AppliedAmount, size: "150px", attr: "align=right", hidden: !1, render: function (n) { var t = n.AppliedAmt; return t = kf(event, t, t), parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) }, editable: { type: "number" } }), f.push({ field: "Date1", caption: n.translatedTexts.Date, size: "80px", hidden: !0, render: function (n) { var t = n.Date1; return new Date(t).toLocaleDateString() } }), f.push({ field: "CpaymentID", caption: n.translatedTexts.c_payment_id, size: "150px", hidden: !0 }), f.push({ field: "C_ConversionType_ID", caption: n.translatedTexts.C_ConversionType_ID, size: "85px", hidden: !0 }), y = [], c = [], i.length > 0 && (c = Object.keys(i[0])), h = 0; h < i.length; h++) { for (l = {}, l.recid = h, a = 0; a < c.length; a++)v = c[a], l[v] = v == "SelectRow" ? !1 : n.Utility.encodeText(i[h][v]); y.push(l) } if (u != undefined && u != null && (u.destroy(), u = null), u = tf.w2grid({ name: "openformatgrid_" + e.windowNo, multiSelect: !0, columns: f, records: y, onClick: function (n) { dc(n); rr() }, onChange: function (n) { be(n, !1, !0, !1, !1) && tl(n) }, onDblClick: function (n) { pc(n) }, onSelect: function (n) { n.all && (n.onComplete = function () { tf.find("#grid_openformatgrid_" + e.windowNo + "_records").on("scroll", co) }) }, onEditField: function (n) { n.onComplete = function (n) { id = n.recid; t("#grid_openformatgrid_" + e.windowNo + "_edit_" + id + "_12").keydown(function (n) { var t = ye.isDecimalSeparatorDot(window.navigator.language); if (t || n.keyCode != 190 && n.keyCode != 110) { if (t && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(".", "")), n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } } }), hr > 0) for (s = 0; s < hr; s++)r = t("#grid_" + u.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(r[s]).prop("checked", !0), u.editChange.call(u, r[s], s, 0, event), p = { type: "click", phase: "before", target: "grid", recid: s, index: s, isStopped: !1, "isCan//celled": !1, onComplete: null }, u.trigger(p); hr = 0; u.autoLoad = !0; t(t(u.box)[0]).find(".w2ui-search-down").css("margin-top", "4px"); t(t(u.box)[0]).find(".w2ui-search-clear").css("margin-top", "4px") } function ac(i) { var o = [], s = [], a, f, h, c, l, r, v, y; for (i.length > 0 && (s = Object.keys(i[0])), a = 0, u.records.length > 0 && (a = u.records.length), f = 0; f < i.length; f++) { for (h = {}, h.recid = a + f, c = 0; c < s.length; c++)l = s[c], h[l] = l == "SelectRow" ? !1 : n.Utility.encodeText(i[f][l]); o.push(h) } if (w2utils.encodeTags(o), u.add(o), hr > 0) for (r = 0; r < hr; r++)v = t("#grid_" + u.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(v[r]).prop("checked", !0), u.editChange.call(u, v[r], r, 0, event), y = { type: "click", phase: "before", target: "grid", recid: r, index: r, isStopped: !1, "isCan//celled": !1, onComplete: null }, u.trigger(y); hr = 0; o = []; s = []; tf.find("#grid_openformatgrid_" + e.windowNo + "_records").on("scroll", co) } function ps(i, r) { var u = [], y, c, h, l, a, v, s, r, p; for (u.push({ field: "SelectRow", caption: n.translatedTexts.VIS_Check, size: "50px", editable: { type: "checkbox" } }), u.push({ field: "AD_Org_ID", caption: n.translatedTexts.AD_Org_ID, size: "85px", hidden: !0 }), u.push({ field: "OrgName", caption: n.translatedTexts.AD_Org_ID, size: "105px", hidden: !1 }), u.push({ field: "DATEACCT", caption: n.translatedTexts.DateAcct, size: "105px", hidden: !1, render: function (n) { var t = n.DATEACCT; return new Date(t).toLocaleDateString() } }), u.push({ field: "ReceiptNo", caption: n.translatedTexts.RECEIPTNO, size: "120px", hidden: !1 }), u.push({ field: "VSS_paymenttype", caption: "Payment ID", size: "120px", hidden: !0 }), u.push({ field: "Payment", caption: "Payment Type", size: "120px", hidden: !1 }), u.push({ field: "Isocode", caption: n.Msg.getMsg("TrxCurrency"), size: "105px", hidden: !1 }), u.push({ field: "ConversionName", caption: n.translatedTexts.C_ConversionType_ID, size: "105px", hidden: !1 }), r ? u.push({ field: "Amount", caption: n.translatedTexts.Amount, size: "150px", attr: "align=right", hidden: !1, render: function (n) { var t = n.Amount; return parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } }) : u.push({ field: "Amount", caption: n.translatedTexts.Amount, size: "150px", hidden: !0 }), u.push({ field: "ConvertedAmount", caption: n.Msg.getMsg("ConvertedAmount"), size: "150px", attr: "align=right", hidden: !1, render: function (n) { var t = n.ConvertedAmount; return parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } }), u.push({ field: "OpenAmt", caption: n.translatedTexts.OpenAmount, size: "150px", hidden: !1, attr: "align=right", render: function (n) { var t = n.OpenAmt; return parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } }), u.push({ field: "AppliedAmt", caption: n.translatedTexts.AppliedAmount, size: "150px", attr: "align=right", hidden: !1, render: function (n) { var t = n.AppliedAmt; return t = kf(event, t, t), parseFloat(t).toLocaleString(navigator.language, { maximumFractionDigits: o, minimumFractionDigits: o }) }, editable: { type: "number" } }), u.push({ field: "Created", caption: n.translatedTexts.Date, size: "80px", hidden: !0, render: function (n) { var t = n.Created; return new Date(t).toLocaleDateString() } }), u.push({ field: "CcashlineiID", caption: n.translatedTexts.ccashlineid, size: "150px", hidden: !0 }), u.push({ field: "Multiplierap", caption: n.translatedTexts.multiplierap, hidden: !0 }), u.push({ field: "C_ConversionType_ID", caption: n.translatedTexts.C_ConversionType_ID, size: "85px", hidden: !0 }), y = [], c = [], i.length > 0 && (c = Object.keys(i[0])), h = 0; h < i.length; h++) { for (l = {}, l.recid = h, a = 0; a < c.length; a++)v = c[a], l[v] = v.toLower() == "selectrow" ? !1 : n.Utility.encodeText(i[h][v]); y.push(l) } if (f != undefined && f != null && (f.destroy(), f = null), f = rf.w2grid({ name: "openformatgridcash_" + e.windowNo, multiSelect: !0, columns: u, records: y, onChange: function (n) { be(n, !1, !1, !0, !1) && rl(n) }, onClick: function (n) { gc(n); rr() }, onDblClick: function (n) { wc(n) }, onSelect: function (n) { n.all && (n.onComplete = function () { rf.find("#grid_openformatgridcash_" + e.windowNo + "_records").on("scroll", lo) }) }, onEditField: function (n) { n.onComplete = function (n) { id = n.recid; t("#grid_openformatgridcash_" + e.windowNo + "_edit_" + id + "_12").keydown(function (n) { var t = ye.isDecimalSeparatorDot(window.navigator.language); if (t || n.keyCode != 190 && n.keyCode != 110) { if (t && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(".", "")), n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } } }), cf > 0) for (s = 0; s < cf; s++)r = t("#grid_" + f.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(r[s]).prop("checked", !0), f.editChange.call(f, r[s], s, 0, event), p = { type: "click", phase: "before", target: "grid", recid: s, index: s, isStopped: !1, "isCan//celled": !1, onComplete: null }, f.trigger(p); cf = 0; f.autoLoad = !0; t(t(f.box)[0]).find(".w2ui-search-down").css("margin-top", "4px"); t(t(f.box)[0]).find(".w2ui-search-clear").css("margin-top", "4px") } function vc(t) { var r = [], u = [], c, i, o, s, h; for (t.length > 0 && (u = Object.keys(t[0])), c = 0, f.records.length > 0 && (c = f.records.length), i = 0; i < t.length; i++) { for (o = {}, o.recid = c + i, s = 0; s < u.length; s++)h = u[s], o[h] = h.toLower() == "selectrow" ? !1 : n.Utility.encodeText(t[i][h]); r.push(o) } w2utils.encodeTags(r); f.add(r); r = []; u = []; rf.find("#grid_openformatgridcash_" + e.windowNo + "_records").on("scroll", lo) } function we(n, e, o, s, h) { var l = !0, c = null; return e ? c = t("#grid_" + i.name + '_records td[col="0"]').find('input[type="checkbox"]:checked') : o ? c = t("#grid_" + u.name + '_records td[col="0"]').find('input[type="checkbox"]:checked') : s ? c = t("#grid_" + f.name + '_records td[col="0"]').find('input[type="checkbox"]:checked') : h && (c = t("#grid_" + r.name + '_records td[col="0"]').find('input[type="checkbox"]:checked')), c != null && c.length > 50 && (t(n).prop("checked", !1), l = !1), l } function be(e, o, s, h, c) { var v = !0, l = null, a, y; return o ? l = i.name : s ? l = u.name : h ? l = f.name : c && (l = r.name), a = t("#grid_" + l + '_records td[col="0"]').find('input[type="checkbox"]:checked'), a != null && a.length > 50 && (y = t("#grid_" + l + '_records td[col="0"]').find('input[type="checkbox"]'), t(y[e.recid]).prop("checked", !1), n.ADialog.warn("VIS_MaxLimitReached"), e.preventDefault(), v = !1), v } function ws(r, u) { var f = [], y, c, h, l, a, v, s, u, p; for (f.push({ field: "SelectRow", caption: n.translatedTexts.VIS_Check, size: "50px", editable: { type: "checkbox" } }), f.push({ field: "AD_Org_ID", caption: n.translatedTexts.AD_Org_ID, size: "85px", hidden: !0 }), f.push({ field: "OrgName", caption: n.translatedTexts.AD_Org_ID, size: "105px", hidden: !1 }), f.push({ field: "DATEACCT", caption: n.translatedTexts.DateAcct, size: "105px", hidden: !1, render: function (n) { var t = n.DATEACCT; return new Date(t).toLocaleDateString() } }), f.push({ field: "Documentno", caption: n.translatedTexts.DocumentNo, size: "120px", hidden: !1 }), f.push({ field: "InvoiceScheduleDate", caption: n.translatedTexts.ScheduleDate, size: "100px", hidden: !1, render: function (n) { var t = n.InvoiceScheduleDate; return new Date(t).toLocaleDateString() } }), f.push({ field: "DocBaseType", caption: n.translatedTexts.DocBaseType, size: "120px", hidden: !1 }), f.push({ field: "PayName", caption: n.translatedTexts.PaymentMethod, size: "120px", hidden: !1 }), f.push({ field: "Isocode", caption: n.Msg.getMsg("TrxCurrency"), size: "85px", hidden: !1 }), f.push({ field: "ConversionName", caption: n.translatedTexts.C_ConversionType_ID, size: "85px", hidden: !1 }), u ? f.push({ field: "Currency", caption: n.translatedTexts.Amount, size: "100px", attr: "align=right", hidden: !1, render: function (n) { var t = n.Currency; return parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } }) : f.push({ field: "Currency", caption: n.translatedTexts.Amount, size: "100px", hidden: !0 }), f.push({ field: "Converted", caption: n.Msg.getMsg("ConvertedAmount"), size: "100px", hidden: !1, attr: "align=right", render: function (n) { var t = n.Converted; return parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } }), f.push({ field: "Amount", caption: n.translatedTexts.OpenAmount, size: "100px", hidden: !1, attr: "align=right", render: function (n) { var t = n.Amount; return parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } }), f.push({ field: "Discount", caption: n.translatedTexts.DiscountAmt, size: "100px", hidden: !1, attr: "align=right", render: function (n) { var t = n.Discount; return t = kf(event, t, t), parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) }, editable: { type: "number" } }), f.push({ field: "Date1", caption: n.translatedTexts.Date, size: "80px", hidden: !0, render: function (n) { var t = n.Date1; return new Date(t).toLocaleDateString() } }), f.push({ field: "CinvoiceID", caption: n.translatedTexts.cinvoiceid, size: "150px", hidden: !0 }), f.push({ field: "Multiplierap", caption: n.translatedTexts.multiplierap, hidden: !0 }), f.push({ field: "Writeoff", caption: n.translatedTexts.WriteOffAmount, size: "100px", attr: "align=right", hidden: !1, render: function (n) { var t = n.Writeoff; return t = kf(event, t, t), parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) }, editable: { type: "number" } }), f.push({ field: "AppliedAmt", caption: n.translatedTexts.AppliedAmount, size: "100px", hidden: !1, attr: "align=right", render: function (n) { var t = n.AppliedAmt; return t = kf(event, t, t), parseFloat(t).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) }, editable: { type: "number" } }), bu > 0 && f.push({ field: "C_InvoicePaySchedule_ID", caption: n.translatedTexts.C_InvoicePaySchedule_ID, size: "100px", hidden: !0 }), f.push({ field: "C_ConversionType_ID", caption: n.translatedTexts.C_ConversionType_ID, size: "85px", hidden: !0 }), y = [], c = [], r.length > 0 && (c = Object.keys(r[0])), h = 0; h < r.length; h++) { for (l = {}, l.recid = h, a = 0; a < c.length; a++)v = c[a], l[v] = v.toLower() == "selectrow" ? !1 : n.Utility.encodeText(r[h][v]); y.push(l) } if (i != undefined && i != null && (i.destroy(), i = null), i = uf.w2grid({ name: "openformatgridinvoice_" + e.windowNo, multiSelect: !0, columns: f, records: y, onChange: function (n) { be(n, !0, !1, !1, !1) && (ul(n), rr()) }, onClick: function (n) { kc(n); rr() }, onDblClick: function (n) { bc(n) }, onSelect: function (n) { n.all && (n.onComplete = function () { uf.find("#grid_openformatgridinvoice_" + e.windowNo + "_records").on("scroll", ao) }) }, onEditField: function (n) { n.onComplete = function (n) { id = n.recid; (n.column == 12 || n.column == 16 || n.column == 17) && t("#grid_openformatgridinvoice_" + e.windowNo + "_edit_" + id + "_" + n.column).keydown(function (n) { var t = ye.isDecimalSeparatorDot(window.navigator.language); if (t || n.keyCode != 190 && n.keyCode != 110) { if (t && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(".", "")), n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && (this.value = this.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } } }), cr > 0) for (s = 0; s < cr; s++)u = t("#grid_" + i.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(u[s]).prop("checked", !0), i.editChange.call(i, u[s], s, 0, event), p = { type: "click", phase: "before", target: "grid", recid: s, index: s, isStopped: !1, "isCan//celled": !1, onComplete: null }, i.trigger(p); cr = 0; i.autoLoad = !0; t(t(i.box)[0]).find(".w2ui-search-down").css("margin-top", "4px"); t(t(i.box)[0]).find(".w2ui-search-clear").css("margin-top", "4px") } function yc(r) { var o = [], s = [], a, f, h, c, l, u, v, y; for (r.length > 0 && (s = Object.keys(r[0])), a = 0, i.records.length > 0 && (a = i.records.length), f = 0; f < r.length; f++) { for (h = {}, h.recid = a + f, c = 0; c < s.length; c++)l = s[c], h[l] = l.toLower() == "selectrow" ? !1 : n.Utility.encodeText(r[f][l]); o.push(h) } if (w2utils.encodeTags(o), i.add(o), cr > 0) for (u = 0; u < cr; u++)v = t("#grid_" + i.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(v[u]).prop("checked", !0), i.editChange.call(i, v[u], u, 0, event), y = { type: "click", phase: "before", target: "grid", recid: u, index: u, isStopped: !1, "isCan//celled": !1, onComplete: null }, i.trigger(y); cr = 0; o = []; s = []; uf.find("#grid_openformatgridinvoice_" + e.windowNo + "_records").on("scroll", ao) } function pc(i) { var r, f; if (u.columns[i.column] == undefined) { i.preventDefault(); return } if (u.columns[i.column].field == "AppliedAmt") { if (r = u.getChanges(), r == undefined || r.length == 0) { u.columns[i.column].editable = !1; return } if (f = t.grep(r, function (n) { return parseInt(n.recid) == parseInt(i.recid) }), f == null || f[0] == undefined || f[0].SelectRow == undefined) { u.columns[i.column].editable = !1; return } u.columns[i.column].editable = { type: "number" }; u.columns[i.column].render = function (t) { var r = 0; return u.columns[i.column].field == "AppliedAmt" && (t.changes == undefined || t.changes.AppliedAmt == undefined || t.changes.SelectRow == undefined ? t.changes != undefined && t.changes.SelectRow != undefined && t.changes.SelectRow == !0 && t.changes.AppliedAmt == undefined ? (t.changes.AppliedAmt = t.OpenAmt, r = nt(t.changes.AppliedAmt.toString(), h)) : r = 0 : t.changes != undefined && t.changes.SelectRow != undefined && t.changes.SelectRow == !0 && t.changes.AppliedAmt == undefined ? (t.changes.AppliedAmt = t.OpenAmt, r = nt(t.changes.AppliedAmt.toString(), h)) : r = nt(t.changes.AppliedAmt.toString(), h)), parseFloat(r) > 0 && parseFloat(r) > parseFloat(t.OpenAmt) ? (n.ADialog.warn("AppliedAmtgrtr"), r = parseFloat(t.OpenAmt)) : parseFloat(t.OpenAmt) < 0 && parseFloat(r) < parseFloat(t.OpenAmt) ? (n.ADialog.warn("AppliedAmtgrtr"), r = parseFloat(t.OpenAmt)) : parseFloat(t.OpenAmt) > 0 && parseFloat(r) < 0 && (n.ADialog.warn("VIS_AppliedAmtleszero"), r = parseFloat(t.OpenAmt)), t.OpenAmt != 0 && t.AppliedAmt != 0 && t.OpenAmt != "" && t.AppliedAmt != "" && t.changes != undefined && t.changes.SelectRow == !0 && t.OpenAmt == t.AppliedAmt && parseFloat(t.changes.AppliedAmt) == t.AppliedAmt && nf(), parseFloat(r).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } } } function wc(i) { var r, u; if (f.columns[i.column] == undefined) { i.preventDefault(); return } if (f.columns[i.column].field == "AppliedAmt") { if (r = f.getChanges(), r == undefined || r.length == 0) { f.columns[i.column].editable = !1; return } if (u = t.grep(r, function (n) { return parseInt(n.recid) == parseInt(i.recid) }), u == null || u[0] == undefined || u[0].SelectRow == undefined) { f.columns[i.column].editable = !1; return } f.columns[i.column].editable = { type: "number" }; f.columns[i.column].render = function (t) { var r = 0; return f.columns[i.column].field == "AppliedAmt" && (t.changes == undefined || t.changes.AppliedAmt == undefined || t.changes.SelectRow == undefined ? t.changes != undefined && t.changes.SelectRow != undefined && t.changes.SelectRow == !0 && t.changes.AppliedAmt == undefined ? (t.changes.AppliedAmt = t.OpenAmt, r = nt(t.changes.AppliedAmt.toString(), h)) : r = 0 : t.changes != undefined && t.changes.SelectRow != undefined && t.changes.SelectRow == !0 && t.changes.AppliedAmt == undefined ? (t.changes.AppliedAmt = t.OpenAmt, r = nt(t.changes.AppliedAmt.toString(), h)) : r = nt(t.changes.AppliedAmt.toString(), h)), parseFloat(r) > 0 && parseFloat(r) > parseFloat(t.OpenAmt) ? (n.ADialog.warn("AppliedAmtgrtr"), r = parseFloat(t.OpenAmt)) : parseFloat(t.OpenAmt) < 0 && parseFloat(r) < parseFloat(t.OpenAmt) ? (n.ADialog.warn("AppliedAmtgrtr"), r = parseFloat(t.OpenAmt)) : parseFloat(t.OpenAmt) > 0 && parseFloat(r) < 0 && (n.ADialog.warn("VIS_AppliedAmtleszero"), r = parseFloat(t.OpenAmt)), t.OpenAmt != 0 && t.AppliedAmt != 0 && t.OpenAmt != "" && t.AppliedAmt != "" && t.changes != undefined && t.changes.SelectRow == !0 && t.OpenAmt == t.AppliedAmt && parseFloat(t.changes.AppliedAmt) == t.AppliedAmt && nf(), parseFloat(r).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } } } function bc(r) { var u, f; if (i.columns[r.column] == undefined) { r.preventDefault(); return } if (i.columns[r.column].field == "AppliedAmt" || i.columns[r.column].field == "Writeoff" || i.columns[r.column].field == "Discount") { if (u = i.getChanges(), u == undefined || u.length == 0) { i.columns[r.column].editable = !1; return } if (f = t.grep(u, function (n) { return parseInt(n.recid) == parseInt(r.recid) }), f == null || f[0] == undefined || f[0].SelectRow == undefined) { i.columns[r.column].editable = !1; return } i.columns[r.column].editable = { type: "number" }; i.columns[r.column].render = function (t) { var u = 0, f; return i.columns[r.column].field == "AppliedAmt" ? t.changes == undefined || t.changes.AppliedAmt == undefined || t.changes.SelectRow == undefined ? t.changes != undefined && t.changes.SelectRow != undefined && t.changes.SelectRow == !0 && t.changes.AppliedAmt == undefined ? (t.changes.AppliedAmt = t.Amount, u = nt(t.changes.AppliedAmt.toString(), h)) : u = 0 : t.changes != undefined && t.changes.SelectRow != undefined && t.changes.SelectRow == !0 && t.changes.AppliedAmt == undefined ? (t.changes.AppliedAmt = t.Amount, u = nt(t.changes.AppliedAmt.toString(), h)) : u = nt(t.changes.AppliedAmt.toString(), h) : i.columns[r.column].field == "Writeoff" ? t.changes == undefined || t.changes.Writeoff == undefined || t.changes.SelectRow == undefined ? t.changes != undefined && t.changes.SelectRow != undefined && t.changes.SelectRow == !0 && t.changes.Writeoff == undefined ? (t.changes.Writeoff = t.Writeoff, u = nt(t.changes.Writeoff.toString(), h)) : u = 0 : t.changes != undefined && t.changes.SelectRow != undefined && t.changes.SelectRow == !0 && t.changes.Writeoff == undefined ? (t.changes.Writeoff = t.Writeoff, u = nt(t.changes.Writeoff.toString(), h)) : u = nt(t.changes.Writeoff.toString(), h) : i.columns[r.column].field == "Discount" && (t.changes == undefined || t.changes.Discount == undefined || t.changes.SelectRow == undefined ? t.changes != undefined && t.changes.SelectRow != undefined && t.changes.SelectRow == !0 && t.changes.Discount == undefined ? (t.changes.Discount = t.Discount, u = nt(t.changes.Discount.toString(), h)) : u = 0 : t.changes != undefined && t.changes.SelectRow != undefined && t.changes.SelectRow == !0 && t.changes.Discount == undefined ? (t.changes.Discount = t.Discount, u = nt(t.changes.Discount.toString(), h)) : u = nt(t.changes.Discount.toString(), h)), parseFloat(u) > 0 && parseFloat(u) > parseFloat(t.Amount) ? (n.ADialog.warn("AppliedAmtgrtr"), u = parseFloat(t.Amount)) : parseFloat(t.Amount) < 0 && parseFloat(u) < parseFloat(t.Amount) ? (n.ADialog.warn("AppliedAmtgrtr"), u = parseFloat(t.Amount)) : parseFloat(t.Amount) > 0 && parseFloat(u) < 0 && (n.ADialog.warn("VIS_AppliedAmtleszero"), u = parseFloat(t.Amount)), t.Amount != 0 && t.AppliedAmt != 0 && t.OpenAmt != "" && t.AppliedAmt != "" && t.changes != undefined && t.changes.SelectRow == !0 && parseFloat(t.Amount) === t.AppliedAmt && parseFloat(t.changes.AppliedAmt) == t.AppliedAmt && ((t.changes.Discount != 0 || t.changes.Writeoff != 0) && (f = parseFloat(t.changes.Discount) + parseFloat(t.changes.Writeoff) + parseFloat(t.changes.AppliedAmt), Math.abs(f) > Math.abs(parseFloat(t.Amount)) && (n.ADialog.warn("AppliedAmtgrtr"), i.columns[r.column].field == "Discount" ? (t.changes.Discount = 0, u = t.changes.Discount) : i.columns[r.column].field == "Writeoff" ? (t.changes.Writeoff = 0, u = t.changes.Writeoff) : i.columns[r.column].field == "AppliedAmt" && (t.changes.AppliedAmt = 0, u = t.changes.AppliedAmt))), nf()), parseFloat(u).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) } } } function nt(n, t) { var i = 0; return typeof n == "string" ? n : n = n.toString(), t ? (n.contains("") ? n = (-1 * pt.GetConvertedNumber(n, t)).toString() : n.contains(".") && (n = pt.GetConvertedNumber(n, t).toString()), i = n != "" ? n : i) : (n.contains("") && !n.contains(".") ? n = (-1 * pt.GetConvertedNumber(n, t)).toString() : n.contains(",") && (n = pt.GetConvertedNumber(n, t).toString()), i = n != "" ? n : i), i } function kf(t, i) { var f = !1, u, r; if (t.value_new = n.Utility.Util.getValueOfString(i), t.value_new.contains(".")) { for (f = !0, u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "." && u.push(r); u.length > 1 && (t.value_new = vo(t.value_new, ".")) } if (t.value_new.contains(",")) if (f) t.value_new = vo(t.value_new, ","); else { for (u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "," && u.push(r); t.value_new = u.length > 1 ? vo(t.value_new, ",") : t.value_new.replace(",", ".") } return t.value_new == "" && (t.value_new = "0"), t.value_new } function vo(n, t) { var i = n.split(t); return n = i.slice(0, -1).join("") + "." + i.slice(-1), n.indexOf(".") == n.length - 1 && (n = n.replace(".", "")), n } function ke(n, t) { var i = n.split(t); return n = i.slice(0, -1).join("") + i.slice(-1), n.indexOf(t == "." ? "," : ".") == n.length - 1 && (n = n.replace(t == "." ? "," : ".", "")), n } function kc(r) { var o = i.getColumn("AppliedAmt", !0), y = i.getColumn("SelectRow", !0), c, u, e, f, h, a, v; if (r.column == 0 || r.column == null) { if (c = i.getChanges(), u = t.grep(c, function (n) { return parseInt(n.recid) == parseInt(r.recid) }), u == null || u[0] == undefined || u.length == 0 || u[0].SelectRow == undefined) i.records[r.recid].AppliedAmt = 0, i.records[r.recid].Writeoff = 0, i.records[r.recid].Discount = 0, i.refreshCell(r.recid, "AppliedAmt"), i.refreshCell(r.recid, "Writeoff"), i.refreshCell(r.recid, "Discount"), rr(); else if (u[0].SelectRow == !0) if (vt == 0 ? vt = i.get(r.recid).C_ConversionType_ID : vt != i.get(r.recid).C_ConversionType_ID && (e = document.getElementsByName(r.target), e.length > 0 && (e = e[0]), f = t(e).find("#grid_openformatgridinvoice_rec_" + r.recid + ""), f.length > 0 && (f = f[0]), t(f).find("input:checked").prop("checked") && t(f).find("input:checked").prop("checked", !1), i.get(r.recid).changes = !1, i.columns[o].editable = !1, i.get(r.recid).changes.AppliedAmt = "0", i.refreshCell(r.recid, "AppliedAmt"), i.get(r.recid).changes.Discount = "0", i.refreshCell(r.recid, "Discount"), i.get(r.recid).changes.Writeoff = "0", i.refreshCell(r.recid, "Writeoff"), n.ADialog.warn("VIS_ConversionNotMatched")), s.is(":checked")) { if (l.val() == "") return n.ADialog.warn("VIS_SlctcnvrsnDate"), i.get(r.recid).changes = !1, i.unselect(r.recid), i.columns[o].editable = !1, i.get(r.recid).changes.AppliedAmt = "0", i.refreshCell(r.recid, "AppliedAmt"), h = t("#grid_" + i.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(h[r.recid]).prop("checked", !1), i.editChange.call(i, h[r.recid], r.recid, 0, r), a = { type: "click", phase: "before", target: "grid", recid: r.recid, index: r.recid, isStopped: !1, "isCan//celled": !1, onComplete: null }, i.trigger(a), !1; v = Globalize.format(new Date(l.val()), "yyyy-MM-dd"); oi.val(Globalize.format(new Date(v), "yyyy-MM-dd")) } else rr(); else i.unselect(r.recid), i.columns[o].editable = !1, i.get(r.recid).changes.AppliedAmt = "0", i.refreshCell(r.recid, "AppliedAmt"), i.get(r.recid).changes.Discount = "0", i.refreshCell(r.recid, "Discount"), i.get(r.recid).changes.Writeoff = "0", i.refreshCell(r.recid, "Writeoff"); y != r.column && r.column != null || u[0] == undefined || u[0].SelectRow == undefined || (i.records[r.recid].AppliedAmt = n.Utility.Util.getValueOfDecimal(i.get(r.recid).Amount)); du(r.recid, r.column, !0, !1) } } function dc(i) { var v, y, r, h, o, a, p, f, e, c; if (su) { i.preventDefault(); return } if (f = u.getColumn("AppliedAmt", !0), v = u.getColumn("SelectRow", !0), i.column == 0 || i.column == null) { if (y = u.getChanges(), r = t.grep(y, function (n) { return parseInt(n.recid) == parseInt(i.recid) }), r == null || r[0] == undefined || r.length == 0 || r[0].SelectRow == undefined) u.records[i.recid].AppliedAmt = 0, u.refreshCell(i.recid, "AppliedAmt"), rr(); else if (r[0].SelectRow == !0) { if (vt == 0 ? vt = u.get(i.recid).C_ConversionType_ID : vt != u.get(i.recid).C_ConversionType_ID && (h = document.getElementsByName(i.target), h.length > 0 && (h = h[0]), o = t(h).find("#grid_openformatgrid_rec_" + i.recid + ""), o.length > 0 && (o = o[0]), t(o).find("input:checked").prop("checked") && t(o).find("input:checked").prop("checked", !1), u.get(i.recid).changes = !1, u.unselect(i.recid), u.columns[f].editable = !1, u.get(i.recid).changes.AppliedAmt = "0", u.refreshCell(i.recid, "AppliedAmt"), n.ADialog.warn("VIS_ConversionNotMatched")), s.is(":checked")) { if (l.val() == "") return n.ADialog.warn("VIS_SlctcnvrsnDate"), u.get(i.recid).changes = !1, u.unselect(i.recid), u.columns[f].editable = !1, u.get(i.recid).changes.AppliedAmt = "0", u.refreshCell(i.recid, "AppliedAmt"), e = t("#grid_" + u.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(e[i.recid]).prop("checked", !1), u.editChange.call(u, e[i.recid], i.recid, 0, i), c = { type: "click", phase: "before", target: "grid", recid: i.recid, index: i.recid, isStopped: !1, "isCan//celled": !1, onComplete: null }, u.trigger(c), !1; if (a = u.records[i.recid].DATEACCT, p = Globalize.format(new Date(l.val()), "yyyy-MM-dd"), a = Globalize.format(new Date(a), "yyyy-MM-dd"), p != a) return n.ADialog.warn("VIS_SelectSameDate"), f = u.getColumn("DATEACCT", !0), u.get(i.recid).changes = !1, u.unselect(i.recid), u.columns[f].editable = !1, u.get(i.recid).changes.AppliedAmt = "0", u.refreshCell(i.recid, "AppliedAmt"), e = t("#grid_" + u.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(e[i.recid]).prop("checked", !1), u.editChange.call(u, e[i.recid], i.recid, 0, i), c = { type: "click", phase: "before", target: "grid", recid: i.recid, index: i.recid, isStopped: !1, "isCan//celled": !1, onComplete: null }, u.trigger(c), !1 } } else u.unselect(i.recid), u.columns[f].editable = !1, u.get(i.recid).changes.AppliedAmt = "0", u.refreshCell(i.recid, "AppliedAmt"); v != i.column && i.column != null || r[0] == undefined || r[0].SelectRow == undefined || (u.records[i.recid].AppliedAmt = n.Utility.Util.getValueOfDecimal(u.get(i.recid).OpenAmt)); du(i.recid, i.column, !1, !1) } } function gc(i) { var v, y, r, h, o, a, p, u, e, c; if (ir) { i.preventDefault(); return } if (u = f.getColumn("AppliedAmt", !0), v = f.getColumn("SelectRow", !0), i.column == 0 || i.column == null) { if (y = f.getChanges(), r = t.grep(y, function (n) { return parseInt(n.recid) == parseInt(i.recid) }), r == null || r[0] == undefined || r.length == 0 || r[0].SelectRow == undefined) f.records[i.recid].AppliedAmt = 0, f.refreshCell(0, "AppliedAmt"); else if (r[0].SelectRow == !0) { if (vt == 0 ? vt = f.get(i.recid).C_ConversionType_ID : vt != f.get(i.recid).C_ConversionType_ID && (h = document.getElementsByName(i.target), h.length > 0 && (h = h[0]), o = t(h).find("#grid_openformatgridcash_rec_" + i.recid + ""), o.length > 0 && (o = o[0]), t(o).find("input:checked").prop("checked") && t(o).find("input:checked").prop("checked", !1), f.get(i.recid).changes = !1, f.unselect(i.recid), f.columns[u].editable = !1, f.refreshCell(0, "AppliedAmt"), n.ADialog.warn("VIS_ConversionNotMatched")), s.is(":checked")) { if (l.val() == "") return n.ADialog.warn("VIS_SlctcnvrsnDate"), f.get(i.recid).changes = !1, f.unselect(i.recid), f.columns[u].editable = !1, f.refreshCell(i.recid, "AppliedAmt"), e = t("#grid_" + f.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(e[i.recid]).prop("checked", !1), f.editChange.call(f, e[i.recid], i.recid, 0, i), c = { type: "click", phase: "before", target: "grid", recid: i.recid, index: i.recid, isStopped: !1, "isCan//celled": !1, onComplete: null }, f.trigger(c), !1; if (a = f.records[i.recid].DATEACCT, p = Globalize.format(new Date(l.val()), "yyyy-MM-dd"), a = Globalize.format(new Date(a), "yyyy-MM-dd"), p != a) return n.ADialog.warn("VIS_SelectSameDate"), u = f.getColumn("DATEACCT", !0), f.get(i.recid).changes = !1, f.unselect(i.recid), f.columns[u].editable = !1, f.refreshCell(i.recid, "AppliedAmt"), e = t("#grid_" + f.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(e[i.recid]).prop("checked", !1), f.editChange.call(f, e[i.recid], i.recid, 0, i), c = { type: "click", phase: "before", target: "grid", recid: i.recid, index: i.recid, isStopped: !1, "isCan//celled": !1, onComplete: null }, f.trigger(c), !1 } } else f.unselect(i.recid), f.columns[u].editable = !1, f.get(0).changes.AppliedAmt = "0", f.refreshCell(0, "AppliedAmt"); v != i.column && i.column != null || r[0] == undefined || r[0].SelectRow == undefined || (f.records[i.recid].AppliedAmt = n.Utility.Util.getValueOfDecimal(f.get(i.recid).OpenAmt)); du(i.recid, i.column, !1, !0) } } function nl(i) { var y, p, e, a, c, v, w, o, f, h, u; if (ru) { i.preventDefault(); return } if (o = r.getColumn("AppliedAmt", !0), y = r.getColumn("SelectRow", !0), i.column == 0 || i.column == null) { if (p = r.getChanges(), e = t.grep(p, function (n) { return parseInt(n.recid) == parseInt(i.recid) }), e == null || e[0] == undefined || e.length == 0 || e[0].SelectRow == undefined) for (r.records[i.recid].AppliedAmt = 0, r.refreshCell(i.recid, "AppliedAmt"), rr(), u = 0; u < ei.length; u++)ei[u].recid == i.recid && ei.splice(u, 1); else if (e[0].SelectRow == !0) { if (vt == 0 ? vt = r.get(i.recid).C_ConversionType_ID : vt != r.get(i.recid).C_ConversionType_ID && (a = document.getElementsByName(i.target), a.length > 0 && (a = a[0]), c = t(a).find("#grid_openformatglgrid_rec_" + i.recid + ""), c.length > 0 && (c = c[0]), t(c).find("input:checked").prop("checked") && t(c).find("input:checked").prop("checked", !1), r.get(i.recid).changes = !1, r.unselect(i.recid), r.columns[o].editable = !1, r.get(i.recid).changes.AppliedAmt = "0", r.refreshCell(i.recid, "AppliedAmt"), n.ADialog.warn("VIS_ConversionNotMatched")), s.is(":checked")) { if (l.val() == "") return n.ADialog.warn("VIS_SlctcnvrsnDate"), r.get(i.recid).changes = !1, r.unselect(i.recid), r.columns[o].editable = !1, r.get(i.recid).changes.AppliedAmt = "0", r.refreshCell(i.recid, "AppliedAmt"), f = t("#grid_" + r.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(f[i.recid]).prop("checked", !1), r.editChange.call(r, f[i.recid], i.recid, 0, i), h = { type: "click", phase: "before", target: "grid", recid: i.recid, index: i.recid, isStopped: !1, "isCan//celled": !1, onComplete: null }, r.trigger(h), !1; if (v = r.records[i.recid].DATEACCT, w = Globalize.format(new Date(l.val()), "yyyy-MM-dd"), v = Globalize.format(new Date(v), "yyyy-MM-dd"), w != v) return n.ADialog.warn("VIS_SelectSameDate"), o = r.getColumn("DATEACCT", !0), r.get(i.recid).changes = !1, r.unselect(i.recid), r.columns[o].editable = !1, r.get(i.recid).changes.AppliedAmt = "0", r.refreshCell(i.recid, "AppliedAmt"), f = t("#grid_" + r.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(f[i.recid]).prop("checked", !1), r.editChange.call(r, f[i.recid], i.recid, 0, i), h = { type: "click", phase: "before", target: "grid", recid: i.recid, index: i.recid, isStopped: !1, "isCan//celled": !1, onComplete: null }, r.trigger(h), !1 } if (ei.push(e[0]), ei.length == 1) to = r.get(i.recid).OpenAmount; else if (ei.length > 1 && (io = r.get(i.recid).OpenAmount, !(parseFloat(to) > 0 && parseFloat(io) > 0) && !(parseFloat(to) < 0 && parseFloat(io) < 0))) { for (fi.is(":checked") || n.ADialog.info("", !0, n.translatedTexts.CreditOrDebit), r.get(i.recid).changes = !1, r.unselect(i.recid), r.columns[o].editable = !1, r.get(i.recid).changes.AppliedAmt = "0", r.refreshCell(i.recid, "AppliedAmt"), f = t("#grid_" + r.name + '_records td[col="0"]').find('input[type="checkbox"]'), t(f[i.recid]).prop("checked", !1), r.editChange.call(r, f[i.recid], i.recid, 0, i), h = { type: "click", phase: "before", target: "grid", recid: i.recid, index: i.recid, isStopped: !1, "isCan//celled": !1, onComplete: null }, r.trigger(h), u = 0; u < ei.length; u++)ei[u].recid == i.recid && ei.splice(u, 1); if (!fi.is(":checked")) return !1 } } else r.unselect(i.recid), r.columns[o].editable = !1, r.get(i.recid).changes.AppliedAmt = "0", r.refreshCell(i.recid, "AppliedAmt"); y != i.column && i.column != null || e[0] == undefined || e[0].SelectRow == undefined || (r.records[i.recid].AppliedAmt = n.Utility.Util.getValueOfDecimal(r.get(i.recid).OpenAmount)); bs(i.recid, i.column) } } function tl(t) { if (su) { t.preventDefault(); return } var r = u.getColumn("AppliedAmt", !0), f = u.getColumn("SelectRow", !0), i = 0; if (u.columns[r].editable != undefined) { if (i = t.value_new != "" ? t.value_new : i, t.column == r && (h ? i.toString().contains("") && (i = (-1 * pt.GetConvertedNumber(i, h)).toString()) : i.toString().contains("") || i.toString().contains(",") ? i = i.toString().contains("") ? (-1 * pt.GetConvertedNumber(i, h)).toString() : pt.GetConvertedNumber(i, h).toString() : isNaN(i) || (i = pt.GetFormatedValue(i, "init", h).toString()), isNaN(i))) { n.ADialog.warn("VIS_ValidAmount"); t.preventDefault(); return } if (u.getChanges(t.recid) != undefined && u.getChanges(t.recid).length > 0 && u.get(t.recid).changes) { if (n.Utility.Util.getValueOfDecimal(i) > 0 && n.Utility.Util.getValueOfDecimal(i) > n.Utility.Util.getValueOfDecimal(u.get(t.recid).OpenAmt)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(u.get(t.recid).OpenAmt) < 0 && n.Utility.Util.getValueOfDecimal(i) < n.Utility.Util.getValueOfDecimal(u.get(t.recid).OpenAmt)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(u.get(t.recid).OpenAmt) > 0 && n.Utility.Util.getValueOfDecimal(i) < 0) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } u.get(t.recid).changes.AppliedAmt = t.value_new != "" ? t.value_new : i; u.refreshCell(t.recid, "AppliedAmt") } else t.column > 0 && u.set(t.recid, { AppliedAmt: t.value_new != "" ? t.value_new : i }); if ((t.column == f || t.column == null) && s.is(":checked") && n.Utility.Util.getValueOfDecimal(u.get(t.recid).OpenAmt) == 0) { n.ADialog.warn("NotFoundCurrencyRate"); t.preventDefault(); return } r == t.column && du(t.index, t.column, !1, !1) } } function il(t) { if (ru) { t.preventDefault(); return } var i = r.getColumn("AppliedAmt", !0); if (r.columns[i].editable != undefined) { if (r.getChanges(t.recid) != undefined && r.getChanges(t.recid).length > 0 && r.get(t.recid).changes) { if (n.Utility.Util.getValueOfDecimal(t.value_new) > 0 && n.Utility.Util.getValueOfDecimal(t.value_new) > n.Utility.Util.getValueOfDecimal(r.get(t.recid).OpenAmount)) { r.set(0, { AppliedAmt: n.Utility.Util.getValueOfDecimal(r.get(t.recid).OpenAmount) }); n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(r.get(t.recid).OpenAmount) < 0 && n.Utility.Util.getValueOfDecimal(t.value_new) < n.Utility.Util.getValueOfDecimal(r.get(t.recid).OpenAmount)) { r.set(0, { AppliedAmt: n.Utility.Util.getValueOfDecimal(r.get(t.recid).OpenAmount) }); n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } i == t.column && (r.get(t.recid).changes.AppliedAmt = t.value_new); r.refreshCell(t.recid, "AppliedAmt") } else t.column > 0 && r.set(t.recid, { AppliedAmt: t.value_new }); t.column == i && (parseFloat(r.get(t.recid).OpenAmount) > parseFloat(r.get(t.recid).AppliedAmt) || r.set(0, { AppliedAmt: r.get(t.recid).OpenAmount }), bs(t.index, t.column)) } } function rl(t) { if (ir) { t.preventDefault(); return } var r = f.getColumn("AppliedAmt", !0), u = f.getColumn("SelectRow", !0), i = 0; if (f.columns[r].editable != undefined) { if (i = t.value_new != "" ? t.value_new : i, t.column == r && (h ? i.toString().contains("") && (i = (-1 * pt.GetConvertedNumber(i, h)).toString()) : i.toString().contains("") || i.toString().contains(",") ? i = i.toString().contains("") ? (-1 * pt.GetConvertedNumber(i, h)).toString() : pt.GetConvertedNumber(i, h).toString() : isNaN(i) || (i = pt.GetFormatedValue(i, "init", h).toString()), isNaN(i))) { n.ADialog.warn("VIS_ValidAmount"); t.preventDefault(); return } if (f.getChanges(t.recid) != undefined && f.getChanges(t.recid).length > 0 && f.get(t.recid).changes) { if (n.Utility.Util.getValueOfDecimal(i) > 0 && n.Utility.Util.getValueOfDecimal(i) > n.Utility.Util.getValueOfDecimal(f.get(t.recid).OpenAmt)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(f.get(t.recid).OpenAmt) < 0 && n.Utility.Util.getValueOfDecimal(i) < n.Utility.Util.getValueOfDecimal(f.get(t.recid).OpenAmt)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(f.get(t.recid).OpenAmt) > 0 && n.Utility.Util.getValueOfDecimal(i) < 0) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } f.get(t.recid).changes.AppliedAmt = t.value_new != "" ? t.value_new : i; f.refreshCell(t.recid, "AppliedAmt") } else t.column > 0 && f.set(t.recid, { AppliedAmt: t.value_new != "" ? t.value_new : i }); if ((t.column == u || t.column == null) && s.is(":checked") && n.Utility.Util.getValueOfDecimal(f.get(t.recid).OpenAmt) == 0) { n.ADialog.warn("NotFoundCurrencyRate"); t.preventDefault(); return } r == t.column && du(t.index, t.column, !1, !0) } } function ul(t) { var u = i.getColumn("AppliedAmt", !0), f = i.getColumn("Writeoff", !0), e = i.getColumn("Discount", !0), v = i.getColumn("SelectRow", !0), c = 0, l = 0, a = 0, r = 0; if (i.columns[u].editable != undefined || i.columns[f].editable != undefined || i.columns[e].editable != undefined) { if (r = t.value_new != "" ? t.value_new : r, t.column == u || t.column == f || t.column == e) { if (h ? r.toString().contains("") && (r = (-1 * pt.GetConvertedNumber(r, h)).toString()) : r.toString().contains("") || r.toString().contains(",") ? r = r.toString().contains("") ? (-1 * pt.GetConvertedNumber(r, h)).toString() : pt.GetConvertedNumber(r, h).toString() : isNaN(r) || (r = pt.GetFormatedValue(r, "init", h).toString()), isNaN(r)) { n.ADialog.warn("VIS_ValidAmount"); t.preventDefault(); return } l = i.get(t.recid).changes.AppliedAmt != undefined && t.column != u ? nt(i.get(t.recid).changes.AppliedAmt, h) : r; c = i.get(t.recid).changes.Discount != undefined && t.column != e ? nt(i.get(t.recid).changes.Discount, h) : r; a = i.get(t.recid).changes.Writeoff != undefined && t.column != f ? nt(i.get(t.recid).changes.Writeoff, h) : r } if (i.getChanges(t.recid) != undefined && i.getChanges(t.recid).length > 0 && i.get(t.recid).changes) { if (n.Utility.Util.getValueOfDecimal(r) > 0 && n.Utility.Util.getValueOfDecimal(r) > n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) < 0 && n.Utility.Util.getValueOfDecimal(r) < n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) > 0 && n.Utility.Util.getValueOfDecimal(r) < 0) { n.ADialog.warn("VIS_AppliedAmtleszero"); t.preventDefault(); return } if (u == t.column) { if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) < 0 && n.Utility.Util.getValueOfDecimal((n.Utility.Util.getValueOfDecimal(r) + n.Utility.Util.getValueOfDecimal(a) + n.Utility.Util.getValueOfDecimal(c)).toFixed(o)) < n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) > 0 && n.Utility.Util.getValueOfDecimal((n.Utility.Util.getValueOfDecimal(r) + n.Utility.Util.getValueOfDecimal(a) + n.Utility.Util.getValueOfDecimal(c)).toFixed(o)) > n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) > 0 && n.Utility.Util.getValueOfDecimal(r) < 0) { n.ADialog.warn("VIS_AppliedAmtleszero"); t.preventDefault(); return } i.get(t.recid).changes.AppliedAmt = t.value_new != "" ? t.value_new : r; i.refreshCell(t.recid, "AppliedAmt") } else if (f == t.column) { if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) < 0 && n.Utility.Util.getValueOfDecimal((n.Utility.Util.getValueOfDecimal(r) + n.Utility.Util.getValueOfDecimal(l) + n.Utility.Util.getValueOfDecimal(c)).toFixed(o)) < n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) > 0 && n.Utility.Util.getValueOfDecimal((n.Utility.Util.getValueOfDecimal(r) + n.Utility.Util.getValueOfDecimal(l) + n.Utility.Util.getValueOfDecimal(c)).toFixed(o)) > n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) > 0 && n.Utility.Util.getValueOfDecimal(r) < 0) { n.ADialog.warn("VIS_AppliedAmtleszero"); t.preventDefault(); return } i.get(t.recid).changes.Writeoff = t.value_new != "" ? t.value_new : r; i.refreshCell(t.recid, "Writeoff") } else if (e == t.column) { if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) < 0 && n.Utility.Util.getValueOfDecimal((n.Utility.Util.getValueOfDecimal(r) + n.Utility.Util.getValueOfDecimal(l) + n.Utility.Util.getValueOfDecimal(a)).toFixed(o)) < n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) > 0 && n.Utility.Util.getValueOfDecimal((n.Utility.Util.getValueOfDecimal(r) + n.Utility.Util.getValueOfDecimal(l) + n.Utility.Util.getValueOfDecimal(a)).toFixed(o)) > n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)) { n.ADialog.warn("AppliedAmtgrtr"); t.preventDefault(); return } if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) > 0 && n.Utility.Util.getValueOfDecimal(r) < 0) { n.ADialog.warn("VIS_AppliedAmtleszero"); t.preventDefault(); return } i.get(t.recid).changes.Discount = t.value_new != "" ? t.value_new : r; i.refreshCell(t.recid, "Discount") } } else t.column > 0 && (u == t.column ? i.set(t.recid, { AppliedAmt: t.value_new != "" ? t.value_new : r }) : f == t.column ? i.set(t.recid, { Writeoff: t.value_new != "" ? t.value_new : r }) : e == t.column && i.set(t.recid, { Discount: t.value_new != "" ? t.value_new : r })); if (v == t.column || t.column == null) if (s.is(":checked")) { if (n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) == 0) { n.ADialog.warn("NotFoundCurrencyRate"); t.preventDefault(); return } i.records[t.recid].AppliedAmt = n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount) } else i.records[t.recid].AppliedAmt = n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount); (t.column == i.getColumn("Discount", !0) || t.column == i.getColumn("Writeoff", !0) || t.column == i.getColumn("AppliedAmt", !0)) && du(t.index, t.column, !0, !1) } } function du(n, t, e, o) { var l = n, tt = t, rt, ft, nt, v, a, et, it, c, g, p, y, w, b, k, d, s; if ((tt == null || tt == undefined) && (tt = 0), rt = null, e || o) { if (o) { if (tt == 0) if (v = f.columns, ss = gu(f.getChanges(), l), uo = hi(v, "AppliedAmt"), nt = v[uo].field, a = f.get(l).changes, ss) c = f.records[l], g = { SelectRow: c.SelectRow, Date1: c.Date1, ReceiptNo: c.ReceiptNo, VSS_paymenttype: c.VSS_paymenttype, Isocode: c.Isocode, CcashlineiID: c.CcashlineiID, Amount: c.Amount, OpenAmt: c.OpenAmt, Payment: c.Payment, Multiplierap: c.Multiplierap, DocBaseType: c.DocBaseType, ConvertedAmount: c.ConvertedAmount, AppliedAmt: c.AppliedAmt, C_ConversionType_ID: c.C_ConversionType_ID, ConversionName: c.ConversionName, DATEACCT: c.DATEACCT, AD_Org_ID: c.AD_Org_ID, OrgName: c.OrgName }, at.push(g), wo = hi(v, "OpenAmt"), p = parseFloat(f.get(l)[v[wo].field]), _value = ke(parseFloat(p).toLocaleString(), h ? "," : "."), nt == "AppliedAmt" && (a != null && a != undefined ? (a.AppliedAmt = _value, f.refreshCell(l, "AppliedAmt")) : f.set(l, { AppliedAmt: _value })); else { for (y = 0; y < at.length; y++)at[y].CcashlineiID == f.records[l].CcashlineiID && at.splice(y, 1); for (nt == "AppliedAmt" && a != null && a != undefined && (a.AppliedAmt = p, f.records[l].AppliedAmt = 0, f.refreshCell(l, "AppliedAmt")), w = !1, s = 0; s < i.getChanges().length; s++)i.getChanges()[s].SelectRow == undefined || i.getChanges()[s].SelectRow == !1 || (w = !0); for (b = !1, s = 0; s < f.getChanges().length; s++)f.getChanges()[s].SelectRow == undefined || f.getChanges()[s].SelectRow == !1 || (b = !0); for (k = !1, s = 0; s < u.getChanges().length; s++)u.getChanges()[s].SelectRow == undefined || u.getChanges()[s].SelectRow == !1 || (k = !0); for (d = !1, s = 0; s < r.getChanges().length; s++)r.getChanges()[s].SelectRow == undefined || r.getChanges()[s].SelectRow == !1 || (d = !0); d || w || b || k || (vt = 0); f.columns[uo].editable = !1 } } else if (tt == 0) if (v = i.columns, es = gu(i.getChanges(), l), a = i.get(l).changes, le = hi(v, "Writeoff"), et = v[le].field, of = hi(v, "AppliedAmt"), it = v[of].field, es) c = i.records[l], g = { SelectRow: c.SelectRow, InvoiceRecord: c.InvoiceRecord, Date1: c.Date1, Documentno: c.Documentno, CinvoiceID: c.CinvoiceID, Isocode: c.Isocode, Currency: c.Currency, Converted: c.Converted, Amount: c.Amount, Discount: c.Discount, Multiplierap: c.Multiplierap, DocBaseType: c.DocBaseType, Writeoff: c.Writeoff, AppliedAmt: c.AppliedAmt, C_InvoicePaySchedule_ID: c.C_InvoicePaySchedule_ID, InvoiceScheduleDate: c.InvoiceScheduleDate, C_ConversionType_ID: c.C_ConversionType_ID, ConversionName: c.ConversionName, DATEACCT: c.DATEACCT, AD_Org_ID: c.AD_Org_ID, OrgName: c.OrgName, PayName: c.PayName }, ut.push(g), ce = hi(v, "Amount"), p = parseFloat(i.get(l)[v[ce].field]), fu = hi(v, "Discount"), p = p - parseFloat(i.get(l)[v[fu].field]), _value = ke(parseFloat(p).toLocaleString(), h ? "," : "."), it == "AppliedAmt" && (a != null && a != undefined ? (a.Writeoff = 0, a.AppliedAmt = _value, fu = hi(v, "Discount"), a.Discount = ke(parseFloat(i.get(l)[v[fu].field]).toLocaleString(), h ? "," : "."), i.refreshCell(l, "Writeoff"), i.refreshCell(l, "AppliedAmt"), i.refreshCell(l, "Discount")) : (i.set(l, { Writeoff: 0 }), i.set(l, { AppliedAmt: _value }))); else { for (y = 0; y < ut.length; y++)ut[y].C_InvoicePaySchedule_ID == i.records[l].C_InvoicePaySchedule_ID && ut.splice(y, 1); for (it == "AppliedAmt" && a != null && a != undefined && (a.Writeoff = p, a.AppliedAmt = p, a.Discount = p, fu = hi(v, "Discount"), i.records[l].AppliedAmt = 0, i.refreshCell(l, "Writeoff"), i.refreshCell(l, "AppliedAmt"), i.refreshCell(l, "Discount")), w = !1, s = 0; s < i.getChanges().length; s++)i.getChanges()[s].SelectRow == undefined || i.getChanges()[s].SelectRow == !1 || (w = !0); for (b = !1, s = 0; s < f.getChanges().length; s++)f.getChanges()[s].SelectRow == undefined || f.getChanges()[s].SelectRow == !1 || (b = !0); for (k = !1, s = 0; s < u.getChanges().length; s++)u.getChanges()[s].SelectRow == undefined || u.getChanges()[s].SelectRow == !1 || (k = !0); for (d = !1, s = 0; s < r.getChanges().length; s++)r.getChanges()[s].SelectRow == undefined || r.getChanges()[s].SelectRow == !1 || (d = !0); d || w || b || k || (vt = 0); i.columns[of].editable = !1 } } else if (tt == 0) if (v = u.columns, os = gu(u.getChanges(), l), he = hi(v, "AppliedAmt"), nt = v[he].field, a = u.get(l).changes, os) c = u.records[l], g = { SelectRow: c.SelectRow, Date1: c.Date1, Documentno: c.Documentno, CpaymentID: c.CpaymentID, Isocode: c.Isocode, ConvertedAmount: c.ConvertedAmount, OpenAmt: c.OpenAmt, Payment: c.Payment, Multiplierap: c.Multiplierap, DocBaseType: c.DocBaseType, AppliedAmt: c.AppliedAmt, C_ConversionType_ID: c.C_ConversionType_ID, ConversionName: c.ConversionName, DATEACCT: c.DATEACCT, AD_Org_ID: c.AD_Org_ID, OrgName: c.OrgName, PayName: c.PayName }, ht.push(g), bo = hi(v, "OpenAmt"), p = parseFloat(u.get(l)[v[bo].field]), _value = ke(parseFloat(p).toLocaleString(), h ? "," : "."), ft = hi(v, "Date1"), rt = new Date(u.get(l)[v[ft].field]), nt == "AppliedAmt" && (a != null && a != undefined ? (a.AppliedAmt = _value, u.refreshCell(l, "AppliedAmt")) : u.set(l, { AppliedAmt: _value })); else { for (y = 0; y < ht.length; y++)ht[y].CpaymentID == u.records[l].CpaymentID && ht.splice(y, 1); for (nt == "AppliedAmt" && a != null && a != undefined && (a.AppliedAmt = p, u.records[l].AppliedAmt = 0, u.refreshCell(l, "AppliedAmt")), w = !1, s = 0; s < i.getChanges().length; s++)i.getChanges()[s].SelectRow == undefined || i.getChanges()[s].SelectRow == !1 || (w = !0); for (b = !1, s = 0; s < f.getChanges().length; s++)f.getChanges()[s].SelectRow == undefined || f.getChanges()[s].SelectRow == !1 || (b = !0); for (k = !1, s = 0; s < u.getChanges().length; s++)u.getChanges()[s].SelectRow == undefined || u.getChanges()[s].SelectRow == !1 || (k = !0); for (d = !1, s = 0; s < r.getChanges().length; s++)r.getChanges()[s].SelectRow == undefined || r.getChanges()[s].SelectRow == !1 || (d = !0); d || w || b || k || (vt = 0); u.columns[he].editable = !1 } nf() } function hi(n, t) { for (var r = 0, i = 0; i < n.length; i++)if (n[i].field == t) { r = i; break } return r } function bs(n, t) { var s = n, l = t, g, a, p, h, o, v, nt, y, c, w, b, k, d, e; if ((l == null || l == undefined) && (l = 0), g = null, l == 0) if (a = r.columns, po = gu(r.getChanges(), s), p = a[10].field, r.get(s) && (h = r.get(s).changes), po) { for (o = null, v = 0; r.records.length; v++)if (r.records[v].recid == parseInt(s)) { o = r.records[v]; break } nt = { SelectRow: o.SelectRow, GLRecords: h.GLRecords, Date1: o.Date1, DOCUMENTNO: o.DOCUMENTNO, Account: o.Account, DATEDOC: o.DATEDOC, Isocode: o.Isocode, GL_JOURNALLINE_ID: o.GL_JOURNALLINE_ID, GL_Journal_ID: o.GL_Journal_ID, OpenAmount: o.OpenAmount, ConvertedAmount: o.ConvertedAmount, AppliedAmt: o.AppliedAmt, C_ConversionType_ID: o.C_ConversionType_ID, ConversionName: o.ConversionName, DATEACCT: o.DATEACCT, AD_Org_ID: o.AD_Org_ID, OrgName: o.OrgName }; rt.push(nt); y = parseFloat(r.get(s)[a[9].field]); g = new Date(r.get(s)[a[11].field]); p == "AppliedAmt" && h != null && h != undefined && (h.AppliedAmt = y, r.set(s, { AppliedAmt: y }), r.refreshCell(s, "AppliedAmt")) } else { for (c = 0; c < rt.length; c++)rt[c].GL_JOURNALLINE_ID == r.records[s].GL_JOURNALLINE_ID && rt.splice(c, 1); for (p == "AppliedAmt" && h != null && h != undefined && (h.AppliedAmt = y, r.records[s].AppliedAmt = 0, r.refreshCell(s, "AppliedAmt")), w = !1, e = 0; e < i.getChanges().length; e++)i.getChanges()[e].SelectRow == undefined || i.getChanges()[e].SelectRow == !1 || (w = !0); for (b = !1, e = 0; e < f.getChanges().length; e++)f.getChanges()[e].SelectRow == undefined || f.getChanges()[e].SelectRow == !1 || (b = !0); for (k = !1, e = 0; e < u.getChanges().length; e++)u.getChanges()[e].SelectRow == undefined || u.getChanges()[e].SelectRow == !1 || (k = !0); for (d = !1, e = 0; e < r.getChanges().length; e++)r.getChanges()[e].SelectRow == undefined || r.getChanges()[e].SelectRow == !1 || (d = !0); d || w || b || k || (vt = 0) } nf() } function gu(n, i) { if (n == null || n.length == 0) return !1; var r = t.grep(n, function (n) { return parseInt(n.recid) == i }); return r == null || r[0] == undefined || r.length == 0 || r[0].SelectRow == undefined ? !1 : r[0].SelectRow } function fl() { df(y.getName(), y.value) } function rr() { var n, t, e, o; for (kt = [], _dateAcct = [], n = 0; n < u.getChanges().length; n++)u.getChanges()[n].SelectRow === undefined || u.getChanges()[n].SelectRow == !0 && (t = u.records[u.getChanges()[n].recid].Date1, kt.push(new Date(t)), e = u.records[u.getChanges()[n].recid].DATEACCT, _dateAcct.push(new Date(e)), oi.val(Globalize.format(new Date(Math.max.apply(null, _dateAcct)), "yyyy-MM-dd"))); for (n = 0; n < i.getChanges().length; n++)i.getChanges()[n].SelectRow === undefined || i.getChanges()[n].SelectRow == !0 && (t = i.records[i.getChanges()[n].recid].Date1, kt.push(new Date(t)), u.getChanges().length == 0 && f.getChanges().length == 0 && r.getChanges().length == 0 && (e = i.records[i.getChanges()[n].recid].DATEACCT, _dateAcct.push(new Date(e)), oi.val(Globalize.format(new Date(Math.max.apply(null, _dateAcct)), "yyyy-MM-dd")))); for (n = 0; n < f.getChanges().length; n++)f.getChanges()[n].SelectRow === undefined || f.getChanges()[n].SelectRow == !0 && (t = f.records[f.getChanges()[n].recid].DATEACCT, kt.push(new Date(t)), u.getChanges().length == 0 && i.getChanges().length == 0 && r.getChanges().length == 0 && (e = f.records[f.getChanges()[n].recid].DATEACCT, _dateAcct.push(new Date(e)), oi.val(Globalize.format(new Date(Math.max.apply(null, _dateAcct)), "yyyy-MM-dd")))); for (n = 0; n < r.getChanges().length; n++)if (r.getChanges()[n].SelectRow !== undefined && r.getChanges()[n].SelectRow == !0) { for (t = null, o = 0; r.records.length; o++)if (r.records[o].recid == r.getChanges()[n].recid) { t = r.records[o].DATEACCT; break } if (kt.push(new Date(t)), u.getChanges().length == 0 && f.getChanges().length == 0 && i.getChanges().length == 0) { for (e = null, o = 0; r.records.length; o++)if (r.records[o].recid == r.getChanges()[n].recid) { e = r.records[o].DATEACCT; break } _dateAcct.push(new Date(e)); oi.val(Globalize.format(new Date(Math.max.apply(null, _dateAcct)), "yyyy-MM-dd")) } } nr = new Date(Math.max.apply(null, kt)); (kt.length == 0 || kt == "Invalid Date") && (nr = new Date); oi.val(Globalize.format(nr, "yyyy-MM-dd")) } function vu() { if (lt > 0) { var i = s.is(":checked"); if (g = st.val(), g == 0) return n.ADialog.info("Message", !0, "select currency", ""); if (AD_Org_ID = ii.val(), v = gi.val(), c = pi.val(), srchText = hf.val(), a[0].style.visibility = "visible", pr = 1, au = 1, wf = 0, dr = !1, c != "" && v > c) return pi.val(""), n.ADialog.info("Message", !0, n.Msg.getMsg("VIS_FromDateGreater"), ""); v != null && v != undefined && v != "" && n.DB.to_date(v); c != null && c != undefined && c != "" && n.DB.to_date(c); t.ajax({ url: n.Application.contextUrl + "VIS/PaymentAllocation/GetGLData", dataType: "json", data: { AD_Org_ID: AD_Org_ID, _C_Currency_ID: g, _C_BPartner_ID: lt, page: pr, size: ri, fromDate: v, toDate: c, srchText: srchText, chk: i, isInterComp: tr }, async: !0, success: function (n) { var t = JSON.parse(n), r, u; if (t) { if (pr == 1 && t.length > 0 && (wf = t[0].GLRecords, au = Math.ceil(wf / ri)), rt.length > 0) { for (sr = rt.length, r = 0; r < t.length; r++)u = rt.filter(function (n) { return n.GL_JOURNALLINE_ID == t[r].GL_JOURNALLINE_ID }), u.length == 0 && (t[r].recid = rt.length + r, rt.push(t[r])); t = rt; rt = [] } vs(t, i); ff.find("#grid_openformatglgrid_" + e.windowNo + "_records").on("scroll", ho); dr = !0; pe() } }, error: function () { a[0].style.visibility = "hidden" } }) } } function ks() { var n, t; for (kt = [], gr = !0, n = 0; n < u.getChanges().length; n++)u.getChanges()[n].SelectRow === undefined || u.getChanges()[n].SelectRow == !0 && (t = u.records[u.getChanges()[n].recid].Date1, gr && parseInt(d.val()) != parseInt(u.records[u.getChanges()[n].recid].AD_Org_ID) && (gr = !1), kt.push(new Date(t))); for (n = 0; n < i.getChanges().length; n++)i.getChanges()[n].SelectRow === undefined || i.getChanges()[n].SelectRow == !0 && (t = i.records[i.getChanges()[n].recid].Date1, gr && parseInt(d.val()) != parseInt(i.records[i.getChanges()[n].recid].AD_Org_ID) && (gr = !1), kt.push(new Date(t))); for (n = 0; n < f.getChanges().length; n++)f.getChanges()[n].SelectRow === undefined || f.getChanges()[n].SelectRow == !0 && (t = f.records[f.getChanges()[n].recid].DATEACCT, gr && parseInt(d.val()) != parseInt(f.records[f.getChanges()[n].recid].AD_Org_ID) && (gr = !1), kt.push(new Date(t))); for (n = 0; n < r.getChanges().length; n++)r.getChanges()[n].SelectRow === undefined || r.getChanges()[n].SelectRow == !0 && (t = r.records[r.getChanges()[n].recid].DATEACCT, kt.push(new Date(t))); return kt.length == 0 ? !1 : !0 } function df(n, t) { if (n != "C_BPartner_ID" && t == null) { b(); w(); return } n == "C_BPartner_ID" ? (lt = t, lt > 0 && y.getControl().removeClass("vis-ev-col-mandatory")) : n == "C_Currency_ID" ? g = parseInt(t) : n == "Date" && s && yo() } function nf() { var it, p, w, d, g, b, nt, e, c, k, t, s, rt; a[0].style.visibility = "visible"; it = n.DisplayType.GetNumberFormat(n.DisplayType.Amount); p = new Date; p = null; w = parseFloat(0); so = 0; var v = null, y = null, l = null, tt = null; if (u && (v = u.getChanges()), f && (y = f.getChanges()), i && (l = i.getChanges()), r && (tt = r.getChanges()), v != null) { for (e = 0; e < v.length; e++)if (v[e].SelectRow == !0) { var c = u.get(v[e].recid), b = new Date(c.Date1), k = new n.TimeUtil; p = k.max(p, b); t = Object.keys(c); v[e][t[t.indexOf("AppliedAmt")]] != "" && v[e][t[t.indexOf("AppliedAmt")]] != undefined ? (s = v[e][t[t.indexOf("AppliedAmt")]].toString().contains("-") || v[e][t[t.indexOf("AppliedAmt")]].toString().contains("") ? (-1 * Math.abs(it.GetConvertedNumber(v[e][t[t.indexOf("AppliedAmt")]].toString(), h))).toFixed(o) : it.GetConvertedNumber(v[e][t[t.indexOf("AppliedAmt")]].toString(), h).toFixed(o), s = parseFloat(s)) : (s = 0, console.log("Payment Row: " + v[e][t[t.indexOf("AppliedAmt")]] + ", RowNo:-" + e)); w = w + (isNaN(s) ? 0 : s); so++ } w = w.toFixed(o); w = parseFloat(w) } if (fo.text(so + " " + n.Msg.getMsg("SelectedLines") + " - " + ti + " " + parseFloat(w).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) + " "), d = parseFloat(0), ae = 0, y != null) { for (e = 0; e < y.length; e++)if (y[e].SelectRow == !0) { var c = f.get(y[e].recid), b = new Date(c.Created), k = new n.TimeUtil; p = k.max(p, b); t = Object.keys(c); y[e][t[t.indexOf("AppliedAmt")]] != "" && y[e][t[t.indexOf("AppliedAmt")]] != undefined ? (s = y[e][t[t.indexOf("AppliedAmt")]].toString().contains("-") || y[e][t[t.indexOf("AppliedAmt")]].toString().contains("") ? (-1 * Math.abs(it.GetConvertedNumber(y[e][t[t.indexOf("AppliedAmt")]].toString(), h))).toFixed(o) : it.GetConvertedNumber(y[e][t[t.indexOf("AppliedAmt")]].toString(), h).toFixed(o), s = parseFloat(s)) : (s = 0, console.log("Cash Row: " + y[e][t[t.indexOf("AppliedAmt")]] + ", RowNo:-" + e)); d = d + (isNaN(s) ? 0 : s); ae++ } d = d.toFixed(o); d = parseFloat(d) } if (eo.text(ae + " " + n.Msg.getMsg("SelectedLines") + " - " + ti + " " + parseFloat(d).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) + " "), g = parseFloat(0), sf = 0, l != null) { for (e = 0; e < l.length; e++)l[e].SelectRow == !0 && (c = i.get(l[e].recid), b = bu > 0 ? new Date(c.InvoiceScheduleDate) : new Date(c.Date1), b == "Invalid Date" && (b = new Date(c.Date1)), k = new n.TimeUtil, p = k.max(p, b), t = Object.keys(c), l[e][t[t.indexOf("AppliedAmt")]] != "" && l[e][t[t.indexOf("AppliedAmt")]] != undefined ? (s = l[e][t[t.indexOf("AppliedAmt")]].toString().contains("-") || l[e][t[t.indexOf("AppliedAmt")]].toString().contains("") ? (-1 * Math.abs(it.GetConvertedNumber(l[e][t[t.indexOf("AppliedAmt")]].toString(), h))).toFixed(o) : it.GetConvertedNumber(l[e][t[t.indexOf("AppliedAmt")]].toString(), h).toFixed(o), s = parseFloat(s)) : (s = 0, console.log("Invoice Row: " + l[e][t[t.indexOf("AppliedAmt")]] + ", RowNo:-" + e)), g = g + (isNaN(s) ? 0 : s), sf++); g = g.toFixed(o); g = parseFloat(g) } if (oo.text(sf + " " + n.Msg.getMsg("SelectedLines") + " - " + ti + " " + parseFloat(g).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) + " "), nt = parseFloat(0), no = 0, tt != null) { for (e = 0; e < tt.length; e++)tt[e].SelectRow == !0 && (c = r.get(tt[e].recid), b = new Date(c.Date1), k = new n.TimeUtil, p = k.max(p, b), t = Object.keys(c), tt[e][t[t.indexOf("AppliedAmt")]] != "" && tt[e][t[t.indexOf("AppliedAmt")]] != undefined ? (s = parseFloat(tt[e][t[t.indexOf("AppliedAmt")]]).toFixed(o), s = parseFloat(s)) : (s = 0, console.log("GL Row: " + l[e][t[t.indexOf("AppliedAmt")]] + ", RowNo:-" + e)), nt = nt + (isNaN(s) ? 0 : s), no++); nt = nt.toFixed(o); nt = parseFloat(nt) } ue.text(no + " " + n.Msg.getMsg("SelectedLines") + " - " + ti + " " + parseFloat(nt).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }) + " "); st.children("option").filter(":selected").text() != null && cs.text(st.children("option").filter(":selected").text()); rt = parseFloat(w + d - (g + nt)).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }); ve.text(rt); parseFloat(rt) == parseFloat(0) ? (eu.prop("readonly", !1), eu.css({ "pointer-events": "auto", opacity: "1" })) : (eu.prop("readonly", !0), eu.css({ "pointer-events": "none", opacity: "0.5" })); a[0].style.visibility = "hidden" } function yo() { var i = parseFloat(0).toLocaleString(navigator.language, { minimumFractionDigits: o, maximumFractionDigits: o }); fo.text("0 " + n.Msg.getMsg("SelectedLines") + " - " + ti + " " + i + " "); eo.text("0 " + n.Msg.getMsg("SelectedLines") + " - " + ti + " " + i + " "); oo.text("0 " + n.Msg.getMsg("SelectedLines") + " - " + ti + " " + i + " "); ue.text("0 " + n.Msg.getMsg("SelectedLines") + " - " + ti + " " + i + " "); ve.text(i); wi.prop("checked", !1); er.prop("checked", !1); or.prop("checked", !1); fi.prop("checked", !1); t(".vis-allocation-payment-grid, .vis-allocation-cashLine-grid, .vis-allocation-invoice-grid, .vis-allocation-gl-grid").css("height", "80%"); t("#cashMaindiv").css("display", "none"); t("#glMaindiv").css("display", "none"); s.is(":checked") ? se.css("display", "block") : se.css("display", "none") } function ds() { var i, r, n, e, t; if (u != undefined && (i = u.getChanges()), f != undefined && (r = f.getChanges()), er.prop("checked", !1), or.prop("checked", !1), re.prop("checked", !1), ir) { if (ir = !0, su = !1, r != null) { for (n = 0; n < r.length; n++)e = gu(f.getChanges(), r[n].recid), e && (t = f.get(r[n].recid).changes, t != null && t != undefined && (t.SelectRow = !1, t.AppliedAmt = 0, f.refreshCell(r[n].recid, "SelectRow"), f.refreshCell(r[n].recid, "AppliedAmt"))); f && f.refresh() } ot.css("display", "none"); it.css("display", ""); u && u.refresh() } else { if (ir = !1, su = !0, i != null) { for (n = 0; n < i.length; n++)e = gu(u.getChanges(), i[n].recid), e && (t = u.get(i[n].recid).changes, t != null && t != undefined && (t.SelectRow = !1, t.AppliedAmt = 0, u.refreshCell(i[n].recid, "SelectRow"), u.refreshCell(i[n].recid, "AppliedAmt"))); u && u.refresh() } it.css("display", "none"); ot.css("display", ""); f && f.refresh() } nf() } function gs() { var i = !0, t; af > lf ? (t = af - lf, af * .05 <= t && (i = !1, n.ADialog.confirm("AllocationWriteOffWarn", !0, "", "Confirm", function (n) { n && nh() }))) : lf > af && (t = lf - af, lf * .05 >= t && (i = n.ADialog.error("AllocationWriteOffWarn"))); i && nh() } function nh() { a[0].style.visibility = "visible"; var o = u.getChanges(), s = f.getChanges(), n = i.getChanges(), h = r.getChanges(), t = ft.val(), e = oi.val(); k.val() == "G" || p.val() == "G" ? sl(o, n, s, h, t, e) : k.val() == "C" || p.val() == "C" ? el(s, n, t, e) : ol(o, n, t, e) } function el(r, u, e, o) { if (sf + ae == 0) return ""; t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/CheckPeriodState", data: { DateTrx: ft.val(), AD_Org_ID: d.val() }, async: !1, success: function (e) { var rt, k, v, y, c, w, p, b; if (e != "") return n.ADialog.info("", !0, e, ""), lr = !0, ku(), a[0].style.visibility = "hidden", ""; var et = "", g = "", ot = "", ht = "", ct = "", tt = 0, at = [], it = [], vt = s.is(":checked"); if (rt = vt ? Globalize.format(new Date(l.val()), "yyyy-MM-dd") : Globalize.format(new Date, "yyyy-MM-dd"), r.length > 0) for (v = Object.keys(f.get(0)), et = v[v.indexOf("AppliedAmt")], g = v[v.indexOf("AppliedAmt")], y = 0; y < r.length; y++)c = f.get(r[y].recid), tt = parseInt(c.C_ConversionType_ID), r[y].AppliedAmt != 0 && r[y].AppliedAmt != undefined && (k = r[y].AppliedAmt, k = nt(k, h), at.push({ AppliedAmt: k, Date: c.Created, Amount: c.Amount, ccashlineid: c.CcashlineiID, Converted: c.ConvertedAmount, Isocode: c.Isocode, Multiplierap: c.Multiplierap, OpenAmt: c.OpenAmt, ReceiptNo: c.ReceiptNo, Org: parseInt(d.val()) })); if (u.length > 0) for (v = Object.keys(i.get(0)), g = v[v.indexOf("AppliedAmt")], ot = v[v.indexOf("Discount")], ht = v[v.indexOf("Writeoff")], ct = v[v.indexOf("Amount")], y = 0; y < u.length; y++)c = i.get(u[y].recid), tt = parseInt(c.C_ConversionType_ID), w = u[y].Discount, w == undefined && (w = c.Discount), p = u[y].AppliedAmt, p == undefined && (p = c.AppliedAmt), b = u[y].Writeoff, b == undefined && (b = c.Writeoff), p != 0 && p != undefined && (p = nt(p, h), w = nt(w, h), b = nt(b, h), bu <= 0 ? it.push({ AppliedAmt: p, Discount: w, Writeoff: b, cinvoiceid: c.CinvoiceID, Converted: c.Converted, Currency: c.Currency, Date: c.Date1, Docbasetype: c.DocBaseType, documentno: c.Documentno, Isocode: c.Isocode, Multiplierap: c.Multiplierap, Amount: c.Amount, Org: parseInt(d.val()) }) : it.push({ AppliedAmt: p, Discount: w, Writeoff: b, cinvoiceid: c.CinvoiceID, Converted: c.Converted, Currency: c.Currency, Date: c.InvoiceScheduleDate, Docbasetype: c.DocBaseType, documentno: c.Documentno, Isocode: c.Isocode, Multiplierap: c.Multiplierap, Amount: c.Amount, c_invoicepayschedule_id: c.C_InvoicePaySchedule_ID, Org: parseInt(d.val()) })); t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/SaveCashData", type: "POST", data: { cashData: JSON.stringify(at), invoiceData: JSON.stringify(it), currency: st.val(), isCash: !0, _C_BPartner_ID: lt, _windowNo: ou.windowNo, payment: et, DateTrx: ft.val(), appliedamt: g, discount: ot, writeOff: ht, open: ct, DateAcct: o, _CurrencyType_ID: tt, isInterBPartner: !1, conversionDate: rt, chk: vt }, success: function (t) { ut = []; n.ADialog.info("", !0, t, ""); lr = !0; ku(); a[0].style.visibility = "hidden" }, error: function (t) { n.ADialog.info("", !0, t, ""); a[0].style.visibility = "hidden" } }) }, error: function (t) { n.ADialog.info("", !0, t, ""); a[0].style.visibility = "hidden" } }) } function ol(r, f, e, o) { if (sf + he == 0) return ""; t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/CheckPeriodState", data: { DateTrx: ft.val(), AD_Org_ID: d.val() }, async: !1, success: function (e) { var rt, g, v, y, c, w, p, b, pt; if (e != "") return n.ADialog.info("", !0, e, ""), lr = !0, ku(), a[0].style.visibility = "hidden", ""; var k = "", et = "", ot = "", ct = "", at = "", tt = 0, vt = [], it = [], yt = s.is(":checked"); for (rt = yt ? Globalize.format(new Date(l.val()), "yyyy-MM-dd") : Globalize.format(new Date, "yyyy-MM-dd"), y = 0; y < r.length; y++)c = u.get(r[y].recid), v = Object.keys(u.get(0)), k = v[v.indexOf("AppliedAmt")], tt = parseInt(c.C_ConversionType_ID), k = v[10], r[y].AppliedAmt != undefined && r[y].AppliedAmt != 0 && (g = r[y].AppliedAmt, g = nt(g, h), vt.push({ appliedamt: g, date: c.Date1, converted: c.ConvertedAmount, cpaymentid: c.CpaymentID, documentno: c.Documentno, isocode: c.Isocode, multiplierap: c.Multiplierap, openamt: c.OpenAmt, payment: c.Payment, Org: parseInt(d.val()) })); if (f.length > 0) for (v = Object.keys(i.get(0)), et = v[v.indexOf("AppliedAmt")], k = v[v.indexOf("AppliedAmt")], ot = v[v.indexOf("Discount")], ct = v[v.indexOf("Writeoff")], at = v[v.indexOf("Amount")], y = 0; y < f.length; y++)c = i.get(f[y].recid), tt = parseInt(c.C_ConversionType_ID), w = f[y].Discount, w == undefined && (w = c.Discount), p = f[y].AppliedAmt, p == undefined && (p = c.AppliedAmt), b = f[y].Writeoff, b == undefined && (b = c.Writeoff), p != 0 && p != undefined && (p = nt(p, h), w = nt(w, h), b = nt(b, h), bu <= 0 ? it.push({ appliedamt: p, discount: w, writeoff: b, cinvoiceid: c.CinvoiceID, converted: c.Converted, currency: c.Currency, date: c.Date1, docbasetype: c.DocBaseType, documentno: c.Documentno, isocode: c.Isocode, multiplierap: c.Multiplierap, amount: c.Amount, Org: parseInt(d.val()) }) : it.push({ appliedamt: p, discount: w, writeoff: b, cinvoiceid: c.CinvoiceID, converted: c.Converted, currency: c.Currency, date: c.InvoiceScheduleDate, docbasetype: c.DocBaseType, DocumentNo: c.Documentno, Isocode: c.Isocode, Multiplierap: c.Multiplierap, Amount: c.Amount, c_invoicepayschedule_id: c.C_InvoicePaySchedule_ID, Org: parseInt(d.val()) })); pt = !1; ir || (pt = !0); t.ajax({ url: n.Application.contextUrl + "PaymentAllocation/SavePaymentData", type: "POST", data: { paymentData: JSON.stringify(vt), invoiceData: JSON.stringify(it), currency: st.val(), _C_BPartner_ID: lt, _windowNo: ou.windowNo, payment: k, DateTrx: ft.val(), appliedamt: et, discount: ot, writeOff: ct, open: at, DateAcct: o, _CurrencyType_ID: tt, isInterBPartner: !1, conversionDate: rt, chk: yt }, success: function (t) { ut = []; ht = []; lr = !0; ku(); n.ADialog.info("", !0, t, ""); a[0].style.visibility = "hidden" }, error: function () { n.ADialog.info("", !0, e, ""); a[0].style.visibility = "hidden" } }) }, error: function (t) { n.ADialog.info("", !0, t, ""); a[0].style.visibility = "hidden" } }) } function sl(e, o, c, v) { t.ajax({ url: n.Application.contextUrl + "VIS/PaymentAllocation/CheckPeriodState", data: { DateTrx: ft.val(), AD_Org_ID: d.val() }, async: !1, success: function (t) { var ct, b, w, g, k, tt, p, y; if (t != "") return n.ADialog.info("", !0, t, ""), lr = !0, ku(), a[0].style.visibility = "hidden", ""; a[0].style.visibility = "visible"; var it = "", ut = "", et = "", ot = "", st = "", rt = 0, lt = [], at = [], vt = [], ht = [], yt = s.is(":checked"); if (ct = yt ? Globalize.format(new Date(l.val()), "yyyy-MM-dd") : Globalize.format(new Date, "yyyy-MM-dd"), e.length > 0) for (w = Object.keys(u.get(0)), it = w[w.indexOf("AppliedAmt")], p = 0; p < e.length; p++)y = u.get(e[p].recid), rt = parseInt(y.C_ConversionType_ID), e[p].AppliedAmt != undefined && e[p].AppliedAmt != 0 && (b = e[p].AppliedAmt, b = nt(b, h), lt.push({ AppliedAmt: b, Date: y.Date1, Converted: y.ConvertedAmount, cpaymentid: y.CpaymentID, Documentno: y.Documentno, Isocode: y.Isocode, Multiplierap: y.Multiplierap, OpenAmt: y.OpenAmt, Payment: y.Payment, Org: parseInt(d.val()), IsPaid: !1, paidAmt: 0, payment: it })); if (c.length > 0) for (w = Object.keys(f.get(0)), it = w[w.indexOf("AppliedAmt")], p = 0; p < c.length; p++)y = f.get(c[p].recid), rt = parseInt(y.C_ConversionType_ID), c[p].AppliedAmt != 0 && c[p].AppliedAmt != undefined && (b = c[p].AppliedAmt, b = nt(b, h), at.push({ AppliedAmt: b, Date: y.Created, Amount: y.Amount, ccashlineid: y.CcashlineiID, Converted: y.ConvertedAmount, Isocode: y.Isocode, Multiplierap: y.Multiplierap, OpenAmt: y.OpenAmt, ReceiptNo: y.ReceiptNo, Org: parseInt(d.val()), IsPaid: !1, paidAmt: 0, payment: it })); if (o.length > 0) for (w = Object.keys(i.get(0)), ut = w[w.indexOf("AppliedAmt")], et = w[w.indexOf("Discount")], ot = w[w.indexOf("Writeoff")], st = w[w.indexOf("Amount")], p = 0; p < o.length; p++)y = i.get(o[p].recid), rt = parseInt(y.C_ConversionType_ID), g = o[p].Discount, g == undefined && (g = y.Discount), k = o[p].AppliedAmt, k == undefined && (k = y.AppliedAmt), tt = o[p].Writeoff, tt == undefined && (tt = y.Writeoff), k != 0 && k != undefined && (k = nt(k, h), g = nt(g, h), tt = nt(tt, h), bu <= 0 ? ht.push({ AppliedAmt: k, Discount: g, Writeoff: tt, cinvoiceid: y.CinvoiceID, Converted: y.Converted, Currency: y.Currency, Date: y.Date1, Docbasetype: y.DocBaseType, applied: ut, discount: et, open: st, writeOff: ot, documentno: y.Documentno, Isocode: y.Isocode, Multiplierap: y.Multiplierap, Amount: y.Amount, Org: parseInt(d.val()), IsPaid: !1, paidAmt: 0 }) : ht.push({ AppliedAmt: k, Discount: g, Writeoff: tt, cinvoiceid: y.CinvoiceID, Converted: y.Converted, Currency: y.Currency, Date: y.InvoiceScheduleDate, Docbasetype: y.DocBaseType, applied: ut, discount: et, open: st, writeOff: ot, documentno: y.Documentno, Isocode: y.Isocode, Multiplierap: y.Multiplierap, Amount: y.Amount, c_invoicepayschedule_id: y.C_InvoicePaySchedule_ID, Org: parseInt(d.val()), IsPaid: !1, paidAmt: 0 })); if (v.length > 0) for (p = 0; p < v.length; p++)y = r.get(v[p].recid), rt = parseInt(y.C_ConversionType_ID), v[p].AppliedAmt != undefined && v[p].AppliedAmt != 0 && vt.push({ AppliedAmt: v[p].AppliedAmt, Date: y.DATEACCT, DateDoc: y.DATEDOC, DocumentNo: y.DOCUMENTNO, OpenAmount: y.OpenAmount, GL_JournalLine_ID: y.GL_JOURNALLINE_ID, GL_Journal_ID: y.GL_Journal_ID, ConvertedAmount: y.ConvertedAmount, Org: parseInt(d.val()), IsPaid: !1, paidAmt: 0 }); hl(JSON.stringify(lt), JSON.stringify(ht), JSON.stringify(at), JSON.stringify(vt), ft.val(), rt, ut, et, st, it, ot, ct, yt) }, error: function (t) { n.ADialog.info("", !0, t, ""); a[0].style.visibility = "hidden" } }) } function hl(e, o, s, h, c, l, v, y, p, w, b, k, nt) { t.ajax({ url: n.Application.contextUrl + "VIS/PaymentAllocation/saveGLJData", type: "POST", data: { paymentData: e, invoiceData: o, cashData: s, glData: h, DateTrx: c, _windowNo: ou.windowNo, C_Currency_ID: g, C_BPartner_ID: lt, AD_Org_ID: d.val(), C_CurrencyType_ID: l, DateAcct: oi.val(), applied: v, discount: y, open: p, payment: w, writeOff: b, conversionDate: k, chk: nt }, async: !1, success: function (t) { ut = []; ht = []; at = []; rt = []; ei = []; lr = !0; ku(); f && f.refresh(); r && r.refresh(); i && i.refresh(); u && u.refresh(); var e = n.DisplayType.GetNumberFormat(n.DisplayType.Amount); ue.text("0 " + n.Msg.getMsg("SelectedLines") + " - " + ti + " " + e.GetFormatedValue(0) + " "); ve.text(e.GetFormatedValue(0)); a[0].style.visibility = "hidden"; n.ADialog.info("", !0, t, "") }, error: function (t) { n.ADialog.info("", !0, t, ""); a[0].style.visibility = "hidden" } }) } function cl() { console.info("BPartner Name : " + y.getName() + " , Value : " + y.value); console.info("Currency ID : " + st.val()); console.info("Allocation From : " + k.val()); console.info("Allocation To : " + p.val()); console.info("MultiCurrency : " + s.is(":checked")); console.info("Organization : " + d.val()); console.info("Document Number : " + gf.val()); console.info("Document Type : " + wt.val()); console.info("Pay Document Type : " + bt.val()); console.info("From Date : " + ai.val()); console.info("To Date : " + ui.val()); console.info("Conversion Date : " + l.val()); a[0].style.visibility = "visible"; ar = 1; hu = 1; vf = 0; vr = 1; cu = 1; yf = 0; yr = 1; lu = 1; pf = 0; pr = 1; au = 1; wf = 0; wr = !1; br = !1; kr = !1; dr = !1; vt = 0; k.val() == "P" | p.val() == "P" ? bi() : wr = !0; k.val() == "C" | p.val() == "C" ? nu() : br = !0; k.val() == "I" | p.val() == "I" ? si() : kr = !0; k.val() == "G" | p.val() == "G" ? vu() : dr = !0; bf(k.val(), p.val()) } function w() { var n = s.is(":checked"); ws([], n); ys([], n); ps([], n); vs([], n); t(".vis-allocate-glSum").css("text-align", "right"); t(".vis-allocate-glSum").css("margin-right", "10px") } this.frame = null; this.windowNo = 0; var tu = n.Env.getCtx(), e = this, iu = t('<div class="vis-allocate-root vis-forms-container">'), de = t('<div class="vis-leftpanel-wrapper vis-pad-0 vis-leftsidebarouterwrap">'), et = t('<div class="vis-leftpanel-inn-wrap">'), ge = t('<div class="vis-allocation-rightContainer vis-formouterwrpdiv">'), it = t('<div class="vis-allocate-paymentdiv" >'), ot = t('<div class="vis-allocate-cashdiv" >'), ct = t('<div class="vis-allocate-invoicediv" >'), yt = t('<div class="vis-allocate-gldiv" style = "height:49%" >'), th = t("<div >"), ti = "", ii = null, y = null, ci = null, li = null, st = t('<select class="vis-allocation-currencycmb" ><\/select>'), d = null, wt = t('<select class="sel-allocation"><\/select>'), bt = t('<select class="sel-allocation"><\/select>'), dt = t('<select class="sel-allocation"><\/select>'), gt = t('<select class="sel-allocation"><\/select>'), ni = t('<select class="sel-allocation"><\/select>'), gf, v, c, ne, ur, fr = null, ai = t('<input class="date-allocation" type="date" max="9999-12-31"><\/input>'), ui = t('<input class="date-allocation" type="date" max="9999-12-31"><\/input>'), ki = t('<input class="date-allocation" type="date" max="9999-12-31"><\/input>'), vi = t('<input class="date-allocation" type="date" max="9999-12-31"><\/input>'), di = t('<input class="date-allocation" type="date" max="9999-12-31"><\/input>'), yi = t('<input class="date-allocation" type="date" max="9999-12-31"><\/input>'), gi = t('<input class="date-allocation" type="date" max="9999-12-31"><\/input>'), pi = t('<input class="date-allocation" type="date" max="9999-12-31"><\/input>'), ll = t('<input value = "" placeholder = "Search..." type = "text" id = _SrchTxtbx_"' + e.windowNo + ">"), te, ie = null, tf = null, rf = null, uf = null, ff = null, k = t('<select class="vis-allocation-currencycmb" ><\/select>'), p = t('<select class="vis-allocation-currencycmb" ><\/select>'), ef = null, re = null, ue = null, fi = null, no = 0, r = null, ru = !0, po = !1, to = 0, io = 0, ei = [], u = null, f = null, i = null, wi = null, er = null, or = null, nr = null, s = null, fe = null, ee = null, oe = null, uu = !1, tr = !1, oi = null, ft = null, ro = "", l = null, se = null, lt = 0, g = 0, he = 10, uo = 8, tt = null, wo = 7, bo = 8, ce = 9, fu = 8, le = 11, of = 12, fo = null, eo = null, oo = null, sf = 0, so = 0, ae = 0, yu = null, pu = null, wu = null, hf = null, ko = null, go = null, ns = null, ts = null, rt = [], sr = 0, is = null, at = [], cf = 0, rs = null, ht = [], hr = 0, us = null, ut = [], cr = 0, fs = null, es = !1, os = !1, ss = !1, lr = !1, ve = null, eu = null, hs = null, cs = null, a = null, ou = this, ir = !0, su = !1, lf = 0, af = 0, bu = 0, o = 0, pt = n.DisplayType.GetNumberFormat(n.DisplayType.Amount), h = n.Env.isDecimalPoint(), ri = 50, ar = 1, hu = 1, vf = 0, vr = 1, cu = 1, yf = 0, yr = 1, lu = 1, pf = 0, pr = 1, au = 1, wf = 0, wr = !1, br = !1, kr = !1, dr = !1, vt = 0, kt = [], gr = !0, ye = new n.CultureSeparator, ih = n.Application.contextUrl, rh = ih + "JsonData/JDataSetWithCode", uh = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return fh(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }; n.translatedTexts = n.Msg.translate(n.Env.getCtx(), ["AD_Org_ID", "C_BPartner_ID", "C_Currency_ID", "C_Payment_ID ", "C_CashLine_ID", "C_Cash_ID", "C_Invoice_ID ", "Date", "DocumentNo", "TrxCurrency", "C_ConversionType_ID", "Amount", "ConvertedAmount", "OpenAmount", "multiplierap", "AppliedAmount", "C_ConversionType_ID", "RECEIPTNO", "PaymentType", "ccashlineid", "ScheduleDate", "cinvoiceid", "DiscountAmt", "DocBaseType", "WriteOffAmount", "C_InvoicePaySchedule_ID", "DateAcct", "GL_JOURNALLINE_ID", "GL_Journal_ID", "DocType", "Doc_Base_Type", "FromDate", "Payment_Type", "CreditOrDebit", "Account", "VIS_Check", "AD_OrgTrx_ID", "PaymentMethod"], !0); eh(); this.disposeComponent = function () { u != undefined && u != null && (u.destroy(), u = null); f != undefined && f != null && (f.destroy(), f = null); i != undefined && i != null && (i.destroy(), i = null); r != undefined && r != null && (r.destroy(), r = null); wi = null; er = null; or = null; r = null; kt = null }; this.getRoot = function () { return iu } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps = n.Apps || {}; n.Apps.AForms = n.Apps.AForms || {}; n.Apps.AForms.VAllocation = i }(VIS, jQuery), function (n, t) { function i() { function vi() { e.append('<div class="vis-group-colwrap"><div class="vis-group-content-wrap"><\/div><\/div><div class="vis-group-colwrap"><div class="vis-group-content-wrap"><\/div><\/div><div class="vis-group-colwrap last-child"><div class="vis-group-content-wrap"><\/div><\/div>'); var n = e.find(".vis-group-content-wrap"); v = t(n[0]); o = t(n[1]); s = t(n[2]); n = null; yi(); bi(); ki(); di() } function yi() { i = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); i[0].style.visibility = "hidden"; e.append(i) } function pi() { k.on("click", rr); tt.on("click", pt); y.on("keydown", or); rt.on("click", ui); ot.on("click", kt); ft.on("click", bt); b.on("keydown", sr); ut.on("click", wt); w.on("keydown", hr); et.on("click", fr); it.on("click", ur); p.on("scroll", er); e.on("click", wi) } function wi(i) { var u = t(i.target); return !u.hasClass("vis-group-roless") && u.parents(".vis-group-roless").length == 0 && !u.hasClass("vis-group-save-btn") && a.length > 0 ? (n.ADialog.confirm("VIS_SaveRole", !0, "", "Confirm", function (n) { n ? ui() : a = [] }), i.stopPropagation(), !1) : !u.hasClass("vis-group-groupss") && u.parents(".vis-group-groupss").length == 0 && !u.hasClass("vis-group-save-btn") && r.length > 0 ? (n.ADialog.confirm("VIS_SaveRole", !0, "", "Confirm", function (n) { n ? kt() : r = [] }), i.stopPropagation(), !1) : void 0 } function bi() { i[0].style.visibility = "visible"; v.append('<div class="vis-group-content-head"><h4 class="vis-group-content-tittle">' + n.Msg.getMsg("VIS_CreateInviteUser") + '<\/h4><span class=" vis-group-pointer vis-group-head-right">' + n.Msg.getMsg("SortBy") + '<\/span><button class="vis-group-add-btn vis-groupbtn"><i class="vis vis-addbp"><\/i><\/button><\/div>'); lt = v.find(".vis-group-head-right"); v.append('<div class="vis-group-searchwrp"><div class="vis-group-content-headDown"><input class="vis-group-SearchText" value="" placeholder="' + n.Msg.getMsg("Search") + '" type="text"><button class="vis-groupbtn vis-group-search-icon"><i class="vis vis-search"><\/i><\/button><\/div><\/div>'); y = v.find(".vis-group-SearchText"); tt = v.find(".vis-group-search-icon"); k = v.find(".vis-group-add-btn"); p = t('<div class="vis-group-users-container">'); h = t('<div class="vis-group-DataContainer">'); p.height(t(e.parent()).height() - 95); v.append(p); p.append(h); nr() } function ki() { o.append(' <div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-role">' + n.Msg.getMsg("Role") + '<\/h4><h7 class="vis-group-SaveMessage">' + n.Msg.getMsg("VIS_RoleSaved") + '<\/h7><div class="vis-group-top-right"><button class="vis-groupbtn vis-group-add-btn"><i class="vis vis-new" title="' + n.Msg.getMsg("AddNew") + '" ><\/i><\/button><button class="vis-groupbtn vis-group-save-btn"><i class="vis vis-save" title="' + n.Msg.getMsg("Save") + '"><\/i><\/button><\/div><\/div><div class="vis-group-searchwrp"><div class="vis-group-content-headDown"><input class="vis-group-SearchText" value="" placeholder="' + n.Msg.getMsg("Search") + '" type="text"><button class="vis-groupbtn vis-group-search-icon"><i class="vis vis-search"><\/i><\/button><\/div><\/div>'); rt = o.find(".vis-group-save-btn"); it = o.find(".vis-group-add-btn"); w = o.find(".vis-group-SearchText"); ut = o.find(".vis-group-search-icon"); g = t('<div class="vis-group-role-container">'); c = t('<div class="vis-group-DataContainer">'); o.append(g); g.append(c); g.height(t(e.parent()).height() - 95); oi() } function di() { s.append('<div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-rights">' + n.Msg.getMsg("VIS_Groups") + '<\/h4><h7 class="vis-group-SaveMessage">' + n.Msg.getMsg("VIS_GroupSaved") + '<\/h7><div class="vis-group-top-right"><div class="vis-group-top-right"><button class="vis-groupbtn vis-group-add-btn"><i class="vis vis-new" title="' + n.Msg.getMsg("AddNew") + '"><\/i><\/button><button class="vis-groupbtn vis-group-save-btn"><i class="vis vis-save" title="' + n.Msg.getMsg("Save") + '"><\/i><\/button><\/div><\/div><\/div><div class="vis-group-searchwrp"><div class="vis-group-content-headDown"><input class="vis-group-SearchText"  value="" placeholder="' + n.Msg.getMsg("Search") + '" type="text"><button class="vis-groupbtn vis-group-search-icon"><i class="vis vis-search"><\/i><\/button><\/div><\/div>'); b = s.find(".vis-group-SearchText"); ft = s.find(".vis-group-search-icon"); et = s.find(".vis-group-add-btn"); ot = s.find(".vis-group-save-btn"); nt = t('<div class="vis-group-role-container">'); l = t('<div class="vis-group-DataContainer">'); s.append(nt); nt.append(l); nt.height(t(e.parent()).height() - 95); ir() } function gi() { d.append("<li value=1>" + n.Msg.getMsg("Name") + "<\/li>"); d.append("<li value=2>" + n.Msg.getMsg("SearchKey") + "<\/li>"); d.append("<li value=3>" + n.Msg.getMsg("EMail") + "<\/li>"); lt.on("click", function () { t(this).w2overlay(d.clone(!0)) }); d.on(n.Events.onTouchStartOrClick, "LI", function () { ri = t(this).val(); pt() }) } function nr() { tr(); pt() } function tr() { var i = ' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap"  data-UID="{{AD_UserID}}"><input type="radio" class="vis-GroupUserRadio"><div class="vis-group-user-profile vis-group-pro-width"><div class="vis-group-user-img vis-chatimgwrap">{{#if UserImage}}<img src="' + n.Application.contextUrl + '{{UserImage}}" alt="user-img">{{else}}<i class="fa fa-user"><\/i>{{/if}}<\/div><div class="vis-group-user-text">{{#if IsActive }}<p style="font-weight: bold">{{Username}}<\/p>{{else}}<p>{{Username}}<\/p>{{/if}}<span>{{Email}}<\/span><p>{{Country}}<\/p><\/div><\/div><div class="vis-group-user-right"><ul class="vis-flex-directionCol"><li><span class="vis-group-user-ico vis-group-edit vis vis-edit" style="padding-bottom: 15px;" title="' + n.Msg.getMsg("Edit") + '" data-UID="{{AD_UserID}}-{{UserTableID}}-{{UserWindowID}}"><\/span><\/li>{{#if IsActive }}{{#if IsUpdate}}<li><span class="vis-group-user-ico vis-group-activeUser fa fa-check-circle" title="' + n.Msg.getMsg("Active") + '" data-UID="{{AD_UserID}}"><\/span><\/li>{{else}}<li><span disabled class="vis-group-user-ico vis-group-activeUser fa fa-check-circle" title="' + n.Msg.getMsg("Active") + '" data-UID="{{AD_UserID}}"><\/span><\/li>{{/if}}{{else}}{{#if IsUpdate}}<li><span class="vis-group-user-ico vis-group-inactiveUser fa fa-check-circle" title="' + n.Msg.getMsg("InActive") + '"  data-UID="{{AD_UserID}}"><\/span><\/li>{{else}}<li><span disabled class="vis-group-user-ico vis-group-inactiveUser fa fa-check-circle" title="' + n.Msg.getMsg("InActive") + '" data-UID="{{AD_UserID}}"><\/span><\/li>{{/if}}{{/if}}<\/ul><\/div><\/div>{{/each}}<\/script>'; dt = t(i).html(); at = Handlebars.compile(dt) } function oi() { var i = ' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-roless vis-group-role-pad"  data-UID="{{AD_Role_ID}}"><div class="vis-group-user-profile">{{#if IsAssignedToUser}}{{#if IsUpdate}}<input type="checkbox" data-UID="{{AD_Role_ID}}" checked="">{{else}}<input disabled type="checkbox" data-UID="{{AD_Role_ID}}" checked="">{{/if}}<label style="color: rgba(var(--v-c-on-secondary), 1);font-weight: bold;">{{Name}}<\/label>{{else}}{{#if IsUpdate}}<input type="checkbox" data-UID="{{AD_Role_ID}}" >{{else}}<input disabled type="checkbox" data-UID="{{AD_Role_ID}}" >{{/if}}<label>{{Name}}<\/label>{{/if}}<\/div><div class="vis-group-user-right"><ul><li><span class="vis-group-user-ico vis-group-edit vis vis-edit" title="' + n.Msg.getMsg("Edit") + '" data-UID="{{AD_Role_ID}}-{{roleWindowID}}"><\/span><\/li><\/ul><\/div><\/div>{{/each}}<\/script>'; gt = t(i).html(); ni = Handlebars.compile(gt) } function ir() { var i = ' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-groupss vis-group-role-pad" data-UID="{{AD_Group_ID}}"><div class="vis-group-user-profile">{{#if IsAssignedToUser}}<input type="checkbox" data-UID="{{AD_Group_ID}}" checked=""><label style="color: rgba(var(--v-c-on-secondary), 1);font-weight: bold;">{{Name}}<\/label>{{else}}<input type="checkbox" data-UID="{{AD_Group_ID}}" ><label>{{Name}}<\/label>{{/if}}<\/div><div class="vis-group-user-right"><ul><li><span class="vis-group-user-ico vis-group-edit vis vis-edit" style="margin-right: 10px" title="' + n.Msg.getMsg("Edit") + '" data-UID="{{AD_Group_ID}}-{{GroupWindowID}}"><\/span><\/li><li><span class="vis-group-user-ico vis-group-info vis vis-info"   data-UID="{{AD_Group_ID}}-{{GroupWindowID}}"><\/span><\/li><\/ul>                           <\/div><\/div>{{/each}}<\/script>'; ti = t(i).html(); ii = Handlebars.compile(ti) } function rr() { var t = new n.createUser; t.intialize(); t.show() } function ur() { var t = new n.createrole; t.intialize(); t.show() } function fr() { i[0].style.visibility = "visible"; yt == 0 && t.ajax({ url: n.Application.contextUrl + "Group/GetWindowIds", async: !1, success: function (n) { var t = JSON.parse(n); t != null && t != undefined && (yt = t.GroupWindowID, hi = t.RoleWindowID, ci = t.UserWindowID) }, error: function () { n.Msg.getMsg("VIS_GroupWindowNotFound") } }); var r = new n.Query; r.addRestriction("AD_GroupInfo_ID", n.Query.prototype.EQUAL, 0); n.viewManager.startWindow(yt, r); i[0].style.visibility = "hidden" } function pt() { ct = 1; t.ajax({ url: n.Application.contextUrl + "Group/GetUserInfo", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { searchText: y.val(), sortBy: ri, pageNo: ct, pageSize: ei }, success: function (n) { var i = JSON.parse(n); h.find(".vis-group-user-wrap").remove(); h.append(at(i)); h.off("click"); h.on("click", cr); t(h.children(".vis-group-user-wrap")).length > 0 && t(h.children(".vis-group-user-wrap")[0]).trigger("click"); ct++ }, error: function () { n.ADialog.error("VIS_ErrorLoadingContacts"); i[0].style.visibility = "hidden" } }) } function er() { t(this).scrollTop() + t(this).innerHeight() >= this.scrollHeight && t.ajax({ url: n.Application.contextUrl + "Group/GetUserInfo", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { searchText: y.val(), sortBy: ri, pageNo: ct, pageSize: ei }, success: function (n) { ct++; var t = JSON.parse(n); h.append(at(t)); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorLoadingContacts"); i[0].style.visibility = "hidden" } }) } function or(n) { (n.keyCode == undefined || n.keyCode == 13) && y != undefined && y != null && pt() } function sr(n) { (n.keyCode == undefined || n.keyCode == 13) && b != undefined && b != null && bt() } function hr(n) { (n.keyCode == undefined || n.keyCode == 13) && w != undefined && w != null && wt() } function cr(i) { var r, u, f; if (!(a.length > 0)) { if (r = t(i.target), t(t(h.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op vis-group-selected-opbackground"), t(h).find(".vis-GroupUserRadio").prop("checked", !1), r.hasClass("vis-group-user-wrap")) r.addClass("vis-group-selected-op vis-group-selected-opbackground"), vt = r.data("uid"), t(t(r).find(".vis-GroupUserRadio")[0]).prop("checked", !0); else if (t(r.parents(".vis-group-user-wrap")).length > 0) t(r.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op vis-group-selected-opbackground"), vt = t(r.parents().find(".vis-group-selected-op")).data("uid"), t(t(t(r).parents(".vis-group-user-wrap")[0]).find(".vis-GroupUserRadio")[0]).prop("checked", !0); else return; r.hasClass("vis-group-user-ico vis-group-edit") ? (u = r.data("uid").split("-"), f = new n.Query, f.addRestriction("AD_User_ID", n.Query.prototype.EQUAL, u[0]), n.viewManager.startWindow(u[2], f)) : r.hasClass("vis-group-user-ico vis-group-activeUser") && r.attr("disabled") != "disabled" ? si(r, !1) : r.hasClass("vis-group-user-ico vis-group-inactiveUser") && r.attr("disabled") != "disabled" && si(r, !0); wt(r) } } function wt() { i[0].style.visibility = "visible"; var r = w.val(); t.ajax({ url: n.Application.contextUrl + "Group/GetRoleInfo", data: { AD_User_ID: vt, name: r }, success: function (n) { var u = JSON.parse(n), r; c.find(".vis-group-user-wrap").remove(); c.append(ni(u)); c.off("click"); c.on("click", lr); for (t(c.children(".vis-group-user-wrap")).length > 0 && t(t(c).children(".vis-group-user-wrap")[0]).trigger("click"), st = [], r = 0; r < u.length; r++)st.push({ AD_Role_ID: u[r].AD_Role_ID, IsAssignedToUser: u[r].IsAssignedToUser }); t(c.find("input")).off("click"); t(c.find("input")).on("click", yr); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorLoadingRoles"); i[0].style.visibility = "hidden" } }) } function bt() { i[0].style.visibility = "visible"; var r = b.val(); t.ajax({ url: n.Application.contextUrl + "Group/GetGroupInfo", data: { AD_Role_ID: u, name: r }, success: function (n) { var u = JSON.parse(n), r; l.find(".vis-group-user-wrap").remove(); l.append(ii(u)); l.off("click"); l.on("click", ar); for (t(l.children(".vis-group-user-wrap")).length > 0 && t(t(l).children(".vis-group-user-wrap")[0]).trigger("click"), ht = [], i[0].style.visibility = "hidden", r = 0; r < u.length; r++)r == 0 && (yt = u[r].GroupWindowID), ht.push({ AD_Group_ID: u[r].AD_Group_ID, IsAssignedToUser: u[r].IsAssignedToUser }); t(l.find("input")).off("click"); t(l.find("input")).on("click", pr) }, error: function () { n.ADialog.error("VIS_ErrorLoadingGroups"); i[0].style.visibility = "hidden" } }) } function lr(i) { var f, e; if (li = !0, r.length > 0) { n.ADialog.confirm("VIS_SaveGroup", !0, "", "Confirm", function (n) { n ? kt() : r = [] }); return } f = t(i.target); t(t(c.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op vis-group-selected-opbackground"); f.hasClass("vis-group-user-wrap") ? (f.addClass("vis-group-selected-op vis-group-selected-opbackground"), u = f.data("uid")) : u = t(f.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op vis-group-selected-opbackground").data("uid"); f.hasClass("vis-group-user-ico vis-group-edit") && (u = f.data("uid"), u = u.split("-"), e = new n.Query, e.addRestriction("AD_Role_ID", n.Query.prototype.EQUAL, u[0]), n.viewManager.startWindow(u[1], e), u = u[0]); u != undefined && bt(f); i.originalEvent === undefined && i.stopPropagation() } function ar(i) { var r, u; ai = !0; r = t(i.target); t(t(l.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op"); r.hasClass("vis-group-user-wrap") ? (r.addClass("vis-group-selected-op"), f = r.data("uid")) : (t(r.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op"), f = t(r.parents().find(".vis-group-selected-op")).data("uid")); r.hasClass("vis-group-user-ico vis-group-edit") ? (f = r.data("uid"), f = f.split("-"), u = new n.Query, u.addRestriction("AD_GroupInfo_ID", n.Query.prototype.EQUAL, f[0]), n.viewManager.startWindow(f[1], u)) : r.hasClass("vis-group-user-ico vis-group-info") && (f = r.data("uid"), f = f.split("-"), vr(f[0])); i.originalEvent === undefined && i.stopPropagation() } function vr(t) { var i = new n.groupInfo(t); i.intialize(); i.show() } function yr(i) { if (r.length > 0) { n.ADialog.confirm("VIS_SaveGroup", !0, "", "Confirm", function (n) { n ? kt() : r = [] }); return } var f = t(i.target), u = t.grep(st, function (n) { return n.AD_Role_ID == f.data("uid") }); u != null && u.length > 0 && (u[0].IsAssignedToUser = f.prop("checked")); u = t.grep(a, function (n) { return n == f.data("uid") }); u == null || u.length == 0 ? a.push(f.data("uid")) : a.splice(a.indexOf(f.data("uid")), 1); i.stopPropagation() } function pr(i) { if (a.length > 0) { n.ADialog.confirm("VIS_SaveRole", !0, "", "Confirm", function (n) { n ? ui() : a = [] }); return } var f = t(i.target), u = t.grep(ht, function (n) { return n.AD_Group_ID == f.data("uid") }); u != null && u.length > 0 && (u[0].IsAssignedToUser = f.prop("checked")); u = t.grep(r, function (n) { return n == f.data("uid") }); u == null || u.length == 0 ? r.push(f.data("uid")) : r.splice(r.indexOf(f.data("uid")), 1); i.stopPropagation() } function ui() { i[0].style.visibility = "visible"; a = []; t.ajax({ url: n.Application.contextUrl + "Group/UpdateUserRoles", type: "Post", data: { AD_User_ID: vt, roles: JSON.stringify(st) }, success: function () { t(t(o.find("h7"))[0]).show(); t(t(o.find("h7"))[0]).fadeOut(1600, "linear"); wt() }, error: function () { n.ADialog.error(n.Msg.getMsg("VIS_ErrorSavingRole")); i[0].style.visibility = "hidden" } }) } function kt() { i[0].style.visibility = "visible"; r = []; t.ajax({ url: n.Application.contextUrl + "Group/UpdateUserGroups", type: "Post", data: { AD_Role_ID: u, AD_Group_ID: f, groups: JSON.stringify(ht) }, success: function () { t(t(s.find("h7"))[0]).show(); t(t(s.find("h7"))[0]).fadeOut(1600, "linear"); bt() }, error: function () { n.ADialog.error(n.Msg.getMsg("VIS_ErrorSavingGroups")); i[0].style.visibility = "hidden" } }) } function si(r, u) { i[0].style.visibility = "visible"; var f = ""; u ? (r.removeClass("vis-group-user-ico vis-group-inactiveUser"), r.addClass("vis-group-user-ico vis-group-activeUser"), f = n.Application.contextUrl + "Group/ActiveUser") : (r.removeClass("vis-group-user-ico vis-group-activeUser"), r.addClass("vis-group-user-ico vis-group-inactiveUser"), f = n.Application.contextUrl + "Group/InActiveUser"); t.ajax({ url: f, data: { AD_User_ID: r.data("uid") }, success: function (t) { var f = JSON.parse(t); f < 1 && n.ADialog.error("VIS_UserNotUpdated"); u ? r.prop("title", n.Msg.getMsg("Active")) : r.prop("title", n.Msg.getMsg("InActive")); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_UserNotUpdated"); i[0].style.visibility = "hidden" } }) } this.frame = null; this.windowNo = null; var fi = this, e = t('<div class="vis-group-assign-content">'), d = t('<ul class="vis-apanel-rb-ul"><\/ul>'), v = null, o = null, s = null, p = null, y = null, tt = null, k = null, lt = null, it = null, rt = null, g = null, h = null, c = null, l = null, i = null, w = null, ut = null, b = null, ft = null, et = null, ot = null, nt = null, dt, at, gt, ni, ti, ii, ri = -1, vt = 0, st = [], ht = [], a = [], r = [], u = 0, f = 0, yt = 0, hi = 0, ci = 0, ct = 0, ei = 20, li = !1, ai = !1; this.initializeComponent = function () { vi(); pi(); gi() }; this.disposeComponent = function () { k != null && k != undefined && k.off("click"); tt.off("click"); y.off("keydown"); rt.off("click"); ot.off("click"); ft.off("click"); b.off("keydown"); ut.off("click"); w.off("keydown"); et.off("click"); it.off("click"); p.off("scroll"); e.off("click"); this.frame = null; this.windowNo = null; v.remove(); v = null; o.remove(); o = null; s.remove(); s = null; p.remove(); p = null; y.remove(); y = null; tt.remove(); tt = null; k.remove(); k = null; lt.remove(); lt = null; it.remove(); it = null; rt.remove(); rt = null; g.remove(); g = null; i.remove(); i = null; b.remove(); b = null; ft.remove(); ft = null; w.remove(); w = null; ut.remove(); ut = null; et.remove(); et = null; ot.remove(); ot = null; nt.remove(); nt = null; dt.remove(); at.remove(); gt.remove(); ni.remove(); ti.remove(); ii.remove(); st = null; ht = null; a = null; r = null; e.remove(); e = null; d = null; fi = null }; this.getRoot = function () { return e } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; t.setTitle("VIS_Group"); this.frame.getContentGrid().append(this.getRoot()); this.initializeComponent() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.GroupForm = i }(VIS, jQuery), function (n, t) { function i() { function ft() { i = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); i[0].style.visibility = "hidden"; r.append(i) } function et() { r = t("<div>"); var i = '  <div style="overflow:hidden" class="vis-group-assinRole-content"><div class="vis-group-assinRole-data" style=" margin-top: 5px; margin-bottom: 0; "><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input  tabindex="1" class="vis-group-email" type="text" name="Name" data-placeholder="" placeholder=" "><label>' + n.Msg.getMsg("EMail") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data vis-creategroup-btnwrap"> <a tabindex="2" class="vis-group-btn vis-group-pointer vis-group-create vis-group-grayBtn" style="float: left;">' + n.Msg.getMsg("Create") + '<\/a><a tabindex="3" class="vis-group-btn vis-group-pointer vis-group-invite vis-group-blueBtn" style="float: right;">' + n.Msg.getMsg("VIS_Invite") + "<\/a><\/div><\/div>"; s = t('<div class="vis-group-assignContainer" style="visibility:hidden"><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input  tabindex="4" type="text" maxlength="60" data-placeholder="" placeholder=" " class="vis-group-name vis-group-mandatory"  name="Name"><label>' + n.Msg.getMsg("Name") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="5" type="text" maxlength="80" data-placeholder="" placeholder=" " class="vis-group-uid"  name="Name"><label>' + n.Msg.getMsg("VIS_UserID") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="6" type="password" maxlength="250" data-placeholder="" placeholder=" " class="vis-group-pwd"  name="Name"><label>' + n.Msg.getMsg("Password") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="7" type="text"  maxlength="50" data-placeholder="" placeholder=" " class="vis-group-mobile"  name="Name"><label>' + n.Msg.getMsg("Mobile") + '<\/label><\/div><\/div><\/div><a tabindex="8" class="vis-group-btn vis-group-Save vis-group-pointer vis-group-grayBtn" style="float: right;">' + n.Msg.getMsg("Save") + "<\/a><\/div>"); o = t('<div class="vis-group-roleContainer" ><div> <label >' + n.Msg.getMsg("SelectRole") + "<\/label> <\/div><\/div>"); r.append(i); f = r.find(".vis-group-assinRole-content"); f.height("100px"); c = r.find(".vis-group-create"); l = r.find(".vis-group-invite"); a = s.find(".vis-group-Save"); e = s.find(".vis-group-name"); p = s.find(".vis-group-uid"); b = s.find(".vis-group-mobile"); w = s.find(".vis-group-pwd"); v = r.find(".vis-group-email") } function ot() { e.on("change", lt); c.on("click", tt); c.on("keydown", st); l.on("click", it); l.on("keydown", ct); a.on("click", rt); a.on("keydown", ht) } function st(n) { (n.keyCode == undefined || n.keyCode == 13) && tt() } function ht(n) { (n.keyCode == undefined || n.keyCode == 13) && rt() } function ct(n) { (n.keyCode == undefined || n.keyCode == 13) && it() } function lt() { e.val().length > 0 ? e.removeClass("vis-group-mandatory") : e.addClass("vis-group-mandatory") } function at() { g = t(' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-role-pad"  data-UID="{{AD_Role_ID}}"><div class="vis-group-user-profile"><input tabindex="7"  type="checkbox" data-UID="{{AD_Role_ID}}" ><label>{{Name}}<\/label><\/div><\/div>{{/each}}<\/script>').html(); nt = Handlebars.compile(g) } function vt() { i[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Group/GetRoleInfo", data: { AD_User_ID: 0 }, success: function (r) { var f = JSON.parse(r), e = t('<div style="height:212px;overflow:auto;margin-bottom:10px">'), u; e.append(nt(f)); o.append(e); k = t('<a tabindex="400" class="vis-group-btn vis-group-pointer vis-group-finish vis-group-grayBtn" style="float: right;">' + n.Msg.getMsg("VIS_Finish") + "<\/a>"); o.append(k); k.on("click", ut); k.on("keydown", yt); for (t(o.children(".vis-group-user-wrap")).length > 0 && t(t(o).children(".vis-group-user-wrap")[0]).trigger("click"), u = 0; u < f.length; u++)d.push({ AD_Role_ID: f[u].AD_Role_ID, IsAssignedToUser: !1 }); t(o.find("input")).off("click"); t(o.find("input")).on("click", pt); i[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorLoadingRoles"); i[0].style.visibility = "hidden" } }) } function yt(n) { (n.keyCode == undefined || n.keyCode == 13) && ut() } function pt(n) { var r = t(n.target), i = t.grep(d, function (n) { return n.AD_Role_ID == r.data("uid") }); i != null && i.length > 0 && (i[0].IsAssignedToUser = r.prop("checked")); n.stopPropagation() } function tt() { f.find(".vis-group-roleContainer").css("display", "none"); f.find(".vis-group-assignContainer").css("display", "inherit"); f.append(s); r.find(".vis-group-assignContainer").css({ visibility: "visible" }); f.height("400px") } function it() { f.find(".vis-group-assignContainer").css("display", "none"); f.find(".vis-group-roleContainer").css("display", "inherit"); f.append(o); f.height("403px") } function rt() { var f, o; if (t(r.find(".vis-group-assignContainer")[0]).css("visibility") == "visible") { if (f = e.val(), f == null || f == undefined || f == "") { n.ADialog.info("VIS_PleaseName"); return } i[0].style.visibility = "visible"; (y == null || y == undefined) && (y = null); o = n.secureEngine.encrypt(w.val()); t.ajax({ url: n.Application.contextUrl + "Group/SaveNewUser", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", async: !0, data: { Name: f, Email: v.val(), Value: p.val(), password: o, mobile: b.val(), OrgID: JSON.stringify(y) }, success: function (t) { var r = JSON.parse(t); i[0].style.visibility = "hidden"; r.length > 0 ? n.ADialog.error(r) : (n.ADialog.info("Record saved successfully"), u.close()) }, error: function () { i[0].style.visibility = "hidden"; n.ADialog.error("VIS_ErrorSavingUser") } }) } } function ut() { var r = v.val(), h, s, e, f, o; if (r == null || r == undefined || r == "") { n.ADialog.error("NotValidEmail"); return } if (h = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i), r.indexOf(";") == -1) { if (f = h.test(r), !f) { n.ADialog.error("NotValidEmail", !0, ":" + r); return } } else for (s = r.split(";"), e = 0; e < s.length; e++)if (f = h.test(s[e]), !f) { n.ADialog.error("NotValidEmail", !0, ":" + s[e]); return } if (o = t.grep(d, function (n) { return n.IsAssignedToUser == !0 }), o == null || o == undefined || o.length == 0) { n.ADialog.info("VIS_SelectRole"); return } r != null && r != undefined && r != "" && r.length > 0 && (i[0].style.visibility = "visible", t.ajax({ url: n.Application.contextUrl + "Group/InviteUsers", type: "POST", datatype: "json", async: !0, data: { email: r, roles: JSON.stringify(o) }, success: function (t) { var r = JSON.parse(t); n.ADialog.info(r); i[0].style.visibility = "hidden"; u.close() }, error: function () { n.ADialog.error("VIS_ErrorInvitingUsers"); i[0].style.visibility = "hidden" } })) } var r = null, f = null, c = null, l = null, a = null, v = null, e = null, p = null, w = null, b = null, u = null, h = this, y = null, i = null, g, nt = null, o = null, d = [], s = null, k = null; this.intialize = function () { et(); ot(); ft(); at(); vt() }; this.setSelectedOrg = function (n) { y = n }; this.show = function () { u = new n.ChildDialog; u.setContent(r); u.setPosition({ my: "center bottom-3" }); u.setWidth(550); u.setTitle(n.Msg.getMsg("VIS_CreateUser")); u.setModal(!0); u.onClose = function () { h.onClose && h.onClose(); h.dispose() }; u.show(); u.hideButtons() }; this.dispose = function () { this.prop = null; $div = null; u = null; h = null; r.remove(); r = null; c.remove(); c = null; l.remove(); l = null; a.remove(); a = null; v.remove(); v = null; e.remove(); e = null; p.remove(); p = null; w.remove(); w = null; b.remove(); b = null; u = null; h = null } } n.createUser = i }(VIS, jQuery), function (n, t) { function i(i) { function h() { u = t("<div>"); t.ajax({ url: n.Application.contextUrl + "Group/GetOrgAccess", success: function (n) { var i = JSON.parse(n); u.append(s(i)); t(u.find("input")).on("click", a) }, error: function () { n.ADialog.error("VIS_ErrorLoadingOrg") } }) } function c() { o = t(' <script type="text/x-handlebars-template">{{#each this}}<div style="border-bottom:1px solid rgba(var(--v-c-on-secondary), .2); margin-bottom: 10px" class="vis-group-assinRole-check"><div style="width:100%" class="vis-group-user-profile"><input type="Checkbox" data-uid="{{OrgID}}"> <p style="margin-bottom:2px">{{OrgName}}<\/p><span class="vis-orgaccess-description">{{Description}}<\/span><\/div><\/div>{{/each}}<\/script>').html(); s = Handlebars.compile(o) } function l() { r.onOkClick = function () { i(f); e.dispose() }; r.onCancelClick = function () { e.dispose() } } function a(n) { var i = t(n.target); i.prop("checked") ? t.inArray(i.data("uid")) == -1 && f.push(i.data("uid")) : f.splice(f.indexOf(i.data("uid")), 1) } var u = null, o, s = null, r = null, f = [], e = this; this.intialize = function () { c(); h() }; this.show = function () { r = new n.ChildDialog; r.setContent(u); r.setWidth(450); r.setHeight(350); r.setTitle(n.Msg.getMsg("VIS_OrgAccess")); r.setModal(!0); r.onClose = function () { e.dispose() }; r.show(); l() }; this.dispose = function () { this.prop = null; $div = null; u.remove(); u = null; o = null; s = null; r = null; e = null; f = null } } n.orgAccess = i }(VIS, jQuery), function (n, t) { function i(i) { function f() { u = t('<div  class="vis-forms-container">'); e() } function e() { t.ajax({ url: n.Application.contextUrl + "Group/GetGroupChildInfo", data: { groupID: i }, success: function (t) { var i = JSON.parse(t), r = '<div class="vis-group-gi-content"><label>' + i.GroupName + "<\/label>"; i.Description != null && i.Description != undefined && i.Description != "" && (r += "<p>" + i.Description + "<\/p>"); i.WindowName != null && i.WindowName != undefined && i.WindowName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("Windows") + ":<\/label><p>" + i.WindowName + "<\/p>", "<\/div>"); i.FormName != null && i.FormName != undefined && i.FormName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("VIS_Forms") + ":<\/label><p>" + i.FormName + "<\/p>", "<\/div>"); i.ProcessName != null && i.ProcessName != undefined && i.ProcessName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("VIS_Processes") + ":<\/label><p>" + i.ProcessName + "<\/p>", "<\/div>"); i.WorkflowName != null && i.WorkflowName != undefined && i.WorkflowName != "" && (r += '<div class="vis-group-gi-data"><label>' + n.Msg.getMsg("VIS_Workflows") + ":<\/label><p>" + i.WorkflowName + "<\/p>", "<\/div>"); r += "<\/div>"; u.append(r) }, error: function () { n.ADialog.error("VIS_ErrorGettingGroupInfo") } }) } var u = null, r = null; this.intialize = function () { f() }; this.show = function () { r = new n.ChildDialog; r.setContent(u); r.setHeight(500); r.setWidth(550); r.setTitle(n.Msg.getMsg("VIS_Groupinfo")); r.setModal(!0); r.onClose = function () { self.onClose && self.onClose(); self.dispose() }; r.show(); r.hideButtons() }; this.dispose = function () { self = null; u.remove(); u = null; r = null } } n.groupInfo = i }(VIS, jQuery), function (n, t) { function i() { function v() { var i = '<div class="vis-group-assinRole-content"><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><input tabindex="1" maxlength="60" data-placeholder="" placeholder=" " class="vis-group-role-text vis-ev-col-mandatory" type="text"><label>' + n.Msg.getMsg("Role") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><select  tabindex="2"  class="vis-group-role-select" ><\/select><label>' + n.Msg.getMsg("VIS_UserLevel") + '<\/label><\/div><\/div><\/div><div class="vis-group-assinRole-data vis-group-asignrole-btnwrap"><a style="float:left"  tabindex="3"  class="vis-group-btn vis-group-orgAccess vis-group-pointer vis-group-grayBtn">' + n.Msg.getMsg("VIS_OrgAccess") + '<\/a><a  tabindex="4"  class="vis-group-btn vis-group-Save vis-group-pointer vis-group-grayBtn" style="float: right;">' + n.Msg.getMsg("Save") + "<\/a><\/div><\/div>"; r.append(i); u = r.find(".vis-group-role-text"); o = r.find(".vis-group-role-select"); s = r.find(".vis-group-orgAccess"); h = r.find(".vis-group-Save"); y(); f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Group/GetUserLevel", success: function (n) { var t = JSON.parse(n), i; if (t != null && t.length > 0) for (i = 0; i < t.length; i++)o.append('<option value="' + t[i].ID + '">' + t[i].Name + "<\/option>"); f[0].style.visibility = "hidden" } }) } function y() { f = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); f[0].style.visibility = "hidden"; r.append(f) } function p() { s.on("click", l); s.on("keydown", w); h.on("click", a); h.on("keydown", b); u.on("change", k) } function w(n) { (n.keyCode == undefined || n.keyCode == 13) && l() } function b(n) { (n.keyCode == undefined || n.keyCode == 13) && a() } function k() { u.val().length > 0 ? u.removeClass("vis-group-mandatory") : u.addClass("vis-group-mandatory") } function l() { var t = new n.orgAccess(c.setSelectedOrg); window.setTimeout(function () { t.intialize(); t.show() }, 20) } function a() { var s = u.val(), r = o.val(); if (s == null || s == undefined || s == "") { n.ADialog.info("VIS_PleaseName"); return } if (e == undefined || e == null || e == "" || e.length == 0) { n.ADialog.info("VIS_SelectOrgAccess"); return } if (r == null || r == undefined || r == "" || r == -1) { n.ADialog.info("VIS_SelectUserLevel"); return } f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "Group/AddNewRole", data: { name: s, userLevel: r, orgID: JSON.stringify(e) }, success: function (t) { var r = JSON.parse(t); r.length > 0 ? n.ADialog.error(r) : (n.ADialog.info("Record saved successfully"), i.close()); f[0].style.visibility = "hidden" }, error: function () { n.ADialog.error("VIS_ErrorSavingRole"); f[0].style.visibility = "hidden" } }) } var r = t("<div>"), i = null, u = null, o = null, s = null, h = null, e = null, c = this, f = null; this.intialize = function () { v(); p() }; this.setSelectedOrg = function (n) { e = n }; this.show = function () { i = new n.ChildDialog; i.setContent(r); i.setWidth(550); i.setTitle(n.Msg.getMsg("VIS_CreateRole")); i.setModal(!0); i.onClose = function () { c.dispose(); c = null }; i.show(); i.hideButtons() }; this.dispose = function () { u.remove(); u = null; o.remove(); o = null; s.remove(); s = null; h.remove(); h = null; r.remove(); r = null; i = null } } n.createrole = i }(VIS, jQuery), function (n, t) { function i() { var b, k, d, g, p; this.onClose = null; var nt = this, r = null, u = null, e = null, a = null, o = null, s = null, h = null, i = null, c = [], w = null, v = null, tt = null, y = [], f = [], l = null, it = function () { r = t("<div>"); u = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); u[0].style.visibility = "visible"; r.append(u); e = t("<div>"); a = t("<div class='vis-markmodulemainwrap'>"); e.append(a); h = t("<div>"); e.append(h); var i = n.Msg.getMsg("Cancel"), f = n.Msg.getMsg("Ok"); s = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(i); o = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(f); h.append(s); h.append(o); r.append(e); l = t("<table>") }; it(); b = function () { s.on("click", function () { p() }); o.on("click", function () { d() }) }; b(); k = function () { var k, d, e, r, b, o; if (i = [], k = null, e = n.dataContext.getJSONData(n.Application.contextUrl + "MarkModule/LoadModules", null, null), e != null) for (r in e) k = {}, k.AD_ModuleInfo_ID = e[r].AD_ModuleInfo_ID, k.Name = e[r].Name, i.push(k); if (c.length == 1 && (d = { RecordID: c[0], TableID: v }, e = n.dataContext.getJSONData(n.Application.contextUrl + "MarkModule/GetExportData", d, null), e != null)) for (r in e) y.push(e[r]); var h = null, p = null, s = null, w = null; if (y.length == 0) for (r = 0; r < i.length; r++)h = t("<tr>"), p = t("<td>"), s = t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'), w = t("<input type='checkbox'>"), s.append(w), s.append(i[r].Name), p.append(s), h.append(p), l.append(h), o = {}, o.Ctrl = w, o.AD_ModuleInfo_ID = i[r].AD_ModuleInfo_ID, f.push(o); else for (b = 0; b < i.length; b++)h = t("<tr>"), p = t("<td>"), s = t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'), w = y.indexOf(i[b].AD_ModuleInfo_ID) > -1 ? t("<input type='checkbox' checked>") : t("<input type='checkbox'>"), s.append(w), s.append(i[b].Name), p.append(s), h.append(p), l.append(h), o = {}, o.Ctrl = w, o.AD_ModuleInfo_ID = i[b].AD_ModuleInfo_ID, f.push(o); a.append(l); u[0].style.visibility = "hidden" }; d = function () { var i, t, e, o, r; for (u[0].style.visibility = "visible", i = [], t = 0; t < f.length; t++)e = f[t].Ctrl, e.prop("checked") && i.push(f[t].AD_ModuleInfo_ID); o = { moduleId: i, _recordID: c, _tableID: v, _strRecordID: w }; r = n.dataContext.getJSONData(n.Application.contextUrl + "MarkModule/SaveExportData", o); r.result != "OK" && alert(r.result); u[0].style.visibility = "hidden"; p() }; this.show = function () { r.dialog({ title: n.Msg.getMsg("VIS_MarkModule"), width: 400, height: 500, resizable: !1, modal: !0, close: g }); k() }; this.init = function (n, t, i) { c = n.toString().split(","); w = n; v = t; tt = i }; g = function () { p() }; p = function () { nt.onClose && nt.onClose(); e = null; a = null; s.off("click"); o.off("click"); o = null; s = null; h = null; k = null; d = null; it = null; b = null; g = null; u = null; i = null; c = null; w = null; v = null; tt = null; y = null; f = null; l = null; r != null && (r.dialog("destroy"), r.remove()); r = null } } n.MarkModule = i }(VIS, jQuery), function (n, t) { function r(r) { function ve() { wr = t('<div class="vis-forms-container" style="width:100%;height:100%"><\/div>'); ye(); pe(); hf(); cr = !0; cf(); no(d); h && g || (l.find("input").prop("disabled", !0), v.find("select").prop("disabled", !0)) } function ef() { u.find("*").attr("disabled", "disabled"); u.find(".vis-firstdiv *").removeAttr("disabled"); u.find(".vis-btnDelete").removeAttr("disabled"); u.find(".vis-cardviewbtn .vis-cdv-customokcancle *").removeAttr("disabled") } function ei(n) { n && ri != null && ri.css({ display: "block" }); n || ri == null || ri.css({ display: "none" }) } function vu(n) { var t, i, r; if (bi(), n && n.length > 0) for (k = n.split(","), t = 0; t < k.length; t++)i = k[t].split(" "), r = a.getField(i[0]), of(r.getHeader(), i[0], i[1]) } function bi() { pr.empty(); k = []; au = [] } function of(n, t, i) { var r = '<div class="vis-sortListItem"><p>' + n + '<\/p><div class="vis-sortListIcons"><span class="vis-sortAsc">'; r += i == "ASC" ? '<i class="fa fa-sort-amount-asc"><\/i>' : '<i class="fa fa-sort-amount-asc" style="transform: rotate(180deg);padding-top:1px"><\/i>'; r += '<\/span><span class="vis-sortIcon vis-sortListItemClose" data-text="' + t + " " + i + '"><i class="fa fa-close"><\/i><\/span><\/div><\/div>'; pr.append(r) } function vf() { hr.css({ display: "block" }); c.css({ display: "block" }); sr.css({ display: "none" }); ot.css({ display: "none" }); dt.css({ display: "block" }); lt.css({ display: "none" }); ot.val(""); at.css({ display: "block" }); kt.css({ display: "none" }); u.find(".vis-cardviewchild") } function yf(t) { ei(!0); window.setTimeout(function () { var r = "", u = "", s, f; for (su = [], s = "", i = 0; i < e.length; i++) { for (r = "", u = "", j = 0; j < e[i].Condition.length; j++)j == 0 ? (r += "@" + e[i].Condition[j].ColName + "@" + e[i].Condition[j].Operator + e[i].Condition[j].QueryValue, u += "@" + e[i].Condition[j].ColHeader + "@" + e[i].Condition[j].Operator + e[i].Condition[j].QueryText) : (r += " & @" + e[i].Condition[j].ColName + "@" + e[i].Condition[j].Operator + e[i].Condition[j].QueryValue, u += " & @" + e[i].Condition[j].ColHeader + "@" + e[i].Condition[j].Operator + e[i].Condition[j].QueryText); su.push({ Color: e[i].Color.toString(), ConditionValue: r, ConditionText: u }) } if (h) { if (ot.val() == "") return n.ADialog.error("FillMandatory", !0, "Name"), ei(!1), !1 } else if (!h && o < 1 && n.MRole.isAdministrator) return n.ADialog.error("ClickNew", !0, ""), ei(!1), !1; if (f = v.children().length, f.length <= 0) return !1; pf(nt); t.stopPropagation(); t.preventDefault() }, 50) } function pu(n) { var t, i; if (n == null || n.length == 0) return null; for (t = 0; t < a.getFields().length; t++)if (i = a.getFields()[t], n.equals(i.getColumnName())) return i; return null } function bf(t) { var i = null, r; return (t && (i = ii), i != null) ? i.getDisplayType() == n.DisplayType.YesNo ? i.getValue().toString().toLowerCase() == "true" ? "Y" : "N" : n.DisplayType.IsDate(i.getDisplayType()) ? (r = i.getValue(), r && r.endsWith(".000Z") && (r = r.replace(".000Z", "Z")), r) : n.DisplayType.IsNumeric(i.getDisplayType()) ? 0 : i.getValue() == "" ? null : i.getValue() : "" } function to(t) { var i = null; if (t && (i = ii), i != null) { if (i.getDisplayType() == n.DisplayType.YesNo) return i.getValue().toString().toLowerCase() == "true" ? "Y" : "N"; i.setValue(null) } } function kf(n) { var t = null; return (n && (t = ii), t != null) ? t.getDisplay() : "" } function io(n) { var t = null; return (n && (t = ii), t != null) ? t.getDisplayType("") : "" } function wu(n) { var t = null; n && (t = ii); t != null && t.setValue(null) } function df(n) { var r = vt.children()[1], i = null; vt.children().length > 2 && (i = vt.children()[2]); i ? t(i).prop("disabled", !n).prop("readonly", !n) : r != null && t(r).prop("disabled", !n).prop("readonly", !n) } function ro(n, t) { n.prop("disabled", !t) } function bu(i, r) { var f, o, u, e; i && (ii = null); le = null; f = null; o = null; i && (f = vt.children()[0], vt.children().length > 1 && (o = vt.children()[1])); f != null && (t(f).remove(), o != null && t(o).remove(), f = null); u = null; u = r != null ? r.getIsKey() ? new n.Controls.VNumTextBox(r.getColumnName(), !1, !1, !0, r.getDisplayLength(), r.getFieldLength(), r.getColumnName()) : n.VControlFactory.getControl(null, r, !0, !0, !1) : new n.Controls.VTextBox("columnName", !1, !0, !1, 20, 20, "format", "GetObscureType", !1); u != null && (u.setReadOnly(!1), n.DisplayType.Text == r.getDisplayType() || n.DisplayType.TextLong == r.getDisplayType() ? (u.getControl().attr("rows", "1"), u.getControl().css("width", "100%")) : n.DisplayType.YesNo == r.getDisplayType() ? u.getControl().css("clear", "both") : n.DisplayType.IsDate(r.getDisplayType()) && u.getControl().css("line-height", "1"), e = null, u.getBtnCount() > 0 && !(u instanceof n.Controls.VComboBox) && (e = u.getBtn(0)), i && (vt.append(u.getControl().css("width", "95%")), ii = u, e && (vt.append(e), u.getControl().css("width", "60%"), e.css("max-width", "35px")))) } function uo(n) { var f = {}, o, r; ut = {}; var u = "", s = "", t = null, i = null, h = null, c = null, l = null, a = null, v = null, y = null; for (o = 0; o < n.length; o++) { for (ut = {}, ut.Color = n[o].Color, ut.Condition = [], u = n[o].ConditionValue.split("&"), s = n[o].ConditionText.split("&"), r = 0; r < u.length; r++)f = {}, u[r].contains("!") ? (t = u[r].trim().split("!"), i = s[r].trim().split("!"), v = "!", y = "!=", h = i[0].trim().substring(1, i[0].lastIndexOf("@")), c = t[0].trim().substring(1, t[0].lastIndexOf("@")), a = i[1], l = t[1]) : u[r].contains("=") ? (t = u[r].split("="), i = s[r].split("="), v = "=", y = "=", h = i[0].trim().substring(1, i[0].lastIndexOf("@")), c = t[0].trim().substring(1, t[0].lastIndexOf("@")), a = i[1], l = t[1]) : u[r].contains("<") ? (t = u[r].split("<"), i = s[r].split("<"), v = "<", y = "<", h = i[0].trim().substring(1, i[0].lastIndexOf("@")), c = t[0].trim().substring(1, t[0].lastIndexOf("@")), a = i[1], l = t[1]) : u[r].contains(">") && (t = u[r].split(">"), i = s[r].split(">"), v = ">", y = ">", h = i[0].trim().substring(1, i[0].lastIndexOf("@")), c = t[0].trim().substring(1, t[0].lastIndexOf("@")), a = i[1], l = t[1]), f.ColHeader = h, f.ColName = c, f.Operator = v, f.OperatorText = y, f.QueryValue = l, f.QueryText = a, ut.Condition.push(f); e.push(ut) } cr || si(e) } var hi = r.curGC, a = hi.getMTab(), et = hi.vCardView, ku = a.getAD_Window_ID(), du = a.getAD_Tab_ID(), gf = a.getName(), ne = a.getWindowNo(), te = r.curGC.aPanel.$parentWindow.getName(), o = et.getAD_CardView_ID(), rt = et.getField_Group_ID(), f = 0, di = 0, br = null, kr = null, dr = null, gr = null, oi = null, v = null, ie = [], s = a.getFields(), yt = [], nu = null, gi = null, gu = 0, y = -1, nr = 0, tr = 0, re = 0, ci = [], nt = [], tu = [], ue = 0, li = "", fe = 0, ht = 0, h = !1, ir = {}, ee = null, ct = null, ai = null, rr = null, ur = null, iu = null, nf = null, tf = null, ru = null, uu = null, vi = null, fr = null, u = null, c = null, er = null, fu = null, eu = null, p = null, w = 0, ot = null, li = "", or = 0, oe = 0, se = [], he = 0, fo = n.context.getAD_User_Name(), sr = null, hr = null, dt = null, lt = null, at = null, yi = null, gt = [], ni = null, ti = "", g = !1, ce = n.Msg.getMsg("IsDefault"), d = null, ii = null, le = null, vt = null, tt = null, rf = a.getFields().slice(), ou = this, st = null, e = [], ut = null, pt = null, su = [], pi = null, cr = !1, lr = [], ri = null, it = null, b = null, ui = null, fi = null, wt = null, bt = null, kt = null, uf = null, ar = null, vr = null, l = null, ff = null, hu = null, cu = null, ae = null, lu, yr = !0, k = [], au = [], wi = "ASC", pr, wr, ft, ye = function () { for (var n = 0; n < a.getFields().length; n++)yt.push(a.getFields()[n]); for (n = 0; n < et.fields.length; n++)se.push(et.fields[n].getAD_Field_ID()) }, pe = function () { var nt, o, ii, et, ht, f, ei, s, e, i, w, si, ct; ae = '<select><option value=""><\/option><option value="1"><\/option><option value="-1"><\/option><\/select>'; nt = t('<div class="input-group vis-input-wrap vis-card-input-wrap">'); ri = t("<div class='vis-apanel-busy vis-cardviewmainbusy'><\/div> "); u = t("<div class='vis-cardviewmain'><\/div>"); var rt = t("<div class='vis-cardviewmainfirstchild vis-pull-left'><\/div>"), y = t("<div class='vis-cardviewtopfieldswrap'><\/div>"), ci = t("<div class='vis-cardviewmainsecondchild'><\/div>"), a = t("<div class='vis-cardviewCondition'><\/div>").append("<div class='vis-cardviewConditionControls'> <\/div>  <div class='vis-cardviewConditionGrid'> <\/div> "), gt = t("<div class='vis-cardviewbtn'>"), ut = t("<div class='d-flex vis-cardviewsortContainer'>"), li = t("<div class='input-group vis-input-wrap'><\/div>").append(t("<div class='vis-control-wrap'><\/div>")), r = t("<div class='vis-cardviewbtn' style='margin-top:0;'> <\/div>"); u.append(rt); rt.append(y); y.append("<div class='vis-firstdiv vis-pull-left' ><\/div>"); y.append("<div class='vis-cv-blankdiv' ><\/div>"); y.append("<div class='vis-seconddiv vis-pull-right'><\/div>"); rt.append("<div class='vis-thirddiv vis-pull-left' ><\/div>"); u.find(".vis-firstdiv").append("<div class='vis-first-divHeader'><label class='vis-ddlcardview'>" + n.Msg.getMsg("SelectCardView") + " <\/label><label style='display:none' class='vis-lbcardviewname'>" + n.Msg.getMsg("CardViewName") + " <\/label><\/div>  "); var ft = t("<div class='vis-CardView vis-pull-left'> <div  class='vis-cardviewchild vis-pull-left'><\/div>  <\/div>"), ni = t("<input style='display:none' class='vis-txtcardviewname' type='text'>"), hi = t("<div class='vis-User vis-pull-left'><\/div>"), ti = t("<div class='vis-pull-left'><button  class='vis-btnnew vis-cvd-btn'><i title=" + n.Msg.getMsg("AddNew") + " class='vis vis-plus'><\/i><\/button><button style='display:none' title=" + n.Msg.getMsg("VIS_DialogCancel") + " class='vis-btncancle vis-cvd-canclebtn'><i class='vis vis-mark'><\/i><\/button> <button class='vis-btnedit vis-cvd-editbtn' title=" + n.Msg.getMsg("EditRecord") + "  ><i class='vis vis-pencil'><\/i><\/button><\/div>"); ft.find(".vis-cardviewchild").append("<select class='vis-cmbcardview'> <\/select>"); hi.append("<Select type='text' class='vis-cmbuser'> <\/Select>"); o = n.dataContext.getJSONData(n.Application.contextUrl + "CardView/GetColumnIDWindowID", { tableName: "AD_CardView", columnName: "AD_HeaderLayout_ID" }); o && (o = o.split(","), ii = n.MLookupFactory.get(n.Env.getCtx(), ne, o[0], n.DisplayType.Search, "AD_HeaderLayout_ID", 0, !1, "IsHeaderView='N'"), it = new n.Controls.VTextBoxButton("AD_HeaderLayout_ID", !0, !1, !0, n.DisplayType.Search, ii, Number(o[1])), et = t('<div class="vis-control-wrap">'), ht = t('<div class="input-group-append">'), et.append(it.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append('<label for="Name">' + n.Msg.getMsg("cardLayout") + "<\/label>"), nt.append(et).append(ht), ht.append(it.getBtn(0)).append(it.getBtn(1))); r.append("<button class='vis-btnDelete'><i title=" + n.Msg.getMsg("DeleteRecord") + " class='vis vis-delete'><\/i><\/button>"); r.append(nt); kt = t('<label class="vis-ec-col-lblchkbox" style="opacity: 1;display:none">' + ce + "<\/label>"); wt = t('<input type="checkbox" name="IsDefault" value="Default">'); kt.prepend(wt); lblIsPublic = t('<label class="vis-ec-col-lblchkbox" style="opacity: 1;">' + n.Msg.getMsg("Shared") + "<\/label>"); bt = t('<input type="checkbox" checked="true" name="IsPublic" value="Public">'); lblIsPublic.prepend(bt); n.MRole.isAdministrator ? r.append(kt).append(lblIsPublic) : r.append(kt); r.append("<div class='vis-cdv-customokcancle'><button class='vis-btnCardApply'>  " + n.Msg.getMsg("SaveAndApply") + "  <\/button><button class='vis-btnOk'>  " + n.Msg.getMsg("SaveIt") + "  <\/button><button class='vis-btnCardViewCancle'>  " + n.Msg.getMsg("close") + "  <\/button><\/div>"); f = t('<div class="vis-sortOrderContainer"><div class="vis-sortOrderData"><div class="input-group vis-input-wrap"><div class="vis-control-wrap"><select name="Rating" class="vis-cardOrderClause" placeholder=" " data-placeholder=""><\/select><label for="Rating">' + n.Msg.getMsg("SortOrderField") + '<\/label><\/div><\/div><div class="vis-sortButtons"><span class="vis-sortBtn vis-sortCardAsc" title="' + n.Msg.getMsg("Ascending") + '" ><i class="fa fa-sort-amount-asc"><\/i><\/span><span class="vis-sortBtn vis-sortCardDesc" title="' + n.Msg.getMsg("Descending") + '" ><i class="fa fa-sort-amount-asc"><\/i><\/span><\/div><button class="btn VIS_Pref_btn-2">' + n.Msg.getMsg("Add") + '<\/button><\/div><div class="vis-sortingList"><\/div>'); ui = f.find(".vis-sortCardAsc"); fi = f.find(".vis-sortCardDesc"); ei = f.find(".VIS_Pref_btn-2"); pr = f.find(".vis-sortingList"); ui.on("click", function () { b.val() != -1 && b.val() != null && (ui.css("color", "rgba(var(--v-c-primary), 1)"), fi.css("color", "rgba(var(--v-c-on-secondary), 1)"), wi = "ASC") }); fi.on("click", function () { b.val() != -1 && b.val() != null && (ui.css("color", "rgba(var(--v-c-on-secondary), 1)"), fi.css("color", "rgba(var(--v-c-primary), 1)"), wi = "DESC") }); for (b = f.find(".vis-cardOrderClause"), b.append('<option value="-1"> <\/option>)'), yt.sort(function (t, i) { var u = t.getHeader().toUpperCase(), r; return ((u == null || u.length == 0) && (u = n.Msg.getElement(n.context, t.getColumnName())), r = i.getHeader().toUpperCase(), (r == null || r.length == 0) && (r = n.Msg.getElement(n.context, i.getColumnName())), u > r) ? 1 : u < r ? -1 : 0 }), s = 0; s < yt.length; s++)(e = yt[s].getHeader(), e != null && e.length != 0 || (e = n.Msg.getElement(n.context, yt[s].getColumnName()), e != null && e.Length != 0)) && b.append('<option value="' + yt[s].getColumnName() + '">' + e + "<\/option>"); ut.append(f); ei.on("click", function () { var t = b.val(), i; if (t != -1) if (ui.css("color", "rgba(var(--v-c-on-secondary), 1)"), fi.css("color", "rgba(var(--v-c-on-secondary), 1)"), k && k.length < 3) { if (i = b.find(":selected").text(), k.indexOf(t + " ASC") > -1 || k.indexOf(t + " DESC") > -1) { n.ADialog.warn("CardSortColAdded"); return } of(i, t, wi); k.push(t + " " + wi); b.val(-1) } else n.ADialog.warn("MaxSortColumn") }); pr.on("click", function (n) { if (g || h) { var i = t(n.target); if (i.hasClass("fa-close") && (i = i.parent()), i.hasClass("vis-sortListItemClose")) { const n = k.indexOf(i.data("text")); k.splice(n, 1); i.closest(".vis-sortListItem").remove() } } }); b.on("change", function () { (b.val() == -1 || b.val() == null) && (ui.css("color", "rgba(var(--v-c-on-secondary), 1)"), fi.css("color", "rgba(var(--v-c-on-secondary), 1)")); wi = "ASC" }); n.MRole.isAdministrator ? (u.find(".vis-firstdiv").append(" <div style='display:none' class='vis-first-divHeader vis-pull-right'><label >" + n.Msg.getMsg("SelectUser") + "<\/label><\/div>"), u.find(".vis-CardView").append(""), u.find(".vis-firstdiv").append(ft), u.find(".vis-cardviewchild").append(ni), u.find(".vis-cardviewchild"), u.find(".vis-CardView").append(ti), er = u.find(".vis-cmbuser"), sf(a.find(".vis-cardviewConditionControls")), u.append(a), u.append(gt), u.append(ut).append(r), u.find(".vis-btnDelete").css("display", "block")) : (a, u.find(".vis-firstdiv").append(ft), u.find(".vis-cardviewchild").append(ni), u.find(".vis-cardviewchild"), u.find(".vis-CardView").append(ti), u.find(".k ").css("display", "none"), sf(a.find(".vis-cardviewConditionControls")), u.append(a), u.append(ut).append(gt), u.append(r), u.find(".vis-btnDelete").css("display", "none")); ge(u.find(".vis-cardviewConditionGrid")); yi = u.find(".vis-ulrole"); hr = u.find(".vis-ddlcardview"); c = u.find(".vis-cmbcardview"); sr = u.find(".vis-lbcardviewname"); ot = u.find(".vis-txtcardviewname"); dt = u.find(".vis-btnnew"); lt = u.find(".vis-btncancle"); at = u.find(".vis-btnedit"); i = t("<div class='vis-divtextcontrol' ><\/div>"); i.append("<div style='display:none' class='vis-second-divHeader vis-pull-left' ><div> <label>" + n.Msg.getMsg("Window") + "<\/label><\/div><div><input type='text'  class='vis-txtwindowname'><\/div><\/div>"); i.append("<div style='display:none' class='vis-second-divHeader vis-pull-left' ><div><label>" + n.Msg.getMsg("Tab") + "<\/label><\/div><div><input type='text'  class='vis-txttabname'><\/div><\/div>"); i.append("<div class='vis-second-divHeader vis-pull-left' ><div><label>" + n.Msg.getMsg("GroupByField") + "<\/label><\/div><div class='vis-CardView'><select class='vis-cmbgroupfield'> <\/select><\/div><\/div>"); u.find(".vis-seconddiv").append(i); fu = i.find(".vis-txtwindowname"); eu = i.find(".vis-txttabname"); p = i.find(".vis-cmbgroupfield"); ai = t("<div class='vis-third-header vis-pull-left' style='width:68%'><\/div>"); vr = t("<div class='vis-third-header vis-pull-left' style='width:28%;margin: 0 15px 0 15px;'><\/div>"); rr = t("<div class='vis-left-fields vis-pull-left'><\/div>"); ur = t("<div class='vis-left-fields vis-pull-left' ><\/div>"); w = t("<div class='vis-left-fields vis-pull-left' ><\/div>"); iu = t("<div class='vis-cardviewbutton vis-pull-left' ><button class='vis-btnup'><i class='vis vis-arrow-up'><\/i><\/button><button  class='vis-btnright'><i class='vis vis-shiftright'><\/i><\/button><\/div>"); iu.append("<button   class='vis-btnleft'><i class='vis vis-shiftleft'><\/i><\/button><button  class='vis-btndown'><i class='vis vis-arrow-down'><\/i><\/button>"); nf = t("<div style='width:100%'><label>" + n.Msg.getMsg("SelectField") + "<\/label><\/div>"); tf = t("<div style='width:100%'><label>" + n.Msg.getMsg("IncludedField") + "<\/label><\/div>"); si = t("<div style='width:100%'><label>" + n.Msg.getMsg("GroupSeq") + "<\/label><\/div>"); ru = t("<div class='vis-cv-filedslist-wrap'><\/div>"); ct = t("<div class='vis-cv-filedslist-wrap'><\/div>"); uu = t("<div class='vis-cv-filedslist-wrap'><\/div>"); vi = t("<ul  class='vis-windowfield'><\/ul>"); fr = t("<ul  class='vis-cardviewcolumnfield'><\/ul>"); l = t("<ul  class='vis-cardviewcolumnfield1'><\/ul>"); ru.append(vi); uu.append(fr); rr.append(nf); rr.append(ru); ur.append(tf); ur.append(uu); ai.append(rr); ai.append(iu); ai.append(ur); ct.append(l); vr.append(w); w.append(si); w.append(ct); ff = t('<div class="vis-cardviewbutton vis-pull-left" style="margin-top:25%;"><button class="vis-Grpbtnup"><i class="vis vis-arrow-up"><\/i><\/button><button class="vis-btnGrpdown"><i class="vis vis-arrow-down"><\/i><\/button><\/div>'); vr.append(ff); u.find(".vis-thirddiv").append(ai).append(vr); wr.append(u); u.before(ri); oi = u.find(".vis-windowfield"); v = u.find(".vis-cardviewcolumnfield"); br = u.find(".vis-btnright"); kr = u.find(".vis-btnleft"); dr = u.find(".vis-btnup"); gr = u.find(".vis-btndown"); btnOk = u.find(".vis-btnOk"); lu = u.find(".vis-btnCardApply"); cu = u.find(".vis-btnGrpdown"); hu = u.find(".vis-Grpbtnup"); btnCardViewCancle = u.find(".vis-btnCardViewCancle"); btnDelete = u.find(".vis-btnDelete"); d = u.find(".vis-cmbcolumn"); vt = u.find(".vis-cvd-valcontainer"); tt = u.find(".vis-cmboperator"); btnSave = u.find(".vis-btnsave"); st = u.find(".vis-cv-rowtable"); pt = u.find(".vis-cmbcolor"); ar = u.find(".vis-gradient"); ri.css({ display: "none" }); ef(); we() }, sf = function (i) { uf = t('<div style="width:100%"> <input class="vis-firstcolor vis-pull-left" type="color" style="width: 20%;"><input class="vis-firstPer vis-pull-left" min="0" max="100" value="0" type="number" style="width: 20%;"><input class="vis-Lastcolor vis-pull-left" type="color" style="width: 20%;"><input class="vis-LastPer vis-pull-left" type="number" min="0" max="100" value="100" style="width: 20%;"><select class="vis-GrdType" style = "width: 20%;"><option value="to bottom"><\/option><option value="to top"><\/option><option value="to right"><\/option><option value="to left"><\/option><option value="to top left"><\/option><option value="to top right"><\/option><option value="to bottom left"><\/option><option value="to bottom right"><\/option><\/select><\/div>'); var r = t('<div class="vis-cv-condctrl-inner">'), u = t("<div class='vis-divcvc-cmbcolor'><div style='width:100%'><lable><input type='checkbox' class='vis-gradient' />" + n.Msg.getMsg("BGColor") + " <\/lable><\/div> <div class='vis-backgroundType' style='width:100%'> <input class='vis-cmbcolor' type='color' /><\/div><\/div>"), f = t("<div class='vis-divcvc-cmbcolumn'><div style='width:100%'><lable>" + n.Msg.getMsg("Column") + "<\/lable><\/div> <div><select class='vis-cmbcolumn'><\/select><\/div><\/div>"), e = t("<div class='vis-divcvc-cmboperator'><div style='width:100%'><lable>" + n.Msg.getMsg("Operator") + "<\/lable><\/div>  <div><select class='vis-cmboperator'><\/select> <\/div><\/div>"), o = t("<div class='vis-divcvc-queryvalue'><div style='width:100%'><lable>" + n.Msg.getMsg("QueryValue") + "<\/lable><\/div> <div class='vis-cvd-valcontainer' style='width:100%'><\/div><\/div>"), s = t("<div class='vis-divcvc-btnsave'><button class='vis-btnsave'><i class='vis vis-plus'><\/i><\/button><\/div>"); r.append(u); r.append(f); r.append(e); r.append(o); i.append(r); i.append(s) }, hf = function (i) { c.children().remove(); i && (o = 0, rt = 0); var r = n.Application.contextUrl + "CardView/GetCardView"; if (t.ajax({ type: "GET", async: !1, url: r, dataType: "json", contentType: "application/json; charset=utf-8", data: { ad_Window_ID: ku, ad_Tab_ID: du }, success: function (t) { var r, e; if (ct = JSON.parse(t), f = ct[0].lstCardViewData, di = ct[0].lstRoleData, ni = ct[0].lstCardViewRoleData, pi = ct[0].lstCardViewConditonData, f != null && f.length > 0) for (r = 0; r < f.length; r++)i && r == 0 && (o = f[0].CardViewID, rt = f[0].AD_GroupField_ID), c.append("<Option idx=" + r + " is_shared=" + f[r].UserID + " ad_user_id=" + f[r].CreatedBy + " cardviewid=" + f[r].CardViewID + " groupSequence='" + f[r].groupSequence + "' excludedGroup='" + f[r].excludedGroup + "'  ad_field_id=" + f[r].AD_GroupField_ID + " isdefault=" + f[r].DefaultID + " ad_headerLayout_id=" + f[r].AD_HeaderLayout_ID + "> " + w2utils.encodeTags(f[r].CardViewName) + "<\/Option>"); else dt.trigger("click"), lt.prop("disabled", !0), at.trigger("click"), btnDelete.prop("disabled", !0); c.find("[cardviewid='" + o + "']").attr("selected", "selected"); or = o; e = c.find(":selected").attr("idx"); f != null && f.length > 0 && (bt.attr("checked", f[e].UserID > 0 ? !1 : !0), wt.attr("checked", f[e].DefaultID ? !0 : !1)); f && (f[e].OrderByClause && f[e].OrderByClause.length > 0 ? vu(f[e].OrderByClause) : bi()); f != null && f.length > 0 && (it.setValue(f[e].AD_HeaderLayout_ID), w = f[e].CreatedBy); w == n.context.getAD_User_ID() ? (u.find(".vis-btnDelete").css("display", "block"), u.find(".vis-cvd-editbtn i").removeClass("vis-copy").addClass("vis-pencil"), u.find(".vis-cvd-editbtn").attr("title", n.Msg.getMsg("EditRecord"))) : (u.find(".vis-btnDelete").css("display", "none"), u.find(".vis-cvd-editbtn i").removeClass("vis-pencil").addClass("vis-copy"), u.find(".vis-cvd-editbtn").attr("title", n.Msg.getMsg("CopyCard"))); try { i ? (f != null && f.length > 0 && (or = f[e].CardViewID, rt = f[e].AD_GroupField_ID), o = or, hi.isCardRow && et.getCardViewData(a, o)) : (ht = w, oe = w) } catch (s) { } n.MRole.isAdministrator }, error: function (n) { alert(n.statusText) } }), c != null) c.on("change", function () { cr = !1; cf() }) }, cf = function () { var i = c.find(":selected"), t; i.length > 0 && (b.val(-1), k = [], au = [], lr = [], t = i.attr("idx"), f && (o = f[t].CardViewID, w = f[t].CreatedBy, it.setValue(f[t].AD_HeaderLayout_ID), wt.prop("checked", f[t].DefaultID ? !0 : !1), bt.prop("checked", f[t].UserID > 0 ? !1 : !0)), f && f[t].OrderByClause && f[t].OrderByClause.length ? vu(f[t].OrderByClause) : bi(), w == n.context.getAD_User_ID() ? (u.find(".vis-btnDelete").css("display", "block"), u.find(".vis-cvd-editbtn i").removeClass("vis-copy").addClass("vis-pencil"), u.find(".vis-cvd-editbtn").attr("title", n.Msg.getMsg("EditRecord"))) : (u.find(".vis-btnDelete").css("display", "none"), u.find(".vis-cvd-editbtn i").removeClass("vis-pencil").addClass("vis-copy"), u.find(".vis-cvd-editbtn").attr("title", n.Msg.getMsg("CopyCard")))); wf(); lf(); o > 0 ? ki(!0, !1) : ki(!1, !1); yu(); h && g || (l.find("input").prop("disabled", !0), v.find("select").prop("disabled", !0)) }, lf = function () { fu.val(te); eu.val(gf); fu.prop("disabled", "disabled"); eu.prop("disabled", "disabled") }, yu = function () { var u, f, i, r, e; if (p != null && p.children().remove(), u = null, f = null, ir = {}, a != null && a.getFields().length > 0) for (p.append("<Option FieldID=-1><\/Option>"), s = a.getFields(), i = 0; i < s.length; i++)(r = s[i].getColumnName().toLower(), r != "created" && r != "createdby" && r != "updated" && r != "updatedby") && (n.DisplayType.IsLookup(s[i].getDisplayType()) && s[i].getLookup() && s[i].getLookup().getIsValidated() && s[i].getIsDisplayed() || s[i].getDisplayType() == n.DisplayType.YesNo) && (p.append("<Option FieldID=" + s[i].getAD_Field_ID() + "> " + s[i].getHeader() + "<\/Option>"), (s[i].getDisplayType() == n.DisplayType.List || s[i].getDisplayType() == n.DisplayType.TableDir || s[i].getDisplayType() == n.DisplayType.Table || s[i].getDisplayType() == n.DisplayType.Search) && s[i].lookup && s[i].lookup.getData() && (ir[s[i].getAD_Field_ID()] = s[i].lookup.getData())); if (rt != null && rt > 0 && (e = jQuery.grep(s, function (n) { return n.getAD_Field_ID() == rt }), p.find("[FieldID='" + rt + "']").attr("selected", "selected"), he = p.find(":selected").attr("fieldid")), af(rt), p != null) p.on("change", function () { rt = parseInt(t(this).find(":selected").attr("fieldid")); af(rt) }) }, ki = function (t, i) { var r, u, f; if (vi != null && vi.children().remove(), ee = null, ct = null, s = a.getFields(), s.sort(function (n, t) { var i = n.getHeader().toLower(), r = t.getHeader().toLower(); return i == r ? 0 : i > r ? 1 : -1 }), be(fr, t), a != null && a.getFields().length > 0) for (r = 0; r < s.length; r++)(u = s[r].getColumnName().toLower(), u != "created" && u != "createdby" && u != "updated" && u != "updatedby") && (n.DisplayType.IsLOB(s[r].getDisplayType()) || s[r].getIsDisplayed() && (et.hasIncludedCols && !i && (f = jQuery.grep(ci, function (n) { return n == s[r].getAD_Field_ID() }), f.length > 0) || vi.append("<li index=" + r + " FieldID=" + s[r].getAD_Field_ID() + "> <span>" + s[r].getHeader() + "<\/span><\/li>"))) }, af = function (t) { var i, r, e, s, a; if (l.html(""), l.parent().removeAttr("style"), ir[t]) { for (i = 0, r = ir[t]; i < r.length; i++)r[i].Key.toString().length > 0 && r[i].Name.toString().length > 0 && l.append('<li key="' + r[i].Key + '"><input type="checkbox"/>' + r[i].Name + "<\/li>"); l.find("input").prop("checked", !0); var h = c.find(":selected").attr("idx"), u = f[h].groupSequence, o = f[h].excludedGroup; if (u) for (u = u.split(","), o = o.split(","), e = 0; e < u.length; e++)s = l.find("[key='" + u[e] + "']"), o.lastIndexOf(u[e]) != -1 && s.find("input").prop("checked", !1), a = l.find("li").eq(e), s.insertBefore(a) } else l.parent().css("background-color", "rgba(var(--v-c-on-secondary), 0.04)"), l.append('<li style="padding-top:40%;text-align:center" key="">' + n.Msg.getMsg("OnlyForLOV") + "<\/li>") }, we = function () { if (dt != null) dt.on("click", function (t) { t.stopPropagation(); g = !1; sr.css({ display: "block" }); ot.css({ display: "block" }); hr.css({ display: "none" }); c.css({ display: "none" }); dt.css({ display: "none" }); lt.css({ display: "block" }); at.css({ display: "none" }); kt.css({ display: "block" }).attr("checked", !1); it.setValue(null); u.find(".vis-cardviewchild"); bt.prop("checked", !1); h = !0; gt = []; p.find(":selected").removeAttr("selected"); p.find("[FieldID='-1']").attr("selected", "selected"); ki(!1, !0); fr.children().remove(); lr = e; e = []; si(e); btnDelete.hide(); au = k; k = []; bi(); l.html(""); l.parent().removeAttr("style"); l.parent().css("background-color", "rgba(--v-c-on-secondary), 0.04)"); l.append('<li style="padding-top:40%;text-align:center" key="">' + n.Msg.getMsg("OnlyForLOV") + "<\/li>"); u.find("*").removeAttr("disabled") }); if (lt != null) lt.on("click", function (t) { t.stopPropagation(); g = !1; b.val(-1); bi(); ui.css("color", "rgba(var(--v-c-on-secondary), 1)"); fi.css("color", "rgba(var(--v-c-on-secondary), 1)"); vf(); ki(!0, !1); yu(); h || si(lr); h = !1; var i = c.find(":selected").attr("idx"); bt.prop("checked", f[i].UserID > 0 ? !1 : !0); wt.prop("checked", f[i].DefaultID ? !0 : !1); it.setValue(f[i].AD_HeaderLayout_ID); u.find("*").attr("disabled", "disabled"); u.find(".vis-firstdiv *").removeAttr("disabled"); u.find(".vis-cardviewbtn .vis-cdv-customokcancle *").removeAttr("disabled"); u.find(".vis-btnDelete").removeAttr("disabled"); f[i].CreatedBy == n.context.getAD_User_ID() ? u.find(".vis-btnDelete").css("display", "block") : u.find(".vis-btnDelete").css("display", "none") }); if (at != null) at.on("click", function (n) { n.stopPropagation(); g = !0; sr.css({ display: "block" }); ot.css({ display: "block" }); hr.css({ display: "none" }); c.css({ display: "none" }); dt.css({ display: "none" }); lt.css({ display: "block" }); at.css({ display: "none" }); u.find(".vis-cardviewchild"); lr = e; ot.val(c.find(":selected").text().trim()); f != null && f.length > 0 ? kt.css({ display: "none" }).attr("checked", !1) : kt.css({ display: "block" }).attr("checked", !1); st.find(".vis-delete").css({ cursor: "pointer" }); u.find("*").removeAttr("disabled") }); if (er != null) er.on("change", function () { }); if (oi != null) oi.on("click", "li", function () { (h || g) && (nu != null && nu.removeClass("vis-cv-liselected"), t(this).addClass("vis-cv-liselected"), nu = t(this), gu = t(this).index(), nr = t(this).attr("FieldID"), li = t(this).find("span").text()) }); if (v != null) v.on("click", "li", function () { (h || g) && (gi != null && gi.removeClass("vis-cv-liselected"), t(this).addClass("vis-cv-liselected"), gi = t(this), y = t(this).index(), tr = t(this).attr("FieldID"), re = t(this).attr("cardviewcolumnid"), li = t(this).find("span").text(), ue = t(this).attr("seqno")) }); if (l != null) l.on("click", "li", function () { (h || g) && (l.find(".vis-cv-liselected").removeClass("vis-cv-liselected"), t(this).addClass("vis-cv-liselected")) }); if (br != null) br.on("click", function (n) { parseInt(nr) <= 0 || (v.append("<li seqno=0 index=" + fe + "  FieldID=" + nr + "><span> " + li + "<\/span><\/li>"), nr = 0, oi.children().eq(gu).remove(), n.stopPropagation(), n.preventDefault()) }); if (kr != null) kr.on("click", function (n) { if (!(parseInt(tr) <= 0)) { v.children().eq(y).remove(); var t = oi.children().length + 1; oi.append("<li seqno=0 index=" + t + "  FieldID=" + tr + "> <span>" + li + "<span><\/li>"); tr = 0; y = -1; n.stopPropagation(); n.preventDefault() } }); if (dr != null) dr.on("click", function (n) { if (parseInt(y) != 0 && parseInt(y) != -1) { var t = parseInt(y) - 1, i = v.children().eq(y), r = v.children().eq(t); v.children().eq(y).remove(); v.children().eq(t).before(i); y = t; n.stopPropagation(); n.preventDefault() } }); if (gr != null) gr.on("click", function (n) { var i = v.children().length - 1; if (i != y && parseInt(y) != -1) { var t = parseInt(y) + 1, r = v.children().eq(y), u = v.children().eq(t); v.children().eq(y).remove(); u.after(r); y = t; n.stopPropagation(); n.preventDefault() } }); if (hu != null) hu.on("click", function (n) { var t = l.find(".vis-cv-liselected"), i = t.prev(); t.insertBefore(i); n.stopPropagation(); n.preventDefault() }); if (cu != null) cu.on("click", function (n) { var t = l.find(".vis-cv-liselected"), i = t.next(); t.insertAfter(i); n.stopPropagation(); n.preventDefault() }); if (yi != null) yi.on("click", "li", function () { var i = t(this).attr("ad_role_id"), n; if (t(this).find("input").is(":checked")) t(this).find("input").prop("checked", !0), gt.push({ AD_Role_ID: parseInt(i) }); else for (t(this).find("input").prop("checked", !1), n = 0; n < gt.length; n++)gt[n].AD_Role_ID == i && gt.splice(n, 1) }); if (btnOk != null) btnOk.on("click", function (n) { (h || g) && (yr = !1, yf(n)) }); if (lu != null) lu.on("click", function (n) { yr = !0; yf(n) }); if (btnCardViewCancle != null) btnCardViewCancle.on("click", function () { ft.close() }); if (btnDelete != null) btnDelete.on("click", function (t) { n.ADialog.confirm("SureWantToDelete", !0, "", n.Msg.getMsg("Confirm"), function (t) { t && (cr = !1, de(), hf(!0), f != null && f.length > 0 && (lf(), yu(), ki(!0, !1), vf(), w == n.context.getAD_User_ID() ? (ht = 0, w = 0, at.find("i").removeClass("vis-copy").addClass("vis-pencil")) : at.find("i").removeClass("vis-pencil").addClass("vis-copy"), ef())) }); t.stopPropagation(); t.preventDefault() }); if (d != null) d.on("change", function (t) { var i, r, f, e, u; t.stopPropagation(); i = d.val(); wu(!0); i && i != "-1" && (r = null, f = null, r = i.endsWith("_ID") || i.endsWith("_Acct") || i.endsWith("_ID_1") || i.endsWith("_ID_2") || i.endsWith("_ID_3") ? ou.getOperatorsQuery(n.Query.prototype.CVOPERATORS_ID) : i.startsWith("Is") ? ou.getOperatorsQuery(n.Query.prototype.OPERATORS_YN) : ou.getOperatorsQuery(n.Query.prototype.CVOPERATORS), e = a.getField(i), tt.html(r), tt[0].SelectedIndex = 0, u = pu(i), bu(!0, u), tt.prop("disabled", !1)); df(!0) }); if (tt != null) tt.on("change", function () { var t = tt.val(), i, r; t || (t = ""); i = ""; r = ""; t && t != "0" ? n.Query.prototype.BETWEEN.equals(t) && (i = d.val(), r = pu(i), bu(!1, r)) : (ro(btnSave, !1), wu(!0)) }); if (btnSave != null) btnSave.on("click", function () { var n, f, i, r, o; if (d.find(":selected").val() != -1) { if (n = {}, ut = {}, f = "", t(ar).is(":checked")) { i = u.find(".vis-firstcolor"); r = u.find(".vis-Lastcolor"); Modernizr.inputtypes.color ? (i = i.val(), r = r.val()) : (i = i.spectrum("get"), r = r.spectrum("get")); var s = u.find(".vis-firstPer").val() || 0, h = u.find(".vis-LastPer").val() || 0, c = u.find(".vis-GrdType option:selected").val(); f = "linear-gradient(" + c + ", " + i + " " + s + "%, " + r + " " + h + "%)" } else f = Modernizr.inputtypes.color ? pt.val() : pt.spectrum("get"); o = t.map(e, function (n, t) { if (n.Color == f) return t }); o.length <= 0 ? (ut.Color = f.toString(), ut.Condition = [], n.ColHeader = d.find(":selected").text(), n.ColName = d.find(":selected").val(), n.Operator = tt.val(), n.OperatorText = tt.find(":selected").text(), n.QueryValue = bf(!0), n.QueryText = kf(!0), ut.Condition.push(n), e.push(ut)) : (n.ColHeader = d.find(":selected").text(), n.ColName = d.find(":selected").val(), n.Operator = tt.val(), n.OperatorText = tt.find(":selected").text(), n.QueryValue = bf(!0), n.QueryText = kf(!0), e[o[0]].Condition.push(n)); si(e); d.find("[value='-1']").attr("selected", "selected"); tt[0].SelectedIndex = -1; to(!0); io(!0) } }); if (st != null) st.on("click", "tr td i", function () { var n; if (g || h) { var r = t(this).parent().parent().index(), u = t(this).parent().parent().children().eq(0).attr("value"), f = t(this).parent().parent().children().eq(1).attr("value"); for (st.find("tr").eq(r).remove(), n = t.map(e, function (n, t) { if (n.Color == u) return t }), i = 0; i < e[n].Condition.length; i++)if (f == e[n].Condition[i].ColName && e[n].Condition.splice(i, 1), e[n].Condition.length <= 0) { e.splice(n, 1); break } } }); if (st != null) st.on("click", "tr td", function () { var n = t(this).attr("value"); typeof n != "undefined" && n.startsWith("#") && (Modernizr.inputtypes.color ? pt.val(n) : pt.spectrum("set", n)) }); if (ar != null) ar.on("click", function () { t(this).is(":checked") ? (u.find(".vis-backgroundType").html("").append(uf), u.find(".vis-divcvc-cmboperator").css({ width: "10%" }), u.find(".vis-divcvc-cmbcolor").css({ width: "40%" })) : (u.find(".vis-divcvc-cmboperator").css({ width: "25%" }), u.find(".vis-divcvc-cmbcolor").css({ width: "25%" }), pt = t("<input class='vis-cmbcolor' type='color' />"), u.find(".vis-backgroundType").html("").append(pt)) }) }, eo = function (n, t) { n != null && n.children().remove(); for (var i = 0; i < nt.length; i++)n.append("<li seqno=" + nt[i].SeqNo + " index=" + i + " FieldID=" + nt[i].AD_Field_ID + "> " + nt[i].FieldName + "<\/li>"); t > 0 && (gi = n.find("[fieldid='" + t + "']"), n.find("[fieldid='" + t + "']").addClass("vis-cv-liselected")) }, oo = function (n, t) { var i, r; for (n != null && n.children().remove(), i = 0; i < t.length; i++)(r = jQuery.grep(nt, function (n) { return n.AD_Field_ID == t[i].getAD_Field_ID() }), r.length > 0) || n.append("<li index=" + i + " FieldID=" + t[i].getAD_Field_ID() + "> " + t[i].getHeader() + "<\/li>") }, be = function (i, r) { var h, s, u, f; if (i != null && i.children().remove(), nt = [], ie = [], ci = [], r && (o > 0 || typeof o == "undefined")) typeof o == "undefined" && (o = 0), h = n.Application.contextUrl + "CardView/GetCardViewColumns", t.ajax({ type: "GET", async: !1, url: h, dataType: "json", contentType: "application/json; charset=utf-8", data: { ad_CardView_ID: o }, success: function (n) { var t, r, u; if (ct = JSON.parse(n), t = ct[0].lstCardViewData, pi = ct[0].lstCardViewConditonData, t != null && t.length > 0) for (rt = t[0].AD_GroupField_ID, w = t[0].CreatedBy, r = 0; r < t.length; r++)t[r].AD_Field_ID != 0 && (u = jQuery.grep(yt, function (n) { return n.getAD_Field_ID() == t[r].AD_Field_ID }), u.length > 0 && ci.push(u[0].getAD_Field_ID()), i.append("<li seqno=0 index=" + r + " CardViewColumnID=0 FieldID=" + t[r].AD_Field_ID + "> <span>" + t[r].FieldName + "<\/span><\/li>"), i.find("li:eq(" + r + ") select").val(t[r].sort)); pi != null && pi.length > 0 ? (e = [], uo(pi)) : (e = [], si(e)); vu(t[0].OrderByClause) }, error: function (n) { alert(n.statusText) } }); else if (et.hasIncludedCols && (s = null, ci = [], u = et.fields, u != null && u.length > 0)) for (f = 0; f < u.length; f++)s = jQuery.grep(yt, function (n) { return n.getAD_Field_ID() == u[f].getAD_Field_ID() }), s.length > 0 && ci.push(s[0].getAD_Field_ID()), nt.push({ AD_Field_ID: u[f].getAD_Field_ID(), CardViewID: o, SeqNo: 0, FieldName: u[f].getHeader() }), i.append("<li seqno=0 index=" + f + " CardViewColumnID=0 FieldID=" + u[f].getAD_Field_ID() + "> " + u[f].getHeader() + "<\/li>") }, pf = function () { var i = c.find(":selected").attr("idx"), t; if (f != null && (w = parseInt(f[i].CreatedBy)), n.context.getAD_User_ID() != w || h ? n.context.getAD_User_ID() != w && !h && g ? (h = !0, ht = n.context.getAD_User_ID(), n.MRole.isAdministrator || bt.prop("checked", !1)) : ht = n.context.getAD_User_ID() : ht = n.context.getAD_User_ID(), h && f != null) for (t = 0; t < f.length; t++)if (f[t].CardViewName.trim() == ot.val().trim()) return n.ADialog.error("cardAlreadyExist", !0, ""), ei(!1), !1; ti = ot.val().trim(); g || h ? ke() : (ei(!1), yr ? (ft.close(), hi.isCardRow && et.getCardViewData(a, o)) : lt.trigger("click")) }, ke = function () { var g = v.children().length, w, s, e, i, r, u, y, b, d; for (nt = [], w = [], s = 0; s < g; s++)e = {}, e.AD_Field_ID = v.children().eq(s).attr("fieldid"), e.CardViewID = o, e.sort = v.children().eq(s).find("option:selected").val(), nt.push(e), w.push(parseInt(e.AD_Field_ID)); return i = "", r = "", t.each(l.find("li"), function () { i += t(this).attr("key") + ","; t(this).find("input").is(":checked") || (r += t(this).attr("key") + ",") }), u = c.find(":selected").attr("idx"), i = i.replace(/,\s*$/, ""), r = r.replace(/,\s*$/, ""), y = k.join(","), tu = [], b = o, h && (b = 0), tu.push({ AD_Window_ID: ku, AD_Tab_ID: du, UserID: ht, AD_GroupField_ID: p.find(":selected").attr("fieldid"), isNewRecord: h, CardViewName: ti, CardViewID: b, IsDefault: wt.is(":checked"), AD_HeaderLayout_ID: it.getValue(), isPublic: bt.is(":checked"), groupSequence: i }), d = n.Application.contextUrl + "CardView/SaveCardViewColumns", t.ajax({ type: "POST", async: !1, url: d, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ lstCardView: tu, lstCardViewColumns: nt, lstCardViewCondition: su, excludeGrp: r, orderByClause: y }), success: function (t) { var s = JSON.parse(t), e; o = s; or = o; yr ? (hi.isCardRow && et.getCardViewData(a, o), ft.close()) : (h ? (e = 0, e = c.find("option").length > 0 ? c.find("option").length : 0, f || (f = []), f.push({ CardViewName: ti, UserID: ht, CreatedBy: n.context.getAD_User_ID(), CardViewID: o, groupSequence: i, excludedGroup: r, AD_GroupField_ID: p.find(":selected").attr("fieldid"), DefaultID: wt.is(":checked"), AD_HeaderLayout_ID: it.getValue(), CardViewName: ti, OrderByClause: y }), c.append("<Option idx=" + e + " is_shared=" + ht + " ad_user_id=" + n.context.getAD_User_ID() + " cardviewid=" + o + " groupSequence='" + i + "' excludedGroup='" + r + "'  ad_field_id=" + p.find(":selected").attr("fieldid") + " isdefault=" + wt.is(":checked") + " ad_headerLayout_id=" + it.getValue() + "> " + w2utils.encodeTags(ti) + "<\/Option>"), c.find('[cardviewid="' + o + '"]').prop("selected", !0).trigger("change")) : (f[u].groupSequence = i, f[u].excludedGroup = r, f[u].AD_GroupField_ID = p.find(":selected").attr("fieldid"), f[u].AD_HeaderLayout_ID = it.getValue(), f[u].CardViewName = ti, f[u].UserID = ht, f[u].OrderByClause = y, c.find("[cardviewid='" + o + "']").text(ti)), lt.trigger("click")); ei(!1) }, error: function (n) { alert(n.statusText); ei(!1) } }), w }, de = function () { var i = n.Application.contextUrl + "CardView/DeleteCardViewRecord"; t.ajax({ type: "POST", async: !1, url: i, dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ ad_CardView_ID: o }), success: function (n) { var t = JSON.parse(n) }, error: function (n) { alert(n.statusText) } }) }, so = function (n) { n != null && n.children().remove(); n.append("<Option ad_user_id=-1 ><\/Option>"); for (var t = 0; t < userInfo.length; t++)n.append("<Option ad_user_id=" + userInfo[t].AD_User_ID + " > " + userInfo[t].UserName + "<\/Option>"); w > 0 && er.find("[ad_user_id='" + w + "']").attr("selected", "selected") }, ho = function (n) { var r, t, i; for (gt = [], r = "", w > 0 && (r = "disabled"), n != null && n.children().remove(), t = 0; t < di.length; t++)n.append("<li ad_role_id=" + di[t].AD_Role_ID + " > <input type='checkbox' " + r + "> " + w2utils.encodeTags(di[t].RoleName) + "<\/li>"); for (t = 0; t < ni.length; t++)if (ni[t] != null) for (i = 0; i < ni[t].length; i++)ni[t][i].AD_CardView_ID == o && (n.find("[ad_role_id='" + ni[t][i].AD_Role_ID + "']").find("input").prop("checked", !0), gt.push({ AD_Role_ID: ni[t][i].AD_Role_ID })) }, wf = function () { ft != null && ft.changeTitle(n.Msg.getMsg("Card")) }, ge = function (i) { var r = t("<Table class='vis-cv-headertable'><tr class='vis-cv-TableHead'><th >" + n.Msg.getMsg("BGColorGrid") + "<\/th><th>" + n.Msg.getMsg("Column") + "<\/th><th>" + n.Msg.getMsg("Operator") + "<\/th><th>" + n.Msg.getMsg("QueryValue") + "<\/th><th>" + n.Msg.getMsg("Action") + "<\/th><tr><\/Table>"), u = t("<div class='vis-cv-divrowtable'><Table class='vis-cv-rowtable'><\/Table><\/div>"); i.append(r); i.append(u) }, si = function (n) { var i, r; if (st != null && st.children().remove(), n != null) { var f = null, e = u.find(".vis-cv-TableHead").children().eq(0).innerWidth(), o = u.find(".vis-cv-TableHead").children().eq(1).innerWidth(), s = u.find(".vis-cv-TableHead").children().eq(2).innerWidth(), h = u.find(".vis-cv-TableHead").children().eq(3).innerWidth(), c = u.find(".vis-cv-TableHead").children().eq(4).innerWidth(); for (i = 0; i < n.length; i++)for (r = 0; r < n[i].Condition.length; r++)f = t("<tr class='vis-cv-TableRow'><\/tr"), f.append("<td value='" + n[i].Color + "' style='width:" + e + "px'><div class='vis-cvd-bgcolor' style='background:" + n[i].Color + ";cursor:pointer;color:transparent'>-<\/div><\/td>"), f.append("<td style='width:" + o + "px' value=" + n[i].Condition[r].ColName + ">" + n[i].Condition[r].ColHeader + "<\/td>"), f.append("<td style='width:" + s + "px' value=" + n[i].Condition[r].Operator + ">" + n[i].Condition[r].OperatorText + "<\/td>"), f.append("<td style='width:" + h + "px' value=" + n[i].Condition[r].QueryValue + ">" + n[i].Condition[r].QueryText + "<\/td>"), f.append("<td style='width:" + c + "px'><i class='vis vis-delete'><\/i><\/td>"), st.append(f) } }, no = function () { for (var f = '<option value="-1"> <\/option>', t, u, i, r = 0; r < rf.length; r++)if (t = rf[r], !t.getIsEncrypted()) { if (u = t.getColumnName(), t.getDisplayType() == n.DisplayType.Button) { if (t.getAD_Reference_Value_ID() == 0) continue; u.endsWith("_ID") ? t.setDisplayType(n.DisplayType.Table) : t.setDisplayType(n.DisplayType.List) } (i = t.getHeader(), i != null && i.length != 0 || (i = n.Msg.getElement(n.context, u), i != null && i.Length != 0)) && (t.getIsKey() && (i += " (ID)"), f += '<option value="' + u + '">' + i + "<\/option>") } d.html(f) }, co = function () { var n = d.val(), t; wu(!0); n && n != "-1" && (t = pu(n), bu(!0, t)); df(!0) }; ve(); this.getRoot = function () { return wr }; this.show = function () { ft = new n.ChildDialog; ft.setTitle(n.Msg.getMsg("Card")); ft.setContent(wr); ft.onOkClick = function () { if (h) { if (ot.val().trim() == "") return n.ADialog.error("FillMandatory", !0, "Name"), !1 } else if (!h && o < 1 && (c.val() == "" || c.val() == null) && n.MRole.isAdministrator) return n.ADialog.error("ClickNew", !0, ""), !1; var t = v.children().length; if (t.length <= 0) return !1; pf(nt) }; ft.show(); ft.hideButtons(); wf(); si(e); Modernizr.inputtypes.color || pt.spectrum({ showButtons: !1, preferredFormat: "hex" }) } } function u() { function s() { return i.val() == null || i.val() == "" ? (n.ADialog.info("FileNameMendatory"), !1) : (e.onClose(), !0) } function o() { return e.onClose(), !0 } var r = t('<div style="padding-bottom:0px">'), u = t('<span style="display:block;margin-bottom:5px;">' + n.Msg.getMsg("NewCardInfo") + "<\/span>"), i = t('<input style="margin-left:5px">'), f = t("<label>" + n.Msg.getMsg("EnterName") + "<\/label>"), e; r.append(u).append(f).append(i); e = this; this.show = function () { ch = new n.ChildDialog; ch.setTitle(n.Msg.getMsg("CardName")); ch.setModal(!0); ch.setContent(r); ch.show(); ch.onOkClick = s; ch.onCancelClick = o; ch.onClose = o }; this.getName = function () { return i.val() } } r.prototype.getOperatorsQuery = function (t, i) { var f = "", r = "", u; for (u in t) r = t[u], i && (r = n.Msg.getMsg(r)), f += '<option value="' + u + '">' + r + "<\/option>"; return f }; n.CVDialog = r; n.CardCopyDialog = u }(VIS, jQuery), function (n, t) { function i(i) { function st(i) { var e, o; u = t("<div style='overflow: hidden;'>"); s = t('<div class="vis-apanel-busy" style="width: 96%; height: 97%; text-align: center; position: absolute; visibility: hidden;"><\/div>'); l = t('<div style="display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;">'); a = t('<div style="padding-left: 7px;height:88.9%;display: inline-block; float: left;width:100%;height:87.8%;">'); w = t("<button class='vis-initial-btn vis-initial-btn-blue' style='border: none;'>" + n.Msg.getMsg("SelectFile") + "<\/button>"); b = t("<div class='VIS-form-data' style='width: 100%;height:200px;border: 1px solid #ccc;margin-top: 11px;padding: 10px;overflow:auto;'>"); v = t('<div style="display: inline-block; float: left;width:100%;height:auto;margin-top: 2px;">'); d = t("<div style='float: left;'>"); y = t('<div style="float:right;">'); e = n.Msg.getMsg("Cancel"); e.indexOf("&") > -1 && (e = e.replace("&", "")); o = n.Msg.getMsg("Ok"); o.indexOf("&") > -1 && (o = o.replace("&", "")); p = t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(e); f = t("<button class='VIS_Pref_btn-2' disabled='true' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(o); h = i ? t("<input type='file' multiple='true'>") : t("<input type='file'>"); a.append(w); a.append(b); l.append(a); v.append(d); y.append(p); y.append(f); v.append(y); l.append(v); u.append(l); u.append(s); r = [] } function ht() { p.on("click", function () { g = !1; et() }); f.on("click", function () { ft() }); w.on("click", function () { h.val(""); h.trigger("click") }); h.on("change", function () { ut(this) }) } function ct() { g || (k = ""); ot.onClose(k); et() } this.onClose = null; var u, s, l, a, v, y, p, f, r, h, w, b, d, ot = this, g = !1, tt = 0, o = 0, k = Date.now().toString() + "_FileCtrl", e = 1048576, it = 0, c = 0, rt = []; st(i); ht(); this.show = function () { u.dialog({ width: 500, height: 377, resizable: !1, modal: !0, title: n.Msg.getMsg("Upload"), close: ct }) }; var ut = function (i) { for (var u = [], c, e, o, v, s = 0; s < i.files.length; s++) { if (file = i.files[s], file == undefined) return; if (file.name.indexOf("&") > -1 || file.name.indexOf("?") > -1 || file.name.indexOf("#") > -1 || file.name.indexOf("/") > -1 || file.name.indexOf("\\") > -1) { u.push(file.name); continue } for (c in r) if (file.name == r[c].name) { window.setTimeout(function () { n.ADialog.info("fileAlreadyAttached") }, 20); return } if (e = {}, e.Name = file.name, e.Size = file.size, !(e.Size > 17e6)) { r.push(file); var h = t("<div class='VIS-file-wrap'>"), y = t("<p>" + e.Name + "<\/p>"), l = r.length - 1, a = t("<span class='vis vis-mark VIS-close-ico mychoice_" + l + "'  data-index='" + l + "'>"); a.on("click", function () { var n = t(this).parent(), i, u; n && (i = n.children()[0], i && (u = r.map(function (n) { return n.name == t(i).text() }).indexOf(!0), r.splice(u, 1), n.remove())); r.length == 0 ? f.attr("disabled", "true") : f.removeAttr("disabled") }); h.append(y); h.append(a); b.append(h); r.length == 0 ? f.attr("disabled", "true") : f.removeAttr("disabled") } } if (u.length > 0) { o = ""; for (v in u) o += u[v].toString() + "\n"; o += u.length == 1 ? "File has" : "Files have"; o += " " + n.Msg.getMsg("VIS_InvalidName") + " " + n.Msg.getMsg("VIS_ChangeFileName"); n.ADialog.info(o) } }, ft = function () { var t, u; s[0].style.visibility = "visible"; var n = null, i = 0; for (t in r) i = parseInt(r[t].size / e), file.size % e > 0 && i++, it += i, n = {}, n.Name = r[t].name, n.Size = r[t].size, rt.push(n); u = nt() }, nt = function () { var t, i, f; if (r == null || r.length == 0) return n.ADialog.info("NothingToUpload"), s[0].style.visibility = "hidden", !1; if (o >= r.length) return s[0].style.visibility = "hidden", g = !0, u.dialog("close"), !0; t = new XMLHttpRequest; i = new FormData; i.append("file", r[o].slice(c * e, c * e + Number(e))); t.open("POST", n.Application.contextUrl + "Attachment/SaveFileinTemp/?filename=" + r[o].name + "&folderKey=" + k, !1); t.send(i); tt++; c++; f = parseInt(r[o].size / e); r[o].size % e > 0 && f++; c == f && (o++, c = 0); window.setTimeout(function () { nt() }, 2) }, et = function () { p.off("click"); f.off("click"); s = l = a = v = y = p = f = null; r = h = w = b = d = null; tt = o = k = e = it = c = rt = null; ut = ft = nt = loadTables = loadLanguage = loadEDL = loadExportScope = null; u != null && (u.dialog("destroy"), u.remove()); u = null } } n.VisImportFiles = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { function i(i, r) { function a(n) { v.css("display", n ? "block" : "none") } function y(t) { if (t.error == null) { var i = JSON.parse(t.result); if (!i.IsError) if (i.ShowParameter) u.pInstanceId = i.AD_PInstance_ID, u.fields = i.ProcessFields; else return i.ReportProcessInfo != null && (n.ADialog.info(i.ReportProcessInfo.Summary, !0, "", ""), n.Msg.getMsg("ImportedSuccessfully") == i.ReportProcessInfo.Summary) ? (p.parentcall(!0), u && (u.isOkProcess = !0), !0) : (u && (u.isOkProcess = !1), p.parentcall(!1), !1) } } function b() { f = t("<div title='ParameterDialog'>"); c = t("<table class='vis-processpara-table'>"); f.append(c); s = t('<input type="button" style="margin-right:5px" >').val(n.Msg.getMsg("OK")); s.addClass("VIS_Pref_btn-2"); o = t("<input type='button'>").val(n.Msg.getMsg("Close")); o.addClass("VIS_Pref_btn-2"); o.css({ "margin-bottom": "0px", "margin-top": "7px" }); s.css({ "margin-bottom": "0px", "margin-top": "7px" }) } function k(t, i) { if (t) { u.paraList = i; var r = new n.ProcessInfo(u.name, u.processId, 0, 0); r.setAD_PInstance_ID(u.pInstanceId); n.dataContext.executeProcess({ processInfo: r.toJson(), parameterList: i }, function (n) { y(n) }) } } var p = r, f, c, w, h, l, e, s, o, v, u; this.windowNo = i; this.processId = null; this.name = null; this.entityType = null; this.pInstanceId = 0; this.className = null; this.fields = null; this.paraList = null; this.asyncProcess = !0; this.gridFields = []; this.depOnFieldColumn = []; this.depOnField = []; this.vEditors = []; this.vEditors2 = []; this.mFields = []; this.mFields2 = []; this.isOkClicked = !1; this.onClosed; v = t("<div class='vis-apanel-busy' style='width:95%;height:98%;position:absolute'>"); u = this; this.onCloseMain = null; this.isOkProcess = !1; this.process = function (t, i, r) { var f = new n.ProcessInfo(i, t, 0, 0), e, o; f.setAD_PInstance_ID(u.pInstanceId); f.setWindowNo(r); e = { processInfo: f.toJson() }; this.asyncProcess ? n.dataContext.process(e, function (n) { y(n) }) : (o = n.dataContext.process(e), y(o)) }; b(); this.addLine = function () { w = h = l = e = null; h = t("<td class=''>"); l = t("<td class=''>"); e = t("<td class='vis-processpara-table-td3'>"); c.append(t("<tr>").append(h).append(l).append(e)) }; this.addFields = function (t, i) { if (t && h.append(t.getControl()), i && (i.getControl().width("200px"), i.getControl().height("30px"), e.append(i.getControl()), i.getBtnCount() > 0)) { var r = i.getBtn(0); e.append(r); i.getDisplayType() == n.DisplayType.MultiKey && e.append(i.getBtn(1)) } }; this.addButtons = function () { this.addLine(); e.append(o).append(s) }; this.showDialog = function () { f.append(v); f.dialog({ modal: !0, width: "auto", close: function () { if (k(u.isOkClicked, u.parameterList), u.onCloseMain) u.onCloseMain(u.isOkClicked); u.dispose(); u = null; a(!1) } }); window.setTimeout(function () { o.focus() }, 200); a(!1) }; this.onClose = function (n) { u.isOkClicked = n; f.dialog("close") }; o.on(n.Events.onTouchStartOrClick, function () { u.onClose(!1) }); s.on(n.Events.onTouchStartOrClick, function () { a(!0); var n = u.saveParameters(); if (!n) { a(!1); return } u.parameterList = n; u.onClose(!0, n) }); this.disposeComponent = function () { o.off(n.Events.onTouchStartOrClick); s.off(n.Events.onTouchStartOrClick); f.dialog("destroy"); f.remove(); u = null; this.gridFields.length = 0; this.gridFields = null; this.depOnFieldColumn.length = 0; this.depOnFieldColumn - null; this.depOnField.length = 0; this.depOnField = null; this.vEditors.length = 0; this.vEditors2.length = 0; this.mFields.length = 0; this.mFields2.length = 0; this.parameterList = null; this.addLine = null; this.addFields = null; this.addButtons = null; this.showDialog = null; this.onClose = null; this.isOkClicked = null; f = c = w = h = l = e = s = o = null } } i.prototype.initDialog = function (i, r, u, f, e) { var a, o, c, b, p, v, k, s, w, y, h, l; for (this.processId = i, this.name = r, this.entityType = u, this.className = f, typeof e != "undefined" && (this.asyncProcess = e), this.process(i, r, this.windowNo), a = this.fields, o = null, c = 0, b = a.length; c < b; c++) { for (o = new n.GridField(a[c]), this.addLine(), this.mFields.push(o), p = o.getDependentOn(!1), v = 0; v < p.length; v++)this.depOnField.push(o), this.depOnFieldColumn.push(p[v]); k = n.VControlFactory.getLabel(o); s = n.VControlFactory.getControl(null, o, !1); s && (l = o.getDefault(n.context, this.windowNo), s.setValue(l), s.addVetoableChangeListener(this)); o.setPropertyChangeListener(s); this.vEditors.push(s); this.addFields(k, s); o.getIsRange() ? (this.addLine(), w = {}, t.extend(!0, w, a[c]), y = new n.GridField(w), this.mFields2.push(y), h = n.VControlFactory.getControl(null, y, !1), h && (l = y.getDefault(n.context, this.windowNo), h.setValue(l), h.addVetoableChangeListener(this)), this.vEditors2.push(h), this.addFields(null, h)) : (this.mFields2.push(null), this.vEditors2.push(null)) } return this.addButtons(), !0 }; i.prototype.vetoablechange = function (t) { var e, r, f, u, o, i; if (console.log(t), e = t.newValue == null ? "" : t.newValue.toString(), r = t.propertyName, n.Env.getCtx().setWindowContext(this.windowNo, r, e), this.depOnFieldColumn.indexOf(r) !== -1) for (f = this.getDependantFields(r), u = 0, o = f.length; u < o; u++)(i = f[u], i != null) && (i.refreshLookup(), i.setValue(i.getDefault(n.Env.getCtx(), this.windowNo), !0)) }; i.prototype.getDependantFields = function (n) { var i = [], r, t; if (this.depOnFieldColumn.indexOf(n) != -1) for (r = this.depOnFieldColumn.length, t = 0; t < r; t++)this.depOnFieldColumn[t].equals(n) && i.indexOf(this.depOnField[t]) < 0 && i.push(this.depOnField[t]); return i }; i.prototype.saveParameters = function () { for (var r = new StringBuilder, v = this.mFields.length, t = 0, u, e, o, y, s, h, c, i, a, t = 0; t < v; t++)u = this.mFields[t], u.getIsMandatory(!0) && (e = this.vEditors[t], o = e.getValue(), o == null || o.toString().length == 0 ? (u.setInserting(!0), u.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : u.setError(!1), y = this.vEditors2[t], y != null && (s = e.getValue(), h = this.mFields2[t], s == null || s.toString().length == 0 ? (u.setInserting(!0), h.setError(!0), r.length() > 0 && r.append(", "), r.append(u.getHeader())) : h.setError(!1))); if (r.length() != 0) return n.ADialog.error("FillMandatory", !0, r.toString()), !1; for (c = [], i = {}, t = 0; t < v; t++) { var p = this.vEditors[t], f = this.vEditors2[t], w = p.getValue(), l = null; (f != null && (l = f.getValue()), w != null || l != null) && (i = {}, a = this.mFields[t], i.Name = a.getColumnName(), i.DisplayType = a.getDisplayType(), i.Result = w, i.Result2 = l, i.Info = p.getDisplay(), f != null && (i.Info_To = f.getDisplay()), c.push(i)) } return c }; i.prototype.dispose = function () { this.disposeComponent() }; n.ParameterDialog = i }(VIS, jQuery), function (n, t) { function f(n, i, u) { var f = null; return t.ajax({ url: r, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { f = n; u && u(n) }), f } function e(t, i) { function f() { var o, e, i, f; try { if (o = "VIS_100", e = [], e[0] = new n.DB.SqlParam("@processName", t), i = u(o, e), i != null && i.getTables()[0].getRows().length > 0) { var s = i.tables[0].getRow(0).getCell(0), h = i.tables[0].getRow(0).getCell(1), c = i.tables[0].getRow(0).getCell(2), l = i.tables[0].getRow(0).getCell(3); s > 0 ? (f = new n.ParameterDialog(r.parent.windowNo, r), f.initDialog(s, h, l, c, !1), f.onCloseMain = function (t) { t ? n.ADialog.info("ProcessWait", !0, "", "") : n.ADialog.info("Process Canceled", !0, "", "") }, f.showDialog(), f = null) : n.ADialog.info("ProcessNotFound", !0, "", "") } } catch (a) { } } this.parent = i; var r = this; f(); this.lockUI = function (n) { r.lockUI && r.lockUI(n) }; this.unlockUI = function (n) { r.unlockUI && r.unlockUI(n) }; this.parentcall = function (n) { r.parentcall && r.parentcall(n) } } var i = n.Application.contextUrl, r = i + "JsonData/JDataSetWithCode", u = function (t, i, r) { var o = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u; return i && (e.param = i), u = null, f(e, o, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }; n.ProcessWrapper = e }(VIS, jQuery), function (n, t) { function i() { function go(n, i, r) { var u = null; return t.ajax({ url: vh, type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: i, data: JSON.stringify(n) }).done(function (n) { u = n; r && r(n) }), u } function es() { t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/TreeDataForCombo", success: function (i) { var u = JSON.parse(i), r; if (u) for (w.append(t("<Option value=''> <\/option>")), r = 0; r < u.length; r++)w.append(t("<Option value=" + u[r].ID + " data-type='" + u[r].TreeType + "' data-isallnodes='" + u[r].IsAllNodes + "'  >" + n.Utility.encodeText(u[r].Name) + "<\/option>")); ei != null && w.val(ei.attr("value")); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "visible" } }) } function os() { nr.css("display", "none"); e = 0; u.empty(); i.empty(); ht.empty(); at = ""; gt.val(""); ei = null; d.addClass("vis-tm-delete"); o.val(""); window.setTimeout(function () { u.empty(); b.data("kendoTreeView").destroy(); b.empty() }, 200); du.text(n.Msg.getMsg("SelectTree")); ti.text(n.Msg.getMsg("SelectTree")); ii.css("display", "none"); dt.addClass("vis-tm-delete"); y.prop("disabled", !0); vi.prop("disabled", !0); y.css("cursor", "not-allowed"); vi.css("cursor", "not-allowed"); o.prop("disabled", !0); gt.prop("disabled", !0); nt.prop("disabled", !0); ft.prop("disabled", !0); ft.css("cursor", "not-allowed"); lr.css("display", "none"); bi.css("display", "none"); vi.prop("checked", !1); ft.prop("checked", !1); y.prop("checked", !1); g.prop("checked", !1) } function ou() { var u = "SELECT ad_table_id FROM ad_tree WHERE ad_tree_id=" + e, i, r, f, s, o; if (u = k(u, null, null), u.tables[0].rows.length > 0 && (u = u.tables[0].rows[0].cells.ad_table_id), i = "SELECT tablename FROM ad_table WHERE ad_table_id=" + u, i = k(i, null, null), i.tables[0].rows.length > 0 && (i = i.tables[0].rows[0].cells.tablename), kr(), r = "SELECT Count(*) as Count FROM " + i + " WHERE IsActive='Y' AND " + i + "_ID  IN (SELECT Node_ID FROM " + di + " where AD_Tree_ID=" + e + ")", r = n.MRole.addAccessSQL(r, i, !0, !1), r = k(r, null, null), r = r.tables[0].rows[0].cells.count, er = r > 0 ? !0 : !1, ni == "false" && r == hi.length && (f = "SELECT node_id  FROM " + di + " WHERE isactive ='Y' AND AD_Tree_ID=" + e, f = k(f, null, null), f != null)) for (s = null, o = 0; o < f.tables[0].rows.length; o++)if (s = f.tables[0].rows[o].cells.node_id, t.inArray(s, hi) < 0) { er = !0; break } else er = !1 } function nf(i, r, u, f) { oi[0].style.visibility = "visible"; it.is(":checked") || (fa(), f = it.is(":checked") ? !0 : !1); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/BindTree", type: "Post", data: { treeType: i, AD_Tree_ID: r, isAllNodes: u, isSummary: f }, success: function (n) { var t = JSON.parse(n); t && (nc(t), window.setTimeout(function () { window.setTimeout(function () { w.val() == "" ? os() : w.val() == null && os(); ou() }, 400) }, 500), po = t, vo = t.settree); oi[0].style.visibility = "hidden" }, error: function (n) { console.log(n); oi[0].style.visibility = "hidden" } }) } function gh() { wr.css("display", "none"); fi = !1; tt.css("display", "none"); c.css("height", "100%"); kt.css("height", "100%"); c.resizable("destroy"); kt.removeClass("VIS-TM-resizediv"); ei != null && nf(bt, e, vr, fi) } function nc(u) { oi[0].style.visibility = "visible"; nr.css("display", "inherit"); b && b.data("kendoTreeView") != undefined && (b.data("kendoTreeView").destroy(), b.empty()); b = r.kendoTreeView({ autoScroll: !0, dragAndDrop: !0, drag: tc, drop: ic, dataSource: u.settree, select: function (n) { st[0].style.visibility = "visible"; it.is(":checked") && cr.css("display", "inherit"); sr == !0; i.empty(); g.prop("checked", !1); r.find(".k-state-selected").removeClass("k-state-selected"); t(n.node).find(".k-state-hover").addClass("k-state-selected").removeClass("k-state-hover"); var u = t(t(t(n.node).find(".treechild")[0]).find("p")).text(); ti.text(u); pr = t(t(n.node).find(".treechild")[0]).attr("data-nodeid"); fr = !0; hf = -1; d.addClass("vis-tm-delete"); ii.css("display", "none"); wf = !1; r.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode"); r.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode"); window.setTimeout(function () { r.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode"); r.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode"); ut = 1; et = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; window.setTimeout(function () { pr = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); it.is(":checked") && (r.find(".k-state-hover").removeClass("k-state-hover"), ki(pr, e, ut, et, v, h, n)) }, 300) }, 300) }, template: "<div class='treechild'  data-getparentnode='#= item.getparentnode #'       data-IsSummary='#= item.IsSummary #' data-TableName='#= item.TableName #' data-NodeID='#= item.NodeID #'   data-TreeParentID='#= item.TreeParentID #' data-ParentID='#= item.ParentID #'  ><div class='imgdivTree'><i class='fa fa-folder-o' data-imgsrc='#= item.ImageSource #'><\/i><\/div><div class='textdivTree'><p>" + n.Utility.encodeText("#= item.text #") + "<\/p><\/div><\/div>" }); nu(); b.find(".k-plus").on("click", function () { t(this).hasClass("k-minus") && (ct.css("display", "inherit"), yt.css("display", "none")); t(this).hasClass("k-plus") && (yt.css("display", "inherit"), ct.css("display", "none")) }); b.find(".k-in").on("dblclick", function () { t(r.find(".k-state-selected").parent().find("span")[0]).hasClass("k-minus") && (ct.css("display", "inherit"), yt.css("display", "none")); t(r.find(".k-state-selected").parent().find("span")[0]).hasClass("k-plus") && (yt.css("display", "inherit"), ct.css("display", "none")) }); window.setTimeout(function () { nr.css("display", "none") }, 200); iu == !0 && (b.data("kendoTreeView").expand(".k-item"), r.find("div").find("div[data-nodeid='" + so + "']").parent().addClass("k-state-selected"), r.find("span").hasClass("k-state-selected") && r.find("div").find("div[data-nodeid='" + so + "']").parent().addClass("k-state-selected")[0].scrollIntoView()); o.val() != "" && ur(rr); lu(); window.setTimeout(function () { o.val() != "" && ur(se) }, 200); hc() } function tc(n) { rr = n; tt.addClass("vis-tm-bottomdivdisable"); ro.css("display", "inherit"); si.css("display", "inherit"); au = t(n.sourceNode).find(".treechild").attr("data-nodeid"); wo = t(n.sourceNode).find(".treechild").parent().parent().parent(); ss = t(n.sourceNode); or = this.dragging._draggable.hint.find(".k-denied"); t(r.find("ul")[0]).css("width", "95%"); s.addClass("VIS-TM-ondragdrop"); au != 0 && (ot.css("display", "inherit"), s.css("display", "inherit")); t(n.sourceNode).find(".treechild").attr("data-nodeid") == 0 && n.setStatusClass("k-denied"); t(n.dropTarget).parent().parent().attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).parent().parent().parent().parent().parent().find(".treechild").attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("k-top") && t(n.dropTarget).find(".treechild").attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("k-item") && n.setStatusClass("k-denied"); this.dragging._draggable.hint.find(".k-add").length == 1 && t(n.dropTarget).parent().attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).parent().find(".textdivTree").length == 1 && this.dragging._draggable.hint.find(".k-add").length == 1 && n.setStatusClass("k-denied"); (t(n.dropTarget).attr("aria-expanded") == "true" || t(n.dropTarget).attr("aria-expanded") == "false") && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("selectchangecolor") ? (or.css("display", "none"), or.parent().prepend(hs), or.parent().find(".vis-tm-unlinkimgss").css("display", "inherit")) : (or.css("display", "inherit"), or.parent().find(".vis-tm-unlinkimgss").css("display", "none")); t(n.dropTarget).hasClass("glyphicon glyphicon-trash") && (or.css("display", "none"), or.parent().prepend(hs)); yo = this.dragging._draggable.hint.find("span").hasClass("k-insert-bottom"); yo && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("k-state-hover") && t(n.dropTarget).find(".treechild").attr("data-issummary") == "false" && n.setStatusClass("k-denied"); t(n.dropTarget).hasClass("VIS-TM-root-node") && n.setStatusClass("k-denied") } function ic(n) { var u, l, h, i, c; if (tf = 0, tf = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"), rr = n, lt.css("overflow", "auto"), gu.css("overflow", "auto"), yf.css("overflow", "auto"), tt.removeClass("vis-tm-bottomdivdisable"), ro.css("display", "none"), si.css("display", "none"), n.sourceNode.previousSibling == n.destinationNode && n.dropPosition == "after") { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (n.sourceNode.nextSibling == n.destinationNode && n.dropPosition == "before") { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (n.dropPosition == "after") { if (t(n.dropTarget).parent().attr("data-nodeid") == 0) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).find(".treechild").attr("data-nodeid") == 0) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).hasClass("k-minus")) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } } if (n.dropPosition == "before") { if (t(n.dropTarget).find(".treechild").attr("data-nodeid") == 0) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).hasClass("k-minus")) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).parent().hasClass("imgdivTree")) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).hasClass("VIS-TM-tree-wrap")) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).parent().hasClass("k-bot") && t(t(t(n.dropTarget).parent()).parent()).parent().attr("role") != "group") { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).parent().hasClass("textdivTree") && t(n.dropTarget).parent().parent().attr("data-nodeid") == 0) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } } if (n.dropPosition == "over") { if (t(n.dropTarget).parent().attr("data-issummary") == "false") { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } if (t(n.dropTarget).find(".treechild").attr("data-nodeid") == 0) { n.preventDefault(); s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); return } } if (s.hasClass("selectchangecolor") && t(t(this.dragging._draggable.hint)).animate({ left: "250px", opacity: "0.5", height: "2px", width: "2px" }, 1e3), s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), ot.css("display", "none"), !or.hasClass("k-denied") || s.hasClass("selectchangecolor")) { if (u = " SELECT treetype FROM ad_tree WHERE ad_tree_id=" + e, u = k(u, null, null), treeType = u.tables[0].rows[0].cells.treetype, gi = treeType == "PR" ? "AD_TreeNodePR" : treeType == "BP" ? "AD_TreeNodeBP" : treeType == "MM" ? "AD_TreeNodeMM" : "AD_TreeNode", l = b.find(".k-state-hover").find(".treechild").attr("data-nodeid"), h = b.find(".k-state-hover").find(".treechild").attr("data-issummary"), h == "true") { rc(e, au, l); i = t(n.destinationNode); f[0].style.visibility = "visible"; window.setTimeout(function () { f[0].style.visibility = "visible"; ls(i); o.val() != "" && ur(n); lu(); cs(); f[0].style.visibility = "hidden" }, 100); return } if (h = t(n.destinationNode).parent().parent().find(".treechild").attr("data-issummary"), n.sourceNode === n.destinationNode) { n.setValid(!1); f[0].style.visibility = "hidden"; return } if (cs(), tf > 0 && window.setTimeout(function () { r.find(".k-state-selected").removeClass("k-state-selected"); t(r.find("div").find("div[data-nodeid='" + tf + "']").parent()).addClass("k-state-selected"); lu() }, 200), t(n.destinationNode).parent().parent().parent().attr("role") == "tree") { i = t(n.destinationNode); f[0].style.visibility = "visible"; var v = n.dropPosition, y = n.sourceNode, p = t(t(n.sourceNode.parentElement).parent().find(".k-in")[0]).find(".treechild").attr("data-nodeid"); window.setTimeout(function () { var o, h, u, r; if (f[0].style.visibility = "visible", o = i.parent().children(), o.length > 0) { var n = 0, c = "SELECT seqno FROM " + gi + "  WHERE AD_Tree_ID=" + e + " AND node_id=" + i.find(".treechild").attr("data-nodeid"), s = k(c, null, null); s.tables[0].rows.length > 0 && (n = s.tables[0].rows[0].cells.seqno); v == "after" && (n = n + 1); h = "update " + gi + " set seqno=seqno+1,Updated=Sysdate,parent_ID=0 where seqno >=" + n + " AND (parent_id=0 or parent_id is null)  AND AD_Tree_ID=" + e; fu(h, null, null); u = t(y).find(".treechild").attr("data-nodeid"); p > 0 ? (r = "update " + gi + " set seqno=" + n + ",parent_id=0  where node_id=" + u + "   AND AD_Tree_ID=" + e, fu(r, null, null)) : (r = "update " + gi + " set seqno=" + n + " where node_id=" + u + " AND (parent_id=0 or parent_id is null) AND AD_Tree_ID=" + e, fu(r, null, null)) } f[0].style.visibility = "hidden" }, 600) } else { if (c = t(n.destinationNode), c.length == 0) { if (pu = t(n.sourceNode).find(".treechild").attr("data-nodeid"), af = t(n.sourceNode).find(".treechild").parent().parent().parent(), s.hasClass("selectchangecolor")) yl(); else { s.removeClass("VIS-TM-ondragdrop"); s.css("display", "none"); ot.css("display", "none"); f[0].style.visibility = "hidden"; return } return } var w = n.destinationNode.parentElement, a = n.sourceNode.parentElement, d = n.destinationNode, g = n.sourceNode; f[0].style.visibility = "visible"; window.setTimeout(function () { var s, u, i, n, o, r; if (f[0].style.visibility = "visible", s = t(t(g).find(".treechild").parent().parent().parent().parent().parent()).find("li").find(".k-state-hover").find("div").attr("data-nodeid"), u = c.parent().children(), w == a) { if (i = t(a.parentElement).find(".treechild").attr("data-nodeid"), i != 0) for (n = 0; n < u.length; n++)o = t(u[n]).find(".treechild").attr("data-nodeid"), r = "UPDATE ", r += gi + " SET Parent_ID=" + i + ", SeqNo=" + n + ", Updated=SysDate WHERE AD_Tree_ID=" + e + " AND Node_ID=" + o, fu(r, null, null) } else if (i = t(d.parentElement).parent().find(".treechild").attr("data-nodeid"), i != 0) for (n = 0; n < u.length; n++)o = t(u[n]).find(".treechild").attr("data-nodeid"), r = "UPDATE ", r += gi + " SET Parent_ID=" + i + ", SeqNo=" + n + ", Updated=SysDate WHERE AD_Tree_ID=" + e + " AND Node_ID=" + o, fu(r, null, null); f[0].style.visibility = "hidden" }, 600) } window.setTimeout(function () { o.val() != "" && ur(n) }, 300) } } function cs() { r.find(".k-state-selected").length > 1 && (r.find(".k-state-selected").removeClass("k-state-selected"), i.empty()) } function ls(n) { var u = n.parent(), i, f; u.attr("role") == "tree" ? (i = n.parent().children().children("ul").children()[n.parent().children().children("ul").children().length - 1], i && u && (i.remove(), t(t(u.children()[0]).children("ul")).prepend(i))) : (n.children("ul") && (i = n.children("ul").children()), i && (i = t(i[i.length - 1])), i && i.siblings().length > 0 && (f = t(i.siblings()[0]).parent(), r.data("kendoTreeView").detach(i[0]), f.prepend(i[0]))) } function rc(i, r, u) { f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/SaveTreeDragDrop", type: "Post", data: { treeID: i, NodeID: r, ParentID: u }, success: function (t) { var i = JSON.parse(t); i == n.Msg.getMsg("VIS_DataSave"); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function ki(r, u, e, s, h, l, a) { st[0].style.visibility = "visible"; h == null && (h = ""); nu(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/GetDataTreeNodeSelect", type: "Post", async: !1, data: { nodeID: r, treeID: u, pageNo: e, pageLength: s, searchChildNode: h, getTreeNodeChkValue: l }, success: function (r) { var u, s, c; if (sr != !1) { var e = JSON.parse(r), h = null; if (e.length > 0) { for (st[0].style.visibility = "visible", fr == !0 && i.empty(), ui = !0, u = 0; u < e.length; u++)if ((fr != !1 || !(i.find("li li").length > 0) || (s = i.find('[data-id="' + e[u].parentID + '"]'), !s || !(s.length > 0))) && e[u].parentID != 0) if (c = t('<input class="VIS-tm-checkbox" type="checkbox" />'), e[u].issummary == "Y") continue; else h = "<i class='vis vis-m-window summNonsumImage' data='Images/mWindow.png'><\/i>", i.append(t('<li class="VIS-tm-topMLi">').append(c).append(h).append(t("<li class='VIS-tm-MLi'    data-id='" + e[u].parentID + "' data-issummary='" + e[u].issummary + "' id='" + e[u].parentID + "'   >" + n.Utility.encodeText(e[u].name) + "<\/li>"))); ii.css("display", "none"); vs(); fo(); nu() } else i.find("li").length > 0 ? (ui = !0, ii.css("display", "none")) : (ui = !1, ii.css("display", "inherit")); ur(a); window.setTimeout(function () { i.find("input:checked").length > 0 ? d.removeClass("vis-tm-delete") : d.addClass("vis-tm-delete") }, 200); ir(); g.is(":checked") && (i.find("input").prop("checked", !0), i.find("input").parent().addClass("vis-tm-menuselectedcolor")); i.find("li").length > 0 ? (ui = !0, ii.css("display", "none")) : (ui = !1, ii.css("display", "inherit")); o.prop("disabled", !1); tr.prop("disabled", !1); o.focus(); df = !0; bf = !0; cr.css("display", "none"); f[0].style.visibility = "hidden"; ou(); st[0].style.visibility = "hidden" } }, error: function (n) { cr.css("display", "none"); ui = !1; console.log(n); i.empty(); o.prop("disabled", !1); tr.prop("disabled", !1); o.focus(); bf = !0; f[0].style.visibility = "hidden"; st[0].style.visibility = "hidden" } }); window.setTimeout(function () { i.find("li").length > 0 ? (ui = !0, ii.css("display", "none"), dt.removeClass("vis-tm-delete"), st[0].style.visibility = "hidden") : (ui = !1, dt.addClass("vis-tm-delete")) }, 500); lt.height(ri.height() - (c.height() + 20 + br.height())) } function as() { f[0].style.visibility = "hidden"; th(); var r = new n.ChildDialog; r.setEnableResize(!1); r.setTitle(n.Msg.getMsg("UnlinkRecord")); r.setModal(!0); r.setContent(ue); r.show(); r.onClose = function () { }; r.onOkClick = function () { for (var n = [], u, r = 0; r < i.find("input:checked").length; r++)u = t(i.find("input:checked")[r]).parent().find("li").attr("data-id"), n.push(u); i.find("input:checked").length == 0 && n.push(su); bottomchildselectedID = n; n = n.toString(); ff(e, n); a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none") }; r.onCancelClick = function () { a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none") } } function uc(r, u) { var o, s, e, h; for (st[0].style.visibility = "visible", o = [], s = "", e = 0; e < i.find("li li").length; e++)h = t(i.find("li li")[e]).attr("data-id"), o.push(h); s = o.toString(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/UpdateItemSeqNo", type: "Post", data: { treeID: u, itemsid: s, ParentID: r }, success: function (n) { var t = JSON.parse(n) }, error: function (n) { console.log(n); f[0].style.visibility = "visible" } }); st[0].style.visibility = "hidden" } function kr() { t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/TreeTableName", async: !1, data: { treeID: e }, success: function (n) { var t = JSON.parse(n); di = t }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function vs() { t(i.find("li")).draggable({ cursorAt: { left: -10, top: -10 }, helper: function () { var r = t(i.find("li")).find("input:checked").parent(), n; if (r.length === 0 && (r = t(this)), n = t("<div/>").attr("id", "draggingContainer"), t(i.find("li")).find("input:checked").length == 0) { if (t(this).hasClass("VIS-tm-topMLi")) return; r = t(this).parent(); n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer") } return n.append(r.clone()), l = n, l.css("width", "250px"), l.css({ "z-index": 2 }), l.css({ "max-height": "250px", overflow: "auto" }), l.css({ overflow: "hidden" }), n }, start: function () { var n, i, r; for (le = t(this).attr("id"), yr = !0, li = [], hu = [], n = 0; n < t(t(l.find("li li"))).length; n++)i = t(t(l.find("li li"))[n]).attr("id"), hu.push(parseInt(i)), li.push(i); nu(); bo = !1; dr = !0; cu = !1; ys(); si.css("display", "inherit"); d.css("display", "none"); a.height(tt.height()); a.css("margin-top", "5px"); a.css("background-color", "#FFC0CB"); a.css("display", "inherit"); a.mouseover(function () { a.addClass("selectchangecolor"); a.css("background-color", "#ff0000") }); a.mouseleave(function () { a.removeClass("selectchangecolor"); a.css("background-color", "#FFC0CB") }); r = ri.width() - 35; tt.width(r); dt.css("display", "none"); lt.css("overflow", "hidden") }, drag: function () { }, stop: function () { var o, u, s, r, i; if (dr = !1, a.hasClass("selectchangecolor")) if (f[0].style.visibility = "visible", kr(), o = "Select node_id from " + di + " where parent_id=" + su + " AND isactive='Y' and ad_tree_id=" + e + "", u = k(o, null, null), u != null && u.tables[0].rows.length == 0) { if (s = [], li.length > 0) if (ni == "false") { for (r = [], i = 0; i < hu.length; i++)t.inArray(hu[i], hi) >= 0 || r.push(hu[i]); r.length > 0 ? ff(e, r.toString()) : (n.ADialog.info("NeverDelete", !0, tu), f[0].style.visibility = "hidden") } else ff(e, li.toString()); else n.ADialog.info("NeverDelete", !0, tu), f[0].style.visibility = "hidden"; a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none"); d.css("display", "inherit") } else as(); a.removeClass("VIS-TM-ondragdrop"); a.css("display", "none"); d.css("display", "inherit"); tt.css("width", "100%"); lt.css("overflow", "auto"); si.css("display", "none"); dt.css("display", "inherit") } }) } function ar(i, r, e, o) { u.find("li").length == 0 && ht.empty(); lf != !1 && u.empty(); wi[0].style.visibility = "visible"; e = n.Utility.encodeText(e); e == null && (e = ""); cr.css("display", "inherit"); si.css("display", "inherit"); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/LoadMenuData", type: "Post", data: { pageLength: ae, pageNo: pi, treeID: i, searchtext: e, demandsMenu: o }, success: function (i) { var f = JSON.parse(i), o, s, e, l = t("<span><\/span>"), r, h, c; if (f) { for (r = 0; r < f.length; r++)u.find("li li").length > 0 && (h = u.find('[data-id="' + f[r].ID + '"]'), h && h.length > 0) || f[r].ID != 0 && (f[r].issummary == "Y" ? (f[r].disabled == !0 ? (e = t('<input class="vis-tm-chkbox" disabled type="checkbox" />'), o = "<i class='" + f[r].classopacity + " fa fa-folder-o summNonsumImage' data-imgsrc='Images/summary.png'><\/i>") : (e = t('<input  class="vis-tm-chkbox" type="checkbox" />'), o = "<i class='vis vis-m-window summNonsumImage' data-imgsrc='Images/folder.png'><\/i>"), u.append(t('<li class="vis-tm-upperLi">').append(t("<div class='vis-tm-upperdivchkandimg'>").append(e).append(o)).append(t("<div class='vis-tm-upperdivli'>").append(t("<li class='" + f[r].classopacity + " vis-tm-textli ' checkSummary='checkSummary'  style='cursor:default;' id='" + f[r].ID + "' data-id='" + f[r].ID + "'  style='cursor:pointer'  >" + n.Utility.encodeText(f[r].Name) + " (" + n.Utility.encodeText(f[r].description) + ")<\/li>").append(t("<span title='" + n.Msg.getMsg("UnlinkNode") + "' class='" + f[r].unlinkClass + "'><\/span>")))))) : (f[r].disabled == !0 ? (e = t('<input  class="vis-tm-chkbox"  disabled type="checkbox" />'), s = "<i class='" + f[r].classopacity + " vis vis-m-window summNonsumImage' data-imgsrc='Images/nonSummary.png'><\/i>") : (e = t('<input  class="vis-tm-chkbox" type="checkbox" />'), s = "<i class='vis vis-m-window summNonsumImage' data-imgsrc='Images/mWindow.png'><\/i>"), u.append(t('<li class="vis-tm-upperLi">').append(t("<div class='vis-tm-upperdivchkandimg'>").append(e).append(s)).append(t("<div class='vis-tm-upperdivli'>").append(t("<li class='" + f[r].classopacity + " vis-tm-textli ' style='cursor:default;' id='" + f[r].ID + "' data-id='" + f[r].ID + "'   style='cursor:pointer'  >" + n.Utility.encodeText(f[r].Name) + " (" + n.Utility.encodeText(f[r].description) + ")<\/li>").append(t("<span title='" + n.Msg.getMsg("UnlinkNode") + "' class='" + f[r].unlinkClass + "'><\/span>"))))))); u.find("li").length > 0 ? eu.css("display", "none") : eu.css("display", "inherit") } else u.find("li").length > 0 ? eu.css("display", "none") : eu.css("display", "inherit"); fc(); ws(); nt.prop("disabled", !1); cr.css("display", "none"); si.css("display", "none"); nr.css("display", "none"); wi[0].style.visibility = "hidden"; c = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); c && t(u.find("li")).draggable("destroy") }, error: function (n) { console.log(n); cr.css("display", "none"); si.css("display", "none"); nt.prop("disabled", !1); nr.css("display", "none"); f[0].style.visibility = "hidden"; wi[0].style.visibility = "hidden" } }) } function fc(n) { rr = n; t(u.find("li")).draggable({ cursorAt: { left: -10, top: -10 }, helper: function () { var i, n; return l = [], i = t(u.find("input:checked")).parent().parent(), i.length === 0 && (i = t(this)), n = t("<div/>"), t(u.find("input:checked")).parent().parent().length == 0 ? t(this).hasClass("vis-tm-textli") ? t(this).parent().parent().find("input").attr("disabled") == "disabled" ? window.setTimeout(function () { }, 200) : (i = t(this).parent().parent(), n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer")) : t(this).hasClass("vis-tm-upperLi") && (t(this).find("input").attr("disabled") == "disabled", n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer")) : t(this).hasClass("vis-tm-textli") ? (t(this).parent().parent().find("input").attr("disabled") == "disabled", n = t('<div style="background-color:lightblue;"/>').attr("id", "draggingContainer")) : t(this).hasClass("vis-tm-upperLi") && (t(this).find("input").attr("disabled") == "disabled", n = t("<div/>").attr("id", "draggingContainer")), t(this).parent().parent().find("input").attr("disabled") != "disabled" && t(this).parent().parent().find("input").attr("disabled") != undefined && n.append(i.clone()), (t(u.find("input:checked")).length > 0 || i.find("input").attr("disabled") == undefined) && !i.hasClass("vis-tm-opacity") && n.append(i.clone()), l = n, l.css({ width: "350px" }), l.css({ "z-index": 2 }), l.find(".vis-tm-upperLi").length > 5 && (l.css({ "max-height": "250px", overflow: "auto" }), l.css({ overflow: "hidden" })), gr = n, n }, start: function () { var u, r, i, f, e; if (si.css("display", "inherit"), gr.find("li").length > 0 && hr.css("display", "inherit"), bo = !0, gr.find(".vis-tm-textli").hasClass("vis-tm-textli") && (dr = !0), le = t(this).attr("id"), yr = !1, vu = !0, li = [], uu = [], cu = !0, l.find(".vis-tm-upperLi").length == 0) i = l.find("li").attr("id"), li.push(i); else for (u = l.find(".vis-tm-upperLi"), r = 0; r < u.length; r++)i = t(u.find("li")[r]).attr("id"), li.push(i), f = t(u[r]).find("i").data("imgsrc"), e = f.substr(f.lastIndexOf("/") + 1), e == "mWindow.png" || e == "folder.png" ? uu.push("new") : uu.push("update"); nu(); fo(n); ys() }, drag: function () { }, stop: function () { li = []; dr = !1; si.css("display", "none"); hr.css("display", "none") } }) } function nu() { ri.droppable({ drop: function (n, i) { var u = !0, s, c, h, o, e, l; be == !1 && (u = !1); t(i.draggable).hasClass("ui-dialog") && (f[0].style.visibility = "hidden", u = !1); r.find("span").hasClass("k-state-hover") || r.find("span").hasClass("k-state-selected") || (f[0].style.visibility = "hidden", u = !1); vu = !1; r.find("span").hasClass("k-state-hover") ? yu = t(r.find("li").find("span")).parent().find(".k-state-hover").parent().parent() : r.find("span").hasClass("k-state-selected") && (yu = t(r.find("li").find("span")).parent().find(".k-state-selected").parent().parent()); r.find("span").hasClass("k-state-hover") ? (o = b.find(".k-state-hover").find(".treechild"), ai = o, s = o.attr("data-issummary"), c = o.attr("data-nodeid"), h = o.attr("data-parentid")) : r.find("span").hasClass("k-state-selected") && (e = r.find(".k-state-selected").find(".treechild"), e.parent().css("border", "none"), ai = e, c = e.attr("data-nodeid"), s = e.attr("data-issummary"), h = e.attr("data-parentid")); l = []; s == "true" ? (cu == !1 && ai.parent().hasClass("k-state-selected") && (u = !1), kf = u, u == !0 ? (kf = u, eo(c, h, li, yr, uu)) : u == !1 && (vu = !0, f[0].style.visibility = "hidden")) : s != "false" || it.is(":checked") || (SummaryIDs = t(yu.parent().parent().find(".treechild")[0]).attr("data-nodeid"), ai = t(yu.parent().parent().find(".treechild")[0]), eo(SummaryIDs, h, li, yr, uu)) } }) } function ys() { r.data("kendoTreeView").wrapper.find(".k-in").on({ mouseenter: function () { dr == !0 && (be = !0, t(this).hasClass("k-state-selected") && t(this).css("border", "2px solid #bac0cc")) }, mouseleave: function () { dr == !0 && t(this).hasClass("k-state-selected") && t(this).css("border", "none"); be = !1 } }) } function fo() { i.parent().droppable({ drop: function (i, u) { var o = !0, e; if (vu == !1 && (o = !1), t(u.draggable).hasClass("ui-dialog") && (f[0].style.visibility = "hidden", o = !1), o == !0 && !yr) if (r.find(".k-state-selected").length == 1) { e = r.find(".k-state-selected").find(".treechild"); ai = e; var s = e.attr("data-nodeid"), h = e.attr("data-issummary"), c = e.attr("data-parentid"); h == "true" && gr.find(".vis-tm-textli").hasClass("vis-tm-textli") && (f[0].style.visibility = "visible", eo(s, c, li, yr, uu)) } else gr.find(".vis-tm-textli").hasClass("vis-tm-textli") && n.ADialog.info("SelectAnySummaryTreeNode"); r.find(".k-state-selected").length == 0 && gr.find(".vis-tm-textli").hasClass("vis-tm-textli") && n.ADialog.info("SelectAnySummaryTreeNode") }, tolerance: "pointer" }) } function eo(s, h, c, a, v) { var p = c.toString(); p != "" && (f[0].style.visibility = "visible", ht.empty(), v = v.toString(), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/SaveDataOnDrop", type: "Post", data: { summaryid: s, nodid: h, treeID: e, dragMenuNodeID: p, checkMorRdragable: a, IsExistItem: v }, success: function (e) { var ht = !0, ri = JSON.parse(e), ft, dt, ui, v, et, lt, at, vt, p, h, w, gt, b, c, bt, rt, d, tt, ot, ut, ni, ti, kt; if (a) for (ft = 0; ft < l.find("li").find(".VIS-tm-MLi").length; ft++)r.find("div").find("div[data-nodeid='" + s + "']").parent().hasClass("k-state-selected") && cu == !1 || (et = t(l.find("li").find(".VIS-tm-MLi")[ft]).attr("id"), t(i.find("li").find("li[data-id='" + et + "']").parent()).remove()); if (ri == n.Msg.getMsg("VIS_DataSave")) { if (dt = u.find(".vis-tm-menuselectedcolor"), ui = l.find("li .vis-tm-textli").attr("id"), r.find("div").find("div[data-nodeid='" + s + "']").parent().hasClass("k-state-selected")) for (v = l.find("li li").length - 1; v >= 0; v--)if (et = l.find("li li").attr("id"), cu != !1) { if (lt = i.find("input:checked").length, at = i.find("input").length, lt == at ? lt != 0 && at != 0 ? g.prop("checked", !1) : g.prop("checked", !1) : g.prop("checked", !1), vt = t(l.find("li li")[v]).attr("id"), p = t(l.find("li li")[v]).text(), p = p.substring(0, p.lastIndexOf("(")), h = t(l.find("li li")[v]).parent().parent().find("i").data("imgsrc"), h = h.substring(h.lastIndexOf("/") + 1), w = null, h == "nonSummary.png") w = "<i class='summNonsumImage vis vis-m-window'  data-imgsrc='Images/mWindow.png'><\/i>"; else if (h == "summary.png") w = "<i class='fa fa-folder-o summNonsumImage' data-imgsrc='Images/folder.png'><\/i>"; else if (h == "folder.png") { w = "<i class='fa fa-folder-o summNonsumImage' data-imgsrc='Images/folder.png'><\/i>"; continue } (h == "mWindow.png" && (w = "<i class='summNonsumImage vis vis-m-window' data-imgsrc='Images/mWindow.png'><\/i>"), o.val() == "" || !y.is(":checked") || p.contains(o.val())) && (gt = t('<input class="VIS-tm-checkbox" type="checkbox" />'), i.prepend(t('<li class="VIS-tm-topMLi">').append(gt).append(w).append(t("<li class='VIS-tm-MLi' data-id='" + vt + "'  id='" + vt + "' style='cursor:default'  >" + n.Utility.encodeText(p) + "<\/li>")))) } for (b = 0; b < l.find("li .vis-tm-textli").length; b++) { c = t(t(u.find("li"))).find("li[data-id='" + t(l.find(".vis-tm-textli")[b]).attr("data-id") + "']").parent().parent(); c.find("input").prop("disabled", "true"); c.find("input").prop("checked", !1); c.find("i").addClass("vis-tm-opacity"); c.find(".vis-tm-textli").addClass("vis-tm-opacity"); c.find("input").css("cursor", "not-allowed"); c.find("span").hasClass("VIS-Tm-glyphiconglyphicon-link") || c.find("span").addClass("VIS-Tm-glyphiconglyphicon-link"); nt.val() == "Unlinked" && c.remove(); var pt = t(t(u.find("li"))).find("li[data-id='" + t(l.find(".vis-tm-textli")[b]).attr("data-id") + "']").parent().parent().find("img").attr("src"), wt = t(t(u.find("li"))).find("li[data-id='" + t(l.find(".vis-tm-textli")[b]).attr("data-id") + "']").parent().parent().find("img"), k, h = pt; h != null && (h = h.substring(h.lastIndexOf("/") + 1), h == "mWindow.png" ? k = n.Application.contextUrl + "Areas/VIS/Images/nonSummary.png" : h == "folder.png" && (k = n.Application.contextUrl + "Areas/VIS/Images/summary.png"), wt.attr("src", k)); ht = !1 } for (bt = 0; bt < u.find(".vis-tm-menuselectedcolor").length; bt++)ht = !1; if (ht != !1 && l.find(".vis-tm-textli").length == 1) { var fi = t(t(u.find("li"))).find("li[data-id='" + l.find(".vis-tm-textli").attr("data-id") + "']"), pt = t(t(u.find("li"))).find("li[data-id='" + l.find(".vis-tm-textli").attr("data-id") + "']").parent().parent().find("img").attr("src"), wt = t(t(u.find("li"))).find("li[data-id='" + l.find(".vis-tm-textli").attr("data-id") + "']").parent().parent().find("img"), k, h = pt; h != null && (h = h.substring(h.lastIndexOf("/") + 1), h == "mWindow.png" ? k = n.Application.contextUrl + "Areas/VIS/Images/nonSummary.png" : h == "folder.png" && (k = n.Application.contextUrl + "Areas/VIS/Images/summary.png"), wt.attr("src", k)) } for (rt = [], d = 0; d < l.find(".vis-tm-textli").length; d++)(tt = null, ot = null, t(l.find(".vis-tm-textli")[d]).attr("checkSummary") == "checkSummary" ? (tt = "true", ot = "Areas/VIS/Images/folder.png") : (tt = "false", ot = "Areas/VIS/Images/mWindow.png"), it.is(":checked") && tt == "false") || (it.is(":checked") && tt == "true" && (yt.css("display", "inherit"), ct.css("display", "none")), it.is(":checked") || (yt.css("display", "inherit"), ct.css("display", "none")), ut = t(l.find(".vis-tm-textli")[d]).text(), ut = ut.substring(0, ut.lastIndexOf("(")), ni = r.data("kendoTreeView").append({ text: n.Utility.encodeText(ut), IsSummary: tt, getparentnode: ai.attr("data-nodeid"), TableName: ai.attr("data-tablename"), NodeID: t(l.find(".vis-tm-textli")[d]).attr("id"), TreeParentID: ai.attr("data-nodeid"), ParentID: ai.attr("data-nodeid"), ImageSource: ot }, ai), rt.push(ni)); if (ti = ai.parent().parent().parent(), rt && rt.length > 0) for (kt = rt.length - 1; kt >= 0; kt--)ls(ti); dt.removeClass("vis-tm-menuselectedcolor"); i.find("li").length > 0 && (ii.css("display", "none"), st[0].style.visibility = "hidden") } vs(); ir(); window.setTimeout(function () { o.val() != "" && ur(se) }, 200); uf(); er = !0; f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } })) } function sc() { w.on("change", ea); it.on("click", ha); yf.on("scroll", sa); u.on("click", ra); i.on("click", ia); o.on("keyup", ur); o.on("keypress", dl); tr.on("click", ta); o.on("input", function (n) { if ("" == this.value) { r.find("span").removeClass("VIS-TM-highlight"); ut = 1; et = 50; v = o.val(); h = y.is(":checked") ? "true" : "false"; var t = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); ki(t, e, ut, et, v, h, n) } }); gt.on("input", function () { "" == this.value && w.val() != "" && (u.empty(), window.setTimeout(function () { u.empty(); at = ""; vt = nt.val(); pi = 1; ar(e, bt, at, vt) }, 200)) }); no.on("click", bl); ge.on("click", ee); us.on("click", pl); gt.on("keyup", wl); c.on("resize", vl); c.find(".ui-resizable-e").css("right", "0px"); c.find(".ui-resizable-s").css("bottom", "0px"); ll(); d.on("click", cl); nt.on("change", al); s.mouseover(function () { s.addClass("selectchangecolor"); s.css("background-color", "#ff0000") }); s.mouseleave(function () { s.removeClass("selectchangecolor"); s.css("background-color", "#FFC0CB") }); lt.on("scroll", hl); window.setTimeout(function () { }, 200); y.is(":checked") && (ru = -1); y.on("click", function (n) { h = y.is(":checked") ? "true" : "false"; ur(n) }); g.on("click", fl); yt.on("click", ul); ct.on("click", rl); dt.on("click", gc); ft.on("click", ws); bi.on("click", bc); lr.on("click", wc); rs.on("click", pc); hr.mouseover(function () { hr.css({ cursor: "not-allowed" }) }); hr.mouseleave(function () { hr.css({ cursor: "default" }) }); pf.on("click", yc); vi.on("click", lc) } function hc() { var i, r, c, l, a, v, u, t, s; yi = []; i = "SELECT ad_table_id FROM ad_tree WHERE ad_tree_id=" + e; i = k(i, null, null); i.tables[0].rows.length > 0 && (i = i.tables[0].rows[0].cells.ad_table_id); r = "SELECT tablename FROM ad_table WHERE ad_table_id=" + i; r = k(r, null, null); r.tables[0].rows.length > 0 && (r = r.tables[0].rows[0].cells.tablename); ni = "true"; r == "AD_Menu" && (c = "SELECT count(*) FROM AD_Role WHERE ad_tree_menu_id=" + e, l = vf(c), l > 0 ? ni = "false" : (a = "SELECT count(*) FROM AD_ClientInfo WHERE ad_tree_menu_id=" + e, v = vf(a), v > 0 && (ni = "false"))); var f = k("SELECT ad_menu_id FROM AD_Menu WHERE ad_form_id IN (SELECT ad_form_id FROM ad_form WHERE name IN ('Tree Maintenance'))", null, null); if (f != null && f.tables[0].rows.length > 0) for (t = 0; t < f.tables[0].rows.length; t++)yi.push(f.tables[0].rows[t].cells.ad_menu_id); if (u = k("SELECT ad_menu_id FROM AD_Menu WHERE ad_window_id IN (SELECT ad_window_id FROM ad_window WHERE name IN ('Role','Tenant','Tree'))", null, null), u != null && u.tables[0].rows.length > 0) for (t = 0; t < u.tables[0].rows.length; t++)yi.push(u.tables[0].rows[t].cells.ad_menu_id); hi = yi; yi = yi.toString(); var y = "SELECT name FROM ad_menu WHERE ad_menu_id IN(" + yi + ") ORDER BY upper(name)", o = k(y, null, null), h = ""; if (o != null && o.tables[0].rows.length > 0) for (s = 0; s < o.tables[0].rows.length; s++)h += o.tables[0].rows[s].cells.name, h += ","; tu = h + " " + n.Msg.getMsg("MenuBinded"); st[0].style.visibility = "hidden" } function cc(n) { var i, t, r; kr(); i = "SELECT MAX(seqno) FROM " + di + " WHERE AD_Tree_ID=" + e; t = vf(i); t += 1; r = "update " + di + " set seqno=" + t + ",Updated=Sysdate,parent_ID=0 WHERE AD_Tree_ID=" + e + " AND node_id=" + n; fu(r, null, null) } function lc() { } function ac() { if (w.val() != "") { if (t(this).find("span").hasClass("vis-tm-delete")) return; n.ADialog.confirm("RemoveUnlinkedItem", !0, "", "Confirm", function (n) { if (n) { vc(); yt.css("display", "none"); ct.css("display", "inherit"); var t = w.find("option:selected").text(); ti.text(t); er = !1 } else return }) } } function vc() { f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/RemoveLinkedItemFromTree", type: "Post", data: { treeID: e, menuId: yi }, success: function (t) { var i = JSON.parse(t); i == "count" ? (u.empty(), at = gt.val(), vt = nt.val(), pi = 1, ar(e, bt, at, vt), window.setTimeout(function () { ee(); window.setTimeout(function () { er = !1; f[0].style.visibility = "hidden" }, 200) }, 200)) : i == "menubind" && (f[0].style.visibility = "hidden", n.ADialog.info("NeverDelete", !0, tu)) }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function yc() { if (w.val() != "") { var f = t('<ul class="vis-apanel-tm-ul"><\/ul>'), u = t("<div>"), i = t('<div style="padding:0 10px;min-width:150px">'), r = t('<span class="VIS-Tm-glyphiconglyphicon-link VIS-Tm-unlinkforbottmo vis vis-link"><\/span>'); gf = t('<p style="line-height:19px;cursor:pointer;">' + n.Msg.getMsg("RemoveLinkedItem") + "<\/p>").append(r); u.append(i); i.append(t('<div style="margin-top: 10px;" ><\/div>').append(vi).append(dh)); i.append(t('<div style="float: left;margin-bottom: 6px;margin-top: 5px;width:100%" ><\/div>').append(gf)); t(this).w2overlay(u); er == !0 ? r.removeClass("vis-tm-delete") : r.addClass("vis-tm-delete"); gf.on("click", ac) } } function uf(n) { if (r.find("span").hasClass("k-state-selected") && lt.find("ul").height() < lt.height()) { ut = 1; et = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; fr = !1; var t = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); ki(t, e, ut, et, v, h, n) } } function ne() { ft.prop("checked", !1) } function pc() { var i = vf("SELECT AD_Window_ID FROM AD_Window WHERE Name='Tree'"), t = new n.Query; t.addRestriction("AD_Tree_ID", n.Query.prototype.EQUAL, e); n.viewManager.startWindow(i, t) } function wc() { lr.css("display", "none"); gt.val(""); w.val() != "" && (u.empty(), window.setTimeout(function () { u.empty(); at = ""; vt = nt.val(); pi = 1; ar(e, bt, at, vt) }, 200)) } function bc(n) { o.val(""); o.focus(); bi.css("display", "none"); r.find("span").removeClass("VIS-TM-highlight"); ut = 1; et = 50; v = o.val(); h = y.is(":checked") ? "true" : "false"; fr = !0; var t = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); w.val() != "" && ki(t, e, ut, et, v, h, n) } function ws(n) { if (rr = n, ft.is(":checked")) { wi[0].style.visibility = "visible"; ye = !1; for (var i = 0; i < u.find("input").length; i++)t(u.find("input")[i]).attr("disabled") == "disabled" && t(u.find("input")[i]).parent().parent().removeClass("vis-tm-menuselectedcolor"), t(u.find("input")[i]).attr("disabled") != "disabled" && (t(u.find("input")[i]).prop("checked", !0), t(u.find("input")[i]).parent().parent().addClass("vis-tm-menuselectedcolor")); wi[0].style.visibility = "hidden" } else ye == !1 && (wi[0].style.visibility = "visible", u.find("input").prop("checked", !1), u.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"), wi[0].style.visibility = "hidden") } function kc(n) { t(n.target).hasClass("VIS-tm-MLi") && (t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(this).find("li").find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), g.prop("checked", !1)); t(n.target).hasClass(" summNonsumImage ") && (t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(this).find("li").find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), g.prop("checked", !1)); t(n.target).hasClass("VIS-tm-checkbox") && (t(n.target).parent().find("input").prop("checked") ? t(n.target).parent().addClass("vis-tm-menuselectedcolor") : (t(n.target).parent().removeClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"), g.prop("checked", !1))) } function dc(n) { v = ""; var i = t(n.currentTarget); i[0].scrollHeight - i.scrollTop() == i.outerHeight() && (te = !1, ie += 1, f[0].style.visibility = "visible", ds(pr, e, ie, oo, v, h, n)) } function gc(u) { var c, s; if (f[0].style.visibility = "visible", w.val() != "" && (o.prop("disabled", !1), tr.prop("disabled", !1)), sr = !1, ui == !1) { sr = !0; dt.addClass("vis-tm-delete"); f[0].style.visibility = "hidden"; return } if (r.find(".k-state-selected").length == 0) { f[0].style.visibility = "hidden"; sr = !0; return } if (w.val() == "") { f[0].style.visibility = "hidden"; sr = !0; return } nl(); te = !0; ie = 1; oo = 50; v = ""; h = "false"; c = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); f[0].style.visibility = "visible"; window.setTimeout(function () { ds(c, e, ie, oo, v, h, u) }, 200); pt.on("click", kc); ks.on("scroll", dc); s = new n.ChildDialog; s.setHeight(550); s.setWidth(450); s.setEnableResize(!1); s.setTitle(n.Msg.getMsg("SetOrder")); s.setModal(!0); s.setContent(bs); pt.empty(); s.show(); s.onClose = function () { iu = !0 }; s.onOkClick = function (u) { var s, f, p; if (re == !1) { re = !0; iu = !0; st[0].style.visibility = "visible"; s = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"); so = s; var c = r.find(".k-state-selected").find(".treechild").attr("data-nodeid"), l = [], a = ""; for (f = 0; f < pt.find("li li").length; f++)p = t(pt.find("li li")[f]).attr("data-id"), l.push(p); a = l.toString(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/UpdateItemSeqNo", type: "Post", data: { treeID: e, itemsid: a, ParentID: c }, success: function (n) { var t = JSON.parse(n); ee(); i.empty(); ut = 1; et = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; fr = !0; ki(c, e, ut, et, v, h, u); yt.css("display", "inherit"); ct.css("display", "none") }, error: function (n) { console.log(n); st[0].style.visibility = "hidden" } }) } v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; sr = !0 }; s.onCancelClick = function () { f[0].style.visibility = "hidden"; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; re = !0; sr = !0; iu = !1 } } function nl() { bs.append(ks.append(pt)) } function ds(i, r, u, e, o, s) { o == null && (o = ""); te == !0 && pt.empty(); nu(); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/FillSequenceDailog", type: "Post", data: { nodeID: i, treeID: r, pageNo: u, pageLength: e, searchChildNode: o, getTreeNodeChkValue: s }, success: function (i) { var r, o, s, e; f[0].style.visibility = "visible"; var u = JSON.parse(i), h = null, c = null; if (u.length > 0) for (r = 0; r < u.length; r++)fr == !1 && pt.find("li li").length > 0 && (o = pt.find('[data-id="' + u[r].parentID + '"]'), o && o.length > 0) || u[r].parentID != 0 && (s = t('<input class="VIS-tm-checkbox" type="checkbox" />'), u[r].issummary == "Y" ? (h = "<i class='fa fa-folder-o summNonsumImage' data-imgsrc='Images/folder.png'><\/i>", pt.append(t('<li class="VIS-tm-topMLi">').append(s).append(h).append(t("<li class='VIS-tm-MLi' data-NodePID='" + u[r].NodeParentID + "' data-id='" + u[r].parentID + "' data-issummary='" + u[r].issummary + "' id='" + u[r].parentID + "'   >" + n.Utility.encodeText(u[r].name) + "<\/li>")))) : (c = "<i class='vis vis-m-window summNonsumImage' data-imgsrc='Images/mWindow.png'><\/i>", e = t('<li class="VIS-tm-topMLi" >'), e.append(s), e.append(c), e.append(t("<li class='VIS-tm-MLi'  data-NodePID='" + u[r].NodeParentID + "'  data-id='" + u[r].parentID + "' data-issummary='" + u[r].issummary + "' id='" + u[r].parentID + "'   >" + n.Utility.encodeText(u[r].name) + "<\/li>")), pt.append(e))); il(); pt.sortable("refresh"); window.setTimeout(function () { f[0].style.visibility = "hidden" }, 500) }, error: function (n) { console.log(n); pt.empty(); f[0].style.visibility = "hidden" } }) } function il() { var n = null; pt.sortable({ cursorAt: { left: -10, top: -10 }, helper: function (i, r) { n = t("<li />"); r.hasClass("vis-tm-menuselectedcolor") || r.addClass("vis-tm-menuselectedcolor").siblings().removeClass("vis-tm-menuselectedcolor"); var u = r.parent().children(".vis-tm-menuselectedcolor").clone(); return gs = r.data("multidrag", u).siblings(".vis-tm-menuselectedcolor"), r.data("multidrag", u).siblings(".vis-tm-menuselectedcolor").hide(), tl = n.append(u), n.append(u) }, start: function (n, i) { re = !1; pt.find("input").prop("checked", !1); su = i.item.find("li").attr("id"); t(this).parent().parent().parent().css("overflow", "hidden") }, change: function () { }, update: function () { }, stop: function (n, t) { t.item.after(t.item.data("multidrag")).remove(); window.setTimeout(function () { gs.remove() }, 100); pt.find("input").prop("checked", !1); pt.find(".vis-tm-menuselectedcolor").find("input").prop("checked", !0) } }) } function rl() { w.val() != "" && r.find("li").length > 1 && (oi[0].style.visibility = "visible", window.setTimeout(function () { ct.css("display", "none"); yt.css("display", "inherit"); yt.css("float", "right"); b.data("kendoTreeView").expand(".k-item"); oi[0].style.visibility = "hidden" }, 150)) } function ul() { w.val() != "" && (oi[0].style.visibility = "visible", window.setTimeout(function () { ct.css("display", "inherit"); yt.css("display", "none"); ct.css("float", "right"); b.data("kendoTreeView").collapse(".k-item"); oi[0].style.visibility = "hidden" }, 150)) } function fl() { g.is(":checked") ? (i.find("input").prop("checked", !0), i.find("li").addClass("vis-tm-menuselectedcolor"), d.removeClass("vis-tm-delete"), i.find("input:checked").length == 0 && d.addClass("vis-tm-delete")) : (i.find("input").prop("checked", !1), i.find("li").removeClass("vis-tm-menuselectedcolor"), d.addClass("vis-tm-delete")) } function hl(n) { v = o.val(); var r = t(n.currentTarget); el = r[0].scrollHeight; ol = r.scrollTop(); sl = r.outerHeight(); r[0].scrollHeight - r.scrollTop() - 10 == r.outerHeight() - 10 && i.find("li").length > 0 && (ut += 1, fr = !1, st[0].style.visibility = "visible", ki(pr, e, ut, et, v, h, n), st[0].style.visibility = "hidden", i.find("li").length > 0 && (ii.css("display", "none"), st[0].style.visibility = "hidden")) } function cl() { wt = []; i.find("input:checked").length > 0 && n.ADialog.confirm("DoYouWantToUnlink", !0, "", "Confirm", function (r) { if (r) f[0].style.visibility = "visible", window.setTimeout(function () { for (var o = [], u, r = 0; r < i.find("input:checked").length; r++)(u = t(i.find("input:checked")[r]).parent().find("li").attr("data-id"), ni == "false" && t.inArray(parseInt(u), hi) >= 0) || (wt.push(u), o.push(parseInt(u))); bottomchildselectedID = wt; wt = wt.toString(); wt.length > 0 ? ff(e, wt) : (n.ADialog.info("NeverDelete", !0, tu), f[0].style.visibility = "hidden") }, 200); else { f[0].style.visibility = "hidden"; return } }); f[0].style.visibility = "hidden" } function ff(e, o) { var s, h, c, l; f[0].style.visibility = "visible"; s = "SELECT ad_table_id FROM ad_tree WHERE ad_tree_id=" + e; s = k(s, null, null); s.tables[0].rows.length > 0 && (s = s.tables[0].rows[0].cells.ad_table_id); h = " SELECT treetype FROM ad_tree WHERE ad_tree_id=" + e; h = k(h, null, null); treeType = h.tables[0].rows[0].cells.treetype; c = ""; c = treeType == "PR" ? "AD_TreeNodePR" : treeType == "BP" ? "AD_TreeNodeBP" : treeType == "MM" ? "AD_TreeNodeMM" : "AD_TreeNode"; rt = []; l = ""; i.find("input:checked").length > 0 && (o = o.toString(), ef(c, o, e)); i.find("input:checked").length == 0 && ef(c, o, e); t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromBottom", type: "Post", data: { nodeid: o, treeID: e, menuArray: yi }, success: function (e) { var et = JSON.parse(e), ut, b, c, h, v, a, k, tt, w, it; if (et == "") { for (g.prop("checked", !1), ut = !0, h = 0; h < i.find("input:checked").length; h++)if (ut = !1, ni != "false" || (w = t(i.find("input:checked").parent().find("li")[h]).attr("data-id"), !(t.inArray(parseInt(w), hi) >= 0))) { b = o.toString(); b = b.split(","); c = u.find("li").find("li[data-id='" + b[h] + "']").parent().parent(); c.find("input").prop("disabled", !1); c.find("i").removeClass("vis-tm-opacity"); c.find(".vis-tm-textli").removeClass("vis-tm-opacity"); c.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); c.find("input").css("cursor", "pointer"); c.hasClass("vis-tm-menuselectedcolor") && (ht.empty(), c.find("input").prop("checked", !0)); nt.val() == "Linked" && c.remove(); var ft = t(i.find("input:checked").parent().find(".VIS-tm-MLi")[h]).attr("data-id"), p = t(t(u.find("li"))).find("li[data-id='" + ft + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + ft + "']").parent().parent().find("img"), l, s = p; if (s != null) if (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png") l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png", y.attr("src", l); else if (s == "summary.png") for (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png", y.attr("src", l), ch(ft), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + bottomchildselectedID[h] + "']").parent().parent().parent()), h = 0; h < rt.length; h++) { v = rt[h]; r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + v + "']").parent().parent().parent()); t(i.find("input:checked")[h]).parent().remove(); a = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent(); a.find("input").prop("disabled", !1); a.removeClass("vis-tm-menuselectedcolor"); a.find("i").removeClass("vis-tm-opacity"); a.find(".vis-tm-textli").removeClass("vis-tm-opacity"); a.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); a.find("input").css("cursor", "pointer"); var p = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img"), l, s = p; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "mWindow.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "folder.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png")); y.attr("src", l) } } if (ut == !0 && i.find("input:checked").length == 0) { c = u.find("li").find("li[data-id='" + rt + "']").parent().parent(); c.find("input").prop("disabled", !1); c.find("i").removeClass("vis-tm-opacity"); c.find(".vis-tm-textli").removeClass("vis-tm-opacity"); c.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); c.find("input").css("cursor", "pointer"); c.hasClass("vis-tm-menuselectedcolor") && (ht.empty(), c.find("input").prop("checked", !0)); nt.val() == "Linked" && c.remove(); var p = t(t(u.find("li"))).find("li[data-id='" + rt + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + rt + "']").parent().parent().find("img"), l, s = p; if (s != null) if (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png") l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png", y.attr("src", l); else if (s == "summary.png") for (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png", y.attr("src", l), ch(rt), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + rt + "']").parent().parent().parent()), h = 0; h < rt.length; h++) { v = rt[h]; r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + v + "']").parent().parent().parent()); t(i.find("input:checked")[h]).parent().remove(); a = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent(); a.find("input").prop("disabled", !1); a.removeClass("vis-tm-menuselectedcolor"); a.find("i").removeClass("vis-tm-opacity"); a.find(".vis-tm-textli").removeClass("vis-tm-opacity"); a.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); a.find("input").css("cursor", "pointer"); var p = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img").attr("src"), y = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img"), l, s = p; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "mWindow.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "folder.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png")); y.attr("src", l) } i.find("li").find("li[data-id='" + rt + "']").parent().remove(); r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + rt + "']").parent().parent().parent()) } for (d.addClass("vis-tm-delete"), k = [], tt = 0; tt < i.find("input:checked").length; tt++)(w = t(i.find("input:checked").parent().find("li")[tt]).attr("data-id"), ni == "false" && t.inArray(parseInt(w), hi) >= 0) || k.push(w); for (it = 0; it < k.length; it++)i.find("li").find("li[data-id='" + k[it] + "']").parent().remove(); i.find("input:checked").length > 0 && n.ADialog.info("NeverDelete"); uf() } ir(); ne(); ou(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }); ir() } function ir() { i.find("input").length == 0 ? (g.prop("disabled", !0), g.css("cursor", "not-allowed"), g.prop("checked", !1), d.addClass("vis-tm-delete"), dt.addClass("vis-tm-delete"), ui = !1) : (dt.removeClass("vis-tm-delete"), ui = !0, g.prop("disabled", !1), g.css("cursor", "pointer")) } function ll() { var i = "" + n.Msg.getMsg("All") + "", r = "" + n.Msg.getMsg("Linked") + "", u = "" + n.Msg.getMsg("UnLinked") + ""; nt.append(t("<Option value='All'>" + i + "<\/option>")); nt.append(t("<Option value='Linked'>" + r + "<\/option>")); nt.append(t("<Option value='Unlinked'>" + u + "<\/option>")) } function al() { w.val() != "" && (ht.empty(), u.empty(), vt = nt.val(), window.setTimeout(function () { nt.prop("disabled", !0); nr.css("display", "inherit"); lf = !1; vt = nt.val(); at = gt.val(); pi = 1; ar(e, bt, at, vt) }, 200)) } function vl(n, t) { var i = t.size.height; c.css("height", i); c.css("overflow-x", "none"); c.css("width", "100%"); window.setTimeout(function () { lt.height(ri.height() - (c.height() + br.height() + 45)) }, 200); tt.css("overflow", "hidden"); tt.height(ri.height() - c.height()); a.height(tt.height() - 10); kt.height(i - 10); c.addClass("VIS-TM-resizediv"); kt.addClass("VIS-TM-resizediv") } function th() { ue = t("<div>"); nh = t('<input style="margin-right: 10px;" type="checkbox"/>'); var r = t("<span>" + n.Msg.getMsg("WantToUnlinked") + "<span/>"), i = t('<span style="font-size: 16px;">' + n.Msg.getMsg("UnlinkedWithChild") + "<span/>"); ue.append(t('<div style="padding: 10px;">').append(i)) } function yl(i) { rr = i; kr(); var u = "Select node_id from " + di + " where parent_id=" + au + " AND isactive='Y' and ad_tree_id=" + e + "", r = k(u, null, null); if (r != null && r.tables[0].rows.length == 0) { if (wu = !0, s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), ot.css("display", "none"), ni == "false") { if (t.inArray(parseInt(pu), hi) >= 0) { n.ADialog.info("NeverDelete", !0, tu); return } ho(e, pu, af, wu) } else ho(e, pu, af, wu); return } f[0].style.visibility = "hidden"; th(); n.ADialog.confirm("ChildAlsoWillbeRemove", !0, "", "Confirm", function (n) { n ? (wu = !0, ho(e, pu, af, wu), s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), ot.css("display", "none")) : (s.removeClass("VIS-TM-ondragdrop"), s.css("display", "none"), ot.css("display", "none")) }) } function ho(e, o, s, h) { var c, l, v, a, y; o != 0 ? (ih = !1, f[0].style.visibility = "visible", c = "SELECT ad_table_id FROM ad_tree WHERE ad_tree_id=" + e, c = k(c, null, null), c.tables[0].rows.length > 0 && (c = c.tables[0].rows[0].cells.ad_table_id), l = "SELECT tablename FROM ad_table WHERE ad_table_id=" + c, l = k(l, null, null), l.tables[0].rows.length > 0 && (l = l.tables[0].rows[0].cells.tablename), v = " SELECT treetype FROM ad_tree WHERE ad_tree_id=" + e, v = k(v, null, null), treeType = v.tables[0].rows[0].cells.treetype, a = "", a = treeType == "PR" ? "AD_TreeNodePR" : treeType == "BP" ? "AD_TreeNodeBP" : treeType == "MM" ? "AD_TreeNodeMM" : "AD_TreeNode", wt = o.toString(), ef(a, wt, e), y = "select parent_ID  from " + a + " WHERE NODE_ID=" + o + " AND AD_Tree_ID=" + e + " AND IsActive='Y'", y = k(y, null, null), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromTree", type: "Post", data: { nodeid: o, treeID: e, unlinkchild: h, menuArray: yi }, success: function (e) { var k = JSON.parse(e), p, v, s, tt, d; if (k == "") { i.find("input:checked").length == 0 && g.prop("checked", !1); ah = k; i.find("li").find("li[data-id='" + o + "']").parent().remove(); s = u.find("li").find("li[data-id='" + o + "']").parent().parent(); s.find("input").prop("disabled", !1); s.find("i").removeClass("vis-tm-opacity"); s.find(".vis-tm-textli").removeClass("vis-tm-opacity"); s.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); s.find("input").css("cursor", "pointer"); s.hasClass("vis-tm-menuselectedcolor") && (ht.empty(), s.find("input").prop("checked", !0)); var w = t(t(u.find("li"))).find("li[data-id='" + o + "']").parent().parent().find("img").attr("src"), b = t(t(u.find("li"))).find("li[data-id='" + o + "']").parent().parent().find("img"), l, c = w; if (c != null && (c = c.substring(c.lastIndexOf("/") + 1), c == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : c == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), b.attr("src", l)), rh = a, h == !0) for (ni == "false" && uh(), r.data("kendoTreeView").remove(ss), p = 0; p < rt.length; p++)if (v = rt[p], i.find("li").find("li[data-id='" + v + "']").parent().remove(), ni != "false" || !(t.inArray(parseInt(v), hi) >= 0)) { s = u.find("li").find("li[data-id='" + v + "']").parent().parent(); s.find("input").prop("disabled", !1); s.find("i").removeClass("vis-tm-opacity"); s.find(".vis-tm-textli").removeClass("vis-tm-opacity"); s.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); s.find("input").css("cursor", "pointer"); s.hasClass("vis-tm-menuselectedcolor") && (s.find("input").prop("checked", !0), ht.empty()); nt.val() == "Linked" && s.remove(); var w = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img").attr("src"), b = t(t(u.find("li"))).find("li[data-id='" + v + "']").parent().parent().find("img"), l, c = w; c != null && (c = c.substring(c.lastIndexOf("/") + 1), c == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : c == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), b.attr("src", l)) } h == !1 && (tt = null, d = y.tables[0].rows[0].cells.parent_id, ai = r.find("div").find("div[data-nodeid='" + d + "']")); uf() } wo.find("span").hasClass("k-state-selected") && ti.text(n.Msg.getMsg("SelectTree")); ir(); ne(); ou(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } })) : n.ADialog.info("VIS_SelectTreeNode") } function uh() { for (var u = [], s, i, f, h, e = 0; e < fe.length; e++)s = fe[e], u.push(parseInt(s)); for (i = 0; i < u.length; i++)t.inArray(u[i], hi) >= 0 && (cc(u[i]), f = r.find("div").find("div[data-nodeid='" + u[i] + "']").parent().parent().parent(), r.find("div").find("div[data-nodeid='" + u[i] + "']").parent().parent().parent().remove(), it.is(":checked") || (h = r.data("kendoTreeView").append({ text: n.Utility.encodeText(f.text()), IsSummary: f.find(".treechild").attr("data-issummary"), getparentnode: 0, TableName: f.find(".treechild").attr("data-tablename"), NodeID: f.find(".treechild").attr("data-nodeid"), TreeParentID: f.find(".treechild").attr("data-nodeid"), ParentID: 0, ImageSource: "Areas/VIS/Images/mWindow.png" }, t(t(r.find(".treechild")[0]))))); o.val() != "" && window.setTimeout(function () { ur(se) }, 200) } function ef(i, r, u) { f[0].style.visibility = "visible"; t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/SelectAllChildNodes", type: "Post", async: !1, data: { TableName: i, treeID: u, nodeID: r }, success: function (n) { f[0].style.visibility = "visible"; var t = JSON.parse(n); rt = []; t != null && (rt = t.split(","), fe = rt) }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) } function pl() { w.val() != "" && (u.empty(), at = gt.val(), vt = nt.val(), pi = 1, ar(e, bt, at, vt)) } function wl(n) { n.which != 13 && n.which != 8 && n.which != 46 && lr.css("display", "inherit"); (n.which == 8 || n.which == 46) && gt.val() == "" && lr.css("display", "none"); n.which == 13 && w.val() != "" && (u.empty(), at = gt.val(), vt = nt.val(), pi = 1, ar(e, bt, at, vt)) } function bl(t) { w.val() != "" && nr.css("display", "inherit"); rr = t; w.empty(); es(); iu = !1; ee(); dt.addClass("vis-tm-delete"); yt.css("display", "none"); ct.css("display", "inherit"); ct.css("float", "right"); ti.text(n.Msg.getMsg("SelectTree")); ir() } function ee() { i.empty(); ps = !1; w.val() != "" && (it.is(":checked") ? (fi = !0, ei != null && nf(bt, e, vr, fi)) : (fi = !1, ei != null && nf(bt, e, vr, fi))); tt.css("overflow", "hidden") } function dl(n) { if (df = !0, n.which == 13) { if (o.val() != "" && it.is(":checked") && (o.prop("disabled", !0), tr.prop("disabled", !0)), h == "true" && r.find(".k-state-selected").length == 1) { ut = 1; et = 50; h = y.is(":checked") ? "true" : "false"; var u = r.find(".k-state-selected").find("div").attr("data-nodeid"); v = o.val(); i.empty(); ki(u, e, ut, et, v, h, n) } o.val() != "" && w.val() != "" && (d.removeClass("vis-tm-delete"), f[0].style.visibility = "visible", b.find("span.k-in").find(".treechild").find("p").each(function () { var r = t(this).text().toUpperCase(), i; if (r == o.val().toUpperCase()) { n.preventDefault(); i = t(this).parent().parent().parent().parent().parent().attr("class"); b.data("kendoTreeView").expand("." + i); b.find("span").removeClass("k-state-selected"); t(this).parent().parent().parent().addClass("k-state-selected"); this.parentNode.parentNode.parentNode.scrollIntoView(); f[0].style.visibility = "hidden"; return } }), sh(n), d.addClass("vis-tm-delete"), f[0].style.visibility = "hidden") } else ru = -1 } function sh(n) { if (it.is(":checked") && (o.prop("disabled", !0), tr.prop("disabled", !0)), fh = of, eh = o.val(), oe = hh(fh, eh, ru), oe > -1) { var t = sf[oe]; currentNode = t; ru = oe; gl(t, n) } else oh = !1, o.val() != "" && (o.prop("disabled", !1), tr.prop("disabled", !1)) } function hh(n, t, i) { for (var r = i + 1; r < n.length; r++)if (r != -1 && n[r].trim().toLowerCase().contains(t.trim().toLowerCase())) return r; return i > -1 ? (i = -1, hh(n, t, i)) : -1 } function gl(n, t) { return n != -1 ? (currentNode = n, na(n, !0, t)) : (currentNode = 0, !1) } function na(n, u, f) { y.is(":checked") ? (i.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"), lt.find("li").find("li[id='" + n + "']").parent().find("input").prop("checked", !0), lt.find("li").find("li[id='" + n + "']").parent().addClass("vis-tm-menuselectedcolor"), lt.find("li").find("li[id='" + n + "']").parent().hasClass("vis-tm-menuselectedcolor") && (lt.find("li").find("li[id='" + n + "']").parent()[0].scrollIntoView(), lt.height(tt.height() - (br.height() + 50)))) : df == !0 && (r.find(".k-state-selected").removeClass("k-state-selected"), t(r.find("div").find("div[data-nodeid='" + n + "']").parent()).addClass("k-state-selected"), t(r.find("div").find("div[data-nodeid='" + n + "']").parent()).hasClass("k-state-selected") && (t(r.find("div").find("div[data-nodeid='" + n + "']").parent()).addClass("k-state-selected")[0].scrollIntoView(), lu()), window.setTimeout(function () { ut = 1; et = 50; v = y.is(":checked") ? o.val() : ""; h = y.is(":checked") ? "true" : "false"; var t = r.find("div").find("div[data-nodeid='" + n + "']").parent().text(); ti.text(t); i.empty(); ki(n, e, ut, et, v, h, f) }, 400)) } function ta(n) { if (o.val() != "" && (o.prop("disabled", !0), tr.prop("disabled", !0)), h == "true" && r.find(".k-state-selected").length == 1) { ut = 1; et = 50; h = y.is(":checked") ? "true" : "false"; var u = r.find(".k-state-selected").find("div").attr("data-nodeid"); v = o.val(); i.empty(); ki(u, e, ut, et, v, h, n) } o.val() != "" && (f[0].style.visibility = "visible", b.find("span.k-in").find(".treechild").find("p").each(function () { var r = t(this).text().toUpperCase(), i; r == o.val().toUpperCase() && (n.preventDefault(), i = t(this).parent().parent().parent().parent().parent().attr("class"), b.data("kendoTreeView").expand("." + i), b.find("span").removeClass("k-state-selected"), t(this).parent().parent().parent().addClass("k-state-selected"), this.parentNode.parentNode.parentNode.scrollIntoView()) }), sh(n), f[0].style.visibility = "hidden") } function ur(u) { var f, e; if (w.val() != "" && (bi.css("display", "inherit"), co == !0 && (co = !1, se = u)), w.val() == "") return !1; if (t(o).val() == "" || !wf) { t(o).val() == "" && (i.find("span").removeClass("VIS-TM-highlight"), r.find("span").removeClass("VIS-TM-highlight"), bi.css("display", "none"), df = !0, co = !0); wf = !0; return } if (u != undefined && u.which != 13) if (f = o.val().toUpperCase(), e = f.length, y.is(":checked")) ru = -1, sf = [], of = [], r.find("span").removeClass("VIS-TM-highlight"), i.find("li li").each(function (r, u) { var c = t(u), s = n.Utility.decodeText(t(this).text()), h, o; if (sf.push(c.attr("id")), of.push(s), h = "", o = 0, f == "") s.toUpperCase().indexOf(f, o) == 0 && (t(this).find("span").removeClass("VIS-TM-highlight"), i.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"), d.addClass("vis-tm-delete"), i.find("input").prop("checked", !1)); else { while ((p = s.toUpperCase().indexOf(f, o)) >= 0) h += s.substring(o, p) + '<span class="VIS-TM-highlight">' + s.substr(p, e) + "<\/span>", o = p + e; s.toUpperCase().indexOf(f, o) == -1 && t(this).find("span").removeClass("VIS-TM-highlight"); o > 0 && (h += s.substring(o)) } }); else { if (sf = [], of = [], i.find("li").find("span").removeClass("VIS-TM-highlight"), b.data("kendoTreeView").expand(".k-item"), ct.css("display", "none"), yt.css("display", "inherit"), t(o).val() == "" && b.find("span").removeClass("VIS-TM-highlight"), t("span.k-in > span.highlight").each(function () { t(this).parent().text(t(this).parent().text()) }), t.trim(o.val()) == "") return; f = o.val().toUpperCase(); e = f.length; b.find("span.k-in").each(function (i, r) { var h = t(r), o = n.Utility.decodeText(t(this).text()), s, u; for (sf.push(h.find(".treechild").attr("data-nodeid")), of.push(o), s = "", u = 0; (p = o.toUpperCase().indexOf(f, u)) >= 0;)s += o.substring(u, p) + '<span class="VIS-TM-highlight">' + o.substr(p, e) + "<\/span>", u = p + e; o.toUpperCase().indexOf(f, u) == -1 && t(this).find("span").removeClass("VIS-TM-highlight"); u > 0 && (s += o.substring(u), t(this).find("p").html(s)) }) } } function lu() { r.find(".k-state-hover").removeClass("k-state-hover"); r.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode"); r.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode") } function ia(n) { var r, u; t(n.target).hasClass("summNonsumImage") && (t(n.target).parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(n.target).parent().parent().find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), d.removeClass("vis-tm-delete"), r = i.find("input").length, u = i.find("input:checked").length, r == u && g.prop("checked", !0)); t(n.target).hasClass("VIS-tm-MLi") && (t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(this).find("li").find("input").prop("checked", !1), t(n.target).parent().addClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("input").prop("checked", !0), d.removeClass("vis-tm-delete"), g.prop("checked", !1), r = i.find("input").length, u = i.find("input:checked").length, r == u && g.prop("checked", !0)); t(n.target).hasClass("VIS-tm-checkbox") && (t(n.target).parent().find("input").prop("checked") ? (t(n.target).parent().addClass("vis-tm-menuselectedcolor"), d.removeClass("vis-tm-delete"), r = i.find("input").length, u = i.find("input:checked").length, r == u && g.prop("checked", !0)) : (t(n.target).parent().removeClass("vis-tm-menuselectedcolor"), t(n.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"), g.prop("checked", !1), i.find("input:checked").length > 0 ? d.removeClass("vis-tm-delete") : d.addClass("vis-tm-delete"))) } function he(n) { rr = n; var t = u.find("input:checked").length, i = u.find("[disabled]").length, r = u.find("input").length, f = r - i; t == f ? n != "disabled" && ft.prop("checked", !0) : ft.prop("checked", !1) } function cf() { } function ra(s) { var p, l, a, c; if (rr = s, p = u, f[0].style.visibility = "visible", u.find("input:checked").length > 1 && ht.empty(), t(s.target).hasClass("VIS-Tm-glyphiconglyphicon-link")) { wt = []; l = t(s.target).parent(); a = t(s.target).parent().attr("id"); wt.push(a); wt = wt.toString(); window.setTimeout(function () { rr = s }, 200); ni == "false" ? t.inArray(parseInt(a), hi) < 0 ? lh(e, wt, l) : (n.ADialog.info("NeverDelete", !0, tu), f[0].style.visibility = "hidden") : lh(e, wt, l); return } if (t(s.target).hasClass("vis-tm-textli") && (t(this).find("input").prop("checked", !1), t(this).find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"), t(t(s.target).parent().parent()).find("input").prop("checked", !0), ci = t(t(s.target).parent().parent()).find("img").attr("src"), s.target.id = t(s.target).attr("id"), t(s.target).parent().parent().find("input").attr("disabled") == "disabled" && t(t(s.target).parent().parent()).find("input").prop("checked", !1), ft.prop("checked", !1), he(t(s.target).parent().parent().find("input").attr("disabled")), ku && cf(t(s.target).parent().parent())), t(s.target).hasClass("vis-tm-upperLi") && (t(s.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).addClass("vis-tm-menuselectedcolor"), t(s.target).parent().find("input").prop("checked", !1), t(s.target).find("input").prop("checked", !0), ci = t(s.target).find("img").attr("src"), s.target.id = t(s.target).find(".vis-tm-textli").attr("id"), t(s.target).find("input").attr("disabled") == "disabled" && t(s.target).find("input").prop("checked", !1), ft.prop("checked", !1), he(t(s.target).find("input").attr("disabled")), ku && cf(t(s.target))), t(s.target).hasClass("vis-tm-upperdivchkandimg") && (t(s.target).parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).parent().addClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().find("input").prop("checked", !1), t(s.target).find("input").prop("checked", !0), ci = t(s.target).find("img").attr("src"), s.target.id = t(s.target).parent().find(".vis-tm-textli").attr("id"), t(s.target).find("input").attr("disabled") == "disabled" && t(s.target).find("input").prop("checked", !1), ft.prop("checked", !1), he(t(s.target).find("input").attr("disabled")), ku && cf(t(s.target).parent().parent())), t(s.target).hasClass("vis-tm-chkbox")) { if (f[0].style.visibility = "visible", t(s.target).attr("disabled") != "disabled") if (t(s.target).prop("checked")) { for (t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"), s.target.id = s.target.id = t(s.target).parent().parent().find(".vis-tm-textli").attr("id"), ci = t(s.target).parent().parent().find("img").attr("src"), c = 0; c < u.find(".vis-tm-menuselectedcolor").length; c++)t(u.find(".vis-tm-menuselectedcolor").find("input")[c]).attr("disabled") == "disabled" && t(u.find(".vis-tm-menuselectedcolor").find("input")[c]).parent().parent().removeClass("vis-tm-menuselectedcolor"); var w = u.find("input:checked").length, d = u.find("[disabled]").length, nt = u.find("input").length, tt = nt - d; w == tt ? ft.prop("checked", !0) : ft.prop("checked", !1) } else t(s.target).parent().parent().removeClass("vis-tm-menuselectedcolor"), ci = t(s.target).parent().parent().find("img").attr("src"), s.target.id = 0, ft.prop("checked", !1); f[0].style.visibility = "hidden"; ku && cf(t(s.target).parent().parent()) } t(s.target).hasClass("summNonsumImage") && (t(s.target).parent().parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"), t(s.target).parent().parent().parent().find("input").prop("checked", !1), t(s.target).parent().find("input").prop("checked", !0), ci = t(s.target).parent().find("img").attr("src"), s.target.id = t(s.target).parent().parent().find(".vis-tm-textli").attr("id"), t(s.target).parent().find("input").attr("disabled") == "disabled" && t(s.target).parent().find("input").prop("checked", !1), ft.prop("checked", !1), he(t(s.target).parent().find("input").attr("disabled")), ku && cf(t(s.target).parent())); (s.target.id == "" || s.target.id == "undefined") && (s.target.id = t(s.target).find(".vis-tm-menuselectedcolor").find("li").attr("id")); u.find(".vis-tm-menuselectedcolor").length == 1 && u.find(".vis-tm-menuselectedcolor").find("li").hasClass("vis-tm-opacity") && s.target.id != "" ? t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/GetNodePath", type: "Post", data: { node_ID: s.target.id, treeID: e }, success: function (c) { var d, rt, p, w, tt, nt, l, a; ft.prop("checked", !1); d = JSON.parse(c); d = d.replaceAll("\\\\", " \\ "); ht.empty(); ht.append(n.Utility.encodeText(d)); vi.is(":checked") && (g.prop("checked", !1), rt = t(s.target).parent().parent().find("li").attr("id"), p = t(s.target).parent().parent().find("img").attr("src"), p = p.substring(p.lastIndexOf("/") + 1), p == "summary.png" && (w = t(s.target).text(), w = w.substring(0, w.lastIndexOf("(")), ti.text(w), hf = -1), ci.lastIndexOf("/"), ci = ci.substring(ci.lastIndexOf("/") + 1), ci != "mWindow.png" && ci != "folder.png" && (it.is(":checked") ? vi.is(":checked") && (f[0].style.visibility = "visible", ci != "nonSummary.png" ? b.data("kendoTreeView").expand(".k-item") : (kr(), tt = "Select parent_id from " + di + " where node_id=" + s.target.id + " AND isactive='Y' and ad_tree_id=" + e + "", nt = k(tt, null, null), nt != null && nt.tables[0].rows.length > 0 && (l = nt.tables[0].rows[0].cells.parent_id, l == null && (l = 0), hf != l && (b.data("kendoTreeView").expand(".k-item"), window.setTimeout(function () { t(r.find(".k-state-selected")).removeClass("k-state-selected"); t(r.find("div").find("div[data-nodeid='" + l + "']").parent()).addClass("k-state-selected")[0].scrollIntoView(); var n = t(r.find(".k-state-selected")).text(); ti.text(n); hf = l; lu() }, 200), i.empty(), ut = 1, et = 50, v = o.val(), h = y.is(":checked") ? "true" : "false", ki(l, e, ut, et, v, h, s), hf = l))), f[0].style.visibility = "hidden") : b.data("kendoTreeView").expand(".k-item")), t(r.find("div").find("div[data-nodeid='" + s.target.id + "']").parent()).addClass("k-state-selected").length != 0 ? (t(r.find(".k-state-selected")).removeClass("k-state-selected"), t(r.find(".k-state-focused")).removeClass("k-state-focused"), window.setTimeout(function () { t(r.find("div").find("div[data-nodeid='" + s.target.id + "']").parent()).addClass("k-state-selected")[0].scrollIntoView(); lu() }, 200), i.empty(), ut = 1, et = 50, v = o.val(), h = y.is(":checked") ? "true" : "false", ki(s.target.id, e, ut, et, v, h, s)) : u.find(".vis-tm-menuselectedcolor").length == 1 && (a = u.find(".vis-tm-menuselectedcolor").find("img").attr("src"), a = a.substring(a.lastIndexOf("/") + 1), a != "nonSummary.png" && a != "summary.png" && ht.empty())); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }) : ht.empty(); f[0].style.visibility = "hidden" } function ch(n) { var i = r.find("div").find("div[data-nodeid='" + n + "']").parent().parent().parent(); i.children("ul").length > 0 && (bu = t(t(i.children("ul")[0]).find("ul")[0]).length > 0 ? t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).length > 0 ? t(t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).length > 0 ? t(t(t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).length > 0 ? !0 : !1 : !1 : !1 : !1) } function lh(e, o) { var s, c, h, a, l; f[0].style.visibility = "visible"; s = "SELECT ad_table_id FROM ad_tree WHERE ad_tree_id=" + e; s = k(s, null, null); s.tables[0].rows.length > 0 && (s = s.tables[0].rows[0].cells.ad_table_id); c = " SELECT treetype FROM ad_tree WHERE ad_tree_id=" + e; c = k(c, null, null); treeType = c.tables[0].rows[0].cells.treetype; h = ""; h = treeType == "PR" ? "AD_TreeNodePR" : treeType == "BP" ? "AD_TreeNodeBP" : treeType == "MM" ? "AD_TreeNodeMM" : "AD_TreeNode"; a = "Select node_id from " + h + " where parent_id=" + o + " AND isactive='Y' and ad_tree_id=" + e + ""; l = k(a, null, null); l != null && l.tables[0].rows.length > 0 ? n.ADialog.confirm("ChildAlsoWillbeRemove", !0, "", "Confirm", function (s) { if (s) o = o.toString(), ef(h, o, e), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromBottom", type: "Post", data: { nodeid: o, treeID: e, menuArray: yi }, success: function (e) { var w = JSON.parse(e), c, v, a, h; if (w == "") { for (i.find("input:checked").length == 0 && g.prop("checked", !1), ht.empty(), c = u.find("li").find("li[data-id='" + o + "']").parent().parent(), c.find("input").prop("disabled", !1), c.find("i").removeClass("vis-tm-opacity"), c.find(".vis-tm-textli").removeClass("vis-tm-opacity"), c.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"), c.find("input").css("cursor", "pointer"), c.hasClass("vis-tm-menuselectedcolor") && (ht.empty(), c.find("input").prop("checked", !0)), ni == "false" && uh(), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + o + "']").parent().parent().parent()), i.find("li").find("li[data-id='" + o + "']").parent().remove(), v = 0; v < rt.length; v++)if (a = rt[v], i.find("li").find("li[data-id='" + a + "']").parent().remove(), ni != "false" || !(t.inArray(parseInt(a), hi) >= 0)) { h = u.find("li").find("li[data-id='" + a + "']").parent().parent(); h.find("input").prop("disabled", !1); h.find("i").removeClass("vis-tm-opacity"); h.find(".vis-tm-textli").removeClass("vis-tm-opacity"); h.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"); h.find("input").css("cursor", "pointer"); h.hasClass("vis-tm-menuselectedcolor") && (ht.empty(), h.find("input").prop("checked", !0)); nt.val() == "Linked" && h.remove(); var y = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), p.attr("src", l)) } var y = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "folder.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/folder.png" : s == "mWindow.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png"), p.attr("src", l)); i.find("li").length != 0 || r.find("span").hasClass("k-state-selected") || ti.text(n.Msg.getMsg("SelectTree")); uf() } ir(); ne(); ou(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } }); else { f[0].style.visibility = "hidden"; return } }) : (o = o.toString(), ef(h, o, e), t.ajax({ url: n.Application.contextUrl + "TreeMaintenance/DeleteNodeFromBottom", type: "Post", data: { nodeid: o, treeID: e, menuArray: yi }, success: function (e) { var w = JSON.parse(e), h, v, a, c; if (w == "") { for (ht.empty(), h = u.find("li").find("li[data-id='" + o + "']").parent().parent(), h.find("input").prop("disabled", !1), h.find("i").removeClass("vis-tm-opacity"), h.find(".vis-tm-textli").removeClass("vis-tm-opacity"), h.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"), h.find("input").css("cursor", "pointer"), r.data("kendoTreeView").remove(r.find("div").find("div[data-nodeid='" + o + "']").parent().parent().parent()), i.find("li").find("li[data-id='" + o + "']").parent().remove(), v = 0; v < rt.length; v++)if (a = rt[v], ni != "false" || !(t.inArray(parseInt(a), hi) >= 0)) { c = u.find("li").find("li[data-id='" + a + "']").parent().parent(); c.find("input").prop("disabled", !1); c.find("i").removeClass("vis-tm-opacity"); c.find(".vis-tm-textli").removeClass("vis-tm-opacity"); c.removeClass("vis-tm-menuselectedcolor"); nt.val() == "Linked" && c.remove(); var y = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + a + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), p.attr("src", l)) } var y = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img").attr("src"), p = u.find("li").find("li[data-id='" + o + "']").parent().parent().find("img"), l, s = y; s != null && (s = s.substring(s.lastIndexOf("/") + 1), s == "nonSummary.png" ? l = n.Application.contextUrl + "Areas/VIS/Images/mWindow.png" : s == "summary.png" && (l = n.Application.contextUrl + "Areas/VIS/Images/folder.png"), p.attr("src", l)); uf() } i.find("li").length != 0 || r.find("span").hasClass("k-state-selected") || ti.text(n.Msg.getMsg("SelectTree")); ir(); ne(); ou(); f[0].style.visibility = "hidden" }, error: function (n) { console.log(n); f[0].style.visibility = "hidden" } })) } function fa() { kr(); var n = "SELECT Count(*) as Count FROM " + di + " WHERE isactive ='Y' AND AD_Tree_ID=" + e; n = k(n, null, null); n = n.tables[0].rows[0].cells.count; n > 5e3 ? (it.prop("checked", !0), it.prop("disabled", !0), st[0].style.visibility = "hidden", fi = !0, lo = !0, wr.css("display", "inherit"), tt.css("display", "inherit"), c.css("height", "70%"), kt.css("height", "100%"), c.resizable({ handles: "n,s,se" }), c.find(".ui-resizable-e").css("right", "0px"), c.find(".ui-resizable-s").css("bottom", "0px"), kt.addClass("VIS-TM-resizediv"), tt.height(ri.height() - c.height() - 20), bi.css("right", "145px")) : (it.prop("disabled", !1), lo = !1) } function ea() { if (ps = !1, bf = !0, iu = !1, kf = !1, w.val() != "") { oi[0].style.visibility = "visible"; pf.removeClass("vis-tm-opacity"); it.prop("disabled", !1); nr.css("display", "inherit"); nt.prop("disabled", !0); vi.prop("disabled", !1); vi.css("cursor", "pointer"); y.prop("disabled", !1); y.css("cursor", "pointer"); o.prop("disabled", !1); gt.prop("disabled", !1); ft.prop("disabled", !1); ft.css("cursor", "pointer"); dt.addClass("vis-tm-delete"); yt.css("display", "none"); ct.css("display", "inherit"); d.addClass("vis-tm-delete"); fr = !0; lf = !0; u.empty(); i.empty(); at = ""; gt.val(""); o.val(""); ii.css("display", "inherit"); ae = 50; pi = 1; nt.val(t(nt.find("option")[0]).attr("value")); var r = w.find("option:selected").text(); du.text(n.Msg.getMsg("AllItems")); ti.text(r); ei = w.find("option:selected"); bt = ei.attr("data-type"); e = ei.val(); vr = ei.attr("data-isallnodes"); window.setTimeout(function () { nf(bt, e, vr, fi) }, 100); window.setTimeout(function () { u.empty(); vt = "All"; pi = 1; ar(e, bt, at, vt); nu(); fo() }, 200); oa(); it.is(":checked") ? (fi = !0, tt.css("display", "inherit"), c.css("height", "70%"), kt.css("height", "100%"), c.resizable({}), c.find(".ui-resizable-e").css("right", "0px"), c.find(".ui-resizable-s").css("bottom", "0px"), kt.addClass("VIS-TM-resizediv"), tt.height(ri.height() - c.height() - 20), lt.height(ri.height() - (c.height() + br.height() + 40)), wr.css("display", "inherit")) : (wr.css("display", "none"), fi = !1, tt.css("display", "none"), c.css("height", "100%"), kt.css("height", "100%"), c.resizable("destroy"), kt.removeClass("VIS-TM-resizediv"), tt.height(ri.height() - c.height())) } else pf.addClass("vis-tm-opacity"), it.prop("disabled", !0), it.prop("checked", !0), nr.css("display", "none"), e = 0, u.empty(), i.empty(), b.data("kendoTreeView").destroy(), b.empty(), ht.empty(), at = "", gt.val(""), ei = null, d.addClass("vis-tm-delete"), o.val(""), window.setTimeout(function () { u.empty() }, 200), du.text(n.Msg.getMsg("SelectTree")), ti.text(n.Msg.getMsg("SelectTree")), ii.css("display", "none"), dt.addClass("vis-tm-delete"), y.prop("disabled", !0), vi.prop("disabled", !0), y.css("cursor", "not-allowed"), vi.css("cursor", "not-allowed"), o.prop("disabled", !0), gt.prop("disabled", !0), nt.prop("disabled", !0), ft.prop("disabled", !0), ft.css("cursor", "not-allowed"), lr.css("display", "none"), bi.css("display", "none"); vi.prop("checked", !1); ft.prop("checked", !1); y.prop("checked", !1); u.empty(); g.prop("checked", !1); ir() } function oa() { kt.height(c.height() - 10) } function sa(n) { var i = t(n.currentTarget); i[0].scrollHeight - i.scrollTop() == i.outerHeight() && u.find("li").length > 0 && (vt = nt.val(), lf = !1, ye = !0, pi += 1, ar(e, bt, at, vt)) } function ha(n) { w.val() != "" && (i.empty(), it.is(":checked") ? (st[0].style.visibility = "hidden", fi = !0, wr.css("display", "inherit"), tt.css("display", "inherit"), c.css("height", "70%"), kt.css("height", "100%"), c.resizable({ handles: "n,s,se" }), c.find(".ui-resizable-e").css("right", "0px"), c.find(".ui-resizable-s").css("bottom", "0px"), kt.addClass("VIS-TM-resizediv"), ei != null && nf(bt, e, vr, fi), tt.height(ri.height() - c.height() - 20), bi.css("right", "145px")) : (gh(), o.val() != "" && y.prop("checked", !1), bi.css("right", "35px")), yt.css("display", "none"), ct.css("display", "inherit"), ir(), window.setTimeout(function () { o.val() != "" && window.setTimeout(function () { ur(n) }, 200) }, 200), ru = -1, iu = !1) } function ca() { f = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); f[0].style.visibility = "visible"; ce.append(f) } function la() { var n = null; n = t('<div style="position: relative; width: 100%; height: 100%; z-index: -1;">'); st = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); n[0].style.visibility = "visible"; n.append(st); tt.append(n) } function aa() { wi = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); wi[0].style.visibility = "visible"; gu.append(wi) } function va() { oi = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'); oi[0].style.visibility = "visible"; c.append(oi) } var s, ot, bi, dt, hr, ri, cr, uo, lr, eu, si, er, wf, bf, tf, ui, rf, di, hu, dr, gr, kf, ec, cu, oc, gf, te, wt, ue, nh, ih, rh, fe, rt, kl, ru, fh, eh, oe, oh, ua, lo, lf; this.frame; this.windowNo; var ya = this, ce = t('<div class="vis-forms-container" style="padding:3px 0 7px;background-color:white;height:100%"/>'), b, fi = !0, ei, bt, e, vr, ao = "", le = 0, vo, ae = 50, pi = 1, l, li = [], uu = [], yr = !0, yo = null, au, pr = 0, f = null, st = null, wi = null, oi = null, fr = !0, vu = !0, yu, po, wo = null, gi = null, at = "", ah = null, bo = !0, v = null, ut = 1, et = 50, ve = 0, pu = 0, af = null, wu = !1, ai = null, bu = !1, vt = "All", ye = !1, sr = !0, ko = n.Application.contextUrl, vh = ko + "JsonData/JDataSet", yh = ko + "JsonData/ExecuteNonQuer", pe = t("<div  class='VIS-TM-left-tree'>"), ph = t("<div  class='VIS-TM-middle'>"), we = t("<div class='VIS-TM-right-slide'>"), be = !1, k = function (t, i, r) { var e = r ? !0 : !1, f = { sql: t, page: 1, pageSize: 0 }, u; return i && (f.param = i), u = null, go(f, e, function (t) { u = (new n.DB.DataSet).toJson(t); r && r(u) }), u }, vf = function (t, i, r) { var f = r ? !0 : !1, e = { sql: t, page: 1, pageSize: 0 }, u = null; return go(e, f, function (t) { i = (new n.DB.DataSet).toJson(t); var i = (new n.DB.DataSet).toJson(t); u = i.getTable(0).getRows().length > 0 ? i.getTable(0).getRow(0).getCell(0) : null; i.dispose(); i = null; f && r(u) }), u }, fu = function (n, i, r) { var f = r ? !0 : !1, u = null, e = { sql: n, param: i }; return t.ajax({ url: yh + "y", type: "POST", datatype: "json", contentType: "application/json; charset=utf-8", async: f, data: JSON.stringify(e) }).done(function (n) { u = n; r && r(n) }), u }; var ke = t('<div class="VIS-TM-data-head" style="padding-top: 8px;">'), ns = t('<div class="VIS-TM-data">'), it = t('<input disabled type="checkbox" checked="true" />'), ts = t("<span>" + n.Msg.getMsg("OnlySummaryLevel") + "<span/>"), is = t("<h4>" + n.Msg.getMsg("SelectTree") + "<\/h4>"), ku = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()); ke.append(is).append(ns.append(it).append(ts)); var de = t('<div class="VIS-TM-treeCombo">'), w = t("<select><\/select>"), ge = t('<span style="display:none" class="VIS-Tm-btnicon vis vis-refresh"  title=' + n.Msg.getMsg("RefreshSelectTree") + "><\/span>"), no = t('<span class="VIS-Tm-btnicon vis vis-refresh" style="float:left" title="' + n.Msg.getMsg("tmRefresh") + '"><\/span>'), yt = t('<span class="VIS-Tm-btnicon fa fa-minus-square-o"  style="display:none;" title="' + n.Msg.getMsg("TreeCollapse") + '" ><\/span>'), ct = t('<span class="VIS-Tm-btnicon fa fa-plus-square-o" title="' + n.Msg.getMsg("TreeExpand") + '" ><\/span>'), rs = t("<i class='vis vis-find VIS-Tm-btnicon' title='" + n.Msg.getMsg("CreateNewTree") + "'><\/i>"), nr = t('<div class="vis-tm-treeCmbDisable "><\/div>'); de.append(nr).append(w).append(rs).append(no).append(yt).append(ct); var c = t('<div class="VIS-TM-tree-wrap">'), r = t('<div class="VIS-TM-root-node" style="overflow:visible">'), kt = t('<div class="vis-tm-topTreeDiv">'); c.resizable({ handles: "n,s,se" }); s = t('<div style="z-index:9;width:28px;display:none;text-align:center;float: right; height: 95%; position: absolute; right: 5px;"><\/div>'); ot = t('<span class="VIS-Tm-deletetreenode" style="margin:auto;display:none;position: relative;top: 50%;"><\/span>'); s.append(ot); kt.append(ge).append(s).append(r); c.append(kt); var to = t("<div class='VIS-TM-tree-search'>"), o = t("<input disabled placeholder='" + n.Msg.getMsg("Search") + "' type='search'>"), tr = t('<span class="VIS-Tm-btnicon vis vis-search"><\/span>'), wr = t('<div class="vis-tm-b-s-ryt">'), y = t('<input type="checkbox" disabled>'), wh = t('<label style="font-weight: normal;margin-bottom:0px">' + n.Msg.getMsg("NodeItem") + "<\/label>"); wr.append(y).append(wh); bi = t('<span class="vis-tmlinkdel-icon"><\/span>'); to.append(o).append(bi).append(wr).append(tr); var br = t("<div class='VIS-TM-data-headMID'>"), d = t("<span style='display:inherit;' class='VIS-Tm-unlinkforbottmo vis vis-link ' title='" + n.Msg.getMsg("UnlinkNode") + "' ><\/span>"), ti = t('<h4 style="float:left">' + n.Msg.getMsg("SelectTree") + "<\/h4>"), lt = t("<div class='VIS-TM-dataWrap' style='padding-top:0px' >"), ii = t('<span class="VIS-TM-recordeNotFound">' + n.Msg.getMsg("TMRecordNotFound") + "<\/span>"), i = t('<ul class="vis-tm-sortable" style="list-style: none;padding:0">'), g = t('<input type="checkbox" disabled />'), bh = t('<span class="vis vis-search" style="display:none;cursor:pointer;float:left;margin: 14px 0 0 6px;font-size: 10px;" ><\/span>'); lt.append(i).append(ii); dt = t('<span style="display:inherit;" class="vis-tm-childnodeinidailog" title="' + n.Msg.getMsg("SetOrder") + '">Set Order<\/span>'); dt.addClass("vis-tm-delete"); hr = t('<div style="display:none;position:absolute;height: 40.2px;width: 100%; z-index: 5;"><\/div>'); br.append(hr).append(g).append(ti).append(bh).append(dt).append(d); var io = t("<div class='VIS-TM-data-head'>"), du = t("<h4>" + n.Msg.getMsg("AllItems") + "<\/h4>"), gu = t("<div class='VIS-TM-dataWrap'>"), yf = t("<div class='VIS-TM-treeList'>"), u = t("<ul style='list-style: none' class='scrolldrag' >"), gt = t("<input disabled placeholder='" + n.Msg.getMsg("Search") + "' type='search'>"), us = t('<span class="VIS-Tm-btnicon vis vis-search" style="top:0px;float:none"><\/span>'), fs = t("<div class='VIS-TM-path'>"), ht = t("<i style='font-weight:600'>"), nt = t('<select disabled style="float: right; min-width: 100px"><\/select>'), kh = t('<span style="margin: 0 7px;">' + n.Msg.getMsg("Show") + "<span/>"), vi = t('<input type="checkbox"  style="float:left;margin-right:5px" disabled  />'), dh = t("<span>" + n.Msg.getMsg("TraceItem") + "<span/>"), ft = t('<input type="checkbox" disabled />'), pf = t('<span class="vis-unlinkallNodes vis-tm-opacity" title="' + n.Msg.getMsg("UnlinkItem") + '"  ><b><\/b><b><\/b><b><\/b><\/span>'); io.append(ft).append(du).append(t('<div class="vis-tm-r-list-w">').append(kh).append(nt).append(pf)); var a = t('<div class="vis-tm-nodeItemDeleteliketopdiv"><span class="VIS-Tm-deletetreenode vis-tm-nodeItemDeletespans" ><\/span><\/div>'), tt = t('<div style="float:left;width:100%;">'), ro = t('<div style="z-index:999;height:100%;display:none;position:absolute; left:0; right:0; top:0; bottom:0;"><\/div>'); tt.append(ro).append(br).append(lt).append(a); ri = t('<div class="VIS-TM-leftMianDataDiv">'); ri.append(c).append(tt); cr = t('<div style="display:none;height: 100%; width: 100%; position: absolute;z-index: 9999;"><\/div>'); pe.append(cr).append(t('<div style="height:100%;" >').append(ke).append(de).append(ri).append(to)); uo = t('<div class="VIS-TM-Righttree-search" >'); lr = t('<span class="vis-tmlinkdel-icon"><\/span>'); uo.append(gt).append(lr).append(us); eu = t('<span class="VIS-TM-recordeNotFound" style="margin-top:50%" >' + n.Msg.getMsg("TMRecordNotFound") + "<\/span>"); si = t('<div style="z-index:999;height:100%;display:none;position:absolute; left:0; right:0; top:0; bottom:0;"><\/div>'); gu.append(si).append(uo).append(yf.append(u).append(eu)).append(fs.append(ht)); we.append(t('<div  style="height:100%">').append(io).append(gu)); ce.append(pe).append(we); er = !1; wf = !0; bf = !0; var or = null, ss = null, hs = t('<div class="vis-tm-unlinkimgss">'); tf = 0; ui = !1; var su = null; rf = null; di = null; hu = []; dr = !1; gr = null; kf = null; ec = !0; cu = !0; oc = null; var h = !1, ps = !1, df = !1; var yi = [], ni = "true", hi = null, tu = null; gf = null; te = !0; var ie = 1, oo = 50, iu = !1, so = 0; var pt = t("<ul style='padding:0;list-style: none'>"), bs = t("<div>"), ks = t('<div style="padding: 10px;height:425px;overflow:auto">'); var gs = null, tl = null, re = !0; var el = 0, ol = 0, sl = 0; wt = []; ue = null; nh = null; ih = !0; rh = null; fe = ""; rt = []; kl = 0; ru = -1; oh = !0; var of = [], sf = [], rr = null, co = !0, se = null; var ci = null, hf = -1; ua = !0; lo = null; lf = !0; this.Initialize = function () { ca(); aa(); va(); la(); es(); sc(); window.setTimeout(function () { f[0].style.visibility = "hidden" }, 200); f[0].style.visibility = "visible"; wi[0].style.visibility = "hidden"; oi[0].style.visibility = "hidden"; st[0].style.visibility = "hidden" }; this.disposeComponent = function () { b = null; fi = null; ei = null; bt = null; e = null; vr = null; ao = null; le = null; vo = null; ae = null; pi = null; l = null; li = null; yr = null; au = null; pr = null; f = null; yu = null; po = null; pe = null; ph = null; we = null; ke = null; ns = null; it = null; ts = null; is = null; de = null; w = null; ge = null; no = null; c = null; r = null; to = null; o = null; tr = null; br = null; ti = null; lt = null; ii = null; i = null; io = null; du = null; gu = null; yf = null; u = null; fs = null; ht = null }; this.getRoot = function () { return window.kendo == undefined || window.kendo == null ? t('<div><p style="text-align: center;line-height: 600px;">' + n.Msg.getMsg("PleaseInstallKendoUIModule") + "<\/p><\/div>") : (window.setTimeout(function () { d.addClass("vis-tm-delete"); c.find(".ui-resizable-n").css("display", "none") }, 200), f[0].style.visibility = "visible", ce) }; this.formSizeChanged = function () { tt.height(ri.height() - c.height() - 20); lt.height(tt.height()); tt.css("overflow", "hidden") }; this.sizeChanged = function (n, t) { this.formSizeChanged(n, t) } } i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.sizeChanged = function (n, t) { this.formSizeChanged(n, t) }; i.prototype.refresh = function () { this.formSizeChanged() }; i.prototype.dispose = function () { this.disposeComponent(); this.frame && this.frame.dispose(); this.frame = null }; n.Apps.AForms.VTreeMaintenance = i }(VIS, jQuery), function (n, t) { function i(i, r) { function l() { } function a(t, i, r, u) { s.filter("p#forreportcreate").text(n.Msg.getMsg("Generating" + u + "File")); h.filter("p#forreportdownload").text(n.Msg.getMsg("Downloading" + u + "File")) } var u, f; this.onClose = null; var e = t("<div><\/div>"), o = t('<div style="overflow-y:auto;margin-bottom:15px"><\/div>'), s = t('<p id="forreportcreate"><\/p><div class="vis-ui-progress-bar hide" id="reportcreate"><div class="progress-bar vis-ui-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><\/div><\/div><br /><p class="hide" id="reportcreateresult"><\/p> <div style="margin-bottom: 15px;"><\/div>'), h = t('<p id="forreportdownload" class="hide"><\/p><div class="vis-ui-progress-bar hide" id="reportdownload"><div class="progress-bar vis-ui-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><\/div><\/div><br /><p class="hide" id="reportdownloadresult"><\/p>'), c = t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"); e.append(c).append(s).append(h); this.winNo = i; u = null; this.prop = { WindowNo: i }; a(o, i, this.prop, r); f = this; this.show = function () { u = new n.ChildDialog; u.setContent(e); u.setHeight(450); u.setWidth(650); u.setTitle(n.Msg.getMsg("Reports")); u.setModal(!0); u.onClose = function () { f.onClose && f.onClose(); f.dispose() }; u.show(); l(); u.hidebuttons() }; this.onClose = function () { u.close() }; this.setBulkBusy = function (n) { c.css("display", n ? "block" : "none") }; this.dispose = function () { this.prop = null; o = null; e = null; u = null; f = null; this.setBulkBusy(!1) } } n.BulkDownload = i }(VIS, jQuery), function (n, t) { function i() { function et() { c = t('<div class="Page-content" style="height:100%;background-color:white;">'); e = t(' <div class="formLeft" style="background-color: rgb(241, 241, 241);display: inline-block; float: left;width:23%;height:87.8%;overflow:auto;padding-left: 7px;">'); r = t('<div class="VIS_formDataRow">'); u = t("<div id=PCont_Name_" + i.windowNo + ' class="VIS_formData">'); k = t("<label>" + n.Msg.translate(n.Env.getCtx(), "Name") + "<\/label><br>"); d = t("<input type=text id=containerName_" + i.windowNo + " ><\/input>"); u.append(k).append(d); r.append(u); e.append(r); r = t('<div class="VIS_formDataRow">'); u = t("<div id=PCont_WarehouseSearch_" + i.windowNo + ' class="VIS_formData" style="margin-top:20px">'); g = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_Warehouse_ID") + "<\/label><br>"); u.append(g); r.append(u); e.append(r); r = t('<div class="VIS_formDataRow">'); u = t("<div id=PCont_LocatorSearch_" + i.windowNo + ' class="VIS_formData" style="margin-top:20px">'); tt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_Locator_ID") + "<\/label><br>"); u.append(tt).append(o); r.append(u); e.append(r); r = t('<div class="VIS_formDataRow">'); u = t('<div class="VIS_formData">'); v = t('<input type=button id="PCont_btnSearch_' + i.windowNo + ' class="#" style="margin-top:20px;width: 100px;" value = ' + n.Msg.getMsg("Search") + "><\/input>"); u.append(v); r.append(u); e.append(r); l = t(' <div class="formRight" style="display: inline-block; float: left; width: 75%; height: 87.8%; margin-left: 10px;">'); p = t('<div style="display: inline-block; float: left; width: 75%; height: 87.8%; margin-left: 10px;">'); a = t("<div>"); y = t('<input type=button id="PCont_OK_' + i.windowNo + ' style="margin-top:20px;width: 100px;" value = ' + n.Msg.getMsg("OK") + "><\/input>"); a.append(y); l.append(p).append(a); c.append(e).append(l); f.append(c).append(b) } function ot() { h = f.find("#PCont_WarehouseSearch_" + i.windowNo); st(); o = f.find("#PCont_LocatorSearch_" + i.windowNo); ht(); var t = f.find("#containerName_" + i.windowNo)[0].value; w(t, $ReqControlWarehouse.value, $ReqControlLocator.value); v.on("click", function () { var n = f.find("#containerName_" + i.windowNo)[0].value; w(n, $ReqControlWarehouse.value, $ReqControlLocator.value) }); y.on("click", function () { var t = n.context.getWindowTabContext(i.windowNo, 1, "KeyColumnName"), r = 0; if (t.length > 0) r = n.context.getWindowContext(i.windowNo, t, !0); else { w2alert(n.Msg.getMsg("VIS_TableNotFound")); return } r > 0 && $selectedContainerId > 0 ? lt(t, r, $selectedContainerId) : w2alert(n.Msg.getMsg("VIS_RecordNotSelected")) }) } function st() { nt = n.MLookupFactory.get(n.Env.getCtx(), i.windowNo, 3798, n.DisplayType.Search, "M_Warehouse_ID", 0, !1, null); this.$ReqControlWarehouse = new n.Controls.VTextBoxButton("M_Warehouse_ID", !0, !0, !0, n.DisplayType.Search, nt); this.$ReqControlWarehouse.getControl().css("width", "55%"); this.$ReqControlWarehouse.getBtn(0).css("height", "29px"); this.$ReqControlWarehouse.getBtn(0).css("margin-top", "-1px"); this.$ReqControlWarehouse.getBtn(0).css("width", "14%"); this.$ReqControlWarehouse.getBtn(1).css("height", "29px"); this.$ReqControlWarehouse.getBtn(1).css("margin-top", "-1px"); this.$ReqControlWarehouse.getBtn(1).css("width", "14%"); h.append(this.$ReqControlWarehouse.getControl()); h.append(this.$ReqControlWarehouse.getBtn(0)); h.append(this.$ReqControlWarehouse.getBtn(1)); var t = ut(i.windowNo, "M_Warehouse_ID"); $ReqControlWarehouse.setValue(t) } function ht() { it = new n.MLocatorLookup(n.Env.getCtx(), i.windowNo); this.$ReqControlLocator = new n.Controls.VLocator("M_Locator_ID", !0, !0, !0, n.DisplayType.Locator, it); this.$ReqControlLocator.getControl().css("width", "55%"); this.$ReqControlLocator.getBtn(0).css("height", "29px"); this.$ReqControlLocator.getBtn(0).css("margin-top", "-1px"); this.$ReqControlLocator.getBtn(0).css("width", "14%"); this.$ReqControlLocator.getBtn(1).css("height", "29px"); this.$ReqControlLocator.getBtn(1).css("margin-top", "-1px"); this.$ReqControlLocator.getBtn(1).css("width", "14%"); o.append(this.$ReqControlLocator.getControl()); o.append(this.$ReqControlLocator.getBtn(0)); o.append(this.$ReqControlLocator.getBtn(1)); var t = ut(i.windowNo, "M_Locator_ID"); $ReqControlLocator.setValue(t) } function ut(t, i) { return n.context.getWindowContext(t, i, !1) } function w(i, r, u) { t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/ProductContainer", data: { Name: i, WarehouseId: r, LocatorId: u }, dataType: "json", success: function (n) { var t = JSON.parse(n); t ? ct(t) : w2ui[s].clear() }, error: function (n) { console.log(n) } }) } function ct(t) { var u = [], f = [], i, r; for (u.push({ field: "ContainerName", caption: n.Msg.getMsg("ContainerName"), size: "15%" }), u.push({ field: "Width", caption: n.Msg.getMsg("Width"), size: "15%" }), u.push({ field: "Height", caption: n.Msg.getMsg("Height"), size: "15%" }), u.push({ field: "ParentPath", caption: n.Msg.getMsg("ParentPath"), size: "22%" }), u.push({ field: "M_ProductContainer_ID", caption: n.Msg.getMsg("M_ProductContainer_ID"), hidden: !0 }), u.push({ field: "Ref_M_Container_ID", caption: n.Msg.getMsg("Ref_M_Container_ID"), hidden: !0 }), i = 0; i < t.length; i++)r = {}, r.M_ProductContainer_ID = t[i].M_ProductContainer_ID, r.Ref_M_Container_ID = t[i].Ref_M_Container_ID, r.ContainerName = t[i].ContainerName, r.ParentPath = t[i].ParentPath, r.Width = t[i].Width, r.Height = t[i].Height, r.recid = i + 1, f[i] = r; s = "PCont_gridContainer" + Math.random(); s = s.replace(".", ""); w2utils.encodeTags(f); rt = p.w2grid({ name: s, recordHeight: 20, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !0, selectColumn: !1, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: u, records: f, onClick: function (n) { $selectedContainerId = rt.get(n.recid).M_ProductContainer_ID } }) } function lt(r, u, e) { t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/UpdateProductContainer", data: { TableName: r, RecordId: u, ContainerId: e }, dataType: "json", success: function (t) { var u = JSON.parse(t), r; u ? (w2alert(n.Msg.getMsg("VIS_UpdatedSuccess")), r = f.find("#containerName_" + i.windowNo)[0].value, w(r, $ReqControlWarehouse.value, $ReqControlLocator.value)) : w2alert(n.Msg.getMsg("VIS_NotUpdated")) }, error: function (n) { console.log(n) } }) } function ft(n) { b[0].style.visibility = n } this.frame; this.windowNo; var i = this, f = t("<div style='height:100%;background-color:white;' >"), b = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), c = null, r = null, e = null, l = null, u = null, a = null, k = null, d = null, g = null, h = null, nt = null; this.$ReqControlWarehouse = null; var tt = null, o = null, it = null; this.$ReqControlLocator = null; var v = null, y = null, p = null, rt = null, s = null; this.$selectedContainerId = null; this.Initialize = function () { ft("visible"); et(); ot(); ft("hidden") }; this.getRoot = function () { return f }; this.formSizeChanged = function () { }; this.sizeChanged = function () { }; disposeComponent = function () { this.$ReqControlWarehouse = null; this.$ReqControlLocator = null; this.$selectedContainerId = null } } n.AForms = n.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; var i = this.Initialize(); this.frame.getContentGrid().append(this.getRoot()); this.formSizeChanged() }; i.prototype.sizeChanged = function (n, t) { this.formSizeChanged(n, t) }; i.prototype.refresh = function () { this.formSizeChanged() }; i.prototype.dispose = function () { disposeComponent(); this.frame = null }; n.AForms.productContainer = i }(VIS, jQuery), function (n, t) { function i() { function pi() { var a, o, y, r, k, g, ot; tt = t('<div class="VIS_main-wrap vis-formouterwrpdiv">'); b = t('<div class="VIS_form-wrap">'); h = t('<div class="VIS_form-row">'); s = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); lt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_Warehouse_ID") + "<\/label>"); w = t('<select disabled class="vis-ev-col-readonly">'); s.append(r); r.append(w).append(lt); l = t('<div class="VIS_form-col input-group vis-input-wrap">'); o = t('<div class="vis-control-wrap">'); at = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_WarehouseTo_ID") + "<\/label>"); c = t('<select disabled class="vis-ev-col-readonly">'); l.append(o); o.append(c).append(at); h.append(s).append(l); b.append(h); h = t('<div class="VIS_form-row">'); s = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); vt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_Locator_ID") + "<\/label>"); u = t("<select>"); s.append(r); r.append(u).append(vt); l = t('<div class="VIS_form-col input-group vis-input-wrap">'); o = t('<div class="vis-control-wrap">'); yt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "M_LocatorTo_ID") + "<\/label>"); e = t("<select>"); l.append(o); o.append(e).append(yt); h.append(s).append(l); b.append(h); h = t('<div class="VIS_form-row">'); s = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); a = t('<div class="input-group-append">'); pt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "VIS_FromContainer") + "<\/label>"); f = t('<select disabled class="VIS-container-move-combo-width" class="vis-ev-col-readonly" data-hasbtn=" ">'); d = t('<span class="fa fa-cubes input-group-text VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled"><\/span>'); s.append(r); r.append(f).append(pt); s.append(a); a.append(d); l = t('<div class="VIS_form-col input-group vis-input-wrap">'); o = t('<div class="vis-control-wrap">'); y = t('<div class="input-group-append">'); wt = t("<label>" + n.Msg.translate(n.Env.getCtx(), "Ref_M_ProductContainerTo_ID") + "<\/label>"); i = t('<select disabled class="VIS-container-move-combo-width" class="vis-ev-col-readonly" data-hasbtn=" ">'); $btnToContainerTree = t('<span class="fa fa-cubes input-group-text VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled"><\/span>'); l.append(o); o.append(i).append(wt); l.append(y); y.append($btnToContainerTree); h.append(s).append(l); b.append(h); h = t('<div class="VIS_form-row">'); s = t('<div class="VIS_form-col input-group vis-input-wrap">'); r = t('<div class="vis-control-wrap">'); k = t('<label class="vis-ec-col-lblchkbox" title="' + n.Msg.translate(n.Env.getCtx(), "VIS_MoveFullContainerToolTip") + '"><input type="checkbox" name="">' + n.Msg.translate(n.Env.getCtx(), "VIS_MoveFullContainer") + "<\/label>"); s.append(r); r.append(k); v = k.find("input"); it = t('<div class="VIS_form-col input-group vis-input-wrap">'); g = t('<div class="vis-control-wrap">'); ot = t('<label class="vis-ec-col-lblchkbox" title="' + n.Msg.translate(n.Env.getCtx(), "VIS_WithoutContainerToolTip") + '"><input type="checkbox" name="WithoutContainer">' + n.Msg.translate(n.Env.getCtx(), "VIS_WithoutContainer") + "<\/label>"); it.append(g); g.append(ot); p = ot.find("input"); h.append(s).append(it); b.append(h); rt = t(' <div class="VIS_outer-table-wrap">'); ut = t('<div class="VIS_outer-table-wrap">'); rt.append(ut); ft = t('<div class="VIS_buttons-wrap">'); bt = t('<div class="pull-left" style="display: none;"><label>' + n.Msg.translate(n.Env.getCtx(), "VIS_ContainerGridInfo") + "<\/label><\/div>"); nt = t('<div class="pull-right">'); et = t('<span class="btn">' + n.Msg.translate(n.Env.getCtx(), "VIS_OK") + "<\/span>"); wi(nt); nt.append(et); ft.append(bt).append(nt); tt.append(b).append(rt).append(ft); ct.append(tt).append(ni) } function wi(i) { ulPaging = t('<ul style="float:left;margin-top:4px" class="vis-statusbar-ul">'); liFirstPage = t('<li style="display: none; "><div><i class="vis vis-shiftleft" title="' + n.Msg.translate(n.Env.getCtx(), "FirstPage") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); liPrevPage = t('<li style="opacity: 1;"><div><i class="vis vis-pageup" title="' + n.Msg.translate(n.Env.getCtx(), "PageUp") + '"  style="opacity: 0.6;"><\/i><\/div><\/li>'); cmbPage = t("<select>"); liCurrPage = t("<li>").append(cmbPage); liNextPage = t('<li style="opacity: 1;"><div><i class="vis vis-pagedown" title="' + n.Msg.translate(n.Env.getCtx(), "PageDown") + '" style="opacity: 0.6;"><\/i><\/div><\/li>'); liLastPage = t('<li style="display: none;"><div><i class="vis vis-shiftright" title="' + n.Msg.translate(n.Env.getCtx(), "LastPage") + '" style="opacity: 0.6;"><\/div><\/li>'); ulPaging.append(liFirstPage).append(liPrevPage).append(liCurrPage).append(liNextPage).append(liLastPage); i.append(ulPaging) } function bi() { liPrevPage.on("click", function (n) { n.preventDefault(); t(this).css("opacity") == "1" && (r("visible"), g(ht, !0, -1)) }); liNextPage.on("click", function (n) { n.preventDefault(); t(this).css("opacity") == "1" && (r("visible"), g(ht, !0, 1)) }); cmbPage.on("change", function (n) { n.preventDefault(); r("visible"); g(ht, !0, 0) }) } function ki(n, t) { cmbPage.val(n); t > 0 ? (t > n ? liNextPage.css("opacity", "1") : liNextPage.css("opacity", "0.6"), n > 1 ? liPrevPage.css("opacity", "1") : liPrevPage.css("opacity", "0.6"), t == 1 && (liPrevPage.css("opacity", "0.6"), liNextPage.css("opacity", "0.6"))) : (liPrevPage.css("opacity", "0.6"), liNextPage.css("opacity", "0.6")); r("hidden") } function di() { gi(); nr(); tr(); u.on("change", function () { r("visible"); f.empty(); u.val() == "0" ? d.addClass("VIS_Tree-Container-disabled") : d.removeClass("VIS_Tree-Container-disabled"); window.setTimeout(function () { g(0, !1, 0) }, 20); r("hidden") }); c.on("change", function () { r("visible"); i.empty(); ii(); r("hidden") }); e.on("change", function () { r("visible"); i.empty(); e.val() == "0" ? $btnToContainerTree.addClass("VIS_Tree-Container-disabled") : $btnToContainerTree.removeClass("VIS_Tree-Container-disabled"); r("hidden") }); g(0, !1, 0); et.on("click", function () { if (c.val() == "0") return n.ADialog.error("VIS_ToWarehouseNotSelected", !0, "", ""), !1; if (u.val() == "0") return n.ADialog.error("VIS_FromLocatorNotSelected", !0, "", ""), !1; if (e.val() == "0") return n.ADialog.error("VIS_ToLocatorNotSelected", !0, "", ""), !1; if (f.val() == null && i.val() == null) return n.ADialog.error("VIS_SelectContainer", !0, "", ""), !1; var t = y.length; if (t == 0 && !p.is(":checked") && !v.is(":checked")) return n.ADialog.error("VIS_MoveQtyNotSelected", !0, "", ""), !1; v.is(":checked") ? n.ADialog.confirm("VIS_DoYouWantToDeleteManualCL", !0, "", "Confirm", function (n) { if (n) r("visible"), ri(), r("hidden"); else return !1 }) : (r("visible"), ri(), r("hidden")) }); d.on("click", function () { if (!d.hasClass("VIS_Tree-Container-disabled")) { var i = w.val() == "0" || w.val() == null ? 0 : parseInt(w.val()), r = u.val() == "0" || u.val() == null ? 0 : parseInt(u.val()), t = new n.productContainerTree(i, r, null, null); t != null && (t.showDialog(), t.onClosing = function (n, t) { ht = n; n > 0 && bt.css("display", "block"); f.empty(); f.append(" <option value=" + n + "  selected>" + t + "<\/option>"); y = []; g(n, !1, 0) }); t = null } }); $btnToContainerTree.on("click", function () { if (!$btnToContainerTree.hasClass("VIS_Tree-Container-disabled")) { var r = c.val() == "0" || c.val() == null ? 0 : parseInt(c.val()), u = e.val() == "0" || e.val() == null ? 0 : parseInt(e.val()), t = new n.productContainerTree(r, u, null, null); t != null && (t.showDialog(), t.onClosing = function (n, t) { i.empty(); i.append(" <option value=" + n + "  selected>" + t + "<\/option>") }); t = null } }); v.change(function () { this.checked ? (w2ui[grdname].lock(""), t(this).prop("checked", !0), p.prop("checked", !1)) : (w2ui[grdname].unlock(""), t(this).prop("checked", !1)) }); p.change(function () { this.checked ? (w2ui[grdname].lock(""), t(this).prop("checked", !0), v.prop("checked", !1)) : (w2ui[grdname].unlock(""), t(this).prop("checked", !1)) }); bi() } function gi() { var i = n.context.getWindowContext(a.windowNo, "DTD001_MWarehouseSource_ID", !0); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadWarehouse", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), w.append(" <option value=" + key + ">" + value + "<\/option>"); w.prop("selectedIndex", 0) }, error: function (n) { r("hidden"); console.log(n) } }) } function nr() { var i = n.context.getWindowContext(a.windowNo, "DTD001_MWarehouseSource_ID", !0); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadLocator", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (u.empty(), u.append("<option value= 0 >Select<\/option>"), i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), u.append(" <option value=" + key + ">" + value + "<\/option>"); else u.append("<option value= 0 >Select<\/option>"); u.prop("selectedIndex", 0) }, error: function (n) { r("hidden"); console.log(n) } }) } function tr() { var i = n.context.getWindowContext(a.windowNo, "M_Warehouse_ID", !0); i == "" && (i = 0); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadWarehouse", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), c.append(" <option value=" + key + ">" + value + "<\/option>"); c.prop("selectedIndex", 0); ii() }, error: function (n) { r("hidden"); console.log(n) } }) } function ii() { var i = c.val() == "0" || c.val() == null ? 0 : parseInt(c.val()); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/LoadLocator", data: { fromWarehouse_ID: i }, dataType: "json", success: function (t) { var r = JSON.parse(t), i; if (r) for (e.empty(), e.append("<option value= 0 >Select<\/option>"), i = 0; i < r.length; i++)key = n.Utility.Util.getValueOfInt(r[i].ID), value = n.Utility.Util.getValueOfString(r[i].Name), e.append(" <option value=" + key + ">" + value + "<\/option>"); else e.append("<option value= 0 >Select<\/option>"); e.prop("selectedIndex", 0) }, error: function (n) { r("hidden"); console.log(n) } }) } function g(i, f, e) { o = 1; k = 1; st = 0; dt = !1; var s = parseInt(n.context.getWindowContext(a.windowNo, "AD_Org_ID", !0)), h = n.context.getWindowContext(a.windowNo, "MovementDate", !0), c = u.val() == "0" || u.val() == null ? 0 : parseInt(u.val()); f && (o = parseInt(cmbPage.val()), e != 0 && (e == -1 ? (o = o - 1, o < 1 && (o = 1)) : e == 1 && (o = o + 1, o > gt && (o = gt)))); t.ajax({ type: "POST", url: n.Application.contextUrl + "ProductContainer/MoveContainer", data: { container: i, movementDate: h, AD_Org_ID: s, locator: c, page: o, size: kt }, dataType: "json", success: function (n) { var u = JSON.parse(n), i; if (u) { if (o == 1 && u.length > 0 && (st = u[0].ContainerRecord, k = Math.ceil(st / kt)), ir(u), f) ot = o, cmbPage.val(ot), ot > 1 ? liPrevPage.css("opacity", "1") : liPrevPage.css("opacity", "0.6"), r("hidden"); else { if (gt = k, liCurrPage.find("option").remove(), k > 0) for (i = 0; i < k; i++)cmbPage.append(t("<option value=" + (i + 1) + ">" + (i + 1) + "<\/option>")); ki(ot, k); cmbPage.val(o) } dt = !0 } }, error: function (n) { r("hidden"); console.log(n) } }) } function ir(i) { var f = [], e = [], r, u, o; for (f.push({ field: "ProductName", caption: n.Msg.translate(n.Env.getCtx(), "ProductName"), size: "20%" }), f.push({ field: "ASI", caption: n.Msg.translate(n.Env.getCtx(), "ASI"), size: "15%" }), f.push({ field: "UomName", caption: n.Msg.translate(n.Env.getCtx(), "UomName"), size: "15%" }), f.push({ field: "ContainerQty", caption: n.Msg.translate(n.Env.getCtx(), "ContainerQty"), size: "10%" }), f.push({ field: "MoveQty", caption: n.Msg.translate(n.Env.getCtx(), "MoveQty"), editable: { type: "float" }, render: "number:4", sortable: !1, size: "10%" }), f.push({ field: "M_ProductContainer_ID", caption: n.Msg.translate(n.Env.getCtx(), "M_ProductContainer_ID"), hidden: !0 }), f.push({ field: "M_PRODUCT_ID", caption: n.Msg.translate(n.Env.getCtx(), "M_PRODUCT_ID"), hidden: !0 }), f.push({ field: "M_AttributeSetInstance_ID", caption: n.Msg.translate(n.Env.getCtx(), "M_AttributeSetInstance_ID"), size: "15%", hidden: !0 }), f.push({ field: "C_Uom_ID", caption: n.Msg.translate(n.Env.getCtx(), "C_Uom_ID"), size: "15%", hidden: !0 }), f.push({ field: "M_Transaction_ID", caption: n.Msg.translate(n.Env.getCtx(), "M_Transaction_ID"), size: "15%", hidden: !0 }), r = 0; r < i.length; r++)u = {}, u.ProductName = i[r].ProductName, u.ASI = i[r].ASI, u.UomName = i[r].UomName, u.ContainerQty = i[r].ContainerQty, u.M_ProductContainer_ID = i[r].M_ProductContainer_ID, u.M_Product_ID = i[r].M_Product_ID, u.M_AttributeSetInstance_ID = i[r].M_AttributeSetInstance_ID, u.C_Uom_ID = i[r].C_Uom_ID, y.length > 0 ? (o = t.map(y, function (n) { if (n.M_Product_ID == i[r].M_Product_ID && n.M_AttributeSetInstance_ID == i[r].M_AttributeSetInstance_ID) return n }), u.MoveQty = o.length > 0 ? o[0].MoveQty : 0) : u.MoveQty = 0, u.recid = r + 1, e[r] = u; grdname = "MCont_gridContainer" + Math.random(); grdname = grdname.replace(".", ""); w2utils.encodeTags(e); ti = ut.w2grid({ name: grdname, recordHeight: 20, show: { toolbar: !1, columnHeaders: !0, lineNumbers: !0, selectColumn: !1, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !1, toolbarSave: !1, selectionBorder: !1, recordTitles: !1 }, columns: f, records: e, multiSelect: !1, onClick: function () { }, onChange: function (t) { if (t.column == 4 && t.value_new && t.value_new != 0) { var i = t.value_new, r = w2ui[grdname].get(t.recid).ContainerQty; if (r < 0 && i > 0) return n.ADialog.error("VIS_CantbePositive"), t.value_new = 0, !1; if (Math.abs(i) > Math.abs(r)) return n.ADialog.error("VIS_CantGreater"), t.value_new = 0, !1; rr(i, t.recid) } } }); (v.is(":checked") || p.is(":checked")) && w2ui[grdname].lock("") } function ri() { var s = [], o = v.is(":checked"), h = !1, k, d, l, b, w, c; if (h = p.is(":checked"), o && f.val() == null) return n.ADialog.error("VIS_FullContainerMove", !0, "", ""), !1; if (k = f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), d = i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), k == d) return n.ADialog.error("VIS_ContainerCantSame", !0, "", ""), !1; if (l = y.length, l == 0 && !o && !h) return n.ADialog.error("VIS_MoveQtyNotSelected", !0, "", ""), !1; if (b = n.context.getWindowContext(a.windowNo, "M_Movement_ID", !0), l > 0 || o || h) { if (!o && !h && l > 0 && (t.each(y, function () { this.ToLocator = parseInt(e.val()); this.ToContainer = i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()) }), s = y), o || h) { for (s = [], w = 0; w < w2ui[grdname].records.length; w++) { c = w2ui[grdname].records[w]; s.push({ M_Product_ID: c.M_Product_ID, M_AttributeSetInstance_ID: c.M_AttributeSetInstance_ID, C_UOM_ID: c.C_Uom_ID, FromLocator: parseInt(u.val()), ToLocator: parseInt(e.val()), FromContainer: f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), ToContainer: i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), MoveQty: c.ContainerQty, M_Movement_ID: b, IsFullMoveContainer: o ? !0 : !1, IsfullContainerQtyWise: h ? !0 : !1 }); break } s.length == 0 && o && s.push({ M_Product_ID: 0, M_AttributeSetInstance_ID: 0, C_UOM_ID: 0, FromLocator: parseInt(u.val()), ToLocator: parseInt(e.val()), FromContainer: f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), ToContainer: i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), MoveQty: 0, M_Movement_ID: b, IsFullMoveContainer: o ? !0 : !1, IsfullContainerQtyWise: h ? !0 : !1 }) } if (s.length == 0) return n.ADialog.error("VIS_MoveQtyNotSelected", !0, "", ""), !1; t.ajax({ url: n.Application.contextUrl + "ProductContainer/SaveMoveData", type: "POST", data: { moveData: JSON.stringify(s) }, success: function (t) { JSON.parse(t) == "VIS_SuccessFullyInserted" ? n.ADialog.info("VIS_SuccessFullyInserted", !0, "", "") : n.ADialog.error("Error", !0, n.Msg.translate(n.Env.getCtx(), "VIS_NotInserted") + " - " + t, ""); v.prop("checked", !1); p.prop("checked", !1); y = []; a.frame.close() }, error: function () { y = []; a.frame.close(); r("hidden") } }) } } function rr(t, r) { var s = v.is(":checked"), h = p.is(":checked"), c = n.context.getWindowContext(a.windowNo, "M_Movement_ID", !0), l = w2ui[grdname].getChanges().length, o; t != 0 && (o = w2ui[grdname].get(r), y.push({ M_Product_ID: o.M_Product_ID, M_AttributeSetInstance_ID: o.M_AttributeSetInstance_ID, C_UOM_ID: o.C_Uom_ID, FromLocator: parseInt(u.val()), ToLocator: parseInt(e.val()), FromContainer: f.val() == "0" || f.val() == null ? 0 : parseInt(f.val()), ToContainer: i.val() == "0" || i.val() == null ? 0 : parseInt(i.val()), MoveQty: t, M_Movement_ID: c, IsFullMoveContainer: s ? !0 : !1, IsfullContainerQtyWise: h ? !0 : !1 })) } function r(n) { ni[0].style.visibility = n } this.frame; this.windowNo; var a = this, ct = t("<div style='height:100%;background-color:white;' class='vis-forms-container' >"), ni = t("<div class='vis-busyindicatorouterwrap'><div class='vis-busyindicatorinnerwrap'><i class='vis-busyindicatordiv'><\/i><\/div><\/div>"), tt = null, b = null, h = null, s = null, l = null, it = null, lt = null, w = null, at = null, c = null, vt = null, u = null, yt = null, e = null, d = null, pt = null, f = null, wt = null, i = null, ui = null, fi = null, ei = null, oi, si = null, v = null, hi = null, p = null, ci = null, li = null, ai = null, rt = null, ut = null, ti = null; this.grdname; var ft = null, nt = null, vi = null, et = null, yi = null, bt = null, kt = 50, ot = 1, o = 1, k = 1, st = 0, dt = !1, gt = 1, ht = 0, y = []; this.Initialize = function () { r("visible"); pi(); di(); r("hidden") }; this.setHeight = function () { return 700 }; this.getRoot = function () { return ct }; disposeComponent = function () { tt = null; b = null; h = null; s = null; l = null; it = null; lt = null; w = null; at = null; c = null; vt = null; u = null; yt = null; e = null; pt = null; f = null; wt = null; i = null; ui = null; fi = null; ei = null; oi; si = null; v = null; hi = null; p = null; ci = null; li = null; ai = null; rt = null; ut = null; ti = null; this.grdname = null; ft = null; nt = null; vi = null; et = null; yi = null; kt = null; o = null; k = null; st = null; dt = null; a = null; ct = null } } n.AForms = n.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; var i = this.Initialize(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { disposeComponent(); this.frame = null }; n.AForms.productContainerMove = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function et(n) { var t; return n = n.toUpperCase(), n.contains("M_LOCATOR_ID") ? t = n.substr(n.indexOf("M_LOCATOR_ID=") + 13, n.length) : n.contains("M_LOCATORTO_ID") && (t = n.substr(n.indexOf("M_LOCATORTO_ID=") + 15, n.length)), t != undefined && (t = t.contains("AND") ? t.substr(0, t.indexOf("AND")).trim() : t.trim()), t } function g(u) { t.ajax({ url: n.Application.contextUrl + "ProductContainer/LoadContainerAsTree", type: "GET", datatype: "json", contentType: "application/json; charset=utf-8", data: { warehouse: i, locator: r, container: 0, validation: f }, success: function (n) { u(n) }, error: function () { n.ADialog.error("VIS_ErrorLoadingFromController") } }) } function nt(n) { var r, i, e, f; for (o = '<div id=containerParent style="width:100%;height:400px"><div><div class="well VIS_tree-container" style="width:100%;float: left;"><div id=containerParent1 style="overflow-y: auto;height: 383px;"><ul class="nav nav-list">', r = JSON.parse(n), i = 0; i < r.length; i++)if (i == 0) { w(r[i], r[i].Level); continue } else if (r[i - 1].Level < r[i].Level) { o += '<ul class="nav nav-list tree" style="display: none;">'; w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li> <\/ul>"); continue } else if (r[i - 1].Level == r[i].Level && r[i].Level != 1) { o += "<\/li>"; w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li>"); continue } else if (r[i - 1].Level > r[i].Level && r[i].Level != 1) { if (r[i - 1].Level > r[i].Level) for (e = r[i - 1].Level - r[i].Level, f = 0; f < e; f++)tt(); w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li>"); continue } else if (r[i].Level == 1) { if (r[i - 1].Level > r[i].Level) for (e = r[i - 1].Level - 1, f = 0; f < e; f++)tt(); o += "<\/li>"; o += '<li class="divider"><\/li>'; w(r[i], r[i].Level); i + 1 == r.length && (o += "<\/li>"); continue } o += "<\/ul> <\/div> <\/div> <\/div> <\/div>"; t("#VIS_ContainerParentChild").html(o); h = t("#VIS_ContainerParentChild")[0]; t("label.tree-toggler").click(function () { var n = t(h); n.find(".nav-header").removeClass("current"); t(t(this)).addClass("current"); t(this).parent().children("ul.tree").toggle(300) }); b.click(function () { c.val() != "" && it(t(h), c.val()); c.val() == "" && t(h).find(".nav-header").removeClass("current") }); u && b.trigger("click"); t(document).keypress(function (n) { var i = n.keyCode ? n.keyCode : n.which; i == 13 && n.preventDefault(); i == "13" && c.val() != "" && it(t(h), c.val()) }); t(document).keyup(function () { $NameInput.val() != "" ? $NameInput.css("background-color", rt(!1)) : $NameInput.css("background-color", rt(!0)) }) } function w(n, t) { o += t == 1 ? "<li data-value=" + n.M_ProductContainer_ID + ' class="First">' : "<li data-value=" + n.M_ProductContainer_ID + ">"; o += '<label class="tree-toggler nav-header" for=' + n.M_ProductContainer_ID + ">" + n.ContainerName + '<span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span><\/label>' } function tt() { o += "<\/li> <\/ul>" } function it(n, i) { var r = n.find("label:contains('" + i + "')"); t("label").removeClass("current"); r.addClass("current"); t(r).parents(".First").find("ul.tree:last-child").css("display") == "none" ? (t(r).parents(".First").find("ul.tree:last-child").toggle(), t(r).parents(".First").find("ul.tree:last-child").css("display", "block")) : t(r).parents(".First").find("ul.tree:last-child").css("display", "block"); r[0].scrollIntoView() } function ot(u, f, e, o, s) { t.ajax({ url: n.Application.contextUrl + "ProductContainer/SaveContainer", datatype: "json", async: !1, contentType: "application/json; charset=utf-8", data: { warehouseId: i, locatorId: r, value: u, name: f, height: e, width: o, parentContainerId: s }, success: function (i) { JSON.parse(i) == "" ? (n.ADialog.info("VIS_ContainerInserted", !0, "", ""), t(h).empty(), h = t("<div id='VIS_ContainerParentChild' style='height:382px; float: left; width: 100%;'><\/div>"), g(nt), ut(), ft()) : n.ADialog.error("", !0, JSON.parse(i), "") }, error: function () { n.ADialog.error("VIS_ErrorLoadingFromController") } }) } function rt(n) { return n ? "#FFB6C1" : "White" } function ut() { y = e.find("#AddNewContainer"); y[0].style.display = "none"; a[0].style.display = "flex"; l[0].style.display = "none"; v[0].style.display = "none"; e.find("#VIS_DialogOKCancelProductContainer")[0].style.display = "block"; e.find("#containerParent").css("height", "400px"); e.find("#containerParent1").css("height", "383px"); e.find("#VIS_ContainerParentChild").css("height", "382px"); p[0].style.display = "none" } function st() { y = e.find("#AddNewContainer"); y[0].style.display = "block"; a[0].style.display = "none"; l[0].style.display = "flex"; v[0].style.display = "flex"; e.find("#VIS_DialogOKCancelProductContainer")[0].style.display = "none"; e.find("#containerParent").css("height", "295px"); e.find("#containerParent1").css("height", "275px"); e.find("#VIS_ContainerParentChild").css("height", "265px"); p[0].style.display = "block" } function ft() { $searchInput.val(""); $NameInput.val(""); $HeightInput.val(""); $WidthInput.val("") } var d = this; this.onClose = null; this.onClosing = null; var e = null, s = null, o, h = null, b = null, c = null, l = null, a = null, v = null, y = null, k, p = null; this.showDialog = function () { var o, w = "", y, tt; f != null ? o = et(f) : r > 0 && (o = r); o != null && (w = n.dataContext.getJSONRecord("ProductContainer/GetWarehouseAndLocatorName", o)); e = t("<div class='vis-formouterwrpdiv' style='float: left; width: 100%;min-height:480px; max-height:480px !important'><\/div>"); tt = t("<div id='AddNewContainer' style='float: left; width: 100%; display:none;'><div class='VIS_form-data-row'><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_SearchValue' type='text' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Value") + "<\/label><\/div><\/div><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_Name' type='text' class='vis-ev-col-mandatory' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Name") + "<\/label><\/div><\/div><\/div><div class='VIS_form-data-row'><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_Height' type='Number' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Height") + "<\/label><\/div><\/div><div class='VIS_form-data-col input-group vis-input-wrap'><div class='vis-control-wrap'><input id='VIS_Width' type='Number' placeholder=' ' data-placeholder=''><label>" + n.Msg.translate(n.Env.getCtx(), "Width") + "<\/label><\/div><\/div><\/div><div class='VIS_form-data-row' style='display: none;'><div class='VIS_form-data-col'><label>" + n.Msg.translate(n.Env.getCtx(), "Ref_M_Container_ID") + "<\/label><\/div><\/div><\/div>"); y = t("<div class='VIS_form-data-row'><div class='VIS_form-search-wrap input-group vis-input-wrap'><div class='vis-control-wrap'><input class='VIS_form-search-wrap input' id='VIS_Search' type='text' placeholder='Search Here...' data-hasbtn=' '><\/div><div class='input-group-append'><button class='VIS_form-search-wrap button input-group-text' id=VIS_BtnSearch title=" + n.Msg.translate(n.Env.getCtx(), "VIS_Search") + "><i class='vis vis-search'><\/i><\/button><button class='VIS_form-search-wrap button input-group-text' id=VIS_BtnAdd title=" + n.Msg.translate(n.Env.getCtx(), "VIS_NewContainer") + "><i class='vis vis-plus'><\/i><\/button><button class='VIS_form-search-wrap button input-group-text' style='display:none;' id=VIS_BtnSave title=" + n.Msg.translate(n.Env.getCtx(), "VIS_SaveContainer") + "><i class='vis vis-save'><\/i><\/button><button class='VIS_form-search-wrap button input-group-text' style='display:none;' id=VIS_BtnCancel title=" + n.Msg.translate(n.Env.getCtx(), "VIS_Cancel") + "><i class='vis vis-mark'><\/i><\/button><\/div><\/div>"); h = t("<div id='VIS_ContainerParentChild' class='VIS_Tree-Container' ><\/div>"); k = t("<div id='VIS_DialogOKCancelProductContainer' class='VIS_buttons-wrap VIS_pop-btn-wrap' style='display:block;'> <span class='btn' id=VIS_DialogOK>" + n.Msg.translate(n.Env.getCtx(), "VIS_DialogOK") + "<\/span> <span class='btn' id=VIS_DialogCancel>" + n.Msg.translate(n.Env.getCtx(), "VIS_DialogCancel") + "<\/span> <\/div>"); p = t("<div id='VIS_LabelInfo' class='VIS_Tree-Container-labelInfo'><label>" + w + "<\/label><\/div>"); y.append(h); e.append(tt).append(y).append(k).append(p); s = new n.ChildDialog; s.setContent(e); s.setTitle(n.Msg.translate(n.Env.getCtx(), "VIS_Container")); s.setWidth("450px"); s.setEnableResize(!1); s.setModal(!0); s.show(); s.hidebuttons(); b = e.find("#VIS_BtnSearch"); c = e.find("#VIS_Search"); $searchInput = e.find("#VIS_SearchValue"); $NameInput = e.find("#VIS_Name"); $HeightInput = e.find("#VIS_Height"); $WidthInput = e.find("#VIS_Width"); a = e.find("#VIS_BtnAdd"); l = e.find("#VIS_BtnSave"); v = e.find("#VIS_BtnCancel"); $DialogbtnOk = e.find("#VIS_DialogOK"); $DialogbtnCancel = e.find("#VIS_DialogCancel"); $DialogbtnOk.click(function () { var i = h, r = t(i).find(".current").length, u, f; if (r > 1) return n.ADialog.error("VIS_SelectSingleContainer", !0, "", ""), !1; if (r > 0) { u = parseInt(t(i).find(".current")[0].htmlFor); f = t(t(i).find(".current")[0]).text(); d.onClosing(u, f); s.close() } else s.close() }); $DialogbtnCancel.click(function () { s.close() }); u && c.val(u); g(nt); a.click(function () { st() }); v.click(function () { ut(); ft() }); l.click(function () { var s, u; if ($NameInput.val() == "") return n.ADialog.error("VIS_ContainerNameNotSelected", !0, "", ""), !1; if (s = f, i == "" && r == "" && f == "") return n.ADialog.error("VIS_WarehouseOrLocatorNotFound", !0, "", ""), !1; f != null && (f = f.toUpperCase(), f.contains("M_LOCATOR_ID") ? u = f.substr(f.indexOf("M_LOCATOR_ID=") + 13, f.length) : f.contains("M_LOCATORTO_ID") && (u = f.substr(f.indexOf("M_LOCATORTO_ID=") + 15, f.length)), u != undefined && (r = u.contains("AND") ? u.substr(0, u.indexOf("AND")).trim() : u.trim(), parseInt(r) == 0 && n.ADialog.error("VIS_WarehouseOrLocatorNotFound", !0, "", ""))); var e = h, c = t(e).find(".current").length, o = 0; if (c <= 1) t(e).find(".current")[0] != undefined && (o = parseInt(t(e).find(".current")[0].htmlFor)); else return n.ADialog.error("VIS_SelectSingleContainer", !0, "", ""), !1; ot($searchInput.val(), $NameInput.val(), $HeightInput.val() == "" ? 0 : $HeightInput.val(), $WidthInput.val() == "" ? 0 : $WidthInput.val(), o) }) }; jQuery.expr[":"].contains = function (n, t, i) { return jQuery(n).text().toUpperCase().indexOf(i[3].toUpperCase()) >= 0 }; this.disposeComponent = function () { d = null; e = null; s = null; o; h = null; b = null; c = null; p = null; l = null; a = null; v = null; y = null; k; this.disposeComponent = null } } i.prototype.dispose = function () { this.disposeComponent() }; n.productContainerTree = i }(VIS, jQuery), function (n, t) { function i(i, r, u, f) { function y() { h = t("<div class='vis-height-full'>"); l = t("<div class='vis-apanel-busy'>"); s = t("<div class='vis-height-full'>"); h.append(s).append(l); e = new n.ChildDialog; p() } function p() { n.dataContext.getFormDataString({ AD_Form_ID: r }, function (i) { if (i.error != null) { n.ADialog.error(i.error); o.dispose(); o = null; return } var r = t.parseJSON(i.result); if (r.IsError) { n.ADialog.error(r.Message); o.dispose(); o = null; return } e.setTitle(r.DisplayName); openForm(r, o, f); r = null }) } function w(n) { e.setContent(s); n.setHeight ? e.setHeight(n.setHeight()) : e.setHeight(i); n.setWidth ? e.setWidth(n.setWidth()) : e.setWidth(window.innerWidth - 100); e.setModal(!0); e.onClose = function () { n.dispose && n.dispose(); e.dispose && e.dispose(); u.dataRefresh(); o.disposeComponent && o.disposeComponent() }; e.show(); e.hidebuttons() } var h, l, s, e, v = n.Env.getCtx(), a = n.Logging.VLogger.getVLogger("VIS.AForm"), c = n.Env.getWindowNo(), o = this; y(); this.getWindowNo = function () { return c }; this.getAD_Table_ID = function () { return u.getAD_Table_ID() }; this.getAD_Window_ID = function () { return u.getAD_Window_ID() }; this.getRecord_ID = function () { return u.getRecord_ID() }; this.getContentGrid = function () { return s }; this.close = function () { e && e.close() }; this.disposeComponent = function () { h.remove(); h = null; s.remove(); s = null; this.getContentGrid = null; o = null }; openForm = function (t, i, r) { var f, s, e; if (t.IsReport) return n.ADialog.info("Form Report is not supported"), !1; f = ""; f = t.Prefix + t.ClassName; console.log(f); a.info("Form Name= " + t.Name + ", Class=" + f); v.setWindowContext(c, "WindowName", t.DisplayName); try { s = n.Utility.getFunctionByName(f, window); e = new s(c); e.init(r, o); e.setRecordID && e.setRecordID(u.getRecord_ID()); w(e) } catch (h) { return a.log(n.Logging.Level.WARNING, "Class=" + f + ", AD_Form Name=" + t.Name, h), !1 } return !0 } } n.WForm = i }(VIS, jQuery), function (n, t) { function i(t, i, r, u, f, e, o) { this._tblName = t; this.rec_ID = r; this.sqlWhere = u; this.gFields = i; this._callbackClose = o; this._newRec = e; this.gridCols = []; this.htmlUI = []; this.deletable = !1; this.maintTblVer = f; this.defaultColsIniPos = [Version = n.Msg.getMsg("VIS_RecordVersion"), ValidFrom = n.Msg.translate(n.Env.getCtx(), "VersionValidFrom"), Approved = n.Msg.getMsg("VIS_IsVersionApproved"),]; this.defaultColEleIniPos = [Version = "RECORDVERSION", ValidFrom = "VERSIONVALIDFROM", Approved = "ISVERSIONAPPROVED"]; this.defaultCols = [VersionLog = n.Msg.translate(n.Env.getCtx(), "VersionLog"), Delete = n.Msg.getMsg("Action")]; this.defaultColElements = [VersionLog = "VERSIONLOG", Delete = "ACTION"]; this.exclCols = [Tenant = "AD_Client_ID", Created = "Created", CreatedBy = "CreatedBy", Updated = "Updated", UpdatedBy = "UpdatedBy", Export_ID = "Export_ID"] } i.prototype.show = function () { var o = !1, f = null, s = null, i = null, r = this, c = this._tblName + ",true," + this.sqlWhere, l = n.dataContext.getJSONRecord("Common/GetIDTextData", c), a = n.dataContext.getJSONRecord("Common/CheckTableDeletable", this._tblName + "_Ver"), h = "40%", u, e; if (a == "Y" && (this.deletable = !0), u = new n.ChildDialog, e = this.getMasterVersionUI(l), u.setContent(e), this.gridCols.length > 8 && (h = "70%"), u.setWidth(h), u.setTitle(n.Msg.getMsg("MasterDataVersioning")), u.setModal(!0), u.onClose = function () { f && (f.off("click"), f = null); i && (i = null); s && (s = null); this.deletable && e.find(".vis-mas-ver-btnDel").off("click"); u = null }, u.onOkClick = function () { var s, h; if (!o && r._callbackClose) if (o = !0, s = i.val(), s && s != "" || (s = new Date), !f.prop("checked") && new Date(i.val()) > new Date) { var c = e.find(".vis-mas-ver-recRow"), l = !1, a = 0; if (c.length > 0) for (h = 0; h < c.length; h++) { var v = t(c[h]), y = v.find(".vis-mas-ver-valFromDate"), p = new Date(t(y).attr("valdt")).getTime(), w = new Date(new Date(i.val()).setHours(0, 0, 0, 0)).getTime(); if (p == w) { l = !0; a = v.attr("recid"); break } } if (l) return n.ADialog.confirm("VersionExistOverwrite", !0, "", "Confirm", function (n) { n ? (r._callbackClose(f.prop("checked"), s, a), u.close(), o = !1) : o = !1 }), !1; r._callbackClose(f.prop("checked"), s, 0); o = !1 } else r._callbackClose(f.prop("checked"), s, 0), o = !1 }, u.onCancelClick = function () { u.close() }, u.show(), this.deletable) e.find(".vis-mas-ver-btnDel").on("click", function (i) { var u = t(i.target).closest(".vis-mas-ver-recRow"), o, f; if (u.length > 0 && (o = u.attr("recid"), o > 0)) { if (f = !1, f) return; n.ADialog.confirm("DeleteConfirm", !0, "", "Confirm", function (t) { if (f = !0, t) { var s = r._tblName + "_Ver," + o, i = n.dataContext.getJSONRecord("Common/DeleteRecord", s); i && i.Success && i.Success == "Y" ? (u.remove(), u = e.find(".vis-mas-ver-recRow"), u.length <= 0 && e.find(".vis-mas-ver-gridData").append(r.getNoRecDiv())) : i.Success && i.Msg != "" ? n.ADialog.error(i.Msg) : n.ADialog.error(n.Msg.getMsg("ErrorDeletingRecord")); f = !1 } else f = !1 }) } }); f = e.find(".vis-mas-ver-chkImmSave"); s = e.find(".vis-mas-ver-secValFrom"); i = e.find(".vis-mas-ver-dtVerVal"); f.on("click", function () { s.toggle(); f.prop("checked") || (r._newRec ? i.val(r.getDateString(!0)) : i.val(r.getDateString())) }); i.on("change", function () { var n = new Date(i.val()).setHours(0, 0, 0, 0), t = (new Date).setHours(0, 0, 0, 0); n == t && i.val(r.getDateString()); r._newRec && n >= t && i.val(r.getDateString(!0)) }) }; i.prototype.getMasterVersionUI = function (i) { return t('<div class= "vis-mas-ver-outerwrap"><div class="vis-mas-ver-text">' + n.Msg.getMsg("VersioningColsFoundValidFrom") + '<\/div><div style="display: flex;"><div class="vis-mas-ver-checkwrap"><input type="checkbox" class="vis-mas-ver-ImmSav vis-mas-ver-chkImmSave" checked="checked"><label>' + n.Msg.getMsg("SaveImmediate") + '<\/label><\/div><div class="vis-mas-ver-fieldwrap vis-mas-ver-checkwrap vis-mas-ver-secValFrom" style="display: none;"><label>' + n.Msg.getMsg("VersionValidFrom") + '<\/label><input type="date" class="vis-mas-ver-ImmSav vis-mas-ver-dtVerVal"><\/div><\/div>' + this.getGrid(i) + "<\/div>") }; i.prototype.getGrid = function (i) { var a, o, s, l, h, p, e; if (this.htmlUI.push('<div class= "vis-mas-ver-gridSection" style="min-height: 300px;">'), this.htmlUI.push("<table>"), a = n.Application.contextUrl + "Areas/VIS/Images/base/delete10.png", this.htmlUI.push('<thead class="vis-mas-ver-gridData">'), this.htmlUI.push(this.createHeaders()), this.htmlUI.push("<\/thead>"), i && i.Table) if (i.Table.length > 0) { for (this.htmlUI.push("<tbody>"), o = 0; o < i.Table.length; o++) { var v = i.Table[o], c = Object.keys(v), u = {}; for (s = 0; s < c.length; s++)u[c[s].toUpperCase()] = v[c[s]]; for (l = "", o % 2 == 0 && (l = "style='background-color: #ebf1f3;'"), this.htmlUI.push('<tr recid="' + u[this._tblName.toUpper() + "_VER_ID"] + '"  ' + l + ' class="vis-mas-ver-recRow">'), h = 0; h < this.gridCols.length; h++) { var r = this.gridCols[h], f = t.grep(this.gFields, function (n) { return n.vo.ColumnName.toUpper() == r })[0], y = "---"; u[r + "_TXT"] ? this.htmlUI.push("<td>" + n.Utility.encodeText(u[r + "_TXT"]) + "<\/td>") : r == "ACTION" ? this.deletable && this.htmlUI.push("<td style='text-align: center;'><button class='vis-mas-ver-btnDel'><img src='" + a + "' /><\/button><\/td>") : u[r + "_LOC"] || u[r + "_LTR"] || u[r + "_ASI"] || u[r + "_ACT"] || u[r + "_CTR"] ? (f && (y = f.getLookup().getDisplay(f.value)), this.htmlUI.push("<td>" + n.Utility.encodeText(y) + "<\/td>")) : u[r] ? r == "ISVERSIONAPPROVED" || f && f.vo && f.vo.displayType && f.vo.displayType == 20 ? u[r] == "Y" ? this.htmlUI.push('<td style="text-align: center;"><input type="checkbox" checked="checked" disabled><\/td>') : this.htmlUI.push('<td style="text-align: center;"><input type="checkbox" disabled><\/td>') : r == "VERSIONVALIDFROM" ? (p = Globalize.format(new Date(u[r]), "d"), this.htmlUI.push('<td class="vis-mas-ver-valFromDate" valdt="' + new Date(u[r]) + '">' + p + "<\/td>")) : f && f.vo && f.vo.displayType && f.vo.displayType == 15 ? (e = Globalize.format(new Date(u[r]), "d"), this.htmlUI.push('<td dtDate="' + new Date(u[r]) + '">' + e + "<\/td>")) : f && f.vo && f.vo.displayType && f.vo.displayType == 16 ? (e = Globalize.format(new Date(u[r] + "Z"), "f"), this.htmlUI.push('<td dtDate="' + new Date(u[r]) + '">' + e + "<\/td>")) : f && f.vo && f.vo.displayType && f.vo.displayType == 24 ? (e = Globalize.format(new Date(u[r] + "Z"), "t"), this.htmlUI.push('<td dtDate="' + new Date(u[r]) + '">' + e + "<\/td>")) : r == "RECORDVERSION" ? this.htmlUI.push('<td style="text-align: center">' + n.Utility.encodeText(u[r]) + "<\/td>") : this.htmlUI.push("<td>" + n.Utility.encodeText(u[r]) + "<\/td>") : this.htmlUI.push("<td> --- <\/td>") } this.htmlUI.push("<\/tr>") } this.htmlUI.push("<\/tbody>") } else this.htmlUI.push(this.getNoRecDiv()); else this.htmlUI.push(this.getNoRecDiv()); return this.htmlUI.push("<\/table>"), this.htmlUI.push("<\/div>"), this.htmlUI.join(" ") }; i.prototype.createHeaders = function () { var t = [], r, i; if (t.push('<tr style="border-bottom: 2px #b5b3b3 solid;">'), this.gFields && this.gFields.length > 0) { for (this.createVerColsHdrs(t, this.defaultColsIniPos, this.defaultColEleIniPos), r = 0; r < this.gFields.length; r++)i = this.gFields[r], (i.vo.IsMaintainVersions || this.maintTblVer) && this.exclCols.indexOf(i.vo.ColumnName) < 0 && (this.gridCols.push(i.vo.ColumnName.toUpper()), i.vo.displayType == 20 ? t.push('<th style="text-align: center;">' + n.Utility.encodeText(i.vo.Header) + "<\/th>") : t.push("<th>" + n.Utility.encodeText(i.vo.Header) + "<\/th>")); this.createVerColsHdrs(t, this.defaultCols, this.defaultColElements) } return t.push("<\/tr>"), t.join(" ") }; i.prototype.createVerColsHdrs = function (t, i, r) { for (var u = 0; u < i.length; u++)this.gridCols.push(r[u]), r[u] == "ACTION" ? this.deletable && t.push('<th style="text-align: center;">' + n.Utility.encodeText(i[u]) + "<\/th>") : r[u] == "ISVERSIONAPPROVED" || r[u] == "RECORDVERSION" ? t.push('<th style="text-align: center;">' + n.Utility.encodeText(i[u]) + "<\/th>") : t.push("<th>" + n.Utility.encodeText(i[u]) + "<\/th>") }; i.prototype.getDateString = function (n) { var t = new Date, u, i, r; return n ? t.setDate(t.getDate() - 1) : t.setDate(t.getDate() + 1), u = t.getFullYear(), i = t.getMonth() + 1, i < 10 && (i = "0" + i), r = t.getDate(), r < 10 && (r = "0" + r), u + "-" + i + "-" + r }; i.prototype.getNoRecDiv = function () { return '<div class="vis-mas-ver-norecord">' + n.Utility.encodeText(n.Msg.getMsg("NoRecords")) + "<\/div>" }; n.MasterDataVersion = i }(VIS, jQuery); VIS = window.VIS || {}, function () { function n() { var i, t, n, r; this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.selectedRow = null; this.panelWidth; this.extraInfo = null; this.init = function () { if (i = $('<div style="height:100%;width:100%"><\/div>'), window.VA037) t = $('<iframe height=100%; width="100%"; frameborder="0" ><\/iframe>'), i.html(t); else { var n = $('<span class="vis-bi-tab-panel">' + VIS.Msg.getMsg("PleaseInstallBIReportTool") + "<\/span>"); i.append(n) } }; this.update = function (n) { r(n) }; this.getRoot = function () { return i }; n = this; r = function (i) { var u, f, e, r, o; if (t) { if (u = n.extraInfo, f = u.match(/\@.+?\@/g), f) for (e = 0; e < f.length; e++)r = f[e].replaceAll("@", ""), VIS.Env.getCtx().getContext(r).length > 0 ? r = VIS.Env.getCtx().getContext(r) : VIS.Env.getCtx().getContext(n.windowNo, r).length > 0 ? r = VIS.Env.getCtx().getContext(n.windowNo, r) : VIS.Env.getCtx().getContext(n.windowNo, n.curTab().getTabNo(), r).length > 0 && (r = VIS.Env.getCtx().getContext(n.windowNo, n.curTab().getTabNo(), r)), u = u.replaceAll(f[e], r); o = VIS.Application.contextUrl + "BiPanel/GetUserBILogin?recID=" + i + "&extraInfo=" + window.encodeURIComponent(u); t.prop("src", o) } }; this.disposeComponent = function () { t && t.remove(); i.remove(); t = null; i = null } } n.prototype.startPanel = function (n, t, i) { this.windowNo = n; this.curTab = t; this.extraInfo = i; this.init() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n) { this.panelWidth = n }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.BiPanel = n }(); VIS = window.VIS || {}, function (n, t) { function i() { n.CalloutEngine.call(this, "calloutColumn") } n.Utility.inheritPrototype(i, n.CalloutEngine); i.prototype.setDBColumnName = function (i, r, u, f, e, o) { if (!this.isCalloutActive() && e != null && e != 0) { this.setCalloutActive(!0); var s = u; return t.ajax({ url: n.Application.contextUrl + "VIS/CalloutColumn/GetDBColunName", data: { AD_Element_ID: e }, success: function (n) { n && s.setValue("ColumnName", n) }, error: function (n) { this.log.severe(n) } }), this.setCalloutActive(!1), i = r = u = f = e = o = null, "" } }; n.calloutColumn = i }(VIS, jQuery), function (n, t) { function i() { function b() { var u, b, k; if (o = t('<div class="vis-gl-main-wrap">'), u = n.context.getWindowContext(r.windowNo, "AD_Column_ID", !0), u == "") return n.ADialog.error("VIS_DimensionColNotSelected", !0, "", ""), !1; b = n.dataContext.getJSONRecord("GlJournall/ColumnName", u); s = t('<div class="vis-gl-form-wrap">'); h = t('<div class="vis-gl-form-row">'); c = t('<div class="vis-gl-form-col">'); w = t("<label>" + n.Msg.translate(e, b) + "<\/label>"); c.append(w); $formDataR = t('<div class="vis-gl-form-col2">'); k = n.MLookupFactory.getMLookUp(e, r.windowNo, n.Utility.Util.getValueOfString(u), n.DisplayType.Search); i = new n.Controls.VTextBoxButton(b, !1, !1, !0, n.DisplayType.Search, k); $formDataR.append(t("<div>").append(i).append(i.getControl()).append(i.getBtn(0))); h.append(c).append($formDataR); s.append(h); l = t('<div class="VIS_buttons-wrap .vis-gl-buttons-wrap">'); a = t('<div class="pull-right">'); v = t('<span class="btn vis-gl-buttons-wrap-span">' + n.Msg.translate(e, "VIS_OK") + "<\/span>"); y = t('<span class="btn vis-gl-buttons-wrap-span">' + n.Msg.translate(e, "Cancel") + "<\/span>"); a.append(v).append(y); l.append(a); o.append(s).append(l); p.append(o).append(f) } function k() { var t = n.context.getWindowContextAsInt(r.windowNo, "DimensionValue", !0); t > 0 && i.setValue(t); v.on("click", function () { if (u(!0), i.getValue() == null) return u(!1), n.ADialog.error("VIS_DimensionNotSelected", !0, "", ""), !1; var t = n.context.getWindowContext(r.windowNo, "GL_LineDimension_ID", !0), f = t.toString().concat(",", i.getValue().toString()), e = n.dataContext.getJSONRecord("GlJournall/SaveDimensionReference", f); if (e <= 0) return u(!1), n.ADialog.error("VIS_NotSaved", !0, "", ""), !1; n.ADialog.info("VIS_Saved", !0, "", ""); u(!1); r.frame.close() }); y.on("click", function () { r.frame.close() }) } function u(n) { f[0].style.visibility = n ? "visible" : "hidden" } this.frame; this.windowNo; var r = this, p = t("<div style='height:100%;background-color:white;' class='vis-forms-container' >"), f = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), e = n.Env.getCtx(), o = null, s = null, h = null, c = null, w = null, i = null, l = null, a = null, v = null, y = null; this.Initialize = function () { u(!0); b(); k(); u(!1) }; this.setHeight = function () { return 235 }; this.setWidth = function () { return 368 }; this.getRoot = function () { return p }; this.disposeComponent = function () { r = null; p = null; f = null; o = null; s = null; h = null; c = null; w = null; i = null; l = null; a = null; v = null; y = null } } n.AForms = n.AForms || {}; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.Initialize(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame = null }; n.AForms.glDimensionValue = i }(VIS, jQuery); VIS = window.VIS || {}, function (n, t) { n.CreateRelatedLines = function () { function bt() { ft = n.MLookupFactory.getMLookUp(n.Env.getCtx(), r.windowNo, 10853, n.DisplayType.List); w = new n.Controls.VComboBox("RelatedProductType", !1, !1, !0, ft, 50); ut.prepend(w.getControl()); rt = n.MLookupFactory.getMLookUp(n.Env.getCtx(), r.windowNo, 2221, n.DisplayType.Search); h = new n.Controls.VTextBoxButton("M_Product_ID", !0, !1, !0, n.DisplayType.Search, rt); var u = t('<div class="vis-control-wrap">'), i = t('<div class="input-group-append">'); b.append(u); u.append(h.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.translatedTexts.M_Product_ID + "<\/label>"); b.append(i); i.append(h.getBtn(0)); i.append(h.getBtn(1)); n.Env.getCtx().setContext(r.windowNo, "M_Product_ID", null); y = new n.MPAttributeLookup(n.context, r.windowNo); et = new n.Controls.VPAttribute("M_AttributeSetInstance_ID", !1, !1, !0, n.DisplayType.PAttribute, y, r.windowNo, !1, !1, !1, !0); ot = new n.Controls.VPAttribute("M_AttributeSetInstance_ID", !1, !1, !0, n.DisplayType.PAttribute, y, r.windowNo, !1, !1, !1, !0); k = n.MLookupFactory.getMLookUp(n.Env.getCtx(), r.windowNo, 2222, n.DisplayType.TableDir); d = n.MLookupFactory.getMLookUp(n.Env.getCtx(), r.windowNo, 2222, n.DisplayType.TableDir); st = new n.Controls.VComboBox("C_UOM_ID", !0, !1, !0, k, 50); ht = new n.Controls.VComboBox("C_UOM_ID", !0, !1, !0, d, 50); pt = n.Env.getCtx().getContextAsInt(r.windowNo, "C_BPartner_ID", !1); wt = n.Env.getCtx().getWindowContext(r.windowNo, "IsSOTrx", !0) == "Y"; c = n.Env.getCtx().getContextAsInt(r.windowNo, "M_PriceList_ID", !1) } function kt(t, i, u, f) { n.dataContext.getJSONData(n.Application.contextUrl + "RelatedProduct/GetProductData", { M_Product_ID: t, M_AttributeSetInstance_ID: i, C_UOM_ID: u, M_PriceList_ID: f, Table_ID: r.Table_ID, Record_ID: r.Record_ID }, dt) } function dt(n) { n != null && u.add(n); vt(a, 0, 0, c) } function vt(t, i, u, f) { n.dataContext.getJSONData(n.Application.contextUrl + "RelatedProduct/GetRelatedProduct", { M_Product_ID: t, M_AttributeSetInstance_ID: i, C_UOM_ID: u, M_PriceList_ID: f, RelatedProductType: at, Table_ID: r.Table_ID, Record_ID: r.Record_ID }, gt) } function gt(n) { if (n != null && i.add(n), i.records.length > 0) for (var r = 0; r < i.records.length; r++)i.records[r].RelatedProductType == "M" && t(t("#grid_" + i.name + "_rec_" + (r + 1)).find("input[type=checkbox]")).prop("checked", !0).attr("disabled", !0); e[0].style.visibility = "hidden" } function ni() { h.fireValueChanged = function () { h.value != null ? (e[0].style.visibility = "visible", a = h.value, u.clear(), i.clear(), kt(a, 0, 0, c)) : (a = 0, u.clear(), i.clear()) }; w.fireValueChanged = function () { e[0].style.visibility = "visible"; at = w.getValue(); i.clear(); vt(a, 0, 0, c) }; nt.on("click touchstart", function () { if (i.records.length > 0) for (var t = 0; t < i.records.length; t++)i.records[t].RelatedProductType == "M" && i.select(t + 1); u.records.length > 0 ? (e[0].style.visibility = "visible", yt(), CreateLines(!1)) : n.ADialog.error("VIS_PlzSelLines") }); tt.on("click touchstart", function () { if (i.records.length > 0) for (var t = 0; t < i.records.length; t++)i.records[t].RelatedProductType == "M" && i.select(t + 1); u.records.length > 0 ? (e[0].style.visibility = "visible", yt(), CreateLines(!0)) : n.ADialog.error("VIS_PlzSelLines") }); it.on("click touchstart", function () { r.frame.close() }) } function yt() { var t, n; for (p = [], p.push({ Product_ID: u.records[0].Product_ID, Product: u.records[0].Product, AttributeSetInstance_ID: u.records[0].M_AttributeSetInstance_ID, UOM_ID: u.records[0].UOM_ID, UOM: u.records[0].UOM_ID, RelatedProductType: u.records[0].RelatedProductType, RelatedType: u.records[0].RelatedType, Value: u.records[0].Value, QtyEntered: u.records[0].QtyEntered, PriceStd: u.records[0].PriceStd, PriceList: u.records[0].PriceList }), t = i.getSelection(), n = 0; n < t.length; n++)p.push({ Product_ID: i.records[t[n] - 1].Product_ID, Product: i.records[t[n] - 1].Product, AttributeSetInstance_ID: i.records[t[n] - 1].M_AttributeSetInstance_ID, UOM_ID: i.records[t[n] - 1].UOM_ID, UOM: i.records[t[n] - 1].UOM_ID, RelatedProductType: i.records[t[n] - 1].RelatedProductType, RelatedType: i.records[t[n] - 1].RelatedType, Value: i.records[t[n] - 1].Value, QtyEntered: i.records[t[n] - 1].QtyEntered, PriceStd: i.records[t[n] - 1].PriceStd, PriceList: i.records[t[n] - 1].PriceList }) } function l(t, i) { var f = !1, u, r; if (t.value_new = n.Utility.Util.getValueOfString(i), t.value_new.contains(".")) { for (f = !0, u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "." && u.push(r); u.length > 1 && (t.value_new = g(t.value_new, ".")) } if (t.value_new.contains(",")) if (f) t.value_new = g(t.value_new, ","); else { for (u = [], r = 0; r < t.value_new.length; r++)t.value_new[r] === "," && u.push(r); t.value_new = u.length > 1 ? g(t.value_new, ",") : t.value_new.replace(",", ".") } return t.value_new == "" && (t.value_new = "0"), t.value_new } function g(n, t) { var i = n.split(t); return n = i.slice(0, -1).join("") + "." + i.slice(-1), n.indexOf(".") == n.length - 1 && (n = n.replace(".", "")), n } function ti() { e = t("<div class='vis-apanel-busy'>"); e.css({ position: "absolute", width: "98%", height: "97%", "text-align": "center", "z-index": "999" }); e[0].style.visibility = "visible"; o.append(e) } var s, f; this.frame; this.windowNo; this.Record_ID; this.Table_ID; var e, r = this, nt, tt, it, o = t("<div>"), p, rt, b, y, ut, ft = null, w = null, h, k = null, d = null, et, ot, st = null, ht = null, u, ct, i, lt, a = 0, at = "", pt = 0, wt, c = 0, v = 2; n.translatedTexts = null; s = n.DisplayType.GetNumberFormat(n.DisplayType.Amount); f = n.Env.isDecimalPoint(); this.initalize = function () { n.translatedTexts = n.Msg.translate(n.Env.getCtx(), ["RelatedProductType", "M_Product_ID", "SearchKeyValue", "ASI", "C_UOM_ID", "QtyEntered", "PriceActual", "PriceList",], !0); o.append('<div class="VIS_Pref_show vis-formouterwrpdiv"><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap" id="VIS_Product_' + r.windowNo + '" ><\/div><\/div><div class= "VIS_Pref_dd"><div class="input-group vis-input-wrap"><div class="vis-control-wrap" id="VIS_RelatedType_' + r.windowNo + '"><label class="VIS_Pref_Label_Font" > ' + n.translatedTexts.RelatedProductType + "<\/label ><\/div><\/div><\/div><\/div>"); o.append('<div class="vis-crtfrm-datawrp" style="height: 15.5%;"><div id="VIS_ProductGrd_' + r.windowNo + '" style="height:80px;" ><\/div><\/div>'); o.append('<div class="vis-crtfrm-datawrp" style="height: 48.5%;"><div id="VIS_RelatedGrd_' + r.windowNo + '" style="height:250px;" ><\/div><\/div>'); o.append('<div class="vis-ctrfrm-btnwrp"><input id="VIS_CancelBtn_' + r.windowNo + '" class= "VIS_Pref_btn-2" type = "button" value = "' + n.Msg.getMsg("Cancel") + '"><input id="VIS_ApplyBtn_' + r.windowNo + '" class="VIS_Pref_btn-2" type="button" value="' + n.Msg.getMsg("Apply") + '"><input id="VIS_OKBtn_' + r.windowNo + '" class="VIS_Pref_btn-2" type="button" value="' + n.Msg.getMsg("OK") + '"><\/div>'); ti(); e[0].style.visibility = "visible" }; this.intialLoad = function () { nt = o.find("#VIS_OKBtn_" + r.windowNo); tt = o.find("#VIS_ApplyBtn_" + r.windowNo); it = o.find("#VIS_CancelBtn_" + r.windowNo); b = o.find("#VIS_Product_" + r.windowNo); ut = o.find("#VIS_RelatedType_" + r.windowNo); ct = o.find("#VIS_ProductGrd_" + r.windowNo); lt = o.find("#VIS_RelatedGrd_" + r.windowNo); bt(); ni(); e[0].style.visibility = "hidden" }; this.LoadProductGrid = function () { u = null; u = ct.w2grid({ name: "VIS_ProductGrid_" + r.windowNo, recordHeight: 25, show: { toolbar: !1, selectColumn: !1, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !0, toolbarSave: !0 }, multiSelect: !0, columns: [{ field: "Product_ID", caption: n.translatedTexts.M_Product_ID, size: "20%", display: !1 }, { field: "Value", caption: n.translatedTexts.SearchKeyValue, size: "150px" }, { field: "Product", caption: n.translatedTexts.M_Product_ID, size: "200px" }, { field: "M_AttributeSetInstance_ID", caption: n.translatedTexts.ASI, sortable: !1, size: "150px", editable: { type: "custom", ctrl: et, showAll: !0 }, render: function (n) { var t = y, i = n.M_AttributeSetInstance_ID, r; return n.changes && typeof n.changes.M_AttributeSetInstance_ID != "undefined" && (i = n.changes.M_AttributeSetInstance_ID), t && (r = t.getDisplay(i, !0)), r } }, { field: "UOM_ID", caption: n.translatedTexts.C_UOM_ID, sortable: !1, size: "120px", editable: { type: "custom", ctrl: st, showAll: !0 }, render: function (n) { var t = k, i = n.UOM_ID, r; return n.changes && typeof n.changes.UOM_ID != "undefined" && (i = n.changes.UOM_ID), t && (r = t.getDisplay(i)), r } }, { field: "UOM", caption: n.translatedTexts.C_UOM_ID, size: "20%", display: !1 }, { field: "QtyEntered", caption: "<div ><span>" + n.translatedTexts.QtyEntered + "<\/span><\/div>", sortable: !1, size: "120px", min: 80, hidden: !1, editable: { type: "number" }, render: function (n) { var t = n.QtyEntered; return t = l(event, t), parseFloat(t).toLocaleString() } }, { field: "PriceStd", caption: "<div ><span>" + n.translatedTexts.PriceActual + "<\/span><\/div>", sortable: !1, size: "120px", min: 80, hidden: !1, editable: { type: "number" }, render: function (n) { var t = n.PriceStd; return t = l(event, t), parseFloat(t).toLocaleString() } }, { field: "PriceList", caption: "<div ><span>" + n.translatedTexts.PriceList + "<\/span><\/div>", sortable: !1, size: "120px", min: 80, hidden: !1, editable: { type: "number" }, render: function (n) { var t = n.PriceList; return t = l(event, t), parseFloat(t).toLocaleString() } }], onEditField: function (n) { if (id = n.recid, n.column == 6 || n.column == 7 || n.column == 8) { u.records[n.index][u.columns[n.column].field] = l(n, u.records[n.index][u.columns[n.column].field]); var i = s.GetFormatAmount(u.records[n.index][u.columns[n.column].field], "init", f); u.records[n.index][u.columns[n.column].field] = s.GetConvertedString(i, f); t("#grid_VIS_ProductGrid_" + r.windowNo + "_rec_" + id).keydown(function (n) { if (f || n.keyCode != 190 && n.keyCode != 110) { if (f && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) ? n.target.value.indexOf(".") > -1 && (n.target.value = n.target.value.replace(".", "")) : n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && n.target.value.indexOf(",") > -1 && (n.target.value = n.target.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } }, onChange: function (t) { var i; t.column == 8 ? (i = s.GetConvertedNumber(t.value_new, f), u.records[t.index].PriceList = i.toFixed(v)) : t.column == 7 ? (i = s.GetConvertedNumber(t.value_new, f), u.records[t.index].PriceStd = i.toFixed(v)) : t.column == 6 ? (i = s.GetConvertedNumber(t.value_new, f), u.records[t.index].QtyEntered = i.toFixed(v)) : t.column == 3 ? t.value_new != null && (u.records[t.index].M_AttributeSetInstance_ID = t.value_new, n.dataContext.getJSONData(n.Application.contextUrl + "RelatedProduct/GetProductData", { M_Product_ID: a, M_AttributeSetInstance_ID: t.value_new, C_UOM_ID: n.Utility.Util.getValueOfInt(u.records[t.index].UOM_ID), M_PriceList_ID: c, Table_ID: r.Table_ID, Record_ID: r.Record_ID }, function (n) { n != null && (u.records[t.index].PriceStd = n.PriceStd, u.records[t.index].PriceList = n.PriceList, u.refreshCell(t.recid, "PriceStd"), u.refreshCell(t.recid, "PriceList")) })) : t.column == 4 && t.value_new != null && (u.records[t.index].UOM_ID = t.value_new, n.dataContext.getJSONData(n.Application.contextUrl + "RelatedProduct/GetProductData", { M_Product_ID: a, M_AttributeSetInstance_ID: n.Utility.Util.getValueOfInt(u.records[t.index].M_AttributeSetInstance_ID), C_UOM_ID: t.value_new, M_PriceList_ID: c, Table_ID: r.Table_ID, Record_ID: r.Record_ID }, function (n) { n != null && (u.records[t.index].PriceStd = n.PriceStd, u.records[t.index].PriceList = n.PriceList, u.refreshCell(t.recid, "PriceStd"), u.refreshCell(t.recid, "PriceList")) })) }, onClick: function (t) { n.Env.getCtx().setContext(r.windowNo, "M_Product_ID", n.Utility.Util.getValueOfInt(u.records[t.recid - 1].Product_ID)) } }); u.hideColumn("Product_ID"); u.hideColumn("UOM") }; this.LoadRelatedGrid = function () { i = null; i = lt.w2grid({ name: "VIS_RelatedGrid_" + r.windowNo, recordHeight: 25, show: { toolbar: !1, selectColumn: !0, toolbarReload: !1, toolbarColumns: !0, toolbarSearch: !1, toolbarAdd: !1, toolbarDelete: !0, toolbarSave: !0 }, multiSelect: !0, columns: [{ field: "Product_ID", caption: n.translatedTexts.M_Product_ID, size: "20%", display: !1 }, { field: "Value", caption: n.translatedTexts.SearchKeyValue, size: "150px" }, { field: "Product", caption: n.translatedTexts.M_Product_ID, size: "200px" }, { field: "RelatedProductType", caption: n.translatedTexts.RelatedProductType, size: "150px" }, { field: "RelatedType", caption: n.translatedTexts.RelatedProductType, size: "150px" }, { field: "M_AttributeSetInstance_ID", caption: n.translatedTexts.ASI, sortable: !1, size: "150px", editable: { type: "custom", ctrl: ot, showAll: !0 }, render: function (n) { var t = y, i = n.M_AttributeSetInstance_ID, r; return n.changes && typeof n.changes.M_AttributeSetInstance_ID != "undefined" && (i = n.changes.M_AttributeSetInstance_ID), t && (r = t.getDisplay(i, !0)), r } }, { field: "UOM_ID", caption: n.translatedTexts.C_UOM_ID, sortable: !1, size: "100px", editable: { type: "custom", ctrl: ht, showAll: !0 }, render: function (n) { var t = d, i = n.UOM_ID, r; return n.changes && typeof n.changes.UOM_ID != "undefined" && (i = n.changes.UOM_ID), t && (r = t.getDisplay(i)), r } }, { field: "UOM", caption: n.translatedTexts.C_UOM_ID, size: "20%", display: !1 }, { field: "QtyEntered", caption: "<div ><span>" + n.translatedTexts.QtyEntered + "<\/span><\/div>", sortable: !1, size: "100px", min: 80, hidden: !1, editable: { type: "number" }, render: function (n) { var t = n.QtyEntered; return t = l(event, t), parseFloat(t).toLocaleString() } }, { field: "PriceStd", caption: "<div ><span>" + n.translatedTexts.PriceActual + "<\/span><\/div>", sortable: !1, size: "100px", min: 80, hidden: !1, editable: { type: "number" }, render: function (n) { var t = n.PriceStd; return t = l(event, t), parseFloat(t).toLocaleString() } }, { field: "PriceList", caption: "<div ><span>" + n.translatedTexts.PriceList + "<\/span><\/div>", sortable: !1, size: "100px", min: 80, hidden: !1, editable: { type: "number" }, render: function (n) { var t = n.PriceList; return t = l(event, t), parseFloat(t).toLocaleString() } }], onUnselect: function (n) { n.onComplete = n.all ? function () { if (i.records.length > 0) for (var n = 0; n < i.records.length; n++)i.records[n].RelatedProductType == "M" && t(t("#grid_" + i.name + "_rec_" + (n + 1)).find("input[type=checkbox]")).prop("checked", !0).attr("disabled", !0) } : function () { i.records[n.index].RelatedProductType == "M" && t(t("#grid_" + i.name + "_rec_" + n.recid).find("input[type=checkbox]")).prop("checked", !0).attr("disabled", !0) } }, onEditField: function (u) { if (id = u.recid, u.column == 8 || u.column == 9 || u.column == 10) { i.records[u.index][i.columns[u.column].field] = l(u, i.records[u.index][i.columns[u.column].field]); var e = s.GetFormatAmount(i.records[u.index][i.columns[u.column].field], "init", f); i.records[u.index][i.columns[u.column].field] = s.GetConvertedString(e, f); t("#grid_VIS_RelatedGrid_" + r.windowNo + "_rec_" + id).keydown(function (n) { if (f || n.keyCode != 190 && n.keyCode != 110) { if (f && n.keyCode == 188) return !1 } else return !1; return n.target.value.contains(".") && (n.which == 110 || n.which == 190 || n.which == 188) ? n.target.value.indexOf(".") > -1 && (n.target.value = n.target.value.replace(".", "")) : n.target.value.contains(",") && (n.which == 110 || n.which == 190 || n.which == 188) && n.target.value.indexOf(",") > -1 && (n.target.value = n.target.value.replace(",", "")), n.keyCode != 8 && n.keyCode != 9 && (n.keyCode < 37 || n.keyCode > 40) && (n.keyCode < 48 || n.keyCode > 57) && (n.keyCode < 96 || n.keyCode > 105) && n.keyCode != 109 && n.keyCode != 189 && n.keyCode != 110 && n.keyCode != 144 && n.keyCode != 188 && n.keyCode != 190 ? !1 : void 0 }) } else u.column == 5 && n.Env.getCtx().setContext(r.windowNo, "M_Product_ID", n.Utility.Util.getValueOfInt(i.records[u.recid - 1].Product_ID)) }, onChange: function (t) { var u; t.column == 10 ? (u = s.GetConvertedNumber(t.value_new, f), i.records[t.index].PriceList = u.toFixed(v)) : t.column == 9 ? (u = s.GetConvertedNumber(t.value_new, f), i.records[t.index].PriceStd = u.toFixed(v)) : t.column == 8 ? (u = s.GetConvertedNumber(t.value_new, f), i.records[t.index].QtyEntered = u.toFixed(v)) : t.column == 5 ? t.value_new != null && (i.records[t.index].M_AttributeSetInstance_ID = t.value_new, n.dataContext.getJSONData(n.Application.contextUrl + "RelatedProduct/GetProductData", { M_Product_ID: i.records[t.index].Product_ID, M_AttributeSetInstance_ID: t.value_new, C_UOM_ID: n.Utility.Util.getValueOfInt(i.records[t.index].UOM_ID), M_PriceList_ID: c, Table_ID: r.Table_ID, Record_ID: r.Record_ID }, function (n) { n != null && (i.records[t.index].PriceStd = n.PriceStd, i.records[t.index].PriceList = n.PriceList, i.refreshCell(t.recid, "PriceStd"), i.refreshCell(t.recid, "PriceList")) })) : t.column == 6 && t.value_new != null && (i.records[t.index].UOM_ID = t.value_new, n.dataContext.getJSONData(n.Application.contextUrl + "RelatedProduct/GetProductData", { M_Product_ID: i.records[t.index].Product_ID, M_AttributeSetInstance_ID: n.Utility.Util.getValueOfInt(i.records[t.index].M_AttributeSetInstance_ID), C_UOM_ID: t.value_new, M_PriceList_ID: c, Table_ID: r.Table_ID, Record_ID: r.Record_ID }, function (n) { n != null && (i.records[t.index].PriceStd = n.PriceStd, i.records[t.index].PriceList = n.PriceList, i.refreshCell(t.recid, "PriceStd"), i.refreshCell(t.recid, "PriceList")) })) }, onClick: function (t) { n.Env.getCtx().setContext(r.windowNo, "M_Product_ID", n.Utility.Util.getValueOfInt(i.records[t.recid - 1].Product_ID)) } }); i.hideColumn("RelatedProductType"); i.hideColumn("Product_ID"); i.hideColumn("UOM") }; CreateLines = function (f) { t.ajax({ url: n.Application.contextUrl + "RelatedProduct/SaveRelatedLines", type: "POST", dataType: "json", contentType: "application/json; charset=utf-8", data: JSON.stringify({ Data: p, Table_ID: r.Table_ID, Record_ID: r.Record_ID }), success: function (t) { JSON.parse(t) != "" && (h.setValue(null, !1, !0), u.clear(), i.clear(), n.ADialog.info("", !0, JSON.parse(t), "")); e[0].style.visibility = "hidden"; f || r.frame.close() }, error: function () { e[0].style.visibility = "hidden" } }) }; this.getRoot = function () { return o } }; n.CreateRelatedLines.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.Record_ID = this.frame.getRecord_ID(); this.Table_ID = this.frame.getAD_Table_ID(); this.initalize(); this.intialLoad(); this.frame.getContentGrid().append(this.getRoot()); var i = this; window.setTimeout(function () { i.LoadProductGrid(); i.LoadRelatedGrid() }, 50); window.setTimeout(function () { }, 50) }; n.CreateRelatedLines.prototype.setHeight = function () { return "575" }; n.CreateRelatedLines.prototype.setWidth = function () { return "1050" }; n.CreateRelatedLines.prototype.dispose = function () { w2ui["VIS_ProductGrid_" + this.windowNo].destroy(); w2ui["VIS_RelatedGrid_" + this.windowNo].destroy(); this.frame = null; this.windowNo = null; $bsyDiv = null; $self = null; $OkBtn = null; $ApplyBtn = null; $root = null; _ProductLookUp = null; pattrLookup = null; puomLookup = null; pruomLookup = null; PUomCtrl = null; PRUomCtrl = null; _ProductCtrl = null; _CmbRelatedType = null; lookupRelatedType = null; ctrlRelatedType = null; PAttrCtrl = null; PRAttrCtrl = null; SelectedRecords = null } }(VIS, jQuery), function (n, t) { function i() { function di() { var t = n.dataContext.getJSONData(n.Application.contextUrl + "ForecastForm/GetTableAndRecordInfo", { AD_Table_ID: r.ad_table_ID, AD_Record_ID: r.record_ID }); t != null && (w = n.Utility.Util.getValueOfInt(t.AD_Org_ID), tt = n.Utility.Util.getValueOfString(t.Table_Name) == "C_MasterForecast" ? !0 : !1, b = n.Utility.Util.getValueOfString(t.Table_Name) == "VA073_SalesForecast" ? !0 : !1, vi = n.Utility.Util.getValueOfInt(t.TeamColumn_ID), pi = n.Utility.Util.getValueOfInt(t.BudgetColumn_ID)) } function gi() { et = t('<div class="vis-budget-main-wrap vis-formouterwrpdiv">'); s = t('<div class="vis-budget-form-wrap">'); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_Organization_' + r.windowNo + '">'); u.append(f); s.append(u); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_Period_' + r.windowNo + '">'); u.append(f); s.append(u); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_IncludeSO_' + r.windowNo + '">'); u.append(f); s.append(u); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_DocumentType_' + r.windowNo + '">'); u.append(f); s.append(u); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_IncludeOpenSalesOrder_' + r.windowNo + '">'); u.append(f); s.append(u); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_OpenSalesOrder_' + r.windowNo + '">'); u.append(f); s.append(u); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_IncludeOpportunity_' + r.windowNo + '">'); u.append(f); s.append(u); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_Opportunity_' + r.windowNo + '">'); u.append(f); s.append(u); tt && (u = t('<div class="vis-budget-form-row">'), f = t('<div class="input-group vis-input-wrap" id="VIS_TeamForecast_' + r.windowNo + '">'), u.append(f), s.append(u)); b && (u = t('<div class="vis-budget-form-row">'), f = t('<div class="input-group vis-input-wrap" id="VIS_BudgetForecast_' + r.windowNo + '">'), u.append(f), s.append(u)); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_ProductCategory_' + r.windowNo + '">'); u.append(f); s.append(u); b && (u = t('<div class="vis-budget-form-row">'), f = t('<div class="input-group vis-input-wrap" id="VIS_PriceList_' + r.windowNo + '">'), u.append(f), s.append(u)); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_BudgetQuantity_' + r.windowNo + '">'); u.append(f); s.append(u); u = t('<div class="vis-budget-form-row">'); f = t('<div class="input-group vis-input-wrap" id="VIS_GenerateLines_' + r.windowNo + '">'); u.append(f); s.append(u); yt = t('<div class="VIS_buttons-wrap .vis-budget-buttons-wrap">'); pt = t('<div class="pull-right">'); wt = t('<span class="btn vis-budget-buttons-wrap-span">' + n.Msg.translate(p, "VIS_OK") + "<\/span>"); bt = t('<span class="btn vis-budget-buttons-wrap-span">' + n.Msg.translate(p, "Cancel") + "<\/span>"); ai = t('<span class="btn vis-budget-buttons-wrap-span">' + n.Msg.translate(p, "Apply") + "<\/span>"); pt.append(wt).append(ai).append(bt); yt.append(pt); et.append(s).append(yt); o.append(et).append(ft) } function nr() { ot = o.find("#VIS_Organization_" + r.windowNo); st = o.find("#VIS_Period_" + r.windowNo); gt = o.find("#VIS_IncludeSO_" + r.windowNo); ni = o.find("#VIS_DocumentType_" + r.windowNo); ii = o.find("#VIS_IncludeOpenSalesOrder_" + r.windowNo); ht = o.find("#VIS_OpenSalesOrder_" + r.windowNo); ui = o.find("#VIS_IncludeOpportunity_" + r.windowNo); ct = o.find("#VIS_Opportunity_" + r.windowNo); tt && (lt = o.find("#VIS_TeamForecast_" + r.windowNo)); b && (oi = o.find("#VIS_BudgetForecast_" + r.windowNo), hi = o.find("#VIS_PriceList_" + r.windowNo)); at = o.find("#VIS_ProductCategory_" + r.windowNo); ci = o.find("#VIS_BudgetQuantity_" + r.windowNo); li = o.find("#VIS_GenerateLines_" + r.windowNo) } function tr() { var yt, pt, i, wt, u, bt, ai, bi, di, f, gi, nr, o, tr, s, ir, d, rr, ft, ur, et, fr, er; kt = n.MLookupFactory.get(p, r.windowNo, w, n.DisplayType.Search, "AD_Org_ID", 0, !1, "AD_Org_ID.IsActive = 'Y'"); rt = new n.Controls.VTextBoxButton("AD_Org_ID", !0, !1, !1, n.DisplayType.Search, kt); yt = t('<div class="vis-control-wrap">'); pt = t('<div class="input-group-append">'); ot.append(yt); yt.append(rt.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.translatedTexts.AD_Org_ID + "<\/label>"); ot.append(pt); pt.append(rt.getBtn(0)); i = "C_Period.IsActive='Y' AND C_Period.C_Year_ID  IN  (Select C_Year_ID FROM C_Year WHERE C_Calendar_ID =  ((SELECT AD_OrgInfo.C_Calendar_ID FROM AD_OrgInfo WHERE AD_OrgInfo.AD_Org_ID = " + w + "))  OR (EXISTS(SELECT 1 FROM AD_OrgInfo WHERE AD_OrgInfo.AD_Org_ID = " + w + " AND AD_OrgInfo.C_Calendar_ID IS NULL) AND  (C_Calendar_ID = (SELECT AD_ClientInfo.C_Calendar_ID FROM AD_ClientInfo WHERE AD_ClientInfo.AD_Client_ID = " + ki + ")))  AND C_year.IsActive = 'Y') and C_Period.Startdate < SYSDATE ORDER BY C_Period.C_Period_ID"; dt = n.MLookupFactory.get(p, r.windowNo, 1004891, n.DisplayType.Search, "C_Period_ID", 0, !1, i); a = new n.Controls.VTextBoxButton("C_Period_ID", !0, !1, !0, n.DisplayType.Search, dt); wt = t('<div class="vis-control-wrap">'); u = t('<div class="input-group-append">'); st.append(wt); wt.append(a.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.translatedTexts.C_Period_ID + "<\/label>"); st.append(u); u.append(a.getBtn(0)); u.append(a.getBtn(1)); a.getControl().prop("disabled", !0); a.getBtn(0).prop("disabled", !0); a.getBtn(1).prop("disabled", !0); h = new n.Controls.VCheckBox("IncludeSO", !1, !1, !0, n.Msg.getMsg("IncludeSO"), null); bt = t('<div class="vis-control-wrap">'); gt.append(bt); bt.append(h.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")); i = "C_DocType.IsActive = 'Y' AND C_DocType.DocBaseType IN ('SOO', 'POO', 'BOO') AND C_DocType.IsSOTrx = 'Y' AND  C_DocType.IsReturnTrx = 'N' AND  C_DocType.IsSalesQuotation = 'N' AND C_DocType.IsBlanketTrx = 'N'  AND C_DocType.AD_Org_ID IN (0, " + w + ") "; ti = n.MLookupFactory.get(p, r.windowNo, 2173, n.DisplayType.TableDir, "C_DocType_ID", 0, !1, i); it = new n.Controls.VComboBox("C_DocType_ID", !1, !1, !0, ti, 50); it.getControl().prop("disabled", !0); ai = t('<div class="vis-control-wrap">'); ni.append(ai); ai.append(it.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.translatedTexts.C_DocType_ID + "<\/label>"); v = new n.Controls.VCheckBox("IncludeOpenSO", !1, !1, !0, n.Msg.getMsg("IncludeOpenSO"), null); bi = t('<div class="vis-control-wrap">'); ii.append(bi); bi.append(v.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")); i = "C_Order.DocStatus IN ('CO') AND C_Order.IsSOTrx = 'Y' AND  C_Order.IsReturnTrx = 'N' AND  C_Order.IsSalesQuotation = 'N' AND C_Order.IsBlanketTrx = 'N' AND C_Order.AD_Org_ID IN (0, " + w + ")"; ri = n.MLookupFactory.get(p, r.windowNo, 2213, n.DisplayType.MultiKey, "C_Order_ID", 0, !1, i); c = new n.Controls.VTextBoxButton("C_Order_ID", !0, !1, !0, n.DisplayType.MultiKey, ri); c.getControl().prop("disabled", !0); c.getBtn(0).prop("disabled", !0); c.getBtn(1).prop("disabled", !0); c.setCustomInfo("Budget_OpenSalesOrder"); di = t('<div class="vis-control-wrap">'); f = t('<div class="input-group-append">'); ht.append(di); di.append(c.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.Msg.getMsg("OpenSO") + "<\/label>"); ht.append(f); f.append(c.getBtn(0)); f.append(c.getBtn(1)); y = new n.Controls.VCheckBox("IncludeOpportunity", !1, !1, !0, n.Msg.getMsg("IncludeOpportunity"), null); gi = t('<div class="vis-control-wrap">'); ui.append(gi); gi.append(y.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")); i = "C_Project.IsActive = 'Y' AND C_Project.IsOpportunity = 'Y' AND C_Project.AD_Org_ID IN (0, " + w + ")"; fi = n.MLookupFactory.get(p, r.windowNo, 5766, n.DisplayType.MultiKey, "C_Project_ID", 0, !1, i); l = new n.Controls.VTextBoxButton("C_Project_ID", !0, !1, !0, n.DisplayType.MultiKey, fi); l.getControl().prop("disabled", !0); l.getBtn(0).prop("disabled", !0); l.getBtn(1).prop("disabled", !0); l.setCustomInfo("Budget_Opportunity"); nr = t('<div class="vis-control-wrap">'); o = t('<div class="input-group-append">'); ct.append(nr); nr.append(l.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.Msg.getMsg("Opportunity") + "<\/label>"); ct.append(o); o.append(l.getBtn(0)); o.append(l.getBtn(1)); tt && (i = " C_Forecast.AD_Org_ID IN (0, " + w + ") AND C_Forecast.DocStatus IN ('CO', 'CL')", ei = n.MLookupFactory.get(p, r.windowNo, vi, n.DisplayType.MultiKey, "C_Forecast_ID", 0, !1, i), nt = new n.Controls.VTextBoxButton("C_Forecast_ID", !0, !1, !0, n.DisplayType.MultiKey, ei), nt.setCustomInfo("Budget_TeamForecast"), tr = t('<div class="vis-control-wrap">'), s = t('<div class="input-group-append">'), lt.append(tr), tr.append(nt.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.translatedTexts.TeamForecast + "<\/label>"), lt.append(s), s.append(nt.getBtn(0)), s.append(nt.getBtn(1))); b && (i = " C_MasterForecast.AD_Org_ID IN (0, " + w + ") AND C_MasterForecast.DocStatus IN ('CO', 'CL')", yi = n.MLookupFactory.get(p, r.windowNo, pi, n.DisplayType.MultiKey, "C_MasterForecast_ID", 0, !1, i), ut = new n.Controls.VTextBoxButton("C_MasterForecast_ID", !0, !1, !0, n.DisplayType.MultiKey, yi), ir = t('<div class="vis-control-wrap">'), d = t('<div class="input-group-append">'), oi.append(ir), ir.append(ut.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.translatedTexts.MasterForecast + "<\/label>"), oi.append(d), d.append(ut.getBtn(0)), d.append(ut.getBtn(1))); i = "M_Product_Category.IsActive = 'Y' AND M_Product_Category.AD_Org_ID IN (0, " + w + ")"; si = n.MLookupFactory.get(p, r.windowNo, 2012, n.DisplayType.MultiKey, "M_Product_Category_ID", 0, !1, i); e = new n.Controls.VTextBoxButton("M_Product_Category_ID", !0, !1, !0, n.DisplayType.MultiKey, si); rr = t('<div class="vis-control-wrap">'); ft = t('<div class="input-group-append">'); at.append(rr); rr.append(e.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.translatedTexts.M_Product_Category_ID + "<\/label>"); at.append(ft); ft.append(e.getBtn(0)); ft.append(e.getBtn(1)); e.fireValueChanged = function () { e.getControl().trigger("change") }; b && (i = "M_PriceList.IsActive = 'Y' AND M_PriceList.IsSOPriceList='Y' AND M_PriceList.AD_Org_ID IN (0, " + w + ")", wi = n.MLookupFactory.get(p, r.windowNo, 2100, n.DisplayType.Search, "M_PriceList_ID", 0, !1, i), k = new n.Controls.VTextBoxButton("M_PriceList_ID", !0, !1, !0, n.DisplayType.Search, wi), ur = t('<div class="vis-control-wrap">'), et = t('<div class="input-group-append">'), hi.append(ur), ur.append(k.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.translatedTexts.M_PriceList_ID + "<\/label>"), hi.append(et), et.append(k.getBtn(0)), et.append(k.getBtn(1)), k.getControl().prop("disabled", !0)); g = new n.Controls.VAmountTextBox("BudgetQuantity", !1, !1, !0, 50, 100, n.DisplayType.Quantity); g.getControl().prop("disabled", !0); fr = t('<div class="vis-control-wrap">'); ci.append(fr); fr.append(g.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")).append("<label>" + n.Msg.getMsg("BudgetQuantity") + "<\/label>"); vt = new n.Controls.VCheckBox("GenerateLines", !1, !1, !0, n.Msg.getMsg("GenerateLines"), null); er = t('<div class="vis-control-wrap">'); li.append(er); er.append(vt.getControl().attr("placeholder", " ").attr("data-placeholder", "").attr("data-hasbtn", " ")) } function ir() { rt.setValue(w); h.getControl().on("click", function () { it.getControl().prop("disabled", h.getValue() ? !1 : !0); a.getControl().prop("disabled", h.getValue() ? !1 : !0); a.getBtn(0).prop("disabled", h.getValue() ? !1 : !0); a.getBtn(1).prop("disabled", h.getValue() ? !1 : !0); h.getValue() || (it.setValue(), a.setValue()); e.getControl().trigger("change") }); v.getControl().on("click", function () { c.getControl().prop("disabled", v.getValue() ? !1 : !0); c.getBtn(0).prop("disabled", v.getValue() ? !1 : !0); c.getBtn(1).prop("disabled", v.getValue() ? !1 : !0); v.getValue() || c.setValue(); e.getControl().trigger("change") }); y.getControl().on("click", function () { l.getControl().prop("disabled", y.getValue() ? !1 : !0); l.getBtn(0).prop("disabled", y.getValue() ? !1 : !0); l.getBtn(1).prop("disabled", y.getValue() ? !1 : !0); y.getValue() || l.setValue(); e.getControl().trigger("change") }); e.getControl().on("change", function () { e.getControl().prop("disabled", v.getValue() || y.getValue() || h.getValue() ? !0 : !1); e.getBtn(0).prop("disabled", v.getValue() || y.getValue() || h.getValue() ? !0 : !1); e.getBtn(1).prop("disabled", v.getValue() || y.getValue() || h.getValue() ? !0 : !1); v.getValue() || y.getValue() || h.getValue() ? e.setValue() : ""; e.getValue() != undefined || n.Utility.Util.getValueOfString(e.getValue()) != "" ? (g.getControl().prop("disabled", !1), k.getControl().prop("disabled", !1)) : (g.getControl().prop("disabled", !0), g.getControl().val(0), k.getControl().prop("disabled", !0)) }); wt.on("click", function () { d(!0); var t = 0, i = 0, u = 0; if (tt && (t = nt.getValue()), b && (i = ut.getValue(), u = k.getValue()), e.getValue() != undefined || n.Utility.Util.getValueOfString(e.getValue()) != "") { if (n.Utility.Util.getValueOfDecimal(g.getValue()) == 0) return n.ADialog.info("SelectBudgetQunatity"), d(!1), !1; if (b && n.Utility.Util.getValueOfDecimal(k.getValue()) == 0) return n.ADialog.info("SelectPriceList"), d(!1), !1 } bi(t, i, u, function (t) { n.ADialog.info("", "", JSON.parse(t)); d(!1); r.frame.close() }) }); ai.on("click", function () { d(!0); var t = 0, i = 0, r = 0; if (tt && (t = nt.getValue()), b && (i = ut.getValue(), r = k.getValue()), e.getValue() != undefined || n.Utility.Util.getValueOfString(e.getValue()) != "") { if (n.Utility.Util.getValueOfDecimal(g.getValue()) == 0) return n.ADialog.info("SelectBudgetQunatity"), d(!1), !1; if (b && n.Utility.Util.getValueOfDecimal(k.getValue()) == 0) return n.ADialog.info("SelectPriceList"), d(!1), !1 } bi(t, i, r, function (t) { n.ADialog.info("", "", JSON.parse(t)); d(!1) }) }); bt.on("click", function () { r.frame.close() }) } function bi(i, u, f, o) { t.ajax({ url: n.Application.contextUrl + "ForecastForm/CreateForecastLine", type: "POST", dataType: "json", async: !0, data: { Org_ID: rt.getValue(), Period_ID: a.getValue(), IncludeSO: h.getValue(), DocType: it.getValue(), IncludeOpenSO: v.getValue(), OpenOrders: c.getValue(), IncludeOpportunity: y.getValue(), Opportunity: l.getValue(), ProductCategory: e.getValue(), BudgetQunatity: g.getValue(), DeleteAndGenerateLines: vt.getValue(), Forecast_ID: r.record_ID, TeamForecast_IDS: i, Table_ID: r.ad_table_ID, IsMasterForecast: tt, IsBudgetForecast: b, MasterForecast_IDs: u, SalesPriceList_ID: f }, success: function (n) { o(n) }, error: function (t) { console.log(t); d(!1); n.ADialog.error("Error") } }) } function d(n) { ft[0].style.visibility = n ? "visible" : "hidden" } this.frame; this.windowNo; var r = this, o = t("<div style='height:100%;background-color:white;' class='vis-forms-container' >"), ft = t('<div class="vis-busyindicatorouterwrap"><div class="vis-busyindicatorinnerwrap"><i class="vis-busyindicatordiv"><\/i><\/div><\/div>'), p = n.Env.getCtx(), et = null, s = null, u = null, f = null, ot, kt, rt, st, dt, a, gt, h, ni, ti, it, ii, v, ht, ri, c, ui, y, ct, fi, l, lt, ei, nt, vi = 0, oi, yi, ut, pi = 0, at, si, e, hi, wi, k, ci, g, li, vt, yt = null, pt = null, wt = null, bt = null, ai = null; this.ad_table_ID; this.ad_window_ID; this.record_ID; var w = n.context.getWindowContextAsInt(r.windowNo, "AD_Org_ID", !1), ki = n.context.getWindowContextAsInt(r.windowNo, "AD_Client_ID", !1), tt = !1, b = !1; n.translatedTexts = n.Msg.translate(n.Env.getCtx(), ["AD_Org_ID", "C_Period_ID", "C_DocType_ID", "M_Product_Category_ID", "TeamForecast", "MasterForecast", "M_PriceList_ID"], !0); this.Initialize = function () { d(!0); di(); gi(); nr(); tr(); ir(); d(!1) }; this.setHeight = function () { tt ? 367 : b ? 402 : 352 }; this.setWidth = function () { return 635 }; this.getRoot = function () { return o }; this.disposeComponent = function () { r = null; o = null; ft = null; et = null; s = null; u = null; f = null; yt = null; pt = null; wt = null; bt = null; ot = null; kt = null; rt = null; st = null; dt = null; a = null; gt = null; h = null; ni = null; ti = null; it = null; ii = null; v = null; ht = null; ri = null; c = null; ui = null; y = null; ct = null; fi = null; l = null; lt = null; ei = null; nt = null; at = null; si = null; e = null; ci = null; g = null; li = null; vt = null }; i.prototype.init = function (n, t) { this.frame = t; this.windowNo = n; this.ad_table_ID = this.frame.getAD_Table_ID(); this.ad_window_ID = this.frame.getAD_Window_ID(); this.record_ID = this.frame.getRecord_ID(); this.Initialize(); this.frame.getContentGrid().append(this.getRoot()) }; i.prototype.dispose = function () { this.disposeComponent(); this.frame = null } } n.AForms = n.AForms || {}; n.AForms.createforecast = i }(VIS, jQuery), function (n) { function t() { function t(t) { n.indexOf(t) < 0 && n.push(t) } function i(t) { var i = n.indexOf(t); i > -1 && n.splice(i, 1) } function r(t) { for (var i = 0, r = n.length; i < r; i++)if (n[i].onmessage) n[i].onmessage(t) } function u() { var n = new EventSource("Message/Get"); n.onmessage = function (n) { var t = JSON.parse(n.data), i, u; if (t && t.length > 0) for (i = 0, u = t.length; i < u; i++)t[i].Event == "MSG" ? toastr.success(t[i].Message, "", { timeOut: 4e3, positionClass: "toast-top-center", closeButton: !0 }) : t[i].Event == "LOGIN" || t[i].Event == "LOGOFF" || r(t[i]) } } var n = []; return { start: u, register: t, unregister: i } } n.sseManager = t() }(VIS, jQuery); VIS = window.VIS || {}, function () { function n() { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.selectedRow = null; this.panelWidth; var t = $('<div class="vis-mas-verinf-wrap"><\/div>'), n = null; this.init = function () { var i = '<div class="vis-mas-verinf-hdrCtr"><div class="vis-mas-verinf-hdrsLft">' + VIS.Msg.getMsg("FieldName") + '<\/div><div class="vis-mas-verinf-hdrsRgt">' + VIS.Msg.getMsg("OldValue") + '<\/div><\/div><div class="vis-mas-verinf-CngCtr"><\/div>'; t.append(i); n = t.find(".vis-mas-verinf-CngCtr") }; this.getRoot = function () { return t }; this.update = function () { try { if (this.selectedRow.recordversion > 1) { this.selectedRow.RID = this.record_ID; this.selectedRow.TName = this.curTab.vo.TableName; this.selectedRow.TabID = this.curTab.vo.AD_Tab_ID; this.selectedRow.TblID = this.curTab.vo.AD_Table_ID; var t = this; $.ajax({ type: "POST", async: !0, url: VIS.Application.contextUrl + "JsonData/GetVerInfo", contentType: "application/json; charset=utf-8", data: "{ 'RowData': '" + JSON.stringify(this.selectedRow) + "' }", success: function (i) { var s = t.curTab, u, o, f, e, r; if (n.empty(), i && (u = JSON.parse(i), u.ColumnNames && u.ColumnNames.length > 0)) { for (o = [], f = 0; f < u.ColumnNames.length; f++) { e = 10; try { e = $.grep(t.curTab.gridTable.gTable.m_fields, function (n) { return n._vo.ColumnName == u.DBColNames[f] })[0]._vo.displayType } catch (h) { e = 10 } r = u.OldVals[f]; e == 15 ? r = Globalize.format(new Date(r), "d") : e == 16 ? r = Globalize.format(new Date(r + "Z"), "f") : e == 24 && (r = Globalize.format(new Date(r + "Z"), "t")); u.OldVals[f] == "" && (r = "&nbsp"); o.push('<div class="vis-mas-verinf-cntCtr"><div class="vis-mas-verinf-cnt">' + u.ColumnNames[f] + '<\/div><div class="vis-mas-verinf-cnt">' + r + "<\/div><\/div>") } n.append(o.join(" ")) } }, error: function () { } }) } else this.selectedRow.recordversion == 1 ? (n.empty(), n.append('<div class="vis-mas-verinf-newrecord">' + VIS.Msg.getMsg("FirstVersion") + "<\/div>")) : (n.empty(), n.append('<div class="vis-mas-verinf-newrecord">' + VIS.Msg.getMsg("NoVersionsFound") + "<\/div>")) } catch (i) { } }; this.disposeComponent = function () { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.rowSource = null; this.panelWidth = null; t.remove(); t = null } } n.prototype.startPanel = function (n, t) { this.windowNo = n; this.curTab = t; this.init() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n, t) { this.panelWidth = t }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.verinfo = n }(); VIS = window.VIS || {}, function () { function n() { function l() { var u = t.closest(".vis-ad-w-p-ap-tp-outerwrap"), o = u.find(".vis-ad-w-p-ap-tp-o-b-head"), e = u.find(".vis-ad-w-p-ap-tp-o-b-content"), i = u.height(), r = o.height() + 40, s = e.height(), f; e.css("height", i - r); f = $("#VIS_pagingHtml" + n).height() + 10; $("#VIS_recordDetail" + n).is(":visible") ? ($("#VIS_recordDetail" + n).css("height", (i - r) / 2 + 50), $("#VIS_HistoryGrd" + n).css("height", (i - r) / 2 - f - 50)) : $("#VIS_HistoryGrd" + n).css("height", i - (r + f)) } function ct() { if (u > 0) { if (w = u % nt == 0 ? u / nt : Math.floor(u / nt) + 1, h = VIS.Utility.Util.getValueOfInt($("#VIS_ddlPages" + n).find(":selected").val()) > 0 ? VIS.Utility.Util.getValueOfInt($("#VIS_ddlPages" + n).find(":selected").val()) : 1, h > 0 && (kt = h - 1), w >= h + 1 && (dt = h + 1), VIS.Utility.Util.getValueOfInt($("#VIS_ddlPages" + n).find(":selected").val()) <= 0 || $("#VIS_ddlPages" + n).children("option").length <= 0) { $("#VIS_ddlPages" + n).empty(); for (var t = 1; t <= w; t++)t == 1 ? $("#VIS_ddlPages" + n).append(new Option(t, t, !0, !0)) : $("#VIS_ddlPages" + n).append(new Option(t, t, !1, !1)) } w > 1 && w > VIS.Utility.Util.getValueOfInt($("#VIS_ddlPages" + n).find(":selected").val()) ? $("#VIS_pagingText" + n).html('<span class="vis-ad-w-p-s-statusdb" id="VIS_pageIndx' + n + '">1/' + k + "<\/span><span>Showing Result " + ((h - 1) * nt + 1) + "-" + h * nt + " of " + u + "<\/span>") : w > 1 && w == VIS.Utility.Util.getValueOfInt($("#VIS_ddlPages" + n).find(":selected").val()) ? $("#VIS_pagingText" + n).html('<span class="vis-ad-w-p-s-statusdb" id="VIS_pageIndx' + n + '">1/' + k + "<\/span><span>Showing Result " + ((h - 1) * nt + 1) + "-" + u + " of " + u + "<\/span>") : w == 1 && $("#VIS_pagingText" + n).html('<span class="vis-ad-w-p-s-statusdb" id="VIS_pageIndx' + n + '">1/' + k + "<\/span><span>Showing Result 1-" + u + " of " + u + "<\/span>") } else $("#VIS_pagingText" + n).html('<span class="vis-ad-w-p-s-statusdb" id="VIS_pageIndx' + n + '">0/0<\/span><span>Showing Result 0-0 of 0<\/span>'), $("#VIS_ddlPages" + n).empty() } function ft(t, i) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetHistoryRecordsCount", data: { RecordId: t, AD_Table_ID: i }, success: function (i) { var r = []; r = JSON.parse(i); r != null && (u = r, $("#VIS_ddlPages" + n).empty(), ct(t, 0)) }, error: function () { } }) } function gt() { s = $("#VIS_ddlPages" + n).find(":selected").val(); it(c, VIS.Utility.Util.getValueOfInt(s), n, b); h = s } function it(n, t, i, r) { $("#VIS_tabPanelDataLoader" + i).show(); $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetHistoryRecordDetails", data: { RecordId: n, AD_Table_ID: r, CurrentPage: t }, success: function (u) { var f = []; if (f = JSON.parse(u), f != null) { tt = f; et(f, i, !1); $("#VIS_recordDetail" + i).hide(); l(); VIS.Utility.Util.getValueOfInt(t) > 0 && ct(n, VIS.Utility.Util.getValueOfInt(t)); $("#VIS_tabPanelDataLoader" + i).hide(); $("#VIS_ddlPages" + i).one("change", gt); $("#VIS_prevPage" + i).one("click"); $("#VIS_nextPage" + i).one("click"); $("#VIS_prevPage" + i).one("click", function (n) { s = $("#VIS_ddlPages" + i).find(":selected").val(); VIS.Utility.Util.getValueOfInt(s) > 1 && ($("#VIS_prevPage" + i).off("click"), $("#VIS_ddlPages" + i).off("change"), it(c, VIS.Utility.Util.getValueOfInt(s) - 1, i, r), h = s, $("#VIS_ddlPages" + i).val(VIS.Utility.Util.getValueOfInt(s) - 1), n.stopPropagation(), n.stopImmediatePropagation()) }); $("#VIS_nextPage" + i).one("click", function (n) { s = $("#VIS_ddlPages" + i).find(":selected").val(); VIS.Utility.Util.getValueOfInt(s) < $("#VIS_ddlPages" + i).children("option").length && ($("#VIS_nextPage" + i).off("click"), $("#VIS_ddlPages" + i).off("change"), it(c, VIS.Utility.Util.getValueOfInt(s) + 1, i, r), h = s, $("#VIS_ddlPages" + i).val(VIS.Utility.Util.getValueOfInt(s) + 1), n.stopPropagation(), n.stopImmediatePropagation()) }) } }, error: function () { } }) } function et(n, r, u) { var a = $('<div class="VIS-tabPanelDataLoader" id="VIS_tabPanelDataLoader' + r + '"><i class="fa fa-spinner fa-pulse fa-3x fa-fw"><\/i><\/div>'), o = $('<div class="VIS-tp-mainContainer"><\/div>'), h = $('<div class="VIS-tp-topSearchWrp"><button id="VIS_btnRefresh' + r + '" class="VIS-tp-refreshIcon" ><i class="vis vis-refresh"><\/i><\/button><div class="VIS-tp-searchControl"><input id="VIS_txtSearch' + r + '" type="text" placeholder="Search"><i id="VIS_faSearch' + r + '" class="fa fa-search"><\/i><\/div><\/div>'), s, e, f; if (n.length > 0) { for (s = $('<div class="VIS-tp-recordswrap"><\/div>'), k = n.length, $("#VIS_pageIndx" + r).text("1/" + k), f = 0; f < n.length; f++)n[f].Type.toLower() == "email" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="email" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" ><i data-recid="' + f + '" class="vis vis-email"><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><i data-recid="' + f + '" class="fa fa-arrow-up"><\/i><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + (VIS.Utility.Util.getValueOfString(n[f].HasAttachment) == "true" ? '" class="vis vis-attachment1"><\/i>' : '"><\/i>') + '<small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "inbox" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="email" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" ><i data-recid="' + f + '" class="vis vis-email"><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><i data-recid="' + f + '" class="fa fa-arrow-down"><\/i><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + (VIS.Utility.Util.getValueOfString(n[f].HasAttachment) == "true" ? '" class="vis vis-attachment1"><\/i>' : '"><\/i>') + '<small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "call" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="call" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap  "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" ><i data-recid="' + f + '" class="fa fa-phone" aria-hidden="true" title="Call" ><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + (VIS.Utility.Util.getValueOfString(n[f].HasAttachment) == "true" ? '" class="vis vis-attachment1">&nbsp;<\/i>' : '">&nbsp;<\/i>') + '<small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "chat" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="chat" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap  "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" ><i data-recid="' + f + '" class="vis vis-chat" title="chat" ><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + '">&nbsp;<\/i><small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "letter" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="letter" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" ><i data-recid="' + f + '" class="vis vis-letter"><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + (VIS.Utility.Util.getValueOfString(n[f].HasAttachment) == "true" ? '" class="vis vis-attachment1">&nbsp;<\/i>' : '">&nbsp;<\/i>') + '<small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "appointment" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="appointment" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class="VIS-tp-recordIcon"><i data-recid="' + f + '" class="vis vis-appointment" title="appointment"><\/i><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + '">&nbsp;<\/i><small data-recid="' + f + '">By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "task" ? e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="task" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class="VIS-tp-recordIcon"><i data-recid="' + f + '" class="vis vis-task" title="task"><\/i><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight">' + (n[f].IsTaskClosed ? '<span data-recid="' + f + '" class="VIS-tp-taskTag">' + VIS.Msg.getMsg("Closed") + "<\/span>" : "") + '<i data-recid="' + f + '">&nbsp;<\/i><small data-recid="' + f + '" >By: ' + n[f].UserName + "<\/small><\/div><\/div>") : n[f].Type.toLower() == "attachment" && (e = $('<div data-rid="' + n[f].ID + '" data-username="' + n[f].UserName + '" data-winno="' + r + '" data-atype="attachment" data-recid="' + f + '" id="rowId' + f + '" class="VIS-tp-recordWrap "><div data-recid="' + f + '" class= "VIS-tp-recordIcon" title="attachment"><i data-recid="' + f + '" class="vis vis-attachmentx"><\/i><\/div ><div data-recid="' + f + '" class="VIS-tp-recordInfo"><h6 data-recid="' + f + '">' + new Date(n[f].Created).toLocaleString() + '<\/h6><div data-recid="' + f + '" class="VIS-tp-recordSubject"><p data-recid="' + f + '">' + n[f].Subject + '<\/p><\/div><\/div><div data-recid="' + f + '" class="VIS-tp-recordInfoRight"><i data-recid="' + f + '" >&nbsp;<\/i><small data-recid="' + f + '" >By: ' + n[f].UserName + "<\/small><\/div><\/div>")), s.append(e); u ? (t.find(".VIS-tp-recordswrap").empty(), t.find(".VIS-tp-recordswrap").append(s.html())) : (o.append(a).append(h).append(s), g.empty(), g.append(o)); t.find(".VIS-tp-recordWrap").click(function (n) { var s = n.target, f = ""; f = VIS.Utility.Util.getValueOfInt($(s).data("recid")); t.find("#rowId" + f).addClass("VIS-tp-selectedRecord"); VIS.Utility.Util.getValueOfInt(i) >= 0 && f != VIS.Utility.Util.getValueOfInt(i) && t.find("#rowId" + i).hasClass("VIS-tp-selectedRecord") && t.find("#rowId" + i).removeClass("VIS-tp-selectedRecord"); i = f; $("#VIS_pageIndx" + r).text(VIS.Utility.Util.getValueOfInt(i) + 1 + "/" + k); var u = t.find("#rowId" + f).data("atype").toString().toUpper(), e = t.find("#rowId" + f).data("rid"), o = t.find("#rowId" + f).data("username"); $("#VIS_recordDetail" + r).show(); u == "EMAIL" || u == "INBOX" ? lt(e, o, r) : u == "CALL" ? vt(e, o, r) : u == "APPOINTMENT" ? yt(e, o, r) : u == "LETTER" ? at(e, o, r) : u == "TASK" ? pt(e, o, r) : u == "ATTACHMENT" ? wt(e, o, r) : u == "CHAT" && ot(e, o, r); l() }); $("#VIS_txtSearch" + r).keyup(function (n) { var t; if ((n.keyCode == undefined || n.keyCode == 13 || n.keyCode == 8) && (t = $(this).val(), t !== "" || n.keyCode == 13)) { var i = [], u = new RegExp(t, "i"), f = 0; $.each(tt, function (n, t) { (t.Subject.search(u) != -1 || t.UserName.search(u) != -1) && (i[f] = t, f++) }); et(i, r, !0); $("#VIS_recordDetail" + r).fadeOut(100); $("#VIS_recordDetail" + r).hide(); t === "" && n.keyCode == 13 ? $("#VIS_pagingHtml" + r).show() : $("#VIS_pagingHtml" + r).hide() } }); $("#VIS_btnRefresh" + r).click(function () { VIS.Utility.Util.getValueOfInt(c) > 0 && (ft(c, b), it(c, 0, r, b)); $("#VIS_recordDetail" + r).hide(); $("#VIS_pagingHtml" + r).show() }); $("#VIS_faSearch" + r).click(function () { var n = $("#VIS_txtSearch" + r).val(); if (n === "") VIS.Utility.Util.getValueOfInt(c) > 0 && (ft(c, b), it(c, 0, r, b)), $("#VIS_recordDetail" + r).hide(), $("#VIS_pagingHtml" + r).show(); else { var t = [], i = new RegExp(n, "i"), u = 0; $.each(tt, function (n, r) { (r.Subject.search(i) != -1 || r.UserName.search(i) != -1) && (t[u] = r, u++) }); et(t, r, !0); $("#VIS_recordDetail" + r).fadeOut(100); $("#VIS_recordDetail" + r).hide(); $("#VIS_pagingHtml" + r).hide() } }) } else o.append(h), g.empty(), g.append(o) } function o(n, t) { var o, u, f, r, e = -1; tt != null && VIS.Utility.Util.getValueOfInt(n) >= 0 && VIS.Utility.Util.getValueOfInt(n) < tt.length && (e = VIS.Utility.Util.getValueOfInt(n), o = tt[e], u = o.ID, f = o.UserName, r = VIS.Utility.Util.getValueOfString(o.Type).toUpper(), $("#rowId" + e).addClass("VIS-tp-selectedRecord"), VIS.Utility.Util.getValueOfInt(i) >= 0 && e != VIS.Utility.Util.getValueOfInt(i) && $("#rowId" + i).hasClass("VIS-tp-selectedRecord") && $("#rowId" + i).removeClass("VIS-tp-selectedRecord"), i = e, $("#VIS_pageIndx" + t).text(VIS.Utility.Util.getValueOfInt(i) + 1 + "/" + k)); r == "EMAIL" || r == "INBOX" ? lt(u, f, t) : r == "CALL" ? vt(u, f, t) : r == "APPOINTMENT" ? yt(u, f, t) : r == "LETTER" ? at(u, f, t) : r == "TASK" ? pt(u, f, t) : r == "ATTACHMENT" ? wt(u, f, t) : r == "CHAT" && ot(u, f, t) } function lt(n, s, h) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedMailDetails", datatype: "json", type: "get", cache: !1, data: { ID: n }, success: function (c) { var w = JSON.parse(c), it, lt = 0, ot = w.Record_ID, ht = w.AD_Table_ID, ut = 0, nt, tt, ft, et, g, at, b, k, ct; if (it = VIS.Utility.Util.getValueOfString(w.ID), ft = "", et = VIS.Utility.Util.getValueOfString(s).split(" "), ft = et.length > 1 ? VIS.Utility.Util.getValueOfString(et[0]).substring(0, 1).toUpper() + VIS.Utility.Util.getValueOfString(et[1]).substring(0, 1).toUpper() : VIS.Utility.Util.getValueOfString(s).substring(0, 2).toUpper(), VIS.Utility.Util.getValueOfString(w.Cc) != "" || VIS.Utility.Util.getValueOfString(w.Bcc) != "") { if (g = '<div class="dropdown show VIS-tp-dropdownWrap">' + w.To + '<a class="btn dropdown-toggle" style="font-size:.75rem;" href = "#" role = "button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" >&nbsp;<i class="fa fa-angle-down VIS-tp-recordLabels"><\/i><\/a><div class="dropdown-menu" aria-labelledby="dropdownMenuLink">', VIS.Utility.Util.getValueOfString(w.Cc) != "") for (nt = VIS.Utility.Util.getValueOfString(w.Cc).split(","), b = 0; b < nt.length; b++)nt[b] != "undefined" && nt[b] != "" && (g += b == 0 ? '<span class="VIS-tp-recordLabels VIS-mail-to">' + VIS.Msg.getMsg("Cc") + ':&nbsp; <\/span><a class="dropdown-item VIS-mail-to" href = "#">' + nt[b] + "<\/a>" : '<a class="dropdown-item VIS-mail-to" href="#">' + nt[b] + "<\/a>"); if (VIS.Utility.Util.getValueOfString(w.Bcc) != "") for (tt = VIS.Utility.Util.getValueOfString(w.Bcc).split(","), k = 0; k < tt.length; k++)tt[k] != "undefined" && tt[k] != "" && (g += k == 0 ? '<span class="VIS-tp-recordLabels VIS-mail-to">' + VIS.Msg.getMsg("Bcc") + ':&nbsp; <\/span><a class="dropdown-item VIS-mail-to" href="#">' + tt[k] + "<\/a>" : '<a class="dropdown-item VIS-mail-to" href="#">' + tt[k] + "<\/a>"); g += "<\/div><\/div>" } else g = w.To; w.Attach != null && w.Attach.length > 0 && (lt = w.Attach.length, ut = w.ID); r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailPanel"><\/div>')); r.empty(); e = $('<div class="VIS-testPanel VIS-tp-borderBott" ><div class="d-flex align-items-center VIS-tp-leftIcons"><span><i class="fa fa-reply" data-mailto="' + w.To + '" data-mailcc="' + w.Cc + '" data-mailbcc="' + w.Bcc + '" id="VIS_imgReply' + h + '"><\/i><\/span><span><i class="fa fa-reply-all" data-mailto="' + w.To + '" data-mailcc="' + w.Cc + '" data-mailbcc="' + w.Bcc + '" id="VIS_imgReplyAll' + h + '"><\/i><\/span><span><i class="fa fa-share" id="VIS_imgForward' + h + '"><\/i><\/span><\/div><div class= "align-items-center d-flex VIS-tp-rightIcons" ><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div ><\/div > '); at = $('<div class="VIS-tp-contentdiv" ><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div class="vis-tp-emailDetailWrap"><div class="VIS-mail-user-div"><span class="VIS-mail-user-span">' + ft + '<\/span><\/div><div class="VIS-contentTitile"><span class="VIS-mail-username">' + s + '<\/span><span id="VIS_mailSubject' + h + '" class="VIS-mail-subject VIS-tp-recordLabels">' + w.Title + '<\/span><div class="VIS-mail-content"><div class="VIS-mail-from"><span class="VIS-tp-recordLabels">' + VIS.Msg.getMsg("From") + ':&nbsp;<\/span><span style="word-break: break-word;">' + w.From + "<\/span><\/div><small>" + new Date(w.Date).toLocaleString() + '<\/small><\/div><span class="VIS-mail-to"><span class="VIS-tp-recordLabels">' + VIS.Msg.getMsg("To") + ":&nbsp; <\/span>" + g + '<\/span><\/div><\/div><div id="VIS_mailBody' + h + '" class="VIS-mail-body" >' + w.Detail + '<\/div><\/div ><div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv" ><div class="VIS-tp-comments-input' + h + '" ><div class="vis-tp-emailDetailWrap"<div class="VIS-mail-user-div"><span class="VIS-mail-user-span">' + ft + '<\/span><\/div><div class="VIS-contentTitile"><span class="VIS-mail-username">' + s + '<\/span><span id="mailSubject" class="VIS-mail-subject VIS-tp-recordLabels">' + w.Title + '<\/span><div class="VIS-mail-content"><span class="VIS-mail-from"><span class="VIS-tp-recordLabels">' + VIS.Msg.getMsg("From") + ':&nbsp;<\/span><span style="word-break: break-word;">' + w.From + "<\/span><\/div><small>" + new Date(w.Date).toLocaleString() + '<\/small><\/div><span class="VIS-mail-to"><span class="VIS-tp-recordLabels">' + VIS.Msg.getMsg("To") + ":&nbsp; <\/span>" + g + '<\/span><\/div><\/div><div class="VIS-mail-body" >' + w.Detail + "<\/div><\/div>"); y = $('<div class="VIS-tp-downloadAttachment"><div class="VIS-tp-attachments"><i class="vis vis-attachment1" ><\/i><span> ' + lt + " " + VIS.Msg.getMsg("Attachments") + '<\/span><\/div><div class="VIS-tp-attchDownload" id="dwnldAllAttach"><i class="vis vis-import" title="Download All" style="opacity: 1;"><\/i><span> ' + VIS.Msg.getMsg("VIS_DownloadAll") + "<\/span><\/div><\/div><\/div>"); ct = $('<div class="VIS-tp-emailDetailOuterPanel VIS-tp-recordDetail"><\/div>'); ct.append(at).append(y); r.append(e).append(ct); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); v(VIS.Utility.Util.getValueOfInt(it), !1, !1); $("#VIS_recordDetail" + h).show(); $("#dwnldAllAttach").click(function () { ti(n) }); $("#VIS_btnComments" + h).click(function (n) { a(!1, !1, n) }); $("#VIS_txtComments" + h).keyup(function (n) { a(!1, !1, n) }); $("#VIS_viewAllComments" + h).click(function () { $("#VIS_viewAllComments" + h).text() == VIS.Msg.getMsg("HideComments") ? ($("#VIS_viewMoreComments" + h).empty(), $("#VIS_viewMoreComments" + h).hide(), $("#VIS-tp-comments-input" + h).show(), $("#VIS_commentsMsg" + h).show(), $("#VIS_viewAllComments" + h).text(VIS.Msg.getMsg("ViewMoreComments")), v(VIS.Utility.Util.getValueOfInt(it), !1, !1)) : rt(VIS.Utility.Util.getValueOfInt(it), !1, !1) }); $("#VIS_imgReply" + h).click(function (n) { st(ot, ht, "<br><br><hr>" + $("#VIS_mailBody" + h).html(), $("#VIS_mailSubject" + h).text(), ut, "R", n) }); $("#VIS_imgReplyAll" + h).click(function (n) { st(ot, ht, "<br><br><hr>" + $("#VIS_mailBody" + h).html(), $("#VIS_mailSubject" + h).text(), ut, "RA", n) }); $("#VIS_imgForward" + h).click(function (n) { st(ot, ht, "<br><br><hr>" + $("#VIS_mailBody" + h).html(), $("#VIS_mailSubject" + h).text(), ut, "F", n) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } }) } function at(n, s, h) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedLetterDetails", datatype: "json", type: "get", cache: !1, data: { ID: n }, success: function (c) { var w = JSON.parse(c), b, tt; b = VIS.Utility.Util.getValueOfString(w.ID); var k = "", g = "", nt = VIS.Utility.Util.getValueOfString(s).split(" "); g = nt.length > 1 ? VIS.Utility.Util.getValueOfString(nt[0]).substring(0, 1).toUpper() + VIS.Utility.Util.getValueOfString(nt[1]).substring(0, 1).toUpper() : VIS.Utility.Util.getValueOfString(s).substring(0, 2).toUpper(); w.Attach != null && w.Attach.length > 0 && (k = w.Attach[0].Name); r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); e = $('<div class="VIS-contentHeadOuter VIS-tp-borderBott" ><div class="VIS-tp-recordIcon" ><i class="vis vis-letter"><\/i><\/div><div class="VIS-contentHead"><span class="VIS-letter-header" >' + VIS.Msg.getMsg("Letter") + '<\/span><\/div><div class="align-items-center d-flex VIS-tp-rightIcons" ><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div>'); $mailbodyhtml = $('<div class="VIS-tp-contentdiv" ><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div style="width: 100%"><table height="50px" width="100%"><tr height="50px"><td style="width:60px"><div class="VIS-mail-user-div"><span class="VIS-mail-user-span">' + g + '<\/span><\/div><\/td><td height="50px"><span class="VIS-mail-username">' + s + '<\/span><span id="mailSubject" class="VIS-mail-subject VIS-tp-recordLabels">' + w.Title + '<\/span><span class="VIS-mail-to">&nbsp;<\/span><span class="VIS-mail-from">&nbsp;<\/span><\/td><td height="50px" class="VIS-mail-date">' + new Date(w.Date).toLocaleString() + '<\/td><\/tr><\/table><\/div><div id="mailBody" class="VIS-mail-body" >' + w.Detail + '<\/div><\/div><div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div> '); f = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div class="" ><div style="width:100%" ><table height="50px" width="100%"><tr height="50px"><td><div class="VIS-mail-user-div"><span class="VIS-mail-user-span">' + g + '<\/span><\/div><\/td><td height="50px"><span class="VIS-mail-username">' + s + '<\/span><span id="mailSubject" class="VIS-mail-subject VIS-tp-recordLabels">' + w.Title + '<\/span><span class="VIS-mail-to">&nbsp;<\/span><span class="VIS-mail-from">&nbsp;<\/span><\/td><td height="50px" class="VIS-mail-date">' + w.Date + '<\/td><\/tr><\/table><\/div><div id="mailBody" class="VIS-mail-body" >' + w.Detail + "<\/div><\/div>"); y = $('<div class="VIS-tp-downloadAttachment"><div class="VIS-tp-attachments"><i class="vis vis-attachment1" ><\/i><span> ' + k + '<\/span><\/div><div class="VIS-tp-attchDownload" id="dwnldLetterAttach"><i class="vis vis-import" title="Download" style="opacity: 1;"><\/i><span> ' + VIS.Msg.getMsg("VIS_Download") + "<\/span><\/div><\/div><\/div>"); tt = $('<div class="VIS-tp-emailDetailOuterPanel VIS-tp-recordDetail"><\/div>'); tt.append($mailbodyhtml).append(y); r.append(e).append(tt); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); v(VIS.Utility.Util.getValueOfInt(b), !1, !1); $("#VIS_recordDetail" + h).show(); $("#VIS_btnComments" + h).click(function (n) { a(!1, !1, n) }); $("#VIS_txtComments" + h).keyup(function (n) { a(!1, !1, n) }); $("#VIS_viewAllComments" + h).click(function () { $("#VIS_viewAllComments" + h).text() == VIS.Msg.getMsg("HideComments") ? ($("#VIS_viewMoreComments" + h).empty(), $("#VIS_viewMoreComments" + h).hide(), $("#VIS-tp-comments-input" + h).show(), $("#VIS_commentsMsg" + h).show(), $("#VIS_viewAllComments" + h).text(VIS.Msg.getMsg("ViewMoreComments")), v(VIS.Utility.Util.getValueOfInt(b), !1, !1)) : rt(VIS.Utility.Util.getValueOfInt(b), !1, !1) }); $("#dwnldLetterAttach").click(function () { ri(n, k) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } }) } function vt(n, s, h) { var c = VIS.Utility.Util.getValueOfInt(n); $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedCallDetails", datatype: "json", type: "get", cache: !1, data: { ID: n }, success: function (n) { var w = JSON.parse(n), k = c, b = "", nt, tt, it, g; attach_ID = 0; attachLine_ID = 0; it = w.VA048_Duration >= 60 ? ni(w.VA048_Duration) : w.VA048_Duration + " " + VIS.Msg.getMsg("VA048_Seconds"); w.Attach != null && w.Attach.length > 0 && (b = w.Attach[0].Name, attach_ID = w.Attach[0].AttID, attachLine_ID = w.Attach[0].ID); VIS.Utility.Util.getValueOfString(w.VA048_Status).toLower() == "completed" && (tt = 'style = "color: #42d819;"'); r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); e = $('<div class="VIS-tp-borderBott"><div class="VIS-contentHeadOuter"><div class= "VIS-tp-recordIcon" ><i class="fa fa-phone" aria-hidden="true" title="Call"><\/i><\/div ><div class="VIS-contentHead"><div class="VIS-contentTitile"><h6 class="mb-0">' + s + "<\/h6><small>" + w.VA048_From + '<\/small><\/div><div class="align-items-center d-flex VIS-tp-rightIcons"><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div><\/div><\/div>'); nt = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div class="" ><table height="50px" width="100%"><tr class="VIS-call-col-header" ><td>' + VIS.Msg.getMsg("VA048_To") + "<\/td><td>" + VIS.Msg.getMsg("VA048_Duration") + '<\/td><\/tr><tr class="VIS-call-col-data " ><td>' + w.VA048_To + "<\/td><td>" + it + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Created") + "<\/td><td>" + VIS.Msg.getMsg("VA048_Status") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + new Date(w.Created).toLocaleString() + "<\/td><td " + tt + " >" + w.VA048_Status + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("VA048_Price") + "<\/td><td>" + VIS.Msg.getMsg("VA048_PriceUnit") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + w.VA048_Price + "<\/td><td>" + w.VA048_Price_Unit + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Category") + "<\/td><td>" + VIS.Msg.getMsg("Attachments") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + VIS.Msg.getMsg("VA048_CallType") + '<\/td><td class="VIS-tp-attchDownload" id="dwnldCallAttach">' + b + '<\/td><\/tr><\/table><\/div><\/div><div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel" ><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div class="" ><table height="50px" width="100%"><tr class="VIS-call-col-header" ><td>' + VIS.Msg.getMsg("VA048_To") + "<\/td><td>" + VIS.Msg.getMsg("VA048_Duration") + '<\/td><\/tr><tr class="VIS-call-col-data " ><td>' + w.VA048_To + "<\/td><td>" + w.VA048_Duration + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Created") + "<\/td><td>" + VIS.Msg.getMsg("VA048_Status") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + w.Created + '<\/td><td style="color: #42d819;">' + w.VA048_Status + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("VA048_Price") + "Price<\/td><td>" + VIS.Msg.getMsg("VA048_PriceUnit") + 'Price Unit<\/td><\/tr><tr class="VIS-call-col-data"><td>' + w.VA048_Price + "<\/td><td>" + w.VA048_Price_Unit + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Category") + "<\/td><td>" + VIS.Msg.getMsg("Attachments") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + VIS.Msg.getMsg("VA048_CallType") + '<\/td><td class="VIS-tp-attchDownload" id="dwnldCallAttach">' + b + "<\/td><\/tr><\/table><\/div><\/div>"); y = $('<div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); g = $('<div class="VIS-mail-header VIS-tp-recordDetail"><\/div>'); g.append(nt); r.append(e).append(g); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); v(VIS.Utility.Util.getValueOfInt(k), !1, !0); $("#VIS_recordDetail" + h).show(); $("#dwnldCallAttach").click(function () { ui(attachLine_ID, attach_ID, b) }); $("#VIS_btnComments" + h).click(function (n) { a(!1, !0, n) }); $("#VIS_txtComments" + h).keyup(function (n) { a(!1, !0, n) }); $("#VIS_viewAllComments" + h).click(function () { $("#VIS_viewAllComments" + h).text() == VIS.Msg.getMsg("HideComments") ? ($("#VIS_viewMoreComments" + h).empty(), $("#VIS_viewMoreComments" + h).hide(), $("#VIS-tp-comments-input" + h).show(), $("#VIS_commentsMsg" + h).show(), $("#VIS_viewAllComments" + h).text(VIS.Msg.getMsg("ViewMoreComments")), v(VIS.Utility.Util.getValueOfInt(k), !1, !0)) : rt(VIS.Utility.Util.getValueOfInt(k), !1, !0) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } }) } function yt(n, s, h) { var w = "", tt, c = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedAppointmentDetails", { record_ID: n }, null), b, k, g, nt; if (c != null) { if (strApp = "", b = VIS.Utility.Util.getValueOfString(c.AppointmentsInfo_ID), k = c.AttendeeInfo, k != null && k != "" && (names = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "AttachmentHistory/GetUser", { UserQry: k }, null), names != null && names.length > 0)) { for (strApp = "", g = 0; g < names.length; g++)strApp += names[g] + ", "; strApp = strApp.substring(0, strApp.length - 2); w = strApp } r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); e = $('<div class="VIS-tp-borderBott"><div class="VIS-contentHeadOuter"><div class= "VIS-tp-recordIcon" ><i class="vis vis-task" title="task"><\/i><\/div ><div class="VIS-contentHead"><div class="VIS-contentTitile"><h6 class="mb-0">' + VIS.Msg.getMsg("Appointment") + "<\/h6><small>" + c.Subject + '<\/small><\/div><div class="align-items-center d-flex VIS-tp-rightIcons"><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div><\/div><\/div>'); tt = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div ><table height="50px" width="100%"><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Location") + "<\/td><td>" + VIS.Msg.getMsg("AllDay") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + c.Location + "<\/td><td>" + c.Allday + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("StartDate") + "<\/td><td>" + VIS.Msg.getMsg("EndDate") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + new Date(c.StartDate).toLocaleString() + "<\/td><td>" + new Date(c.EndDate).toLocaleString() + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Contacts") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + w + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Description") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + c.Description + '<\/td><\/tr><\/table><\/div><\/div><div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div ><table height="50px" width="100%"><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Location") + "<\/td><td>" + VIS.Msg.getMsg("AllDay") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + c.Location + "<\/td><td>" + c.Allday + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("StartDate") + "<\/td><td>" + VIS.Msg.getMsg("EndDate") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + c.StartDate + "<\/td><td>" + c.EndDate + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Contacts") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + w + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Description") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + c.Description + "<\/td><\/tr><\/table><\/div><\/div>"); y = $('<div id="ViewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); nt = $('<div class="VIS-mail-header VIS-tp-recordDetail"><\/div>'); nt.append(tt); r.append(e).append(nt); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); v(VIS.Utility.Util.getValueOfInt(b), !0, !1); w = ""; $("#VIS_recordDetail" + h).show(); $("#VIS_btnComments" + h).click(function (n) { a(!0, !1, n) }); $("#VIS_txtComments" + h).keyup(function (n) { a(!0, !1, n) }); $("#VIS_viewAllComments" + h).click(function () { $("#VIS_viewAllComments" + h).text() == VIS.Msg.getMsg("HideComments") ? ($("#VIS_viewMoreComments" + h).empty(), $("#VIS_viewMoreComments" + h).hide(), $("#VIS-tp-comments-input" + h).show(), $("#VIS_commentsMsg" + h).show(), $("#VIS_viewAllComments" + h).text(VIS.Msg.getMsg("ViewMoreComments")), v(VIS.Utility.Util.getValueOfInt(b), !0, !1)) : rt(VIS.Utility.Util.getValueOfInt(b), !0, !1) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } } function pt(n, s, h) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedTaskDetails", datatype: "json", type: "get", cache: !1, data: { record_ID: n }, success: function (n) { var s = JSON.parse(n), ft = "", g, c, w, nt, tt, k, b, it; if (s != null) { if (w = "", nt = s.AttendeeInfo, ht = s.IsTaskClosed, g = VIS.Utility.Util.getValueOfString(s.AppointmentsInfo_ID), nt != null && nt != "" && (names = VIS.dataContext.getJSONData(VIS.Application.contextUrl + "AttachmentHistory/GetUser", { UserQry: nt }, null), names != null && names.length > 0)) { for (w = "", tt = 0; tt < names.length; tt++)w += names[tt] + ", "; w = w.substring(0, w.length - 2); ft = w } VIS.Utility.Util.getValueOfString(s.PriorityKey) != "" && (s.PriorityKey == "1" ? (b = "color: #f60000;", k = "Urgent") : s.PriorityKey == "3" ? (b = "color: #fb9300;", k = "High") : s.PriorityKey == "5" ? (b = "color: #6f04e8;", k = "Medium") : s.PriorityKey == "7" ? (b = "color: #03e5f3;", k = "Low") : s.PriorityKey == "9" && (b = "color: #42d819;", k = "Minor")); r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); e = $('<div class="VIS-tp-borderBott"><div class="VIS-contentHeadOuter"><div class= "VIS-tp-recordIcon" ><i class="vis vis-task" title="task"><\/i><\/div ><div class="VIS-contentHead"><div class="VIS-contentTitile"><h6 class="mb-0">' + VIS.Msg.getMsg("Task") + "<\/h6><small>" + s.Subject + '<\/small><\/div><div class="align-items-center d-flex VIS-tp-rightIcons"><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div><\/div><\/div>'); c = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div class="VIS-tp-taskcontTag" >' + (s.IsTaskClosed ? '<span class="VIS-tp-taskTag">' + VIS.Msg.getMsg("Closed") + "<\/span>" : "") + '<table height="50px" width="100%"><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Priority") + "<\/td><td>" + VIS.Msg.getMsg("Status") + '<\/td><\/tr><tr class="VIS-call-col-data"><td style="' + b + '">' + k + "<\/td><td>" + VIS.Utility.Util.getValueOfInt(s.TaskStatus) * 10 + '%<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("StartDate") + "<\/td><td>" + VIS.Msg.getMsg("EndDate") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + new Date(s.StartDate).toLocaleString() + "<\/td><td>" + new Date(s.EndDate).toLocaleString() + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("ASSIGNEDTO") + "<\/td><td>" + VIS.Msg.getMsg("Category") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + s.AssignedTo + "<\/td><td>" + s.CategoryName + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Result") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + s.Result + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Description") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + s.Description + '<\/td><\/tr><tr><td><div class="vis-float-left vis-frm-ls-top"><input id="VIS_chkTaskComplete' + h + '" value="1" type="checkbox" class="vis-float-left"><label id="VIS_lblTaskComplete' + h + '" for="chkTaskComplete" class="wsp-task-from-inputLabel vis-float-left" style="margin:0 0 0 5px;">' + VIS.Msg.getMsg("Closed") + '<\/label><\/div><\/td><td><div class="vis-float-right"><a href="javascript:void(0)" id="VIS_hlnktaskdone' + h + '" class="vis-btn vis-btn-done vis-icon-doneButton vis-float-right vis-btnOk"> <span class="vis-btn-ico vis-btn-done-bg vis-btn-done-border"><\/span>' + VIS.Msg.getMsg("Done") + '<\/a><\/div><\/td><\/tr><\/table><\/div><\/div><div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div id="VIS-tp-comments-input' + h + '" class="VIS-tp-comments-input"><div class="VIS-tp-taskcontTag" >' + (s.IsTaskClosed ? '<span class="VIS-tp-taskTag">' + VIS.Msg.getMsg("Closed") + "<\/span>" : "") + '<table height="50px" width="100%"><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("Priority") + "<\/td><td>" + VIS.Msg.getMsg("Status") + '<\/td><\/tr><tr class="VIS-call-col-data"><td style="' + b + '">' + s.Priority + "<\/td><td>" + VIS.Utility.Util.getValueOfInt(s.TaskStatus) * 10 + '%<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("StartDate") + "<\/td><td>" + VIS.Msg.getMsg("EndDate") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + s.StartDate + "<\/td><td>" + s.EndDate + '<\/td><\/tr><tr class="VIS-call-col-header"><td>' + VIS.Msg.getMsg("ASSIGNEDTO") + "<\/td><td>" + VIS.Msg.getMsg("Category") + '<\/td><\/tr><tr class="VIS-call-col-data"><td>' + s.AssignedTo + "<\/td><td>" + s.CategoryName + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Result") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + s.Result + '<\/td><\/tr><tr class="VIS-call-col-header"><td colspan="2">' + VIS.Msg.getMsg("Description") + '<\/td><\/tr><tr class="VIS-call-col-data"><td colspan="2">' + s.Description + "<\/td><\/tr><\/table><\/div><\/div>"); y = $('<div id="VIS_viewMoreComments' + h + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div><div id="VIS_commentsdata' + h + '"><div class="pr-0 m-0 VIS-tp-commentsField d-flex flex-column w-100"><p id="VIS_viewAllComments' + h + '" class="vis-attachhistory-view-comments" > ' + VIS.Msg.getMsg("ViewMoreComments") + '<\/p><div class="vis-attachhistory-comments vis-feedMessage m-0"><input id="VIS_txtComments' + h + '" type="text" placeholder="' + VIS.Msg.getMsg("TypeComment") + '"><\/input><span id="VIS_btnComments' + h + '" class="vis-attachhistory-comment-icon vis vis-sms"><\/span><\/div><\/div><\/div>'); it = $('<div class="VIS-mail-header VIS-tp-recordDetail"><\/div>'); it.append(c); r.append(e).append(it); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); v(VIS.Utility.Util.getValueOfInt(g), !0, !1); ft = ""; $("#VIS_recordDetail" + h).show(); $("#VIS_btnComments" + h).click(function (n) { a(!0, !1, n) }); $("#VIS_txtComments" + h).keyup(function (n) { a(!0, !1, n) }); $("#VIS_viewAllComments" + h).click(function () { $("#VIS_viewAllComments" + h).text() == VIS.Msg.getMsg("HideComments") ? ($("#VIS_viewMoreComments" + h).empty(), $("#VIS_viewMoreComments" + h).hide(), $("#VIS-tp-comments-input" + h).show(), $("#VIS_commentsMsg" + h).show(), $("#VIS_viewAllComments" + h).text(VIS.Msg.getMsg("ViewMoreComments")), v(VIS.Utility.Util.getValueOfInt(g), !0, !1)) : rt(VIS.Utility.Util.getValueOfInt(g), !0, !1) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }); ht && (c.find("#VIS_chkTaskComplete" + h).hide(), c.find("#VIS_hlnktaskdone" + h).hide(), c.find("#VIS_lblTaskComplete" + h).hide()); c.find("#VIS_hlnktaskdone" + h).on("click", function () { var i, n; ut != null && ut.empty(); var t = s.Subject, o = s.CategoryName, r = s.StartDate, u = s.EndDate; if (u < r) { ut.append(VIS.Msg.getMsg("WSP_EndDateShouldBeGreaterThanStartDate")); return } var l = s.Description, a = s.Result, v = s.PriorityKey, b = s.Priority, y = parseInt(s.TaskStatus), k = s.TaskStatus, f = "", p = c.find("#VIS_chkTaskComplete" + h).prop("checked", !0); f = p.is(":checked") ? !0 : !1; var e = [], w = s.AppointmentsInfo_ID; WspSharedUser = []; i = 0; n = s.UserID; i = n != null && n != 0 ? n : VIS.context.getAD_User_ID(); e.push({ AppointmentsInfo_ID: w, Title: t, Description: l, Start: r, End: u, Categories: o, TaskStatus: y, PriorityKey: v, Ad_User_ID: i, Contacts: [], ContactsInfo: WspSharedUser, isClosed: f, Result: a }); t != "" && t.trim().length > 0 && $.ajax({ url: VIS.Application.contextUrl + "WSP/Home/UpdateJson_Task", type: "POST", datatype: "JSON", contentType: "application/json; charset=utf-8", async: !0, data: JSON.stringify({ models: e }), success: function (n) { var t = JSON.parse(n); VIS.ADialog.info("WSP_TaskUpdated", !0, null); c.find("#VIS_chkTaskComplete" + h).hide(); c.find("#VIS_hlnktaskdone" + h).hide(); c.find("#VIS_lblTaskComplete" + h).hide() } }) }) } }, error: function () { } }) } function wt(n, s, h) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedAttachmentDetails", datatype: "json", type: "get", cache: !1, data: { record_ID: n }, success: function (n) { var s = JSON.parse(n), y = "", c, a, v; if (s != null && s.length > 0) for (c = 0; c < s.length; c++)a = "", a = VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".doc" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".docx" ? '<i class="vis vis-doc-word"><\/i>' : VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".xls" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".xlsx" ? '<i class="vis vis-doc-excel"><\/i>' : VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".ppt" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".pptx" ? '<i class="vis vis-doc-pp"><\/i>' : VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".pdf" ? '<i class="vis vis-doc-pdf"><\/i>' : VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".txt" ? '<i class="vis vis-doc-text"><\/i>' : VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".png" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".jpg" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".jpeg" || VIS.Utility.Util.getValueOfString(s[c].FileType).toString().toLower() == ".gif" ? '<i class="vis vis-doc-img"><\/i>' : '<i class="vis vis-doc-img"><\/i>', y += '<div class="VIS-tp-recordWrap"><div class="VIS-tp-attachIcon">' + a + '<\/div><div data-filename="' + VIS.Utility.Util.getValueOfString(s[c].FileName) + '" data-attid="' + VIS.Utility.Util.getValueOfString(s[c].AD_Attachment_ID) + '" data-id="' + VIS.Utility.Util.getValueOfString(s[c].ID) + '" class="VIS-tp-attachInfo" ><h6>' + VIS.Utility.Util.getValueOfString(s[c].FileName) + "<\/h6><small>" + VIS.Utility.Util.getValueOfString(s[c].FileSize) + ' kb<\/small><\/div><div class="VIS-tp-recordInfoRight"><span class="VIS-tp-dateTime">' + new Date(s[c].CreatedOn).toLocaleString() + "<\/span><small>By: " + VIS.Utility.Util.getValueOfString(s[c].CreatedBy) + "<\/small><\/div><\/div>"; r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); e = $('<div class="VIS-contentHeadOuter VIS-tp-borderBott"><div class= "VIS-tp-recordIcon" ><i class="vis vis-attachmentx"><\/i><\/div><div class="VIS-contentHead"><span class="VIS-letter-header">' + VIS.Msg.getMsg("Attachment") + '<\/span><\/div><div class="align-items-center d-flex VIS-tp-rightIcons" ><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv"><div class="VIS-tp-contentWrap VIS-tp-attachmentContent">' + y + "<\/div><\/div>"); v = $('<div class="VIS-mail-header VIS-tp-recordDetail"><\/div>'); v.append(f); r.append(e).append(v); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); attdInfo = ""; $("#VIS_recordDetail" + h).show(); $(".VIS-tp-attachInfo").click(function (n) { $(".VIS-tp-contentWrap").css({ cursor: "wait" }); ii(n) }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } }) } function ot(n, s, h) { $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/GetSelectedChatDetails", datatype: "json", type: "get", cache: !1, data: { record_ID: n }, success: function (s) { var a = JSON.parse(s), b = "", g = !1, ut = 0, w, ft, et = VIS.context.getAD_User_Name(), ot, c, k, it, rt; if (a != null && a.length > 0) for (ot = "", c = 0; c < a.length; c++) { if (a[c].Created != null && a[c].Created != "") { k = new Date; w = new Date(a[c].Created.toString()); var v = w.getHours(), nt = w.getMinutes(), tt = " AM"; v == 0 ? v = 12 : v < 12 ? v = v : v == 12 ? (v = v, tt = " PM") : v > 12 && (v = v - 12, tt = " PM"); ft = w.getMonth() + "/" + w.getDate() + "/" + w.getFullYear() + " | " + (v >= 10 ? v : "0" + v) + ":" + (nt >= 10 ? nt : "0" + nt) + tt } c == 0 && (b = '<div class="VIS-tp-contentWrap VIS-tp-attachmentContent">'); (c == 0 || c == VIS.Utility.Util.getValueOfInt(a.length) - 1) && w.getDate() == k.getDate() && w.getMonth() == k.getMonth() && w.getFullYear() == k.getFullYear() && (g = !0); ut = VIS.Utility.Util.getValueOfInt(a[c].Record_ID); b += et.toString().toLower() == a[c].UserName.toString().toLower() ? '<div class="VIS-tp-recordWrap VIS-tp-msgSend"><div class="VIS-tp-userImg" >' + a[c].UserImage + '<\/div><div class="VIS-tp-recordInfo pr-0"><div class="VIS-tp-chatInfo"><h6>' + a[c].UserName + "<\/h6><span>" + w.toLocaleString() + '<\/span><\/div><p class="VIS-tp-message">' + a[c].CharacterData + "<\/p><\/div><\/div >" : '<div class="VIS-tp-recordWrap VIS-tp-msgRecevied"><div class="VIS-tp-userImg" >' + a[c].UserImage + '<\/div><div class="VIS-tp-recordInfo pr-0"><div class="VIS-tp-chatInfo"><h6>' + a[c].UserName + "<\/h6><span>" + w.toLocaleString() + '<\/span><\/div><p class="VIS-tp-message">' + a[c].CharacterData + "<\/p><\/div><\/div>"; c == a.length - 1 && (b += "<\/div>") } r.length < 1 && (r = $('<div id="VIS_recordDetail' + h + '" class="VIS-tp-detailsPanel"><\/div>')); r.empty(); it = ""; g && (it = '<div class="VIS-chatBoxWrap"><div class="VIS-chat-box"><textarea id="VIS_chatBox' + h + '" class="VIS-chat-msgbox" style="height:46px;" maxlength="500"><\/textarea><\/div><div class="VIS-chat-send-div"><div style="float:left;"><\/div><div class="VIS-chat-send"><i class="fa fa-paper-plane VIS-tp-chatBtn" data-chid="' + VIS.Utility.Util.getValueOfInt(n).toString() + '" data-recid="' + ut.toString() + '" id="VIS_imgSend' + h + '" ><\/i><i id="VIS_imgCancel' + h + '" class="fa fa-times-circle VIS-tp-chatBtn"><\/i><\/div><\/div><\/div>'); e = $('<div class="VIS-contentHeadOuter VIS-tp-borderBott" ><div class= "VIS-tp-recordIcon" ><i class="vis vis-chat"><\/i><\/div><div class="VIS-contentHead"><span class="VIS-letter-header">' + VIS.Msg.getMsg("Chat") + '<\/span><\/div><div class="align-items-center d-flex VIS-tp-rightIcons" ><span id="VIS_prtHistory' + h + '"><i class="vis vis-print" title="Print"><\/i><\/span><span><i id="VIS_prevRecord' + h + '" class="fa fa-arrow-left"><\/i><\/span><span><i id="VIS_nextRecord' + h + '" class="fa fa-arrow-right"><\/i><\/span><span class="VIS-close-btn" id="VIS_btnClose' + h + '"><i class="vis vis-cross"><\/i><\/span><\/div><\/div>'); f = $('<div class="VIS-tp-contentdiv VIS-tp-contentPanel"><div class="' + (g ? "VIS-chatContentWrap" : "") + '" >' + b + "<\/div>"); y = $(it + "<\/div>"); rt = $('<div class="VIS-mail-header VIS-tp-recordDetail"><\/div>'); rt.append(f).append(y); r.append(e).append(rt); t.html().toString().contains("VIS_recordDetail" + h) || t.append(r); t.html().toString().contains("VIS_pagingHtml" + h) || t.append(p); attdInfo = ""; $("#VIS_recordDetail" + h).show(); $("#VIS_imgSend" + h).click(function (n) { fi(n) }); $("#VIS_imgCancel" + h).click(function () { $("#VIS_chatBox" + h).val("") }); $("#VIS_prtHistory" + h).find("i").click(function () { d(f.html()) }); $("#VIS_prevRecord" + h).click(function () { i > 0 && o(VIS.Utility.Util.getValueOfInt(i) - 1, h) }); $("#VIS_nextRecord" + h).click(function () { i < VIS.Utility.Util.getValueOfInt(u) - 1 && o(VIS.Utility.Util.getValueOfInt(i) + 1, h) }); $("#VIS_btnClose" + h).click(function () { $("#VIS_recordDetail" + h).hide(); l() }) } }) } function ni(n) { var u = ~~(n / 3600), i = ~~(n % 3600 / 60), r = n % 60, t = ""; return u > 0 && (t += "" + hrs + ":" + (i < 10 ? "0" : "")), t += "" + i + ":" + (r < 10 ? "0" : ""), t += "" + r, t + " " + VIS.Msg.getMsg("VA048_Minutes") } function d(n) { var t = window.open(), i = '<link rel="stylesheet" href="' + VIS.Application.contextUrl + 'Areas/VIS/Content/VIS.all.min.css" />'; t.document.write(i + n); setTimeout(function () { t.print(); t.close() }, 300) } function ti(n) { n != null && n != 0 && $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/DownloadAllAttachments", datatype: "json", type: "get", cache: !1, data: { ID: n, Name: name }, success: function (n) { var t = JSON.parse(n), i; t != null && t != "" ? (i = VIS.Application.contextUrl + "TempDownload/" + t, window.open(i)) : VIS.ADialog.error("AttachmentNotFound") } }) } function ii(n) { var t = n.target, r = "", i = "", u = ""; ($(t).is("div") ? (r = $(t).data("filename"), u = $(t).data("attid"), i = $(t).data("id")) : $(t).is("h6") && (r = $(t).parent().data("filename"), u = $(t).parent().data("attid"), i = $(t).parent().data("id")), i != null && i != 0) && $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/DownloadHistoryAttachment", datatype: "json", type: "get", cache: !1, data: { AttID: u, ID: i, Name: r }, success: function (n) { var t = JSON.parse(n), i; t != null && t != "" ? (i = VIS.Application.contextUrl + "TempDownload/" + t, $("#tblAttach").css({ cursor: "default" }), window.open(i)) : VIS.ADialog.error("AttachmentNotFound") } }) } function ri(n, t) { n != null && n != 0 && $.ajax({ url: VIS.Application.contextUrl + "VIS/HistoryDetailsData/DownloadAttachment", datatype: "json", type: "get", cache: !1, data: { ID: n, Name: t }, success: function (n) { var t = JSON.parse(n), i; t != null && t != "" ? (i = VIS.Application.contextUrl + "TempDownload/" + t, window.open(i)) : VIS.ADialog.error("AttachmentNotFound") } }) } function ui(n, t, i) { n != null && n != 0 && $.ajax({ url: VIS.Application.contextUrl + "AttachmentHistory/DownloadAttachmentCall", datatype: "json", type: "get", cache: !1, data: { AttID: t, ID: n, Name: i }, success: function (n) { var t = JSON.parse(n), i; t != null && t != "" ? (i = VIS.Application.contextUrl + "TempDownload/" + t, window.open(i)) : VIS.ADialog.error("AttachmentNotFound") } }) } function st(n, t, i, r, u, f, e) { var s = null, h = e.target, c, l, a, o; $(h).is("i") && (f == "R" || f == "RA") && (c = $(h).data("mailto"), l = $(h).data("mailcc"), a = $(h).data("mailbcc")); f == "R" || f == "RA" ? s = new VIS.Email(c, null, null, n, !0, !0, t, i, "RE: " + VIS.Utility.Util.getValueOfString(r), u) : f == "F" && (s = new VIS.Email("", null, null, n, !0, !0, t, i, "FW: " + VIS.Utility.Util.getValueOfString(r), u)); o = new VIS.CFrame; o.setName(VIS.Msg.getMsg("EMail")); o.setTitle(VIS.Msg.getMsg("EMail")); o.hideHeader(!0); o.setContent(s); o.show(); f == "RA" && s.showCcBccMails(l.replace(/,/g, ""), a.replace(/,/g, "")); s.initializeComponent() } function fi(t) { var r = t.target, e = 0, u = 0, i; if (_AD_Table_ID = 876, $(r).is("i") && (e = $(r).data("recid"), u = $(r).data("chid")), i = $("#VIS_chatBox" + n).val(), $.trim(i) == "" || i == "" || i == null) return VIS.ADialog.info("EnterData"), t != undefined && t.preventDefault(), !1; var f = new VIS.Chat(e, u, _AD_Table_ID, "info: test", this.windowNo); f.prop.ChatText = i; f.onClose = function () { }; VIS.dataContext.saveChat(f.prop); ot(u, "", n) } function rt(n, t, i) { $.ajax({ url: VIS.Application.contextUrl + "AttachmentHistory/ViewChatonHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: n, isAppointment: t, isCall: i }, success: function (n) { var r = JSON.parse(n); oi(r, t, i) }, error: function () { VIS.ADialog.error("RecordNotSaved") } }) } function a(t, r, u) { var o = u.target, e, f; (u.keyCode == undefined || u.keyCode == 13) && (u.keyCode != undefined || $(o).hasClass("vis-attachhistory-comment-icon")) && (e = 0, e = $("#rowId" + i).data("rid"), e != 0) && (f = "", f = $("#VIS_txtComments" + n).val(), f.length != 0) && $.ajax({ url: VIS.Application.contextUrl + "AttachmentHistory/SaveComment", datatype: "json", type: "POST", cache: !1, data: { ID: e, Text: f, isAppointment: t, isCall: r }, success: function (t) { var i = JSON.parse(t), r, e, u; i != null && (u = i.length - 1); e = i[u].UserImage != "VIS_NoRecordFound" && i[u].UserImage != "VIS_FileDoesn'tExist" && i[u].UserImage != null ? '<img  class="userAvatar-Feeds"  src="' + i[u].UserImage + "?" + new Date + '">' : '<i class="fa fa-user userAvatar-Feeds"><\/i>'; $("#VIS_txtComments" + n).val(""); $("#VIS_commentsdata" + n).html().contains("VIS_commentsMsg") ? (r = $('<div class= "vis-attachhistory-comment-detail VIS-feedDetails-cmnt d-flex" >' + e + '<div class="vis-attachhistory-comment-text ml-0"><div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">Me <\/h6><div class="vis-attachhistory-comment-dateTime"><p>' + (new Date).toLocaleString().replace(",", "").replace(/:.. /, " ") + '<\/p><\/div><\/div><p class= "VIS-attachhistory-comment-text" >' + f + "<\/p><\/div><\/div>"), $("#VIS_commentsMsg" + n).empty(), $("#VIS_commentsMsg" + n).append(r), $("#VIS_viewMoreComments" + n).is(":visible") && $("#VIS_viewMoreComments" + n).append(r), $("#VIS_commentsdata" + n).show(), $("#VIS_commentsMsg" + n).show()) : (r = $('<div id="VIS_commentsMsg' + n + '"  class="vis-attachhistory-comment-data mb-0 VIS-tp-commentData"><div class= "vis-attachhistory-comment-detail VIS-feedDetails-cmnt d-flex" >' + e + '<div class="vis-attachhistory-comment-text ml-0"><div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">Me <\/h6><div class="vis-attachhistory-comment-dateTime"><p>' + (new Date).toLocaleString().replace(",", "").replace(/:.. /, " ") + '<\/p><\/div><\/div><p class= "VIS-attachhistory-comment-text" >' + f + "<\/p><\/div><\/div><\/div>"), $("#VIS_commentsdata" + n).prepend(r), $("#VIS_viewMoreComments" + n).is(":visible") && $("#VIS_viewMoreComments" + n).append(r)) }, error: function () { VIS.ADialog.error("RecordNotSaved") } }) } function ei(n, t) { return n += ' <div class="vis-attachhistory-comment-data  mb-0 VIS-tp-commentData"><div class="vis-attachhistory-comment-detail VIS-feedDetails-cmnt d-flex">', n += t.UserImage != "VIS_NoRecordFound" && t.UserImage != "VIS_FileDoesn'tExist" && t.UserImage != null ? '<img  class="userAvatar-Feeds"  src="' + t.UserImage + "?" + new Date + '">' : '<i class="fa fa-user userAvatar-Feeds"><\/i>', n += '<div class="vis-attachhistory-comment-text ml-0">', n += t.CreatedBy == VIS.Env.getCtx().getAD_User_ID() ? '<div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">' + VIS.Msg.getMsg("Me") + " <\/h6>" : '<div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">' + t.UserName + "<\/h6>", n + ('<div class="vis-attachhistory-comment-dateTime"><p>' + new Date(t.Created).toLocaleString() + '<\/p><\/div><\/div> <p class="VIS-attachhistory-comment-text">' + t.CharacterData + "<\/p><\/div><\/div><\/div>") } function oi(i) { var r, u; if (i.length > 0) { for (r = '<div class="vis-attachhistory-comments-container">', u = 0; u < i.length; u++)r = ei(r, i[u]); r += "<\/div>"; $("#VIS_viewMoreComments" + n).show(); $("#VIS-tp-comments-input" + n).hide(); $("#VIS_viewMoreComments" + n).empty(); $("#VIS_commentsMsg" + n).hide(); $("#VIS_viewAllComments" + n).text(VIS.Msg.getMsg("HideComments")); $("#VIS_viewMoreComments" + n).height(t.find(".VIS-tp-contentdiv").height() - $("#VIS_commentsdata" + n).height()); $("#VIS_viewMoreComments" + n).append(r) } } function si(t, i) { return t += '<div class="vis-attachhistory-comment-detail VIS-feedDetails-cmnt d-flex">', t += i.UserImage != "VIS_NoRecordFound" && i.UserImage != "VIS_FileDoesn'tExist" && i.UserImage != null ? '<img  class="userAvatar-Feeds"  src="' + i.UserImage + "?" + new Date + '">' : '<i class="fa fa-user userAvatar-Feeds"><\/i>', t += '<div class="vis-attachhistory-comment-text ml-0">', t += i.CreatedBy == VIS.Env.getCtx().getAD_User_ID() ? '<div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">' + VIS.Msg.getMsg("Me") + " <\/h6>" : '<div class="d-flex justify-content-between VIS-tp-commentHead"><h6 class="VIS-attachhistory-comment-text">' + i.UserName + "<\/h6>", t += '<div class="vis-attachhistory-comment-dateTime"><p>' + new Date(i.Created).toLocaleString() + '<\/p><\/div><\/div> <p class="VIS-attachhistory-comment-text">' + i.CharacterData + "<\/p><\/div><\/div > ", $("#VIS_commentsdata" + n).html().contains("VIS_commentsMsg") || (t = '<div id="VIS_commentsMsg' + n + '" class="vis-attachhistory-comment-data  mb-0 VIS-tp-commentData">' + t + "<\/div >"), t } function v(t, i, r) { $.ajax({ url: VIS.Application.contextUrl + "AttachmentHistory/ViewChatonLastHistory", datatype: "json", type: "POST", cache: !1, data: { record_ID: t, isAppointment: i, isCall: r }, success: function (t) { var r = JSON.parse(t), i; r.length > 0 && (i = "", i = si(i, r[0]), $("#VIS_commentsMsg" + n).empty(), $("#VIS_commentsdata" + n).html().contains("VIS_commentsMsg") ? $("#VIS_commentsMsg" + n).prepend(i) : $("#VIS_commentsdata" + n).prepend(i)) } }) } this.record_ID = 0; this.windowNo = 0; this.table_ID = 0; this.frame; this.curTab = null; this.selectedRow = null; this.panelWidth; var t = $('<div class="VIS-root-div"><\/div>'), g, r, e, f, y, p, bt, nt = 10, h = 0, kt = 0, dt = 0, w = 0, u = 0, s = 0, c = 0, i = 0, tt, k = 0, b = 0, n = 0, ut = null, ht; this.init = function () { g = $('<div class="VIS-testPanel VIS-HistGrd-data" id="VIS_HistoryGrd' + this.windowNo + '" ><\/div>'); r = $('<div id="VIS_recordDetail' + this.windowNo + '" style="display:none;" class="VIS-tp-detailsPanel"><\/div>'); t.prepend(g); p = $('<div id="VIS_pagingHtml' + this.windowNo + '" class="vis-ad-w-p-s-pages VIS-root-pagingHtml"><ul class="vis-ad-w-p-s-plst w-100"><li class="flex-fill"><div id="VIS_pagingText' + this.windowNo + '" class="vis-ad-w-p-s-result"><span class="vis-ad-w-p-s-statusdb" id="VIS_pageIndx' + n + '">0/0<\/span><span>Showing Result 0-0 of 0<\/span><\/div><\/li><li id="VIS_prevPage' + this.windowNo + '" style="opacity: 1;"><div ><i class="vis vis-pageup" title="Page Up(Alt+ Pg Up)" })="" style="opacity: 1;"><\/i><\/div><\/li><li><select id="VIS_ddlPages' + this.windowNo + '" class="vis-statusbar-combo"><option><\/option><\/select><\/li><li id="VIS_nextPage' + this.windowNo + '" style="opacity: 1;"><div ><i class="vis vis-pagedown" title="Page Down(Alt+ Pg Dn)" })="" style="opacity: 1;"><\/i><\/div><\/li><\/div><\/ul><\/div>'); bt = $('<div id="VIS_viewMoreComments' + this.windowNo + '" style="display:none;" class="VIS-tp-commentsPanel"><\/div>'); t.append(p); t.append(r); n = this.windowNo; l() }; this.getRoot = function () { return t }; this.update = function (n) { c = n; b = this.table_ID; ft(n, b); it(n, 0, this.windowNo, b) }; this.disposeComponent = function () { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.rowSource = null; this.panelWidth = null; _gridCtrl = null; t.remove(); t = null; n = 0 } } n.prototype.startPanel = function (n, t) { this.windowNo = n; this.curTab = t; this.init(); window_No = n; this.table_ID = t.getAD_Table_ID() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n) { this.panelWidth = n }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.HistoryDetailsTabPanel = n }(); VIS = window.VIS || {}, function () { function n() { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.selectedRow = null; this.panelWidth; var t = null, i = null, r = null, u = null, f = null, n = $('<div style="height:100%;width:100%;padding:15px"><\/div>'); this.init = function () { var e = '<div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Name: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblName"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Location: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblLocation"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Business Partner: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblBPartner"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Date Time: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblDateTime"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Amount: <\/span><label class="vis-testPanel-Label" id="' + this.windowNo + 'lblAmount"><\/label> <\/div>'; n.append(e); t = n.find("#" + this.windowNo + "lblName"); i = n.find("#" + this.windowNo + "lblLocation"); r = n.find("#" + this.windowNo + "lblBPartner"); u = n.find("#" + this.windowNo + "lblDateTime"); f = n.find("#" + this.windowNo + "lblAmount") }; this.getRoot = function () { return n }; this.update = function () { var n, e; t.text(VIS.context.getWindowContext(this.windowNo, "Name")); try { e = "C_Location_ID"; n = this.selectedRow[e.toLower()]; (VIS.DisplayType.IsLookup(this.curTab.getField(e).getDisplayType()) || VIS.DisplayType.Location == this.curTab.getField(e).getDisplayType()) && (n && (n = this.curTab.getField(e.toLower()).lookup.getDisplay(n)), i.text(n)); n = null; e = "C_BPartner_ID"; n = this.selectedRow[e.toLower()]; (VIS.DisplayType.IsLookup(this.curTab.getField(e).getDisplayType()) || VIS.DisplayType.Location == this.curTab.getField(e).getDisplayType()) && (n && (n = this.curTab.getField(e.toLower()).lookup.getDisplay(n)), r.text(n)); n = null; e = "T_DateTime"; VIS.DisplayType.IsDate(this.curTab.getField(e).getDisplayType()) && (n = this.curTab.getField(e).value, n = new Date(n).toLocaleString(), u.text(n)); n = null; e = "T_Amount"; n = this.selectedRow[e.toLower()]; f.text(n) } catch (o) { } }; this.disposeComponent = function () { this.record_ID = 0; this.windowNo = 0; this.curTab = null; this.rowSource = null; this.panelWidth = null; t.remove(); t = null; i.remove(); i = null; r.remove(); r = null; u.remove(); u = null; f.remove(); f = null; n.remove(); n = null } } n.prototype.startPanel = function (n, t) { this.windowNo = n; this.curTab = t; this.init() }; n.prototype.refreshPanelData = function (n, t) { this.record_ID = n; this.selectedRow = t; this.update(n) }; n.prototype.sizeChanged = function (n) { this.panelWidth = n }; n.prototype.dispose = function () { this.disposeComponent() }; VIS.TestPanel = n }(), function (n, t) { function i() { function r() { var u = t("#vis_theme"), r; u.on("click", "div.vis-theme-rec", function (n) { var r = t(n.currentTarget).data("color"); i(r) }); n.Application.theme && n.Application.theme != "" ? i(n.Application.theme) : (r = u.find("div.vis-theme-rec"), r.length > 0 && i(t(r[0]).data("color"))) } function i(n) { var t = document.documentElement, i = n.split("|"); t.style.setProperty("--v-c-primary", i[0]); t.style.setProperty("--v-c-on-primary", i[1]); t.style.setProperty("--v-c-secondary", i[2]); t.style.setProperty("--v-c-on-secondary", i[3]) } return { init: r, applyTheme: i } } n.themeMgr = i() }(VIS, jQuery), function (n, t) { VIS.VApp = function () { function i() { var n = t.context.getAD_Language().replace("_", "-"); Globalize.culture(n) } function r() { document.getElementById("vis_mainConatiner").removeChild(document.getElementById("vis_busyGrid")); var t = n("#vis_antiForgeryToken").val(); n.ajaxSetup({ headers: { VerificationToken: t } }); VIS.Application.isIOS = /ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()) } function u() { var n = t.Logging; n.VLogMgt.initialize(!0); n.VLogMgt.setLevel(VIS.Ini.getTraceLevel()) } function f() { VIS.Ini.updateLocalContextFromIni() } function e() { r(); i(); f(); u(); VIS.desktopMgr.start(); VIS.themeMgr.init(); VIS.Env.setWINDOW_PAGE_SIZE(VIS.Ini.getLocalStorage(VIS.IniConstants.WIN_PAGESIZE)); var e = n("#vis_userDate").find("span"); e.text(" " + (new Date).toLocaleDateString(t.context.getAD_Language().replace("_", "-"), { weekday: "long", year: "numeric", month: "long", day: "numeric" })) } return { init: e } }() }(jQuery, VIS)