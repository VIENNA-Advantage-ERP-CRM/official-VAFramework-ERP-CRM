/*** version 1.2.121.2***/(function(n){function i(n,t){if(!(n.originalEvent.touches.length>1)){n.preventDefault();var i=n.originalEvent.changedTouches[0],r=document.createEvent("MouseEvents");r.initMouseEvent(t,!0,!0,window,1,i.screenX,i.screenY,i.clientX,i.clientY,!1,!1,!1,!1,0,null);n.target.dispatchEvent(r)}}if(n.support.touch="ontouchend"in document,n.support.touch){var t=n.ui.mouse.prototype,u=t._mouseInit,f=t._mouseDestroy,r;t._touchStart=function(n){var t=this;!r&&t._mouseCapture(n.originalEvent.changedTouches[0])&&(r=!0,t._touchMoved=!1,i(n,"mouseover"),i(n,"mousemove"),i(n,"mousedown"))};t._touchMove=function(n){r&&(this._touchMoved=!0,i(n,"mousemove"))};t._touchEnd=function(n){r&&(i(n,"mouseup"),i(n,"mouseout"),this._touchMoved||i(n,"click"),r=!1)};t._mouseInit=function(){var t=this;t.element.bind({touchstart:n.proxy(t,"_touchStart"),touchmove:n.proxy(t,"_touchMove"),touchend:n.proxy(t,"_touchEnd")});u.call(t)};t._mouseDestroy=function(){var t=this;t.element.unbind({touchstart:n.proxy(t,"_touchStart"),touchmove:n.proxy(t,"_touchMove"),touchend:n.proxy(t,"_touchEnd")});f.call(t)}}})(jQuery);String.prototype.equals=function(n,t){return t?this.toString().toLowerCase()===n.toLowerCase():this.toString()===n};String.prototype.equalsIgnoreCase=function(n){return this.toString().toLowerCase()===n.toLowerCase()};String.prototype.startsWith=function(n){return n===""?!0:this==null||n==null?!1:(n=String(n),this.length>=n.length&&this.slice(0,n.length)===n)};String.prototype.endsWith=function(n){return n===""?!0:this==null||n==null?!1:(n=String(n),this.length>=n.length&&this.slice(this.length-n.length)===n)};String.prototype.contains=function(n){return this.indexOf(n)>-1};String.prototype.toUpper=function(){return this.toUpperCase()};String.prototype.toLower=function(){return this.toLowerCase()};String.prototype.compareTo=function(n){var u=this.length,f=n.length,o=u<f?u:f,t,r,e;for(i=0;i<o;i++)if(t=this.charCodeAt(i),r=n.charCodeAt(i),t!=r)return t>r?1:t<r?-1:0;return e=u-f,e>0?1:e<0?-1:0};String.prototype.replaceAll=function(n,t){var i=this;return i.replace(new RegExp(n,"g"),t)};Number.prototype.compareTo=function(n){var t=this-n;return t>0?1:t<0?-1:0};Array.prototype.indexOf||(Array.prototype.indexOf=function(n){for(var t=0;t<this.length;t++)if(this[t]===n)return t;return-1});StringBuilder=function(n){this.str=n?n:""};StringBuilder.prototype.append=function(n){return this.str+=n,this};StringBuilder.prototype.toString=function(){return this.str};StringBuilder.prototype.endsWith=function(n){return this.str.endsWith(n)};StringBuilder.prototype.replace=function(n,t){var i=this.str;return i.replace(new RegExp(n,"g"),t)};StringBuilder.prototype.indexOf=function(n){return this.str.indexOf(n)};StringBuilder.prototype.length=function(){return this.str.length};StringBuilder.prototype.insert=function(n,t){return this.str=n>0?this.str.substring(0,n)+t+this.str.substring(n,this.str.length):t+this.str,str};StringBuilder.prototype.clear=function(){return this.str.length=0,this.str="",this};Date.prototype.toUniversalTime=function(){return new Date(this.getTime())};VISUtil=window.VISUtil||{},function(n,t){function c(t,i,r){var u=function(u){var f,e,o;if(isNaN(u)||u===null)return 0;if(f=u.toString(),e=f.indexOf("."),e!=-1){if(o=f.substring(0,e),o.length>t)return o=o.substring(0,t),o+f.substring(e,f.Length-e)}else if(i===0&&r===0){if(f>n.EnvConstants.INT32MAXVALUE)return n.EnvConstants.INT32MAXVALUE;if(f<-1*(n.EnvConstants.INT32MAXVALUE+1))return-1*(n.EnvConstants.INT32MAXVALUE+1)}return u};this.GetFormatedValue=function(n){var t=u(n).toString();return r!=0&&(t.indexOf(".")<=-1?t=parseFloat(t).toFixed(r):t.split(".")[1].length>r?(t=parseFloat(t).toFixed(i),t=parseFloat(t)):r===i&&(t=parseFloat(t).toFixed(r))),t};this.dispose=function(){this.GetFormatedValue=null;u=null}}function r(n){this.pattern;this.applyPattern(n)}function f(t,i,r,u){n.dataContext.getDataSetJString(i,r,function(n){u(n)})}function l(t,i,r,u){n.dataContext.executeQuery(i,r,function(n){u(n)})}function a(t,i,r,u){n.dataContext.executeQueries(i,r,function(n){u(n)})}function s(n,t){this.name=n;this.value=t;this.isDate=!1;this.isByteArray=!1}function e(){this.tables=[];this.total=0}function u(){this.count=0;this.totalPage=0;this.page=1;this.columns=[];this.rows=[];this.totalRecord=0;this.columnsName=[]}function o(n,t){this.cells=n.cells;this.id=n.id;this.parent=t}function i(){return this.rowIndex=-1,this.tables=[],this.curTable,this}function h(){}n.Events=function(){var n="click",t="touchstart",i="click",r;return"onmouseover"in document&&"ontouchstart"in document?(n="click",t="click"):"ontouchstart"in document?(n="touchstart",t="touchstart"):(n="click",t="click"),i="ontouchend"in document?"touchend":"click",r="click",{onTouchStartOrClick:n,onTouchEndOrClick:i,onClick:r,onTouchStartAndClick:t}}();n.Actions={zoom:"zoom",refresh:"refresh",preference:"preference",add:"add",update:"update",remove:"delete",contact:"contact"};n.EnvConstants={WINDOW_FIND:1110,WINDOW_MLOOKUP:1111,WINDOW_CUSTOMIZE:1112,WINDOW_INFO:1113,TAB_INFO:1113,WINDOW_ACCOUNT:1114,WINDOW_TEMP:111e5,INT32MAXVALUE:2147483647};n.Format=c;n.Utility={divCoding:t("<div>"),inheritPrototype:function(n,t){var i=Object.create(t.prototype);i.constructor=n;n.prototype=i;n.prototype.$super=t.prototype},getBusyPanel:function(){return t("<div>").html(t("<strong>").html("Loading...."))},getFunctionByName:function(n,t){for(var f=[].slice.call(arguments).splice(2),r=n.split("."),u=r.pop(),i=0;i<r.length;i++)t=t[r[i]];return t[u]},utf8_to_b64:function(n){return window.btoa(unescape(encodeURIComponent(n)))},b64_to_utf8:function(n){return decodeURIComponent(escape(window.atob(n)))},decodeText:function(n){return this.divCoding.html(n).text()},encodeText:function(n){return this.divCoding.text(n).html()}};n.Utility.encode=n.Utility.utf8_to_b64;n.Utility.decode=n.Utility.b64_to_utf8;n.Utility.Util={getValueOfInt:function(n){return n==null||n.toString().trim()==""?0:isNaN(n)?0:parseInt(n.toString())},getValueOfDecimal:function(n){return n==null||n.toString().trim()==""?0:isNaN(n)?0:parseFloat(n.toString())},getValueOfDouble:function(n){return n==null||n.toString().trim()==""?0:isNaN(n)?0:parseFloat(n.toString())},getValueOfString:function(n){return n==null||n.toString().trim()==""?"":n==null?"":n.toString()},getValueOfDate:function(n){return n==null||n.toString().trim()==""?0:n?new Date(n):null},getValueOfFormattedDateTime:function(n){if(n==null||n.toString().trim()=="")return 0;if(n){var t=new Date(n),i,r,u,f,e,o;return i=t.getFullYear(),r=t.getMonth().toString().length===1?"0"+(t.getMonth()+1).toString():t.getMonth()+1,u=t.getDate().toString().length===1?"0"+t.getDate().toString():t.getDate(),f=t.getHours().toString().length===1?"0"+t.getHours().toString():t.getHours(),e=t.getMinutes().toString().length===1?"0"+t.getMinutes().toString():t.getMinutes(),o=t.getSeconds().toString().length===1?"0"+t.getSeconds().toString():t.getSeconds(),i+"-"+r+"-"+u+"T"+f+":"+e+":"+o}return null},getValueOfBoolean:function(n){return n==null||n.toString().trim()==""?null:n.toString().toLowerCase()=="true"||n.toString()=="Y"?!0:!1},contains:function(n,t){return n.indexOf(t)>-1},isEmpty:function(n){return n==null||n.length===0?!0:!1},cleanMnemonic:function(n){if(n==null||n.length==0)return n;var t=n.indexOf("&");return t==-1?n:(t+1<n.length&&n.charAt(t+1)!=" "&&(n=n.substring(0,t)+n.substring(t+1)),n)},scale:function(n){var t,i;return isNaN(n)?0:(t=1.1,t=t.toLocaleString().substring(1,2),i=n.toString().split(t),i.length>2||i.length==1)?0:i[1].length}};n.Env=function(){function o(){return i++}function s(){return n.context}function h(n,t,i,r,u){var c,h,o,l;if(i==null||i.Length==0)return"";for(var f="",s=new String(""),e=i.indexOf("@");e!=-1&&e!=i.lastIndexOf("@");){if(c=i.substring(0,e),s+=i.substring(0,e),i=i.substring(e+1,i.length),h=i.indexOf("@"),h<0)return"";if(o="",l="",f=i.substring(0,h),o=f.contains(".")?n.getWindowContext(t,f.substring(0,f.indexOf(".")),r):n.getWindowContext(t,f,r),o.length==0&&(f.startsWith("#")||f.startsWith("$"))&&(o=n.getContext(f)),o.length==0){if(!u)return"";s+=" NULL "}else s+=o;i=i.substring(h+1,i.length);e=i.indexOf("@")}return s+i}function c(){return r}function l(n){n&&n.toString().length!=0||(n=50);r=n}function a(){return u}function v(n){u=n}function y(n,t,i,r){if(n==null||i==null)throw new IllegalArgumentException("Require Context");var u=null;return r?(u=n.getContext("#"+i),u.length==0&&(u=n.getContext("$"+i))):(u=n.getContext("P"+t+"|"+i),u.length==0&&(u=n.getContext("P|"+i))),u==null?"":u}function p(n,t){var i="";return t>0&&(i+=n.getWindowContext(t,"WindowName",!1)+"  "),i}function w(n){var t,u,r;if(n==null)throw new Error("Require Context");t=[];for(u in n)u.startsWith(i+"|")&&t.push(u);while(t.length>0)r=t.pop(),n[r]=null,delete n[r],r=null}function b(n,t){if(isNaN(n)||n===null)return"0";var i=n.toString();return i.contains(t)&&(i=i.split(t).join("")),i}function f(n,t){var i=[],r,u;return i=n.split("."),r=Globalize.format(Number(i[0]),"N",Globalize.cultureSelector),u=i[1]===""?".0":i[1],r.substring(0,r.length-3)+t+u}function k(t,i,r){return i=n.Env.removeCultCommaDot(i,t.thousendSeprator),i=i.split(t.decimalSeprator).join("."),i=t.format.GetFormatedValue(i),r===n.DisplayType.Amount?i=Globalize.format(Number(i),"N",Globalize.cultureSelector):r===n.DisplayType.Number&&(i=f(i.toString(),t.decimalSeprator)),i}function d(){return Date.now}function g(n){var i="";return i=typeof n!="string"?e(n):n,t()==i}function e(n){if(n!=null){var i=n.getContext("#AD_Language");if(i!=null&&i.length>0)return i}return t()}function t(){return"en_US"}function nt(n){return n==null||n.toString().trim()==""?0:isNaN(n)?0:n>0?1:n<0?-1:0}function tt(n){window.open(n)}var i=1,r=50,u=400;return{getWindowNo:o,getCtx:s,parseContext:h,getWINDOW_PAGE_SIZE:c,setWINDOW_PAGE_SIZE:l,setScreenHeight:v,getScreenHeight:a,getPreference:y,getHeader:p,clearWinContext:w,removeCultCommaDot:b,numberCultureValueFormat:f,numberDisplay:k,isBaseLanguage:g,getAD_Language:e,getBaseAD_Language:t,currentTimeMillis:d,signum:nt,startBrowser:tt,ZERO:0,ONE:1,ONEHUNDRED:100,NL:"\r\n",SHOW_CLIENT_ORG:0,SHOW_CLIENT_ONLY:1,SHOW_ORG_ONLY:2,HIDE_CLIENT_ORG:3,NULLString:"NULLValue"}}();n.AEnv=function(){function s(n,i,r){var u=null;return t.ajax({url:e,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function h(t,i,r){n.dataContext.getWindowJString({windowNo:t,AD_Window_ID:i},r)}function c(i){return t('<button class="vis-controls-txtbtn-table-td2" '+(i?"disabled":"")+' ><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/Zoom20.png" /><\/button>')}function l(i){var r=t("<ul class='vis-apanel-rb-ul'>");return typeof i[n.Actions.zoom]!="undefined"&&r.append(t("<li data-action='"+n.Actions.zoom+"' style='opacity:"+(i[n.Actions.zoom]?.7:1)+"'><img data-action='"+n.Actions.zoom+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/Zoom16.png'><span data-action='"+n.Actions.zoom+"'>"+n.Msg.getMsg("Zoom")+"<\/span><\/li>")),i[n.Actions.preference]&&r.append(t("<li data-action='"+n.Actions.preference+"'><img data-action='"+n.Actions.preference+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/Preference16.png'><span data-action='"+n.Actions.preference+"'>"+n.Msg.getMsg("Preference")+"<\/span><\/li>")),i[n.Actions.refresh]&&r.append(t("<li data-action='"+n.Actions.refresh+"'><img data-action='"+n.Actions.refresh+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/Refresh16.png'><span data-action='"+n.Actions.refresh+"'>"+n.Msg.getMsg("Requery")+"<\/span><\/li>")),i[n.Actions.add]&&r.append(t("<li data-action='"+n.Actions.add+"'><img data-action='"+n.Actions.add+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/AddBP16.png'><span data-action='"+n.Actions.add+"'>"+n.Msg.getMsg("Add")+"<\/span><\/li>")),i[n.Actions.update]&&r.append(t("<li data-action='"+n.Actions.update+"'><img data-action='"+n.Actions.update+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/UpdateBP16.png'><span data-action='"+n.Actions.update+"'>"+n.Msg.getMsg("Update")+"<\/span><\/li>")),i[n.Actions.remove]&&r.append(t("<li data-action='"+n.Actions.remove+"'><img data-action='"+n.Actions.remove+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/Clear16.png'><span data-action='"+n.Actions.remove+"'>"+n.Msg.getMsg("Clear")+"<\/span><\/li>")),i[n.Actions.contact]&&r.append(t("<li data-action='"+n.Actions.contact+"'><img data-action='"+n.Actions.contact+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/Contact16.png'><span data-action='"+n.Actions.contact+"'>"+n.Msg.getMsg("Contact")+"<\/span><\/li>")),r}function a(){if(i==null){i=!1;var u=645;n.MRole.getIsTableAccess(u,!0)?i=!0:(u=644,n.MRole.getIsTableAccess(u,!0)&&(i=!0));i&&t.ajax({type:"Get",async:!0,url:n.Application.contextUrl+"Form/GetWorkflowWindowID",data:{AD_Table_ID:u},success:function(n){var t=JSON.parse(n);t&&!isNaN(t)&&(r=parseInt(t));r==0&&(r=297)}})}return i}function v(t,i){var u=null;t!=0&&i!=0&&(u=new n.Query("AD_WF_Process"),u.addRestriction("AD_Table_ID",n.Query.prototype.EQUAL,t),u.addRestriction("Record_ID",n.Query.prototype.EQUAL,i),n.viewManager.startWindow(r,u))}function f(i,r){var f=null,e=0,o=0,u=null,s;(t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GetZoomWindowID",data:{AD_Table_ID:i},success:function(t){u=(new n.DB.DataReader).toJson(t)}}),u.read()&&(f=u.get(0).toString(),e=n.Utility.Util.getValueOfInt(u.getInt(1)),o=n.Utility.Util.getValueOfInt(u.getInt(2))),u.dispose(),f!=null&&e!=0)&&(o==0||(s=f+"_ID="+r,e=n.ZoomTarget.getZoomAD_Window_ID(f,0,s,!0),e!=0))&&n.viewManager.startWindow(e,n.Query.prototype.getEqualQuery(f+"_ID",r))}function y(t,i,r){var e=null,h=0,l=0,s=0,c=[],u,v,a;if(c[0]=new n.DB.SqlParam("@AD_Table_ID",t),c[1]=new n.DB.SqlParam("@AD_WF_Activity_ID",r),u=null,u=o("VIS_146",c),u.read())e=u.get(0).toString(),h=n.Utility.Util.getValueOfInt(u.getInt(1)),l=n.Utility.Util.getValueOfInt(u.getInt(2)),s=n.Utility.Util.getValueOfInt(u.getInt(3));else{f(t,i);return}if(u.dispose(),e!=null||h!=0||s==null||s==0){if(s!=null&&s!=0){v=new n.Query;n.viewManager.startWindow(s,n.Query.prototype.getEqualQuery(e+"_ID",i));return}(l==0||(a=e+"_ID="+i,h=n.ZoomTarget.getZoomAD_Window_ID(e,0,a,!0),h!=0))&&n.viewManager.startWindow(h,n.Query.prototype.getEqualQuery(e+"_ID",i))}}var i=null,r=0,u=n.Application.contextUrl,e=u+"JsonData/JDataSetWithCode",p=u+"JsonData/ExecuteNonQuer",o=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,s(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u};return{getGridWindow:h,getContextPopup:l,getZoomButton:c,getIsWorkflowProcess:a,startWorkflowProcess:v,zoom:f,wfzoom:y}}();r.prototype.typeList=["","","number","","date","","time","","choice"];r.prototype.modifierList=["","","currency","","percent","","integer"];r.prototype.dateModifierList=["","","short","","medium","","long","","full"];r.prototype.allFormats={currency:"C",decimal:"D",general:"G",number:"N",percent:"P",shortdate:"d",longdate:"D",shorttime:"t",longtime:"T",fulltime:"T",fulldate:"D",mediumdate:"d",mediumtime:"t",choice:""};r.prototype.applyPattern=function(n){var r,t,u,i;if(!this.cmpreFormat(n)){this.pattern=n;return}for(r=[],t=new StringBuilder(""),u=0;u<n.length;++u)i=n[u],i=="{"?t.length()==0?t.append(i):(r.push(t.toString()),t.clear(),t.append(i)):i=="}"?(t.append(i),r.push(t.toString()),t.clear()):u==n.length?(r.add(t.toString()),t.clear()):t.append(i);this.pattern=this.parsePattren(r)};r.prototype.parsePattren=function(n){for(var r=new StringBuilder(" "),t,i=0;i<n.length;i++){if(t=n[i],t.startsWith("{")&&this.cmpreFormat(t)){t=this.getFormat(t.split(","));r.append(t);continue}r.append(t)}return r.toString()};r.prototype.getFormat=function(n){var i=new StringBuilder(n[0]),t="";switch(this.findKeyword(n[1],this.typeList)){case 0:break;case 1:case 2:switch(this.findKeyword(n[2].toString(),this.modifierList)){case 0:t=this.allFormats.number;break;case 1:case 2:t=this.allFormats.currency;break;case 3:case 4:t=this.allFormats.percent;break;case 5:case 6:t=this.allFormats.decimal;break;default:t=this.allFormats.number}break;case 3:case 4:switch(this.findKeyword(n[2],this.dateModifierList)){case 0:t=this.allFormats.shortdate;break;case 1:case 2:t=this.allFormats.shortdate;break;case 3:case 4:t=this.allFormats.mediumdate;break;case 5:case 6:t=this.allFormats.longdate;break;case 7:case 8:t=this.allFormats.fulldate;break;default:t=n[3].ToString()}break;case 5:case 6:switch(this.FindKeyword(n[2].ToString(),this.dateModifierList)){case 0:t=this.allFormats.shorttime;break;case 1:case 2:t=this.allFormats.shorttime;break;case 3:case 4:t=this.allFormats.mediumtime;break;case 5:case 6:t=this.allFormats.mediumtime;break;case 7:case 8:t=this.allFormats.mediumtime;break;default:t=n[2].ToString()}break;case 7:case 8:try{t=n[3];this.allFormats.choice=n[3].ToString()}catch(r){throw new ArgumentException("Choice Pattern incorrect");}break;default:throw new ArgumentException("unknown format type at ");}return n=null,t="",i.append(t).append("}"),i.toString()};r.prototype.format=function(n){var i=this.pattern,t,r;for(this.pattern=null,t=0;t<n.length;t++)r=new RegExp("\\{"+t+"\\}","gm"),i=i.replace(r,n[t]);return i};r.prototype.cmpreFormat=function(n){return n.contains("number,")||n.contains("date,")||n.contains("time,")||n.contains("custom,")?!0:!1};r.prototype.findKeyword=function(n,t){for(var i=0;i<t.length;i++)if(n.equals(t[i]))return i;return-1};n.DB={QUOTE:"'",getDBDateFormat:function(n,t,i){var r="",u;return i||n.setMinutes(-n.getTimezoneOffset()),r=n.toISOString(),u=r.split("T"),r=u[0],t&&(r+=" "+u[1].substring(0,u[1].length-5)),r},to_date:function(n,t){time=n&&n.toString().length>0?n instanceof Date?n:new Date(n):null;time.toString()=="Invaild Date"&&(time=null);var i="",r="";if(1){if(time==null)return t?"TRUNC(SysDate)":"SysDate";i+="TO_DATE('";r=time;t?(r=this.getDBDateFormat(time,!1,!1),i+=r,i+="','YYYY-MM-DD')"):(r=this.getDBDateFormat(time,!0,!0),i+=r,i+="','YYYY-MM-DD HH24:MI:SS')")}else if(DatabaseType.IsPostgre){if(time==null)return t?"TRUNC(SysDate)":"SysDate";i=new StringBuilder("TO_DATE('");t?(r=time.Value.ToString("yyyy-MM-dd"),i.Append(r),i.Append("','YYYY-MM-DD')")):(r=time.Value.ToString("yyyy-MM-dd HH:mm:ss"),i.Append(r),i.Append("','YYYY-MM-DD HH24:MI:SS')"))}else if(DatabaseType.IsMSSql){if(time==null)return t?"CAST(STR(YEAR(Getdate()))+'-'+STR(Month(Getdate()))+'-'+STR(Day(Getdate())) AS DATETIME)":"getdate()";i=new StringBuilder("CAST('");r=time.ToString();t?(i.Append(r.Substring(0,10)),i.Append("' AS DATETIME)")):(i.Append(r.Substring(0,r.IndexOf("."))),i.Append("' AS DATETIME)"))}return i.toString()},to_char:function(t,i){var r="TRIM(TO_CHAR(";return r=r.concat(t),n.DisplayType.IsNumeric(i)?r=i==n.DisplayType.Amount?r.concat(",'9G999G999G999G990D00'"):r.concat(",'TM9'"):n.DisplayType.IsDate(i)&&(r=r.concat(",'").concat("yyyy-MM-dd").concat("'")),r=r.concat("))"),r.toString()},to_string:function(n,t){var i,r,u,f;if(n==null&&n.length==0)return"NULL";for(t!=null&&(t=0),i=n,t!=0&&i.length>t&&(i=n.substring(0,t)),r=new StringBuilder,r.append(this.QUOTE),u=0;u<i.length;u++)f=i.charAt(u),f==this.QUOTE?r.append("''"):r.append(f);return r.append(this.QUOTE),i=r.toString(),r.clear(),i},executeDataSet:function(t,i,r){var e=r?!0:!1,o={sql:t,page:1,pageSize:0},u;return i&&(o.param=i),u=null,f(arguments,o,e,function(t){u=(new n.DB.DataSet).toJson(t);e&&r(u)}),u},executeDataReader:function(t,i,r){var e=r?!0:!1,o={sql:t,page:1,pageSize:0},u;return i&&(o.param=i),u=null,f(arguments,o,e,function(t){u=(new n.DB.DataReader).toJson(t);e&&r(u)}),u},executeReader:function(t,i,r){var e=r?!0:!1,o={sql:t,page:1,pageSize:0},u;return i&&(o.param=i),u=null,f(arguments,o,e,function(t){u=(new n.DB.DataReader).toJson(t);e&&r(u)}),u},executeDataReaderPaging:function(t,i,r,u,e){var s=e?!0:!1,h={sql:t,page:i,pageSize:r},o;return u&&(h.param=u),o=null,f(arguments,h,s,function(t){o=(new n.DB.DataReader).toJson(t);s&&e(o)}),o},executeDataSetPaging:function(t,i,r,u,e){var s=e?!0:!1,h={sql:t,page:i,pageSize:r},o;return u&&(h.param=u),o=null,f(arguments,h,s,function(t){o=(new n.DB.DataSet).toJson(t);s&&e(o)}),o},executeScalar:function(t,i,r){var e=r?!0:!1,o={sql:t,page:1,pageSize:0},u=null;return f(arguments,o,e,function(t){var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;e&&r(u)}),u},executeQuery:function(n,t,i){var u=i?!0:!1,r=null,f={sql:n};return t&&(f.param=t),l(arguments,f,u,function(n){r=JSON.parse(n);u&&i(r)}),r},executeQueries:function(n,t,i){var u=i?!0:!1,r=null,f={sql:n.join("/"),param:t};return a(arguments,f,u,function(n){r=JSON.parse(n);u&&i(r)}),r}};s.prototype.setIsDate=function(n){this.isDate=n};s.prototype.setIsByteArray=function(n){this.isByteArray=n};e.prototype.toJson=function(i){for(var r=JSON.parse(i),f,r=t.isArray(r)?r:[r],u=0;u<r.length;u++)f=new n.DB.DataTable,f.toJson(r[u]),this.tables.push(f);return r=null,this};e.prototype.getTable=function(n){return n>-1&&n<this.tables.length?this.tables[n]:null};e.prototype.getTables=function(){return this.tables};e.prototype.dispose=function(){for(var n=this.tables.length;n>0;n--)this.tables.pop().dispose();this.tables.length=0;this.tables=null};u.prototype.toJson=function(t){var i,r;if(t){if(this.totalRecord=t.records,this.totalPage=t.total,this.page=t.page,t.columns){for(i=0;i<t.columns.length;i++)this.columnsName[i]=t.columns[i].name;for(r=0;r<t.rows.length;r++)this.rows.push(new n.DB.DataRow(t.rows[r],this));this.columns=t.columns}this.count=this.rows.count}t=null};u.prototype.getRowCount=function(){return this.rows.length};u.prototype.getColumnCount=function(){return this.columns.length};u.prototype.getRow=function(n){return n>-1&&n<this.rows.length?this.rows[n]:null};u.prototype.getRows=function(){return this.rows};u.prototype.getColumnsName=function(){return this.columnsName};u.prototype.dispose=function(){for(this.count=0,this.totalPage=0,this.page=1,this.columns.length=0,this.columns=null;this.rows.length>0;)this.rows.pop().dispose();this.rows.length=0;this.rows=null;this.totalRecord=0};o.prototype.getCell=function(n){var t=-1,i="";isNaN(n)?(n=n.toLowerCase(),t=this.parent.columnsName.indexOf(n),i=n):(t=n,i=this.parent.columnsName[t]);var r=this.parent.columns[t],u=r.type,f=this.cells[i];return u=="system.datetime",f};o.prototype.getJSCells=function(){return this.cells};o.prototype.dispose=function(){this.cells.length=0;this.cells=null;this.id=null;this.parent=null};i.prototype.toJson=function(i){for(var r=JSON.parse(i),f,r=t.isArray(r)?r:[r],u=0;u<r.length;u++)f=new n.DB.DataTable,f.toJson(r[u]),this.tables.push(f),u===0&&(this.curTable=this.tables[u]);return r=null,this};i.prototype.read=function(){return this.curTable?++this.rowIndex>=this.curTable.getRowCount()?!1:!0:!1};i.prototype.getCell=function(n){return this.curTable.getRow(this.rowIndex).getCell(n)};i.prototype.get=function(n){return this.curTable.getRow(this.rowIndex).getCell(n)};i.prototype.getString=function(n){var t=this.curTable.getRow(this.rowIndex).getCell(n);return t==null?"":t.toString()};i.prototype.getInt=function(n){var t=this.curTable.getRow(this.rowIndex).getCell(n);return t==null?0:parseInt(t)};i.prototype.getDecimal=function(n){var t=this.curTable.getRow(this.rowIndex).getCell(n);return t==null?0:parseFloat(t)};i.prototype.getDateTime=function(n){return this.curTable.getRow(this.rowIndex).getCell(n)};i.prototype.setTableIndex=function(n){this.rowIndex=0;this.curTable=this.tables[n]};i.prototype.close=function(){};i.prototype.dispose=function(){this.curTable=null;for(var n=this.tables.length;n>0;n--)this.tables.pop().dispose();this.tables.length=0;this.tables=null;this.rowIndex=null};h.prototype.max=function(n,t){return n==null?t:t==null?n:n>t?n:t};n.DB.DataSet=e;n.DB.DataTable=u;n.DB.DataRow=o;n.DB.SqlParam=s;n.DB.DataReader=i;n.MessageFormat=r;n.TimeUtil=h}(VIS,jQuery);VIS.Logging=VIS.Logging||{},function(n){function t(n,t){this.name=n;this.value=t}function e(n,t){this._level=n;this._sequenceNumber;this._sourceClassName;this._sourceMethodName;this._message=t;this._lineNumber;this._loggerName}function o(){if(o.prototype.singleInstance)return o.prototype.singleInstance;o.prototype.singleInstance=this}function u(){if(u.prototype.singletonInstance)return u.prototype.singletonInstance;u.prototype.singletonInstance=this}function s(){this.offValue=t.OFF.getIntValue();this.logLevel=t.ALL;this.formatter;this.filter}function f(){if(f.prototype.singleInstance)return f.prototype.singleInstance;this.setFormatter(u.get());this.setLevel(t.INFO);this.setFilter(o.get());this.ERROR_SIZE=20;this.m_errors=[];this.m_history=[];this.LOG_SIZE=100;this.m_logs=[];this.m_issueError=!0;f.prototype.singleInstance=this}function i(n){this.levelValue=t.INFO.getIntValue();this.name=n;this.levelObject;this.handlers=[];this.kids=[];this.manager=r.getLogManager();this.parent;this.offValue=t.OFF.getIntValue();this.filter}function c(){i.call(this,"");this.setLevel(t.INFO)}function r(){if(r.prototype.singleInstance)return r.prototype.singleInstance;this.emptyHandlers=[];this.loggers={};this.defaultLevel=t.INFO;this.rootLogger;r.prototype.singleInstance=this}function h(n){i.call(this,n)}function l(){var e=null,n=t.INFO,h=[t.OFF,t.SEVERE,t.WARNING,t.INFO,t.CONFIG,t.FINE,t.FINER,t.FINEST,t.ALL],c=function(n){if(n!=null){var t=i.getLogger("");t.addHandler(n);e.push(n)}},d=function(){return t.ALL.getIntValue()==n.getIntValue()},l=function(){var r,t,n;if(e==null){e=[];try{for(r=i.getLogger(""),t=r.getHandlers(),n=0;n<t.length;n++)e.contains(t[n])||e.Add(t[n])}catch(s){}f.get(!1)==null&&c(f.get(!0));v(u.get());y(o.get())}},s=function(t){var i,r;if(t!=null){for(e==null&&l(!0),i=0;i<e.length;i++)r=e[i],r.setLevel(t);t.getIntValue()!=n.getIntValue()&&a(t,null);n=t}},a=function(n,t){var f,e,o,u,s;if(n!=null){f=r.getLogManager();e=f.getLoggerNames();for(o in e)u=o,(t==null||u.indexOf(t)!=-1)&&(s=i.getLogger(u),s.setLevel(n))}},v=function(n){for(var i,t=0;t<e.length;t++)i=e[t],i.setFormatter(n)},y=function(n){for(var i,t=0;t<e.length;t++)i=e[t],i.setFilter(n)},p=function(){return n},w=function(n){if(n)for(var t=0;t<h.length;t++)if(h[t].getName().equals(n)){s(h[t]);return}},g=function(){return n.getIntValue()},b=function(){var n=r.getLogManager();n.reset()},k=function(i){if(i)s(n);else{var r=n;s(t.OFF);n=r}};return{initialize:l,addHandler:c,setLevel:s,setLevelByString:w,getLevel:p,shutdown:b,enable:k,getIsLevelAll:function(){return t.ALL.getIntValue()==n.getIntValue()},getIsLevelFinest:function(){return t.FINEST.getIntValue()>=n.getIntValue()},getIsLevelFiner:function(){return t.FINER.getIntValue()>=n.getIntValue()},getIsLevelFine:function(){return t.FINE.getIntValue()>=n.getIntValue()},getIsLevelInfo:function(){return t.INFO.IntValue()>=n.IntValue()}}}t.prototype.getIntValue=function(){return this.value};t.prototype.getName=function(){return this.name};t.prototype.getLevel=function(n){return t.OFF.getIntValue()==n?t.OFF:t.SEVERE.getIntValue()==n?t.SEVERE:t.WARNING.getIntValue()==n?t.WARNING:t.INFO.getIntValue()==n?t.INFO:t.CONFIG.getIntValue()==n?t.CONFIG:t.FINE.getIntValue()==n?t.FINE:t.FINER.getIntValue()==n?t.FINER:t.FINEST.getIntValue()==n?t.FINEST:t.ALL.getIntValue()==n?t.ALL:void 0};t.OFF=new t("OFF",9999);t.SEVERE=new t("SEVERE",1e3);t.WARNING=new t("WARNING",900);t.INFO=new t("INFO",800);t.CONFIG=new t("CONFIG",700);t.FINE=new t("FINE",600);t.FINER=new t("FINER",500);t.FINEST=new t("FINEST",400);t.ALL=new t("ALL",0);e.prototype.getMessage=function(){return this._message};e.prototype.setMessage=function(n){this._message=n};e.prototype.getSourceClassName=function(){return this._sourceClassName};e.prototype.setSourceClassName=function(n){this._sourceClassName=n};e.prototype.getSourceMethodName=function(){return this._sourceMethodName};e.prototype.setSourceMethodName=function(n){this._sourceMethodName=n};e.prototype.getLineNumber=function(){return this._lineNumber};e.prototype.setLineNumber=function(n){this._lineNumber=n};e.prototype.getLoggerName=function(){return this._loggerName};e.prototype.setLoggerName=function(n){this._loggerName=n};e.prototype.getLevel=function(){return this._level};o.prototype.singleInstance=null;o.get=function(){return o.prototype.singleInstance?o.prototype.singleInstance:new o};o.prototype.getIsLoggable=function(n){var i,r;return n.getLevel()===t.SEVERE||n.getLevel()===t.WARNING?!0:(i=n.getLoggerName(),i&&i.startsWith("System."))?!1:(r=n.sourceClassName,r&&r.startsWith("System."))?!1:!0};u.prototype.singletonInstance=null;u.prototype.NL="/n";u.get=function(){return u.prototype.singletonInstance?u.prototype.singletonInstance:new u};u.prototype.format=function(n){var i=new StringBuilder,r=Date.now.toString("yyyy-MM-dd hh:mm:ss.ms"),u;return r=r+"00",n.getLevel()==t.prototype.SEVERE?(i.append("===========> "),i.append("    (SEVERE)   ")):n.getLevel()==t.WARNING?(i.append("-----------> "),i.append("    (WARNING)  ")):(i.append(r.Substring(11,12)),u=11,n.getLevel()==t.INFO?i.append("    (INFO)     "):n.getLevel()==t.CONFIG?i.append("    (CONFIG)   "):n.getLevel()==t.FINE?i.append("    (FINE)     "):n.getLevel()==t.FINER?i.append("    (FINER)    "):n.getLevel()==t.FINEST&&i.append("    (FINEST)   ")),i.append(n.message),i.toString()};u.prototype.getHead=function(){var n=(new StringBuilder).append("*** ").append(DateTime.Now.ToString()).append(" VAdvantage Log ").append(" ***").append("\n").append("ViennaAdvantage");return n.toString()};u.prototype.getTail=function(){var n=(new StringBuilder).append("*** ").append(" VAdvantage Log").append(" ***");return n.toString()};u.prototype.getClassMethod=function(n){var i="",t=n.getLoggerName(),r,u;return((t==null||t.indexOf("default")!=-1||t.indexOf("global")!=-1)&&(t=n.getSourceClassName()),t!=null?(r=t.lastIndexOf("."),i+=r!=-1?t.substring(r+1):t):i+=n.getLoggerName(),n.getSourceMethodName()!=null&&(i+="."+n.getSourceMethodName()),u=i,u.equals("Trace.printStack"))?"":u};u.prototype.getParameters=function(n){var r="",i=n.getParameters(),t;if(i!=null&&i.length>0)for(t=0;t<i.length;t++)t>0&&(r+=", "),r+=i[t];return r};u.prototype.getExceptionTrace=function(){try{}catch(n){}return""};s.prototype.publish=function(){};s.prototype.close=function(){};s.prototype.flush=function(){};s.prototype.setLevel=function(n){if(n==null)throw new NullReferenceException("No Level");this.logLevel=n};s.prototype.getLevel=function(){return this.logLevel};s.prototype.getFilter=function(){return this.filter};s.prototype.setFilter=function(n){this.filter=n};s.prototype.getIsLoggable=function(n){var i=this.getLevel().getIntValue(),t;return n.getLevel().getIntValue()<i||i==this.offValue?!1:(t=this.getFilter(),t==null)?!0:t.getIsLoggable(n)};s.prototype.getFormatter=function(){return this.formatter};s.prototype.setFormatter=function(n){this.formatter=n};n.Utility.inheritPrototype(f,s);f.prototype.singleInstance=null;f.get=function(n){return f.prototype.singleInstance?f.prototype.singleInstance:n?new f:null};f.prototype.setLevel=function(n){n!=null&&(n==t.OFF?this.$super.setLevel.call(this,t.SEVERE):n==t.ALL||n==t.FINEST||n==t.FINER?this.$super.setLevel.call(this,t.FINE):this.$super.setLevel.call(this,n))};f.prototype.publish=function(n){var i,r,u,f,e;if(this.getIsLoggable(n)&&this.m_logs!=null){if(this.m_logs.length>=this.LOG_SIZE&&this.m_logs.shift(),this.m_logs.push(n),n.getLevel()==t.SEVERE){for(this.m_errors.length>=this.ERROR_SIZE&&(this.m_errors.shift(),this.m_history.shift()),this.m_errors.push(n),i=[],r=0;r<this.m_logs.length;r++)if(u=this.m_logs[r],u.getLevel()==t.SEVERE)if(i.length==0)i.push(u);else break;else if(i.push(u),i.length>10)break;this.m_history.push(i);this.m_issueError&&(f=n.getLoggerName(),e=n.getSourceMethodName())}console.log(n)}};f.prototype.close=function(){this.m_logs!=null&&(this.m_logs.length=0,this.m_logs=null);this.m_errors!=null&&(this.m_errors.length=0,this.m_errors=null);this.m_history!=null&&(this.m_history.length=0,this.m_history=null)};f.prototype.getColumnNames=function(){var n=[4];return n[0]="Time",n[1]="Level",n[2]="Class.Method",n[3]="Message",n};f.prototype.getRecords=function(n){return n?this.m_errors.slice():this.m_logs.slice()};f.prototype.getLogData=function(n){for(var f=this.getRecords(n),e=[],r,t,i=0,o=f.length;i<o;i++)r=f[i],t=[],t.push((new Date).toString()),t.push(r.getLevel().getName()),t.push(u.get().getClassMethod(r)),t.push(r.getMessage()),e.push(t);return e};f.prototype.resetBuffer=function(n){this.m_errors.length=0;this.m_history.length=0;n||(this.m_logs.length=0)};i.prototype.setFilter=function(n){this.filter=n};i.prototype.getFilter=function(){return this.filter};i.prototype.log=function(n,i,r){var i=i,f,u,o,s;if((r&&(r.message&&(i+=" => "+r.message),r.stack&&(i+=" ===> "+r.stack)),!(n.getIntValue()<this.levelValue)&&this.levelValue!=t.OFF.getIntValue())&&(f=new e(n,i),f.setLoggerName(this.name),this.filter==null||this.filter.getIsLoggable(f)))for(u=this;u!=null;){if(o=u.getHandlers(),o!=null)for(s=0;s<o.length;s++)o[s].publish(f);u=u.getParent()}};i.prototype.getParent=function(){return this.parent};i.prototype.getHandlers=function(){return this.handlers==null?emptyHandlers:this.handlers};i.prototype.getName=function(){return this.name};i.prototype.setLevel=function(n){this.levelObject=n;this.levelValue=n.getIntValue()};i.prototype.getLevel=function(){return this.levelObject};i.prototype.addHandler=function(n){this.handlers==null&&(handlers=[]);this.handlers.push(n)};i.prototype.removeHandler=function(n){n!=null&&this.handlers!=null&&this.handlers.remove(n)};i.getLogger=function(n){var u=r.getLogManager(),t=u.getLogger(n);return t==null&&(t=new i(n),u.addLogger(t),t=u.getLogger(n)),t};i.prototype.setParent=function(n){this.parent=n};i.prototype.getIsLoggable=function(n){return n.getIntValue()<levelValue||levelValue==offValue?!1:!0};i.prototype.fine=function(n){t.FINE.getIntValue()<this.levelValue||this.log(t.FINE,n)};i.prototype.info=function(n){t.INFO.getIntValue()<this.levelValue||this.log(t.INFO,n)};i.prototype.config=function(n){t.CONFIG.getIntValue()<this.levelValue||this.log(t.CONFIG,n)};i.prototype.finer=function(n){t.FINER.getIntValue()<this.levelValue||this.log(t.FINER,n)};i.prototype.finest=function(n){t.FINEST.getIntValue()<this.levelValue||this.log(t.FINEST,n)};i.prototype.severe=function(n){t.SEVERE.getIntValue()<this.levelValue||this.log(t.SEVERE,n)};i.prototype.warning=function(n){t.WARNING.getIntValue()<this.levelValue||this.log(t.WARNING,n)};i.prototype.saveError=function(n,t){return this.saveError(n,t.message,!0)};i.prototype.saveError=function(n,t,i){return i&&this.warning(n+" "+t.message),!0};i.prototype.getIsLevelFinest=function(){return l.getIsLevelFinest()};n.Utility.inheritPrototype(c,i);r.prototype.singleInstance=null;r.prototype.addLogger=function(n){var t=n.getName(),i=null;return(t in this.loggers&&(i=loggers[t]),i!=null)?!1:(this.loggers[t]=n,n instanceof c||n.setParent(this.rootLogger),!0)};r.prototype.reset=function(){for(var n in this.loggers)ResetLogger(n)};r.prototype.resetLogger=function(n){var t=this.getLogger(n),r,i,u;if(t!=null){for(r=t.getHandlers(),i=0;i<r.length;i++){u=r[i];t.removeHandler(u);try{u.close()}catch(f){}}n!=null&&n.equals("")?t.setLevel(this.defaultLevel):t.setLevel(null)}};r.prototype.getLogger=function(n){return n in this.loggers?this.loggers[n]:null};r.getLogManager=function(){if(!r.prototype.singleInstance){new r;var n=r.prototype.singleInstance;n.rootLogger=new c;n.addLogger(n.rootLogger)}return r.prototype.singleInstance};r.prototype.getLoggerNames=function(){return this.loggers};n.Utility.inheritPrototype(h,i);h.getVLogger=function(t){var f=r.getLogManager(),i,u;return(t||(t=""),i=f.getLogger(t),i!=null&&i instanceof h)?i:(u=new h(t),u.setLevel(n.Logging.VLogMgt.getLevel()),f.addLogger(u),u)};n.Logging.Level=t;n.Logging.LogRecord=e;n.Logging.VLogFilter=o;n.Logging.VLogFormatter=u;n.Logging.VLogErrorBuffer=f;n.Logging.Logger=i;n.Logging.VLogger=h;n.Logging.LogManager=r;n.Logging.VLogMgt=l()}(VIS,jQuery);VIS.Controls={},function(n,t){function ft(t,i,r){var u=null;return n.ajax({url:ot,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(t)}).done(function(n){u=n;r&&r(n)}),u}function i(n,r,u,f,e){if(this instanceof i)this.ctrl=n,this.displayType=r,this.isReadOnly=u,this.colName=f,this.isMandatory=e,this.oldValue="oldValue",this.visible,this.tag,this.setVisible(!0),this.editingGrid=null;else return new t.controls.IControl(n,r,u,f,e)}function p(r,u,f,e,o,s,h,c,l){var y=t.DisplayType.String,a=n("<input>",{type:l?"password":"text",name:r,maxlength:s}),v;i.call(this,a,y,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);v=this;a.on("change",function(n){var t,i;n.stopPropagation();t=a.val();this.value=t;t!==v.oldValue&&(i={newValue:t,propertyName:v.getName()},v.fireValueChanged(i),i=null)});this.disposeComponent=function(){a.off("change");a=null;v=null}}function et(r,u,f,e){var s,o;r=r!=null?r.replace("[&]",""):"";s=' for="'+u+'"';e&&(s="");o=n("<label "+s+">");i.call(this,o,t.DisplayType.Label,!0,e?u:"lbl"+u);f?o.text(r).append("<sup>*<\/sup>"):o.text(r);this.disposeComponent=function(){o=null;self=null}}function r(r,u,f,e,o,s,h,c,l,a,v,y,p){function d(n){nt.attr("src",tt+n)}function it(){var i=n("<ul class='vis-apanel-rb-ul'>");return i.append(n("<li data-action='C'>").text(t.Msg.getMsg("OpenCSV"))),i.append(n("<li data-action='P'>").text(t.Msg.getMsg("OpenPDF"))),i}var w,g;this.actionListner;this.AD_Process_ID=c;this.AD_Form_ID=v;this.description=s;this.help=h;this.text=o;this.isLink=l;this.isRightLink=a;this.actionLink=null;this.isCsv=!1;this.isPdf=!1;this.askUserBGProcess=p;this.isBackgroundProcess=y;this.values=null;var nt=n("<img style='min-width:15px'>"),b=n("<span>").text(o),tt=t.Application.contextUrl+"Areas/VIS/Images/base/",k=null;l?k=n("<li>"):(k=n('<button class="vis-gc-vpanel-table-btn-blue">',{type:"button",name:r}),nt.css("margin-right","8px"));r.equals("PaymentRule")?(this.readReference(195),b.css("color","blue"),d("Payment20.png")):r.equals("DocAction")?(this.readReference(135),b.css("color","blue"),d("Process20.png")):r.equals("CreateFrom")?d("Copy16.png"):r.equals("Record_ID")?(d("Zoom20.png"),b.text(t.Msg.getMsg("ZoomDocument"))):r.equals("Posted")&&(this.readReference(234),b.css("color","magenta"),d("InfoAccount20.png"));k.append(nt).append(b);i.call(this,k,t.DisplayType.Button,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);w=this;g=null;g=it();k.on(t.Events.onClick,function(n){var u,r,i,f;n.stopPropagation();u=null;w.isReadOnly||(r="VIS_81",i=[],i[0]=new t.DB.SqlParam("@AD_Process_ID",c),u=ut(r,i),r="VIS_149",i=[],i[0]=new t.DB.SqlParam("@AD_Process_ID",c),f=ut(r,i),f=="Y"&&t.context.getIsUseCrystalReportViewer()?w.invokeActionPerformed({source:w}):u=="Y"?nt.w2overlay(g.clone(!0)):w.invokeActionPerformed({source:w}))});if(g)g.on("click","LI",function(t){var i=n(t.target);i.data("action")=="P"?(w.isPdf=!0,w.isCsv=!1):i.data("action")=="C"&&(w.isCsv=!0,w.isPdf=!1);w.invokeActionPerformed({source:w})});this.setText=function(n){var t,i;if(n==null){b.text("");return}t=n.indexOf("&");t!=-1&&(i=n.toUpperCase().charAt(t+1),i!=" "&&(n=n.substring(0,t)+n.substring(t+1)));b.text(n)};this.disposeComponent=function(){k.off(t.Events.onClick);k=null;w=null;this.AD_Process_ID=null;this.description=null;this.help=null;this.setText=null}}function w(r,u,f,e,o){var s=n("<input>",{type:"checkbox",name:r,value:o}),c=n('<label class="vis-gc-vpanel-table-label-checkbox" />').html(o).prepend(s),h;i.call(this,c,t.DisplayType.YesNo,f,r,u);this.cBox=s;h=this;this.setReadOnly=function(n){this.isReadOnly=n;s.prop("disabled",n);c.css("opacity",n?.7:1)};f||!e?this.setReadOnly(!0):this.setReadOnly(!1);s.on("change",function(n){var t,i;n.stopPropagation();t=s.prop("checked");t!==h.oldValue&&(h.oldValue=t,i={newValue:t,propertyName:h.getName()},h.fireValueChanged(i),i=null)});this.disposeComponent=function(){s.off("change");s=null;h=null;this.cBox=null}}function c(r,u,e,o,s,h,c,l){function g(){var i,n,r,e,o,s,u,h;if(a.lookup&&!b){if(i=a.lookup.getZoomQuery(),n=a.getValue(),n==null,n==""&&(n=null),n==null||isNaN(n)||(n=parseInt(n)),i==null||n!=null){if(i=new t.Query,r=null,a.lookup!=null&&a.lookup instanceof t.MLookup&&(e=a.lookup.getAD_Reference_Value_ID(),e!=0)){o="VIS_83";s=[];s[0]=new t.DB.SqlParam("@AD_Reference_ID",e);try{u=f(o,s);u.read()&&(r=u.getString(0));u.dispose()}catch(c){this.log.log(t.Logging.Level.SEVERE,o,c)}}r!=null&&r.length!=0?i.addRestriction(r,t.Query.prototype.EQUAL,n):i.addRestriction(a.getColumnName(),t.Query.prototype.EQUAL,n);i.setRecordCount(1)}h=0;h=a.mField.getZoomWindow_ID()>0?a.mField.getZoomWindow_ID():a.lookup.getZoomWindow(i);(n==null||n==-1)&&(i=null);t.viewManager.startWindow(h,i)}}var v,a;c||(c=t.DisplayType.Table);v=n("<select>",{name:r});i.call(this,v,c,e,r,u);this.lookup=s;this.lastDisplay="";this.settingFocus=!1;this.inserting=!1;this.settingValue=!1;this.loading=!1;s!=null&&s.getIsValidated()&&(this.loading=!0);v[0].selectedIndex=-1;e||!o?this.setReadOnly(!0):this.setReadOnly(!1);var d=!1,y=null,k=0,p=null,w={},b=!1;s!=null&&((s.getDisplayType()==t.DisplayType.List&&t.context.getAD_Role_ID()==0||s.getDisplayType()!=t.DisplayType.List)&&(d=!0,s instanceof t.MLookup&&s.getZoomWindow()==0&&l<1&&(b=!0),w[t.Actions.zoom]=b),(this.lookup&&(this.lookup.info.keyColumn.toLowerCase()=="ad_user.ad_user_id"||this.lookup.info.keyColumn.toLowerCase()=="ad_user_id")||r==="AD_User_ID"||r==="SalesRep_ID")&&(w[t.Actions.contact]=!0),y=n('<button tabindex="-1" class="vis-controls-txtbtn-table-td2"><img tabindex="-1" src="'+t.Application.contextUrl+'Areas/VIS/Images/base/Info20.png" /><\/button>'),w[t.Actions.refresh]=!0,t.MRole.getIsShowPreference()&&(w[t.Actions.preference]=!0),p=t.AEnv.getContextPopup(w),k+=1,w=null);this.getBtnCount=function(){return k};this.getBtn=function(){return y};this.setVisible=function(n){this.visible=n;n?(y&&y.show(),v.show()):(v.hide(),y&&y.hide())};a=this;v.on("focus",function(){var n;if(a.lookup!=null){if(n=v.val(),a.lookup.getIsValidated()&&!a.lookup.getHasInactive()){if(a.loading){if(a.lookup.fillCombobox(u,!1,!1,!1),a.lookup.loading)return;a.refreshOptions(a.lookup.data,n);n!=null&&v[0].selectedIndex<0&&(a.oldValue="old",v.trigger("change"));a.loading=!1}return}a.getIsReadonly()||(a.settingFocus=!0,n=v.val(),a.lookup.fillCombobox(a.getIsMandatory(),!0,!0,!0),a.refreshOptions(a.lookup.data,n),n&&v[0].selectedIndex<0&&(a.oldValue="old",v.trigger("change")),a.settingFocus=!1)}});v.on("change",function(n){var t=v.val(),i;t!==a.oldValue&&((t==-1||t=="")&&(t=null),i={newValue:t,propertyName:a.getName()},a.fireValueChanged(i),i=null);n.stopPropagation()});if(y)y.on(t.Events.onClick,function(n){y.w2overlay(p.clone(!0));n.stopPropagation()});if(p)p.on("click","LI",function(i){var r=n(i.target).data("action"),u,e,f,o;if(r==t.Actions.preference)u=new t.ValuePreference(a.mField,a.getValue(),a.getDisplay()),u!=null&&u.showDialog(),u=null;else if(r==t.Actions.refresh){if(s==null)return;a.settingFocus=!0;e=v.val();a.lookup.refresh();a.lookup.getIsValidated()?a.lookup.fillCombobox(a.getIsMandatory(),!1,!1,!1):a.lookup.fillCombobox(a.getIsMandatory(),!0,!1,!1);a.refreshOptions(a.lookup.data,e);a.settingFocus=!1}else r==t.Actions.contact?(f=a.getValue(),f&&f.toString().length>0&&(o=new t.ContactInfo(f,a.mField.getWindowNo()),o.show())):r==t.Actions.zoom&&(b||g())});this.disposeComponent=function(){v.off("focus");v.off("change");y&&(y.off(t.Events.onClick),y.remove());y=null;p&&p.remove();p=null;this.lookup=null;this.lastDisplay=null;this.settingFocus=null;this.inserting=null;this.settingValue=null;v=null;a=null}}function b(r,u,f,e,o){var c="date",h,s;o==t.DisplayType.Time&&(c="time");o==t.DisplayType.DateTime&&(c="datetime-local");h=n("<input>",{type:c,name:r});i.call(this,h,o,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);s=this;h.on("focusout",function(){var n,t;this.editingGrid||(n=s.getValue(),s.oldValue=n,t={newValue:n,propertyName:s.getName()},s.fireValueChanged(t),t=null)});this.disposeComponent=function(){h.off("change");s=null;h=null}}function o(r,u,o,s,h,c,l){function ot(){var i,r,u,o,s,h,e,c;if(a.lookup&&!g){if(i=a.lookup.getZoomQuery(),r=a.getValue(),r==null,r==""&&(r=null),i==null||n.isEmptyObject(i)||r!=null){if(i=new t.Query,u=null,a.lookup!=null&&a.lookup instanceof t.MLookup&&(o=a.lookup.getAD_Reference_Value_ID(),o!=0)){s="VIS_90";h=[];h[0]=new t.DB.SqlParam("@AD_Reference_ID",o);try{e=f(s,h);e.read()&&(u=e.getString(0));e.dispose()}catch(l){this.log.log(t.Logging.Level.SEVERE,s,l)}}u!=null&&u.length!=0?i.addRestriction(u,t.Query.prototype.EQUAL,r):i.addRestriction(a.getColumnName(),t.Query.prototype.EQUAL,r);i.setRecordCount(1)}c=0;c=a.mField!=null&&a.mField.getZoomWindow_ID()>0?a.mField.getZoomWindow_ID():a.lookup.getZoomWindow(i);t.viewManager.startWindow(c,i)}}var it,rt,ft,et,a;h||(h=t.DisplayType.Search);this.lookup=c;this.isMultiKeyTextBox=h===t.DisplayType.MultiKey;this.value=null;this.custInfoWin=null;it=null;rt=null;this.infoMultipleIds=null;ft=null;this.log=t.Logging.VLogger.getVLogger("VTextBoxButton");var nt=1113,tt=1113,k=t.Application.contextUrl+"Areas/VIS/Images/base/";h==t.DisplayType.Location||h==t.DisplayType.MultiKey?k+=this.isMultiKeyTextBox?"PickOpen20.png":"Location10.png":h==t.DisplayType.Locator?k+="Locator10.png":h==t.DisplayType.Search&&(k+=r.equals("C_BPartner_ID")||r.equals("C_BPartner_To_ID")&&c.getColumnName().equals("C_BPartner.C_BPartner_ID")?"BPartner20.png":r.equals("M_Product_ID")||r.equals("M_Product_To_ID")&&c.getColumnName().equals("M_Product.M_Product_ID")?"Product20.png":"PickOpen20.png");var d=0,y=n("<input >",{type:"text",name:r}),w=n('<button  tabindex="-1" class="vis-controls-txtbtn-table-td2"><img  tabindex="-1" src="'+k+'" /><\/button>');d+=1;var v=null,b=null,p={},g=!1;c==null||this.isMultiKeyTextBox||(c instanceof t.MLookup&&c.getZoomWindow()==0&&l<1&&(g=!0),p[t.Actions.zoom]=g,v=n('<button  tabindex="-1" class="vis-controls-txtbtn-table-td2"><img tabindex="-1" src="'+t.Application.contextUrl+'Areas/VIS/Images/base/Info20.png" /><\/button>'),et=!1,r==="C_BPartner_ID"&&(p[t.Actions.add]=!0,p[t.Actions.update]=!0),(this.lookup&&(this.lookup.info.keyColumn.toLowerCase()=="ad_user.ad_user_id"||this.lookup.info.keyColumn.toLowerCase()=="ad_user_id")||r==="AD_User_ID"||r==="SalesRep_ID")&&(p[t.Actions.contact]=!0),t.MRole.getIsShowPreference()&&(p[t.Actions.preference]=!0),p[t.Actions.refresh]=!0,p[t.Actions.remove]=!0,b=t.AEnv.getContextPopup(p),d+=1,p=null);this.isMultiKeyTextBox&&(v=n('<button  tabindex="-1" class="vis-controls-txtbtn-table-td2"><img  tabindex="-1" src="'+t.Application.contextUrl+'Areas/VIS/Images/clear16.png" /><\/button>'),d+=1);a=this;i.call(this,y,h,o,r,u);this.setReadOnly=function(n){this.isReadOnly=n;y.prop("disabled",n?!0:!1);n?w.css("opacity",.7):w.css("opacity",1);this.isMultiKeyTextBox&&(n?v.css("opacity",.7):v.css("opacity",1))};y.on("keydown",function(n){n.keyCode!=13&&n.keyCode!=9||n.shiftKey||a.actionText()&&(n.stopPropagation(),n.preventDefault())});this.actionText=function(){var r=y.val().trim(),u,i;if(t.context.setContext(a.lookup.windowNo,"AttrCode",r),r!=null&&r.indexOf("(01)")>=0&&(u=r,u.indexOf("(10)")>=0&&(u=u.substring(0,u.indexOf("(10)"))),u.indexOf("(17)")>=0&&(u=u.substring(0,u.indexOf("(17)"))),u=u.replace("(01)",""),r=u),r==null||r.length==0||r.equals("%"))return a.openSearchForm(),!0;r=r.toUpper();var f=-3,o=null,i=null,s=t.Msg.parseTranslation(t.context,a.getDirectAccessSQL(r));try{if(i=null,n.ajax({type:"Post",async:!1,url:t.Application.contextUrl+"Form/GetTextButtonQueryResult",data:{sql:t.secureEngine.encrypt(s)},success:function(n){i=(new t.DB.DataReader).toJson(n)}}),i.read()){try{o=parseInt(i.get(0))}catch(h){o=i.get(0)}f=1;i.read()&&(f=-1,o=null)}i.close();i=null}catch(c){i!=null&&i.close();i=null;this.log.log(t.Logging.Level.SEVERE,e);f=-2}if(f==-3&&!r.endsWith("%")){r+="%";s=t.Msg.parseTranslation(t.context,a.getDirectAccessSQL(r));try{if(i=null,n.ajax({type:"Get",async:!1,url:t.Application.contextUrl+"Form/GetTextButtonQueryResult",data:{sql:t.secureEngine.encrypt(s)},success:function(n){i=(new t.DB.DataReader).toJson(n)}}),i.read()){try{o=parseInt(i.get(0))}catch(l){o=i.get(0)}f=1;i.read()&&(o=null,f=-1)}i.close()}catch(v){i!=null&&i.close();i=null;this.log.log(t.Logging.Level.SEVERE,e);f=-2}}return f<0&&o==null?(ft={},a.openSearchForm(),!0):(r="",a.setValue(o,!0,!0),!1)};this.getDirectAccessSQL=function(n){var i=a.getDirectAccessSQL1(t.context,r,c,n);return it=i[1],rt=i[2],i[0]};this.getDirectAccessSQL1=function(i,r,u,e){var h="",s=[],c=r.substring(0,r.length-3),v=r,p,o,k,g,it,rt,b,l,w,y;if(r.equals("M_Product_ID")?(i.setContext(nt,tt,"M_Product_ID","0"),i.setContext(nt,tt,"M_AttributeSetInstance_ID","0"),i.setContext(nt,tt,"M_Locator_ID","0")):r.equals("SalesRep_ID")&&(c="AD_User",v="AD_User_ID"),n.ajax({url:t.Application.contextUrl+"Form/GetAccessSql",dataType:"json",async:!1,data:{columnName:r,text:e},success:function(n){h=n}}),h.length>0)return p=a.getWhereClause(i,r,u),r.equals("M_Product_ID")?p!=null&&p.length>0&&(h+=" AND "+p.replace(/M_Product\./g,"p.")+" AND p.IsActive='Y'"):p!=null&&p.length>0&&(h+=" AND "+p+" AND IsActive='Y'"),s.push(t.MRole.getDefault().addAccessSQL(h,c,t.MRole.SQL_FULLYQUALIFIED,t.MRole.SQL_RO)),s.push(c),s.push(v),s;if(o=null,u!=null&&u instanceof t.MLookup&&(k=u.getAD_Reference_Value_ID(),k!=0)){g="VIS_84";try{for(l=[],l[0]=new t.DB.SqlParam("@refid",k),o=f(g,l);o.read();){r=o.get(0);v=o.get(0);c=o.get(1);break}o.close();o=null}catch(d){o!=null&&(o.close(),o=null);this.log.log(t.Logging.Level.SEVERE,b,d)}it="VIS_85";rt=null;v=r;h="(";try{for(l=[],l[0]=new t.DB.SqlParam("@refid",k),l[1]=new t.DB.SqlParam("@colname",r),o=f(it,l);o.read();)h.length>1&&(h+=" OR "),c=o.get(0),h+="UPPER("+o.get(1)+") LIKE "+t.DB.to_string(e);h+=")";o.close();o=null}catch(d){o!=null&&(o.close(),o=null);this.log.log(t.Logging.Level.SEVERE,b,d)}return h.length==0?(this.log.log(t.Logging.Level.SEVERE,r+" (TableDir) - no standard/identifier columns"),s.push(""),s.push(c),s.push(v),s):(w="SELECT "+r+" FROM "+c+" WHERE "+h+" AND IsActive='Y'",y=a.getWhereClause(i,r,u),y!=null&&y.length>0&&(w+=" AND "+y),s.push(t.MRole.getDefault().addAccessSQL(w,c,t.MRole.SQL_NOTQUALIFIED,t.MRole.SQL_RO)),s.push(c),s.push(v),s)}b="VIS_86";v=r;h="(";try{for(l=[],l[0]=new t.DB.SqlParam("@colname",v),o=f(b,l);o.read();)h.length>1&&(h+=" OR "),c=o.get(0),h+="UPPER("+o.get(1)+") LIKE "+t.DB.to_string(e);h+=")";o.close();o=null}catch(d){o!=null&&(o.close(),o=null);this.log.log(t.Logging.Level.SEVERE,b,d)}return h.length==0?(this.log.log(t.Logging.Level.SEVERE,r+" (TableDir) - no standard/identifier columns"),s.push(""),s.push(c),s.push(v),s):(w="SELECT "+r+" FROM "+c+" WHERE "+h+" AND IsActive='Y'",y=a.getWhereClause(i,r,u),y!=null&&y.length>0&&(w+=" AND "+y),s.push(t.MRole.getDefault().addAccessSQL(w,c,t.MRole.SQL_NOTQUALIFIED,t.MRole.SQL_RO)),s.push(c),s.push(v),s)};this.getWhereClause=function(n,i,r){var u="",f,e;try{if(r==null)return"";if(r.getZoomQuery()!=null&&(u=r.getZoomQuery().getWhereClause()),f=r.getValidation(),f==null&&(f=""),u.length==0?u=f:f.length>0&&(u+=" AND "+f),u.indexOf("@")!=-1&&(e=t.Env.parseContext(n,r.getWindowNo(),u,!1,!0),e.length!=0))return e}catch(o){}return u};o||!s?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtnCount=function(){return d};this.getBtn=function(n){return n==0?w:n==1&&v?v:void 0};this.setVisible=function(n){this.visible=n;n?(y.css("visibility","visible"),v&&v.show(),w.show()):(y.css("visibility","hidden"),v&&v.hide(),w.hide())};this.openSearchForm=function(){var s,o,l,u,g,w,e;if(!a.isReadOnly&&(s=y.val().trim(),typeof s=="object"&&(s=""),!a.isReadOnly)&&a.lookup!=null){if(o=0,l=a.getWhereClause(t.Env.getCtx(),r,a.lookup),a.custInfoWin!=null?n.ajax({url:t.Application.contextUrl+"InfoWindow/GetInfoWindowID",dataType:"json",async:!1,data:{InfoSearchKey:a.custInfoWin},success:function(n){o=n.result}}):a.getField()!=null&o==0&&(o=a.getField().getAD_InfoWindow_ID()),u=null,o!=0)u=new t.InfoWindow(o,s,a.lookup.windowNo,l,a.isMultiKeyTextBox);else{var h=h,v=r,c=null,i=null,b=0,k=0,p=0,d=a.lookup.getAD_Reference_Value_ID();if(d>0){c="VIS_87";g=null;try{for(e=[],e[0]=new t.DB.SqlParam("@AD_Reference_ID",d),i=f(c,e);i.read();)v=i.getString(0),g=i.getString(1),h=i.getString(2);i.close();i=null}catch(nt){i!=null&&(i.close(),i=null)}}else h=String(r).substr(0,r.length-3),v=r;if(c="VIS_88",e=[],e[0]=new t.DB.SqlParam("@AD_Tab_ID",t.context.getContext(a.lookup.windowNo,"0|AD_Tab_ID",!0)),p=ut(c,e),v.equals("M_Product_ID")&&p)b=window.DTD001&&p==170?t.context.getContextAsInt(a.lookup.windowNo,"DTD001_MWarehouseSource_ID"):t.context.getContextAsInt(a.lookup.windowNo,"M_Warehouse_ID"),k=t.context.getContextAsInt(a.lookup.windowNo,"M_PriceList_ID"),w=!1,a.lookup.windowNo>0&&(w=t.context.getWindowTabContext(a.lookup.windowNo,1,"KeyColumnName")=="C_OrderLine_ID"||t.context.getWindowTabContext(a.lookup.windowNo,1,"KeyColumnName")=="C_InvoiceLine_ID"||t.context.getWindowTabContext(a.lookup.windowNo,1,"KeyColumnName")=="M_InOutLine_ID"||t.context.getWindowTabContext(a.lookup.windowNo,1,"KeyColumnName")=="M_PackageLine_ID"||t.context.getWindowTabContext(a.lookup.windowNo,1,"KeyColumnName")=="M_MovementLine_ID"||t.context.getWindowTabContext(a.lookup.windowNo,1,"KeyColumnName")=="M_InventoryLine_ID"||t.context.getWindowTabContext(a.lookup.windowNo,1,"KeyColumnName")=="M_ProductPrice_ID"||t.context.getWindowTabContext(a.lookup.windowNo,1,"KeyColumnName")=="C_ProjectLine_ID"||t.context.getWindowTabContext(a.lookup.windowNo,1,"KeyColumnName")=="M_RequisitionLine_ID"||t.context.getWindowTabContext(a.lookup.windowNo,0,"KeyColumnName")=="M_PriceList_ID"||t.context.getWindowTabContext(a.lookup.windowNo,1,"KeyColumnName")=="SAP001_StockTransferLine_ID"),u=new t.infoProduct(!0,a.lookup.windowNo,b,k,s,h,v,w,l);else{for(c="VIS_89",e=[],e[0]=new t.DB.SqlParam("@tableName",h),i=f(c,e);i.read();){o=i.getString(0);break}i.close();i=null;u=o>0?new t.InfoWindow(o,s,a.lookup.windowNo,l,a.isMultiKeyTextBox):new t.infoGeneral(!0,a.lookup.windowNo,s,h,v,a.isMultiKeyTextBox,l)}}u.onClose=function(){var n=u.getSelectedValues(),t,r;if(n&&n.length==0){y.closest("td").hasClass("vis-gc-vpanel-table-td3")?window.setTimeout(function(){y.closest("tr").nextAll().children("input,select,textarea,button").focus()},200):y.closest("td").hasClass("vis-gc-vpanel-table-td1")?(t=y.closest("td").siblings(".vis-gc-vpanel-table-td3"),t&&t.length>0&&(t=t.find("input,select,textarea,button"),t&&t.length>0?window.setTimeout(function(){t.focus()},200):window.setTimeout(function(){y.closest("tr").nextAll().children("input,select,textarea,button").focus()},200))):window.setTimeout(function(){y.closest("td").siblings(".vis-gc-vpanel-table-td3").find("input,select,textarea,button").focus()},200);y.closest("td").nextAll().children("input,select,textarea,button").focus();u.constructor.name=="infoProduct"&&u.getRefreshStatus()&&a.fireRefreshUI();return}if(a.isMultiKeyTextBox){for(var f="",i=0,e=0,i=0,e=n.length;i<e;i++){if(f.length==0){f+=n[i];continue}f+=","+n[i]}a.setValue(f,!1,!0)}else r=null,u.getRefreshStatus&&u.getRefreshStatus()?a.fireRefreshUI():(n!=null&&n.length==1?r=n[0]:(InfoMultipleIds=null,n.length>1&&(r=n[0])),r!=null&&a.setValue(r,!1,!0));u=null};u.show()}};w.on(t.Events.onClick,a.openSearchForm);if(v)v.on(t.Events.onClick,function(n){if(a.isMultiKeyTextBox){if(a.isReadOnly)return;var t=a.getValue();t&&t.toString().length>0&&a.setValue(null,!1,!0)}else v.w2overlay(b.clone(!0));n.stopPropagation()});if(b)b.on("click","LI",function(i){var u=n(i.target).data("action"),f,r,e;if(u==t.Actions.zoom){if(g)return;ot()}else if(u==t.Actions.preference)f=new t.ValuePreference(a.mField,a.getValue(),a.getDisplay()),f!=null&&f.showDialog(),f=null;else if(u==t.Actions.refresh){if(!a.lookup||a.isReadOnly)return;a.lookup.refresh()}else if(u==t.Actions.add)r=a.getValue(),t.AddUpdateBPartner(a.mField.getWindowNo(),0,t.Msg.getMsg("Customer"),null,0,0);else if(u==t.Actions.update)r=a.getValue(),r&&r.toString().length>0&&t.AddUpdateBPartner(a.mField.getWindowNo(),r,t.Msg.getMsg("Customer"),null,0,0);else if(u==t.Actions.contact)r=a.getValue(),r&&r.toString().length>0&&(e=new t.ContactInfo(r,a.mField.getWindowNo()),e.show());else if(u==t.Actions.remove){if(a.isReadOnly)return;a.setValue(null,!1,!0)}});this.disposeComponent=function(){w.off(t.Events.onClick);v&&v.off(t.Events.onClick);b&&b.off(t.Events.onTouchStartOrClick);b=null;a=null;y=null;w=null;v=null;this.getBtn=null;this.setVisible=null}}function tt(r,u,f,e,o,s,h){var l=7,c,a;if(h!=t.DisplayType.Memo)h==t.DisplayType.TextLong?(l=7,s=1e5):l=s<300?3:s<2e3?5:7;else try{l=s<300?3:s<2e3?5:s/500}catch(v){l=s<300?3:s<2e3?5:7}c=n("<textarea>",{name:r,maxlength:s,rows:l});i.call(this,c,h,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);a=this;c.on("change",function(n){var t,i;n.stopPropagation();t=c.val();t!==a.oldValue&&(i={newValue:t,propertyName:a.getName()},a.fireValueChanged(i),i=null)});this.disposeComponent=function(){c.off("change");c=null;a=null}}function s(r,u,f,e,o,s,h){var v=h,a=s,c=n("<input>",{type:"number",step:"any",name:r,maxlength:a}),l;i.call(this,c,v,f,r,u);this.format=t.DisplayType.GetNumberFormat(v);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);l=this;c.on("keydown",function(n){return n.keyCode==189||n.keyCode==109||n.keyCode==173?n.keyCode==189&&this.value.length==0?!0:(this.value=Number(this.value*-1),setTimeout(function(){c.trigger("change")},100),!1):n.keyCode>=37&&n.keyCode<=40||n.keyCode==8||n.keyCode==9||n.keyCode==16||n.keyCode==17||n.keyCode==35||n.keyCode==36||n.keyCode==46?!0:n.keyCode>=48&&n.keyCode<=57&&n.shiftKey==!1||n.keyCode>=96&&n.keyCode<=105&&n.shiftKey==!1?this.value.length>=a?!1:!0:n.keyCode==189||n.keyCode==109||n.keyCode==173?(this.value=this.value*-1,!1):n.keyCode==190||n.keyCode==110?(this.value.indexOf(".")>-1&&(this.value=this.value.replace(".","")),this.value.length>=a)?!1:!0:n.keyCode==188?!1:!1});c.on("focus",function(n){n.stopPropagation();t.DisplayType.Amount==v&&c.select()});c.on("change",function(n){var t,i;n.stopPropagation();t=l.getValue();this.value=t;t!==l.oldValue&&(i={newValue:t,propertyName:l.getName()},l.fireValueChanged(i),i=null)});this.disposeComponent=function(){c.off("keydown");c.off("change");c=null;l=null;this.format.dispose();this.format=null;a=null}}function k(r,u,f,e,o,s){var a=t.DisplayType.Integer,l=s,c=n("<input>",{type:"text",name:r,maxlength:l}),h;i.call(this,c,a,f,r,u);this.format=t.DisplayType.GetNumberFormat(a);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);h=this;c.on("keydown",function(n){if(n.keyCode==189||n.keyCode==109||n.keyCode==173)return n.keyCode==189&&this.value.length==0?!0:(this.value=Number(this.value*-1),setTimeout(function(){c.trigger("change")},100),!1);if(n.keyCode>=37&&n.keyCode<=40||n.keyCode==8||n.keyCode==9||n.keyCode==16||n.keyCode==17||n.keyCode==35||n.keyCode==36||n.keyCode==46)return!0;if(this.value<0){if(this.value.length>t.DisplayType.INTEGER_DIGITS&&n.keyCode!=8&&n.keyCode!=9&&n.keyCode!=46)return!1}else if(this.value.length>=t.DisplayType.INTEGER_DIGITS&&n.keyCode!=8&&n.keyCode!=9&&n.keyCode!=46)return!1;return n.keyCode>=48&&n.keyCode<=57&&n.shiftKey==!1||n.keyCode>=96&&n.keyCode<=105&&n.shiftKey==!1?this.value.length>=l?!1:!0:!1});c.on("change",function(n){var t,i,r;n.stopPropagation();t=h.getValue();t=Globalize.parseInt(t.toString());i=Number(h.format.GetFormatedValue(t));t!=i&&(h.mField.setValue(null),t=i);t!==h.oldValue&&(r={newValue:t,propertyName:h.getName()},h.fireValueChanged(r),r=null)});this.disposeComponent=function(){c.off("keydown");c.off("change");c=null;h=null;this.format.dispose();this.format=null;l=null}}function d(r,u,f,e,o,s){o||(o=t.DisplayType.Location);this.lookup=s;this.lastDisplay="";this.settingFocus=!1;this.inserting=!1;this.settingValue=!1;this.value=null;var a=n("<input readonly>",{type:"text",name:r}),l=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+t.Application.contextUrl+'Areas/VIS/Images/base/ToLink20.png" /><\/button>'),c=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+t.Application.contextUrl+'Areas/VIS/Images/base/Location20.png" /><\/button>'),v=2,h=this;i.call(this,a,o,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtn=function(n){return n==0?l:n==1?c:void 0};this.getBtnCount=function(){return v};this.setVisible=function(n){this.visible=n;n?(a.show(),l.show(),c.show()):(a.hide(),l.hide(),c.hide())};this.setReadOnly=function(n){this.isReadOnly=n;a.prop("disabled",n?!0:!1);n?c.css("opacity",.7):c.css("opacity",1);this.setBackground(!1)};l.on(t.Events.onClick,function(n){var t="http://local.google.com/maps?q="+h.getDisplay();window.open(t);n.stopPropagation()});c.on(t.Events.onClick,function(n){if(n.stopPropagation(),!h.isReadOnly){var i=new t.LocationForm(h.value);i.load();i.showDialog();i.onClose=function(n,t){if(t){h.oldValue=0;h.lookup.refreshLocation(n);h.setValue(n);var i={newValue:n,propertyName:h.getColumnName()};h.fireValueChanged(i);i=null}};i=null}});this.disposeComponent=function(){l.off(t.Events.onClick);c.off(t.Events.onClick);h=null;a=null;l=null;c=null;this.setVisible=null}}function h(r,u,e,o,s,h){var y;this.mandatory=u;this.onlyWarehouseId=0;this.onlyProductId=0;this.onlyOutgoing=null;this.windowNum=h.getWindowNo();this.columnName=r;this.lookup=h;y=t.Application.contextUrl+"Areas/VIS/Images/base/Locator20.png";this.value=null;s||(s=t.DisplayType.Locator);var a=n("<input readonly>",{type:"text",name:r}),l=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+y+'" /><\/button>'),v=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+t.Application.contextUrl+'Areas/VIS/Images/base/Zoom20.png" /><\/button>'),p=2,c=this;i.call(this,a,s,e,r,u);this.getBtnCount=function(){return p};this.getBtn=function(n){return n==0?l:n==1?v:void 0};this.setVisible=function(n){this.visible=n;n?(a.show(),l.show(),v.show()):(l.hide(),v.hide(),a.hide())};this.setReadOnly=function(n){this.isReadOnly=n;a.prop("disabled",n?!0:!1);n?l.css("opacity",.7):l.css("opacity",1);this.setBackground(!1)};l.on(t.Events.onClick,function(n){if(n.stopPropagation(),!c.isReadOnly){var t=c.getOnlyWarehouseID(),i=c.getOnlyProductID();c.showLocatorForm(t,i)}});v.on(t.Events.onClick,function(n){var i,r,u,o,s,h,e,l;if(n.stopPropagation(),c.lookup){if(i=c.lookup.getZoomQuery(),r=c.getValue(),r==null,r==""&&(r=null),i==null||r!=null){if(i=new t.Query,u=null,c.lookup!=null&&c.lookup instanceof t.MLookup&&(o=c.lookup.getAD_Reference_Value_ID(),o!=0)){s="VIS_91";h=[];h[0]=new t.DB.SqlParam("@AD_Reference_ID",o);try{e=f(s,h);e.read()&&(u=e.getString(0));e.dispose()}catch(n){this.log.log(t.Logging.Level.SEVERE,s,n)}}u!=null&&u.length!=0?i.addRestriction(u,t.Query.prototype.EQUAL,r):i.addRestriction(c.getColumnName(),t.Query.prototype.EQUAL,r);i.setRecordCount(1)}l=0;l=c.mField.getZoomWindow_ID()>0?c.mField.getZoomWindow_ID():c.lookup.getZoomWindow(i);t.viewManager.startWindow(l,i)}});this.disposeComponent=function(){l.off(t.Events.onClick);v.off(t.Events.onClick);c=null;a=null;l=null;this.getBtn=null;this.setVisible=null}}function u(r,u,f,e,o,s,h,c,l,a,v){function tt(n){var i=t.Env.getCtx().getContextAsInt(y.windowNo,"C_GenAttributeSetInstance_ID"),r;y.isFromActivityForm&&(i=y.C_GenAttributeSetInstance_ID);i==0;r=new t.GenralAttributeForm(i,n,y.windowNo,y.isSearch,y.getCanSaveRecord(),y.isFromDMS);r.showDialog();r.onClose=function(n,i,r){t.Env.getCtx().setContext(h,"C_GenAttributeSetInstance_ID",n);b(n,i);r!=null&&(y.setInstanceIDs=r);y.getControl().val(i)}}function b(n){if(y.log.finest("Changed M_AttributeSetInstance_ID="+n),y.oldValue!=n){n==0&&y.setValue(null);y.setValue(n);var t={newValue:n,propertyName:y.colName};y.fireValueChanged(t);t=null}}function it(i){var u=i==null?0:i,r=t.Env.getCtx().getContextAsInt(h,"M_Product_ID"),e=t.Env.getCtx().getContextAsInt(h,"M_ProductBOM_ID"),c=t.Env.getCtx().getContextAsInt(h,"M_Locator_ID"),f;y.log.config("M_Product_ID="+r+"/"+e+",M_AttributeSetInstance_ID="+u+", AD_Column_ID="+y.AD_Column_ID);var o=y.AD_Column_ID==8418,s=!0,l=!1;e!=0&&(r=e);r!=0&&n.ajax({url:t.Application.contextUrl+"PAttributes/ExcludeEntry",dataType:"json",async:!1,data:{productId:r,adColumn:y.AD_Column_ID,windowNo:h},success:function(n){s=n.result}});!o&&(r==0||s)?(l=!0,u=0,b(u),t.ADialog.info("VIS_PAttributeNotFound",null,null,null)):(f=new t.PAttributesForm(u,r,c,y.C_BPartner_ID,o,y.AD_Column_ID,h),f.hasAttribute&&f.showDialog(),f.onClose=function(n,t,i){this.M_Locator_ID=i;b(n,t)})}var k,g,d;this.NO_INSTANCE=0;this.AD_Column_ID=0;k="M_AttributeSetInstance_ID";g=!1;this.C_GenAttributeSet_ID=0;this.C_GenAttributeSetInstance_ID=0;this.M_Locator_ID=0;k=r;this.value=null;this.windowNo=h;this.lookup=s;this.C_BPartner_ID=t.Env.getCtx().getContextAsInt(this.windowNo,"C_BPartner_ID");this.log=t.Logging.VLogger.getVLogger("VPAttribute");d=t.Application.contextUrl+"Areas/VIS/Images/base/PAttribute20.png";o||(o=t.DisplayType.PAttribute);this.isFromActivityForm=c;this.isSearch=l;this.isFromDMS=a;this.isPAttribute=v;this.canSaveRecord=!0;var w=n("<input >",{type:"text",name:r}),p=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+d+'" /><\/button>'),nt=1,y=this;this.setInstanceIDs=null;i.call(this,w,o,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtnCount=function(){return nt};this.getBtn=function(n){if(n==0)return p};this.setVisible=function(n){this.visible=n;n?(w.show(),p.show()):(p.hide(),w.hide())};this.setReadOnly=function(n){this.isReadOnly=n;w.prop("disabled",n?!0:!1);n?p.css("opacity",.7):p.css("opacity",1);this.setBackground(!1)};p.on(t.Events.onClick,function(n){var r,i;if(n.stopPropagation(),!y.isReadOnly){if(r=y.getValue(),!y.isPAttribute){if(i=0,i=t.Env.getCtx().getContextAsInt(y.windowNo,"C_GenAttributeSet_ID"),i==0&&(i=y.C_GenAttributeSet_ID,i==0)){t.ADialog.info("NoAttributeSet",null,null,null);return}tt(i,r);return}it(r)}});this.SetC_GenAttributeSet_ID=function(n){this.C_GenAttributeSet_ID=n};this.disposeComponent=function(){p.off(t.Events.onClick);y=null;w=null;p=null;this.getBtn=null;this.setVisible=null;this.value=null;this.lookup=null}}function g(r,u,f,e,o,s,h,c){var y,p;this.value=null;this.windowNo=h;this.lookup=s;this.title=c;y=r;p=t.Application.contextUrl+"Areas/VIS/Images/base/Account20.png";o||(o=t.DisplayType.PAttribute);var v=n("<input readonly>",{type:"text",name:r}),a=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+p+'" /><\/button>'),w=1,l=this;i.call(this,v,o,f,r,u);this.getBtnCount=function(){return w};this.getBtn=function(n){if(n==0)return a};this.setVisible=function(n){this.visible=n;n?(v.show(),a.show()):(v.hide(),a.hide())};this.setReadOnly=function(n){this.isReadOnly=n;v.prop("disabled",n?!0:!1);n?a.css("opacity",.7):a.css("opacity",1);this.setBackground(!1)};a.on(t.Events.onClick,function(n){var u,r,i;(n.stopPropagation(),l.isReadOnly)||(u=t.Env.getCtx().getContextAsInt(l.windowNo,"C_AcctSchema_ID"),r=0,l!=null&&l.getField()!=null&&l.getField().vo!=null&&l.getField().vo.AD_Table_ID!=null&&(r=l.getField().vo.AD_Table_ID),i=new t.AccountForm(l.title,l.lookup,u,r),i.load(),i.showDialog(),i.onClose=function(n){if(l.oldValue!=n){l.setValue(n);var t={newValue:n,propertyName:y};l.fireValueChanged(t);t=null}},i=null)});this.disposeComponent=function(){a.off(t.Events.onClick);l=null;v=null;a=null;this.getBtn=null;this.setVisible=null;this.value=null;this.lookup=null;this.value=null;this.windowNo=null;this.title=null}}function l(r,u,f,e){var s;this.values=null;this.log=t.Logging.VLogger.getVLogger("VImage");var a=e,l=r,h=n("<img style='width: 20px;height: 20px;'>"),o=n("<span>").text("-"),c=null;c=n("<button>",{type:"button",name:l});o.css("color","blue");c.append(h).append(o);i.call(this,c,t.DisplayType.Button,f,l,u);f?this.setReadOnly(!0):this.setReadOnly(!1);s=this;c.on(t.Events.onClick,function(n){if(n.stopPropagation(),!s.isReadOnly){var i=new t.VImageForm(s.getValue(),o.text().trim().length);i.showDialog();i.onClose=function(n,t){if(t&&(s.oldValue=0,s.oldValue!=n)){n=n=="null"?"":n;s.setValue(n);var i={newValue:n,propertyName:l};s.fireValueChanged(i,!0);i=null}};i=null}});this.setText=function(n){var t,i;if(n==null){o.text("");h.image.src="";return}t=n.indexOf("&");t!=-1&&(i=n.toUpperCase().charAt(t+1),i!=" "&&(n=n.substring(0,t)+n.substring(t+1)));o.text(n)};this.setIcon=function(n){n!=null?(h.attr("src","data:image/jpg;base64,"+n),h.show(),o.text("")):(h.attr("src","data:image/jpg;base64,"+n),h.hide(),o.text("-"))};this.disposeComponent=function(){c.off(t.Events.onClick);c=null;this.log=null;a=null;h=null;o=null;this.setText=null;this.setIcon=null;s=null}}function a(r,u,f,e,o){function b(){var i=n("<ul class='vis-apanel-rb-ul'>");return i.append(n("<a id='link' style='border-bottom: 1px solid #CCDADE;color: #535353;font-size: 12px;display: block;margin-bottom: 8px;'  href='javascript:void(0)'>"+t.Msg.getMsg("SaveTolocalFile")+"<\/a>")),i.append(n("<li data-action='"+y+"'>").text(t.Msg.getMsg("Open/LoadIntoDatabase"))),i}var l,s;this.values=null;var a=n("<span>").text(""),w=o,v=r,h=null,c=null,p="SaveTolocalFile",y="LoadIntoDatabase";if(this.data=null,l=n("<input type='file' class='file' name='file'/>"),h=n("<button>",{type:"button",name:v}),h.append(a),i.call(this,h,t.DisplayType.Button,f,v,u),f||!e?this.setReadOnly(!0):this.setReadOnly(!1),s=this,c=b(),c){c.on("click","LI",function(t){var i=n(t.target).data("action");i==p||i==y&&l.trigger("click")});c.on("click","a",function(){if(s.getValue()!=null){var t=(new Date).toISOString().slice(0,19).replace(/-/g,""),i="data:;base64,"+s.getValue();n(this).attr("href",i).attr("download","file-"+t+".log")}})}l.change(function(){var t=l[0].files[0],n=new FileReader,i=n.readAsDataURL(t);n.onloadend=function(){var t=n.result.split(",")[1],i;s.oldValue!=t&&(s.setValue(t),i={newValue:t,propertyName:v},s.fireValueChanged(i,!0),i=null)};return});h.on(t.Events.onClick,function(n){s.isReadOnly||h.w2overlay(c.clone(!0));n.stopPropagation()});this.setText=function(n){var t,i;if(n==null){a.text("");return}t=n.indexOf("&");t!=-1&&(i=n.toUpperCase().charAt(t+1),i!=" "&&(n=n.substring(0,t)+n.substring(t+1)));a.text(n)};this.disposeComponent=function(){h.off(t.Events.onClick);h=null;this.setText=null;this.values=null;a=null;w=null;v=null;c=null;p=null;y=null;this.data=null;l=null;s=null}}function it(r,u,f,e,o,s){var h;this.value=null;var v=t.Application.contextUrl+"Areas/VIS/Images/base/Url20.png",a=0,c=n("<input>",{type:"text",name:r,maxlength:s}),l=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+v+'" /><\/button>');a+=1;h=this;i.call(this,c,t.DisplayType.URL,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtnCount=function(){return a};this.getBtn=function(n){if(n==0)return l};this.setVisible=function(n){this.visible=n;n?(c.show(),l.show()):(c.hide(),l.hide())};l.on(t.Events.onClick,function(n){if((n.stopPropagation(),h.value!=null)&&!h.isReadOnly){var i=h.value.trim();if(i.length>0){i.contains("http://")||i.contains("https://")||(i="http://"+i);window.open(i);return}t.ADialog.warn("URLnotValid",!0,null)}});c.on("change",function(n){var t,i;n.stopPropagation();t=c.val();t!==h.oldValue&&(i={newValue:t,propertyName:h.getName()},h.fireValueChanged(i),i=null)});this.disposeComponent=function(){l.off(t.Events.onClick);c.off("change");h=null;c=null;l=null;this.getBtn=null;this.setVisible=null;this.value=null;v=null;a=null;this.getBtnCount=null;this.getBtn=null}}function v(r,u,f,e,o,s){var k=!1,w,y,s,b,p,d,l,v,h;s==s.FileName&&(k=!0);DialogType={OpenFile:0,SaveFile:1,Custom:2};SelectionType={FilesOnly:0,DirectoryOnly:1};w=SelectionType.DirectoryOnly;y=DialogType.Custom;this.log=t.Logging.VLogger.getVLogger("VFile");s=t.DisplayType.FileName;b=t.Application.contextUrl+"Areas/VIS/Images/base/Folder20.png";k&&(w=SelectionType.FilesOnly,b=t.Application.contextUrl+"Areas/VIS/Images/base/File20.png");p=r.toUpperCase();p.indexOf("open")!=-1||p.indexOf("load")!=-1?y=DialogType.OpenFile:p.indexOf("save")!=-1&&(y=DialogType.SaveFile);d=o;l=r;this.value=null;var g=0,c=n("<input>",{type:"text",name:l}),a=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+b+'" /><\/button>');g+=1;v=n("<input type='file' class='file' name='file'/>");c.append(a);i.call(this,c,s,f,l,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtnCount=function(){return g};this.getBtn=function(n){if(n==0)return a};this.setVisible=function(n){this.visible=n;n?(c.show(),a.show()):(c.hide(),a.hide())};h=this;a.on(t.Events.onClick,function(i){var u,f,r;h.isReadOnly||(i.stopPropagation(),w==SelectionType.DirectoryOnly?(r=new t.VisImportFiles(!0),r.onClose=function(n){h.setValue(n)},r.show()):y==DialogType.SaveFile?h.getValue()!=null&&(u=(new Date).toISOString().slice(0,19).replace(/-/g,""),f="data:;base64,"+h.getValue(),n(this).attr("href",f).attr("download","file-"+u+".log")):(r=new t.VisImportFiles(!1),r.onClose=function(){h.setValue(name)},r.show()))});v.on("change",function(t){var i,r;t.stopPropagation();i=n(v).val().split("\\").pop();h.oldValue!=i&&(h.setValue(i),r={newValue:i,propertyName:l},h.fireValueChanged(r),r=null)});c.on("change",function(n){var t,i;n.stopPropagation();t=c.val();this.value=t;t!==h.oldValue&&(i={newValue:t,propertyName:h.getName()},h.fireValueChanged(i),i=null,h.setValue(t))});this.disposeComponent=function(){c.off(t.Events.onClick);c.off("change");v.off("change");c=null;d=null;l=null;v=null;h=null}}function nt(r,u,f,e,o,s,h){o||(o=t.DisplayType.AmtDimension);this.lookup=s;this.lastDisplay="";this.settingFocus=!1;this.inserting=!1;this.settingValue=!1;this.value=null;this.defaultValue="";var l=n("<input readonly>",{type:"text",name:r}),a=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+t.Application.contextUrl+'Areas/VIS/Images/base/AmtDimension20.png" /><\/button>'),v=1,c=this;i.call(this,l,o,f,r,u);f||!e?this.setReadOnly(!0):this.setReadOnly(!1);this.getBtn=function(n){if(n==0)return a};this.getBtnCount=function(){return v};this.hideButton=function(n){n?a.show():a.hide()};this.setVisible=function(n){this.visible=n;n?(l.show(),a.show()):(l.hide(),a.hide())};this.setReadOnly=function(n){u?u&&c.value&&(n=!0,l.css("background-color","#f8f8f8")):(n=!0,l.css("background-color","#f8f8f8"));this.isReadOnly=n;l.prop("disabled",n?!0:!1);n?a.css("opacity",.7):a.css("opacity",1);this.setBackground(n)};this.setReadOnlyTextbox=function(n){n?(l.attr("readonly","readonly"),l.attr("disabled","disabled")):(l.removeAttr("readonly"),l.removeAttr("disabled"))};this.getText=function(){return l.val()};this.setDefaultValue=function(n){this.defaultValue=n};a.on(t.Events.onClick,function(n){n.stopPropagation();c.actionText()});this.actionText=function(){var i,r,n;c.value||(c.value=0);i=t.Env.getCtx().getContextAsInt(h,"AD_Org_ID",!1);this.defaultValue&&(c.defaultValue=c.defaultValue.replace(/@/g,"").trim().replace(".value",""),r=t.Env.getCtx().getContextAsInt(h,c.defaultValue,!1));c.oldValue=c.value;n=new t.AmountDivision(c.value,i,r,f);n.onClosing=function(n){if(n>0){c.oldValue=0;c.setValue(n);var t={newValue:n,propertyName:c.getColumnName()};c.fireValueChanged(t);t=null}};n.show();n=null};this.disposeComponent=function(){a.off(t.Events.onClick);c=null;l=null;a=null;this.setVisible=null}}function y(r,u,f,e,o,s,h){function k(){var i,n,r;c.lookup&&(i=c.lookup.getZoomQuery(),n=c.getValue(),n==null,n==""&&(n=null),n==null||isNaN(n)||(n=parseInt(n)),i=new t.Query,i.addRestriction("M_ProductContainer_ID",t.Query.prototype.EQUAL,n),i.setRecordCount(1),r=0,r=c.mField.getZoomWindow_ID()>0?c.mField.getZoomWindow_ID():c.lookup.getZoomWindow(i),t.viewManager.startWindow(r,i))}var y,w,c;o||(o=t.DisplayType.ProductContainer);y={};this.lookup=s;this.lastDisplay="";this.settingFocus=!1;this.inserting=!1;this.settingValue=!1;this.value=null;this.defaultValue="";w=!1;y[t.Actions.zoom]=w;t.MRole.getIsShowPreference()&&(y[t.Actions.preference]=!0);y[t.Actions.remove]=!0;var p=t.AEnv.getContextPopup(y),v=n("<input>",{type:"text",name:r}),a=n('<button class="vis-controls-txtbtn-table-td2"><img src="'+t.Application.contextUrl+'Areas/VIS/Images/base/pContainer.png" /><\/button>'),l=n('<button  tabindex="-1" class="vis-controls-txtbtn-table-td2"><img tabindex="-1" src="'+t.Application.contextUrl+'Areas/VIS/Images/base/Info20.png" /><\/button>'),b=1;if(b+=1,c=this,i.call(this,v,o,f,r,u),f||!e?this.setReadOnly(!0):this.setReadOnly(!1),this.getBtn=function(n){return n==0?a:n==1&&l?l:void 0},this.getBtnCount=function(){return b},this.hideButton=function(n){n?(a.show(),this.getBtnCount()>1&&l&&l.show()):(a.hide(),this.getBtnCount()>1&&l&&l.hide())},this.setVisible=function(n){this.visible=n;n?(v.show(),a.show(),this.getBtnCount()>1&&l&&l.show()):(v.hide(),a.hide(),this.getBtnCount()>1&&l&&l.hide())},this.setReadOnly=function(n){this.isReadOnly=n;v.prop("disabled",n?!0:!1);n?a.css("opacity",.7):a.css("opacity",1);this.setBackground(!1)},l)l.on(t.Events.onClick,function(n){l.w2overlay(p.clone(!0));n.stopPropagation()});if(p)p.on("click","LI",function(i){var u=n(i.target).data("action"),r;if(u==t.Actions.preference)r=new t.ValuePreference(c.mField,c.getValue(),c.getDisplay()),r!=null&&r.showDialog(),r=null;else if(u==t.Actions.zoom)k();else if(u==t.Actions.remove){if(c.isReadOnly)return;c.setValue(null,!1,!0)}});this.getText=function(){return v.val()};this.setDefaultValue=function(n){this.defaultValue=n};a.on(t.Events.onClick,function(n){(n.stopPropagation(),c.isReadOnly)||c.actionText(!0)});this.actionText=function(i){c.value||(c.value=0);var r=v.val().trim(),u=t.Env.parseContext(t.Env.getCtx(),h,c.lookup.info.validationCode,!1,!0);!r||i?c.openForm(0,0,r,u):n.ajax({url:rt+"productContainer/GetProductContainer",data:{text:r,validation:u},success:function(n){n=JSON.parse(n);n=="null"||n==null||n==""||n==0?c.openForm(0,0,r,u):c.setVal(n)},error:function(){}})};v.on("keydown",function(n){(n.keyCode==13||n.keyCode==9)&&c.actionText(!1)});this.setVal=function(n){c.oldValue=0;c.setValue(n);var t={newValue:n,propertyName:c.getColumnName()};c.fireValueChanged(t,!0);t=null};this.openForm=function(n,i,r,u){c.oldValue=c.value;var f=new t.productContainerTree(n,i,r,u);f!=null&&(f.showDialog(),f.onClosing=function(n){c.setVal(n)});f=null};this.disposeComponent=function(){a.off(t.Events.onClick);c=null;v=null;a=null;this.setVisible=null}}var rt=t.Application.contextUrl,ot=rt+"JsonData/JDataSetWithCode",st=rt+"JsonData/ExecuteNonQuer",f=function(n,i,r){var e=r?!0:!1,f={sql:n,page:1,pageSize:0},u;return i&&(f.param=i),u=null,ft(f,e,function(n){u=(new t.DB.DataReader).toJson(n);r&&r(u)}),u},ht=function(n,i,r){var e=r?!0:!1,f={sql:n,page:1,pageSize:0},u;return i&&(f.param=i),u=null,ft(f,e,function(n){u=(new t.DB.DataSet).toJson(n);r&&r(u)}),u},ut=function(n,i,r){var f=r?!0:!1,e={sql:n,page:1,pageSize:0},u;return i&&(e.param=i),u=null,ft(e,f,function(n){i=(new t.DB.DataSet).toJson(n);var i=(new t.DB.DataSet).toJson(n);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u},ct=function(t,i,r){var f=r?!0:!1,u=null,e={sql:t.join("/"),param:i};return n.ajax({url:st+"iesWithCode",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:f,data:JSON.stringify(e)}).done(function(n){u=n;r&&r(n)}),u};t.DisplayType={String:10,Integer:11,Amount:12,ID:13,Text:14,Date:15,DateTime:16,List:17,Table:18,TableDir:19,YesNo:20,Location:21,Number:22,Binary:23,Time:24,Account:25,RowID:26,Color:27,Button:28,Quantity:29,Search:30,Locator:31,Image:32,Assignment:33,Memo:34,PAttribute:35,TextLong:36,CostPrice:37,FilePath:38,FileName:39,URL:40,PrinterName:42,Label:44,MultiKey:45,GAttribute:46,AmtDimension:47,ProductContainer:48,IsString:function(n){return t.DisplayType.String==n},IsText:function(n){return n==t.DisplayType.String||n==t.DisplayType.Text||n==t.DisplayType.TextLong||n==t.DisplayType.Memo||n==t.DisplayType.FilePath||n==t.DisplayType.FileName||n==t.DisplayType.URL||n==t.DisplayType.PrinterName?!0:!1},IsLookup:function(n){return t.DisplayType.List==n||n==t.DisplayType.TableDir||n==t.DisplayType.Table||n==t.DisplayType.Search||n==t.DisplayType.MultiKey||n==t.DisplayType.ProductContainer?!0:!1},IsInt:function(n){return n==t.DisplayType.Integer?!0:!1},IsSearch:function(n){return n==this.Search?!0:!1},IsID:function(n){return n==t.DisplayType.ID||n==t.DisplayType.Table||n==t.DisplayType.TableDir||n==t.DisplayType.Search||n==t.DisplayType.Location||n==t.DisplayType.Locator||n==t.DisplayType.Account||n==t.DisplayType.Assignment||n==t.DisplayType.PAttribute||n==t.DisplayType.Image||n==t.DisplayType.Color||n==t.DisplayType.AmtDimension||n==t.DisplayType.ProductContainer?!0:!1},IsNumeric:function(n){return n==t.DisplayType.Amount||n==t.DisplayType.Number||n==t.DisplayType.CostPrice||n==t.DisplayType.Integer||n==t.DisplayType.Quantity?!0:!1},IsDate:function(n){return n==t.DisplayType.Date||n==t.DisplayType.DateTime||n==t.DisplayType.Time?!0:!1},IsLOB:function(n){return n==t.DisplayType.Binary||n==t.DisplayType.TextLong?!0:!1},MAX_DIGITS:28,INTEGER_DIGITS:10,MAX_FRACTION:12,AMOUNT_FRACTION:2,GetNumberFormat:function(n){return n==this.Integer?new t.Format(this.INTEGER_DIGITS,0,0):n==this.Quantity?new t.Format(this.MAX_DIGITS,this.MAX_FRACTION,0):n==this.Amount?new t.Format(this.MAX_DIGITS,this.MAX_FRACTION,this.AMOUNT_FRACTION):n==this.CostPrice?new t.Format(this.MAX_DIGITS,this.MAX_FRACTION,this.AMOUNT_FRACTION):new t.Format(this.MAX_DIGITS,this.MAX_FRACTION,1)}};t.VControlFactory={getControl:function(n,i,f,e){var ut,ot,gt,ti,ni,vt,yt,pt,ii,ri,ui,kt,fi,dt,wt,ei,oi,si,bt,ct,lt;if(!i||(ut=i.getColumnName(),ot=i.getIsMandatory(!1),i.getIsHeading()))return null;var li=i.getIsDisplayed(),hi=i.getMinValue(),ci=i.getMaxValue(),ft=null,rt=i.getDisplayType(),st=i.getIsReadOnly(),ht=i.getIsEditable(!1),at=i.getWindowNo();return rt==t.DisplayType.Button?(gt=new r(ut,ot,st,ht,i.getHeader(),i.getDescription(),i.getHelp(),i.getAD_Process_ID(),i.getIsLink(),i.getIsRightPaneLink(),i.getAD_Form_ID(),i.getIsBackgroundProcess(),i.getAskUserBGProcess()),gt.setField(i),gt.setReferenceKey(i.getAD_Reference_Value_ID()),ft=gt):rt==t.DisplayType.String?(lt=new p(ut,ot,st,ht,i.getDisplayLength(),i.getFieldLength(),i.getVFormat(),i.getObscureType(),i.getIsEncryptedField()),lt.setField(i),ft=lt):rt==t.DisplayType.YesNo?(ti=new w(ut,ot,st,ht,i.getHeader(),i.getDescription()),ti.setField(i),ft=ti):t.DisplayType.IsDate(rt)?(rt==t.DisplayType.DateTime&&(readOnly=!0),ni=new b(ut,ot,st,ht,rt,i.getHeader()),ni.setName(ut),ni.setField(i),ft=ni):t.DisplayType.IsLookup(rt)||t.DisplayType.ID==rt?(vt=i.getLookup(),e&&vt!=null&&vt.disableValidation(),e?vt==null||rt!=t.DisplayType.Search&&vt.getDisplayType()!=t.DisplayType.Search?(yt=new c(ut,ot,st,ht,vt,i.getDisplayLength(),rt,i.getZoomWindow_ID()),yt.setDisplayType(rt),yt.setField(i),ft=yt):(rt=t.DisplayType.Search,pt=new o(ut,ot,st,ht,rt,vt,i.getZoomWindow_ID()),pt.setField(i),ft=pt):rt!=t.DisplayType.Search&&rt!=t.DisplayType.MultiKey&&rt!=t.DisplayType.ProductContainer?(yt=new c(ut,ot,st,ht,vt,i.getDisplayLength(),rt,i.getZoomWindow_ID()),yt.setField(i),ft=yt):rt==t.DisplayType.ProductContainer?(ct=new y(ut,ot,st,ht,rt,i.getLookup(),at),ct.setField(i),ft=ct):(pt=new o(ut,ot,st,ht,rt,vt,i.getZoomWindow_ID()),pt.setField(i),ft=pt)):rt==t.DisplayType.Location?(ii=new d(ut,ot,st,ht,rt,i.getLookup()),ii.setField(i),ft=ii):rt==t.DisplayType.Locator?(ri=new h(ut,ot,st,ht,rt,i.getLookup()),ri.setField(i),ft=ri):t.DisplayType.Text==rt||t.DisplayType.TextLong==rt||t.DisplayType.Memo==rt?(ui=new tt(ut,ot,st,ht,i.getDisplayLength(),i.getFieldLength(),rt),ui.setField(i),ft=ui):t.DisplayType.IsNumeric(rt)?t.DisplayType.Amount==rt||t.DisplayType.Quantity==rt||t.DisplayType.CostPrice==rt?(kt=new s(ut,ot,st,ht,i.getDisplayLength(),i.getFieldLength(),rt,"FixedHeader"),kt.setMinValue(hi),kt.setMaxValue(ci),kt.setField(i),ft=kt):t.DisplayType.Integer==rt?(fi=new k(ut,ot,st,ht,i.getDisplayLength(),i.getFieldLength(),"FixedHeader"),fi.setField(i),ft=fi):t.DisplayType.Number==rt&&(dt=new s(ut,ot,st,ht,i.getDisplayLength(),i.getFieldLength(),rt,"FixedHeader"),dt.setField(i),dt.setMinValue(hi),dt.setMaxValue(ci),ft=dt):rt==t.DisplayType.PAttribute?(wt=new u(ut,ot,st,ht,rt,i.getLookup(),at,!1,!1,!1,!0),wt.setField(i),ft=wt):rt==t.DisplayType.GAttribute?(wt=new u(ut,ot,st,ht,rt,i.getLookup(),at,!1,!1,!1,!1),wt.setField(i),ft=wt):rt==t.DisplayType.Account?(ei=new g(ut,ot,st,ht,rt,i.getLookup(),at,i.getHeader()),ei.setField(i),ft=ei):rt==t.DisplayType.Binary?(oi=new a(ut,ot,st,ht,at),oi.setField(i),ft=oi):rt==t.DisplayType.Image?(si=new l(ut,ot,st,at),si.setField(i),ft=si):rt==t.DisplayType.URL?(bt=new it(ut,ot,st,ht,i.getDisplayLength(),i.getFieldLength()),bt.setField(i),ft=bt):rt==t.DisplayType.FileName||rt==t.DisplayType.FilePath?(bt=new v(ut,ot,st,ht,at,rt),bt.setField(i),ft=bt):rt==t.DisplayType.Label?(lt=new et(i.getHelp(),ut,!1,!0),lt.setField(i),ft=lt):rt==t.DisplayType.AmtDimension?(ct=new nt(ut,ot,st,ht,rt,i.getLookup(),at),ct.setField(i),ct.setDefaultValue(i.vo.DefaultValue),ft=ct):rt==t.DisplayType.ProductContainer&&(ct=new y(ut,ot,st,ht,rt,i.getLookup(),at),ct.setField(i),ft=ct),ft==null&&(lt=new p(ut,ot,st,ht,i.getDisplayLength(),i.getFieldLength(),i.getVFormat(),i.getObscureType(),i.getIsEncryptedField()),lt.setField(i),ft=lt),ft},getLabel:function(n){if(n==null)return null;var i=n.getDisplayType();return n.getIsFieldOnly()||i==t.DisplayType.YesNo||i==t.DisplayType.Button||i==t.DisplayType.Label?null:new t.Controls.VLabel(n.getHeader(),n.getColumnName(),n.getIsMandatory())}};i.prototype.getControl=function(){return this.ctrl};i.prototype.getField=function(){return this.mField};i.prototype.getName=function(){return this.colName};i.prototype.getColumnName=function(){return this.colName};i.prototype.getIsMandatory=function(){return this.isMandatory};i.prototype.getIsReadonly=function(){return this.readOnly};i.prototype.getDisplayType=function(){return this.displayType};i.prototype.getIsVisible=function(){return this.visible};i.prototype.getValue=function(){return this.ctrl.val()};i.prototype.getDisplay=function(){return this.ctrl.val()};i.prototype.getBtnCount=function(){return 0};i.prototype.setName=function(n,t){t?this.name=t+n:this.colName=n};i.prototype.setField=function(n){this.mField=n};i.prototype.setValue=function(){};i.prototype.setVisible=function(n){this.visible=n;n?this.ctrl.show():this.ctrl.hide()};i.prototype.setReadOnly=function(n){this.isReadOnly=n;this.ctrl.prop("disabled",n?!0:!1);this.setBackground(!1)};i.prototype.setDefaultFocus=function(n){n&&this.ctrl.focus()};i.prototype.setMandatory=function(n){this.isMandatory=n;this.setBackground(!1)};i.prototype.setBackground=function(n){if(!this.colName.startsWith("lbl")&&this.displayType!=t.DisplayType.Label&&this.displayType!=t.DisplayType.YesNo&&this.displayType!=t.DisplayType.Button)if(typeof n=="boolean")if(n)this.setBackground("vis-gc-vpanel-table-error");else if(this.isReadOnly)this.setBackground("vis-gc-vpanel-table-readOnly");else if(this.isMandatory){var i=this.getValue();if(i&&i.toString().length>0){this.setBackground("");return}this.setBackground("vis-gc-vpanel-table-mandatory")}else this.setBackground("");else{if(this.activeClass==n)return;this.ctrl.removeClass();n.length>0&&this.ctrl.addClass(n);this.activeClass=n}};i.prototype.setDisplayType=function(n){this.displayType=n};i.prototype.addVetoableChangeListener=function(n){this.vetoablechangeListner=n};i.prototype.fireValueChanged=function(n,t){this.editingGrid&&(this.gridPos.dialog||t)?window.setTimeout(function(t){t.ctrl.parent().length!=0&&t.ctrl.detach();t.editingGrid.editChange.call(t.editingGrid,t.ctrl[0],t.gridPos.index,t.gridPos.col,n,n.newValue);t=null;n=null},10,this):this.vetoablechangeListner&&!this.editingGrid&&window.setTimeout(function(t){t.vetoablechangeListner.vetoablechange(n);t=null;n=null},10,this)};i.prototype.fireRefreshUI=function(n){this.vetoablechangeListner&&window.setTimeout(function(t){t.vetoablechangeListner.refreshUI(n);t=null;n=null},10,this)};i.prototype.addActionListner=function(n){this.actionListner=n};i.prototype.invokeActionPerformed=function(n){this.actionListner&&this.actionListner.actionPerformed(n)};i.prototype.dispose=function(){console.log("dispose ");this.ctrl.remove();this.ctrl=null;this.mField=null;this.displayType=null;this.isReadOnly=null;this.colName=null;this.isMandatory=null;this.oldValue=null;this.vetoablechangeListner=null;this.actionListner=null;this.disposeComponent()};t.Utility.inheritPrototype(p,i);p.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,this.ctrl.val(n))};p.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(et,i);t.Utility.inheritPrototype(r,i);r.prototype.setReferenceKey=function(n){n&&n>0&&n!=195&&n!=135&&n!=234&&this.readReference(n)};r.prototype.setValue=function(n){var i,r;this.value=n;i=this.text;n==null||this.colName.equals("Record_ID")||(this.values!=null?i=this.values[n]:this.lookup!=null&&(r=this.lookup.get(n),r!=null&&(i=r.getName())));i||(i=t.Msg.getMsg("Invalid")+" { '"+n+"' }");this.setText(i!=null?i:"")};r.prototype.setReadOnly=function(n){this.isReadOnly=n;this.ctrl.css("opacity",n?.6:1);this.isLink||this.ctrl.prop("disabled",n?!0:!1);this.setBackground(!1)};r.prototype.getValue=function(){return this.value!=null?this.value.toString():null};r.prototype.getDisplay=function(){return this.value};r.prototype.readReference=function(n){var r,u,i;this.values={};r=t.Env.isBaseLanguage(t.Env.getCtx(),"")?"VIS_82":"VIS_148";u=[];u[0]=new t.DB.SqlParam("@AD_Reference_ID",n);try{for(i=f(r,u);i.read();)this.values[i.getString(0)]=i.getString(1);i.close()}catch(e){t.Logging.VLogger.getVLogger().get().log(t.Logging.Level.SEVERE,r,e)}};r.prototype.getProcess_ID=function(){return this.AD_Process_ID};r.prototype.getAD_Form_ID=function(){return this.AD_Form_ID};r.prototype.getDescription=function(){return this.description};r.prototype.getHelp=function(){return this.help};r.prototype.getAskUserBGProcess=function(){return this.askUserBGProcess};r.prototype.getIsBackgroundProcess=function(){return this.isBackgroundProcess};t.Utility.inheritPrototype(w,i);w.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,this.cBox.prop("checked",n))};w.prototype.getValue=function(){return this.cBox.prop("checked")};w.prototype.getDisplay=function(){return this.cBox.prop("checked").toString()};t.Utility.inheritPrototype(c,i);c.prototype.setValue=function(n,i){var u,f,r;if(this.oldValue!=n){if(this.settingValue=!0,this.oldValue=n,this.ctrl.val(n),n==null){this.lastDisplay="";this.settingValue=!1;return}if(this.lookup==null){this.lastDisplay=n.toString();this.settingValue=!1;return}if(this.lastDisplay=this.lookup.getDisplay(n,!0),this.lastDisplay.equals("<-1>")&&(this.lastDisplay="",this.oldValue=null),this.inserting=i,u=this.lastDisplay.startsWith("<")&&this.lastDisplay.endsWith(">"),f=this.ctrl.val(),f==null||this.inserting&&this.lookup.getDisplayType()!=t.DisplayType.Search){if(u&&this.lookup.loading){window.setTimeout(function(t){t.setValue(n,i);t=null;return},500,this);this.oldValue="oldValue";return}u&&(this.lastDisplay=this.lookup.getDisplay(n,!1),u=this.lastDisplay.startsWith("<")&&this.lastDisplay.endsWith(">"));u?(this.oldValue="old",this.ctrl.val(null),this.inserting&&this.ctrl.trigger("change")):this.ctrl.val()==null&&(this.inserting&&!this.lookup.info.isParent&&this.lookup.getIsValidated()&&this.lookup.allLoaded?(this.lookup.fillCombobox(this.getIsMandatory(),!1,!1,!1),this.lookup.loading||this.refreshOptions(this.lookup.data,n)):(r=null,this.lookup.loading||(r=this.lookup.getFromList(n)),r==null&&(r=this.lookup.get(n)),r!=null&&(this.ctrl.append('<option value="'+r.Key+'">'+r.Name+"<\/option>"),this.ctrl.val(n))));this.ctrl.val()==null&&n!=null&&(this.oldValue=null)}this.settingValue=!1}this.inserting=!1};c.prototype.refreshOptions=function(n,t){for(var r=[],u=-1,i=0;i<n.length;i++)t&&t==n[i].Key&&(u=i),r[i]='<option value="'+n[i].Key+'">'+n[i].Name+"<\/option>";this.ctrl.empty();this.ctrl.html(r.join(""));this.ctrl[0].selectedIndex=u};c.prototype.getDisplay=function(){return this.lookup==null?this.ctrl.val():this.lookup.getDisplay(this.ctrl.val())};t.Utility.inheritPrototype(b,i);b.prototype.setValue=function(n){var i,f,e,r,u;if(this.oldValue!=n){if(this.oldValue=n,n==null||n==""){this.ctrl.val("");return}i=new Date(n);this.displayType!=t.DisplayType.Date&&i.setMinutes(-i.getTimezoneOffset()+i.getMinutes());n=i.toISOString();f=n.substring(0,n.length-1);e=n.indexOf("T");this.displayType==t.DisplayType.DateTime?this.ctrl.val(f):this.displayType==t.DisplayType.Date?this.ctrl.val(f.substring(0,e)):(r=i.getUTCHours(),u=i.getUTCMinutes(),this.ctrl.val((r<10?"0"+r:r)+":"+(u<10?"0"+u:u)))}};b.prototype.getValue=function(){var i=this.ctrl.val(),n;if(i==null||i=="")return null;if(n=null,this.displayType==t.DisplayType.Time){n=new Date(0);var r=i.match(/(\d+)\:(\d+)/),u=parseInt(r[1],10),f=parseInt(r[2],10);n.setHours(u);n.setMinutes(f)}else n=new Date(i+"Z");try{return this.displayType==t.DisplayType.DateTime&&n.setMinutes(n.getTimezoneOffset()+n.getMinutes()),n.toISOString().replace(".000Z","Z")}catch(e){return console.log(i),new Date}};b.prototype.getDisplay=function(){return this.getValue()};t.Utility.inheritPrototype(o,i);o.prototype.setValue=function(n,i,r){var s,e,o,h,f,u;if(this.oldValue!=n||i){if(this.settingValue=!0,this.oldValue=n,this.value=n,n==null){this.lastDisplay="";this.ctrl.val("");this.settingValue=!1;r&&(u={newValue:n,propertyName:this.getName()},this.fireValueChanged(u),u=null);return}if(this.lookup==null){this.ctrl.val(n.toString());this.lastDisplay=n.toString();this.settingValue=!1;return}if(this.displayType!==t.DisplayType.MultiKey)this.lastDisplay=this.lookup.getDisplay(n);else{for(s=n.toString().split(","),e="",o=0,h=s.length;o<h;o++){if(f=s[o],isNaN(f)||(f=Number(f)),e.length==0){e+=this.lookup.getDisplay(f);continue}e+=", "+this.lookup.getDisplay(f)}this.lastDisplay=e}this.lastDisplay.equals("<-1>")&&(this.lastDisplay="",this.oldValue=null,this.value=null);this.value=n;this.ctrl.val(t.Utility.decodeText(this.lastDisplay));this.settingValue=!1;r&&((n==-1||n=="")&&(n=null),u={newValue:n,propertyName:this.getName()},this.fireValueChanged(u),u=null)}};o.prototype.getValue=function(){return this.value};o.prototype.getMultipleIds=function(){return this.infoMultipleIds};o.prototype.getDisplay=function(){return this.lookup==null?this.value:this.lookup.getDisplay(this.value)};o.prototype.setCustomInfo=function(n){n!=null&&(this.custInfoWin=n)};t.Utility.inheritPrototype(tt,i);tt.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,this.ctrl.val(n))};tt.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(s,i);s.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,n=this.format.GetFormatedValue(n),this.ctrl.val(n))};s.prototype.getValue=function(){var n=this.$super.getValue.call(this);return isNaN(n)||n===null?null:Number(n)};s.prototype.getDisplay=function(){return this.ctrl.val()};s.prototype.setMaxValue=function(t){n.isNumeric(t)&&this.ctrl.attr("max",t)};s.prototype.setMinValue=function(t){n.isNumeric(t)&&this.ctrl.attr("min",t)};t.Utility.inheritPrototype(k,i);k.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,n=Number(this.format.GetFormatedValue(n)),this.ctrl.val(n))};k.prototype.getValue=function(){var n=this.$super.getValue.call(this);return n===null?null:(this.editingGrid&&(n=this.format.GetFormatedValue(n)),n)};k.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(d,i);d.prototype.setValue=function(n){if(this.oldValue!=n){if(this.settingValue=!0,this.oldValue=n,this.value=n,n==null){this.lastDisplay="";this.ctrl.val("");this.settingValue=!1;return}if(this.lookup==null){this.ctrl.val(n.toString());this.lastDisplay=n.toString();this.settingValue=!1;return}this.lastDisplay=this.lookup.getDisplay(n);this.lastDisplay.equals("<-1>")&&(this.lastDisplay="",this.oldValue=null,this.value=null);this.value=n;this.ctrl.val(t.Utility.decodeText(this.lastDisplay));this.settingValue=!0}};d.prototype.getValue=function(){return this.value};d.prototype.getDisplay=function(){return this.lookup==null?this.value:this.lookup.getDisplay(this.value)};t.Utility.inheritPrototype(h,i);h.prototype.getOnlyWarehouseID=function(){var r=t.Env.getCtx(),u=r.getContext(this.windowNum,"0|AD_Table_ID",!0),n,i;if("572"==u)return 0;n=r.getContext(this.windowNum,"M_Warehouse_ID",!0);i=0;try{n!=null&&n.length>0&&(i=Number(n))}catch(f){}return i};h.prototype.getOnlyProductID=function(){var r=t.Env.getCtx(),u=r.getContext(this.windowNum,"0|AD_Table_ID",!0),n,i;if("572"==u)return 0;n=r.getContext(this.windowNum,"M_Product_ID",!0);i=0;try{n!=null&&n.length>0&&(i=Number(n))}catch(f){}return i};h.prototype.showLocatorForm=function(n,i){var u=0,r;this.value!=null&&(u=Number(this.value));this.lookup.setOnlyWarehouseID(n);this.lookup.setOnlyProductID(i);var f="Y".equals(t.context.getWindowContext(this.windowNum,"IsReturnTrx")),e=t.Env.getCtx().isSOTrx(this.windowNum),o=(e&&!f||!e&&f)&&this.columnName=="M_Locator_ID";this.lookup.setOnlyOutgoing(o);this.lookup.refresh();self=this;r=new t.LocatorForm(this.columnName,this.lookup,u,this.mandatory,n,this.windowNum);r.load();r.showDialog();r.onClose=function(n){if(self.oldValue!=n){self.setValue(n);var t={newValue:n,propertyName:self.columnName};self.fireValueChanged(t);t=null}}};h.prototype.setValue=function(n){if(this.oldValue!=n){if(this.settingValue=!0,this.oldValue=n,this.value=n,n==null){this.lastDisplay="";this.ctrl.val("");this.settingValue=!1;return}if(this.lookup==null){this.ctrl.val(n.toString());this.lastDisplay=n.toString();this.settingValue=!1;return}this.lastDisplay=this.lookup.getDisplay(n);this.lastDisplay.equals("<-1>")&&(this.lastDisplay="",this.oldValue=null,this.value=null);this.value=n;this.ctrl.val(this.lastDisplay);this.settingValue=!0}};h.prototype.getValue=function(){return this.value};h.prototype.getDisplay=function(){return this.lookup==null?this.value:this.lookup.getDisplay(this.value)};t.Utility.inheritPrototype(u,i);u.prototype.setValue=function(n){(n==null||0===n)&&(this.ctrl.text(""),this.value=n);this.value=n;this.ctrl.val(this.lookup.getDisplay(n))};u.prototype.setField=function(n){n!=null&&(this.windowNo=n.getWindowNo(),this.AD_Column_ID=n.getAD_Column_ID());this.mField=n};u.prototype.getValue=function(){return this.value};u.prototype.genSetInstanceIDs=function(){return this.setInstanceIDs};u.prototype.getDisplay=function(){return this.ctrl.val()};u.prototype.getCanSaveRecord=function(){return this.canSaveRecord};u.prototype.setCanSaveRecord=function(n){return this.canSaveRecord=n};t.Utility.inheritPrototype(g,i);g.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,this.value=n,this.ctrl.val(this.lookup.getDisplay(n)))};g.prototype.getValue=function(){return this.value};g.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(l,i);l.prototype.setValue=function(i){if(this.oldValue!=i){if(this.oldValue=i,this.value=i,i==null){this.setIcon(null);this.value=0;return}var u=i,r=this;n.ajax({url:t.Application.contextUrl+"VImageForm/GetImageAsByte",dataType:"json",data:{ad_image_id:u},success:function(n){var t=n.result;r.setIcon(t);r.ctrl.val(u);r=null}})}};l.prototype.setReadOnly=function(n){this.isReadOnly=n;this.isLink?this.ctrl.css("opacity",n?.6:1):this.ctrl.prop("disabled",n?!0:!1);this.setBackground(!1)};l.prototype.getValue=function(){return this.value};l.prototype.getDisplay=function(){return this.value};t.Utility.inheritPrototype(a,i);a.prototype.setValue=function(n){var t,i;this.oldValue!=n&&(this.oldValue=n,n==null?(this.setText("-"),this.value=n,this.ctrl.val(n)):(t="?",n.length>0?(i=n,t="#"+i.length):t=n.GetType().FullName,this.setText(t!=null?t:""),this.value=n,this.ctrl.val(n)))};a.prototype.setReadOnly=function(n){this.isReadOnly=n;this.ctrl.prop("disabled",n?!0:!1);this.setBackground(!1)};a.prototype.getValue=function(){return this.value};a.prototype.getDisplay=function(){return this.value};t.Utility.inheritPrototype(it,i);it.prototype.setValue=function(n){if(this.oldValue!=n){if(this.oldValue=n,this.value=n,n==null){this.lastDisplay="";this.ctrl.val("");return}this.value=n;this.ctrl.val(n);this.ctrl.val(n)}};it.prototype.getValue=function(){return this.value};it.prototype.getDisplay=function(){return this.ctrl.val()};t.Utility.inheritPrototype(v,i);v.prototype.setValue=function(n){this.oldValue!=n&&(this.oldValue=n,this.value=n,this.ctrl.val(n))};v.prototype.setReadOnly=function(n){this.isReadOnly=n;this.ctrl.prop("disabled",n?!0:!1);this.setBackground(!1)};v.prototype.getValue=function(){return this.value};v.prototype.getDisplay=function(){return this.value};t.Utility.inheritPrototype(nt,i);nt.prototype.setValue=function(n){if(this.oldValue!=n){if(this.settingValue=!0,this.oldValue=n,this.value=n,n==null){this.lastDisplay="";this.ctrl.val("");this.settingValue=!1;return}if(this.lookup==null){this.ctrl.val(n.toString());this.lastDisplay=n.toString();this.settingValue=!1;return}this.lastDisplay=this.lookup.getDisplay(n);this.lastDisplay&&this.lastDisplay.equals("<-1>")&&(this.lastDisplay="",this.oldValue=null,this.value=null);this.value=this.lastDisplay&&this.lastDisplay.indexOf("<")>-1?this.lastDisplay:n;this.lastDisplay&&this.ctrl.val(t.Utility.decodeText(this.lastDisplay));this.settingValue=!0}};nt.prototype.getValue=function(){return this.value};nt.prototype.getDisplay=function(){return this.lookup==null?this.value:this.lookup.getDisplay(this.value)};t.Utility.inheritPrototype(y,i);y.prototype.setValue=function(n,i,r){if(this.oldValue!=n){if(this.settingValue=!0,this.oldValue=n,this.value=n,n==null){if(this.lastDisplay="",this.ctrl.val(""),this.settingValue=!1,r){var u={newValue:n,propertyName:this.getName()};this.fireValueChanged(u);u=null}return}if(this.lookup==null){this.ctrl.val(n.toString());this.lastDisplay=n.toString();this.settingValue=!1;return}this.lastDisplay=this.lookup.getDisplay(n);this.lastDisplay.equals("<-1>")&&(this.lastDisplay="",this.oldValue=null,this.value=null);this.value=this.lastDisplay.indexOf("<")>-1?this.lastDisplay:n;this.ctrl.val(t.Utility.decodeText(this.lastDisplay));this.settingValue=!0}};y.prototype.getValue=function(){return this.value};y.prototype.getDisplay=function(){return this.lookup==null?this.value:this.lookup.getDisplay(this.value)};t.Controls.IControl=i;t.Controls.VTextBox=p;t.Controls.VLabel=et;t.Controls.VButton=r;t.Controls.VCheckBox=w;t.Controls.VComboBox=c;t.Controls.VTextBoxButton=o;t.Controls.VTextArea=tt;t.Controls.VAmountTextBox=s;t.Controls.VNumTextBox=k;t.Controls.VLocation=d;t.Controls.VDate=b;t.Controls.VLocator=h;t.Controls.VAccount=g;t.Controls.VPAttribute=u;t.Controls.VImage=l;t.Controls.VBinary=a;t.Controls.VFile=v;t.Controls.VAmtDimension=nt;t.Controls.VProductContainer=y}(jQuery,VIS),function(n,t){function h(t,i,r){var u=null;return n.ajax({url:s,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(t)}).done(function(n){u=n;r&&r(n)}),u}function i(n){this.log=t.Logging.VLogger.getVLogger("AccessSqlParser");this.sqlOriginal;this.sql=[];this.tableInfo=[];this.setSql(n)}function u(n,t){this.tableName=n;this.synonym=t}function c(){function e(t){if(t==null)return!1;var i=t.getTableName();return r.push(i),n.push(t),!0}function o(t){var r,i,u;if(t==null)return!1;for(r=!1,i=n.lenght-1;i>=0;i--)u=n[i],t===u&&(n.splice(1,1),r=!0);return r}function u(){var r,u,e,t;if(arguments.length==2)return f(arguments[0],arguments[1]);if(arguments.length==1)return f(arguments[0]);for(r=0,u=0,e=0;e<n.length;e++)t=n.get(e),t!=null&&t.lenght>0&&(i.info(t.toString()),u+=t.reset(),r++);return r>0&&i.info("#"+r+" ("+u+")"),u}function f(t,f){var e,o,s,c,h;if(t==null||t.length()==0)return u();if(f||(f=0),r.indexOf(t)<0)return 0;for(t.equals("AD_Role"),e=0,o=0,s=0;s<n.length;s++)(c=n[s],c!=null)&&(h=c.reset(t,f),h>=0&&e++,h>0&&(o+=h));return e>0&&i.fine(t+": #"+e+" ("+o+")"),o}var n=[],r=[],i=t.Logging.VLogger.getVLogger("CacheMgt");return{register:e,reset:u,unregister:o}}function r(n,i,r,u,f,e){this.m_cacheK=[];this.m_cacheV=[];this.m_tableName=n;this.m_resetAll=u?u:!1;this.m_tableName2=e;this.setExpireMinutes(r);t.CacheMgt.register(this)}var e=/(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})/,l=t.Logging.Level,o=t.Application.contextUrl,s=o+"JsonData/JDataSetWithCode",f=function(n,i,r,u){var o=r?!0:!1,e={sql:n,page:1,pageSize:0},f;return i&&(e.param=i),f=null,h(e,o,function(n){f=(new t.DB.DataReader).toJson(n);r&&r(f)},u),f};t.Evaluator={parseDepends:function(n,t){var i,r,u;if(t!=null&&t.length!=0)for(i=t;i.indexOf("@")!=-1;)(r=i.indexOf("@"),i=i.substring(r+1),r=i.indexOf("@"),r!=-1)&&(u=i.substring(0,r),i=i.substring(r+1),n.indexOf(u)<0&&(n[n.length]=u))},evaluateLogic:function(n,i){var u=new t.StringTokenizer(i.trim(),"&|",!0),o=u.countTokens(),r,f,e;if(o/2-(o+1)/2==0)return!1;for(r=this.evaluateLogicDouble(n,u.nextToken());u.hasMoreTokens();)if(f=u.nextToken().trim(),e=this.evaluateLogicDouble(n,u.nextToken()),f.equals("&"))r=r&&e;else if(f.equals("|"))r=r||e;else return!1;return r},evaluateLogicDouble:function(n,i){var o=new t.StringTokenizer(i.trim(),"!=^><",!0),e,u;if(o.countTokens()!==3)return!1;e=o.nextToken().trim();u=e.trim();e.indexOf("@")!=-1&&(e=e.replaceAll("@"," ").trim(),u=n.getValueAsString(e),u==null&&(u=""));u=u.replaceAll("'"," ").replaceAll('"'," ").trim();var s=o.nextToken(),f=o.nextToken(),r=f.trim();return f.indexOf("@")!=-1&&f[0]=="@"&&f[f.length-1]=="@"&&(f=f.replaceAll("@"," ").trim(),r=n.getValueAsString(f),r==null&&(r="")),r=r.replaceAll("'"," ").replaceAll('"'," ").trim(),e.indexOf("_ID")!=-1&&u.length==0&&(u="0"),f.indexOf("_ID")!=-1&&r.length==0&&(r="0"),u=="0"&&(r==""||r=="null")&&(r="0"),u.length==0&&r=="null"&&(r=""),this.evaluateLogicTuple(u,s,r)},evaluateLogicTuple:function(n,t,i){if(n==null||t==null||i==null)return!1;var r=0,u=0;try{n.startsWith("'")||isNaN(n)||(r=Number(n));i.startsWith("'")||isNaN(i)||(u=Number(i))}catch(f){r=0;u=0}return t.equals("=")?r!=0&&u!=0?r.compareTo(u)==0:n.compareTo(i)==0:t.equals("<")?r!=0&&u!=0?r.compareTo(u)<0:n.compareTo(i)<0:t.equals(">")?r!=0&&u!=0?r.compareTo(u)>0:n.compareTo(i)>0:r!=0&&u!=0?r.compareTo(u)!=0:n.compareTo(i)!=0},getVariables:function(n){for(var u=[],f=new StringBuilder,r=new t.StringTokenizer(n,"@"),i;r.hasMoreTokens();)f.append(r.nextToken()),r.hasMoreTokens()&&(f.append("?"),i=r.nextToken(),i.indexOf("|")!=-1&&(i=i.substring(0,i.indexOf("|"))),u.indexOf(i)===-1&&u.push(i));return u},replaceVariables:function(n,t,i){var u=n,h=[],e,f,r,o,s;for(this.parseDepends(h,n),e=0;e<h.length;e++){if(f=h[e],f.indexOf("\n")!=-1)break;if(r=null,i!=null&&(r=i.get(f)),r==null&&(r=t.getContext(f)),r!=null&&r.length>0){o=null;try{o=new Number(r)}catch(c){}if(o!=null)u=u.replaceAll("@"+f+"@",o.toString());else{s=null;try{s=new Double(r)}catch(c){}u=s!=null?u.replaceAll("@"+f+"@",s.toString()):u.replaceAll("@"+f+"@",r.replaceAll("'","''"))}}else u=u.replaceAll("@"+f+"@","NULL")}return u}};t.Query=function(n,t){this.tableName=n?n:"";this.list=[];this.recordCount=999999;this.newRecord=!1;this.isORcondition=!1;t&&t==!0&&(this.isORcondition=!0)};t.Query.prototype.addRestriction=function(){var n=null,i;if(arguments.length==5)n=new t.QueryRestriction(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]),this.isORcondition&&(n.andCondition=!1),arguments[3].toString().startsWith("-")||this.list.push(n);else if(arguments.length==3)n=new t.QueryRestriction(arguments[0],arguments[1],arguments[2],null,null),this.isORcondition&&(n.andCondition=!1),this.list.push(n);else if(arguments.length==1)if(i=arguments[0],typeof i=="string"){if(i==null||i.trim().length==0)return;n=new t.QueryRestriction(i);this.isORcondition&&(n.andCondition=!1);this.list.push(n);this.newRecord=i.equals(t.Query.NEWRECORD)}else n=i,this.isORcondition&&(n.andCondition=!1),this.list.push(n);else throw new Error("invalid arguments Addrestriction");n=null};t.Query.prototype.setTableName=function(n){this.tableName=n};t.Query.prototype.setRecordCount=function(n){this.recordCount=n};t.Query.prototype.setColumnName=function(n,t){n<0||n>=this.list.length||(this.list[n].columnName=t)};t.Query.prototype.getCode=function(n){if(n<0||n>=this.list.length)return null;this.list[n].code};t.Query.prototype.getInfo=function(){var i="",n=null,t;for(this.tableName!=null&&(i+=this.tableName+": "),t=0;t<this.list.length;t++)n=this.list[t],t!=0&&(i+=n.andCondition?" AND ":" OR "),i+=n.getInfoName()+n.getInfoOperator()+n.getInfoDisplayAll();return i};t.Query.prototype.getIsActive=function(){return this.list.length!=0};t.Query.prototype.getIsNewRecordQuery=function(){return this.newRecord};t.Query.prototype.getRecordCount=function(){return this.recordCount};t.Query.prototype.getWhereClause=function(){var t=arguments.length==1?arguments[0]:!1,n="",i=null,u,r;if(typeof t=="boolean"||isNaN(t)){for(u=t,u&&(this.tableName==null||this.tableName.length==0)&&(u=!1),r=0;r<this.list.length;r++)i=this.list[r],r!=0&&(n+=i.andCondition?" AND ":" OR "),n+=u?i.getSQL(this.tableName):i.getSQL(null);return n.length>0?" ( "+n+" ) ":n}return t>=0&&t<this.list.Count&&(i=this.list[t],n+=i.GetSQL(null)),n};t.Query.prototype.getRestrictionCount=function(){return this.list.length};t.Query.prototype.getRestrictions=function(){return this.list};t.Query.prototype.copyRestrictions=function(n){this.list=this.list.concat(n)};t.Query.prototype.addRangeRestriction=function(){var n=null;n=arguments.length==3?new t.QueryRestriction(arguments[0],arguments[1],arguments[2],null,null,null):new t.QueryRestriction(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);this.list.push(n)};t.Query.prototype.getColumnName=function(n){return n<0||n>=this.list.length?null:this.list[n].columnName};t.Query.prototype.getTableName=function(){return this.tableName};t.Query.prototype.getOperator=function(n){return n<0||n>=this.list.length?null:this.list[n].operator};t.Query.prototype.getCodeTo=function(n){return n<0||n>=this.list.Count?null:this.list[n].code_to};t.Query.prototype.getInfoDisplay=function(n){return n<0||n>=this.list.length?null:this.list[n].infoDisplay};t.Query.prototype.getInfoDisplay_to=function(n){return n<0||n>=this.list.length?null:this.list[n].infoDisplay_to};t.Query.prototype.getInfoName=function(n){return n<0||n>=this.list.length?null:this.list[n].infoName};t.Query.prototype.getInfoOperator=function(n){return n<0||n>=this.list.length?null:this.list[n].getInfoOperator()};t.Query.prototype.getInfoDisplayAll=function(n){return n<0||n>=_list.Count?null:this.list[n].getInfoDisplayAll()};t.Query.prototype.deepCopy=function(){for(var i=new t.Query(this.tableName),n=0;n<this.list.length;n++)i.addRestriction(this.list[n]);return i};t.Query.prototype.getNoRecordQuery=function(n,i){var r=new t.Query(n);return i?r.AddRestriction(t.Query.NEWRECORD):r.AddRestriction("1=2"),r.setRecordCount(0),r};t.Query.prototype.NEWRECORD="2=3";t.Query.prototype.EQUAL="=";t.Query.prototype.EQUAL_INDEX=0;t.Query.prototype.NOT_EQUAL="!=";t.Query.prototype.LIKE=" LIKE ";t.Query.prototype.NOT_LIKE=" NOT LIKE ";t.Query.prototype.GREATER=">";t.Query.prototype.GREATER_EQUAL=">=";t.Query.prototype.LESS="<";t.Query.prototype.LESS_EQUAL="<=";t.Query.prototype.BETWEEN=" BETWEEN ";t.Query.prototype.BETWEEN_INDEX=8;t.Query.prototype.IN=" IN ";t.Query.prototype.NOT_IN=" NOT IN ";t.Query.prototype.OPERATORS={"=":" = ","!=":" != "," LIKE ":" ~ "," NOT LIKE ":" !~ ",">":" > ",">=":" >= ","<":" < ","<=":" <= "," BETWEEN ":" >-< "};t.Query.prototype.CVOPERATORS={"=":" = ","!":" != ",">":" > ","<":" < "};t.Query.prototype.OPERATORS_ID={"=":" = ","!=":" != "};t.Query.prototype.CVOPERATORS_ID={"=":" = ","!":" != "};t.Query.prototype.OPERATORS_YN={"=":" = "};t.Query.prototype.OPERATORS_DATE_DYNAMIC={"0":"Today","1":"lastxDays","2":"lastxMonth","3":"lastxYears"};t.Query.prototype.OPERATORS_DYNAMIC_ID={"@#AD_User_ID@":"LoginUser"};t.Query.prototype.getEqualQuery=function(n,i){var r=new t.Query;return r.addRestriction(n,t.Query.prototype.EQUAL,i),r.setRecordCount(1),r};t.QueryRestriction=function(){this.directWhereClause=null;this.columnName;this.infoName;this.operator;this.code;this.infoDisplay;this.code_to;this.infoDisplay_to;this.andCondition=!0;switch(arguments.length){case 5:this.fnArgu5(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]);break;case 6:this.fnArgu6(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5]);break;case 9:this.fnArgu9(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4],arguments[5],arguments[6],arguments[7],arguments[8]);break;case 1:this.fnArgu1(arguments[0]);break;case 0:break;default:throw new Error("Invalid arguments");}};t.QueryRestriction.prototype.fnArgu5=function(n,t,i,r,u){var o=n.trim(),s,f,e;s=r!=null?r:o;Operator=t;f=i!=null&&typeof i=="Boolean"?new Boolean(i)==!0?"Y":"N":i;f!=null&&typeof f=="string"&&(f.startsWith("'")&&(f=f.substring(1)),f.endsWith("'")&&(f=f.substring(0,f.length-2)));u!=null?e=u.toString().trim():i!=null&&(e=i);this.columnName=o;this.infoName=s;this.operator=Operator;this.code=f;this.infoDisplay=e};t.QueryRestriction.prototype.fnArgu6=function(n,i,r,u,f,e){var o,s;this.fnArgu5(n,t.Query.prototype.BETWEEN,i,u,f);o=r;typeof o=="string"&&(o.startsWith("'")&&(o=o.substring(1)),o.endsWith("'")&&(o=o.substring(0,o.length-2)));e!=null?s=e.trim():o!=null&&(s=o.toString());this.code_to=o;this.infoDisplay_to=s};t.QueryRestriction.prototype.fnArgu9=function(n,t,i,r,u,f,e,o,s){this.columnName=n;this.infoName=r;this.code=t;this.code_to=i;this.infoName=r;this.infoDisplay=u;this.infoDisplay_to=f;this.operator=e;this.directWhereClause=o;this.andCondition=s};t.QueryRestriction.prototype.fnArgu1=function(n){this.directWhereClause=n};t.QueryRestriction.prototype.getInfoName=function(){return this.infoName};t.QueryRestriction.prototype.getInfoOperator=function(){return this.operator in t.Query.OPERATORS?t.Query.OPERATORS[this.operator]:this.operator};t.QueryRestriction.prototype.getInfoDisplayAll=function(){if(this.infoDisplay_to==null)return this.infoDisplay;var n=this.infoDisplay;return n+(" - "+InfoDisplay_to)};t.QueryRestriction.prototype.getSQL=function(n){var i,r,u;return this.directWhereClause!=null?this.directWhereClause:(i="",typeof this.code=="string"&&(i+=" UPPER( "),n!=null&&n.length>0?(r=this.columnName.lastIndexOf("(")+1,u=this.columnName.indexOf(")"),i+=r!=-1&&u!=-1?this.columnName.substring(0,r)+n+"."+this.columnName.substring(r,r+(u-r))+this.columnName.substring(u):n+"."+this.columnName):i+=this.columnName,typeof this.code=="string"&&(i+=" ) "),this.code==null||"NULL".equals(this.code.toString().toUpper())||"NullValue".toUpper().equals(this.code.toString().toUpper())?i+=this.operator.equals(t.Query.prototype.EQUAL)?" IS NULL ":" IS NOT NULL ":(i+=this.operator,(t.Query.prototype.IN.equals(this.operator)||t.Query.prototype.NOT_IN.equals(this.operator))&&(i+="("),this.code instanceof Date||this.code&&e.test(this.code.toString())?i+=t.DB.to_date(this.code,!1):"string"==typeof this.code?(i+=" UPPER( ",i+=t.DB.to_string(this.code.toString()),i+=" ) "):i+=this.code,t.Query.prototype.BETWEEN.equals(this.operator)?(i+=" AND ",i+=this.code_to instanceof Date||this.code_to&&e.test(this.code_to.toString())?t.DB.to_date(this.code_to,!1):typeof this.code_to=="string"?t.DB.to_string(this.code_to.toString()):this.code_to):(t.Query.prototype.IN.equals(this.operator)||t.Query.prototype.NOT_IN.equals(this.operator))&&(i+=")")),i)};i.prototype.FROM=" FROM ";i.prototype.FROM_LENGTH=i.prototype.FROM.length;i.prototype.WHERE=" WHERE ";i.prototype.ON=" ON ";i.prototype.setSql=function(n){if(n==null)throw new IllegalArgumentException("No SQL");this.sqlOriginal=n;var t=this.sqlOriginal.indexOf("\nFROM ");t!=-1&&(this.sqlOriginal=this.sqlOriginal.replace("\nFROM ",this.FROM));t=this.sqlOriginal.indexOf("\nWHERE ");t!=-1&&(this.sqlOriginal=this.sqlOriginal.replace("\nWHERE ",this.WHERE));this.parse()};i.prototype.getSql=function(){return this.sqlOriginal};i.prototype.setSql=function(n){if(n==null)throw new IllegalArgumentException("No SQL");this.sqlOriginal=n;var t=this.sqlOriginal.indexOf("\nFROM ");t!=-1&&(this.sqlOriginal=this.sqlOriginal.replaceAll("\nFROM ",this.FROM));t=this.sqlOriginal.indexOf("\nWHERE ");t!=-1&&(this.sqlOriginal=this.sqlOriginal.replaceAll("\nWHERE ",this.WHERE));this.parse()};i.prototype.getSql=function(){return this.sqlOriginal};i.prototype.parse=function(){var n,t;if(this.sqlOriginal==null||this.sqlOriginal.length==0)throw new IllegalArgumentException("No SQL");for(this.getSelectStatements(),n=0;n<this.sql.length;n++)t=this.getTableInfo(this.sql[n].trim()),this.tableInfo.push(t);return this.tableInfo.length>0};i.prototype.getSelectStatements=function(){var i=[this.sqlOriginal],n=null;try{n=this.getSubSQL(i)}catch(r){this.log.log(t.Logging.Level.SEVERE,this.sqlOriginal,r);throw new IllegalArgumentException(this.sqlOriginal);}while(i.length!=n.length){i=n;try{n=this.getSubSQL(i)}catch(r){this.log.log(t.Logging.Level.SEVERE,this.sqlOriginal,r);throw new IllegalArgumentException(n.length+": "+m_sqlOriginal);}}this.sql=n};i.prototype.getSubSQL=function(n){for(var e=[],t="",i,r,f,o,s,u=0;u<n.length;u++){for(t=n[u],i=t.indexOf("(SELECT ",7);i!=-1;){for(r=i+1,f=0;r++<t.length;)if(o=t.charAt(r),o==")")if(f==0)break;else f--;else o=="("&&f++;s=t.substring(i,r+1);e.push(s);t=t.substring(0,i+1)+"##"+t.substring(r);i=t.indexOf("(SELECT ",7)}e.push(t)}return e};i.prototype.getTableInfo=function(n){var o,f,i,e,s,h,r;if(isNaN(n)){for(o=[],n.startsWith("(")&&n.endsWith(")")&&(n=n.substring(1,n.length-1)),f=n.indexOf(this.FROM),f!=n.lastIndexOf(this.FROM)&&this.log.log(t.Logging.Level.FINE,"More than one FROM clause - "+n);f!=-1;){for(i=n.substring(f+this.FROM_LENGTH),r=i.indexOf(this.WHERE),r!=-1&&(i=i.substring(0,r)),i=i.replaceAll(" AS "," "),i=i.replaceAll(" as "," "),i=i.replaceAll(" INNER JOIN ",", "),i=i.replaceAll(" LEFT OUTER JOIN ",", "),i=i.replaceAll(" RIGHT OUTER JOIN ",", "),i=i.replaceAll(" FULL JOIN ",", "),r=i.indexOf(this.ON);r!=-1;){if(e=i.indexOf(")"),s=i.indexOf(this.ON,r+4),s!=-1&&(e=i.lastIndexOf(")",s)),e!=-1)i=i.substring(0,r)+i.substring(e+1);else{this.log.log(t.Logging.Level.SEVERE,"Could not remove ON "+i);break}r=i.indexOf(this.ON)}for(h=new t.StringTokenizer(i,",");h.hasMoreTokens();){var l=h.nextToken().trim(),c=new t.StringTokenizer(l," "),a=null;a=c.countTokens()>1?new u(c.nextToken(),c.nextToken()):new u(l);o.push(a)}n=n.substring(0,f);f=n.lastIndexOf(this.FROM)}return o}return(r=n,r<0||r>this.tableInfo.length)?null:this.tableInfo[r]};i.prototype.getSqlStatement=function(n){return n<0||n>this.sql.length?null:this.sql[n]};i.prototype.getNoSqlStatments=function(){return this.sql==null?0:this.sql.length};i.prototype.getMainSqlIndex=function(){if(this.sql==null)return-1;if(this.sql.length==1)return 0;for(var n=this.sql.length-1;n>=0;n--)if(this.sql[n].charAt(0)!="(")return n;return-1};i.prototype.getMainSql=function(){if(this.sql==null)return this.sqlOriginal;if(this.sql.length==1)return this.sql[0];for(var n=this.sql.length-1;n>=0;n--)if(this.sql[n].charAt(0)!="(")return this.sql[n];return""};i.prototype.size=function(){return this.tableInfo.length};u.prototype.getSynonym=function(){return this.synonym==null?"":this.synonym};u.prototype.getTableName=function(){return this.tableName};t.TableInfo=u;t.AccessSqlParser=i;t.ZoomTarget={log:t.Logging.VLogger.getVLogger("VIS.ZoomTarget"),getZoomAD_Window_ID:function(n,i,r,u){var c=0,l=0,v,e,b,s,y,p,o,a,h;n.equals("M_Product");v="VIS_78";o=[];o[0]=new t.DB.SqlParam("@targetTableName",n);e=null;try{b=1;e=f(v,o);e.read()&&(c=e.getInt(0),l=e.getInt(1))}catch(w){this.log.log(t.Logging.Level.SEVERE,v,w)}finally{e!=null&&e.dispose();e=null}if(l==0)return c;if(l!=0&&c!=0&&r!=null&&r.length!=0&&(s=null,y=n.indexOf("Line"),y!=-1&&(s=n.substring(0,y)),s!=null)){p="VIS_79";o=[];o[0]=new t.DB.SqlParam("@ParentTable",s);o[1]=new t.DB.SqlParam("@targetTableName",n);o[2]=new t.DB.SqlParam("@targetWhereClause",r);o[3]=new t.DB.SqlParam("@ParentTable1",s);o[4]=new t.DB.SqlParam("@ParentTable2",s);try{e=f(p,o);e.read()&&(u=e.getString(0).equals("Y"))}catch(w){this.log(t.Logging.Level.SEVERE,p.toString(),w)}finally{e!=null&&e.dispose();e=null}}return(a=0,r!=null&&r.length!=0&&(h=[],h=this.getZoomTargets(n,i,r),h!=null&&h.length>0&&(a=h[0].Key)),a!=0)?a:u?c:l},parseColumns:function(n,t){var i,e,u,f,r;if(t!=null&&t.length!=0&&(i=t,!i.contains(" EXISTS ")&&!i.contains(" IN ")&&!i.contains("(")&&!i.contains(")")))while(i.indexOf("=")!=-1)e=i.indexOf("="),u=i.substring(0,e),u=u.trim(),f=u.lastIndexOf(" ",u.length),r=u.substring(f+1),r.indexOf(".")!=-1&&(f=r.indexOf(".")+1,r=r.substring(f,r.length)),n.indexOf(r)<0&&n.push(r),i=i.substring(e+1)},evaluateWhereClause:function(n,i){var r,s,o;if(i==null||i.length==0)return!0;if(r=i,s=!0,r.contains(" EXISTS ")||r.contains(" IN ")||r.contains("(")||r.contains(")"))return!1;while(r.indexOf("=")!=-1){var u=r.indexOf("="),f=r.lastIndexOf(" ",u),e=r.substring(f+1,u),h="",c="";for(e.indexOf(".")!=-1&&(f=e.indexOf(".")+1,e=e.substring(f,e.length)),o=0;o<n.length;o++)if(e.equals(n[o].Name)){h=n[o].Value;break}if(r=r.substring(u+1),f=0,u=r.indexOf(" "),c=u==-1?r.substring(f):r.substring(f,u),!t.Evaluator.evaluateLogicTuple(h,"=",c)){s=!1;break}}return s},getZoomTargets:function(i,r,u,e){var it,s,k,p,h,a,d,o,l,y,g,ot,w;if(arguments.length==4){if(e.length!=1)return null;it=e[0];s=u.replace("?",it.toString());s=s.replace("WHERE "," ");this.log.fine("WhereClause : "+s);u=s}var b=[],c=[],v=[],nt=0,rt=0,ut="",s="",ft=!1,st=null,ht=0,ct=0,lt=0,et="VIS_80",o=null;try{for(o=f(et);o.read();)k=o.getInt(0),p=o.getString(1),p.equals("Work Center")?ht=k:p.equals("Work Center Costs")?(ct=k,st=p):p.equals("Production Resource")&&(lt=k)}catch(tt){this.log.log(t.Logging.Level.SEVERE,et,tt)}finally{o!=null&&o.dispose();o=null}try{for(o=null,n.ajax({type:"Get",async:!1,url:t.Application.contextUrl+"Form/GetZoomTargetClass",data:{targetTableName:i,curWindow_ID:r},success:function(n){o=(new t.DB.DataReader).toJson(n)}});o.read();){if(ft=!0,nt=o.getInt(6),ut=o.getString(7),rt=o.getInt(4),s=o.getString(2),rt==0)break;c.push({AD_Window_ID:o.getInt(0),windowName:o.getString(1),whereClause:s})}}catch(tt){this.log.log(t.Logging.Level.SEVERE,sql,tt)}finally{o!=null&&o.dispose()}if(h="",!ft||c.length<=1&&nt==0)return b;if(c.length<=1)h="SELECT count(*) FROM "+i+" WHERE "+u,s!=null&&s.length!=0&&(h+=" AND "+t.Evaluator.replaceVariables(s,t.Env.getCtx(),null));else if(c.length>1){for(a=0;a<c.length;a++)this.parseColumns(v,c[a].whereClause);for(h="SELECT DISTINCT ",a=0;a<v.length;a++)a!=0&&(h+=","),h+=v[a];v.length==0&&(h+="count(*) ");h+=" FROM "+i+" WHERE "+u}this.log.fine(h);d=[];try{for(o=null,n.ajax({type:"Get",async:!1,url:t.Application.contextUrl+"Form/GetZoomWhereClause",data:{sql:t.secureEngine.encrypt(h)},success:function(n){o=(new t.DB.DataReader).toJson(n)}});o.read();)if(v.length>0){for(d.length=0,l=0;l<v.length;l++)y=v[l],g="",g=typeof o.get(y)!="string"?o.get(y).toString():"'"+o.get(y).toString()+"'",this.log.fine(y+" = "+g),d.push({Value:g,Name:y});for(l=0;l<c.length;l++)if(this.evaluateWhereClause(d,c[l].whereClause)){w={Key:c[l].AD_Window_ID,Value:c[l].windowName};b.push(w);break}}else ot=o.getInt(0),ot!=0&&(w={Key:nt,Value:ut},b.push(w))}catch(tt){this.log.log(t.Logging.Level.SEVERE,h,tt)}finally{o!=null&&o.dispose()}return b}};r.prototype.setExpireMinutes=function(n){if(n>0){this.m_expire=n;var i=6e4*n;this.m_timeExp=t.Env.currentTimeMillis()+i}else this.m_expire=0,this.m_timeExp=0};r.prototype.expire=function(){this.m_expire!=0&&this.m_timeExp<t.Env.currentTimeMillis()&&this.reset()};r.prototype.reset=function(){var n,i;return arguments.length==2?this.reset2(arguments[0],arguments[1]):arguments.length==1?this.reset2(arguments[0]):(n=this.m_cacheK.length,this.clear(),this.m_expire!=0&&(i=6e4*this.m_expire,this.m_timeExp=t.Env.currentTimeMillis()+i),n)};r.prototype.reset2=function(n,t){if(this.tableName==null)return-1;var i=n===this.m_tableName||n===this.m_tableName2;return i||this.m_tableName2.startsWith(n)?t==0||this.m_resetAll?reset():this.remove(t):-1};r.prototype.remove=function(n){var t=this.m_cacheK.indexOf(n);return t>-1?(this.m_cacheK.splice(t,1),this.m_cacheV.splice(t,1),1):0};r.prototype.get=function(n){this.expire();var t=this.m_cacheK.indexOf(n);return t>-1?this.m_cacheV[t]:null};r.prototype.contains=function(n){var t=this.m_cacheK.indexOf(n);return t>-1?!0:!1};r.prototype.add=function(t,i){var u,r;this.expire();(typeof i=="function"||n.isFunction(i))&&(u="");r=this.m_cacheK.indexOf(t);r<0?(this.m_cacheK.push(t),this.m_cacheV.push(i)):this.m_cacheV[r]=i};r.prototype.clear=function(){this.m_cacheK.length=0;this.m_cacheV.length=0};r.prototype.size=function(){return this.expire(),this.m_cacheV.length};r.prototype.getTableName=function(){return this.m_tableName};t.CacheMgt=c();t.CCache=r}(jQuery,VIS),function(n){var t=function(n,t,i,r){this.tokenizers=t.splice?t:t.split("");r&&(this.doBuild=r);this.src=n;this.ended=!1;this.tokens=[];this.returnDelim=i;this.curIndex=0;this.parse()};t.prototype={parse:function(){do this.next();while(!this.ended);return this.tokens},build:function(n,t){if(n){if(!this.returnDelim&&this.tokenizers.indexOf(n)>-1)return;this.tokens.push(this.doBuild?this.doBuild(n,t,this.tkn):n)}},next:function(){var n=this,t;n.findMin();t=n.src.slice(0,n.min);n.build(t,!1);n.src=n.src.slice(n.min).replace(n.tkn,function(t){return n.build(t,!0),""});n.src||(n.ended=!0)},findMin:function(){var n=this,r=0,t,i;for(n.min=-1,n.tkn="";(t=n.tokenizers[r++])!==undefined;)i=n.src[t.test?"search":"indexOf"](t),i!=-1&&(n.min==-1||i<n.min)&&(n.tkn=t,n.min=i);n.min==-1&&(n.min=n.src.length)},countTokens:function(){return this.tokens.length},nextToken:function(){return this.hasMoreTokens()?this.tokens[this.curIndex++]:null},hasMoreTokens:function(){return this.curIndex<this.tokens.length?!0:!1},reset:function(){this.curIndex=-1}};n.StringTokenizer=t}(VIS),function(n){function u(){function ot(){return it}function st(){function i(i){if(i.target.nodeName==="LABEL"){if(Date.now()-t<300){i.preventDefault();i.stopPropagation();t=Date.now();return}t=Date.now()}if(i.target.nodeName==="A"){var r=$(i.target);if(r.data("isfavbtn")=="yes"){n.FavouriteHelper.showOverlay(r);return}l(r.data("action"),r.data("actionid"));return}}a.on(n.Events.onTouchStartOrClick,function(n){n.preventDefault();v()});var t=Date.now();k.on("click",function(n){i(n)});k.on("keyDown",function(n){n.which==13&&i(n)});h.on(n.Events.onClick,function(n){n.preventDefault();var t=null;n.target.nodeName==="LI"?t=$(n.target):n.target.parentNode.nodeName==="LI"&&(t=$(n.target.parentNode));t&&(p(t[0].id),y(t));t=null});b.on("click",function(t){n.MRole.getIsDisableMenu()||(t.preventDefault(),window.setTimeout(function(){r.focus();$("#vis_divTree").on("focus","li",function(n){var t=$(n.target);$(t).off("keydown");$(t).on("keydown",function(n){n.key=="Enter"&&(t.siblings("label").length>0&&$(t.siblings("label")).trigger("click"),t.siblings("a").length>0&&$(t.siblings("label")).trigger("a"))});$(t.siblings("label")).css("border","1px solid #1aa0ed")});$("#vis_divTree").on("focusout","li",function(n){var t=$(n.target);$(t.siblings("label")).css("border","1px solid white")})},2),lt())});ut.on("click",function(n){n.preventDefault();v()});nt&&r.bind("input",function(){vt(r.val(),this.list)});$(window).resize(et);window.onbeforeunload=function(){$.ajax({url:n.Application.contextUrl+"Account/LogOffHandler",type:"POST"})};ft(1)}function ft(t){window.setTimeout(function(){$.ajax({url:n.Application.contextUrl+"Account/Refresh",complete:function(){ft(180)}})},1e3*t)}function ht(){n.Application.contextFullUrl.toLower().indexOf("softwareonthecloud.com")>-1?$.ajax({url:n.Application.contextUrl+"home/GetSubscriptionDaysLeft/",success:function(t){var i=JSON.parse(t);i&&(i=="True"||i==""?c.css("display","none"):i>1?c.text(n.Msg.getMsg("VIS_TrialPeriod")+": "+i+" "+n.Msg.getMsg("VIS_TrialDaysLeft")):i==1&&c.text(n.Msg.getMsg("VIS_TrialPeriod")+": "+i+" "+n.Msg.getMsg("VIS_TrialDayLeft")))},error:function(){c.css("display","none")}}):c.css("display","none")}function ct(){u&&u.id&&u.action&&(l(u.action,u.id),r.val(""));u=null}function v(){i.closePopup();rt.hide("fast");a.fadeOut();r.val("");r.blur()}function lt(){a.fadeIn();rt.show("fast")}function et(){var t=0;t=(n.Application.isMobile||n.Application.isIOS)&&document.documentElement?document.documentElement.clientHeight:window.innerHeight;tt.css("height",t-22);n.Env.setScreenHeight(t-64);n.viewManager&&n.viewManager.sizeChanged()}function l(t,i){n.viewManager.startAction(t,i);v()}function y(n){g&&g.css("background-color","");g=n.css("background-color","#D7E3E7");n=null}function at(n){var t=n.data("wid");y(h.find("LI#"+t))}function p(i){s?s.hide():it.children("div").hide();o[i]&&(s=o[i],s.css({opacity:0}),s.show().animate({opacity:1},500,"linear",function(){n.viewManager.resize(i)}));t.indexOf(i)!=-1&&t.splice(t.indexOf(i),1);t.push(i);v()}function vt(n,t){var i,u;if(n!==""&&!(n.length<1))for(i=0;i<t.options.length;i++)if(t.options[i].value===n){u=$(t.options[i]);l(u.data("action"),u.data("actionid"));r.val("");break}}function yt(){gt();i.init(k,$("#vis_filterMenu"));f.init($("#vis_home_ca"),$("#vis_userName"));pt();historyMgr.restoreHistory();ii();window.addEventListener("DOMContentLoaded",e,!1)}function pt(){(!n.MRole.getIsDisableMenu()||n.MRole.getIsDisableMenu()&&n.MRole.getHomePage()==0)&&wt();n.MRole.getIsDisableMenu()&&($(".vis-topMenu").hide(),$(".vis-menuHeaderLogo").show());var t=n.MRole.getHomePage();t&&parseInt(t)>0&&l("X",t)}function wt(){$("#vis_lhome").show();o.vis_lhome=w;s=w.show();n.HomeMgr.initHome(w)}function bt(n,i){return o[n]=i,t.push(n),p(n),i}function kt(n){var r,i;return h.find("LI#"+n).remove(),r=o[n],o[n]=null,delete o[n],t.pop(),r=null,i="",i=t.length>0?t[t.length-1]:"vis_lhome",p(i),y(h.find("LI#"+i)),!0}function dt(n,t,i){var r=$("<li id="+n+"><img src= "+t+" /> <a >"+i+"<\/a><\/li>");h.append(r);y(r);r=null}function gt(){var n,i,t=[];nt||(i=r.attr("list"),n=$("#"+i),n.length>0&&(t=[],n.find("option").each(function(){t.push({label:this.value,value:this.value,action:$(this).data("action"),id:$(this).data("actionid")})}),r.autocomplete({source:t,open:function(){window.setTimeout(function(){$(".ui-autocomplete").css("z-index",1e3);var n=window.innerHeight*60/100;$(".ui-autocomplete").css("max-height",n)})},select:function(n,t){u=t.item},close:function(){ct()}})),n.remove())}function ni(){b.trigger("click")}function ti(){ut.trigger("click")}function ii(){d=$('<div class="vis-nav-windowContainer"><\/div>');tt.prepend(d)}function ri(){return d}function ui(){return b}var u=null,s=null,o={},t=[],nt=!1,w=$("#vis_home"),tt=$("#vis_mainSection"),it=$("#vis_mainConatiner"),h=$("#vis_taskbar"),b=$("#vis_appMenu"),rt=$("#vis_mainMenu"),ut=$("#vis_closeMenu"),c=$("#vis_cloud_daysleft"),r=$("#vis_menuSearch"),k=$("#vis_divTree"),a=$("#vis_menuOverlay"),d=null,g=null;return et(),st(),ht(),{startMenuAction:l,getMainConatiner:ot,toggleContainer:p,registerView:bt,unRegisterView:kt,addTaskBarItem:dt,start:yt,activateTaskBarItemUsingID:at,openMenu:ni,closeMenu:ti,getNavigationSection:ri,getMenuDiv:ui}}n.desktopMgr=u();var f=function(){function et(s,l){s.remove();b=l;o=s;v=s.find("#vis_changeAuthForm");f=s.find("#vis_home_role");r=s.find("#vis_home_client");i=s.find("#vis_home_org");t=s.find("#vis_home_warehouse");y=s.find("#vis_home_warehouseId");e=s.find("#vis-auth-close");u=s.find("#vis-auth-change");tt=s.find('label[for="Login2Model_Role"]');it=s.find('label[for="Login2Model_Client"]');rt=s.find('label[for="Login2Model_Org"]');ut=s.find('label[for="Login2Model_Warehouse"]');k=f.val();d=r.html();g=i.html();nt=t.html();st();$("body").append(c);$("body").append(o);h=n.Application.contextUrl;ot();y.val()=="-1"&&t.val(null)}function ot(){tt.text(Globalize.localize("Role"));it.text(Globalize.localize("Client"));rt.text(Globalize.localize("Organization"));ut.text(Globalize.localize("Warehouse"));u.val(n.Msg.getMsg("Change"));e.val(n.Msg.getMsg("Close"))}function st(){b.on("click",ct);c.on("click",ft);e.on("click",ft);f.on("change",l);r.on("change",l);i.on("change",l);t.on("change",l);v.submit(at)}function ht(){f.val(k);r.html(d);i.html(g);t.html(nt);y.val()=="-1"&&t.val(null);u.prop("disabled",!0);a(v,[]);s=!1}function ct(){c.show();o.show("slideDown");e.prop("disabled",!1);u.prop("disabled",!0)}function ft(n){return s&&ht(),c.hide(),o.hide("slideUp"),n.preventDefault(),!1}function w(n,t,i){$.ajax(t,{data:i}).success(function(t){lt(n,t.data)}).fail(function(n){alert(n)})}function l(){if(!p){s||(s=!0,u.prop("disabled",!1));combo=this;combo.id===f.attr("id")?(r.empty(),i.empty(),t.empty(),w(r,h+"Account/GetClients",{Id:combo.value})):combo.id===r.attr("id")?(i.empty(),t.empty(),w(i,h+"Account/GetOrgs",{role:f.val(),user:n.context.getAD_User_ID(),client:combo.value})):combo.id===i.attr("id")?(t.empty(),w(t,h+"Account/GetWarehouse",{id:i.val()})):combo.id===t.attr("id");var e=$("#"+combo.id+"Name"),o=this.options[this.selectedIndex].innerHTML;e.val(o)}}function lt(n,t){p=!0;n.empty();var u=Globalize.localize("SelectWarehouse");n===f?u=Globalize.localize("SelectRole"):n===r?u=Globalize.localize("SelectClient"):n===i&&(u=Globalize.localize("SelectOrg"));$("<option />",{val:"-1",text:u}).appendTo(n);$(t).each(function(){$("<option />",{val:this.Key,text:this.Name}).appendTo(n)});p=!1}function at(n){var t=$(this);a(t,[]);e.prop("disabled",!0);u.prop("disabled",!0);t.find("#vis_home_langugage").val(localStorage.getItem("vis_login_langCode"));(!t.valid||t.valid())&&$.post(t.attr("action"),t.serializeArray()).done(function(n){n=n||{};n.success?(window.location=n.redirect||location.href,window.location.href.indexOf("#")!=-1&&location.reload()):n.errors&&(a(t,n.errors),e.prop("disabled",!1),u.prop("disabled",!1))}).error(function(){a(t,["An unknown error happened."]);e.prop("disabled",!1);u.prop("disabled",!1)});n.preventDefault()}var v,f,r,i,t,b,o,e,u,k,d,g,nt,y,s=!1,p=!1,h="",tt,it,rt,ut,c=$('<div class="vis-wakeup-main" >').hide(),vt=function(n){return n.find(".validation-summary-errors, .validation-summary-valid")},a=function(n,t){var i=vt(n).removeClass("validation-summary-valid").addClass("validation-summary-errors"),r=$.map(t,function(n){return"<li>"+Globalize.localize(n)+"<\/li>"}).join("");i.find("ul").empty().append(r)};return{init:et}}(),i=function(){function h(r,o){i.html('<input type="radio" name="filter" id="vis_filter_radio_1" value="A" checked style="margin-bottom:5px;margin:1px;" /><label for="vis_filter_radio_1">'+n.Msg.getMsg("All")+'<\/label><br><input type="radio" name="filter" id="vis_filter_radio_2" value="W" style="margin-bottom:5px;margin:1px;" /><label for="vis_filter_radio_2">'+n.Msg.getMsg("Window")+'<\/label><br><input type="radio" name="filter" id="vis_filter_radio_3" value="X" style="margin-bottom:5px;margin:1px;"/><label for="vis_filter_radio_3">'+n.Msg.getMsg("Form")+'<\/label><br><input type="radio" name="filter" id="vis_filter_radio_4" value="P" style="margin-bottom:5px;margin:1px;"/><label for="vis_filter_radio_4">'+n.Msg.getMsg("Process")+'<\/label><br><input type="radio" name="filter" id="vis_filter_radio_5" value="R" style="margin-bottom:20px;margin:1px;"/><label for="vis_filter_radio_5">'+n.Msg.getMsg("Report")+'<\/label><br/><input type="button" name="filter" style="background-color: #616364;color:white" value='+n.Msg.getMsg("Filter")+"><\/input>");t=r.find(">ul");var s=[],h=null;t.find("li").each(function(){h=$(this);h.data("summary")=="N"&&s.push(h[0].outerHTML)});u=t.html();f=s.join("");s.length=0;s=null;e=o;$("body").append(i);c()}function c(){e.on("click",o);i.on("click","input[type=button]",function(n){n.stopPropagation();var t=i.find("input[type=radio]:checked").val();l(t);s()})}function l(n){n==="A"?(t.empty(),t.html(u)):(t.empty(),t.html(f),t.find("li").hide(),t.find('li > a[data-action="'+n+'"]').parent().show())}function o(){r=!r;r?i.show("slide-down"):i.hide("slide-up")}function s(){r&&o()}var t=null,u="",f="",e=null,r=!1,i=$('<div class="vis-dialog vis-filter-dialog">');return{init:h,closePopup:s}}(),r=function(){function e(n){f.text(n);$("body").append(t)}var t=$('<div class="vis-wakeup-main"><\/div><div class="vis-wakeup"><\/div><div class="vis-wakeup-content"><div style="width: 40%; float: left; height: 100%"><img src="'+n.Application.contextUrl+'Areas/VIS/Images/smiley-sleep.gif" style="padding: 10px;padding-top:15px;" class="vis-wakeup-sleep" /><img src="'+n.Application.contextUrl+'Areas/VIS/Images/smiley-awake.gif" style="padding: 10px;display:none;padding-top:15px;" class="vis-wakeup-awake" /><\/div><div style="width: 60%; height: 100%; float: right;text-align:right"><div style="height: 70%;margin: 10px; overflow: auto;" class="vis-wakeup-text"><\/div><button style="margin-right:5px;">WakeUp <\/button><\/div><\/div><\/div>'),i=t.find("button"),r=t.find(".vis-wakeup-sleep"),u=t.find(".vis-wakeup-awake"),f=t.find(".vis-wakeup-text");i.on("click",function(){i.prop("disabled",!0);r.hide();u.show();window.location.reload()});return{init:e}}(),e=function(){var n=new EventSource("JsonData/MsgForToastr?varificationToken="+$("#vis_antiForgeryToken").val());n.onmessage=function(n){var t=JSON.parse(n.data);t.message&&t.message.length>0&&toastr.success(t.message,"",{timeOut:4e3,positionClass:"toast-top-center",closeButton:!0})}},t=!1;$(document).ajaxError(function(i,u){u.status===401?t||(r.init(n.Msg.getMsg("UnAuthorized")),t=!0):u.status===999?t||(r.init(n.Msg.getMsg("WakeupText")),t=!0):console.log(u.responseText)})}(VIS),function(n){function u(){function it(n,t){v===n?rt(t):y===n?ut(t):(d===n||g===n)&&ot(t,n)}function s(i,r,u,f){if(w)et();else{var e=n.Application.contextUrl+"Areas/VIS/Images/base/window-default.png";r&&(e=r);t.addTaskBarItem(i,e,u);f&&i.slice(i.indexOf("_")+1)!=n.MRole.getHomePage()&&(h.push(f),historyMgr.updateHistory(b(h.join(p))))}}function et(){if(tt++,tt==Object.keys(i).length){w=!1;for(var n in i)s(i[n].id,i[n].img,i[n].name,i[n].hid)}}function b(t){return n.Utility.encode(t)}function a(n,r,u,e){var o,s;return(t.unRegisterView(n),u&&(o=h.indexOf(u),o>-1&&h.splice(o,1),historyMgr.updateHistory(b(h.join(p)))),s=i[n],i[n]=null,delete i[n],f=null,e&&vt(s))?!1:!0}function rt(t,i){var f=null,u;return(t.toString().indexOf("&")!=-1&&(f=t.split("&")[1],t=t.split("&")[0]),u=yt(t),u)?(u.refreshData(),u.show(r,s),l(u),u):(u=new n.AWindow,u.initWindow(t,i,s,v,f)&&(u.onClosed=a,u.show(r),l(u)),u)}function ut(t){var i=new n.AWindow;n.MRole.getIsDisableMenu()&&i.hideCloseIcon(!0);i.initForm(t,s,y)&&(i.onClosed=a,i.show(r),l(i))}function ot(t,i){var u=new n.AWindow;u.initProcess(t,s,i,!0)&&(u.onClosed=a,u.show(r),l(u))}function st(n){n.onClosed=a;n.show(r);s(n.getId(),null,n.getName(),null);l(n)}function l(n){t.registerView(n.getId(),n.getRootLayout());i[n.getId()]=n}function ht(t){var i,e,r,o;try{if(historyMgr.updateHistory("#"),i=[],t.indexOf("&")!=-1&&(t=t.split("&"),i=t[1].split(","),t=t[0]),t=n.Utility.decode(t),t.length>0)for(w=!0,e=t.split(p),r=0,o=e.length;r<o;r++)if(e[r].length>0){var s=e[r],u=s.substring(0,1),f=s.substring(2);if(y===u){if(!n.MRole.getFormAccess(f)){console.log("No Form Access");continue}}else if(d===u||g===u){if(!n.MRole.getProcessAccess(f)){console.log("No Process Access");continue}}else if(v===u){if(!n.MRole.getWindowAccess(f)){console.log("No Window Access");continue}i&&i.length>0&&(f+="&"+i.shift())}it(u,f)}}catch(h){historyMgr.updateHistory("#");console.log(h)}}function ct(n){i[n]&&(f=i[n].refresh())}function lt(){for(var n in i)i[n].sizeChanged()}function at(t,i){if(t&&i){var r=t+"="+i;r=b(r);window.open(n.Application.contextUrl+"#"+r);return}alert("improper data")}function vt(t){var i,r;if(!n.Ini.getIsCacheWindow())return!1;for(i=0;i<e.length;i++)if(r=e[i],r.getAD_Window_ID()==t.getAD_Window_ID())return!0;if(t.getAD_Window_ID()!=0)try{return e.push(t),e.length>10&&e.splice(0,1),!0}catch(u){return!1}return!1}function yt(n){for(var i,t=0;t<e.length;t++)if(i=e[t],i.getAD_Window_ID()==n)return e.splice(t,1),i;return}function pt(){nt=t.getMenuDiv();$(document).on("keydown",wt);$(document).on("keyup",bt)}function wt(r){if($(".ui-widget-overlay.ui-front").length>0&&(r.altKey&&r.ctrlKey||r.altKey))return!1;if(r.altKey&&r.keyCode==88)f.dispose();else if(r.altKey&&r.keyCode==77)t.openMenu();else if(nt.css("display")!="none"&&r.keyCode==27)t.closeMenu();else if(r.altKey&&r.keyCode==76)n.ADialog.confirm("LogOut?",!0,"","Confirm",function(n){n&&$("#logoutForm").trigger("submit")});else if(!r.altKey&&(r.ctrlKey||r.ctrlKey&&r.shiftKey)&&r.keyCode==32){if(!i||Object.keys(i).length<=0)return;o||(o=t.getNavigationSection());r.ctrlKey&&r.shiftKey?k(!0,!1):k(!0,!0);r.preventDefault();r.stopPropagation()}else r.altKey&&r.ctrlKey&&(r.keyCode==37||r.keyCode==39)?(f.navigateThroghtShortcut(r.keyCode==39),r.preventDefault(),r.stopPropagation()):f&&typeof f.keyDown=="function"&&f.keyDown.call(f,r)}function bt(n){n.ctrlKey||(k(!1),c=!1)}function k(t,r){var e;if(t)o.css("display","inherit");else{c&&(e=u.find(".vis-current-nav-window"),ft(e));return}if(!c){u=$('<div class="vis-nav-innerContainer">');o.append(u);u.on("click",kt);$.each(i,function(t,i){var r="";i.hid?i.hid.startsWith("W")?r=n.Application.contextUrl+"Areas/VIS/Images/base/winPic.png":i.hid.startsWith("P")?r=n.Application.contextUrl+"Areas/VIS/Images/base/processPic.png":i.hid.startsWith("X")?r=n.Application.contextUrl+"Areas/VIS/Images/base/FormPic.png":i.hid.startsWith("R")&&(r=n.Application.contextUrl+"Areas/VIS/Images/base/report-pic.png"):r=n.Application.contextUrl+"Areas/VIS/Images/base/FormPic.png";f.id==i.id?u.append("<div tabindex="+t+' data-wid="'+i.id+'" class="vis-current-nav-window vis-nav-window"><span>'+i.name+'<\/span><img data-wid="'+i.id+'" class="vis-nav-window-img" src="'+r+'"> <\/img><\/div>'):u.append("<div tabindex="+t+' data-wid="'+i.id+'" class="vis-nav-window"><span>'+i.name+'<\/span><img data-wid="'+i.id+'" class="vis-nav-window-img" src="'+r+'"> <\/img><\/div>')});c=!0}r?(e=u.find(".vis-current-nav-window").next(),(!e||e.length<=0)&&(e=u.children().first())):(e=u.find(".vis-current-nav-window").prev(),(!e||e.length<=0)&&(e=u.children().last()));u.find(".vis-current-nav-window").removeClass("vis-current-nav-window");e.addClass("vis-current-nav-window").focus()}function ft(n){f.id!=n.data("wid")&&(t.toggleContainer(n.data("wid")),t.activateTaskBarItemUsingID(n));o.css("display","none");o.empty();c=!1}function kt(n){var t=$(n.target);(t.hasClass("vis-nav-window")||t.hasClass("vis-nav-window-img"))&&ft(t)}var d="P",g="R",v="W",y="X",p="!",h=[],i={},e=[],c=!1,o=null,u=null,nt=null,w=!1,tt=0,f=null;return pt(),{startAction:it,restoreActions:ht,resize:ct,sizeChanged:lt,startWindow:rt,startForm:ut,startCFrame:st,startActionInNewTab:at}}function i(t){var i,r;this.frame=new n.AWindow;this.frame.setName("Form");this.onOpened=null;this.onClose=null;i=null;this.contentDispose=null;this.error=!1;this.windowNo=t||n.Env.getWindowNo();this.hideH=!1;r=this;this.setContent=function(t){t.getRoot&&t.getRoot()||(n.Dialog.error("Error",!0,"class must define root element  and implement getRoot function"),t.dispose(),this.error=!0);t.sizeChanged||(t.sizeChanged=function(){});t.refresh||(t.refresh=function(){});t.dispose&&(this.contentDispose=t.dispose,t.dispose=function(){r.dispose()});i=t;this.frame.setCFrameContent(t,this.windowNo);this.hideH&&this.frame.hideHeader(this.hideH)};this.dispose=function(){this.disposing||(this.disposing=!0,this.contentDispose.call(i),this.frame&&this.frame.dispose(),this.frame=null,this.onOpened=null,this.onClose=null,i=null,this.contentDispose=null,r=null)}}var t=n.desktopMgr,r=t.getMainConatiner();i.prototype.setTitle=function(n){this.frame.setTitle(n)};i.prototype.getTitle=function(){return this.frame.getTitle()};i.prototype.setName=function(n){this.frame.setName(n)};i.prototype.show=function(){if(this.error){this.dispose();return}n.viewManager.startCFrame(this.frame);this.onOpened&&this.onOpened()};i.prototype.hideHeader=function(n){this.hideH=n;this.frame.cPanel&&this.frame.hideHeader(n)};n.viewManager=u();n.CFrame=i}(VIS);VIS.context.m_map={};VIS.context.getContext=function(n){if(n==null)throw new ArgumentException("Require Context");if(arguments.length>2)return typeof arguments[1]=="int"?this.getWindowTabContext(arguments[0],arguments[1],arguments[2]):this.getWindowContext(arguments[0],arguments[1],arguments[2]);if(arguments.length==2)return this.getWindowContext(arguments[0],arguments[1]);var t=VIS.context.ctx[n];return t?t:n=="#AD_User_ID"?VIS.context.getContext("#"+n):n=="#AD_User_Name"?VIS.context.getContext("#"+n):""};VIS.context.getWindowContext=function(n,t,i){if(t==null)throw new ArgumentException("Require Context");var u=n+"|"+t,r="";return(this.m_map[n]&&(r=this.m_map[n][u]),!r||r=="")?t.startsWith("#")||t.startsWith("$")?VIS.context.getContext(t):i?"":VIS.context.getContext("#"+t):r};VIS.context.getWindowTabContext=function(n,t,i){if(i==null)throw new ArgumentException("Require Context");var r="";return(this.m_map[n]&&(r=this.m_map[n][n+"|"+t+"|"+i]),!r||r=="")?VIS.context.getWindowContext(n,i,!1):r};VIS.context.setContext=function(n,t){return arguments.length==4?this.setWindowTabContext(arguments[0],arguments[1],arguments[2],arguments[3]):arguments.length==3?this.setWindowContext(arguments[0],arguments[1],arguments[2]):VIS.context.ctx[n]=t,n};VIS.context.setWindowContext=function(n,t,i){t!=null&&(this.m_map[n]||(this.m_map[n]={}),this.m_map[n][n+"|"+t]=i==null||i===""?null:i)};VIS.context.setWindowTabContext=function(n,t,i,r){i!=null&&(this.m_map[n]||(this.m_map[n]={}),this.m_map[n][n+"|"+t+"|"+i]=r==null||String(r).equals("")?null:r)};VIS.context.getAD_User_ID=function(){return VIS.context.getContext("##AD_User_ID")};VIS.context.getAD_User_Name=function(){return this.getContext("#AD_User_Name")};VIS.context.getAD_Role_ID=function(){return this.getContextAsInt("#AD_Role_ID")};VIS.context.getAD_Role_Name=function(){return this.getContext("#AD_Role_Name")};VIS.context.getAD_Client_ID=function(){return VIS.context.getContext("#AD_Client_ID")};VIS.context.getAD_Client_Name=function(){return this.getContext("#AD_Client_Name")};VIS.context.getAD_Org_ID=function(){return VIS.context.getContext("#AD_Org_ID")};VIS.context.getAD_Language=function(){return VIS.context.getContext("#AD_Language")};VIS.context.setAutoCommit=function(n,t){VIS.context.setWindowContext(n,"AutoCommit",t?"Y":"N")};VIS.context.setAutoNew=function(n,t){VIS.context.setWindowContext(n,"AutoNew",t?"Y":"N")};VIS.context.isAutoNew=function(){var n=VIS.context.getContext("AutoNew");return n!=null&&n==="Y"?!0:!1};VIS.context.getStdPrecision=function(){return VIS.context.getContext("#StdPrecision")};VIS.context.setStdPrecision=function(){return VIS.context.getContext("#StdPrecision")};VIS.context.getIsAutoNew=function(n){var t=this.getWindowContext(n,"AutoNew",!1);return t!=null&&t!=""?t.equals("Y")?!0:!1:this.isAutoNew()};VIS.context.isAutoCommit=function(){var n=VIS.context.getContext("AutoCommit");return n!=null&&n==="Y"?!0:!1};VIS.context.setContextOfWindow=function(n,t){if(n&&t){for(prop in n)VIS.context.setWindowContext(t,prop,n[prop]);n=null}};VIS.context.getContextAsInt=function(n,t,i){var r="";if(r=arguments.length>1&&typeof arguments[0]=="number"?this.getWindowContext(n,t,i):this.getContext(arguments[0]),r.length==0)return 0;try{return parseInt(r)}catch(u){}return 0};VIS.context.getWindowContextAsInt=function(n,t,i){var r=this.getWindowContext(n,t,i);if(r.length==0)return 0;try{return parseInt(r)}catch(u){}return 0};VIS.context.getContextAsTime=function(n,t){var i=this.getContext(n,t,!1);return i==null||i.length==0?Date.now().getTime():new Date(i).getTime()};VIS.context.getShowClientOrg=function(){return this.getContextAsInt("#ClientOrgLevel")};VIS.context.removeWindow=function(n){this.m_map[n]=null;delete this.m_map[n];key=null};VIS.context.getWindowCtx=function(n){var t={};return $.extend(t,this.ctx),n&&$.extend(t,this.m_map[n]),t};VIS.context.getEntireCtx=function(){var n={},t;$.extend(n,this.ctx);for(t in this.m_map)this.m_map.hasOwnProperty(t)&&$.extend(n,this.m_map[t]);return n};VIS.context.isSOTrx=function(n){var t=!1;return(t=n?this.getWindowContext(n,"IsSOTrx",!0):this.getContext("IsSOTrx"),t!=null&&t.equals("Y"))?!0:!1};VIS.context.setIsSOTrx=function(){arguments.length==2?this.setContext(arguments[0],"IsSOTrx",arguments[1]?"Y":"N"):this.setContext("IsSOTrx",arguments[0]?"Y":"N")};VIS.context.getIsUseCrystalReportViewer=function(){return VIS.context.getContext("#USE_CRYSTAL_REPORT_VIEWER")=="Y"};VIS.Msg={};VIS.Msg.elements={};VIS.I18N.getLabel=function(n,t,i,r){var u,f;if(!VIS.I18N.labels[n])return i&&r&&VIS.I18N.getLabelFromServer(n,t,i,r),"["+n+"]";if(u=VIS.I18N.labels[n],t&&t.length&&t.length>0)for(f=0;f<t.length;f++)u=u.replace("%"+f,t[f]);return i&&r&&(Object.prototype.toString.call(i[r])==="[object Function]"?i[r](u):i[r]=u),u};VIS.I18N.getLabelFromServer=function(n){return"UNDEFINED "+n};VIS.Msg.getMsg=function(n,t,i){if(!VIS.I18N.labels[n])return"["+n+"]";label=VIS.Utility.Util.cleanMnemonic(VIS.I18N.labels[n]);var r=label.split("      ");return t||(label=r[0]),i&&r.length>1&&(label=r[1]),label};VIS.Msg.parseTranslation=function(n,t){var u;if(t==null||t.length==0)return t;for(var i=t,e,f="",r=i.indexOf("@");r!=-1;){if(f+=i.substring(0,r),i=i.substring(r+1,i.length),u=i.indexOf("@"),u<0){i="@"+i;break}e=i.substring(0,u);f+=this.translate(n,e);i=i.substring(u+1,i.length);r=i.indexOf("@")}return f+i};VIS.Msg.translate=function(n,t,i){if(t==null||t.length==0)return t;if(i){var r=null;if($.ajax({url:VIS.Application.contextUrl+"JsonData/GetTranslatedText",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({Columns:t,AD_Language:VIS.Env.getAD_Language(n)})}).done(function(n){r=n}),r)return JSON.parse(r);r}else return VIS.Msg.translate3(VIS.Env.getAD_Language(n),n.isSOTrx(),t)};VIS.Msg.getElement=function(n,t){return VIS.Msg.getElement3(VIS.Env.getAD_Language(n),t,!0)};VIS.Msg.getElement1=function(n){return VIS.Msg.getElement3(VIS.Env.getAD_Language(VIS.Env.getCtx()),n,!0)};VIS.Msg.translate3=function(n,t,i){var u,r;return i==null||i.equals("")?"":(u=n,(u==null||u.length==0)&&(u=VIS.Env.getBaseAD_Language()),r=VIS.Msg.getElement3(u,i,t),!r.equals(""))?r.trim():(r=VIS.Msg.getMsg(i),r&&r.length>0)?r:i};VIS.Msg.getElement3=function(n,t,i){function a(n,t,i){var r=null;return $.ajax({url:l,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:t,data:JSON.stringify(n)}).done(function(n){r=n;i&&i(n)}),r}var c=VIS.Application.contextUrl,l=c+"JsonData/JDataSetWithCode",h=function(n,t,i){var f=i?!0:!1,u={sql:n,page:1,pageSize:0},r;return t&&(u.param=t),r=null,a(u,f,function(n){r=(new VIS.DB.DataReader).toJson(n);i&&i(r)}),r},r,u,s;if(t==null||t.equals(""))return"";if(r=n,(r==null||r.length==0)&&(r=VIS.Env.getBaseAD_Language()),VIS.Msg.elements[t])return VIS.Msg.elements[t];var f="",o="",e=null;try{r==null||r.length==0||VIS.Env.isBaseLanguage(r,"AD_Element")?(o="VIS_73",u=[],u[0]=new VIS.DB.SqlParam("@ColumnName",t.toUpper()),e=h(o,u)):(o="VIS_74",u=[],u[0]=new VIS.DB.SqlParam("@ColumnName",t.toUpper()),u[1]=new VIS.DB.SqlParam("@AD_Language",r),e=h(o,u));e.read()&&(f=e.getString(0),i||(s=e.getString(1),s!=null&&s.length>0&&(f=s)));e.close()}catch(v){e.close()}return f!=null&&(f=f.trim()),VIS.Msg.elements[t]=f,f};VIS.MRole.getDefault=function(){return VIS.MRole};VIS.MRole.log=VIS.Logging.VLogger.getVLogger("MRole");VIS.MRole.canUpdate=function(n,t,i,r,u){var e=this.vo.UserLevel.trim(),f=!0,o="";return n==0&&t==0&&e.indexOf("S")==-1?(f=!1,o+="S"):n!=0&&t==0&&e.indexOf("C")==-1?e.indexOf("O")==-1&&this.getIsOrgAccess(t,!0)||(f=!1,o+="C"):n!=0&&t!=0&&e.indexOf("O")==-1&&(f=!1,o+="O"),f&&(f=this.getIsTableAccess(i,!1)),f&&r!=0&&(f=this.getIsRecordAccess(i,r,!1)),!f&&u,f};VIS.MRole.getIsColumnAccess=function(n,t,i){var u,f,r;if(!this.getIsTableAccess(n,i))return!1;for(u=!0,f=this.vo.columnAccess,r=0;r<f.length;r++)if(f[r].IsExclude){if(f[r].AD_Table_ID==n&&f[r].AD_Column_ID==t&&(u=i?!1:!f[r].IsReadOnly,!u))return u}else if(f[r].AD_Table_ID==n&&f[r].AD_Column_ID==t&&(u=i?!0:!f[r].IsReadOnly,!u))return u;return!u,u};VIS.MRole.getIsTableAccessLevel=function(n,t){var i,r;return t?!0:(i=this.vo.tableAccessLevel[n],i==null)?!1:i.equals(VIS.Consts.ACCESSLEVEL_All)?!0:(r=this.vo.UserLevel.trim(),r.indexOf("S")!=-1&&(i.equals(VIS.Consts.ACCESSLEVEL_SystemOnly)||i.equals(VIS.Consts.ACCESSLEVEL_SystemPlusClient)))?!0:r.indexOf("C")!=-1&&(i.equals(VIS.Consts.ACCESSLEVEL_ClientOnly)||i.equals(VIS.Consts.ACCESSLEVEL_SystemPlusClient))?!0:r.indexOf("O")!=-1&&(i.equals(VIS.Consts.ACCESSLEVEL_Organization)||i.equals(VIS.Consts.ACCESSLEVEL_ClientPlusOrganization))?!0:!1};VIS.MRole.canView=function(n){var i=this.vo.UserLevel.trim(),t=!0;return VIS.Consts.ACCESSLEVEL_All.equals(n)?t=!0:VIS.Consts.ACCESSLEVEL_SystemOnly.equals(n)&&i.indexOf("S")==-1?t=!1:VIS.Consts.ACCESSLEVEL_ClientOnly.equals(n)&&i.indexOf("C")==-1?t=!1:VIS.Consts.ACCESSLEVEL_Organization.equals(n)&&i.indexOf("O")==-1?t=!1:!VIS.Consts.ACCESSLEVEL_ClientPlusOrganization.equals(n)||i.indexOf("C")!=-1||i.indexOf("O")!=-1?!VIS.Consts.ACCESSLEVEL_SystemPlusClient.equals(n)||i.indexOf("S")!=-1||i.indexOf("C")!=-1||(t=!1):t=!1,t,t};VIS.MRole.getIsTableAccess=function(n,t){var u,i,r;if(!this.getIsTableAccessLevel(n,t))return!1;for(u=!0,i=this.vo.tableAccess,r=0;r<i.length;r++)if(VIS.Consts.ACCESSTYPERULE_Accessing.equals(i[r].AccessTypeRule))if(i[r].IsExclude){if(i[r].AD_Table_ID===n)return t?i[r].IsReadOnly:!1}else if(u=!1,i[r].AD_Table_ID==n)return t?!0:!i[r].IsReadOnly;return!u,i=null,u};VIS.MRole.getIsCanReport=function(n){var r,t,i;if(!this.vo.IsCanReport||!this.getIsTableAccess(n,!0))return!1;for(r=!0,t=this.vo.tableAccess,i=0;i<t.length;i++)if(VIS.Consts.ACCESSTYPERULE_Reporting.equals(t[i].AccessTypeRule))if(t[i].IsExclude){if(t[i].AD_Table_ID===n)return t[i].IsCanReport}else if(r=!1,t[i].AD_Table_ID===n)return t[i].IsCanReport;return t=null,r};VIS.MRole.getIsCanExport=function(n){var r,t,i;if(!this.vo.IsCanExport||!this.getIsTableAccess(n,!0)||!this.getIsCanReport(n))return!1;for(r=!0,t=this.vo.tableAccess,i=0;i<t.length;i++)if(VIS.Consts.ACCESSTYPERULE_Exporting.equals(t[i].AccessTypeRule))if(t[i].IsExclude){if(t[i].AD_Table_ID===n)return t[i].IsCanExport}else if(r=!1,t[i].AD_Table_ID===n)return t[i].IsCanExport;return t=null,r};VIS.MRole.getIsOrgAccess=function(n,t){var i,r;if(this.vo.IsAccessAllOrgs||n==0&&!t)return!0;for(i=this.vo.orgAccess,r=0;r<i.length;r++)if(i[r].AD_Org_ID===n)return t?i[r].readOnly?!1:!0:!0;return i=null,!1};VIS.MRole.getIsRecordAccess=function(n,t,i){for(var e=!0,u=this.vo.recordAccess,r=null,f=0;f<u.length;f++)if(r=u[f],r.AD_Table_ID===n)if(r.IsExclude){if(r.Record_ID===t)return u=null,i?r.IsReadOnly:!1}else if(e=!1,r.Record_ID===t)return u=null,i?!0:!r.IsReadOnly;return e};VIS.MRole.getClientWhere=function(n){var t,r,u,i,e,f;if(this.vo.IsAccessAllOrgs)return n||this.vo.AD_Client_ID==0?"AD_Client_ID="+this.vo.AD_Client_ID:"AD_Client_ID IN (0,"+this.vo.AD_Client_ID+")";for(t=[],n||t.push("0"),r=0;r<this.vo.orgAccess.length;r++)u=this.vo.orgAccess[r].AD_Client_ID.toString(),t.indexOf(u)<0&&t.push(u),u=null;for(i=new StringBuilder,e=!0,f=0;f<t.length;f++)i.length()>0&&(i.append(","),e=!1),i.append(t[f]);return(t=null,e)?i.length()>0?"AD_Client_ID="+i.toString():(this.log.log(VIS.Logging.Level.SEVERE,"No Access Org records"),"AD_Client_ID=-1"):"AD_Client_ID IN("+i.toString()+")"};VIS.MRole.getOrgWhere=function(n,t){var i,f,e,r,s;if(this.vo.IsAccessAllOrgs)return null;for(i=[],t||i.push("0"),f=this.vo.orgAccess,e=0;e<f.length;e++)r=f[e].AD_Org_ID.toString(),t?r.readOnly||i.indexOf(r)<0&&i.push(r):i.indexOf(r)<0&&i.push(r);if(f=null,i.length==1)return"COALESCE("+(n==null?"":n+".")+"AD_Org_ID,0)="+i[0];if(i.length==0)return this.log.log(VIS.Logging.Level.SEVERE,"No Access Org records"),(n==null?"":n+".")+"AD_Org_ID=-1";var o=new StringBuilder,u=new StringBuilder,h=0;for(s=0;s<i.length;s++)u.length()>0&&u.append(","),u.append(i[s]),h++,(h%999==0||h==i.length)&&(o.length()>0&&o.append(" OR "),o.append("COALESCE("+(n==null?"":n+".")+"AD_Org_ID,0) IN(").append(u.toString()).append(")"),u=null,u=new StringBuilder);return"("+o.toString()+")"};VIS.MRole.getAD_Table_ID=function(n){var t=this.vo.tableName[n];return t!=null?t:0};VIS.MRole.getSynonym=function(n){var t=this.columnSynonym[n];return t?t:null};VIS.MRole.getKeyColumnName=function(n,t){var u=this.getSynonym(t),i,r;if(u==null)return t;for(i=0;i<n.length;i++)if(r=n[i],t.equals("AD_User_ID")){if(r.getTableName().equals("AD_User"))return t}else if(t.equals("AD_ElementValue_ID")&&r.getTableName().equals("AD_ElementValue"))return t;return u};VIS.MRole.getDependentAccess=function(n,t,i){var r,u;if(t.length==0&&i.length==0)return"";if(t.length!=0&&i.length!=0&&this.log.warning("Mixing Include and Excluse rules - Will not return values"),r=new StringBuilder(" AND "),t.length==1)r.append(n).append("=").append(t[0]);else if(t.length>1){for(r.append(n).append(" IN ("),u=0;u<t.length;u++)u>0&&r.append(","),r.append(t[u]);r.append(")")}else if(i.length==1)r.append(n).append("<>").append(i[0]);else if(i.length>1){for(r.append(n).append(" NOT IN ("),u=0;u<i.length;u++)u>0&&r.append(","),r.append(i[u]);r.append(")")}return r.toString()};VIS.MRole.getDependentRecordWhereColumn=function(n,t){var f=t,e=n.indexOf(t),u=e-1,i=n.charAt(u),r;if(i=="."){for(r=new StringBuilder;i!=" "&&i!=","&&i!="(";)r.insert(0,i),i=n.charAt(--u);return r.append(t),r.toString()}return f};VIS.MRole.getRecordWhere=function(n,t,i){for(var e=new StringBuilder,o=new StringBuilder,f=this.vo.recordAccess,r,s,u=0;u<f.length;u++)f[u].AD_Table_ID==n&&(f[u].IsExclude?(o.length()==0?o.append(t).append(" NOT IN ("):o.append(","),o.append(f[u].Record_ID)):i&&f[u].IsReadOnly||(e.length()==0?e.append(t).append(" IN ("):e.append(","),e.append(f[u].Record_ID)));return r=new StringBuilder,o.length()>0&&r.append(o).append(")"),e.length()>0&&(r.length()>0&&r.append(" AND "),r.append(e).append(")")),this.vo.IsPersonalAccess||!this.vo.tableData[n].IsView&&this.vo.tableData[n].HasKey&&(s=" NOT IN ( SELECT Record_ID FROM AD_Private_Access WHERE AD_Table_ID = "+n+" AND AD_User_ID <> "+this.vo.AD_User_ID+" AND IsActive = 'Y' )",r.length()>0&&r.append(" AND "),r.append(t).append(s)),f=null,r.toString()};VIS.MRole.getDocWhere=function(n){function s(n,t,i){var r=null;return $.ajax({url:e,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:t,data:JSON.stringify(n)}).done(function(n){r=n;i&&i(n)}),r}var f=VIS.Application.contextUrl,e=f+"JsonData/JDataSetWithCode",o=function(n,t,i){var u=i?!0:!1,f={sql:n,page:1,pageSize:0},r=null;return s(f,u,function(n){t=(new VIS.DB.DataSet).toJson(n);var t=(new VIS.DB.DataSet).toJson(n);r=t.getTable(0).getRows().length>0?t.getTable(0).getRow(0).getCell(0):null;t.dispose();t=null;u&&i(r)}),r},t,u;if(!this.vo.IsUseBPRestrictions)return"";var i=!1,r=[];return(r[0]=new VIS.DB.SqlParam("@TableName",n),t=o("VIS_101",r),i=(t?parseInt(t):0)!=0,!i)?"":(u=VIS.context.getAD_User_ID(),$.ajax({type:"Get",async:!1,url:VIS.Application.contextUrl+"Form/GetDocWhere",data:{AD_User_ID:u,TableName:n},success:function(n){docAccess=n},error:function(n){console.log(n)}}),docAccess)};VIS.MRole.addAccessSQL=function(n,t,r,u,f){var a,h,o,d,ut,s,b,p,k,v,g,w,y,tt,l,st,it;r&&VIS.Utility.Util.isEmpty(t)&&(r=!1);var e=new StringBuilder,ot="",rt=n.lastIndexOf(" ORDER BY ");for(rt!=-1?(ot=n.substring(rt),e.append(n.substring(0,rt))):e.append(n),a=new VIS.AccessSqlParser(e.toString()),h=a.getTableInfo(a.getMainSqlIndex()),a.getMainSql().indexOf(" WHERE ")==-1?e.append(" WHERE "):e.append(" AND "),o="",h.length>0&&(h[0].getTableName().equals(t)||h[0].getSynonym().equals(t))&&(o=h[0].getSynonym(),VIS.Utility.Util.isEmpty(o)&&(o=h[0].getTableName())),!VIS.Utility.Util.isEmpty(t)&&VIS.Utility.Util.isEmpty(o)&&(d="TableName not correctly parsed - TableNameIn="+t+" - "+a,h.length>0&&(d+=" - #1 "+h[0]),d+="\n = "+n,this.log.log(VIS.Logging.Level.SEVERE,d),o=t),r&&!VIS.Utility.Util.isEmpty(o)&&e.append(o).append("."),e.append(this.getClientWhere(u)),this.vo.IsAccessAllOrgs||f||(e.append(" AND "),r&&!VIS.Utility.Util.isEmpty(o)?e.append(this.getOrgWhere(o,u)):e.append(this.getOrgWhere(null,u))),this.vo.IsUseBPRestrictions&&(ut=this.getDocWhere(o),ut.length()>0&&(e.append(" AND "),e.append(ut))),s=0,i=0;i<h.length;i++){if(b=h[i],p=b.getTableName(),s=this.getAD_Table_ID(p),s!=0&&!this.vo.IsAccessAllOrgs&&f&&(k=b.getSynonym(),(k==null||k.isEmpty())&&(k=p),e.append(" AND "),e.append(this.getOrgWhere(k,u))),s!=0&&!this.getIsTableAccess(s,!u)){e.append(" AND 1=3");this.log.fine("No access to AD_Table_ID="+s+" - "+p+" - "+e);break}v="";r&&(v=b.getSynonym(),v.length==0&&(v=p),v+=".");v+=p+"_ID";g=this.getRecordWhere(s,v,u);g.length>0&&(e.append(" AND ").append(g),this.log.finest("Record access - "+g))}b=null;w=a.getMainSql();s=0;var nt=null,ft=[],et=[],c=this.vo.recordDependentAccess;for(i=0;i<c.length;i++)(y=this.getKeyColumnName(a.getTableInfo(a.getMainSqlIndex()),c[i].KeyColumnName),y!=null)&&(tt=w.indexOf(y),tt!=-1)&&(l=w.charAt(tt-1),l==","||l=="."||l==" "||l=="(")&&(l=w.charAt(tt+y.length),l==","||l==" "||l==")")&&(s!=0&&s!=c[i].AD_Table_ID&&e.append(this.getDependentAccess(nt,ft,et)),s=c[i].AD_Table_ID,c[i].IsExclude?(et.push(c[i].Record_ID),this.log.fine("Exclude "+y+" - "+c[i])):u&&c[i].IsReadOnly||ft.push(c[i].Record_ID),st=null,st!=null?(it="",nt=it==null||it.length()==0?this.getDependentRecordWhereColumn(w,y):it):nt=this.getDependentRecordWhereColumn(w,y));return e.append(this.getDependentAccess(nt,ft,et)),e.append(ot),e.toString()};VIS.MRole.getWindowAccess=function(n){return this.vo.windowAccess[n]?!0:!1};VIS.MRole.getFormAccess=function(n){return this.vo.formAccess[n]?!0:!1};VIS.MRole.getProcessAccess=function(n){return this.vo.processAccess[n]?!0:!1};VIS.MRole.getIsClientAccess=function(n,t){var r,i;if(n==0&&!t)return!0;for(r=this.vo.orgAccess,i=0;i<r.length;i++)if(r[i].AD_Client_ID==n&&(!t||!r[i].readOnly))return!0;return!1};VIS.MRole.getIsShowPreference=function(){return this.vo.IsShowPreference};VIS.MRole.getName=function(){return this.vo.Name};VIS.MRole.getPreferenceType=function(){return this.vo.PreferenceType};VIS.MRole.getIsDisplayClient=function(){return this.vo.IsDisplayClient};VIS.MRole.getIsDisplayOrg=function(){return this.vo.IsDisplayOrg};VIS.MRole.getIsPersonalLock=function(){return this.vo.IsPersonalLock};VIS.MRole.getMaxQueryRecords=function(){return this.vo.MaxQueryRecords};VIS.MRole.getIsQueryMax=function(n){var t=this.getMaxQueryRecords();return t>0&&n>t};VIS.MRole.getIsShowAcct=function(){return this.vo.IsShowAcct};VIS.MRole.getIsOverwritePriceLimit=function(){return this.vo.IsOverwritePriceLimit};VIS.MRole.getIsOverrideReturnPolicy=function(){return this.vo.IsOverrideReturnPolicy};VIS.MRole.getIsDisableMenu=function(){return this.vo.IsDisableMenu};VIS.MRole.getHomePage=function(){return this.vo.HomePage};VIS.MRole.toStringX=function(n){var t=new StringBuilder;return t.append(VIS.Msg.translate(n,"AD_Role_ID")).append("=").append(this.getName()).append(" - ").append(VIS.Msg.translate(n,"IsCanExport")).append("=").append(this.getIsCanExport()).append(" - ").append(VIS.Msg.translate(n,"IsCanReport")).append("=").append(this.getIsCanReport()).append(VIS.Env.NL).append(VIS.Env.NL),t.toString()},function(n,t){function i(){function w(n){if(n)window.setTimeout(function(){c.focus();r.on("keydown",function(n){if(n.keyCode==9)l.is(":focus")?c.focus():c.is(":focus")?l.focus():c.focus(),n.preventDefault(),n.stopPropagation();else if(n.keyCode==27)return n.preventDefault(),n.stopPropagation(),k(n),!1})},100);else{r.focus();r.on("keydown",function(n){return n.preventDefault(),n.stopPropagation(),k(n),!1})}}function k(n){n.stopPropagation();u&&u();u=null;b()}function b(){a.hide();r.css({position:"inherit",display:"none"});i.find(".vis-Dialog-buttons").css("display","none");l&&l.off("click");c&&c.off("click");r.off("keydown")}function d(t,c,l){u=l;try{}catch(v){}r.css({position:"absolute",display:"inherit"});i.show();f.removeClass();f.addClass("vis-alert-close vis-alert-close-info");e.removeClass();e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info");h.removeClass();h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info");o.removeClass();o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info");y.attr("src",n.Application.contextUrl+"Areas/VIS/Images/base/info-icon.png");_prodFound=!0;p.text(t);c?s.text(n.Msg.getMsg(c)):s.text(n.Msg.getMsg("Info"));a.show();i.fadeIn(300);w(!1)}function g(t,v,k){u=k;try{}catch(g){}r.css({position:"absolute",display:"inherit"});i.show();f.removeClass();f.addClass("vis-alert-close vis-alert-close-info");e.removeClass();e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info");h.removeClass();h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info vis-PopupContent-alert-Confirm");o.removeClass();o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info");y.attr("src",n.Application.contextUrl+"Areas/VIS/Images/base/confirm-icon.png");var d=i.find(".vis-Dialog-buttons");d.css("display","inherit");l=d.find(".vis-Dialog-buttons-OK");c=d.find(".vis-Dialog-buttons-Cancel");_prodFound=!0;p.text(t);v?s.text(n.Msg.getMsg(v)):s.text(n.Msg.getMsg("Confirm"));a.show();i.fadeIn(300);l.one("click",function(){b();d.css("display","none");u(!0)});c.one("click",function(){b();d.css("display","none");u(!1)});w(!0)}function nt(t,k,d,g){u=g;try{}catch(tt){}r.css({position:"absolute",display:"inherit"});i.show();f.removeClass();f.addClass("vis-alert-close vis-alert-close-info");e.removeClass();e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-info");h.removeClass();h.addClass("vis-PopupContent-alert vis-PopupContent-alert-info vis-PopupContent-alert-Confirm");o.removeClass();o.addClass("vis-popup-headerContainer vis-popup-headerContainer-info");y.attr("src",n.Application.contextUrl+"Areas/VIS/Images/base/confirm-icon.png");var nt=i.find(".vis-Dialog-buttons");nt.css("display","inherit");l=nt.find(".vis-Dialog-buttons-OK");c=nt.find(".vis-Dialog-buttons-Cancel");_prodFound=!0;p.text(t);v.empty();v.css("display","block");v.append(d);k?s.text(n.Msg.getMsg(k)):s.text(n.Msg.getMsg("Confirm"));a.show();i.fadeIn(300);l.one("click",function(){b();nt.css("display","none");v.css("display","none");v.empty();u(!0)});c.one("click",function(){b();nt.css("display","none");v.css("display","none");v.empty();u(!1)});w(!0)}function tt(c,l,v){u=v;try{t("#prodError")[0].play()}catch(b){}_prodFound=!0;r.css({position:"absolute",display:"inherit"});i.show();f.removeClass();f.addClass("vis-alert-close vis-alert-close-warn");e.removeClass();e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-warn");h.removeClass();h.addClass("vis-PopupContent-alert vis-PopupContent-alert-warn");o.removeClass();o.addClass("vis-popup-headerContainer vis-popup-headerContainer-warn");y.attr("src",n.Application.contextUrl+"Areas/VIS/Images/base/warning-icon.png");p.text(c);l?s.text(n.Msg.getMsg(l)):s.text(n.Msg.getMsg("Warning"));a.show();w(!1)}function it(c,l,v){u=v;try{t("#prodError")[0].play()}catch(b){}_prodFound=!0;r.css({position:"absolute",display:"inherit"});i.show();f.removeClass();f.addClass("vis-alert-close vis-alert-close-error");e.removeClass();e.addClass("vis-PopupHeader-alert vis-PopupHeader-alert-error");h.removeClass();h.addClass("vis-PopupContent-alert vis-PopupContent-alert-error");o.removeClass();o.addClass("vis-popup-headerContainer vis-popup-headerContainer-error");y.attr("src",n.Application.contextUrl+"Areas/VIS/Images/base/error-icon.png");p.text(c);l?s.text(n.Msg.getMsg(l)):s.text(n.Msg.getMsg("Error"));a.show();i.fadeIn(300);w(!1)}var a=t('<div id="overlayMsgDialog" class="web_dialog_overlay"><\/div>'),r=t('<div class="" style="z-index: 999999;width: 100%;top: 0;height: 100%;display:none;" tabIndex=1>'),i=t('<div id="VAPOS_ErrorInfo" class="vis-PopupWrap-alert" style="width:300px; margin: 20% auto;"><input class="vis-Dialog-buttons-text" type="number"  tabindex="-30" style="z-index:-44;position:absolute"  autofocus="autofocus"  >        <div class="vis-popup-headerContainer">                                                  <div class="vis-PopupHeader-alert">           <h4 id="VAPOS_CLInformation" style="padding-left: 10px; color: #fff">Information<\/h4>           <span id="btnCloseInfo" class="vis-PopuptopCloseIconTop"><\/span>                            <\/div>  <\/div>                                                                                          <div class="vis-PopupContent-alert">                                                                    <div class="form-group vis-PopupInput-alert" style="width: 100%">                                <img class="vis-alert-img" style="float:left"  />                                                                      <label style="width: 90%;padding-left: 10px;word-break: break-word" id="VAPOS_lblErrorInfo"><\/label>                                   <div class="vis-confirm-customUI" style="display:none"> <\/div>                        <\/div>                                                                                                <div class="vis-Dialog-buttons" style="display:none">                                           <input class="vis-Dialog-buttons-OK " type="button" value="'+n.Msg.getMsg("OK")+'" > <input  class="vis-Dialog-buttons-Cancel"  type="button" value="'+n.Msg.getMsg("Cancel")+'" >                                               <\/div>                                                                                                                                                  <\/div>                                                                                      <\/div>');r.append(i);t("body").append(a).append(r);var e=i.find(".vis-PopupHeader-alert"),o=i.find(".vis-popup-headerContainer"),f=i.find("#btnCloseInfo"),s=i.find("#VAPOS_CLInformation"),y=i.find(".vis-alert-img"),h=i.find(".vis-PopupContent-alert"),p=i.find("#VAPOS_lblErrorInfo"),v=i.find(".vis-confirm-customUI"),rt=i.find("#VAPOS_busyInd"),l=null,c=null,u=null;f.on("click",function(n){k(n)});return{info:d,ask:g,error:it,warn:tt,askCustomUI:nt}}n.ADialog={info:function(t,i,r,u){var f="";t==null||t.equals("")||(f+=n.Msg.getMsg(t));r!=null&&r.length>0&&(f+="\n"+r);n.ADialogUI.info(f,u);f=null},ask:function(t,i,r){var u="",f;return t==null||t.equals("")||(u+=n.Msg.getMsg(t)),r!=null&&r.length>0&&(u+="\n"+r),f=!1,confirm(u)&&(f=!0),f},error:function(t,i,r,u){var f="";t==null||t.equals("")||(f+=n.Msg.getMsg(t));r!=null&&r.length>0&&(f+="\n"+r);n.ADialogUI.error(f,u);f=null},warn:function(t,i,r,u){var f="";t==null||t.equals("")||(f+=n.Msg.getMsg(t));r!=null&&r.length>0&&(f+="\n"+r);n.ADialogUI.warn(f,u);f=null},confirm:function(t,i,r,u,f){var e="",o;return t==null||t.equals("")||(e+=n.Msg.getMsg(t)),r!=null&&r.length>0&&(e+="\n"+r),o=!1,n.ADialogUI.ask(e,u,f),o},confirmCustomUI:function(t,i,r,u,f,e){var o="",s;return t==null||t.equals("")||(o+=n.Msg.getMsg(t)),r!=null&&r.length>0&&(o+="\n"+r),s=!1,n.ADialogUI.askCustomUI(o,u,f,e),s}};n.ADialogUI=i()}(VIS,jQuery),function(n,t){function k(n,i,r){var u=null;return t.ajax({url:d,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function w(i,r,u){var f=null;return i.sql=n.secureEngine.encrypt(i.sql),t.ajax({url:g,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:r,data:JSON.stringify(i)}).done(function(n){f=n;u&&u(n)}),f}function i(n,t,i,r,u){this.info=n;this.lookup=null;this.allLoaded=!1;this.hasInactive=!1;this.displayType=u;this.selectedObject;this.windowNo=r;this.validationDisabled=!1;this.data=[];this.ctx=i;t&&(this.lookup=t._lookup,this.allLoaded=t._allLoaded,this.hasInactive=t._hasInactive,this.displayType=t._displayType,this.windowNo=t._WindowNo,this.info&&(this.info.windowNo=t._WindowNo))}function r(t,r){i.call(this,t,r);this.lookupDirect={};this.directNullKey;this.loading=!1;this.nextRead=0;this.cLookup=!1;this.lookupDirectAll={};this.zomQuery=null;this.prepareZQuery();this.log=n.Logging.VLogger.getVLogger("MLookup")}function f(t,r){i.call(this,null,null,t,r,n.DisplayType.TableDir);this.lookup={};this.load()}function u(t,r){i.call(this,null,null,t,r,n.DisplayType.TableDir);this.C_Locator_ID=0;this.onlyWarehouseID=0;this.onlyProductID=0;this.onlyOutgoing=!1;this.lookup={};this.maxRows=1e4;this.defaultID="";this.log=n.Logging.VLogger.getVLogger("MLocatorLookup");this.load(!1);this.disposeLocal=function(){this.lookup=null;this.log=null}}function o(t,r){i.call(this,null,null,t,r,n.DisplayType.TableDir);this.log=n.Logging.VLogger.getVLogger("MAccountLookup");this.C_ValidCombination_ID=0;this.combination;this.description}function a(t,r){i.call(this,null,null,t,r,n.DisplayType.TableDir);this.NO_INSTANCE={Key:0,Name:""};this.log=n.Logging.VLogger.getVLogger("MPAttributeLookup")}function h(t,r){i.call(this,null,null,t,r,n.DisplayType.TableDir);this.NO_INSTANCE={Key:0,Name:""};this.log=n.Logging.VLogger.getVLogger("MGAttributeLookup")}function c(t,r){i.call(this,null,null,t,r,n.DisplayType.AmtDimension);this.lookup={}}function l(t,r){i.call(this,null,null,t,r,n.DisplayType.ProductContainer);this.log=n.Logging.VLogger.getVLogger("MProductContainerLookup");this.lookup={}}var v=n.DB,e=n.Logging.Level,y=n.Application.contextUrl,d=y+"JsonData/JDataSetWithCode",g=y+"Form/JDataSet",nt=y+"JsonData/ExecuteNonQuer",s=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,k(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u},tt=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,k(f,e,function(t){u=(new n.DB.DataSet).toJson(t);r&&r(u)}),u},it=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,w(f,e,function(t){u=(new n.DB.DataSet).toJson(t);r&&r(u)}),u},p=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,w(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u},b=function(t,i,r,u,f){var s=f?!0:!1,o={sql:t,page:i,pageSize:r},e;return u&&(o.param=u),e=null,w(o,s,function(t){e=(new n.DB.DataReader).toJson(t);f&&f(e)}),e};i.prototype.INACTIVE_S="~";i.prototype.INACTIVE_E="~";i.prototype.MAX_ROWS=1e4;i.prototype.MINUS_ONE=-1;i.prototype.getValidation=function(){return""};i.prototype.getWindowNo=function(){return this.windowNo};i.prototype.getDisplayType=function(){return this.displayType};i.prototype.setDisplayType=function(n){this.displayType=n};i.prototype.disableValidation=function(){this.validationDisabled=!0};i.prototype.getIsValidationDisabled=function(){return this.validationDisabled};i.prototype.getIsValidated=function(){return!0};i.prototype.getHasInactive=function(){return this.hasInactive};i.prototype.getData=function(){return[]};i.prototype.getDisplay=function(){return""};i.prototype.getSelectedItem=function(){return this.selectedObject};i.prototype.fillCombobox=function(n,t,i,r){var u=this.selectedObject,f;this.data!=null&&(this.data.length=0);this.data=this.getData(n,t,i,r);f=0;this.data!=null&&(f=this.data.length);u!=this.selectedObject&&(u=this.selectedObject);u==null&&n&&f>0&&(u=this.data[0],this.selectedObject=u)};i.prototype.setSelectedItem=function(n){(this.selectedObject!=null&&this.selectedObject!==n||this.selectedObject==null&&n!=null)&&this.setSelectedItemAlways(n)};i.prototype.setSelectedItemAlways=function(n){this.selectedObject=this.data.indexOf(n)>-1||n==null?n:null};i.prototype.refresh=function(){return 0};i.prototype.getZoomQuery=function(){return null};i.prototype.getColumnName=function(){return this.info.keyColumn};i.prototype.dispose=function(){this.info=null;this.lookup=null;this.allLoaded=null;this._hasInactive=null;this.selectedObject=null;this.data=null;this.ctx=null};i.prototype.removeAllElements=function(){this.data.length>0&&(this.data.length=0,this.selectedObject=null)};i.prototype.clear=function(){this.removeAllElements()};n.Utility.inheritPrototype(r,i);r.prototype.prepareZQuery=function(){var r,f,u,i;if(this.info.zoomQuery!=null&&!t.isEmptyObject(this.info.zoomQuery))for(r=this.info.zoomQuery,this.zomQuery=new n.Query(r._tableName),f=null,u=0;u<r._list.length;u++)i=r._list[u],f=new n.QueryRestriction(i.ColumnName,i.Code,i.Code_to,i.InfoName,r.InfoDisplay,i.InfoDisplay_to,i.Operator,i.DirectWhereClause,i.AndCondition),this.zomQuery.addRestriction(f)};r.prototype.initialize=function(n){return n?this:this.info.isCreadedUpdatedBy?this:this.info.isParent||this.info.isKey?(this.hasInactive=!0,this):(this.info.isValidated?this.load(!0,!0):this.fillDirectList(),this)};r.prototype.getValidation=function(){return this.getIsValidationDisabled()?"":this.info.validationCode};r.prototype.getIsValidated=function(){return this.getIsValidationDisabled()?!0:this.info==null?!1:this.info.isValidated};r.prototype.getData=function(n,t,i,r){var u=this.getData2(t,r),f,o,e,s;if(i&&this.hasInactive)for(f=u.length;f>0;f--)o=u[f-1],o!=null&&(e=o.Name,e.startsWith(this.INACTIVE_S)&&e.endsWith(this.INACTIVE_E)&&(console.log(e),u.splice(f-1,1)));return n||(s=null,s=this.info.keyColumn!=null&&this.info.keyColumn.toUpperCase().endsWith("_ID")?{Key:-1,Name:""}:{Key:"",Name:""},u.unshift(s)),u};r.prototype.getData2=function(n,i){return((!this.allLoaded||t.isEmptyObject(this.lookup))&&this.refresh(i),this.info.isValidated)?this.getObjectArray(this.lookup):(!this.info.isValidated&&n&&this.refresh(i),this.getObjectArray(this.lookup))};r.prototype.getObjectArray=function(n){var t=[],r=0,i;for(i in n)t[r++]=n[i];return t};r.prototype.getDisplay=function(n,t){if(n==null)return"";var i=t?this.getFromList(n):this.get(n);return i==null?"<"+n.toString()+">":i.Name};r.prototype.get=function(i){var r,u;return i==null||this.MINUS_ONE===i?null:(this.info.isParent&&this.nextRead<Date.now()&&(this.lookup=null,this.lookup={},this.lookupDirect&&(this.lookupDirect=null,this.lookupDirect={}),this.nextRead=Date.now()+500),r=this.lookup[" "+i],r)?r:(!this.info.isParent&&this.info.isValidated&&this.allLoaded&&this.getDirect(i,!1,!0),!this.allLoaded&&t.isEmptyObject(this.lookup)&&!this.info.isCreadedUpdatedBy&&!this.info.isParent&&this.getDisplayType()!=n.DisplayType.Search&&(this.load(),r=this.lookup[" "+i],r!=null))?r:(u=this.info.isValidated,this.getDirect(i,!1,u))};r.prototype.getFromList=function(i){var r,u;return i==null||this.MINUS_ONE===i?null:this.info.isParent&&this.nextRead<Date.now()?(this.lookup=null,this.lookup={},this.lookupDirect&&(this.lookupDirect=null,this.lookupDirect={}),this.nextRead=Date.now()+500,this.get(i)):(r=this.lookup[" "+i],r!=null)?r:(!this.info.isParent&&this.info.isValidated&&this.allLoaded&&this.getDirectFromList(i,!1,!0),!this.allLoaded&&t.isEmptyObject(this.lookup)&&!this.info.isCreadedUpdatedBy&&!this.info.isParent&&this.getDisplayType()!=n.DisplayType.Search&&(r=this.lookup[" "+i],r!=null))?r:(u=this.info.isValidated,this.getDirectFromList(i,!1,u))};r.prototype.getDirect=function(t,i,r){var u,s,h,o,f,e,w,c,l,a,y;if(t==null||this.info.queryDirect==null||this.info.queryDirect.length==0||t===this.directNullKey)return null;if(u=null,this.lookupDirect!=null&&(u=this.lookupDirect[t],u))return u;s=this.info.keyColumn.toUpperCase().endsWith("_ID");try{h=this.info.queryDirect;o=[];s?o.push(new v.SqlParam("@key",parseInt(t))):o.push(new v.SqlParam("@key",t.toString()));f=p(h,o);f.read()?(e=f.getString(2),w=f.getString(3).equals("Y"),w||(e=this.INACTIVE_S+e+this.INACTIVE_E,this.hasInactive=!0),s?(c=f.getInt(0),l={Key:c,Name:n.Utility.encodeText(e)},i&&(this.lookup[" "+c]=l),u=l):(a=f.getString(1),y={Key:a,Name:n.Utility.encodeText(e)},i&&(this.lookup[" "+a]=y),u=y),f.read()&&this.log.log(n.Logging.Level.SEVERE,this.info.keyColumn+": Not unique (first returned) for "+t+" SQL="+h)):(this.directNullKey=t,u=null)}catch(b){this.log.log(n.Logging.Level.SEVERE,this.info.keyColumn+": SQL="+this.info.queryDirect+"; Key="+t,b);u=null}finally{f!=null&&f.dispose();f=null}return r&&!i&&u!=null&&(this.lookupDirect==null&&(this.lookupDirect={}),this.lookupDirect[t]=u),this.hasInactive=!0,u};r.prototype.getDirectFromList=function(n,t,i){var r,u,f;return n==null||this.info.queryDirect==null||this.info.queryDirect.length==0?null:n===this.directNullKey?null:(r=null,this.lookupDirect!=null&&(u=null,u=this.lookupDirect[" "+n],u&&u!=null))?u:(this.lookupDirectAll[" "+n]?(f=this.lookupDirectAll[" "+n],t&&(this.lookup[" "+n]=f),r=f):this.loading||(this.addInList(n),r=null),i&&!t&&r!=null&&(this.lookupDirect==null&&(this.lookupDirect={}),this.lookupDirect[" "+n]=r),this.hasInactive=!0,r)};r.prototype.addInList=function(t){var f,i;if(!(this.info.queryDirect.length<=0)&&t!=null){var u=this.info.keyColumn.toUpperCase().endsWith("_ID"),e=this.info.queryDirect,r=[];u?r.push(new v.SqlParam("@key",parseInt(t))):r.push(new v.SqlParam("@key",t.toString()));f=this.info.queryDirect;i=this;p(f,r,function(r){var f,e,o;try{r.read()?(f=r.getString(2),u?(e=n.Utility.Util.getValueOfInt(r.getCell(0)),i.lookupDirectAll[" "+e]={Key:e,Name:n.Utility.encodeText(f)}):(o=r.getString(1),i.lookupDirectAll[" "+o]={Key:o,Name:n.Utility.encodeText(f)})):i.directNullKey=t}catch(s){console.log(s)}i=null})}};r.prototype.load=function(t,i){var r=this.info.query,e,s,f,u;if(!this.info.isValidated){if(e=n.Env.parseContext(n.context,this.getWindowNo(),this.info.validationCode,!1,!0),e.length==0&&this.info.validationCode.length>0){this.log.fine(this.info.keyColumn+": Loader NOT Validated: "+this.info.validationCode);return}var c=r.lastIndexOf(" FROM "),h=r.indexOf(" WHERE ",c)!=-1,o=r.lastIndexOf(" ORDER BY ");o!=-1?r=r.substring(0,o)+(h?" AND ":" WHERE ")+e+r.substring(o):r+=(h?" AND ":" WHERE ")+e;this.log.fine(this.info.keyColumn+": Validation="+e)}if(s=this.info.keyColumn.toUpperCase().endsWith("_ID"),this.hasInactive=!1,f=null,this.lookup={},i&&(this.cLookup=!1,n.MLookupCache.loadFromCache(this.info,this)))return this;if(t)return u=this,u.loading=!0,b(r,1,1e3,null,function(t){u.readData(t,s);i&&n.MLookupCache.loadEnd(u.info,u);u.loading=!1;u=null}),0;try{f=p(r,null);this.readData(f,s);i&&n.MLookupCache.loadEnd(this.info,this)}catch(l){this.log.log(n.Logging.Level.SEVERE,this.info.keyColumn+": Loader - "+r,l)}finally{f!=null&&(f.dispose(),f=null)}return 0};r.prototype.fillDirectList=function(){var i,t;this.info.queryAll==null||this.info.queryAll.length<=0||(i=this.info.queryAll,this.cLookup=!0,n.MLookupCache.loadFromCache(this.info,this))||(t=this,b(i,1,1e3,null,function(i){var e,r,u,f;try{for(e=t.info.keyColumn.endsWith("_ID");i.read();)r=i.getString(2),e?(u=i.getInt(0),t.lookupDirectAll[" "+u]={Key:u,Name:n.Utility.encodeText(r)}):(f=i.getString(1),t.lookupDirectAll[" "+f]={Key:f,Name:n.Utility.encodeText(r)})}catch(o){console.log(o)}n.MLookupCache.loadEnd(t.info,t);t.loading=!1;t=null}),this.loading=!0)};r.prototype.readData=function(t,i){var u={},c=0,r,o,f,s,e,h;for(this.allLoaded=!0;t.read();){if(c++>this.MAX_ROWS){this.log.fine(this.info.keyColumn+": Loader - Too many records");this.allLoaded=!1;break}r=t.getString(2);o=t.getString(3).equals("Y");o||(r=this.INACTIVE_S+r+this.INACTIVE_E,this.hasInactive=!0);i?(f=t.getInt(0),s={Key:f,Name:n.Utility.encodeText(r)},u[" "+f]=s):(e=t.getString(1),h={Key:e,Name:n.Utility.encodeText(r)},u[" "+e]=h)}this.lookup=null;this.lookup=u;this.loading=!1};r.prototype.refresh=function(){if(this.getDisplayType()==n.DisplayType.Search||this.info.IsCreadedUpdatedBy||this.loading)return 0;return this.load()};r.prototype.clear=function(){this.$super.clear.call(this);this.lookup={}};r.prototype.getCLookup=function(){return this.cLookup&&this.lookupDirectAll,this.lookup};r.prototype.setCLookup=function(n){this.cLookup&&(this.lookupDirectAll=n);this.lookup=n};r.prototype.getIsLoading=function(){return this.loading};r.prototype.setIsLoading=function(n){this.loading=n};r.prototype.getZoomWindow=function(){if(arguments.length==0)return this.info.zoomWindow;var t=arguments[0];return n.ZoomTarget.getZoomAD_Window_ID(this.info.tableName,this.windowNo,t.getWhereClause(),n.context.isSOTrx(this.windowNo))};r.prototype.getZoomQuery=function(){return this.zomQuery};r.prototype.getAD_Reference_Value_ID=function(){return this.info.AD_Reference_Value_ID};r.prototype.disableValidation=function(){var t=this.info.validationCode;this.$super.disableValidation.call(this);this.info.isValidated=!0;this.info.validationCode="";t!=null&&t.length>0&&(t.indexOf("@")!=-1&&this.getDisplayType()==n.DisplayType.Table||this.getDisplayType()==n.DisplayType.TableDir)&&this.setDisplayType(n.DisplayType.Search)};r.prototype.dispose=function(){this.$super.dispose.call(this);this.lookupDirect=null;this.directNullKey=null;this.log=null};n.Utility.inheritPrototype(f,i);f.prototype.cacheLookup=null;f.prototype.getDisplay=function(n){if(n==null)return"";var t=this.getLocation(n,null);return t==null?"<"+n.toString()+">":t.Name};f.prototype.get=function(n){if(n==null)return null;var t=this.getLocation(n,null);return t==null?null:t};f.prototype.getColumnName=function(){return"C_Location_ID"};f.prototype.getLocation=function(t,i){if(t==null)return null;if(t in this.lookup)return this.lookup[t];var r=n.dataContext.getJSONData(n.Application.contextUrl+"Location/GetLocation",{id:t});return(this.lookup[t]=r.LocItem,this.lstLatLng[t]=r.LocLatLng,!i)?r.LocItem:r.LocLatLng};f.prototype.refreshLocation=function(t){if(t==null)return null;var i=n.dataContext.getJSONData(n.Application.contextUrl+"Location/GetLocation",{id:t});return this.lookup[t]=i.LocItem,this.lstLatLng[t]=i.LocLatLng,i};f.prototype.load=function(){var t=this;if(t.lstLatLng={},f.prototype.cacheLookup!=null){t.lookup=f.prototype.cacheLookup.LocLookup;t.lstLatLng=f.prototype.cacheLookup.LocLatLng;t=null;return}n.dataContext.getJSONData(n.Application.contextUrl+"Location/GetLocations","",function(n){f.prototype.cacheLookup||(f.prototype.cacheLookup=n);t.lookup=n.LocLookup;t.lstLatLng=n.LocLatLng;t=null})};f.prototype.getLatLng=function(n){if(n==null||n.toString().len<1)return null;if(n in this.lstLatLng)return this.lstLatLng[n];return this.getLocation(n,!0)};f.prototype.dispose=function(){this.lstLatLng=null;this.$super.dispose.call(this);this.lookup=null};n.Utility.inheritPrototype(u,i);u.prototype.getDefault=function(){return this.defaultID};u.prototype.getOnlyWarehouseID=function(){return this.onlyWarehouseID};u.prototype.getOnlyProductId=function(){return this.onlyProductID};u.prototype.getIsOnlyOutgoing=function(){return this.onlyOutgoing};u.prototype.setOnlyWarehouseID=function(n){this.onlyWarehouseID=n};u.prototype.setOnlyProductID=function(n){this.onlyProductID=n};u.prototype.setOnlyOutgoing=function(n){this.onlyOutgoing=n};u.prototype.getDirect=function(t,i){var o,u,r,f,e;if(t==null)return null;if(o="VIS_92",u=[],u[0]=new n.DB.SqlParam("@keyValue",t),r=s(o,u),f="",r.read())f=r.getString(0);else return null;return r.dispose(),e={Key:t,Name:n.Utility.encodeText(f)},i&&(this.lookup[" "+t]=e),e};u.prototype.getIsValid=function(n){if(n==null)return!0;var t=this.lookup[n];return t!=null};u.prototype.load=function(i){var o=0,c=this.getOnlyWarehouseID(),l=this.getOnlyProductId(),s=this.getIsOnlyOutgoing(),h="Value, LocatorCombination, M_Warehouse_ID, (SELECT Name FROM M_Warehouse WHERE M_Warehouse_ID = M_Locator.M_Warehouse_ID) AS Warehouse",r,f,a,u,v,e;try{}catch(y){this.log.log(n.Logging.Level.SEVERE,sql,y);h="Value"}this.lookup=null;this.lookup={};s=s!=null&&s.value?!1:!0;try{if(r=null,i){for(t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GetWareProWiseLocator",data:{colName:h,warehouseId:c,productId:l,onlyIsSOTrx:s},success:function(t){r=(new n.DB.DataSet).toJson(t)}}),f=r.getTable(0),a=f.getRows().length,u=0;u<a;u++){if(o++>this.maxRows){this.log.warning("Over Max Rows - "+o);break}v=n.Utility.Util.getValueOfString(f.getRow(u).getCell(4))+"_"+n.Utility.Util.getValueOfString(f.getRow(u).getCell(1))+"("+n.Utility.Util.getValueOfString(f.getRow(u).getCell(2))+")";this.lookup[f.getRow(u).getCell(0)]={Key:f.getRow(u).getCell(0),Name:v}}r.dispose();r=null;this.log.fine("Complete #"+o)}else e=this,t.ajax({type:"Get",async:!0,url:n.Application.contextUrl+"Form/GetWareProWiseLocator",data:{colName:h,warehouseId:c,productId:l,onlyIsSOTrx:s},success:function(t){var u,f,i;r=(new n.DB.DataSet).toJson(t);try{for(u=r.getTable(0),f=u.getRows().length,i=0;i<f;i++){if(o++>e.maxRows){e.log.warning("Over Max Rows - "+o);break}e.lookup[u.getRow(i).getCell(0)]={Key:u.getRow(i).getCell(0),Name:n.Utility.Util.getValueOfString(u.getRow(i).getCell(1))}}r.dispose();r=null;e.log.fine("Complete #"+o)}catch(s){e.log(n.Logging.Level.SEVERE,"",s)}e=null}})}catch(p){this.log.log(n.Logging.Level.SEVERE,finalSql,p)}i&&t.isEmptyObject(this.lookup)&&this.log.Finer(finalSql)};u.prototype.get=function(n){if(n==null)return null;var i=Number(n),t=this.lookup[i];return t!=null?t:this.getDirect(n,!0,null)};u.prototype.getDisplay=function(n){if(n==null)return"";var t=this.get(n);return t==null?"<"+n.toString()+">":t.Name};u.prototype.getData=function(){var n=this.lookup;return t.map(this.lookup,function(n){return n})};u.prototype.refresh=function(){this.log.fine("start");try{this.load(!0)}catch(n){this.log.severe("#"+this.lookup.Count)}return this.log.info("#"+this.lookup.Count),this.lookup.length};u.prototype.getColumnName=function(){return"M_Locator.M_Locator_ID"};u.prototype.dispose=function(){this.disposeLocal();this.$super.dispose.call(this);this.lookupDirect=null;this.directNullKey=null;this.log=null;this.disposeLocal=null};n.Utility.inheritPrototype(o,i);o.prototype.getDisplay=function(n){return this.containsKey(n)?this.toStringX():"<"+n.toString()+">"};o.prototype.toStringX=function(){return this.C_ValidCombination_ID==0?"":this.combination};o.prototype.containsKey=function(n){var t=0;return n!=null&&(t=parseInt(n.toString())),this.load(t)};o.prototype.load=function(t){var u,r,i;if(t==0)return this.C_ValidCombination_ID=0,this.combination="",this.description="",!0;if(t==this.C_ValidCombination_ID)return!0;u="VIS_94";r=[];r[0]=new n.DB.SqlParam("@ID",t);i=null;try{if(i=s(u,r),!i.read())return!1;this.C_ValidCombination_ID=i.getInt(0);this.combination=i.getString(1);this.description=i.getString(2)}catch(f){return!1}return!0};o.prototype.getColumnName=function(){return""};o.prototype.getData=function(i,r,u){var o=[],f;i||o.push({Key:-1,Name:""});f=null;try{for(t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GetValidAccountCombination",data:{AD_Client_ID:AD_Client_ID,onlyActive:u},success:function(){f=(new n.DB.DataReader).toJson(jString)}});f.read();)o.push({Key:f.getInt(0),Name:f.getString(1)+" - "+f.getString(2)})}catch(s){this.log.log(e.SEVERE,sql,s)}return o};n.Utility.inheritPrototype(a,i);a.prototype.getDisplay=function(n){if(n==null)return"";var t=this.get(n);return t==null?"<"+n.toString()+">":t.Name};a.prototype.get=function(t){var i,r,f,u;if(t==null)return null;if(i=0,t instanceof Number)i=t;else try{i=parseInt(t.toString())}catch(o){this.log.log(e.SEVERE,"Value="+t,o)}if(i==0)return this.NO_INSTANCE;r=null;try{f=[];f[0]=new n.DB.SqlParam("@M_AttributeSetInstance_ID",i);u=s("VIS_95",f);u.read()&&(r=u.getString(0),(r==null||r.length==0)&&(r=n.Logging.VLogMgt.getIsLevelFine()?"{"+i+"}":""));u.dispose();u=null}catch(o){this.log.log(e.SEVERE,"get",o)}return r==null?null:{Key:i,Name:r}};a.prototype.getColumnName=function(){return"M_AttributeSetInstance_ID"};a.prototype.dispose=function(){this.$super.dispose.call(this);this.NO_INSTANCE=null;this.log=null};n.Utility.inheritPrototype(h,i);h.prototype.getDisplay=function(n){if(n==null)return"";var t=this.get(n);return t==null?"<"+n.toString()+">":t.Name};h.prototype.get=function(t){var i,r,f,u;if(t==null)return null;if(i=0,t instanceof Number)i=t;else try{i=parseInt(t.toString())}catch(o){this.log.log(e.SEVERE,"Value="+t,o)}if(i==0)return this.NO_INSTANCE;r=null;try{f=[];f[0]=new n.DB.SqlParam("@C_GenttributeSetInstance_ID",i);u=s("VIS_96",f);u.read()&&(r=u.getString(0),(r==null||r.length==0)&&(r=n.Logging.VLogMgt.getIsLevelFine()?"{"+i+"}":""));u.dispose();u=null}catch(o){this.log.log(e.SEVERE,"get",o)}return r==null?null:{Key:i,Name:r}};h.prototype.getColumnName=function(){return"C_GenAttributeSetInstance_ID"};h.prototype.dispose=function(){this.$super.dispose.call(this);this.NO_INSTANCE=null;this.log=null};h.prototype.getData=function(i,r,u){var o=[],f;i||o.push({Key:-1,Name:""});f=null;try{for(t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GenAttributeSetInstance",data:{C_GenAttributeSet_ID:n.Env.getCtx().getContextAsInt(this.windowNo,"C_GenAttributeSet_ID"),onlyActive:u},success:function(){f=(new n.DB.DataReader).toJson(jString)}});f.read();)o.push({Key:f.getInt(0),Name:f.getString(1)+" - "+f.getString(2)})}catch(s){this.log.log(e.SEVERE,sql,s)}return o};n.MLookupFactory={get:function(t,i,r,u,f,e,o,s){var c={ctx:t.getWindowCtx(i),windowNo:i,column_ID:r,AD_Reference_ID:u,columnName:f,AD_Reference_Value_ID:e,isParent:o,validationCode:s},h=n.dataContext.getJSONData(n.Application.contextUrl+"JsonData/GetLookup",c);return new n.MLookup(h._vInfo,h)},getMLookUp:function(t,i,r,u){var o="",h=0,c=!1,l="",f=null,e;try{e=[];e[0]=new n.DB.SqlParam("@Column_ID",r);f=s("VIS_97".toString(),e,null);f.read()&&(o=f.getString(0),h=f.getInt(1),c="Y".equals(f.getString(2)),l=f.getString(3));f.close();f=null}catch(a){f!=null&&(f.close(),f=null)}return n.MLookupFactory.get(t,i,r,u,o,h,c,l)},GetLookUpInfo:function(n,t,i,r,u,f,e,o){var s={WindowNum:t,AD_Reference_ID:i,Column_ID:r,columnName:u,AD_Reference_Value_ID:f,IsParent:e,ValidationCode:o}},getLookup_TableDirEmbed:function(t,i,r,u){var h=i.substring(0,i.length-3),l=[],a=[],o,f,c,e;a[0]=new n.DB.SqlParam("@tableName",h);try{for(o=s("VIS_98",a);o.read();)l.push({ColumnName:o.getString(0),IsTranslated:o.getString(1),DisplayType:o.getInt(2),AD_Reference_Value_ID:o.getInt(3)});o.close();o=null}catch(v){return""}if(l.length==0)return"";for(f="SELECT ",c=0;c<l.length;c++)c>0&&(f=f.concat("||' - '||")),e=l[c],n.DisplayType.IsDate(e.DisplayType)||n.DisplayType.IsNumeric(e.DisplayType)?f=f.concat(n.DB.to_char(h+"."+e.ColumnName,e.DisplayType,n.Env.getAD_Language(n.Env.getCtx()))):(e.DisplayType==n.DisplayType.TableDir||e.DisplayType==n.DisplayType.Search)&&e.ColumnName.endsWith("_ID")?alert("TableDir"):f=f.concat(h).concat(".").concat(e.ColumnName);return f=f.concat(" FROM ").concat(h),f=f.concat(" WHERE ").concat(r).concat(".").concat(u),f=f.concat("=").concat(h).concat(".").concat(i),f.toString()}};n.MLookupCache={s_log:n.Logging.VLogger.getVLogger("MLookupCache"),s_loadedLookups:new n.CCache("MLookupCache"),s_sentLookups:new n.CCache("MLookupCacheSent"),s_windowLookup:{},getKey:function(t){if(t==null)return n.Env.currentTimeMillis();var i=t.windowNo+":";return i+(":"+t.keyColumn+t.AD_Reference_Value_ID+t.query+t.validationCode)},loadFromCache:function(n,i){var u=this.getKey(n),f=null,r=!0;return this.s_loadedLookups.contains(u)&&(f=this.s_loadedLookups.get(u)),f==null&&(r=!1),r&&t.isEmptyObject(f)&&(this.s_loadedLookups.remove(u),r=!1),r&&(i.setCLookup(jQuery.extend({},f)),i.setIsLoading(!1)),r||(r=!0,this.s_sentLookups.contains(u)?this.s_sentLookups.get(u).indexOf(i)==-1&&(i.setIsLoading(!0),this.s_sentLookups.get(u).push(i)):(this.s_sentLookups.add(u,[]),r=!1)),r},loadEnd:function(n,i){var f=this.getKey(n),o,e,r,u;if(i.getCLookup()&&!t.isEmptyObject(i.getCLookup())){if(this.s_loadedLookups.add(f,i.getCLookup()),this.s_sentLookups.contains(f)){for(r=this.s_sentLookups.get(f),r.length>0&&(o=""),u=0;u<r.length;u++)e=r[u],e.setCLookup(t.extend({},i.getCLookup())),e.setIsLoading(!1);r.length=0;this.s_sentLookups.remove(f)}}else if(this.s_sentLookups.contains(f)){for(r=this.s_sentLookups.get(f),u=0;u<r.length;u++)r[u].setIsLoading(!1);r.length=0;this.s_sentLookups.remove(f)}},cacheReset:function(n){for(var e=n.toString()+":",h=this.s_loadedLookups.size(),u=[],i,o,r,s,t=0,f=this.s_loadedLookups.m_cacheK.length;t<f;t++){i=this.s_loadedLookups.m_cacheK[t];try{i!=null&&i.startsWith(e)&&u.push(i)}catch(c){o=""}}for(r=0;r<u.length;r++)this.s_loadedLookups.remove(u[r]);s=this.s_loadedLookups.size()},addWindowLookup:function(n,t){if(this.s_windowLookup[n])this.s_windowLookup[n].push(t);else{var i=[];i.push(t);this.s_windowLookup[n]=i}},initWindowLookup:function(n){var t,i,r;if(this.s_windowLookup[n]){for(t=this.s_windowLookup[n],i=0,r=t.length;i<r;i++)t[i].initialize();t.length=0;delete this.s_windowLookup[n]}}};n.Utility.inheritPrototype(c,i);c.prototype.cacheLookup=null;c.prototype.getDisplay=function(n){if(n==null)return"";var t=this.get(n);return t==null?"<"+n.toString()+">":t};c.prototype.get=function(t){var i,r,f,u;if(t==null)return null;if(i=0,t instanceof Number)i=t;else try{i=parseInt(t.toString())}catch(o){this.log.log(e.SEVERE,"Value="+t,o)}if(i in this.lookup)return this.lookup[i];if(i==0)return this.NO_INSTANCE;r=null;try{f=[];f[0]=new n.DB.SqlParam("@C_DimAmt_ID",i);u=s("VIS_99",f);u.read()&&(r=u.getString(0),(r==null||r.length==0)&&(r=n.Logging.VLogMgt.getIsLevelFine()?"{"+i+"}":""));u.dispose();u=null;this.lookup[i]=r}catch(o){this.log.log(e.SEVERE,"get",o)}return r==null?null:{Key:i,Name:r}};c.prototype.getColumnName=function(){return"C_DimAmt_ID"};c.prototype.dispose=function(){this.lstLatLng=null;this.$super.dispose.call(this);this.lookup=null};n.Utility.inheritPrototype(l,i);l.prototype.cacheLookup=null;l.prototype.getDisplay=function(n){if(n==null)return"";var t=this.get(n);return t==null?"<"+n.toString()+">":t.Name};l.prototype.get=function(i){var r,u;if(i==null)return null;if(r=0,i instanceof Number)r=i;else try{r=parseInt(i.toString())}catch(f){this.log.log(e.SEVERE,"Value="+i,f)}return r in this.lookup?this.lookup[r]:r==0?this.NO_INSTANCE:(u=null,t.ajax({url:y+"ProductContainer/GetProductContainerInfo",data:{ID:r},async:!1,success:function(t){u=t?t:n.Logging.VLogMgt.getIsLevelFine()?"{"+r+"}":""},error:function(n){this.log.log(e.SEVERE,"get",n)}}),this.lookup[r]=u,u==null)?null:{Key:r,Name:u}};l.prototype.getColumnName=function(){return"M_ProductContainer_ID"};l.prototype.dispose=function(){this.lstLatLng=null;this.$super.dispose.call(this);this.lookup=null};n.MLookup=r;n.MLocationLookup=f;n.MAccountLookup=o;n.MPAttributeLookup=a;n.MGAttributeLookup=h;n.MLocatorLookup=u;n.MAmtDivLookup=c;n.MProductContainerLookup=l}(VIS,jQuery),function(n,t){function i(i,r,u,f,e){function ct(){c=t("<table style='width:100%;height:100%'><tr><td style='height:100%'><div class='vis-css-treewindow' ><\/td><\/tr><tr><td style='text-align:center'><div class='vis-tree-search'><div class='input-group'><input type='text' class='form-control ui-autocomplete-input' placeholder='Search'>  <span class='input-group-addon'><a href='#' class='glyphicon glyphicon-search'><\/a><\/span><\/div><\/div><\/td><\/tr><\/table>");h=c.find(".vis-css-treewindow");h.css({"margin-left":"5px","max-width":"295px","background-color":"#eee"});ot=c.find(".vis-tree-search");tt=c.find(".input-group-addon");it=c.find("input");a=t("<ul class='vis-apanel-rb-ul'>");w=t("<li data-action='Copy'>").text(n.Msg.getMsg("Copy"));b=t("<li data-action='Move'>").text(n.Msg.getMsg("Move"));k=t("<li data-action='Cancel'>").text(n.Msg.getMsg("Cancel"));a.append(w);o.onDemandTree&&(d=t("<li data-action='MoveHere'>").text(n.Msg.getMsg("MoveHere")),a.append(d));a.append(b).append(k)}function lt(){var h,u,i,e;if(s!=null&&l!=null&&s.data("value")!=l.data("value")){h=s.parent();s.remove();var a=h.parent().data("value"),o=null,r=l,c=0;l.data("summary")!="Y"?(r=l.parent(),c=l.index(),s.insertAfter(r.children()[c]),o=r.parent().data("value")):(u=r.find(">ul"),u.children().length>0?s.insertBefore(u.children()[c]):s.appendTo(u),o=r.data("value"),r=u);for(var f=h.children(),i=0,v=[],p=[],i=0;i<f.length;i++)e=t(f[i]),v.push(e.data("value"));if(a!=o)for(f=r.children(),i=0;i<f.length;i++)e=t(f[i]),p.push(e.data("value"));t.ajax({type:"Get",async:!0,url:n.Application.contextUrl+"Form/UpdateTree",data:{oldParentChildren:JSON.stringify(v),newParentChildren:JSON.stringify(p),oldId:a,newId:o,AD_Tree_ID:y,tableName:rt},success:function(n){console.log(n)},error:function(){}})}}function at(){g.length=0;nt.length=0;h.find("LI").each(function(n,i){var r=t(i),u=r.find(">label");u.length<1&&(u=r.find(">A"));g.push(r.data("value"));nt.push(u.text())})}function et(){var i=it.val(),n,t;if(i==null||i.length<2){o.searchNode=!1;return}n=o.containsTextInArray(nt,i,ut);n>-1?(t=g[n],o.currentNode=t,ut=n,o.setSelectedNode(t),o.selectionChangeListner?o.selectionChangeListner.nodeSelectionChanged({newValue:t,propertyName:""}):o.searchNode=!1):o.searchNode=!1}var o;this.selectionChangeListner=null;this.windowNo=i;var rt="",p=null,g=[],nt=[],ut=-1,v=null,s=null,l=null,y=0,ft=0;this.onDemandTree=f;this.currentNode=0;this.searchNode=!1;this.gc=e;var o=this,c=null,h=null,ot=null,tt=null,it=null,a=null,w,b,k,d,st=n.Application.contextUrl,ht=st+"JsonData/ExecuteNonQuer",vt=function(n,i,r){var f=r?!0:!1,u=null,e={sql:n.join("/"),param:i};return t.ajax({url:ht+"ies",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:f,data:JSON.stringify(e)}).done(function(n){u=n;r&&r(n)}),u};ct();o=this;this.setSize=function(n){h.height(n-40)};this.setTabID=function(n){ft=n};this.initTree=function(r){y=r;(this.onDemandTree=="undefined"||this.onDemandTree==null)&&(this.onDemandTree=!1);var f={AD_Tree_ID:y,editable:u,windowNo:i,onDemandTree:this.onDemandTree,AD_Tab_ID:ft};y=y;n.dataContext.getTreeAsString(f,function(n){var i,r;h.html(n);at();p=h.find(">ul");rt=p.data("tablename");p=p.find(">li>ul");o.onDemandTree&&h&&(i=h.find("ul"),i&&i.length>1&&(r=t(i.find("ul")[0]).children(),r&&r.length>0&&!o.gc.isZoomAction?t(r[0]).trigger("click"):o.gc.isZoomAction||(o.gc.query(o.selectionChangeListner.aPanel.curTab.getOnlyCurrentDays(),0,!1),o.selectionChangeListner.aPanel.setBusy(!1))))})};this.getRoot=function(){return c};h.on(n.Events.onClick,function(n){var r,u,i,f;n.target.nodeName==="INPUT"||n.target.nodeName==="LI"||n.target.nodeName==="A"?(r=t(n.target),n.target.nodeName==="INPUT"&&(r=t(n.target.parentNode)),o.selectionChangeListner&&(o.onDemandTree&&(u=c.find("*.vis-css-treewindow-selected"),u.length>0&&u.removeClass("vis-css-treewindow-selected"),i=t(t(n.target).parent()),i.find(">label").length>0?i.find(">label").addClass("vis-css-treewindow-selected"):(i.find(">a").addClass("vis-css-treewindow-selected"),t(i.find("label")[0]).addClass("vis-css-treewindow-selected"))),o.selectionChangeListner.nodeSelectionChanged({newValue:r.data("value"),propertyName:""})),n.stopPropagation()):n.target.nodeName==="SPAN"&&(n.target.parentNode.nodeName=="SPAN"||n.target.parentNode.nodeName=="LI")&&(f=t(n.target.parentNode),n.target.parentNode.nodeName==="SPAN"&&(f=t(n.target.parentNode.parentNode)),v=f,w.hide(),k.hide(),b.hide(),o.onDemandTree&&d.hide(),s!=null?(b.show(),k.show()):(w.show(),o.onDemandTree&&d.show()),t(n.target).w2overlay(a.clone(!0)))});tt.on(n.Events.onTouchStartOrClick,function(n){o.searchNode=!0;et(n)});it.on("keydown",function(n){n.keyCode==13&&(o.searchNode=!0,et(n))});a.on(n.Events.onTouchStartOrClick,"LI",function(i){var f=t(i.target).data("action"),r,e,h,c,u,a;if(f=="Copy")s=v;else if(f=="Move")l=v,lt(),s=null,l=null,v=null;else if(f=="MoveHere"){if(r=o.selectionChangeListner.vTable.getSelection(!0),e="",o.selectionChangeListner.aPanel.setBusy(!0),r&&r.length>0)for(h=o.selectionChangeListner.vTable.grid,c=o.selectionChangeListner.getMTab().gridTable.keyColumnName.toLower(),u=0;u<r.length;u++)e+=u==0?h.get(r[u]+1)[c]:","+h.get(r[u]+1)[c];a={nodeID:e,oldParentID:0,newParentID:v.data("value"),AD_Tree_ID:y};t.ajax({url:n.Application.contextUrl+"Tree/UpdateTree",dataType:"json",data:a,success:function(n){var t=n;t>0&&o.selectionChangeListner.removeRecord()},error:function(){o.selectionChangeListner.aPanel.setBusy(!1)}});v=null;s=null}else f=="Cancel"&&(s=null,v=null)});this.getRootNode=function(){return p};this.disposeLocal=function(){h.off(n.Events.onClick);tt.off(n.Events.onTouchStartOrClick);a.off(n.Events.onTouchStartOrClick);a=null;h=null;c.remove();c=null;o=null}}i.prototype.containsTextInArray=function(n,t,i){for(var r=i+1;r<n.length;r++)if(r!=-1&&n[r].trim().toLowerCase().contains(t.trim().toLowerCase()))return r;return i>-1?(i=-1,this.containsTextInArray(n,t,i)):-1};i.prototype.addSelectionChangeListner=function(n){this.selectionChangeListner=n};i.prototype.setSelectedNode=function(n){return n!=-1?this.selectID(n,!0):(this.currentNode=0,!1)};i.prototype.selectID=function(n){var r,t,u,f,i;if(!this.onDemandTree||this.searchNode){if(this.currentNode=n,this.searchNode=!1,r=this.getRoot(),t=r.find("li[data-value='"+n+"']"),t!=null&&t.length>0){for(u=r.find("*.vis-css-treewindow-selected"),u.length>0&&u.removeClass("vis-css-treewindow-selected"),t.find(">label").length>0?t.find(">label").addClass("vis-css-treewindow-selected"):t.find(">a").addClass("vis-css-treewindow-selected"),f=t;t!=null;)i=t.find("input"),i.length>0&&(i.prop("checked")||i.prop("checked",!0)),t=t.parent(),t[0].nodeName=="UL"&&(t=t.parent()),t[0].nodeName=="LI"||(t=null);return f[0].scrollIntoView(),!0}return!1}};i.prototype.nodeChanged=function(n,i,r,u,f,e){var c,l,y,s,a;if(console.log("Save="+n+", KeyID="+i+", Name="+r+", Description="+u+", IsSummary="+f+", ImageInd="+e),i!=0){var v=this.getRoot(),h=!1,o=v.find("li[data-value='"+i+"']");o!=null&&o.length>0&&(h=!0);!h&&n?this.onDemandTree?(c=v.find("*.vis-css-treewindow-selected"),c&&f&&(l=t(c.parent()).find("ul"),l&&l.length>0?t(l[0]).append(this.getNode(i,r,u,f,e,this.windowNo)):t(c.parent()).append(t("<ul>").append(this.getNode(i,r,u,f,e,this.windowNo))))):(y=this.getRootNode(),y.append(this.getNode(i,r,u,f,e,this.windowNo))):h&&n?(this.toggleTypeOfNode(o,f,i,this.windowNo,e),f&&o.find(">ul").length==0&&o.append(t("<ul>")),s=o.find(">label"),s&&s.length!=0||(s=o.find(">a")),s.length>0&&s.text(r)):h&&!n?(a=o.find(">ul"),a.length>0&&(a.remove(),this.getRootNode().append(a.children())),o.remove()):o=null;o==null}};i.prototype.getNode=function(i,r,u,f,e,o){r=n.Utility.encodeText(r);var s='<li data-value="'+i+'"';return s+=f?'data-summary="Y" class="vis-hasSubMenu"> <input type="checkbox" id="'+o+i+'"><label for="'+o+i+'">'+r+'<\/label><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span><ul><ul>':'data-summary="N">  <img src="'+n.Application.contextUrl+"Areas/VIS/Images/login/"+this.getIcon(e)+'">  <a href="javascript:void(0)" data-value="'+i+'" data-action="'+e+'" data-actionid="'+i+'"> '+r+'<\/a><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"> <\/span><\/span><\/li>',t(s)};i.prototype.getIcon=function(n){switch(n){case"W":return"mWindow.png";case"R":return"mReport.png";case"P":return"mProcess.png";case"F":return"mWorkflow.png";case"B":return"mWorkbench.png";case"X":return"mWindow.png";case"V":return"mWindow.png";case"D":return"mDocAction.png";default:return"mWindow.png"}};i.prototype.toggleTypeOfNode=function(t,i,r,u,f){var h=t.data("summary")=="Y",o,e,s;i!==h?(o=t.find(">ul"),o.remove(),t.data("summary",i?"Y":"N"),t.toggleClass("vis-hasSubMenu"),i?t.html('<input type="checkbox" id="'+u+r+'"><label for="'+u+r+'">'+name+'<\/label><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span>'):t.html('<img src="'+n.Application.contextUrl+"Areas/VIS/Images/login/"+this.getIcon(f)+'">  <a href="javascript:void(0)" data-value="'+r+'" data-action="'+f+'" data-actionid="'+r+'"> '+name+'<\/a><span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"> <\/span><\/span>'),o.length>0&&t.append(o)):i||(e=t.find(">a"),e.length>0&&(s=e.data("action"),e!=f&&(t.find(">img").attr("src",n.Application.contextUrl+"Areas/VIS/Images/login/"+this.getIcon(f)),e.data("action",f)),e=s=null))};i.prototype.dispose=function(){this.disposeLocal();this.addPropertyChangeListner=null};n.TreePanel=i}(VIS,jQuery),function(n,t){function w(n,i,r){var u=null;return t.ajax({url:tt,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function ft(i,r,u){var f=null;return i.sql=n.secureEngine.encrypt(i.sql),t.ajax({url:rt,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:r,data:JSON.stringify(i)}).done(function(n){f=n;u&&u(n)}),f}function u(){function h(){var s,h,c;r=t("<table class='vis-awindow'>");s=t("<td style='max-height:42px;'>");u=t("<td class='vis-height-full'>");e=t("<h1>");i=t('<a href="javascript:void(0)" title="'+n.Msg.getMsg("Close")+" "+n.Msg.getMsg("Shct_Close")+'" class="vis-mainMenuIcons vis-icon-menuclose"><\/a>');o=t("<div class='vis-awindow-toolbar' >");f=t("<div class='vis-awindow-header vis-menuTitle' >").append(i).append(e).append(o);s.append(f);h=t("<tr>").append(s);c=t("<tr>").append(u);r.append(h).append(c)}var f,r,u,e,i,o,s;this.name;this.windowNo;this.id;this.cPanel;this.isHeaderVisible=!0;this.onClosed;this.title="window";f=null;o=null;this.onLoad=null;h();this.setTitle=function(n){this.title=n;e.text(this.title)};this.setSize=function(n){r.height(n)};this.hideHeader=function(n){this.isHeaderVisible=!n;n?f.hide():f.show();this.sizeChanged()};this.hideCloseIcon=function(n){n?i.hide():i.show()};this.getRootLayout=function(){return r};this.getContentGrid=function(){return u};this.setToolbar=function(n){o.append(n)};s=this;i.on(n.Events.onTouchStartOrClick,function(n){n.preventDefault();n.stopPropagation();s.dispose()});this.disposeComponent=function(){s=null;i&&i.off(n.Events.onTouchStartOrClick);i=null;r&&r.remove();u&&u.remove();r=u=e=i=null;this.setTitle=null;this.name=null;this.windowNo=null;this.id=null;this.setTitle=null;this.setName=null;this.getRootLayout=null;this.getContentGrid=null;this.onLoad=null}}function i(){function rr(){k=t("<div style='position:relative;'>");g=t("<div class='vis-apanel-busy'>");a=t("<ul class='vis-appsaction-ul'>");dt=t("<div class='vis-apanel-search'>");ui=t("<div class='vis-apanel-toolbar'>").append(a);rt=t("<ul class='vis-appsaction-ul vis-apanel-nav-ul'>");ri=t("<div class='vis-apanel-nav'>").append(rt);y=t("<ul class='vis-appsaction-ul vis-apanel-tabcontrol-ul'>");w=t("<div class='vis-apanel-tabcontrol'>").append(y);d=t("<div class='vis-apanel-tab-oflow'>").hide();d.html("<a href='javascript:void(0)'><img data-dir='bf' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/thumb-"+(n.Application.isRTL?"last":"first")+".png'><\/a><a href='javascript:void(0)'><img data-dir='b' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/thumb-"+(n.Application.isRTL?"forward":"back")+".png'><\/a><a href='javascript:void(0)' ><img data-dir='r' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/thumb-"+(n.Application.isRTL?"back":"forward")+".png' /><\/a><a href='javascript:void(0)' ><img data-dir='rl' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/thumb-"+(n.Application.isRTL?"first":"last")+".png' /><\/a>");ii=t("<div class='vis-apanel-header-nav'>").hide();pt=t("<td style='width:40px;' style='height:100%' rowspan='3'>");ht=t("<div class='vis-apanel-lb'>");ti=t("<div class='vis-apanel-lb-toggle' ><img class='vis-apanel-lb-img' title='"+n.Msg.getMsg("Actions")+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/mt24.png'><\/div>");e=t("<ul class='vis-apanel-lb-ul'>");b=t('<div class="vis-apanel-lb-main">');st=t("<div class='vis-apanel-lb-oflow'>").hide();st.html("<a data-dir='u' href='javascript:void(0)'><img style='margin-left:10px' data-dir='u' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/arrow-top.png' ><\/a><a data-dir='d' href='javascript:void(0)' ><img style='margin-left:10px' data-dir='d' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/arrow-bottom.png' /><\/a>");ht.append(ti);ht.append(b);ht.append(st);pt.append(ht);wt=t("<td style='width:auto;height:100%;' rowspan='3'>");p=t("<td class='vis-apanel-table-td3' style='height:100%;' rowspan='3'>");ct=t("<a href='javascript:void(0)' class='vis-flex-prev vis-apanel-sliderBackground'>").html("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/arrow-slider.png'>");et=t("<div class='vis-apanel-bar-fixpart' style='position:absolute'>").append(ct);nt=t("<div class='vis-apanel-bar-varpart' style='overflow-y:auto'>");ut=t("<div class='vis-apanel-bar' style='position:relative'>").append(et).append(nt);lt=t("<td rowspan='3' style='height:100%;vertical-align:top;max-width:8px;display:none'>").append(ut);ni=t("<ul class='vis-apanel-rb-ul'>");ir=t("<ul class='vis-apanel-rb-ul'>");ot=t("<ul class='vis-apanel-rb-ul'>");l=n.Application.isRTL?t("<td class='vis-window-tab-td-rtl' style='display:none; max-width:"+bt+"px' rowspan='3' >"):t("<td class='vis-window-tab-td' style='display:none;max-width:"+bt+"px' rowspan='3'>");nr=t("<td style='height:"+v+"px;position:relative'setwi>").append(ii);kt=t("<td style='height:100%;'>");ft=t("<div class='vis-apanel-statusbar'>").hide();gi=t("<td style='height:"+h+"px'>").append(ft);fi=t("<tr>").append(gi);ei=t("<tr>").append(kt);oi=t("<tr>").append(pt).append(wt).append(nr).append(p).append(l).append(lt);si=t('<div class="vis-window-tab-panel-outerwrap">');at=t('<div class="vis-window-tab-panels vis-pull-left">');hi=t('<div class="vis-window-tabpanel-head vis-pull-left">');vt=t('<div class="vis-window-tab-panelContent">');ci=t(' <div class="vis-window-tab-panels-iconsbar vis-pull-right">');li=t('<div class="vis-window-tab-icons">');ai=t('<h3 class="vis-pull-left">');vi=t('<span class="vis-window-tab-infoicon">');tt=t("<ul>");yi=t('<span class="vis-pull-right">').append('<i class="glyphicon glyphicon-remove"><\/i>');li.append(tt);ci.append(vi).append(li);hi.append(ai).append(yi);at.append(hi).append(vt);si.append(at).append(ci);l.append(si);it=t("<table class='vis-apanel-table' >");k.append(it);k.append(g);r=t("<input type='text' class='vis-apanel-search' placeholder='"+n.Msg.getMsg("Search")+"'><span style='right:58px;display:none' class='glyphicon glyphicon glyphicon-remove VIS-winSearch-autocom'><\/span><span style='display:none' class='glyphicon glyphicon-chevron-down VIS-winSearch-autocom'><\/span>");gt=t("<img  title='"+n.Msg.getMsg("Search")+" "+n.Msg.getMsg("Shct_Search")+"' src='"+f.prototype.getPath()+"Sear.png'>");dt.append(r).append(gt)}function ur(){ii.append(w).append(d).append(ri);nt.append("<h1 class='vis-apnel-rb-header'>"+n.Msg.getMsg("Action")+"<\/h1>").append(ni);nt.append("<h1 class='vis-apnel-rb-header'>"+n.Msg.getMsg("Related")+"<\/h1>").append(ot);b.append(e);ii.show();ft.show();it.append(oi).append(ei).append(fi);fi=ei=oi=null}function bi(){l.css({position:"relative","z-index":""});var t="w";n.Application.isRTL&&(t="e");l.is(".ui-resizable")||l.resizable({handles:t,minWidth:102,maxWidth:bt,resize:function(n,t){i.panelWidth=t.size.width;l.css({position:"absolute",left:"","z-index":"99"})},start:function(){l.css({position:"absolute","z-index":"99"})},stop:function(t,r){i.curTab.getIncluded_Tab_ID()==0?p.css("width","0px"):p.css("width","");var u=i.curGC.getCurrentPanel();u&&u.sizeChanged&&u.sizeChanged(r.originalSize.width);n.Application.isRTL?l.css({position:"relative",right:"","z-index":""}):l.css({position:"relative",left:"","z-index":""});i.setWidth(-1,!0);i.curTab.getIncluded_Tab_ID()>0&&i.curGC.vIncludedGC.vTable.resize();i.setTabNavigation()}})}var tr,ki,di,i,wi,u;this.$parentWindow;this.ctx=n.Env.getCtx();this.curGC;this.curST;this.curTab;this.vTabbedPane=new n.VTabbedPane(!1);this.statusBar=new s;this.curWinTab=null;this.curTabIndex;this.firstTabId=null;tr=0;ki=0;this.toolbarCreated=!1;this.errorDisplayed=!1;this.isPersonalLock=n.MRole.getIsPersonalLock();this.log=n.Logging.VLogger.getVLogger("APanel");di=!1;this.isSummaryVisible=!1;var it,ri,kt,rt,dt,ui,a,ft,y,w,d,r,gt,k,g,et,nt,ut,ir,ot,ni,pt,ti,e,b,st,wt="",p,ht,ii,ct,fi,ei,oi,gi,nr,l,lt,si,at,hi,vt,ci,li,ai,vi,tt,yi,bt=t(document).width()/2,yt=[],pi={};this.defaultSearch=!0;this.isAutoCompleteOpen=!1;this.panelWidth=0;this.windowWidth=0;this.createSearchAutoComplete=function(){if(r){var u=this;t(r[0]).autocomplete({source:function(f,e){if(f.term.trim().length!=0){t(r[2]).css("transform","rotate(180deg)");var o=[];o[0]=new n.DB.SqlParam("@AD_Tab_ID",i.curTab.getAD_Tab_ID());o[1]=new n.DB.SqlParam("@AD_User_ID",i.ctx.getAD_User_ID());o[2]=new n.DB.SqlParam("@AD_Tab_ID1",i.curTab.getAD_Tab_ID());o[3]=new n.DB.SqlParam("@AD_User_ID1",i.ctx.getAD_User_ID());o[4]=new n.DB.SqlParam("@AD_Client_ID",i.ctx.getAD_Client_ID());o[5]=new n.DB.SqlParam("@AD_Tab_ID2",i.curTab.getAD_Tab_ID());o[6]=new n.DB.SqlParam("@AD_Table_ID",i.curTab.getAD_Table_ID());o[7]=new n.DB.SqlParam("@queryData",f.term);c("VIS_114",o,function(f){var h=[],l,o,a,s;if(f&&f.tables[0].rows&&f.tables[0].rows.length>0){for(h.push({title:n.Msg.getMsg("All"),name:n.Msg.getMsg("All"),code:n.Msg.getMsg("All")}),t(r[1]).css("display","block"),t(r[2]).css("display","block"),l=!1,o=0;o<f.tables[0].rows.length;o++)f.tables[0].rows[o].cells.ad_defaultuserquery_id>0?(h.push({title:f.tables[0].rows[o].cells.title,name:f.tables[0].rows[o].cells.name,code:f.tables[0].rows[o].cells.code,id:f.tables[0].rows[o].cells.ad_userquery_id,defaultids:f.tables[0].rows[o].cells.ad_defaultuserquery_id,userid:f.tables[0].rows[o].cells.ad_defaultuserquery_id}),l=!0):h.push({title:f.tables[0].rows[o].cells.title,name:f.tables[0].rows[o].cells.name,code:f.tables[0].rows[o].cells.code,id:f.tables[0].rows[o].cells.ad_userquery_id});u.toggleASearchIcons(!0,l)}else a="VIS_115",s=[],s[0]=new n.DB.SqlParam("@AD_Client_ID",i.ctx.getAD_Client_ID()),s[1]=new n.DB.SqlParam("@AD_Tab_ID",i.curTab.getAD_Tab_ID()),s[2]=new n.DB.SqlParam("@AD_Table_ID",i.curTab.getAD_Table_ID()),c(a,s,function(n){n&&n.tables[0].rows&&n.tables[0].rows.length>0&&(n.tables[0].rows[0].cells[0]>0?u.toggleASearchIcons(!0,!1):u.toggleASearchIcons(!1,!1))});e(t.map(h,function(n){return{label:n.name,value:n.name,code:n.code,title:n.title,id:n.id,defid:n.defaultids,userid:n.userid}}))})}},select:function(u,f){i.defaultSearch=!1;i.isSummaryVisible?i.curTab.setShowSummaryNodes(!0):i.curTab.setShowSummaryNodes(!1);var e=new n.Query(i.curTab.getTableName(),!1);i.curTab.searchText=f.item.value;i.curTab.userQueryID=f.item.id;f.item.code!=n.Msg.getMsg("All")&&e.addRestriction(f.item.code);i.curTab.getTableModel().setCurrentPage(1);i.curTab.setQuery(e);i.curGC.query(0,0,!1);t(r[1]).css("display","inherit");t(r[2]).css("display","inherit");t(r[2]).css("transform","rotate(360deg)");u.stopPropagation()},minLength:0,open:function(){u.isAutoCompleteOpen=!0},close:function(){t(r[2]).css("transform","rotate(360deg)");window.setTimeout(function(){u.isAutoCompleteOpen=!1},400)}});window.setTimeout(function(){t(r[0]).autocomplete().data("ui-autocomplete")._renderItem=function(r,f){var e=null,o;e=u.curTab.getTabLevel()==0?f.defaultids&&f.userid>0?t("<span title='"+n.Msg.getMsg("DefaultSearch")+"'  data-id='"+f.id+"' class='VIS-winSearch-defaultIcon'><\/span>"):t("<span title='"+n.Msg.getMsg("MakeDefaultSearch")+"' data-id='"+f.id+"' class='VIS-winSearch-NonDefaultIcon'><\/span>"):t("<span title='"+n.Msg.getMsg("DefaultSearch")+"'  data-id='"+f.id+"'><\/span>");o=t("<li>").append(t("<a style='display:block' title='"+f.title+"'>"+f.label+"<\/a>").append(e)).appendTo(r);e.on("click",function(){var r=t(this).data("id");t.ajax({url:n.Application.contextUrl+"JsonData/InsertUpdateDefaultSearch",dataType:"json",data:{AD_Tab_ID:i.curTab.getAD_Tab_ID(),AD_Table_ID:i.curTab.getAD_Table_ID(),AD_User_ID:i.ctx.getAD_User_ID(),AD_UserQuery_ID:r},success:function(){},error:function(n){console.log(n)}})});return o}},200)}};i=this;rr();ft.append(this.statusBar.getRoot());wi=n.Env.getScreenHeight()-o;it.height(wi);g.height(wi);this.setSize=function(t){it.height(t);ht.height(t);ut.height(t);ft.height(h);b.height(t-43);e.height()>b.height()&&(n.Application.isMobile||(b.height(t-83),st.show()));this.aParentDetail&&this.aParentDetail.setSize(t);g.height(t);t=null};u=function(n){i.actionPerformed(n)};this.onTabChange=function(n){i.tabActionPerformed(n)};this.statusBar.onComboChange=function(n){i.setBusy(!0);setTimeout(function(){i.curGC.navigatePageExact(n+1);i.curGC.onDemandTree||i.setBusy(!1)},100)};this.createToolBar=function(){this.aRefresh=this.addActions(this.ACTION_NAME_REFRESH,null,!0,!0,!1,u,null,"Shct_Refresh");this.aDelete=this.addActions(this.ACTION_NAME_DELETE,null,!0,!0,!1,u,null,"Shct_Delete");this.aNew=this.addActions(this.ACTION_NAME_NEW,null,!0,!0,!1,u,null,"Shct_New");this.aIgnore=this.addActions("Ignore",null,!0,!0,!1,u,null,"Shct_Ignore");this.aSave=this.addActions("Save",null,!0,!0,!1,u,null,"Shct_Save");this.aFind=this.addActions("Find",null,!0,!0,!1,u,null,"Shct_Find");this.aInfo=this.addActions("Info",null,!0,!0,!1,u,null,"Shct_Info");this.aReport=this.addActions("Report",null,!0,!0,!1,u,null,"Shct_Report");this.aPrint=this.addActions("Print",null,!0,!0,!1,u,null,"Shct_Print");a.append(this.aIgnore.getListItm());a.append(this.aNew.getListItm());a.append(this.aDelete.getListItm());a.append(this.aSave.getListItm());a.append(this.aRefresh.getListItm());a.append(this.aReport.getListItm());a.append(this.aPrint.getListItm());a.append((new f).getSeprator(!1,!0));a.append(this.aFind.getListItm());this.aPrevious=this.addActions(this.ACTION_NAME_PREV,null,!0,!0,!0,u,null,"Shct_PrevRec");this.aFirst=this.addActions(this.ACTION_NAME_FIRST,null,!0,!0,!0,u,null,"Shct_FirstRec");this.aLast=this.addActions(this.ACTION_NAME_LAST,null,!0,!0,!0,u,null,"Shct_LastRec");this.aNext=this.addActions(this.ACTION_NAME_NEXT,null,!0,!0,!0,u,null,"Shct_NextRec");this.aMulti=this.addActions("Multi",null,!1,!0,!0,u,!0,"Shct_MultiRow");this.aCard=this.addActions("Card",null,!1,!0,!0,u,null,"Shct_CardView");this.aMap=this.addActions("Map",null,!1,!0,!0,u);rt.append(this.aFirst.getListItm()).append(this.aPrevious.getListItm()).append(this.aNext.getListItm()).append(this.aLast.getListItm());rt.append(this.aMulti.getListItm());rt.append(this.aCard.getListItm());rt.append(this.aMap.getListItm().hide());this.aPageUp=this.addActions("PageUp",null,!0,!0,!0,u,null,"Shct_PageUp");this.aPageFirst=this.addActions("PageFirst",null,!0,!0,!0,u,null,"Shct_PageFirst");this.aPageLast=this.addActions("PageLast",null,!0,!0,!0,u,null,"Shct_PageLast");this.aPageDown=this.addActions("PageDown",null,!0,!0,!0,u,null,"Shct_PageDown");var t=this.gridWindow;ki=0;t.getIsAppointment()&&(this.aAppointment=this.addActions("Appointment",null,!1,!1,!1,u),e.append(this.aAppointment.getListItmIT()));t.getIsTask()&&(this.aTask=this.addActions("Task",null,!1,!1,!1,u),e.append(this.aTask.getListItmIT()));t.getIsEmail()&&(this.aEmail=this.addActions("EMail",null,!1,!1,!1,u),e.append(this.aEmail.getListItmIT()));t.getIsLetter()&&(this.aLetter=this.addActions("Letter",null,!1,!1,!1,u),e.append(this.aLetter.getListItmIT()));t.getIsSms()&&(this.aSms=this.addActions("Sms",null,!1,!1,!1,u),e.append(this.aSms.getListItmIT()));t.getIsFaxEmail()&&(this.aFaxEmail=this.addActions("FaxEmail",null,!1,!1,!1,u),e.append(this.aFaxEmail.getListItmIT()));t.getIsChat()&&(this.aChat=this.addActions(this.ACTION_NAME_CHAT,null,!1,!1,!1,u,!0),e.append(this.aChat.getListItmIT()));t.getIsAttachment()&&(this.aAttachment=this.addActions("Attachment",null,!1,!1,!1,u,!0),e.append(this.aAttachment.getListItmIT()));t.getIsHistory()&&(this.aHistory=this.addActions("History",null,!1,!1,!1,u),e.append(this.aHistory.getListItmIT()));t.getIsCheckRequest()&&(this.aRequest=this.addActions("Request",null,!0,!1,!1,u),e.append(this.aRequest.getListItmIT()));n.AEnv.getIsWorkflowProcess()&&(this.aWorkflow=this.addActions("Workflow",null,!0,!1,!1,u),e.append(this.aWorkflow.getListItmIT()));t.getIsCopyReocrd()&&(this.aCopy=this.addActions("Copy",null,!1,!1,!1,u),e.append(this.aCopy.getListItmIT()));t.getIsSubscribedRecord()&&(this.aSubscribe=this.addActions("Subscribe",null,!0,!1,!1,u,!0),e.append(this.aSubscribe.getListItmIT()));t.getIsZoomAcross()&&(this.aZoomAcross=this.addActions("ZoomAcross",null,!0,!1,!1,u),e.append(this.aZoomAcross.getListItmIT()));t.getIsCreatedDocument()&&(this.aCreateDocument=this.addActions("CreateDocument",null,!1,!1,!1,u),e.append(this.aCreateDocument.getListItmIT()));t.getIsUploadedDocument()&&(this.aUploadDocument=this.addActions("UploadDocument",null,!1,!1,!1,u),e.append(this.aUploadDocument.getListItmIT()));t.getIsViewDocument()&&(this.aViewDocument=this.addActions("ViewDocument",null,!1,!1,!1,u,!0),e.append(this.aViewDocument.getListItmIT()));t.getIsAttachDocumentFrom()&&(this.aAttachFrom=this.addActions("AttachDocumentFrom",null,!1,!1,!1,u,!0),e.append(this.aAttachFrom.getListItmIT()));t.getIsMarkToExport()&&(this.aMarkToExport=this.addActions("Mark",null,!1,!1,!1,u,!0),e.append(this.aMarkToExport.getListItmIT()));t.getIsImportMap()&&(this.aImportMap=this.addActions("Import",null,!1,!1,!1,u),e.append(this.aImportMap.getListItmIT()));t.getIsArchive();t.getIsAttachmail();t.getIsRoleCenterView();this.isPersonalLock&&(this.aLock=this.addActions("Lock",null,!0,!1,!1,u,!0),e.append(this.aLock.getListItmIT()),this.aRecAccess=this.addActions("RecordAccess",null,!0,!1,!1,u,!0),e.append(this.aRecAccess.getListItmIT()));this.aPreference=this.addActions("Preference",null,!1,!1,!0,u);n.MRole.getDefault().getIsShowPreference()&&ot.append(this.aPreference.getListItmIT());this.aHelp=this.addActions("Help",null,!0,!1,!0,u);ot.append(this.aHelp.getListItmIT());this.aCardDialog=this.addActions("CardDialog",null,!0,!1,!0,u);ot.append(this.aCardDialog.getListItmIT());this.aShowSummaryLevel=this.addActions("ShowSummaryNodes",null,!0,!1,!0,u,!0);ot.append(this.aShowSummaryLevel.getListItmIT());t=null;this.statusBar.setPageItem(this.aPageFirst.getListItm());this.statusBar.setPageItem(this.aPageUp.getListItm());this.statusBar.setComboPage();this.statusBar.setPageItem(this.aPageDown.getListItm());this.statusBar.setPageItem(this.aPageLast.getListItm());this.statusBar.render();this.toolbarCreated=!0;this.$parentWindow.setToolbar(ui);this.$parentWindow.setToolbar(dt);ur()};this.setDynamicActions=function(){if(this.curGC!=null){var n=0,t=[];if(this.curGC.leftPaneLinkItems.length>0)for(t=this.curGC.leftPaneLinkItems,n=0;n<t.length;n++)ni.append(t[n].getControl());if(n=0,this.curGC.rightPaneLinkItems.length>0)for(t=this.curGC.rightPaneLinkItems,n=0;n<t.length;n++)ni.append(t[n].getControl());t=null}};this.getRoot=function(){return k};this.getLayout=function(){return kt};this.getIncludedEmptyArea=function(){return p};this.getParentDetailPane=function(){return wt};vi.on("click",function(){et.trigger("click")});this.setTabPanelIcons=function(){var t,n;this.curGC&&(tt.empty(),tt.append(this.curGC.createTabPanel(this.curTab.getTabPanels())),this.curGC.getCurrentPanel()?(t=this.curGC.getCurrentPanelID(),n=tt.find("[data-panelid='"+t+"']").first(),n&&n.length>0?(bi(),n.trigger("click"),this.showPanelContainer(!0)):this.showPanelContainer(!1)):(n=tt.find("[default='true']").first(),n&&n.length>0?(bi(),n.trigger("click"),this.showPanelContainer(!0)):this.showPanelContainer(!1)))};this.setCurrentTabPanel=function(){if(this.curGC){var n=this.curGC.getCurrentPanel();n&&(vt.empty(),vt.append(n.getRoot()),this.showPanelContainer(!0))}};this.showTabPanel=function(n){if(n)if(l.css({display:""}),this.curTab.getIncluded_Tab_ID()>0){p.css("width","");var t=p.attr("style",t)}else l.width()<=40?p.css({width:"","padding-left":"","padding-right":""}):p.width(0);else p.css("width",""),l.css({display:""}),l.css("width","40px"),at.css("display","none")};this.setIncludedTabWidth=function(n){n?p.css("width",""):p.css("width","0px")};this.showPanelContainer=function(n){n?(l.css("width",this.panelWidth+"px"),at.css({display:"","z-index":""})):(l.css({display:""}),l.css("width","40px"),at.css("display","none"),w.css("width",""),l.is(".ui-resizable")&&l.resizable("destroy"));this.setTabNavigation()};this.setWidth=function(n){var i=this;n&&(n>0&&(n=100-n,n=t(document).width()*n/100,n>bt&&(n=bt),l.css({width:n+"px"}),i.panelWidth=n),this.refresh())};yi.on("click",function(){i.showPanelContainer(!1);i.setIncludedTabWidth(!0);i.setWidth(-1,!1);i.curGC.setCurrentPanel(null);i.setTabNavigation();var n=tt.find(".vis-selected-list")[0];t(n).removeClass("vis-selected-list")});tt.on("click",function(n){var r=t(n.target),f,u;r.is("li")?(u=r.siblings(".vis-selected-list"),u&&u.removeClass("vis-selected-list"),u.removeClass("vis-selected-list"),r.addClass("vis-selected-list"),r=r.find("img")):r.is("img")&&(f=t(r.parent()),u=f.siblings(".vis-selected-list"),u&&u.removeClass("vis-selected-list"),f.addClass("vis-selected-list"));ai.text(r.data("name"));vt.empty();i.curGC.setCurrentPanelID(r.data("panelid"));i.curGC.setCurrentPanel(r.data("cname"),i.$parentWindow.getWindowNo());vt.append(i.curGC.getCurrentPanel().getRoot());bi();l.width()<=40&&i.showPanelContainer(!0);i.curTab.getIncluded_Tab_ID()==0?i.setIncludedTabWidth(!1):i.setIncludedTabWidth(!0);i.showTabPanel(!0);i.setWidth(-1,!0);i.setTabNavigation()});this.setTabControl=function(t){var i,r;for(yt=t,i=0;i<t.length;i++)r=t[i].getListItm(),pi[yt[i].action]=r,y.append(r);y.width()>w.width()&&(n.Application.isMobile||d.show())};this.navigateToSelectedTab=function(){y.find(".vis-apanel-tab-selected")[0].scrollIntoView()};this.setTabNavigation=function(){y.width()>w.width()?n.Application.isMobile||d.show():d.hide()};this.setSelectedTab=function(n){this.selectedTab&&this.selectedTab.removeClass("vis-apanel-tab-selected");this.selectedTab=pi[n];this.selectedTab.addClass("vis-apanel-tab-selected")};this.navigateThroghtShortcut=function(n){var t=null;n?(t=y.find(".vis-apanel-tab-selected").next(),(!t||t.length<=0)&&(t=y.children().first())):(t=y.find(".vis-apanel-tab-selected").prev(),(!t||t.length<=0)&&(t=y.children().last()));t.trigger("click")};this.setBusy=function(n,t){di=n;n?g[0].style.visibility="visible":(g[0].style.visibility="hidden",t)};d.on("click",function(n){var f,e;if(n.stopPropagation(),f=t(n.target).data("dir"),f){var s=w.width(),o=y.width(),i=w.scrollLeft(),r=Math.ceil(s/2),u=0;if(f=="r"){if(i+r>=o-r)return;e=o-s;u=i+r;w.animate({scrollLeft:u>e?e:u},1e3)}else if(f=="b"){if(i==0)return;u=i-r;w.animate({scrollLeft:u<0?0:u},1e3)}if(f=="rl"){if(i+r>=o-r)return;e=o-s;w.animate({scrollLeft:e},500)}else if(f=="bf"){if(i==0)return;u=i-r;w.animate({scrollLeft:0},500)}}});st.on("click",function(n){var r,o;if(n.stopPropagation(),r=t(n.target).data("dir"),r){var s=b.height(),h=e.height(),u=b.scrollTop(),f=Math.ceil(s/2),i=0;if(r=="d"){if(u+f>=h-f)return;o=h-s;i=u+f;b.animate({scrollTop:i>o?o:i},1e3,"easeOutBounce")}else if(r=="u"){if(u==0)return;i=u-f;b.animate({scrollTop:i<0?0:i},1e3,"easeOutBounce")}}});gt.on(n.Events.onTouchStartOrClick,function(u){if(t(r[1]).is(":visible")==!0){t(r[1]).css("display","none");t(r[0]).val("");i.curTab.searchText="";var f=new n.Query;i.findRecords(f)}else i.cmd_find(r.val()),t(r[1]).css("display","none"),i.curTab.searchText="",r.val("");u.stopPropagation()});if(!n.Application.isMobile)t(r[0]).on("keyup",function(u){var e=u.charCode||u.keyCode,f;if(e==13){if(!i.defaultSearch)return;t(r[1]).css("display","none");i.cmd_find(t(r[0]).val());t(r[0]).val("")}else e==8&&t(r[1]).is(":visible")==!0&&(u.preventDefault(),i.defaultSearch=!0,t(r[1]).css("display","none"),t(r[0]).val(""),f=new n.Query,f.addRestriction(" 1 = 1 "),i.findRecords(f))});t(r[2]).on("click",function(){i.isAutoCompleteOpen?t(r[2]).css("transform","rotate(360deg)"):(t(r[2]).css("transform","rotate(180deg)"),i.refreshSavedASearchList(!0))});t(r[1]).on("click",function(){t(r[1]).css("display","none");i.defaultSearch=!0;i.curTab.searchText="";t(r[0]).val("");var u=new n.Query;i.findRecords(u);t(r[2]).css("transform","rotate(360deg)")});this.setAdvancedSerachText=function(n,i){n?t(r[1]).css("display","none"):(t(r[1]).css("display","inherit"),t(r[2]).css("display","inherit"));t(r[0]).val(i)};this.toggleASearchIcons=function(n,i){n&&i?(t(r[1]).css("display","inherit"),t(r[2]).css("display","inherit")):n&&!i?(t(r[1]).css("display","none"),t(r[2]).css("display","inherit")):(t(r[1]).css("display","none"),t(r[2]).css("display","none"))};this.setSearchFocus=function(n){n?t(r[0]).focus():t(r[0]).trigger("focusout")};this.refreshSavedASearchList=function(u,f){var e=[],o;e[0]=new n.DB.SqlParam("@AD_Tab_ID",i.curTab.getAD_Tab_ID());e[1]=new n.DB.SqlParam("@AD_User_ID",i.ctx.getAD_User_ID());e[2]=new n.DB.SqlParam("@AD_Tab_ID1",i.curTab.getAD_Tab_ID());e[3]=new n.DB.SqlParam("@AD_User_ID1",i.ctx.getAD_User_ID());e[4]=new n.DB.SqlParam("@AD_Client_ID",i.ctx.getAD_Client_ID());e[5]=new n.DB.SqlParam("@AD_Tab_ID2",i.curTab.getAD_Tab_ID());e[6]=new n.DB.SqlParam("@AD_Table_ID",i.curTab.getAD_Table_ID());o=this;c("VIS_116",e,function(i){var s=[],h,e;if(i&&i.tables[0].rows&&i.tables[0].rows.length>0)for(t(r[2]).css("display","inherit"),s.push({label:n.Msg.getMsg("All"),value:n.Msg.getMsg("All"),code:n.Msg.getMsg("All")}),h=!1,e=0;e<i.tables[0].rows.length;e++)i.tables[0].rows[e].cells.ad_defaultuserquery_id>0?(s.push({title:i.tables[0].rows[e].cells.title,label:i.tables[0].rows[e].cells.name,value:i.tables[0].rows[e].cells.name,code:i.tables[0].rows[e].cells.code,id:i.tables[0].rows[e].cells.ad_userquery_id,defaultids:i.tables[0].rows[e].cells.ad_defaultuserquery_id,userid:i.tables[0].rows[e].cells.ad_defaultuserquery_id}),h=!0):s.push({title:i.tables[0].rows[e].cells.title,label:i.tables[0].rows[e].cells.name,value:i.tables[0].rows[e].cells.name,code:i.tables[0].rows[e].cells.code,id:i.tables[0].rows[e].cells.ad_userquery_id});else o.toggleASearchIcons(!1,!1);f||(f=t(r[0]).val());f&&f.length>0?(f.length>25?t(r[0]).val(f.substr(0,25)+"..."):t(r[0]).val(f),t(r[1]).css("display","inherit"),o.defaultSearch=!1):t(r[1]).css("display","none");t(r[0]).autocomplete("option","source",s);u&&(t(r[0]).autocomplete("search",""),t(r[0]).trigger("focus"))})};this.findRecords=function(n){var t=!1,i;this.curTab.getTableModel().setCurrentPage(1);this.isSummaryVisible?this.curTab.setShowSummaryNodes(!0):this.curTab.setShowSummaryNodes(!1);this.curGC.skipRowInserting(!0);n!=null&&n.getIsActive()?(this.curTab.setQuery(n),this.curGC.query(0,0,t)):(i=0,this.curTab.setQuery(null),this.curGC.query(0,i,t))};ti.on(n.Events.onTouchStartOrClick,function(n){n.stopPropagation();n.preventDefault();var t=pt.width();t>50&&e.find("span").hide();pt.animate({width:t>50?40:200},300,"swing",function(){t<50&&e.find("span").show();i.curGC&&i.curGC.multiRowResize();i.setWidth(-1,!0);i.setTabNavigation()})});et.on("click",function(r){r.stopPropagation();var u=n.Application.isRTL;ut.width()>100?(ut.animate({left:u?0:k.width()-8+"px",width:"8px"},500,"swing",function(){nt.css({width:"0px"})}),nt.animate({width:"0px"},500,"swing"),i.curTab.getHasPanel()?(t(ct.find("img")).css({transform:"rotate(360deg)",display:"none"}),lt.css("display","none")):(t(ct.find("img")).css({transform:"rotate(360deg)"}),lt.css("display","none"))):(ut.css({position:"absolute",width:"8px",left:u?0:k.width()-8}),ut.animate({left:u?0:k.width()-220+"px",width:"220px"},500,"swing"),nt.animate({width:"212px"},500,"swing"),i.curTab.getHasPanel()?(t(ct.find("img")).css({transform:"rotate(180deg)",display:""}),lt.css("display","")):(t(ct.find("img")).css({transform:"rotate(180deg)"}),lt.css("display","")))});this.disposeComponent=function(){if(gt.off(n.Events.onTouchStartOrClick),r.remove(),r=null,ti.off(n.onTouchStartOrClick),st.off("click"),d.off("click"),k.remove(),g.remove(),it.remove(),k=g=it=ri=kt=rt=dt=ui=a=ft=null,i=null,u=null,this.toolbarCreated&&(this.aRefresh.dispose(),this.aDelete.dispose(),this.aNew.dispose(),this.aSave.dispose(),this.aPrevious.dispose(),this.aFirst.dispose(),this.aLast.dispose(),this.aNext.dispose(),this.aPageUp.dispose(),this.aPageFirst.dispose(),this.aPageLast.dispose(),this.aPageDown.dispose(),this.aCard.dispose(),this.aCardDialog.dispose(),this.aShowSummaryLevel&&this.aShowSummaryLevel.dispose(),this.aChat&&this.aChat.dispose(),this.aAppointment&&this.aAppointment.dispose(),this.aHelp.dispose(),this.aSubscribe&&this.aSubscribe.dispose(),this.aAttachment&&this.aAttachment.dispose(),this.aHistory&&this.aHistory.dispose(),this.aZoomAcross&&this.aZoomAcross.dispose(),this.aRequest&&this.aRequest.dispose(),this.aMarkToExport&&this.aMarkToExport.dispose(),this.aWorkflow&&this.aWorkflow.dispose(),this.aRecAccess&&this.aRecAccess.dispose(),this.aImportMap&&this.aImportMap.dispose(),this.aRefresh=this.aDelete=this.aNew=this.aPrevious=this.aFirst=this.aLast=this.aNext=null,this.aChat=this.aPageUp=this.aPageFirst=this.aPageLast=this.aPageDown=null,this.aHelp=this.aSubscribe=this.aAttachment=null,this.toolbarCreated=null,this.aZoomAcross=this.aRequest=this.aMark=this.aWorkflow=this.aHistory=null,this.aAppointment=null,this.aRecAccess=this.aImportMap=this.aCard=this.aCardDialog=this.aShowSummaryLevel=null),this.statusBar.dispose(),this.statusBar.onComboChange=null,this.statusBar=null,this.getRoot=null,this.getLayout=null,this.setBusy=null,this.createToolBar=null,this.$parentWindow=null,this.ctx=null,this.curGC=null,this.curST=null,this.curTab=null,this.vTabbedPane=null,this.curWinTab=null,this.curTabIndex=null,this.firstTabId=null,et.off("click"),et=null,nt=null,wt.remove(),wt=null,this.getParentDetailPane=null,yt)for(var t=0;t<yt.length;t++)yt[t].dispose();yt=null;pi=null;y.remove()}}function et(i){t.ajax({url:n.Application.contextUrl+"Posting/PostByNewLogic",dataType:"json",async:!0,data:{AD_Client_ID:n.context.getAD_Client_ID()},error:function(){n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer"))},success:function(n){i&&i(n.result)}})}function b(n,t,i,r,u,f,e){if(n.getProcess_ID()!=0){var o=!0;return u.curTab.needSave(!0,!1)&&(o=!1,u.cmd_save(!0,function(o){if(o)return nt(n,t,i,r,u,f,e)})),o?nt(n,t,i,r,u,f,e):void 0}}function nt(i,r,u,f,e,o,s){var l=i.getName(),h=!1,v=!0,a;try{if(i.getAskUserBGProcess()==!0||i.getIsBackgroundProcess()==!0){var y=t('<div class="vis-confirm-popup-check"><label>'+n.Msg.translate(n.context,"IsBackgroundProcess")+"<\/label><\/div>"),c=t('<input type="checkbox">'),p=i.getIsBackgroundProcess();c.prop("checked",p);c.prop("disabled",p);y.prepend(c);n.ADialog.confirmCustomUI("StartProcess?",!0,i.getDescription()+"\n"+i.getHelp(),"Confirm",y,function(n){if(n)return isBg=c.is(":checked"),k(i,r,u,f,s,e,h,l,isBg)})}else if(a=i.getIsBackgroundProcess(),o||i.getDescription().equals("")&&i.getHelp().equals("")||(v=!1,n.ADialog.confirm("StartProcess?",!0,i.getDescription()+"\n"+i.getHelp(),"Confirm",function(n){if(n)return k(i,r,u,f,s,e,h,l,a)})),v)return k(i,r,u,f,s,e,h,l,a)}catch(w){n.ADialog.error("Error?",!0,"error in process : "+w.message);h=!1}return!1}function k(t,i,r,u,f,e,o,s,h){var l=t.getDescription(),c,a;return(l==null||l.length==0)&&(l=s),c=new n.ProcessInfo(l,t.getProcess_ID(),i,r),c.setAD_User_ID(u.getAD_User_ID()),c.setAD_Client_ID(u.getAD_Client_ID()),c.setAD_Window_ID(e.$parentWindow===undefined?0:e.$parentWindow.AD_Window_ID),c.setIsBatch(f),c.setIsBackground(h),a=new n.ProcessCtl(e,c,null),t.isPdf?c.setFileType(n.ProcessCtl.prototype.REPORT_TYPE_PDF):t.isCsv&&c.setFileType(n.ProcessCtl.prototype.REPORT_TYPE_CSV),a.process(e.curWindowNo),o=!0,e=null,t=null,f=!1,startWOasking=!1,actionProcessAfterSave=null,o}function f(i){var u,f,r;i&&(this.action,this.toggle,this.enableDisable,this.pressed,this.isEnabled=!0,this.text,this.toolTipText,this.imageOnly,this.textOnly,this.onAction=null,this.isSmall,t.extend(!0,this,i),this.items={},this.$li,this.text||(this.text=n.I18N.getLabel(this.action),this.text.contains("&")&&(this.text=this.text.replace("&","")),this.toolTipText?(this.toolTipText=n.Msg.getMsg(this.toolTipText),this.text=this.text+" "+this.toolTipText):this.toolTipText=n.Msg.getMsg(this.action),this.toolTipText.contains("&")&&(this.toolTipText=this.toolTipText.replace("&",""))),u=this.getPath(),f=this.getPath(),this.isSmall?(u+=this.action+"16.png",(this.toggle||this.enableDisable)&&(f+=this.action+"X16.png")):(u+=this.action+"24.png",(this.toggle||this.enableDisable)&&(f+=this.action+"X24.png")),this.imgUrl=u,this.imgUrlX=f);r=this;this.getListItm=function(i){var u=t("<li>"),f=t("<div><\/div>"),e=!0;u.on(n.Events.onClick,function(n){n.stopPropagation();e&&r.onAction&&r.isEnabled&&(r.toggle&&r.setPressed(!r.pressed),e=!1,f.css("background-color","red"),setTimeout(function(){f.css("background-color","transparent");r.onAction(r.action);e=!0},10))});return this.textOnly?u.append(t("<h2>").text(this.text)):this.imageOnly?(this.img=t("<img />").attr({src:this.imgUrl,alt:this.text,title:this.text}),u.append(f),f.append(this.img)):(u.append('<ul class="vis-appsaction-ul-inner"><li><img src="'+this.imgUrl+'" title="'+this.text+'" /><\/li><li><span>'+this.text+"<\/span><\/li><\/ul>"),this.img=u.find("img")),this.$li=u,i&&(this.items[i]=u),this.$li};this.getListItmIT=function(i){if(this.$li)return this.$li;var u=t("<li>"),f=t("<div><\/div>"),e=!0;u.on(n.Events.onClick,function(n){n.stopPropagation();e&&r.onAction&&r.isEnabled&&(r.toggle&&r.setPressed(!r.pressed),e=!1,f.css("background-color","red"),setTimeout(function(){f.css("background-color","transparent");r.onAction(r.action);e=!0},10))});return this.textOnly?u.text(this.text):this.imageOnly?(this.img=t("<img />").attr({src:this.imgUrl,alt:this.text,title:this.text}),u.append(f),f.append(this.img)):(u.append('<img src="'+this.imgUrl+'"  title="'+this.text+'"   /><span> '+this.text+"<\/span>"),this.img=u.find("img")),this.$li=u,i&&(this.items[i]=u),this.$li};this.disposeComponent=function(){r=null;this.getListItm=null;this.getListItmIT=null}}function s(i){function p(){f=t("<table class='vis-statusbar-table'>");o=t("<td style='text-align:center' colspan='3' >");s=t("<td style='width:auto;white-space:nowrap;'>");c=t("<td  style='width:100%;'>");l=t("<td style='width:auto;white-space:nowrap;'>");u=t("<ul class='vis-statusbar-ul'>")}var v,y,f,o,s,u,c,l,e;this.$statusLine=t("<span>");this.$statusDB=t("<span class='vis-statusbar-statusDB'>").text("0/0");this.$infoLine=t("<span class='vis-statusbar-infoLine'>").text("info");var h=t("<span class='vis-statusbar-pageMsg'>"),a=t("<img class='vis-statusbar-img' src= '"+n.Application.contextUrl+"Areas/VIS/Images/base/seprator16.png'>"),r=t("<select class='vis-statusbar-combo'>");this.text="";this.dse;this.merror;this.mtext;v=n.Msg.getMsg("ShowingResult");y=n.Msg.getMsg("of");this.onComboChange;p();u.append(t("<li>").append(this.$statusDB));s.append(h).append(a);c.append(t("<div class='vis-statusbar-statusLine'>").append(this.$statusLine));l.append(u);o.append(this.$infoLine);i||this.$infoLine.hide();this.getRoot=function(){return f};this.render=function(){f.empty();f.append(t("<tr class='vis-height-auto'>").append(o)).append(t("<tr class='vis-height-full'>").append(s).append(c).append(l))};this.setPageItem=function(n){u.append(n)};this.setComboPage=function(){u.append(t("<li>").append(r))};this.setPageLine=function(n){var l,f,a,t;if(n!=null){var i=n.getCurrentPage(),e=n.getTotalPage(),o=n.getPageSize(),s=n.getTotalRecords(),c=(i-1)*o,u=c+o;if(u>s&&(u=s),l=v+" "+(c+1)+"-"+u+" "+y+" "+n.getTotalRecords(),h.text(l),e!=r[0].options.length){for(f=[],a=-1,t=0;t<e;t++)f[t]="<option>"+(t+1)+"<\/option>";r.empty();r.html(f.join(""))}r[0].selectedIndex!=i-1&&(r[0].selectedIndex=i-1)}};this.setComboCallback=function(n){selectionCallback=n};e=this;r.on("change",function(n){if(n.stopPropagation(),e.onComboChange)e.onComboChange(this.selectedIndex)});this.$statusDB.on("click",function(){var t=n.Msg.getMsg("Who")+e.text,i=new n.RecordInfo(t,e.dse);i.show()});this.disposeComponent=function(){e=null;f.remove();o=null;s=null;f=null;this.getRoot=null;this.onComboChange=null;u.remove();u=null;h=null;this.$statusLine=null;this.$statusDB=null;a=null;this.disposeComponent=null;this.setPageItem=null;this.getRoot=null;this.render=null;this.setPageLine=null;this.$infoLine=null;this.text=null;this.dse=null;this.merror=null;this.mtext=null;r.empty();r.remove();r=null}}function r(){function r(n){var i,r;return t.readOnly?!1:(i=t.grid.columns[n],!t.mTab.getTableModel().getIsInserting()&&i.readOnly)?!1:(r=i.gridField,r.getIsEditable(!0,!0))?!0:!1}function u(n,i){return t.readOnly?!1:i==t.indexActiveColumn&&t.indexProcessedColumn==-1?!0:f(n)?!0:!1}function f(i){var r,u;if(t.readOnly||i<0)return!1;if(t.indexActiveColumn&&t.indexActiveColumn>0)if(r=t.grid.getCellValue(i,t.indexActiveColumn),typeof r=="boolean"){if(!r)return r}else if("True".equals(r)){if("N".equals(r))return!1}else return!1;if(t.indexProcessedColumn&&t.indexProcessedColumn>0)if(u=t.grid.getCellValue(i,t.indexProcessedColumn),typeof u=="boolean"){if(u)return!1}else if("True".equals(u)||"Y".equals(u))return!1;var f=e(i),o=f[0],s=f[1],h=f[2];return n.MRole.canUpdate(o,s,t.AD_Table_ID,h,!1)}function e(i){var e=-1,u,f,r;return typeof t.indexClientColumn!="undefined"&&t.indexClientColumn!=-1&&(r=t.grid.getCellValue(i,t.indexClientColumn),r!=null&&r!==""&&(e=n.Utility.Util.getValueOfInt(r))),u=0,typeof t.indexOrgColumn!="undefined"&&t.indexOrgColumn!=-1&&(r=t.grid.getCellValue(i,t.indexOrgColumn),r!=null&&r!==""&&(u=n.Utility.Util.getValueOfInt(r))),f=0,typeof t.indexKeyColumn!="undefined"&&t.indexKeyColumn!=-1&&(r=t.grid.getCellValue(i,t.indexKeyColumn),r!=null&&r!==""&&(f=n.Utility.Util.getValueOfInt(r))),[e,u,f]}this.grid=null;this.id=null;this.$container=null;this.rendered=!1;this.onSelect=null;this.onCellEditing=null;this.onCellValueChanged=null;this.onSort=null;this.onEdit=null;this.onAdd=null;this.editColumnIndex=-1;var t=this,i={caption:"",sortable:!1,render:function(){return'<img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/pencil.png"  />'},size:"25px"};this.getEditColumn=function(){return i};this.onClick=function(n){this.readOnly||(t.skipEditing=!1,this.records.length>0&&this.records[t.mTab.getCurrentRow()].recid!=n.recid&&(t.skipEditing=!0))};this.onSingleClick=function(){};this.onSelectLocal=function(n){if(t.blockSelect){t.blockSelect=!1;return}if(t.onSelect)t.onSelect(n)};this.checkCellEditable=!0;this.onEditField=function(n){if(t.skipEditing){t.skipEditing=!1;n.isCancelled=!0;this.select({recid:n.recid});return}n.isCancelled=!r(n.column)||n.originalEvent&&n.originalEvent.altKey;t.blockSelect=!n.isCancelled};this.onChange=function(n){if(t.grid.columns[n.column].editable.type=="checkbox"){if(this.records.length>0&&this.records[t.mTab.getCurrentRow()].recid!=n.recid){n.isCancelled=!0;return}n.isCancelled=!r(n.column)}n.onComplete=function(n){var i={newValue:n.value_new,propertyName:t.grid.columns[n.column].field};if(t.onCellValueChanged)t.onCellValueChanged(i,t.grid.columns[n.column].editable.type=="checkbox")}};this.onUnSelect=function(){};this.onRowAdd=function(n){t.paintRow(n.index)};this.paintRow=function(n){var t=this.grid.records[n];if(!u(n,0)){t.style="background-color:whitesmoke";return}t&&t.style&&delete t.style};this.disposeComponenet=function(){t=null;i=null;this.getEditColumn=null;this.onClick=null}}function e(){function o(){r=t("<div class='vis-cv-body vis-noselect'>");n=t("<div class='vis-cv-main'>");f=t("<div class='vis-cv-header'>");r.append(n)}var r,n,f,u,i,e;this.cGroupInfo={};this.cCols=[];this.cConditions=[];this.cGroup=null;this.mTab;this.AD_Window_ID;this.AD_Tab_ID;this.groupCtrls=[];this.fields=[];this.grpCount=0;this.grpColName="";this.hasIncludedCols=!1;this.onCardEdit=null;n=null;u=this;o();this.getRoot=function(){return r};this.getBody=function(){return n};this.setHeader=function(n){f.text(n)};this.getHeader=function(){return f};this.sizeChanged=function(n,t){r.height(n-12+"px");this.calculateWidth(t)};this.calculateWidth=function(t){var i=this.groupCtrls.length,r,u;if(!(i<1)){if(t)if(r=262*i,r>t)n.width(262*i);else for(n.width(t),u=Math.ceil(t/i)-24;i>0;)--i,this.groupCtrls[i].setWidth(u);else n.width(262*i);this.navigate()}};n.on("click","div.vis-cv-card",function(n){var r,i,f;if(u.onCardEdit)if(r=t(n.target),r[0].nodeName=="SPAN"&&r.hasClass("vis-cv-card-edit")){if(i=r.data("recid"),i||i===0)u.onCardEdit({recid:i})}else{for(f=0;!r.hasClass("vis-cv-card");){if(f>5)break;r=r.parent();f++}if(i=r.data("recid"),i||i===0){u.onCardEdit({recid:i},!0);u.navigate(i,!1,!0)}}n.stopPropagation()});this.getAD_CardView_ID=function(){return this.AD_CardView_ID};this.getField_Group_ID=function(){return this.cGroup?this.cGroup.getAD_Field_ID():0};i=null;e=null;this.navigate=function(t,r,u){(t&&(e=t),r)||(i&&i.length>0&&i.toggleClass("vis-cv-card-selected"),i=n.find("div.vis-cv-card[name~=vc_"+e+"]"),i.length!=0&&(i.toggleClass("vis-cv-card-selected"),u||i[0].scrollIntoView()))};this.dC=function(){for(n.off("click"),this.onCardEdit=null,u=null,r.remove(),n.remove(),f.remove(),r=n=f=null,this.getRoot=this.getBody=this.setHeader=this.getHeader=this.dC=null,i=null,this.cGroupInfo={},this.cCols.length=0,this.cConditions.length=0,this.cGroup=null,this.mTab=null,this.fields.length=0,this.grpCount=null;this.groupCtrls.length>0;)this.groupCtrls.pop().dispose()}}function d(i,r,u,f,e){function c(){var n="<div class='vis-cv-cg vis-pull-left'> <div class='vis-cv-head' >"+u+"<\/div><div class='vis-cv-grpbody'><\/div><\/div>";o=t(n);s=o.find(".vis-cv-grpbody");i&&o.css({"margin-right":"0px",width:"100%"})}function a(){for(var t=null,u=0;u<r.length;u++)t=new l(f,r[u]),i&&t.getRoot().width("240px").css({margin:"5px 12px 12px 5px",float:n.Application.isRTL?"right":"left"}),h.push(t),s.append(t.getRoot()),t.evaluate(e)}var o=null,s,h=[];c();a();this.getRoot=function(){return o};this.getBody=function(){return s};this.setWidth=function(n){o.width(n)};this.dC=function(){while(h.length>0)h.pop().dispose();o.remove();o=null;s=null;this.getBody=null;this.getRoot=null}}function l(i,r){var f,s,e,o,h,u,c;for(this.record=r,f=t('<div class="vis-cv-card" data-recid='+r.recid+" name = vc_"+r.recid+" ><\/div>"),s=t('<span class="glyphicon glyphicon-pencil vis-cv-card-edit vis-pull-right" data-recid='+r.recid+"><\/span>"),f.append(s),e=null,h=0;h<i.length;h++)e=i[h],u=r[e.getColumnName().toLowerCase()],o=e.getDisplayType(),n.DisplayType.IsLookup(o)?u=e.getLookup().getDisplay(u):n.DisplayType.YesNo==o?u=u||u=="Y"?n.Msg.getMsg("Yes"):u=n.Msg.getMsg("No"):n.DisplayType.IsDate(o)&&(u=u?o==n.DisplayType.Date?Globalize.format(new Date(u),"d"):o==n.DisplayType.DateTime?Globalize.format(new Date(u),"f"):Globalize.format(new Date(u),"t"):null),u||u==0||(u=" -- "),u=w2utils.encodeTags(u),c="",c=n.Application.isRTL?"<p><strong title='"+u+"'>"+u+"<\/strong> :"+e.getHeader()+"<\/p>":"<p>"+e.getHeader()+": <strong title='"+u+"'>"+u+"<\/strong><\/p>",f.append(t(c));this.setColor=function(n,t){n&&f.css("background-color",n);t&&f.css("color",n)};s.on("touchstart",function(){t(this).css({color:"gray"})});this.getRoot=function(){return f};this.setWidth=function(n){f.width(n)};this.dC=function(){s.off("touchstart mouseover");f.remove();f=null;this.getRoot=null;this.dc=null}}function a(){function y(t,i){var u=new google.maps.Marker({position:t,animation:google.maps.Animation.DROP,map:n,title:i});u.info=new google.maps.InfoWindow({content:i});u.info.open(n,u);google.maps.event.addListener(u,"click",function(){this.info.open(n,this)});r.push(u)}function p(n,t,i){window.setTimeout(function(){y(n,t)},i)}function a(n){for(var t=0;t<r.length;t++)r[t].setMap(n),google.maps.event.clearListeners(r[t],"click"),r[t].info=null}function w(){a(null)}function v(){w();r=[]}function b(){v();n=null}function k(){n||(n=new google.maps.Map(f[0],c),d())}function d(){var r="",t=i.mapFields,n;if(t.length>1){for(n=0;n<t.length;n++)r+="<option value="+t[n].getColumnName()+" >"+t[n].getHeader()+"<\/option>";o.html(r);o[0].selectedIndex=0;nt()}else s.hide(),f.css("top","0")}function g(){f=t('<div class="vis-mv-map">');e=t('<div class="vis-apanel-busy vis-full-height">').hide();s=t('<div class="vis-mv-header"> <select class="vis-mv-select vis-pull-right" /> <\/div>');o=s.find(".vis-mv-select");h.append(s).append(f).append(e);l&&(c={center:new google.maps.LatLng(26,76),zoom:4,mapTypeId:google.maps.MapTypeId.ROADMAP})}function nt(){o.on("change",function(){i.setBusy(!0);i.curIndex=this.selectedIndex;i.setMapData(i.mapcols[i.curIndex])})}var n=null,h=t('<div class="vis-mv-main">'),f="",e="",r=[],c,u=null,o=null,s=null,i=this,l=window.google&&google.maps?!0:!1;g();this.setBusy=function(n){n?e.show():e.hide()};this.getRoot=function(){return h};this.sizeChanged=function(){};this.setMapData=function(t){var e,r,f;if(l){for(k(),v(),u=null,u=new google.maps.LatLngBounds,google.maps.event.trigger(n,"resize"),e=t.length,r=0;r<e;r++)if(t[r].Latitude&&t[r].Longitude){f=null;try{f=new google.maps.LatLng(Number(t[r].Latitude),Number(t[r].Longitude));p(f,t[r].msg,100);u.extend(f);n.fitBounds(u)}catch(o){console.log(o)}}n.fitBounds(u);i.setBusy(!1)}};this.dc=function(){b();h.remove();this.cols=this.gc=this.aPanel=this.mapcols=null;this.mapFields=null;this.curIndex=0;this.getRoot=null;this.dc=null}}var o=43,v=50,h=40,ot=n.Logging.Level,y=n.Application.contextUrl,tt=y+"JsonData/JDataSetWithCode",it=y+"JsonData/ExecuteNonQuer",rt=y+"Form/JDataSet",g=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,w(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u},c=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,w(f,e,function(t){u=(new n.DB.DataSet).toJson(t);r&&r(u)}),u},p=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u;return i&&(e.param=i),u=null,w(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u},st=function(n,i,r){var f=r?!0:!1,u=null,e={sql:n.join("/"),param:i};return t.ajax({url:it+"ies",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:f,data:JSON.stringify(e)}).done(function(n){u=n;r&&r(n)}),u},ut=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,ft(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u};u.prototype.setName=function(n){this.name=n};u.prototype.getName=function(){return this.name};u.prototype.sizeChanged=function(t,i){t||(t=n.Env.getScreenHeight());i||(i=window.innerWidth);this.setSize(t);var r=this.isHeaderVisible?o:0;this.cPanel.sizeChanged(t-r,i)};u.prototype.refresh=function(){return this.cPanel.refresh(),this};u.prototype.keyDown=function(n){return this.cPanel.keyDown&&this.cPanel.keyDown(n),this};u.prototype.navigateThroghtShortcut=function(n){var i=t(document.activeElement),r;return i&&i.length>0?(i.trigger("change"),r=this,window.setTimeout(function(){r.cPanel.navigateThroghtShortcut&&r.cPanel.navigateThroghtShortcut(n)},200)):this.cPanel.navigateThroghtShortcut&&this.cPanel.navigateThroghtShortcut(n),this};u.prototype.initWindow=function(i,r,u,f,e){var s,o;return this.cPanel=new n.APanel,s=n.Env.getWindowNo(),this.id=s+"_"+i,this.hid=f+"="+i,o=this,n.AEnv.getGridWindow(s,i,function(i){if(i.error!=null){n.ADialog.error(i.error);o.dispose();o=null;return}var f=t.parseJSON(i.result);n.context.setContextOfWindow(t.parseJSON(i.wCtx),s);o.cPanel.initPanel(f,r,o,!1,e);o.sizeChanged();o.cPanel.createSearchAutoComplete();o.cPanel.selectFirstTab(r!=null);n.MLookupCache.initWindowLookup(s);u&&u(o.id,null,o.name,o.hid);o.onLoad&&o.onLoad();f=null;o=null}),this.AD_Window_ID=i,this.windowNo=s,this.getRootLayout().id=this.id,this.getRootLayout().attr("id","AS_"+this.id),this.getContentGrid().append(this.cPanel.getRoot()),!0};u.prototype.setCFrameContent=function(n,t){this.cPanel=n;this.windowNo=t;this.id=this.windowNo+"_CFrame";this.getRootLayout().id=this.id;this.getRootLayout().attr("id","AS_"+this.id);this.getContentGrid().append(this.cPanel.getRoot())};u.prototype.initForm=function(i,r,u){var e,f;return this.cPanel=new n.AForm(n.Env.getScreenHeight()-o),e=n.Env.getWindowNo(),this.id=e+"_"+i,this.hid=u+"="+i,f=this,n.dataContext.getFormDataString({AD_Form_ID:i},function(i){if(i.error!=null){n.ADialog.error(i.error);f.dispose();f=null;return}var u=t.parseJSON(i.result);if(u.IsError){n.ADialog.error(u.Message);f.dispose();f=null;return}if(f.setTitle(u.DisplayName),f.setName(u.DisplayName),!f.cPanel.openForm(u,f,e)){f.dispose();f=null;return}r&&r(f.id,null,f.name,f.hid);u=null;f=null}),this.windowNo=e,this.getRootLayout().id=this.id,this.getRootLayout().attr("id","AS_"+this.id),this.getContentGrid().append(this.cPanel.getRoot()),!0};u.prototype.initProcess=function(i,r,u,f,e){var h,s;return this.cPanel=new n.AProcess(i,n.Env.getScreenHeight()-o,f,e),h=n.Env.getWindowNo(),this.id=h+"_"+i,this.hid=u+"="+i,s=this,n.dataContext.getProcessDataString({AD_Process_ID:i},function(u){if(u.error!=null){n.ADialog.error(u.error);s.dispose();s=null;return}var f=t.parseJSON(u.result);if(f.IsError){n.ADialog.error(f.Message);s.dispose();s=null;return}if(s.setTitle(""),s.setName(f.Name),f.AD_Process_ID=i,!s.cPanel.init(f,s,h)){s.dispose();s=null;return}r&&r(s.id,null,s.name,s.hid);f=null;s=null}),this.windowNo=h,this.getRootLayout().id=this.id,this.getRootLayout().attr("id","AS_"+this.id),this.getContentGrid().append(this.cPanel.getRoot()),!0};u.prototype.refreshProcess=function(n,t,i,r,u){return this.cPanel&&(this.cPanel.disposeComponent(),this.cPanel=null),r=!0,this.initProcess(n,t,i,r,u),u.disposeComponent&&(u.getParameterContainer().empty().append(this.cPanel.getParametersContainer()),this.cPanel.getContentTable().css("height",u.getContentContainer().height()),u.getContentContainer().empty().append(this.cPanel.getContentTable()).append(this.cPanel.getBusyIndicator()).css("position","relative"),u.getToolbarContainer().empty().append(this.cPanel.getToolbar())),this.cPanel};u.prototype.getProcessPanel=function(){return this.cPanel};u.prototype.getTitile=function(){return this.title};u.prototype.getAD_Window_ID=function(){return this.AD_Window_ID};u.prototype.show=function(n,t){return n.append(this.getRootLayout()),t&&t(this.id,null,this.name,this.hid),!0};u.prototype.refreshData=function(){this.cPanel.refreshData()};u.prototype.getId=function(){return this.id};u.prototype.getWindowNo=function(){return this.windowNo};u.prototype.dispose=function(){(!this.onClosed||this.onClosed(this.id,this.$layout,this.hid,this.AD_Window_ID))&&(this.onClosed=null,this.cPanel&&this.cPanel.dispose(),this.cPanel=null,this.children=null,this.disposeComponent())};i.prototype.ACTION_NAME_FIRST="First";i.prototype.ACTION_NAME_LAST="Last";i.prototype.ACTION_NAME_PREV="Previous";i.prototype.ACTION_NAME_NEXT="Next";i.prototype.ACTION_NAME_NEW="New";i.prototype.ACTION_NAME_DELETE="Delete";i.prototype.ACTION_NAME_REFRESH="Refresh";i.prototype.ACTION_NAME_FIND="Find";i.prototype.ACTION_NAME_CHAT="Chat";i.prototype.ACTION_NAME_APPOINTMENT="Appointment";i.prototype.ACTION_NAME_ARCHIVE="Archive";i.prototype.keyDown=function(n){if(n.altKey&&this.curGC){var t=this.aNew.getIsEnabled();switch(n.keyCode){case 78:t&&this.actionPerformed(this.aNew.getAction());break;case 83:this.ShortcutNavigation(this.aSave.getAction());break;case 68:t&&this.actionPerformed(this.aDelete.getAction());break;case 90:t||this.actionPerformed(this.aIgnore.getAction());break;case 80:t&&this.actionPerformed(this.aPrint.getAction());break;case 82:t&&this.actionPerformed(this.aReport.getAction());break;case 81:t&&this.actionPerformed(this.aRefresh.getAction());break;case 65:this.actionPerformed(this.aFind.getAction());break;case 70:this.setSearchFocus(!0);break;case 37:this.ShortcutNavigation(this.aFirst.getAction());break;case 39:this.ShortcutNavigation(this.aLast.getAction());break;case 38:this.ShortcutNavigation(this.aPrevious.getAction());break;case 40:this.ShortcutNavigation(this.aNext.getAction());break;case 84:this.actionPerformed(this.aMulti.getAction());break;case 86:this.actionPerformed(this.aCard.getAction());break;case 88:this.$parentWindow.dispose();break;case 33:if(n.ctrlKey){this.aPageFirst.isEnabled&&this.ShortcutNavigation(this.aPageFirst.getAction());break}else{this.aPageUp.isEnabled&&this.ShortcutNavigation(this.aPageUp.getAction());break}case 34:if(n.ctrlKey){this.aPageLast.isEnabled&&this.ShortcutNavigation(this.aPageLast.getAction());break}else{this.aPageDown.isEnabled&&this.ShortcutNavigation(this.aPageDown.getAction());break}}n.preventDefault();n.stopPropagation()}else n.keyCode==112&&(this.actionPerformed(this.aHelp.getAction()),n.preventDefault(),n.stopPropagation())};i.prototype.ShortcutNavigation=function(n){var r=this,i=t(document.activeElement);i&&i.length>0&&i.trigger("change");window.setTimeout(function(){r.actionPerformed(n)},200)};i.prototype.sizeChanged=function(n,t){this.setSize(n,t);this.vTabbedPane&&this.vTabbedPane.sizeChanged(n-(v+h),t)};i.prototype.refresh=function(){this.curGC&&(this.curGC.vTable.resize(),this.curGC.vIncludedGC&&this.curGC.vIncludedGC.vTable.refresh())};i.prototype.refreshData=function(){var n=this;window.setTimeout(function(){n.curTab.getAD_Tab_ID()==n.firstTabId.split("_")[1]?n.curGC.dataRefreshAll():n.selectFirstTab(!1,function(){n.curGC.dataRefreshAll()});n.setBusy(!1)},100);this.setBusy(!0)};i.prototype.addActions=function(t,i,r,u,f,e,o,s){var t=new n.AppsAction({action:t,parent:i,enableDisable:r,toggle:o,imageOnly:u,isSmall:f,onAction:e,toolTipText:s});return t};i.prototype.initPanel=function(i,r,u,f,e){var a,y,o,p,g,k,w,d,s,v,b,it,l,nt,rt;this.$parentWindow=u;a=new n.GridWindow(i);this.gridWindow=a;this.createToolBar();var h=u.getWindowNo(),tt=this.ctx.isAutoNew(),c=a.getTabs();for(this.ctx.setAutoCommit(h,this.ctx.isAutoCommit()),this.ctx.setAutoNew(h,tt),this.ctx.setIsSOTrx(h,a.getIsSOTrx()),!tt&&a.getIsTransaction()&&this.ctx.setAutoNew(h,!0),this.ctx.setContext(h,"WindowName",a.getName()),!r&&e&&(r=new n.Query,y=c[0].getKeyColumnName(),y.length==0&&(y=c[0].getLinkColumnName()),y.length!=0&&(y.endsWith("_ID")?r.addRestriction(y,n.Query.prototype.EQUAL,e):r.addRestriction(y,n.Query.prototype.EQUAL,e))),p=[],g={},a.getHasPanel()&&(k=a.getWindowWidth(),k&&k>0&&k<75?this.setWidth(k,!0):this.setWidth(75,!0)),w=!1,d=!0,s=0;s<c.length;s++)v=h+"_"+c[s].getAD_Tab_ID(),p[s]=new n.AppsAction({action:v,text:c[s].getName(),toolTipText:c[s].getDescription,textOnly:!0}),o=c[s],d&&(s===0&&(r==null||r.list!=null&&r.list.length==0)?(this.curTab=o,this.firstTabId=v,w=!0,d=!1,r!=null&&o.setQuery(r)):r!=null&&r.list!=null&&r.list.length>0&&o.getKeyColumnName().toUpperCase()==r.list[0].columnName.toUpperCase()&&(this.firstTabId=v,o.setQuery(r),this.curTab=o,w=!0,d=!1,s>0&&this.setParentsContext(c,s))),b=null,o.getIsSortTab()?(it=new n.VSortTab(h,o.getAD_Table_ID(),o.getAD_ColumnSortOrder_ID(),o.getAD_ColumnSortYesNo_ID(),o.getIsReadOnly(),v),b=it):(l=new n.GridController(!0,!0,v),l.initGrid(!1,h,this,o),w&&(this.curGC=l,w=!1),s!==0||w||(this.curTab=o,this.curGC=l,this.firstTabId=v),b=l,s===0&&f&&l.switchSingleRow(),o.getIncluded_Tab_ID()!=0&&(g[o.getIncluded_Tab_ID()]=l,s==0&&(this.aParentDetail=new n.AParentDetail(l,this.getParentDetailPane()))),t.isEmptyObject(g)||(nt=g[o.getAD_Tab_ID()],nt!=null&&(rt=nt.includeTab(l)))),this.vTabbedPane.addTab(v,o,b,p[s]),b&&this.getLayout().append(b.getRoot()),p[s].onAction=this.onTabChange;d&&r!=null&&c[0].setQuery(r);this.setTabControl(p);p=null;this.ctx.setWindowContext(h,"WindowName",i._vo.DisplayName);u.setTitle(n.Env.getHeader(this.ctx,h));u.setName(i._vo.DisplayName);this.curWindowNo=h;i=null;u=null};i.prototype.setParentsContext=function(t,i){for(var u=[],f=t[i].query.list[0].code,e,o,r=i-1;r>=0;r--)t[r].getTabLevel()!=t[i].getTabLevel()&&t[r].getTabLevel()<t[i].getTabLevel()&&(u.push({TabNo:t[r].getTabNo(),columnName:t[r].getKeyColumnName(),childTableKeyColumn:t[i].getKeyColumnName(),index:r}),i=r);if(u)for(e=t[i].getWindowNo(),r=0;r<u.length;r++)f&&(t[u[r].index].query.addRestriction(u[r].childTableKeyColumn,n.Query.prototype.EQUAL,f),t[u[r].index].setIsZoomAction(!0)),o={SelectColumn:u[r].columnName,SelectTable:u[r].childTableKeyColumn.substr(0,u[r].childTableKeyColumn.length-3),WhereColumn:u[r].childTableKeyColumn,WhereValue:f},f=n.dataContext.getJSONData(n.Application.contextUrl+"JsonData/GetZoomParentRec",o),f&&n.context.setWindowContext(e,u[r].columnName,f.toString())};i.prototype.selectFirstTab=function(n){this.curTab.setIsZoomAction(n);setTimeout(function(n){n.tabActionPerformed(n.firstTabId);n.setTabNavigation();n=null},10,this)};i.prototype.getIsUILocked=function(){return this.isLocked};i.prototype.lockUI=function(){this.setBusy(!0,!1)};i.prototype.unlockUI=function(t){var r=t!=null&&t.getAD_Process_ID()!=this.curTab.getAD_Process_ID(),i;r&&(this.curTab.dataRefresh(),t.getIsTimeout()&&n.context.setWindowContext(this.curWindowNo,"Processed","Y"),this.curGC.dynamicDisplay(-1),this.setStatusLine(t.getSummary(),t.getIsError()),n.ProcessInfoUtil.setLogFromDB(t),i=t.getLogInfo(),i.length>0&&(n.ADialog.info(t.getTitle(),!0,i,""),this.setStatusLine(t.getSummary(),t.getIsError())));this.setBusy(!1,r)};i.prototype.actionPerformed=function(t){if(!this.getIsUILocked()){var i=this;setTimeout(function(){if(t.source instanceof n.Controls.VButton){i.actionButton(t.source)||i.setBusy(!1,!0);return}i.actionPerformedCallback(i,t)});this.setBusy(!0)}};i.prototype.actionPerformedCallback=function(i,r){var o,u,f,e,s,h;i.aFirst.getAction()===r?(i.isDefaultFocusSet=!1,i.curGC.navigate(0)):i.aPrevious.getAction()===r?(i.isDefaultFocusSet=!1,i.curGC.navigateRelative(-1)):i.aLast.getAction()===r?(i.isDefaultFocusSet=!1,i.curGC.navigate(i.curTab.getRowCount()-1)):i.aNext.getAction()===r?(i.isDefaultFocusSet=!1,i.curGC.navigateRelative(1)):i.aMulti.getAction()===r?(i.aMulti.setPressed(!i.curGC.getIsSingleRow()),i.curGC.switchRowPresentation()):i.aCard.getAction()===r?(i.aMulti.setPressed(!1),i.curGC.switchCardRow()):i.aMap.getAction()===r?(i.aMulti.setPressed(!0),i.curGC.switchMapRow()):i.aPageUp.getAction()===r?(i.isDefaultFocusSet=!1,i.curGC.navigatePage(-1)):i.aPageFirst.getAction()===r?(i.isDefaultFocusSet=!1,i.curGC.navigatePage(0)):i.aPageDown.getAction()===r?(i.isDefaultFocusSet=!1,i.curGC.navigatePage(1)):i.aPageLast.getAction()===r?(i.isDefaultFocusSet=!1,i.curGC.navigatePage("last")):i.aRefresh.getAction()===r?i.cmd_refresh():i.aIgnore.getAction()===r?i.cmd_ignore():i.aSave.getAction()===r?i.cmd_save(!0):i.aNew.getAction()===r?i.cmd_new(!1):i.aCopy&&i.aCopy.getAction()===r?i.cmd_new(!0):i.aDelete.getAction()===r?i.cmd_delete():i.aFind.getAction()===r?i.cmd_finddialog():i.aChat&&i.aChat.getAction()===r?i.cmd_chat():i.aAttachment&&i.aAttachment.getAction()===r?i.cmd_attachment():i.aHistory&&i.aHistory.getAction()==r?i.cmd_history():i.aPreference.getAction()===r?i.cmd_preference():i.aHelp.getAction()===r?i.cmd_help():i.aCardDialog.getAction()===r?i.cmd_cardDialog():i.aAppointment&&i.aAppointment.getAction()===r?i.cmd_appointment():i.aTask&&i.aTask.getAction()===r?i.cmd_task():i.aSubscribe&&i.aSubscribe.getAction()===r?i.cmd_subscribe():i.aImportMap&&i.aImportMap.getAction()===r?i.cmd_ImportMap():i.aEmail&&i.aEmail.getAction()===r?i.cmd_email():i.aLetter&&i.aLetter.getAction()===r?i.cmd_letter():i.aSms&&i.aSms.getAction()===r?i.cmd_sms():i.aInfo.getAction()===r?i.cmd_infoWindow():i.aZoomAcross&&i.aZoomAcross.getAction()===r?i.cmd_zoomAcross():i.aRequest&&i.aRequest.getAction()===r?i.cmd_request():i.aReport.getAction()===r?i.cmd_report():i.isPersonalLock&&i.aLock.getAction()===r?i.cmd_lock():i.isPersonalLock&&i.aRecAccess.getAction()===r?i.cmd_recAccess():i.aWorkflow!=null&&r===i.aWorkflow.getAction()?i.curTab.getRecord_ID()>0&&n.AEnv.startWorkflowProcess(i.curTab.getAD_Table_ID(),i.curTab.getRecord_ID()):i.aPrint.getAction()===r?i.cmd_print():i.aCreateDocument&&i.aCreateDocument.getAction()===r?window.VADMS?(u=new n.CFrame,o=new window.VADMS.editDocument(0,"",0,"",0,null,"",i.curTab.getAD_Window_ID(),i.curTab.getAD_Table_ID(),i.curTab.getRecord_ID()),u.setName(n.Msg.getMsg("VADMS_CreateDocument")),u.setTitle(n.Msg.getMsg("VADMS_CreateDocument")),u.hideHeader(!0),u.setContent(o),o.initialize(),u.show()):n.ADialog.error("PleaseInstallDMSModule",!0,""):i.aUploadDocument&&i.aUploadDocument.getAction()===r?window.VADMS?window.VADMS.uploaddocument(0,i.curTab.getAD_Window_ID(),i.curTab.getAD_Table_ID(),i.curTab.getRecord_ID()):n.ADialog.error("PleaseInstallDMSModule",!0,""):i.aViewDocument&&i.aViewDocument.getAction()===r?window.VADMS?(u=new n.CFrame,f=new window.VADMS.DocumentManagementSystem,u.setName(n.Msg.getMsg("VADMS_Document")),u.setTitle(n.Msg.getMsg("VADMS_Document")),u.hideHeader(!0),f.setWindowNo(n.Env.getWindowNo()),f.setWindowID(i.curTab.getAD_Window_ID()),f.setTableID(i.curTab.getAD_Table_ID()),f.setRecordID(i.curTab.getRecord_ID()),f.setWindowName(i.gridWindow.getName()),u.setContent(f),f.initialize(),u.show()):n.ADialog.error("PleaseInstallDMSModule",!0,""):i.aAttachFrom&&i.aAttachFrom.getAction()===r?window.VADMS?(e=i,s=n.context.getContext("VADMS_Document_ID"),s.length>0&&(h={docID:s,winID:i.curTab.getAD_Window_ID(),tableID:i.curTab.getAD_Table_ID(),recID:i.curTab.getRecord_ID()},t.ajax({url:n.Application.contextUrl+"JsonData/AttachFrom",dataType:"json",data:h,success:function(t){JSON.parse(t)=="OK"?(e.curTab.loadDocuments(),e.aViewDocument.setPressed(e.curTab.hasDocument()),n.ADialog.confirm("AttachWithOther",!0,"","Confirm",function(t){t||n.context.setContext("VADMS_Document_ID",0)}),e=null):n.ADialog.error("NotAttached",!0,"")}}))):n.ADialog.error("PleaseInstallDMSModule",!0,""):i.aMarkToExport&&i.aMarkToExport.getAction()===r?i.cmd_markToExport():i.aShowSummaryLevel.getAction()==r&&i.ShowSummaryNodes();i.setBusy(!1);i=null};i.prototype.actionButton=function(t){var e=!1,o=!1,s=null,u=t.getColumnName(),i=n.context,r=this,h,c,f;if(u.equals("Record_ID")){h=i.getContextAsInt(this.curWindowNo,"AD_Table_ID");c=i.getContextAsInt(this.curWindowNo,"Record_ID");n.AEnv.zoom(h,c);return}return f=!0,this.curTab.needSave(!0,!1)&&(f=!1,this.cmd_save(!0,function(n){n&&r.actionButtonCallBack(t,e,o,s,u,i,r)})),f?r.actionButtonCallBack(t,e,o,s,u,i,r):void 0};i.prototype.actionButtonCallBack=function(i,r,u,f,e,o,s){var d=this.curTab.getAD_Table_ID(),h=this.curTab.getRecord_ID(),g,v,c,w,l,a,nt,y,p,k,tt,it;if(h==-1&&this.curTab.getKeyColumnName().equals("AD_Language")&&(h=o.getContextAsInt(this.curWindowNo,"AD_Language_ID")),h==-1&&(i.getProcess_ID()==306||i.getProcess_ID()==307)&&(g=this.curTab.getValue("AD_ChangeLog_ID"),h=g),h==-1&&this.curTab.getKeyColumnName().equals("EntityType")&&(h=this.curTab.getValue("AD_EntityType_ID")),h==-1&&this.curTab.getKeyColumnName().toUpperCase().endsWith("_ID")){n.ADialog.error("SaveErrorRowNotFound",!0,"");return}if(e.equals("PaymentRule")){v=new n.VPayment(this.curWindowNo,this.curTab,i);v.show();v.init();v.onClose=function(){v.isInitOK()&&(s.curGC.dynamicDisplay(i.getName()),s.cmd_save(!1),b(i,d,h,o,s,r,u))};return}if(e.equals("DocAction")){c=new n.VDocAction(this.curWindowNo,this.curTab,h);c.show();c.onClose=function(){if(c.getNumberOfOptions()==0){c.dispose();s.log.info("DocAction - No Options");return}if(!c.isStartProcess()){c.dispose();return}u=c.isBatch();r=!0;b(i,d,h,o,s,r,u);c.dispose();s=null};return}if(e.equals("CreateFrom")){if(w=!1,(this.curTab.getAD_Window_ID()==341||this.curTab.getAD_Window_ID()==170)&&(window.MMPM?(a=MMPM.Requisition.prototype.create(this.curTab.getAD_Window_ID(),this.curTab.getRecord_ID()),w=!0):window.DTD001&&(a=DTD001.Requisition.prototype.create(this.curTab.getAD_Window_ID(),this.curTab.getRecord_ID()),w=!0)),w)return;if(l=n.VCreateFrom.prototype.create(this.curTab),l!=null){l.isInitOK()?(l.showDialog(),l.onClose=function(){l.dispose();this.curTab.dataRefresh()},l=null):l.dispose();return}}else{if(e.equals("GenerateSticker")){window.DTD001&&(a=DTD001.StickerProduct.prototype.create(this.curTab.getAD_Window_ID(),this.curTab.getRecord_ID()));return}if(e.equals("DTD001_GenerateSticker")){window.DTD001&&(a=DTD001.MRProductSticker.create(this.curTab.getAD_Window_ID(),this.curTab.getRecord_ID(),this.curTab.getTabLevel()));return}if(e.equals("BGT01_CreateLinePo")){window.BGT01&&BGT01.CreateLineMovement(this.curTab.getAD_Window_ID(),this.curTab.getAD_Tab_ID(),this.curTab.getRecord_ID());return}if(e=="Posted"&&n.MRole.getDefault().getIsShowAcct()){if(nt=n.context.getWindowContext(this.curWindowNo,"Processed"),nt!="Y"&&(y=n.context.getWindowContext(this.curWindowNo,"DocStatus"),DocActionVariables.STATUS_Completed!=y&&DocActionVariables.STATUS_Closed!=y&&DocActionVariables.STATUS_Reversed!=y&&DocActionVariables.STATUS_Voided!=y)){n.ADialog.info(n.Msg.getMsg("PostDocNotComplete"));return}return p=this.curTab.getValue("Posted"),p!=null&&p=="Y"?(k=new n.AcctViewer(n.context.getAD_Client_ID(),this.curTab.getAD_Table_ID(),this.curTab.getRecord_ID(),this.curWindowNo,this.curTab.getAD_Window_ID()),k!=null&&(this.setBusy(!1),k.showDialog()),k=null):n.ADialog.confirm("PostImmediate?",!0,"","Confirm",function(i){var r=s,u;if(i)r.setBusy(!0,!0),u=p!=null&&p!="N",et(function(i){var f=!1;if(i=="Yes"&&(f=!0),window.FRPT&&f){var e=Number(n.context.getWindowTabContext(r.curWindowNo,0,"AD_Org_ID")),o=r.curTab.getAD_Window_ID(),s=Number(n.context.getWindowTabContext(r.curWindowNo,0,"C_DocType_ID")),h=FRPT.PostingLogic(r.curWindowNo,r.curTab.getAD_Table_ID(),r.curTab.getRecord_ID(),u,e,o,s);r.curGC.dataRefresh();r.setBusy(!1,!0);return}t.ajax({url:n.Application.contextUrl+"Posting/PostImmediate",dataType:"json",data:{AD_Client_ID:n.context.getAD_Client_ID(),AD_Table_ID:r.curTab.getAD_Table_ID(),Record_ID:r.curTab.getRecord_ID(),force:u},error:function(){r.setBusy(!1,!0);n.ADialog.info("ERRORGettingPostingServer")},success:function(t){t.result!="OK"?(r.setBusy(!1,!0),n.ADialog.info(t.result)):(r.setBusy(!1,!0),r.curGC.dataRefresh())}})});else return r.setBusy(!1,!0),!1}),!1}if(e.equals("SendNewEMail"))return}if(i.AD_Process_ID>0)return tt=b(i,d,h,o,s),s=null,tt;i.AD_Form_ID>0&&(n.MRole.getFormAccess(i.AD_Form_ID)?it=new n.WForm(n.Env.getScreenHeight(),i.AD_Form_ID,this.curTab,this.curWindowNo):n.ADialog.warn("AccessTableNoView"))};i.prototype.tabActionPerformed=function(t){var i,h,u,c,o;if(!this.vTabbedPane.getIsTabChanged(t))return console.log("tabNotChange"),!1;var l=!1,f=!1,e=this.vTabbedPane.getTabElement(t),r=this.curST||this.curGC,s=null;if(this.toggleASearchIcons(!1,!1),this.setAdvancedSerachText(!0,""),i=this,!this.vTabbedPane.getIsWorkbench()){if(this.curWinTab=this.vTabbedPane,h=this.curWinTab.getSelectedIndex(),l=h<this.curTabIndex,u=null,c=null,e instanceof n.VSortTab?(c=e,f=!0):u=e,o=!0,this.curGC!=null){if(this.curTab.needSave(!0,!1))if(this.curTab.needSave(!0,!0))if(this.ctx.isAutoCommit(this.curWindowNo)){if(!this.curTab.dataSave(!0))return this.vTabbedPane.restoreTabChange(),this.setBusy(!1,!0),!1}else o=!1,n.ADialog.confirm("SaveChanges?",!0,this.curTab.getCommitWarning(),"Confirm",function(n){if(n){if(!i.curTab.dataSave(!0))return i.vTabbedPane.restoreTabChange(),i.setBusy(!1,!0),!1}else i.curTab.dataIgnore();r=i.curGC;s=i.curGC;i.curGC=null;i.curST!=null&&(i.curST.saveData(),i.curST.unRegisterAPanel(),r=i.curST,i.curST=null);i.curTabIndex=h;f||(i.curGC=u);i.tabActionPerformedCallback(t,l,f,e,r,s,u,c)});else i.curTab.dataIgnore();o&&(r=this.curGC,s=this.curGC,this.curGC=null)}o&&(this.curST!=null&&(this.curST.saveData(),this.curST.unRegisterAPanel(),r=this.curST,this.curST=null),this.curTabIndex=h,f||(this.curGC=u))}return o&&i.tabActionPerformedCallback(t,l,f,e,r,s,u,c),!0};i.prototype.tabActionPerformedCallback2=function(n,t){n=this.curGC;t=this.curGC;this.curGC=null};i.prototype.tabActionPerformedCallback3=function(n,t,i,r){this.curST!=null&&(this.curST.saveData(),this.curST.unRegisterAPanel(),n=this.curST,this.curST=null);this.curTabIndex=r;t||(this.curGC=i)};i.prototype.tabActionPerformedCallback=function(t,i,r,u,f,e,o,s){if(this.setSelectedTab(t),r)this.curST=s,s.registerAPanel(this),s.loadData();else{if(o.activate(e),e&&e.detachDynamicAction(),this.curTab=o.getMTab(),this.setDynamicActions(),!this.curTab.getIsZoomAction()&&this.curTab.getTabLevel()>0){var h=new n.Query;this.curTab.query=h}i&&this.curTab.getIsCurrent()?(this.curTab.getTabLevel()==0?this.curTab.searchText?this.setAdvancedSerachText(!1,this.curTab.searchText):this.curTab.hasSavedAdvancedSearch&&this.toggleASearchIcons(!0,!1):this.curTab.searchText?this.setAdvancedSerachText(!1,this.curTab.searchText):this.curTab.hasSavedAdvancedSearch&&this.toggleASearchIcons(!0,!1),o.dataRefresh()):(this.curTab.getTableModel().setCurrentPage(1),(!this.curGC.onDemandTree||o.getMTab().getIsZoomAction())&&(this.curTab.searchText="",this.setDefaultSearch(o),o.query(this.curTab.getOnlyCurrentDays(),0,!1)));this.curGC.onDemandTree?this.aShowSummaryLevel.show():this.aShowSummaryLevel.hide()}r?(this.aMulti.setPressed(!1),this.aMulti.setEnabled(!1),this.aCard.setEnabled(!1),this.aCardDialog.setEnabled(!1),this.aNew.setEnabled(!1),this.aDelete.setEnabled(!1),this.aFind.setEnabled(!1),this.aRefresh.setEnabled(!1),this.aNext.setEnabled(!1),this.aLast.setEnabled(!1),this.aFirst.setEnabled(!1),this.aPrevious.setEnabled(!1),this.aPageFirst.setEnabled(!1),this.aPageUp.setEnabled(!1),this.aPageLast.setEnabled(!1),this.aPageDown.setEnabled(!1)):(this.aMulti.setEnabled(!0),this.aMulti.setPressed(this.curGC.getIsSingleRow()||this.curGC.getIsMapRow()),this.aCard.setEnabled(!0),this.aCardDialog.setEnabled(!0),this.aFind.setEnabled(!0),this.aRefresh.setEnabled(!0));f.setVisible(!1);u.setVisible(!0);this.curTab.getHasPanel()?(this.setCurrentTabPanel(),this.setTabPanelIcons(),this.showTabPanel(!0)):(this.setTabPanelIcons(),this.showTabPanel(!1));this.refresh();this.setTabNavigation();this.aParentDetail&&this.aParentDetail.evaluate(u);f=u=null;this.curTab.getAD_Process_ID()==0?this.aPrint.setEnabled(!1):this.aPrint.setEnabled(!0);this.curTab.getIsMapView()?this.aMap.show():this.aMap.hide()};i.prototype.setDefaultSearch=function(t){var i=this,u=[],r,e,f,o;if(u[0]=new n.DB.SqlParam("@AD_Tab_ID",this.curTab.getAD_Tab_ID()),u[1]=new n.DB.SqlParam("@AD_User_ID",this.ctx.getAD_User_ID()),u[2]=new n.DB.SqlParam("@AD_Tab_ID1",this.curTab.getAD_Tab_ID()),u[3]=new n.DB.SqlParam("@AD_User_ID1",this.ctx.getAD_User_ID()),u[4]=new n.DB.SqlParam("@AD_Client_ID",this.ctx.getAD_Client_ID()),u[5]=new n.DB.SqlParam("@AD_Tab_ID2",this.curTab.getAD_Tab_ID()),u[6]=new n.DB.SqlParam("@AD_Table_ID",this.curTab.getAD_Table_ID()),r=c("VIS_117",u),r&&r.tables[0].rows&&r.tables[0].rows.length>0)if(i.curTab.hasSavedAdvancedSearch=!0,i.curTab.getTabLevel()!=0||t.getMTab().getIsZoomAction())i.toggleASearchIcons(!0,!1);else{for(e=!1,f=0;f<r.tables[0].rows.length;f++)r.tables[0].rows[f].cells.ad_defaultuserquery_id>0&&(e=!0,i.setAdvancedSerachText(!1,r.tables[0].rows[f].cells.name),o=new n.Query(i.curTab.getTableName(),!1),o.addRestriction(r.tables[0].rows[f].cells.code),i.curTab.setQuery(o),i.defaultSearch=!1,i.curTab.searchText=r.tables[0].rows[f].cells.name);!i.curTab.hasSavedAdvancedSearch;i.toggleASearchIcons(!0,e)}else i.toggleASearchIcons(!1,!1),i.setAdvancedSerachText(!0,"")};i.prototype.dataStatusChanged=function(t){var o=t.getMessage(),p=this.curTab.getIsQueryActive()||this.curTab.getOnlyCurrentDays()>0,i,s,e,y,h,c,l,a,v;p&&(o="[ "+o+" ]");this.statusBar.setStatusDB(o,t);(t.getAD_Message()!=null||t.getInfo()!=null)&&(i=new StringBuilder,s=t.getMessage(),s!=null&&s.length>0&&i.append(n.Msg.getMsg(t.getAD_Message())),e=t.getInfo(),e!=null&&e.length>0&&(i.length()>0&&!i.endsWith(":")&&i.append(": "),i.append(e)),i.length()>0&&(y=i.indexOf("\n"),y!=-1&&i.replace("\n"," - "),this.setStatusLine(i.toString(),t.getIsError())));t.getIsError()&&!t.getIsConfirmed()?(n.ADialog.error(t.getAD_Message(),!0,t.getInfo()),t.setConfirmed(!0),this.errorDisplayed=!0):t.getIsWarning()&&!t.getIsConfirmed()&&(n.ADialog.warn(t.getAD_Message(),!0,t.getInfo()),t.setConfirmed(!0));h=t.getIsFirstRow();this.aFirst.setEnabled(!h);this.aPrevious.setEnabled(!h);c=t.getIsLastRow();this.aNext.setEnabled(!c);this.aLast.setEnabled(!c);l=t.getIsFirstPage();this.aPageFirst.setEnabled(!l);this.aPageUp.setEnabled(!l);a=t.getIsLastPage();this.aPageLast.setEnabled(!a);this.aPageDown.setEnabled(!a);var r=t.getIsChanged()||t.getIsInserting(),u=this.curTab.getIsReadOnly(),f=!u;f&&(f=this.curTab.getIsInsertRecord());this.aNew.setEnabled(!r&&f);this.aCopy&&this.aCopy.setEnabled(!r&&f);this.aRefresh.setEnabled(!r);this.aDelete.setEnabled(!r&&!u&&t.getCurrentRow()>-1);u&&this.curTab.getIsAlwaysUpdateField()&&(u=!1);this.aIgnore.setEnabled(r&&!u);this.aSave.setEnabled(r&&!u);this.aCardDialog.setEnabled(!r);t.getTotalRows()==0&&f&&(this.aNew.setEnabled(!0),this.aDelete.setEnabled(!1));this.aMulti.setPressed(this.curGC.getIsSingleRow()||this.curGC.getIsMapRow());this.aChat&&this.aChat.setPressed(this.curTab.hasChat());this.aAttachment&&this.aAttachment.setPressed(this.curTab.hasAttachment());this.aMarkToExport&&this.aMarkToExport.setPressed(this.curTab.hasMarked());this.aSubscribe&&this.aSubscribe.setPressed(this.curTab.HasSubscribed());this.isPersonalLock&&(this.aLock.setEnabled(!0),this.aLock.setPressed(this.curTab.getIsLocked()),this.aRecAccess.setEnabled(!0));this.curTab.getRecord_ID()==-1?(this.aChat&&this.aChat.setEnabled(!1),this.aAttachment&&this.aAttachment.setEnabled(!1),this.aSubscribe&&this.aSubscribe.setEnabled(!1),this.aHistory&&this.aHistory.setEnabled(!1),this.aEmail&&this.aEmail.setEnabled(!1),this.aLetter&&this.aLetter.setEnabled(!1),this.aSms&&this.aSms.setEnabled(!1),this.aFaxEmail&&this.aFaxEmail.setEnabled(!1),this.aCreateDocument&&this.aCreateDocument.setEnabled(!1),this.aUploadDocument&&this.aUploadDocument.setEnabled(!1),this.aViewDocument&&this.aViewDocument.setEnabled(!1),this.aAttachFrom&&this.aAttachFrom.setEnabled(!1),this.aZoomAcross&&this.aZoomAcross.setEnabled(!1),this.aMarkToExport&&this.aMarkToExport.setEnabled(!1),this.aArchive&&this.aArchive.setEnabled(!1),this.aEmailAttach&&this.aEmailAttach.setEnabled(!1),this.aAppointment&&this.aAppointment.setEnabled(!1),this.aTask&&this.aTask.setEnabled(!1),this.aRequest&&this.aRequest.setEnabled(!1),this.aWorkflow&&this.aWorkflow.setEnabled(!1),this.aCopy&&this.aCopy.setEnabled(!1),this.aLock&&this.aLock.setEnabled(!1),this.aRecAccess&&this.aRecAccess.setEnabled(!1)):(this.aChat&&this.aChat.setEnabled(!0),this.aAttachment&&this.aAttachment.setEnabled(!0),this.aSubscribe&&this.aSubscribe.setEnabled(!0),this.aHistory&&this.aHistory.setEnabled(!0),this.aEmail&&this.aEmail.setEnabled(!0),this.aLetter&&this.aLetter.setEnabled(!0),this.aSms&&this.aSms.setEnabled(!0),this.aFaxEmail&&this.aFaxEmail.setEnabled(!0),this.aImportMap&&this.aImportMap.setEnabled(!0),this.aCreateDocument&&this.aCreateDocument.setEnabled(!0),this.aUploadDocument&&this.aUploadDocument.setEnabled(!0),this.aViewDocument&&this.aViewDocument.setEnabled(!0),this.aAttachFrom&&this.aAttachFrom.setEnabled(!0),this.aZoomAcross&&this.aZoomAcross.setEnabled(!0),this.aMarkToExport&&this.aMarkToExport.setEnabled(!0),this.aArchive&&this.aArchive.setEnabled(!0),this.aEmailAttach&&this.aEmailAttach.setEnabled(!0),this.aAppointment&&this.aAppointment.setEnabled(!0),this.aTask&&this.aTask.setEnabled(!0),this.aRequest&&this.aRequest.setEnabled(!0),this.aWorkflow&&this.aWorkflow.setEnabled(!0),this.aCopy&&this.aCopy.setEnabled(!0),this.aLock&&this.aLock.setEnabled(!0));t.getIsInserting()||(v=n.GridTab.prototype.getTrxInfo(this.curTab.getTableName(),n.context,this.curTab.getWindowNo(),this.curTab.getTabNo()),v!=null&&this.statusBar.setInfo(v));this.curWinTab==this.vTabbedPane&&this.curWinTab.evaluate(null)};i.prototype.setStatusLine=function(n,t){this.statusBar.setStatusLine(n,t)};i.prototype.cmd_refresh=function(){this.cmd_save(!1);this.curGC.dataRefreshAll()};i.prototype.cmd_ignore=function(){this.curGC.dataIgnore()};i.prototype.cmd_help=function(){var t=new n.Apps.help(this.gridWindow)};i.prototype.cmd_cardDialog=function(){var t=new n.CVDialog(this);t.show()};i.prototype.cmd_save=function(t,i){var f,u,r;if(this.curST!=null&&(t=!1),this.errorDisplayed=!1,this.curST!=null){this.curST.saveData();this.aSave.setEnabled(!1);return}return f=!0,this.curTab.getCommitWarning().length>0&&this.curTab.needSave(!0,!1)&&(f=!1,u=this,n.ADialog.confirm("SaveChanges?",!0,this.curTab.getCommitWarning(),"Confirm",function(n){if(n){var i=u.curGC.dataSave(t);t&&!i&&!u.errorDisplayed;this.curGC.refreshTabPanelData(this.curTab.getRecord_ID());t&&u.curGC.dynamicDisplay(-1)}}),i&&i(r)),f?(r=this.curGC.dataSave(t),t&&!r&&!this.errorDisplayed,t&&this.curGC.dynamicDisplay(-1),i&&i(r),this.curGC.refreshTabPanelData(this.curTab.getRecord_ID()),r):void 0};i.prototype.cmd_new=function(n){this.curTab.getIsInsertRecord()&&this.curGC.dataNew(n)};i.prototype.cmd_delete=function(){var t,i;if(!this.curTab.getIsReadOnly()){if(t=this.curGC.canDeleteRecords(),t.length>0){n.ADialog.error("CannotDelete",!0," [ "+t.join(",")+"]");return}i=this;n.ADialog.confirm("DeleteRecord?",!0,"","Confirm",function(n){n&&i.curGC.dataDelete()})}};i.prototype.cmd_find=function(n){var t,r,i,u;if(this.curTab){if(!this.defaultSearch){this.defaultSearch=!0;return}this.setBusy(!0);t=null;n&&n.trim()!==""&&(n="%"+n+"%",t=this.curTab.getSearchQuery(n));r=0;i=!1;this.curTab.getTableModel().setCurrentPage(1);this.isSummaryVisible?this.curTab.setShowSummaryNodes(!0):this.curTab.setShowSummaryNodes(!1);this.curGC.skipRowInserting(!0);t!=null&&t.getIsActive()?(this.curTab.setQuery(t),this.curGC.query(0,0,i)):(u=0,this.curTab.setQuery(null),this.curGC.query(r,u,i))}};i.prototype.cmd_chat=function(){var o=this.curTab.getRecord_ID(),r,u,f,t,i,e;if(o==-1){this.aChat.setEnabled(!1);return}for(r=null,u=null,f=0;f<this.curTab.getFieldCount();f++)if(t=this.curTab.getField(f),t.getIsKey()&&(r=t.getHeader()),(t.getColumnName().toString()=="Name"||t.getColumnName().toString()=="DocumentNo")&&t.getValue()!=null&&t.getValue()!=""&&(u=t.getValue()),r!=null&&u!=null)break;i=this;e=new n.Chat(o,this.curTab.getCM_ChatID(),this.curTab.getAD_Table_ID(),r+": "+u,this.curWindowNo);e.onClose=function(){i.curTab.loadChats();i.aChat.setPressed(i.curTab.hasChat());i=null};e.show()};i.prototype.cmd_appointment=function(){var t=this.curTab.getRecord_ID(),i=this.curTab.getAD_Table_ID();t!=-1&&n.AppointmentsForm.init(i,t,0,0,!1,!0)};i.prototype.cmd_task=function(){var t=this.curTab.getRecord_ID(),i=this.curTab.getAD_Table_ID();t!=-1&&n.AppointmentsForm.init(i,t,0,0,!0)};i.prototype.cmd_letter=function(){var r=this.curTab.getRecord_ID(),i,t;if(r==-1){this.aLetter.setEnabled(!1);return}i=new n.Email("",this.curTab,this.curGC,r,!1);t=new n.CFrame;t.setName(n.Msg.getMsg("Letter"));t.setTitle(n.Msg.getMsg("Letter"));t.hideHeader(!0);t.setContent(i);t.show();i.initializeComponent()};i.prototype.cmd_email=function(){var r=this.curTab.getRecord_ID(),i,t;if(r==-1){this.aEmail.setEnabled(!1);return}i=new n.Email("",this.curTab,this.curGC,r,!0);t=new n.CFrame;t.setName(n.Msg.getMsg("EMail"));t.setTitle(n.Msg.getMsg("EMail"));t.hideHeader(!0);t.setContent(i);t.show();i.initializeComponent()};i.prototype.cmd_report=function(){var i,t,r,u,e,s,f,h,o;if(!n.MRole.getDefault().getIsCanReport(this.curTab.getAD_Table_ID())){n.ADialog.warn("AccessCannotReport");return}if(this.curTab.needSave(!0,!1)){this.cmd_save(!0);return}for(i=null,i=this.curTab.query&&this.curTab.query.list.length>0?this.curTab.query:new n.Query(this.curTab.getTableName()),i.tableName=this.curTab.getTableName(),t=this.curTab.getLinkColumnName(),t.length==0&&(t=this.curTab.getKeyColumnName()),r=null,u=null,e=0,s=this.curTab.getFieldCount();e<s;e++)if(f=this.curTab.getField(e),f.getIsKey()&&(r=f.getHeader()),(f.getColumnName()=="Name"||f.getColumnName()=="DocumentNo")&&f.getValue()!=null&&(u=f.getValue()),r!=null&&u!=null)break;h=this.curTab.getParentColumnNames().length==0;t.length!=0&&(h&&(this.curTab.getLinkColumnName()==null||this.curTab.getLinkColumnName()=="")||(t.endsWith("_ID")?r==null&&u==null?i.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContextAsInt(this.curWindowNo,t)):i.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContextAsInt(this.curWindowNo,t),r,u):r==null&&u==null?i.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContext(this.curWindowNo,t)):i.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContext(this.curWindowNo,t),r,u)));o=this.curGC.onDemandTree?this.isSummaryVisible?new n.AReport(this.curTab.getAD_Table_ID(),i,this.curTab.getAD_Tab_ID(),this.curWindowNo,this.curTab,this.curGC.treeID,this.curGC.treeNodeID,!0):new n.AReport(this.curTab.getAD_Table_ID(),i,this.curTab.getAD_Tab_ID(),this.curWindowNo,this.curTab,this.curGC.treeID,this.curGC.treeNodeID,!1):new n.AReport(this.curTab.getAD_Table_ID(),i,this.curTab.getAD_Tab_ID(),this.curWindowNo,this.curTab,0,0,!1)};i.prototype.cmd_print=function(){var i=this.curGC.getSelectedRows(),r,f,o,c,s,e,t,h,u;if(i.length==0){n.ADialog.info("SelectRecord");return}if(r=this.curTab.getAD_Process_ID(),r!=0)if(f="VIS_118",o=[],o[0]=new n.DB.SqlParam("@AD_Process_ID",r),c=p(f,o),f="VIS_119",s=p(f),i.length>1&&c>0&&s&&s.toString()>"1.0.0.3"){if(this.curTab.needSave(!0,!1)){this.cmd_save(!0);return}for(e="",t=0;t<i.length;t++)t==0?e=i[t][this.curTab.getKeyColumnName().toLower()]:e+=","+i[t][this.curTab.getKeyColumnName().toLower()];u=new n.APrint(r,this.curTab.getAD_Table_ID(),0,this.curWindowNo,e,this.curTab,!0);u.start(this.aPrint.getListItmIT())}else{if(h=this.curTab.getRecord_ID(),h==-1){n.ADialog.info(n.Msg.getMsg("SelectRecord"));return}if(this.curTab.needSave(!0,!1)){this.cmd_save(!0);return}u=new n.APrint(r,this.curTab.getAD_Table_ID(),h,this.curWindowNo,null,this.curTab);u.start(this.aPrint.getListItmIT())}};i.prototype.cmd_sms=function(){var r=this.curTab.getRecord_ID(),i,t;if(r==-1){this.aSms.setEnabled(!1);return}i=new n.Sms(this.curTab,this.curGC,r,!1);t=new n.CFrame;t.setName(n.Msg.getMsg("Sms"));t.setTitle(n.Msg.getMsg("Sms"));t.hideHeader(!0);t.setContent(i);t.show();i.initializeComponent()};i.prototype.cmd_subscribe=function(){var i=this.curTab.getRecord_ID(),t,r;if(i==-1){this.aSubscribe.setEnabled(!1);return}t=this;r=function(){t.curTab.loadSubscribe();t.aSubscribe.setPressed(t.curTab.HasSubscribed())};n.dataContext.subscribeUnsubscribeRecords(this.curTab.getCM_SubScribedID(),this.curTab.getAD_Window_ID(),i,this.curTab.getAD_Table_ID(),r)};i.prototype.cmd_ImportMap=function(){if(window.VDIU){if(this.curTab.getIsReadOnly()){n.ADialog.warn("ReadOnly");return}var i=new VDIU.ImportExcel(this.curTab.getAD_Window_ID(),this.gridWindow.getName()),t=new n.CFrame;t.setName(n.Msg.getMsg("Import"));t.setTitle(n.Msg.getMsg("Import"));t.setContent(i);t.show();i.initialize()}else n.ADialog.error("PleaseInstallExcelImportModule")};i.prototype.cmd_attachment=function(){if(this.curTab.getRecord_ID()<1){this.aAttachment.setEnabled(!1);return}var t=this,i=new n.attachmentForm(0,0,this.curTab.getAD_Table_ID(),this.curTab.getRecord_ID(),"");i.show();i.onClose=function(){t.curTab.loadAttachments();t.aAttachment.setPressed(t.curTab.hasAttachment());t=null}};i.prototype.cmd_history=function(){var t=null,i=0,r=0;(Object.keys(this.curGC.getColumnNames()).indexOf("C_BPartner_ID")>0||this.curTab.getField("C_BPartner_ID")!=null&&this.curTab.getField("C_BPartner_ID").getValue()>0)&&(i=this.curTab.getField("C_BPartner_ID").getValue());(Object.keys(this.curGC.getColumnNames()).indexOf("AD_User_ID")>0||this.curTab.getField("AD_User_ID")!=null&&this.curTab.getField("AD_User_ID").getValue()>0)&&(r=this.curTab.getField("AD_User_ID").getValue());t=new n.AttachmentHistory(this.curTab.getAD_Table_ID(),this.curTab.getRecord_ID(),i,r,this.curTab.getKeyColumnName());t.show()};i.prototype.cmd_finddialog=function(){var i=new n.Find(this.curWindowNo,this.curTab,0),t=this,r="";i.onClose=function(){var e,o;if(i.getIsOKPressed()||i.needRefresh()){t.setAdvancedSerachText(!0,"");t.curTab.searchText="";t.isSummaryVisible?t.curTab.setShowSummaryNodes(!0):t.curTab.setShowSummaryNodes(!1);var u=i.getQuery(),s=i.getCurrentDays(),f=i.getIsCreated();r=i.getSavedQueryName();t.curTab.userQueryID=i.getSavedID();i.dispose();i=null;t.curTab.getTableModel().setCurrentPage(1);u!=null&&u.getIsActive()?(t.curTab.setQuery(u),t.curGC.query(0,0,f)):u!=null&&(e=n.MRole.getDefault().getMaxQueryRecords(),t.curTab.setQuery(null),t.curGC.query(s,e,f));o=t.curTab.getIsQueryActive()||t.curTab.getOnlyCurrentDays()>0;t.aFind.setPressed(o)}t.refreshSavedASearchList(!1,r);t=null};i.show()};i.prototype.cmd_preference=function(){var t=new n.Framework.UserPreference;t.load();t.showDialog();t=null};i.prototype.cmd_infoWindow=function(){n.InfoMenu.show(this.aInfo.getItem())};i.prototype.cmd_zoomAcross=function(){var r=this.curTab.getRecord_ID(),i,t,u;r>0&&(i=new n.Query,t=this.curTab.getKeyColumnName(),t.length==0&&(t=this.curTab.getLinkColumnName()),t.length!=0&&(t.endsWith("_ID")?i.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContextAsInt(this.curWindowNo,t)):i.addRestriction(t,n.Query.prototype.EQUAL,n.context.getContext(this.curWindowNo,t))),u=new n.AZoomAcross(this.aZoomAcross,this.curTab.getTableName(),i,this.curTab.getAD_Window_ID(),this,this.aZoomAcross.getListItmIT(),t,r),u.init())};i.prototype.cmd_request=function(){var t=this.curTab.getRecord_ID();if(t>0){var r=this.curTab.getAD_Table_ID(),u=this.curTab.getValue("C_BPartner_ID"),i=new n.ARequest(this.aRequest,r,t,u,null,this.aRequest.getListItmIT());i.getRequests();i=null}};i.prototype.cmd_markToExport=function(){var f=this.curTab.getRecord_ID(),e=this.curGC.getSelectedRows(),h=null,o=this.curTab.getAD_Table_ID(),s=this.curTab.getTableName(),c,l,a,r,v,u,i,t;if(f==-1){if(c={AD_Table_ID:o},l=n.dataContext.getJSONData(n.Application.contextUrl+"JsonData/GetKeyColumns",c),l==null)return}else{if(a=s+"_ID",r="",this.curGC.singleRow){h=f;i=new n.MarkModule;i.init(h,o,s);i.show();t=this;i.onClose=function(){t.curTab.loadMarking();t.aMarkToExport.setPressed(t.curTab.hasMarked());t=null};return}if(v=e.length,v==1)r=f;else{for(u=0;u<e.length;u++)r+=e[u][a.toLowerCase()]+",";r.endsWith(",")&&(r=r.substring(0,r.length-1))}i=new n.MarkModule;i.init(r,o,s);i.show();t=this;i.onClose=function(){t.curTab.loadMarking();t.aMarkToExport.setPressed(t.curTab.hasMarked());t=null};return}};i.prototype.cmd_lock=function(){var i=!1,t;this.isPersonalLock&&((t=this.curTab.getRecord_ID(),t==-1||t<0)||(this.curTab.locks(n.context,t,this.aLock.getIsPressed()),this.curTab.loadAttachments(),i=this.curTab.getIsLocked(),this.aLock.setPressed(i)))};i.prototype.cmd_recAccess=function(){var t=new n.RecordAccessDialog;t.Load(this.curTab.getAD_Table_ID(),this.curTab.getRecord_ID())};i.prototype.ShowSummaryNodes=function(){this.isSummaryVisible?(this.aShowSummaryLevel.setPressed(!1),this.isSummaryVisible=!1):(this.aShowSummaryLevel.setPressed(!0),this.isSummaryVisible=!0)};i.prototype.cmd_call=function(){var r=this.curTab.getRecord_ID(),u,i,t;if(r==-1){this.aCall.setEnabled(!1);return}u=this.curTab.getAD_Table_ID();VA048&&VA048.Apps?(i=new VA048.Apps.CallForm,i.initializeComponent(u,r),t=new n.CFrame,t.setName(n.Msg.getMsg("Call")),t.setTitle(n.Msg.getMsg("Call")),t.hideHeader(!0),t.setContent(i),t.show()):alert(n.Msg.getMsg("Please install Communication module first"))};i.prototype.dispose=function(){this.aParentDetail&&this.aParentDetail.dispose();this.curST!=null&&(this.curST.unRegisterAPanel(),this.curST=null);this.vTabbedPane.dispose();this.vTabbedPane=null;this.gridWindow&&(this.gridWindow.dispose(),this.gridWindow=null,this.ctx.setAutoCommit(this.$parentWindow.getWindowNo(),!1),this.ctx.removeWindow(this.$parentWindow.getWindowNo()),n.MLookupCache.cacheReset(this.$parentWindow.getWindowNo()));this.ctx=null;this.$parentWindow=null;this.tabPages=null;this.curGC=null;this.curST=null;this.aParentDetail=null;this.curTab=null;this.disposeComponent()};n.VTabbedPane=function(){var n=!1;this.oldTabIndex=-1;this.Items=[];this.ItemsIds=[];this.count=0;this.dependents=[];this.TabItems=[];this.getIsWorkbench=function(){return n}};n.VTabbedPane.prototype.setTabObject=function(n){this.tabObj=n};n.VTabbedPane.prototype.addTab=function(n,t,i,r){var f,u,e;for(this.ItemsIds[this.count]=n,this.Items[this.count]=i,this.TabItems.push(r),f=t.getDependentOn(),u=0;u<f.length;u++)e=f[u],this.dependents.indexOf(e)<0&&this.dependents.push(e);this.count++};n.VTabbedPane.prototype.getIsTabChanged=function(t){var u=this.ItemsIds.indexOf(t),f=this.oldTabIndex,r,h,i,e,s,o;if(u===f)return console.log("same tab"),!1;if(i=this.Items[u],r=null,i instanceof n.GridController&&(r=i,h=r.getIsDisplayed(),!h))return!1;if(r!=null&&f>=0&&u!=f&&(i=this.Items[f],i!=null&&i instanceof n.GridController)){if(r.getTabLevel()>i.getTabLevel()+1){for(e=u-1;e>=0;e--)if(s=this.Items[e],o=null,s instanceof n.GridController&&(o=s,o.getTabLevel()==i.getTabLevel()+1))return n.ADialog.warn("TabSwitchJumpGo",!0,"",o.getTitle()),!1;return n.ADialog.warn("TabSwitchJump"),!1}i.setMnemonics(!1)}return r!=null&&r.setMnemonics(!0),this.oldTabIndex=u,!0};n.VTabbedPane.prototype.restoreTabChange=function(){this.oldTabIndex=-1};n.VTabbedPane.prototype.getTabElement=function(){return this.Items[this.oldTabIndex]};n.VTabbedPane.prototype.getSelectedIndex=function(){return this.oldTabIndex};n.VTabbedPane.prototype.sizeChanged=function(n,t){for(var i in this.Items)this.Items[i].sizeChanged(n,t)};n.VTabbedPane.prototype.evaluate=function(t){var r=t==null,u=null,i,f,e,o;if(r||(u=t,r=u!=null?this.dependents.indexOf(u)>-1:!0),r)for(i=0;i<this.TabItems.length;i++)f=this.Items[i],f instanceof n.GridController&&(e=f,o=e.getIsDisplayed(),this.TabItems[i].setEnabled(o))};n.VTabbedPane.prototype.dispose=function(){for(var n in this.Items)this.Items[n].dispose(),this.Items[n]=null;this.TabItems.length=0;this.TabItems=null;this.Items.length=0;this.Items=null;this.ItemsIds.length=0;this.ItemsIds=null;this.dependents.length=0;this.dependents=null};f.prototype.setPressed=function(n){this.toggle&&(this.pressed=n,this.img&&this.toggle&&this.img.prop("src",n?this.imgUrlX:this.imgUrl))};f.prototype.getIsPressed=function(){return this.pressed};f.prototype.getAction=function(){return this.action};f.prototype.getPath=function(){return n.Application.contextUrl+"Areas/VIS/Images/base/"};f.prototype.getSeprator=function(n,t){var i=this.getPath();return(i+=n?"seprator16.png":"seprator24.png",t)?"<li>|<\/li>":'<li><img src="'+i+'"><\/li>'};f.prototype.setEnabled=function(n){this.isEnabled=n;this.$li&&this.$li.css("opacity",n?1:.6);this.img&&this.img.prop("disabled",!n).css("opacity",n?1:.6)};f.prototype.show=function(){this.$li&&this.$li.show();this.img&&this.img.show()};f.prototype.hide=function(){this.$li&&this.$li.hide();this.img&&this.img.hide()};f.prototype.getItem=function(){return this.$li};f.prototype.getIsEnabled=function(){return this.isEnabled};f.prototype.dispose=function(t){if(this.action=this.toggle=this.pressed=this.isEnabled=this.text=this.toolTipText=this.imageOnly=null,this.textOnly=this.onAction=this.isSmall=null,this.$li&&(this.$li.off(n.Events.onClick),this.$li.remove(),this.$li=null),this.img&&(this.img=null),t&&t in this.items){var i=this.items[t];i&&(i.off(n.Events.onClick),i.remove(),i=null);delete this.items[t]}this.disposeComponent()};f.prototype.setIsRo;s.prototype.setStatusDB=function(n,t){n==null||n.length==0?this.$statusDB.text(""):this.$statusDB.text(n);this.text=n;this.dse=t;this.setPageLine(t)};s.prototype.setStatusLine=function(n,t){this.merror=t;this.mtext=n;this.$statusLine.text(n)};s.prototype.setInfo=function(n){this.$infoLine.is(":visible")||this.$infoLine.show();this.$infoLine.text(n)};s.prototype.dispose=function(){this.disposeComponent()};n.GridController=function(i,r,u){function st(){b=t("<td colspan='2' class='vis-height-auto'>");k=t("<td colspan='2' class='vis-height-auto'>");tt=t("<td style='width:100%'>");d=t("<div>");rt=t("<td>").append(d).hide();p=t("<table class='vis-gc-table'>").append(t("<tr>").append(b)).append(t("<tr>").append(k)).append(t("<tr  class='vis-height-full'>").append(rt).append(tt)).hide();e=t("<ul  class='vis-appsaction-ul vis-gc-tabcontrol'>").hide();s=t("<div class='vis-gc-header'>").hide();y=t("<div class='vis-gc-vtable'>");c=t("<div class='vis-gc-vpanel' id='AS_"+u+"'>");l=t("<div class='vis-gc-vcard'>");a=t("<div class='vis-gc-vmap'>");b.append(s);k.append(e);it=t("<div class='vis-height-full' style='overflow:hidden'>");ot=t("<div class='vis-height-full'>");it.append(y).append(c).append(l).append(a);tt.append(it)}function ht(){et=new n.AppsAction({action:"Add_sub",parent:null,enableDisable:!0,toggle:!1,imageOnly:!0,isSmall:!0,onAction:ft});g=new n.AppsAction({action:"Edit_sub",parent:null,enableDisable:!0,toggle:!1,imageOnly:!0,isSmall:!0,onAction:ft});e.append(g.getListItm()).append(et.getListItm())}var w,f,ft;this.id=u;this.vGridPanel=new n.VGridPanel;this.vTable=new n.VTable;this.vCardView=new n.VCardView;this.vMapView=new n.VMapView;this.windowNo=0;this.aPanel=null;this.singleRow=!1;this.isCardRow=!1;this.doPaging=r;this.vIncludedGC=null;this.m_tree=null;this.onRowInserted=null;this.onRowInserting=null;this.curTabPanel=null;this.ul_tabPanels=null;this.rightPaneLinkItems=[];this.leftPaneLinkItems=[];this.showClient=!1;this.showOrg=!1;w=n.Env.getCtx().getShowClientOrg();w==n.Env.SHOW_CLIENT_ONLY?this.showClient=!0:w==n.Env.SHOW_ORG_ONLY?this.showOrg=!0:w==n.Env.SHOW_CLIENT_ORG&&(this.showOrg=!0,this.showClient=!0);this.isParentDetailVisible=!1;this.isIncludedGCVisible=!1;this.displayAsIncludedGC=!1;var c,l,a,e,p,s,nt=[],b,k,tt,y,d,it,ot,rt,ut=null,et,g=null;st();f=this;ft=function(n){if(n=="Edit_sub"){if(f.displayAsIncludedGC){f.aPanel.tabActionPerformed(f.id)&&(f.switchSingleRow(),e.find(".vis-apanel-tab-selected")[0].scrollIntoView());return}}else if(f.displayAsIncludedGC){if(!f.aPanel.tabActionPerformed(f.id))return;f.switchSingleRow();setTimeout(function(n){n.aPanel.cmd_new()},500,f)}};ht();this.initLayout=function(){this.layoutLoaded=!0};this.sizeChanged=function(t,i){t||(t=n.Env.getScreenHeight()-(o+v+h));p.height(t);y.height(t-2);c.height(t);d.height(t);l.height(t);a.height(t);this.m_tree&&this.m_tree.setSize(t,i);this.vCardView&&this.vCardView.sizeChanged(t,l.width());this.vMapView&&this.vMapView.sizeChanged(t,a.width())};this.sizeChanged();c.append(this.vGridPanel.getRoot());this.getRoot=function(){return p};this.getTreeArea=function(){return d};this.setTreePanelWidth=function(){rt.show()};this.getId=function(){return u};this.getReocrdDiv=function(){return s};this.getTabControl=function(){return e};this.setRecord=function(){};this.getVTablePanel=function(){return y};this.getVPanel=function(){return c};this.getVCardPanel=function(){return l};this.getVMapPanel=function(){return a};this.setUI=function(n){n?(s.html(this.gTab.getName()),s.css("white-space","nowrap"),s.show(),e.show(),g.setEnabled(!1),this.vTable.grid.show.selectColumn=!1):(s.hide(),e.hide(),this.vTable.grid.show.selectColumn=!0)};this.enableDisableToolbarItems=function(n){g.setEnabled(n)};this.vTable.onSelect=function(n){f.aPanel&&f.aPanel.setBusy&&f.aPanel.setBusy(!0);f.cancelSel=!1;f.onTableRowSelect(n);f.cancelSel&&(n.isCancelled=!0);f.aPanel&&f.aPanel.setBusy&&f.aPanel.setBusy(!1)};this.vTable.onCellValueChanged=function(n,t){t?window.setTimeout(function(){f.vetoablechange(n);f.vTable.refreshCells()},10):(f.vetoablechange(n),f.vTable.refreshCells())};this.vCardView.onCardEdit=function(n,t){f.onTableRowSelect(n);t||f.switchSingleRow()};this.vTable.onSort=function(){window.setTimeout(function(){f.navigate(f.gTab.getCurrentRow(),!0)},10)};this.disposeComponent=function(){this.rightPaneLinkItems.length=0;this.rightPaneLinkItems=null;this.leftPaneLinkItems.length=0;this.leftPaneLinkItems=null;y=null;$divRecords=null;for(var n=0;n<nt.length;n++)nt[n].dispose("ul_"+this.id);nt=null;this.seletedTab=null;b=null;k=null;this.vGridPanel.dispose();this.vGridPanel=null;this.vCardView.dispose();this.vCardView.onSelect=null;this.vMapView.dispose();this.vTable.dispose();this.vTable.onSelect=null;this.vTable.onSort=null;this.vTable=null;y=null;c=null;l=null;a=null;f=null;this.getId=null;this.getReocrdDiv=null;this.getRoot=null;this.getVTablePanel=null;this.getVPanel=null;this.getVCardPanel=null;p.remove();p=null;ut&&ut.destroy();ut=null;this.onRowInserted=null}};n.GridController.prototype.createTabPanel=function(t){var r,i,u;if(this.ul_tabPanels)this.ul_tabPanels=this.ul_tabPanels.replace('default="true"',"");else if(t&&t.length>0){for(r="",i=0;i<t.length;i++)u="",u=t[i].getIconPath()?t[i].getIconPath():"VIS/Images/base/defPanel.ico",r+='<li ><img alt="'+t[i].getName()+'" title="'+t[i].getName()+'" default="'+t[i].getIsDefault()+'" data-panelID="'+t[i].getAD_TabPanel_ID()+'" data-cName="'+t[i].getClassName()+'" data-Name="'+t[i].getName()+'" src="'+n.Application.contextUrl+"Areas/"+u+'"><\/img><\/li>';this.ul_tabPanels=r}return this.ul_tabPanels};n.GridController.prototype.setCurrentPanelID=function(n){this.panelID=n};n.GridController.prototype.getCurrentPanelID=function(){return this.panelID};n.GridController.prototype.setCurrentPanel=function(t,i){var u,r;this.curTabPanel&&(this.curTabPanel.dispose&&this.curTabPanel.dispose(),this.curTabPanel=null);t&&(u=n.Utility.getFunctionByName(t,window),u&&(r=new u,r.startPanel(i,this.gTab),this.gTab.getRecord_ID()>-1&&r.refreshPanelData(this.gTab.getRecord_ID(),this.gTab.getTableModel().getRow(this.gTab.getCurrentRow())),this.curTabPanel=r))};n.GridController.prototype.getCurrentPanel=function(){return this.curTabPanel};n.GridController.prototype.refreshTabPanelData=function(n){this.curTabPanel&&t(this.curTabPanel.getRoot()).is(":visible")&&this.curTabPanel.refreshPanelData(n,this.gTab.getTableModel().getRow(this.gTab.getCurrentRow()))};n.GridController.prototype.initGrid=function(t,i,r,u){var l=u.gridTable.gridFields,e=null,y=i+"_"+u.vo.AD_Tab_ID,w=i+"_c"+u.vo.AD_Tab_ID,b=i+"_m"+u.vo.AD_Tab_ID,c,a,s,f,o,v,h;if(u.getTableModel().setDoPaging(this.doPaging),c=n.MRole,c.getIsDisplayClient()&&this.showClient||u.getField("AD_Client_ID").setDisplayed(!1),c.getIsDisplayOrg()&&this.showOrg||u.getField("AD_Org_ID").setDisplayed(!1),a=this.vTable.setupGridTable(r,l,this.getVTablePanel(),y,u,this),u.addDataStatusListener(this),!t)for(this.vCardView.setupCardView(r,u,this.getVCardPanel(),w),u.getIsMapView()&&this.vMapView.setupMapView(r,this,u,this.getVMapPanel(),b),s=0;s<a;s++)if(e=l[s],e.getIsDisplayed()){if(f=n.VControlFactory.getControl(u,e,!1,!1,!1),f==null&&!e.getIsHeading())continue;f!=null&&(f.setReadOnly(!0),e.setPropertyChangeListener(f),f.addVetoableChangeListener(this));this.vGridPanel.addField(f,e);f instanceof n.Controls.VButton&&(e.getIsLink()&&(e.getIsRightPaneLink()?this.rightPaneLinkItems.push(f):this.leftPaneLinkItems.push(f)),f.addActionListner(r));f=null}o=0;u.getIsTreeTab()&&(v="VIS_120",h=[],h[0]=new n.DB.SqlParam("@AD_Client_ID",n.Env.getCtx().getAD_Client_ID()),h[1]=new n.DB.SqlParam("@AD_Table_ID",u.getAD_Table_ID()),o=p(v,h),o>0&&(this.treeID=o,u.getShowSummaryLevel()?(this.onDemandTree=!0,this.m_tree=new n.TreePanel(i,!1,!0,!0,this),r.aShowSummaryLevel.show()):(this.onDemandTree=!1,this.m_tree=new n.TreePanel(i,!1,!0,!1,this),r.aShowSummaryLevel.hide()),this.m_tree.setTabID(u.getAD_Tab_ID()),u.getTabNo()==0&&this.m_tree.initTree(o),this.getTreeArea().append(this.m_tree.getRoot()),this.m_tree.addSelectionChangeListner(this),this.setTreePanelWidth("300px"),this.getTreeArea().width("300px"),this.m_tree.setSize(this.getTreeArea().height())));u.getTableModel().addTableModelListener(this.vTable);u.getTableModel().addCardModelListener(this.vCardView);u.getTableModel().addRowChangedListener(this);u.getTableModel().addQueryCompleteListner(this);u.getTableModel().setDoPaging(this.doPaging);u.getTableModel().setCurrentPage(1);this.gTab=u;this.windowNo=i;this.onlyMultiRow=t;this.aPanel=r;t||!u.getIsSingleRow()?this.singleRow=!1:this.switchSingleRow(!0)};n.GridController.prototype.detachDynamicAction=function(){for(var n=0,t=0,n=0,t=this.leftPaneLinkItems.length;n<t;n++)this.leftPaneLinkItems[n].getControl().detach();for(n=0,t=this.rightPaneLinkItems.length;n<t;n++)this.rightPaneLinkItems[n].getControl().detach();n=null;t=null};n.GridController.prototype.switchRowPresentation=function(){this.singleRow?this.switchMultiRow():this.switchSingleRow()};n.GridController.prototype.getIsSingleRow=function(){return this.singleRow};n.GridController.prototype.getIsMapRow=function(){return this.isMapRow};n.GridController.prototype.onTableRowSelect=function(n){var i,r,t;if(!this.rowSetting&&this.gTab.getRowCount()!=0){if(i=this.vTable.get(n.recid,!0),r=this.gTab.getCurrentRow(),i==-1&&r>=0){this.vTable.select(n.recid);this.vCardView.navigate(n.recid,!this.isCardRow);return}if(i!=r)this.rowSetting=!0,this.navigate(i),this.rowSetting=!1;else if(!this.settingGridSelecton)return;this.dynamicDisplay(-1);t=this;this.getIsSingleRow()?t.vIncludedGC!=null&&t.switchIncludedGC():window.setTimeout(function(){t.vIncludedGC!=null&&t.switchIncludedGC()},50)}};n.GridController.prototype.switchIncludedGC=function(){this.vIncludedGC!=null&&this.switchIncludedGC()};n.GridController.prototype.dynamicDisplay=function(t){var l,e,i,u,r,o,f,c;if(this.gTab!=null&&!this.isCardRow&&!this.isMapRow){if(l=this.gTab.getRecord_ID(),!this.getIsSingleRow()){this.dynamicDisplayLinks(t);return}if(this.gTab.getIsOpen()){if(t>=0){var s=this.gTab.getField(t),u=s.getColumnName(),a=this.gTab.getDependantFields(u);if(a.length==0&&s.getCallout().length>0)return}var v=this.gTab.getRowCount()==0,h=this.vGridPanel.getComponents(),y=h.length;for(e=0;e<y;e++)i=h[e],u=i.getName(),u!=null&&(u.startsWith("lbl")&&(u=u.substring(3)),r=this.gTab.getField(u),r!=null&&(r.getIsDisplayed(!0)?(o=i.tag,!i.getIsVisible()&&(o==null||o=="undefined"||o)&&i.setVisible(!0),i instanceof n.Controls.IControl&&(f=i,v?f.setReadOnly(!0):(c=r.getIsEditable(!0)&&!this.gTab.getIsReadOnly(),f.setReadOnly(!c),f.setMandatory(r.getIsMandatory(!0)),f.setBackground(r.getIsError()),!r.getIsDefaultFocus()||this.isDefaultFocusSet||i.getName().startsWith("lbl")||(f.setDefaultFocus(!0),this.isDefaultFocusSet=!0)))):i.getIsVisible()&&i.setVisible(!1),r.getIsDisplayed(!0)||r.getIsMandatory(!0)||r.setError(!1)))}}};n.GridController.prototype.dynamicDisplayLinks=function(){var s,o,f,t,r,i,e,u,h;if(!this.displayAsIncludedGC)for(s=this.gTab.getRowCount()==0,o=this.vGridPanel.getLinkComponents(),f=0;f<o.length;f++)t=o[f],r=t.getName(),r!=null&&(r.startsWith("lbl")&&(r=r.substring(3)),i=this.gTab.getField(r),i!=null&&(i.getIsDisplayed(!0)?(e=t.tag,!t.getIsVisible()&&(e==null||e=="undefined"||e)&&t.setVisible(!0),t instanceof n.Controls.IControl&&(u=t,s?u.setReadOnly(!0):(h=i.getIsEditable(!0)&&!this.gTab.getIsReadOnly(),u.setReadOnly(!h),u.setMandatory(i.getIsMandatory(!0)),u.setBackground(i.getIsError())))):t.getIsVisible()&&t.setVisible(!1),i.getIsDisplayed(!0)||i.getIsMandatory(!0)||i.setError(!1)))};n.GridController.prototype.setDefaultFocus=function(){for(var e=this.gTab.getRowCount()==0,r=this.vGridPanel.getComponents(),f=r.length,u,t,i,n=0;n<f;n++)if(u=r[n],t=u.getName(),t!=null&&(i=this.gTab.getField(t),i!=null&&i.getIsDefaultFocus())){this.vTable.setDefaultFocus(t);break}};n.GridController.prototype.setVisible=function(n){this.layoutLoaded||this.initLayout();n?(this.getRoot().show(),this.vTable.resize()):this.getRoot().hide()};n.GridController.prototype.getMTab=function(){return this.gTab};n.GridController.prototype.getIsDisplayed=function(){return this.gTab.getIsDisplayed(!1)};n.GridController.prototype.getTabLevel=function(){return this.gTab.getTabLevel()};n.GridController.prototype.getTitle=function(){return this.gTab.getName()};n.GridController.prototype.getSelection=function(n){return this.vTable.getSelection(n)};n.GridController.prototype.getSelectedRows=function(){return this.vTable.getSelectedRows()};n.GridController.prototype.getColumnNames=function(){var t,i,n;if(this.colNames)return this.colNames;for(t=this.gTab.getTableModel().getFields(),i={},n=0;n<t.length;n++)i[t[n].getColumnName()]=t[n].getHeader();return this.colNames=i,this.colNames};n.GridController.prototype.setMnemonics=function(){};n.GridController.prototype.activate=function(n){var t,i;this.vTable.activate();n=n||{};this.vTable.setReadOnly(!1);this.displayAsIncludedGC?(i=this.aPanel.getLayout(),this.setUI(!1),this.getRoot().detach(),i.append(this.getRoot()),this.displayAsIncludedGC=!1,this.aPanel.getIncludedEmptyArea().css({width:"",padding:""})):this.gTab.getIncluded_Tab_ID()==0&&(t=n.vIncludedGC,t&&(i=t.aPanel.getLayout(),t.setUI(!1),t.getRoot().detach()));this.isIncludedGCVisible=!1;this.vIncludedGC&&(this.vIncludedGC.displayAsIncludedGC=!1,this.vIncludedGC.isIncludedGCVisible=!1);this.activateTree()};n.GridController.prototype.multiRowResize=function(){this.singleRow||this.isCardRow||this.vTable.resize()};n.GridController.prototype.activateTree=function(){var t,i,r,e,o,s,u,f;if(this.gTab.getIsTreeTab()&&this.gTab.getTabNo()>0){if(t=0,this.gTab.getTabLevel()>0&&(i=this.gTab.getKeyColumnName(),r="AD_Tree_ID",i.startsWith("CM")&&(i.equals("CM_Container_ID")?r="AD_TreeCMC_ID":i.equals("CM_CStage_ID")?r="AD_TreeCMS_ID":i.equals("CM_Template_ID")?r="AD_TreeCMT_ID":i.equals("CM_Media_ID")&&(r="AD_TreeCMM_ID")),t=n.Env.getCtx().getWindowContextAsInt(this.windowNo,r)),t==0){if(e=this.gTab.getAD_Table_ID(),o=n.Env.getCtx().getAD_Client_ID(),e==0)return 0;s="VIS_121";u=[];u[0]=new n.DB.SqlParam("@AD_Client_ID",o);u[1]=new n.DB.SqlParam("@AD_Table_ID",e);f=g(s,u);f.read()&&(t=f.getInt(0));f=null}this.m_tree!=null&&t>0&&this.m_tree.initTree(t)}};n.GridController.prototype.nodeSelectionChanged=function(n){var u,t,f,r,i;if(n!=null&&(u=n.newValue,u!=null)){if(t=u,this.treeNodeID=t,this.onDemandTree){this.aPanel&&this.aPanel.setBusy&&this.aPanel.setBusy(!0);this.gTab.setTreeNodeID(t);this.gTab.gridTable.setCurrentPage(1);this.gTab.setQuery(null);this.navigate(0);this.query(0,0,!1,t,this.treeID,this.gTab.getAD_Table_ID());return}for(f=this.gTab.getRowCount(),r=-1,i=0;i<f;i++)if(this.gTab.getKeyID(i)==t){r=i;break}r!=-1&&this.navigate(r)}};n.GridController.prototype.skipRowInserting=function(n){this.skipInserting=n};n.GridController.prototype.query=function(n,t,i,r,u,f){this.aPanel&&this.aPanel.setBusy&&this.aPanel.setBusy(!0);this.onDemandTree&&(r&&this.gTab.setTreeNodeID(r),u&&this.gTab.setTreeID(u),f&&this.gTab.setTreeTable(f),this.aPanel.isSummaryVisible?this.gTab.setShowSummaryNodes(!0):this.gTab.setShowSummaryNodes(!1));var e=this.gTab.prepareQuery(n,t,i,!1)};n.GridController.prototype.queryCompleted=function(){this.vTable.clear();this.gTab.clearSelectedRow();this.vTable.add(this.gTab.getTableModel().getDataTable());this.gTab.getTableModel().setSortModel(this.vTable.getGrid().records);this.displayAsIncludedGC||(this.onRowInserting?this.onRowInserting():this.checkInsertNewRow());this.navigate(this.gTab.getCurrentRow(),!this.gTab.getTableModel().getIsInserting());this.isCardRow&&this.vCardView.refreshUI(this.getVCardPanel().width());this.isMapRow&&this.vMapView.refreshUI(this.getVMapPanel().width());this.aPanel&&this.aPanel.setBusy(!1);this.skipInserting=!1;this.dynamicDisplay(-1)};n.GridController.prototype.checkInsertNewRow=function(){if(this.aPanel==null)return!1;var t=!0,i=this.gTab.getLinkColumnName(),r=n.context.getWindowContext(this.windowNo,i);return(i.Length>0&&r.length==0&&(t=!1),this.gTab.getTableModel().getTotalRowCount()==0&&!this.gTab.getIsReadOnly()&&(n.context.getIsAutoNew(this.windowNo)||this.gTab.getIsQueryNewRecord())&&t&&this.gTab.getIsInsertRecord()&&!this.skipInserting)?(this.dataNew(!1),!0):!1};n.GridController.prototype.vetoablechange=function(n){var t=this.gTab.getTableModel(),i=this.gTab.getCurrentRow(),r=t.findColumn(n.propertyName);t.setValueAt(n.newValue,i,r)};n.GridController.prototype.refreshUI=function(){this.dataRefreshAll()};n.GridController.prototype.navigate=function(i,r){var u;if(!r&&i==this.gTab.getCurrentRow())return this.gTab.getCurrentRow();if(u=this.gTab.navigate(i,!0,r),u>-1&&!this.rowSetting?(this.settingGridSelecton=!0,this.vTable.select(u),this.settingGridSelecton=!1,this.vCardView.navigate(u,!this.isCardRow)):u>-1&&this.vCardView.navigate(u,!0),u==-1){this.cancelSel=!0;return}if(u>-1&&this.refreshTabPanelData(this.gTab.getRecord_ID()),this.m_tree!=null&&this.m_tree.setSelectedNode(this.gTab.getRecord_ID()),this.vTable.scrollInView(i),this.onDemandTree){var f=this.gTab.getRecord_ID(),e=this.treeID,o=this.aPanel;t.ajax({url:n.Application.contextUrl+"JsonData/GetTreeNodePath",data:{nodeID:f,treeID:e},success:function(n){var t=JSON.parse(n);o.setStatusLine(t)},error:function(n){console.log(n)}})}return this.gTab.getCurrentRow()};n.GridController.prototype.navigatePageExact=function(n){this.gTab.getTableModel().setCurrentPage(n);this.query(this.gTab.getOnlyCurrentDays(),0,!1,this.treeNodeID,this.treeID,this.gTab.getAD_Table_ID())};n.GridController.prototype.navigatePage=function(n){this.gTab.getTableModel().setCurrentPageRelative(n);this.query(this.gTab.getOnlyCurrentDays(),0,!1,this.treeNodeID,this.treeID,this.gTab.getAD_Table_ID())};n.GridController.prototype.navigateRelative=function(n){return this.navigate(this.gTab.getCurrentRow()+n)};n.GridController.prototype.dataRefresh=function(){var n=this.gTab.dataRefresh();this.dynamicDisplay(-1);window.setTimeout(function(n){n.switchIncludedGC();n=null},500,this)};n.GridController.prototype.dataRefreshAll=function(){this.gTab.getTableModel().dataRefreshAll()};n.GridController.prototype.dataSave=function(n){this.m_tree!=null&&this.gTab.SetSelectedNode(this.m_tree.currentNode);var t=this.gTab.dataSave(n);return t,t};n.GridController.prototype.dataNew=function(n){this.isDefaultFocusSet=!1;this.gTab.dataNew(n);this.dynamicDisplay(-1);this.switchIncludedGC();this.onRowInserted&&this.onRowInserted();this.isDefaultFocusSet=!0};n.GridController.prototype.canDeleteRecords=function(){for(var i=this.vTable.getSelection(!0),f=this.vTable.getGrid().records,u=[],r,t=0;t<i.length;t++)r=f[i[t]],"ad_client_id"in r&&(n.MRole.getIsClientAccess(r.ad_client_id,!0)||u.push(i[t]));return u};n.GridController.prototype.dataDelete=function(){var n=this.gTab.dataDelete(this.vTable.getSelection(!0));return this.refreshTabPanelData(this.gTab.getRecord_ID()),this.dynamicDisplay(-1),n};n.GridController.prototype.rowChanged=function(n,i){var r;if(this.m_tree!=null){if(t.isArray(i)&&!n){for(r=0;r<i.length;r++)this.m_tree.nodeChanged(n,i[r],"","","","");return}if(!(i<=0)){var f=this.gTab.getValue("Name"),e=this.gTab.getValue("Description"),u=this.gTab.getValue("IsSummary"),o=u==!0||u=="Y",s=this.gTab.getValue("Action");this.m_tree.nodeChanged(n,i,f,e,o,s)}}};n.GridController.prototype.dataIgnore=function(){this.gTab.dataIgnore();this.dynamicDisplay(-1);this.switchIncludedGC();this.vTable.refreshUndo()};n.GridController.prototype.dataStatusChanged=function(t){var r,i,f,e,u,o,s,h;if(this.displayAsIncludedGC){this.enableDisableToolbarItems(!0);return}if(this.aPanel.dataStatusChanged(t),r=t.getChangedColumn(),t.getIsChanged()&&!(r<0)){if(i=this.gTab.getField(r),i!=null)if(i.getCallout().length>0)f=this.gTab.processFieldChange(i),f.length>0&&n.ADialog.error(f);else for(e=i.getColumnName(),dependants=this.gTab.getDependantFields(e),u=0;u<dependants.length;u++)(o=dependants[u],o!=null)&&(s=o.getLookup(),s!=null)&&(h=s.getValidation(),h.indexOf(e)!=-1);this.dynamicDisplay(r)}};n.GridController.prototype.includeTab=function(n){var t=n.getMTab();return this.gTab.getIncluded_Tab_ID()!=t.getAD_Tab_ID()?!1:(this.vIncludedGC=n,this.vIncludedGC.switchMultiRow(),!0)};n.GridController.prototype.switchSingleRow=function(){if(!this.onlyMultiRow&&!this.singleRow){this.singleRow=!0;this.isCardRow=!1;this.isMapRow=!1;var n=this.getVTablePanel(),t=this.getVPanel();(this.isIncludedGCVisible||!0)&&(n.hide(),t.css("display","block"),this.getVCardPanel().hide(),this.getVMapPanel().hide());this.dynamicDisplay(-1)}};n.GridController.prototype.switchMultiRow=function(){if(this.singleRow){this.singleRow=!1;this.isCardRow=!1;this.isMapRow=!1;var n=this.getVTablePanel();this.getVPanel().hide();this.getVCardPanel().hide();this.getVMapPanel().hide();this.isIncludedGCVisible?n.css({float:"right"}):n.css({float:""});n.show();n=null;this.vTable.resize();this.vTable.refreshRow()}};n.GridController.prototype.switchCardRow=function(){if(!this.isCardRow){this.singleRow=!1;this.isCardRow=!0;this.isMapRow=!1;this.getVTablePanel().hide();this.getVPanel().hide();this.getVMapPanel().hide();var n=this.getVCardPanel();this.isIncludedGCVisible?n.css({float:"right"}):n.css({float:""});n.show();this.vCardView.refreshUI(this.getVCardPanel().width());n=null}};n.GridController.prototype.switchMapRow=function(){if(!this.isMapRow){this.singleRow=!0;this.isCardRow=!1;this.isMapRow=!0;this.getVTablePanel().hide();this.getVPanel().hide();this.getVCardPanel().hide();var n=this.getVMapPanel();this.isIncludedGCVisible?n.css({float:"right"}):n.css({float:""});n.show();this.vMapView.refreshUI(this.getVMapPanel().width());n=null}};n.GridController.prototype.switchIncludedGC=function(){var r,t,i;this.vIncludedGC&&!this.displayAsIncludedGC&&(r=this.isIncludedGCVisible,r||(t=this.aPanel.getIncludedEmptyArea(),t.empty(),i=this.vIncludedGC.getRoot(),i.detach(),this.vIncludedGC.setUI(!0),t.append(i),this.gTab.getHasPanel()?t.css("padding","0px 1px 0px 1px"):t.css("padding","0px 5px 0px 7px"),t.width(n.Application.isMobile?250:350),i.show(),this.vIncludedGC.vTable.activate(),this.vIncludedGC.vTable.setReadOnly(!0),this.isIncludedGCVisible=!0,this.singleRow||(this.singleRow=!0,this.switchMultiRow()),this.vIncludedGC.displayAsIncludedGC=!0,this.vIncludedGC.singleRow=!0,this.vIncludedGC.switchMultiRow(),this.vTable.resize(),this.gTab.getHasPanel()&&this.aPanel.setWidth(-1,!0)),window.setTimeout(function(n){n.vIncludedGC.query(0,0,!1);n=null},1,this))};n.GridController.prototype.removeRecord=function(){var n=this.vTable.getSelection(!0),t;if(n&&n.length>0)for(t=0;t<n.length;t++)this.vTable.grid.unselect(n[t]+1),this.vTable.grid.remove(n[t]+1);this.navigate(0);this.aPanel.setBusy(!1)};n.GridController.prototype.dispose=function(){this.gTab.removeDataStatusListener(this.aPanel);this.gTab.removeDataStatusListener();this.gTab.getTableModel().removeTableModelListener(this.vTable);this.gTab.getTableModel().removeCardModelListener(this.vCardView);this.gTab.getTableModel().removeRowChangedListener();this.gTab.getTableModel().removeQueryCompleteListner();this.disposeComponent();this.gTab=null;this.windowNo=null;this.onlyMultiRow=null;this.aPanel=null;this.m_tree&&this.m_tree.dispose();this.curTabPanel&&(this.curTabPanel.dispose(),this.curTabPanel=null);this.m_tree=null};n.GridController.prototype.HEADER_HEIGHT=55;n.AParentDetail=function(i,r){function y(){f=t("<div class='vis-apanel-bar'>");c=t("<div class='vis-apanel-bar-fixpart' style='background-color:white'>");o=t("<div class='vis-apanel-bar-varpart vis-apanel-bar-pdetail'>");e=t('<div class="vis-apanel-lb-main">');s=t("<div class='vis-apanel-lb-oflow' style='border-left: 1px solid white;'>").hide();s.html("<a data-dir='u' href='javascript:void(0)'><img style='margin-left:10px' data-dir='u' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/arrow-top.png' ><\/a><a data-dir='d' href='javascript:void(0)' ><img style='margin-left:10px' data-dir='d' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/arrow-bottom.png' /><\/a>");o.append(e).append(s);h=t("<div style='width:192px;overflow-y:auto;padding-left: 4px;padding-right:3px;'>");e.append(h);f.append(o).append(c);r.append(f);f.hide()}function a(){for(var r=null,c="",t="",o,s,e=0;e<v;e++)(r=l[e],t=null,t=r.getValue(),t&&t!=""&&r.getIsDisplayed())&&(c+="<h3>"+w2utils.encodeTags(r.getHeader())+"<\/h3>",o=r.getDisplayType(),r.lookup?t=r.lookup.getDisplay(t,!0):n.DisplayType.IsDate(o)?t=new Date(t).toLocaleString():o==n.DisplayType.YesNo?(s=t.toString(),r.getIsEncryptedColumn()&&(s=n.secureEngine.decrypt(s)),t=s.equals("Y")):t=t.toString(),r.getIsEncryptedColumn()&&o!=n.DisplayType.YesNo&&(t=n.secureEngine.decrypt(t)),c+="<h5>"+w2utils.encodeTags(t)+"<\/h5>");h.empty();h.html("<h1>"+i.getMTab().getName()+"<\/h1>"+c);u.setSize(f.height())}function p(){u.curGC&&(u.curGC.multiRowResize(),u.curGC.aPanel.setWidth(-1,!0),u.curGC.aPanel.setTabNavigation())}function w(){a();u.curGC&&(u.curGC.multiRowResize(),u.curGC.aPanel.setWidth(-1,!0),u.curGC.aPanel.setTabNavigation())}var u;this.gc=i;this.$root=r;this.visible=!1;this.expaned=!1;this.curGC=null;var l=i.getMTab().getTableModel().getFields(),v=l.length,c,o,f=null,e,s,h;y();u=this;c.on(n.Events.onTouchStartOrClick,function(n){u.$root.width()>20?u.hide():u.show();n.stopPropagation()});s.on("click",function(n){var r,o;if(n.stopPropagation(),r=t(n.target).data("dir"),r){var s=e.height(),c=h.height(),u=e.scrollTop(),f=Math.ceil(s/2),i=0;if(r=="d"){if(u+f>=c-f)return;o=c-s;i=u+f;e.animate({scrollTop:i>o?o:i},1e3,"easeOutBounce")}else if(r=="u"){if(u==0)return;i=u-f;e.animate({scrollTop:i<0?0:i},1e3,"easeOutBounce")}}});this.show=function(){if(u.expaned){a();return}this.expaned=!0;u.visible&&f.show();r.animate({width:"200px"},300,"swing");o.show().animate({width:"192px"},300,"swing",w)};this.hide=function(){(this.expaned||!this.visible)&&(this.expaned=!1,r.animate({width:u.visible?"8px":"0px"},300,"swing"),u.visible||f.hide(),o.hide().animate({width:"0px"},300,"swing",p))};this.setSize=function(t){f.height(t);e.height(t);h.height()>e.height()&&(n.Application.isMobile||(e.height(t-40),s.show()))};this.disposeComponenet=function(){this.gc=null;this.$root=null;this.visible=null;this.expaned=null;s.off("click");c.off(n.Events.onTouchStartOrClick);c=o=null;f.remove();f=null;u=null;this.curGC=null;l.length=0;l=null;this.show=null;this.hide=null}};n.AParentDetail.prototype.evaluate=function(n){if(this.curGC=null,this.curGC=n,this.gc.getId()===n.getId())this.visible=!1,this.hide();else{if(this.curGC.isParentDetailVisible=!0,this.visible)return;this.visible=!0;this.show()}};n.AParentDetail.prototype.dispose=function(){this.disposeComponenet()};n.VSortTab=function(i,r,u,f,e,o){function g(){b=t("<span>").text(n.Msg.getMsg("N"));k=t("<span>").text(n.Msg.getMsg("Y"));h=t("<ul class='vis-sortTab-select' "+(e?" disabled":"")+">");s=t("<ul class='vis-sortTab-select' "+(e?" disabled":"")+" >");v=t("<button"+(e?" disabled":"")+" ><img src='"+w+"Left32.png' /><\/button");a=t("<button"+(e?" disabled":"")+" ><img src='"+w+"Right32.png' /><\/button");y=t("<button"+(e?" disabled":"")+" ><img src='"+w+"Up32.png' /><\/button");p=t("<button"+(e?" disabled":"")+" ><img src='"+w+"Down32.png' /><\/button");l=t("<table class='vis-apanel-sorttab' style='display:none;'>");var i=t("<td class='vis-apanel-sorttab-td'>");i.append(t("<div class='vis-apanel-sorttab-td-inner'>").append(b).append(h).append(t("<div class='vis-apanel-sorttab-td-right'>").append(a).append(v)));i.append(t("<div class='vis-apanel-sorttab-td-inner'>").append(k).append(s).append(t("<div class='vis-apanel-sorttab-td-right'>").append(y).append(p)));l.append(t("<tr>").append(i))}var l,b,k,h,s,a,v,y,p,w,d,c;this.winNumber=i;this.tableName=null;this.columnSortName=null;this.columnYesNoName=null;this.keyColumnName=null;this.identifierColumnName=null;this.identifierTranslated=!1;this.parentColumnName=null;this.aPanel=null;this.log=n.Logging.VLogger.getVLogger("VSortTab");w=n.Application.contextUrl+"Areas/VIS/Images/base/";d=null;g();this.dynInit(r,u,f);this.getRoot=function(){return l};this.getId=function(){return o};this.getlstModel=function(n){return n?s.find("li"):h.find("li")};this.setLabelName=function(n,t){b.text(n);k.text(t)};this.setListOptions=function(n,t){h.empty();h.append(n);s.empty();s.append(t)};this.setOldValues=function(n){d=n};this.getOldValues=function(){return d};c=this;v.on(n.Events.onTouchStartOrClick,function(n){c.btn_Click("Left");n.stopPropagation()});a.on(n.Events.onTouchStartOrClick,function(n){c.btn_Click("Right");n.stopPropagation()});y.on(n.Events.onTouchStartOrClick,function(n){c.btn_Click("Up");n.stopPropagation()});p.on(n.Events.onTouchStartOrClick,function(n){c.btn_Click("Down");n.stopPropagation()});h.on(n.Events.onClick,"LI",function(){t(this).toggleClass("vis-apanel-sorttab-selected")});s.on(n.Events.onClick,"LI",function(){t(this).toggleClass("vis-apanel-sorttab-selected")});this.btn_Click=function(n){var e=!1,i=null,u,f,c,r,o;if(n=="Right"){for(i=h.find("li.vis-apanel-sorttab-selected"),s.children().removeClass("vis-apanel-sorttab-selected"),u=0;u<i.length;u++)i[u].remove(),t(i[u]).toggleClass("vis-apanel-sorttab-selected"),s.append(i[u]),e=!0;i.length=0;i=0}else if(n=="Left"){for(i=s.find("li.vis-apanel-sorttab-selected"),h.children().removeClass("vis-apanel-sorttab-selected"),f=0;f<i.length;f++)i[f].remove(),t(i[f]).toggleClass("vis-apanel-sorttab-selected"),h.append(i[f]),e=!0;i.length=0;i=0}else{if(i=s.find("li.vis-apanel-sorttab-selected"),i==null)return;if(c=i.length,c==0)return;if(r=t(i[0]),r==null)return;if(s.children().removeClass("vis-apanel-sorttab-selected"),r.addClass("vis-apanel-sorttab-selected"),o=r.index(),n=="Up"){if(o==0)return;r.remove();r.insertBefore(s.find("li").eq(o-1));e=!0}else if(n=="Down"){if(o>=s.children().length-1)return;r.remove();r.insertAfter(s.find("li").eq(o));e=!0}}e&&this.aPanel!=null&&this.aPanel.aSave.setEnabled(!0)};this.disposeComponent=function(){v.off(n.Events.onTouchStartOrClick);a.off(n.Events.onTouchStartOrClick);y.off(n.Events.onTouchStartOrClick);p.off(n.Events.onTouchStartOrClick);this.seletedTab=null;l.remove();l=null;c=null;this.winNumber=null;this.tableName=null;this.columnSortName=null;this.columnYesNoName=null;this.keyColumnName=null;this.identifierColumnName=null;this.identifierTranslated=!1;this.parentColumnName=null;this.aPanel=null;this.log=null;h=null;s=null;y=p=v=a=null;this.btn_Click=this.setListOptions=this.getlstModel=this.setLabelName=this.setListOptions=this.getRoot=this.getId=null;console.log("dispose vSortTab")}};n.VSortTab.prototype.dynInit=function(t,i,r){var e=!n.Env.isBaseLanguage(n.Env.getCtx(),""),o="VIS_122",f=[],u,s;f[0]=new n.DB.SqlParam("@AD_Table_ID",t);f[1]=new n.DB.SqlParam("@AD_ColumnSortOrder_ID",i);f[2]=new n.DB.SqlParam("@AD_ColumnSortYesNo_ID",r);e&&(o="VIS_123",f=[],f[0]=new n.DB.SqlParam("@AD_Table_ID",t),f[1]=new n.DB.SqlParam("@AD_ColumnSortOrder_ID",i),f[2]=new n.DB.SqlParam("@AD_ColumnSortYesNo_ID",r),f[3]=new n.DB.SqlParam("@AD_Language",n.Env.getAD_Language(n.Env.getCtx())));u=this;s="";g(o,f,function(t){if(t!=null){for(var f="";t.read();)u.tableName=t.getString(0),i==t.get(1)?(u.columnSortName=t.getString(2),f=t.getString(3)):r==t.get(1)?u.columnYesNoName=t.getString(2):t.getString(4)=="Y"?u.parentColumnName=t.getString(2):t.getString(5)=="Y"?u.keyColumnName=t.getString(2):t.getString(6)=="Y"&&(u.identifierColumnName=t.getString(2),e&&(u.identifierTranslated="Y"==t.getString(7)));t.close();u.setLabelName(n.Msg.getMsg("Available"),f)}u=null})};n.VSortTab.prototype.setVisible=function(n){n?this.getRoot().show():this.getRoot().hide()};n.VSortTab.prototype.loadData=function(){var t="",e;t+="SELECT t."+this.keyColumnName;t+=this.identifierTranslated?",tt.":",t.";t+=this.identifierColumnName+",t."+this.columnSortName;this.columnYesNoName!=null&&(t+=",t."+this.columnYesNoName);t+=" FROM "+this.tableName+" t";this.identifierTranslated&&(t+=", "+this.tableName+"_Trl tt");t+=" WHERE t."+this.parentColumnName+"=@ID";this.identifierTranslated&&(t+=" AND t."+this.keyColumnName+"=tt."+this.keyColumnName+" AND tt.AD_Language='"+n.Env.getAD_Language(VAdvantage.Utility.Env.getCtx())+"'");t+=" ORDER BY ";this.columnYesNoName!=null&&(t+="4 DESC,");t+="3,2";var c=n.Env.getCtx().getWindowContext(this.winNumber,this.parentColumnName),i=ut(t,[new n.DB.SqlParam("@ID",c)]),o="",s="",r=[];try{while(i.read()){var u=i.get(0),l=i.getString(1),f=i.get(2),h=f!=0;this.columnYesNoName!=null&&(h=i.getString(3)=="Y");e="<li data-value='"+u+"'>"+l+"<\/li>";h?(o+=e,r.push({key:u,value:f})):(s+=e,r.push({key:u,value:f}))}i.close();i.dispose();this.setOldValues(r);this.setListOptions(s,o)}catch(a){this.log.Log(n.Logging.Level.SEVERE,t,a)}this.aPanel.aSave.setEnabled(!1)};n.VSortTab.prototype.saveData=function(){var u;if(this.aPanel.aSave.getIsEnabled()){var f=this.getlstModel(),e=this,o=this.tableName,s=this.columnSortName,h=this.columnYesNoName,c=this.keyColumnName,i=[],r=[];f.each(function(n,u){i.push(t(u).data("value"));r.push("N")});u=this.getlstModel(!0);u.each(function(n,u){i.push(t(u).data("value"));r.push("Y")});t.ajax({url:n.Application.contextUrl+"Form/SetFieldsSorting",async:!1,type:"POST",data:{values:JSON.stringify(i),noYes:JSON.stringify(r),tableName:o,keyColumnName:c,columnSortName:s,columnYesNoName:h,oldValues:JSON.stringify(e.getOldValues())},success:function(){},error:function(){}})}};n.VSortTab.prototype.unRegisterAPanel=function(){this.saveData();this.aPanel=null};n.VSortTab.prototype.registerAPanel=function(n){this.aPanel=n};n.VSortTab.prototype.sizeChanged=function(n){this.getRoot().height(n)};n.VSortTab.prototype.dispose=function(){this.disposeComponent()};n.VGridPanel=function(){function tt(){h=t("<table class='vis-gc-vpanel-table'>")}function l(){p=i=k=d=c=u=g=nt=w=y=null;p=t("<td  class='vis-gc-vpanel-table-td0'>");i=t("<td colspan = '3' class='vis-gc-vpanel-table-td1'>");c=t("<td class='vis-gc-vpanel-table-td2'>");u=t("<td colspan='3' class='vis-gc-vpanel-table-td3'>");w=t("<td class='vis-gc-vpanel-table-td4'>");y=t("<tr>");h.append(y);y.append(p).append(i).append(c).append(u).append(w)}function it(n){var u,r,o;n.stopPropagation();var i=t(this),h=i.data("name"),c=i.data("display"),e=!1;for(c==="show"?(i.data("display","hide"),t(i.children()[0]).addClass("vis-gc-vpanel-fieldgroup-img-rotate")):(i.data("display","show"),e=!0,t(i.children()[0]).removeClass("vis-gc-vpanel-fieldgroup-img-rotate")),u=f[h],r=0;r<u.length;r++)o=s[u[r].getName()],u[r].tag=e,u[r].setVisible(e&&o.getIsDisplayed(!0))}function rt(f){if(r==null&&(r=""),f==null||f.length==0||f.equals(r))return!1;r=f;l();var o=t("<span class='vis-gc-vpanel-fieldgroup-span'>"+f+"<\/span>"),s=t("<img class='vis-gc-vpanel-fieldgroup-img' src= '"+n.Application.contextUrl+"Areas/VIS/Images/base/fieldgrpdown.png' >"),e=t("<div class='vis-gc-vpanel-fieldgroup' data-name='"+f+"' data-display='show' >").append(s).append(o);u.remove();c.remove();i.prop("colspan",8);i.append(e);e.on("click",it);return!0}function b(n){if(r!=null&&!r.equals("")){var t=null;f[r]&&(t=f[r]);t==null&&(t=[],f[r]=t);t.push(n)}}var r=null,e=-2,a=-1,o=[],v=[],h,y=null,p,i,k,d,c,u,g,nt,w,s={},f={};tt();this.addField=function(r,f){var y,p,k,h,w;if(f.getIsLink()){o[++a]=r;v.push(r);return}if((y=n.VControlFactory.getLabel(f),y!=null||r!=null)&&(p=f.getIsSameLine(),rt(f.getFieldGroup())&&(p=!1),p?(++e,e>2?(p=!1,l(),e=0):e<0&&(l(),e=0)):(e=0,l()),y!=null&&(p?u.append(y.getControl()):i.append(y.getControl()),f.getDescription().length>0&&y.getControl().prop("title",f.getDescription()),b(y),s[y.getName()]=f,o[++a]=y),r!=null)){p?u.append(r.getControl()):i.append(r.getControl());k=f.getVFormat();switch(k){case"":break;default:r.getControl().on("focusout",function(i){var r=new RegExp(k);n.DisplayType.IsString(f.getDisplayType())&&t(i.target).val()!=null&&t(i.target).val().toString().trim().length>0&&(r.test(t(i.target).val())||n.ADialogUI.warn(n.Msg.getMsg("RegexFailed")+":"+f.getHeader(),"",function(){t(i.target).focus()}))})}if(h=r.getBtnCount(),h>0){while(h>0)w=r.getBtn(h-1),w!=null&&(p?t("<td class='vis-gc-vpanel-table-td-fix30'>").append(w).insertAfter(u):t("<td class='vis-gc-vpanel-table-td-fix30'>").append(w).insertAfter(i)),--h;h=-1;w=null}h=r.getBtnCount();!p&&f.getIsLongField()?(c.remove(),u.remove(),i.prop("colspan",8-h),i.css("width","100%"),e=2):p?(u.prop("colspan",3-h),e=2):i.prop("colspan",3-h);h=0;b(r);s[r.getName()]=f;o[++a]=r}};this.getRoot=function(){return h};this.getComponents=function(){return o};this.getLinkComponents=function(){return v};this.dispose=function(){var n,t;for(v.length=0,v=null;o.length>0;)o.pop().dispose();for(n in s)s[n]=null,delete s[n];s=null;for(t in f)f[t].length=0,f[t]=null,delete f[n];f=null;a=null;o=null;h.remove();h=null;this.addField=null;l=null;b=null}};r.prototype.ROW_ADD="A";r.prototype.ROW_DELETE="D";r.prototype.ROW_REFRESH="F";r.prototype.ROW_UNDO="U";r.prototype.setupGridTable=function(i,r,u,f,e,o){var v,b,a,c,s,g,ft,p,nt,w;if(!e.getIsDisplayed(!0))return 0;this.id=f;this.$container=u;this.mTab=e;this.AD_Table_ID=this.mTab.getAD_Table_ID();var h=[],l=null,tt=r.length,k=0,d=r.slice(0);for(d.sort(function(n,t){return n.getMRSeqNo()-t.getMRSeqNo()}),v=-1,b=0;b<d.length;b++)if(l=d[b],l!=null){a=l.getColumnName();c=l.getDisplayType();++v;l.getIsKey()?this.indexKeyColumn=v:a.equals("IsActive")?this.indexActiveColumn=v:a.equals("Processed")?this.indexProcessedColumn=v:a.equals("AD_Client_ID")?this.indexClientColumn=v:a.equals("AD_Org_ID")&&(this.indexOrgColumn=v);var y=l.getIsDisplayedMR?l.getIsDisplayedMR():l.getIsDisplayed(),it=l.getIsMandatory(!1),rt=l.getIsReadOnly(),ut=l.getIsEditable(!1);l.getIsHeading()||(s={resizable:!0},s.gridField=l,(rt||!ut)&&(s.readOnly=!0),s.caption=l.getHeader(),it&&(s.caption+='<sup style="color:red;font-size: 11px;top: 0;">*<\/sup>'),s.field=a.toLowerCase(),s.hidden=!y,g=s.gridField.getColumnWidth(),s.size=g?g+"px":"100px",c==n.DisplayType.Amount?(s.sortable=!0,s.customFormat=n.DisplayType.GetNumberFormat(c),s.render=function(n,t,i){var r=h[i].field,u=n[r];return parseFloat(h[i].customFormat.GetFormatedValue(u)).toLocaleString()}):n.DisplayType.IsNumeric(c)?(s.sortable=!0,s.customFormat=n.DisplayType.GetNumberFormat(c),s.render=function(n,t,i){var r=h[i].field,u=n[r];return h[i].customFormat.GetFormatedValue(u)}):c==n.DisplayType.YesNo?(s.sortable=!0,ft=a.toLowerCase(),s.editable={type:"checkbox"}):c==n.DisplayType.String||c==n.DisplayType.Text||c==n.DisplayType.TextLong||c==n.DisplayType.Memo?(s.sortable=!0,s.render=l.getIsEncryptedField()?function(n,t,i){var u=h[i].field,r=n[u];return(n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),r=n[h[i].field],r||r===0)?r.replace(/\w|\W/g,"*"):""}:function(n,t,i){var u=h[i].field,r=n[u];return(n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),r||r==0)?w2utils.encodeTags(r):""}):n.DisplayType.IsLookup(c)||c==n.DisplayType.ID?(s.sortable=!0,s.lookup=l.getLookup(),y&&(s.render=function(n,t,i){var r=h[i].lookup,u=h[i].field,e=n[u],f;return n.changes&&typeof n.changes[u]!="undefined",r&&(f=r.getDisplay(e,!0)),f})):n.DisplayType.IsDate(c)?(s.sortable=!0,s.displayType=c,s.render=function(t,i,r){var o=h[r],e=h[r].field,u=t[e],f;return t.changes&&typeof t.changes[e]!="undefined"&&(u=t.changes[e]),u?o.displayType==n.DisplayType.Date?(f=new Date(u),f.setMinutes(f.getTimezoneOffset()+f.getMinutes()),u=Globalize.format(f,"d")):u=o.displayType==n.DisplayType.DateTime?Globalize.format(new Date(u),"f"):Globalize.format(new Date(u),"t"):u="",u}):c==n.DisplayType.Location||c==n.DisplayType.Locator?(s.sortable=!0,s.lookup=l.getLookup(),y&&(s.render=function(n,t,i){var f=h[i].lookup,u=h[i].field,r=n[u];return n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),f&&(r=f.getDisplay(r,!0),r=w2utils.encodeTags(r)),r})):c==n.DisplayType.AmtDimension?(s.sortable=!0,s.lookup=l.getLookup(),y&&(s.render=function(n,t,i){var f=h[i].lookup,u=h[i].field,r=n[u];return n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),f&&(r=f.getDisplay(r,!0),r=w2utils.encodeTags(r)),r})):c==n.DisplayType.ProductContainer?(s.sortable=!0,s.lookup=l.getLookup(),y&&(s.render=function(n,t,i){var f=h[i].lookup,u=h[i].field,r=n[u];return n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),f&&(r=f.getDisplay(r,!0),r=w2utils.encodeTags(r)),r})):c==n.DisplayType.Account||c==n.DisplayType.PAttribute?(s.sortable=!0,s.lookup=l.getLookup(),y&&(s.render=function(n,t,i){var f=h[i].lookup,u=h[i].field,r=n[u];return n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),f&&(r=f.getDisplay(r,!0),r=w2utils.encodeTags(r)),r})):c==n.DisplayType.PAttribute?(s.sortable=!0,s.render="int"):c==n.DisplayType.Button?s.sortable=!0:c==n.DisplayType.Image?(s.sortable=!0,s.render=function(t,i,r){var u=h[r].field,f=t[u];return(t.changes&&typeof t.changes[u]!="undefined"&&(f=t.changes[u]),!f)?"-":n.Msg.getElement1("AD_Image_ID")+"-"+f}):n.DisplayType.IsLOB(c)?(s.sortable=!0,s.render=function(n,t,i){var u=h[i].field,r=n[u];return n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),r||(r=""),"#"+r.toString().length}):(s.sortable=!0,s.render=function(n,t,i){var u=h[i].field,r=n[u];return(n.changes&&typeof n.changes[u]!="undefined"&&(r=n.changes[u]),r||r==0)?w2utils.encodeTags(r):""}),s.hidden||k++,h.push(s),s.columnName=a,p=n.VControlFactory.getControl(e,l,!1,!1,!1),p.setReadOnly(!1),s.editable||(s.editable={type:"custom",ctrl:p}),p.addVetoableChangeListener(o),p instanceof n.Controls.VButton&&p.addActionListner(i))}if(k>0){nt=Math.floor(100/k);for(w in h)h[w].hidden||!h[w].size<0&&(h[w].size=nt+"%",h[w].min=100)}return this.grid=t().w2grid({name:f,autoLoad:!1,columns:h,records:[],show:{toolbar:!1,columnHeaders:!0,lineNumbers:!1,selectColumn:!0,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},recordHeight:36,onSelect:this.onSelectLocal,onUnselect:this.onUnSelect,onSort:this.onSort,onClick:this.onSingleClick,onDblClick:this.onClick,onEditField:this.onEditField,onChange:this.onChange,onRowAdd:this.onRowAdd}),tt};r.prototype.get=function(n,t){return this.grid.get(n,t)};r.prototype.activate=function(){this.grid&&!this.rendred&&(this.$container.w2render(this.grid.name),this.rendred=!0)};r.prototype.setReadOnly=function(n){this.readOnly=n};r.prototype.getGrid=function(){return this.grid};r.prototype.select=function(n){var t=this.grid.getSelection();if(t.indexOf(n)==-1){if(t.length==1)this.grid.unselect(t[0]);else if(t.length>1)while(t.length>0)this.grid.unselect(t.pop());return this.grid.select(n)}};r.prototype.add=function(n){this.grid.add(n)};r.prototype.clear=function(){this.grid.clear(!0);this.grid.reset()};r.prototype.refresh=function(){this.grid.refresh()};r.prototype.resize=function(){this.grid.resize()};r.prototype.setRow=function(n){isNaN(n)?this.grid.set(n.recid,n):this.grid.set(n)};r.prototype.refreshRow=function(n,t){if(!(this.grid.records.length<1)){var i=this.mTab.getCurrentRow();i<0||(typeof n!="undefined"&&(i=n),this.paintRow(t?this.grid.get(n,!0):i),this.grid.clearRowChanges(t?n:this.grid.records[i].recid))}};r.prototype.refreshCells=function(){if(!(this.grid.records.length<1)){var n=this.mTab.getCurrentRow();this.paintRow(n);this.grid.refreshRow(this.grid.records[n].recid)}};r.prototype.refreshUndo=function(){if(!(this.grid.records.length<1)){var n=this.mTab.getCurrentRow();this.grid.clearRowChanges(this.grid.records[n].recid);this.paintRow(n);this.grid.refreshRow(this.grid.records[n].recid)}};r.prototype.getSelection=function(n){return this.grid.getSelection(n)};r.prototype.getSelectedRows=function(){for(var t=this.grid.getSelection(!0),i=[],n=0,r=t.length;n<r;n++)i.push(this.grid.records[t[n]]);return i};r.prototype.getColumnNames=function(){for(var t=this.grid.columns,i={},n=0,r=t.length;n<r;n++)i[t[n].columnName]=t[n].caption;return i};r.prototype.scrollInView=function(n){this.grid.scrollIntoView(n)};r.prototype.tableModelChanged=function(t,i,r){var u,f,e;if(this.blockSelect=!0,t===n.VTable.prototype.ROW_REFRESH)this.setRow(i),this.refreshRow(i.recid,!0);else{if(u=null,t===n.VTable.prototype.ROW_UNDO)this.grid.unselect(i),this.grid.remove(i),r>=this.grid.records.length-1&&this.grid.records.length>0?(this.blockSelect=!1,u=this.grid.records[this.grid.records.length-1].recid):r<this.grid.records.length&&(u=this.grid.records[r].recid);else if(t===n.VTable.prototype.ROW_ADD)this.grid.records.splice(r,0,i),u=i.recid,this.grid.refresh(),this.blockSelect=!0;else if(t===n.VTable.prototype.ROW_DELETE){for(f=i.slice();f.length>0;)e=f.pop(),this.grid.unselect(e),this.grid.remove(e);isNaN(r)?u=r[0]:this.grid.records.length>0&&(u=this.grid.records[this.grid.records.length-1<r?this.grid.records.length-1:r].recid)}u&&this.select(u)}this.blockSelect=!1};r.prototype.setDefaultFocus=function(n){var t=this.grid.getSelection(),i=this.grid.getColumn(n.toLower(),!0);t&&t.length>0&&this.grid.dblClick(t[0],{metaKey:!0})};r.prototype.dispose=function(){var n,t;this.grid.off("select",this.onSelect);this.grid.off("sort",this.onSort);this.grid.off("click",this.onClick);this.onSelect=null;this.onSort=null;n=this.grid.columns;for(t in n)n[t].editable.ctrl&&n[t].editable.ctrl.dispose();this.grid.destroy();this.grid=null;this.id=null;this.$container=null;this.rendered=null;this.disposeComponenet()};e.prototype.tableModelChanged=function(t,i,r){var u=null,f,e;if(t===n.VTable.prototype.ROW_REFRESH)u=i.recid?i.recid:i;else if(t===n.VTable.prototype.ROW_UNDO)this.getBody().find("div.vis-cv-card[name~=vc_"+i+"]").remove();else if(t===n.VTable.prototype.ROW_DELETE){for(f=i.slice();f.length>0;)e=f.pop(),this.getBody().find("div.vis-cv-card[name~=vc_"+e+"]").remove();isNaN(r)&&(u=r[0])}else t===n.VTable.prototype.ROW_ADD&&(u=i.recid);u&&this.navigate(u)};e.prototype.setupCardView=function(t,i,r){this.mTab=i;var u=this;n.dataContext.getCardViewInfo(i.getAD_Window_ID(),i.getAD_Tab_ID(),function(n){u.setCardViewData(n)});r.append(this.getHeader());r.append(this.getRoot())};e.prototype.setCardViewData=function(n){var i,t,r;if(this.hasIncludedCols=!1,this.fields=[],this.cGroup=null,this.cConditions=[],n)for(this.AD_CardView_ID=n.AD_CardView_ID,t=this.mTab.getFieldById(n.FieldGroupID),t&&(this.cGroup=t),this.cConditions=n.Conditions,i=0;i<n.IncludedCols.length;i++)t=this.mTab.getFieldById(n.IncludedCols[i]),t&&this.fields.push(t),this.hasIncludedCols=!0;this.fields.length<1&&this.fields.length<1&&(t=this.mTab.getField("Name"),t&&this.fields.push(t),t=this.mTab.getField("Description"),t&&this.fields.push(t),t=this.mTab.getField("Help"),t&&this.fields.push(t));for(r in this.cGroupInfo)this.cGroupInfo[r].records.length=0;this.cGroupInfo={};this.grpCount=0;this.isProcessed=!1};e.prototype.createGroups=function(){var f,t,u,r,i;if(this.isProcessed){for(f in this.cGroupInfo)this.cGroupInfo[f].records=[];return}if(this.cGroup)if(t=this.cGroup,t){if(t.getDisplayType()==n.DisplayType.YesNo)this.cGroupInfo["true"]={name:"Yes",records:[]},this.cGroupInfo["false"]={name:"No",records:[]},this.grpCount=2;else if(n.DisplayType.IsLookup(t.getDisplayType())&&t.getLookup())for(u=t.getLookup(),u.fillCombobox(!0,!0,!0,!1),r=u.data,i=0;i<r.length;i++)this.cGroupInfo[r[i].Key]={name:r[i].Name,records:[]},this.grpCount+=1;this.setHeader(t.getHeader())}else this.setHeader("");this.grpCount<1&&(this.cGroupInfo.All={name:n.Msg.getMsg("All"),records:[]},this.grpCount=1);this.isProcessed=!0};e.prototype.refreshUI=function(n){var u,r,t,f,i;for(this.createGroups(),u=this.mTab.getTableModel().mSortList,r=this.getBody();this.groupCtrls.length>0;)this.groupCtrls.pop().dispose();if(this.groupCtrls.length=0,r.empty(),t=null,this.grpCount==1){f="";for(i in this.cGroupInfo){f=this.cGroupInfo[i].name;break}t=new d(!0,u,f,this.fields,this.cConditions);this.groupCtrls.push(t);r.append(t.getRoot())}else{this.filterRecord(u);for(i in this.cGroupInfo)t=new d(this.grpCount===1,this.cGroupInfo[i].records,this.cGroupInfo[i].name,this.fields,this.cConditions),this.groupCtrls.push(t),r.append(t.getRoot())}this.calculateWidth(n)};e.prototype.filterRecord=function(n){for(var e=n.length,o=this.cGroup.getColumnName().toLowerCase(),i=null,u=null,t,f,r=0;r<e;r++)i=n[r],u=i[o],this.cGroupInfo[u]?this.cGroupInfo[u].records.push(i):(this.cGroupInfo.Other__1||(this.cGroupInfo.Other__1={name:"Others",records:[]},this.grpCount+=1),this.cGroupInfo.Other__1.records.push(i));t=[];for(f in this.cGroupInfo)this.cGroupInfo[f].records.length<1&&t.push(f);for(this.grpCount-=t.length;t.length>0;)delete this.cGroupInfo[t.pop()]};e.prototype.dispose=function(){this.dC()};d.prototype.dispose=function(){this.dC()};l.prototype.evaluate=function(t){for(var i=null,r=0;r<t.length;r++)(i=t[r],i.ConditionValue)&&n.Evaluator.evaluateLogic(this,i.ConditionValue)&&this.setColor(i.Color,i.FColor)};l.prototype.getValueAsString=function(n){var t=this.record[n.toLowerCase()];return t?(t===!0?t="Y":t&&t.toString().endsWith(".000Z")&&(t=t.replace(".000Z","Z")),t=t.toString()):t===!1?t="N":t===0&&(t="0"),t};l.prototype.dispose=function(){this.dC()};a.prototype.setupMapView=function(n,t,i,r){var u,f,e;for(this.mapFields=[],u=i.getMapColumns(),f=0;f<u.length;f++)e=i.getField(u[f]),e&&this.mapFields.push(e);this.cols=u;this.gc=t;this.aPanel=n;this.mapcols={};this.curIndex=0;r.append(this.getRoot())};a.prototype.refreshUI=function(){var u=this.gc.getSelectedRows(),o=u.length,s,n,t,i,r;if(!(u.length<1)&&!(this.cols.length<1)){for(s=[[]],n=0;n<this.cols.length;n++){var h=this.cols[n],f=this.mapFields[n].getLookup(),e=[];for(t=0;t<o;t++)i=u[t][h.toLowerCase()],i&&(r=f.getLatLng(i),r&&(r.msg=f.getDisplay(i),e.push(r)));this.mapcols[n]=e}this.setMapData(this.mapcols[this.curIndex])}};a.prototype.dispose=function(){this.dc()};n.RecordInfo=function(i,r){function c(){e=null;s=null;u.remove();u=null}var e=null,o=i,s=n.Logging.VLogger.getVLogger("VIS.RecordInfo"),u=t("<div style='min-width:550px;max-width:600px'>"),f=null,h={CreatedBy:r.CreatedBy,Created:r.Created,Updated:r.Updated,UpdatedBy:r.UpdatedBy,Info:r.Info,AD_Table_ID:r.AD_Table_ID,Record_ID:r.Record_ID};n.dataContext.getJSONData(n.Application.contextUrl+"JsonData/GetRecordInfo",{dse:h},function(n){var s,h,f,c,o;if(u.html("<span>"+n.Info+"<\/span>"),n.ShowGrid){s=t("<table class='vis-advancedSearchTable'>");h=t("<div class='vis-advancedSearchTableWrap vis-table-responsive' style='max-height:200px;overflow-y:auto'>").append(s);u.append(h);var i="",e="",r=null;for(f=0,c=n.Rows.length;f<c;f++){if(f==0){for(i+='<thead><tr class="vis-advancedSearchTableHead">',o=0;o<n.Headers.length;o++)i+="<th>"+n.Headers[o]+"<\/th>";i+="<\/tr><\/thead><tbody>"}e='<tr class="vis-advancedSearchTableRow">';r=n.Rows[f];e+="<td>"+r.AD_Column_ID+"<\/td><td>"+r.NewValue+"<\/td><td>"+r.OldValue+"<\/td><td>"+r.UpdatedBy+"<\/td><td>"+Globalize.format(new Date(r.Updated),"f")+"<\/td>";e+="<\/tr>";i+=e}i+="<\/tbody>";s.html(i)}});this.show=function(){f=new n.ChildDialog;f.setTitle(o);f.setContent(u);f.close=function(){c()};f.show()}};n.AWindow=u;n.AppsAction=f;n.APanel=i;n.VTable=r;n.VCardView=e;n.VMapView=a}(VIS,jQuery),function(n,t){function l(n,i,r){var u=null;return t.ajax({url:y,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function v(i,r,u){var f=null;return i.sql=n.secureEngine.encrypt(i.sql),t.ajax({url:w,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:r,data:JSON.stringify(i)}).done(function(n){f=n;u&&u(n)}),f}function e(t){this.vo=t._vo;this.tabs=[];for(var i=0;i<t._tabs.length;i++)this.tabs.push(new n.GridTab(t._tabs[i],this.vo));t=null}function i(t,i){this.gTab=t;this.vo=t._vo;this.gridTable=new n.GridTable(t._gridTable);this.parents=[];this.orderBys=[];this.depOnFieldColumn=[];this.depOnField=[];this.tabPanels=[];this.linkColumnName=t._linkColumnName;this.extendendWhere=t._extendedWhere;this.keyColumnName="";this.isThroughRoleCenter=!1;this.query=new n.Query;this.oldQuery="0=9";this.linkValue="999999";this.currentRow=-1;this.hasPanel=!1;this.mDataStatusEvent;this.mDataListenerList=[];this.loadFields();this.loadTabPanels();this.gridTable.addDataStatusListener(this);this.gridTable.setAD_Tab_ID(this.vo.AD_Tab_ID);this.log=n.Logging.VLogger.getVLogger("VIS.GridTab");this.loadData(i);i=null}function r(t){this.gTable=t;this.readOnly=this.gTable._readOnly;this.AD_Table_ID=t._AD_Table_ID;this.deleteable=this.gTable._deleteable;this.gridFields=[];this.keyColumnName="";this.isOpen=!1;this.inserting=!1;this.SQL_Select="";this.SQL_Count="";this.SQL="";this.bufferList=[];this.defaultModel={};this.pazeSize=n.Env.getWINDOW_PAGE_SIZE();this.newRow=-1;this.compareDB=!0;this.treeNode_ID=0;this.treeTable_ID=0;this.treeID=0;this.selectedTreeNode=0;this.ShowSummaryNodes=!1;this.isZoomAction=!1;this.currentPage;this.dopaging;t=null;this.mSortList;this.AD_Tab_ID=0;this.log=n.Logging.VLogger.getVLogger("VIS.GridTable")}function u(t){this.gfield=t;this.vo=t._vo;this.oldValue;this.value;this.inserting;this.error;this.valueNoFire=!0;var i=null;this.vo.IsDisplayedf&&(t._vo.lookupInfo!=null&&n.DisplayType.IsLookup(t._vo.displayType)?n.DisplayType.IsLookup(t._vo.displayType)&&(i=new n.MLookup(t._vo.lookupInfo,t._lookup),this.vo.tabNo>0?(i.initialize(!0),n.MLookupCache.addWindowLookup(this.vo.windowNo,i)):i.initialize()):t._vo.displayType==n.DisplayType.Location?i=new n.MLocationLookup(n.context,t._vo.windowNo):t._vo.displayType==n.DisplayType.Locator?i=new n.MLocatorLookup(n.context,t._vo.windowNo):t._vo.displayType==n.DisplayType.Account?i=new n.MAccountLookup(n.context,t._vo.windowNo):t._vo.displayType==n.DisplayType.PAttribute?i=new n.MPAttributeLookup(n.context,t._vo.windowNo):t._vo.displayType==n.DisplayType.GAttribute?i=new n.MGAttributeLookup(n.context,t._vo.windowNo):t._vo.displayType==n.DisplayType.AmtDimension?i=new n.MAmtDivLookup(n.context,t._vo.windowNo):t._vo.displayType==n.DisplayType.ProductContainer&&(i=new n.MProductContainerLookup(n.context,t._vo.windowNo)));this.lookup=i;this.propertyChangeListner;this.log=n.Logging.VLogger.getVLogger("VIS.GridField");t=null}function h(n){this.tPanel=n;this.vo=n._vo}function f(t,i,r,u,f){this.mTotalPage=1;this.mCurrentPage=1;this.mPageSize=n.Env.getWINDOW_PAGE_SIZE();this.totalRecords=1;this.m_totalRows=i;this.m_changed=r;this.m_autoSave=u;this.m_inserting=f;this.m_AD_Message;this.m_info=null;this.m_isError=!1;this.m_isWarning=!1;this.m_confirmed=!1;this.m_allLoaded=!0;this.m_loadedRows=-1;this.m_currentRow=-1;this.m_changedColumn=-1;this.m_columnName=null;this.Created;this.CreatedBy;this.Updated;this.UpdatedBy;this.Info;this.AD_Table_ID;this.Record_ID;this.source=t}var o=n.Logging.Level,c=n.Application.contextUrl,y=c+"JsonData/JDataSetWithCode",p=c+"JsonData/ExecuteNonQuer",w=c+"Form/JDataSet",s=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,l(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u},b=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,l(f,e,function(t){u=(new n.DB.DataSet).toJson(t);r&&r(u)}),u},k=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u;return i&&(e.param=i),u=null,l(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u},d=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u;return i&&(e.param=i),u=null,v(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u},a=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,v(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u},g=function(n,i,r){var f=r?!0:!1,u=null,e={sql:n.join("/"),param:i};return t.ajax({url:p+"ies",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:f,data:JSON.stringify(e)}).done(function(n){u=n;r&&r(n)}),u};e.prototype.getTabs=function(){return this.tabs};e.prototype.getIsAppointment=function(){return this.vo.IsAppointment};e.prototype.getIsTask=function(){return this.vo.IsTask};e.prototype.getIsEmail=function(){return this.vo.IsEmail};e.prototype.getIsLetter=function(){return this.vo.IsLetter};e.prototype.getIsSms=function(){return this.vo.IsSms};e.prototype.getIsChat=function(){return this.vo.IsChat};e.prototype.getIsAttachment=function(){return this.vo.IsAttachment};e.prototype.getIsHistory=function(){return this.vo.IsHistory};e.prototype.getIsCheckRequest=function(){return this.vo.IsCheckRequest};e.prototype.getIsCopyReocrd=function(){return this.vo.IsCopyReocrd};e.prototype.getIsSubscribedRecord=function(){return this.vo.IsSubscribedRecord};e.prototype.getIsZoomAcross=function(){return this.vo.IsZoomAcross};e.prototype.getIsCreatedDocument=function(){return this.vo.IsCreatedDocument};e.prototype.getIsUploadedDocument=function(){return this.vo.IsUploadedDocument};e.prototype.getIsViewDocument=function(){return this.vo.IsViewDocument};e.prototype.getIsAttachDocumentFrom=function(){return this.vo.IsAttachDocumentFrom};e.prototype.getIsFaxEmail=function(){return this.vo.IsFaxEmail};e.prototype.getIsMarkToExport=function(){return this.vo.IsMarkToExport};e.prototype.getIsArchive=function(){return this.vo.IsArchive};e.prototype.getIsImportMap=function(){return this.vo.IsImportMap};e.prototype.getIsAttachmail=function(){return this.vo.IsAttachmail};e.prototype.getIsRoleCenterView=function(){return this.vo.IsRoleCenterView};e.prototype.getIsSOTrx=function(){return this.vo.IsSOTrx};e.prototype.getIsTransaction=function(){return this.vo.IsTransaction};e.prototype.getName=function(){return this.vo.Name};e.prototype.getWindowWidth=function(){return this.vo.WinWidth};e.prototype.getHasPanel=function(){return this.vo.hasPanel};e.prototype.dispose=function(){var n;for(originalLength=this.tabs.length,n=originalLength;n>0;n--)gtab=this.tabs.pop(),gtab.dispose(),gtab=null;this.tabs.length=0;this.vo=null;this.tabs=null};i.prototype.getAD_Tab_ID=function(){return this.vo.AD_Tab_ID};i.prototype.getAD_Window_ID=function(){return this.vo.AD_Window_ID};i.prototype.getAD_Table_ID=function(){return this.vo.AD_Table_ID};i.prototype.getTableName=function(){return this.vo.TableName};i.prototype.getName=function(){return this.vo.Name};i.prototype.getDescription=function(){return this.vo.Description};i.prototype.getIsSortTab=function(){return this.vo.IsSortTab};i.prototype.getDependentOn=function(){var t=[];return n.Evaluator.parseDepends(t,this.vo.DisplayLogic),t};i.prototype.getTabLevel=function(){return this.vo.TabLevel};i.prototype.getWindowNo=function(){return this.vo.windowNo};i.prototype.getTabNo=function(){return this.vo.tabNo};i.prototype.getIsSingleRow=function(){return this.vo.IsSingleRow};i.prototype.getIsDisplayed=function(t){var i=this.vo.DisplayLogic,r;return i==null||i.equals("")?!0:t?i.indexOf("@#")!=-1&&(r=n.Env.parseContext(n.context,0,i,!1,!0).trim(),r.Length!=0)?n.Evaluator.evaluateLogic(this,i):!0:n.Evaluator.evaluateLogic(this,i)};i.prototype.getValueAsString=function(t){return n.context.getWindowContext(this.vo.windowNo,t,!0)};i.prototype.getIsCurrent=function(){if(!this.gridTable.getIsOpen()||!this.oldQuery.equals(this.query.getWhereClause()))return!1;if(!this.getIsDetail())return!0;var t=n.context.getWindowContext(this.vo.windowNo,this.getLinkColumnName());return this.linkValue.equals(t)};i.prototype.getIsDetail=function(){return this.parents.length>0||this.vo.AD_Column_ID!=0?!0:!1};i.prototype.getField=function(n){return this.gridTable.getField(n)};i.prototype.getFieldById=function(n){return this.gridTable.getFieldById(n)};i.prototype.getFields=function(){return this.gridTable.getFields()};i.prototype.getLinkColumnName=function(){return this.linkColumnName?this.linkColumnName:""};i.prototype.getOnlyCurrentDays=function(){return this.getIsZoomAction()?0:this.vo.onlyCurrentDays};i.prototype.getShowSummaryLevel=function(){return this.vo.ShowSummaryLevel};i.prototype.getIsTreeTab=function(){return this.vo.HasTree};i.prototype.getRowCount=function(){return this.gridTable.getRowCount()};i.prototype.getRecords=function(){return this.gridTable.getDataTable()};i.prototype.getCurrentRow=function(){return this.currentRow};i.prototype.getOrderByClause=function(n){var i,t;if(this.vo.orderByClause.length>0)return this.vo.OrderByClause;for(this.vo.orderByClause="",i=0;i<3;i++)t=this.orderBys[i],t&&t!=null&&t!=""&&t.length>0&&(this.vo.orderByClause.length>0&&(this.vo.OrderByClause+=","),this.vo.orderByClause+=t);return this.vo.orderByClause.Length>0?this.vo.orderByClause:(this.vo.orderByClause="Created",n>0&&(this.vo.orderByClause+=" DESC"),this.vo.orderByClause)};i.prototype.getTableModel=function(){return this.gridTable};i.prototype.getIsOpen=function(){return this.gridTable!=null?this.gridTable.getIsOpen():!1};i.prototype.getIsQueryActive=function(){return this.query!=null?this.query.getIsActive():!1};i.prototype.getDependantFields=function(n){var i=[],r,t;if(this.depOnFieldColumn.indexOf(n)!=-1)for(r=this.depOnFieldColumn.length,t=0;t<r;t++)this.depOnFieldColumn[t].equals(n)&&i.indexOf(this.depOnField[t])<0&&i.push(this.depOnField[t]);return i};i.prototype.getIsReadOnly=function(){if(this.vo.IsReadOnly)return!0;if(this.vo.ReadOnlyLogic==null||this.vo.ReadOnlyLogic.equals(""))return this.vo.IsReadOnly;return n.Evaluator.evaluateLogic(this,this.vo.ReadOnlyLogic)};i.prototype.getIsQueryNewRecord=function(){return this.query!=null?this.query.getIsNewRecordQuery():!1};i.prototype.getIsInsertRecord=function(){return this.getIsReadOnly()?!1:this.vo.IsInsertRecord};i.prototype.getIncluded_Tab_ID=function(){return this.vo.Included_Tab_ID};i.prototype.getIsAlwaysUpdateField=function(){for(var t,n=0;n<this.gridTable.getColumnCount();n++)if(t=this.gridTable.getField(n),t.getIsAlwaysUpdateable())return!0;return!1};i.prototype.getValue=function(n){if(n==null)return null;var t=this.gridTable.getField(n);return this.getValueOfField(t)};i.prototype.getValueOfField=function(n){return n==null?null:n.getValue()};i.prototype.getAD_Process_ID=function(){return this.vo.AD_Process_ID};i.prototype.getRecord_ID=function(){return this.gridTable.getKeyID(this.currentRow)};i.prototype.getKeyID=function(n){return this.gridTable.getKeyID(n)};i.prototype.getTrxInfo=function(i,r,u){var e,f,l,a,v,y,p;if(i.startsWith("C_Order")||i.startsWith("C_Invoice")){var e,h=i.startsWith("C_Order"),o=null,s=null;try{o=new n.MessageFormat(n.Msg.getMsg("OrderSummary"));s=new n.MessageFormat(n.Msg.getMsg("OrderSummaryMC"))}catch(w){}if(o==null||s==null)return" ";var arguments=[],c=!1,f=null;try{e=0;e=h?r.getContextAsInt(u,"C_Order_ID"):r.getContextAsInt(u,"C_Invoice_ID");f=null;t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GetTrxInfo",data:{Record_ID:e,isOrder:h},success:function(t){f=(new n.DB.DataReader).toJson(t)}});f.read()&&(l=f.getInt(0),arguments[0]=l,a=f.getDecimal(2),arguments[1]=a,v=f.getDecimal(3),arguments[2]=v,y=f.getString(1),arguments[3]=y,p=f.getDecimal(4),arguments[4]=p,arguments[5]=r.getContext("$CurrencyISO"),c=!0)}catch(w){}finally{f!=null&&f.dispose()}return c?arguments[2]===arguments[4]?o.format(arguments):s.format(arguments):" "}};i.prototype.getIsProcessed=function(){var i=this.gridTable.findColumn("Processed"),t;if(i!=-1){if(t=this.gridTable.getValueAt(this.currentRow,i),typeof t=="string")return"Y".equals(t);if(typeof t=="boolean")return t}return"Y".equals(n.context.getWindowContext(this.vo.windowNo,"Processed"))};i.prototype.getKeyColumnName=function(){return this.keyColumnName};i.prototype.getAD_ColumnSortOrder_ID=function(){return this.vo.AD_ColumnSortOrder_ID};i.prototype.getIsMapView=function(){return this.vo.locationCols&&this.vo.locationCols.length>0?!0:!1};i.prototype.getMapColumns=function(){return this.vo.locationCols};i.prototype.getAD_ColumnSortYesNo_ID=function(){return this.vo.AD_ColumnSortYesNo_ID};i.prototype.getWhereClause=function(){return this.vo.WhereClause};i.prototype.getSearchQuery=function(t){for(var r=null,f=this.getFields(),i=null,u=0;u<f.length;u++)(i=f[u],i.getIsVirtualColumn())||i.getColumnName().toLowerCase()!="export_id"&&n.DisplayType.IsText(i.getDisplayType())&&(r||(r=new n.Query(this.getTableName(),!0)),r.addRestriction(i.getColumnName(),n.Query.prototype.LIKE,t,i.getColumnName(),t));return f=null,i=null,r};i.prototype.getParentColumnNames=function(){return this.parents};i.prototype.clearSelectedRow=function(){for(var i=this.gridTable.getFields().length,t,n=0;n<i;n++)t=this.gridTable.getField(n),t.getIsKey()?t.setValue(null,!1):t.setNullValue()};i.prototype.setCurrentRow=function(n,t){var e=-1,c=this.verifyRow(n),r,s,u,i,h,o;for(this.currentRow=c,r=this.gridTable.getRow(this.currentRow),r&&(e=r.recid),s=this.gridTable.getFields().length,u=0;u<s;u++)i=this.gridTable.getField(u),r?(h=r[i.getColumnName().toLowerCase()],i.setValue(h,this.gridTable.getIsInserting())):i.getIsKey()?i.setValue(null,!1):i.setNullValue();return t?(this.mDataStatusEvent==null&&(this.mDataStatusEvent=new f(null,this.getRowCount(),this.gridTable.getIsInserting(),!1,this.gridTable.getIsInserting()),this.mDataStatusEvent.setPageInfo(this.gridTable.currentPage,this.gridTable.rowCount,this.gridTable.pazeSize)),this.mDataStatusEvent.setCurrentRow(this.currentRow),o=this.mDataStatusEvent.getAD_Message(),(o==null||o.length==0)&&this.mDataStatusEvent.setInfo("NavigateOrUpdate",null,!1,!1),this.fireDataStatusChanged(this.mDataStatusEvent),e):e};i.prototype.fireDataStatusEventOnly=function(){this.mDataStatusEvent==null&&(this.mDataStatusEvent=new f(null,this.getRowCount(),this.gridTable.getIsInserting(),!1,this.gridTable.getIsInserting()),this.mDataStatusEvent.setPageInfo(this.gridTable.currentPage,this.gridTable.rowCount,this.gridTable.pazeSize));this.mDataStatusEvent.setCurrentRow(this.currentRow);var n=this.mDataStatusEvent.getAD_Message();(n==null||n.length==0)&&this.mDataStatusEvent.setInfo("NavigateOrUpdate",null,!1,!1);this.fireDataStatusChanged(this.mDataStatusEvent)};i.prototype.setQuery=function(t){t==null?this.query=new n.Query:(this.query=t,this.vo.onlyCurrentDays=0)};i.prototype.setValue=function(t,i){var r,u;if(!(t instanceof n.GridField)){if(t==null)return"NoColumn";t=this.gridTable.getField(t)}return t==null?"NoField":(r=t.getDisplayType(),i==null||i.toString()==""?i=null:i===0&&(n.DisplayType.IsID(r)||r==n.DisplayType.List)&&!this.getIsStdColumn(t.getColumnName().toUpper())&&(i=null),u=this.gridTable.findColumn(t.getColumnName()),this.gridTable.setValueAt(i,this.currentRow,u,!1),this.processFieldChange(t))};i.prototype.getIsStdColumn=function(n){return n=="AD_USER_ID"||n=="AD_ROLE_ID"||n=="AD_CLIENT_ID"||n=="AD_ORG_ID"?!0:!1};i.prototype.addDataStatusListener=function(n){this.mDataListenerList.push(n)};i.prototype.removeDataStatusListener=function(n){for(var t=this.mDataListenerList.length-1;t>=0;t--)this.mDataListenerList[t]===n&&(this.mDataListenerList[t]=null,this.mDataListenerList.splice(t,1))};i.prototype.needSave=function(n,t){return n?this.gridTable.needSave(-2,t):t?this.gridTable.needSave():this.gridTable.needSave(t)};i.prototype.loadFields=function(){for(var t,n,i,e,f,r=0;r<this.gTab._gridTable.m_fields.length;r++){for(t=new u(this.gTab._gridTable.m_fields[r]),this.gridTable.gridFields.push(t),n=t.getColumnName(),t.getIsKey()&&(this.keyColumnName=n,this.gridTable.setKeyColumnName(n)),t.getIsParentColumn()&&this.parents.push(n),i=t.getSortNo(),i==0||(Math.abs(i)==1?(this.orderBys[0]=n,i<0&&(this.orderBys[0]+=" DESC")):Math.abs(i)==2?(this.orderBys[1]=n,i<0&&(this.orderBys[1]+=" DESC")):Math.abs(i)==3&&(this.orderBys[2]=n,i<0&&(this.orderBys[2]+=" DESC"))),e=t.getDependentOn(),f=0;f<e.length;f++)this.depOnFieldColumn.push(e[f]),this.depOnField.push(t);(n.equals("IsActive")||n.equals("Processed")||n.equals("Processing"))&&(this.depOnFieldColumn.push(n),this.depOnField.push(null));t=null}};i.prototype.loadTabPanels=function(){var n,t;if(this.gTab._panels&&this.gTab._panels.length>0)for(this.hasPanel=!0,n=0;n<this.gTab._panels.length;n++)t=new h(this.gTab._panels[n]),this.tabPanels.push(t);else this.hasPanel=!1};i.prototype.getHasPanel=function(){return this.hasPanel};i.prototype.getTabPanels=function(){return this.tabPanels};i.prototype.validateQuery=function(t){var i,r,h,f,c,e,u,v,l;if(t==null||t.getRestrictionCount()==0)return null;if(t.getRestrictionCount()!=1||(i=t.getColumnName(0),i==null)||i.indexOf("(")!=-1)return t.getWhereClause();if(r=null,i.equals("R_RequestRelated_ID")?r="R_Request_ID":i.startsWith("C_DocType")?r="C_DocType_ID":i.equals("CreatedBy")||i.equals("UpdatedBy")?r="AD_User_ID":i.equals("Orig_Order_ID")?r="C_Order_ID":i.equals("Orig_InOut_ID")&&(r="M_InOut_ID"),r!=null){if(this.getField(r)!=null)return t.setColumnName(0,r),t.getWhereClause();r=null}if(this.getField(i)!=null)return t.getWhereClause();h="VIS_104";u=[];u[0]=new n.DB.SqlParam("@colName",i);f=null;try{f=s(h,u);f.read()&&(r=f.getString(0))}catch(a){return this.log.log(o.SEVERE,"(ref) - Column="+i,a),t.getWhereClause()}finally{f!=null&&f.dispose()}if(r!=null){if(t.setColumnName(0,r),this.getField(r)!=null)return this.log.fine("Column "+i+" replaced with "+r),t.getWhereClause();i=r}c=null;e=this.getKeyColumnName();h="VIS_105";u=[];u[0]=new n.DB.SqlParam("@colName",i);u[1]=new n.DB.SqlParam("@tabKeyColumn",e);try{f=s(h,u);f.read()&&(c=f.getString(0))}catch(a){return this.log.log(o.SEVERE,"Column="+i+", Key="+e,a),null}finally{f!=null&&f.dispose()}return e.equals("AD_Reference_ID")?(h="VIS_106",u=[],u[0]=new n.DB.SqlParam("@colName",i),v=k(h,u),"AD_Reference_ID="+v):c==null?(this.log.info("Not successfull - Column="+i+", Key="+e+", Query="+t),t.getWhereClause()):(t.setTableName("xx"),l="EXISTS (SELECT * FROM "+c+" xx WHERE "+t.getWhereClause(!0)+" AND xx."+e+"="+this.getTableName()+"."+e+")",this.log.fine(l),l)};i.prototype.setTreeNodeID=function(n){this.treeNode_ID=n;this.gridTable.treeNode_ID=n};i.prototype.setTreeID=function(n){this.treeID=n;this.gridTable.treeID=n};i.prototype.setTreeTable=function(n){this.treeTable_ID=n;this.gridTable.treeTable_ID=n};i.prototype.setShowSummaryNodes=function(n){this.ShowSummaryNodes=n;this.gridTable.ShowSummaryNodes=n};i.prototype.setIsZoomAction=function(n){this.isZoomAction=n;this.gridTable.isZoomAction=n};i.prototype.getIsZoomAction=function(){return this.isZoomAction};i.prototype.prepareQuery=function(t,i,r,u){var v=!0,w=!1,l=this.oldQuery.equals(this.query.getWhereClause())&&this.vo.onlyCurrentDays==t,f,y,s,o,p,k,h,a,e,c;if(this.getIsTreeTab()&&(this.getShowSummaryLevel()||this.gridTable.setDoPaging(!1),this.getShowSummaryLevel()&&(this.gridTable.setDoPaging(!0),l=!1)),this.oldQuery=this.query.getWhereClause(),this.vo.onlyCurrentDays=t,f="",u||(f+=this.vo.WhereClause),!this.ShowSummaryNodes&&this.getShowSummaryLevel()&&(f+=f.length>0?" AND IsSummary='N'":" IsSummary='N'"),this.getOnlyCurrentDays()>0&&(f.length>0&&(f+=" AND "),y=this.findColumn("Processed")!=-1,y&&(f+="(Processed='N' OR "),f+=r?"Created>=":"Updated>=",f+="addDays(SysDate, -"+this.vo.onlyCurrentDays+")",y&&(f+=")")),this.isThroughRoleCenter||this.getIsDetail()&&(s=this.getLinkColumnName(),s.equals("")?(f.length>0&&(f+=" AND "),f+=" 2=3",v=!1):(o=n.context.getWindowContext(this.vo.windowNo,s),l&&(l=this.linkValue.equals(o),w=!l),this.linkValue=o,o.length==0?(f.length>0&&(f+=" AND "),f+=" 2=4",v=!1):(f.length>0&&(f+=" AND "),"NULL".equals(o.toUpper())?f+=s+" IS NULL ":(f+=s+"=",f+=s.endsWith("_ID")?o:"'"+o+"'")))),this.extendedWhere=f.toString(),this.query.getIsActive()&&(p=this.validateQuery(this.query),p==null||w||(f.length>0&&(f+=" AND "),f+=p)),this.gridTable.getIsOpen())l?this.gridTable.dataRefreshAll():this.gridTable.dataRequery(f.toString());else{if(!this.isZoomAction&&(k="VIS_107",h=[],h[0]=new n.DB.SqlParam("@AD_User_ID",n.Env.getCtx().getAD_User_ID()),h[1]=new n.DB.SqlParam("@AD_Client_ID",n.Env.getCtx().getAD_Client_ID()),h[2]=new n.DB.SqlParam("@AD_Tab_ID",this.gridTable.AD_Tab_ID),h[3]=new n.DB.SqlParam("@AD_Table_ID",this.gridTable.AD_Table_ID),a="",e=b(k,h),e&&e.tables[0].rows&&e.tables[0].rows.length>0)){for(c=0;c<e.tables[0].rows.length;c++)n.Env.getCtx().getAD_User_ID()==e.tables[0].rows[c].cells.ad_user_id&&this.gridTable.AD_Tab_ID==e.tables[0].rows[c].cells.ad_tab_id&&(a=e.tables[0].rows[c].cells.code);a&&(f=f.length>0?f+" AND "+a:a)}this.gridTable.setSelectWhereClause(f.toString());this.gridTable.open(i)}return v};i.prototype.dataRefresh=function(){var n=this.currentRow,t=this.gridTable.dataRefresh(n);return this.setCurrentRow(n,!0),t};i.prototype.dataIgnore=function(){this.gridTable.dataIgnore();this.setCurrentRow(this.currentRow,!1)};i.prototype.SetSelectedNode=function(n){this.gridTable.selectedTreeNode=n};i.prototype.dataSave=function(t){try{var i=this.gridTable.dataSave(t)==n.GridTable.prototype.SAVE_OK;return t&&this.setCurrentRow(this.currentRow,!1),i,i}catch(r){this.log.log(n.Logging.Level.SEVERE,"#"+this.vo.tabNo+" - row="+this.currentRow,r)}return!1};i.prototype.dataNew=function(t){var r,u,f,i;if(!this.getIsInsertRecord())return this.log.warning("Insert Not allowed in TabNo="+this.vo.tabNo),null;if(this.vo.tabNo>0){if(r="Y".equals(n.context.getWindowContext(this.vo.windowNo,"Processed")),r)return this.log.warning("Not allowed in TabNo="+this.vo.tabNo+" -> Processed="+r),null;this.log.finest("Processed="+r)}if(u=this.gridTable.dataNew(this.currentRow,t),!u)return u;for(this.setCurrentRow(this.currentRow+1,!0),f=this.getFieldCount(),i=0;i<f;i++)this.processCallout(this.getField(i));for(i=0;i<f;i++)this.getField(i).setError(!1);return u};i.prototype.dataDelete=function(n){var t=this.gridTable.dataDelete(n,this.currentRow);return this.setCurrentRow(this.currentRow,!0),t};i.prototype.findColumn=function(n){return this.gridTable.findColumn(n)};i.prototype.navigate=function(n,t,i){var u=-1,r=null;return!i&&(n===this.currentRow||(r=this.verifyRow(n),r===this.currentRow))?u:(r=r!=null?r:this.currentRow,this.gridTable.dataSave(r,!1)&&(u=this.setCurrentRow(r,t)),u)};i.prototype.verifyRow=function(n){var t=n,i;return this.gridTable.getIsOpen()?(i=this.getRowCount(),i==0)?-1:(t>=i?t=i-1:t<0&&(t=0),t):-1};i.prototype.navigateRelative=function(n){return this.navigate(this.currentRow+n)};i.prototype.hasDependants=function(n){return this.depOnFieldColumn.indexOf(n)!==-1};i.prototype.dataStatusChanged=function(n){var i=n.getCurrentRow(),r=n.getAD_Message(),t;n.setCurrentRow(this.currentRow);this.mDataStatusEvent=n;i==this.currentRow?(t=this.gridTable.getField(n.getChangedColumn()),t!=null):this.fireDataStatusChanged(this.mDataStatusEvent)};i.prototype.fireDataStatusChanged=function(n){var u=this.mDataListenerList,t,i,f,r;if(u.length!=0){if(n.getCurrentRow()>=0){if(n.Created=this.getValue("Created"),n.CreatedBy=this.getValue("CreatedBy"),n.Updated=this.getValue("Updated"),n.UpdatedBy=this.getValue("UpdatedBy"),n.Record_ID=this.getKeyID(n.getCurrentRow()),t=new StringBuilder(this.getTableName()),this.keyColumnName!=null&&this.keyColumnName.length>0)t.append(" - ").append(this.keyColumnName).append("=").append(n.Record_ID);else for(i=0;i<this.parents.length;i++)f=this.parents[i],t.append(" - ").append(f).append("=").append(this.getValue(f));n.Info=t.toString()}for(n.setInserting(this.gridTable.getIsInserting()),r=0;r<u.length;r++)u[r].dataStatusChanged(n)}};i.prototype.processFieldChange=function(n){return this.processDependencies(n),this.processCallout(n)};i.prototype.processDependencies=function(t){var r=t.getColumnName(),f,u,i,e;if(this.hasDependants(r))for(f=this.getDependantFields(r),u=0;u<f.length;u++){if(i=f[u],i!=null&&i.getLookup()instanceof n.MLookup&&(e=i.getLookup(),e.getValidation().indexOf("@"+r+"@")!=-1))if(r=="C_BPartner_ID"&&i.getColumnName()=="C_BPartner_Location_ID")continue;else this.log.fine(r+" changed - "+i.getColumnName()+" set to null"),this.setValue(i,null);i!=null&&i.getLookup()instanceof n.MLocatorLookup}};i.prototype.processCallout=function(t){var l=t.getCallout(),e,i;if(l.length==0||this.getIsProcessed())return"";for(var v=t.getValue(),y=t.getOldValue(),a=new n.StringTokenizer(l,";,",!1);a.hasMoreTokens();){var u=a.nextToken().trim(),h=null,f=null,r=u,c=u.lastIndexOf(".");try{c!=-1&&(r=u.substring(0,c).replace("ViennaAdvantage","VIS").replace("VAdvantage","VIS"),e=n.Utility.getFunctionByName(r,window),e||r.startsWith("VIS")||(r="VIS"+r.substring(r.indexOf(".")),e=n.Utility.getFunctionByName(r,window)),h=new e,f=u.substring(c+1))}catch(s){return this.log.log(o.SEVERE,r,s),"Callout Invalid: "+r+" ("+s.toString()+")"}if(h==null||f==null||f.length==0)return"Callout Invalid: "+f;i="";try{i=h.start(n.context,f,this.vo.windowNo,this,t,v,y)}catch(s){return this.log.log(n.Logging.Level.SEVERE,"start",s),i="Callout Invalid: "+s.toString()}if(i&&!i.toString().equals(""))return i instanceof Error&&(i=i.toString()+"-> "+u),this.log.warning(i),i}return""};i.prototype.getFieldCount=function(){return this.gridTable.getColumnCount()};i.prototype.getCM_ChatID=function(){var t;return((this.chats==null||this.chats.length==0)&&this.loadChats(),this.chats==null)?0:(t=this.getRecord_ID(),this.hasKey(this.chats,t))?n.Utility.Util.getValueOfInt(this.getKeyValue(this.chats,t)):0};i.prototype.getCM_SubScribedID=function(){var t;return((this._subscribe==null||this._subscribe.length==0)&&this.loadSubscribe(),this._subscribe==null)?0:(t=this.getRecord_ID(),this.hasKey(this._subscribe,t))?n.Utility.Util.getValueOfInt(this.getKeyValue(this._subscribe,t)):0};i.prototype.hasKey=function(n,t){for(var i=0;i<n.length;i++)if(n[i].ID===t)return!0;return!1};i.prototype.getKeyValue=function(n,t){for(var i=0;i<n.length;i++)if(n[i].ID===t)return n[i].value;return 0};i.prototype.getCommitWarning=function(){return this.vo.CommitWarning};i.prototype.getField=function(n){return this.gridTable.getField(n)};i.prototype.dispose=function(){if(this.gTab=null,this.vo=null,this.gridTable.removeDataStatusListener(this),this.gridTable.dispose(),this.gridTable=null,this.mDataListenerList!=null)for(var n=this.mDataListenerList.length-1;n>=0;n--)this.mDataListenerList[n]=null,this.mDataListenerList.splice(n,1)};i.prototype.getIsLocked=function(){if(!n.MRole.getIsPersonalLock()||this.isDataLoading||(this._Lock==null&&this.loadLocks(),this._Lock==null||this._Lock.length==0))return!1;var t=this.getRecord_ID();return this._Lock.indexOf(t)>-1};i.prototype.loadLocks=function(){var f=n.context.getAD_User_ID(),r,i,t,u;if(this.canHaveAttachment()){r="VIS_108";i=[];i[0]=new n.DB.SqlParam("@AD_User_ID",f.toString());i[1]=new n.DB.SqlParam("@AD_Table_ID",this.vo.AD_Table_ID.toString());t=null;try{for(this._Lock==null?this._Lock=[]:this._Lock.length=0,t=s(r,i);t.read();)u=n.Utility.Util.getValueOfInt(t.get("Record_ID")),this._Lock.push(u);t.close();t=null}catch(e){this.log.log(o.SEVERE,r,e)}this.log.fine("#"+this._Lock.length)}};i.prototype.loadSubscribe=function(){var r,i,t,u,f;if(this.canHaveAttachment()){r="VIS_109";i=[];i[0]=new n.DB.SqlParam("@AD_User_ID",n.context.getAD_User_ID());i[1]=new n.DB.SqlParam("@AD_Table_ID",this.getAD_Table_ID());t=null;try{for(this._subscribe=[],this._subscribe==null?this._subscribe={}:this._subscribe.length=0,t=s(r,i);t.read();)u=n.Utility.Util.getValueOfInt(t.getString(1)),f=n.Utility.Util.getValueOfInt(t.getString(0)),this._subscribe.push({ID:u,value:f});t=null}catch(e){}}};i.prototype.loadDocuments=function(){var r,i,t,u,f;if(this.canHaveAttachment()){r="VIS_110";i=[];i[0]=new n.DB.SqlParam("@ad_table_id",this.getAD_Table_ID());t=null;try{for(this.viewDocument=[],this.viewDocument==null?this.viewDocument={}:this.viewDocument.length=0,t=s(r,i);t.read();)u=n.Utility.Util.getValueOfInt(t.getString(1)),f=n.Utility.Util.getValueOfInt(t.getString(0)),this.viewDocument.push({ID:u,value:f});t=null}catch(e){}}};i.prototype.loadChats=function(){var r,i,t,u,f;if(this.canHaveAttachment()){r="VIS_111";i=[];i[0]=new n.DB.SqlParam("@AD_Table_ID",this.getAD_Table_ID());t=null;try{for(this.chats=[],this.chats==null?this.chats={}:this.chats.length=0,t=s(r,i);t.read();)u=n.Utility.Util.getValueOfInt(t.getString(1)),f=n.Utility.Util.getValueOfInt(t.getString(0)),this.chats.push({ID:u,value:f});t=null}catch(e){}}};i.prototype.canHaveAttachment=function(){return this.keyColumnName.endsWith("_ID")?!0:!1};i.prototype.hasChat=function(){if(this.isDataLoading||(this.chats==null&&this.loadChats(),this.chats==null))return!1;var n=this.getRecord_ID();return this.hasKey(this.chats,n)};i.prototype.hasDocument=function(){if(this.isDataLoading||(this.viewDocument==null&&this.loadDocuments(),this.viewDocument==null))return!1;var n=this.getRecord_ID();return this.hasKey(this.viewDocument,n)};i.prototype.HasSubscribed=function(){if(this.isDataLoading||(this._subscribe==null&&this.loadSubscribe(),this._subscribe==null))return!1;var n=this.getRecord_ID();return this.hasKey(this._subscribe,n)};i.prototype.loadAttachments=function(){var r,i,t,u,f;if(this.canHaveAttachment()){r="VIS_112";i=[];i[0]=new n.DB.SqlParam("@AD_Table_ID",this.getAD_Table_ID());t=null;try{for(this._attachments=[],t=s(r,i);t.read();)u=n.Utility.Util.getValueOfInt(t.getString(1)),f=n.Utility.Util.getValueOfInt(t.getString(0)),this._attachments.push({ID:u,value:f});t=null}catch(e){}}};i.prototype.loadMarking=function(){var i=[],t,r,u;i[0]=new n.DB.SqlParam("@AD_Table_ID",this.getAD_Table_ID());t=null;try{for(this._marking=[],t=s("VIS_113",i);t.read();)r=n.Utility.Util.getValueOfInt(t.getString(1)),u=n.Utility.Util.getValueOfInt(t.getString(0)),this._marking.push({ID:r,value:u});t=null}catch(f){}};i.prototype.hasAttachment=function(){if(this.isDataLoading||(this._attachments==null&&this.loadAttachments(),this._attachments==null))return!1;var n=this.getRecord_ID();return this.hasKey(this._attachments,n)};i.prototype.hasMarked=function(){if(this.isDataLoading||(this._marking==null&&this.loadMarking(),this._marking==null))return!1;var n=this.getRecord_ID();return this.hasKey(this._marking,n)};i.prototype.loadData=function(){this.isDataLoading=!1;this.isExportLoading=!1;this._attachments=this.gTab._attachments;this.chats=this.gTab._chats;this._lock=this.gTab._pAccess;this._subscribe=this.gTab._subscribe;this.viewDocument=this.gTab._documents};i.prototype.locks=function(t,i,r){var u=t.getAD_User_ID();n.dataContext.updateInsertLocks(u,this.vo.AD_Table_ID,i,r);this.loadLocks()};i.prototype.setRecordStatus=function(n){var t=n};r.prototype.ctx=n.context;r.prototype.SAVE_OK="O";r.prototype.SAVE_ERROR="E";r.prototype.SAVE_ACCESS="A";r.prototype.SAVE_MANDATORY="M";r.prototype.SAVE_ABORT="U";r.prototype.SAVE_REGEX_ERROR="R";r.prototype.getReadOnly=function(){return!1};r.prototype.setAD_Tab_ID=function(n){this.AD_Tab_ID=n};r.prototype.getField=function(n){var r,t,i;if(isNaN(n)){if(n==null||n.length==0)return null;for(r=this.gridFields.length,t=0;t<r;t++)if(i=this.gridFields[t],n.equals(i.getColumnName(),!0))return i;return null}return n<0||n>=this.gridFields.length?null:this.gridFields[n]};r.prototype.getFieldById=function(n){var r,t,i;if(n<1)return null;for(r=this.gridFields.length,t=0;t<r;t++)if(i=this.gridFields[t],n===i.getAD_Field_ID())return i;return null};r.prototype.getIsInserting=function(){return this.inserting};r.prototype.getColumnCount=function(){return this.gridFields.length};r.prototype.getFields=function(){return this.gridFields};r.prototype.getWhereClause=function(t){for(var h=this.gridFields.length,s=null,u=null,f,i,r,e=0;e<h;e++)if(f=this.gridFields[e],f.getIsKey()){if(i=f.getColumnName().toLowerCase(),r=t[i],r==null)return this.log.log(n.Logging.Level.WARNING,"PK data is null - "+i),null;s=i.toUpperCase().endsWith("_ID")?new StringBuilder(i).append("=").append(r):new StringBuilder(i).append("=").append(n.DB.to_string(r.toString()))}else if(f.getIsParentColumn()){if(i=f.getColumnName().toLowerCase(),r=t[i],r==null){this.log.log(o.INFO,"FK data is null - "+i);continue}u==null?u=new StringBuilder:u.append(" AND ");i.toUpperCase().endsWith("_ID")?u.append(i).append("=").append(r):u.append(i).append("=").append(n.DB.to_string(r.toString()))}return s!=null?s.toString():u!=null?u.toString():(this.log.log(o.WARNING,"No key Found"),null)};r.prototype.getIsOpen=function(){return this.isOpen};r.prototype.getTableID=function(){return this.gTable._AD_Table_ID};r.prototype.getDataTable=function(){return this.bufferList};r.prototype.getSortModel=function(){return this.mSortList};r.prototype.getRow=function(n){return this.mSortList[n]};r.prototype.getRowCount=function(){return this.mSortList?this.mSortList.length:this.bufferList?this.bufferList.length:0};r.prototype.getTotalRowCount=function(){return this.rowCount};r.prototype.getValueAt=function(n,t){var i=this.getRow(n);return i&&t in i?i[t]:null};r.prototype.checkMaxMin=function(){for(var o=new StringBuilder,e=this.gridFields.length,r="",u="",i,f=0;f<e;f++)if(i=this.gridFields[f],n.DisplayType.IsNumeric(i.getDisplayType()))if(r=i.getMaxValue(),u=i.getMinValue(),t.isNumeric(r)&&t.isNumeric(u)){if(i.getValue()>i.getMaxValue()||i.getValue()<i.getMinValue())return n.ADialog.error("ValidationError",!0,": "+n.Msg.getMsg("VIS_ValueOf")+" "+i.getHeader()+" "+n.Msg.getMsg("VIS_MustBetween")+" "+i.getMinValue()+" "+n.Msg.getMsg("VIS_And")+i.getMaxValue()),!1}else if(t.isNumeric(r)){if(i.getValue()>r)return n.ADialog.error("ValidationError",!0,": "+n.Msg.getMsg("VIS_ValueOf")+" "+i.getHeader()+" "+n.Msg.getMsg("VIS_Lessthan")+" "+r),!1}else if(t.isNumeric(u)&&i.getValue()<u)return n.ADialog.error("ValidationError",!0,": "+n.Msg.getMsg("VIS_ValueOf")+" "+i.getHeader()+" "+n.Msg.getMsg("VIS_Greaterthan")+" "+u),!1;return!0};r.prototype.getMandatory=function(n){for(var i=new StringBuilder,f=this.gridFields.length,t,u,r=0;r<f;r++)t=this.gridFields[r],t.getIsMandatory(!0)&&(u=t.getColumnName().toLowerCase(),(n[u]==null||n[u].toString().length==0)&&(t.setInserting(!0),t.setError(!0),i.length()>0&&i.append(", "),i.append(t.getHeader())));return i.length()==0?"":i.toString()};r.prototype.getErrorColumns=function(){for(var n=new StringBuilder,r=this.gridFields.length,i,t=0;t<r;t++)i=this.gridFields[t],i.getIsError()&&(n.length()>0&&n.append(", "),n.append(i.getHeader()));return n.length()==0?"":n.toString()};r.prototype.getClientOrg=function(n){var u=-1,t,i,r;return this.gTable._indexClientColumn!=-1&&(t=this.getValueAt(n,"ad_client_id"),t!=null&&(u=t)),i=0,this.gTable._indexOrgColumn!=-1&&(r=this.getValueAt(n,"ad_org_id"),r!=null&&(i=r)),[u,i]};r.prototype.getKeyID=function(n){if(this.gTable._indexKeyColumn!=-1)try{var t=this.getValueAt(n,this.keyColumnName.toLowerCase());return t==null||isNaN(t)?-1:t}catch(i){return-1}return-1};r.prototype.setKeyColumnName=function(n){this.keyColumnName=n};r.prototype.setTableName=function(n){this.isOpen||n!=null&&n.length!=0&&(this.gTable._tableName=n)};r.prototype.setReadOnly=function(n){this.readOnly=n};r.prototype.setDeleteable=function(n){this.gTable._deleteable=n};r.prototype.setOrderClause=function(n){this.gTable._orderClause=n;this.gTable._orderClause==null&&(this.gTable._orderClause="")};r.prototype.setSelectWhereClause=function(n){return this.isOpen?!1:(this.gTable._whereClause=n,this.gTable._whereClause==null&&(this.gTable._whereClause=""),!0)};r.prototype.setDoPaging=function(n){this.dopaging=n};r.prototype.setCurrentPage=function(n){this.currentPage=n};r.prototype.setCurrentPageRelative=function(n){var t=this.currentPage;isNaN(n)?t=Math.ceil(this.rowCount/this.pazeSize):n!==0?t+=n:t=1;this.currentPage=t};r.prototype.setSortModel=function(n){this.mSortList=null;this.mSortList=n};r.prototype.setValueAt=function(n,i,r,u){var f,e,o,s;!this.isOpen||i<0||r<0||this.rowCount==0||(f=this.getField(r),e=this.getValueAt(i,f.getColumnName().toLowerCase()),u||(e!=null||n!=null)&&e!==n)&&(o=this.getRow(i),this.rowChanged=i,this.rowData==null&&(this.rowData={},t.extend(this.rowData,o)),f.setValue(n,this.inserting),o[f.getColumnName().toLowerCase()]=n,s=this.createDSE(),s.setChangedColumn(r,f.getColumnName()),this.fireDataStatusChanged(s))};r.prototype.needSave=function(n,t){var i=n,r=t;return(arguments.length==0?(i=this.rowChanged,r=!1):arguments.length==1?(i=arguments[0],r=!1):(i=arguments[0],r=arguments[1]),typeof this.changed=="undefined"||!this.changed&&(this.rowChanged==-1||typeof this.rowChanged=="undefined"))?!1:this.changed&&(typeof this.rowChanged=="undefined"||this.rowChanged==-1)&&r?!1:i==this.rowChanged?!1:!0};r.prototype.findColumn=function(n){for(var i=this.gridFields,r,t=0;t<i.length;t++)if(r=i[t],n.equals(r.getColumnName(),!0))return t;return-1};r.prototype.createSelectSql=function(){var t=this.gTable,r,u,e,o,f,i;if(this.gridFields.length==0||t._tableName==null||t._tableName.equals(""))return"";for(r=new StringBuilder("SELECT "),u=null,e=0;e<this.gridFields.length;e++)e>0&&r.append(", "),o=this.gridFields[e],u=o.getColumnSQL(!0),u.indexOf("@")==-1?r.append(u):r.append(n.Env.parseContext(this.ctx,t._windowNo,u,!1));return u=null,r.append(" FROM ").append(t._tableName),this.SQL_Select=r.toString(),this.SQL_Count="SELECT COUNT(*) FROM "+t._tableName,f=new StringBuilder(""),i=t._whereClause,i.length>0&&(f.append(" WHERE "),i.indexOf("@")==-1?f.append(i):f.append(n.Env.parseContext(this.ctx,t._windowNo,i,!1)),i.toUpperCase().indexOf("=NULL")>0&&this.log.Severe("Invalid NULL - "+_tableName+"="+i)),this.SQL=this.SQL_Select+f.toString(),this.SQL_Count+=f.toString(),t._withAccessControl&&(this.SQL=n.MRole.addAccessSQL(this.SQL,t._tableName,n.MRole.SQL_FULLYQUALIFIED,n.MRole.SQL_RO),this.SQL_Count=n.MRole.addAccessSQL(this.SQL_Count,t._tableName,n.MRole.SQL_FULLYQUALIFIED,n.MRole.SQL_RO)),t._orderClause.equals("")||(this.SQL+=" ORDER BY "+t._orderClause),this.ctx.setWindowTabContext(t._windowNo,t._tabNo,"SQL",this.SQL),this.SQL};r.prototype.open=function(i){if(this.maxRows=i,this.isOpen)return this.dataRefreshAll(),!0;if(this.createSelectSql(),this.SQL==null||this.SQL.equals(""))return!1;this.rowCount=0;var r=0;return this.treeNode_ID>0?t.ajax({url:n.Application.contextUrl+"jsonData/GetRecordCountForTreeNode",data:{sqlIn:this.gTable._whereClause,AD_Table_ID:this.AD_Table_ID,treeID:this.treeID,treeNodeID:this.treeNode_ID,windowNo:this.gTable._windowNo,summaryOnly:this.ShowSummaryNodes},type:"POST",async:!1,success:function(n){r=JSON.parse(n)},error:function(){}}):r=d(this.SQL_Count,null),this.rowCount=r,this.rowCount>0?(this.fillData(),this.isOpen=!0,this.changed=!1,this.rowChanged=-1):(this.bufferList!=null&&(this.bufferList.length=0),this.mSortList!=null&&(this.mSortList=null),this.currentPage=1,this.isOpen=!0,this.changed=!1,this.rowChanged=-1,window.setTimeout(function(n){n.fireQueryCompleted(!0)},300,this)),!0};r.prototype.fillData=function(){var i;this.pazeSize=n.Env.getWINDOW_PAGE_SIZE();this.maxRows>0&&this.rowCount>this.maxRows?(this.pazeSize=this.maxRows,this.rowChanged=this.maxRows):(!this.dopaging||this.pazeSize>this.rowCount)&&(this.pazeSize=this.rowCount);this.dopaging&&this.rowCount+this.pazeSize<=this.currentPage*this.pazeSize&&--this.currentPage;this.bufferList.length=0;var t=this,r=this.createGridFieldArr(this.gridFields,!0),i={sql:this.SQL,page:this.dopaging?this.currentPage:0,pageSize:this.dopaging?this.pazeSize:0};this.treeNode_ID>0?(i={sql:this.SQL,page:this.dopaging?this.currentPage:0,pageSize:this.dopaging?this.pazeSize:0},this.SQL_Count=n.secureEngine.encrypt(this.SQL_Count),i.sql=n.secureEngine.encrypt(i.sql),n.dataContext.getWindowRecordsForTreeNode(i,r,this.rowCount,this.SQL_Count,this.AD_Table_ID,this.treeID,this.treeNode_ID,function(n){var s,e,r,u,f,i;try{if(n!=null){if(s=0,n.getTables().length!=0)for(e=n.getTable(0).getRows(),r=n.getTable(0).getColumnsName(),u=0;u<e.length;u++){for(f=e[u].getJSCells(),i=0;i<r.length;i++)f[r[i]]=t.readDataOfColumn(r[i],f[r[i]]);t.bufferList[u]=f;s++}n.dispose();n=null}}catch(h){this.log.Log(o.SEVERE,t.SQL,h)}t.fireQueryCompleted(!0);t=null})):(this.SQL_Count=n.secureEngine.encrypt(this.SQL_Count),i.sql=n.secureEngine.encrypt(i.sql),n.dataContext.getWindowRecords(i,r,this.rowCount,this.SQL_Count,this.AD_Table_ID,function(n){var s,e,r,u,f,i;try{if(n!=null){if(s=0,n.getTables().length!=0)for(e=n.getTable(0).getRows(),r=n.getTable(0).getColumnsName(),u=0;u<e.length;u++){for(f=e[u].getJSCells(),i=0;i<r.length;i++)f[r[i]]=t.readDataOfColumn(r[i],f[r[i]]);t.bufferList[u]=f;s++}n.dispose();n=null}}catch(h){this.log.Log(o.SEVERE,t.SQL,h)}t.fireQueryCompleted(!0);t=null}))};r.prototype.readDataOfColumn=function(t,i){var f,u,r,o,e;if(i==null)return i;try{if(f=this.getField(t),f==null)return i;u=f.getColumnName();r=f.getDisplayType();n.DisplayType.IsID(r)&&(u.endsWith("_ID")||u.endsWith("_Acct"))||u.endsWith("atedBy")||u.endsWith("_ID_1")||u.endsWith("_ID_2")||u.endsWith("_ID_3")||r==n.DisplayType.Integer?i=n.Utility.Util.getValueOfInt(i):n.DisplayType.IsNumeric(r)?i=n.Utility.Util.getValueOfDecimal(i):n.DisplayType.IsDate(r)?dte=null:r==n.DisplayType.RowID?i=null:r==n.DisplayType.YesNo?(o=i.toString(),f.getIsEncryptedColumn()&&(o=this.decrypt(o)),i=o.equals("Y")):n.DisplayType.IsLOB(r)?(e=i,e==null&&(i=null),i=typeof e==typeof string?e.toString():e):i=i.toString();f.getIsEncryptedColumn()&&r!=n.DisplayType.YesNo&&(i=this.decrypt(i))}catch(s){console.log(s)}return i};r.prototype.encrypt=function(t){return t==null||t.length<1?t:n.secureEngine.encrypt(t)};r.prototype.decrypt=function(t){return t==null||t.length<1?t:n.secureEngine.isEncrypted(t)?n.secureEngine.decrypt(t):t};r.prototype.dataSave=function(n,t){return arguments.length==2?!this.changed&&(typeof this.rowChanged=="undefined"||this.rowChanged==-1)?!0:n==this.rowChanged?!0:this.dataSaveL(t)==r.prototype.SAVE_OK:this.dataSaveL(t)};r.prototype.dataSaveL=function(i){var o,f,a,v,y,d,u,s,r;if(!this.isOpen)return this.log.warning("Error - Open="+this.isOpen),this.SAVE_ERROR;if(this.rowChanged==-1&&(this.log.config("NoNeed - Changed="+this.changed+", Row="+this.rowChanged),!i))return this.SAVE_OK;if(this.rowData==null)return this.log.fine("No Changes"),this.SAVE_ERROR;if(this.readOnly)return log.warning("IsReadOnly - ignored"),this.dataIgnore(),this.SAVE_ACCESS;if(this.rowChanged==-1)if(this.newRow!=-1)this.rowChanged=this.newRow;else return this.fireDataStatusEEvent("SaveErrorNoChange","",!1),this.SAVE_ERROR;var p=this.getClientOrg(this.rowChanged),w=p[0],b=p[1];if(!n.MRole.canUpdate(w,b,this.AD_Table_ID,0,!0))return this.fireDataStatusEEvent("cant-update"),this.dataIgnore(),this.SAVE_ACCESS;for(o=this.getRow(this.rowChanged),u=0;u<this.gridFields.length;u++)if(f=this.gridFields[u],n.DisplayType.IsString(f.getDisplayType())&&f.value!=null&&f.value.toString().trim().length>0&&!new RegExp(f.getVFormat()).test(f.value))return this.fireDataStatusEEvent("RegexFailed",(f.getHeader()==""?f.getColumnName():f.getHeader())+"\n",!0),f.propertyChangeListner.ctrl.focus(),this.SAVE_ERROR;if(a=this.getMandatory(o),a.length!=0)return this.fireDataStatusEEvent("FillMandatory",a+"\n",!0),this.SAVE_MANDATORY;if(this.checkMaxMin()){if(v=this.getErrorColumns(),v.length!=0)return this.fireDataStatusEEvent("Error",v+"\n",!0),this.SAVE_ERROR;y=0;this.inserting||(y=this.getKeyID(this.rowChanged));var k=[],l=this.gridFields,g=l.length;k=this.createGridFieldArr(l);var e=this.createGridFieldArr(l,!0),h={},c={};if(t.extend(!0,h,o),t.extend(!0,c,this.rowData),e&&e.length>0)for(d=e.length,u=0;u<d;u++)h[e[u]]&&(h[e[u]]=this.encrypt(h[e[u]])),c[e[u]]&&(c[e[u]]=this.encrypt(c[e[u]]));return s={Record_ID:y,AD_Table_ID:this.AD_Table_ID,TableName:this.gTable._tableName,Inserting:this.inserting,CompareDB:this.compareDB,RowData:h,OldRowData:c,ManualCmd:i,WhereClause:this.getWhereClause(o),Fields:k,AD_Client_ID:w,AD_Org_ID:b,SelectSQL:n.secureEngine.encrypt(this.SQL_Select),AD_WIndow_ID:l[0].getAD_Window_ID()},this.selectedTreeNode>0&&(s.SelectedTreeNodeID=this.selectedTreeNode),this.treeNode_ID>0&&(s.ParentNodeID=this.treeNode_ID,s.TreeID=this.treeID,s.TreeTableID=this.treeTable_ID),r=n.dataContext.insertOrUpdateWRecord(s),r=JSON.parse(r),r.IsError||(t.extend(!0,o,this.readDataOfObject(r.RowData)),this.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH,o,this.rowChanged),this.fireRowChanged(!0,this.getKeyID(this.rowChanged)),this.rowData=null,this.changed=!1,this.compareDB=!0,this.rowChanged=-1,this.newRow=-1,this.inserting=!1),r.ErrorMsg!=null&&this.log.log(n.Logging.Level.SEVERE,r.ErrorMsg),r.FireEEvent?this.fireDataStatusEEvent(r.EventParam.Msg,r.EventParam.Info,r.EventParam.IsError):r.FireIEvent&&this.fireDataStatusIEvent(r.EventParam.Msg,r.EventParam.Info,r.EventParam.IsError),r.Status}};r.prototype.createGridFieldArr=function(n,t){var u=n.length,r,i;if(t){if(this.gFieldLessData)return this.gFieldLessData;for(this.gFieldLessData=[],r=0;r<u;r++)i=n[r],i.getIsEncryptedColumn()&&this.gFieldLessData.push(i.getColumnName().toLowerCase());return this.gFieldLessData}if(this.gFieldData)return this.gFieldData;for(this.gFieldData=[],r=0;r<u;r++)i=n[r],this.gFieldData.push({IsVirtualColumn:i.getIsVirtualColumn(),DisplayType:i.getDisplayType(),ColumnName:i.getColumnName(),IsKey:i.getIsKey(),ColumnSQL:i.getColumnSQL(!0),IsEncryptedColumn:i.getIsEncryptedColumn(),IsParentColumn:i.getIsParentColumn()});return this.gFieldData};r.prototype.dataRefreshAll=function(){this.inserting=!1;this.dataIgnore();this.close(!1);this.open(this.maxRows);this.dseEvent="Refreshed"};r.prototype.dataRequery=function(n){return this.close(!1),this.setSelectWhereClause(n),this.rowData=null,this.changed=!1,this.rowChanged=-1,this.inserting=!1,this.open(this.maxRows),this.dseEvent="Refreshed",!0};r.prototype.dataRefresh=function(t){var e,r;if(t<0||this.getRowCount()==0||this.inserting)return null;e=this.getRow(t);this.dataIgnore();r=this.getWhereClause(e);(r==null||r.length==0)&&(r="1=2");var i=this.SQL_Select+" WHERE "+r,f=null,u=null;try{i=n.secureEngine.encrypt(i);u=n.dataContext.getWindowRecord(i,this.createGridFieldArr(this.gridFields,!0));u.read()&&(f=this.readData(u));f.recid=e.recid}catch(s){return i=n.secureEngine.decrypt(i),this.log.log(o.SEVERE,i,s),this.fireDataStatusEEvent("RefreshError",i,!0),null}finally{u!=null&&u.dispose()}return this.rowData=null,this.changed=!1,this.rowChanged=-1,this.inserting=!1,this.fireTableModelChanged(n.VTable.prototype.ROW_REFRESH,f),this.fireDataStatusIEvent("Refreshed",""),f};r.prototype.dataNew=function(t,i){var c,s,e,a,h,o,u,f;if(this.log.info("Current="+t+", Copy="+i),this.readOnly)return this.fireDataStatusEEvent("AccessCannotInsert","",!0),!1;if(this.inserting=!0,c=this.gridFields.length,this.rowData={},s={},e=this.gTable._windowNo+n.EnvConstants.WINDOW_TEMP,i)for(a=this.getRow(t),o=0;o<c;o++){var u=this.gridFields[o],r=u.getColumnName(),l=r.toLowerCase();u.getIsVirtualColumn()||(u.getIsKey()||r.equals("AD_Client_ID")||r.equals("IsActive")||r.startsWith("Created")||r.startsWith("Updated")||r.equals("EntityType")||r.equals("DocumentNo")||r.equals("Processed")||r.equals("IsSelfService")||r.equals("DocAction")||r.equals("DocStatus")||r.startsWith("Ref_")||r.equals("Posted")||r.equals("GrandTotal")||r.equals("TotalLines")||r.equals("C_CashLine_ID")||r.equals("C_Payment_ID")||r.equals("IsPaid")||r.equals("IsAllocated")||r.equalsIgnoreCase("C_Location_ID")||r.equals("IsApproved")||r.equals("IsDelivered")||r.equals("IsInvoiced")||r.equals("TotalDr")||r.equals("TotalCr")||r.equalsIgnoreCase("I_IsImported")?(f=u.getDefault(this.ctx,e),s[l]=f,f!=null&&this.ctx.setWindowContext(e,u.getColumnName(),f.toString())):u.getIsCopy()?(h=a[r.toLowerCase()],s[l]=h,h!=null&&this.ctx.setWindowContext(e,u.getColumnName(),h.toString())):(f=u.getDefault(this.ctx,e),s[l]=f,f!=null&&this.ctx.setWindowContext(e,u.getColumnName(),f.toString())))}else for(o=0;o<c;o++)u=this.gridFields[o],f=u.getDefault(this.ctx,e),s[u.getColumnName().toLowerCase()]=f,f!=null&&this.ctx.setWindowContext(e,u.getColumnName(),f.toString());return this.ctx.removeWindow(e),this.changed=!0,this.compareDB=!0,this.newRow=t+1,this.getRowCount()<this.newRow&&(this.newRow=this.getRowCount()),this.rowChanged=this.newRow,this.rowCount++,s.recid=this.rowCount,this.pazeSize++,this.fireTableModelChanged(n.VTable.prototype.ROW_ADD,s,this.newRow),this.fireDataStatusIEvent(i?"UpdateCopied":"Inserted",""),this.log.fine("Current="+this.currentRow+", New="+this.newRow+" - complete"),!0};r.prototype.dataDelete=function(t,i){var f,l,r,s,w;if(!t||t.length<0)return!1;if(this.readOnly)return this.fireDataStatusEEvent("AccessCannotDelete","",!0),!1;if(!this.deleteable)return this.fireDataStatusEEvent("AccessNotDeleteable","",!0),!1;var h=this.gTable._indexKeyColumn!=-1,y=this.gTable._indexProcessedColumn>0&&!this.gTable._tableName.startsWith("I_"),e=[],c=[],a=[],v=[],p=this.AD_Table_ID,u=null;for(f=0;f<t.length;f++){if(u=this.mSortList[t[f]],y&&(l=this.getValueAt(t[f],"processed"),l!=null&&l)){e.push(u.recid);continue}c.push(u.recid);h?a.push(u[this.keyColumnName.toLowerCase()]):v.push(this.getWhereClause(u))}if(r=null,c.length>0)s={RecIds:c,HasKeyColumn:h,TableName:this.gTable._tableName,AD_Table_ID:p},h?s.SingleKeyWhere=a:s.MultiKeyWhere=v,r=n.dataContext.deleteWRecords(s),r=JSON.parse(r);else if(e.length>0)return this.fireDataStatusEEvent("CannotDeleteTrx","",!0),!1;if(r){if(w=null,selIndexOrId=r.UnDeletedRecIds&&r.UnDeletedRecIds.length>0?r.UnDeletedRecIds:e.length>0?e:i,r.DeletedRecIds&&r.DeletedRecIds.length>0&&(this.rowCount-=r.DeletedRecIds.length,this.fireTableModelChanged(n.VTable.prototype.ROW_DELETE,r.DeletedRecIds,selIndexOrId),r.RecIds&&r.RecIds.length>0&&this.fireRowChanged(!1,r.RecIds)),r.ErrorMsg&&this.log.log(o.SEVERE,r.ErrorMsg),r.InfoMsg&&this.log.log(o.Info,r.InfoMsg),r.IsError)return r.FireEEvent&&this.fireDataStatusEEvent(r.EventParam.Msg,r.EventParam.Info,r.EventParam.IsError),!1;this.changed=!1;this.rowChanged=-1;this.fireDataStatusIEvent("Deleted","")}return!0};r.prototype.readData=function(n){var r={},u=this.gridFields.length,t=null,i;try{for(i=0;i<u;i++)t=this.gridFields[i].getColumnName().toLowerCase(),r[t]=this.readDataOfColumn(t,n.getCell(t)),t=null;return r}catch(f){throw f;}};r.prototype.readDataOfObject=function(n){var r={},u=this.gridFields.length,t=null,i;try{for(i=0;i<u;i++)t=this.gridFields[i].getColumnName().toLowerCase(),r[t]=this.readDataOfColumn(t,n[t]),t=null;return r}catch(f){throw f;}};r.prototype.close=function(n){this.isOpen&&(n,!this.inserting,this.bufferList!=null&&(this.bufferList.length=0,this.bufferList=null,this.bufferList=[],this.mSortList=null),this.mSortList!=null&&(this.mSortList=null),n&&this.dispose(),this.isOpen=!1)};r.prototype.dataIgnore=function(){if(this.inserting||this.changed||!(this.rowChanged<0)){if(this.inserting)this.rowCount--,this.pazeSize--,this.changed=!1,this.rowChanged=-1,this.inserting=!1,this.fireTableModelChanged(n.VTable.prototype.ROW_UNDO,this.mSortList[this.newRow].recid,this.newRow);else if(this.rowData!=null){var i=this.getRow(this.rowChanged);t.extend(i,this.rowData)}this.changed=!1;this.rowChanged=-1;this.rowData=null;this.inserting=!1;this.newRow=-1;this.fireDataStatusIEvent("Ignored","")}};r.prototype.createDSE=function(){var t=this.changed,n;return this.rowChanged!=-1&&(t=!0),n=new f(null,this.getRowCount(),t,!1,this.inserting),n.setPageInfo(this.currentPage,this.rowCount,this.pazeSize),n.AD_Table_ID=this.gTable._AD_Table_ID,n.Record_ID=null,n};r.prototype.fireDataStatusChanged=function(n){this.mDataListener&&this.mDataListener.dataStatusChanged(n);n=null};r.prototype.fireTableModelChanged=function(n,t,i,r){this.mCardModelListener&&this.mCardModelListener.tableModelChanged(n,t,i,r);this.mTableModelListener&&this.mTableModelListener.tableModelChanged(n,t,i,r)};r.prototype.fireRowChanged=function(n,t){this.mRowChangedListener&&this.mRowChangedListener.rowChanged(n,t)};r.prototype.fireDataStatusIEvent=function(n,t){var i=this.createDSE();i.setInfo(n,t,!1,!1);this.fireDataStatusChanged(i)};r.prototype.fireQueryCompleted=function(n){this.fireDataStatusIEvent(this.dseEvent);this.mQueryCompletedListener&&this.mQueryCompletedListener.queryCompleted(n);n=null};r.prototype.fireDataStatusEEvent=function(n,t,i){if(arguments.length===1)this.fireDataStatusEEvent(arguments[0].value,arguments[0].name,!0);else{var r=this.createDSE();r.setInfo(n,t,i,!i);this.fireDataStatusChanged(r)}};r.prototype.addDataStatusListener=function(n){this.mDataListener=n};r.prototype.removeDataStatusListener=function(){this.mDataListener=null};r.prototype.addQueryCompleteListner=function(n){this.mQueryCompletedListener=n};r.prototype.removeQueryCompleteListner=function(){this.mQueryCompletedListener=null};r.prototype.addTableModelListener=function(n){this.mTableModelListener=n};r.prototype.removeTableModelListener=function(n){this.mTableModelListener=null;n=null};r.prototype.addCardModelListener=function(n){this.mCardModelListener=n};r.prototype.removeCardModelListener=function(n){this.mCardModelListener=null;n=null};r.prototype.addRowChangedListener=function(n){this.mRowChangedListener=n};r.prototype.removeRowChangedListener=function(n){this.mRowChangedListener=null;n=null};r.prototype.updateTableModel=function(t){var i=t.getColumnName(),r=t.getDisplayType();r==n.DisplayType.Integer||n.DisplayType.IsID(r)&&(i.endsWith("_ID")||i.endsWith("_Acct")||i.endsWith("_ID_1")||i.endsWith("_ID_2")||i.endsWith("_ID_3"))||i.endsWith("atedBy")?this.defaultModel[i.toLowerCase()]=new Number:n.DisplayType.IsNumeric(r)?this.defaultModel[i.toLowerCase()]=new Number:n.DisplayType.IsDate(r)?this.defaultModel[i.toLowerCase()]=new Date:r==n.DisplayType.RowID?(dc=new DataColumn(i,typeof Object),this.defaultModel[i.toLowerCase()]={}):this.defaultModel[i.toLowerCase()]=r==n.DisplayType.YesNo?new Boolean:n.DisplayType.IsLOB(r)?new String:new String};r.prototype.dispose=function(){var n,t;for(originalLength=this.gridFields.length,t=originalLength;t>0;t--)n=this.gridFields.pop(),n.dispose(),n=null;this.gridFields.length=0;this.gTable=null;this.gridFields=null;this.gFieldLessData=null;this.gFieldData=null};u.prototype.PROPERTY="FieldValue";u.prototype.INSERTING="FieldValueInserting";u.prototype.getIsDisplayed=function(t){var u;if(arguments.length==0)return this.vo.IsDisplayedf;if(!this.vo.IsDisplayedf)return!1;if(this.vo.DisplayLogic==null||this.vo.DisplayLogic.equals(""))return!0;if(t){for(var i=!1,r=[],f=[],e=new n.StringTokenizer(this.vo.DisplayLogic,"[]");e.hasMoreTokens();)u=e.nextToken(),u.trim()!=" & ".trim()?(i=n.Evaluator.evaluateLogic(this,u),r.push(i)):f.push(u);return r.length>1&&(f[0].trim().equals("&")?i=r.indexOf(!1)>-1?!1:!0:f[0].trim().equals("|")&&r.indexOf(!0)>-1&&(i=!0)),i}return!0};u.prototype.getIsDisplayedMR=function(t){var u;if(arguments.length==0)return this.vo.IsDisplayedMR;if(!this.vo.IsDisplayedMR)return!1;if(this.vo.DisplayLogic==null||this.vo.DisplayLogic.equals(""))return!0;if(t){for(var i=!1,r=[],f=[],e=new n.StringTokenizer(this.vo.DisplayLogic,"[]");e.hasMoreTokens();)u=e.nextToken(),u.trim()!=" & ".trim()?(i=n.Evaluator.evaluateLogic(this,u),r.push(i)):f.push(u);return r.length>1&&(f[0].trim().equals("&")?i=r.indexOf(!1)>-1?!1:!0:f[0].trim().equals("|")&&r.indexOf(!0)>-1&&(i=!0)),i}return!0};u.prototype.getColumnName=function(){return this.vo.ColumnName};u.prototype.getIsLongField=function(){return this.vo.DisplayLength>=30};u.prototype.getIsMandatory=function(t){var r,i;return t&&this.vo.mandatoryLogic!=null&&this.vo.mandatoryLogic.length>0&&(r=n.Evaluator.evaluateLogic(this,this.vo.mandatoryLogic),r)?!0:!this.vo.IsMandatoryUI||this.getIsVirtualColumn()?!1:(i=this.vo,i.IsKey&&i.ColumnName.endsWith("_ID")||i.ColumnName.startsWith("Created")||i.ColumnName.startsWith("Updated")||i.ColumnName.equals("Value")||i.ColumnName.equals("DocumentNo")||i.ColumnName.equals("M_AttributeSetInstance_ID"))?!1:this.getIsDisplayed(t)};u.prototype.getDisplayType=function(){return this.vo.displayType};u.prototype.getIsVirtualColumn=function(){return this.vo.ColumnSQL&&this.vo.ColumnSQL.length>0?!0:!1};u.prototype.getIsReadOnly=function(){return this.getIsVirtualColumn()?!0:this.vo.IsReadOnly};u.prototype.setReadOnly=function(n){this.vo.IsReadOnly=n};u.prototype.getIsEditable=function(t,i){var r=this.vo,o,u,h,e,s,c;if(this.getIsVirtualColumn())return!1;if(r.ColumnName.equals("Posted")||r.ColumnName.equals("Record_ID")&&r.displayType==n.DisplayType.Button||(o=i&&!(this.vo.DisplayLogic==null||this.vo.DisplayLogic.equals("")),r.IsAlwaysUpdateable&&!r.tabReadOnly&&!o))return!0;if(r.tabReadOnly||r.IsReadOnly||!r.IsUpdateable&&!this.inserting||r.ColumnName.equals(n.context.getWindowTabContext(r.windowNo,r.tabNo,"LinkColumnName")))return!1;if(u=n.context,t){h=parseInt(u.getWindowTabContext(r.windowNo,r.tabNo,"AD_Client_ID"));r.ColumnName.equals("AD_Org_ID")&&(u.getWindowContext(r.windowNo,"AD_Org_ID")==null||u.getWindowContext(r.windowNo,"AD_Org_ID").length==0)&&u.setWindowContext(r.windowNo,"AD_Org_ID",u.getContext("#AD_Org_ID"));var l=parseInt(u.getWindowTabContext(r.windowNo,r.tabNo,"AD_Org_ID")),f=u.getWindowTabContext(r.windowNo,r.tabNo,"KeyColumnName"),a=r.AD_Window_ID;if(("EntityType".equals(f)&&(f="AD_EntityType_ID"),f.toUpperCase().endsWith("_ID")||(f+="_ID"),e=u.getWindowTabContext(r.windowNo,r.tabNo,f),e==""&&(e=0),s=r.AD_Table_ID,!n.MRole.canUpdate(h,l,s,e,!1)||!n.MRole.getWindowAccess(a))||!n.MRole.getIsColumnAccess(s,this.vo.AD_Column_ID,!1))return!1}return t&&r.ReadOnlyLogic.length>0&&(c=!n.Evaluator.evaluateLogic(this,r.ReadOnlyLogic),!c)?!1:r.ColumnName.equals("Processing")||r.ColumnName.equals("DocAction")||r.ColumnName.equals("GenerateTo")?!0:t&&(u.getWindowContext(r.windowNo,"Processed").equals("Y")||u.getWindowContext(r.windowNo,"Processing").equals("Y"))&&!o?!1:r.ColumnName.equals("IsActive")?!0:t&&!u.getWindowContext(r.windowNo,"IsActive").equals("Y")?!1:i?this.getIsDisplayedMR(t):this.getIsDisplayed(t)};u.prototype.getWindowNo=function(){return this.vo.windowNo};u.prototype.getIsHeading=function(){return this.vo.IsHeading};u.prototype.getIsSameLine=function(){return this.vo.IsSameLine};u.prototype.getHeader=function(){return this.vo.Header};u.prototype.getDescription=function(){return this.vo.Description};u.prototype.getHelp=function(){return this.vo.Help};u.prototype.getAD_Process_ID=function(){return this.vo.AD_Process_ID};u.prototype.getAD_Form_ID=function(){return this.vo.AD_Form_ID};u.prototype.getAD_Column_ID=function(){return this.vo.AD_Column_ID};u.prototype.getAD_Field_ID=function(){return this.vo.AD_Field_ID};u.prototype.getFieldGroup=function(){return this.vo.FieldGroup};u.prototype.getIsFieldOnly=function(){return this.vo.IsFieldOnly};u.prototype.getIsKey=function(){return this.vo.IsKey};u.prototype.getIsParentColumn=function(){return this.vo.IsParent};u.prototype.getSortNo=function(){return this.vo.SortNo};u.prototype.getMRSeqNo=function(){return this.vo.mrSeqNo};u.prototype.getIsSelectionColumn=function(){return this.vo.IsSelectionColumn};u.prototype.getIsIncludedColumn=function(){return this.vo.IsIncludedColumn};u.prototype.getDependentOn=function(){var t=[],i=this.getColumnName();return i.equals("M_AttributeSetInstance_ID")?t.push("M_Product_ID"):(i.equals("M_Locator_ID")||i.equals("M_LocatorTo_ID"))&&(t.push("M_Product_ID"),t.push("M_Warehouse_ID")),n.Evaluator.parseDepends(t,this.vo.DisplayLogic),n.Evaluator.parseDepends(t,this.vo.ReadOnlyLogic),this.lookup!=null&&n.Evaluator.parseDepends(t,this.lookup.getValidation()),t};u.prototype.getAD_Window_ID=function(){return this.vo.AD_Window_ID};u.prototype.getAD_InfoWindow_ID=function(){return this.vo.AD_InfoWindow_ID};u.prototype.getValueAsString=function(t){return n.context.getWindowContext(this.vo.windowNo,t,!0)};u.prototype.getColumnSQL=function(t){return arguments.length==0?this.vo.ColumnName:this.vo.ColumnSQL!=null&&this.vo.ColumnSQL.length>0?t?(this.vo.displayType==n.DisplayType.YesNo,this.vo.ColumnSQL+" AS "+this.vo.ColumnName):(this.vo.displayType==n.DisplayType.YesNo,this.vo.ColumnSQL):(this.vo.displayType==n.DisplayType.YesNo,this.vo.ColumnName)};u.prototype.getIsLink=function(){return this.vo.isLink};u.prototype.getIsRightPaneLink=function(){return this.vo.isRightPaneLink};u.prototype.getColumnWidth=function(){return this.vo.ColumnWidth};u.prototype.getIsAlwaysUpdateable=function(){return this.getIsVirtualColumn()||!this.vo.IsUpdateable?!1:this.vo.IsAlwaysUpdateable};u.prototype.getIsEncryptedField=function(){return this.vo.IsEncryptedField};u.prototype.getIsEncrypted=function(){if(this.vo.IsEncryptedField)return!0;var n=this.getObscureType();return n!=null&&n.length>0?!0:this.vo.ColumnName.equals("Password")};u.prototype.getObscureType=function(){return this.vo.ObscureType};u.prototype.getDisplayLength=function(){return this.vo.DisplayLength};u.prototype.getFieldLength=function(){return this.vo.FieldLength};u.prototype.getMinValue=function(){return this.vo.ValueMin};u.prototype.getMaxValue=function(){return this.vo.ValueMax};u.prototype.getVFormat=function(){return this.vo.VFormat};u.prototype.getLookup=function(){return this.lookup};u.prototype.getIsError=function(){return this.error};u.prototype.getIsCopy=function(){return this.vo.IsCopy};u.prototype.getCallout=function(){return this.vo.Callout};u.prototype.getValue=function(){return this.value};u.prototype.getOldValue=function(){return this.oldValue};u.prototype.getIsRange=function(){return this.vo.isRange};u.prototype.getIsRange=function(){return this.vo.isRange};u.prototype.getIsParentValue=function(){var i=n.context,t;return this.parentValue!=null?this.parentValue:(n.DisplayType.IsID(this.vo.displayType)&&this.vo.tabNo!=0?(t=i.getWindowTabContext(this.vo.windowNo,this.vo.tabNo,"LinkColumnName"),this.parentValue=t.length==0?!1:this.vo.ColumnName.equals(t),this.parentValue&&this.log.config(this.parentValue+" - Link("+t+", W="+this.vo.windowNo+",T="+this.vo.tabNo+") = "+this.vo.ColumnName)):this.parentValue=!1,this.parentValue)};u.prototype.getDefault=function(t,i){var r=this.vo,l,u,s,p,f,k,d,c,h,nt;if(r.IsKey||r.displayType==n.DisplayType.RowID||n.DisplayType.IsLOB(r.displayType))return null;if(this.getIsParentValue()&&n.Utility.Util.isEmpty(r.DefaultValue))return l=t.getWindowContext(r.windowNo,r.ColumnName),this.log.fine("[Parent] "+r.ColumnName+"="+l),this.createDefault(r.ColumnName,l);if(r.ColumnName.equals("IsActive"))return this.log.fine("[IsActive] "+r.ColumnName+"=Y"),!0;if(n.Consts.ACCESSLEVEL_SystemOnly.equals(t.getWindowTabContext(r.windowNo,r.tabNo,"AccessLevel"))&&(r.ColumnName.equals("AD_Client_ID")||r.ColumnName.equals("AD_Org_ID")))return this.log.fine("[SystemAccess] "+r.ColumnName+"=0"),0;if(n.Consts.ACCESSLEVEL_SystemPlusClient.equals(t.getWindowTabContext(r.windowNo,r.tabNo,"AccessLevel"))&&r.ColumnName.equals("AD_Org_ID"))return this.log.fine("[ClientAccess] "+r.ColumnName+"=0"),0;if(u="",r.DefaultValue.startsWith("@SQL=")){var v=r.DefaultValue.substring(5),e=n.Env.parseContext(t,r.windowNo,v,!1,!0),y=e.toUpperCase();if(y.indexOf("DELETE ")!=-1&&y.indexOf("UPDATE ")!=-1&&y.indexOf("DROP ")!=-1&&(e=""),e.equals(""))this.log.log(o.WARNING,"("+r.ColumnName+") - Default SQL variable parse failed: "+v);else{s=null;try{s=a(e);s.read()?u=s.getString(0):this.log.log(o.WARNING,"("+r.ColumnName+") - no Result: "+e);s.close()}catch(b){e.endsWith("=")?this.log.log(o.SEVERE,"("+r.ColumnName+") "+v,b):this.log.log(o.WARNING,"("+r.ColumnName+") "+e,b)}finally{s!=null&&s.dispose()}}if(u!=null&&u.length>0)return this.log.fine("[SQL] "+r.ColumnName+"="+u),this.createDefault("",u)}if(!r.DefaultValue.equals("")&&!r.DefaultValue.startsWith("@SQL="))for(u="",p=new n.StringTokenizer(r.DefaultValue,",;",!1);p.hasMoreTokens();){if(f=p.nextToken().trim(),f.equals("@SysDate@")||f.equals("@Now@"))return k=new Date,d=k.toISOString(),d;if(u=f.indexOf("@")!=-1?t.getWindowContext(r.windowNo,f.replaceAll("@"," ").trim()):f.startsWith("'")&&f.endsWith("'")?f.length-2>0?f.substring(1,f.length-1):f.replaceAll("'",""):f,u.length>0)return this.log.fine("[DefaultValue] "+r.ColumnName+"="+u),this.createDefault(f,u)}if(this.lookup!=null&&!n.Utility.Util.isEmpty(this.lookup.getValidation())){var tt=this.lookup.getValidation(),g=n.Evaluator.getVariables(tt),w=!1;for(c=0;c<g.length;c++)if(h=g[c],!h.startsWith("#")&&h.toUpperCase().endsWith("_ID")&&!h.equals(r.ColumnName)&&(nt=t.getWindowContext(i,h),w=n.Utility.Util.isEmpty(nt),w))break;if(w)return this.lookup.clear(),null}return(u=n.Env.getPreference(t,r.AD_Window_ID,r.ColumnName,!1),u!=="")?(this.log.fine("[UserPreference] "+r.ColumnName+"="+u),this.createDefault("",u)):(u=n.Env.getPreference(t,r.AD_Window_ID,r.ColumnName,!0),u!=="")?(this.log.fine("[SystemPreference] "+r.ColumnName+"="+u),this.createDefault("",u)):r.displayType==n.DisplayType.Button&&!r.ColumnName.toUpperCase().endsWith("_ID")?(this.log.fine("[Button=N] "+r.ColumnName),"N"):this.vo.displayType==n.DisplayType.YesNo?(this.log.fine("[YesNo=N] "+r.ColumnName),!1):r.ColumnName.toUpperCase().endsWith("_ID")?(this.log.fine("[ID=null] "+r.ColumnName),null):n.DisplayType.IsNumeric(r.displayType)?(this.log.fine("[Number=0] "+r.ColumnName),this.createDefault("","0")):(this.log.fine("[NONE] "+r.ColumnName),null)};u.prototype.getDefault2=function(t,i){var r=this.vo,l,u,s,p,f,k,d,c,h,nt;if(r.IsKey||r.displayType==n.DisplayType.RowID||n.DisplayType.IsLOB(r.displayType))return null;if(this.getIsParentValue()&&n.Utility.Util.isEmpty(r.DefaultValue2))return l=t.getWindowContext(r.windowNo,r.ColumnName),this.log.fine("[Parent] "+r.ColumnName+"="+l),this.createDefault(r.ColumnName,l);if(r.ColumnName.equals("IsActive"))return this.log.fine("[IsActive] "+r.ColumnName+"=Y"),!0;if(n.Consts.ACCESSLEVEL_SystemOnly.equals(t.getWindowTabContext(r.windowNo,r.tabNo,"AccessLevel"))&&(r.ColumnName.equals("AD_Client_ID")||r.ColumnName.equals("AD_Org_ID")))return this.log.fine("[SystemAccess] "+r.ColumnName+"=0"),0;if(n.Consts.ACCESSLEVEL_SystemPlusClient.equals(t.getWindowTabContext(r.windowNo,r.tabNo,"AccessLevel"))&&r.ColumnName.equals("AD_Org_ID"))return this.log.fine("[ClientAccess] "+r.ColumnName+"=0"),0;if(u="",r.DefaultValue2.startsWith("@SQL=")){var v=r.DefaultValue2.substring(5),e=n.Env.parseContext(t,r.windowNo,v,!1,!0),y=e.toUpperCase();if(y.indexOf("DELETE ")!=-1&&y.indexOf("UPDATE ")!=-1&&y.indexOf("DROP ")!=-1&&(e=""),e.equals(""))this.log.log(o.WARNING,"("+r.ColumnName+") - Default SQL variable parse failed: "+v);else{s=null;try{s=a(e);s.read()?u=s.getString(0):this.log.log(o.WARNING,"("+r.ColumnName+") - no Result: "+e);s.close()}catch(b){e.endsWith("=")?this.log.log(o.SEVERE,"("+r.ColumnName+") "+v,b):this.log.log(o.WARNING,"("+r.ColumnName+") "+e,b)}finally{s!=null&&s.dispose()}}if(u!=null&&u.length>0)return this.log.fine("[SQL] "+r.ColumnName+"="+u),this.createDefault("",u)}if(!r.DefaultValue2.equals("")&&!r.DefaultValue2.startsWith("@SQL="))for(u="",p=new n.StringTokenizer(r.DefaultValue2,",;",!1);p.hasMoreTokens();){if(f=p.nextToken().trim(),f.equals("@SysDate@")||f.equals("@Now@"))return k=new Date,d=k.toISOString(),d;if(u=f.indexOf("@")!=-1?t.getWindowContext(r.windowNo,f.replaceAll("@"," ").trim()):f.startsWith("'")&&f.endsWith("'")?f.length-2>0?f.substring(1,f.length-1):f.replaceAll("'",""):f,u.length>0)return this.log.fine("[DefaultValue2] "+r.ColumnName+"="+u),this.createDefault(f,u)}if(this.lookup!=null&&!n.Utility.Util.isEmpty(this.lookup.getValidation())){var tt=this.lookup.getValidation(),g=n.Evaluator.getVariables(tt),w=!1;for(c=0;c<g.length;c++)if(h=g[c],!h.startsWith("#")&&h.toUpperCase().endsWith("_ID")&&!h.equals(r.ColumnName)&&(nt=t.getWindowContext(i,h),w=n.Utility.Util.isEmpty(nt),w))break;if(w)return this.lookup.clear(),null}return(u=n.Env.getPreference(t,r.AD_Window_ID,r.ColumnName,!1),u!=="")?(this.log.fine("[UserPreference] "+r.ColumnName+"="+u),this.createDefault("",u)):(u=n.Env.getPreference(t,r.AD_Window_ID,r.ColumnName,!0),u!=="")?(this.log.fine("[SystemPreference] "+r.ColumnName+"="+u),this.createDefault("",u)):r.displayType==n.DisplayType.Button&&!r.ColumnName.toUpperCase().endsWith("_ID")?(this.log.fine("[Button=N] "+r.ColumnName),"N"):this.vo.displayType==n.DisplayType.YesNo?(this.log.fine("[YesNo=N] "+r.ColumnName),!1):r.ColumnName.toUpperCase().endsWith("_ID")?(this.log.fine("[ID=null] "+r.ColumnName),null):n.DisplayType.IsNumeric(r.displayType)?(this.log.fine("[Number=0] "+r.ColumnName),this.createDefault("","0")):(this.log.fine("[NONE] "+r.ColumnName),null)};u.prototype.getIsEncryptedColumn=function(){return this.vo.IsEncryptedColumn};u.prototype.getZoomWindow_ID=function(){return this.vo.ZoomWindow_ID};u.prototype.getIsDefaultFocus=function(){return this.vo.IsDefaultFocus};u.prototype.createDefault=function(t,i){var u,r,f,e;if(i==null||i.length==0)return null;try{if(this.vo.ColumnName.endsWith("atedBy")||this.vo.ColumnName.toUpperCase().endsWith("_ID")){try{return(u=parseInt(i),u<0)?null:u}catch(s){this.log.warning("Cannot parse: "+i+" - "+s.message)}return 0}if(this.vo.displayType==n.DisplayType.Integer)return parseInt(i);if(n.DisplayType.IsNumeric(this.vo.displayType))return parseFloat(i);if(n.DisplayType.IsDate(this.vo.displayType)){try{return r=null,isNaN(Number(i))?r=new Date(i):(r=new Date,console.log(this.vo.ColumnName+"==>[1n] "+r),r.setMinutes(-r.getTimezoneOffset()+r.getMinutes()),console.log(this.vo.ColumnName+"==>[3n] "+r.toISOString())),r.toISOString()}catch(c){}f=i+"2014-01-01T01:00:05Z".substring(i.length);try{new Date(f).toISOString()}catch(l){this.log.warning("Cannot convert to Timestamp: "+f)}return(new Date).toISOString()}if(this.vo.displayType==n.DisplayType.YesNo)return"Y".equals(i);if(t.equals("@#Date@"))try{e=new Date(parseInt(i));i=e.toLocaleDateString()}catch(a){}return i}catch(h){this.log.log(o.SEVERE,this.vo.ColumnName+" - "+h.message)}return null};u.prototype.setValue=function(t,i){var e;this.inserting||(this.oldValue=this.value);this.value=t;this.inserting=i;this.error=!1;var r=this.vo,u=n.DisplayType,f=n.context;r.displayType==u.Text||r.displayType==u.Memo||r.displayType==u.TextLong||r.displayType==u.Binary||r.displayType==u.RowID||this.getIsEncrypted()||(t=="undefined"||t==null?f.setWindowContext(r.windowNo,r.ColumnName,null):typeof t==typeof Boolean||r.displayType==u.YesNo?t.toString()=="Y"||t.toString()=="N"?f.setWindowContext(r.windowNo,r.ColumnName,t.toString()):f.setWindowContext(r.windowNo,r.ColumnName,t.toString().toLowerCase()=="true"?"Y":"N"):typeof t==typeof date||u.IsDate(r.displayType)?f.setWindowContext(r.windowNo,r.ColumnName,t):f.setWindowContext(r.windowNo,r.ColumnName,t==null?null:t.toString()));e=this.oldValue;i&&(e=this.INSERTING);(e!==t||this.forcefirepropchange)&&this.propertyChangeListner&&this.propertyChangeListner.setValue(t,i);this.forcefirepropchange=this.inserting||r.displayType==u.YesNo};u.prototype.setNullValue=function(){this.valueNoFire&&(this.oldValue=this.value);this.value=null;this.inserting=!1;this.error=!1;this.oldValue!==this.value&&this.propertyChangeListner&&this.propertyChangeListner.setValue(this.value)};u.prototype.setPropertyChangeListener=function(n){this.propertyChangeListner=n};u.prototype.setError=function(n){this.error=n};u.prototype.setInserting=function(n){this.inserting=n};u.prototype.getAD_Reference_Value_ID=function(){return this.vo.AD_Reference_Value_ID};u.prototype.setDisplayType=function(n){this.vo.displayType=n};u.prototype.setDisplayLength=function(n){this.vo.DisplayLength=n};u.prototype.setDisplayed=function(n){this.vo.IsDisplayedf=n};u.prototype.setValueNoFire=function(n){this.valueNoFire=n};u.prototype.getLoadRecursiveData=function(){return this.vo.LoadRecursiveData};u.prototype.getShowChildOfSelected=function(){return this.vo.ShowChildOfSelected};u.prototype.getIsBackgroundProcess=function(){return this.vo.IsBackgroundProcess};u.prototype.getAskUserBGProcess=function(){return this.vo.AskUserBGProcess};u.prototype.refreshLookup=function(){return!this.lookup||this.lookup.getValidation().length==0?!0:(this.lookup.refresh(),this.lookup.getIsValidated())};u.prototype.dispose=function(){this.lookup!=null&&(this.lookup.dispose(),this.lookup=null);this.gfield=null;this.vo=null;this.propertyChangeListner=null};h.prototype.getName=function(){return this.vo.Name};h.prototype.getAD_Tab_ID=function(){return this.vo.AD_Tab_ID};h.prototype.getIconPath=function(){return this.vo.IconPath};h.prototype.getIsDefault=function(){return this.vo.IsDefault};h.prototype.getClassName=function(){return this.vo.Classname};h.prototype.getAD_TabPanel_ID=function(){return this.vo.AD_TabPanel_ID};h.prototype.getSeqNo=function(){return this.vo.SeqNo};f.prototype.setLoading=function(n){this.m_allLoaded=!1;this.m_loadedRows=n};f.prototype.getIsLoading=function(){return!this.m_allLoaded};f.prototype.getLoadedRows=function(){return this.m_loadedRows};f.prototype.setCurrentRow=function(n){this.m_currentRow=n};f.prototype.setCurrentPage=function(n){this.mCurrentPage=n};f.prototype.getCurrentRow=function(){return this.m_currentRow};f.prototype.getTotalRows=function(){return this.m_totalRows};f.prototype.getTotalRecords=function(){return this.totalRecords};f.prototype.getCurrentPage=function(){return this.mCurrentPage};f.prototype.getTotalPage=function(){return this.mTotalPage};f.prototype.getPageSize=function(){return this.mPageSize};f.prototype.setInfo=function(n,t,i,r){this.m_AD_Message=n;this.m_info=t;this.m_isError=i;this.m_isWarning=r};f.prototype.setPageInfo=function(n,t,i){this.mCurrentPage=n;this.mPageSize=i;t<1||t<i?(this.mcurrentPage=1,this.mTotalPage=1):this.mTotalPage=i==0?1:Math.ceil(t/i);this.totalRecords=t};f.prototype.setInserting=function(n){this.m_inserting=n};f.prototype.getIsInserting=function(){return this.m_inserting};f.prototype.getAD_Message=function(){return this.m_AD_Message};f.prototype.getInfo=function(){return this.m_info};f.prototype.getIsError=function(){return this.m_isError};f.prototype.getIsWarning=function(){return this.m_isWarning};f.prototype.getMessage=function(){var n=new StringBuilder;return this.m_inserting&&n.append("+"),n.append(this.m_changed?this.m_autoSave?"*":"?":" "),this.m_totalRows==0?n.append(this.m_currentRow):n.append(this.m_currentRow+1),n.append("/"),this.m_allLoaded?n.append(this.m_totalRows):n.append(this.m_loadedRows).append("->").append(this.m_totalRows),n.toString()};f.prototype.getIsChanged=function(){return this.m_changed};f.prototype.getIsFirstRow=function(){return this.m_totalRows==0?!0:this.m_currentRow==0};f.prototype.getIsLastRow=function(){return this.m_totalRows==0?!0:this.m_currentRow==this.m_totalRows-1};f.prototype.getIsFirstPage=function(){return this.mTotalPage<2?!0:this.mCurrentPage<2};f.prototype.getIsLastPage=function(){return this.mTotalPage<2?!0:this.mCurrentPage>=this.mTotalPage};f.prototype.setChangedColumn=function(n,t){this.m_changedColumn=n;this.m_columnName=t};f.prototype.getChangedColumn=function(){return this.m_changedColumn};f.prototype.getColumnName=function(){return this.m_columnName};f.prototype.setConfirmed=function(n){this.m_confirmed=n};f.prototype.getIsConfirmed=function(){return this.m_confirmed};n.GridWindow=e;n.GridTab=i;n.GridTable=r;n.GridField=u}(VIS,jQuery),function(n,t){function i(i){function e(){r=t("<div class='vis-height-full'>");u=t("<div class='vis-apanel-busy'>");f=t("<div class='vis-height-full'>");r.append(f).append(u)}this.$parent;this.mPanel;this.ctx=n.Env.getCtx();this.log=n.Logging.VLogger.getVLogger("VIS.AForm");var r,u,f;e();this.setSize=function(n){r.height(n);f.height(n)};this.setSize(i);this.getRoot=function(){return r};this.getContentGrid=function(){return f};this.setBusy=function(n,t){isLocked=n;n?u[0].style.visibility="visible":(u[0].style.visibility="hidden",t)};this.disposeComponent=function(){r.remove();r=null;f.remove();f=null;u.remove();u=null;this.$parentWindow=null;this.ctx=null;this.getRoot=null;this.getContentGrid=null;this.setBusy=null;this.setSize=null}}i.prototype.openForm=function(t,i,r){var u,e,f;if(t.IsReport)return n.ADialog.info("Form Report is not supported"),!1;this.parent=i;u="";u=t.Prefix+t.ClassName;console.log(u);this.log.info("Form Name= "+t.Name+", Class="+u);this.ctx.setWindowContext(r,"WindowName",t.DisplayName);try{e=n.Utility.getFunctionByName(u,window);f=new e(r);f.init(r,this);this.mPanel=f;f=null}catch(o){return this.log.log(n.Logging.Level.WARNING,"Class="+u+", AD_Form Name="+t.Name,o),!1}return this.setBusy(!1),this.windowNo=r,this.setTitle(n.Env.getHeader(this.ctx,r)),this.parent.setName(t.DisplayName),i=null,!0};i.prototype.setTitle=function(t){this.parent&&this.parent.setTitle(n.Utility.Util.cleanMnemonic(t))};i.prototype.hideHeader=function(n){this.parent&&this.parent.hideHeader(n)};i.prototype.hideCloseIcon=function(n){this.parent&&this.parent.hideCloseIcon(n)};i.prototype.sizeChanged=function(n,t){this.setSize(n);this.mPanel&&this.mPanel.sizeChanged&&this.mPanel.sizeChanged(n,t)};i.prototype.refresh=function(){this.mPanel&&this.mPanel.refresh&&this.mPanel.refresh()};i.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.mPanel&&(this.mPanel.disposeComponent&&this.mPanel.dispose(),this.mPanel=null),this.parent&&(this.parent.dispose(),this.parent=null),n.Env.clearWinContext(this.ctx,this.windowNo),this.disposeComponent())};n.AForm=i}(VIS,jQuery),function(n,t){function i(i,r,u,f){function g(){var i,f;a=t("<div style='position:relative;width:100%'>");s=t("<div class='vis-apanel-busy'>");w=t("<table  class='vis-process-table'>");h=t("<button class='vis-button-ok'>").text(n.Msg.getMsg("OK"));y=t("<button class='vis-button-close'>").text(n.Msg.getMsg("Close"));u&&(s.css("top","0px"),h.hide(),y.hide());w.height(r);s.height(r);c=t("<div>");a.append(w).append(s);p.append(s);v=t('<select style="display:none;width:100%">');l=t('<input type="checkbox" class="vis-process-background">');k=t('<label  class="vis-process-background-label">'+n.Msg.translate(n.context,"IsBackgroundProcess")+"<\/label>");o=t("<span class='vis-process-description-Span' style='height: 40px;'>").val("asassasasasasaasa");c.append(o);b=t('<label style="float: left;margin: 0px 10px 0px 0px;display:none;color:white">'+n.Msg.getMsg("ChooseReportType")+"<\/label>");i=t('<div style="display:inherit"><\/div>');e.parameterFixedArea.append(b).append(v).append(l).append(k);c.append(i);f=t("<div>");c.append(h).append(y);e.$divDesc.append(c)}var e=null,p,d,a,s,c,w,h,y,o,v,b,l,k;this.parent;this.mPanel;this.ctx=n.Env.getCtx();this.isLocked=!1;this.log=n.Logging.VLogger.getVLogger("VIS.AProcess");this.isComplete=!1;this.jpObj=null;this.splitUI=u;this.extrnalForm=f;this.partitionContainer=null;this.parameterContainer=null;this.reportContainer=null;this.reportToolbar=null;this.isReport=!1;this.calculateWidth=!0;this.hideclose=!1;this.showParameterClose=!0;this.cssForAll=null;this.visRepformatIcons=null;this.visSaveCsvIcons=null;this.visSavePdfIcons=null;this.visArchiveIcons=null;this.visRequeryIcons=null;this.visCustomizeIcons=null;this.visPrintIcons=null;this.toolbarColor=null;p=null;d=t('<img class="vis-apanel-lb-img" title="Actions" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/mt24.png">');this.splitUI&&(this.partitionContainer=t('<div class="vis-process-outer-wrap">'),this.parameterContainer=t('<div class="vis-process-left-sidebar">'),this.reportAreaContainer=t('<div class="vis-process-main-wrap">'),this.reportToolbar=t('<div class="vis-process-toolbar">'),this.parameterFixedArea=t('<div class="vis-process-parm-top">'),this.parameterContainer.append(t('<div class="vis-apanel-lb-toggle"><\/div>').append(d)).append(this.parameterFixedArea),p=t('<div class="vis-process-outer-main-wrap">'),this.$divDesc=t('<div class="vis-process-description">'),this.reportContainer=t('<div class="vis-process-result">'),this.reportAreaContainer.append(this.$divDesc).append(this.reportContainer),p.append(this.parameterContainer).append(this.reportAreaContainer),this.partitionContainer.append(this.reportToolbar).append(p),this.showParameterClose=!1);e=this;this.loadFileTypes=function(){var i=this;t.ajax({url:n.Application.contextUrl+"JsonData/GetReportFileTypes/",dataType:"json",data:{AD_Process_ID:e.jpObj.AD_Process_ID},success:function(r){var u,f,e;if(r!=null){if(u=jQuery.parseJSON(r),u.length==0){i.showReportTypes(!1);return}for(v.append("<option value='S'>"+n.Msg.getMsg("Select")+"<\/option>"),f=0;f<u.length;f++)e=t("<option value="+u[f].Key+">"+u[f].Name+"<\/li>"),v.append(e),e=null}}})};g();this.setSize=function(n){a&&(a.height(n),s.height(n),this.setMsg&&this.setMsg(""))};this.setSize(r);this.isBackground=function(){return l.is(":checked")};this.getRoot=function(){return a};this.getContentGrid=function(){return c};this.setBusy=function(n,t){isLocked=n;n?(s[0].style.visibility="visible",s.css("display","")):(s[0].style.visibility="hidden",s.css("display","none"),t)};this.setMsg=function(n){var r=o.find("b"),f,i,u,s;if(o.text().length>0&&n&&n.length>0?(f=t("<span>"+n+"<\/span>"),this.reportContainer.removeClass("vis-process-result"),this.reportContainer.addClass("vis-process-detail-result"),this.reportContainer.append(f)):o.append(n),i="",this.isReport&&(!r||r.length<=0)&&(i=t('<strong class="vis-process-papapa vis-procss-more"    style="position: fixed;right: 29px;top:96px"><i class="glyphicon glyphicon-chevron-down"><\/i><\/strong>'),o.append(i)),u=t(o.find("p")[0]),i=o.find(".vis-process-papapa"),u.css({float:"left"}),this.isReport&&(s=u.width(),s+45>o.width()?i.show():i.hide()),this.isReport&&(!r||r.length<=0))i.on("click",function(){var t=e.reportAreaContainer.height(),n=i.find("i");n.hasClass("glyphicon-chevron-up")?(n.addClass("glyphicon-chevron-down"),n.removeClass("glyphicon-chevron-up"),o.css({height:"40px"})):(n.addClass("glyphicon-chevron-up"),n.removeClass("glyphicon-chevron-down"),o.css({height:""}));e.reportContainer.height(t-(e.$divDesc.height()+20))});this.setMsgHeight(this.isReport)};this.setMsgHeight=function(n){n?(o.css("height","40px"),o.css("max-height","")):(o.css("height",""),e.parent&&o.css("max-height",e.parent.getContentGrid().height()-100+"px"));this.reportContainer.height(this.reportAreaContainer.height()-(this.$divDesc.height()+20));this.reportAreaContainer.width(this.partitionContainer.width()-this.parameterContainer.width())};this.setParameterHeights=function(n,i){var r=this,u=t(r.partitionContainer.find(".vis-process-outer-main-wrap")[0]),f,e;n&&(r.partitionContainer.height(n),u.height(n));f=u.height();e=t(r.partitionContainer.find(".vis-pro-para-root")[0]);e.height(f-114+"px");this.reportAreaContainer.width(i-this.parameterContainer.width())};this.getParametersContainer=function(){return this.parameterContainer};this.getReportAreaContainer=function(){return this.reportContainer};this.getContentTable=function(){return w};this.getBusyIndicator=function(){return s};this.getToolbar=function(){return this.reportToolbar};this.showCloseIcon=function(n){this.hideclose=n?!1:!0};this.showOkIcon=function(n){n?(this.parameterContainer.append(t('<div style="overflow:auto;padding:0 10px">').append(h)),h.removeClass(""),h.addClass("vis-process-ok-btn VIS_Pref_btn-2"),h.show()):h.hide()};this.showParameterCloseIcon=function(n){this.showParameterClose=n?!0:!1};this.getShowParameterCloseIcon=function(){return this.showParameterClose};this.setCssForToolbarIcons=function(n){this.cssForAll=n};this.setReportFormatIcons=function(n){this.visRepformatIcons=n};this.setSaveCsvIcons=function(n){this.visSaveCsvIcons=n};this.setSavePdfIcons=function(n){this.visSavePdfIcons=n};this.setArchiveIcons=function(n){this.visArchiveIcons=n};this.setRequeryIcons=function(n){this.visRequeryIcons=n};this.setCustomizeIcons=function(n){this.visCustomizeIcons=n};this.setPrintIcons=function(n){this.visPrintIcons=n};this.setToolbarColor=function(n){this.toolbarColor=n};this.getFileType=function(){return v.val()};this.reportBytes=null;this.reportPath=null;this.showReportTypes=function(n){n?(v.css("display","block"),b.css("display","block")):(v.css("display","none"),b.css("display","none"))};this.showBackgroundProcess=function(n){n?(e.parameterFixedArea.addClass("vis-process-pram-checkbox-text"),l.css("display","block"),k.css("display","block")):(e.parameterFixedArea.removeClass("vis-process-pram-checkbox-text"),l.css("display","none"),k.css("display","none"))};this.enableBackgroundSetting=function(n){l.prop("checked",n);n==!0?l.prop("disabled","disabled"):l.prop("disabled","")};this.archiveDocument=function(i,r){i.setBusy(!0);t.ajax({url:n.Application.contextUrl+"JsonData/ArchiveDoc/",dataType:"json",type:"post",data:{AD_Process_ID:r.pi.getAD_Process_ID(),Name:r.pi.getTitle(),AD_Table_ID:r.pi.getTable_ID(),Record_ID:r.pi.getRecord_ID(),C_BPartner_ID:0,isReport:!0,binaryData:e.reportBytes,reportPath:e.reportPath},success:function(){n.ADialog.info("Archived",!0,"","");i.setBusy(!1)}})};h.on("click",function(){e.onclickTrigger(e)});this.onclickTrigger=function(t){var i,r;if(t.isComplete){t.dispose();return}i=null;i=new n.ProcessInfo(t.jpObj.Name,t.jpObj.AD_Process_ID,0,0);i.setAD_User_ID(t.ctx.getAD_User_ID());i.setAD_Client_ID(t.ctx.getAD_Client_ID());i.setUseCrystalReportViewer(n.context.getIsUseCrystalReportViewer());i.setIsBackground(l.is(":checked"));i.setIsReport(t.isReport);r=new n.ProcessCtl(t,i,null);i.setFileType(v.val());t.windowNo?r.process(t.windowNo):r.process(n.Env.getWindowNo());r=null};y.on("click",function(){e.parent.dispose()});d.on("click",function(n){n.stopPropagation();n.preventDefault();e.parameterContainer.width()>40?(e.parameterContainer.css("flex-basis","40px"),e.parameterFixedArea.hide(),e.getParametersContainer().find(".vis-pro-para-root").hide(),e.getParametersContainer().find(".vis-process-ok-btn").hide()):(e.parameterContainer.css("flex-basis","280px"),e.parameterFixedArea.show(),e.getParametersContainer().find(".vis-pro-para-root").show(),e.getParametersContainer().find(".vis-process-ok-btn").show())});this.disposeComponent=function(){h&&h.off("click");y&&y.off("click");a&&a.remove();a=null;c&&c.remove();c=null;this.reportContainer&&this.reportContainer.remove();this.parameterContainer&&this.parameterContainer.remove();this.reportToolbar&&this.reportToolbar.remove();this.partitionContainer&&this.partitionContainer.remove();s&&s.remove();s=null;h=y=o=null;this.$parentWindow=null;this.isComplete=!1;this.jpObj=null;e=null}}function e(n,i,r){var u=null;return t.ajax({url:o,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}var r=n.Application.contextUrl,u=r+"JsonData/ExecuteNonQuer",f=function(n,i,r){var e=r?!0:!1,f=null,o={sql:n.join("/"),param:i};return t.ajax({url:u+"yWithCode",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:e,data:JSON.stringify(o)}).done(function(n){f=n;r&&r(n)}),f};i.prototype.init=function(t,i,r){if(t.Name==null||t.Name=="")return n.ADialog.info("Process Name is empty"),fasle;if(this.ctx.setWindowContext(r,"IsSOTrx",t.IsSOTrx),i.getContentGrid().append(this.getRoot()),this.isReport=t.IsReport,this.setMsg(t.MessageText),this.setBusy(!1),this.parent=i,this.jpObj=t,t.IsReport?(this.showReportTypes(!0),this.loadFileTypes(),t.IsCrystal&&n.context.getIsUseCrystalReportViewer()&&this.parameterFixedArea.hide()):(this.showBackgroundProcess(!0),this.enableBackgroundSetting(t.IsBackground)),this.setMsgHeight(t.IsReport),t.HasPara||this.showOkIcon(!0),this.splitUI&&t.HasPara)this.onclickTrigger(this);return this.splitUI&&(this.parent.getContentGrid().empty(),this.parent.getContentGrid().append(this.partitionContainer)),this.windowNo=r,!0};i.prototype.setTitle=function(t){this.parent&&this.parent.setTitle(n.Utility.Util.cleanMnemonic(t))};i.prototype.lockUI=function(){this.isLocked=!0;this.setBusy(!0)};i.prototype.unlockUI=function(t){t.logs&&t.logs.length>0&&(t.logs=null);n.ProcessInfoUtil.setLogFromDB(t);var i="";t&&t.getSummary()?i="<p style='float: left;width: 100%;'><font color=\""+(t.getIsError()?"#FF0000":"#0000FF")+'">** '+t.getSummary()+"<\/font><\/p>":this.jpObj.IsReport||(i="<p style='float: left;width: 100%;'><font color=\""+(t.getIsError()?"#FF0000":"#0000FF")+'">** <\/font><\/p>');i+=t.getLogInfo(!0);this.setMsg(i);this.setBusy(!1);t.setSummary("");this.isLocked=!1};i.prototype.getIsUILocked=function(){return this.isLocked};i.prototype.dispose=function(){this.disposed||(this.disposed=!0,this.mPanel&&(this.mPanel.dispose(),this.mPanel=null),this.parent&&(this.parent.dispose(),this.parent=null),n.Env.clearWinContext(this.ctx,this.windowNo),this.disposeComponent())};var r=n.Application.contextUrl,o=r+"JsonData/JDataSetWithCode",u=r+"JsonData/ExecuteNonQuer",s=function(t,i,r){var o=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,e(f,o,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u},h=function(t,i,r){var f=r?!0:!1,o={sql:t,page:1,pageSize:0},u=null;return e(o,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u},f=function(n,i,r){var e=r?!0:!1,f=null,o={sql:n,param:i};return t.ajax({url:u+"iesWithCode",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:e,data:JSON.stringify(data)}).done(function(n){f=n;r&&r(n)}),f};i.prototype.createUI=function(i,r,u){function ft(i,u){var st=r.pi.get_AD_PrintFormat_Table_ID(),ot,ft,f,ut;if(w=n.MRole.getDefault().getIsCanExport(st),ot=[],ft=-1,s=[],f=null,t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GetPrintFormatDetails",data:{AD_Table_ID:st},success:function(t){var i,r;f=(new n.DB.DataReader).toJson(t);try{while(f.read())ft=parseInt(ft)+1,i=f.getString(1),ot.indexOf(i)>-1&&(i=i+"_"+(parseInt(ft)+1)),r={},r.ID=n.Utility.Util.getValueOfInt(f.get(0)),r.Name=i,r.IsDefault=f.getString(3),ot.push(f.getString(1)),s.push(r);f.close()}catch(u){f.close()}f=null}}),et(),rt=t("<div>"),h=t('<select class="vis-selectcsview-page">'),c=t("<ul class='vis-apanel-rb-ul'>"),e.cssForAll?(b=t("<li><a  title='"+n.Msg.getMsg("SaveAllRecordCsv")+"'  style='cursor:pointer;'class='"+e.cssForAll+"vis-report-icon vis-savecsvAll-ico'><\/a><\/li>"),k=t("<li><a  title='"+n.Msg.getMsg("SaveAllPagePdf")+"' style='cursor:pointer;' class='"+e.cssForAll+"vis-report-icon vis-savepdfALL-ico'><\/a><\/li>")):(b=t("<li><a  title='"+n.Msg.getMsg("SaveAllRecordCsv")+"'  style='cursor:pointer;'class='vis-report-icon vis-savecsvAll-ico'><\/a><\/li>"),k=t("<li><a  title='"+n.Msg.getMsg("SaveAllPagePdf")+"' style='cursor:pointer;' class='vis-report-icon vis-savepdfALL-ico'><\/a><\/li>")),d=t("<div class='vis-report-header'>").append(t('<h3 class="vis-report-tittle" style="float:left;padding-top: 10px;">').append(n.Msg.getMsg("Report"))),e.toolbarColor&&d.css("background-color",e.toolbarColor),v=t('<a href="javascript:void(0)" class="vis-mainMenuIcons vis-icon-menuclose" style="float:right">'),g=t('<div class="vis-report-top-icons" style="float:right;">'),o=t('<ul style="margin-top: 10px;float:left">'),p=t("<li><a style='cursor:pointer;margin-top:2px' class='"+e.visRepformatIcons+"'><\/a><\/li>"),c.append(t('<li data-id="-1">').append(n.Msg.getMsg("NewReport"))),rt.append(c),o.append(p),w&&(tt=t("<li><a title='"+n.Msg.getMsg("SaveCSVPage")+"' style='cursor:pointer;margin-top:1px' class='"+e.visSaveCsvIcons+"'><\/a><\/li>"),o.append(tt)),r.pi.getSupportPaging()&&w){for(o.append(b),ut=1;ut<r.pi.getTotalPages()+1;ut++)h.append(t("<option value="+ut+">"+ut+"<\/option>"));g.append(h)}w&&(it=t("<li><a title='"+n.Msg.getMsg("SavePDFDocumentPage")+"' style='cursor:pointer;margin-top:1px' class='"+e.visSavePdfIcons+"'><\/a><\/li>"),o.append(it));r.pi.getSupportPaging()&&w?o.append(k):(tt.find("a").attr("title",n.Msg.getMsg("SaveCSV")),it.find("a").attr("title",n.Msg.getMsg("SavePdf")));n.context.ctx["#BULK_REPORT_DOWNLOAD"]=="Y"?(b.css("display","block"),k.css("display","block")):(b.css("display","none"),k.css("display","none"));nt=t("<li><a title='"+n.Msg.getMsg("Archive")+"' style='cursor:pointer;' class='"+e.visArchiveIcons+"'><\/a><\/li>");o.append(nt);y=t("<li><a title='"+n.Msg.getMsg("Requery")+"' style='cursor:pointer;' class='"+e.visRequeryIcons+"'><\/a><\/li>");o.append(y);l=t("<li><a style='cursor:pointer;' class='"+e.visCustomizeIcons+"'><\/a><\/li>");o.append(l);a=t("<li><a style='cursor:pointer;' class='"+e.visPrintIcons+"'><\/a><\/li>");o.append(a);u.HTML||(a.css("display","none"),l.css("display","none"),p.css("display","none"));g.append(o);e.hideclose||d.append(v);d.append(g);e.splitUI?(e.reportToolbar.css("display","flex"),e.reportToolbar.empty().append(d),e.reportContainer.empty().append(i.getRoot()),e.extrnalForm&&e.getContentTable().empty().append(e.reportContainer)):(e.parent.getContentGrid().append(d).append(i.getRoot()),i.getRoot().css("width",t(window).width()))}function ut(i){function lt(n){r.pi.setFileType(n);return{processInfo:r.pi.toJson(),parameterList:r.paraList}}function wt(n,t){return{AD_Process_ID:r.pi.getAD_Process_ID(),Name:r.pi.getTitle(),AD_PInstance_ID:r.pi.getAD_PInstance_ID(),AD_Table_ID:r.pi.getTable_ID(),Record_ID:r.pi.getRecord_ID(),pageNumber:n,page_Size:t,saveAll:!1}}function ot(n,t,i,u,f,e){return{processInfo:r.pi.toJson(),queryInfo:JSON.stringify(n),code:t,isCreateNew:i,treeID:f,node_ID:u,IsSummary:e}}function bt(n,t,i,r,u,f,e,o){return{AD_Process_ID:n,Name:t,AD_PInstance_ID:i,AD_Table_ID:r,Record_ID:u,pageNumber:f,page_Size:e,printAllPages:o}}function at(t,i){n.dataContext.executeProcess(t,function(n){if(n.error!=null){r.pi.setSummary(n.error,!0);r.unlock();r=null;return}var t=JSON.parse(n.result);if(t.IsError){r.pi.setSummary(t.Message,!0);r.unlock();r=null;return}i(t)})}function d(i,r){var f,u,o,s,c,h;try{if(i.HTML){if(r.getRightInnerDiv().html(i.HTML),f=document.getElementsByClassName("vis-reptabledetect"),f.length>0){for(u=0,o=0,s=0,c=f.length;s<c;s++)o=t(f[s]).width(),o>u&&(u=o);r.getRightDiv().width(t(window).width()-10);r.getRightDiv().css("min-width",t(window).width()+"px");r.getRightInnerDiv().width(u+50)}r.getRightInnerDiv().width(u)}else i.ReportFilePath&&(h=t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"),h.attr("src",n.Application.contextUrl+i.ReportFilePath),r.getRightDiv().empty().append(h),e.reportPath=i.ReportFilePath)}catch(l){}r.setBusy(!1)}function kt(t,i,r,u,f){t.HTML&&t.HTML.length>0?d(t,i):u==0?(window.open(n.Application.contextUrl+t.ReportFilePath),i.setBusy(!1)):ft(u,t.ReportFilePath,f,t)}function ft(i,r,f,e){f.setBulkBusy(!1);t("#forreportdownload").addClass("hide");et+='<input type="checkbox" data-num="'+e+'"  data-url="'+n.Application.contextUrl+r+'" checked />';u+=1;updateCreateBar(u/i*100);u==i&&setTimeout(function(){updateCreateBar(100);showCreateMessage(n.Msg.getMsg("Generated"));t("<form>",{id:"download_form",html:et,action:"#",Class:"hide"}).appendTo(document.body).submit()},1e3)}function st(u){var f={processInfo:r.pi.toJson()};t.ajax({url:n.Application.contextUrl+r.pi.dynamicAction,type:"Post",data:f,success:function(f){var o=JSON.parse(f),s;return ct||u!=r.REPORT_TYPE_PDF?window.open(n.Application.contextUrl+o):(s=t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"),s.attr("src",n.Application.contextUrl+o),i.getRightDiv().empty().append(s),e.reportPath=o.ReportFilePath),i.setBusy(!1),o.ReportFilePath}})}function vt(u,f,e){r.pi.setPageNo(u);var o={processInfo:r.pi.toJson()};t.ajax({url:n.Application.contextUrl+r.pi.dynamicAction,type:"Post",data:o,success:function(n){n=JSON.parse(n);ft(e,n,f,u);i.setBusy(!1)}})}var ht=e.parent,ct=/ipad|iphone|ipod|mobile|android|blackberry|webos|windows phone/i.test(navigator.userAgent.toLowerCase()),yt,pt,u,ri,et;v.off("click");y.off("click");l.off("click");a.off("click");p.off("click");c.off("click");nt.off("click");v.on("click",function(){i&&(i.dispose(),i=null);ht&&(ht.dispose(),ht=null);r.pi&&r.pi.dispose();r.pi=null;o.empty();v.off("click");y.off("click");l.off("click");a.off("click");p.off("click");c.off("click");v=null;g=null;o=null;nt=null;y=null;l=null;a=null;tt=null;it=null;ut=null});y.on("click",function(){i.setBusy(!0);i.getRightInnerDiv().html("");i.getRightInnerDiv().width(0);r.pi.dynamicAction&&r.pi.dynamicAction.length>0?st(r.REPORT_TYPE_PDF,h.val()):loadReportData()});l.on("click",function(){var t=new n.Query;t.addRestriction("AD_PrintFormat_ID",n.Query.prototype.EQUAL,r.pi.AD_PrintFormat_ID);n.viewManager.startWindow(240,t)});a.on("click",function(){if(i.getIsHtmlReport()){var n=window.open();n.document.write("<html><head>");n.document.write("<\/head><body >");n.document.write(i.getHtml());n.document.write("<\/body><\/html>");n.print();n.close()}});if(w){tt.on("click",function(){r.pi.setFileType("C");r.pi.getPageNo()==1?(i.setBusy(!0),at(lt(r.REPORT_TYPE_CSV),function(t){window.open(n.Application.contextUrl+t.ReportFilePath);i.setBusy(!1)})):(i.setBusy(!0),window.setTimeout(function(){if(r.pi.dynamicAction&&r.pi.dynamicAction.length>0)st(r.REPORT_TYPE_CSV,r.pi.getPageNo());else if(r.pi.GetAD_ReportView_ID()>0)pt(h.val(),0,null);else if(r.pi.getIsJasperReport())dt("C",r.pi.getPageNo());else{pageNo=h.val();var u=wt(pageNo,r.pi.getPageSize());t.ajax({url:n.Application.contextUrl+"ReportCom/ExecuteReportforCsv",type:"Post",data:u,success:function(t){var r=JSON.parse(t);window.open(n.Application.contextUrl+"TempDownload/"+r);i.setBusy(!1)}})}},100))});it.on("click",function(){r.pi.setFileType(r.REPORT_TYPE_PDF);r.pi.getPageNo()==1?(i.setBusy(!0),at(lt(r.REPORT_TYPE_PDF),function(n){d(n,i)})):loadReportData()});function loadReportData(){i.setBusy(!0);window.setTimeout(function(){if(r.pi.dynamicAction&&r.pi.dynamicAction.length>0)st(r.REPORT_TYPE_PDF,r.pi.getPageNo());else if(r.pi.GetAD_ReportView_ID()>0)yt(r.pi.getPageNo(),0,null);else if(r.pi.getIsJasperReport())dt(r.REPORT_TYPE_PDF,r.pi.getPageNo());else if(r.pi.getIsReportFormat()){var u=bt(r.pi.getAD_Process_ID(),r.pi.getTitle(),r.pi.getAD_PInstance_ID(),r.pi.getTable_ID(),r.pi.getRecord_ID(),r.pi.getPageNo(),r.pi.getPageSize(),!1);t.ajax({url:n.Application.contextUrl+"ReportCom/ExecuteReport",type:"Post",data:u,success:function(r){var u=JSON.parse(r),f;ct?window.open(n.Application.contextUrl+u):(f=t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"),f.attr("src",n.Application.contextUrl+u),i.getRightDiv().empty().append(f));e.reportPath=u;i.setBusy(!1)}})}else at(lt(r.REPORT_TYPE_PDF),function(n){d(n,i)})},200)}h.on("change",function(){var u,f,o;pageNo=h.val();r.pi.GetAD_ReportView_ID()>0?(i.setBusy(!0),u=[],r.pi.setPageNo(pageNo),f=new n.Query(r.pi.getPrintFormatTableName()),r.pi.getPrintFormatTableName()&&(u.push(f.getTableName()),u.push(f.getWhereClause(!0))),o=ot(u,"",!1,0,0,!1),t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",type:"POST",data:o,success:function(n){var t=jQuery.parseJSON(n);if(t.IsError){r.pi.setSummary(t.Message,!0);r.unlock();r=null;return}d(t.repInfo,i);e.reportPath=t.repInfo.ReportFilePath}})):r.pi.setPageNo(pageNo)});function dt(u){r.pi.setFileType(u);var f={processInfo:r.pi.toJson()};t.ajax({url:n.Application.contextUrl+"JasperReport/ExecuteReport",type:"Post",data:f,success:function(f){var o=JSON.parse(f),s;ct?window.open(n.Application.contextUrl+o):(u==r.REPORT_TYPE_PDF?(s=t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"),s.attr("src",n.Application.contextUrl+o),i.getRightDiv().empty().append(s)):window.open(n.Application.contextUrl+o),e.reportPath=o);i.setBusy(!1)}})}function gt(u,f,e){var o;r.pi.setPageNo(u);o={processInfo:r.pi.toJson()};t.ajax({url:n.Application.contextUrl+"JasperReport/ExecuteReport",type:"Post",data:o,success:function(n){n=JSON.parse(n);ft(f,n,e,u);i.setBusy(!1)}})}b.on("click",function(){i.setBusy(!0);u=0;et="";r.pi.setFileType("C");window.setTimeout(function(){var i=new n.BulkDownload(e.windowNo,"CSV"),t;if(i.onClose=function(){},i.show(),r.pi.dynamicAction&&r.pi.dynamicAction.length>0)for(t=1;t<=r.pi.getTotalPages();t++)vt(t,i,r.pi.getTotalPages());else if(r.pi.GetAD_ReportView_ID()>0)for(t=1;t<=r.pi.getTotalPages();t++)pt(t,r.pi.getTotalPages(),i);else if(r.pi.getIsJasperReport())for(t=1;t<=r.pi.getTotalPages();t++)gt(t,r.pi.getTotalPages(),i);else for(t=1;t<=r.pi.getTotalPages();t++)ti(t,i,r.pi.getTotalPages());r.pi.setPageNo(h.val())},100)});function ti(u,f,e){var s="",o;r.pi.dynamicAction&&r.pi.dynamicAction.length>0?s=st(r.REPORT_TYPE_CSV,u):(o=wt(u,r.pi.getPageSize()),t.ajax({url:n.Application.contextUrl+"ReportCom/ExecuteReportforCsv",type:"Post",data:o,success:function(n){var t=JSON.parse(n);t="TempDownload/"+t;ft(e,t,f,u);i.setBusy(!1)}}))}yt=function(u,f,o){var s=[],h=new n.Query(r.pi.getPrintFormatTableName()),c;s.push(h.getTableName());s.push(h.getWhereClause(!0));c=ot(s,"",!1,0,0,!1);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:c,type:"POST",success:function(t){t==null&&n.ADialog.error("ERRORGettingRepData");var s=jQuery.parseJSON(t),r=s.repInfo;if(r.ErrorText){n.ADialog.error(r.ErrorText);i.setBusy(!0);return}kt(r,i,u,f,o);i.setBusy(!1);e.reportPath=r.ReportFilePath}})};pt=function(u,f,o){var s=[],h=new n.Query(r.pi.getPrintFormatTableName()),c;s.push(h.getTableName());s.push(h.getWhereClause(!0));c=ot(s,"",!1,0,0,!1);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:c,type:"POST",success:function(t){t==null&&n.ADialog.error("ERRORGettingRepData");var s=jQuery.parseJSON(t),r=s.repInfo;if(r.ErrorText){n.ADialog.error(r.ErrorText);setBusy(!1);return}kt(r,i,u,f,o);e.reportPath=r.ReportFilePath;i.setBusy(!1)}})};k.on("click",function(){i.setBusy(!0);u=0;et="";r.pi.setFileType(r.REPORT_TYPE_PDF);window.setTimeout(function(){var i=new n.BulkDownload(e.windowNo,"PDF"),t;if(i.onClose=function(){},i.show(),r.pi.dynamicAction&&r.pi.dynamicAction.length>0)for(t=1;t<=r.pi.getTotalPages();t++)vt(t,i,r.pi.getTotalPages());else if(r.pi.GetAD_ReportView_ID()>0)for(t=1;t<=r.pi.getTotalPages();t++)yt(t,r.pi.getTotalPages(),i);else if(r.pi.getIsJasperReport())for(t=1;t<=r.pi.getTotalPages();t++)gt(t,r.pi.getTotalPages(),i);else for(t=1;t<=r.pi.getTotalPages();t++)ii(t,i,r.pi.getTotalPages());r.pi.setPageNo(h.val())},100)});u=0;function ii(u,f,o){var h="",s;r.pi.dynamicAction&&r.pi.dynamicAction.length>0?h=vt(r.REPORT_TYPE_CSV,u):(s=bt(r.pi.getAD_Process_ID(),r.pi.getTitle(),r.pi.getAD_PInstance_ID(),r.pi.getTable_ID(),r.pi.getRecord_ID(),u,r.pi.getPageSize(),!1),t.ajax({url:n.Application.contextUrl+"ReportCom/ExecuteReport",type:"Post",data:s,success:function(n){var t=JSON.parse(n);ft(o,t,f,u);e.reportPath=t;i.setBusy(!1)}}))}ri=function(){for(var i,r,u,n=0;n<arguments.length;n++)i=t('<iframe style="visibility: collapse;"><\/iframe>'),t("body").append(i),r=i[0].contentDocument,u='<form action="'+arguments[n]+'" method="GET"><\/form>',r.write(u),t("form",r).submit(),setTimeout(function(n){return function(){n.remove()}}(i),2e3)};et="";function updateCreateBar(n){var i=t("#reportcreate").find(".progress-bar").width()*100/t("#reportcreate").width();isNaN(i)&&(i=0);i<=n&&t("#reportcreate").removeClass("hide").find(".progress-bar").attr("aria-valuenow",n).css({width:n+"%"}).text(n.toFixed(0)+"%")}function ni(){t("#reportcreateresult").removeClass().text("")}function showCreateMessage(n){ni();t("#reportcreateresult").addClass("alert alert-success").text(n);t("#forreportdownload").removeClass("hide")}function ui(n){ni();t("#reportcreateresult").addClass("alert alert-danger").text(n)}}p.on("click",function(){var i,u,r;for(c.empty(),i=0;i<s.length;i++)u=s[i].IsDefault=="Y"?"vis-mainfavitem":"vis-mainnonfavitem",r=t('<li><a data-isdefbtn="no" data-id="'+s[i].ID+'">'+s[i].Name+"<\/a><\/li>"),c.append(r);c.append(t('<li><a data-id="-1">'+n.Msg.getMsg("NewReport")+"<\/a>"));t(this).w2overlay(rt.clone(!0),{css:{height:"300px"}})});c.on("click","LI",function(u){var v,h,y,o,c,p,l,a,w;if(i.setBusy(!0),v=t(u.target),h=v.data("id"),v.data("isdefbtn")=="yes"){for(y="VIS_76",o=[],o[0]=new n.DB.SqlParam("@tableID",r.pi.Ad_Table_ID),o[1]=new n.DB.SqlParam("@tabID",curTab.getAD_Tab_ID()),f(sql,o),y="VIS_77",o=[],o[0]=new n.DB.SqlParam("@printForamt",h),f(sql,o),c=0;c<s.length;c++)s[c].IsDefault=s[c].ID==h?"Y":"N";return}AD_PrintFormat_ID=h;p=!1;h==-1&&(h=r.pi.get_AD_PrintFormat_Table_ID,p=!0);l=[];a=new n.Query(r.pi.getPrintFormatTableName());l.push(a.getTableName());l.push(a.getWhereClause(!0));w=ot(l,a.getCode(0),false0,0,!1);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:w,type:"POST",success:function(n){var t=jQuery.parseJSON(n);if(t.IsError){r.pi.setSummary(t.Message,!0);r.unlock();r=null;return}d(t.repInfo,i);e.reportPath=t.repInfo.ReportFilePath}})});nt.on("click",function(){e.archiveDocument(i,r)})}function et(){e.visRepformatIcons&&e.visRepformatIcons.length!=0||(e.visRepformatIcons=e.cssForAll?e.cssForAll+" vis-repformat-ico ":"vis-repformat-ico vis-report-icon ");e.visSaveCsvIcons=e.visSaveCsvIcons&&e.visSaveCsvIcons.length!=0?e.visSaveCsvIcons+" vis-report-icon ":" vis-savecsv-ico vis-report-icon ";e.visSavePdfIcons=e.visSavePdfIcons&&e.visSavePdfIcons.length!=0?e.visSavePdfIcons+" vis-report-icon ":" vis-savepdf-ico vis-report-icon ";e.visArchiveIcons=e.visArchiveIcons&&e.visArchiveIcons.length!=0?e.visArchiveIcons+" vis-report-icon ":" vis-archive-ico vis-report-icon ";e.visRequeryIcons=e.visRequeryIcons&&e.visRequeryIcons.length!=0?e.visRequeryIcons+" vis-report-icon ":" vis-requery-ico vis-report-icon ";e.visCustomizeIcons=e.visCustomizeIcons&&e.visCustomizeIcons.length!=0?e.visCustomizeIcons+" vis-report-icon ":" vis-customize-ico vis-report-icon ";e.visPrintIcons=e.visPrintIcons&&e.visPrintIcons.length!=0?e.visPrintIcons+" vis-report-icon ":" vis-print-ico vis-report-icon "}var v=null,g=null,o=null,nt=null,y=null,l=null,a=null,tt=null,it=null,p=null,w=!1,s=[],rt=null,h=null,c=null,b=null,k=null,e=this,d=null;ft(i,u);ut(i,u)};i.prototype.showReport=function(t,i,r){var u=this;this.splitUI||(this.mPanel&&(this.mPanel.dispose(),this.mPanel=null),this.disposeComponent());this.mPanel=t;this.pCtl=r;this.createUI(t,r,i);this.parent.hideHeader(!0);t.setBusy(!1);(n.context.ctx.$AutoArchive=="1"||n.context.ctx.$AutoArchive=="2")&&u.archiveDocument(t,r)};i.prototype.showTelerikReport=function(n,t){var i=new KJS.TelerikContainer(n,t);i.getRoot().height(this.parent.getContentGrid().height());this.parent.getContentGrid().empty();this.parent.getContentGrid().append(i.getRoot());i.init()};i.prototype.setReportBytes=function(n){this.reportBytes=n};i.prototype.setReportPath=function(n){this.reportPath=n};i.prototype.sizeChanged=function(n,t){this.setSize(n,t);this.mPanel&&this.mPanel.sizeChanged&&!this.splitUI&&this.mPanel.sizeChanged(n,t);this.setParameterHeights&&this.setParameterHeights(n,t)};i.prototype.refresh=function(){this.setParameterHeights&&this.setParameterHeights();this.mPanel&&this.mPanel.refresh&&this.mPanel.refresh();this.setMsg&&this.setMsg("")};n.AProcess=i}(VIS,jQuery),function(n,t){function i(n,t){this.parent=n;this.pi=t;this.windowNo;this.paraList=null;this.splitUI=n.splitUI;this.parameters=null;this.cansplitUI=function(n){splitUI=n};this.getFileType=function(){return n.getFileType()};this.setBusy=function(t){n.setBusy(t)};this.isBackground=function(){return n.isBackground()}}function r(i,r,u){function h(){f=t("<div class='vis-height-full'>");e=t("<div class='vis-height-full' style='background: #63BFE9;'>");$innerRightDiv=t("<div class='vis-height-full' style='padding:5px;'>");f.append(e);f.append(s);u?(e.append($innerRightDiv),$innerRightDiv.html(i)):(o=t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>"),o.attr("src",n.Application.contextUrl+i),e.css("height","100%"),e.css("width","100%"),e.append(o))}this.bytes=null;this.RptFileName=i;this.Pi=r;var f=null,e=null;$innerRightDiv=null;var o=null,s=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>");h();this.getRoot=function(){return f};this.getRightDiv=function(){return e};this.getRightInnerDiv=function(){return $innerRightDiv};this.getIsHtmlReport=function(){return u};this.getHtml=function(){return i};this.disposeComponent=function(){f!=null&&(f.remove(),f=null)};this.setBusy=function(n){s.css("display",n?"block":"none")};this.sizeChanged=function(){};this.refresh=function(){}}i.prototype.REPORT_TYPE_CSV="C";i.prototype.REPORT_TYPE_PDF="P";i.prototype.REPORT_TYPE_RTF="R";i.prototype.process=function(t){var i,r;this.lock();this.windowNo=t;this.pi.setWindowNo(t);i=this;this.jObjectFromServer=null;r={processInfo:this.pi.toJson()};n.dataContext.process(r,function(n){if(n.error!=null){i.pi.setSummary(n.error,!0);i.unlock();i=null;return}var t=JSON.parse(n.result);if(t.IsError){i.pi.setSummary(t.Message,!0);i.unlock();i=null;return}i.complete(t);i=null})};i.prototype.complete=function(t){var i,u,r,f,e;if(this.jObjectFromServer=t,this.pi.setAD_PInstance_ID(t.AD_PInstance_ID),t&&t.ReportProcessInfo&&(this.pi.setTotalPages(t.ReportProcessInfo.TotalPage),this.pi.setSupportPaging(t.ReportProcessInfo.SupportPaging),this.pi.setPageSize(t.ReportProcessInfo.PageSize)),t.ShowParameter){this.pi.setAD_PInstance_ID(t.AD_PInstance_ID);try{i=new n.ProcessParameter(this.pi,this,this.windowNo);this.splitUI&&(this.parent.parameterContainer.append(i.getRoot()),this.parent.setParameterHeights());i.initDialog(t.ProcessFields);this.splitUI?i.showCloseIcon(this.parent.getShowParameterCloseIcon()):(i.showDialog(),i=null)}catch(o){this.pi.setSummary(o.message,!0)}this.unlock()}else t.IsTelerikReport?window.KJS&&this.parent&&this.parent.showTelerikReport(this.pi.AD_PInstance_ID,this.pi.getTable_ID()):(this.unlock(),this.parent&&(t.AskForNewTab&&t.HTML&&t.HTML.length>0?n.ADialog.confirm("VIS_OpenNewTab",!0,"","Confirm",function(i){i&&window.open(n.Application.contextUrl+t.ReportFilePath)}):t.ReportFilePath?(u=/ipad|iphone|ipod|mobile|android|blackberry|webos|windows phone/i.test(navigator.userAgent.toLowerCase()),u?window.open(n.Application.contextUrl+t.ReportFilePath):this.parent.setReportBytes?(this.parent.setReportBytes(t.Report),this.parent.setReportPath(t.ReportFilePath),r=null,f=!1,t.HTML&&t.HTML.length>0?(r=new n.PdfViewer(t.HTML,null,!0),this.parent.showReport(r,t,this)):t.ReportFilePath&&t.ReportFilePath.length>0&&(r=new n.PdfViewer(t.ReportFilePath),f=!0,this.parent.showReport(r,t,this))):window.open(n.Application.contextUrl+t.ReportFilePath)):this.pi.getUseCrystalReportViewer()&&this.pi.getIsReport()&&(e=new n.ReportViewerContainer(this),e.show()))),this.setBusy(!1),this.dispose()};i.prototype.onProcessDialogClosed=function(t,i){var r,u;t&&(r=this,this.paraList=i,this.lock(),u={processInfo:r.pi.toJson(),parameterList:i},n.dataContext.executeProcess(u,function(n){if(n.error!=null){r.pi.setSummary(n.error,!0);r.unlock();r=null;return}var t=JSON.parse(n.result);if(t.IsError){r.pi.setSummary(t.Message,!0);r.unlock();r=null;return}r.complete(t);this.splitUI||(r=null)}))};i.prototype.unlock=function(){var t=this.jObjectFromServer.Result;t!=null&&t.indexOf("@")!=-1?this.pi.setSummary(n.Msg.parseTranslation(n.Env.getCtx(),t)):t&&this.pi.setSummary(t);this.pi.setError(this.jObjectFromServer.IsError);this.parent&&this.parent.unlockUI(this.pi)};i.prototype.lock=function(){this.parent&&this.parent.lockUI(this.pi)};i.prototype.dispose=function(){this.splitUI||(this.parent=null)};r.prototype.dispose=function(){this.disposeComponent()};n.PdfViewer=r;n.ProcessCtl=i}(VIS,jQuery),function(n,t){function i(t,i,r,u){this.title=t;this.AD_Process_ID=i;this.table_ID=r;this.tableName="";this.record_ID=u;this.AD_User_ID=0;this.AD_Client_ID=0;this.className=null;this.AD_PInstance_ID=0;this.summary="";this.error=!1;this.batch=!1;this.timeout=!1;this.parameter=null;this.AD_PrintFormat_Table_ID=0;this.AD_PrintFormat_ID=0;this.isReportFormat=!1;this.isCrystal=!1;this.totalrecords=0;this.isTelerikReport=!1;this.supportPaging=!1;this.dynamicAction="";this.pageSize=n.context.ctx["#REPORT_PAGE_SIZE"];this.totalPage=1;this.pageNo=1;this.fileType=n.ProcessCtl.prototype.REPORT_TYPE_PDF;this.windowNo=0;this.tableName="";this.AD_Window_ID=0;this.AD_ReportView_ID=0;this.printFormatTableName="";this.useCrystalReportViewer=!1;this.isReport=!1;this.isBackground=!1}function u(n,t){n.className=t.ClassName;n.record_ID=t.Record_ID;n.error=t.Error;n.AD_PInstance_ID=t.AD_PInstance_ID;n.summary=t.Summary;n.table_ID=t.AD_Table_ID;n.tableName=t.AD_TableName;n.AD_User_ID=t.AD_User_ID;n.AD_Client_ID=t.AD_Client_ID;n.batch=t.Batch;n.timeout=t.TimeOut;n.AD_PrintFormat_Table_ID=t.AD_PrintFormat_Table_ID;n.printFormatTableName=t.PrintFormatTableName;n.AD_PrintFormat_ID=t.AD_PrintFormat_ID;n.isCrystal=t.IsCrystal;n.isReportFormat=t.IsReportFormat;n.totalrecords=parseInt(t.TotalRecords);n.isTelerikReport=t.IsTelerikReport;n.supportPaging=t.SupportPaging;n.dynamicAction=t.DynamicAction;n.pageSize=t.PageSize;n.title=t.Title;n.AD_Process_ID=t.Process_ID;n.totalPage=t.TotalPage;n.pageNo=t.PageNo;n.windowNo=t.WindowNo;n.AD_ReportView_ID=t.AD_ReportView_ID;n.isJasperReport=t.IsJasperReport;n.useCrystalReportViewer=t.UseCrystalReportViewer;n.isReport=t.IsReport;n.isBackground=t.IsBackground}function s(n,i,r){var u=null;return t.ajax({url:e,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function r(n,t,i,r,u){this.P_ID;this.P_Date;this.P_Number;this.P_Msg;n?this.setLog_ID(n):this.setLog_ID(this.Log_ID++);this.setP_ID(t);this.setP_Date(i);this.setP_Number(r);this.setP_Msg(u)}i.prototype.toJson=function(){return{Title:this.title,Process_ID:this.AD_Process_ID,AD_PInstance_ID:this.AD_PInstance_ID,Record_ID:this.record_ID,Error:this.error,Summary:this.getSummary(),ClassName:this.className,AD_Table_ID:this.table_ID,AD_TableName:this.tableName,AD_User_ID:this.AD_User_ID,AD_Client_ID:this.AD_Client_ID,Batch:this.batch,TimeOut:this.timeout,AD_PrintFormat_Table_ID:this.AD_PrintFormat_Table_ID,PrintFormatTableName:this.printFormatTableName,AD_PrintFormat_ID:this.AD_PrintFormat_ID,SupportPaging:this.supportPaging,DynamicAction:this.dynamicAction,PageSize:this.pageSize,TotalPage:this.totalPage,PageNo:this.pageNo,FileType:this.fileType,AD_Window_ID:this.AD_Window_ID,WindowNo:this.windowNo,AD_ReportView_ID:this.AD_ReportView_ID,UseCrystalReportViewer:this.useCrystalReportViewer,IsReport:this.isReport,IsBackground:this.isBackground}};i.prototype.fromJson=function(n){var t=null;return t=this instanceof i?this:new i(n.Title,n.Process_ID),n&&n.length>0&&u(t,n),t};i.prototype.setPrintFormatTableName=function(n){this.printFormatTableName=n};i.prototype.getPrintFormatTableName=function(){return this.printFormatTableName};i.prototype.setSupportPaging=function(n){this.supportPaging=n};i.prototype.getSupportPaging=function(){return this.supportPaging};i.prototype.setTotalPages=function(n){this.totalPage=n};i.prototype.getTotalPages=function(){return this.totalPage};i.prototype.setPageNo=function(n){this.pageNo=n};i.prototype.getPageNo=function(){return this.pageNo};i.prototype.setPageSize=function(n){this.pageSize=n};i.prototype.getPageSize=function(){return this.pageSize};i.prototype.setError=function(n){this.error=n};i.prototype.getIsError=function(){return this.error};i.prototype.getIsBatch=function(){return this.batch};i.prototype.setIsBatch=function(n){this.batch=n};i.prototype.getAD_PInstance_ID=function(){return this.AD_PInstance_ID};i.prototype.setAD_PInstance_ID=function(n){this.AD_PInstance_ID=n};i.prototype.getAD_Process_ID=function(){return this.AD_Process_ID};i.prototype.setAD_Process_ID=function(n){this.AD_Process_ID=n};i.prototype.getClassName=function(){return this.className};i.prototype.setClassName=function(n){this.className=n;n!=null&&n.length==0&&(this.className=null)};i.prototype.getTable_ID=function(){return this.table_ID};i.prototype.setTable_ID=function(n){this.table_ID=n};i.prototype.setTable_Name=function(n){this.tableName=n};i.prototype.getTable_Name=function(){return this.tableName};i.prototype.setPrintFormatTableName=function(n){this.printFormatTableName=n};i.prototype.getPrintFormatTableName=function(){return this.printFormatTableName};i.prototype.getRecord_ID=function(){return this.record_ID};i.prototype.setRecord_ID=function(n){this.record_ID=n};i.prototype.getTitle=function(){return this.title};i.prototype.setTitle=function(n){this.title=n};i.prototype.setAD_Client_ID=function(n){this.AD_Client_ID=n};i.prototype.getAD_Client_ID=function(){return this.AD_Client_ID};i.prototype.setAD_User_ID=function(n){this.AD_User_ID=n};i.prototype.getAD_User_ID=function(){return this.AD_User_ID};i.prototype.getParameter=function(){return this.parameter};i.prototype.setParameter=function(n){this.parameter=n};i.prototype.setIsTimeout=function(n){this.timeout=n};i.prototype.getIsTimeout=function(){return this.timeout};i.prototype.set_AD_PrintFormat_Table_ID=function(n){this.AD_PrintFormat_Table_ID=n};i.prototype.get_AD_PrintFormat_Table_ID=function(){return this.AD_PrintFormat_Table_ID};i.prototype.set_AD_PrintFormat_ID=function(n){this.AD_PrintFormat_ID=n};i.prototype.Get_AD_PrintFormat_ID=function(){return this.AD_PrintFormat_ID};i.prototype.setIsCrystal=function(n){this.isCrystal=n};i.prototype.getIsCrystal=function(){return this.isCrystal};i.prototype.setIsTelerikReport=function(n){this.isTelerikReport=n};i.prototype.getIsTelerikReport=function(){return this.isTelerikReport};i.prototype.setIsReportFormat=function(n){this.isReportFormat=n};i.prototype.getIsReportFormat=function(){return this.isReportFormat};i.prototype.getTotalRecord=function(){return this.totalrecords};i.prototype.getFileType=function(){return this.fileType};i.prototype.setFileType=function(n){this.fileType=n};i.prototype.setWindowNo=function(n){this.windowNo=n};i.prototype.getWindowNo=function(){return this.windowNo};i.prototype.setUseCrystalReportViewer=function(n){this.useCrystalReportViewer=n};i.prototype.getUseCrystalReportViewer=function(){return this.useCrystalReportViewer};i.prototype.setIsReport=function(n){this.isReport=n};i.prototype.getIsReport=function(){return this.isReport};i.prototype.GetAD_ReportView_ID=function(){return this.AD_ReportView_ID};i.prototype.SetAD_ReportView_ID=function(n){this.AD_ReportView_ID=n};i.prototype.setIsJasperReport=function(n){this.isJasperReport=n};i.prototype.getIsJasperReport=function(){return this.isJasperReport};i.prototype.setAD_Window_ID=function(n){this.AD_Window_ID=n};i.prototype.getAD_Window_ID=function(){return this.AD_Window_ID};i.prototype.setIsBackground=function(n){this.isBackground=n};i.prototype.getIsBackground=function(){return this.isBackground};i.prototype.setSummary=function(n,t){arguments.length==2&&this.setError(t);this.summary=n};i.prototype.getSummary=function(){return this.summary};i.prototype.addLog=function(n,t,i,u,f){return this.addLogEntry(new r(n,t,i,u,f))};i.prototype.addLogEntry=function(n){var r,t,i,u;if(n==null)return null;for(this.logs==null&&(this.logs=[]),r=n.getLog_ID(),t=0;t<this.logs.length;t++)if(i=this.logs[t],u=i.getLog_ID(),r==u)return i;return this.logs.push(n),n};i.prototype.getLogInfo=function(t){var i,u,r,s;if(this.logs==null)return"";i=new StringBuilder;t&&i.append('<div class=\'vis-process-result-table\'><table width="100%" border="0" cellspacing="0" cellpadding="2">');var f=!1,e=!1,o=!1;for(u=0;u<this.logs.length;u++)r=this.logs[u],r.getP_Date()!=null&&(f=!0),r.getP_Number()!=null&&(e=!0),r.getP_Msg()!=null&&(o=!0);for(u=0;u<this.logs.length;u++)t?i.append("<tr>"):u>0&&i.append("\n"),r=this.logs[u],r.getP_Date()!=null?(i.append(t?"<td>":""),s=r.getP_Date(),i.append(t?"<\/td>":" \t")):f&&i.append(t?"<td>&nbsp;<\/td>":" \t"),r.getP_Number()!=null?i.append(t?"<td>":"").append(r.getP_Number()).append(t?"<\/td>":" \t"):e&&i.append(t?"<td>&nbsp;<\/td>":" \t"),r.getP_Msg()!=null?i.append(t?"<td>":"").append(n.Msg.parseTranslation(n.Env.getCtx(),r.getP_Msg())).append(t?"<\/td>":""):o&&i.append(t?"<td>&nbsp;<\/td>":""),t&&i.append("<\/tr>");return t&&i.append("<\/table><\/div>"),i.toString()};i.prototype.dispose=function(){this.title=null;this.AD_Process_ID=null;this.table_ID=null;this.tableName=null;this.record_ID=null;this.AD_User_ID=null;this.AD_Client_ID==null;this.className=null;this.AD_PInstance_ID=null;this.summary=null;this.error=null;this.batch=null;this.timeout=null;this.parameter=null;this.AD_PrintFormat_Table_ID=null;this.AD_PrintFormat_ID=null;this.isReportFormat=null;this.isCrystal=null;this.totalrecords=null;this.isJasperReport=null};var f=n.Application.contextUrl,e=f+"JsonData/JDataSetWithCode",o=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,s(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u};n.ProcessInfoUtil={setLogFromDB:function(t){var r=[],i;r[0]=new n.DB.SqlParam("@AD_PInstance_ID",t.getAD_PInstance_ID());i=null;try{for(i=o("VIS_144",r);i.read();)t.addLog(i.getInt(0),i.getInt(1),i.getDateTime(2),i.getDecimal(3),i.getString(4))}catch(u){console.log(u)}finally{i&&i.dispose()}}};r.prototype.Log_ID=0;r.prototype.getLog_ID=function(){return this.Log_ID};r.prototype.setLog_ID=function(n){this.Log_ID=n};r.prototype.getP_ID=function(){return this.P_ID};r.prototype.setP_ID=function(n){this.P_ID=n};r.prototype.getP_Date=function(){return this.P_Date};r.prototype.setP_Date=function(n){this.P_Date=n};r.prototype.getP_Number=function(){return this.P_Number};r.prototype.setP_Number=function(n){this.P_Number=n};r.prototype.getP_Msg=function(){return this.P_Msg};r.prototype.setP_Msg=function(n){this.P_Msg=n};n.ProcessInfo=i}(VIS,jQuery),function(n,t){function i(i,r,u){function b(){s=t("<div class='vis-pro-para-root'>");a=t("<table class='vis-processpara-table'>");p=t('<div style="overflow:auto;padding:0 10px">');y=t('<div class="vis-para-maxheight">');y.append(a);s.append(y).append(p);c=t('<input type="button" class="vis-process-ok-btn" >').val(n.Msg.getMsg("OK"));c.addClass("VIS_Pref_btn-2");e=t("<input type='button'>").val(n.Msg.getMsg("Close"));e.addClass("VIS_Pref_btn-2");e.css({"margin-bottom":"0px","margin-top":"7px","margin-left":"5px"});c.css({"margin-bottom":"0px","margin-top":"7px"});o||y.css("height","auto")}var o,s,a,v,l,w,h,c,e,p,y,f;this.pi=i;this.parent=r;this.windowNo=u;this.gridFields=[];this.depOnFieldColumn=[];this.depOnField=[];this.vEditors=[];this.vEditors2=[];this.mFields=[];this.mFields2=[];this.isOkClicked=!1;o=r.splitUI;this.onClosed;b();f=this;this.addLine=function(){v=l=w=h=null;v=t("<tr>");l=t("<td class=''>");h=t("<td class='vis-processpara-table-td3'>");a.append(v.append(l).append(h));o&&(a.width("100%"),v.addClass("vis-processpara-table-SplitUI"),l.addClass("vis-processpara-table-SplitUI"),h.addClass("vis-processpara-table-SplitUI"))};this.addFields=function(n,t){var i,u,r;n&&(i=n.getControl(),o&&i.css("color","white"),l.append(i));t&&(h.append(t.getControl()),t.getBtnCount()>0?(o?t.getControl().attr("type")=="date"&&t.getControl().css({width:"100%"}):t.getControl().width("200px"),u=t.getBtn(0),h.append(u),r=t.getBtn(1),r&&h.append(r)):o&&t.getControl().attr("type")=="date"&&t.getControl().css({width:"100%"}))};this.addButtons=function(){this.addLine();p.append(e).append(c)};this.canOpenDialog=function(n){o=n};this.showCloseIcon=function(n){n||e.hide()};this.showDialog=function(){s.dialog({modal:!0,width:"auto",closeText:n.Msg.getMsg("close"),close:function(){if(f.parent)f.parent.onProcessDialogClosed(f.isOkClicked,f.parameterList);f.dispose();f=null}});window.setTimeout(function(){e.focus()},200)};this.getRoot=function(){var n=this;return s};this.onClose=function(n){f.isOkClicked=n;s.dialog("close")};e.on(n.Events.onTouchStartAndClick,function(n){n.stopPropagation();n.preventDefault();f.onClose(!1)});c.on(n.Events.onTouchStartAndClick,function(t){var i;if(o){if(f.isOkClicked=!0,r.setBusy(!0),i=f.saveParameters(),!i){r.setBusy(!1);return}f.pi.setAD_PInstance_ID(0);f.pi.setPageNo(1);f.parent.getFileType()?f.pi.setFileType(f.parent.getFileType()):f.pi.setFileType(n.ProcessCtl.prototype.REPORT_TYPE_PDF);f.pi.setIsBackground(f.parent.isBackground());f.parameterList=i;f.parent.onProcessDialogClosed(f.isOkClicked,f.parameterList)}else{if(t.stopPropagation(),t.preventDefault(),i=f.saveParameters(),!i)return;f.parameterList=i;f.onClose(!0,i)}});this.setHeights=function(){};this.disposeComponent=function(){e.off(n.Events.onTouchStartOrClick);c.off(n.Events.onTouchStartOrClick);s.dialog("destroy");s.remove();f=null;this.gridFields.length=0;this.gridFields=null;this.depOnFieldColumn.length=0;this.depOnFieldColumn-null;this.depOnField.length=0;this.depOnField=null;this.vEditors.length=0;this.vEditors2.length=0;this.mFields.length=0;this.mFields2.length=0;this.parent=null;this.parameterList=null;this.pi=null;this.addLine=null;this.addFields=null;this.addButtons=null;this.showDialog=null;this.onClose=null;this.isOkClicked=null;s=a=v=l=w=h=c=e=null}}i.prototype.initDialog=function(i){for(var r=null,c,s,v,u,l,h,f,o,e=0,a=i.length;e<a;e++){for(r=new n.GridField(i[e]),this.addLine(),this.mFields.push(r),c=r.getDependentOn(!1),s=0;s<c.length;s++)this.depOnField.push(r),this.depOnFieldColumn.push(c[s]);v=n.VControlFactory.getLabel(r);u=n.VControlFactory.getControl(null,r,!1);u&&(o=r.getDefault(n.context,this.windowNo),u.setValue(o),u.addVetoableChangeListener(this),r.getDisplayType()==n.DisplayType.AmtDimension&&(u.hideButton(!1),u.setReadOnlyTextbox(!1),u.getControl().css("width","100%")));r.setPropertyChangeListener(u);this.vEditors.push(u);this.addFields(v,u);r.getIsRange()?(this.addLine(),l={},t.extend(!0,l,i[e]),h=new n.GridField(l),this.mFields2.push(h),f=n.VControlFactory.getControl(null,h,!1),f&&(o=h.getDefault2(n.context,this.windowNo),f.setValue(o),f.addVetoableChangeListener(this),r.getDisplayType()==n.DisplayType.AmtDimension&&(f.hideButton(!1),f.setReadOnlyTextbox(!1),f.getControl().css("width","100%"))),this.vEditors2.push(f),this.addFields(null,f)):(this.mFields2.push(null),this.vEditors2.push(null))}return this.addButtons(),!0};i.prototype.vetoablechange=function(t){var f,r,e,i,o,u;for(console.log(t),f=t.newValue==null?"":t.newValue.toString(),r=t.propertyName,i=0;i<this.mFields.length;i++)if(this.mFields[i].getColumnName().toLower()==r.toLower())if(this.mFields[i].getDisplayType()==n.DisplayType.YesNo){f.toString()=="Y"||f.toString()=="N"?n.Env.getCtx().setWindowContext(this.windowNo,r,f.toString()):n.Env.getCtx().setWindowContext(this.windowNo,r,f.toString().toLowerCase()=="true"?"Y":"N");break}else{n.Env.getCtx().setWindowContext(this.windowNo,r,f);break}if(this.depOnFieldColumn.indexOf(r)!==-1)for(e=this.getDependantFields(r),i=0,o=e.length;i<o;i++)if(u=e[i],u!=null)if(r=="M_Product_ID"&&(u.getColumnName()=="M_Locator_ID"||u.getColumnName()=="M_LocatorTo_ID"))continue;else u.refreshLookup(),u.setValue(u.getDefault(n.Env.getCtx(),this.windowNo),!0)};i.prototype.getDependantFields=function(n){var i=[],r,t;if(this.depOnFieldColumn.indexOf(n)!=-1)for(r=this.depOnFieldColumn.length,t=0;t<r;t++)this.depOnFieldColumn[t].equals(n)&&i.indexOf(this.depOnField[t])<0&&i.push(this.depOnField[t]);return i};i.prototype.saveParameters=function(){for(var r=new StringBuilder,p=this.mFields.length,t=0,u,w,c,l,a,v,y,i,h,o,t=0;t<p;t++)u=this.mFields[t],u.getIsMandatory(!0)&&(w=this.vEditors[t],c=w.getValue(),c==null||c.toString().length==0?(u.setInserting(!0),u.setError(!0),r.length()>0&&r.append(", "),r.append(u.getHeader())):u.setError(!1),l=this.vEditors2[t],l!=null&&(a=l.getValue(),v=this.mFields2[t],a==null||a.toString().length==0?(u.setInserting(!0),v.setError(!0),r.length()>0&&r.append(", "),r.append(u.getHeader())):v.setError(!1)));if(r.length()!=0)return n.ADialog.error("FillMandatory",!0,r.toString()),!1;for(y=[],i={},t=0;t<p;t++){var f=this.vEditors[t],e=this.vEditors2[t],s=f.getValue();(f.getDisplayType()==n.DisplayType.AmtDimension&&(s=f.getText()),h=null,e!=null&&(h=e.getValue(),e.getDisplayType()==n.DisplayType.AmtDimension&&(s=e.getText())),s!=null||h!=null)&&(i={},o=this.mFields[t],i.Name=o.getColumnName(),i.DisplayType=o.getDisplayType(),i.Result=s,i.Result2=h,i.LoadRecursiveData=o.getLoadRecursiveData(),i.ShowChildOfSelected=o.getShowChildOfSelected(),i.AD_Column_ID=o.getAD_Column_ID(),i.Info=f.getDisplay(),f.getDisplayType()==n.DisplayType.MultiKey&&(i.Info=f.lastDisplay),e!=null&&(i.Info_To=e.getDisplay()),y.push(i))}return y};i.prototype.dispose=function(){this.disposeComponent()};n.ProcessParameter=i}(VIS,jQuery),function(n,t){n.Apps=n.Apps||{};n.Apps.TestForm=function(){function y(){r=t("<div class='vis-height-full'>");s=t("<input type='text'>");f=t("<input type='button'>").val(n.Msg.getMsg("OK"));e=t("<input type='button'>").val(n.Msg.getMsg("Close"));o=t('<select style="width:300px;height:30px">');h=t('<div style="width:300px;height:100%;float:left;background-color:gray">');c=t('<div style="width:calc(100% - 400px);height:calc(100% - 35px);float:right;background-color:yellow">');l=t('<div style="width:calc(100% - 300px);height:35px;float:right;background-color:brown">');v=t('<div style="width:calc(100% - 400px);height:calc(100%);position:absolute">');r.append(o).append(l).append(h).append(c);t.ajax({url:n.Application.contextUrl+"home/GetReports",success:function(n){if(n=JSON.parse(n),n)for(var t=0;t<n.length;t++)o.append('<option value="'+n[t].Key+'">'+n[t].Name+"<\/option>")}});o.on("change",function(){a||(a=new n.AWindow);i=a.refreshProcess(o.val(),null,"P",!0,u);i.showCloseIcon(!1);i.setSaveCsvIcons("vis-savecsv-ico-pos");i.setReportFormatIcons("vis-repformat-ico-pos");i.setSavePdfIcons("vis-savepdf-ico-pos");i.setArchiveIcons("vis-archive-ico-pos");i.setRequeryIcons("vis-requery-ico-pos");i.setCustomizeIcons("vis-customize-ico-pos");i.setPrintIcons("vis-print-ico-pos");i.setToolbarColor("white");i.showParameterCloseIcon(!1)})}var r,s,f,e,h,c,l,v,o,a,i,u;this.frame;this.windowNo;i=null;u=this;y();u=this;f.on(n.Events.onTouchStartOrClick,function(){alert("Test From has value :==> "+s.val())});e.on(n.Events.onTouchStartOrClick,function(){confirm("wanna close this form???")&&u.dispose()});this.getRoot=function(){return r};this.getParameterContainer=function(){return h};this.getContentContainer=function(){return c};this.getToolbarContainer=function(){return l};this.getBusyIndicatorContainer=function(){return v};this.disposeComponent=function(){u=null;r&&r.remove();r=null;f&&f.off(n.Events.onTouchStartOrClick);e&&e.off(n.Events.onTouchStartOrClick);s=f=e=null;this.getRoot=null;this.disposeComponent=null}};n.Apps.TestForm.prototype.init=function(n,t){this.frame=t;this.frame.getContentGrid().append(this.getRoot())};n.Apps.TestForm.prototype.sizeChanged=function(){};n.Apps.TestForm.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.TestForm.prototype.show=function(){var t=new n.CFrame;t.setName(n.Msg.getMsg("Tect"));t.setTitle(n.Msg.getMsg("Test"));t.hideHeader(!0);t.setContent(this);t.show()}}(VIS,jQuery),function(n,t){var i=n.Application.contextUrl,f=i+"JsonData/GetGridWindow",e=i+"JsonData/InsertOrUpdateWRecords",o=i+"JsonData/DeleteWRecords",s=i+"JsonData/GetWindowRecords",h=i+"JsonData/GetWindowRecordsForTreeNode",c=i+"JsonData/GetFormInfo",l=i+"JsonData/GetProcessInfo",r=i+"JsonData/Process",a=i+"JsonData/ExecuteProcess",v=i+"JsonData/UpdateOrInsertPersonalLock",y=i+"JsonData/JDataSet",u=i+"JsonData/ExecuteNonQuer",p=i+"JsonData/GetCardViewDetail",w=i+"JsonData/GetLocLatLng",b=function(){function b(n,r){t.ajax({url:i+"JsonData/UpdateCtx",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:JSON.stringify({dCtx:n})}).done(function(n){r&&r(n)})}function k(n,i,r){var u={AD_Window_ID:n,AD_Tab_ID:i};t.ajax({url:p,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:JSON.stringify(u)}).done(function(n){if(r){var t=null;n&&(t=n,typeof n=="string"&&(t=JSON.parse(n)));r(t)}})}function d(n,i){t.ajax({url:f,type:"GET",datatype:"json",async:!0,data:n}).done(function(n){i&&i(n)})}function g(n){var i=null;return t.ajax({url:e,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify(n)}).done(function(n){i=n}),i}function nt(n){var i=null;return t.ajax({url:o,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify(n)}).done(function(n){i=n}),i}function tt(i,r,u,f,e,o){var h={fields:r,sqlIn:i,rowCount:u,sqlCount:f,AD_Table_ID:e};t.ajax({url:s,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:JSON.stringify(h)}).done(function(t){if(o){var i=null;t&&(i=(new n.DB.DataSet).toJson(t));o(i)}})}function it(i,r,u,f,e,o,s,c){var l={fields:r,sqlIn:i,rowCount:u,sqlCount:f,AD_Table_ID:e,treeID:o,treeNodeID:s};t.ajax({url:h,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:JSON.stringify(l)}).done(function(t){if(c){var i=null;t&&(i=(new n.DB.DataSet).toJson(t));c(i)}})}function rt(r,u){var f=null;return t.ajax({url:i+"JsonData/GetWindowRecord",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({sql:r,fields:u})}).done(function(t){t&&(f=(new n.DB.DataReader).toJson(t))}),f}function ut(n,i,r,u){var f=null,e={AD_User_ID:n,AD_Table_ID:i,Record_ID:r,locked:u};return t.ajax({url:v,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify(e)}).done(function(n){f=n}),f}function ft(i,r){var u=null;return i.indexOf(n.Application.contextUrl)==-1&&(i=n.Application.contextUrl+i),t.ajax({url:i,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({fields:r})}).done(function(n){n&&(u=JSON.parse(n))}).fail(function(n,t,i){alert(i)}),u}function et(n,i){t.ajax({url:c,type:"GET",datatype:"json",async:!0,data:n}).done(function(n){i&&i(n)})}function ot(n,i){t.ajax({url:l,type:"GET",datatype:"json",async:!0,data:n}).done(function(n){i&&i(n)})}function st(n,i){var f=i?!0:!1,u=null;return t.ajax({url:r,type:"POST",datatype:"json",async:f,data:n}).done(function(n){u=n;i&&i(n)}),u}function ht(n,i){t.ajax({url:r,type:"GET",datatype:"json",async:!1,data:n}).done(function(n){i&&i(n)})}function ct(n,i){var u=i?!0:!1,r=null;return t.ajax({url:a,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:u,data:JSON.stringify(n)}).done(function(n){r=n;i&&i(n)}),r}function lt(n,i,r){var u=null;return t.ajax({url:y,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function at(n,i,r){var f=null;return t.ajax({url:u+"y",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){f=n;r&&r(n)}),f}function vt(n,i,r){var f=null;return t.ajax({url:u+"ies",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){f=n;r&&r(n)}),f}function yt(n,i,r){var f=r?!0:!1,u=null;return t.ajax({url:n,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:f,data:JSON.stringify(i)}).done(function(n){n&&(u=n,typeof n=="string"&&(u=JSON.parse(n)));f&&r(u)}),u}function pt(i,r){t.ajax({url:n.Application.contextUrl+"Chat/LoadChat",data:i,type:"GET",cache:!1,datatype:"Json",success:function(n){r&&r(n)}})}function wt(i){t.ajax({url:n.Application.contextUrl+"Chat/SaveChat",type:"POST",dataType:"Json",data:i,success:function(n){n?console.log("Chat Saved"):console.log("Chat Not Saved")},error:function(){console.log("Chat Not Saved")}})}function bt(n,r){var u=null,f=r?!0:!1;return t.ajax({url:i+"Tree/GetTreeAsString",async:f,data:n}).done(function(n){u=n;r&&r(n)}),u}function kt(i,r,u,f,e){var o,s;i==0?(o=n.Application.contextUrl+"Subscribe/Subscribe",s={AD_Window_ID:r,Record_ID:u,AD_Table_ID:f}):(o=n.Application.contextUrl+"Subscribe/UnSubscribe",s={AD_Window_ID:r,Record_ID:u,AD_Table_ID:f});t.ajax({url:o,type:"GET",dataType:"Json",data:s,success:function(t){t==0?i==0?n.ADialog.error("SubscriptionFailed"):n.ADialog.error("UnSubscriptionFailed"):t==2&&n.ADialog.info("AlreadyUnsubscribed");e()},error:function(t){n.ADialog.error(n.Msg.getMsg("Error")+t.statusText)}})}return{insertOrUpdateWRecord:g,getWindowJString:d,deleteWRecords:nt,getWindowRecords:tt,getWindowRecordsForTreeNode:it,getWindowRecord:rt,updateInsertLocks:ut,getDataSetJString:lt,getFormDataString:et,getProcessDataString:ot,process:st,processAsyncFalse:ht,executeProcess:ct,updateClientCtx:b,executeQueries:vt,executeQuery:at,getJSONRecord:ft,getJSONData:yt,subscribeUnsubscribeRecords:kt,getChatRecords:pt,saveChat:wt,getTreeAsString:bt,getCardViewInfo:k}}();n.dataContext=b}(VIS,jQuery);VIS.Model=VIS.Model||{},function(n){function t(t){t||(t="CalloutEngine");this.log=n.Logging.VLogger.getVLogger(t)}var i=!1;t.prototype.isCalloutActive=function(){return i};t.prototype.setCalloutActive=function(n){i=n};t.prototype.start=function(t,i,r,u,f,e,o){var c,l,s,h;if(i==null||i.length==0)throw new Error("No Method Name");if(c="",l=i+" - "+f.getColumnName()+"="+e+" (old="+o+") {active="+this.isCalloutActive()+"}",this.isCalloutActive()||this.log.info(l.toString()),s=this[i],s==null&&(i=i.charAt(0).toUpperCase()+i.substr(1),s=this[i],!s))throw new Error("Method not found: "+i);if(h=s.length,!(h==5||h==6))throw new Error("Method "+i+" has invalid no of arguments: "+h);try{c=h==6?this[i](t,r,u,f,e,o):this[i](t,r,u,f,e)}catch(a){this.setCalloutActive(!1);this.log.log(n.Logging.Level.SEVERE,"start: "+i,a);c=a.toString()}return c};t.prototype.DateAcct=function(n,t,i,r,u,f){return this.isCalloutActive()?"":u?(i.setValue("DateAcct",u),i.getTableName()=="C_BankStatementLine"&&i.setValue("ValutaDate",u),this.setCalloutActive(!1),n=t=i=r=u=f=null,""):""};t.prototype.Rate=function(t,i,r,u,f,e){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var s=f,o=n.Env.ZERO;return n.Utility.Util.getValueOfDouble(s)!=0&&(o=(1/s).toFixed(12)),u.getColumnName().toString()=="MultiplyRate"?r.setValue("DivideRate",o):r.setValue("MultiplyRate",o),this.log.info(u.getColumnName()+"="+s+" => "+o),this.setCalloutActive(!1),t=i=r=u=f=e=null,""};n.Model.CalloutEngine=t;n.CalloutEngine=t}(VIS,jQuery),function(n){function k(){n.CalloutEngine.call(this,"VIS.TestClass")}function d(){n.CalloutEngine.call(this,"VIS.CalloutObjectData")}function s(){n.CalloutEngine.call(this,"VIS.CalloutOffer")}function g(){n.CalloutEngine.call(this,"VIS.CalloutCurrency")}function h(){n.CalloutEngine.call(this,"VIS.copyname")}function nt(){n.CalloutEngine.call(this,"VIS.CalloutUserTimeRec")}function c(){n.CalloutEngine.call(this,"VIS.CalloutTimeExpense")}function l(){n.CalloutEngine.call(this,"VIS.CalloutTeamForcast")}function a(){n.CalloutEngine.call(this,"VIS.CalloutTaxAmt")}function tt(){n.CalloutEngine.call(this,"VIS.CalloutTax")}function it(){n.CalloutEngine.call(this,"VIS.CalloutSetBP")}function rt(){n.CalloutEngine.call(this,"VIS.CalloutProductToOpportunity")}function ut(){n.CalloutEngine.call(this,"VIS.CalloutPriceListOpp")}function r(){n.CalloutEngine.call(this,"VIS.CalloutKPI")}function i(){n.CalloutEngine.call(this,"VIS.CalloutDashboard")}function u(){n.CalloutEngine.call(this,"VIS.CalloutDashboardView")}function ft(){n.CalloutEngine.call(this,"VIS.CalloutService")}function v(){n.CalloutEngine.call(this,"VIS.CallOutWorkflow ")}function et(){n.CalloutEngine.call(this,"VIS.CalloutSalesQuotation ")}function ot(){n.CalloutEngine.call(this,"VIS.CalloutSetDate ")}function st(){n.CalloutEngine.call(this,"VIS.CalloutDisplayButton ")}function ht(){n.CalloutEngine.call(this,"VIS.CalloutMoveConfirmLine")}function y(){n.CalloutEngine.call(this,"VIS.CalloutDocumentType")}function ct(){n.CalloutEngine.call(this,"VIS.CalloutProjectCBPartner")}function lt(){n.CalloutEngine.call(this,"VIS.CalloutMCampaign")}function p(){n.CalloutEngine.call(this,"VIS.CalloutMRequest")}function f(){n.CalloutEngine.call(this,"VIS.CalloutModuleMgmt")}function at(){n.CalloutEngine.call(this,"VIS.CalloutPriclistUOM")}function o(){n.CalloutEngine.call(this,"VIS.CalloutTaxAmount")}function vt(){n.CalloutEngine.call(this,"VIS.CalloutProdCatVal")}function yt(){n.CalloutEngine.call(this,"VIS.CalloutProdTypeVal")}function pt(){n.CalloutEngine.call(this,"VIS.CalloutProfitTax")}function wt(){n.CalloutEngine.call(this,"VIS.CalloutBPartner")}function bt(){n.CalloutEngine.call(this,"VIS.CalloutshipLine")}function kt(){n.CalloutEngine.call(this,"VIS.CalloutRecurring")}function dt(){n.CalloutEngine.call(this,"VIS.CalloutProductionLine")}function w(){n.CalloutEngine.call(this,"VIS.CalloutProfitLoss")}function gt(){n.CalloutEngine.call(this,"VIS.CalloutShipReceiptConfirmLine")}function ni(){n.CalloutEngine.call(this,"VIS.CalloutUOMConversion")}function ti(){n.CalloutEngine.call(this,"VIS.CalloutIncoTerm")}function ii(){n.CalloutEngine.call(this,"VIS.CalloutBlanketOrderRef")}function b(n){var t=new Date(n);return t.setMinutes(-t.getTimezoneOffset()+t.getMinutes()),t.toISOString()}function ri(){n.CalloutEngine.call(this,"VIS.CalloutLocatorPC")}function ui(){n.CalloutEngine.call(this,"VIS.CalloutSetDates")}function fi(){n.CalloutEngine.call(this,"VIS.CalloutLandedCost")}var ei=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(k,n.CalloutEngine);k.prototype.set=function(n,t,i,r,u){return i.setValue("Description",u),""};n.Model.TestClass=k;n.Utility.inheritPrototype(d,n.CalloutEngine);d.prototype.Objectchk=function(i,r,u,f,o,s){var y,a,v,c,w,h,p,l;if(o==null||o.toString()==""||o==null||(y=t.getValueOfInt(u.getValue("FO_OBJECT_DATA_ID")),c=t.getValueOfDateTime(u.getValue("TODAYDATE")),y==null))return"";w="select FO_RES_ACCOMODATION_ID,DATE_FROM,TILL_DATE from FO_RES_ACCOMODATION where FO_OBJECT_DATA_ID=@FO_OBJ_DATA_ID";h=null;try{for(p=[],p[0]=new n.DB.SqlParam("@FO_OBJ_DATA_ID",y),h=n.DB.executeReader(w,p,null);h.read();){if((a=t.getValueOfDateTime(h[1]),v=t.getValueOfDateTime(h[2]),l=a,c.compareTo(v)>0)||c.compareTo(a)<0)return u.setValue("RES_STATUS",!1),"";if(c.compareTo(a)>0&&c.compareTo(v)<0)while(!(l.compareTo(v)==0))c.compareTo(l)==0&&u.setValue("RES_STATUS",!0),l=l.AddDays(1)}h.close()}catch(b){this.setCalloutActive(!1);h!=null&&h.close();this.log.severe(e.toString())}finally{h!=null&&h.close()}return i=r=u=f=o=s=null,""};n.Model.CalloutObjectData=d;n.Utility.inheritPrototype(s,n.CalloutEngine);s.prototype.Datechk=function(i,r,u,f,e,o){var c,v,y,p,h,w;if(e==null||e.toString()==""||(c=t.getValueOfDateTime(e),c==null||c==0))return"";var b=u.getValue("AD_ORG_ID"),l=0,k="select  DAYSPAYABLE2 from FO_SETTINGS where AD_ORG_ID="+b,s=null;try{for(s=n.DB.executeReader(k,null,null);s.read();)l=t.getValueOfInt(s[0].toString());s.close()}catch(a){this.setCalloutActive(!1);s!=null&&s.close();this.log.severe(a.toString())}v=t.getValueOfDateTime(u.getValue("DATE1"));y=v.AddDays(l);u.setValue("DATE2",y);h=100;w="select max(OFFERNO)from FO_OFFER";try{for(s=n.DB.executeReader(w,null,null);s.read();)h=t.getValueOfInt(s[0].toString());s.close()}catch(a){this.setCalloutActive(!1);s!=null&&s.close();this.log.severe(a.toString())}finally{s!=null&&s.close()}return p=h==null|h==0?100:h+1,u.setValue("OFFERNO",p),i=r=u=f=e=o=null,""};s.prototype.guestpricelist=function(i,r,u,f,e,o){var h;if(e==null||(h=t.getValueOfInt(e),h==null||h==0))return"";var l="select FO_PRICE_LIST_ID from FO_ADDRESS_PRICE where FO_ADDRESS_ID="+h,c=0,s=null;try{for(s=n.DB.executeReader(l,null,null);s.read();)c=t.getValueOfInt(s[0]);s.close()}catch(a){this.setCalloutActive(!1);s!=null&&s.close();this.log.severe(a.toString())}finally{s!=null&&s.close()}return u.setValue("FO_PRICE_LIST_ID",c),i=r=u=f=e=o=null,""};n.Model.CalloutOffer=s;n.Utility.inheritPrototype(g,n.CalloutEngine);g.prototype.Currency=function(i,r,u,f,e,o){var s,h;if(e==null||e.toString()=="")return"";s="";try{s="select C_Currency_id from m_pricelist where m_pricelist_ID = "+t.getValueOfInt(e);h=t.getValueOfInt(n.DB.executeScalar(s,null,null));u.setValue("C_Currency_ID",h)}catch(c){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};n.Model.CalloutCurrency=g;n.Utility.inheritPrototype(h,n.CalloutEngine);h.prototype.product=function(n,t,i,r,u,f){return i.setValue("Help",i.getValue("Name")),n=t=i=r=u=f=null,""};h.prototype.product2=function(n,t,i,r,u,f){return i.setValue("Description",i.getValue("Help")),n=t=i=r=u=f=null,""};n.Model.copyname=h;n.Utility.inheritPrototype(nt,n.CalloutEngine);nt.prototype.IsInternal=function(i,r,u,f,e,o){if(e==null||e.toString()==""||this.isCalloutActive())return"";try{this.setCalloutActive(!0);var h="select ProfileType from S_Resource where AD_User_ID = "+t.getValueOfInt(e),s=t.getValueOfString(n.DB.executeScalar(h,null,null));s!=""&&(s.toUpper()=="I"?u.setValue("IsInternal",!0):s.toUpper()=="E"&&u.setValue("IsInternal",!1));this.setCalloutActive(!1)}catch(c){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};n.Model.CalloutUserTimeRec=nt;n.Utility.inheritPrototype(c,n.CalloutEngine);c.prototype.Product=function(i,r,u,f,o,s){var p=o,a,w,b,l,y;if(p==null||t.getValueOfInt(p)==0)return"";this.setCalloutActive(!0);var c=null,k=i.getContext(r,"DateExpense"),v=null,h=null;try{for(a=!0,v="SELECT bomPriceStd(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceStd,bomPriceList(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceList,bomPriceLimit(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceLimit,p.C_UOM_ID,pv.ValidFrom,pl.C_Currency_ID FROM M_Product p, M_ProductPrice pp, M_PriceList pl, M_PriceList_Version pv WHERE p.M_Product_ID=pp.M_Product_ID AND pp.M_PriceList_Version_ID=pv.M_PriceList_Version_ID AND pv.M_PriceList_ID=pl.M_PriceList_ID AND pv.IsActive='Y' AND p.M_Product_ID=@param1 AND pl.M_PriceList_ID=@param2 ORDER BY pv.ValidFrom DESC",w=[],w[0]=new n.DB.SqlParam("@param1",t.getValueOfInt(p)),w[1]=new n.DB.SqlParam("@param2",i.getContextAsInt(r,"M_PriceList_ID")),h=n.DB.executeReader(v,w,null);h.read()&&a;)l=h.get("validfrom"),l!=null&&k<l||(a=!1,c=t.getValueOfDecimal(h.get("pricestd")),c==null&&(c=t.getValueOfDecimal(h.get("pricelist"))),c==null&&(c=t.getValueOfDecimal(h.get("pricelimit"))),y=t.getValueOfInt(h.get("c_currency_id")),h==null||u.setValue("C_Currency_ID",y));if(h.close(),a){for(v="SELECT bomPriceStd(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceStd,bomPriceList(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceList,bomPriceLimit(p.M_Product_ID,pv.M_PriceList_Version_ID) AS PriceLimit,p.C_UOM_ID,pv.ValidFrom,pl.C_Currency_ID FROM M_Product p, M_ProductPrice pp, M_PriceList pl, M_PriceList bpl, M_PriceList_Version pv WHERE p.M_Product_ID=pp.M_Product_ID AND pp.M_PriceList_Version_ID=pv.M_PriceList_Version_ID AND pv.M_PriceList_ID=bpl.M_PriceList_ID AND pv.IsActive='Y' AND bpl.M_PriceList_ID=pl.BasePriceList_ID AND p.M_Product_ID=@param1 AND pl.M_PriceList_ID=@param2 ORDER BY pv.ValidFrom DESC",b=[],b[0]=new n.DB.SqlParam("@param1",t.getValueOfInt(p)),b[1]=new n.DB.SqlParam("@param2",i.getContextAsInt(r,"M_PriceList_ID")),h=n.DB.executeReader(v,b,null);h.read()&&a;)l=h.get("validfrom"),l!=null&&k<l||(a=!1,c=t.getValueOfDecimal(h.get("pricestd")),c==null&&(c=t.getValueOfDecimal(h.get("pricelist"))),c==null&&(c=t.getValueOfDecimal(h.get("pricelimit"))),y=t.getValueOfInt(h.get("c_currency_id")),h==null||u.setValue("C_Currency_ID",y));h.close()}}catch(d){return h!=null&&h.close(),this.log.log(ei.SEVERE,v,d),this.setCalloutActive(!1),e.message}return this.setCalloutActive(!1),c==null&&(c=n.Env.ZERO),u.setValue("ExpenseAmt",c),i=r=u=f=o=s=null,""};c.prototype.Amount=function(i,r,u,f,e,o){var s;if(this.isCalloutActive())return"";this.setCalloutActive(!0);var c=u.getValue("ExpenseAmt"),h=u.getValue("C_Currency_ID"),l=i.getContextAsInt(r,"$C_Currency_ID"),p=i.getContext(r,"DateExpense");if(this.log.fine("Amt="+c+", C_Currency_ID="+h),s=c.toString(),!s.equals(n.Env.ZERO)&&l!=t.getValueOfInt(h)){var a=i.getContextAsInt(r,"AD_Client_ID"),v=i.getContextAsInt(r,"AD_Org_ID"),y=s.toString()+","+h.toString()+","+l.toString()+","+a.toString()+","+v.toString();s=n.dataContext.getJSONRecord("MConversionRate/Convert",y)}return u.setValue("ConvertedAmt",s),this.log.fine("= ConvertedAmt="+s),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutTimeExpense=c;n.Utility.inheritPrototype(l,n.CalloutEngine);l.prototype.ProductInfo=function(i,r,u,f,e,o){var c,l,s,a,h;return e==null||e.toString()==""||t.getValueOfInt(e)==0?"":(c=e,c==null||c==0)?"":(l=i.getContextAsInt(r,"M_PriceList_ID"),l!=0?(s="Select M_PriceList_Version_ID from M_ProductPrice where M_Product_id="+t.getValueOfInt(e)+" and M_PriceList_Version_ID in (select m_pricelist_version_id from m_pricelist_version where m_pricelist_id = "+l+" and isactive='Y')",a=t.getValueOfInt(n.DB.executeScalar(s,null,null)),a!=0&&(s="Select PriceStd from M_ProductPrice where M_PriceList_Version_ID="+a+" and M_Product_id="+t.getValueOfInt(e),h=t.getValueOfDecimal(n.DB.executeScalar(s,null,null)),u.setValue("PriceStd",h),u.setValue("UnitPrice",h),u.setValue("PriceStd",h*t.getValueOfDecimal(u.getValue("QtyEntered"))))):n.ADialog.info("PriceLisetNotFound"),i=r=u=f=e=o=null,"")};l.prototype.CalculatePrice=function(n,i,r,u,f,e){if(f==null||f.toString()==""||t.getValueOfInt(f)<=0)return"";var o=t.getValueOfDecimal(r.getValue("UnitPrice"))*t.getValueOfDecimal(r.getValue("QtyEntered"));return r.setValue("PriceStd",o),n=i=r=u=f=e=null,""};n.Model.CalloutTeamForcast=l;n.Utility.inheritPrototype(a,n.CalloutEngine);a.prototype.TaxID=function(i,r,u,f,e,o){var c,h,s;if(e==null||e.toString()==""||t.getValueOfInt(e)==0||this.isCalloutActive())return"";try{this.setCalloutActive(!0);c="select Rate from C_Tax where C_Tax_ID = "+t.getValueOfInt(e);h=t.getValueOfDecimal(n.DB.executeScalar(c,null,null));h!=0?(s=t.getValueOfDecimal(u.getValue("ApprovedExpenseAmt"))*h/100,s=s.toFixed(2),u.setValue("TaxAmt",s)):u.setValue("TaxAmt",n.Env.ZERO);this.setCalloutActive(!1)}catch(l){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};a.prototype.ExpenseAmt=function(i,r,u,f,e,o){var c,h,s;if(e==null||e.toString()==""||t.getValueOfInt(e)==0||this.isCalloutActive())return"";try{this.setCalloutActive(!0);c="select Rate from C_Tax where C_Tax_ID = "+t.getValueOfInt(u.getValue("C_Tax_ID"));h=t.getValueOfDecimal(n.DB.executeScalar(c,null,null));h!=0?(s=t.getValueOfDecimal(e)*h/100,s=s.toFixed(2),u.setValue("TaxAmt",s)):u.setValue("TaxAmt",n.Env.ZERO);this.setCalloutActive(!1)}catch(l){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};n.Model.CalloutTaxAmt=a;n.Utility.inheritPrototype(tt,n.CalloutEngine);tt.prototype.Tax=function(i,r,u,f,e,o){var h;if(e==null||e.toString()=="")return"";var c=0,l=n.Env.ZERO,s=n.Env.ZERO;return c=t.getValueOfInt(u.getValue("C_Tax_ID")),l=n.dataContext.getJSONRecord("MTax/GetTaxRate",c.toString()),h=t.getValueOfDecimal(u.getValue("LineNetAmt")),s=t.getValueOfDecimal(h*l/100),s=t.getValueOfDecimal(s.toFixed(2)),u.setValue("GrandTotal",s+h),u.setValue("taxamt",s),i=r=u=f=e=o=null,""};n.Model.CalloutTax=tt;n.Utility.inheritPrototype(it,n.CalloutEngine);it.prototype.SetBP=function(n,i,r,u,f,e){if(f==null||f.toString()==""||t.getValueOfInt(f)==0||this.isCalloutActive())return"";try{this.setCalloutActive(!0);r.setValue("C_BPartner_ID",t.getValueOfInt(f));this.setCalloutActive(!1)}catch(o){this.setCalloutActive(!1)}return n=i=r=u=f=e=null,""};n.Model.CalloutSetBP=it;n.Utility.inheritPrototype(rt,n.CalloutEngine);rt.prototype.ProductInfo=function(i,r,u,f,e,o){var h,c,a,l;if(e==null||e.toString()=="")return"";var v=t.getValueOfInt(u.getValue("C_ProjectTask_ID")),y=t.getValueOfInt(u.getValue("C_ProjectPhase_ID")),p=t.getValueOfInt(u.getValue("C_Project_ID")),w=t.getValueOfInt(u.getValue("M_Product_ID")),b=v.toString()+","+y.toString()+","+p.toString()+","+w.toString(),s=n.dataContext.getJSONRecord("MProject/GetProjectDetail",b);if(s!=null){h=t.getValueOfDecimal(s.PriceList);u.setValue("PriceList",h);c=t.getValueOfDecimal(s.PriceStd);u.setValue("PlannedPrice",c);u.setValue("PlannedQty",1);a=t.getValueOfDecimal(s.PriceLimit);try{if(l=(h-c)*100/h,isNaN(l))return this.setCalloutActive(!1),n.Msg.getMsg("PriceNotDefined")}catch(k){return this.setCalloutActive(!1),"PriceListNotSelected"}u.setValue("Discount",l.toFixed(2));u.setValue("PlannedMarginAmt",c-a)}return i=r=u=f=e=o=null,""};n.Model.CalloutProductToOpportunity=rt;n.Utility.inheritPrototype(ut,n.CalloutEngine);ut.prototype.PriceList=function(i,r,u,f,e,o){var s,h,c;if(e==null||e.toString()=="")return"";s="";try{s="select M_PriceList_ID from M_PriceList_Version where M_PriceList_Version_ID = "+t.getValueOfInt(e);h=t.getValueOfInt(n.DB.executeScalar(s,null,null));h!=0&&(u.setValue("M_PriceList_ID",h),s="select C_Currency_id from m_pricelist where m_pricelist_ID = "+h,c=t.getValueOfInt(n.DB.executeScalar(s,null,null)),c!=0?u.setValue("C_Currency_ID",c):n.ADialog.info("CurrencyNotDefinedForThePriceList"))}catch(l){this.setCalloutActive(!1);this.log.saveError(s,s)}return i=r=u=f=e=o=null,""};n.Model.CalloutPriceListOpp=ut;n.Utility.inheritPrototype(r,n.CalloutEngine);r.prototype.CalculationSelection=function(n,t,i,r,u){return this.isCalloutActive()||u==null||u.toString()==""||u==!1?"":(this.setCalloutActive(!0),r.getColumnName()=="IsSum"?(i.setValue("IsMaximum",!1),i.setValue("IsCount",!1),i.setValue("IsMinimum",!1)):r.getColumnName()=="IsMaximum"?(i.setValue("IsSum",!1),i.setValue("IsMinimum",!1),i.setValue("IsCount",!1)):r.getColumnName()=="IsCount"?(i.setValue("IsMaximum",!1),i.setValue("IsSum",!1),i.setValue("IsMinimum",!1)):r.getColumnName()=="IsMinimum"&&(i.setValue("IsSum",!1),i.setValue("IsCount",!1),i.setValue("IsMaximum",!1)),this.setCalloutActive(!1),"")};r.prototype.UpdateKPITableInContext=function(n,t,i,r,u){return this.isCalloutActive()||u==null||u.toString()==""?"":(this.setCalloutActive(!0),u==!0?(i.setValue("AD_Table_ID",-1),i.setValue("AD_Tab_ID",-1),n.setContext(t,"AD_Table_ID",-1),n.setContext(t,"AD_Tab_ID",-1)):(i.setValue("TableView_ID",-1),n.setContext(t,"TableView_ID",-1)),this.setCalloutActive(!1),"")};r.prototype.UpdateTabIDContext=function(n,t,i,r,u){return this.isCalloutActive()?"":(this.setCalloutActive(!0),u<1||u==null||u.toString()==""?(i.setValue("AD_Tab_ID",-1),n.setContext(t,"AD_Tab_ID",-1)):n.setContext(t,"AD_Tab_ID",u),this.setCalloutActive(!1),"")};n.Model.CalloutKPI=r;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.UpdateTableInContext=function(n,t,i,r,u){return this.isCalloutActive()?"":(this.setCalloutActive(!0),u==!0?(i.setValue("AD_Table_ID",-1),i.setValue("AD_Tab_ID",-1),n.setContext(t,"AD_Table_ID",-1),n.setContext(t,"AD_Tab_ID",-1)):(i.setValue("TableView_ID",-1),n.setContext(t,"TableView_ID",-1)),this.setCalloutActive(!1),"")};i.prototype.UpdateTabIDContext=function(n,t,i,r,u){return this.isCalloutActive()?"":(this.setCalloutActive(!0),u<1||u==null||u.toString()==""?(i.setValue("AD_Tab_ID",-1),n.setContext(t,"AD_Tab_ID",-1)):(n.setContext(t,"AD_Tab_ID",u),i.setValue("TableView_ID",-1),n.setContext(t,"TableView_ID",-1)),this.setCalloutActive(!1),"")};i.prototype.UpdateTableViewIDOnTableContext=function(n,t,i,r,u){return this.isCalloutActive()||u==null||u.toString()==""?"":(this.setCalloutActive(!0),u>0&&(i.setValue("TableView_ID",-1),n.setContext(t,"TableView_ID",-1)),this.setCalloutActive(!1),"")};i.prototype.SelectFunctionOnDashboard=function(n,i,r,u,f){if(this.isCalloutActive()||f==null||f.toString()==""||f==!1)return"";this.setCalloutActive(!0);var e=t.getValueOfBoolean(f);return u.getColumnName()=="IsSum"?(r.setValue("IsAvg",!1),r.setValue("IsCount",!1),r.setValue("IsNone",!1)):u.getColumnName()=="IsAvg"?(r.setValue("IsSum",!1),r.setValue("IsCount",!1),r.setValue("IsNone",!1)):u.getColumnName()=="IsCount"?(r.setValue("IsSum",!1),r.setValue("IsAvg",!1),r.setValue("IsNone",!1)):u.getColumnName()=="IsNone"&&(r.setValue("IsSum",!1),r.setValue("IsCount",!1),r.setValue("IsAvg",!1)),this.setCalloutActive(!1),""};i.prototype.ValueCheck=function(n,t,i,r,u,f){if(this.isCalloutActive())return"";this.setCalloutActive(!0);var e=i.getValue("LastNValue");return e>60&&i.setValue("LastNValue",1),this.setCalloutActive(!1),n=t=i=r=u=f=null,""};n.Model.CalloutDashboard=i;n.Utility.inheritPrototype(u,n.CalloutEngine);u.prototype.UpdateTabIDContext=function(n,t,i,r,u){return this.isCalloutActive()?"":(this.setCalloutActive(!0),u<1||u==null||u.toString()==""?(i.setValue("AD_Tab_ID",-1),n.setContext(t,"AD_Tab_ID",-1)):n.setContext(t,"AD_Tab_ID",u),this.setCalloutActive(!1),"")};u.prototype.GroupByChecked=function(t,i,r,u,f){if(this.isCalloutActive()||f==null)return"";this.setCalloutActive(!0);var e="UPDATE RC_ViewColumn SET IsGroupBy='N' WHERE RC_View_ID="+r.getValue("RC_View_ID")+" AND RC_ViewColumn_ID NOT IN("+r.getValue("RC_ViewColumn_ID")+")",o=n.DB.executeQuery(e);return this.setCalloutActive(!1),""};u.prototype.IsViewChecked=function(n,t,i,r,u){return this.isCalloutActive()||u==null?"":(this.setCalloutActive(!0),u?(i.setValue("AD_Tab_ID",-1),i.setValue("AD_Table_ID",-1),n.setContext(t,"AD_Tab_ID",-1),n.setContext(t,"AD_Table_ID",-1)):(i.setValue("TableView_ID",-1),n.setContext(t,"TableView_ID",-1)),this.setCalloutActive(!1),"")};n.Model.CalloutDashboardView=u;n.Utility.inheritPrototype(ft,n.CalloutEngine);ft.prototype.StatisticGroup=function(n,t,i,r,u){return u==null||u.toString()==""?"":(i.setValue("FO_STATISTICSUBGROUP_ID",0),"")};n.Model.CalloutService=ft;n.Utility.inheritPrototype(v,n.CalloutEngine);v.prototype.WorkflowType=function(i,r,u,f,e){var s,o;if(e==null||e.toString()=="")return"";if(this.setCalloutActive(!0),s=t.getValueOfString(e.toString()),s=="R"){if(o=t.getValueOfInt(n.DB.executeScalar("SELECT AD_Table_ID FROM AD_Table WHERE IsActive='Y' AND TableName= 'VADMS_MetaData'")),o==0)return n.ADialog.info("No_VADMS",null,"",""),n.Msg.getMsg("No_VADMS");u.setValue("AD_Table_ID",o)}return this.setCalloutActive(!1),""};v.prototype.SetSelectedColumn=function(i,r,u,f,e){return e==null||e.toString()==""?"":(this.setCalloutActive(!0),t.getValueOfString(n.DB.executeScalar("SELECT ColumnName FROM AD_Column WHERE AD_Column_ID="+e)).toLower()=="C_GenAttributeSetInstance_ID".toLower()?i.setContext(r,"IsGenericAttribute","Y"):i.setContext(r,"IsGenericAttribute","N"),this.setCalloutActive(!1),"")};n.Model.CallOutWorkflow=v;n.Utility.inheritPrototype(et,n.CalloutEngine);et.prototype.GetPaymentNote=function(i,r,u,f,e){if(e==null||e.toString()==""||e==""||this.isCalloutActive())return"";this.setCalloutActive(!0);var o=t.getValueOfString(n.DB.executeScalar("select documentnote from c_paymentterm where c_paymentterm_id="+e));return o!=null&&u.setValue("description",o),this.setCalloutActive(!1),""};n.Model.CalloutSalesQuotation=et;n.Utility.inheritPrototype(ot,n.CalloutEngine);ot.prototype.SetDate=function(i,r,u,f,e,o){var h,s,c;if(e==null||e.toString()=="")return"";if(u.getValue("StartDate")==null||u.getValue("NoofCycle")==null)return this.setCalloutActive(!1),"";try{this.setCalloutActive(!0);h="";h=n.dataContext.getJSONRecord("MOrderLine/GetNoOfMonths",t.getValueOfString(u.getValue("C_Frequency_ID")));s=new Date(u.getValue("StartDate"));c=s.setMonth(s.getMonth()+h*t.getValueOfInt(u.getValue("NoofCycle")));c=new Date(s.setDate(s.getDate()-1));u.setValue("EndDate",c.toISOString());i=r=u=f=e=o=null;this.setCalloutActive(!1)}catch(l){}return""};n.Model.CalloutSetDate=ot;n.Utility.inheritPrototype(st,n.CalloutEngine);st.prototype.DisplayButton=function(i,r,u,f,e){if(e==null||e.toString()=="")return"";if(t.getValueOfInt(u.getValue("C_DocTypeTarget_ID"))!=0){var s="select dc.DocSubTypeSO from c_doctype dc inner join c_docbasetype db on(dc.DocBaseType=db.DocBaseType)where c_doctype_id="+t.getValueOfInt(u.getValue("C_DocTypeTarget_ID"))+" and db.DocBaseType='SOO' and dc.DocSubTypeSO in ('WR','WI')",o=t.getValueOfString(n.DB.executeScalar(s,null,null));o=="WR"||o=="WI"?u.setValue("InvoicePrint","Y"):u.setValue("InvoicePrint","N")}else return this.setCalloutActive(!1),"";return this.setCalloutActive(!1),""};n.Model.CalloutDisplayButton=st;n.Utility.inheritPrototype(ht,n.CalloutEngine);ht.prototype.SetQty=function(n,i,r,u,f){if(this.isCalloutActive()||f==null||f.toString()=="")return"";if(this.setCalloutActive(!0),t.getValueOfDecimal(r.getValue("TargetQty"))<t.getValueOfDecimal(r.getValue("ConfirmedQty")))return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";if(u.getColumnName()=="ConfirmedQty"){if(t.getValueOfDecimal(r.getValue("ConfirmedQty"))<0)return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";r.setValue("ScrappedQty",0);r.setValue("DifferenceQty",t.getValueOfDecimal(r.getValue("TargetQty"))-(t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("ScrappedQty"))))}else if(u.getColumnName()=="DifferenceQty"){if(t.getValueOfDecimal(r.getValue("TargetQty"))<t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("DifferenceQty")))return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";r.setValue("ScrappedQty",t.getValueOfDecimal(r.getValue("TargetQty"))-(t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("DifferenceQty"))))}else if(u.getColumnName()=="ScrappedQty"){if(t.getValueOfDecimal(r.getValue("ScrappedQty"))<0||t.getValueOfDecimal(r.getValue("TargetQty"))<t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("ScrappedQty")))return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";r.setValue("DifferenceQty",t.getValueOfDecimal(r.getValue("TargetQty"))-(t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("ScrappedQty"))))}return this.setCalloutActive(!1),""};n.Model.CalloutMoveConfirmLine=ht;n.Utility.inheritPrototype(y,n.CalloutEngine);y.prototype.SetSalesQuotation=function(n,i,r,u,f){if(this.isCalloutActive()||f==null||f.toString()=="")return"";try{this.setCalloutActive(!0);t.getValueOfString(r.getValue("DocSubTypeSO"))=="OB"||t.getValueOfString(r.getValue("DocSubTypeSO"))=="ON"?r.setValue("IsSalesQuotation",!0):r.setValue("IsSalesQuotation",!1)}catch(e){return this.setCalloutActive(!1),e}return this.setCalloutActive(!1),""};y.prototype.Organization=function(t,i,r,u,f){var o,e;if(this.isCalloutActive()||f==null||f.toString()=="")return"";try{this.setCalloutActive(!0);o="";r.getField("M_Warehouse_ID")!=null&&(e=n.dataContext.getJSONRecord("MDocType/GetWarehouse",f.toString()),e>0&&(r.getTableName()=="M_Movement"&&r.getField("DTD001_MWarehouseSource_ID")!=null?r.setValue("DTD001_MWarehouseSource_ID",e):r.setValue("M_Warehouse_ID",e)))}catch(s){return this.setCalloutActive(!1),s}return this.setCalloutActive(!1),""};n.Model.CalloutDocumentType=y;n.Utility.inheritPrototype(ct,n.CalloutEngine);ct.prototype.SetAddress=function(i,r,u,f,e){var o,s,h;if(this.isCalloutActive()||e==null||e.toString()=="")return"";try{this.setCalloutActive(!0);f.getColumnName()=="C_BPartner_ID"?(u.getField("Ref_BPartner_ID")!=null&&u.setValue("Ref_BPartner_ID",e),o=null,o=n.dataContext.getJSONRecord("MBPartner/GetBPData",t.getValueOfString(u.getValue("C_BPartner_ID"))),o!=null&&(s=n.Utility.Util.getValueOfInt(o.C_BPartner_Location_ID),s==0?u.setValue("C_BPartner_Location_ID",null):u.setValue("C_BPartner_Location_ID",s),h=n.Utility.Util.getValueOfInt(o.AD_User_ID),h==0?u.setValue("AD_User_ID",null):u.setValue("AD_User_ID",h))):f.getColumnName()=="C_BPartnerSR_ID"&&(u.getField("Ref_BPartner_ID")!=null&&u.setValue("Ref_BPartner_ID",e),o=null,o=n.dataContext.getJSONRecord("MBPartner/GetBPData",t.getValueOfString(u.getValue("C_BPartnerSR_ID"))),o!=null&&(s=n.Utility.Util.getValueOfInt(o.C_BPartner_Location_ID),s==0?u.setValue("C_BPartner_Location_ID",null):u.setValue("C_BPartner_Location_ID",s),h=n.Utility.Util.getValueOfInt(o.AD_User_ID),h==0?u.setValue("AD_User_ID",null):u.setValue("AD_User_ID",h)))}catch(c){return this.setCalloutActive(!1),c}return this.setCalloutActive(!1),""};n.Model.CalloutProjectCBPartner=ct;n.Utility.inheritPrototype(lt,n.CalloutEngine);lt.prototype.DateRequired=function(t,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);try{var s,o;s=new Date(r.getValue("DateContract"));o=new Date(r.getValue("DateFinish"));o.toISOString()<s.toISOString()&&(r.setValue("DateFinish",""),this.setCalloutActive(!1),n.ADialog.info("DateInvalid",null,"",""));this.log.fine("DateFinish="+o)}catch(h){return n.ADialog.info("DateError"+h,null,"",""),this.setCalloutActive(!1),h}return this.setCalloutActive(!1),t=i=r=u=f=e=null,""};n.Model.CalloutMCampaign=lt;n.Utility.inheritPrototype(p,n.CalloutEngine);p.prototype.DateRequired=function(t,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);try{var s,o;s=new Date(r.getValue("StartDate"));o=new Date(r.getValue("CloseDate"));o.toISOString()<s.toISOString()&&(r.setValue("CloseDate",""),this.setCalloutActive(!1),n.ADialog.info("CloseDateInvalid",null,"",""));this.log.fine("CloseDate="+o)}catch(h){return n.ADialog.info("error in Date"+h,null,"",""),this.setCalloutActive(!1),h}return this.setCalloutActive(!1),t=i=r=u=f=e=null,""};p.prototype.PlanDateRequired=function(t,i,r,u,f,e){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);try{var s,o;s=new Date(r.getValue("DateStartPlan"));o=new Date(r.getValue("DateCompletePlan"));o.toISOString()<s.toISOString()&&(r.setValue("DateCompletePlan",""),this.setCalloutActive(!1),n.ADialog.info("CmpDateInvalid",null,"",""));this.log.fine("DateCompletePlan="+o)}catch(h){return n.ADialog.info("error in Date"+h,null,"",""),this.setCalloutActive(!1),h}return this.setCalloutActive(!1),t=i=r=u=f=e=null,""};n.Model.CalloutMRequest=p;n.Utility.inheritPrototype(f,n.CalloutEngine);f.prototype.GenerateMenuItemExportID=function(n,t,i,r,u){var f,e,o;return u==null||u.toString()==""?"":(f=n.getContext(t,"Prefix"),i.getValue("MenuItemExport_ID")==null&&i.getValue("IsMenuItem").toString()=="true"&&(e=new Date,o=f+e.getTime(),i.setValue("MenuItemExport_ID",o)),this.setCalloutActive(!1),"")};f.prototype.GenerateVersionID=function(n,t,i,r,u){if(u==null||u.toString()=="")return"";var f=n.getContext(t,"VersionNo"),e=f.replace(".","");return i.setValue("VersionID",e),this.setCalloutActive(!1),""};f.prototype.CheckBoxValidation=function(n,i,r,u,f){var o,e;return f==null||f.toString()==""?"":(o=t.getValueOfBoolean(f),o==!0&&(e=u.getColumnName(),e=="IsProfessionalFree"?(r.setValue("IsProfessionalPaid",!1),r.setValue("IsFree",!1),r.setValue("IsPaid",!1)):e=="IsProfessionalPaid"?(r.setValue("IsProfessionalFree",!1),r.setValue("IsFree",!1),r.setValue("IsPaid",!1)):e=="IsFree"?(r.setValue("IsProfessionalPaid",!1),r.setValue("IsProfessionalFree",!1),r.setValue("IsPaid",!1)):e=="IsPaid"&&(r.setValue("IsProfessionalPaid",!1),r.setValue("IsFree",!1),r.setValue("IsProfessionalFree",!1))),this.setCalloutActive(!1),"")};n.Model.CalloutModuleMgmt=f;n.Utility.inheritPrototype(at,n.CalloutEngine);at.prototype.SetUOM=function(i,r,u,f,e,o){if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);u.getField("M_AttributeSetInstance_ID")!=null&&u.setValue("M_AttributeSetInstance_ID",null);try{if(t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_' "))>0){var s=t.getValueOfInt(e),h=t.getValueOfInt(n.DB.executeScalar("SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_PRoduct_ID = "+s));u.setValue("C_UOM_ID",h)}}catch(c){this.setCalloutActive(!1);this.log.severe(c.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutPriclistUOM=at;n.Utility.inheritPrototype(o,n.CalloutEngine);o.prototype.PaymentTaxAmount=function(i,r,u,f,e,o){var s,h;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{if(f.getColumnName()=="C_Tax_ID")if(t.getValueOfDecimal(u.getValue("PayAmt"))>0)if(s=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(e)+" AND IsActive='Y'")),s>0)h=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("PayAmt"))-t.getValueOfDecimal(u.getValue("PayAmt"))/(s/100+1)),u.setValue("TaxAmount",h);else return u.setValue("TaxAmount",0),this.setCalloutActive(!1),"";else return this.setCalloutActive(!1),"";else if(t.getValueOfInt(u.getValue("C_Tax_ID"))>0)if(s=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(u.getValue("C_Tax_ID"))+" AND IsActive='Y'")),s>0)h=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("PayAmt"))-t.getValueOfDecimal(u.getValue("PayAmt"))/(s/100+1)),u.setValue("TaxAmount",h);else return u.setValue("TaxAmount",0),this.setCalloutActive(!1),"";else return this.setCalloutActive(!1),""}catch(c){this.setCalloutActive(!1);this.log.severe(c.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};o.prototype.CashLineTaxAmount=function(i,r,u,f,e,o){var s,h;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{if(f.getColumnName()=="C_Tax_ID")if(t.getValueOfDecimal(u.getValue("Amount"))!=0)if(s=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(e)+" AND IsActive='Y'")),s>0)h=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("Amount"))-t.getValueOfDecimal(u.getValue("Amount"))/(s/100+1)),u.setValue("TaxAmt",h);else return u.setValue("TaxAmt",0),this.setCalloutActive(!1),"";else return this.setCalloutActive(!1),"";else if(t.getValueOfInt(u.getValue("C_Tax_ID"))>0)if(s=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(u.getValue("C_Tax_ID"))+" AND IsActive='Y'")),s>0)h=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("Amount"))-t.getValueOfDecimal(u.getValue("Amount"))/(s/100+1)),u.setValue("TaxAmt",h);else return u.setValue("TaxAmt",0),this.setCalloutActive(!1),"";else return this.setCalloutActive(!1),""}catch(c){this.setCalloutActive(!1);this.log.severe(c.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};o.prototype.BankStatementLineTaxAmount=function(i,r,u,f,e,o){var c,h,s,l,a;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);c="";try{if(f.getColumnName()=="C_Tax_ID")if(t.getValueOfDecimal(u.getValue("ChargeAmt"))!=0)if(h=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(e)+" AND IsActive='Y'")),h>0)s=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("ChargeAmt"))-t.getValueOfDecimal(u.getValue("ChargeAmt"))/(h/100+1)),c=u.getValue("C_Currency_ID").toString(),l=n.dataContext.getJSONRecord("MCurrency/GetCurrency",c),a=l.StdPrecision,s=t.getValueOfDecimal(s.toFixed(a)),u.setValue("TaxAmt",s);else return u.setValue("TaxAmt",0),this.setCalloutActive(!1),i=r=u=f=e=o=null,"";else return this.setCalloutActive(!1),i=r=u=f=e=o=null,"";else if(t.getValueOfInt(u.getValue("C_Tax_ID"))>0)if(h=t.getValueOfDecimal(n.DB.executeScalar("Select Rate From C_Tax Where C_Tax_ID="+t.getValueOfInt(u.getValue("C_Tax_ID"))+" AND IsActive='Y'")),h>0)s=t.getValueOfDecimal(t.getValueOfDecimal(u.getValue("ChargeAmt"))-t.getValueOfDecimal(u.getValue("ChargeAmt"))/(h/100+1)),c=u.getValue("C_Currency_ID").toString(),l=n.dataContext.getJSONRecord("MCurrency/GetCurrency",c),a=l.StdPrecision,s=t.getValueOfDecimal(s.toFixed(a)),u.setValue("TaxAmt",s);else return u.setValue("TaxAmt",0),this.setCalloutActive(!1),i=r=u=f=e=o=null,"";else return this.setCalloutActive(!1),i=r=u=f=e=o=null,""}catch(v){this.setCalloutActive(!1);this.log.severe(v.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutTaxAmount=o;n.Utility.inheritPrototype(vt,n.CalloutEngine);vt.prototype.SetProdCatValues=function(i,r,u,f,e,o){var s,l,a;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{var h="SELECT IsActive ",v=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA038_' ")),c=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='DTD001_' "));c>0&&(h+=" , producttype ");c>0&&(h+=" , m_attributeset_id, c_taxcategory_id ");h+=" FROM M_Product_Category WHERE m_product_category_id="+t.getValueOfInt(e);s=n.DB.executeDataSet(h);s!=null&&s.tables[0].rows.length>0&&(t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='DTD001_' "))>0&&(s.tables[0].rows[0].cells.producttype!=null||t.getValueOfString(s.tables[0].rows[0].cells.producttype)!=""?u.setValue("PRODUCTTYPE",s.tables[0].rows[0].cells.producttype):u.setValue("PRODUCTTYPE","")),c>0&&(s.tables[0].rows[0].cells.m_attributeset_id!=null||t.getValueOfString(s.tables[0].rows[0].cells.m_attributeset_id)!=""?u.setValue("M_AttributeSet_ID",t.getValueOfInt(s.tables[0].rows[0].cells.m_attributeset_id)):u.setValue("M_AttributeSet_ID",0),s.tables[0].rows[0].cells.c_taxcategory_id!=null||t.getValueOfString(s.tables[0].rows[0].cells.c_taxcategory_id)!=""?u.setValue("C_TaxCategory_ID",t.getValueOfInt(s.tables[0].rows[0].cells.c_taxcategory_id)):u.setValue("C_TaxCategory_ID",0)));v>0&&(t.getValueOfString(s.tables[0].rows[0].cells.producttype)=="E"||t.getValueOfString(s.tables[0].rows[0].cells.producttype)=="S"?(l=t.getValueOfInt(n.DB.executeScalar("SELECT A_Asset_Group_ID FROM M_Product_Category WHERE M_Product_Category_ID="+t.getValueOfInt(e))),l>0?(a=t.getValueOfInt(n.DB.executeScalar("SELECT VA038_AmortizationTemplate_ID FROM A_Asset_Group WHERE A_Asset_Group_ID="+l)),a>0?u.setValue("VA038_AmortizationTemplate_ID",a):u.setValue("VA038_AmortizationTemplate_ID",0)):u.setValue("VA038_AmortizationTemplate_ID",0)):u.setValue("VA038_AmortizationTemplate_ID",0))}catch(y){this.setCalloutActive(!1);this.log.severe(y.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutProdCatVal=vt;n.Utility.inheritPrototype(yt,n.CalloutEngine);yt.prototype.SetProdTypeValues=function(i,r,u,f,e,o){var c,s,h;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{c=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA038_' "));c>0&&(t.getValueOfString(result.tables[0].rows[0].cells.producttype)=="E"||t.getValueOfString(result.tables[0].rows[0].cells.producttype)=="S"?(s=t.getValueOfInt(n.DB.executeScalar("SELECT A_Asset_Group_ID FROM M_Product_Category WHERE M_Product_Category_ID="+t.getValueOfInt(e))),s>0?(h=t.getValueOfInt(n.DB.executeScalar("SELECT VA038_AmortizationTemplate_ID FROM A_Asset_Group WHERE A_Asset_Group_ID="+s)),h>0?u.setValue("VA038_AmortizationTemplate_ID",h):u.setValue("VA038_AmortizationTemplate_ID",0)):u.setValue("VA038_AmortizationTemplate_ID",0)):u.setValue("VA038_AmortizationTemplate_ID",0))}catch(l){this.setCalloutActive(!1);this.log.severe(l.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutProdTypeVal=yt;n.Utility.inheritPrototype(pt,n.CalloutEngine);pt.prototype.SetProfitBeforeTax=function(i,r,u,f,e,o){if(e==null||e.toString()==""||this.isCalloutActive()||e==null)return"";this.setCalloutActive(!0);try{var h=0,c=0,l=0,s=null;s=n.DB.executeDataSet("SELECT ProfitBeforeTax,C_Year_ID,C_ProfitAndLoss_ID FROM C_ProfitLoss WHERE C_ProfitLoss_ID="+e,null,null);s!=null&&s.tables[0].rows.length>0&&(h=t.getValueOfDecimal(s.getTables()[0].getRows()[0].getCell("ProfitBeforeTax")),c=t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("C_Year_ID")),l=t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("C_ProfitAndLoss_ID")),u.setValue("ProfitBeforeTax",h),u.setValue("C_Year_ID",c),u.setValue("C_ProfitAndLoss_ID",l))}catch(a){this.setCalloutActive(!1);this.log.severe(a.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutProfitTax=pt;n.Utility.inheritPrototype(wt,n.CalloutEngine);wt.prototype.BPGroup=function(i,r,u,f,e,o){if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{var a="select M_ReturnPolicy_ID, M_DiscountSchema_ID, M_PRICELIST_ID, PO_PriceList_ID,PO_DiscountSchema_ID,PO_ReturnPolicy_ID from C_BP_Group where C_BP_Group_ID="+t.getValueOfInt(e),s=n.DB.executeDataSet(a),v=u.getValue("IsCustomer"),y=u.getValue("IsVendor");if(v&&s!=null&&s.tables[0].rows.length>0){var h=t.getValueOfInt(s.tables[0].rows[0].cells.m_returnpolicy_id),c=t.getValueOfInt(s.tables[0].rows[0].cells.m_discountschema_id),l=t.getValueOfInt(s.tables[0].rows[0].cells.m_pricelist_id);u.setValue("M_ReturnPolicy_ID",h);u.setValue("M_DiscountSchema_ID",c);u.setValue("M_PRICELIST_ID",l)}y&&s!=null&&s.tables[0].rows.length>0&&(h=t.getValueOfInt(s.tables[0].rows[0].cells.po_returnpolicy_id),c=t.getValueOfInt(s.tables[0].rows[0].cells.po_discountschema_id),l=t.getValueOfInt(s.tables[0].rows[0].cells.po_pricelist_id),u.setValue("PO_ReturnPolicy_ID",h),u.setValue("PO_DiscountSchema_ID",c),u.setValue("PO_PriceList_ID",l))}catch(p){this.setCalloutActive(!1);this.log.severe(p.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutBPartner=wt;n.Utility.inheritPrototype(bt,n.CalloutEngine);bt.prototype.DocType=function(i,r,u,f,e,o){var s,h,c,l,a;if(e==null||e.toString()==""||this.isCalloutActive()||e==null)return"";this.setCalloutActive(!0);try{sql="SELECT M_Product_ID , movementqty , M_AttributeSetInstance_ID FROM M_InOutLine WHERE M_InOutLine_ID="+t.getValueOfInt(e);s=n.DB.executeDataSet(sql);h=0;s.getTables().length>0&&s.getTables()[0].getRows().length>0&&(c=t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("M_Product_ID")),h=t.getValueOfDecimal(s.getTables()[0].getRows()[0].getCell("movementqty")),l=t.getValueOfInt(s.getTables()[0].getRows()[0].getCell("M_AttributeSetInstance_ID")));sql="SELECT  SUM(ConfirmedQty + scrappedqty) FROM M_PackageLine WHERE  M_Package_ID="+u.getValue("M_Package_ID")+" and m_inoutline_id =  "+u.getValue("M_InOutLine_ID");a=t.getValueOfDecimal(n.DB.executeScalar(sql));u.setValue("M_Product_ID",c);u.setValue("Qty",h-a);u.setValue("M_AttributeSetInstance_ID",l);u.setValue("DTD001_IsConfirm",!0)}catch(v){this.setCalloutActive(!1);this.log.severe(v.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutshipLine=bt;n.Utility.inheritPrototype(kt,n.CalloutEngine);kt.prototype.SetMaxRunZero=function(n,t,i,r,u,f){if(u==null||u.toString()=="")return"";this.setCalloutActive(!0);var e=i.getValue("RunsMax");return e!=""&&e>0&&i.setValue("RunsRemaining",0),this.setCalloutActive(!1),n=t=i=r=u=f=null,""};n.Model.CalloutRecurring=kt;n.Utility.inheritPrototype(dt,n.CalloutEngine);dt.prototype.SetChargeAmount=function(t,i,r,u,f,e){if(f==null||f.toString()=="")return"";this.setCalloutActive(!0);try{var s=f.toString(),o=n.dataContext.getJSONRecord("MProductionLine/GetChargeAmt",s);o!=null&&(r.setValue("Amt",o.ChargeAmt),r.setValue("M_Product_ID",null))}catch(h){this.setCalloutActive(!1);this.log.severe(h.toString())}return this.setCalloutActive(!1),t=i=r=u=f=e=null,""};n.Model.CalloutProductionLine=dt;n.Utility.inheritPrototype(w,n.CalloutEngine);w.prototype.SetDateFromAndDateTo=function(i,r,u,f,e,o){var h,s,c,l;if(e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{h=e.toString()+","+i.getAD_Client_ID().toString();s=n.dataContext.getJSONRecord("Common/GetPeriodFromYear",h);s!=null&&(c=t.getValueOfDate(s.STARTDATE),l=t.getValueOfDate(s.ENDDATE),u.setValue("DateFrom",c),u.setValue("DateTo",l))}catch(a){this.setCalloutActive(!1);this.log.severe(a.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};w.prototype.SetCurrency=function(i,r,u,f,e,o){var h,s,c;if(e==null||e.toString()=="")return"";this.setCalloutActive(!0);try{h=e.toString()+","+i.getAD_Client_ID().toString();s=n.dataContext.getJSONRecord("Common/GetCurrencyFromAccountingSchema",h);s!=null&&(c=t.getValueOfInt(s.CurrencyID),u.setValue("C_Currency_ID",c))}catch(l){this.setCalloutActive(!1);this.log.severe(l.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutProfitLoss=w;n.Utility.inheritPrototype(gt,n.CalloutEngine);gt.prototype.SetQty=function(n,i,r,u,f){if(this.isCalloutActive()||f==null||f.toString()=="")return"";if(this.setCalloutActive(!0),t.getValueOfDecimal(r.getValue("TargetQty"))<t.getValueOfDecimal(r.getValue("ConfirmedQty")))return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";if(u.getColumnName()=="ConfirmedQty"){if(t.getValueOfDecimal(r.getValue("ConfirmedQty"))<0)return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";r.setValue("ScrappedQty",0);r.setValue("DifferenceQty",t.getValueOfDecimal(r.getValue("TargetQty"))-(t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("ScrappedQty"))))}else if(u.getColumnName()=="ScrappedQty"){if(t.getValueOfDecimal(r.getValue("ScrappedQty"))<0||t.getValueOfDecimal(r.getValue("TargetQty"))<t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("ScrappedQty")))return r.setValue("ConfirmedQty",t.getValueOfDecimal(r.getValue("TargetQty"))),r.setValue("DifferenceQty",0),r.setValue("ScrappedQty",0),this.setCalloutActive(!1),"";r.setValue("DifferenceQty",t.getValueOfDecimal(r.getValue("TargetQty"))-(t.getValueOfDecimal(r.getValue("ConfirmedQty"))+t.getValueOfDecimal(r.getValue("ScrappedQty"))))}return this.setCalloutActive(!1),""};n.Model.CalloutShipReceiptConfirmLine=gt;n.Utility.inheritPrototype(ni,n.CalloutEngine);ni.prototype.SetMultiplyRate=function(n,t,i,r,u){if(this.isCalloutActive()||u==null||u.toString()=="")return i.setValue("MultiplyRate",0),"";this.setCalloutActive(!0);var f=i.getValue("C_UOM_ID"),e=i.getValue("C_UOM_To_ID");return f==e&&(i.setValue("DivideRate",1),i.setValue("MultiplyRate",1)),this.setCalloutActive(!1),""};n.Model.CalloutUOMConversion=ni;n.Utility.inheritPrototype(ti,n.CalloutEngine);ti.prototype.CheckIncoTerm=function(i,r,u,f,e){if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);var s=i.isSOTrx(r),h=0,o="";try{if(u.getTableName().startsWith("C_Order")?s&&t.getValueOfInt(u.getValue("C_Order_Quotation"))>0?(o=s+","+u.getTableName()+",C_Order_Quotation,"+t.getValueOfInt(u.getValue("C_Order_Quotation")).toString(),h=n.dataContext.getJSONRecord("MOrder/GetIncoTerm",o)):!s&&t.getValueOfInt(u.getValue("Ref_Order_ID"))>0?(o=s+","+u.getTableName()+",Ref_Order_ID,"+t.getValueOfInt(u.getValue("Ref_Order_ID")).toString(),h=n.dataContext.getJSONRecord("MOrder/GetIncoTerm",o)):t.getValueOfInt(u.getValue("C_Order_Blanket"))>0&&(o=s+","+u.getTableName()+",C_Order_Blanket,"+t.getValueOfInt(u.getValue("C_Order_Blanket")).toString(),h=n.dataContext.getJSONRecord("MOrder/GetIncoTerm",o)):u.getTableName().startsWith("C_Invoice")?s&&t.getValueOfInt(u.getValue("C_Order_ID"))>0?(o=s+","+u.getTableName()+",C_Order_ID,"+t.getValueOfInt(u.getValue("C_Order_ID")).toString(),h=n.dataContext.getJSONRecord("MOrder/GetIncoTerm",o)):!s&&t.getValueOfInt(u.getValue("C_Order_ID"))>0?(o=s+","+u.getTableName()+",C_Order_ID,"+t.getValueOfInt(u.getValue("C_Order_ID")).toString(),h=n.dataContext.getJSONRecord("MOrder/GetIncoTerm",o)):!s&&t.getValueOfInt(u.getValue("M_InOut_ID"))>0&&(o=s+","+u.getTableName()+",M_InOut_ID,"+t.getValueOfInt(u.getValue("M_InOut_ID")).toString(),h=n.dataContext.getJSONRecord("MOrder/GetIncoTerm",o)):u.getTableName().startsWith("M_InOut")&&(s&&t.getValueOfInt(u.getValue("C_Order_ID"))>0?(o=s+","+u.getTableName()+",C_Order_ID,"+t.getValueOfInt(u.getValue("C_Order_ID")).toString(),h=n.dataContext.getJSONRecord("MOrder/GetIncoTerm",o)):!s&&t.getValueOfInt(u.getValue("C_Order_ID"))>0?(o=s+","+u.getTableName()+",C_Order_ID,"+t.getValueOfInt(u.getValue("C_Order_ID")).toString(),h=n.dataContext.getJSONRecord("MOrder/GetIncoTerm",o)):!s&&t.getValueOfInt(u.getValue("C_Invoice_ID"))>0&&(o=s+","+u.getTableName()+",C_Invoice_ID,"+t.getValueOfInt(u.getValue("C_Invoice_ID")).toString(),h=n.dataContext.getJSONRecord("MOrder/GetIncoTerm",o))),h>0&h!=e)return this.setCalloutActive(!1),n.ADialog.warn("IncoTermChanged"),""}catch(c){this.setCalloutActive(!1);this.log.severe(c.toString())}return this.setCalloutActive(!1),""};n.Model.CalloutIncoTerm=ti;n.Utility.inheritPrototype(ii,n.CalloutEngine);ii.prototype.BlanketOrderRef=function(t,i,r,u,f){var o,s,e;return this.isCalloutActive()||f==null||f.toString()==""?"":(this.setCalloutActive(!0),u.getColumnName()=="Blanket_Ref_Order_ID"&&(o=n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix","VA009_"),s=o.VA009_?f.toString()+","+o.VA009_:f.toString()+",false",e=n.dataContext.getJSONRecord("MOrder/GetOrderHeader",s),e!=null&&(r.setValue("AD_Client_ID",e.AD_Client_ID),r.setValue("AD_Org_ID",e.AD_Org_ID),r.setValue("Description",e.Description),r.setValue("C_DocTypeTarget_ID",e.C_DocTypeTarget_ID),r.setValue("DateOrdered",b(e.DateOrdered)),r.setValue("DatePromised",b(e.DatePromised)),r.setValue("OrderValidFrom",b(e.OrderValidFrom)),r.setValue("OrderValidTo",b(e.OrderValidTo)),r.setValue("C_BPartner_ID",e.C_BPartner_ID),r.setValue("Bill_BPartner_ID",e.Bill_BPartner_ID),r.setValue("C_BPartner_Location_ID",e.C_BPartner_Location_ID),r.setValue("Bill_Location_ID",e.Bill_Location_ID),r.setValue("AD_User_ID",e.AD_User_ID),r.setValue("Bill_User_ID",e.Bill_User_ID),r.setValue("M_Warehouse_ID",e.M_Warehouse_ID),r.setValue("PriorityRule",e.PriorityRule),r.setValue("M_PriceList_ID",e.M_PriceList_ID),r.setValue("C_IncoTerm_ID",e.C_IncoTerm_ID),r.setValue("C_Currency_ID",e.C_Currency_ID),r.setValue("C_ConversionType_ID",e.C_ConversionType_ID),r.setValue("SalesRep_ID",e.SalesRep_ID),o.VA009_&&r.setValue("VA009_PaymentMethod_ID",e.VA009_PaymentMethod_ID),r.setValue("C_PaymentTerm_ID",e.C_PaymentTerm_ID),r.setValue("C_Campaign_ID",e.C_Campaign_ID),r.setValue("C_Activity_ID",e.C_Activity_ID),r.setValue("AD_OrgTrx_ID",e.AD_OrgTrx_ID),r.setValue("User1_ID",e.User1_ID),r.setValue("User2_ID",e.User2_ID),r.setValue("TotalLines",e.TotalLines),r.setValue("GrandTotal",e.GrandTotal))),this.setCalloutActive(!1),"")};n.Model.CalloutBlanketOrderRef=ii;n.Utility.inheritPrototype(ri,n.CalloutEngine);ri.prototype.SetLocatorPC=function(n,t,i,r,u,f){return this.isCalloutActive()||u==null||u.toString()==""?"":(this.setCalloutActive(!0),r.getColumnName()=="M_Warehouse_ID"?u!=f&&(i.setValue("M_Locator_ID",""),i.setValue("Ref_M_Container_ID","")):r.getColumnName()=="M_Locator_ID"&&u!=f&&i.setValue("Ref_M_Container_ID",""),this.setCalloutActive(!1),n=t=i=r=u=f=null,"")};n.Model.CalloutLocatorPC=ri;n.Utility.inheritPrototype(ui,n.CalloutEngine);ui.prototype.SetDates=function(n,t,i,r,u,f){return this.isCalloutActive()||u==null||u.toString()==""?"":(this.setCalloutActive(!0),r.getColumnName()=="C_Frequency_ID"&&u!=f&&(i.setValue("StartDate",""),i.setValue("EndDate","")),this.setCalloutActive(!1),"")};n.Model.CalloutSetDates=ui;n.Utility.inheritPrototype(fi,n.CalloutEngine);fi.prototype.Product=function(n,t,i,r,u){return this.isCalloutActive()||u==null||u.toString()==""?"":(this.setCalloutActive(!0),i.getField("M_AttributeSetInstance_ID")!=null&&i.setValue("M_AttributeSetInstance_ID",null),this.setCalloutActive(!1),"")};n.Model.CalloutLandedCost=fi}(VIS,jQuery),function(n,t){function i(){function di(n,i,r){var u=null;return t.ajax({url:bi,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function gi(n){ei=n;tr()}function y(){var u=t(window).width(),e=t(".row.scrollerHorizontal > div").length,h;e=e-1;t(".scrollerHorizontal").width(u);var l=u/e-20,i=parseInt(l),o={};if(n.Application.isRTL&&(t("#welcomeScreen").css({right:"0",left:"auto"}),t(".vis-welcomeScreenFeeds > .row").css("margin-right","0px")),u>=1366&&(t("#workflowActivity").css("display")=="none"?(t("#welcomeScreen").width(i),o=n.Application.isRTL?{width:i,right:i+20}:{width:i,left:i+20},t("#fllupsScreen").animate(o,200,function(){}),o=n.Application.isRTL?{width:i,right:i*2+40}:{width:i,left:i*2+40},t("#favLinks").animate(o,200,function(){})):t("#workflowActivity").css("display")=="block"&&(h=u+i+20,t(".scrollerHorizontal").width(h),ot.scroll(),t("#welcomeScreen").width(i),o=n.Application.isRTL?{width:i,right:i+20}:{width:i,left:i+20},t("#workflowActivity").animate(o,200,function(){pt.scroll()}),o=n.Application.isRTL?{width:i,right:i*2+40}:{width:i,left:i*2+40},t("#fllupsScreen").animate(o,200,function(){}),o=n.Application.isRTL?{width:i,right:i*3+60}:{width:i,left:i*3+60},t("#favLinks").animate(o,200,function(){})),t("#vis_userDate").show()),u>1024&&u<1366)t("#workflowActivity").css("display")=="none"?(n.Application.isRTL?(t("#fllupsScreen").css("right",i+20),t("#favLinks").css("right",i*2+40)):(t("#fllupsScreen").css("left",i+20),t("#favLinks").css("left",i*2+40)),t("#welcomeScreen,#fllupsScreen,#favLinks").width(i)):t("#workflowActivity").css("display")=="block"&&(h=u+i+20,t(".scrollerHorizontal").width(h),ot.scroll(),t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(i),n.Application.isRTL?(t("#workflowActivity").css("right",i+20),t("#fllupsScreen").css("right",i*2+40),t("#favLinks").css("right",i*3+60)):(t("#workflowActivity").css("left",i+20),t("#fllupsScreen").css("left",i*2+40),t("#favLinks").css("left",i*3+60))),t("#vis_userDate").show();else if(u>=1e3&&u<=1024){if(t("#workflowActivity").css("display")=="none"){var s=u/2,r=parseInt(s),c=r*e;t(".scrollerHorizontal").width(c);n.Application.isRTL?(t("#fllupsScreen").css("right",r),t("#favLinks").css("right",r*2)):(t("#fllupsScreen").css("left",r),t("#favLinks").css("left",r*2));t("#welcomeScreen,#fllupsScreen,#favLinks").width(r-20)}else if(t("#workflowActivity").css("display")=="block"){e=e+1;var s=u/2,r=parseInt(s),c=r*e;t(".scrollerHorizontal").width(c);ot.scroll();t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(r-20);n.Application.isRTL?(t("#workflowActivity").css("right",r),t("#fllupsScreen").css("right",r*2),t("#favLinks").css("right",r*3)):(t("#workflowActivity").css("left",r),t("#fllupsScreen").css("left",r*2),t("#favLinks").css("left",r*3))}t("#vis_userDate").show()}else if(u<1e3){if(t("#workflowActivity").css("display")=="none"){var s=u*e,r=parseInt(s),f=u;t(".scrollerHorizontal").width(r);n.Application.isRTL?(t("#fllupsScreen").css("right",f),t("#favLinks").css("right",f*2)):(t("#fllupsScreen").css("left",f),t("#favLinks").css("left",f*2));t("#welcomeScreen,#fllupsScreen,#favLinks").width(f-20)}else if(t("#workflowActivity").css("display")=="block"){e=e+1;var s=u*e,r=parseInt(s),f=u;t(".scrollerHorizontal").width(r);ot.scroll();t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(f-20);n.Application.isRTL?(t("#workflowActivity").css("right",f),t("#fllupsScreen").css("right",f*2),t("#favLinks").css("right",f*3)):(t("#workflowActivity").css("left",f),t("#fllupsScreen").css("left",f*2),t("#favLinks").css("left",f*3))}t("#vis_userDate").hide()}}function nr(){var i=new Date,t=i.getHours();return t<12?n.Msg.getMsg("GoodMorning"):t<17?n.Msg.getMsg("GoodAfternoon"):n.Msg.getMsg("GoodEvening")}function tr(){ei.load(n.Application.contextUrl+"Home/Home",function(){function sr(i,r,u){er.show();ur=!0;var f=n.Application.contextUrl+"Home/GetJSONFllups";t.ajax({url:f,data:{fllPageSize:i,fllPage:r,isRef:u},type:"GET",cache:!1,datatype:"json",success:function(i){var r=JSON.parse(i),f=0,o="",s="",h="",a,c,l,e;if(r.lstFollowups.length>0){u&&ki.text(r.FllCnt);for(a in r.lstFollowups){if(c=r.lstFollowups[f].ChatID+"-"+r.lstFollowups[f].RecordID+"-"+r.lstFollowups[f].SubscriberID+"-"+r.lstFollowups[f].TableID+"-"+r.lstFollowups[f].WinID+"-"+r.lstFollowups[f].TableName,r.lstFollowups[f].Cdate!=null&&r.lstFollowups[f].Cdate!=""&&(l=new Date(r.lstFollowups[f].Cdate),h=Globalize.format(l,"F",Globalize.cultureSelector)),r.lstFollowups[f].AD_Image_ID==0)s="<img  style='cursor:pointer;'  data-fll='UID' data-UID='"+r.lstFollowups[f].AD_User_ID+"' alt='"+n.Msg.getMsg("userImage")+"' title='"+n.Msg.getMsg("UserImage")+"' class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.png '/>";else for(e in r.lstUserImg)if(r.lstUserImg[e].AD_Image_ID==r.lstFollowups[f].AD_Image_ID){s=r.lstUserImg[e].UserImg!="NoRecordFound"&&r.lstUserImg[e].UserImg!="FileDoesn'tExist"&&r.lstUserImg[e].UserImg!=null?"<img  style='cursor:pointer;'   data-fll='UID' data-UID='"+r.lstFollowups[f].AD_User_ID+"' alt='"+n.Msg.getMsg("UserImage")+"' title='"+n.Msg.getMsg("UserImage")+"' class='userAvatar-Feeds' src='"+n.Application.contextUrl+r.lstUserImg[e].UserImg+"?"+new Date(t.now()).getSeconds()+"'/>":"<img  style='cursor:pointer;'  data-fll='UID' data-UID='"+r.lstFollowups[f].AD_User_ID+"' alt='"+n.Msg.getMsg("UserImage")+"' title='"+n.Msg.getMsg("UserImage")+"' class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.png '/>";break}o+="<div id="+c+" data-fll='divfllups' class='vis-feedContainer'><div class='vis-feedTitleBar'><h3> "+r.lstFollowups[f].WinName+" : "+r.lstFollowups[f].Identifier+" <\/h3><div class='vis-feedTitleBar-buttons'><ul><li> <a href='javascript:void(0)'  data-fll='azoomfllups'  title='"+n.Msg.getMsg("ViewFollowups")+"' class='vis-feedIcons vis-icon-viewFeed'>"+n.Msg.getMsg("ViewFollowups")+"<\/a><\/li><li> <a href='javascript:void(0)'  data-fll='asubscribefllups'  title='"+n.Msg.getMsg("UnsubscribeFollowups")+"' class='vis-feedIcons vis-icon-unsubscribeFeed'>"+n.Msg.getMsg("UnsubscribeFollowups")+" <\/a><\/li><\/ul> <\/div><\/div><div id='divfllcmntdata"+r.lstFollowups[f].ChatID+"' data-fll='fll-cmnt' class='vis-feedDetails'><div class='vis-feedDetails-cmnt' data-fll='fll-cmnt'>"+s+"<p> <strong data-fll='UID' data-UID='"+r.lstFollowups[f].AD_User_ID+"'>";o+=r.lstFollowups[f].AD_User_ID==n.Env.getCtx().getAD_User_ID()?n.Msg.getMsg("Me")+" <\/strong> <br />":r.lstFollowups[f].Name+"<\/strong> <br />";o+=n.Utility.encodeText(r.lstFollowups[f].ChatData)+"<\/p><p class='vis-feedDateTime'>"+h+"<\/p><\/div><\/div><a id='divfllvm_"+r.lstFollowups[f].ChatID+"'  data-fll='viewmorefllupscmnt' href='javascript:void(0)' class='vis-viewMoreComments'><span class='vis-feedIcons vis-icon-viewMoreComments'><\/span>"+n.Msg.getMsg("ViewMoreComments")+"...<\/a><a id='divfllvl_"+r.lstFollowups[f].ChatID+"' style='display:none;'  data-fll='viewlessfllupscmnt' href='javascript:void(0)' class='vis-viewMoreComments'><span class='vis-feedIcons vis-icon-viewMoreComments'><\/span>"+n.Msg.getMsg("ViewLessComments")+"...<\/a> <div class='clearfix'><\/div> <div id="+r.lstFollowups[f].ChatID+" class='vis-feedMessage'> <input id='txtFllCmnt"+r.lstFollowups[f].ChatID+"' data-fll='txtcmntfll' placeholder='"+n.Msg.getMsg("TypeMessage")+"' type='text' value='' /> <span  id='btnFllCmnt"+r.lstFollowups[f].ChatID+"' data-fll='btncmntfll' title='"+n.Msg.getMsg("PostMessage")+"'  class='vis-feedIcons vis-icon-message' ><\/span> <div class='clearfix'><\/div> <\/div><\/div> ";f++}ut.append(o)}else pr==!1&&(n.Application.isRTL?ut.append("<p style='margin-top: 200px;text-align: center '>"+n.Msg.getMsg("NoRecordFound")+"!!!<\/p>"):ut.append("<p style='margin-top: 200px;text-align: center '>"+n.Msg.getMsg("NoRecordFound")+"!!!<\/p>"));ur=!1;er.hide()},error:function(){}})}function wr(i,r,u){var f=n.Application.contextUrl+"Home/GetJSONFllupsCmnt/";t.ajax({url:f,data:{FllupsID:i,fllCmntPageSize:r,fllCmntPage:u},type:"GET",cache:!1,datatype:"json",success:function(i){var r=JSON.parse(i),u=0,e="",c="",a=r.lstFollowups[u].ChatID,s="",o,l,f,h;for(o in r.lstFollowups){if(r.lstFollowups[o].Cdate!=null&&r.lstFollowups[o].Cdate!=""&&(l=new Date(r.lstFollowups[o].Cdate),c=Globalize.format(l,"F",Globalize.cultureSelector)),r.lstFollowups[u].AD_Image_ID==0)s="<img  style='cursor:pointer;'  data-fll='UID' data-UID='"+r.lstFollowups[u].AD_User_ID+"'  alt='"+n.Msg.getMsg("UserImage")+"'  title='"+n.Msg.getMsg("UserImage")+"' class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.png'/>";else for(f in r.lstUserImg)if(r.lstUserImg[f].AD_Image_ID==r.lstFollowups[u].AD_Image_ID){s=r.lstUserImg[f].UserImg!="NoRecordFound"&&r.lstUserImg[f].UserImg!="FileDoesn'tExist"&&r.lstUserImg[f].UserImg!=null?"<img style='cursor:pointer;'  data-fll='UID' data-UID='"+r.lstFollowups[u].AD_User_ID+"' alt='"+n.Msg.getMsg("UserImage")+"'  title='"+n.Msg.getMsg("UserImage")+"'  class='userAvatar-Feeds' src='"+r.lstUserImg[f].UserImg+"?"+new Date(t.now()).getSeconds()+"'/>":"<img  style='cursor:pointer;'  data-fll='UID' data-UID='"+r.lstFollowups[u].AD_User_ID+"'  alt='"+n.Msg.getMsg("UserImage")+"'  title='"+n.Msg.getMsg("UserImage")+"'  class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.png'/>";break}e+="<div class='vis-feedDetails-cmnt'  data-fll='fll-cmnt'>"+s+"<p> <strong  data-fll='UID' data-UID='"+r.lstFollowups[u].AD_User_ID+"'>";e+=r.lstFollowups[u].AD_User_ID==n.Env.getCtx().getAD_User_ID()?n.Msg.getMsg("Me")+" <\/strong> <br />":r.lstFollowups[u].Name+"<\/strong> <br />";e+=n.Utility.encodeText(r.lstFollowups[u].ChatData)+"<\/p><p class='vis-feedDateTime'>"+c+"<\/p><\/div>";u++}h=t("#divfllcmntdata"+a);h.html("");h.append(e)},error:function(){console.log("Error")}})}function hr(i,r){var u=n.Application.contextUrl+"Home/PostFllupsCmnt/";t.ajax({url:u,data:{fllChatID:wi,fllSubscriberID:rr,cmntTxt:i},type:"POST",cache:!1,datatype:"json",success:function(u){var s=new Date,h=Globalize.format(s,"F",Globalize.cultureSelector),f=u,c=n.context.getContext("##AD_User_Name"),e="",o;e=f!==null?f!="NoRecordFound"&&f!="FileDoesn'tExist"?"<img  style='cursor:pointer;'   data-fll='UID' data-UID='"+n.Env.getCtx().getAD_User_ID()+"'  alt='"+n.Msg.getMsg("UserImage")+"'  class='userAvatar-Feeds' src='"+f+"?"+new Date(t.now()).getSeconds()+"' />":"<img  style='cursor:pointer;'   data-fll='UID' data-UID='"+n.Env.getCtx().getAD_User_ID()+"' alt='"+n.Msg.getMsg("UserImage")+"'   class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.PNG '/>":"<img  style='cursor:pointer;'   data-fll='UID' data-UID='"+n.Env.getCtx().getAD_User_ID()+"' alt='"+n.Msg.getMsg("UserImage")+"'   class='userAvatar-Feeds' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/defaultUser46X46.PNG '/>";o="<div class='vis-feedDetails-cmnt' data-fll='fll-cmnt'>"+e+"<p> <strong  data-fll='UID' data-UID='"+n.Env.getCtx().getAD_User_ID()+"'>"+n.Msg.getMsg("Me")+"<\/strong><br />"+n.Utility.encodeText(i)+"<\/p><p class='vis-feedDateTime'>"+h+"<\/p><\/div>";r.append(o)},error:function(){console.log("Error")}})}var fr;et=!1;ct=!1;k=!1;f=!1;l=t("#sAlrtTxtType");h=t("#hAlrtTxtTypeCount");b=t("#ulHomeTabMenu");wt=t("#divTabMenuDataLoder");c=t("#spanWelcomeTabtopHdr");yi=t("#searchData");ot=t("#dataContainer");ut=t("#fllupsList");pt=t("#workflowActivityData");li=t("#userLinks-List");ai=t("#userFavs-List");a=t("#hlnkTabDataRef");i=t("#welcomeScreenFeedsList");vi=t("#favLinks");r=1;w=t("#workflowActivity");bt=t("#divTabMenuDataLoder");lt=t("#workflowActivityDetails");ft=t("#hWelcomeScreenSwapHdr");v=t("#sNewNts");p=t("#WFSearchshow");tt=t("#divNoticeCount");rt=t("#divRequestCount");kt=t("#divNotesCount");dt=t("#divAptCount");ii=t("#divKPI");e=10;u=0;o=0;s=0;y();t(window).resize(y);t("div.vis-workflowActivityTitleBar-buttons ul li .vis-icon-check").on(n.Events.onTouchStartOrClick,function(){t("#workflowActivity").hide();t(".vis-activityContainer").removeClass("vis-activeFeed");y();ot.scroll()});t("#btnWFAClose").on(n.Events.onTouchStartOrClick,function(){t("#workflowActivity").hide();t(".vis-activityContainer").removeClass("vis-activeFeed");y();ot.scroll()});n.changeUserImage();t("#userFav-Tab").click(function(){t("#userLinks div").removeClass("row userLinks_activeTab");t("#userLinks div").addClass("row userLinks_inactiveTab");t("#userFavs div").removeClass("row userFavs_inactiveTab");t("#userFavs div").addClass("row userFavs_activeTab");t("#userLinks-List").hide("fast");t("#userFavs-List").show("fast",function(){setTimeout(function(){},0)})});t("#userLinks-Tab").click(function(){t("#userFavs div").removeClass("row userFavs_activeTab");t("#userFavs div").addClass("row userFavs_inactiveTab");t("#userLinks div").removeClass("row userLinks_inactiveTab");t("#userLinks div").addClass("row userLinks_activeTab");t("#userFavs-List").hide("fast");t("#userLinks-List").show("fast",function(){setTimeout(function(){},0)})});n.shortcutMgr.init(t("#userLinks-List"),t("#userFavs-List"));t(".vis-welcomeScreenFeeds").hide();t(".vis-icon-userfeeds").off("click");t(".vis-icon-userfeeds").on("click",function(){t(".vis-welcomeScreen-Data").hide("slow");t(".vis-welcomeScreenFeeds").show("fast")});t(".vis-welcomeScreenTab-notificationBubbles").on("click",function(){return!1});fr=nr();t("#vis-userGreeting").text(fr);a.on("click",function(){if(f=!0,et==!1&&r!=oi)if(r==at)d=0,e=g,u=nt,s=0,it(),ui();else if(r==ri)y(),v.hide(),p.show(),l.empty(),l.append(n.Msg.getMsg("WorkflowActivities")),h.empty(),h.append(t("#divfActivity").html()),ft.empty(),ft.append(n.Msg.getMsg("Activity")),d=0,e=g,u=nt,s=0,st==null&&(st=new n.wfActivity(i,lt,pt,i,p)),st.Load(!0);else if(r==ht)d=0,e=g,u=nt,s=0,it(),fi();else if(r==gt)d=0,e=g,u=nt,s=0,WSP.wspHomeMgr.viewWSPHome(gt,f);else if(r==ni)d=0,e=g,u=nt,s=0,WSP.wspHomeMgr.viewWSPHome(ni,f);else{if(r==si)return;r==vt?(d=0,e=g,u=nt,s=0,it(),WSP.wspHomeMgr.viewWSPHome(vt,f)):r==yt?(d=0,e=g,u=nt,s=0,it(),WSP.wspHomeMgr.viewWSPHome(yt,f)):r==hi&&(w.hide(),y(),d=0,e=g,u=nt,s=0,it(),p.hide(),VADB.Apps.KpiHomeScreen(i,bt,v,w,lt,ft,ii))}});i.on("click",function(i){var o=t(i.target).data("vishomercrd"),f;if(r==ht){if(i.target.tagName==="SPAN"&&o==="more"){if(t(i.target.parentNode.parentNode).data("vishomercrd")=="more-details"){var s=i.target.parentNode.parentNode.id,h=t("#snoticetitle_"+s),c=t("#snoticedesc_"+s),l=t("#snoticemore_"+s);l.hide();h.hide();c.show();t("#snoticeless_"+s).show()}}else if(t(i.target.parentNode.parentNode).data("vishomercrd")=="more-details"){var s=i.target.parentNode.parentNode.id,h=t("#snoticetitle_"+s),c=t("#snoticedesc_"+s),l=t("#snoticemore_"+s);l.show();h.show();c.hide();t("#snoticeless_"+s).hide()}if(o==="view"){var f=i.target.id,u=f.toString().split("|"),a=u[0],v=u[1],y=u[2],nt=u[3],e=new n.Query;e.addRestriction(v+"_ID",n.Query.prototype.EQUAL,a);n.viewManager.startWindow(y,e)}else if(o==="liview"){var f=i.target.firstChild.id,u=f.toString().split("|"),a=u[0],v=u[1],y=u[2],nt=u[3],e=new n.Query;e.addRestriction(v+"_ID",n.Query.prototype.EQUAL,a);n.viewManager.startWindow(y,e)}else if(o==="approve")f=i.target.id,ci(f,!0);else if(o==="liapprove")f=i.target.firstChild.id,ci(f,!0);else if(o==="lispecial"){var f=i.target.firstChild.id,u=f.toString().split("|"),p=u[0],w=u[1],b=u[2],e=new n.Query;e.addRestriction(w+"_ID",n.Query.prototype.EQUAL,p);n.viewManager.startWindow(b,e)}else if(o==="lispecial1"){var f=i.target.id,u=f.toString().split("|"),p=u[0],w=u[1],b=u[2],e=new n.Query;e.addRestriction(w+"_ID",n.Query.prototype.EQUAL,p);n.viewManager.startWindow(b,e)}}else if(r==at)if(o==="view"){var f=i.target.id,u=f.toString().split("|"),k=u[0],d=u[1],g=u[2],e=new n.Query;e.addRestriction(d+"_ID",n.Query.prototype.EQUAL,k);n.viewManager.startWindow(g,e)}else if(o==="liview"){var f=i.target.firstChild.id,u=f.toString().split("|"),k=u[0],d=u[1],g=u[2],e=new n.Query;e.addRestriction(d+"_ID",n.Query.prototype.EQUAL,k);n.viewManager.startWindow(g,e)}});i.bind("scroll",function(){if(t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight)if(k=!0,f=!1,r==ri)if(o=parseInt(t("#divfActivity").html()),s=u*e,s<=o&&st!=null)u+=1,st.AppendRecord(u,e);else return;else if(r==ht)if(o=parseInt(tt.text()),s=u*e,u+=1,s<=o)fi();else return;else if(r==at)if(o=parseInt(rt.text()),s=u*e,u+=1,s<=o)ui();else return;else if(r==vt)if(o=parseInt(dt.text()),s=u*e,u+=1,s<=o)WSP.wspHomeMgr.doScrollWSPHome(vt,u,e);else return;else if(r==yt)if(o=parseInt(kt.text()),s=u*e,s<=o)u+=1,WSP.wspHomeMgr.doScrollWSPHome(yt,u,e);else return});var cr=t("#hlnkFllupsRef"),ki=t("#follupsCount"),er=t("#divFllMainLoder"),bi="",lr="",ei="",ar=0,di=10,gi=1,ir=0,or=0,vr=10,yr=0,wi=0,rr=0,pr=!1,tr=!1,ur=!1;ut.on("click",function(i){var f=t(i.target).data("fll"),u,e,o,c,s,r,h,l,a;if(f==="viewmorefllupscmnt")ei=i.target.parentNode.id,wi=0,rr=0,wi=i.target.parentNode.children[3].id,wr(ei,vr,yr),u=i.target.id,e=u.split("_"),t("#divfllvl_"+e[1]).show(),t("#"+u).hide();else if(f==="viewlessfllupscmnt")ei=i.target.parentNode.id,wi=0,rr=0,wi=i.target.parentNode.children[3].id,u=i.target.id,e=u.split("_"),t("#divfllvm_"+e[1]).show(),o=t("#divfllcmntdata"+e[1]),c=o.find("div:last-child"),o.empty(),o.html(c),t("#"+u).hide();else if(f==="azoomfllups")ei=i.target.parentNode.parentNode.parentNode.parentNode.parentNode.id,r=ei.toString().split("-"),s=new n.Query,s.addRestriction(r[5]+"_ID",n.Query.prototype.EQUAL,r[1]),n.viewManager.startWindow(r[4],s);else if(f==="asubscribefllups")ei=i.target.parentNode.parentNode.parentNode.parentNode.parentNode.id,r=ei.toString().split("-"),t.ajax({url:n.Application.contextUrl+"Subscribe/UnSubscribe",type:"GET",dataType:"Json",data:{AD_Window_ID:r[4],Record_ID:r[1],AD_Table_ID:r[3]},success:function(i){if(i==!1)alert(n.Msg.getMsg("UnSubscription Failed"));else{t("#"+ei).animate({width:"100%",height:"132px","margin-top":"-132px"},700,function(){t("#"+ei).remove()});var r=ki.text();ki.text(r-1)}}});else if(f==="btncmntfll")wi=i.target.parentNode.id,FllupsData=t("#"+i.target.parentNode.parentNode.children[1].id),bi=t("#"+i.target.previousElementSibling.id),lr=t("#"+i.target.id),h=t(bi).val(),h!==""&&(l=new Date,a=Globalize.format(l,"F",Globalize.cultureSelector),hr(h,FllupsData),t(bi).val(""));else if(f=="UID"){var v=t(i.target).data("uid"),y=n.Env.getWindowNo(),p=new n.ContactInfo(v,y);p.show()}});ut.on("keydown",function(n){var u=t(n.target).data("fll"),i,r;u==="txtcmntfll"&&(ei=n.target.parentNode.parentNode.id,wi=n.target.parentNode.id,FllupsData=t("#"+n.target.parentNode.parentNode.children[1].id),bi=t("#"+n.target.id),i=t(bi).val(),i!==""&&i!==null&&(r=n.charCode||n.keyCode,r===pi&&(hr(i,FllupsData),t(bi).val(""))))});ut.bind("scroll",function(){if(t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight&&(tr=!1,ir=ki.text(),ir>di))if(or=gi*di,gi+=1,or<=ir)sr(di,gi,tr);else return});cr.on("click",function(){ur==!1&&(di=10,gi=1,ar=ki.text(),tr=!0,ut.empty(),sr(di,gi,tr))});b.off("click");ti();window.WSP?(ct=!0,p.hide(),WSP.wspHomeMgr.initWSPHome(i,b,lt,pt,w,bt,ft,v,l,h,dt,kt)):console.log("PleaseInstallWSPModule")})}function ir(){return{activeTabType:r}}function ui(){wt.show();et=!0;t.ajax({url:n.Application.contextUrl+"Home/GetJSONHomeRequest",data:{pagesize:e,page:u,isTabDataRef:f},type:"GET",datatype:"json",cache:!1,success:function(t){var u=JSON.parse(t.data),v="",e,p,a,y,s,c,l;if(u.length>0){r==at&&f&&(o=parseInt(t.count),rt.empty(),rt.show(),h.empty(),rt.text(t.count),h.text(t.count));for(e in u)p="",(u[e].StartDate!=null||u[e].StartDate!="")&&(s=new Date(u[e].StartDate),p=Globalize.format(s,"d",Globalize.cultureSelector)),a="",u[e].NextActionDate!=null?(s=new Date(u[e].NextActionDate),a=Globalize.format(s,"d",Globalize.cultureSelector)):a="&nbsp;-----------",y="",(u[e].CreatedDate!=null||u[e].CreatedDate!="")&&(s=new Date(u[e].CreatedDate),y=Globalize.format(s,"F",Globalize.cultureSelector)),c=u[e].Summary,c.length>80&&(c=c.substr(0,80)+"..."),l=u[e].CaseType,l.length>30&&(l=l.substr(0,30)+"..."),v+="<div class='vis-activityContainer'><div class='vis-feedTitleBar'><h3>#"+u[e].DocumentNo+"<\/h3><div class='vis-feedTitleBar-buttons'><ul><li style='color:#999999; padding-top:10px; font-size:14px;'>"+u[e].Name+"<\/li><li data-vishomercrd='liview'><a href='javascript:void(0)' data-vishomercrd='view' id="+u[e].R_Request_ID+"|"+u[e].TableName+"|"+u[e].AD_Window_ID+"  title='"+n.Msg.getMsg("View")+"' class='vis-feedIcons vis-icon-viewFeed'> title='"+n.Msg.getMsg("View")+"'<\/a><\/li><\/ul><\/div><\/div><div  class='vis-feedDetails vis-pt-0 vis-pl-0'><div class='vis-table-request'><ul><li><span>"+n.Msg.getMsg("Priority")+":<\/span><br>"+u[e].Priority+"<\/li><li><span>"+n.Msg.getMsg("Status")+":<\/span><br>"+u[e].Status+"<\/li><li><span>"+n.Msg.getMsg("NextActionDate")+":<\/span><br>"+a+"<\/li><\/ul><\/div><p class='vis-maintain-customer-p'><strong>"+n.Utility.encodeText(l)+" <\/strong><br /><span>"+n.Msg.getMsg("Message")+":<\/span><br>"+n.Utility.encodeText(c)+"<\/p><p class='vis-feedDateTime'  style=' width: 69%; margin-right: 10px;'>"+y+"<\/p><\/div><\/div>"}else i.find(".vis-table-request").length==0&&k==!1&&(v=n.Application.isRTL?"<p style=' margin-top:200px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"<\/p>":"<p style=' margin-top:200px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"<\/p>",rt.empty(),h.empty(),rt.text(0),rt.hide(),h.text(0));et=!1;ti();r==at&&i.append(v);wt.hide()}})}function fi(){et=!0;wt.show();t.ajax({url:n.Application.contextUrl+"Home/GetJSONHomeNotice",data:{pagesize:e,page:u,isTabDataRef:f},type:"GET",datatype:"json",success:function(t){var u=JSON.parse(t.data),s="",l=null,e,a,c,v;if(u.length>0){r==ht&&f&&(o=parseInt(t.count),tt.empty(),tt.show(),h.empty(),tt.text(t.count),h.text(t.count));for(e in u)u[e].CDate!=null&&u[e].CDate!=""&&(a=new Date(u[e].CDate),l=Globalize.format(a,"F",Globalize.cultureSelector)),c="",v=u[e].Description,c=v.length<=100?"<p><strong style='color:#666666' data-vishomercrd='title' id='"+u[e].AD_Note_ID+"'>"+n.Utility.encodeText(u[e].Title)+"<\/strong><\/p>":"<p><strong  id='snoticetitle_"+u[e].AD_Note_ID+"'  style='color:#666666;' >"+n.Utility.encodeText(u[e].Title)+"...<\/strong><strong id='snoticedesc_"+u[e].AD_Note_ID+"' style='display:none; color:#666666;'>"+n.Utility.encodeText(u[e].Description)+"...<\/strong> <span id='snoticemore_"+u[e].AD_Note_ID+"' data-vishomercrd='more' style='color:gray; float:right;'>"+n.Msg.getMsg("more")+"<\/span><span id='snoticeless_"+u[e].AD_Note_ID+"' data-vishomercrd='less' style='display:none; color:gray; float:right;'>"+n.Msg.getMsg("less")+"<\/span><\/p>",s+="<div data-vishomercrd='view-recrd-cntainer' id='divrecdcntnr_"+u[e].AD_Note_ID+"' class='vis-activityContainer'> <div class='vis-feedTitleBar'>",s+=u[e].SpecialTable?"<h3 style='color:#1b95d7;width:calc(100% - 105px)'>"+n.Utility.encodeText(u[e].MsgType)+"<\/h3>":"<h3 style='color:#1b95d7;'>"+n.Utility.encodeText(u[e].MsgType)+"<\/h3>",s+=" <div class='vis-feedTitleBar-buttons'>  <ul>",s+="<li data-vishomercrd='liapprove'><a href='javascript:void(0)' data-vishomercrd='approve'  id="+u[e].AD_Note_ID+"  title='"+n.Msg.getMsg("Approve")+"' class='vis-feedIcons vis-icon-check'> title='"+n.Msg.getMsg("Approve")+"'<\/a><\/li><li data-vishomercrd='liview'><a href='javascript:void(0)' data-vishomercrd='view' id="+u[e].AD_Note_ID+"|"+u[e].TableName+"|"+u[e].AD_Window_ID+"|"+u[e].Record_ID+" title='"+n.Msg.getMsg("View")+"'  class='vis-feedIcons vis-icon-viewFeed'>title='"+n.Msg.getMsg("View")+"'<\/a><\/li><\/ul>  <\/div><\/div><div data-vishomercrd='more-details' id="+u[e].AD_Note_ID+" class='vis-feedDetails'>"+c+" <p class='vis-feedDateTime'>"+n.Utility.encodeText(l)+"<\/p> <\/div> <\/div>"}else i.find(".vis-feedTitleBar").length==0&&(s=n.Application.isRTL?"<p style=' margin-top:200px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"<\/p>":"<p style=' margin-top:200px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"<\/p>",r==ht&&(tt.empty(),h.empty(),tt.hide(),tt.text(t.count),h.text(t.count)));et=!1;ti();wt.hide();r==ht&&i.append(s)}})}function ci(i,r){t.ajax({url:n.Application.contextUrl+"Home/ApproveNotice",data:{Ad_Note_ID:i,isAcknowldge:r},type:"POST",datatype:"json",success:function(n){var r=JSON.parse(n);t("#divrecdcntnr_"+i).animate({width:"0px",height:"132px","margin-left":"800px"},700,"",function(){t("#divrecdcntnr_"+i).remove()})}})}function ti(){b.off("click");b.on("click",function(ut){var ot,wt;if(a.show(),i.css({"margin-left":"auto","margin-top":"auto"}),t(".vis-welcomeScreenTabMenu li").removeClass("vis-activeTab"),ut.target.nodeName=="LI"?t(ut.target).addClass("vis-activeTab"):ut.target.nodeName=="A"&&t(ut.target.parentNode).addClass("vis-activeTab"),ot=t(ut.target).data("vishome"),ot==="userprofile")c.show(),c.css("background-position","0px 0px"),r=oi,k=!1,f=!0,t("li .vis-welcomeScreenTab-notificationBubbles").removeClass("blank").addClass("vis-feedsAlert"),t("li:first-child .vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t("li:last-child .vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t(".vis-welcomeScreenContainer > div").fadeOut("fast"),t(".vis-welcomeScreen-Data").fadeIn("fast"),v.hide(),p.hide(),w.hide(),y();else if(ot==="KPI")t(".vis-welcomeScreen-Data").hide("fast"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(""),c.show(),l.html(n.Msg.getMsg("KPI")),c.css("background-position","0px -537px"),window.VADB&&window.VADB!=null&&VADB.Apps.KpiHomeScreen!=undefined?(i.css({"text-align":"auto"}),r=hi,k=!1,f=!0,t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),a.css("margin-right","17px"),b.off("click"),VADB.Apps.KpiHomeScreen(i,bt,v,w,lt,ft,ii),w.hide(),y(),v.show(),p.hide()):(a.hide(),i.html(n.Msg.getMsg("PleaseInstallVADashboard")),n.Application.isRTL?i.css({"text-align":"center","margin-top":"200px"}):i.css({"text-align":"center","margin-top":"200px"}));else if(ot==="workflow")c.show(),b.off("click"),i.css("overflow-y","auto"),i.css({"text-align":"auto"}),r=ri,k=!1,f=!0,a.css("margin-right","17px"),c.css("background-position","0px -76px"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),w.hide(),y(),v.hide(),p.show(),l.empty(),l.append(n.Msg.getMsg("WorkflowActivities")),h.empty(),h.append(t("#divfActivity").html()),ft.empty(),ft.append(n.Msg.getMsg("Activity")),it(),d=0,e=g,u=nt,s=0,st=new n.wfActivity(i,lt,pt,i,p),st.Load(!1);else if(ot==="notice")c.show(),b.off("click"),r=ht,k=!1,f=!0,a.css("margin-right","17px"),i.css("overflow-y","auto"),i.css({"text-align":"auto"}),c.css("background-position","0px -143px"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(n.Msg.getMsg("Notice")),v.hide(),p.hide(),o=parseInt(tt.text()),tt.text(o),h.text(o),et==!1&&(d=0,e=10,u=1,s=0,it(),fi()),w.hide(),y();else if(ot==="mytask")t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(""),l.html(n.Msg.getMsg("MyTask")),c.css("background-position","0px -406px"),ct?(i.css({"text-align":"auto"}),b.off("click"),c.show(),r=gt,k=!1,f=!1,i.css("overflow-y","hidden"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),v.show(),p.hide(),h.html(t("#divMyTaskCount").html()),a.css("margin-right","17px"),WSP.wspHomeMgr.viewWSPHome(gt,f),w.hide(),y()):(a.hide(),i.html(n.Msg.getMsg("PleaseInstallWSPModule")),n.Application.isRTL?i.css({"text-align":"center","margin-top":"200px"}):i.css({"text-align":"center","margin-top":"200px"}));else if(ot==="taskassignbyme")t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(""),l.html(n.Msg.getMsg("TaskAssignByMe")),c.css("background-position","0px -340px"),ct?(i.css({"text-align":"auto"}),c.show(),b.off("click"),k=!1,f=!1,r=ni,i.css("overflow-y","hidden"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),v.show(),p.hide(),h.html(parseInt(t("#divTaskAssignBymeCount").html())),a.css("margin-right","17px"),WSP.wspHomeMgr.viewWSPHome(ni,f),w.hide(),y()):(a.hide(),i.html(n.Msg.getMsg("PleaseInstallWSPModule")),n.Application.isRTL?i.css({"text-align":"center","margin-top":"200px"}):i.css({"text-align":"center","margin-top":"200px"}));else if(ot==="documentrecive")c.show(),a.css("margin-right","17px"),a.hide(),r=si,k=!1,f=!0,w.hide(),y(),i.css("overflow-y","auto"),i.css({"text-align":"auto"}),l.html(n.Msg.getMsg("Documents")),o=0,h.html(o),c.css("background-position-y","-603px"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),it(),wt="<p style=' margin-top:200px;text-align:center'>"+n.Msg.getMsg("PleaseInstallDMSModule")+"<\/p>",i.html(wt),v.hide(),p.hide();else if(ot==="request"){c.show();b.off("click");r=at;k=!1;f=!0;i.css("overflow-y","auto");i.css({"text-align":"auto"});c.css("background-position","0px -209px");t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank");t(".vis-welcomeScreen-Data").hide("slow");t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)});v.show();p.hide();a.css("margin-right","17px");l.html(n.Msg.getMsg("Requests"));o=parseInt(rt.text());h.html(o);et==!1&&(d=0,e=g,u=nt,s=0,it(),ui());w.hide();y();v.off("click");v.on("click",function(){var i=ki("VIS_129"),t=new n.Query;t.addRestriction("R_Request_ID",n.Query.prototype.EQUAL,0);n.viewManager.startWindow(i,t)})}else ot==="appointments"?(t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(""),l.html(n.Msg.getMsg("Appointment")),c.css("background-position","0px -275px"),ct?(i.css({"text-align":"auto"}),b.off("click"),c.show(),r=vt,k=!1,f=!0,a.css("margin-right","17px"),i.css("overflow-y","auto"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),v.hide(),p.hide(),o=parseInt(dt.text()),h.html(o),d=0,e=g,u=nt,s=0,WSP.wspHomeMgr.viewWSPHome(vt,f),w.hide(),y()):(a.hide(),i.html(n.Msg.getMsg("PleaseInstallWSPModule")),n.Application.isRTL?i.css({"text-align":"center","margin-top":"200px"}):i.css({"text-align":"center","margin-top":"200px"}))):ot==="notes"&&(t(".vis-welcomeScreen-Data").hide("slow"),t(".vis-welcomeScreenFeeds").fadeIn("fast",function(){setTimeout(function(){},0)}),l.html(""),l.html(n.Msg.getMsg("MyNotes")),c.css("background-position","0px -473px"),ct?(i.css({"text-align":"auto"}),b.off("click"),r=yt,c.show(),k=!1,f=!0,a.css("margin-right","17px"),i.css("overflow-y","auto"),t(".vis-welcomeScreenTab-notificationBubbles").removeClass("vis-feedsAlert").addClass("blank"),v.show(),p.hide(),o=parseInt(kt.text()),h.html(o),d=0,e=g,u=nt,s=0,it(),WSP.wspHomeMgr.viewWSPHome(yt,f),w.hide(),y()):(a.hide(),i.html(n.Msg.getMsg("PleaseInstallWSPModule")),n.Application.isRTL?i.css({"text-align":"center","margin-top":"200px"}):i.css({"text-align":"center","margin-top":"200px"})))})}function it(){i.children().length>0&&i.children().remove();i.empty()}var ei=null,ot=null,ut=null,pt=null,li=null,ai=null,i=null,a=null,vi=null,r=null,w=null,ct=null,bt=null,lt=null,ft=null,st=null,et=null,f=null,b=null,wt=null,tt=null,rt=null,kt=null,dt=null,ii=null,l=null,h=null,c=null,yi=null,pi=13,oi=1,at=2,ri=3,vt=4,gt=5,ni=6,si=7,ht=8,yt=9,hi=10,g=10,nt=1,k=null,d=null,e=null,u=null,o=null,s=null,v=null,p=null,wi=n.Application.contextUrl,bi=wi+"JsonData/JDataSetWithCode",ki=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u=null;return di(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u};return t(".vis-icon-Info-Home").click(function(){n.InfoMenu.show(t(this))}),{initHome:gi,adjustDivSize:y,BindMenuClick:ti,getActiveTab:ir}}n.HomeMgr=i()}(VIS,jQuery),function(n,t){function i(){function e(){i=t("#vis-textStatus");t.ajax({url:n.Application.contextUrl+"Home/SaveStatus",dataType:"json",type:"POST",async:!1,data:{status:i.val()},success:function(n){JSON.parse(n).length>0?(i.css("visibility","hidden"),f.css("visibility","hidden"),u.css("visibility","hidden"),r.css("visibility","visible"),r.text(JSON.parse(n))):(i.css("visibility","visible"),f.css("visibility","hidden"),u.css("visibility","hidden"),r.css("visibility","visible"),r.text(JSON.parse(n)))}})}var i=t("#vis-textStatus"),u=t("#vis-img-OKStatus"),f=t("#vis-img-CancelStatus"),r=t("#vis-labelStatus");t("#vis-file-input").change(function(){if(document.getElementById("vis-file-input").files[0]!=null){var i=new XMLHttpRequest,r=new FormData;r.append("file",document.getElementById("vis-file-input").files[0]);i.open("POST",n.Application.contextUrl+"Home/SaveImageAsByte",!0);i.send(r);i.addEventListener("load",function(n){var i=n.target.response,r=JSON.parse(i),u=JSON.parse(r);t("#imgUsrImage").attr("src","data:image/jpg;base64,"+u)},!1)}});u.on("click",function(){e()});f.on("click",function(){i.css("visibility","hidden");f.css("visibility","hidden");u.css("visibility","hidden");r.css("visibility","visible")});i.on("focus",function(){f.css("visibility","visible");u.css("visibility","visible")});i.on("keypress",function(n){var t=n.keyCode||n.which;t==13&&e()});i.on("blur",function(){});r.on("click",function(){r.css("visibility","hidden");i.css("visibility","visible");i.val(r.text());i.focus()})}n.changeUserImage=i}(VIS,jQuery),function(n,t){function r(){function o(t,i){f=t;r=f.find("#vis_linkScroll");n.favMgr.init(i);s();h()}function s(){n.dataContext.getJSONData(n.Application.contextUrl+"Home/GetShortcutItems",null,function(t){var i,f,e;if(u=t,i=null,f='<ul class="vis-userLinks-ListMenu">',t)for(e=0;e<t.length;e++)i=t[e],f+='<li data-index="'+e+'" ><a data-index="'+e+'" href="javascript:void(0)"><img data-index="'+e+'" style="width: 54px;height: 63px;margin-bottom: 10px;margin-right: auto;margin-left: auto;display:block;" src="',i.HasImage&&(f+=i.IsImageByteArray?"data:image/*;base64,"+i.IconBytes:n.Application.contextUrl+i.IconUrl),f+='" />',f+=i.ShortcutName+"<\/a><\/li>";f+="<\/ul>";r.empty();r.html(f);c(t.length)})}function h(){r.on("click",function(r){var o=t(r.target).data("index"),f,h,s,a,l,c;if((o||o=="0")&&o<u.length)if(f=u[o],f.HasChild)h=new i(f.KeyID),h.show(),h=null;else if(f.Url||f.Url.length>0)n.Env.startBrowser(f.Url);else if(f.SpecialAction&&f.SpecialAction.length>0){s=f.SpecialAction;a=f.ActionName;try{l=n.Utility.getFunctionByName(s,window);c=new l;c.show();c=null}catch(r){return e.log(n.Logging.Level.WARNING,"Class="+s+", Action Class Name="+s,r),!1}}else{if(f.Action==null||f.Action.length<=0||f.ActionID<1)return;n.viewManager.startAction(f.Action,f.ActionID)}})}function c(i){var r=t("#userLinks-Tab");r.empty();r.append(t("<span class='vis-linksIcons vis-icon-link'>"));r.append(n.Msg.getMsg("Links")+" - ");r.append(t("<strong>").append(i));r=null}var f,r,u=null,e=n.Logging.VLogger.getVLogger("ShortCut");return{init:o}}function i(i){function s(){n.dataContext.getJSONData(n.Application.contextUrl+"Home/GetSettingItems",{AD_Shortcut_ID:i},function(t){var i,r,e;if(u=t,i=null,r='<ul class="vis-userLinks-ListMenu">',t)for(e=0;e<t.length;e++)i=t[e],r+='<li data-index="'+e+'" ><a data-index="'+e+'" href="javascript:void(0)"><img data-index="'+e+'" style="width: 54px;margin-bottom: 10px;height: 63px;display:block;margin-right: auto;margin-left: auto" src="',i.HasImage&&(r+=i.IsImageByteArray?"data:image/*;base64,"+i.IconBytes:n.Application.contextUrl+i.IconUrl),r+='" />',r+=i.ShortcutName+"<\/a><\/li>";r+="<\/ul>";f.empty();f.html(r);h()})}function h(){f.on("click",function(i){var e=t(i.target).data("index"),f,s,l,c,h;if((e||e=="0")&&e<u.length){if(f=u[e],f.HasChild)n.Msg.getMsg("settingDialog");else if(f.Url||f.Url.length>0)n.Env.startBrowser(f.Url);else if(f.SpecialAction&&f.SpecialAction.length>0){s=f.SpecialAction;l=f.ActionName;try{c=n.Utility.getFunctionByName(s,window);h=new c;h.show();h=null}catch(i){return o.log(n.Logging.Level.WARNING,"Class="+s+", Action Class Name="+s,i),!1}}else{if(f.Action==null||f.Action.length<=0||f.ActionID<1)return;n.viewManager.startAction(f.Action,f.ActionID)}r.close()}})}var e=t("<div>"),f=t('<div style="width:auto;z-index:1">').html('<div class="vis-apanel-busy" style="height:280px;position:static"> <\/div>'),o=n.Logging.VLogger.getVLogger("SettingDialog"),r,u;e.append(f);r=null;u=null;this.show=function(){r=new n.ChildDialog;r.setWidth(540);r.setHeight(400);r.setTitle(n.Msg.getMsg("Setting"));r.setContent(e);r.show()};this.disposeComponent=function(){f.off("click");f.remove();u&&(u.length=0);u=null;this.show=null;e=null;r&&r.dispose()};s()}i.prototype.dispose=function(){this.disposeComponent()};n.shortcutMgr=r()}(VIS,jQuery),function(n,t){var i=n.historyMgr||{},r;"replaceState"in history?i.replaceHash=function(n){(""+n).charAt(0)!=="#"&&(n="#"+n);history.replaceState("","",n)}:(r=location.hash,i.replaceHash=function(n){location.hash!==r&&history.back();location.hash=n});i.updateHistory=function(n){i.replaceHash(n)};i.restoreHistory=function(){var n=i.geHashtLocation();t.viewManager.restoreActions(n)};i.geHashtLocation=function(){var n=location.hash;return n.length>1?n.substring(1):""};n.historyMgr=i}(window,VIS);var CryptoJS=CryptoJS||function(n,t){var u={},f=u.lib={},o=function(){},i=f.Base={extend:function(n){o.prototype=this;var t=new o;return n&&t.mixIn(n),t.hasOwnProperty("init")||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var n=this.extend();return n.init.apply(n,arguments),n},init:function(){},mixIn:function(n){for(var t in n)n.hasOwnProperty(t)&&(this[t]=n[t]);n.hasOwnProperty("toString")&&(this.toString=n.toString)},clone:function(){return this.init.prototype.extend(this)}},r=f.WordArray=i.extend({init:function(n,i){n=this.words=n||[];this.sigBytes=i!=t?i:4*n.length},toString:function(n){return(n||l).stringify(this)},concat:function(n){var i=this.words,r=n.words,u=this.sigBytes,t;if(n=n.sigBytes,this.clamp(),u%4)for(t=0;t<n;t++)i[u+t>>>2]|=(r[t>>>2]>>>24-8*(t%4)&255)<<24-8*((u+t)%4);else if(65535<r.length)for(t=0;t<n;t+=4)i[u+t>>>2]=r[t>>>2];else i.push.apply(i,r);return this.sigBytes+=n,this},clamp:function(){var i=this.words,t=this.sigBytes;i[t>>>2]&=4294967295<<32-8*(t%4);i.length=n.ceil(t/4)},clone:function(){var n=i.clone.call(this);return n.words=this.words.slice(0),n},random:function(t){for(var i=[],u=0;u<t;u+=4)i.push(4294967296*n.random()|0);return new r.init(i,t)}}),e=u.enc={},l=e.Hex={stringify:function(n){var u=n.words,i,t,r;for(n=n.sigBytes,i=[],t=0;t<n;t++)r=u[t>>>2]>>>24-8*(t%4)&255,i.push((r>>>4).toString(16)),i.push((r&15).toString(16));return i.join("")},parse:function(n){for(var i=n.length,u=[],t=0;t<i;t+=2)u[t>>>3]|=parseInt(n.substr(t,2),16)<<24-4*(t%8);return new r.init(u,i/2)}},s=e.Latin1={stringify:function(n){var r=n.words,i,t;for(n=n.sigBytes,i=[],t=0;t<n;t++)i.push(String.fromCharCode(r[t>>>2]>>>24-8*(t%4)&255));return i.join("")},parse:function(n){for(var i=n.length,u=[],t=0;t<i;t++)u[t>>>2]|=(n.charCodeAt(t)&255)<<24-8*(t%4);return new r.init(u,i)}},a=e.Utf8={stringify:function(n){try{return decodeURIComponent(escape(s.stringify(n)))}catch(t){throw Error("Malformed UTF-8 data");}},parse:function(n){return s.parse(unescape(encodeURIComponent(n)))}},h=f.BufferedBlockAlgorithm=i.extend({reset:function(){this._data=new r.init;this._nDataBytes=0},_append:function(n){"string"==typeof n&&(n=a.parse(n));this._data.concat(n);this._nDataBytes+=n.sigBytes},_process:function(t){var e=this._data,s=e.words,u=e.sigBytes,o=this.blockSize,f=u/(4*o),f=t?n.ceil(f):n.max((f|0)-this._minBufferSize,0),i;if(t=f*o,u=n.min(4*t,u),t){for(i=0;i<t;i+=o)this._doProcessBlock(s,i);i=s.splice(0,t);e.sigBytes-=u}return new r.init(i,u)},clone:function(){var n=i.clone.call(this);return n._data=this._data.clone(),n},_minBufferSize:0}),c;return f.Hasher=h.extend({cfg:i.extend(),init:function(n){this.cfg=this.cfg.extend(n);this.reset()},reset:function(){h.reset.call(this);this._doReset()},update:function(n){return this._append(n),this._process(),this},finalize:function(n){return n&&this._append(n),this._doFinalize()},blockSize:16,_createHelper:function(n){return function(t,i){return new n.init(i).finalize(t)}},_createHmacHelper:function(n){return function(t,i){return new c.HMAC.init(n,i).finalize(t)}}}),c=u.algo={},u}(Math);(function(){var n=CryptoJS,t=n.lib.WordArray;n.enc.Base64={stringify:function(n){var i=n.words,u=n.sigBytes,f=this._map,t,e,r;for(n.clamp(),n=[],t=0;t<u;t+=3)for(e=(i[t>>>2]>>>24-8*(t%4)&255)<<16|(i[t+1>>>2]>>>24-8*((t+1)%4)&255)<<8|i[t+2>>>2]>>>24-8*((t+2)%4)&255,r=0;4>r&&t+.75*r<u;r++)n.push(f.charAt(e>>>6*(3-r)&63));if(i=f.charAt(64))for(;n.length%4;)n.push(i);return n.join("")},parse:function(n){var e=n.length,f=this._map,i=f.charAt(64),o,s;i&&(i=n.indexOf(i),-1!=i&&(e=i));for(var i=[],u=0,r=0;r<e;r++)r%4&&(o=f.indexOf(n.charAt(r-1))<<2*(r%4),s=f.indexOf(n.charAt(r))>>>6-2*(r%4),i[u>>>2]|=(o|s)<<24-8*(u%4),u++);return t.create(i,u)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}})(),function(n){function i(n,t,i,r,u,f,e){return n=n+(t&i|~t&r)+u+e,(n<<f|n>>>32-f)+t}function r(n,t,i,r,u,f,e){return n=n+(t&r|i&~r)+u+e,(n<<f|n>>>32-f)+t}function u(n,t,i,r,u,f,e){return n=n+(t^i^r)+u+e,(n<<f|n>>>32-f)+t}function f(n,t,i,r,u,f,e){return n=n+(i^(t|~r))+u+e,(n<<f|n>>>32-f)+t}for(var o=CryptoJS,e=o.lib,c=e.WordArray,s=e.Hasher,e=o.algo,t=[],h=0;64>h;h++)t[h]=4294967296*n.abs(n.sin(h+1))|0;e=e.MD5=s.extend({_doReset:function(){this._hash=new c.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(n,e){for(var v,a,l=0;16>l;l++)v=e+l,a=n[v],n[v]=(a<<8|a>>>24)&16711935|(a<<24|a>>>8)&4278255360;var l=this._hash.words,v=n[e+0],a=n[e+1],y=n[e+2],p=n[e+3],w=n[e+4],b=n[e+5],k=n[e+6],d=n[e+7],g=n[e+8],nt=n[e+9],tt=n[e+10],it=n[e+11],rt=n[e+12],ut=n[e+13],ft=n[e+14],et=n[e+15],o=l[0],s=l[1],h=l[2],c=l[3],o=i(o,s,h,c,v,7,t[0]),c=i(c,o,s,h,a,12,t[1]),h=i(h,c,o,s,y,17,t[2]),s=i(s,h,c,o,p,22,t[3]),o=i(o,s,h,c,w,7,t[4]),c=i(c,o,s,h,b,12,t[5]),h=i(h,c,o,s,k,17,t[6]),s=i(s,h,c,o,d,22,t[7]),o=i(o,s,h,c,g,7,t[8]),c=i(c,o,s,h,nt,12,t[9]),h=i(h,c,o,s,tt,17,t[10]),s=i(s,h,c,o,it,22,t[11]),o=i(o,s,h,c,rt,7,t[12]),c=i(c,o,s,h,ut,12,t[13]),h=i(h,c,o,s,ft,17,t[14]),s=i(s,h,c,o,et,22,t[15]),o=r(o,s,h,c,a,5,t[16]),c=r(c,o,s,h,k,9,t[17]),h=r(h,c,o,s,it,14,t[18]),s=r(s,h,c,o,v,20,t[19]),o=r(o,s,h,c,b,5,t[20]),c=r(c,o,s,h,tt,9,t[21]),h=r(h,c,o,s,et,14,t[22]),s=r(s,h,c,o,w,20,t[23]),o=r(o,s,h,c,nt,5,t[24]),c=r(c,o,s,h,ft,9,t[25]),h=r(h,c,o,s,p,14,t[26]),s=r(s,h,c,o,g,20,t[27]),o=r(o,s,h,c,ut,5,t[28]),c=r(c,o,s,h,y,9,t[29]),h=r(h,c,o,s,d,14,t[30]),s=r(s,h,c,o,rt,20,t[31]),o=u(o,s,h,c,b,4,t[32]),c=u(c,o,s,h,g,11,t[33]),h=u(h,c,o,s,it,16,t[34]),s=u(s,h,c,o,ft,23,t[35]),o=u(o,s,h,c,a,4,t[36]),c=u(c,o,s,h,w,11,t[37]),h=u(h,c,o,s,d,16,t[38]),s=u(s,h,c,o,tt,23,t[39]),o=u(o,s,h,c,ut,4,t[40]),c=u(c,o,s,h,v,11,t[41]),h=u(h,c,o,s,p,16,t[42]),s=u(s,h,c,o,k,23,t[43]),o=u(o,s,h,c,nt,4,t[44]),c=u(c,o,s,h,rt,11,t[45]),h=u(h,c,o,s,et,16,t[46]),s=u(s,h,c,o,y,23,t[47]),o=f(o,s,h,c,v,6,t[48]),c=f(c,o,s,h,d,10,t[49]),h=f(h,c,o,s,ft,15,t[50]),s=f(s,h,c,o,b,21,t[51]),o=f(o,s,h,c,rt,6,t[52]),c=f(c,o,s,h,p,10,t[53]),h=f(h,c,o,s,tt,15,t[54]),s=f(s,h,c,o,a,21,t[55]),o=f(o,s,h,c,g,6,t[56]),c=f(c,o,s,h,et,10,t[57]),h=f(h,c,o,s,k,15,t[58]),s=f(s,h,c,o,ut,21,t[59]),o=f(o,s,h,c,w,6,t[60]),c=f(c,o,s,h,it,10,t[61]),h=f(h,c,o,s,y,15,t[62]),s=f(s,h,c,o,nt,21,t[63]);l[0]=l[0]+o|0;l[1]=l[1]+s|0;l[2]=l[2]+h|0;l[3]=l[3]+c|0},_doFinalize:function(){var u=this._data,r=u.words,t=8*this._nDataBytes,i=8*u.sigBytes,f;for(r[i>>>5]|=128<<24-i%32,f=n.floor(t/4294967296),r[(i+64>>>9<<4)+15]=(f<<8|f>>>24)&16711935|(f<<24|f>>>8)&4278255360,r[(i+64>>>9<<4)+14]=(t<<8|t>>>24)&16711935|(t<<24|t>>>8)&4278255360,u.sigBytes=4*(r.length+1),this._process(),u=this._hash,r=u.words,t=0;4>t;t++)i=r[t],r[t]=(i<<8|i>>>24)&16711935|(i<<24|i>>>8)&4278255360;return u},clone:function(){var n=s.clone.call(this);return n._hash=this._hash.clone(),n}});o.MD5=s._createHelper(e);o.HmacMD5=s._createHmacHelper(e)}(Math),function(){var t=CryptoJS,n=t.lib,i=n.Base,r=n.WordArray,n=t.algo,u=n.EvpKDF=i.extend({cfg:i.extend({keySize:4,hasher:n.MD5,iterations:1}),init:function(n){this.cfg=this.cfg.extend(n)},compute:function(n,t){for(var i,o,u=this.cfg,f=u.hasher.create(),e=r.create(),h=e.words,s=u.keySize,u=u.iterations;h.length<s;){for(i&&f.update(i),i=f.update(n).finalize(t),f.reset(),o=1;o<u;o++)i=f.finalize(i),f.reset();e.concat(i)}return e.sigBytes=4*s,e}});t.EvpKDF=function(n,t,i){return u.create(i).compute(n,t)}}();CryptoJS.lib.Cipher||function(n){var i=CryptoJS,t=i.lib,f=t.Base,e=t.WordArray,c=t.BufferedBlockAlgorithm,l=i.enc.Base64,y=i.algo.EvpKDF,s=t.Cipher=c.extend({cfg:f.extend(),createEncryptor:function(n,t){return this.create(this._ENC_XFORM_MODE,n,t)},createDecryptor:function(n,t){return this.create(this._DEC_XFORM_MODE,n,t)},init:function(n,t,i){this.cfg=this.cfg.extend(i);this._xformMode=n;this._key=t;this.reset()},reset:function(){c.reset.call(this);this._doReset()},process:function(n){return this._append(n),this._process()},finalize:function(n){return n&&this._append(n),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(n){return{encrypt:function(t,i,r){return("string"==typeof i?v:u).encrypt(n,t,i,r)},decrypt:function(t,i,r){return("string"==typeof i?v:u).decrypt(n,t,i,r)}}}});t.StreamCipher=s.extend({_doFinalize:function(){return this._process(!0)},blockSize:1});var o=i.mode={},a=function(t,i,r){var f=this._iv,u;for(f?this._iv=n:f=this._prevBlock,u=0;u<r;u++)t[i+u]^=f[u]},r=(t.BlockCipherMode=f.extend({createEncryptor:function(n,t){return this.Encryptor.create(n,t)},createDecryptor:function(n,t){return this.Decryptor.create(n,t)},init:function(n,t){this._cipher=n;this._iv=t}})).extend();r.Encryptor=r.extend({processBlock:function(n,t){var i=this._cipher,r=i.blockSize;a.call(this,n,t,r);i.encryptBlock(n,t);this._prevBlock=n.slice(t,t+r)}});r.Decryptor=r.extend({processBlock:function(n,t){var i=this._cipher,r=i.blockSize,u=n.slice(t,t+r);i.decryptBlock(n,t);a.call(this,n,t,r);this._prevBlock=u}});o=o.CBC=r;r=(i.pad={}).Pkcs7={pad:function(n,t){for(var i=4*t,i=i-n.sigBytes%i,f=i<<24|i<<16|i<<8|i,r=[],u=0;u<i;u+=4)r.push(f);i=e.create(r,i);n.concat(i)},unpad:function(n){n.sigBytes-=n.words[n.sigBytes-1>>>2]&255}};t.BlockCipher=s.extend({cfg:s.cfg.extend({mode:o,padding:r}),reset:function(){var t;s.reset.call(this);var n=this.cfg,i=n.iv,n=n.mode;this._xformMode==this._ENC_XFORM_MODE?t=n.createEncryptor:(t=n.createDecryptor,this._minBufferSize=1);this._mode=t.call(n,this,i&&i.words)},_doProcessBlock:function(n,t){this._mode.processBlock(n,t)},_doFinalize:function(){var t=this.cfg.padding,n;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),n=this._process(!0)):(n=this._process(!0),t.unpad(n)),n},blockSize:4});var h=t.CipherParams=f.extend({init:function(n){this.mixIn(n)},toString:function(n){return(n||this.formatter).stringify(this)}}),o=(i.format={}).OpenSSL={stringify:function(n){var t=n.ciphertext;return n=n.salt,(n?e.create([1398893684,1701076831]).concat(n).concat(t):t).toString(l)},parse:function(n){var t,i;return n=l.parse(n),t=n.words,1398893684==t[0]&&1701076831==t[1]&&(i=e.create(t.slice(2,4)),t.splice(0,4),n.sigBytes-=16),h.create({ciphertext:n,salt:i})}},u=t.SerializableCipher=f.extend({cfg:f.extend({format:o}),encrypt:function(n,t,i,r){r=this.cfg.extend(r);var u=n.createEncryptor(i,r);return t=u.finalize(t),u=u.cfg,h.create({ciphertext:t,key:i,iv:u.iv,algorithm:n,mode:u.mode,padding:u.padding,blockSize:n.blockSize,formatter:r.format})},decrypt:function(n,t,i,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),n.createDecryptor(i,r).finalize(t.ciphertext)},_parse:function(n,t){return"string"==typeof n?t.parse(n,this):n}}),i=(i.kdf={}).OpenSSL={execute:function(n,t,i,r){return r||(r=e.random(8)),n=y.create({keySize:t+i}).compute(n,r),i=e.create(n.words.slice(t),4*i),n.sigBytes=4*t,h.create({key:n,iv:i,salt:r})}},v=t.PasswordBasedCipher=u.extend({cfg:u.cfg.extend({kdf:i}),encrypt:function(n,t,i,r){return r=this.cfg.extend(r),i=r.kdf.execute(i,n.keySize,n.ivSize),r.iv=i.iv,n=u.encrypt.call(this,n,t,i.key,r),n.mixIn(i),n},decrypt:function(n,t,i,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),i=r.kdf.execute(i,n.keySize,n.ivSize,t.salt),r.iv=i.iv,u.decrypt.call(this,n,t,i.key,r)}})}(),function(){for(var i,tt,h=CryptoJS,y=h.lib.BlockCipher,o=h.algo,t=[],p=[],w=[],b=[],k=[],d=[],c=[],l=[],a=[],v=[],u=[],f=0;256>f;f++)u[f]=128>f?f<<1:f<<1^283;for(var r=0,e=0,f=0;256>f;f++){i=e^e<<1^e<<2^e<<3^e<<4;i=i>>>8^i&255^99;t[r]=i;p[i]=r;var s=u[r],g=u[s],nt=u[g],n=257*u[i]^16843008*i;w[r]=n<<24|n>>>8;b[r]=n<<16|n>>>16;k[r]=n<<8|n>>>24;d[r]=n;n=16843009*nt^65537*g^257*s^16843008*r;c[i]=n<<24|n>>>8;l[i]=n<<16|n>>>16;a[i]=n<<8|n>>>24;v[i]=n;r?(r=s^u[u[u[nt^s]]],e^=u[u[e]]):r=e=1}tt=[0,1,2,4,8,16,32,64,128,27,54];o=o.AES=y.extend({_doReset:function(){for(var n,u=this._key,e=u.words,r=u.sigBytes/4,u=4*((this._nRounds=r+6)+1),f=this._keySchedule=[],i=0;i<u;i++)i<r?f[i]=e[i]:(n=f[i-1],i%r?6<r&&4==i%r&&(n=t[n>>>24]<<24|t[n>>>16&255]<<16|t[n>>>8&255]<<8|t[n&255]):(n=n<<8|n>>>24,n=t[n>>>24]<<24|t[n>>>16&255]<<16|t[n>>>8&255]<<8|t[n&255],n^=tt[i/r|0]<<24),f[i]=f[i-r]^n);for(e=this._invKeySchedule=[],r=0;r<u;r++)i=u-r,n=r%4?f[i]:f[i-4],e[r]=4>r||4>=i?n:c[t[n>>>24]]^l[t[n>>>16&255]]^a[t[n>>>8&255]]^v[t[n&255]]},encryptBlock:function(n,i){this._doCryptBlock(n,i,this._keySchedule,w,b,k,d,t)},decryptBlock:function(n,t){var i=n[t+1];n[t+1]=n[t+3];n[t+3]=i;this._doCryptBlock(n,t,this._invKeySchedule,c,l,a,v,p);i=n[t+1];n[t+1]=n[t+3];n[t+3]=i},_doCryptBlock:function(n,t,i,r,u,f,e,o){for(var b=this._nRounds,h=n[t]^i[0],c=n[t+1]^i[1],l=n[t+2]^i[2],s=n[t+3]^i[3],a=4,w=1;w<b;w++)var v=r[h>>>24]^u[c>>>16&255]^f[l>>>8&255]^e[s&255]^i[a++],y=r[c>>>24]^u[l>>>16&255]^f[s>>>8&255]^e[h&255]^i[a++],p=r[l>>>24]^u[s>>>16&255]^f[h>>>8&255]^e[c&255]^i[a++],s=r[s>>>24]^u[h>>>16&255]^f[c>>>8&255]^e[l&255]^i[a++],h=v,c=y,l=p;v=(o[h>>>24]<<24|o[c>>>16&255]<<16|o[l>>>8&255]<<8|o[s&255])^i[a++];y=(o[c>>>24]<<24|o[l>>>16&255]<<16|o[s>>>8&255]<<8|o[h&255])^i[a++];p=(o[l>>>24]<<24|o[s>>>16&255]<<16|o[h>>>8&255]<<8|o[c&255])^i[a++];s=(o[s>>>24]<<24|o[h>>>16&255]<<16|o[c>>>8&255]<<8|o[l&255])^i[a++];n[t]=v;n[t+1]=y;n[t+2]=p;n[t+3]=s},keySize:8});h.AES=y._createHelper(o)}(),function(n,t){var i=t.enc.Utf8.parse(n.context.getContext("#key")),r=t.enc.Utf8.parse(n.context.getContext("#key"));n.secureEngine={encrypt:function(n){var u="";return(n||n===0)&&(u=t.AES.encrypt(t.enc.Utf8.parse(n.toString()),i,{keySize:16,iv:r,mode:t.mode.CBC,padding:t.pad.Pkcs7})),u.toString()},decrypt:function(n){var u="";return(n||n.length>12)&&(u=t.AES.decrypt(n,i,{keySize:16,iv:r,mode:t.mode.CBC,padding:t.pad.Pkcs7})),u.toString(t.enc.Utf8)},isEncrypted:function(n){if(n||n.length>12)return!0}}}(VIS,CryptoJS),function(n,t){function i(i){this.frame;this.windowNo;var hi=null,tr=null,ci=null,it=null,ht=null,ct=null,lt=null,ir=null,w=null,at=null,li=null,wr=null,rt=null,vt=null,b=null,yt=null,ut=null,rr=null,ur=null,k=null,pt=null,wt=null,ai=null,vi=null,ft=null,et=null,ot=null,fr=null,yi=null,pi=this,br=null,wi=null,bt=null,kt=null,er=null,or=null,sr=null,hr=null,bi=null,ki=null,cr=null,lr=null,ar=null,kr=null,c=null,f=null,dr=null,gr=null,dt=null,nu=null,gt=null,d=null,ni=null,e=null,di=null,ti=!1,tu=null,ii=null,y=null,g=null,o=null,st=null,ri=!1,iu=null,ui=null,nt=null,u=null,fi=!1,ei=null,oi=null,si=null,gi=null,nr=null,u=null,ru=null,l=null,a=null,h=null,p=null,v=null,s=t("<div class='vis-forms-container'>"),tt=t("<div class='vis-apanel-busy'>"),r=n.Env.getWindowNo();this.log=n.Logging.VLogger.getVLogger("UserPreference");this.load=function(){s.load(n.Application.contextUrl+"UserPreference/Index/?windowno="+r+"&adUserId="+n.context.getAD_User_ID(),function(){tt[0].style.visibility="visible";pi.init(s);var n=s.find("#content_"+r);n!=null;tt[0].style.visibility="hidden"})};this.init=function(pi){function ku(n){tt[0].style.visibility=n?"visible":"hidden"}function ke(n){var t=new Date,i=("0"+t.getDate()).slice(-2),r=("0"+(t.getMonth()+1)).slice(-2),u=t.getFullYear()+"-"+r+"-"+i;n.val(u)}function fo(){t.ajax({type:"POST",async:!1,url:n.Application.contextUrl+"UserPreference/GetSavedDetail",dataType:"json",data:{isTask:!0},success:function(t){ri=!1;ti=!1;fi=!1;var i=JSON.parse(t);i.IsSyncInBackground=="false"?(ni.prop("checked",!1),di=!1):(ni.prop("checked",!0),di=!0);i.IsCalSyncInBackground=="false"?(g.prop("checked",!1),st=!1):(g.prop("checked",!0),st=!0);d.val(i.TaskAuthCode);d.val().length>0&&(gt.html(n.Msg.getMsg("RemoveLink")),ti=!0);y.val(i.CalendarAuthCode);y.val().length>0&&(ii.html(n.Msg.getMsg("RemoveLink")),ri=!0);nt.val(i.ContactAuthCode);nt.val().length>0&&(ui.html(n.Msg.getMsg("RemoveLink")),fi=!0)}})}function du(i,r){t.ajax({type:"POST",async:!1,url:n.Application.contextUrl+"UserPreference/GetGmailAuthorizationCode",dataType:"json",data:{isTask:i,isContact:r},success:function(n){var t=JSON.parse(n);t!=null&&t.length>0&&window.open(t)}})}function gu(i,r,f,s,h){t.ajax({type:"POST",async:!1,url:n.Application.contextUrl+"UserPreference/SaveGmailAccountSettings",dataType:"json",data:{authCodes:f,isTask:i,isSyncInBackground:r,isRemoveLink:s,isContact:h},success:function(t){var r=JSON.parse(t);i?r.toString()=="false"?(e.css("color","red"),e.text(n.Msg.getMsg("RecordNotSaved")),e.show()):r.toString()=="true"?(e.css("color","green"),e.text(n.Msg.getMsg("RecordSaved")),s?(d.val(""),gt.html(n.Msg.getMsg("Save")),ni.prop("checked",!1),ti=!1,d.removeAttr("disabled"),e.text(n.Msg.getMsg("LinkRemoved"))):(gt.html(n.Msg.getMsg("RemoveLink")),d.attr("disabled",!0),ti=!0),e.show()):window.open(r):h?r.toString()=="false"?(u.css("color","red"),u.text(n.Msg.getMsg("RecordNotSaved")),u.show()):r.toString()=="true"?(u.css("color","green"),u.text(n.Msg.getMsg("RecordSaved")),s?(nt.val(""),ui.html(n.Msg.getMsg("Save")),fi=!1,nt.removeAttr("disabled"),u.text(n.Msg.getMsg("LinkRemoved"))):(ui.html(n.Msg.getMsg("RemoveLink")),nt.attr("disabled",!0),fi=!0),u.show()):window.open(r):r.toString()=="false"?(o.css("color","red"),o.text(n.Msg.getMsg("RecordNotSaved")),o.show()):r.toString()=="true"?(o.css("color","green"),o.text(n.Msg.getMsg("RecordSaved")),s?(y.val(""),ii.html(n.Msg.getMsg("Save")),g.prop("checked",!1),ri=!1,y.removeAttr("disabled"),o.text(n.Msg.getMsg("LinkRemoved"))):(ii.html(n.Msg.getMsg("RemoveLink")),y.attr("disabled",!0),ri=!0),o.show()):window.open(r)}})}function eo(){so();si!=null&&si.append(yu);oo()}function oo(){var i=n.Application.contextUrl+"WSP/ContactSettings/GetSavedDetail";t.ajax({type:"GET",async:!1,url:i,dataType:"json",success:function(n){var t=JSON.parse(n),i;ei.val(t.Username);oi.val(t.Password);t.Role!=""&&si.val(t.Role);i=t.IsUpdate;i.toString().toLowerCase()=="false"?(gi.prop("checked",!1),nr=!1):(gi.prop("checked",!0),nr=!0)}})}function so(){var i=n.Application.contextUrl+"WSP/ContactSettings/GetRole";t.ajax({type:"GET",async:!1,url:i,dataType:"json",success:function(t){var r=JSON.parse(t),i;for(yu+="<option value='-1'  selected='selected'>"+n.Msg.getMsg("SelectRole")+"<\/option>",i=0;i<r.length;i++)yu+="<option value='"+r[i].RoleID+"'>"+r[i].RoleName+"<\/option>"}})}function ho(i,r,f,e){var o=n.Application.contextUrl+"WSP/ContactSettings/SaveGmailContactSettings";t.ajax({type:"POST",async:!1,url:o,dataType:"json",data:{username:i,password:r,role_ID:f,isUpdateExisting:e},success:function(t){var i=JSON.parse(t);i.toString()=="false"?(u.css("color","red"),u.text(n.Msg.getMsg("RecordNotSaved")),u.show()):(u.css("color","green"),u.text(n.Msg.getMsg("RecordSaved")),u.show())}})}function de(){var r,u,t,i,f;n.Env.getCtx().setContext("AutoCommit",hi.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_A_NEW,ct.prop("checked")?"Y":"N");n.Env.getCtx().setContext("AutoNew",ct.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACEFILE,at.prop("checked")?"Y":"N");r=w.find("option:selected").val();u=n.Logging.Level.prototype.getLevel(r);n.Logging.VLogMgt.setLevel(u);n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACELEVEL,w.find("option:selected").val());t=rt[0].selectedIndex;n.Ini.setValueToLocalStorage(n.IniConstants.CO_SHOWLEVEL,t<0?0:t);n.Env.getCtx().setContext("#ClientOrgLevel",t<0?0:t);n.Ini.setValueToLocalStorage(n.IniConstants.W_PAGESIZE,b.find("option:selected").val());n.Env.getCtx().setContext("#ShowWorkSpacePageSize",b.find("option:selected").val());i=ut.find("option:selected").val();n.Ini.setValueToLocalStorage(n.IniConstants.WIN_PAGESIZE,i);n.Env.setWINDOW_PAGE_SIZE(i);n.Ini.setValueToLocalStorage(n.IniConstants.P_Show_Mini_Grid,vt.prop("checked")?"Y":"N");n.Env.getCtx().setContext("#ShowMiniGrid",vt.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_Print_Native_Digits,yt.prop("checked")?"Y":"N");n.Env.getCtx().setContext("#PrintNativeDigits",yt.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_A_LOGIN,ci.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_STORE_PWD,tr.prop("checked")?"Y":"N");n.Env.getCtx().setContext("#ShowAcct",ht.prop("checked")?"Y":"N");n.Env.getCtx().setContext("#ShowTrl",it.prop("checked")?"Y":"N");n.Env.getCtx().setContext("#ShowAdvanced",lt.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_CACHE_WINDOW,ir.prop("checked")?"Y":"N");n.Ini.setValueToLocalStorage(n.IniConstants.P_TRACEFILE,at.prop("checked")?"Y":"N");f=lo({IsAutoCommit:hi.prop("checked")?"Y":"N",IsShowAcct:ht.prop("checked")?"Y":"N",IsShowTrl:it.prop("checked")?"Y":"N",IsShowAdvanced:lt.prop("checked")?"Y":"N"})}function nf(n){for(var e=n.length,f="",u,r,i=0;i<e;i+=1){for(f+="<tr class='VIS_Pref-tbl-Row'>",u=0;u<n[i].length;u+=1)r=n[i][u],f+=u==0?i%2?"<td class='VIS_Pref_table-row2'>"+r+"<\/td>":"<td class='VIS_Pref_table-row1' style='border-left: 1px solid #ECECEC;'>"+r+"<\/td>":u==n[i].length-1?i%2?"<td class='VIS_Pref_table-row2'>"+r+"<\/td>":"<td class='VIS_Pref_table-row1'>"+r+"<\/td>":i%2?"<td class='VIS_Pref_table-row2'>"+r+"<\/td>":"<td class='VIS_Pref_table-row1'>"+r+"<\/td>";f+=" <\/tr>"}ft.find("tbody > tr").eq(0).after(t.parseHTML(f));cu=null;f=null}function co(){ht.prop("checked",n.Env.getCtx().ctx["#ShowAcct"]=="Y"?!0:!1);it.prop("checked",n.Env.getCtx().ctx["#ShowTrl"]=="Y"?!0:!1);lt.prop("checked",n.Env.getCtx().ctx["#ShowAdvanced"]=="Y"?!0:!1)}function lo(i){var r=null;t.ajax({url:n.Application.contextUrl+"UserPreference/SavePrefrence",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({pref:i})}).done(function(n){r=n;s.dialog("close")})}var tf,rf,uf,ff,ef,of,sf,hf,cf,lf,af,vf,yf,pf,wf,bf,kf,df,gf,ne,te,ie,re,ue,fe,ee,oe,se,he,ce,lu,le,ae,ve,ye,pe,we,be,wu,su,ou,eu,vu,hu,bu,yu;hi=pi.find("#chkAutoCommit_"+r);tr=pi.find("#chkStorePassword_"+r);ci=pi.find("#chkAutoLogin_"+r);it=pi.find("#chkShowTranslationTab_"+r);ht=pi.find("#chkShowAccountingTab_"+r);ct=pi.find("#chkAutoNewRecord_"+r);lt=pi.find("#chkShowAdvancedTab_"+r);ir=pi.find("#chkCacheWindows_"+r);w=pi.find("#cmbTraceLevel_"+r);at=pi.find("#chkTraceFile_"+r);li=pi.find("#dt_Date_"+r);wr=pi.find("#chkDictionaryMaintain_"+r);rt=pi.find("#cmbClientOrg_"+r);vt=pi.find("#chkShowMiniGrid_"+r);b=pi.find("#cmbPageSize_"+r);yt=pi.find("#chkNativeDigit_"+r);ut=pi.find("#cmbWindowPageSize_"+r);rr=pi.find("#lblVariableName_"+r);ur=pi.find("#lblVariableValue_"+r);et=pi.find("#btnOk_"+r);ot=pi.find("#btnCancel_"+r);fr=pi.find("#btnRole_"+r);yi=pi.find("#contextlst_"+r);ft=pi.find("#prefErrortbl_"+r);et.hide();ot.hide();br=pi.find("#btnChangePws_"+r);wi=pi.find("#txtCurrentPws_"+r);bt=pi.find("#txtNewPws_"+r);kt=pi.find("#txtConformPws_"+r);er=pi.find("#chkIsEmail_"+r);or=pi.find("#chkIsNotice_"+r);sr=pi.find("#chkIsSMS_"+r);hr=pi.find("#chkIsFax_"+r);bi=pi.find("#txtUserName_"+r);ki=pi.find("#txtPws_"+r);cr=pi.find("#btnEmailConfig_"+r);lr=pi.find("#btnSubstitute_"+r);ar=pi.find("#btnSaveChanges_"+r);kr=pi.find("#btnSaveChangePassword_"+r);gr=pi.find("#lblPrefSave_"+r);dr=pi.find("#btnSave_"+r);nu=pi.find("#vbtnGmailAuth_"+r);gt=pi.find("#vbtnSyncGmailTask_"+r);d=pi.find("#txtAuthCode_"+r);ni=pi.find("#chkIsSyncBackground_"+r);e=pi.find("#lblTaskSettingMessage_"+r);e.hide();tu=pi.find("#vbtnGmailCalAuth_"+r);ii=pi.find("#vbtnSyncGmailCalendar_"+r);y=pi.find("#txtCalAuthCode_"+r);g=pi.find("#chkCalIsSyncBackground_"+r);o=pi.find("#lblCalendarSettingMessage_"+r);o.hide();iu=pi.find("#vbtnGmailContactAuth_"+r);ui=pi.find("#vbtnSyncGmailContact_"+r);nt=pi.find("#txtContactAuthCode_"+r);u=pi.find("#lblContactSettingMessage_"+r);u.hide();fo();ei=pi.find("#txtGmailUserName_"+r);oi=pi.find("#txtGmailPassword_"+r);si=pi.find("#cmbSettingRole_"+r);gi=pi.find("#chkbxUpdateExisting_"+r);ru=pi.find("#vbtnSyncGmailContact_"+r);u=pi.find("#lblContactSettingMessage_"+r);u.hide();eo();l=pi.find("#cmbRole_"+r);l.on("change",function(){vr()});a=pi.find("#cmbClient_"+r);a.on("change",function(){yr()});h=pi.find("#cmbOrg_"+r);h.on("change",function(){pr()});p=pi.find("#cmbWareHouse_"+r);v={};fu();uu();var ge=pi.find("#lblUserSetMenu_"+r),no=pi.find("#lblPreferenceMenu_"+r),to=pi.find("#lblContextMenu_"+r),io=pi.find("#lblErrorMenu_"+r);if(ge.text(n.Msg.getMsg("UserSetting")),no.text(n.Msg.getMsg("Preference")),to.text(n.Msg.getMsg("Context")),io.text(n.Msg.getMsg("PreferenceError")),tf=pi.find("#lblchangePwsHeader_"+r),tf.text(n.Msg.getMsg("ChangePassword")),rf=pi.find("#lblAutoMatic_"+r),rf.text(n.Msg.getMsg("AutoCommit")),uf=pi.find("#imgAutoMatic_"+r),uf.text(n.Msg.getMsg("AutoCommit",!0)),ff=pi.find("#lblTranslation_"+r),ff.text(n.Msg.getMsg("ShowTranslationTab")),ef=pi.find("#imgTranslation_"+r),ef.text(n.Msg.getMsg("ShowTranslationTab")),of=pi.find("#lblShowAccounting_"+r),of.text(n.Msg.getMsg("ShowAcctTab")),sf=pi.find("#imgShowAccounting_"+r),sf.text(n.Msg.getMsg("ShowAcctTab")),hf=pi.find("#lblAutoNewRecord_"+r),hf.text(n.Msg.getMsg("AutoNew")),cf=pi.find("#imgAutoNewRecord_"+r),cf.text(n.Msg.getMsg("AutoNew")),lf=pi.find("#lblShowAdvanced_"+r),lf.text(n.Msg.getMsg("ShowAdvancedTab")),af=pi.find("#imgShowAdvanced_"+r),af.text(n.Msg.getMsg("ShowAdvancedTab")),vf=pi.find("#lblCacheWindows_"+r),vf.text(n.Msg.getMsg("CacheWindow")),yf=pi.find("#imgCacheWindows_"+r),yf.text(n.Msg.getMsg("CacheWindow")),pf=pi.find("#vlblClientOrg_"+r),pf.text(n.Msg.getMsg("Show")),wf=pi.find("#imgClientOrg_"+r),wf.text(n.Msg.getMsg("ClientOrg")),bf=pi.find("#lblWindowPageSize_"+r),bf.text(n.Msg.getMsg("WindowPageSize")),kf=pi.find("#imgWindowPageSize_"+r),kf.text(n.Msg.getMsg("WindowPageSize")),df=pi.find("#lblAutoLogin_"+r),df.text(n.Msg.getMsg("AutoLogin")),gf=pi.find("#imgAutoLogin_"+r),gf.text(n.Msg.getMsg("AutoLogin")),ne=pi.find("#lblStorePassword_"+r),ne.text(n.Msg.getMsg("StorePassword")),te=pi.find("#imgStorePassword_"+r),te.text(n.Msg.getMsg("StorePassword")),ie=pi.find("#lblTraceLevel_"+r),ie.text(n.Msg.getMsg("TraceLevel")),re=pi.find("#imgTraceLevel_"+r),re.text(n.Msg.getMsg("TraceLevel")),ue=pi.find("#lblTraceFile_"+r),ue.text(n.Msg.getMsg("TraceFile")),fe=pi.find("#imgTraceFile_"+r),fe.text(n.Msg.getMsg("TraceFile")),ee=pi.find("#lblNativeDigit_"+r),ee.text(n.Msg.getMsg("PrintNativeDigits")),oe=pi.find("#imgNativeDigit_"+r),oe.text(n.Msg.getMsg("PrintNativeDigits")),se=pi.find("#vlblDateText_"+r),se.text(n.Msg.getMsg("Date")),he=pi.find("#imgDateText_"+r),he.text(n.Msg.getMsg("Date")),lu=pi.find("#vlblPageSize_"+r),lu.text(n.Msg.getMsg("Pagesize")),ce=pi.find("#imgPageSize_"+r),ce.text(n.Msg.getMsg("Pagesize")),lu=pi.find("#vlblPageSize_"+r),lu.text(n.Msg.getMsg("Pagesize")),le=pi.find("#lblContext_"+r),le.text(n.Msg.getMsg("Context")),c=pi.find("#lblRecordSave_"+r),f=pi.find("#lblChangePasswordMessage_"+r),c.hide(),gr.hide(),f.hide(),ae=pi.find("#pchangePws_"+r),ae.text(n.Msg.getMsg("PPasswordInfo")),ve=pi.find("#pNotification_"+r),ve.text(n.Msg.getMsg("PNotificationInfo")),ye=pi.find("#pEmailConfig_"+r),ye.text(n.Msg.getMsg("PEmailConfigInfo")),pe=pi.find("#pSubstitute_"+r),pe.text(n.Msg.getMsg("PSubstituteInfo")),we=pi.find("#pContext_"+r),we.text(n.Msg.getMsg("PContextInfo")),be=pi.find("#pError_"+r),be.text(n.Msg.getMsg("PErrorInfo")),w!=null){var pu=[n.Logging.Level.OFF.getIntValue(),n.Logging.Level.SEVERE.getIntValue(),n.Logging.Level.WARNING.getIntValue(),n.Logging.Level.INFO.getIntValue(),n.Logging.Level.CONFIG.getIntValue(),n.Logging.Level.FINE.getIntValue(),n.Logging.Level.FINER.getIntValue(),n.Logging.Level.FINEST.getIntValue(),n.Logging.Level.ALL.getIntValue()],ro=[n.Logging.Level.OFF.getName(),n.Logging.Level.SEVERE.getName(),n.Logging.Level.WARNING.getName(),n.Logging.Level.INFO.getName(),n.Logging.Level.CONFIG.getName(),n.Logging.Level.FINE.getName(),n.Logging.Level.FINER.getName(),n.Logging.Level.FINEST.getName(),n.Logging.Level.ALL.getName()],ou=0;for(eu=0;eu<pu.length;eu++)w.append(" <option value="+pu[eu]+">"+ro[eu]+"<\/option>"),n.Ini.getLocalStorage(n.IniConstants.P_TRACELEVEL)==pu[eu]&&(ou=eu);w.prop("selectedIndex",ou)}if(rt!=null){for(wu=[n.Msg.getMsg("Client+Org"),n.Msg.getMsg("Client"),n.Msg.getMsg("Org"),n.Msg.getMsg("None")],ou=0,eu=0;eu<wu.length;eu++)rt.append("<option>"+wu[eu]+"<\/option>"),n.Ini.getLocalStorage(n.IniConstants.CO_SHOWLEVEL)==eu&&(ou=eu);rt.prop("selectedIndex",ou)}if(b!=null){for(su=[5,6,7,8,9,10],ou=0,eu=0;eu<su.length;eu++)b.append("<option>"+su[eu]+"<\/option>"),n.Ini.getLocalStorage(n.IniConstants.W_PAGESIZE)==su[eu]&&(ou=eu);b.prop("selectedIndex",ou)}if(ut!=null){for(su=[50,100,500],ou=0,eu=0;eu<su.length;eu++)ut.append("<option>"+su[eu]+"<\/option>"),n.Ini.getLocalStorage(n.IniConstants.WIN_PAGESIZE)==su[eu]&&(ou=eu);ut.prop("selectedIndex",ou)}if(yi!=null){var cu=n.context.getEntireCtx(),au=[],eu=0,uo=Object.keys(cu).length;for(vu=0;vu<uo;vu+=1)au[eu++]=' <li class="VIS_Pref_li-err" ><span >',au[eu++]=Object.keys(cu)[vu]+" == "+cu[Object.keys(cu)[vu]],au[eu++]="<\/span><\/li>";yi.append(au.join(""));cu=null;au=null}k=pi.find("#vchkErrorOnly_"+r);pt=pi.find("#vbtnReset_"+r);wt=pi.find("#vbtnSaveToFile_"+r);n.context&&!n.context.getAD_Role_ID()==0&&pi.find(".VIS_Pref_err_btnLeft").hide();ai=pi.find("#vbtnLogDate_"+r);vi=pi.find("#vbtnDownLog_"+r);ke(ai);vi.on("click",function(){var i=ai.val();i=i?new Date(i).toISOString():(new Date).toISOString();ku(!0);t.ajax({type:"POST",url:n.Application.contextUrl+"UserPreference/DownloadServerLog",dataType:"json",data:{logDate:i},success:function(t){if(t){var i="TempDownload/"+t;window.open(n.Application.contextUrl+i);ke(ai)}else n.ADialog.info("VIS_NoLogFound",null,null);ku(!1)},error:function(){ku(!1)}})});k.prop("checked",!0);ft!=null&&(hu=n.Logging.VLogErrorBuffer.get(!0).getLogData(k.prop("checked")),dt=hu,nf(hu));wt.on("click",function(){var i,n,r,u;if(hu=dt,hu.length>0){for(i="",n=0;n<hu.length;n++)i+=hu[n]+"\n";r=(new Date).toISOString().slice(0,19).replace(/-/g,"");u="data:text/csv;base64,"+window.btoa(i);t(this).attr("href",u).attr("download","file-"+r+".csv")}});co();hi.prop("checked",n.Env.getCtx().isAutoCommit());ct.prop("checked",n.Env.getCtx().isAutoNew());ci.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_A_LOGIN)=="N"?!1:!0);tr.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_STORE_PWD)=="N"?!1:!0);vt.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_Show_Mini_Grid)=="N"?!1:!0);yt.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_Print_Native_Digits)=="Y"?!0:!1);ir.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_CACHE_WINDOW)=="Y"?!0:!1);at.prop("checked",n.Ini.getLocalStorage(n.IniConstants.P_TRACEFILE)=="Y"?!0:!1);bu=new Date(Number(n.Env.getCtx().ctx["#Date"]));bu!=null&&li.val(Globalize.format(bu,"yyyy-MM-dd"));yi.on("click","li",function(){var n=t(this).text().split("==")[0],i=t(this).text().split("==")[1];rr.text(n.toString());ur.text(i.toString())});t(".VIS_Pref_meni li").on("click",function(){t(".VIS_Pref_menu li").removeClass("active");t(this).addClass("active")});pt.on("click",function(){var t=n.Logging.VLogErrorBuffer.get(!0).resetBuffer(k.prop("checked"));dt=t;t!=null?nf(t):ft.find("tr:gt(0)").remove()});t(".VIS_Pref_btn-pass-click").on("click",function(){t(".VIS_Pref_new-password").css("display","block");t(".VIS_Pref_Save").css("display","block")});t(".VIS_Pref_close-btn").click(function(){t(".VIS_Pref_new-password").css("display","none");t(".VIS_Pref_Save").css("display","none")});t(".VIS_Pref_link-1").click(function(){t(".VIS_Pref_content-right").css("display","block");t(".VIS_Pref_content-right-2").css("display","none");t(".VIS_Pref_content-right-3").css("display","none");t(".VIS_Pref_content-right-4").css("display","none");t(".VIS_Pref_content-right-5").css("display","none")});t(".VIS_Pref_link-2").click(function(){t(".VIS_Pref_content-right").css("display","none");t(".VIS_Pref_content-right-2").css("display","block");t(".VIS_Pref_content-right-3").css("display","none");t(".VIS_Pref_content-right-4").css("display","none");t(".VIS_Pref_content-right-5").css("display","none")});t(".VIS_Pref_link-3").click(function(){t(".VIS_Pref_content-right").css("display","none");t(".VIS_Pref_content-right-2").css("display","none");t(".VIS_Pref_content-right-3").css("display","block");t(".VIS_Pref_content-right-4").css("display","none");t(".VIS_Pref_content-right-5").css("display","none")});t(".VIS_Pref_link-4").click(function(){t(".VIS_Pref_content-right").css("display","none");t(".VIS_Pref_content-right-2").css("display","none");t(".VIS_Pref_content-right-3").css("display","none");t(".VIS_Pref_content-right-4").css("display","block");t(".VIS_Pref_content-right-5").css("display","none")});t(".VIS_Pref_link-5").click(function(){window.WSP?(t(".VIS_Pref_content-right").css("display","none"),t(".VIS_Pref_content-right-2").css("display","none"),t(".VIS_Pref_content-right-3").css("display","none"),t(".VIS_Pref_content-right-4").css("display","none"),t(".VIS_Pref_content-right-5").css("display","block")):alert("please download WSP !!!")});i&&t(".VIS_Pref_link-5").trigger("click");dr.on("click",function(){de()});et.on("click",function(){de()});ot.on("click",function(){s.dialog("close")});k.on("click",function(){var t=null;ft.find("tr").slice(1,-1).remove();t=n.Logging.VLogErrorBuffer.get(!0).getLogData(k.prop("checked"));dt=t;t!=null&&nf(t)});fr.on("click",function(){var t=n.MRole.toStringX(n.Env.getCtx())});kr.on("click",function(){var r=wi.val(),i=bt.val(),u=kt.val(),e=bi.val(),o=ki.val();if(r.length<=0||i.length<=0||u.length<=0){f.css("color","red");f.text(n.Msg.getMsg("FillMandatory"));f.show();return}if(i!=u){f.css("color","red");f.text(n.Msg.getMsg("samePassword"));f.show();return}t.ajax({type:"POST",async:!1,url:n.Application.contextUrl+"UserPreference/SaveChangePassword",dataType:"json",data:{AD_User_ID:n.context.getAD_User_ID(),currentPws:r,newPws:i},success:function(t){returnValue=t.result;f.show();returnValue=="OK"?(f.css("color","green"),f.text(n.Msg.getMsg("Passwordchanged"))):(f.css("color","red"),f.text(returnValue))}})});ar.on("click",function(){var i=wi.val(),r=bt.val(),u=kt.val(),v=bi.val(),y=ki.val();if((!(i.length<=0)||!(r.length<=0)||!(u.length<=0))&&(!(i.length>0)||!(r.length>0)||!(u.length>0))){c.text(n.Msg.getMsg("mandatoryFields"));return}if(bt.text().localeCompare(kt.text())==-1){c.text(n.Msg.getMsg("samePassword"));return}var e=l.val(),o=a.val(),s=h.val(),f=p.val();if(e==undefined||o==undefined||s==undefined){c.text(n.Msg.getMsg("VIS_FillLogin"));return}f==undefined&&(f=0);t.ajax({type:"POST",async:!1,url:n.Application.contextUrl+"UserPreference/SaveUserSettings",dataType:"json",data:{AD_User_ID:n.context.getAD_User_ID(),currentPws:i,newPws:r,conformPws:u,chkEmail:er.prop("checked"),chkNotice:or.prop("checked"),chkSMS:sr.prop("checked"),chkFax:hr.prop("checked"),emailUserName:v,emailPws:y,AD_Role_ID:e,AD_Client_ID:o,AD_Org_ID:s,M_Warehouse_ID:f},success:function(n){returnValue=n.result;c.show();c.css("color","green");c.text(returnValue.Msg);returnValue.IsSaved||c.css("color","red")}})});cr.on("click",function(){var t=0,i;try{t=n.dataContext.getJSONData(n.Application.contextUrl+"UserPreference/GetWindowID",{WindowName:"Mail Configuration"},null);t>0&&(i=new n.Query,i.addRestriction("AD_User_ID",n.Query.prototype.EQUAL,n.context.getAD_User_ID()),n.viewManager.startWindow(t,i))}catch(r){this.log.log(n.Logging.Level.SEVERE,sql,r)}s.dialog("close")});lr.on("click",function(){var t=0,i;try{t=n.dataContext.getJSONData(n.Application.contextUrl+"UserPreference/GetWindowID",{WindowName:"User Substitute"},null);t>0&&(i=new n.Query,i.addRestriction("AD_User_ID",n.Query.prototype.EQUAL,n.context.getAD_User_ID()),n.viewManager.startWindow(t,i))}catch(r){this.log.log(n.Logging.Level.SEVERE,sql,r)}s.dialog("close")});nu.on("click",function(){du(!0,!1)});gt.on("click",function(){e.css("color","gray");e.text(n.Msg.getMsg("PleaseWait"));e.show();window.setTimeout(function(){gu(!0,di,d.val(),ti,!1)},500)});ni.on("click",function(n){di=n.originalEvent.target.checked});iu.on("click",function(){du(!1,!0)});ui.on("click",function(){u.css("color","gray");u.text(n.Msg.getMsg("PleaseWait"));u.show();window.setTimeout(function(){gu(!1,!1,nt.val(),fi,!0)},500)});tu.on("click",function(){du(!1,!1)});ii.on("click",function(){o.css("color","gray");o.text(n.Msg.getMsg("PleaseWait"));o.show();window.setTimeout(function(){gu(!1,st,y.val(),ri,!1)},500)});g.on("click",function(n){st=n.originalEvent.target.checked});gi.on("click",function(n){nr=n.originalEvent.target.checked});ru.on("click",function(){ei.val()!=""&&ei.val().length!=0&&oi.val()!=""&&oi.val().length!=0&&(u.css("color","gray"),u.text(n.Msg.getMsg("PleaseWait")),u.show(),window.setTimeout(function(){ho(ei.val(),oi.val(),si.val(),nr)},500))});yu=null};var fu=function(){t.ajax({url:n.Application.contextUrl+"UserPreference/GetDefaultLogin",dataType:"json",async:!1,data:{AD_User_ID:n.context.getAD_User_ID()},success:function(n){var t=JSON.parse(n);v.AD_Role_ID=t.AD_Role_ID;v.AD_Client_ID=t.AD_Client_ID;v.AD_Org_ID=t.AD_Org_ID;v.M_Warehouse_ID=t.M_Warehouse_ID}})},uu=function(){var i="SELECT  r.Name,r.AD_Role_ID FROM AD_User u INNER JOIN AD_User_Roles ur ON (u.AD_User_ID=ur.AD_User_ID AND ur.IsActive='Y') INNER JOIN AD_Role r ON (ur.AD_Role_ID=r.AD_Role_ID AND r.IsActive='Y')  WHERE  u.AD_User_ID="+n.context.getAD_User_ID()+" AND u.IsActive='Y'  AND u.IsLoginUser='Y'  AND EXISTS (SELECT * FROM AD_Client c WHERE u.AD_Client_ID=c.AD_Client_ID AND c.IsActive='Y') AND EXISTS (SELECT * FROM AD_Client c WHERE r.AD_Client_ID=c.AD_Client_ID AND c.IsActive='Y') ORDER BY r.Name";t.ajax({url:n.Application.contextUrl+"UserPreference/GetLoginData",dataType:"json",data:{sql:i},success:function(n){var t=JSON.parse(n),i="",r;for(r in t)i+="<option value="+t[r].RecKey+">"+t[r].Name+"<\/option>";l.append(i);l.val(v.AD_Role_ID);i=null;t=null;vr()}})},vr=function(){var i=l.val(),r;(a.empty(),h.empty(),p.empty(),i!=undefined)&&(r="SELECT c.Name,r.AD_Client_ID FROM AD_Role r INNER JOIN AD_Client c ON (c.AD_Client_ID=r.AD_Client_ID) WHERE r.AD_Role_ID="+i,i=null,t.ajax({url:n.Application.contextUrl+"UserPreference/GetLoginData",dataType:"json",data:{sql:r},success:function(n){var t=JSON.parse(n),i="",u;for(u in t)i+="<option value="+t[u].RecKey+">"+t[u].Name+"<\/option>";a.append(i);a.val(v.AD_Client_ID);i=null;t=null;r=null;yr()}}))},yr=function(){var i=l.val(),r=a.val(),u;(h.empty(),p.empty(),i!=undefined&&r!=undefined)&&(u="SELECT o.Name,o.AD_Org_ID FROM AD_Role r, AD_Client c INNER JOIN AD_Org o ON (c.AD_Client_ID=o.AD_Client_ID OR o.AD_Org_ID=0) WHERE r.AD_Role_ID='"+i+"' AND c.AD_Client_ID='"+r+"' AND o.IsActive='Y' AND o.IsSummary='N' AND (r.IsAccessAllOrgs='Y' OR (r.IsUseUserOrgAccess='N' AND o.AD_Org_ID IN (SELECT AD_Org_ID FROM AD_Role_OrgAccess ra WHERE ra.AD_Role_ID=r.AD_Role_ID AND ra.IsActive='Y')) OR (r.IsUseUserOrgAccess='Y' AND o.AD_Org_ID IN (SELECT AD_Org_ID FROM AD_User_OrgAccess ua WHERE ua.AD_User_ID='"+n.context.getAD_User_ID()+"' AND ua.IsActive='Y'))) ORDER BY o.Name",i=null,r=null,t.ajax({url:n.Application.contextUrl+"UserPreference/GetLoginData",dataType:"json",data:{sql:u},success:function(n){var t=JSON.parse(n),i="",r;for(r in t)i+="<option value="+t[r].RecKey+">"+t[r].Name+"<\/option>";h.append(i);h.val(v.AD_Org_ID);i=null;t=null;u=null;pr()}}))},pr=function(){var i=h.val(),r;(p.empty(),i!=undefined)&&(r="SELECT Name,M_Warehouse_ID  FROM M_Warehouse WHERE AD_Org_ID="+i+" AND IsActive='Y' ORDER BY Name",i=null,t.ajax({url:n.Application.contextUrl+"UserPreference/GetLoginData",dataType:"json",data:{sql:r},success:function(n){var t=JSON.parse(n),i="",u;for(u in t)i+="<option value="+t[u].RecKey+">"+t[u].Name+"<\/option>";p.append(i);p.val(v.M_Warehouse_ID);i=null;t=null;r=null}}))};this.showDialog=function(){var i=t(window).width()-150,r=t(window).height()-40;tt.height(r);tt.width(i);s.append(tt);s.dialog({modal:!1,title:n.Msg.getMsg("Preference"),width:i,height:r,position:{at:"center top",of:window},close:function(){pi.dispose();s.dialog("destroy");t("#ui-datepicker-div").remove();s=null;pi=null}})};this.show=function(){this.load();this.showDialog()};this.disposeComponent=function(){pi=null;et&&et.off("click");ot&&ot.off("click");pt&&pt.off("click");wt&&wt.off("click");vi&&vi.off("click");ci=null;it=null;ht=null;ct=null;lt=null;at=null;w=null;dt=null;wr=null;rt=null;vt=null;b=null;yt=null;ut=null;rr=null;ur=null;it=null;k=null;pt=null;wt=null;ft=null;fr=null;et=null;ot=null;br=null;wi=null;bt=null;kt=null;er=null;or=null;sr=null;hr=null;bi=null;ki=null;cr=null;lr=null;ar=null;lblUserSetMenu=null;lblPreferenceMenu=null;lblContextMenu=null;lblErrorMenu=null;lblchangePwsHeader=null;lblAutoMatic=null;imgAutoMatic=null;lblTranslation=null;imgTranslation=null;lblShowAccounting=null;imgShowAccounting=null;lblAutoNewRecord=null;imgAutoNewRecord=null;lblShowAdvanced=null;imgShowAdvanced=null;lblCacheWindows=null;imgCacheWindows=null;vlblClientOrg=null;imgClientOrg=null;lblWindowPageSize=null;imgWindowPageSize=null;lblAutoLogin=null;imgAutoLogin=null;lblStorePassword=null;imgStorePassword=null;lblTraceLevel=null;imgTraceLevel=null;lblTraceFile=null;imgTraceFile=null;lblNativeDigit=null;imgNativeDigit=null;vlblDateText=null;imgDateText=null;vlblPageSize=null;imgPageSize=null;vlblPageSize=null;lblContext=null;li.datepicker("destroy");li=null;l.off("change");a.off("change");h.off("change");l=null;a=null;h=null;p=null;uu=null;yr=null;vr=null;pr=null;this.disposeComponent=null}}n.Framework=n.Framework||{};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Framework.UserPreference=i}(VIS,jQuery),function(n,t){function i(i,r){var e=this,u=t("<div>"),h=t("<div class='vis-apanel-busy'>"),f=n.Env.getWindowNo(),c=null,l=null,o=null,d,g;this.onClose=null;var nt=null,p=null,a=null,v=null,k=null,b=null,s=!1,w=null,y=null;(i==null||i=="null")&&(i=0);d=function(){u.load(n.Application.contextUrl+"VImageForm/Index/?windowno="+f+"&ad_image_id="+i,function(){h[0].style.visibility="visible";g(u);h[0].style.visibility="hidden"})};g=function(t){c=u.find("#btnOk_"+f);l=u.find("#btnCancel_"+f);o=u.find("#btnImgDelete_"+f);n.Application.isRTL&&(c.css("margin-right","-128px"),l.css("margin-right","110px"),o.css("margin-right","55px"));i>0?o.css("display","inline-block"):o.css("display","none");p=t.find("#fileUpload_"+f);a=t.find("#holderDiv_"+f);v=t.find("#imgUsrImage_"+f);a.css("width",w-48);y>180&&a.css("height",y-180);r>0?v.hide():v[0].width>300&&a.css("overflow","auto");k=t.find("#lblfileUpload_"+f);b=t.find("#chkDataBaseSave_"+f);p.on("change",function(){v.show();var t=p[0].files[0],n=new FileReader;return n.onload=function(n){v.removeAttr("src").attr("src",n.target.result);a.css("overflow","auto")},n.readAsDataURL(t),s=!0,n=null,t=null,!1});b.on("change",function(){return s=!0,!1});c.on("click",function(){if(s){var r=new XMLHttpRequest,t=new FormData;t.append("file",p[0].files[0]);t.append("isDatabaseSave",b.prop("checked"));t.append("ad_image_id",i);r.open("POST",n.Application.contextUrl+"VImageForm/SaveImage",!0);r.send(t);r.addEventListener("load",function(n){var i=n.target.response,f;if(i=JSON.parse(i),f=i.result,e.onClose)e.onClose(f,s);r=null;t=null;u.dialog("close")},!1)}else{if(e.onClose)e.onClose(i,s);u.dialog("close")}});l.on("click",function(){u.dialog("close")});o.on("click",function(){s=!0;var t=new XMLHttpRequest,r=new FormData;r.append("ad_image_id",i);t.open("POST",n.Application.contextUrl+"VImageForm/DeleteImage",!0);t.send(r);t.addEventListener("load",function(n){var i=n.target.response,f;if(i=JSON.parse(i),f=i.result,e.onClose)e.onClose(f,s);t=null;r=null;u.dialog("close")},!1)})};this.showDialog=function(){d();w=t(window).width()-150;y=t(window).height()-40;h.height(y);h.width(w);u.append(h);u.dialog({modal:!0,title:n.Msg.getMsg("ImageDialog"),width:w,height:y,position:{at:"center top",of:window},close:function(){e.dispose();e=null;u.dialog("destroy");u=null}})};this.disposeComponent=function(){e=null;c&&c.off("click");l&&l.off("click");o&&o.off("click");h=null;f=null;c=null;l=null;o=null;nt=null;p=null;a=null;v=null;k=null;b=null;s=!1;w=null;y=null;this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};n.VImageForm=i}(VIS,jQuery),function(n,t){function i(i){function f(){var e,s,f,h,o;for(r=t("<div><\/div>"),e="<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'>",e+=n.Application.isRTL?"<html dir='rtl' xmlns='http://www.w3.org/1999/xhtml'>":"<html xmlns='http://www.w3.org/1999/xhtml'>",e+="<head><script type='text/javascript' language='javascript'> document.onkeydown = function(){ if((window.event && window.event .keyCode == 116)||(window.event && window.event .keyCode == 78)) { window.event.keyCode = 505; }if(window.event && window.event .keyCode == 505){ return false; } }<\/script> <meta http-equiv='Content-Type' content='text/html; charset=utf-8' /><title>Help &amp; Support "+i.vo.Name+"<\/title><style type='text/css'><!--body {margin-left: 0px;margin-top: 0px;margin-right: 0px;margin-bottom: 0px;font-family:verdana;font-size:12px;color:#000000;}.hed1{font-family:verdana;font-weight:bold;font-size:12px;color:#000000;}.border{border:1px solid #c6daf3;}.border-1{border:1px solid #aac7e7;background-color:#e9e8e8;}.border-2{border:1px solid #aac7e7;}.border-bottom{border-bottom:1px solid #c6daf3;}.border-top-none{border-bottom:1px solid #c6daf3;border-right:1px solid #c6daf3;border-left:1px solid #c6daf3;}.red{font-size:12px;color:#FF0000;font-weight:bold;}.white{font-size:16px;color:#FFffff;font-weight:bold;}.black{font-size:16px;color:#000000;font-weight:bold;}.blue{color:#5490fa;font-weight:bold;}.orange{color:#f2b227;font-weight:bold;}.pad{padding:5px;}a{color:#5490fa;\t}a:hover{color:#000000;\ttext-decoration:none;}--><\/style><\/head><body oncontextmenu='return false;'>",e=e+"<table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'><tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' bgcolor='#c6daf3' class='border-bottom'><tr><td width='100%' class='hed1' height='29'>Vienna Solutions<\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td>",e=e+"<\/tr><tr><td><table width='98%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'><tr><td><table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td class='red'>&nbsp;<\/td><\/tr><tr><td class='red'>Window: "+i.vo.Name+"<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>"+i.vo.Description+"<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>"+i.vo.Help+"<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><tr><td>",s="",f=0;f<i.tabs.length;f++)s==""?s="<a href='#"+i.tabs[f].vo.Name+""+f+"'>"+i.tabs[f].vo.Name+"<\/a>":s+=" -&gt; <a href='#"+i.tabs[f].vo.Name+""+f+"'>"+i.tabs[f].vo.Name+"<\/a> ";for(e=e+s,e=e+"<\/td><\/tr><tr><td>&nbsp;<\/td><\/tr><\/table><\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>",e=e+"<tr><td><table width='98%' border='0' align='center' cellpadding='0' cellspacing='0' class='border'>",f=0;f<i.tabs.length;f++){for(e=e+"<tr><td><table width='99%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td class='black' style='padding-top:5px;' ><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0'><tr><td width='340' height='5' bgcolor='#f9b31c'><\/td><td width='4'><\/td><td width='624' bgcolor='#f9b31c'><\/td><\/tr><tr><td height='35' bgcolor='#FFFFFF' class='border-top-none' style='padding-left:10px;'>Tab:"+i.tabs[f].vo.Name+"<a name='"+i.tabs[f].vo.Name+""+f+"'><\/a> <\/td><td ><\/td><td bgcolor='#FFFFFF' class='border-top-none' style='padding-left:10px;'>"+i.tabs[f].vo.Description,"NaN<\/tr><\/table><\/td><\/tr><tr><td >&nbsp;<\/td><\/tr><tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border-2'><tr><td style='padding:10px; text-align:justify'><span class='red'>"+i.tabs[f].vo.Help,"NaN<br />",h="",o=0;o<i.tabs[f].gTab._gridTable.m_fields.length;o++)h==""&&(i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR||i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf)?h="<a href='#"+i.tabs[f].vo.Name+""+f+""+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+""+o+"'>"+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+"<\/a>":(i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR||i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf)&&(h+=" | <a href='#"+i.tabs[f].vo.Name+""+f+""+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+""+o+"'>"+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+"<\/a>");for(e=e+h,e=e+" <\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>",o=0;o<i.tabs[f].gTab._gridTable.m_fields.length;o++)i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header!=""&&(i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedMR||i.tabs[f].gTab._gridTable.m_fields[o]._vo.IsDisplayedf)&&(e=e+"<tr><td><table width='100%' border='0' align='center' cellpadding='0' cellspacing='0' class='border-1'><tr><td style='padding:10px; text-align:justify'><span class='blue'>Field: "+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+"<\/span><a name='"+i.tabs[f].vo.Name+""+f+""+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Header+""+o+"'><\/a><br /><br />"+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Description+"<br /><br />"+i.tabs[f].gTab._gridTable.m_fields[o]._vo.Help+" <\/td><\/tr><\/table><\/td><\/tr><tr><td>&nbsp;<\/td><\/tr>");e=e+"<\/table><\/td><\/tr>"}e=e+"<\/table><\/td><\/tr><\/table><\/body><\/html>";r.append(jQuery.parseHTML(e));u=e}function e(){var n=window.open();n.document.open();n.document.write(u)}var r,u="";f();e()}n.Apps.help=i}(VIS,jQuery),function(n,t){t.IniConstants={log:t.Logging.VLogger.getVLogger(" VIS.Ini"),ENV_PREFIX:"env.",VIENNA_HOME:"VIENNA_HOME",VIENNA_PROPERTY_FILE:"vienna.properties",VIENNA_ENV_FILE:"viennaEnv.properties",P_UID:"ApplicationUserID",DEFAULT_UID:"UserPwd",P_PWD:"ApplicationPassword",DEFAULT_PWD:"UserPwd",P_STORE_PWD:"StorePassword",DEFAULT_STORE_PWD:!0,P_TRACELEVEL:"TraceLevel",DEFAULT_TRACELEVEL:"WARNING",P_TRACEFILE:"TraceFile",DEFAULT_TRACEFILE:!1,P_INI:"FileNameINI",DEFAULT_INI:"",P_CONNECTION:"Connection",DEFAULT_CONNECTION:"",P_A_LOGIN:"AutoLogin",DEFAULT_A_LOGIN:!1,P_A_NEW:"AutoNew",DEFAULT_A_NEW:!0,P_VIENNASYS:"ViennaSys",DEFAULT_VIENNASYS:!1,P_CACHE_WINDOW:"CacheWindow",DEFAULT_CACHE_WINDOW:!1,P_TEMP_DIR:"TempDir",DEFAULT_TEMP_DIR:"",P_ROLE:"Role",DEFAULT_ROLE:"",P_CLIENT:"Client",DEFAULT_CLIENT:"",P_ORG:"Organization",DEFAULT_ORG:"",P_WAREHOUSE:"Warehouse",DEFAULT_WAREHOUSE:"",P_TODAY:"CDate264",DEFAULT_TODAY:Date.now,P_PRINTPREVIEW:"PrintPreview",DEFAULT_PRINTPREVIEW:!0,P_WARNING:"Warning",DEFAULT_WARNING:"Do_not_change_any_of_the_data_as_they_will_have_undocumented_side_effects.",P_PRINTER:"Printer",DEFAULT_PRINTER:"",P_DBUSED:"dbused",DEFAULT_DBUSED:"",P_DB_NAME:"dbname",DEFAULT_DB_NAME:"",P_DBUSER_ID:"dbuserid",DEFAULT_DBUSER_ID:"",P_DBPWD:"dbpwd",DEFAULT_DB_PWD:"",P_DB_PORT:"dbport",DEFAULT_DB_PORT:"",P_DB_HOST:"dbhost",DEFAULT_DB_HOST:"",CO_SHOWLEVEL:"ClientOrgLevel",DEFAULT_CO_SHOWLEVEL:"2",W_PAGESIZE:"WorkSpacePageSize",DEFAULT_W_PAGESIZE:"5",WIN_PAGESIZE:"WindowPageSize",DEFAULT_WIN_PAGESIZE:"50",P_Show_Mini_Grid:"ShowMiniGrid",DEFAULT_MiniGrid_Status:!1,P_Print_Native_Digits:"PrintNativeDigits",DEFAULT_Native_Digits_Status:!0,P_WELCOME_SCREEN:"HideWelcomeScreen",DEFAULT_SCREEN_STATUS:!1,P_APP_TYPE:"AppType",DEFAULT_APP_TYPE:"VServer",P_APP_HOST:"AppHost",DEFAULT_APP_HOST:"localhost",P_APP_PORT:"AppPort",DEFAULT_APP_PORT:"2090",_VIENNASYS:"VFramworkSys",_XML_DOC_PATH:"appconn.xml",_XML_ROOT:"//connectionvar"};t.Ini=function(){function n(n,t){localStorage.setItem(n,t)}function i(n){return localStorage.getItem(n)}function r(){localStorage.clear()}function u(n){localStorage.removeItem(n)}function f(){return localStorage.getItem(t.IniConstants.P_CACHE_WINDOW)=="Y"}function e(){return t.Ini.getLocalStorage(t.IniConstants.P_TRACELEVEL)!=null?t.Logging.Level.prototype.getLevel(t.Ini.getLocalStorage(t.IniConstants.P_TRACELEVEL)):t.Logging.Level.INFO}function o(){for(var i=[t.IniConstants.P_A_NEW,t.IniConstants.P_TRACEFILE,t.IniConstants.P_TRACELEVEL,t.IniConstants.CO_SHOWLEVEL,t.IniConstants.W_PAGESIZE,t.IniConstants.WIN_PAGESIZE,t.IniConstants.P_Show_Mini_Grid,t.IniConstants.P_Print_Native_Digits,t.IniConstants.P_A_LOGIN,t.IniConstants.P_STORE_PWD,t.IniConstants.P_CACHE_WINDOW,t.IniConstants.P_PRINTPREVIEW,t.IniConstants.P_TRACEFILE],r={},n=0;n<i.length;n++)i[n]=="AutoNew"?t.context.setContext(i[n],t.Ini.getLocalStorage(i[n])==null?"Y":t.Ini.getLocalStorage(i[n])):t.context.setContext("#"+i[n],t.Ini.getLocalStorage(i[n])),r[i[n]]=t.Ini.getLocalStorage(i[n]);r["#TimezoneOffset"]=(new Date).getTimezoneOffset().toString();t.dataContext.updateClientCtx(r)}return{setValueToLocalStorage:n,getLocalStorage:i,clearLocalStorage:r,removeLocalStorageItem:u,updateLocalContextFromIni:o,getIsCacheWindow:f,getTraceLevel:e}}()}(jQuery,VIS),function(n,t){function i(i){function g(n){nt.css("display",n?"block":"none")}this.onClose=null;var v=i,p=this,r=t("<div style='position:relative;'>"),nt=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),u=n.Env.getWindowNo(),tt=null,w=null,e=null,o=null,s=null,h=null,c=null,b=null,l=null,a=null,k=null,it=null,y=null,d=null,ut=null,rt=null,f=!1;this.load=function(){r.load(n.Application.contextUrl+"Location/Locations/?windowno="+u+"&locationId="+v+"&AD_Language="+n.context.getContext("#AD_Language"),function(){r.append(nt);g(!0);p.init();g(!1)})};this.init=function(){function ut(i){var u=null;t.ajax({url:n.Application.contextUrl+"Location/SaveLocation",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({pref:i})}).done(function(n){if(u=n,v=u.locationid,rt=u.locaddress,this.location=v,g(!1),p.onClose)p.onClose(v,f);r.dialog("close");f=null})}var nt,i;y=r.find("#btnOk_"+u);d=r.find("#btnCancel_"+u);tt=r.find("#lstLocation_"+u);w=r.find("#txtCountry_"+u);e=r.find("#txtAddress1_"+u);o=r.find("#txtAddress2_"+u);s=r.find("#txtAddress3_"+u);h=r.find("#txtAddress4_"+u);n.Application.isRTL&&(y.removeClass("pull-left"),y.addClass("pull-right"),r.find("Sup").css("float","right"),t(r.find(".cat2 a")[0]).removeClass("pull-right"),t(r.find(".cat2 a")[0]).addClass("pull-left"),t(r.find(".cat3 a")[0]).removeClass("pull-right"),t(r.find(".cat3 a")[0]).addClass("pull-left"),t(r.find(".cat2 a")[0]).css("margin-left","10px"),t(r.find(".cat3 a")[0]).css("margin-left","10px"));e.val()&&e.val(e.val());o.val()&&o.val(o.val());s.val()&&(nt=t("#aCollection"),i=t(".cat"+t(nt).attr("data-prod-cat")),i?i.length>0&&i.toggle():t(".cat"+t(nt).attr("data-prod-close")).hide(),s.val(s.val()));h.val()&&(nt=r.find(".cat3").find("a")[0],i=t(".cat"+t(nt).attr("data-prod-cat")),i?i.length>0&&i.toggle():t(".cat"+t(nt).attr("data-prod-close")).hide(),h.val(h.val()));c=r.find("#txtCity_"+u);c.val()&&c.val(c.val());b=r.find("#txtState_"+u);l=r.find("#txtZipCode_"+u);l.val()&&l.val(l.val());a=r.find("#countryhdn_"+u).val();k=r.find("#Statehdn_"+u).val();w.autocomplete({source:function(i,r){i.term.trim().length!=0&&t.ajax({url:n.Application.contextUrl+"Location/GetCountry",dataType:"json",data:{style:"full",name_startsWith:i.term},success:function(n){r(t.map(n.result,function(n){return{label:n.Name,value:n.Name,id:n.Key}}))}})},minLength:1,select:function(n,t){a=t.item.id},open:function(){t(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){t(this).removeClass("ui-corner-top").addClass("ui-corner-all");Number(a)>0&&(f=!0)}});b.autocomplete({source:function(i,r){i.term.trim().length!=0&&t.ajax({url:n.Application.contextUrl+"Location/GetStates",dataType:"json",data:{style:"full",name_startsWith:i.term,countryId:a},success:function(n){r(t.map(n.result,function(n){return{label:n.Name,value:n.Name,id:n.Key}}))}})},minLength:1,select:function(n,t){k=t.item.id},open:function(){t(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){t(this).removeClass("ui-corner-top").addClass("ui-corner-all")}});tt.autocomplete({source:function(i,r){i.term.trim().length!=0&&t.ajax({url:n.Application.contextUrl+"Location/GetAddresses",dataType:"json",data:{style:"full",name_startsWith:i.term},success:function(n){r(t.map(n.result,function(n){return{label:n.ADDRESS,value:n.ADDRESS,C_COUNTRY_ID:n.C_COUNTRY_ID,C_LOCATION_ID:n.C_LOCATION_ID,C_REGION_ID:n.C_REGION_ID,COUNTRYNAME:n.COUNTRYNAME,ADDRESS1:n.ADDRESS1,ADDRESS2:n.ADDRESS2,ADDRESS3:n.ADDRESS3,ADDRESS4:n.ADDRESS4,CITYNAME:n.CITYNAME,STATENAME:n.STATENAME,ZIPCODE:n.ZIPCODE}}))}})},minLength:1,select:function(n,t){w.val(t.item.COUNTRYNAME);e.val(t.item.ADDRESS1);o.val(t.item.ADDRESS2);s.val(t.item.ADDRESS3);h.val(t.item.ADDRESS4);c.val(t.item.CITYNAME);b.val(t.item.STATENAME);l.val(t.item.ZIPCODE);f=!0;k=t.item.C_REGION_ID;v=0;it=0;a=t.item.C_COUNTRY_ID},open:function(){t(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){t(this).removeClass("ui-corner-top").addClass("ui-corner-all")}});y.on("click",function(){if(g(!0),Number(a)<=0){n.ADialog.warn("SelectCountry",!0,null);g(!1);return}var t={countryName:w.val(),addvalue1:e.val(),addvalue2:o.val(),addvalue3:s.val(),addvalue4:h.val(),cityValue:c.val(),stateValue:b.val(),zipValue:l.val(),clocationId:v,countryId:a,stateId:k,cityId:it},i=ut(t)});d.on("click",function(){r.dialog("close")});t(".VIS-Location-toggler").click(function(n){n.preventDefault();var i=t(".cat"+t(this).attr("data-prod-cat"));i?i.length>0&&i.toggle():t(".cat"+t(this).attr("data-prod-close")).hide()});w.bind("change",function(){f=!0});e.bind("change",function(){f=!0});o.bind("change",function(){f=!0});s.bind("change",function(){f=!0});h.bind("change",function(){f=!0});c.bind("change",function(){f=!0});b.bind("change",function(){f=!0});l.bind("change",function(){f=!0})};this.showDialog=function(){r.append(nt);r.dialog({modal:!0,resizable:!1,title:n.Msg.getMsg("Location"),closeText:n.Msg.getMsg("close"),width:620,position:{at:"center top",of:window},close:function(){p.dispose();p=null;r.dialog("destroy");r=null}})};this.disposeComponent=function(){p=null;y&&y.off("click");d&&d.off("click");v=0;tt=null;w=null;e=null;o=null;s=null;h=null;c=null;b=null;l=null;a=null;k=null;it=null;y=null;d=null;ut=null;rt=null;this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};n.LocationForm=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o){function vt(){function o(){var n=nt.prop("checked");n?(it.hide(),rt.show(),l.removeClass("vis-gc-vpanel-table-readOnly"),a.removeClass("vis-gc-vpanel-table-readOnly"),v.removeClass("vis-gc-vpanel-table-readOnly"),y.removeClass("vis-gc-vpanel-table-readOnly"),c.removeClass("vis-gc-vpanel-table-readOnly"),c.removeAttr("disabled")):(rt.hide(),it.show(),l.addClass("vis-gc-vpanel-table-readOnly"),a.addClass("vis-gc-vpanel-table-readOnly"),v.addClass("vis-gc-vpanel-table-readOnly"),y.addClass("vis-gc-vpanel-table-readOnly"),c.addClass("vis-gc-vpanel-table-readOnly"),c.attr("disabled",!0));l.attr("readonly",!n);a.attr("readonly",!n);v.attr("readonly",!n);y.attr("readonly",!n)}function r(){var n=c.find("option:selected").text()+" "+g+" "+l.val()+" "+g+" "+a.val()+" "+g+" "+v.val();y.val(n)}function ct(){w.on("click",function(){if(yt(),k.onClose)k.onClose(u);s.dialog("close")});b.on("click",function(){s.dialog("close")});nt.change(function(){o()});ut.change(function(){});l.change(function(){r()});a.change(function(){r()});v.change(function(){r()});c.change(function(){r()});d.change(function(){at(i)})}var e,i,t;for(w=s.find("#btnOk_"+h),b=s.find("#btnCancel_"+h),d=s.find("#cmbLocator_"+h),nt=s.find("#chkCreateNew_"+h),ut=s.find("#txtWarehouseInfo_"+h),c=s.find("#cmbWarehouse_"+h),l=s.find("#txtX_"+h),a=s.find("#txtY_"+h),v=s.find("#txtZ_"+h),y=s.find("#txtValue_"+h),tt=s.find("#divchkCreateNew_"+h),it=s.find("#divWarehouseInfo_"+h),rt=s.find("#divWarehouse_"+h),ft=s.find("#lblX_"+h),et=s.find("#lblY_"+h),ot=s.find("#lblZ_"+h),st=s.find("#lblValue_"+h),ht=s.find("#lblWarehouse_"+h),n.Application.isRTL&&(w.css("margin-right","-132px"),b.css("margin-right","55px"),tt.children(0).css("float","left")),p.refresh(),p.fillCombobox(f,!0,!0,!1),e=0,t=0;t<p.data.length;t++)d.append(" <option value="+p.data[t].Key+">"+p.data[t].Name+"<\/option>"),u==p.data[t].Key&&(e=t);if(d.prop("selectedIndex",e),i=n.dataContext.getJSONData(n.Application.contextUrl+"Locator/GetWarehouse",{Warehouse_ID:lt},null),i!=null)for(t in i)c.append(" <option value="+i[t].M_Warehouse_ID+">"+i[t].Name+"<\/option>");c.prop("selectedIndex",0);at(i);p.getIsOnlyOutgoing()&&tt.hide();o();ct()}function yt(){var i;if(nt.prop("checked")){i="";y.val().trim().length==0&&(i+=st.val()+" - ");l.val().trim().length==0&&(i+=ft.val()+" - ");a.val().trim().length==0&&(i+=et.val()+" - ");v.val().trim().length==0&&(i+=ot.val()+" - ");var f=ht.val(),o=y.val(),s=l.val(),h=a.val(),w=v.val(),r=c.find("option:selected").val();r!=0&&e!=r&&(e=r);e==0&&(i+=f+" - ");i.length!=0?n.ADialog.error("FillMandatory",!0,i.substring(0,i.length-3)):t.ajax({url:n.Application.contextUrl+"Locator/Save",dataType:"json",async:!1,data:{warehouseId:e,tValue:o,tX:s,tY:h,tZ:w},success:function(n){returnValue=n.locatorId;u=returnValue;p.refresh()}})}else k.change=!0}function at(t){var s,f;u=d.find("option:selected").val();var r="",o="",i=n.dataContext.getJSONData(n.Application.contextUrl+"Locator/GetWarehouseData",{Locator_ID:u},null);if(t!=null&&i!=null&&(ut.val(i.Name),l.val(i.x),a.val(i.y),v.val(i.z),y.val(i.Value),e=i.M_Warehouse_ID,o=i.wValue,r=i.Separator),g=r,s=o+" "+r+" "+l.val()+" "+r+" "+a.val()+" "+r+" "+v.val(),y.val(s),t!=null)for(f in t)if(e==t[f].M_Warehouse_ID){c.prop("selectedIndex",f);break}}this.onClose=null;this.change=!1;var s=t("<div style='position:relative;'>"),ct=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),w=null,b=null,k=this,g=null,i=i,u=u,f=f,lt=e,e=0,h=o,p=r,d=null,nt=null,tt=null,it=null,rt=null,ut=null,c=null,l=null,a=null,v=null,y=null,ft=null,et=null,ot=null,st=null,ht=null;setBusy=function(n){ct.css("display",n?"block":"none")};this.load=function(){s.load(n.Application.contextUrl+"Locator/Index/?windowno="+h+"&locatorId="+u,function(){setBusy(!0);vt();setBusy(!1)})};this.showDialog=function(){s.append(ct);s.dialog({modal:!0,resizable:!1,title:n.Msg.translate(n.Env.getCtx(),"Locator"),width:510,position:{at:"center top",of:window},close:function(){k.dispose();k=null;s.dialog("destroy");s=null}})};this.disposeComponent=function(){w&&w.off("click");b&&b.off("click");w=null;b=null;k=null;i=null;u=null;f=null;lt=null;e=null;h=null;p=null;tt=null;it=null;rt=null;d=null;nt=null;ut=null;c=null;l=null;a=null;v=null;y=null;ft=null;et=null;ot=null;st=null;ht=null;this.disposeComponent=null;this.load=null;g=null}}i.prototype.dispose=function(){this.disposeComponent()};n.LocatorForm=i}(VIS,jQuery),function(n,t){function i(i,r,u){function o(n){s.css("display",n?"block":"none")}function h(t){var i='<div style="width: 100%;  float: left" id="fisrt_'+t.windowNum+'"><label class=" VIS_Pref_Label_Font" style="width:15% ;text-align: left;"  id="vlblAttributeText_'+t.windowNum+'">test<\/label><input class="VIS_Pref_pass vis-gc-vpanel-table-readOnly" style="float:none;width:250px"  type="text" readonly="true" id="vtxtAttribute_'+t.windowNum+'" /><label class="VIS_Pref_Label_Font" style="width:auto;"  id="vlblAttribute_'+t.windowNum+'">test<\/label><\/div><div style="width: 100%; float: left" id="second_'+t.windowNum+'"><label class="VIS_Pref_Label_Font" style="width:15% ;text-align: left;" id="vlblValueText_'+t.windowNum+'">test<\/label><input class="VIS_Pref_pass vis-gc-vpanel-table-readOnly" style="float:none;width:250px" type="text" readonly="true" id="vtxtSearchKey_'+t.windowNum+'" /><label class="VIS_Pref_Label_Font" style="width:auto" id="vlblValue_'+t.windowNum+'">test<\/label><\/div><div style="width: 100%; float: left">    <label style="float: none; width:15%;text-align:left" class=" VIS_Pref_Label_Font" id="vlblLevelText_'+t.windowNum+'">test<\/label><div style="width: 83%; display: inline-block"> <div class="VIS_Pref_col-50"><input  type="checkbox" id="vchkTenant_'+t.windowNum+'" ><label class="VIS_Pref_Label_Font">test<\/label><\/div>   <div class="VIS_Pref_col-50"> <input  type="checkbox" id="vchkOrg_'+t.windowNum+'" /><label class="VIS_Pref_Label_Font">test<\/label><\/div> <\/div> <div style="width: 100%; float:left;">  <div class="VIS_Pref_col-50"><input  type="checkbox" id="vchkUser_'+t.windowNum+'" /><label class="VIS_Pref_Label_Font">test<\/label><\/div>  <div class="VIS_Pref_col-50"> <input  type="checkbox" id="vchkWindow_'+t.windowNum+'" /><label class="VIS_Pref_Label_Font">test<\/label><\/div> <\/div><\/div><div id="divMsg_'+t.windowNum+'" style="width: 100%; float: left; margin-bottom: 5px; margin-top: 5px; text-align: left"><label class="VIS_Pref_Label_Font" id="vlblMsg_'+t.windowNum+'">test<\/label><\/div><div style="height: 10%; width: 100%; float: left"> <button type="button" id="btnDelete_'+t.windowNum+'"  class="VIS_Pref_btn-2"  style="margin-bottom:0px;margin-top:0px;float: left" value="Ok" role="button" aria-disabled="false"><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/Delete-W24.PNG" /><\/button> <input id= "btnCancel_'+t.windowNum+'" class="VIS_Pref_btn-2" style="margin-bottom:0px;margin-top:0px; float:right" type="button" value="Cancel" /><input id="btnOK_'+t.windowNum+'"  class="VIS_Pref_btn-2" style="margin-bottom:0px;margin-top:0px ;float:right; margin-right:10px" type="button" value="Ok" /><\/div>';f.append(i)}if(i==null)return null;var e=this,f=t("<div class='vis-forms-container' style='position:relative;'>"),s=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>");if(this.Okbtn=null,this.cancelbtn=null,this.deletebtn=null,this.txtAttribute=null,this.lblAttribute=null,this.txtSearchKey=null,this.lblValue=null,this.lblAttribute=null,this.lblValueText=null,this.lblLevelText=null,this.chkTenant=null,this.chkOrg=null,this.chkUser=null,this.chkWindow=null,this.lblMsg=null,this.userchk=null,this.tenantchk=null,this.windowchk=null,this.orgchk=null,this.aValue=null,this.aDisplayValue=null,r!=null&&(this.aValue=r,typeof r==Boolean&&(this.aValue=r?"Y":"N"),this.aDisplayValue=u==null?this.aValue:u),this.AD_Window_ID=i.getAD_Window_ID(),this.aAttribute=i.getColumnName(),this.aDisplayAttribute=i.getHeader(),this.aDisplayType=i.getDisplayType(),this.AD_Reference_ID=0,this.windowNum=i.getWindowNo(),"Value".equals(this.aAttribute)||"DocumentNo".equals(this.aAttribute))return null;this.AD_Client_ID=n.context.getAD_Client_ID();this.AD_Org_ID=n.context.getWindowContext(this.windowNum,"AD_Org_ID",!0);this.AD_User_ID=n.context.getAD_User_ID();this.role=n.MRole.getDefault();this.load=function(){h(e);f.append(s);o(!0);e.init(f);o(!1)};this.init=function(){this.lblAttributeText=f.find("#vlblAttributeText_"+this.windowNum);this.lblValueText=f.find("#vlblValueText_"+this.windowNum);this.lblLevelText=f.find("#vlblLevelText_"+this.windowNum);this.deletebtn=f.find("#btnDelete_"+this.windowNum);this.txtAttribute=f.find("#vtxtAttribute_"+this.windowNum);this.txtSearchKey=f.find("#vtxtSearchKey_"+this.windowNum);this.chkTenant=f.find("#vchkTenant_"+this.windowNum);this.chkOrg=f.find("#vchkOrg_"+this.windowNum);this.chkUser=f.find("#vchkUser_"+this.windowNum);this.chkWindow=f.find("#vchkWindow_"+this.windowNum);this.lblMsg=f.find("#vlblMsg_"+this.windowNum);this.lblAttribute=f.find("#vlblAttribute_"+this.windowNum);this.lblValue=f.find("#vlblValue_"+this.windowNum);this.Okbtn=f.find("#btnOK_"+this.windowNum);this.cancelbtn=f.find("#btnCancel_"+this.windowNum);n.Application.isRTL?(this.Okbtn.css("margin-right","-128px"),this.cancelbtn.css("margin-right","55px"),this.lblAttributeText.css("text-align","right"),this.lblValueText.css("text-align","right"),this.lblLevelText.css("text-align","right"),this.chkOrg.css("margin-right","0px"),this.chkTenant.css("margin-right","37px"),this.chkUser.css("margin-right","72px"),this.chkWindow.css("margin-right","72px"),f.find("#divMsg_"+this.windowNum).css("text-align","right")):(this.chkUser.css("margin-left","83px"),this.chkWindow.css("margin-left","45px"));this.txtAttribute.val(this.aDisplayAttribute==null?"":this.aDisplayAttribute);this.lblAttribute.text(this.aAttribute==null?"":this.aAttribute);this.txtSearchKey.val(this.aDisplayValue==null?"":n.Utility.decodeText(this.aDisplayValue));this.lblValue.text(this.aValue);this.lblAttributeText.text(n.Msg.getMsg("Attribute"));this.lblValueText.text(n.Msg.getMsg("SearchKey"));this.lblLevelText.text(n.Msg.getMsg("ValuePreferenceSetFor"));this.chkTenant.next("label").text(n.Msg.getMsg("Tenant"));this.chkOrg.next("label").text(n.Msg.getMsg("Org"));this.chkUser.next("label").text(n.Msg.getMsg("UserContact"));this.chkWindow.next("label").text(n.Msg.getMsg("Window"));this.chkTenant.prop("disabled",!0);this.chkTenant.prop("checked",!0);this.chkUser.prop("checked",!0);this.chkWindow.prop("checked",!0);n.MRole.PREFERENCETYPE_Client.equals(n.MRole.getPreferenceType())||(this.chkOrg.prop("disabled",!0),this.chkOrg.prop("checked",!0));n.MRole.PREFERENCETYPE_Client.equals(n.MRole.getPreferenceType())||n.MRole.PREFERENCETYPE_Organization.equals(n.MRole.getPreferenceType())||(this.chkUser.prop("disabled",!0),this.chkUser.prop("checked",!0));this.setExplanation();this.Okbtn.on("click",function(){o(!0);e.save();o(!1);f.dialog("close")});this.cancelbtn.on("click",function(){f.dialog("close")});this.deletebtn.on("click",function(){e.delete();f.dialog("close")});t("[id^=vch]").click(function(){e.setExplanation()})};this.showDialog=function(){f.append(s);o(!0);setTimeout(this.load(),5);f.dialog({modal:!0,title:n.Msg.getMsg("ValuePreference"),width:530,position:{at:"center top",of:window},close:function(){e.dispose();f.dialog("destroy");f=null}})};this.disposeComponent=function(){this.Okbtn&&this.Okbtn.off("click");this.cancelbtn&&this.cancelbtn.off("click");this.deletebtn&&this.deletebtn.off("click");t("[id^=vch]")&&t("[id^=vch]").off("click");this.Okbtn=null;this.cancelbtn=null;this.deletebtn=null;s=null;e=null;this.disposeComponent=null}}i.prototype.setExplanation=function(){var t="For ";this.chkTenant.prop("checked")&&this.chkOrg.prop("checked")?t+="this Client and Organization":this.chkTenant.prop("checked")&&!this.chkOrg.prop("checked")?t+="all Organizations of this Client":!this.chkTenant.prop("checked")&&this.chkOrg.prop("checked")?(this.chkOrg.prop("checked",!1),t+="entire System"):t+="entire System";t+=this.chkUser.prop("checked")?", this User":", all Users";t+=this.chkWindow.prop("checked")?" and this Window":" and all Windows";n.Env.isBaseLanguage()&&this.lblMsg.text(t.toString());this.orgchk=this.chkOrg.prop("checked");this.userchk=this.chkUser.prop("checked");this.windowchk=this.chkWindow.prop("checked");this.tenantchk=this.chkTenant.prop("checked")};i.prototype.getADPreferenceID=function(){var t="SELECT AD_Preference_ID FROM AD_Preference WHERE ",u=this.tenantchk?this.AD_Client_ID:0,i,r;return t+="AD_Client_ID="+u,u=this.orgchk?this.AD_Org_ID:0,t+=" AND AD_Org_ID="+u,t+=this.userchk?" AND AD_User_ID="+this.AD_User_ID:" AND AD_User_ID IS NULL",t+=this.windowchk?" AND AD_Window_ID="+this.AD_Window_ID:" AND AD_Window_ID IS NULL",t+=" AND Attribute='"+this.aAttribute+"'",i=0,r=n.DB.executeDataSet(t.toString()),r!=null&&r.tables[0].rows.length>0&&(i=r.tables[0].rows[0].getCell("ad_preference_id")),i<0&&(i=0),i};i.prototype.delete=function(){var i=!1,r=this.getADPreferenceID(),u=this;return r>0?t.ajax({url:n.Application.contextUrl+"ValuePreference/Delete",dataType:"json",data:{preferenceId:r},success:function(t){i=t.result;i&&(n.Env.getCtx().setContext(u.getContextKey(),null),n.ADialog.info("ValuePreferenceDeleted",!0,"",null))}}):n.ADialog.warn("ValuePreferenceNotFound",!0,"",null),i};i.prototype.save=function(){if(this.aValue==null)if(n.DisplayType.IsLookup(this.displayType))this.aValue="-1";else if(n.DisplayType.IsDate(this.displayType))this.aValue=" ";else return n.ADialog.warn("ValuePreferenceNotInserted",!0,"",null),!1;else if(this.aValue.toString().indexOf("@")!=-1)return!1;var i=!1,u=this.getADPreferenceID(),r=this;return t.ajax({url:n.Application.contextUrl+"ValuePreference/Save",dataType:"json",data:{preferenceId:u,clientId:this.tenantchk?this.AD_Client_ID:0,orgId:this.orgchk?this.AD_Org_ID:0,chkWindow:this.windowchk,AD_Window_ID:this.AD_Window_ID,chkUser:this.userchk,attribute:this.aAttribute,userId:this.AD_User_ID,value:this.aValue},success:function(t){i=t.result;i?(n.Env.getCtx().setContext(r.getContextKey(),r.aValue),n.ADialog.info("ValuePreferenceInserted",!0,"",null)):n.ADialog.warn("ValuePreferenceNotInserted",!0,"",null)}}),i};i.prototype.getContextKey=function(){return this.windowchk?"P"+this.AD_Window_ID+"|"+this.aAttribute:"P|"+this.aAttribute};i.prototype.dispose=function(){this.disposeComponent()};n.ValuePreference=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s){function li(){t.ajax({url:n.Application.contextUrl+"PAttributes/Load",dataType:"json",async:!1,data:{mAttributeSetInstanceId:b,mProductId:nt,productWindow:ft,windowNo:y,AD_Column_ID:o,window_ID:pt,IsSOTrx:gt,IsInternalUse:ni},success:function(t){if(returnValue=t.result,returnValue.Error!=null){n.ADialog.error(returnValue.Error,null,null,null);it.hasAttribute=!1;return}h.html(returnValue.tableStucture);h.append(bt);returnValue.ControlList&&(c=returnValue.ControlList.split(","));ci=returnValue.MAttributeSetID}})}function ai(t){var i,r;if(l.val(""),p.val(""),a.val(Globalize.format(new Date,"yyyy-MM-dd")),t=jQuery.parseJSON(t),t.result!=null)for(i in t.result)if(c){r=h.find("[attribute_id="+i+"]");r.attr("id").contains("cmb")?r.val(n.Utility.Util.getValueOfInt(t.result[i])):r.val(t.result[i]);continue}l!=null&&t.lot!=""?l.val(t.lot):p!=null&&t.serial!=""&&p.val(t.serial);a!=null&&t.gdate!=""&&a.val(Globalize.format(new Date(t.gdate),"yyyy-MM-dd"))}function vi(){var t=!0,f=!1,i,r,u;if(tt.prop("checked"))f=wt.val().length>0?!0:!1;else if(rt.prop("checked")){if(i=l.val(),t=!1,r=n.dataContext.getJSONData(n.Application.contextUrl+"PAttributes/CheckUniqueLot",null,null),r>0&&(u=pi(i),u))return t=!0,n.ADialog.Info("LotNoExists",null,null,null),!1;t||ri()}else{if(t=!1,n.Env.getCtx().setContext(w,"AttrCode",st),it.onClose)it.onClose(b,vt,ut);k(!1);h.dialog("close")}t&&ri()}function ri(){var f=[],u,i;if(c)for(u=0;u<c.length;u++)if(i=h.find("#"+c[u]),c[u].toString().contains("cmb"))i.find("option:selected").length>0?f.push({Key:Number(i.find("option:selected").val()),Name:i.find("option:selected").text()}):f.push({Key:0,Name:i.val()});else{if(i.attr("class").contains("vis-gc-vpanel-table-mandatory")&&i.val().trim().length==0)return n.ADialog.warn("FillMandatoryFields",!0,null),!1;i.attr("type")=="number"&&(i.val().contains(".")||i.val(i.val().concat(".0")));f.push({Key:0,Name:i.val()})}t.ajax({url:n.Application.contextUrl+"PAttributes/Save",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({windowNoParent:w,strLotString:l.val(),strSerNo:p.val(),dtGuaranteeDate:a.val(),strAttrCode:ct.val(),productWindow:ft,mAttributeSetInstanceId:b,mProductId:r,windowNo:y,description:wt.val(),isEdited:tt.prop("checked"),lst:f}),success:function(t){if(returnValue=t.result,returnValue)if(returnValue.Error!=null)n.ADialog.info("",null,returnValue.Error,null),k(!1);else{if(n.Env.getCtx().setContext(w,"AttrCode",returnValue.attrCode),it.onClose)it.onClose(returnValue.M_AttributeSetInstance_ID,returnValue.M_AttributeSetInstanceName,ut);k(!1);h.dialog("close")}},error:function(n,t){console.log(t);k(!1)}})}function yi(){var t,r,f,i;it.log.config("");t=0;w!=-1&&(t=window.DTD001&&pt==170?n.Env.getCtx().getContextAsInt(w,"DTD001_MWarehouseSource_ID"):n.Env.getCtx().getContextAsInt(w,"M_Warehouse_ID"));r="";try{r=n.dataContext.getJSONData(n.Application.contextUrl+"PAttributes/GetTitle",{Warehouse_ID:t,Product_ID:nt},null)}catch(u){console.log(u)}f=-1;i=new n.PAttributeInstance(r,t,ut,nt,yt,p.val(),l.val(),a.val());i.showDialog();i.onClose=function(n,t,i,r){n!=-1&&(b=n,vt=t,ut=i,st=r,dt=!0,k(!0),ei(),rt.prop("checked")&&(rt.prop("checked",!1),ui()),tt.prop("checked")&&(tt.prop("checked",!1),fi()),ii.show(),tt.show())};i=null}function ui(){var n=rt.prop("checked"),i,t;if(tt.attr("disabled",n),l&&(l.attr("readOnly",!n),n?l.removeClass("vis-gc-vpanel-table-readOnly"):l.addClass("vis-gc-vpanel-table-readOnly")),v&&(n?(v.removeClass("vis-gc-vpanel-table-readOnly"),v.removeAttr("disabled")):(v.attr("disabled",!0),v.addClass("vis-gc-vpanel-table-readOnly"))),d&&(n?d.removeAttr("disabled"):d.attr("disabled",!0)),p&&(p.attr("readOnly",!n),n?p.removeClass("vis-gc-vpanel-table-readOnly"):p.addClass("vis-gc-vpanel-table-readOnly")),g&&(n?g.removeAttr("disabled"):g.attr("disabled",!0)),a&&(a.prop("disable",n),n?(a.removeClass("vis-gc-vpanel-table-readOnly"),a.removeAttr("disabled")):(a.addClass("vis-gc-vpanel-table-readOnly"),a.attr("disabled",!0))),c)for(i=0;i<c.length;i++)t=h.find("#"+c[i]),t.attr("readOnly",!n),n?(t.removeClass("vis-gc-vpanel-table-readOnly"),t.removeAttr("disabled")):(t.addClass("vis-gc-vpanel-table-readOnly"),t.attr("disabled",!0))}function fi(){var n=tt.prop("checked"),i,t;if(rt.attr("disabled",n),l&&(l.attr("readOnly",!n),n?l.removeClass("vis-gc-vpanel-table-readOnly"):l.addClass("vis-gc-vpanel-table-readOnly")),v&&(n?(v.removeClass("vis-gc-vpanel-table-readOnly"),v.removeAttr("disabled")):(v.attr("disabled",!0),v.addClass("vis-gc-vpanel-table-readOnly"))),d&&(n?d.removeAttr("disabled"):d.attr("disabled",!0)),p&&(p.attr("readOnly",!n),n?p.removeClass("vis-gc-vpanel-table-readOnly"):p.addClass("vis-gc-vpanel-table-readOnly")),g&&(n?g.removeAttr("disabled"):g.attr("disabled",!0)),a&&(a.prop("disable",n),n?(a.removeClass("vis-gc-vpanel-table-readOnly"),a.removeAttr("disabled")):(a.addClass("vis-gc-vpanel-table-readOnly"),a.attr("disabled",!0))),c)for(i=0;i<c.length;i++)t=h.find("#"+c[i]),t.attr("readOnly",!n),n?(t.removeClass("vis-gc-vpanel-table-readOnly"),t.removeAttr("disabled")):(t.addClass("vis-gc-vpanel-table-readOnly"),t.attr("disabled",!0))}function pi(t){var i=!1,r;try{r=n.dataContext.getJSONData(n.Application.contextUrl+"PAttributes/CheckAttribute",{Window_No:w,Product_ID:nt,LotNumber:t},null);r>0&&(i=!0)}catch(u){console.log(u)}return i}function wi(n){v.append(new Option(n.Name,n.Key,!0,!0));v.change()}function ei(){if(c)for(var i=0;i<c.length;i++)c[i].toString().contains("cmb")?h.find("#"+c[i]).prop("selectedIndex",-1):h.find("#"+c[i]).val("");t.ajax({url:n.Application.contextUrl+"PAttributes/GetAttribute",dataType:"json",data:{mAttributeSetInstanceId:b,mProductId:nt,productWindow:ft,windowNo:y,AD_Column_ID:o,attrcode:st},success:function(n){returnValue=n;returnValue!=null&&ai(returnValue);k(!1)},error:function(n,t){console.log(t);k(!1)}})}function bi(){if(v!=null&&v.change(function(){var n=v.find("option:selected").val(),t=v.find("option:selected").text();n!=null&&n!=-1?(l.val(t),l.attr("readOnly",!0),l.addClass("vis-gc-vpanel-table-readOnly"),oi=n):(l.attr("readOnly",!1),l.removeClass("vis-gc-vpanel-table-readOnly"))}),rt!=null&&rt.change(function(){ui()}),tt!=null&&tt.change(function(){fi()}),ct!=null)ct.on("keydown",function(n){(n.keyCode==13||n.keyCode==9)&&(k(!0),st=ct.val(),ei())});if(et!=null)et.on("click",function(){k(!0);vi()});if(ot!=null)ot.on("click",function(){h.dialog("close")});if(ht!=null){k(!0);ht.on("click",function(){yi()});k(!1)}if(d!=null)d.on("click",function(){t.ajax({url:n.Application.contextUrl+"PAttributes/CreateLot",dataType:"json",async:!1,data:{mAttributeSetInstanceId:b,mProductId:nt},success:function(n){returnValue=n.result;wi(returnValue)}})});if(g!=null)g.on("click",function(){t.ajax({url:n.Application.contextUrl+"PAttributes/GetSerNo",dataType:"json",async:!1,data:{mAttributeSetInstanceId:b,mProductId:nt},success:function(n){returnValue=n.result;p.val(returnValue)}})});c}function k(n){bt.css("display",n?"block":"none")}var ti,lt,at;this.onClose=null;var it=this,h=t("<div style='position:relative'>"),bt=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),y=n.Env.getWindowNo(),b=null,ut=null,vt=null,nt=null,yt=null,kt=null,w=null,oi=null,st="",ft=!1,dt=!1,si=40,hi={},c=null,ci=null,pt=0,gt=!1,ni=!1;if(this.log=n.Logging.VLogger.getVLogger("PAttributesForm"),this.log.config("M_AttributeSetInstance_ID="+i+", M_Product_ID="+r+", C_BPartner_ID="+f+", ProductW="+ft+", Column="+o),b=i,nt=r,yt=f,ft=e,kt=o,w=s,ut=u,w!=-1&&(ti=n.context.getWindowTabContext(w,0,"AD_Tab_ID"),pt=n.dataContext.getJSONRecord("InfoProduct/GetWindowID",ti.toString()),gt=n.context.isSOTrx(w),ni=n.context.getWindowTabContext(w,0,"IsInternalUse")),nt!=0){this.hasAttribute=!0;li();var et=h.find("#btnOk_"+y),ot=h.find("#btnCancel_"+y),ht=h.find("#btnSelect_"+y),d=h.find("#btnLot_"+y),g=h.find("#btnSerNo_"+y),v=h.find("#cmbLot_"+y),rt=h.find("#chkNewEdit_"+y),ii=h.find("#lblEdit_"+y),tt=h.find("#chkEdit_"+y),wt=h.find("#txtDescription_"+y),l=h.find("#txtLotString_"+y),p=h.find("#txtSerNo_"+y),a=h.find("#dtpicGuaranteeDate_"+y),ct=h.find("#txtAttrCode_"+y);if(ht.children(0).attr("src",n.Application.contextUrl+"Areas/VIS/Images/base/Locator10.png"),n.Application.isRTL&&(et.css("margin-right","-138px"),ot.css("margin-right","55px")),!ft)if(rt.prop("checked",b==0),b>0){if(l&&(l.attr("readOnly",!0),l.addClass("vis-gc-vpanel-table-readOnly")),v&&(v.attr("disabled",!0),v.addClass("vis-gc-vpanel-table-readOnly")),d&&d.attr("disabled",!0),p&&(p.attr("readOnly",!0),p.addClass("vis-gc-vpanel-table-readOnly")),g&&g.attr("disabled",!0),a&&(a.prop("disable",!0),a.addClass("vis-gc-vpanel-table-readOnly"),a.attr("disabled",!0)),c)for(lt=0;lt<c.length;lt++)at=h.find("#"+c[lt]),at.attr("readOnly",!0),at.addClass("vis-gc-vpanel-table-readOnly"),at.attr("disabled",!0)}else ii.hide(),tt.hide();bi();this.showDialog=function(){if(h.dialog({modal:!0,title:n.Msg.translate(n.Env.getCtx(),"M_AttributeSetInstance_ID"),width:490,close:function(){it.dispose();it=null;h.dialog("destroy");h=null}}),c&&i==0)for(var t=0;t<c.length;t++)c[t].toString().contains("cmb")&&h.find("#"+c[t]).prop("selectedIndex",-1);k(!1)};this.disposeComponent=function(){et&&et.off("click");ot&&ot.off("click");n.Env.clearWinContext(n.Env.getCtx(),y);n.Env.getCtx().setContext(n.Env.WINDOW_INFO,n.Env.TAB_INFO,"M_AttributeSetInstance_ID",b);n.Env.getCtx().setContext(n.Env.WINDOW_INFO,n.Env.TAB_INFO,"M_Locator_ID",ut);ut=null;vt=null;nt=null;yt=null;kt=null;w=null;ft=null;dt=null;si=0;hi=null;et=null;ot=null;ht=null;d=null;g=null;v=null;rt=null;wt=null;l=null;p=null;a=null;it=null;y=null;b=null;this.disposeComponent=null}}}i.prototype.dispose=function(){this.disposeComponent()};n.PAttributesForm=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s){function vt(t){var f;if(h.log.config("C_BPartner_ID="+t),t!=0){var u=0,i=0,r=null;try{r=n.dataContext.getJSONData(n.Application.contextUrl+"PAttributes/GetBPData",{Product_ID:nt,BPartner_ID:t},null);r!=null&&(u=r.ShelfLifeMinPct,f=r.PCT,f>0&&(i=f),i=r.ShelfLifeMinDays)}catch(e){console.log(e)}u>0&&(k=" AND COALESCE(TRUNC((daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD'))/p.GuaranteeDays)*100),0)>="+u,h.log.config("PAttributeInstance.dynInit - ShelfLifeMinPct="+u));i>0&&(k+=" AND COALESCE(daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD')),0)>="+i,h.log.config("PAttributeInstance.dynInit - ShelfLifeMinDays="+i))}a=yt(ht,ct,!1,"patr")+" ORDER BY asi.GuaranteeDate, QtyOnHand";rt();g.append(d);it.append(v).append(c);y.append(ut).append(g).append(tt).append(it);g.hide();wt()}function yt(t,i,r,u){var f="SELECT DISTINCT patr.M_AttributeSetInstance_ID, asi.Description, asi.Lot, asi.SerNo, asi.GuaranteeDate, asi.Value AS AttrCode, l.Value, NVL(s.M_Locator_ID,0) AS M_Locator_ID, NVL(s.QtyOnHand,0) AS QtyOnHand, NVL(s.QtyReserved,0) AS QtyReserved, NVL(s.QtyOrdered,0) AS QtyOrdered, (daysBetween(TRUNC(asi.GuaranteeDate,'DD'), TRUNC(SysDate,'DD'))-p.GuaranteeDaysMin) as ShelfLifeDays, daysBetween(TRUNC(asi.GuaranteeDate,'DD'), TRUNC(SysDate,'DD')) as GoodForDays, CASE WHEN p.GuaranteeDays > 0 THEN  ROUND(daysBetween(TRUNC(asi.GuaranteeDate,'DD'),TRUNC(SysDate,'DD'))/p.GuaranteeDays*100,12) ELSE 0 END as ShelfLifeRemainingPct",e;return(f=f.concat(" FROM ").concat(t),f=f.concat(" WHERE ").concat(i),t.length==0)?f.toString():(h.log.finest(e),n.MRole.getDefault().addAccessSQL(f,u,n.MRole.SQL_FULLYQUALIFIED,n.MRole.SQL_RO))}function rt(){var o,u,i,t;a==null&&(a="");var f=[],r=a,e=a.lastIndexOf(" ORDER BY ");d.prop("checked")||(r=a.substring(0,e)+st,k.length>0&&(r+=k),r+=a.substring(e));h.log.finest(r);try{if(o=n.secureEngine.encrypt(r),dr=n.dataContext.getJSONData(n.Application.contextUrl+"PAttributes/GetAttributeData",{Sq1Atribute:o,Product_ID:nt},null),dr.length>0){u=1;for(i in dr)t={},t.M_AttributeSetInstance_ID=dr[i].M_AttributeSetInstance_ID,t.Description=dr[i].Description,t.Lot=dr[i].Lot,t.SerNo=dr[i].SerNo,t.GuaranteeDate=dr[i].GuaranteeDate,t.Value=dr[i].Value,t.QtyReserved=dr[i].QtyReserved,t.QtyOrdered=dr[i].QtyOrdered,t.QtyOnHand=dr[i].QtyOnHand,t.GoodForDays=dr[i].GoodForDays,t.ShelfLifeDays=dr[i].ShelfLifeDays,t.ShelfLifeRemainingPct=dr[i].ShelfLifeRemainingPct,t.M_Locator_ID=dr[i].M_Locator_ID,t.AttrCode=dr[i].AttrCode,t.recid=u,u++,f.push(t)}lt()}catch(s){console.log(s)}pt(f)}function pt(i){h.dGrid!=null&&(h.dGrid.destroy(),h.dGrid=null);h.arrListColumns.length==0&&(h.arrListColumns.push({field:"Description",caption:n.Msg.translate(n.Env.getCtx(),"Description"),sortable:!0,size:"16%",min:150,hidden:!1}),h.arrListColumns.push({field:"Lot",caption:n.Msg.translate(n.Env.getCtx(),"Lot"),sortable:!0,size:"10%",min:100,hidden:!1}),h.arrListColumns.push({field:"SerNo",caption:n.Msg.getElement(n.Env.getCtx(),"SerNo"),sortable:!0,size:"10%",min:100,hidden:!1}),h.arrListColumns.push({field:"GuaranteeDate",caption:n.Msg.getElement(n.Env.getCtx(),"GuaranteeDate"),sortable:!0,size:"10%",min:100,hidden:!1,render:"date",options:{format:"yyyy-mm-dd"}}),h.arrListColumns.push({field:"Value",caption:n.Msg.getElement(n.Env.getCtx(),"M_Locator_ID"),sortable:!0,size:"10%",min:100,hidden:!1}),h.arrListColumns.push({field:"QtyReserved",caption:n.Msg.getElement(n.Env.getCtx(),"QtyReserved"),sortable:!0,size:"15%",min:100,hidden:!1}),h.arrListColumns.push({field:"QtyOrdered",caption:n.Msg.getElement(n.Env.getCtx(),"QtyOrdered"),sortable:!0,size:"15%",min:100,hidden:!1}),h.arrListColumns.push({field:"QtyOnHand",caption:n.Msg.getElement(n.Env.getCtx(),"QtyOnHand"),sortable:!0,size:"15%",min:100,hidden:!1}),h.arrListColumns.push({field:"GoodForDays",caption:n.Msg.getElement(n.Env.getCtx(),"GoodForDays"),sortable:!0,size:"15%",min:100,hidden:!1}),h.arrListColumns.push({field:"ShelfLifeDays",caption:n.Msg.getElement(n.Env.getCtx(),"ShelfLifeDays"),sortable:!0,size:"15%",min:100,hidden:!1}),h.arrListColumns.push({field:"ShelfLifeRemainingPct",caption:n.Msg.getElement(n.Env.getCtx(),"ShelfLifeRemainingPct"),sortable:!0,size:"20%",min:100,hidden:!1}),h.arrListColumns.push({field:"M_Locator_ID",caption:n.Msg.getElement(n.Env.getCtx(),"M_Locator_ID"),sortable:!0,size:"16%",min:150,hidden:!0}),h.arrListColumns.push({field:"M_AttributeSetInstance_ID",caption:n.Msg.translate(n.Env.getCtx(),"ID"),sortable:!0,size:"16%",min:150,hidden:!0}),h.arrListColumns.push({field:"AttrCode",caption:n.Msg.getElement(n.Env.getCtx(),"AttrCode"),sortable:!0,size:"16%",min:150,hidden:!0}));setTimeout(10);w2utils.encodeTags(i);h.dGrid=t(tt).w2grid({name:"gridPinstance"+l,show:{toolbar:!0,footer:!0},recordHeight:30,columns:h.arrListColumns,records:i,multiSearch:!0,searches:[{field:"Description",caption:"Description",type:"text"},{field:"Lot",caption:"Lot",type:"text"},{field:"SerNo",caption:"SerNo",type:"text"},{field:"GuaranteeDate",caption:"GuaranteeDate",type:"date",options:{format:"yyyy-mm-dd"}}],onClick:function(){h.dGrid.records.length>0&&c.removeAttr("disabled")}});o?h.dGrid.search("all",o):s&&h.dGrid.search("all",s)}function lt(){var n=-1,t=n!=-1,i;h.dGrid!=null&&(n=Number(h.dGrid.getSelection().toString()),w=-1,b=null,p=0,t=n!=-1,t&&n>0&&(i=h.dGrid.get(n).M_AttributeSetInstance_ID,i>0&&(w=i,b=h.dGrid.get(n).Description,p=h.dGrid.get(n).M_Locator_ID,ot=h.dGrid.get(n).AttrCode)));c.attr("disabled",!0);t&&c.removeAttr("disabled");h.log.fine("M_AttributeSetInstance_ID="+w+" - "+b+"; M_Locator_ID="+p)}function wt(){if(c!=null)c.on(n.Events.onTouchStartOrClick,function(){if(lt(),h.onClose)h.onClose(w,b,p,ot);y.dialog("close")});if(v!=null)v.on(n.Events.onTouchStartOrClick,function(){y.dialog("close")});d!=null&&d.change(function(){rt()})}var h=this;this.onClose=null;var y=t("<div>"),ut=t("<div class='vis-apanel-busy'>"),at=r,p=u,nt=f,ft=e,et=i;this.arrListColumns=[];this.dGrid=null;var w=-1,b=null,ot="",a="",st="",ht="M_ProductAttributes patr LEFT JOIN M_Storage s ON (patr.M_AttributeSetInstance_ID = s.M_AttributeSetInstance_ID AND patr.M_Product_ID = s.M_Product_ID) LEFT JOIN M_Locator l ON (s.M_Locator_ID=l.M_Locator_ID) INNER JOIN M_Product p ON (patr.M_Product_ID=p.M_Product_ID) INNER JOIN M_AttributeSetInstance asi ON (patr.M_AttributeSetInstance_ID=asi.M_AttributeSetInstance_ID)",ct=" patr.M_Product_ID=@M_Product_ID AND patr.M_AttributeSetInstance_ID != 0",k="";this.log=n.Logging.VLogger.getVLogger("PAttributeInstance");var l=n.Env.getWindowNo(),d=t("<input id='chkShowAll_"+l+"' type='checkbox' ><span><label id='lblShowAll_"+l+"' class='VIS_Pref_Label_Font'>"+n.Msg.getMsg("ShowAll")+"<\/label><\/span>"),c=t("<input id='btnOk_"+l+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 5px; float: right; margin-right: 15px ;' type='button' value='"+n.Msg.getMsg("OK")+"'>"),v=t("<input id='btnCancel_"+l+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 5px; float: right;margin-right: 0px;' type='button' value='"+n.Msg.getMsg("Cancel")+"'>"),g=t("<div id='topdiv_"+l+"' style='float: left; width: 100%; height: 10%; text-align: right;'>"),tt=t("<div id='middeldiv_"+l+"' style='float: left; width: 100%; height: 86%;'>"),it=t("<div id='bottomdiv_"+l+"' style='float: left; width: 100%; height: 14%;'>");n.Application.isRTL&&(g.css("text-align","left"),c.css("margin-right","-130px"),v.css("margin-right","55px"));this.showDialog=function(){y.dialog({modal:!0,title:et,width:540,height:400,resizable:!1,close:function(){h.dispose();h=null;y.dialog("destroy");y=null}});rt()};this.disposeComponent=function(){c&&c.off("click");v&&v.off("click");c=null;v=null;l=null;this.onClose=null;ut=null;at=null;p=null;nt=null;ft=null;et=null;this.arrListColumns=null;this.dGrid=null;ht=null;ct=null;st=null;k=null;this.log=null;d=null;g=null;tt=null;it=null;w=null;b=null;a=null;this.disposeComponent=null};vt(ft)}i.prototype.dispose=function(){this.disposeComponent()};n.PAttributeInstance=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o){function rt(){t.ajax({url:n.Application.contextUrl+"GenralAttribute/Load",dataType:"json",async:!1,data:{mAttributeSetInstanceId:v,vadms_AttributeSet_ID:p,windowNo:h},success:function(t){if(returnValue=t.result,n.Env.getCtx().setContext(h,"C_GenAttributeSet_ID",p),returnValue.Error!=null){n.ADialog.error(returnValue.Error,null,null,null);return}s.html(returnValue.tableStucture);a=returnValue.ControlList.split(",")}})}function ut(){for(var u=[],r,i=0;i<a.length;i++)r=s.find("#"+a[i]),a[i].toString().contains("cmb")?u.push({Key:Number(r.find("option:selected").val()),Name:r.find("option:selected").text()}):u.push({Key:0,Name:n.Utility.decodeText(r.val())});t.ajax({url:n.Application.contextUrl+"GenralAttribute/Save",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({windowNoParent:w,mAttributeSetInstanceId:v,vadms_AttributeSet_ID:p,windowNo:h,lst:u}),success:function(n){if(returnValue=n.result,l.onClose)l.onClose(returnValue.M_AttributeSetInstance_ID,returnValue.M_AttributeSetInstanceName)}})}function ft(){for(var u=[],r,i=0;i<a.length;i++)r=s.find("#"+a[i]),a[i].toString().contains("cmb")?u.push({Key:Number(r.find("option:selected").val()),Name:r.find("option:selected").text()}):u.push({Key:0,Name:r.val()});t.ajax({url:n.Application.contextUrl+"GenralAttribute/SearchValues",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({windowNoParent:Number(w),mAttributeSetInstanceId:v,vadms_AttributeSet_ID:p,windowNo:h,lst:u}),success:function(n){if(returnValue=n.result,l.onClose){returnValue.M_AttributeSetInstanceName==null&&(returnValue.M_AttributeSetInstanceName=returnValue.Description);l.onClose(returnValue.M_AttributeSetInstance_ID,returnValue.M_AttributeSetInstanceName,returnValue.GenSetInstance)}}})}var l,s;this.onClose=null;l=this;s=t("<div>");this.log=n.Logging.VLogger.getVLogger("GenralAttributeForm");var h=n.Env.getWindowNo(),v=null,k=null,d=null,w=u,p=0,g=!1,nt=40,tt=o,it={},b=!1,c=null,y=null,a=null;this.log.config("C_GenAttributeSetInstance_ID="+i);v=i;p=r;tt=o;b=f;rt();c=s.find("#btnOk_"+h);y=s.find("#btnCancel_"+h);e?(c.attr("disabled",!1),c.css("opacity","1")):(c.attr("disabled",!0),c.css("opacity","0.6"));n.Application.isRTL&&(c.css("margin-right","-132px"),y.css("margin-right","55px"));this.btnSelect=s.find("#btnSelect_"+h);this.txtDescription=s.find("#txtDescription_"+h);c.on("click",function(){b?ft():ut();s.dialog("close")});y.on("click",function(){s.dialog("close")});this.showDialog=function(){s.dialog({modal:!0,title:n.Msg.translate(n.Env.getCtx(),"C_GenAttributeSetInstance_ID"),width:400,close:function(){l.dispose();l=null;s.dialog("destroy");s=null}})};this.disposeComponent=function(){c&&c.off("click");y&&y.off("click");n.Env.clearWinContext(n.Env.getCtx(),h);n.Env.getCtx().setContext(n.Env.WINDOW_INFO,n.Env.TAB_INFO,"M_AttributeSetInstance_ID",v);c=null;y=null;mLocatorId=null;k=null;mProductId=null;d=null;adColumnId=null;w=null;productWindow=null;g=null;nt=0;it=null;l=null;h=null;v=null;this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};n.GenralAttributeForm=i}(VIS,jQuery),function(n,t){function i(i,r,u,f){function of(i,r,u){var f=null;return i.sql=n.secureEngine.encrypt(i.sql),t.ajax({url:rf,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:r,data:JSON.stringify(i)}).done(function(n){f=n;u&&u(n)}),f}function bu(n,i,r){var u=null;return t.ajax({url:nf,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}this.onClose=null;var ti=t("<div style='position:relative;'>"),ei=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),s=this,pu=i,oi=r,at=u,o=n.Env.getWindowNo(),wu=null,di=new n.Controls.VLabel,k=null,bt=null,lt=null,g=null,nt=null,d=null,tt=null,it=null,rt=null,ut=null,ft=null,et=null,ot=null,st=null,ht=null,ct=null,h=null,c=null,l=null,a=null,v=null,y=null,p=null,w=null,b=null,gi=null,nr=null,tr=null,ir=null,rr=null,ur=null,fr=null,er=null,or=null,sr=!1,hr=!1,cr=!1,lr=!1,ar=!1,vr=!1,yr=!1,pr=!1,wr=!1,br=n.Application.contextUrl,nf=br+"JsonData/JDataSetWithCode",tf=br+"JsonData/ExecuteNonQuer",rf=br+"Form/JDataSet",uf=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,bu(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u},vt=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u;return i&&(e.param=i),u=null,bu(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u},ff=function(n,i,r){var f=r?!0:!1,u=null,e={sql:n,param:i};return t.ajax({url:tf+"yWithCode",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:f,data:JSON.stringify(e)}).done(function(n){u=n;r&&r(n)}),u},ef=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,of(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u};this.log=n.Logging.VLogger.getVLogger("AccountForm");this.log.config("C_AcctSchema_ID="+at+", C_ValidCombination_ID="+oi.C_ValidCombination_ID);var sf=181,kr="AC",dr="AY",gr="BP",nu="LF",tu="LT",iu="MC",ru="OO",uu="OT",fu="PJ",eu="PR",ou="SA",su="SR",hu="U1",cu="U2",si="X1",hi="X2",ci="X3",li="X4",ai="X5",vi="X6",yi="X7",pi="X8",wi="X9",yt=t("<table>");yt.css("width","100%");var kt=t("<tr>"),gt=null,ni=null,ri=null,ui=null,fi=null,lu=null,bi=null,ku=null,du=null,ki=null,gu=null,pt=null,hf=!1,au=null,ii=null,e=null,vu=null,yu=null,wt=null,dt=null;this.load=function(){ti.load(n.Application.contextUrl+"AccountForm/Index/?windowno="+o,function(){s.setBusy(!0);s.init(ti);s.setBusy(!1)})};this.setBusy=function(n){ei.css("display",n?"block":"none")};this.init=function(i){function br(){n.Env.getCtx().setContext(o,"C_AcctSchema_ID",at);t.ajax({url:n.Application.contextUrl+"AccountForm/LoadControls",dataType:"json",data:{windowNo:o,C_AcctSchema_ID:at},success:function(n){returnValue=n.result;pu(returnValue);dt=returnValue}})}function pu(i){n.AEnv.getGridWindow(o,153,function(r){var ku,pu,du,wu,bu,dt,kt,ti,fi,ei,ui,ni,gu,au,yu;if(r.error!=null){n.ADialog.error(r.error);self.dispose();self=null;return}if(ku=t.parseJSON(r.result),n.context.setContextOfWindow(t.parseJSON(r.wCtx),o),pu=new n.GridWindow(ku),pu!=null){for(e=pu.getTabs()[0],e.getField("Alias").setDisplayLength(15),e.getField("Combination").setDisplayLength(15),e.getField("AD_Client_ID").setDisplayed(!1),e.getField("C_AcctSchema_ID").setDisplayed(!1),e.getField("IsActive").setDisplayed(!1),e.getField("IsFullyQualified").setDisplayed(!1),dt=0;dt<e.getFieldCount();dt++)kt=e.getField(dt),kt.getIsDisplayed(!0)||kt.setDisplayed(!1);for(du=o+"_"+at,pt=new n.GridController(!1,!1,du),pt.initGrid(!0,o,s,e),pt.setVisible(!0),window.innerHeight>700?pt.sizeChanged(window.innerHeight-230,window.innerWidth):pt.sizeChanged(window.innerHeight-215,window.innerWidth),ki.append(pt.getRoot()),pt.activate(),i.IsHasAlies&&(wu=e.getField("Alias"),k=n.VControlFactory.getControl(e,wu,!1),u(wu,k,!1)),bu=e.getField("Combination"),bt=n.VControlFactory.getControl(e,bu,!1),u(bu,bt,!1),dt=0;dt<i.Elements.length;dt++){var di=returnValue.Elements[dt].Type,gt=returnValue.Elements[dt].IsMandatory,br=returnValue.Elements[dt].IsHeavyData,ri=returnValue.Elements[dt].Name;if(di.equals(ru))kt=e.getField("AD_Org_ID"),lt=n.VControlFactory.getControl(e,kt,!1),u(kt,lt,gt,ri,ru);else if(di.equals(kr))kt=e.getField("Account_ID"),g=n.VControlFactory.getControl(e,kt,!1),g.setValue(at),u(kt,g,gt,ri,kr);else if(di.equals(ou))kt=e.getField("C_SubAcct_ID"),nt=n.VControlFactory.getControl(e,kt,!1),u(kt,nt,gt,ri,ou);else if(di.equals(eu))kt=e.getField("M_Product_ID"),d=n.VControlFactory.getControl(e,kt,!1),d.getBtn(),u(kt,d,gt,ri,eu);else if(di.equals(gr))kt=e.getField("C_BPartner_ID"),tt=n.VControlFactory.getControl(e,kt,!1),u(kt,tt,gt,ri,gr);else if(di.equals(iu))kt=e.getField("C_Campaign_ID"),it=n.VControlFactory.getControl(e,kt,!1),u(kt,it,gt,ri,iu);else if(di.equals(nu))kt=e.getField("C_LocFrom_ID"),rt=n.VControlFactory.getControl(e,kt,!1),u(kt,rt,gt,ri,nu);else if(di.equals(tu))kt=e.getField("C_LocTo_ID"),ut=n.VControlFactory.getControl(e,kt,!1),u(kt,ut,gt,ri,tu);else if(di.equals(fu))kt=e.getField("C_Project_ID"),ft=n.VControlFactory.getControl(e,kt,!1),u(kt,ft,gt,ri,fu);else if(di.equals(su))kt=e.getField("C_SalesRegion_ID"),et=n.VControlFactory.getControl(e,kt,!1),u(kt,et,gt,ri,su);else if(di.equals(uu))kt=e.getField("AD_OrgTrx_ID"),ot=n.VControlFactory.getControl(e,kt,!1),u(kt,ot,gt,ri,uu);else if(di.equals(dr))kt=e.getField("C_Activity_ID"),st=n.VControlFactory.getControl(e,kt,!1),u(kt,st,gt,ri,dr);else if(di.equals(hu))kt=e.getField("User1_ID"),ht=n.VControlFactory.getControl(e,kt,!1),u(kt,ht,gt,ri,hu);else if(di.equals(cu))kt=e.getField("User2_ID"),ct=n.VControlFactory.getControl(e,kt,!1),u(kt,ct,gt,ri,cu);else if(di.equals(si))if(kt=e.getField("UserElement1_ID"),i.Elements[dt].AD_Column_ID>0)if(ui="VIS_125",ni=[],ni[0]=new n.DB.SqlParam("@AD_Column_ID",i.Elements[dt].AD_Column_ID),ti=vt(ui,ni),br){fi=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.Search);h=new n.Controls.VTextBoxButton(ti,gt,!1,!0,n.DisplayType.Search,fi);u(kt,h,gt,ri,si);h.fireValueChanged=lu;function lu(){gi=h.getValue();sr=!0}}else ei=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.TableDir),h=new n.Controls.VComboBox(ti,!1,!1,!0,ei,150,n.DisplayType.TableDir,0),u(kt,h,gt,ri,si),sr=!1;else continue;else if(di.equals(hi))if(kt=e.getField("UserElement2_ID"),i.Elements[dt].AD_Column_ID>0)if(ui="VIS_125",ni=[],ni[0]=new n.DB.SqlParam("@AD_Column_ID",i.Elements[dt].AD_Column_ID),ti=vt(ui,ni),br){fi=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.Search);c=new n.Controls.VTextBoxButton(ti,gt,!1,!0,n.DisplayType.Search,fi);u(kt,c,gt,ri,hi);c.fireValueChanged=lu;function lu(){nr=c.getValue();hr=!0}}else ei=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.TableDir),c=new n.Controls.VComboBox(ti,!1,!1,!0,ei,150,n.DisplayType.TableDir,0),u(kt,c,gt,ri,hi),hr=!1;else continue;else if(di.equals(ci))if(kt=e.getField("UserElement3_ID"),i.Elements[dt].AD_Column_ID>0)if(ui="VIS_125",ni=[],ni[0]=new n.DB.SqlParam("@AD_Column_ID",i.Elements[dt].AD_Column_ID),ti=vt(ui,ni),br){fi=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.Search);l=new n.Controls.VTextBoxButton(ti,gt,!1,!0,n.DisplayType.Search,fi);u(kt,l,gt,ri,ci);l.fireValueChanged=lu;function lu(){tr=l.getValue();cr=!0}}else ei=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.TableDir),l=new n.Controls.VComboBox(ti,!1,!1,!0,ei,150,n.DisplayType.TableDir,0),u(kt,l,gt,ri,ci),cr=!1;else continue;else if(di.equals(li))if(kt=e.getField("UserElement4_ID"),i.Elements[dt].AD_Column_ID>0)if(ui="VIS_125",ni=[],ni[0]=new n.DB.SqlParam("@AD_Column_ID",i.Elements[dt].AD_Column_ID),ti=vt(ui,ni),br){fi=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.Search);a=new n.Controls.VTextBoxButton(ti,gt,!1,!0,n.DisplayType.Search,fi);u(kt,a,gt,ri,li);a.fireValueChanged=lu;function lu(){ir=a.getValue();lr=!0}}else ei=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.TableDir),a=new n.Controls.VComboBox(ti,!1,!1,!0,ei,150,n.DisplayType.TableDir,0),u(kt,a,gt,ri,li),lr=!1;else continue;else if(di.equals(ai))if(kt=e.getField("UserElement5_ID"),i.Elements[dt].AD_Column_ID>0)if(ui="VIS_125",ni=[],ni[0]=new n.DB.SqlParam("@AD_Column_ID",i.Elements[dt].AD_Column_ID),ti=vt(ui,ni),br){fi=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.Search);v=new n.Controls.VTextBoxButton(ti,gt,!1,!0,n.DisplayType.Search,fi);u(kt,v,gt,ri,ai);v.fireValueChanged=lu;function lu(){rr=v.getValue();ar=!0}}else ei=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.TableDir),v=new n.Controls.VComboBox(ti,!1,!1,!0,ei,150,n.DisplayType.TableDir,0),u(kt,v,gt,ri,ai),ar=!1;else continue;else if(di.equals(vi))if(kt=e.getField("UserElement6_ID"),i.Elements[dt].AD_Column_ID>0)if(ui="VIS_125",ni=[],ni[0]=new n.DB.SqlParam("@AD_Column_ID",i.Elements[dt].AD_Column_ID),ti=vt(ui,ni),br){fi=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.Search);y=new n.Controls.VTextBoxButton(ti,gt,!1,!0,n.DisplayType.Search,fi);u(kt,y,gt,ri,vi);y.fireValueChanged=lu;function lu(){ur=y.getValue();vr=!0}}else ei=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.TableDir),y=new n.Controls.VComboBox(ti,!1,!1,!0,ei,150,n.DisplayType.TableDir,0),u(kt,y,gt,ri,vi),vr=!1;else continue;else if(di.equals(yi))if(kt=e.getField("UserElement7_ID"),i.Elements[dt].AD_Column_ID>0)if(ui="VIS_125",ni=[],ni[0]=new n.DB.SqlParam("@AD_Column_ID",i.Elements[dt].AD_Column_ID),ti=vt(ui,ni),br){fi=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.Search);p=new n.Controls.VTextBoxButton(ti,gt,!1,!0,n.DisplayType.Search,fi);u(kt,p,gt,ri,yi);p.fireValueChanged=lu;function lu(){fr=p.getValue();yr=!0}}else ei=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.TableDir),p=new n.Controls.VComboBox(ti,!1,!1,!0,ei,150,n.DisplayType.TableDir,0),u(kt,p,gt,ri,yi),yr=!1;else continue;else if(di.equals(pi))if(kt=e.getField("UserElement8_ID"),i.Elements[dt].AD_Column_ID>0)if(ui="VIS_125",ni=[],ni[0]=new n.DB.SqlParam("@AD_Column_ID",i.Elements[dt].AD_Column_ID),ti=vt(ui,ni),br){fi=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.Search);w=new n.Controls.VTextBoxButton(ti,gt,!1,!0,n.DisplayType.Search,fi);u(kt,w,gt,ri,pi);w.fireValueChanged=lu;function lu(){er=w.getValue();pr=!0}}else ei=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.TableDir),w=new n.Controls.VComboBox(ti,!1,!1,!0,ei,150,n.DisplayType.TableDir,0),u(kt,w,gt,ri,pi),pr=!1;else continue;else if(di.equals(wi))if(kt=e.getField("UserElement9_ID"),i.Elements[dt].AD_Column_ID>0)if(ui="VIS_125",ni=[],ni[0]=new n.DB.SqlParam("@AD_Column_ID",i.Elements[dt].AD_Column_ID),ti=vt(ui,ni),br){fi=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.Search);b=new n.Controls.VTextBoxButton(ti,gt,!1,!0,n.DisplayType.Search,fi);u(kt,b,gt,ri,wi);b.fireValueChanged=lu;function lu(){or=b.getValue();wr=!0}}else ei=n.MLookupFactory.getMLookUp(n.Env.getCtx(),o,i.Elements[dt].AD_Column_ID,n.DisplayType.TableDir),b=new n.Controls.VComboBox(ti,!1,!1,!0,ei,150,n.DisplayType.TableDir,0),u(kt,b,gt,ri,wi),wr=!1;else continue}wt.css("display","none");bi.html(yt);ii=new n.Query;ii.addRestriction("C_AcctSchema_ID",n.Query.prototype.EQUAL,at);ui="VIS_126";ni=[];ni[0]=new n.DB.SqlParam("@tblID_s",f);gu=vt(ui,ni);gu=="GL_JournalLine"&&ii.addRestriction("IsFullyQualified",n.Query.prototype.EQUAL,"Y");oi.C_ValidCombination_ID==0?e.setQuery(n.Query.prototype.getEqualQuery("1","2")):(au=new n.Query,au.addRestriction("C_AcctSchema_ID",n.Query.prototype.EQUAL,at),au.addRestriction("C_ValidCombination_ID",n.Query.prototype.EQUAL,oi.C_ValidCombination_ID),e.setQuery(au));pt.query(0,0,!1);vu.text(i.Description);yu=yt.find('[name="AD_Org_ID"]');window.setTimeout(function(){var i,u,r,e;if(ki.css("width","73%"),bi.parent().css({width:"27%",padding:"0 10px 0 0"}),i=t(yt.find("button").parent().find("input")[0]).width(),t(yt.find("select")).width(i+35),t(yt.find("input")[0]).width(i+32),t(yt.find("input")[1]).width(i+32),u="VIS_126",r=[],r[0]=new n.DB.SqlParam("@tblID_s",f),e=vt(u,r),e=="GL_JournalLine")yu.on("click",function(){yu.find("option[value=0]").length!=0&&yu.find("option[value=0]").remove()})},200)}})}function u(i,r,u,f,e){var l,c,h,o;s.log.fine("Field="+i);kt=t("<tr>");yt.append(kt);l=n.VControlFactory.getLabel(i);r.setReadOnly(!1);r.setMandatory(u);i.setPropertyChangeListener(r);c=t("<td>");kt.append(c.css("padding","4px 0px 2px 0px"));c.append(l.getControl().addClass("VIS_Pref_Label_Font"));e!=undefined&&(e=="X1"||e=="X2"||e=="X3"||e=="X4"||e=="X5"||e=="X6"||e=="X7"||e=="X8"||e=="X9")&&c.find("label").text(f);kt=t("<tr>");yt.append(kt);h=t("<td>");r.getBtnCount()>=2?(kt.append(h),o=t("<Div style='width: 100%'>"),h.append(o),window.innerHeight>700?(o.append(r.getControl().css("width","85%")),o.append(r.getBtn(0))):(o.append(r.getControl().css("width","85%")),o.append(r.getBtn(0).css("width","30px").css("-webkit-appearance","none").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")))):(kt.append(h),h.append(r.getControl().css("width","100%")))}function r(n){return n==null||n==0?!0:!1}function wu(){if(au=e.getValue("C_ValidCombination_ID"),s.onClose)s.onClose(au);i.dialog("close")}function ti(t){var i=null,u;i=ii!=null?jQuery.extend(!0,{},ii):new n.Query;t&&k!=null&&k.getValue().toString().length>0&&(u=k.getValue().toString().toUpperCase(),u.endsWith("%")||(u+="%"),i.addRestriction("UPPER(Alias)",i.LIKE,u));t&&bt.getValue().toString().length>0&&(u=bt.getValue().toString().toUpperCase(),u.endsWith("%")||(u+="%"),i.addRestriction("UPPER(Combination)",i.LIKE,u));lt!=null&&lt.getValue()!=null&&i.addRestriction("AD_Org_ID",i.EQUAL,lt.getValue());g==null||r(g.getValue())||i.addRestriction("Account_ID",i.EQUAL,g.getValue());nt==null||r(nt.getValue())||i.addRestriction("C_SubAcct_ID",i.EQUAL,nt.getValue());d==null||r(d.getValue())||i.addRestriction("M_Product_ID",i.EQUAL,d.getValue());tt==null||r(tt.getValue())||i.addRestriction("C_BPartner_ID",i.EQUAL,tt.getValue());it==null||r(it.getValue())||i.addRestriction("C_Campaign_ID",i.EQUAL,it.getValue());rt==null||r(rt.getValue())||i.addRestriction("C_LocFrom_ID",i.EQUAL,rt.getValue());ut==null||r(ut.getValue())||i.addRestriction("C_LocTo_ID",i.EQUAL,ut.getValue());ft==null||r(ft.getValue())||i.addRestriction("C_Project_ID",i.EQUAL,ft.getValue());et==null||r(et.getValue())||i.addRestriction("C_SalesRegion_ID",i.EQUAL,et.getValue());ot==null||r(ot.getValue())||i.addRestriction("AD_OrgTrx_ID",i.EQUAL,ot.getValue());st==null||r(st.getValue())||i.addRestriction("C_Activity_ID",i.EQUAL,st.getValue());ht==null||r(ht.getValue())||i.addRestriction("User1_ID",i.EQUAL,ht.getValue());ct==null||r(ct.getValue())||i.addRestriction("User2_ID",i.EQUAL,ct.getValue());h==null||r(h.getValue())||i.addRestriction("UserElement1_ID",i.EQUAL,h.getValue());c==null||r(c.getValue())||i.addRestriction("UserElement2_ID",i.EQUAL,c.getValue());l==null||r(l.getValue())||i.addRestriction("UserElement3_ID",i.EQUAL,l.getValue());a==null||r(a.getValue())||i.addRestriction("UserElement4_ID",i.EQUAL,a.getValue());v==null||r(v.getValue())||i.addRestriction("UserElement5_ID",i.EQUAL,v.getValue());y==null||r(y.getValue())||i.addRestriction("UserElement6_ID",i.EQUAL,y.getValue());p==null||r(p.getValue())||i.addRestriction("UserElement7_ID",i.EQUAL,p.getValue());w==null||r(w.getValue())||i.addRestriction("UserElement8_ID",i.EQUAL,w.getValue());b==null||r(b.getValue())||i.addRestriction("UserElement9_ID",i.EQUAL,b.getValue());e.setQuery(i);pt.query(0,0,!1)}function bu(){k!=null&&k.setValue("");bt.setValue("");di.Content="";di.Visible=!1;wt.val("");lt.setValue(null);g.setValue(null);nt!=null&&nt.setValue(null);d!=null&&d.setValue(null);tt!=null&&tt.setValue(null);it!=null&&it.setValue(null);rt!=null&&rt.setValue(null);ut!=null&&ut.setValue(null);ft!=null&&ft.setValue(null);et!=null&&et.setValue(null);ot!=null&&ot.setValue(null);st!=null&&st.setValue(null);ht!=null&&ht.setValue(null);ct!=null&&ct.setValue(null);h!=null&&h.setValue(null);c!=null&&c.setValue(null);l!=null&&l.setValue(null);a!=null&&a.setValue(null);v!=null&&v.setValue(null);y!=null&&y.setValue(null);p!=null&&p.setValue(null);w!=null&&w.setValue(null);b!=null&&b.setValue(null)}function nf(){var o=null,u="",ui=null,fi,br,yt,vt,si,hi,ci,li,ai,vi,yi,pi,wi,bi,ki,di,pt,wt,bt,kt,gt,ni,ti,ii,ri,kr,dr;for(dt.IsHasAlies&&(ui=k.getValue(),ui==null&&o!=null&&(o=o.concat(n.Msg.translate(n.Env.getCtx(),"Alias")).concat(", "))),fi=[],vt=0;vt<dt.Elements.length;vt++)br=dt.Elements[vt],fi.push(br.Name);if(t.ajax({url:n.Application.contextUrl+"Form/GetValidCombination",dataType:"json",type:"POST",async:!1,data:{accountSchemaElements:JSON.stringify(dt),Elements:JSON.stringify(dt.Elements),aseList:JSON.stringify(fi),value:ui,strinB:o},success:function(n){u=n},error:function(n){console.log(n)}}),o!=null){n.ADialog.info("FillMandatory",!0,o.ToString().Substring(0,o.Length-2),null);return}if(lt==null||lt.getValue()==null){n.ADialog.info("FillMandatory",!0,n.Msg.getElement(n.Env.getCtx(),"AD_Org_ID"),null);return}if(g==null||r(g.getValue())){n.ADialog.info("FillMandatory",!0,n.Msg.getElement(n.Env.getCtx(),"Account_ID"),null);s.setBusy(!1);return}u=u.concat("AD_Client_ID="+n.Env.getCtx().getAD_Client_ID()+" AND C_AcctSchema_ID="+at);s.log.fine("Check = "+u.toString());var gr=k.getValue().toString(),f=0,e=null,oi=k.getValue().toString(),i=null;try{i=ef(u,null);i.read()&&(f=i.tables[0].rows[0].cells.c_validcombination_id,e=i.tables[0].rows[0].cells.alias);i.close();i=null}catch(nu){f=0;i!=null&&(i.close(),i=null)}if(s.log.fine("ID="+f+", Alias="+e),e==null&&(e=""),f!=0&&dt.IsHasAlies&&oi.equals(e)){yt=[];oi.toString().length==0?(u="VIS_127",yt[0]=new n.DB.SqlParam("@IDvalue",f)):(u="VIS_128",yt[0]=new n.DB.SqlParam("@f_alies",oi),yt[1]=new n.DB.SqlParam("@IDvalue",f));vt=0;try{ff(u,yt)}catch(nu){}}if(f!=0){ei(f,at);return}s.log.config("New");e=null;k!=null&&(e=k.getValue().toString());si=0;nt!=null&&nt.getValue()!=null&&(si=nt.getValue());hi=0;d==null||r(d.getValue())||(hi=d.getValue());ci=0;tt==null||r(tt.getValue())||(ci=tt.getValue());li=0;ot==null||r(ot.getValue())||(li=ot.getValue());ai=0;rt==null||r(rt.getValue())||(ai=rt.getValue());vi=0;ut==null||r(ut.getValue())||(vi=ut.getValue());yi=0;et==null||r(et.getValue())||(yi=et.getValue());pi=0;ft==null||r(ft.getValue())||(pi=ft.getValue());wi=0;it==null||r(it.getValue())||(wi=it.getValue());bi=0;st==null||r(st.getValue())||(bi=st.getValue());ki=0;ht==null||r(ht.getValue())||(ki=ht.getValue());di=0;ct==null||r(ct.getValue())||(di=ct.getValue());pt=0;h==null||r(h.getValue())||(pt=h.getValue());wt=0;c==null||r(c.getValue())||(wt=c.getValue());bt=0;l==null||r(l.getValue())||(bt=l.getValue());kt=0;a==null||r(a.getValue())||(kt=a.getValue());gt=0;v==null||r(v.getValue())||(gt=v.getValue());ni=0;y==null||r(y.getValue())||(ni=y.getValue());ti=0;p==null||r(p.getValue())||(ti=p.getValue());ii=0;w==null||r(w.getValue())||(ii=w.getValue());ri=0;b==null||r(b.getValue())||(ri=b.getValue());kr=lt.getValue();dr=g.getValue();sr&&gi!=null&&(pt=gi);hr&&nr!=null&&(wt=nr);cr&&tr!=null&&(bt=tr);lr&&ir!=null&&(kt=ir);ar&&rr!=null&&(gt=rr);vr&&ur!=null&&(ni=ur);yr&&fr!=null&&(ti=fr);pr&&er!=null&&(ii=er);wr&&or!=null&&(ri=or);t.ajax({url:n.Application.contextUrl+"AccountForm/Save",dataType:"json",data:{AD_Client_ID:n.Env.getCtx().getAD_Client_ID(),AD_Org_ID:kr,C_AcctSchema_ID:at,AD_Account_ID:dr,C_SubAcct_ID:si,M_Product_ID:hi,C_BPartner_ID:ci,AD_OrgTrx_ID:li,C_LocFrom_ID:ai,C_LocTo_ID:vi,C_SRegion_ID:yi,C_Project_ID:pi,C_Campaign_ID:wi,C_Activity_ID:bi,User1_ID:ki,User2_ID:di,UserElement1_ID:pt,UserElement2_ID:wt,UserElement3_ID:bt,UserElement4_ID:kt,UserElement5_ID:gt,UserElement6_ID:ni,UserElement7_ID:ti,UserElement8_ID:ii,UserElement9_ID:ri,Alias:e},success:function(n){returnValue=n.result;ei(returnValue.C_ValidCombination_ID,returnValue.C_AcctSchema_ID)}})}function ei(t,i){var r=null,u;try{u=[];u[0]=new n.DB.SqlParam("@C_ValidCombination_ID",t);u[0]=new n.DB.SqlParam("@C_AcctSchema_ID",i);r=uf("VIS_124",u);r.read()&&(k!=null&&k.setValue(r.getString("Alias")),bt!=null&&bt.setValue(r.getString("Combination")),lt!=null&&lt.setValue(r.getInt("AD_Org_ID")),g!=null&&g.setValue(r.getInt("Account_ID")),nt!=null&&nt.setValue(r.getInt("C_SubAcct_ID")),d!=null&&r.getInt("M_Product_ID")!=0&&d.setValue(r.getInt("M_Product_ID")),tt!=null&&r.getInt("C_BPartner_ID")!=0&&tt.setValue(r.getInt("C_BPartner_ID")),it!=null&&it.setValue(r.getInt("C_Campaign_ID")),rt!=null&&rt.setValue(r.getInt("C_LocFrom_ID")),ut!=null&&ut.setValue(r.getInt("C_LocTo_ID")),ft!=null&&ft.setValue(r.getInt("C_Project_ID")),et!=null&&et.setValue(r.getInt("C_SalesRegion_ID")),ot!=null&&ot.setValue(r.getInt("AD_OrgTrx_ID")),st!=null&&st.setValue(r.getInt("C_Activity_ID")),ht!=null&&ht.setValue(r.getInt("User1_ID")),ct!=null&&ct.setValue(r.getInt("User2_ID")),h!=null&&r.getInt("UserElement1_ID")!=0&&h.setValue(r.getInt("UserElement1_ID")),c!=null&&r.getInt("UserElement2_ID")!=0&&c.setValue(r.getInt("UserElement2_ID")),l!=null&&r.getInt("UserElement3_ID")!=0&&l.setValue(r.getInt("UserElement3_ID")),a!=null&&r.getInt("UserElement4_ID")!=0&&a.setValue(r.getInt("UserElement4_ID")),v!=null&&r.getInt("UserElement5_ID")!=0&&v.setValue(r.getInt("UserElement5_ID")),y!=null&&r.getInt("UserElement6_ID")!=0&&y.setValue(r.getInt("UserElement6_ID")),p!=null&&r.getInt("UserElement7_ID")!=0&&p.setValue(r.getInt("UserElement7_ID")),w!=null&&r.getInt("UserElement8_ID")!=0&&w.setValue(r.getInt("UserElement8_ID")),b!=null&&r.getInt("UserElement9_ID")!=0&&b.setValue(r.getInt("UserElement9_ID")),wt!=null&&wt.text(r.getString("Description")));r.close();r=null}catch(f){r!=null&&(r.close(),r=null)}ti(!1)}gt=i.find("#btnOk_"+o);ni=i.find("#btnCancel_"+o);ri=i.find("#btnRefresh_"+o);ui=i.find("#btnUndo_"+o);fi=i.find("#btnSave_"+o);lu=i.find("#lblParameter_"+o);bi=i.find("#parameterDiv_"+o);ku=i.find("#bottumDiv_"+o);du=i.find("#discriptionDiv_"+o);ki=i.find("#accDiv_"+o);gu=i.find("#acctbl_"+o);vu=i.find("#lblbottumMsg_"+o);yu=i.find("#lblCount_"+o);wt=i.find("#lblbottumMsg2_"+o);n.Application.isRTL&&(gt.css("margin-right","-128px"),ni.css("margin-right","55px"));gt.val(n.Msg.getMsg("OK"));ni.val(n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Cancel")));lu.val(n.Msg.getMsg("Parameter"));br();gt.on("click",function(){s.setBusy(!0);wu();s.setBusy(!1)});ni.on("click",function(){i.dialog("close")});ri.on("click",function(){s.setBusy(!0);ti(!0);s.setBusy(!1)});ui.on("click",function(){bu()});fi.on("click",function(){s.setBusy(!0);nf();s.setBusy(!1)})};this.showDialog=function(){var n=t(window).width()-50,i=t(window).height()-60;ei.height(i);ei.width(n);ti.append(ei);ti.dialog({modal:!1,resizable:!1,title:pu,width:n,height:i,position:{at:"center top",of:window},close:function(){s.dispose();ti.dialog("destroy");ti=null;s=null}})};this.dataStatusChanged=function(n){var t=e.getValue("Description");wu=e.getValue("COMBINATION");t!=null&&t.length>0?wt.css("display","inline-block"):wt.css("display","none");wt.text(t);yu.text(n.totalRecords)};this.disposeComponent=function(){gt&&gt.off("click");ni&&ni.off("click");ri&&ri.off("click");ui&&ui.off("click");fi&&fi.off("click");pu=null;oi=null;at=null;o=null;wu=null;di=null;k=null;bt=null;lt=null;g=null;nt=null;d=null;tt=null;it=null;rt=null;ut=null;ft=null;et=null;ot=null;st=null;ht=null;ct=null;this.log=null;sf=null;kr=null;dr=null;gr=null;nu=null;tu=null;iu=null;ru=null;uu=null;fu=null;eu=null;ou=null;su=null;hu=null;cu=null;si=null;hi=null;ci=null;li=null;ai=null;vi=null;yi=null;pi=null;wi=null;yt=null;kt=null;gt=null;ni=null;ri=null;ui=null;fi=null;lu=null;bi=null;ku=null;du=null;ki=null;gu=null;pt=null;hf=!1;au=null;ii=null;e=null;vu=null;yu=null;wt=null;dt=null}}i.prototype.dispose=function(){this.disposeComponent()};n.AccountForm=i}(VIS,jQuery),function(n,t){function i(){function gi(){var a,k;e=t("<input id='chkReportQ_"+i.windowNo+"' type='checkbox' style='margin-left: 0px;' class='VIS_Pref_automatic'><span><label id='lblReportQ_"+i.windowNo+"' class='VIS_Pref_Label_Font'>SelectDoc<\/label><\/span>");wt=new n.Controls.VLabel;v=new n.Controls.VLabel;bt=new n.Controls.VLabel;kt=new n.Controls.VLabel;dt=new n.Controls.VLabel;gt=new n.Controls.VLabel;ni=new n.Controls.VLabel;ti=new n.Controls.VLabel;a=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,0,n.DisplayType.Search,"C_BPartner_ID",0,!1,null);it=new n.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,n.DisplayType.Search,a);y=new n.Controls.VComboBox("",!1,!1,!0);o=new n.Controls.VComboBox("",!1,!1,!0);rt=new n.Controls.VTextBox("NameQ",!1,!1,!0,50,50,"NameQ");ut=new n.Controls.VTextBox("DescriptionQ",!1,!1,!0,50,50,"DescriptionQ");ft=new n.Controls.VTextBox("CommentQ",!1,!1,!0,50,50,"CommentQ");rt.getControl().val("%%");ut.getControl().val("%%");ft.getControl().val("%%");p=new n.Controls.VComboBox("",!1,!1,!0);ii=t("<input id='dtpCreatedFromQ_"+i.windowNo+"' type='date'  style='display: inline-block;line-height: 23px;width:100%'>");ri=t("<input id='dtpCreatedToQ_"+i.windowNo+"' type='date' style='display: inline-block;line-height: 23px;width:100%'>");ui=new n.Controls.VLabel;fi=new n.Controls.VLabel;ei=new n.Controls.VLabel;oi=new n.Controls.VLabel;si=new n.Controls.VLabel;et=new n.Controls.VTextBox("CreatedBy",!1,!0,!0,50,50,"CreatedBy");d=new n.Controls.VTextBox("Name",!1,!1,!0,50,50,"Name");g=new n.Controls.VTextBox("Description",!1,!1,!0,50,50,"Description");nt=new n.Controls.VTextArea("Comment",!1,!1,!0,200,200);ot=t("<input id='dtpCreatedOn_"+i.windowNo+"' readonly class='vis-gc-vpanel-table-readOnly' type='date' style='display: inline-block;height: 30px;width:100%'>");st=new n.Controls.VLabel;h=t("<input id='btnOk_"+i.windowNo+"' class='VIS_Pref_btn-2' style=' margin-top: 0px; margin-right: 0px;' type='button' value='Ok'>");w=t("<input id='btnSave_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-bottom: 0px; margin-top: 0px; margin-right: 10px; margin-left: 10px;float: right;' type='button' value='Save'>");ht=t("<input id='btnNext_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin: 10px; display: none;'  type='button' value='>>'>");ct=t("<input id='btnPre_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin: 10px; display: none;' type='button' value='<<'>");w.val(n.Msg.getMsg("Save"));h.val(n.Msg.getMsg("OK"));k=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";s=t("<div class='vis-archive-left-sidebar' id='topLeftDiv_"+i.windowNo+"' style='float: left; height: 100%; margin-bottom: 2px;margin-left: 0px;position: absolute;'><div id='topToggalDiv_"+i.windowNo+"' style='width: 100%; height: 45px;float: left;padding-left: 11px; padding-top: 11px; background-color: #F1F1F1;'><button id='btnToggal_"+i.windowNo+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+k+"' /><\/button><\/div><\/div>");this.btnToggal=s.find("#btnToggal_"+i.windowNo);u=t("<div style='float: left; width: 100%;height: 74%;' id='topleftparaDiv_"+i.windowNo+"'>");u.css("height",ki);hi=t("<div style='height: 100%; margin-top: 1px;background-color: #F1F1F1;' id='topleftInnerParaDiv_"+i.windowNo+"'>");u.append(hi);s.append(u);s.css("width",vt);var l=t("<table>"),f=t("<tr>"),r=t("<td style='padding: 4px 12px 2px;'>");hi.append(l);l.append(f);f.append(r);r.append(e);f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(v.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font")).append(wt.getControl().addClass("VIS-Search-hide").css("display","inline-block").addClass("VIS_Pref_Label_Font"));v.getControl().hide();f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(o.getControl().css("display","inline-block").css("width","236px").css("height","30px")).append(it.getControl().addClass("VIS-Search-hide").css("width","206px")).append(it.getBtn(0).addClass("VIS-Search-hide").css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"));o.getControl().hide();f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(bt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(y.getControl().css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(kt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(rt.getControl().css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(dt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(ut.getControl().css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(gt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(ft.getControl().css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(ni.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(p.getControl().css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(ti.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td style='padding: 0px 12px 0px;'>");l.append(f);f.append(r);r.append(ii.css("display","inline-block").css("width","236px").css("height","30px"));f=t("<tr>");r=t("<td style='padding: 4px 12px 2px;'>");l.append(f);f.append(r);r.append(ri.css("display","inline-block").css("width","236px").css("height","30px"));ci=t("<div style='float: left; width: 100%;height:45px;position: relative;background-color: #F1F1F1; padding-left: 13px;padding-right: 13px;' id='leftBottomDiv_"+i.windowNo+"'>");s.append(ci);ci.append(h);c=t("<div id='topRightDiv_"+i.windowNo+"' style='float: right;height: 100%; margin-left: 0px;'>");c.css("width",yi);n.Application.isRTL&&(c.css("float","left"),w.css("float","left"),e.css("margin-left","5px"));lt=t("<div id='rightTopDiv_"+i.windowNo+"' style='float: left; width: 98.5%; height: 55%; margin-right: 10px; margin-left: 5px; margin-top: 5px;'>");at=t("<div id='rightBottomDiv_"+i.windowNo+"' style='float: left; width: 99.5%; margin-right: 0px; margin-left: 0px; margin-top: 5px; '>");lt.css("height",pi);at.css("height",di);l=t("<table style='width: 100%; '>");f=t("<tr>");r=t("<td colspan='4' style='text-align: right; height: 10px;'>");at.append(l);l.append(f);f.append(r);r.append(ct).append(st.getControl().css("display","inline-block").css("margin-top","20px").css("margin-right","10px").css("margin-left","10px").addClass("VIS_Pref_Label_Font")).append(ht);st.getControl().css("display","none");f=t("<tr>");r=t("<td colspan='2' class='VIS-archive-table-padding' >");l.append(f);f.append(r);r.append(ui.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<td colspan='2' class='VIS-archive-table-padding'>");f.append(r);r.append(fi.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td colspan='2' class='VIS-archive-table-padding'>");l.append(f);f.append(r);r.append(et.getControl().css("display","inline-block").css("width","100%").addClass("VIS_Pref_Label_Font"));r=t("<td colspan='2' class='VIS-archive-table-padding'>");f.append(r);r.append(ot.css("display","inline-block").css("width","100%").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td colspan='2' class='VIS-archive-table-padding' >");l.append(f);f.append(r);r.append(ei.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<td colspan='2' class='VIS-archive-table-padding'>");f.append(r);r.append(oi.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td colspan='2' class='VIS-archive-table-padding'>");l.append(f);f.append(r);r.append(d.getControl().css("display","inline-block").css("width","100%").addClass("VIS_Pref_Label_Font"));r=t("<td colspan='2' class='VIS-archive-table-padding'>");f.append(r);r.append(g.getControl().css("display","inline-block").css("width","100%").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td colspan='2' class='VIS-archive-table-padding'>");l.append(f);f.append(r);r.append(si.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));f=t("<tr>");r=t("<td colspan='4' class='VIS-archive-table-padding'>");l.append(f);f.append(r);r.append(nt.getControl().css("display","inline-block").css("width","100%").css("height","60px").addClass("VIS_Pref_Label_Font"));li=t("<div style='float: left; width: 100%;height: 40px;position: relative;' id='rightBottomSaveDiv_"+i.windowNo+"'>");li.append(w);c.append(lt).append(at).append(li);tt.append(b);tt.append(s).append(c)}function nr(){e.find("label").text(n.Msg.translate(n.Env.getCtx(),"IsReport"));v.getControl().text(n.Msg.translate(n.Env.getCtx(),"AD_Process_ID"));bt.getControl().text(n.Msg.translate(n.Env.getCtx(),"AD_Table_ID"));wt.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));kt.getControl().text(n.Msg.translate(n.Env.getCtx(),"Name"));dt.getControl().text(n.Msg.translate(n.Env.getCtx(),"Description"));gt.getControl().text(n.Msg.translate(n.Env.getCtx(),"Help"));ni.getControl().text(n.Msg.translate(n.Env.getCtx(),"CreatedBy"));ti.getControl().text(n.Msg.translate(n.Env.getCtx(),"Created"));ui.getControl().text(n.Msg.translate(n.Env.getCtx(),"CreatedBy"));fi.getControl().text(n.Msg.translate(n.Env.getCtx(),"Created"));ei.getControl().text(n.Msg.translate(n.Env.getCtx(),"Name"));oi.getControl().text(n.Msg.translate(n.Env.getCtx(),"Description"));si.getControl().text(n.Msg.translate(n.Env.getCtx(),"Help"));st.getControl().text(n.Msg.translate(n.Env.getCtx(),"NoRecordFound"))}function tr(){for(var s=n.context.getAD_Role_ID(),i=!0,r="SELECT DISTINCT p.AD_Process_ID, p.Name FROM AD_Process p INNER JOIN AD_Process_Access pa ON (p.AD_Process_ID=pa.AD_Process_ID) WHERE pa.AD_Role_ID="+s+" AND p.IsReport='Y' AND p.IsActive='Y' AND pa.IsActive='Y' ORDER BY 2",t=n.DB.executeReader(r.toString(),null),u,f;t.read();)u=n.Utility.Util.getValueOfInt(t.getString(0)),f=n.Utility.encodeText(t.getString(1)),i&&(o.getControl().append(" <option><\/option>"),i=!1),o.getControl().append(" <option value="+u+">"+f+"<\/option>");for(t.close(),i=!0,o.getControl().prop("selectedIndex",0),r="SELECT DISTINCT t.AD_Table_ID, t.Name FROM AD_Table t INNER JOIN AD_Tab tab ON (tab.AD_Table_ID=t.AD_Table_ID) INNER JOIN AD_Window_Access wa ON (tab.AD_Window_ID=wa.AD_Window_ID) WHERE wa.AD_Role_ID="+s+" AND t.IsActive='Y' AND tab.IsActive='Y' ORDER BY 2",t=n.DB.executeReader(r.toString(),null);t.read();)u=n.Utility.Util.getValueOfInt(t.getString(0)),f=n.Utility.encodeText(t.getString(1)),i&&(y.getControl().append(" <option><\/option>"),i=!1),y.getControl().append(" <option value="+u+">"+f+"<\/option>");for(t.close(),i=!0,y.getControl().prop("selectedIndex",0),r="SELECT AD_User_ID, Name FROM AD_User u WHERE EXISTS (SELECT * FROM AD_User_Roles ur WHERE u.AD_User_ID=ur.AD_User_ID) ORDER BY 2",r=n.MRole.getDefault().addAccessSQL(r,"AD_User",n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RW),t=n.DB.executeReader(r.toString(),null);t.read();)u=n.Utility.Util.getValueOfInt(t.getString(0)),f=n.Utility.encodeText(t.getString(1)),i&&(p.getControl().append(" <option><\/option>"),i=!1),p.getControl().append(" <option value="+u+">"+f+"<\/option>");t.close();i=!0;p.getControl().prop("selectedIndex",0);l>0&&(e.prop("checked",!0),yt())}function yt(){var t="",v=e.prop("checked"),b=null,u,w,r,s,f,h,c;b=n.MRole.getDefault();try{if(!b.getIsCanReport()){i.log.warning("User/Role cannot Report AD_User_ID="+n.context.getAD_User_ID());return}t=t.concat(" AND IsReport=").concat(v?"'Y'":"'N'");v&&(u=o.getControl().find("option:selected").val(),u!=""&&u!=null&&(t=t.concat(" AND AD_Process_ID=").concat(u)));l>0?(t=t.concat(" AND ((AD_Table_ID=").concat(l),a>0&&(t=t.concat(" AND Record_ID=").concat(a)),t=t.concat(")"),l==X_C_BPartner.Table_ID&&a>0&&(t=t.concat(" OR C_BPartner_ID=").concat(a)),t=t.concat(")"),l=0,a=0):(u=y.getControl().find("option:selected").val(),u!=""&&u!=null&&(t=t.concat(" AND AD_Table_ID=").concat(u)));v||(w=it.getValue(),t=w!=null?t.concat(" AND C_BPartner_ID=").concat(w):t.concat(" AND C_BPartner_ID IS NOT NULL"));r=rt.getControl().val();r!=null&&r!="%%"&&r.length>0&&(t=r.indexOf("%")!=-1||r.indexOf("_")!=-1?t.concat(" AND LOWER(Name) LIKE LOWER( ").concat("'").concat(r).concat("')"):t.concat(" AND LOWER(Name)= LOWER(").concat("'").concat(r).concat("')"));r=ut.getControl().val();r!=null&&r!="%%"&&r.length>0&&(t=r.indexOf("%")!=-1||r.indexOf("_")!=-1?t.concat(" AND LOWER(Description) LIKE LOWER( ").concat("'").concat(r).concat("')"):t.concat(" AND LOWER(Description)= LOWER(").concat("'").concat(r).concat("')"));r=ft.getControl().val();r!=null&&r!="%%"&&r.length>0&&(t=r.indexOf("%")!=-1||r.indexOf("_")!=-1?t.concat(" AND LOWER(Help) LIKE LOWER( ").concat("'").concat(r).concat("')"):t.concat(" AND LOWER(Help)= LOWER(").concat("'").concat(r).concat("')"));s=p.getControl().find("option:selected").val();s!=null&&s>0&&(t=t.concat(" AND CreatedBy=").concat(s));f=ii.val();f!=""&&(t=t.concat(" AND Created>=").concat(n.DB.to_date(f)));f=ri.val();f!=""&&(t=t.concat(" AND Created<").concat(n.DB.to_date(f)));i.log.fine(t.toString());t=t.concat(" AND (AD_Process_ID IS NULL OR AD_Process_ID IN (SELECT AD_Process_ID FROM AD_Process_Access WHERE AD_Role_ID=").concat(n.context.getAD_Role_ID()).concat("))");t=t.concat(" AND (AD_Table_ID IS NULL OR (AD_Table_ID IS NOT NULL AND AD_Process_ID IS NOT NULL) OR AD_Table_ID IN (SELECT t.AD_Table_ID FROM AD_Tab t INNER JOIN AD_Window_Access wa ON (t.AD_Window_ID=wa.AD_Window_ID) WHERE wa.AD_Role_ID=").concat(n.context.getAD_Role_ID()).concat("))");i.log.finest(t.toString())}catch(k){}h=t;c="SELECT AD_ARCHIVE_ID,AD_CLIENT_ID,AD_ORG_ID,AD_PROCESS_ID,AD_TABLE_ID,C_BPARTNER_ID,CREATED,CREATEDBY,DESCRIPTION,HELP, ISACTIVE,ISREPORT,NAME,RECORD_ID,UPDATED,UPDATEDBY,EXPORT_ID FROM AD_Archive WHERE AD_Client_ID="+n.Env.getCtx().getAD_Client_ID();h!=null&&h.length>0&&(c+=h);c+=" ORDER BY Created desc";er(c)}function vi(n,t){return n==null?t==null:t==null?!1:n.equals(t)}function ir(){var u;if(!(r.getSelection().length<0)){var f=d.getControl().val(),e=g.getControl().val(),o=nt.getControl().val(),i=Number(r.getSelection().toString());r.get(i)!=null&&(u=!1,vi(f,r.get(i).NAME)||f!=null&&f.length>0&&(u=!0),vi(e,r.get(i).DESCRIPTION)||(u=!0),vi(o,r.get(i).HELP)||(u=!0),k=r.get(i).AD_ARCHIVE_ID,u&&t.ajax({url:n.Application.contextUrl+"Common/UpdateArchive",dataType:"json",data:{name:f,des:e,help:o,archiveId:k},success:function(n){n.result&&yt()}}))}}function wi(u){r!=null&&(r.destroy(),r=null);f.length==0&&(f.push({field:"NAME",caption:n.Msg.translate(n.Env.getCtx(),"NAME"),sortable:!0,size:"16%",min:150,hidden:!1}),f.push({field:"DESCRIPTION",caption:n.Msg.translate(n.Env.getCtx(),"DESCRIPTION"),sortable:!0,size:"16%",min:150,hidden:!1}),f.push({field:"HELP",caption:n.Msg.getElement(n.Env.getCtx(),"HELP"),sortable:!0,size:"16%",min:150,hidden:!1}),f.push({field:"CREATEDBY",caption:n.Msg.getElement(n.Env.getCtx(),"CREATEDBY"),sortable:!0,size:"16%",min:150,hidden:!1}),f.push({field:"CREATED",caption:n.Msg.getElement(n.Env.getCtx(),"CREATED"),sortable:!0,size:"16%",min:150,hidden:!1,render:"date"}),f.push({field:"View",caption:n.Msg.translate(n.Env.getCtx(),"View"),sortable:!0,size:"80px",min:150,hidden:!1,render:function(){return'<div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/download-ico-hover.png" alt="View record" title="View record" style="opacity: 1;"><\/div>'}}),f.push({field:"AD_ARCHIVE_ID",caption:n.Msg.translate(n.Env.getCtx(),"AD_ARCHIVE_ID"),hidden:!0}));setTimeout(10);w2utils.encodeTags(u);r=t(lt).w2grid({name:"gridArchive"+i.windowNo,recordHeight:40,columns:f,records:u,onClick:function(n){n.column==5&&r.records.length>0&&rr(n.recid);ur(n.recid)}})}function rr(i){k=r.get(i).AD_ARCHIVE_ID;t.ajax({url:n.Application.contextUrl+"Common/DownloadPdf",dataType:"json",data:{archiveId:k},success:function(t){t.result!=null&&(t.result.indexOf("TempDownload")>-1?window.open(n.Application.contextUrl+t.result):window.open("data:application/pdf;base64, "+t.result))}})}function ur(n){d.getControl().val(r.get(n).NAME);g.getControl().val(r.get(n).DESCRIPTION);nt.getControl().val(r.get(n).HELP);et.getControl().val(r.get(n).CREATEDBY);r.get(n).CREATED!=null&&ot.val(r.get(n).CREATED.split("T")[0]);k=r.get(n).AD_ARCHIVE_ID}function fr(t){var r="",u="SELECT Name FROM AD_User WHERE AD_User_ID="+t,i;try{i=n.DB.executeReader(u.toString(),null,null);i.read()&&(r=i.getString("Name"));i.close()}catch(f){}return r}function er(t){var u=[],i,f,r;try{for(i=n.DB.executeReader(t.toString(),null,null),f=1;i.read();)r={},r.NAME=i.getString("NAME"),r.DESCRIPTION=i.getString("DESCRIPTION"),r.HELP=i.getString("HELP"),r.CREATEDBY=fr(i.getString("CREATEDBY")),r.CREATED=i.getString("CREATED"),r.AD_ARCHIVE_ID=i.getInt("AD_ARCHIVE_ID"),r.recid=f,f++,u.push(r);i.close()}catch(e){}return wi(u),u}function or(){d.getControl().val("");g.getControl().val("");nt.getControl().val("");et.getControl().val("");ot.val(null)}function sr(){if(h!=null)h.on(n.Events.onTouchStartOrClick,function(){b[0].style.visibility="visible";yt();or();b[0].style.visibility="hidden"});if(w!=null)w.on(n.Events.onTouchStartOrClick,function(){b[0].style.visibility="visible";ir();b[0].style.visibility="hidden"});if(ht!=null)ht.on(n.Events.onTouchStartOrClick,function(){alert("btnNext")});if(ct!=null)ct.on(n.Events.onTouchStartOrClick,function(){alert("btnPre")});if(this.btnToggal!=null)this.btnToggal.on(n.Events.onTouchStartOrClick,function(){pt?(btnToggal.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),pt=!1,s.animate({width:vt},"slow"),u.animate({width:vt},"slow"),u.find("table").css("display","block"),u.css("background-color","transparent"),h.css("display","block"),c.animate({width:yi},"slow",null,function(){r.resize()})):(btnToggal.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),pt=!0,s.animate({width:ai},"slow"),u.animate({width:ai},"slow"),u.find("table").css("display","none"),u.css("background-color","#F1F1F1"),h.css("display","none"),c.animate({width:bi},"slow",null,function(){r.resize()}))});e.change(function(){o.getControl().hide();v.getControl().hide();t(".VIS-Search-hide").show();e.prop("checked")&&(o.getControl().show(),v.getControl().show(),t(".VIS-Search-hide").hide())})}this.log=n.Logging.VLogger.getVLogger("VIS.ArchiveViewer");this.frame;this.windowNo;var l=0,a=0,i=this,pt=!1,tt=t("<div class='vis-forms-container' style='width: 100%; height: 100%; background-color: white;'>"),b=t("<div class='vis-apanel-busy'>"),f=[],r=null,k=0,e=null,wt=null,v=null,bt=null,kt=null,dt=null,gt=null,ni=null,ti=null,it=null,y=null,rt=null,ut=null,ft=null,p=null,o=null,ii=null,ri=null,ui=null,fi=null,ei=null,oi=null,si=null,d=null,g=null,nt=null,et=null,ot=null,st=null,h=null,w=null,ht=null,ct=null;this.btnToggal=null;var s=null,c=null,u=null,hi=null,ci=null,lt=null,at=null,li=null,vt=260,ai=50,yi=t(window).width()-(vt+10),bi=t(window).width()-(10+ai),ki=t(window).height()-193,pi=t(window).height()-366,di=t(window).height()-(pi+40+118);this.display=function(){wi()};this.load=function(){gi();nr();tr();sr()};this.getRoot=function(){return tt};this.disposeComponent=function(){tt=null}}n.Apps=n.Apps||{};n.Apps.AForms=n.Apps.AForms||{};i.prototype.sizeChanged=function(){};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.load();this.frame.getContentGrid().append(this.getRoot());this.display()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.ArchiveViewer=i}(VIS,jQuery),function(n,t){function i(){function c(){r.onClose&&r.onClose();r.dispose();r=null}var i=t("<div><\/div>"),u="Dialog",f="auto",e="auto",o=!0,s=!1,h=!0,r;this.onOkClick=null;this.onCancelClick=null;this.onClose=null;this.setTitle=function(n){u=n};this.setModal=function(n){o=n};this.changeTitle=function(n){i.dialog("widget").find(".ui-dialog-title").text(n)};this.setHeight=function(n){f=n};this.setWidth=function(n){e=n};this.setEnableResize=function(n){h=n};r=this;this.setContent=function(n){i.empty();n.css("margin-left","-6px");n.css("margin-right","-7px");i.append(n)};this.getRoot=function(){return i};this.hidebuttons=function(){i.dialog("widget").find(".ui-dialog-buttonpane .ui-button").hide();i.dialog("widget").find(".ui-widget-content").css("border","0px");i.dialog("widget").find(".ui-dialog-buttonpane").css("padding","0px");i.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top","0px");i.dialog("widget").find(".ui-dialog .ui-dialog-buttonpane").hide()};this.hideButtons=function(){i.dialog("widget").find(".ui-dialog-buttonpane .ui-button").hide();i.dialog("widget").find(".ui-widget-content").css("border","0px");i.dialog("widget").find(".ui-dialog-buttonpane").css("padding","0px");i.dialog("widget").find(".ui-dialog-buttonpane").css("margin-top","0px");i.dialog("widget").find(".ui-dialog .ui-dialog-buttonpane").hide()};this.close=function(){i.dialog("close");this.dispose()};this.show=function(){var l="margin-right:-2px;margin-top:-10px;margin-bottom:3px;margin-right:-4px",a="margin-top:-10px;margin-bottom:3px;margin-right:12px";n.Application.isRTL&&(l="margin-right:7px;margin-top:-5px;margin-bottom:3px",a="margin-top:-5px;margin-bottom:3px;margin-right:-3px");i.dialog({height:f,width:e,title:u,modal:o,resizable:h,closeOnEscape:!s,closeText:n.Msg.getMsg("close"),buttons:[{text:n.Msg.getMsg("Ok"),click:function(n){var f=n.target,u;t(f).attr("disabled",!0);u=!0;r.onOkClick&&(u=r.onOkClick(n));u==!0||u==undefined?i!=null&&i.dialog("close"):t(f).attr("disabled",!1)},style:a},{text:n.Msg.getMsg("Cancel"),click:function(){r.onCancelClick&&r.onCancelClick();i&&i.dialog("close")},style:l}],close:c});t(document).on("keydown",function(n){if(event.altKey&&event.keyCode==37)return n.preventDefault(),!1;n.stopPropagation()});return t(".ui-dialog .ui-dialog-buttonpane").css("border-width","0 0 0"),s&&t(".ui-dialog-titlebar-close").remove(),i};this.dispose=function(){i!=null&&(i.dialog("destroy"),i.remove());i=null;this.Show=null;this.setContent=null;this.setTitle=null}}n.ChildDialog=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e){function a(){}function v(){o.onOkClick=function(i){var r=l.val();if(t.trim(r)==""||r==""||r==null)return n.ADialog.info("EnterData"),i!=undefined&&i.preventDefault(),!1;s.prop.ChatText=r;n.dataContext.saveChat(s.prop)};o.onCancelClick=function(){}}function y(i,r,u){n.dataContext.getChatRecords(u,function(t){var r=JSON.parse(t),s="",u,o,e;for(u in r.subChat){var c=new Date(r.subChat[u].ChatDate),h=c.toLocaleString(),f='   <div style="margin-bottom: 15px; border: 1px solid DarkGray; min-height: 50px; border-radius: 4px;overflow-y:auto;margin-right:5px">';if(f+=n.Application.isRTL?'<div style="overflow: auto;height: 48px;width: 48px;display: inline;float: right;margin: 5px;position:relative;line-height:45px;text-align:center;">':'<div style="overflow: auto;height: 48px;width: 48px;display: inline;float: left;margin: 5px;position:relative;line-height:45px;text-align:center;">',o=!1,r.subChat[u].AD_Image_ID==0)f+="<img  data-uID='"+r.subChat[u].AD_User_ID+"'  style=\"cursor:pointer;height: 48px;width: 48px;\" src= '"+n.Application.contextUrl+"Areas/VIS/Images/Home/userAvatar.png'/>",o=!0;else for(e in r.userimages)if(r.userimages[e].AD_Image_ID==r.subChat[u].AD_Image_ID&&r.userimages[e].UserImg!="NoRecordFound"&&r.userimages[e].UserImg!="FileDoesn'tExist"){f+='<img  data-uID="'+r.subChat[u].AD_User_ID+'"  style="cursor:pointer;vertical-align: middle;" src="'+n.Application.contextUrl+r.userimages[e].UserImg+'" />';o=!0;break}o==!1&&(f+="<img   data-uID='"+r.subChat[u].AD_User_ID+"'  style=\"cursor:pointer;height: 48px;width: 48px;\" src= '"+n.Application.contextUrl+"Areas/VIS/Images/Home/userAvatar.png'/>");f+='<\/div><div style="overflow-y;margin-bottom:5px"><div style="overflow:auto">';f+=n.Application.isRTL?'<span data-uID="'+r.subChat[u].AD_User_ID+'"  style="float: right; color: #3892DA;;font-size: 10pt;margin-top:2px;cursor:pointer ">':'<span data-uID="'+r.subChat[u].AD_User_ID+'"  style="float: left; color: #3892DA;;font-size: 10pt;margin-top:2px;cursor:pointer ">';f+=n.Env.getCtx().getAD_User_ID()==r.subChat[u].AD_User_ID?"Me":r.subChat[u].UserName;f+=n.Application.isRTL?'<\/span><span style="display: block; text-align: right;float:left; margin-left: 5px;margin-top:2px;font-size: 10pt;">'+h+'<\/span><\/div><div  style="overflow:auto">':'<\/span><span style="display: block; text-align: right;float:right; margin-right: 5px;margin-top:2px;font-size: 10pt;">'+h+'<\/span><\/div><div  style="overflow:auto">';f+=n.Application.isRTL?'<span style="width:526px;font-size: 10pt;margin-right:5px">'+n.Utility.encodeText(r.subChat[u].ChatData)+"<\/span><\/div>":'<span style="width:526px;font-size: 10pt;">'+n.Utility.encodeText(r.subChat[u].ChatData)+"<\/span><\/div>";f+="<\/div>";f+="            <\/div>  ";s+=f}i.html(s)});i.on("click",function(i){var u,f;(t(i.target).is("span")||t(i.target).is("img"))&&(u=t(i.target).data("uid"),u!=undefined&&u!=null&&u>0&&(f=new n.ContactInfo(u,r),f.show(),o.close()))})}var o,s;this.onClose=null;var h=t('<div class="vis-forms-container"><\/div>'),c=t('<div style="overflow-y:auto;height:216px;margin-right:-2px;margin-bottom:15px"><\/div>'),l=t('<textarea  id="input-chat-new" style="Height:70px;width:624px;text-wrap:normal;margin-top:0px;font-size: 10pt;resize: none;margin-bottom:-10px;margin-right:3px"  maxlength="500" />');h.append(c).append(l);this.winNo=e;o=null;this.prop={WindowNo:e,ChatID:r,AD_Table_ID:u,Record_ID:i,Description:f,TrxName:null,ChatText:"",page:0,pageSize:10};y(c,e,this.prop);s=this;a();this.show=function(){o=new n.ChildDialog;o.setContent(h);o.setHeight(428);o.setWidth(655);o.setTitle(n.Msg.getMsg("Chat"));o.setModal(!0);o.onClose=function(){s.onClose&&s.onClose();s.dispose()};o.show();v()};this.dispose=function(){this.prop=null;c=null;h.remove();h=null;o=null;s=null}}n.Chat=i}(VIS,jQuery),function(n,t){function u(){t.ajax({url:n.Application.contextUrl+"InfoMenu/LoadMenu",dataType:"json",error:function(){alert("No DATA")},success:function(n){var r=n.result,u,f;for(u in r)f=t("<li data-id='"+r[u].AD_InfoWindow_ID+"' >"),f.append(r[u].Name),i.append(f)}})}var r=t("<div/>"),i;r.css("width","100%");r.css("height","100%");i=t("<ul class='vis-apanel-rb-ul'>");i.css("width","100%");i.css("height","100%");r.append(i);i.on("click","LI",function(i){var r=t(i.target).data("id"),u=new n.InfoWindow(r,null,0,null,null);u.show()});u();n.InfoMenu={show:function(n){n.w2overlay(r.clone(!0),{css:{height:"300px"}})}}}(VIS,jQuery),function(n,t){function i(i,r,u,f,e){function ti(){var f,i,r,u;y.css("width","100%");y.css("height","100%");y.css("position","relative");p.css("width","98%");p.css("height","97%");p.css("position","absolute");p.css("overflow","auto");n.Application.isRTL?(et=t("<div style='background-color: rgb(241, 241, 241);padding-left: 7px;height:88.9%;display: inline-block;width:23%;height:87.8%;overflow:auto;margin-left:10px;padding-right: 10px;'>"),it=t("<div style='background-color: rgb(241, 241, 241);display: inline-block;height:87.8%;'>"),et.append(it),ot=t("<div style='display: inline-block;width:75%;height:87.8%;overflow:auto;'>"),rt=t("<div style='display: inline-block;width:99%;height:auto;margin-top: 2px;'>")):(et=t("<div style='background-color: rgb(241, 241, 241);padding-left: 7px;height:88.9%;display: inline-block; float: left;width:23%;height:87.8%;overflow:auto;'>"),it=t("<div style='background-color: rgb(241, 241, 241);'>"),et.append(it),ot=t("<div style='display: inline-block; float: left;width:75%;height:87.8%;margin-left:10px;'>"),rt=t("<div style='display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;'>"));p.append(et);p.append(ot);p.append(rt);f=n.Msg.getMsg("Refresh");f.indexOf("&")>-1&&(f=f.replace("&",""));i=n.Msg.getMsg("Cancel");i.indexOf("&")>-1&&(i=i.replace("&",""));r=n.Msg.getMsg("Ok");r.indexOf("&")>-1&&(r=r.replace("&",""));st=t("<div style='float:right;'>");n.Application.isRTL?(ut=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(i),ft=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(r)):(ut=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(i),ft=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(r));u=t("<div style='float:left;'>");ht=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png'>"));lt=t("<div>");oi();lt.append(at);n.Application.isRTL?(u.append(ut),u.append(ft),st.append(ht)):(st.append(ut),st.append(ft),u.append(ht));rt.append(st);rt.append(lt);rt.append(u);h=t("<div class='vis-apanel-busy'>");h.css("width","98%");h.css("height","97%");h.css("text-align","center");h.css("position","absolute");y.append(p);y.append(h)}function ii(){ft.on("click",function(){bt()});ht.on("click",function(){h[0].style.visibility="visible";f!=null&&f!=undefined&&f.length>0&&(f=n.Env.parseContext(n.Env.getCtx(),u,f,!1,!1));tt(!0,a.val())});ut.on("click",function(){nt.onClose!=null&&nt.onClose();ct()});if(!n.Application.isMobile)y.on("keyup",function(t){t.keyCode===13&&(h[0].style.visibility="visible",f!=null&&f!=undefined&&f.length>0&&(f=n.Env.parseContext(n.Env.getCtx(),u,f,!1,!1)),tt(!0,a.val()))})}function ri(){nt.onClose!=null&&nt.onClose();ct()}function ei(n){var i,t;if(e)if(n.index)t=w2ui[n.target].records[n.index][keyCol],l.indexOf(t)>-1&&l.splice(l.indexOf(t),1);else for(i=0;i<w2ui[n.target].records.length;i++)t=w2ui[n.target].records[i][keyCol],l.indexOf(t)>-1&&l.splice(l.indexOf(t),1)}function oi(){at=t('<ul style="float:right;margin-top:10px" class="vis-statusbar-ul">');w=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageFirst16.png" alt="First Page" title="'+n.Msg.getMsg("FirstPage")+'" style="opacity: 0.6;"><\/div><\/li>');b=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageUp16.png" alt="Page Up" title="'+n.Msg.getMsg("PageUp")+'" style="opacity: 0.6;"><\/div><\/li>');a=t("<select>");yt=t("<li>").append(a);k=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageDown16.png" alt="Page Down" "'+n.Msg.getMsg("PageDown")+'" style="opacity: 0.6;"><\/div><\/li>');d=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageLast16.png" alt="Last Page" title="'+n.Msg.getMsg("LastPage")+'" style="opacity: 0.6;"><\/div><\/li>');at.append(w).append(b).append(yt).append(k).append(d);si()}function si(){w.on("click",function(){t(this).css("opacity")=="1"&&tt(!0,1)});b.on("click",function(){t(this).css("opacity")=="1"&&tt(!0,parseInt(a.val())-1)});k.on("click",function(){t(this).css("opacity")=="1"&&tt(!0,parseInt(a.val())+1)});d.on("click",function(){t(this).css("opacity")=="1"&&tt(!0,parseInt(a.find("Option:last").val()))});a.on("change",function(){tt(!0,a.val())})}function hi(n){if(a.empty(),n.TotalPage>0){for(var i=0;i<n.TotalPage;i++)a.append(t("<option value="+(i+1)+">"+(i+1)+"<\/option>"));a.val(n.CurrentPage);n.TotalPage>n.CurrentPage?(k.css("opacity","1"),d.css("opacity","1")):(k.css("opacity","0.6"),d.css("opacity","0.6"));n.CurrentPage>1?(w.css("opacity","1"),b.css("opacity","1")):(w.css("opacity","0.6"),b.css("opacity","0.6"));n.TotalPage==1&&(w.css("opacity","0.6"),b.css("opacity","0.6"),k.css("opacity","0.6"),d.css("opacity","0.6"))}else w.css("opacity","0.6"),b.css("opacity","0.6"),k.css("opacity","0.6"),d.css("opacity","0.6")}var wt,bt,ct;this.onClose=null;var y=t("<div>"),p=t("<div>"),kt=!0,dt,gt,ni,et,it,ot,rt,h,st,ut,ft,ht,g=null,c=null,o=null,vt=!1,s=[];this.keyCol="";this.windowNo=u;var nt=this,l=[],v=null,lt,at,w,b,yt,k,d,a;ti();ii();this.show=function(){var r=nt;t.ajax({url:n.Application.contextUrl+"InfoWindow/GetSearchColumn/?Ad_InfoWindow_ID="+i,dataType:"json",error:function(){alert(n.Msg.getMsg("ERRORGettingSchema"));h[0].style.visibility="hidden"},success:function(t){if(t.result==null||t.result.Schema==null){alert(n.Msg.getMsg("ERRORGettingSchema"));return}if(c=t.result,o=c.Schema,o==null){alert(n.Msg.getMsg("ERRORGettingSchema"));return}ui(r)}})};var ui=function(i){var at=null,f=null,d=t("<table>"),l,ht,ct,v,b,rt,nt,ut,w,h,e,ft,et,ot;d.css("width","100%");var p=null,vt=0,k=!1,yt=null,wt=null,st=null;for(l in o)if(o[l].IsQueryCriteria){if(k=!1,p=t("<tr>"),d.append(p),ht=t("<td class='vis-gc-vpanel-table-td1'>"),o[l].AD_Reference_ID==n.DisplayType.YesNo||o[l].AD_Reference_ID==n.DisplayType.Button||o[l].AD_Reference_ID==n.DisplayType.Label?k=!0:(at=new n.Controls.VLabel(o[l].Name,o[l].ColumnName),ct=at.getControl().css("margin-bottom","0px").css("margin-top","5px"),ct.css("font-weight","inherit"),ht.append(ct)),p.append(ht),p=t("<tr>"),d.append(p),v={},yt=o[l].AD_Reference_ID,f=pt(o[l].AD_Reference_ID,o[l].ColumnName,o[l].Name,o[l].AD_Reference_Value_ID,o[l].lookup),v.Ctrl=f,o[l].SetValue!=null){if(b=!1,o[l].Condition!=null){for(var g=[],lt=[],bt=new n.StringTokenizer(o[l].Condition,"[]");bt.hasMoreTokens();)rt=bt.nextToken(),rt.trim()!=" & ".trim()?(b=n.Evaluator.evaluateLogic(i,rt),g.push(b)):lt.push(rt);g.length>1?lt[0].trim().equals("&")?b=g.indexOf(!1)>-1?!1:!0:lt[0].trim().equals("|")&&g.indexOf(!0)>-1&&(b=!0):g.length==1&&g[0]==!0&&(b=!0)}else b=!0;b&&(yt==n.DisplayType.YesNo?o[l].SetValue.toUpperCase()=="Y"?f.getControl().find("input").prop("checked",!0):o[l].SetValue.toUpperCase()=="N"&&f.getControl().find("input").prop("checked",!1):o[l].SetValue.contains("@")?(wt=o[l].SetValue.substring(1,o[l].SetValue.lastIndexOf("@")),st=n.context.getWindowContext(u,wt,!1),st.equals("")?f.setValue(null):f.setValue(st)):f.setValue(o[l].SetValue))}v.AD_Reference_ID=o[l].AD_Reference_ID;v.ColumnName=o[l].SelectClause;v.SearchColumnName=v.ColumnName.toUpperCase().indexOf(" AS ")>-1?v.ColumnName.substring(0,v.ColumnName.toUpperCase().indexOf(" AS ")):v.ColumnName;o[l].ISIDENTIFIER&&r!=null&&f.setValue(r);nt=t("<td>");p.append(nt);w=f.getBtnCount();w==2?(h=t("<div>"),k&&h.css("margin-top","5px"),n.Application.isRTL?(h.css("width","97%"),e=f.getBtn(1),e!=null&&h.append(e.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px").css("float","left")),e=f.getBtn(0),e!=null&&h.append(e.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px").css("float","left")),h.append(f.getControl().css("width","72%").css("float","left").css("height","30px")),w=-1,f=null):(h.css("width","97%"),h.append(f.getControl().css("width","72%").css("float","left").css("height","30px")),e=f.getBtn(0),e!=null&&h.append(e.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px")),e=f.getBtn(1),e!=null&&h.append(e.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px")),w=-1,f=null),nt.append(h)):w==1?(h=t("<div>"),k&&h.css("margin-top","5px"),n.Application.isRTL?(h.css("width","97%"),e=f.getBtn(0),e!=null&&h.append(e.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px").css("float","left")),h.append(f.getControl().css("width","86%").css("float","left").css("height","30px")),w=-1,f=null):(h.css("width","97%"),h.append(f.getControl().css("width","86%").css("float","left").css("height","30px")),e=f.getBtn(0),e!=null&&h.append(e.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px")),w=-1,f=null),nt.append(h)):(k&&f.getControl().css("margin-top","5px"),o[l].AD_Reference_ID==n.DisplayType.YesNo&&f.getControl().css("margin-top","12px").css("height","17px"),nt.append(f.getControl().css("width","97%").css("font-weight","inherit").css("height","30px")));o[l].IsRange?(v.IsRange=!0,p=t("<tr>"),d.append(p),p.append(new n.Controls.VLabel(n.Msg.getMsg("To"),o[l].ColumnName).getControl().css("margin-bottom","0px").css("margin-top","5px").css("font-weight","inherit")),p=t("<tr>"),d.append(p),f=pt(o[l].AD_Reference_ID,o[l].ColumnName,o[l].Name),v.CtrlTo=f,ut=t("<td>"),w=f.getBtnCount(),w==2?(h=t("<div>"),h.css("width","97%"),k&&f.getControl().css("margin-top","5px"),n.Application.isRTL?(h.css("width","97%"),e=f.getBtn(1),e!=null&&h.append(e.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px").css("float","left")),e=f.getBtn(0),e!=null&&h.append(e.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px").css("float","left")),h.append(f.getControl().css("width","72%").css("float","left").css("height","30px")),w=-1,f=null):(h.css("width","97%"),h.append(f.getControl().css("width","72%").css("float","left").css("height","30px")),e=f.getBtn(0),e!=null&&h.append(e.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px")),e=f.getBtn(1),e!=null&&h.append(e.css("class","vis-controls-txtbtn-table-td2").css("width","14%").css("padding","0px").css("border-color","#BBBBBB").css("height","30px")),w=-1,f=null),ut.append(h)):(k&&f.getControl().css("margin-top","5px"),o[l].AD_Reference_ID==n.DisplayType.YesNo?f.getControl().css("margin-top","12px").css("height","17px"):f.getControl().css("height","30px"),ut.append(f.getControl().css("width","97%").css("font-weight","inherit"))),p.append(ut)):v.IsRange=!1;vt=vt+1;s.push(v)}it.append(d);ft=n.Msg.getMsg("Refresh");ft.indexOf("&")>-1&&(ft=ft.replace("&",""));et=n.Msg.getMsg("Cancel");et.indexOf("&")>-1&&(et=et.replace("&",""));ot=n.Msg.getMsg("Ok");ot.indexOf("&")>-1&&(ot=ot.replace("&",""));y.dialog({width:1020,height:487,resizable:!1,title:c.WindowName,modal:!0,closeText:n.Msg.getMsg("close"),close:ri});tt(!1,a.val())},pt=function(t,i,r,f,e){var o=null,y,c,p,l,e,w,a,b,k,d,g,nt,tt,s,v,it,rt,h;return t==n.DisplayType.Button?(y=new n.Controls.VButton(i,!1,!1,!0,r,null,null,0),o=y):t==n.DisplayType.String?(c=new n.Controls.VTextBox(i,!1,!1,!0,50,100,null,null,!1),o=c,c.click=function(){vt=!0}):t==n.DisplayType.YesNo?(p=new n.Controls.VCheckBox(i,!1,!1,!0,r,null),o=p):n.DisplayType.IsDate(t)?(t==n.DisplayType.DateTime&&(readOnly=!0),l=new n.Controls.VDate(i,!1,!1,!0,t,r),l.setName(i),o=l):n.DisplayType.IsLookup(t)||n.DisplayType.ID==t?(e=n.MLookupFactory.get(n.Env.getCtx(),u,0,t,i,f,!1,null),t!=n.DisplayType.Search&&t!=n.DisplayType.MultiKey?(w=new n.Controls.VComboBox(i,!1,!1,!0,e,50),o=w):(t=n.DisplayType.Search,a=new n.Controls.VTextBoxButton(i,!1,!1,!0,t,e),a.getBtn(),o=a)):t==n.DisplayType.Location?(b=new n.Controls.VLocation(i,!1,!1,!0,t,null),o=b):t==n.DisplayType.Locator?(k=new n.Controls.VLocator(i,!1,!1,!0,t,e),o=k):n.DisplayType.Text==t||n.DisplayType.TextLong==t?(d=new n.Controls.VTextArea(i,!1,!1,!0,50,100,t),o=d):n.DisplayType.IsNumeric(t)?n.DisplayType.Amount==t?(g=new n.Controls.VAmountTextBox(i,!1,!1,!0,50,100,t,r),o=g):n.DisplayType.Integer==t?(nt=new n.Controls.VNumTextBox(i,!1,!1,!0,50,100,r),o=nt):n.DisplayType.Number==t&&(tt=new n.Controls.VAmountTextBox(i,!1,!1,!0,50,100,t,r),o=tt):t==n.DisplayType.PAttribute?(s=new n.Controls.VPAttribute(i,!1,!1,!0,t,e,u,!1,!1,!1,!0),s.getBtn(0),o=s):t==n.DisplayType.GAttribute?(s=new n.Controls.VPAttribute(i,!1,!1,!0,t,e,u,!1,!1,!1,!1),s.getBtn(0),o=s):t==n.DisplayType.Account?(v=new n.Controls.VAccount(i,!1,!1,!0,t,e,u,r),v.getBtn(0),o=v):t==n.DisplayType.Binary?(it=new n.Controls.VBinary(i,!1,!1,!0,u),o=it):t==n.DisplayType.Image?(rt=new n.Controls.VImage(i,!1,!1,u),o=rt):t==n.DisplayType.URL?(h=new n.Controls.VURL(i,!1,!1,!0,50,100),o=h):(t==n.DisplayType.FileName||t==n.DisplayType.FilePath)&&(h=new n.Controls.VFile(i,!1,!1,!0,u,t),o=h),o},tt=function(i,r){var nt,d,it,ut,u,b,g;if(e&&w2ui[v]){nt=w2ui[v].getSelection();for(d in nt)l.indexOf(w2ui[v].get(nt[d])[keyCol])==-1&&l.push(w2ui[v].get(nt[d])[keyCol])}wt();var p="SELECT ",k=null,tt=null,rt=0,et=t.makeArray(o).length;for(d in o){if(k=o[d].SelectClause,tt=String(k).indexOf(".")>-1?String(k).substring(String(k).lastIndexOf(".")+1,String(k).length):k,o[d].IsKey&&(keyCol=tt.toUpperCase()),rt=o[d].AD_Reference_ID,rt==n.DisplayType.YesNo)p+=" ( CASE "+k+" WHEN 'Y' THEN  'True' ELSE 'False'  END ) AS "+tt;else if(rt==n.DisplayType.List){it=o[d].RefList;p+=" CASE ";for(ut in it)p+=" WHEN "+k+"='"+it[ut].Key+"' THEN '"+it[ut].Value+"'";p+=" END AS "+tt}else p+=k+" ";et-1==d||(p+=", ")}if(p+=" FROM "+c.FromClause,i==!0){var w=" ",y=null,ft=!1;for(u=0;u<s.length;u++)if(y=s[u].Ctrl.getValue(),y!=null&&y.length!=0&&(y!=0||s[u].AD_Reference_ID==n.DisplayType.YesNo)&&y!=-1){if(ft==!0&&(w+=" AND "),s[u].AD_Reference_ID==n.DisplayType.String||s[u].AD_Reference_ID==n.DisplayType.Text||s[u].AD_Reference_ID==n.DisplayType.TextLong)y=String(y).indexOf("%")==0?String(y).replace("%","●"):"●"+y,String(y).lastIndexOf("●")==String(y).length||(y=y+"●"),w+="  UPPER("+s[u].SearchColumnName+") LIKE '"+y.toUpperCase()+"' ";else if(s[u].AD_Reference_ID==n.DisplayType.Date){var b=null,g=null,a=new Date(s[u].Ctrl.getValue());b="TO_DATE( '"+(Number(a.getMonth())+1)+"-"+a.getDate()+"-"+a.getFullYear()+"', 'MM-DD-YYYY')";s[u].IsRange?(a=new Date(s[u].CtrlTo.getValue()),g="TO_DATE( '"+(Number(a.getMonth())+1)+"-"+a.getDate()+"-"+a.getFullYear()+"', 'MM-DD-YYYY')",w+=" ( "+s[u].SearchColumnName+" BETWEEN "+b+" AND "+g+")"):w+=s[u].SearchColumnName+" ="+b}else if(s[u].AD_Reference_ID==n.DisplayType.DateTime){var b=null,g=null,a=new Date(s[u].Ctrl.getValue());b="TO_DATE( '"+(Number(a.getMonth())+1)+"-"+a.getDate()+"-"+a.getFullYear()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"', 'MM-DD-YYYY HH24:MI:SS')";s[u].IsRange?(a=new Date(s[u].CtrlTo.getValue()),g="TO_DATE( '"+(Number(a.getMonth())+1)+"-"+a.getDate()+"-"+a.getFullYear()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds()+"', 'MM-DD-YYYY HH24:MI:SS')",w+=" ( "+s[u].SearchColumnName+" BETWEEN "+b+" AND "+g+")"):w+=s[u].SearchColumnName+" ="+b}else s[u].AD_Reference_ID==n.DisplayType.YesNo?(y=s[u].Ctrl.getValue()==!0?"Y":"N",w+=s[u].SearchColumnName+" = '"+y+"'"):(b=null,g=null,b=s[u].Ctrl.getValue(),s[u].IsRange?(g=s[u].CtrlTo.getValue(),w+=" ( "+s[u].SearchColumnName+" BETWEEN '"+b+"' AND '"+g+"')"):w+=" "+s[u].SearchColumnName+" ='"+b+"'");ft=!0}w.length>1?(p+=c.FromClause.toUpperCase().indexOf("WHERE")>-1?" AND "+w:" WHERE "+w,f!=null&&f.length>0&&(p+=" AND "+f)):f!=null&&f.length>0&&(p+=c.FromClause.toUpperCase().indexOf("WHERE")>-1?" AND "+f:" WHERE "+f);c.OTHERCLAUSE!=null&&(String(c.OTHERCLAUSE).toUpperCase().indexOf("WHERE")>-1&&(c.FromClause.toUpperCase().indexOf("WHERE")>-1||w.length>1||f!=null&&f.length>1)&&(c.OTHERCLAUSE=String(c.OTHERCLAUSE).replace("WHERE","AND")),p+=" "+c.OTHERCLAUSE)}else p+=c.FromClause.toUpperCase().indexOf("WHERE")>-1?" AND rownum=-1":" WHERE rownum=-1";r||(r=1);t.ajax({url:n.Application.contextUrl+"InfoWindow/GetData",dataType:"json",type:"POST",data:{sql:p,tableName:c.TableName,pageNo:r},error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));h[0].style.visibility="hidden";return},success:function(t){var i=JSON.parse(t);if(i==null){h[0].style.visibility="hidden";return}if(i.Error){n.ADialog.error(i.Error);h[0].style.visibility="hidden";return}hi(i.pSetting);fi(i.data)}})},fi=function(i){var r,s,c,u;if(i==null){alert(n.Msg.getMsg("NoDataFound"));h[0].style.visibility="hidden";return}var a=[],y=[],f=null;for(u in i)r={resizable:!0},f=o[u].AD_Reference_ID,r.caption=o[u].Name,r.field=i[u].ColumnName.toUpperCase(),r.columnName=i[u].ColumnName.toUpperCase(),r.sortable=!0,r.hidden=!o[u].IsDisplayed,r.size="100px",n.DisplayType.IsNumeric(f)?r.render=f==n.DisplayType.Integer?"int":f==n.DisplayType.Amount?"number:2":"number:1":n.DisplayType.IsDate(f)?r.render=function(n,t,i){var r=n[a[i].field];return r?Globalize.format(new Date(r),"d"):""}:f==n.DisplayType.Location||f==n.DisplayType.Locator?r.render="int":f==n.DisplayType.Account?r.render="int":f==n.DisplayType.PAttribute?r.render="int":f==n.DisplayType.Button?r.render=function(){return"<div>button<\/div>"}:f==n.DisplayType.Image?r.render=function(){return"<div>Image<\/div>"}:n.DisplayType.IsLOB(f)&&(r.render=function(){return"<div>[Lob-blob]<\/div>"}),a[u]=r;for(s=0;s<i[0].RowCount;s++){c={};for(u in i)c[i[u].ColumnName.toUpperCase()]=i[u].Values[s];c.recid=s+1;y[s]=c}if(v="gridInfodata"+Math.random(),v=v.replace(".",""),w2utils.encodeTags(y),g=t(ot).w2grid({name:v,recordHeight:40,show:{toolbar:!0,columnHeaders:!0,lineNumbers:!0,selectColumn:!0,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:a,records:y,multiSelect:e,onUnselect:ei}),e)for(itm in l)for(u in w2ui[v].records)w2ui[v].records[u][keyCol]==l[itm]&&w2ui[v].select(parseInt(u)+1);h[0].style.visibility="hidden"};wt=function(){g!=null&&g.destroy();g=null};bt=function(){var n=w2ui[v].getSelection();for(item in n)l.indexOf(w2ui[v].get(n[item])[keyCol])==-1&&l.push(w2ui[v].get(n[item])[keyCol]);nt.onClose!=null&&l.length>0&&nt.onClose();ct()};this.getSelectedValues=function(){return l};ct=function(){ft.off("click");ht.off("click");ut.off("click");y.off("keyup");w.off("click");b.off("click");k.off("click");d.off("click");a.off("change");ot=null;it=null;g!=null&&g.destroy();g=null;p=null;kt=null;dt=gt=ni=et=it=ot=rt=null;h=st=ut=ft=ht=null;w=b=k=d=a=null;g=null;c=null;o=null;vt=null;s=null;keyCol=null;nt=null;l=null;y!=null&&(y.dialog("destroy"),y.remove());y=null;this.disposeComponent=null;this.displaySchema=null;this.getControl=null;this.displayData=null;this.loadData=null;this.disposeDataSec=null;this.btnOKClick=null;this.getSelectedValues=null;this.disposeComponent=null}}i.prototype.getValueAsString=function(t){return n.context.getWindowContext(this.windowNo,t,!0)};n.InfoWindow=i}(VIS,jQuery),function(n,t){function i(i,r,u,f){function es(){function kr(t){t&&(cr=s.find("option:selected").val());ut=1;a=[];s.val()!=0?a[0]=s.val():a=ht;ui(a,null,function(t){li(t);co(s.val(),function(){t.length!=0?(e.val(t[0].DimensionTypeVal),pr(e.val()),l.val(""),et=!1,rt.empty().append(n.Msg.getMsg("Add")),s.val()!=-1&&e.val()!=0?(y.css("display","block"),rt.css("display","block"),gt.html()==""?p.getRoot().parent().css("height","448px"):p.getRoot().parent().css("height","469px")):(y.css("display","none"),rt.css("display","none"),gt.html()==""?p.getRoot().parent().css("height","390px"):p.getRoot().parent().css("height","410px"))):(pr(e.val()),s.val()!=-1&&e.val()!=0?(y.css("display","block"),rt.css("display","block"),gt.html()==""?p.getRoot().parent().css("height","448px"):p.getRoot().parent().css("height","469px")):(y.css("display","none"),rt.css("display","none"),gt.html()==""?p.getRoot().parent().css("height","390px"):p.getRoot().parent().css("height","410px")))})})}var r,u,b,it,pi,ar,br;rf=t("<label>");uf=t("<label>");ff=t("<label>");ef=t("<label>");no=t("<label>");of=t("<label>");gt=t("<label>");s=t("<select tabindex='2'>");e=t("<select tabindex='3'>");tt=t("<select>");l=t("<input type='number' min='0' tabindex='6'>");v=t("<input type='number' min='0' tabindex='11'>");w=f?t("<input type='number' min='0' tabindex='1' readonly style='background-color:#F1F1F1'>"):t("<input type='number' min='0' tabindex='1'>");ft=t("<input type='text' readonly='true' tabindex='15' style='background-color:#F1F1F1'>");rt=t("<a style='cursor:pointer;' tabindex='7'>");gi=t("<a>");du=t("<a style='cursor:pointer;' tabindex='12'>");gu=t("<a style='cursor:pointer;' tabindex='13'>");te=t("<div class='VIS-AMTD-Grid'>");bf=t("<div class='VIS-AMTD-SubGrid'>");g=t("<div class='VIS-AMTD-formDynmicInput'>");d=t("<div class='VIS-AMTD-formDynmicInput'>");yo=t("<button>");po=t("<button>");or=t("<div class='VIS-AMTD-Modal' id='updateModal'>");ne=t("<div class='VIS-AMTD-Modal-Content'>");ge=t("<span class='VIS-AMTD-Close'>");statusSpanShowRecordNo=t("<label>");statusSpanShowRecordNo.addClass("vis-statusbar-pageMsg");ge.append("X");er=t('<ul class="vis-statusbar-ul"><\/ul>');ae=t('<div class="VIS-AMTD-StatusContainer"><\/div>');io=t('<li  style="opacity: 0.6;"><div><img style="opacity: 1;" action="first" title="First Page" alt="First Page" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageFirst16.png"><\/div><\/li>');er.append(io);ro=t('<li style="opacity: 0.6;"><div><img style="opacity: 1;" action="prev" title="Page Down" alt="Page Up" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageUp16.png"><\/div><\/li>');er.append(ro);dt=t('<select class="vis-statusbar-combo" style="width:50px;"><\/select>');r=t("<li><\/li>");r.append(dt);er.append(r);uo=t('<li style="opacity: 1;"><div><img style="opacity: 1;" action="next" title="Page Up" alt="Page Down" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageDown16.png"><\/div><\/li>');er.append(uo);fo=t('<li style="opacity: 1;"><div><img style="opacity: 1;" action="last" title="Last Page" alt="Last Page" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageLast16.png"><\/div><\/li>');er.append(fo);ae.append(er);lo=[];h=0;et=!1;ao=0;vo=0;kf="";tr="";ir="";rr="";ur="";ei="";oi="";si="";hi="";ht="";di="";wo=0;ht=[];a=[];ve=0;nf=!0;k=0;hr=30;ut=1;fs=0;sr=0;cr=-1;eo=0;ci=n.DisplayType.GetNumberFormat(n.DisplayType.Amount);df=t("<div class='VIS-AMTD-formWrap'>");wr=t("<input type='button' class='VIS_Pref_btn-2 pull-left' tabindex='16' >");rt.append(n.Msg.getMsg("Add"));gi.append(n.Msg.getMsg("Cancel"));du.append(n.Msg.getMsg("Update"));gu.append(n.Msg.getMsg("Cancel"));wr.val(n.Msg.getMsg("OK"));rf.append(n.Msg.translate(n.Env.getCtx(),"C_AcctSchema_ID"));uf.append(n.Msg.translate(n.Env.getCtx(),"ElementType"));ff.append(n.Msg.getMsg("TotalAmount"));ef.append(n.Msg.getMsg("Amount"));no.append(n.Msg.getMsg("Amount"));gi.css("display","none");of.append(n.Msg.getMsg("Total"));u=t("<div class='VIS-AMTD-formData'>");u.append(rf).append(s);b=t("<div class='VIS-AMTD-formData'>");b.append(uf).append(e);it=t("<div class='VIS-AMTD-formData'>");it.append(ff).append(w);y=t("<div class='VIS-AMTD-formData VIS-AMTD-amountTxt'>");y.append(ef).append(l);at=t("<div class='VIS-AMTD-formData VIS-AMTD-amountTxt'>");at.append(no).append(v);ot=t("<div class='VIS-AMTD-formBtns'>");pi=t("<div class='pull-right'>");pi.append(rt);ot.append(pi);gf=t("<div class='VIS-AMTD-ModalformBtns'>");ar=t("<div class='pull-right'>");ar.append(du).append(gu);gf.append(ar);br=t("<div class='VIS-AMTD-formData'>");ne.append(d).append(at).append(gf);or.append(ne);te.append(bf).append(or).append(ae);br.append(of).append(ft);yr=t("<div style='color:green;font-size:small'>");yr.append(gt);df.append(yr).append(it).append(u).append(b).append(g).append(y).append(ot);be.append(df).append(te).append(br).append(wr);lr.append(be).append(ke);s.on("change",function(){o("visible");var t=!0;s.val()==0&&(t=!1,ui(ht,null,function(t){t.length!=0&&n.ADialog.confirm("ConfirmSelectAllAcctSchema",!0,"","Confirm",function(t){if(t){o("visible");for(var r=0;r<ht.length;r++)n.DB.executeQuery("delete from c_dimamtaccttype where c_acctschema_id="+ht[r]+" and c_dimamt_id="+i+"");tf();ui(ht,null,function(t){o("visible");li(t);cr=s.find("option:selected").val();h=0;l.val("0");et=!1;gi.css("display","none");ot.css("width","6%");e.val()=="AC"||e.val()=="U1"||e.val()=="U2"?y.css("width","25%"):y.css("width","33.3%");rt.empty().append(n.Msg.getMsg("Add"));ft.val(0);kr(!1)})}else s.val(cr),e.val(sr),kr(!1)})}));ui(ht,null,function(){kr(t);o("hidden")})});e.on("change",function(){o("visible");ui(a,null,function(t){t.length!=0?n.ADialog.confirm("ConfirmChangeDimensionType",!0,"","Confirm",function(t){if(t){o("visible");pr(e.val());sr=e.find("option:selected").val();l.val("0");et=!1;gi.css("display","none");ot.css("width","6%");e.val()=="AC"||e.val()=="U1"||e.val()=="U2"?y.css("width","25%"):y.css("width","33.3%");rt.empty().append(n.Msg.getMsg("Add"));for(var r=0;r<a.length;r++)n.DB.executeQuery("delete from c_dimamtaccttype where c_acctschema_id="+a[r]+" and c_dimamt_id="+i+"");ui(a,null,function(n){li(n);tf();ft.val(0)});o("hidden")}else return e.val(sr),oo(),o("hidden"),!1;oo()}):(pr(e.val()),sr=e.find("option:selected").val());oo();e.focus();o("hidden")})});rt.on("keydown",function(n){if(n.keyCode==13&&(o("visible"),pe())){et||h++;var t=e.find("option:selected").val();t=="AC"?(c(e.find("option:selected").text(),ii.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),fi.getValue(),tt.find("option:selected").val(),0),tt.val("-1"),fi.setValue("-1")):t=="AY"?(c(e.find("option:selected").text(),ni.find("option:selected").text(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ni.find("option:selected").val(),-1,0),ni.val(-1)):t=="BP"?(c(e.find("option:selected").text(),ai.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),tr.getValue(),-1,0),ai.val(""),tr.setValue("-1")):t=="LF"||t=="LT"?(c(e.find("option:selected").text(),nr.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ir.getValue(),-1,0),nr.val(""),ir.setValue("-1")):t=="MC"?(c(e.find("option:selected").text(),wt.find("option:selected").text(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),wt.find("option:selected").val(),-1,0),wt.val(-1)):t=="OO"||t=="OT"?(c(e.find("option:selected").text(),ct.find("option:selected").text(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ct.find("option:selected").val(),-1,0),ct.val("-1")):t=="PJ"?(c(e.find("option:selected").text(),vi.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),rr.getValue(),-1,0),vi.val(""),rr.setValue("-1")):t=="PR"?(c(e.find("option:selected").text(),yi.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ur.getValue(),-1,0),yi.val(""),ur.setValue("-1")):t=="SA"?c(e.find("option:selected").text(),"",l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),"",-1,0):t=="SR"?(c(e.find("option:selected").text(),ti.find("option:selected").text(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ti.find("option:selected").val(),-1,0),ti.val("-1")):t=="U1"||t=="U2"?(c(e.find("option:selected").text(),ii.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),fi.getValue(),tt.find("option:selected").val(),0),tt.val("-1"),ii.val(""),fi.setValue("-1")):(t=="X1"||t=="X2"||t=="X3"||t=="X4"||t=="X5"||t=="X6"||t=="X7"||t=="X8"||t=="X9")&&(c(e.find("option:selected").text(),lt.find("option:selected").text(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),lt.find("option:selected").val(),-1,0),lt.val(-1))}});rt.on("click",function(){if(o("visible"),pe()){et||h++;var n=e.find("option:selected").val();n=="AC"?(c(e.find("option:selected").text(),ii.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),fi.getValue(),tt.find("option:selected").val(),0),tt.val("-1"),fi.setValue("-1")):n=="AY"?(c(e.find("option:selected").text(),ni.find("option:selected").text(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ni.find("option:selected").val(),-1,0),ni.val(-1)):n=="BP"?(c(e.find("option:selected").text(),ai.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),tr.getValue(),-1,0),ai.val(""),tr.setValue("-1")):n=="LF"||n=="LT"?(c(e.find("option:selected").text(),nr.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ir.getValue(),-1,0),nr.val(""),ir.setValue("-1")):n=="MC"?(c(e.find("option:selected").text(),wt.find("option:selected").text(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),wt.find("option:selected").val(),-1,0),wt.val(-1)):n=="OO"||n=="OT"?(c(e.find("option:selected").text(),ct.find("option:selected").text(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ct.find("option:selected").val(),-1,0),ct.val("-1")):n=="PJ"?(c(e.find("option:selected").text(),vi.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),rr.getValue(),-1,0),vi.val(""),rr.setValue("-1")):n=="PR"?(c(e.find("option:selected").text(),yi.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ur.getValue(),-1,0),yi.val(""),ur.setValue("-1")):n=="SA"?c(e.find("option:selected").text(),"",l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),"",-1,0):n=="SR"?(c(e.find("option:selected").text(),ti.find("option:selected").text(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ti.find("option:selected").val(),-1,0),ti.val("-1")):n=="U1"||n=="U2"?(c(e.find("option:selected").text(),ii.val(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),fi.getValue(),tt.find("option:selected").val(),0),tt.val("-1"),ii.val(""),fi.setValue("-1")):(n=="X1"||n=="X2"||n=="X3"||n=="X4"||n=="X5"||n=="X6"||n=="X7"||n=="X8"||n=="X9")&&(c(e.find("option:selected").text(),lt.find("option:selected").text(),l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),lt.find("option:selected").val(),-1,0),lt.val(-1))}});gi.on("click",function(){o("visible");pr(e.val());l.val("");et=!1;gi.css("display","none");ot.css("width","6%");e.val()=="AC"||e.val()=="U1"||e.val()=="U2"?y.css("width","25%"):y.css("width","33.3%");rt.empty().append(n.Msg.getMsg("Add"));o("hidden")});du.on("keydown",function(n){if(n.keyCode==13&&(o("visible"),pe())){var t=e.find("option:selected").val();t=="AC"?(c(e.find("option:selected").text(),ri.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),kt.getValue(),nt.find("option:selected").val(),k),nt.val("-1"),kt.setValue("-1")):t=="AY"?(c(e.find("option:selected").text(),yt.find("option:selected").text(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),yt.find("option:selected").val(),-1,k),yt.val(-1)):t=="BP"?(c(e.find("option:selected").text(),wi.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ei.getValue(),-1,k),wi.val(""),ei.setValue("-1")):t=="LF"||t=="LT"?(c(e.find("option:selected").text(),fr.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),oi.getValue(),-1,k),fr.val(""),oi.setValue("-1")):t=="MC"?(c(e.find("option:selected").text(),bt.find("option:selected").text(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),bt.find("option:selected").val(),-1,k),bt.val(-1)):t=="OO"||t=="OT"?(c(e.find("option:selected").text(),vt.find("option:selected").text(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),vt.find("option:selected").val(),-1,k),vt.val("-1")):t=="PJ"?(c(e.find("option:selected").text(),bi.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),si.getValue(),-1,k),bi.val(""),si.setValue("-1")):t=="PR"?(c(e.find("option:selected").text(),ki.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),hi.getValue(),-1,k),ki.val(""),hi.setValue("-1")):t=="SA"?c(e.find("option:selected").text(),"",l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),"",-1,k):t=="SR"?(c(e.find("option:selected").text(),pt.find("option:selected").text(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),pt.find("option:selected").val(),-1,k),pt.val("-1")):t=="U1"||t=="U2"?(c(e.find("option:selected").text(),ri.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),kt.getValue(),nt.find("option:selected").val(),k),nt.val("-1"),ri.val(""),kt.setValue("-1")):(t=="X1"||t=="X2"||t=="X3"||t=="X4"||t=="X5"||t=="X6"||t=="X7"||t=="X8"||t=="X9")&&(c(e.find("option:selected").text(),st.find("option:selected").text(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),st.find("option:selected").val(),-1,k),st.val(-1))}});du.on("click",function(){if(o("visible"),pe()){var n=e.find("option:selected").val();n=="AC"?(c(e.find("option:selected").text(),ri.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),kt.getValue(),nt.find("option:selected").val(),k),nt.val("-1"),kt.setValue("-1")):n=="AY"?(c(e.find("option:selected").text(),yt.find("option:selected").text(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),yt.find("option:selected").val(),-1,k),yt.val(-1)):n=="BP"?(c(e.find("option:selected").text(),wi.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),ei.getValue(),-1,k),wi.val(""),ei.setValue("-1")):n=="LF"||n=="LT"?(c(e.find("option:selected").text(),fr.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),oi.getValue(),-1,k),fr.val(""),oi.setValue("-1")):n=="MC"?(c(e.find("option:selected").text(),bt.find("option:selected").text(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),bt.find("option:selected").val(),-1,k),bt.val(-1)):n=="OO"||n=="OT"?(c(e.find("option:selected").text(),vt.find("option:selected").text(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),vt.find("option:selected").val(),-1,k),vt.val("-1")):n=="PJ"?(c(e.find("option:selected").text(),bi.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),si.getValue(),-1,k),bi.val(""),si.setValue("-1")):n=="PR"?(c(e.find("option:selected").text(),ki.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),hi.getValue(),-1,k),ki.val(""),hi.setValue("-1")):n=="SA"?c(e.find("option:selected").text(),"",l.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),"",-1,k):n=="SR"?(c(e.find("option:selected").text(),pt.find("option:selected").text(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),pt.find("option:selected").val(),-1,k),pt.val("-1")):n=="U1"||n=="U2"?(c(e.find("option:selected").text(),ri.val(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),kt.getValue(),nt.find("option:selected").val(),k),nt.val("-1"),ri.val(""),kt.setValue("-1")):(n=="X1"||n=="X2"||n=="X3"||n=="X4"||n=="X5"||n=="X6"||n=="X7"||n=="X8"||n=="X9")&&(c(e.find("option:selected").text(),st.find("option:selected").text(),v.val(),h,s.find("Option:selected").val(),e.find("option:selected").val(),st.find("option:selected").val(),-1,k),st.val(-1))}});w.on("keypress",function(n){return n.keyCode>=48&&n.keyCode<=57||n.keyCode==46?!0:!1});l.on("keypress",function(n){return n.keyCode>=48&&n.keyCode<=57||n.keyCode==46?!0:!1});v.on("keypress",function(n){return n.keyCode>=48&&n.keyCode<=57||n.keyCode==46?!0:!1});gu.on("click",function(){et=!1;or.css("display","none")});gu.on("keydown",function(n){n.keyCode==13&&(et=!1,or.css("display","none"))});er.on(n.Events.onTouchStartOrClick,"LI",function(n){var i;if(o("visible"),t(n.target).attr("action")=="first")ut!=1&&(ut=1,ui(a,null,function(n){li(n);dt.val(ut)}));else if(t(n.target).attr("action")=="prev")ut!=1&&(ut--,ui(a,null,function(n){li(n);dt.val(ut)}));else if(t(n.target).attr("action")=="next"){if(i=so(),ut>=i){o("hidden");return}ut++;ui(a,null,function(n){li(n);dt.val(ut)})}else if(t(n.target).attr("action")=="last"){if(i=so(),ut>=i){o("hidden");return}ut=i;ui(a,null,function(n){li(n);dt.val(ut)})}o("hidden")});dt.on("change",function(){o("visible");ut!=dt.val()&&(ut=dt.val(),ui(a,null,function(n){li(n);dt.val(ut)}));o("hidden")});wr.on("click",function(){if(o("visible"),parseFloat(ft.val())>parseFloat(w.val()))n.ADialog.warn("LineTotalNotGrater"),w.focus(),o("hidden");else if(w.val()!=""&&w.val()!=0)a=[],s.val()==0?a=ht:a[0]=s.val(),ho(i,w.val(),-1,a,"","","",-1,-1,-1,function(){vr.onClosing(i);p.close()});else{vr.onClosing(i);p.close()}})}function oo(){e.val()==""||e.val()==0?(y.css("display","none"),rt.css("display","none"),gt.html()==""?p.getRoot().parent().css("height","390px"):p.getRoot().parent().css("height","410px")):(y.css("display","block"),rt.css("display","block"),gt.html()==""?p.getRoot().parent().css("height","448px"):p.getRoot().parent().css("height","469px"))}function tf(){var f=!1,t="",e="",o,r,s;for(gt.empty(),gt.append(""),o=" select distinct ct.totaldimlineamout as amount,ac.name from c_dimamtaccttype ct  inner join c_dimamtline cl on ct.c_dimamt_id=cl.c_dimamt_id and ct.c_dimamtaccttype_id=cl.c_dimamtaccttype_id  inner join c_acctschema ac on ac.c_acctschema_id=ct.c_acctschema_id   where ct.totaldimlineamout in (Select max(totaldimlineamout) from c_Dimamtaccttype    where c_dimamt_id="+i+") and ct.c_dimamt_id="+i+"",r=n.DB.executeReader(o);r.read();)r.getInt(0)!=null?(yr.css("display","block"),f=!0,e=ci.GetFormatedValue(r.getString(0)),t+=t==""?r.getString(1):","+r.getString(1)):(gt.append(""),f=!1,window.setTimeout(function(){p.getRoot().parent().css("height","448px")},200));f&&(t.length>55&&(t=t.substring(0,55)+"..."),gt.append(n.Msg.getMsg("MaxDimensionAmount")+" : "+e+" "+n.Msg.getMsg("ForAcctSchema")+" : "+t),window.setTimeout(function(){p.getRoot().parent().css("height","470px")},200));i!=0?(s=n.DB.executeScalar("select amount from c_dimAmt where c_dimamt_id="+i+""),parseFloat(u)>0?w.val(u):w.val(s)):u?w.val(u):w.val("");gt.html()==""&&(yr.css("display","none"),p.getRoot().parent().css("height","448px"))}function pe(){return w.val()==""&&w.val().trim().length==0?(n.ADialog.warn("ValidateTotalAmount"),w.focus(),o("hidden"),!1):s.val()==""||s.val()==-1?(n.ADialog.warn("ValidateAcctSchema"),s.focus(),o("hidden"),!1):e.val()==""||e.val()==0?(n.ADialog.warn("ValidateDimType"),e.focus(),o("hidden"),!1):w.val()==""&&w.val().trim().length==0?(n.ADialog.warn("ValidateTotalAmount"),w.focus(),o("hidden"),!1):et?et?v.val()==""&&v.val().trim().length==0?(n.ADialog.warn("ValidateAmount"),v.focus(),o("hidden"),!1):parseFloat(v.val())>parseFloat(w.val())?(n.ADialog.warn("LineTotalNotGrater"),v.focus(),o("hidden"),!1):bo()?(o("hidden"),!0):(o("hidden"),!1):(o("hidden"),!0):l.val()==""&&l.val().trim().length==0?(n.ADialog.warn("ValidateAmount"),l.focus(),o("hidden"),!1):parseFloat(l.val())>parseFloat(w.val())?(n.ADialog.warn("LineTotalNotGrater"),l.focus(),o("hidden"),!1):bo()?(o("hidden"),!0):(o("hidden"),!1)}function bo(){if(e.val()!=0)if(et){if(e.val()=="AC")return nt.val()==-1||nt.val()==null?(n.ADialog.warn("ValidateElement"),nt.focus(),o("hidden"),!1):ri.val()==""?(n.ADialog.warn("ValidateAcctElement"),ri.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="AY")return yt.val()==-1||yt.val()==null?(n.ADialog.warn("ValidateActivity"),yt.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="BP")return wi.val()==""?(n.ADialog.warn("ValidateBPartner"),wi.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="LF"||e.val()=="LT")return fr.val()==""?(n.ADialog.warn("ValidateLocation"),fr.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="MC")return bt.val()==-1||bt.val()==null?(n.ADialog.warn("ValidateCamp"),wt.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="OO"||e.val()=="OT")return vt.val()==-1||vt.val()==null?(n.ADialog.warn("ValidateOrg"),vt.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="PJ")return bi.val()==""?(n.ADialog.warn("ValidateProject"),bi.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="PR")return ki.val()==""?(n.ADialog.warn("ValidateProduct"),ki.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="SA")return!0;if(e.val()=="SR")return pt.val()==-1||pt.val()==null?(n.ADialog.warn("ValidateSales"),pt.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="U1"||e.val()=="U2")return nt.val()==-1||nt.val()==null?(n.ADialog.warn("ValidateElement"),nt.focus(),o("hidden"),!1):ri.val()==""?(n.ADialog.warn("ValidateAcctElement"),ri.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="X1"||e.val()=="X2"||e.val()=="X3"||e.val()=="X4"||e.val()=="X5"||e.val()=="X6"||e.val()=="X7"||e.val()=="X8"||e.val()=="X9")return st.val()==-1||st.val()==null?(n.ADialog.warn("ValidateUElement"),st.focus(),o("hidden"),!1):(o("hidden"),!0)}else{if(e.val()=="AC")return tt.val()==-1||tt.val()==null?(n.ADialog.warn("ValidateElement"),tt.focus(),o("hidden"),!1):ii.val()==""?(n.ADialog.warn("ValidateAcctElement"),ii.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="AY")return ni.val()==-1||ni.val()==null?(n.ADialog.warn("ValidateActivity"),ni.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="BP")return ai.val()==""?(n.ADialog.warn("ValidateBPartner"),ai.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="LF"||e.val()=="LT")return nr.val()==""?(n.ADialog.warn("ValidateLocation"),nr.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="MC")return wt.val()==-1||wt.val()==null?(n.ADialog.warn("ValidateCamp"),wt.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="OO"||e.val()=="OT")return ct.val()==-1||ct.val()==null?(n.ADialog.warn("ValidateOrg"),ct.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="PJ")return vi.val()==""?(n.ADialog.warn("ValidateProject"),vi.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="PR")return yi.val()==""?(n.ADialog.warn("ValidateProduct"),yi.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="SA")return!0;if(e.val()=="SR")return ti.val()==-1||ti.val()==null?(n.ADialog.warn("ValidateSales"),ti.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="U1"||e.val()=="U2")return tt.val()==-1||tt.val()==null?(n.ADialog.warn("ValidateElement"),tt.focus(),o("hidden"),!1):ii.val()==""?(n.ADialog.warn("ValidateAcctElement"),ii.focus(),o("hidden"),!1):(o("hidden"),!0);if(e.val()=="X1"||e.val()=="X2"||e.val()=="X3"||e.val()=="X4"||e.val()=="X5"||e.val()=="X6"||e.val()=="X7"||e.val()=="X8"||e.val()=="X9")return lt.val()==-1||lt.val()==null?(n.ADialog.warn("ValidateUElement"),lt.focus(),o("hidden"),!1):(o("hidden"),!0)}}function ui(r,u,f){var c=[];return t.ajax({dataType:"json",type:"POST",url:n.Application.contextUrl+"AmountDivision/GetDiminsionLine",data:{accountingSchema:JSON.stringify(r),dimensionID:i,DimensionLineID:0,pageNo:ut,pSize:hr},success:function(t){var i,r;if(t){if(t=JSON.parse(t),nf=!0,t.length>0){for(i=0;i<t.length;i++)if(i==0&&nf){for(ye=t[i].TotalRecord,r=so(),dt.empty(),b=1;b<r+1;b++)dt.empty().append("<option value="+b+">"+b+"<\/option>");dt.val(1);nf=!1}u&&(s.val(t[0].AcctSchema),co(s.val(),function(){e.val(t[0].DimensionTypeVal);pr(e.val());sr=t[0].DimensionTypeVal;cr=t[0].AcctSchema;ft.val(ci.GetFormatedValue(t[0].TotalLineAmount))}));u||(sr=t[0].DimensionTypeVal,cr=t[0].AcctSchema,ft.val(ci.GetFormatedValue(t[0].TotalLineAmount)))}else dt.empty().append('<option value="1">1<\/option>'),ft.val(ci.GetFormatedValue(0));h=t.length;l.val("");et=!1;rt.empty().append(n.Msg.getMsg("Add"));c=t;f&&f(t)}else n.ADialog.error("ErrorGettingData"),o("hidden")},error:function(){o("hidden");n.ADialog.error("ErrorGettingData");return}}),c}function o(n){ke[0].style.visibility=n}function so(){var n=ye%hr;return n!=0?parseInt(ye/hr)+1:parseInt(ye/hr)}function ho(r,u,f,e,s,c,l,a,v,y,p){o("visible");u=ci.GetFormatedValue(u);f=ci.GetFormatedValue(f);t.ajax({dataType:"json",type:"POST",url:n.Application.contextUrl+"AmountDivision/InsertDimensionLine",data:{recordId:r,totalAmount:u,lineAmount:f,acctSchemaID:JSON.stringify(e),elementTypeID:c,dimensionValue:a,elementID:v,oldDimensionName:y},success:function(t){var u,r;t=JSON.parse(t);t[0]!=""?(i=t[0],tf(),et?(n.ADialog.info("UpdatedDimLine"),w2ui[di].set(h,{DimensionName:l}),w2ui[di].set(h,{DimensionValueAmount:f}),w2ui[di].set(h,{CalculateDimValAmt:f}),r=ci.GetFormatedValue(parseFloat(parseFloat(ft.val())-parseFloat(ve))+parseFloat(f)),ft.val(r)):(u=w2ui[di].records.length,w2ui[di].add({recid:u+1,DimensionType:s,DimensionName:l,DimensionValueAmount:f,lineAmountID:t[1],CalculateDimValAmt:f}),r=ci.GetFormatedValue(parseFloat(ft.val())+parseFloat(f)),ft.val(r)),o("hidden")):(n.ADialog.error("ErrorGettingData"),o("hidden"));p&&p()},error:function(){o("hidden");n.ADialog.error("ErrorGettingData");retval=!1;loading=!1}})}function c(t,r,u,f,e,s,h,c,y){var b,k,p;if(u=ci.GetFormatedValue(u),b="",a=[],e==0?a=ht:a[0]=e,et)if(p="select nvl(cline.c_dimamtline_id,0) as DimLineID from c_dimamt cd inner join c_dimamtaccttype cact on cd.c_dimamt_id=cact.c_dimamt_id  inner join c_dimamtline cline on cd.c_Dimamt_id=cline.c_dimamt_id and cact.c_dimamtaccttype_id=cline.c_dimamtaccttype_id  where cd.c_dimamt_id="+i+" and cact.elementtype='"+s+"' and cact.c_acctschema_id in("+a.toString()+") and cline.c_dimamtline_id not in ("+y+") ",s=="AC"?p+=" and C_ElementValue_ID="+h:s=="AY"?p+=" and C_Activity_ID ="+h:s=="BP"?p+=" and C_BPartner_ID="+h:s=="LF"||s=="LT"?p+=" and C_Location_ID="+h:s=="MC"?p+=" and C_Campaign_ID="+h:s=="OO"||s=="OT"?p+=" and Org_ID="+h:s=="PJ"?p+=" and C_Project_ID="+h:s=="PR"?p+=" and M_Product_ID="+h:s=="SA"||(s=="SR"?p+=" and C_SalesRegion_ID="+h:s=="U1"||s=="U2"?p+=" and C_ElementValue_ID="+h:(s=="X1"||s=="X2"||s=="X3"||s=="X4"||s=="X5"||s=="X6"||s=="X7"||s=="X8"||s=="X9")&&(p+=" and AD_Column_ID="+h)),b=n.DB.executeScalar(p),b==null)k=n.DB.executeScalar("select amount from c_dimamtline where c_dimamtline_id in ("+y+") and rownum=1"),parseFloat(ft.val())+parseFloat(u)-parseFloat(k)<=parseFloat(w.val())?ho(i,w.val(),u,a,t,s,r,h,c,eo,function(){we()}):(n.ADialog.warn("LineTotalNotGrater"),v.val(""),v.focus(),we());else return n.ADialog.warn("NameExists"),v.val(""),o("hidden"),!1;else if(parseFloat(ft.val())+parseFloat(u)<=parseFloat(w.val()))if(p="select nvl(cline.c_dimamtline_id,0) as DimLineID from c_dimamt cd inner join c_dimamtaccttype cact on cd.c_dimamt_id=cact.c_dimamt_id  inner join c_dimamtline cline on cd.c_Dimamt_id=cline.c_dimamt_id and cact.c_dimamtaccttype_id=cline.c_dimamtaccttype_id  where cd.c_dimamt_id="+i+" and cact.elementtype='"+s+"' and cact.c_acctschema_id in("+a.toString()+")",s=="AC"?p+=" and C_ElementValue_ID="+h:s=="AY"?p+=" and C_Activity_ID ="+h:s=="BP"?p+=" and C_BPartner_ID="+h:s=="LF"||s=="LT"?p+=" and C_Location_ID="+h:s=="MC"?p+=" and C_Campaign_ID="+h:s=="OO"||s=="OT"?p+=" and Org_ID="+h:s=="PJ"?p+=" and C_Project_ID="+h:s=="PR"?p+=" and M_Product_ID="+h:s=="SA"||(s=="SR"?p+=" and C_SalesRegion_ID="+h:s=="U1"||s=="U2"?p+=" and C_ElementValue_ID="+h:(s=="X1"||s=="X2"||s=="X3"||s=="X4"||s=="X5"||s=="X6"||s=="X7"||s=="X8"||s=="X9")&&(p+=" and AD_Column_ID="+h)),b=n.DB.executeScalar(p),b==null)ho(i,w.val(),u,a,t,s,r,h,c,0,function(){we()});else return n.ADialog.warn("NameExists"),f=f-1,l.val(""),o("hidden"),!1;else n.ADialog.warn("LineTotalNotGrater"),l.val(""),l.focus(),f=f-1,we()}function we(){l.val("");et=!1;gi.css("display","none");or.css("display","none");ot.css("width","6%");e.val()=="AC"||e.val()=="U1"||e.val()=="U2"?y.css("width","25%"):y.css("width","33.3%");rt.empty().append(n.Msg.getMsg("Add"))}function ko(){br=null;ct=null;sf=null;ni=null;hf=null;wt=null;cf=null;ti=null;lf=null;lt=null;af=null;ai=null;vf=null;vi=null;yf=null;yi=null;pf=null;wf=null;tt=null;ie=null;vt=null;re=null;yt=null;ue=null;bt=null;fe=null;pt=null;ee=null;st=null;oe=null;wi=null;se=null;bi=null;he=null;ki=null;ce=null;le=null;nt=null;g.empty();d.empty()}function pr(n){ko();n=="AC"?ts():n=="AY"?ss():n=="BP"?as():n=="LF"?ns():n=="LT"?ns():n=="MC"?hs():n=="OO"?go():n=="OT"?go():n=="PJ"?vs():n=="PR"?ys():n=="SA"||(n=="SR"?cs():n=="U1"||n=="U2"?ts():(n=="X1"||n=="X2"||n=="X3"||n=="X4"||n=="X5"||n=="X6"||n=="X7"||n=="X8"||n=="X9")&&ls())}function os(r,u){t.ajax({url:n.Application.contextUrl+"AmountDivision/GetAccountingSchema",dataType:"json",data:{OrgID:r},type:"POST",error:function(){o("hidden");alert(n.Msg.getMsg("ErrorWhileGettingData"));return},success:function(r){var h=n.DB.executeScalar("select c_acctschema1_id from ad_clientinfo where ad_client_ID="+n.Env.getCtx().getAD_Client_ID()+""),l=!1,e=JSON.parse(r),f,c;if(e.Error){n.ADialog.error(e.Error);o("hidden");return}for(s.empty().append('<option selected="selected" value="-1">Please select<\/option>'),f=0;f<e.length;f++)f==0&&s.append('<option value="0">ALL<\/option>'),h==e[f].Key&&(l=!0),s.append(t("<option><\/option>").val(e[f].Key).html(e[f].Value)),ht.push(e[f].Key);l&&(c=n.DB.executeScalar("select cd.c_acctschema_id from c_dimamtaccttype cd inner join c_dimamtline cl on cd.c_dimamtaccttype_id=cl.c_dimamtaccttype_id where cd.c_dimamt_id="+i+""),(c==""||c==null)&&(s.val(h),co(h)));u&&(o("visible"),u(),o("hidden"))}})}function co(i,r){o("visible");t.ajax({url:n.Application.contextUrl+"AmountDivision/GetDiminsionType",dataType:"json",data:"{}",type:"POST",error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));o("hidden");return},success:function(u){var s="",h=JSON.parse(u),c,f;if(h.Error){n.ADialog.error(h.Error);o("hidden");return}if(i==0){for(f=0;f<ht.length;f++)f==0?s="SELECT Distinct elementtype FROM C_AcctSchema_Element WHERE  c_acctschema_id ="+ht[f]+" AND elementtype NOT IN('AC','SA','X1','X2','X3','X4','X5','X6','X7','X8','X9') ":s+=" AND elementtype IN(SELECT elementtype FROM C_AcctSchema_Element WHERE  c_acctschema_id ="+ht[f]+" AND elementtype NOT IN('AC','SA','X1','X2','X3','X4','X5','X6','X7','X8','X9')) ";s+=" ORDER BY elementtype"}else s="SELECT Distinct elementtype FROM C_AcctSchema_Element WHERE  c_acctschema_id ="+i+" AND elementtype<>'AC' AND elementtype<>'SA' ORDER BY elementtype";for(s=n.MRole.addAccessSQL(s,"C_AcctSchema_Element",n.MRole.SQL_FULLYQUALIFIED,n.MRole.SQL_RW),c=n.DB.executeReader(s),e.empty().append('<option selected="selected" value="0">Please select<\/option>');c.read();)for(f=0;f<h.length;f++)if(h[f].Key==c.getString(0)){e.append(t("<option><\/option>").val(h[f].Key).html(h[f].Value));break}r&&r();o("hidden")}})}function ps(t,r,u){n.ADialog.confirm("DeleteConfirm",!0,"","Confirm",function(f){var e,s,h;f&&(o("visible"),n.DB.executeQuery("delete from c_dimamtline where c_dimamtline_id in("+t+")"),e="select nvl((sum(cd.amount)),0) as Amount from c_dimamtline cd inner join c_dimamtaccttype ct on cd.c_dimamt_id=ct.c_dimamt_id  and cd.c_dimamtaccttype_id=ct.c_dimamtaccttype_id  where cd.c_dimamt_id="+i+" and ct.c_acctSchema_id="+a[0]+"",s=n.DB.executeScalar(e),n.DB.executeQuery("update c_dimamtaccttype set totaldimlineamout="+s+" where c_dimamt_id="+i+" and c_acctSchema_id="+a[0]+""),w2ui[di].select(u),w2ui[di].delete(!0),h=parseFloat(ft.val())-parseFloat(r),ft.val(h),tf(),o("hidden"))})}function ws(r,u,f){o("visible");var c=[];or.css("display","block");e.val()=="AC"||e.val()=="U1"||e.val()=="U2"?at.css({width:"13%","padding-right":"0"}):(y.css("width","33.3%"),at.css("width","33.3%"));et=!0;a=[];s.val()==0?a=ht:a[0]=s.val();t.ajax({dataType:"json",type:"POST",url:n.Application.contextUrl+"AmountDivision/GetDiminsionLine",data:{accountingSchema:JSON.stringify(a),dimensionID:i,DimensionLineID:r[0],pageNo:ut,pSize:hr},success:function(n){if(n){c=JSON.parse(n);h=f;k=r.toString();var t=e.val();DimensionNameVal=c[0].DimensionNameVal;eo=c[0].DimensionNameVal;v.val(c[0].CalculateDimValAmt);ve=c[0].CalculateDimValAmt;e.val()=="AC"||e.val()=="U1"||e.val()=="U2"?(nt.focus(),nt.val(c[0].ElementID),kt.setValue(DimensionNameVal)):t=="AY"?(yt.focus(),yt.val(DimensionNameVal)):t=="BP"?(ei.getControl(0).val(ei.getDisplay()),ei.setValue(DimensionNameVal)):t=="LF"||t=="LT"?(oi.getControl(0).val(oi.getDisplay()),oi.setValue(DimensionNameVal)):t=="MC"?(bt.focus(),bt.val(DimensionNameVal)):t=="OO"||t=="OT"?(vt.focus(),vt.val(DimensionNameVal)):t=="PJ"?(si.getControl(0).val(si.getDisplay()),si.setValue(DimensionNameVal)):t=="PR"?(hi.getControl(0).val(hi.getDisplay()),hi.setValue(DimensionNameVal)):t=="SA"||(t=="SR"?(pt.focus(),pt.val(DimensionNameVal)):t=="U1"||t=="U2"?(nt.val(editArrayData[0].ElementID),kt.getControl(0).val(kt.getDisplay()),kt.setValue(DimensionNameVal)):(t=="X1"||t=="X2"||t=="X3"||t=="X4"||t=="X5"||t=="X6"||t=="X7"||t=="X8"||t=="X9")&&(st.focus(),st.val(DimensionNameVal)));o("hidden")}}})}var li,is;i&&i.toString().indexOf("<")>-1&&(i=0);this.onClose=null;this.onClosing=null;var lr=t("<div style='width:100%;height:100%;position:relative'>"),be=t("<div class='VIS-AMTD-MainContent'>"),ke=t("<div class='vis-apanel-busy' style='height:100%;position:absolute;z-index: 2'>"),bs=t("<table>"),s,e,w,ct,l,rt,wr,gi,rs,rf,uf,ff,br,ef,ft,of,sf,ni,hf,wt,cf,ti,lf,lt,af,ai,de,nr,vf,vi,yf,yi,pf,wf,tt,ii,fi,hr=null,ut=null,ar=null,pi=null,bf=null,g=null,lo=null,it=n.Env.getWindowNo(),h=null,et=null,ao=null,vo=null,kf=null,tr=null,ir=null,rr=null,ur="",ei=null,oi=null,si=null,hi=null,a=null,us=null,p=new n.ChildDialog,df=null,kr=null,dr=null,gr=null,nu=null,tu=null,iu=null,ru=null,uu=null,fu=null,eu=null,ou=null,y=null,yo=null,po=null,wo=null,ht=null,vr=this,ot=null,gf=null,or=null,ne=null,ge=null,te=null,su=null,hu=null,cu=null,lu=null,au=null,vu=null,yu=null,pu=null,wu=null,bu=null,ku=null,at=null,d=null,vt,v,du,gu,ie,no,re,yt,ue,bt,fe,pt,ee,st,oe,wi,to,fr,se,bi,he,ki,ce,le,nt,ri,kt,ae=null,er=null,io=null,ro=null,dt=null,uo=null,fo=null,nf=null,di=null,k=null,ve=null,gt=null,yr=null,ci=null,fs=null,sr=null,cr=null,eo=null,ye=0;var go=function(){g.css({width:"32.3%"});d.css({width:"32.3%"});y.css("width","33.3%");ot.css("width","6%");at.css("width","33.3%");br=t("<label>");ie=t("<label>");var i=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"AD_Org_ID",0,!1,"AD_Org_ID<>0"),r=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"AD_Org_ID",0,!1,"AD_Org_ID<>0"),u=new n.Controls.VComboBox("Org_ID",!1,!1,!0,i,50),f=new n.Controls.VComboBox("Org_ID",!1,!1,!0,r,50);ct=u.getControl();ct.find("option[value=0]").remove();ct.attr("tabindex","4");vt=f.getControl();vt.attr("tabindex","9");br.append(n.Msg.translate(n.Env.getCtx(),"Org_ID"));ie.append(n.Msg.translate(n.Env.getCtx(),"Org_ID"));kr=t("<div class='VIS-AMTD-formData'>");kr.css("width","103%");su=t("<div class='VIS-AMTD-formData'>");su.css("width","100%");kr.append(br).append(ct);g.append(kr);su.append(ie).append(vt);d.append(su);ct.focus();vt.focus()},ss=function(){g.css({width:"32.3%"});d.css({width:"32.3%"});y.css("width","33.3%");ot.css("width","6%");at.css("width","33.3%");sf=t("<label>");re=t("<label>");var i=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_Activity_ID",0,!1,null),r=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_Activity_ID",0,!1,null),u=new n.Controls.VComboBox("C_Activity_ID",!1,!1,!0,i,50),f=new n.Controls.VComboBox("C_Activity_ID",!1,!1,!0,r,50);ni=u.getControl();ni.attr("tabindex","4");yt=f.getControl();yt.attr("tabindex","9");sf.append(n.Msg.translate(n.Env.getCtx(),"C_Activity_ID"));nu=t("<div class='VIS-AMTD-formData'>");nu.css("width","103%");nu.append(sf).append(ni);g.append(nu);ni.focus();re.append(n.Msg.translate(n.Env.getCtx(),"C_Activity_ID"));lu=t("<div class='VIS-AMTD-formData'>");lu.css("width","100%");lu.append(re).append(yt);d.append(lu);yt.focus()},hs=function(){g.css({width:"32.3%"});d.css({width:"32.3%"});y.css("width","32.3%");ot.css("width","6%");at.css("width","32.3%");hf=t("<label>");ue=t("<label>");var i=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_Campaign_ID",0,!1,null),r=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_Campaign_ID",0,!1,null),u=new n.Controls.VComboBox("C_Campaign_ID",!1,!1,!0,i,50),f=new n.Controls.VComboBox("C_Campaign_ID",!1,!1,!0,r,50);wt=u.getControl();wt.attr("tabindex","4");bt=f.getControl();bt.attr("tabindex","9");hf.append(n.Msg.translate(n.Env.getCtx(),"C_Campaign_ID"));ru=t("<div class='VIS-AMTD-formData'>");ru.css("width","103%");ru.append(hf).append(wt);g.append(ru);wt.focus();ue.append(n.Msg.translate(n.Env.getCtx(),"C_Campaign_ID"));yu=t("<div class='VIS-AMTD-formData'>");yu.css("width","100%");yu.append(ue).append(bt);d.append(yu);bt.focus()},cs=function(){var i,r,u,f;g.css({width:"32.3%"});d.css({width:"32.3%"});y.css("width","33.3%");ot.css("width","6%");at.css("width","33.3%");cf=t("<label>");fe=t("<label>");i=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_SalesRegion_ID",0,!1,null);r=new n.Controls.VComboBox("C_SalesRegion_ID",!1,!1,!0,i,50);ti=r.getControl();ti.attr("tabindex","4");cf.append(n.Msg.translate(n.Env.getCtx(),"C_SalesRegion_ID"));eu=t("<div class='VIS-AMTD-formData'>");eu.css("width","103%");eu.append(cf).append(ti);g.append(eu);ti.focus();u=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_SalesRegion_ID",0,!1,null);f=new n.Controls.VComboBox("C_SalesRegion_ID",!1,!1,!0,u,50);pt=f.getControl();pt.attr("tabindex","9");fe.append(n.Msg.translate(n.Env.getCtx(),"C_SalesRegion_ID"));bu=t("<div class='VIS-AMTD-formData'>");bu.css("width","100%");bu.append(fe).append(pt);d.append(bu);pt.focus()},ls=function(){var i,r;lt=t("<select>");st=t("<select>");for(var i="select adt.ad_column_id,adt.columnname,adtab.TableName from c_acctschema_element ac inner join ad_column ad on ac.ad_column_id=ad.ad_column_id  inner join ad_column adt on ad.ad_table_ID=adt.ad_table_ID and adt.isactive='Y'   inner join ad_table adtab on adtab.ad_table_id=ad.ad_table_ID  where ac.c_acctschema_id="+a[0]+" and ac.elementtype='"+e.find("option:selected").val()+"' and adt.isidentifier='Y' order by adt.ad_column_ID",f=n.DB.executeReader(i),u="",o="";f.read();)u=f.getString(2),o+=o==""?f.getString(1):" ||'_'|| "+f.getString(1);if(g.css({width:"32.3%"}),d.css({width:"32.3%"}),y.css("width","33.3%"),ot.css("width","6%"),at.css("width","33.3%"),lf=t("<label>"),lt.empty().append("<option value=-1><\/option>"),st.empty().append("<option value=-1><\/option>"),u!="")for(i="SELECT "+u+"_ID ,("+o+") as Name FROM "+u+" WHERE isactive='Y'",i=n.MRole.addAccessSQL(i,u,n.MRole.SQL_FULLYQUALIFIED,n.MRole.SQL_RW),r=n.DB.executeReader(i);r.read();)lt.append("<option value="+r.getInt(0)+">"+r.getString(1)+"<\/option>"),st.append("<option value="+r.getInt(0)+">"+r.getString(1)+"<\/option>");lt.attr("tabindex","4");lf.append(n.Msg.translate(n.Env.getCtx(),"AD_Column_ID"));ou=t("<div class='VIS-AMTD-formData'>");ou.css("width","103%");ou.append(lf).append(lt);g.append(ou);lt.focus();ee=t("<label>");st.attr("tabindex","9");ee.append(n.Msg.translate(n.Env.getCtx(),"AD_Column_ID"));ku=t("<div class='VIS-AMTD-formData'>");ku.css("width","100%");ku.append(ee).append(st);d.append(ku);st.focus()},as=function(){var i,r;g.css({width:"32.3%"});d.css({width:"32.3%"});y.css("width","33.3%");ot.css("width","6%");at.css("width","33.3%");af=t("<label>");i=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_BPartner_ID",0,!1,null);tr=new n.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,n.DisplayType.Search,i);ai=tr.getControl();ai.attr("tabindex","4");af.append(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));tu=t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>");tu.css("width","100%");tu.append(af).append(ai).append(tr.getBtn(0));g.append(tu);oe=t("<label>");r=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_BPartner_ID",0,!1,null);ei=new n.Controls.VTextBoxButton("C_BPartner_ID",!1,!1,!0,n.DisplayType.Search,r);wi=ei.getControl();wi.attr("tabindex","9");oe.append(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));au=t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>");au.css("width","100%");au.append(oe).append(wi).append(ei.getBtn(0));d.append(au)},ns=function(){var i,r;g.css({width:"32.3%"});d.css({width:"32.3%"});y.css("width","33.3%");ot.css("width","6%");at.css("width","33.3%");de=t("<label>");i=new n.MLocationLookup(n.Env.getCtx(),it);ir=new n.Controls.VLocation("C_Location_ID",!1,!1,!0,n.DisplayType.Location,i);nr=ir.getControl();nr.attr("tabindex","4");de.append(n.Msg.translate(n.Env.getCtx(),"C_Location_ID"));iu=t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>");iu.css("width","100%");iu.append(de).append(nr).append(ir.getBtn(1));g.append(iu);to=t("<label>");r=new n.MLocationLookup(n.Env.getCtx(),it);oi=new n.Controls.VLocation("C_Location_ID",!1,!1,!0,n.DisplayType.Location,r);fr=oi.getControl();fr.attr("tabindex","9");to.append(n.Msg.translate(n.Env.getCtx(),"C_Location_ID"));vu=t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>");vu.css("width","100%");vu.append(to).append(fr).append(oi.getBtn(1));d.append(vu)},vs=function(){var i,r;g.css({width:"32.3%"});d.css({width:"32.3%"});y.css("width","33.3%");ot.css("width","6%");at.css("width","33.3%");vf=t("<label>");i=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_Project_ID",0,!1,null);rr=new n.Controls.VTextBoxButton("C_Project_ID",!1,!1,!0,n.DisplayType.Search,i);vi=rr.getControl();vi.attr("tabindex","4");vf.append(n.Msg.translate(n.Env.getCtx(),"C_Project_ID"));fu=t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>");fu.css("width","100%");fu.append(vf).append(vi).append(rr.getBtn(0));g.append(fu);se=t("<label>");r=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_Project_ID",0,!1,null);si=new n.Controls.VTextBoxButton("C_Project_ID",!1,!1,!0,n.DisplayType.Search,r);bi=si.getControl();bi.attr("tabindex","9");se.append(n.Msg.translate(n.Env.getCtx(),"C_Project_ID"));wu=t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>");wu.css("width","100%");wu.append(se).append(bi).append(si.getBtn(0));d.append(wu)},ys=function(){var i,r;g.css({width:"32.3%"});d.css({width:"32.3%"});y.css("width","33.3%");ot.css("width","6%");at.css("width","33.3%");yf=t("<label>");i=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"M_Product_ID",0,!1,null);ur=new n.Controls.VTextBoxButton("M_Product_ID",!1,!1,!0,n.DisplayType.Search,i);yi=ur.getControl();yi.attr("tabindex","4");yf.append(n.Msg.translate(n.Env.getCtx(),"M_Product_ID"));uu=t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>");uu.css("width","100%");uu.append(yf).append(yi).append(ur.getBtn(0));g.append(uu);he=t("<label>");r=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"M_Product_ID",0,!1,null);hi=new n.Controls.VTextBoxButton("M_Product_ID",!1,!1,!0,n.DisplayType.Search,r);ki=hi.getControl();ki.attr("tabindex","9");he.append(n.Msg.translate(n.Env.getCtx(),"M_Product_ID"));pu=t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>");pu.css("width","100%");pu.append(he).append(ki).append(hi.getBtn(0));d.append(pu)},ts=function(){var i,r,u,f,e,o;g.css({width:"65.7%"});d.css({width:"65.7%","margin-right":"9px"});y.css("width","26.5%");ot.css("width","6%");at.css("width","26.5%");pf=t("<label>");wf=t("<label>");pf.append(n.Msg.translate(n.Env.getCtx(),"C_Element_ID"));wf.append(n.Msg.translate(n.Env.getCtx(),"C_ElementValue_ID"));i=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_Element_ID",0,!1,null);r=new n.Controls.VComboBox("C_Element_ID",!1,!1,!0,i,50);tt=r.getControl();tt.attr("tabindex","4");dr=t("<div class='VIS-AMTD-formData'>");dr.css("width","51%");dr.append(pf).append(tt);g.append(dr);tt.focus();u=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_ElementValue_ID",0,!1);fi=new n.Controls.VTextBoxButton("C_ElementValue_ID",!1,!1,!0,n.DisplayType.Search,u);ii=fi.getControl();ii.attr("tabindex","5");gr=t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>");gr.css("width","49%");gr.append(wf).append(ii).append(fi.getBtn(0));g.append(gr);tt.on("change",function(){var t=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_ElementValue_ID",0,!1,"C_Element_ID="+tt.val());ii.lookup=t});ce=t("<label>");le=t("<label>");ce.append(n.Msg.translate(n.Env.getCtx(),"C_Element_ID"));le.append(n.Msg.translate(n.Env.getCtx(),"C_ElementValue_ID"));f=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_Element_ID",0,!1,null);e=new n.Controls.VComboBox("C_Element_ID",!1,!1,!0,f,50);nt=e.getControl();nt.attr("tabindex","9");hu=t("<div class='VIS-AMTD-formData'>");hu.css("width","51%");hu.append(ce).append(nt);d.append(hu);nt.focus();o=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_ElementValue_ID",0,!1);kt=new n.Controls.VTextBoxButton("C_ElementValue_ID",!1,!1,!0,n.DisplayType.Search,o);ri=kt.getControl();ri.attr("tabindex","10");cu=t("<div class='VIS-AMTD-formData VIS-AMTD-InputBtns'>");cu.css("width","49%");cu.append(le).append(ri).append(kt.getBtn(0));d.append(cu);nt.on("change",function(){var t=n.MLookupFactory.get(n.Env.getCtx(),it,0,n.DisplayType.TableDir,"C_ElementValue_ID",0,!1,"C_Element_ID="+nt.val());ri.lookup=t})};li=function(i){var r=[];r.push({field:"DimensionType",caption:"Dimension Type",size:"30%",min:217});r.push({field:"DimensionName",caption:"Dimension Name",size:"30%",min:217});r.push({field:"DimensionValueAmount",caption:"Dimension Value Amount",size:"30%",min:216});r.push({field:"Edit",caption:"",size:"5%",resizable:!1,render:function(){return'<a href="#" tabindex="8"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/Edit_sub16.png" alt="Edit record" title="Edit record" style="opacity: 1;"><\/div><\/a>'}});r.push({field:"Delete",caption:"",size:"5%",resizable:!1,render:function(){return'<a id="a1" href="#" tabindex="14"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/delete10.png" alt="Delete record" title="Delete record" style="opacity: 1;"><\/div><\/a>'}});r.push({field:"lineAmountID",caption:"lineAmountID",hidden:!0,resizable:!1,min:0,max:0});r.push({field:"CalculateDimValAmt",caption:"CalculateDimValAmt",hidden:!0,resizable:!1,min:0,max:0});ar="gridAmountDivision"+Math.random();ar=ar.replace(".","");di=ar;w2utils.encodeTags([]);pi=t(bf).w2grid({name:ar,recordHeight:20,show:{toolbar:!1,columnHeaders:!0,lineNumbers:!1,selectColumn:!1,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:r,records:i,onClick:function(t){if(t.column==3&&pi.records.length>0){kf=t.recid;var i=pi.get(t.recid).lineAmountID,r=[];i.search(",")==-1?r[0]=i:r=i.split(",");ws(r,pi.get(t.recid).CalculateDimValAmt,t.recid)}t.column==4&&pi.records.length>0&&(rt.html()==n.Msg.getMsg("Update")&&kf==t.recid?n.ADialog.warn("PleaseFirstUpdateThisRecord"):ps(pi.get(t.recid).lineAmountID,pi.get(t.recid).CalculateDimValAmt,t.recid))}})};this.show=function(){is();p.getRoot().css("padding-right","5px");o("visible");os(r,function(){ui(ht,!0,function(n){li(n);a[0]=s.val();tf();i==0||n.length==0?(y.css("display","none"),rt.css("display","none"),p.getRoot().parent().css("height","390px")):(y.css("display","block"),rt.css("display","block"),gt.html()==""?p.getRoot().parent().css("height","448px"):p.getRoot().parent().css("height","469px"));o("hidden")})})};es();is=function(){p.setContent(lr);p.setHeight(535);p.setWidth(750);p.setTitle(n.Msg.getMsg("AmountDimension"));p.setModal(!0);p.setEnableResize(!1);p.show();p.hideButtons();p.onClose=function(){vr.onClosing(i);vr.onClose&&vr.onClose()}}}n.AmountDivision=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s){function ei(){y.css("width","100%");y.css("height","100%");y.css("position","relative");tt.css("width","98%");tt.css("height","97%");tt.css("position","absolute");n.Application.isRTL?(lt=t("<div style='background-color: rgb(241, 241, 241);height:88.9%;display: inline-block;width:23%;height:87.8%;overflow:auto;padding-right: 10px;margin-left: 10px;'>"),ot=t("<div style='background-color: rgb(241, 241, 241);display: inline-block;height:87.8%;'>"),lt.append(ot),at=t("<div style='display: inline-block;width:75%;height:87.8%;overflow:auto;'>"),it=t("<div style='display: inline-block;width:99%;height:auto;margin-top: 2px;'>")):(lt=t("<div style='background-color: rgb(241, 241, 241);padding-left: 7px;height:88.9%;display: inline-block; float: left;width:23%;height:87.8%;overflow:auto;'>"),ot=t("<div style='background-color: rgb(241, 241, 241);'>"),lt.append(ot),at=t("<div style='display: inline-block; float: left;width:75%;height:87.8%;margin-left:10px;'>"),it=t("<div style='display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;'>"));tt.append(lt);tt.append(at);tt.append(it);pt=n.Msg.getMsg("Refresh");pt.indexOf("&")>-1&&(pt=pt.replace("&",""));st=n.Msg.getMsg("Cancel");st.indexOf("&")>-1&&(st=st.replace("&",""));ht=n.Msg.getMsg("Ok");ht.indexOf("&")>-1&&(ht=ht.replace("&",""));w=t("<div style='float:right;'>");n.Application.isRTL?(rt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(st),ut=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(ht)):(rt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(st),ut=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(ht));w.append(rt);w.append(ut);it.append(w);vt=t("<div style='float:left;'>");yt=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png'>"));bt=t("<div>");ai();bt.append(kt);n.Application.isRTL?(vt.append(rt),vt.append(ut),w.append(yt)):(w.append(rt),w.append(ut),vt.append(yt));it.append(w);it.append(bt);it.append(vt);c=t("<div class='vis-apanel-busy'>");c.css("width","98%");c.css("height","97%");c.css("text-align","center");c.css("position","absolute");c[0].style.visibility="visible";y.append(tt);y.append(c)}function oi(){if(!n.Application.isMobile)y.on("keyup",function(t){t.keyCode===13&&(c[0].style.visibility="visible",s!=null&&s.length>0&&(s=n.Env.parseContext(n.Env.getCtx(),r,s,!1,!1)),et(!0,a.val()))});rt.on("click",function(){ct.onClose!=null&&ct.onClose();wt()});ut.on("click",function(){gt()});yt.on("click",function(){c[0].style.visibility="visible";s!=null&&s!=undefined&&s.length>0&&(s=n.Env.parseContext(n.Env.getCtx(),r,s,!1,!1));et(!0,a.val())})}function si(){ct.onClose!=null&&ct.onClose();wt()}function li(n){var i,t;if(o)if(n.index)t=w2ui[n.target].records[n.index][keyCol],l.indexOf(t)>-1&&l.splice(l.indexOf(t),1);else for(i=0;i<w2ui[n.target].records.length;i++)t=w2ui[n.target].records[i][keyCol],l.indexOf(t)>-1&&l.splice(l.indexOf(t),1)}function ai(){kt=t('<ul style="float:right;margin-top:10px" class="vis-statusbar-ul">');k=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageFirst16.png" alt="First Page" title="'+n.Msg.getMsg("FirstPage")+'" style="opacity: 0.6;"><\/div><\/li>');d=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageUp16.png" alt="Page Up" title="'+n.Msg.getMsg("PageUp")+'" style="opacity: 0.6;"><\/div><\/li>');a=t("<select>");dt=t("<li>").append(a);g=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageDown16.png" alt="Page Down" title="'+n.Msg.getMsg("PageDown")+'" style="opacity: 0.6;"><\/div><\/li>');nt=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageLast16.png" alt="Last Page" title="'+n.Msg.getMsg("LastPage")+'" style="opacity: 0.6;"><\/div><\/li>');kt.append(k).append(d).append(dt).append(g).append(nt);vi()}function vi(){k.on("click",function(){t(this).css("opacity")=="1"&&et(!0,1)});d.on("click",function(){t(this).css("opacity")=="1"&&et(!0,parseInt(a.val())-1)});g.on("click",function(){t(this).css("opacity")=="1"&&et(!0,parseInt(a.val())+1)});nt.on("click",function(){t(this).css("opacity")=="1"&&et(!0,parseInt(a.find("Option:last").val()))});a.on("change",function(){et(!0,a.val())})}function yi(n){if(a.empty(),n.TotalPage>0){for(var i=0;i<n.TotalPage;i++)a.append(t("<option value="+(i+1)+">"+(i+1)+"<\/option>"));a.val(n.CurrentPage);n.TotalPage>n.CurrentPage?(g.css("opacity","1"),nt.css("opacity","1")):(g.css("opacity","0.6"),nt.css("opacity","0.6"));n.CurrentPage>1?(k.css("opacity","1"),d.css("opacity","1")):(k.css("opacity","0.6"),d.css("opacity","0.6"));n.TotalPage==1&&(k.css("opacity","0.6"),d.css("opacity","0.6"),g.css("opacity","0.6"),nt.css("opacity","0.6"))}else k.css("opacity","0.6"),d.css("opacity","0.6"),g.css("opacity","0.6"),nt.css("opacity","0.6")}var gt,ni,wt;this.onClose=null;var y=t("<div>"),ti=!0,tt=t("<div>"),ii=null,ri=null,ui=null,lt=null,ot=null,at=null,it=null,pt=null,st=null,ht=null,w=null,rt=null,ut=null,vt=null,yt=null,c=null,p=null,b=[],h=null,ft=null,ct=this;this.keyCol="";var l=[],fi=null,v=null,bt,kt,k,d,dt,g,nt,a;ei();oi();gt=function(){var n=w2ui[v].getSelection();for(item in n)l.indexOf(w2ui[v].get(n[item])[keyCol])==-1&&l.push(w2ui[v].get(n[item])[keyCol]);ct.onClose!=null&&l.length>0&&ct.onClose();wt()};this.show=function(){t.ajax({url:n.Application.contextUrl+"InfoGeneral/GetSearchColumns",dataType:"json",data:{tableName:f,ad_Language:n.context.getAD_Language(),isBaseLangage:n.Env.isBaseLanguage(n.context)},error:function(){n.ADialog.error("ERRORGettingSearchCols");c[0].style.visibility="hidden"},success:function(t){if(p=t.result,p==null){n.ADialog.error("ERRORGettingSearchCols");c[0].style.visibility="hidden";return}hi()}})};var hi=function(){var i,r,k,e,d,l,v,w;if(h=n.dataContext.getJSONData(n.Application.contextUrl+"InfoGeneral/GetDispalyColumns",{AD_Table_ID:p[0].AD_Table_ID,AD_Language:n.context.getAD_Language(),IsBaseLangage:n.Env.isBaseLanguage(n.context),TableName:f}).result,h==null){alert(n.Msg.getMsg("ERRORGettingDisplayCols"));c[0].style.visibility="hidden";return}var g=null,o=null,s=t("<table>");s.css("width","100%");i=null;for(r in p)i=t("<tr>"),s.append(i),k=t("<td>"),g=new n.Controls.VLabel(p[r].Name,p[r].ColumnName),k.append(g.getControl().css("margin-bottom","0px").css("margin-top","5px").css("font-weight","inherit")),i.append(k),i=t("<tr>"),s.append(i),e={},o=new n.Controls.VTextBox(p[r].ColumnName,!1,!1,!0,50,100,null,null,!1),e.Ctrl=o,e.AD_Reference_ID=10,e.ColumnName=p[r].ColumnName,e.IsTranslated=p[r].IsTranslated,p[r].IsIdentifier&&o.setValue(u),d=t("<td>"),i.append(d),d.append(o.getControl().css("width","97%").css("font-weight","inherit")),b.push(e);ot.append(s);l=n.Msg.getMsg("Refresh");l.indexOf("&")>-1&&(l=l.replace("&",""));v=n.Msg.getMsg("Cancel");v.indexOf("&")>-1&&(v=v.replace("&",""));w=n.Msg.getMsg("Ok");w.indexOf("&")>-1&&(w=w.replace("&",""));y.dialog({width:1020,height:500,resizable:!1,modal:!0,close:si,closeText:n.Msg.getMsg("close")});et(!1,a.val())},et=function(i,r){var w,u,d,nt,y;if(o&&w2ui[v]){w=w2ui[v].getSelection();for(u in w)l.indexOf(w2ui[v].get(w[u])[keyCol])==-1&&l.push(w2ui[v].get(w[u])[keyCol])}ni();var e="SELECT ",g=0,it=t.makeArray(h).length,k=!1;for(u in h){if(g=h[u].AD_Reference_ID,g==n.DisplayType.YesNo)e+=" ( CASE "+f+"."+h[u].ColumnName+" WHEN 'Y' THEN  'True' ELSE 'False'  END ) AS "+h[u].ColumnName;else if(g==n.DisplayType.List){d=h[u].RefList;e+=" CASE ";for(nt in d)e+=" WHEN "+f+"."+h[u].ColumnName+"='"+d[nt].Key+"' THEN '"+d[nt].Value.replace("'","''")+"'";e+=" END AS "+h[u].ColumnName}else n.Env.isBaseLanguage(n.context)?e+=f+"."+h[u].ColumnName+" ":h[u].trlTableExist?h[u].IsTranslated?(e+="trlTable."+h[u].ColumnName+" ",k=!0):e+=f+"."+h[u].ColumnName+" ":e+=f+"."+h[u].ColumnName+" ";h[u].IsKey&&(keyCol=h[u].ColumnName.toUpperCase());it-1==u||(e+=", ")}if(e+=" FROM "+f+" "+f,k&&(e+=" Inner join "+f+"_Trl trlTable on ("+f+"."+f+"_ID=trlTable."+f+"_ID  AND trlTable.AD_Language='"+n.context.getAD_Language()+"')"),i==!0){var p=" ",a=null,tt=!1;for(y=0;y<b.length;y++)(a=b[y].Ctrl.getValue(),a!=null&&a.length!=0&&a!=0)&&(tt==!0&&(p+=" AND "),a=String(a).indexOf("%")==0?String(a).replace("%","●"):"●"+a,String(a).lastIndexOf("●")==String(a).length||(a=a+"●"),n.Env.isBaseLanguage(n.context)?p+="  UPPER("+f+"."+b[y].ColumnName+") LIKE '"+a.toUpperCase()+"' ":k?b[y].IsTranslated?(p+="  UPPER(trlTable."+b[y].ColumnName+") LIKE '"+a.toUpperCase()+"' ",k=!0):p+="  UPPER("+f+"."+b[y].ColumnName+") LIKE '"+a.toUpperCase()+"' ":p+="  UPPER("+f+"."+b[y].ColumnName+") LIKE '"+a.toUpperCase()+"' ",tt=!0);p.length>1?(e+=" WHERE "+p,s!=null&&s.length>0&&(e+=" AND "+s)):s!=null&&s.length>0&&(e+=" WHERE "+s)}else e+=s.length>0&&s.trim().toUpperCase().startsWith("WHERE")?" "+s+" AND "+f+"_ID=-1":s.length>0?" WHERE "+f+"."+f+"_ID=-1 AND "+s:" WHERE "+f+"."+f+"_ID=-1";r||(r=1);t.ajax({url:n.Application.contextUrl+"InfoGeneral/GetData",dataType:"json",type:"POST",data:{sql:e,tableName:f,pageNo:r},error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));c[0].style.visibility="hidden";return},success:function(t){var i=JSON.parse(t);if(i==null){c[0].style.visibility="hidden";return}if(i.Error){n.ADialog.error(i.Error);c[0].style.visibility="hidden";return}yi(i.pSetting);ci(i.data)}})},ci=function(i){var r,e,s,u;if(i==null){alert(n.Msg.getMsg("NoDataFound"));c[0].style.visibility="hidden";return}var a=[],y=[],f=null;for(u in i)r={resizable:!0},f=h[u].AD_Reference_ID,r.caption=h[u].Name,r.field=h[u].ColumnName.toUpperCase(),r.columnName=h[u].ColumnName.toUpperCase(),r.sortable=!0,r.hidden=!h[u].IsDisplayed,r.size="100px",n.DisplayType.IsNumeric(f)?r.render=f==n.DisplayType.Integer?"int":f==n.DisplayType.Amount?"number:2":"number:1":n.DisplayType.IsDate(f)?r.render=function(n,t,i){var r=n[a[i].field];return r?Globalize.format(new Date(r),"d"):""}:f==n.DisplayType.Location||f==n.DisplayType.Locator?r.render="int":f==n.DisplayType.Account?r.render="int":f==n.DisplayType.PAttribute?r.render="int":f==n.DisplayType.Button?r.render=function(){return"<div>button<\/div>"}:f==n.DisplayType.Image?r.render=function(){return"<div>Image<\/div>"}:n.DisplayType.IsLOB(f)&&(r.render=function(){return"<div>[Lob-blob]<\/div>"}),a[u]=r;for(e=0;e<i[0].RowCount;e++){s={};for(u in i)s[i[u].ColumnName.toUpperCase()]=i[u].Values[e];s.recid=e+1;y[e]=s}if(v="gridGenInfodata"+Math.random(),v=v.replace(".",""),w2utils.encodeTags(y),ft=t(at).w2grid({name:v,recordHeight:40,show:{toolbar:!0,columnHeaders:!0,lineNumbers:!0,selectColumn:!0,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:a,records:y,multiSelect:o,onUnselect:li}),o)for(itm in l)for(u in w2ui[v].records)w2ui[v].records[u][keyCol]==l[itm]&&w2ui[v].select(parseInt(u)+1);c[0].style.visibility="hidden"};ni=function(){ft!=null&&ft.destroy();ft=null};this.getSelectedValues=function(){return l};wt=function(){y.off("keyup");rt.off("click");ut.off("click");yt.off("click");k.off("click");d.off("click");g.off("click");nt.off("click");a.off("change");at=null;ot=null;ft!=null&&ft.destroy();ft=null;ti=null;tt=null;ii=null;ri=null;ui=null;lt=null;ot=null;at=null;it=null;pt=null;st=null;ht=null;w=null;rt=null;ut=null;vt=null;yt=null;c=null;p=null;b=null;h=null;ft=null;ct=null;keyCol=null;l=null;fi=null;k=d=g=nt=a=null;y!=null&&(y.dialog("destroy"),y.remove());y=null;this.btnOKClick=null;this.displaySearchCol=null;this.displayData=null;this.loadData=null;this.disposeComponent=null;this.disposeDataSec=null;this.getSelectedValues=null}}n.infoGeneral=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s,h,c){function af(){var u,r,i;uu=[];uu.push({field:"WareHouse",caption:n.Msg.getMsg("Warehouse"),size:"150px"},{field:"Variant",caption:n.Msg.getMsg("Variant"),size:"150px"},{field:"Quantity",caption:n.Msg.getMsg("Quantity"),size:"100px",editable:{type:"float"},render:"number:1"},{field:"Available",caption:n.Msg.getElement(n.Env.getCtx(),"QtyAvailable"),size:"100px"},{field:"OnHand",caption:n.Msg.getElement(n.Env.getCtx(),"QtyOnHand"),size:"100px"},{field:"Reserved",caption:n.Msg.getElement(n.Env.getCtx(),"QtyReserved"),size:"100px"},{field:"Ordered",caption:n.Msg.getElement(n.Env.getCtx(),"QtyOrdered"),size:"100px"},{field:"M_Warehouse_ID",caption:"WareHouse ID",size:"150px",hidden:!0},{field:"M_AttributeSetInstance_ID",caption:"M_AttributeSetInstance_ID",size:"150px",hidden:!0},{field:"M_Product_ID",caption:"M_Product_ID",size:"150px",hidden:!0},{field:"ParentRec_ID",caption:"Parent recid",size:"150px",hidden:!0});ft.css("width","100%");ft.css("height","100%");ft.css("position","relative");dt.css("width","98%");dt.css("height","97%");dt.css("position","absolute");d.css("width","100%");n.Application.isRTL?(gt=t("<div style='background-color: rgb(241, 241, 241);display: inline-block; float:right;width:23%;height:87.8%;overflow:auto;padding-right: 7px;margin-left: 10px;'>"),ri=t("<div style='background-color: rgb(241, 241, 241);'>"),gt.append(ri),ui=t("<div style='display: inline-block;width:75%;height:87.8%;overflow:auto;'>"),fi=t("<div style='display: inline-block;float: right;width:99%;height:auto;margin-top: 2px;'>")):(gt=t("<div style='background-color: rgb(241, 241, 241);display: inline-block; float: left;width:23%;height:87.8%;overflow:auto;padding-left: 7px;'>"),ri=t("<div style='background-color: rgb(241, 241, 241);'>"),gt.append(ri),ui=t("<div style='display: inline-block; float: left;width:75%;height:87.8%;margin-left:10px;'>"),fi=t("<div style='display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;'>"));dt.append(gt);dt.append(ui);dt.append(fi);rr=n.Msg.getMsg("Value");rr.indexOf("&")>-1&&(rr=rr.replace("&",""));ur=n.Msg.getMsg("Name");ur.indexOf("&")>-1&&(ur=ur.replace("&",""));fr=n.Msg.getMsg("UPC");fr.indexOf("&")>-1&&(fr=fr.replace("&",""));er=n.Msg.getMsg("SKU");er.indexOf("&")>-1&&(er=er.replace("&",""));or=n.Msg.getMsg("Warehouse");or.indexOf("&")>-1&&(or=or.replace("&",""));sr=n.Msg.getMsg("PriceListVersion");sr.indexOf("&")>-1&&(sr=sr.replace("&",""));tr=n.Msg.getMsg("Refresh");tr.indexOf("&")>-1&&(tr=tr.replace("&",""));pr=n.Msg.getMsg("AddCatalog");pr.indexOf("&")>-1&&(pr=pr.replace("&",""));wr=n.Msg.getMsg("ShowSaved");wr.indexOf("&")>-1&&(wr=wr.replace("&",""));kr=n.Msg.getMsg("ShowCart");kr.indexOf("&")>-1&&(kr=kr.replace("&",""));br=n.Msg.getMsg("ShowScan");br.indexOf("&")>-1&&(br=br.replace("&",""));ei=n.Msg.getMsg("Cancel");ei.indexOf("&")>-1&&(ei=ei.replace("&",""));oi=n.Msg.getMsg("Ok");oi.indexOf("&")>-1&&(oi=oi.replace("&",""));hr=n.Msg.getElement(n.Env.getCtx(),"M_AttributeSet_ID");hr.indexOf("&")>-1&&(hr=hr.replace("&",""));cr=n.Msg.getElement(n.Env.getCtx(),"M_AttributeSetInstance_ID");cr.indexOf("&")>-1&&(cr=cr.replace("&",""));lr=n.Msg.getMsg("AttrCode");lr.indexOf("&")>-1&&(lr=lr.replace("&",""));a=t("<tr>");d.append(a);r=t("<td>");tt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(rr);r.append(tt);a.append(r);a=t("<tr>");d.append(a);i={};ut=new n.Controls.VTextBox("Value",!1,!1,!0,50,100,null,null,!1);i.Ctrl=ut;i.AD_Reference_ID=10;i.ColumnName="Value";u=t("<td>");a.append(u);u.append(ut.getControl().css("width","97%").css("font-weight","inherit"));k.push(i);a=t("<tr>");d.append(a);r=t("<td>");tt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(ur);r.append(tt);a.append(r);a=t("<tr>");d.append(a);i={};ut=new n.Controls.VTextBox("Name",!1,!1,!0,50,100,null,null,!1);i.Ctrl=ut;i.AD_Reference_ID=10;i.ColumnName="Name";ut.setValue(e);u=t("<td>");a.append(u);u.append(ut.getControl().css("width","97%").css("font-weight","inherit"));k.push(i);a=t("<tr>");d.append(a);r=t("<td>");tt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(fr);r.append(tt);a.append(r);a=t("<tr>");d.append(a);i={};ut=new n.Controls.VTextBox("UPC",!1,!1,!0,50,100,null,null,!1);i.Ctrl=ut;i.AD_Reference_ID=10;i.ColumnName="UPC";u=t("<td>");a.append(u);u.append(ut.getControl().css("width","97%").css("font-weight","inherit"));k.push(i);a=t("<tr>");d.append(a);r=t("<td>");tt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(er);r.append(tt);a.append(r);a=t("<tr>");d.append(a);i={};ut=new n.Controls.VTextBox("SKU",!1,!1,!0,50,100,null,null,!1);i.Ctrl=ut;i.AD_Reference_ID=10;i.ColumnName="SKU";u=t("<td>");a.append(u);u.append(ut.getControl().css("width","97%").css("font-weight","inherit"));k.push(i);a=t("<tr>");d.append(a);r=t("<td>");tt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(or);r.append(tt);a.append(r);a=t("<tr>");d.append(a);i={};wi=new n.Controls.VComboBox("M_Warehouse_ID",!1,!1,!0,null,50);i.Ctrl=wi;i.AD_Reference_ID=n.DisplayType.tableDir;i.ColumnName="M_Warehouse_ID";u=t("<td>");a.append(u);u.append(wi.getControl().css("width","97%").css("font-weight","inherit"));k.push(i);a=t("<tr>");d.append(a);r=t("<td>");tt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(sr);r.append(tt);a.append(r);a=t("<tr>");d.append(a);i={};bi=new n.Controls.VComboBox("M_PriceList_Version_ID",!1,!1,!0,null,50);i.Ctrl=bi;i.AD_Reference_ID=n.DisplayType.tableDir;i.ColumnName="M_PriceList_Version_ID";u=t("<td>");a.append(u);u.append(bi.getControl().css("width","97%").css("font-weight","inherit"));k.push(i);a=t("<tr>");d.append(a);r=t("<td>");tt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(lr);r.append(tt);a.append(r);a=t("<tr>");d.append(a);i={};ut=new n.Controls.VTextBox("AttributeCode",!1,!1,!0,50,100,null,null,!1);i.Ctrl=ut;i.AD_Reference_ID=10;i.ColumnName="AttributeCode";u=t("<td>");a.append(u);u.append(ut.getControl().css("width","97%").css("font-weight","inherit"));k.push(i);a=t("<tr>");d.append(a);r=t("<td>");tt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(hr);r.append(tt);a.append(r);a=t("<tr>");d.append(a);i={};ai=new n.Controls.VComboBox("M_AttributeSet_ID",!1,!1,!0,null,50);i.Ctrl=ai;i.AD_Reference_ID=n.DisplayType.tableDir;i.ColumnName="M_AttributeSet_ID";u=t("<td>");a.append(u);u.append(ai.getControl().css("width","97%").css("font-weight","inherit"));k.push(i);a=t("<tr>");d.append(a);r=t("<td>");tt=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(cr);r.append(tt);a.append(r);a=t("<tr>");d.append(a);i={};ku();ri.append(d);ni=t("<div style='float:right;'>");n.Application.isRTL?(ti=t("<div style='float:left;'>"),hi=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(ei),ci=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(oi),it=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px;display:block;'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/addToCart.png'>")),at=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/list.png'>")),yi=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-left:5px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/scan.png'>")),si=t("<button class='VIS_Pref_btn-2'style='margin-top: 5px;margin-bottom: -10px;margin-left:5px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/opencart.png'>"))):(ti=t("<div style='float:right;'>"),hi=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(ei),ci=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(oi),it=t("<button class='VIS_Pref_btn-2' style='margin-right:5px;margin-top: 5px;margin-bottom: -10px;display:block;'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/addToCart.png'>")),at=t("<button class='VIS_Pref_btn-2' disabled style='margin-right:5px;margin-top: 5px;margin-bottom: -10px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/list.png'>")),yi=t("<button class='VIS_Pref_btn-2' style='margin-right:5px;margin-top: 5px;margin-bottom: -10px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/scan.png'>")),si=t("<button class='VIS_Pref_btn-2' style='margin-right:5px;margin-top: 5px;margin-bottom: -10px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/opencart.png'>")));ii=t("<div style='float:left;'>");pi=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png'>"));su=t("<div>");le();su.append(hu);n.Application.isRTL?(ii.append(hi),ii.append(ci),ii.append(at),ii.append(it),ti.append(yi),ti.append(si),gt.append(ti),ni.append(pi)):(ni.append(hi),ni.append(ci),ni.append(at),ni.append(it),ti.append(yi),ti.append(si),gt.append(ti),ii.append(pi));fi.append(ni);fi.append(su);fi.append(ii);y=t("<div class='vis-apanel-busy'>");y.css("width","98%");y.css("height","97%");y.css("text-align","center");y.css("position","absolute");y[0].style.visibility="visible";ft.append(dt);ft.append(y)}function ku(){var i={},f,u;a.empty();f=" M_AttributeSetInstance_ID IN (SELECT  asi.M_AttributeSetInstance_ID as M_AttributeSetInstance_ID   FROM M_AttributeSetInstance asi   WHERE asi.IsActive='Y' AND asi.M_ATTRIBUTESET_ID="+ai.ctrl.val()+")";ru=n.MLookupFactory.get(n.Env.getCtx(),r,8472,n.DisplayType.Search,"M_AttributeSetInstance_ID",0,!1,f);st=new n.Controls.VTextBoxButton("M_AttributeSetInstance_ID",!1,!1,!0,n.DisplayType.Search,ru);st.getControl().css("width","60%");st.getBtn(0).css("height","26px");st.getBtn(0).css("margin-top","-1px");st.getBtn(0).css("width","18%");st.getBtn(1).css("height","26px");st.getBtn(1).css("margin-top","-1px");st.getBtn(1).css("width","18%");i.Ctrl=st;i.AD_Reference_ID=n.DisplayType.Search;i.ColumnName="M_AttributeSetInstance_ID";u=t("<td>");a.append(u);u.append(st.getControl()).append(st.getBtn(0)).append(st.getBtn(1));k.push(i)}function vf(){if(!n.Application.isMobile)ft.on("keyup",function(t){if(t.keyCode===13&&(y[0].style.visibility="visible",c!=null&&c.length>0&&(g=n.Env.parseContext(n.Env.getCtx(),r,c,!1,!1)),lt(!0,nt.val()),w.length>0)){for(var i=0;i<w.length;i++)w2ui["subgrid-"+w[i]].destroy();w=[]}});yi.on("click",function(){re()});si.on("click",function(){ie()});it.on("click",function(){ue()});at.on("click",function(){y[0].style.visibility="visible";cu()});hi.on("click",function(){vt.onClose!=null&&vt.onClose();iu()});ci.on("click",function(){gu()});pi.on("click",function(){if(g=null,h&&!ht&&it.show(),p.length==0&&at.prop("disabled",!0),v=[],y[0].style.visibility="visible",c!=null&&c!=undefined&&c.length>0&&(g=n.Env.parseContext(n.Env.getCtx(),r,c,!1,!1)),lt(!0,1),w.length>0){for(var t=0;t<w.length;t++)w2ui["subgrid-"+w[t]].destroy();w=[]}});ai.ctrl.change(function(){st=null;ru=null;for(var n=0;n<k.length;n++)k[n].Ctrl.colName=="M_AttributeSetInstance_ID"&&k.splice(n);ku()})}function yf(i,u){ou=new n.MPAttributeLookup(n.context,r);wu=new n.Controls.VPAttribute("M_AttributeSetInstance_ID",!1,!1,!0,n.DisplayType.PAttribute,ou,r,!1,!1,!1,!0);wi.ctrl.append(t('<Option value="0"><\/option>'));bi.ctrl.append(t('<Option value="0"><\/option>'));ai.ctrl.append(t('<Option value="0"><\/option>'));vu=jQuery.parseJSON(vu);yu=jQuery.parseJSON(yu);u==0&&(u=bf());fu=te(n.Env.getCtx(),r,u);pf()}function pf(){try{n.dataContext.getJSONData(n.Application.contextUrl+"InfoProduct/GetWarehouse","",wf)}catch(t){console.log(t);y[0].style.visibility="hidden"}}function wf(t){var i,e,r;if(t.length>0)for(r in t)i=n.Utility.Util.getValueOfInt(t[r].M_Warehouse_ID),e=n.Utility.Util.getValueOfString(t[r].Name),wi.getControl().append(" <option value="+i+">"+e+"<\/option>"),i==u&&wi.ctrl.val(u);kf(f)}function bf(){var i=0,t;try{t=n.dataContext.getJSONData(n.Application.contextUrl+"InfoProduct/GetDefaultPriceList",null,null);t!=null&&(i=t)}catch(r){console.log(r);y[0].style.visibility="hidden"}return i}function kf(t){try{n.dataContext.getJSONData(n.Application.contextUrl+"InfoProduct/GetPriceList",{PriceList:t},df)}catch(i){console.log(i);y[0].style.visibility="hidden"}}function df(t){var i,u,r;if(t.length>0)for(r in t)i=n.Utility.Util.getValueOfInt(t[r].M_PriceList_Version_ID),u=n.Utility.Util.getValueOfString(t[r].Name),bi.getControl().append(" <option value="+i+">"+u+"<\/option>"),i==fu&&bi.ctrl.val(fu);gf()}function gf(){try{n.dataContext.getJSONData(n.Application.contextUrl+"InfoProduct/GetAttributeSet",null,ne)}catch(t){console.log(t);y[0].style.visibility="hidden"}}function ne(t){var r,u,i;if(t.length>0)for(i in t)r=n.Utility.Util.getValueOfInt(t[i].M_AttributeSet_ID),u=n.Utility.Util.getValueOfString(t[i].Name),ai.getControl().append(" <option value="+r+">"+u+"<\/option>")}function te(t,i,u){var e=null,s=0,o=t.getContext(i,"DateOrdered"),c,f,h,l,a;o!=null&&o.Length>0?e=System.Convert.ToDateTime(n.Env.parseContext(n.Env.getCtx(),r,"DateOrdered",!1,!1)):(o=t.getContext(i,"DateInvoiced"),o!=null&&o.Length>0&&(e=System.Convert.ToDateTime(n.Env.parseContext(n.Env.getCtx(),r,"DateInvoiced",!1,!1))));e==null&&(c=new Date,e=n.Utility.Util.getValueOfDate(c));try{if(f=n.dataContext.getJSONData(n.Application.contextUrl+"InfoProduct/GetPriceListVersion",{PriceList:u},null),f.length>0){for(h in f)l=n.Utility.Util.getValueOfInt(f[h].M_PriceList_Version_ID),a=n.Utility.Util.getValueOfString(f[h].ValidFrom),e>a&&(s=l);s==0&&(s=n.Utility.Util.getValueOfInt(f[0].M_PriceList_Version_ID))}}catch(v){console.log(v);y[0].style.visibility="hidden"}return s}function ie(){vi=!1;ki=0;var t=new n.InfoScanForm(r,!0);t.showDialog();t.onClose=function(t,i,u){y[0].style.visibility="visible";window.setTimeout(function(){var l,f,h,w,c,b;if(vi=i,ki=u,l=n.Env.getCtx().getContext("#AD_Session_ID"),t&&t.length>0)for(f in t){var a="",v="",e=0,o=0,s=t[f].VAICNT_Quantity,y=t[f].M_Product_ID,k=t[f].Value;e=t[f].M_AttributeSetInstance_ID;h=t[f].Description;w=t[f].VAICNT_InventoryCountLine_ID;a=t[f].Name;v=t[f].UOM;o=t[f].C_UOM_ID;c=t[f].LineID;s>0&&(p.length>0?(b=p.map(function(n){return n._prdID==y&&n._Attribute==e&&n._uom==o&&n._refLineID==c}).indexOf(!0),b>-1?p[b]._prodQty+=s:p.push({_prodQty:s,_prdID:y,_prdName:a,_value:k,_uom:o,_uomName:v,_AD_Session_ID:l,_windowNo:r,_RefNo:"",_Attribute:e,_AttributeName:h,_Locator_ID:0,_IsLotSerial:"N",_countID:w,_refLineID:c})):p.push({_prodQty:s,_prdID:y,_prdName:a,_value:k,_uom:o,_uomName:v,_AD_Session_ID:l,_windowNo:r,_RefNo:"",_Attribute:e,_AttributeName:h,_Locator_ID:0,_IsLotSerial:"N",_countID:w,_refLineID:c}),dr[e]=h)}cu()},200)}}function lu(){var f,i,u;for(ot=null,f=[],i=0;i<b.length;i++)u={},u.Product=b[i].Product,u.Value=b[i].Value,u.QtyEntered=b[i].QtyEntered,u.UOM=b[i].UOM,u.Attribute=b[i].Attribute,u.ProdID=b[i].M_Product_ID1,u.recid=i+1,f[i]=u;l="gridsavedprd"+Math.random();l=l.replace(".","");w2utils.encodeTags(f);ot=t(ui).w2grid({name:l,recordHeight:40,show:{toolbar:!0,columnHeaders:!0,lineNumbers:!0,selectColumn:!0,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:[{field:"Value",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"Value")+"<\/span><\/div>",sortable:!1,size:"120px",min:100,hidden:!1},{field:"Product",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"Product")+"<\/span><\/div>",sortable:!1,size:"20%",min:150,hidden:!1},{field:"QtyEntered",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"QtyEntered")+"<\/span><\/div>",sortable:!1,size:"70px",min:60,hidden:!1,editable:{type:"float"},render:"number:1"},{field:"UOM",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"UOM")+"<\/span><\/div>",sortable:!1,size:"70px",min:60,hidden:!1},{field:"Attribute",caption:n.Msg.translate(n.Env.getCtx(),"Attribute"),sortable:!1,size:"20%",min:150,hidden:!1,editable:{type:"custom",ctrl:wu,showAll:!0},render:function(n){var r=ou,t=n.Attribute,i=dr[t];return!i&&t>0&&(i=r.getDisplay(t,!0),dr[t]=i),i}},{field:"Delete",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"DeleteActivity")+"<\/span><\/div>",sortable:!1,size:"60px",min:40,hidden:!1,render:function(){return'<div style="text-align: center;"><img src="'+n.Application.contextUrl+'Areas/VIS/Images/delete-ico-hover.png" alt="Delete record" title="Delete record" style="opacity: 1;"><\/div>'}},{field:"Copy",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"Copy")+"<\/span><\/div>",sortable:!1,size:"60px",min:40,hidden:!1,render:function(){return'<div style="text-align: center;"><img src="'+n.Application.contextUrl+'Areas/VIS/Images/add-edit.png" alt="Copy record" title="Copy record" style="opacity: 1;"><\/div>'}},{field:"ProdID",caption:'<div style="text-align: center;" ><span>'+n.Msg.translate(n.Env.getCtx(),"ProdID")+"<\/span><\/div>",sortable:!1,size:"20%",min:150,hidden:!0}],records:f,onChange:function(n){n.column==2?(w2ui[l].records[n.index].QtyEntered=n.value_new,p[n.index]._prodQty=n.value_new,b[n.index].QtyEntered=n.value_new):n.column==4&&(w2ui[l].records[n.index].Attribute=n.value_new,p[n.index]._Attribute=n.value_new,b[n.index].Attribute=n.value_new)},onClick:function(t){t.column==5&&ot.records.length>0?(y[0].style.visibility="visible",p.splice(t.recid-1,1),b.splice(t.recid-1,1),lu()):t.column==6&&ot.records.length>0?(y[0].style.visibility="visible",b.push({SrNo:b.length,Product:b[t.recid-1].Product,Value:b[t.recid-1].Value,QtyEntered:b[t.recid-1].QtyEntered,UOM_ID:b[t.recid-1].UOM_ID,UOM:b[t.recid-1].UOM,M_Product_ID1:b[t.recid-1].M_Product_ID1,Attribute:"",AttributeName:"",RefNo:b[t.recid-1].RefNo}),p[p.length]={_prodQty:b[b.length-1].QtyEntered,_prdID:b[b.length-1].M_Product_ID1,_prdName:b[b.length-1].Product,_value:b[b.length-1].Value,_uom:b[b.length-1].UOM_ID,_uomName:b[b.length-1].UOM,_AD_Session_ID:n.Env.getCtx().getContext("#AD_Session_ID"),_windowNo:r,_RefNo:"",_Attribute:0,_AttributeName:"",_Locator_ID:0,_IsLotSerial:"N",_countID:0},lu()):t.column==4&&ot.records.length>0&&n.Env.getCtx().setContext(r,"M_Product_ID",n.Utility.Util.getValueOfInt(b[t.recid-1].M_Product_ID1))}});y[0].style.visibility="hidden"}function nr(t,i,r){y[0].style.visibility="hidden";t&&(eu=!0);vt.onClose!=null&&vt.onClose();iu();var u=n.Msg.getMsg("RecSaved");t||(u=r>0?r+" "+n.Msg.getMsg("RecordsNotSaved"):n.Msg.getMsg("ErrorInSaving"));i&&i!=""&&(u+=", "+i);n.ADialog.info("",!0,u)}function tf(){var b=0,f="",k=0,nt="",d=0,c=0,l=0,u=0,a=0,g=0,i;d=n.Utility.Util.getValueOfInt(n.context.getWindowContext(r,"M_Locator_ID",!0));b=n.context.getContextAsInt(r,n.context.getWindowTabContext(r,0,"KeyColumnName"));f=n.context.getWindowTabContext(r,0,"KeyColumnName");k=n.context.getContextAsInt(r,n.context.getWindowTabContext(r,1,"KeyColumnName"));nt=n.context.getWindowTabContext(r,1,"KeyColumnName");a=n.Utility.Util.getValueOfInt(n.context.getWindowContext(r,"M_ProductContainer_ID",!0));li==170&&(c=n.Utility.Util.getValueOfInt(n.context.getWindowContext(r,"M_LocatorTo_ID",!0)),g=n.Utility.Util.getValueOfInt(n.context.getWindowContext(r,"Ref_M_ProductContainerTo_ID",!0)));li==146&&(b=n.context.getContextAsInt(r,n.context.getWindowTabContext(r,1,"KeyColumnName")),k=0);l=n.Utility.Util.getValueOfInt(b);u=n.Utility.Util.getValueOfInt(k);var e=[],o=[],s=[],v=[],h=[],w=[];if(p.length>0&&it.css("display")=="none"){for(i in p)if(e.push(p[i]._prdID),o.push(p[i]._prodQty),v.push(p[i]._RefNo),h.push(p[i]._Attribute),s.push(p[i]._uom),w.push(p[i]._countID),u!=0)break;di=p.length}else{for(i in ct)if(e.push(ct[i]._prdID),o.push(ct[i]._prodQty),v.push(ct[i]._RefNo),h.push(ct[i]._Attribute),s.push(ct[i]._uom),w.push(ct[i]._countID),u!=0)break;di=ct.length}tu=di%et==0?di/et:Math.ceil(di/et);tu==1?f=="SAP001_StockTransfer_ID"?t.ajax({type:"POST",url:n.Application.contextUrl+"InfoProduct/SaveStockTfr",dataType:"json",data:{id:l,keyColumn:f,AD_Table_ID:n.context.getWindowTabContext(r,1,"AD_Table_ID"),prod:JSON.stringify(e),C_UOM_ID:JSON.stringify(s),listAst:JSON.stringify(h),qty:JSON.stringify(o),locatorTo:c,lineID:u,ContainerID:a},success:function(n){var t=n.result;t},error:function(n,t){y[0].style.visibility="hidden";console.log(t);returnValue}}):t.ajax({type:"POST",url:n.Application.contextUrl+"InfoProduct/Save",dataType:"json",data:{id:l,keyColumn:f,prod:JSON.stringify(e),C_UOM_ID:JSON.stringify(s),listAst:JSON.stringify(h),qty:JSON.stringify(o),locatorTo:c,lineID:u,InvCountID:JSON.stringify(w),ReferenceNo:JSON.stringify(v),Locator_ID:d,WindowID:li,ContainerID:a,ContainerToID:g},success:function(t){var i=JSON.parse(t);if(i.count==0){if(vi)try{n.dataContext.getJSONData(n.Application.contextUrl+"InfoProduct/DeleteCart",{invCount_ID:ki},null)}catch(r){console.log(r);nr(!0,r.message)}nr(!0);return}au(i);nr(!1,uf(),i.count);return},error:function(n,t){y[0].style.visibility="hidden";console.log(t)}}):rf(l,f,u,e,o,[],s,v,h,d,c,[],w,a,g)}function rf(i,u,f,e,o,s,h,c,l,a,v,p,w,b,k){var d=ft.find(".filestatuscounter");d.text()!=""?tu==ar?d.text(di+" Records Inserted..Please Wait..!!"):d.text(ar*et-vr+" Records Inserted..Please Wait..!!"):ce(ar*et);u=="SAP001_StockTransfer_ID"?t.ajax({type:"POST",url:n.Application.contextUrl+"InfoProduct/SaveStockTfr",dataType:"json",data:{id:i,keyColumn:u,AD_Table_ID:n.context.getWindowTabContext(r,1,"AD_Table_ID"),prod:JSON.stringify(e.splice(0,et)),C_UOM_ID:JSON.stringify(h.splice(0,et)),listAst:JSON.stringify(l.splice(0,et)),qty:JSON.stringify(o.splice(0,et)),locatorTo:v,lineID:f,ContainerID:b},success:function(n){var t=n.result;t},error:function(n,t){y[0].style.visibility="hidden";console.log(t);returnValue}}):t.ajax({type:"POST",url:n.Application.contextUrl+"InfoProduct/Save",dataType:"json",data:{id:i,keyColumn:u,prod:JSON.stringify(e.splice(0,et)),C_UOM_ID:JSON.stringify(h.splice(0,et)),listAst:JSON.stringify(l.splice(0,et)),qty:JSON.stringify(o.splice(0,et)),locatorTo:v,lineID:f,InvCountID:JSON.stringify(w.splice(0,et)),ReferenceNo:c,Locator_ID:a,WindowID:li,ContainerID:b,ContainerToID:k},success:function(t){var r=JSON.parse(t);if(ar++,tu==ar){if(vr==0){if(vi)try{n.dataContext.getJSONData(n.Application.contextUrl+"InfoProduct/DeleteCart",{invCount_ID:ki},null)}catch(y){console.log(y);nr(!0,y.message)}nr(!0);return}au(r);vr+=r.count;nr(!1,uf(),vr);return}r.count==0||(au(r),vr+=r.count);rf(i,u,f,e,o,s,h,c,l,a,v,p,w,b,k)},error:function(n,t){y[0].style.visibility="hidden";console.log(t)}})}function uf(){var t="",n;if(kt.length>0)for(n=0;n<kt.length;n++)n!=0&&(t+=" ::: "),t+=kt[n]+" --> "+gi[n];return kt=[],gi=[],t}function au(n){var t,i;if(n.errorKeys.length>0)if(kt.length>0)for(t=0;t<n.errorKeys.length;t++)i=kt.indexOf(n.errorKeys[t]),i>=0?gi[i]=gi[i]+", "+n.errorProds[t]:(kt.push(n.errorKeys[t]),gi.push(n.errorProds[t]));else kt=n.errorKeys,gi=n.errorProds;else kt.push(n.error)}function fe(){vt.onClose!=null&&vt.onClose();iu()}function ce(n){nu=t("<div class='filestatus'> <label class='filestatuscounter'>"+n+" Records Inserted..Please Wait..!!<\/lable><\/div>");nu.css({position:"absolute",width:"98%",height:"97%","text-align":"center","z-index":"999"});nu[0].style.visibility="visible";ft.append(nu)}function le(){hu=t('<ul style="float:right;margin-top:10px" class="vis-statusbar-ul">');yt=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageFirst16.png" alt="First Page" title="'+n.Msg.getMsg("FirstPage")+'"  style="opacity: 0.6;"><\/div><\/li>');pt=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageUp16.png" alt="Page Up" title="'+n.Msg.getMsg("PageUp")+'"  style="opacity: 0.6;"><\/div><\/li>');nt=t("<select>");gr=t("<li>").append(nt);wt=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageDown16.png" alt="Page Down" title="'+n.Msg.getMsg("PageDown")+'" style="opacity: 0.6;"><\/div><\/li>');bt=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageLast16.png" alt="Last Page" title="'+n.Msg.getMsg("LastPage")+'" style="opacity: 0.6;"><\/div><\/li>');hu.append(yt).append(pt).append(gr).append(wt).append(bt);ae()}function ae(){yt.on("click",function(){if(t(this).css("opacity")=="1"&&(y[0].style.visibility="visible",h&&!ht&&it.show(),lt(!0,1),w.length>0)){for(var n=0;n<w.length;n++)w2ui["subgrid-"+w[n]].destroy();w=[]}});pt.on("click",function(){if(t(this).css("opacity")=="1"&&(y[0].style.visibility="visible",h&&!ht&&it.show(),lt(!0,parseInt(nt.val())-1),w.length>0)){for(var n=0;n<w.length;n++)w2ui["subgrid-"+w[n]].destroy();w=[]}});wt.on("click",function(){if(t(this).css("opacity")=="1"&&(y[0].style.visibility="visible",h&&!ht&&it.show(),lt(!0,parseInt(nt.val())+1),w.length>0)){for(var n=0;n<w.length;n++)w2ui["subgrid-"+w[n]].destroy();w=[]}});bt.on("click",function(){if(t(this).css("opacity")=="1"&&(y[0].style.visibility="visible",h&&!ht&&it.show(),lt(!0,parseInt(nt.find("Option:last").val())),w.length>0)){for(var n=0;n<w.length;n++)w2ui["subgrid-"+w[n]].destroy();w=[]}});nt.on("change",function(){if(y[0].style.visibility="visible",h&&!ht&&it.show(),lt(!0,nt.val()),w.length>0){for(var n=0;n<w.length;n++)w2ui["subgrid-"+w[n]].destroy();w=[]}})}function ve(n){nt=null;gr.find("select").remove();nt=t("<select>");gr.append(nt);nt.on("change",function(){y[0].style.visibility="visible";h&&!ht&&it.show();lt(!0,nt.val())});if(n.TotalPage>0){for(var i=0;i<n.TotalPage;i++)nt.append(t("<option value="+(i+1)+">"+(i+1)+"<\/option>"));nt.val(n.CurrentPage);n.TotalPage>n.CurrentPage?(wt.css("opacity","1"),bt.css("opacity","1")):(wt.css("opacity","0.6"),bt.css("opacity","0.6"));n.CurrentPage>1?(yt.css("opacity","1"),pt.css("opacity","1")):(yt.css("opacity","0.6"),pt.css("opacity","0.6"));n.TotalPage==1&&(yt.css("opacity","0.6"),pt.css("opacity","0.6"),wt.css("opacity","0.6"),bt.css("opacity","0.6"))}else yt.css("opacity","0.6"),pt.css("opacity","0.6"),wt.css("opacity","0.6"),bt.css("opacity","0.6")}function ye(i){var r;if(i!=null){var u=0,f=n.Utility.Util.getValueOfInt(w2ui[l].records[i.recid-1].M_PRODUCT_ID),e=n.Utility.Util.getValueOfInt(w2ui[l].records[i.recid-1].M_WAREHOUSE_ID),o="";for(r=0;r<k.length;r++)k[r].Ctrl.colName=="M_AttributeSetInstance_ID"&&(u=n.Utility.Util.getValueOfInt(k[r].Ctrl.value));for(r=0;r<k.length;r++)k[r].Ctrl.colName=="AttributeCode"&&(o=k[r].Ctrl.getValue());f>0&&e>0&&t.ajax({url:n.Application.contextUrl+"InfoProduct/GetVariants",dataType:"json",type:"POST",async:!1,data:{M_Product_ID:f,M_Warehouse_ID:e,ParentRec_ID:i.recid,M_AttributeSetInstance_ID:u,AttributeCode:o},error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));y[0].style.visibility="hidden";return},success:function(n){var t=JSON.parse(n);pe(t)}})}}function pe(n){n!=null&&(bu=n)}var du,yr,gu,nf;this.onClose=null;var ft=t("<div>"),ff=!0,dt=t("<div>"),ef=null,of=null,sf=null,gt=null,ri=null,ui=null,fi=null,tr=null,pr=null,wr=null,br=null,kr=null,ei=null,oi=null,ni=null,ti=null,yi=null,at=null,si=null,it=null,hi=null,ci=null,ii=null,pi=null,y=null,hf=null,k=[],rt=null,ot=null,vt=this,ir="",li=0,v=[],dr=[],cf=null,l=null,rr=null,ur=null,fr=null,er=null,or=null,sr=null,hr=null,cr=null,lr=null,ai=null,st=null,ru=null,uu=[],w=[],tt=null,ut=null,wi=null,bi=null,d=t("<table>"),a=null,vu=null,yu=null,fu=null,p=[],b=[],eu=!1,ht=!1,pu=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()),vi=!1,ki=0,g=null,wu=null,ou=null,su,hu,yt,pt,gr,wt,bt,nt,nu,di=0,tu=0,ar=0,vr=0,et=500,kt=[],gi=[],bu=[],lf=[],ct=[];af();du=n.context.getWindowTabContext(r,0,"AD_Tab_ID");li=n.dataContext.getJSONRecord("InfoProduct/GetWindowID",du.toString());li==146||n.context.getContextAsInt(r,n.context.getWindowTabContext(r,1,"KeyColumnName"))!=0&&(ht=!0);(!h||ht)&&(it.hide(),at.hide(),yi.hide(),si.hide());yr="M_Product p LEFT OUTER JOIN M_ProductPrice pr ON (p.M_Product_ID=pr.M_Product_ID AND pr.IsActive='Y') LEFT OUTER JOIN M_PriceList_Version plv ON (pr.M_PriceList_Version_ID=plv.M_PriceList_Version_ID) LEFT OUTER JOIN M_AttributeSet pa ON (p.M_AttributeSet_ID=pa.M_AttributeSet_ID) LEFT OUTER JOIN C_UOM c ON (p.C_UOM_ID=c.C_UOM_ID)";vf();yf(u,f);var re=function(){vi=!1;ki=0;var t=new n.InfoScanForm(r,!1);t.showDialog();t.onClose=function(t,i,u){var l,f,e,c,k;if(y[0].style.visibility="visible",vi=i,ki=u,l=n.Env.getCtx().getContext("#AD_Session_ID"),t&&t.length>0)for(f in t){var a="",v="",o=0,s=t[f].M_AttributeSetInstance_ID,w=t[f].Description,d=t[f].VAICNT_InventoryCountLine_ID,h=t[f].VAICNT_Quantity,b=t[f].M_Product_ID,g=t[f].Value;a=t[f].Name;v=t[f].UOM;o=t[f].C_UOM_ID;e=t[f].VAICNT_ReferenceNo;e==""&&(e="null");c=t[f].LineID;h>0&&(p.length>0?(k=p.map(function(n){return n._prdID==b&&n._Attribute==s&&n._uom==o&&n._refLineID==c}).indexOf(!0),k>-1?p[k]._prodQty+=h:p.push({_prodQty:h,_prdID:b,_prdName:a,_value:g,_uom:o,_uomName:v,_AD_Session_ID:l,_windowNo:r,_RefNo:e,_Attribute:s,_AttributeName:w,_Locator_ID:0,_IsLotSerial:"N",_countID:d,_refLineID:c})):p.push({_prodQty:h,_prdID:b,_prdName:a,_value:g,_uom:o,_uomName:v,_AD_Session_ID:l,_windowNo:r,_RefNo:e,_Attribute:s,_AttributeName:w,_Locator_ID:0,_IsLotSerial:"N",_countID:d,_refLineID:c}),dr[s]=w)}cu()}},ue=function(){if(y[0].style.visibility="visible",se(),lt(!0,nt.val()),w.length>0){for(var n=0;n<w.length;n++)w2ui["subgrid-"+w[n]].destroy();w=[]}p.length>0?at.prop("disabled",!1):at.prop("disabled",!0);v=[]},cu=function(){var i=[],r=[],u=[],f=[],e=[],o=[],s=[],h=[],c=[],t,n;b=[];it.hide();for(t in p)i.push(p[t]._prdID),f.push(p[t]._prdName),r.push(p[t]._value),u.push(p[t]._prodQty),c.push(p[t]._RefNo),s.push(p[t]._Attribute),h.push(p[t]._AttributeName),e.push(p[t]._uom),o.push(p[t]._uomName);if(i.length>0){for(n=0;n<i.length;n++)b.push({SrNo:n,Product:f[n],Value:r[n],QtyEntered:u[n],UOM_ID:e[n],UOM:o[n],M_Product_ID1:i[n],Attribute:s[n],AttributeName:h[n],RefNo:c[n]});lu()}y[0].style.visibility="hidden"};gu=function(){var n,r,i,f,e,u;if(y[0].style.visibility="visible",h&&p.length>0&&it.css("display")=="none"){if(v=[],n=w2ui[l].getSelection(),r=p,n.length>0){for(r=[],i=0;i<n.length;i++)f=w2ui[l].records[n[i]-1].ProdID,e=w2ui[l].records[n[i]-1].Attribute,r.push(t.grep(p,function(n){return n._prdID==f&&n._Attribute==e})[0]);p=r}tf(p)}else if(h&&w2ui[l].getSelection().length>1&&it.css("display")=="block")ct=nf(),tf(ct);else{v=[];u=w2ui[l].getSelection();for(item in u)v.indexOf(w2ui[l].get(u[item])[ir])==-1&&v.push(w2ui[l].get(u[item])[ir]);y[0].style.visibility="hidden";vt.onClose!=null&&vt.onClose();iu()}};nf=function(){var i=w2ui[l].getSelection(),u,t,e,o,f;if(i.length>0)for(u=[],t=0;t<i.length;t++)w2ui[l].records[i[t]-1].QTYENTERED>0&&(e=w2ui[l].records[i[t]-1].M_PRODUCT_ID,o=w2ui[l].records[i[t]-1].M_AttributeSetInstance_ID,u.length>0?(f=u.map(function(n){return n._prdID==e&&n._Attribute==o}).indexOf(!0),f>-1?u[f]._prodQty+=qty:u.push({_prodQty:w2ui[l].records[i[t]-1].QTYENTERED,_prdID:w2ui[l].records[i[t]-1].M_PRODUCT_ID,_prdName:w2ui[l].records[i[t]-1].NAME,_value:w2ui[l].records[i[t]-1].NAME,_uom:w2ui[l].records[i[t]-1].C_UOM_ID,_uomName:w2ui[l].records[i[t]-1].UOM,_AD_Session_ID:n.Env.getCtx().getContext("#AD_Session_ID"),_windowNo:r,_RefNo:"",_Attribute:w2ui[l].records[i[t]-1].M_AttributeSetInstance_ID,_AttributeName:"",_Locator_ID:0,_IsLotSerial:"N",_countID:0})):u.push({_prodQty:w2ui[l].records[i[t]-1].QTYENTERED,_prdID:w2ui[l].records[i[t]-1].M_PRODUCT_ID,_prdName:w2ui[l].records[i[t]-1].NAME,_value:w2ui[l].records[i[t]-1].NAME,_uom:w2ui[l].records[i[t]-1].C_UOM_ID,_uomName:w2ui[l].records[i[t]-1].UOM,_AD_Session_ID:n.Env.getCtx().getContext("#AD_Session_ID"),_windowNo:r,_RefNo:"",_Attribute:w2ui[l].records[i[t]-1].M_AttributeSetInstance_ID,_AttributeName:"",_Locator_ID:0,_IsLotSerial:"N",_countID:0}));return u};this.show=function(){t.ajax({url:n.Application.contextUrl+"InfoProduct/GetInfoColumns",dataType:"json",error:function(){alert(n.Msg.getMsg("ERRORGettingSearchCols"));y[0].style.visibility="hidden"},success:function(t){if(rt=jQuery.parseJSON(t),rt==null){alert(n.Msg.getMsg("ERRORGettingSearchCols"));y[0].style.visibility="hidden";return}ft.dialog({width:1020,height:500,title:n.Msg.translate(n.Env.getCtx(),"InfoProduct"),resizable:!1,modal:!0,closeText:n.Msg.getMsg("close"),close:fe});lt(!1,nt.val())}})};var lt=function(i,r){var p,e,f,d,nt;if(h&&w2ui[l]){p=w2ui[l].getSelection();for(e in p)v.indexOf(w2ui[l].get(p[e])[ir])==-1&&v.push(w2ui[l].get(p[e]))}oe();var c="SELECT ",a="",w=0,tt=t.makeArray(rt).length;for(e in rt)w=rt[e].AD_Reference_ID,c+=w==n.DisplayType.YesNo?" ( CASE "+rt[e].ColumnSQL+" WHEN 'Y' THEN  'True' ELSE 'False'  END ) "+rt[e].ColumnName:rt[e].ColumnSQL+" ",w==n.DisplayType.ID&&rt[e].ColumnName.toUpperCase()=="M_PRODUCT_ID"&&(ir=rt[e].ColumnName.toUpperCase()),tt-1==e||(c+=", ");if(i==!0){var s=" w.AD_Client_ID = "+n.context.getAD_Client_ID(),u=null,b=!1;for(yr="M_Product p LEFT OUTER JOIN M_ProductPrice pr ON (p.M_Product_ID=pr.M_Product_ID AND pr.IsActive='Y') LEFT OUTER JOIN M_PriceList_Version plv ON (pr.M_PriceList_Version_ID=plv.M_PriceList_Version_ID) LEFT OUTER JOIN M_AttributeSet pa ON (p.M_AttributeSet_ID=pa.M_AttributeSet_ID) LEFT OUTER JOIN C_UOM c ON (p.C_UOM_ID=c.C_UOM_ID)",f=0;f<k.length;f++)(u=k[f].Ctrl.getValue(),u!=null&&u.length!=0&&u!=0)&&(k[f].Ctrl.displayType==10&&(u=String(u).indexOf("%")==0?String(u).replace("%","●"):"●"+u,String(u).lastIndexOf("●")==String(u).length||(u=u+"●")),k[f].Ctrl.colName=="Value"?s+=" AND UPPER(p."+k[f].ColumnName+") LIKE '"+u.toUpperCase()+"' ":k[f].Ctrl.colName=="Name"?s+=" AND UPPER(p."+k[f].ColumnName+") LIKE '"+u.toUpperCase()+"' ":k[f].Ctrl.colName=="UPC"?(b=!0,s+=" AND (UPPER(patr.UPC) LIKE '"+u.toUpperCase()+"' OR UPPER(p.UPC) LIKE '"+u.toUpperCase()+"' OR UPPER(mr.UPC) LIKE '"+u.toUpperCase()+"')"):k[f].Ctrl.colName=="SKU"?s+=" AND UPPER(p."+k[f].ColumnName+") LIKE '"+u.toUpperCase()+"' ":k[f].Ctrl.colName=="M_Warehouse_ID"?n.Utility.Util.getValueOfInt(u)!=0&&(s+=" AND w.M_Warehouse_ID="+n.Utility.Util.getValueOfInt(u)):k[f].Ctrl.colName=="M_PriceList_Version_ID"?n.Utility.Util.getValueOfInt(u)!=0&&(s+=" AND pr.M_PriceList_Version_ID="+n.Utility.Util.getValueOfInt(u)):k[f].Ctrl.colName=="M_AttributeSet_ID"?n.Utility.Util.getValueOfInt(u)!=0&&(s+=" AND p.M_AttributeSet_ID="+n.Utility.Util.getValueOfInt(u)):k[f].Ctrl.colName=="AttributeCode"&&(s+=" AND p.M_Product_ID in (SELECT distinct M_Product_ID from M_ProductAttributes WHERE UPPER(UPC) LIKE '"+u.toUpperCase()+"')"));b&&(yr+=" LEFT OUTER JOIN M_manufacturer mr ON (p.M_Product_ID=mr.M_Product_ID) LEFT OUTER JOIN M_ProductAttributes patr ON (p.M_Product_ID=patr.M_Product_ID)");c+=" FROM "+yr+" JOIN M_Warehouse w ON (1=1)";li==181&&g!=null&&g.length>0&&(g+=" AND (p.Discontinued = 'N' OR p.DiscontinuedBy > sysdate )");s.length>1?(a+=" WHERE "+s,g!=null&&g.length>0&&(a+=" AND "+g.replace(/M_Product\./g,"p."))):g!=null&&g.length>0&&(a+=" WHERE "+g.replace(/M_Product\./g,"p."))}else c+=" FROM "+yr+" JOIN M_Warehouse w ON (1=1)",a+=g!=null&&g.length>0&&g.trim().toUpperCase().startsWith("WHERE")?" "+g.replace(/M_Product\./g,"p.")+" AND "+o+"_ID=-1":g!=null&&g.length>0?" WHERE p."+o+"_ID=-1 AND "+g.replace(/M_Product\./g,"p."):" WHERE p."+o+"_ID=-1";r||(r=1);d=n.secureEngine.encrypt(c);nt=n.secureEngine.encrypt(a);t.ajax({url:n.Application.contextUrl+"InfoProduct/GetData",dataType:"json",type:"POST",data:{sql:d,where:nt,tableName:o,pageNo:r,ForMobile:pu},error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));y[0].style.visibility="hidden";return},success:function(t){var i=JSON.parse(t);if(i==null){y[0].style.visibility="hidden";return}if(i.Error){n.ADialog.error(i.Error);y[0].style.visibility="hidden";return}ve(i.pSetting);ee(i.data)}})},ee=function(i){var r,e,s,f;if(i==null){alert(n.Msg.getMsg("NoDataFound"));y[0].style.visibility="hidden";return}var o=[],c=[],u=null;for(f in i)r={resizable:!0},u=rt[f].AD_Reference_ID,r.caption=rt[f].Name,r.field=rt[f].ColumnName.toUpperCase(),r.columnName=rt[f].ColumnName.toUpperCase(),r.sortable=!0,r.hidden=!1,r.size="100px",n.DisplayType.IsNumeric(u)?(r.render=u==n.DisplayType.Integer?"int":u==n.DisplayType.Amount?"number:2":"number:1",rt[f].ColumnName.toUpperCase()=="QTYENTERED"&&h&&!ht&&(r.editable={type:"float"})):n.DisplayType.IsDate(u)?r.render=function(n,t,i){var r=n[o[i].field];return r?Globalize.format(new Date(r),"d"):""}:u==n.DisplayType.Location||u==n.DisplayType.Locator?r.render="int":u==n.DisplayType.Account?r.render="int":u==n.DisplayType.PAttribute?r.render="int":u==n.DisplayType.Button?r.render=function(){return"<div>button<\/div>"}:u==n.DisplayType.Image?r.render=function(){return"<div>Image<\/div>"}:n.DisplayType.IsLOB(u)&&(r.render=function(){return"<div>[Lob-blob]<\/div>"}),o[f]=r;for(o[o.length]={field:"M_AttributeSetInstance_ID",caption:"M_AttributeSetInstance_ID",size:"150px",hidden:!0},e=0;e<i[0].RowCount;e++){s={};for(f in i)s[i[f].ColumnName]=i[f].Values[e];s.M_AttributeSetInstance_ID=0;s.recid=e+1;c[e]=s}l="gridPrdInfodata"+Math.random();l=l.replace(".","");w2utils.encodeTags(c);ot=t(ui).w2grid({name:l,recordHeight:40,show:{toolbar:!0,columnHeaders:!0,lineNumbers:!0,selectColumn:!0,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:o,records:c,onExpand:function(n){y[0].style.visibility="visible";ye(n);w2ui.hasOwnProperty("subgrid-"+n.recid)&&w2ui["subgrid-"+n.recid].destroy();w.indexOf(n.recid)==-1&&w.push(n.recid);t("#"+n.box_id).css({margin:"0px",padding:"0px",width:"100%",height:"105px"});setTimeout(function(){t("#"+n.box_id).w2grid({name:"subgrid-"+n.recid,show:{columnHeaders:!0,selectColumn:!0},fixedBody:!0,columns:uu,records:bu,onChange:function(n){var u=-1,f=w2ui[n.target].records[n.index].ParentRec_ID,r,i,t;if(v.length>0){for(r in v)if(v[r].M_PRODUCT_ID==w2ui[l].records[f-1].M_PRODUCT_ID&&v[r].M_AttributeSetInstance_ID==w2ui[n.target].records[n.index].M_AttributeSetInstance_ID){u=r;break}u>-1?v[u].QTYENTERED=n.value_new:(i=w2ui[l].records[f-1],t=JSON.parse(JSON.stringify(i)),t.M_AttributeSetInstance_ID=w2ui[n.target].records[n.index].M_AttributeSetInstance_ID,t.QTYENTERED=n.value_new,v.push(t))}else i=w2ui[l].records[f-1],t=JSON.parse(JSON.stringify(i)),t.M_AttributeSetInstance_ID=w2ui[n.target].records[n.index].M_AttributeSetInstance_ID,t.QTYENTERED=n.value_new,v.push(t)}});w2ui["subgrid-"+n.recid].resize();y[0].style.visibility="hidden"},500)},onChange:function(n){var i=-1,t;if(w2ui[l].records[n.index].QTYENTERED=n.value_new,v.length>0){for(t in v)if(v[t].M_PRODUCT_ID==w2ui[l].records[n.index].M_PRODUCT_ID&&v[t].M_AttributeSetInstance_ID==0){i=t;break}i>-1?v[i].QTYENTERED=n.value_new:v.push(w2ui[l].records[n.index])}else v.push(w2ui[l].records[n.index])}});w2ui[l].hideColumn("M_PRODUCT_ID");w2ui[l].hideColumn("C_UOM_ID");w2ui[l].hideColumn("UOM");w2ui[l].hideColumn("M_WAREHOUSE_ID");w2ui[l].hideColumn("M_PRICELIST_VERSION_ID");(!h||ht)&&w2ui[l].hideColumn("QTYENTERED");y[0].style.visibility="hidden"},oe=function(){ot!=null&&ot.destroy();ot=null};this.getSelectedValues=function(){return v};this.getRefreshStatus=function(){return eu};var se=function(){if(h&&(v.length>0||w2ui[l].getSelection().length>0))he();else return},he=function(){var u,a,f,o,s,h,e,t,c,i;if(w2ui[l].getSelection().length>0){u=w2ui[l].getSelection();for(t in u)if(a=w2ui[l].get(u[t]).M_PRODUCT_ID,f="subgrid-"+w2ui[l].get(u[t]).recid,w2ui[f]!=undefined)if(w2ui[f].getSelection().length>0){o=w2ui[f].getSelection();for(s in o)if(v.length>0)if(i=v.map(function(n){return n.M_PRODUCT_ID==a&&n.M_AttributeSetInstance_ID==w2ui[f].records[o[s]-1].M_AttributeSetInstance_ID}).indexOf(!0),i>-1)continue;else h=w2ui[l].get(u[t]),e=JSON.parse(JSON.stringify(h)),e.M_AttributeSetInstance_ID=w2ui[f].records[o[s]-1].M_AttributeSetInstance_ID,e.QTYENTERED=w2ui[f].records[o[s]-1].Quantity,v.push(e);else h=w2ui[l].get(u[t]),e=JSON.parse(JSON.stringify(h)),e.M_AttributeSetInstance_ID=w2ui[f].records[o[s]-1].M_AttributeSetInstance_ID,e.QTYENTERED=w2ui[f].records[o[s]-1].Quantity,v.push(e)}else if(v.length>0)if(i=v.map(function(n){return n.M_PRODUCT_ID==a&&n.M_AttributeSetInstance_ID==0}).indexOf(!0),i>-1)continue;else v.push(w2ui[l].get(u[t]));else v.push(w2ui[l].get(u[t]));else if(v.length>0)if(i=v.map(function(n){return n.M_PRODUCT_ID==a&&n.M_AttributeSetInstance_ID==0}).indexOf(!0),i>-1)continue;else v.push(w2ui[l].get(u[t]));else v.push(w2ui[l].get(u[t]))}if(v.length>0)for(t in v)c=v[t].QTYENTERED,c>0&&(p.length>0?(i=p.map(function(n){return n._prdID==v[t].M_PRODUCT_ID&&n._Attribute==v[t].M_AttributeSetInstance_ID}).indexOf(!0),i>-1?p[i]._prodQty+=c:p.push({_prodQty:c,_prdID:v[t].M_PRODUCT_ID,_prdName:v[t].NAME,_value:v[t].VALUE,_uom:v[t].C_UOM_ID,_uomName:v[t].UOM,_AD_Session_ID:n.Env.getCtx().getContext("#AD_Session_ID"),_windowNo:r,_RefNo:"",_Attribute:v[t].M_AttributeSetInstance_ID,_AttributeName:"",_Locator_ID:0,_IsLotSerial:"N",_countID:0})):p.push({_prodQty:c,_prdID:v[t].M_PRODUCT_ID,_prdName:v[t].NAME,_value:v[t].VALUE,_uom:v[t].C_UOM_ID,_uomName:v[t].UOM,_AD_Session_ID:n.Env.getCtx().getContext("#AD_Session_ID"),_windowNo:r,_RefNo:"",_Attribute:v[t].M_AttributeSetInstance_ID,_AttributeName:"",_Locator_ID:0,_IsLotSerial:"N",_countID:0}))},iu=function(){if(ft.off("keyup"),hi.off("click"),ci.off("click"),pi.off("click"),yt.off("click"),pt.off("click"),wt.off("click"),bt.off("click"),nt.off("change"),yt=pt=wt=bt=nt=null,ui=null,ri=null,ot!=null&&ot.destroy(),ot=null,ff=null,dt=null,ef=null,of=null,sf=null,gt=null,ri=null,ui=null,fi=null,tr=null,ei=null,oi=null,ni=null,hi=null,ci=null,ii=null,pi=null,si=null,y=null,hf=null,k=null,rt=null,ot=null,vt=null,ir=null,v=null,cf=null,p=null,b=null,eu=!1,pu=null,vi=null,ft!=null&&(ft.dialog("destroy"),ft.remove()),ft=null,this.btnOKClick=null,this.displaySearchCol=null,this.displayData=null,this.loadData=null,this.disposeComponent=null,this.disposeDataSec=null,this.getSelectedValues=null,this.refreshUI=null,w.length>0){for(var n=0;n<w.length;n++)w2ui["subgrid-"+w[n]].destroy();w=[]}}}n.infoProduct=i}(VIS,jQuery),function(n,t){function i(i,r){function ui(){var u,r,o;h.css("width","100%");h.css("height","100%");h.css("position","relative");rt.css("width","98%");rt.css("height","97%");rt.css("position","absolute");v.css("width","100%");n.Application.isRTL?(y=t("<div style='background-color: rgb(241, 241, 241);height:88.9%;display: inline-block;width:25%;height:87.8%;overflow:auto;padding-right: 10px;margin-left: 10px;'>"),lt=t("<div style='background-color: rgb(241, 241, 241);display: inline-block;height:87.8%;'>"),y.append(lt),at=t("<div style='display: inline-block;width:73%;height:87.8%;overflow:auto;'>"),p=t("<div style='display: inline-block;width:99%;height:auto;margin-top: 2px;'>")):(y=t("<div style='background-color: rgb(241, 241, 241);padding-left: 7px;height:88.9%;display: inline-block; float: left;width:25%;height:87.8%;overflow:auto;'>"),lt=t("<div style='background-color: rgb(241, 241, 241);'>"),y.append(lt),at=t("<div style='display: inline-block; float: left;width:73%;height:87.8%;margin-left:10px;'>"),p=t("<div style='display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;'>"));rt.append(y);rt.append(at);rt.append(p);vt=n.Msg.translate(n.Env.getCtx(),"Name");vt.indexOf("&")>-1&&(vt=vt.replace("&",""));bt=n.Msg.translate(n.Env.getCtx(),"ReferenceNo");bt.indexOf("&")>-1&&(bt=lblUPCtxt.replace("&",""));yt=n.Msg.translate(n.Env.getCtx(),"FromDate");yt.indexOf("&")>-1&&(yt=yt.replace("&",""));pt=n.Msg.translate(n.Env.getCtx(),"ToDate");pt.indexOf("&")>-1&&(pt=pt.replace("&",""));ot=n.Msg.getMsg("Cancel");ot.indexOf("&")>-1&&(ot=ot.replace("&",""));et=n.Msg.getMsg("Search");et.indexOf("&")>-1&&(et=et.replace("&",""));st=n.Msg.getMsg("Ok");st.indexOf("&")>-1&&(st=st.replace("&",""));w=t("<div style='float:right;'>");ht=t("<div style='float:right;'>");n.Application.isRTL?(ut=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(ot),b=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(st),ct=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:10px'>").append(et)):(f=t("<tr>"),v.append(f),u=t("<td>"),ft=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(vt),u.append(ft),f.append(u),f=t("<tr>"),v.append(f),r={},c=new n.Controls.VTextBox("Name",!1,!1,!0,50,100,null,null,!1),r.Ctrl=c,r.AD_Reference_ID=10,r.ColumnName="Name",o=t("<td>"),f.append(o),o.append(c.getControl().css("width","97%").css("font-weight","inherit")),a.push(r),f=t("<tr>"),v.append(f),u=t("<td>"),ft=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(bt),u.append(ft),f.append(u),f=t("<tr>"),v.append(f),r={},c=new n.Controls.VTextBox("Reference",!1,!1,!0,50,100,null,null,!1),r.Ctrl=c,r.AD_Reference_ID=10,r.ColumnName="Reference",o=t("<td>"),f.append(o),o.append(c.getControl().css("width","97%").css("font-weight","inherit")),a.push(r),f=t("<tr>"),v.append(f),u=t("<td>"),ft=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(yt),u.append(ft),f.append(u),f=t("<tr>"),v.append(f),r={},c=new n.Controls.VDate("TrxFromDate",!1,!1,!0,n.DisplayType.Date,n.Msg.translate("FromDate")),r.Ctrl=c,r.AD_Reference_ID=10,r.ColumnName="TrxFromDate",o=t("<td>"),f.append(o),o.append(c.getControl().css("width","97%").css("font-weight","inherit").css("height","30px")),a.push(r),f=t("<tr>"),v.append(f),u=t("<td>"),ft=t("<label class='VIS_Pref_Label_Font' style='margin-bottom: 0px;margin-top:5px;font-weight:inherit'>").append(pt),u.append(ft),f.append(u),f=t("<tr>"),v.append(f),r={},c=new n.Controls.VDate("TrxToDate",!1,!1,!0,n.DisplayType.Date,n.Msg.translate("ToDate")),r.Ctrl=c,r.AD_Reference_ID=10,r.ColumnName="TrxToDate",o=t("<td>"),f.append(o),o.append(c.getControl().css("width","97%").css("font-weight","inherit").css("height","30px")),a.push(r),lt.append(v),ut=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(ot),b=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(st),ct=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:10px'>").append(et));w.append(ut);w.append(b);w.append(t('<div style="float:left;margin-right:10px;margin-top:15px;"><input type="checkbox" id="chkDelCart_'+i+'" style="float:left"><span style="float:left">'+n.Msg.getMsg("DeleteCart")+"<\/span>"));ht.append(ct);y.append(ht);p.append(w);gt=t("<div>");si();gt.append(ni);n.Application.isRTL?(wt.append(ut),wt.append(b),ht.append(ct),y.append(ht)):(w.append(ut),w.append(b),ht.append(ct),y.append(ht));p.append(w);p.append(gt);p.append(wt);e=t("<div class='vis-apanel-busy'>");e.css("width","98%");e.css("height","97%");e.css("text-align","center");e.css("position","absolute");e[0].style.visibility="visible";dt=p.find("#chkDelCart_"+i);h.append(rt);h.append(e)}function fi(){if(!n.Application.isMobile)h.on("keyup",function(n){n.keyCode===13&&(e[0].style.visibility="visible",s=[],u.selectNone(),it(!0,o.val()))});ut.on("click",function(){l.dispose()});b.on("click",function(){oi()});ct.on("click",function(){e[0].style.visibility="visible";s=[];u.selectNone();it(!0,1)})}function si(){ni=t('<ul style="float:right;margin-top:10px" class="vis-statusbar-ul">');d=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageFirst16.png" alt="First Page" title="First Page" style="opacity: 0.6;"><\/div><\/li>');g=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageUp16.png" alt="Page Up" title="Page Up" style="opacity: 0.6;"><\/div><\/li>');o=t("<select>");kt=t("<li>").append(o);nt=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageDown16.png" alt="Page Down" title="Page Down" style="opacity: 0.6;"><\/div><\/li>');tt=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageLast16.png" alt="Last Page" title="Last Page" style="opacity: 0.6;"><\/div><\/li>');ni.append(d).append(g).append(kt).append(nt).append(tt);hi()}function hi(){d.on("click",function(){t(this).css("opacity")=="1"&&(e[0].style.visibility="visible",it(!0,1))});g.on("click",function(){t(this).css("opacity")=="1"&&(e[0].style.visibility="visible",it(!0,parseInt(o.val())-1))});nt.on("click",function(){t(this).css("opacity")=="1"&&(e[0].style.visibility="visible",it(!0,parseInt(o.val())+1))});tt.on("click",function(){t(this).css("opacity")=="1"&&(e[0].style.visibility="visible",it(!0,parseInt(o.find("Option:last").val())))});o.on("change",function(){e[0].style.visibility="visible";it(!0,o.val())})}function ci(n){o=null;kt.find("select").remove();o=t("<select>");kt.append(o);o.on("change",function(){e[0].style.visibility="visible";it(!0,o.val())});if(n.TotalPage>0){for(var i=0;i<n.TotalPage;i++)o.append(t("<option value="+(i+1)+">"+(i+1)+"<\/option>"));o.val(n.CurrentPage);n.TotalPage>n.CurrentPage?(nt.css("opacity","1"),tt.css("opacity","1")):(nt.css("opacity","0.6"),tt.css("opacity","0.6"));n.CurrentPage>1?(d.css("opacity","1"),g.css("opacity","1")):(d.css("opacity","0.6"),g.css("opacity","0.6"));n.TotalPage==1&&(d.css("opacity","0.6"),g.css("opacity","0.6"),nt.css("opacity","0.6"),tt.css("opacity","0.6"))}else d.css("opacity","0.6"),g.css("opacity","0.6"),nt.css("opacity","0.6"),tt.css("opacity","0.6")}this.onClose=null;this.arrListColumns=[];var h=t("<div>"),ti=!0,rt=t("<div>"),y=null,lt=null,at=null,p=null,et=null,ot=null,st=null,w=null,ht=null,ut=null,b=null,ct=null,dt=null,wt=null,e=null,u=null,l=this,k=0,vt=null,bt=null,yt=null,pt=null,ft=null,c=null,v=t("<table>"),f=null,ii=!1,a=[],gt,ni,d,g,kt,nt,tt,o,s=[],li=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase()),ri=n.context.getWindowTabContext(i,0,"AD_Tab_ID");k=n.dataContext.getJSONRecord("InfoProduct/GetWindowID",ri.toString());ui();fi();var it=function(f,o){var y,c,l,v,g;if(u){y=u.getSelection();for(item in y)s.indexOf(u.get(y[item]).count_ID)==-1&&s.push(u.get(y[item]).count_ID)}var h="",w=0,b=0,p=0,d=0;if(f==!0){for(c=null,l=0;l<a.length;l++)(c=a[l].Ctrl.getValue(),c!=null&&c.length!=0&&c!=0)&&(a[l].Ctrl.colName=="Name"?h+=" AND upper(VAICNT_ScanName) LIKE '%"+c.toUpperCase()+"%' ":a[l].Ctrl.colName=="Reference"?h+=" AND upper(VAICNT_ReferenceNo) LIKE '%"+c.toUpperCase()+"%' ":a[l].Ctrl.colName=="TrxFromDate"?(v=n.DB.to_date(c,!0),h+=" AND DateTrx >= "+v):a[l].Ctrl.colName=="TrxToDate"&&(v=n.DB.to_date(c,!0),h+=" AND DateTrx <= "+v));r?h+=" AND VAICNT_TransactionType = 'OT' ":k==184?h+=" AND VAICNT_TransactionType = 'MR' and VAICNT_ReferenceNo in (SELECT DocumentNo from C_Order WHERE C_BPartner_ID = "+n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(i,0,"C_BPartner_ID"))+" AND DocStatus IN ('CO', 'CL'))":k==319||k==170?(h+=" AND VAICNT_TransactionType = 'IM' ",w=n.Utility.Util.getValueOfInt(n.context.getWindowContext(i,"M_Locator_ID",!0)),b=n.Utility.Util.getValueOfInt(n.context.getWindowContext(i,"M_LocatorTo_ID",!0)),p=n.Utility.Util.getValueOfInt(n.context.getWindowContext(i,"DTD001_MWarehouseSource_ID",!0)),d=n.Utility.Util.getValueOfInt(n.context.getWindowContext(i,"M_Warehouse_ID",!0))):k==168?(h+=" AND VAICNT_TransactionType = 'PI' ",p=n.Utility.Util.getValueOfInt(n.context.getWindowContext(i,"M_Warehouse_ID",!0))):h+=k==169?" AND VAICNT_TransactionType = 'SH' and VAICNT_ReferenceNo in (SELECT DocumentNo from C_Order WHERE  C_BPartner_ID = "+n.Utility.Util.getValueOfInt(n.context.getWindowTabContext(i,0,"C_BPartner_ID"))+" AND DocStatus IN ('CO'))":k==341?" AND VAICNT_TransactionType = 'IU' AND VAICNT_ReferenceNo IN (SELECT DocumentNo FROM M_Requisition WHERE IsActive = 'Y' AND M_Warehouse_ID = "+n.Utility.Util.getValueOfInt(n.context.getWindowContext(i,"M_Warehouse_ID",!0))+" AND DocStatus IN ('CO'))":" AND VAICNT_TransactionType = 'OT' "}else h+=" AND VAICNT_InventoryCount_ID = -1";sql="SELECT VAICNT_ScanName,VAICNT_ReferenceNo,DateTrx,VAICNT_InventoryCount_ID FROM VAICNT_InventoryCount WHERE IsActive='Y' AND AD_Client_ID = "+n.Utility.Util.getValueOfInt(n.context.getAD_Client_ID())+h;g=n.secureEngine.encrypt(sql);o||(o=1);t.ajax({url:n.Application.contextUrl+"InfoProduct/GetCart",dataType:"json",data:{sql:g,pageNo:o,isCart:r,windowID:k,WarehouseID:p,WarehouseToID:d,LocatorID:w,LocatorToID:b},error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));e[0].style.visibility="hidden";return},success:function(t){var i=JSON.parse(t);if(i==null){e[0].style.visibility="hidden";return}if(i.Error){n.ADialog.error(i.Error);e[0].style.visibility="hidden";return}ci(i.pSetting);ei(i.data)}})},ei=function(i){if(i==null){e[0].style.visibility="hidden";return}u!=null&&(u.destroy(),u=null);u=null;l.arrListColumns=[];l.arrListColumns.push({field:"Name",caption:n.Msg.translate(n.Env.getCtx(),"Name"),sortable:!0,size:"16%",min:150,hidden:!1});l.arrListColumns.push({field:"Reference",caption:n.Msg.translate(n.Env.getCtx(),"ReferenceNo"),sortable:!0,size:"16%",min:150,hidden:!1});l.arrListColumns.push({field:"TrxDate",caption:n.Msg.translate(n.Env.getCtx(),"DateTrx"),sortable:!0,size:"16%",min:150,hidden:!1,render:"date"});l.arrListColumns.push({field:"count_ID",caption:n.Msg.translate(n.Env.getCtx(),"ID"),sortable:!0,size:"16%",min:150,hidden:!0});var r="gridPrdInfodata"+Math.random();r=r.replace(".","");w2utils.encodeTags(i);u=t(at).w2grid({name:r,recordHeight:30,show:{columnHeaders:!0,lineNumbers:!0,selectColumn:!0},columns:l.arrListColumns,records:i,onClick:function(){u.records.length>0&&b.removeAttr("disabled")}});u.selectNone();for(itm in s)for(item in u.records)u.records[item].count_ID==s[itm]&&u.select(parseInt(item)+1);u.on("unselect",function(n){if(n.all)n.onComplete=function(){for(item in u.records){var n=u.records[item].count_ID;s.indexOf(n)>-1&&s.splice(s.indexOf(n),1)}};else{var t=u.records[n.index].count_ID;s.indexOf(t)>-1&&s.splice(s.indexOf(t),1)}});e[0].style.visibility="hidden"},oi=function(){var t="",i,r,f;if(u!=null){if(i=u.getSelection(),i.length>0)for(r in i)s.indexOf(u.get(i[r]).count_ID)==-1&&s.push(u.get(i[r]).count_ID);if(s.length>0){for(r in s)t+=s[r]+",";if(t=t.substr(0,t.length-1),f=n.dataContext.getJSONData(n.Application.contextUrl+"InfoProduct/GetCartData",{invCount_ID:t,WindowID:k},null),l.onClose)l.onClose(f,dt.prop("checked"),t);h.dialog("close")}else alert("Please Select a Record")}};this.showDialog=function(){h.dialog({modal:!0,title:n.Msg.translate(n.Env.getCtx(),"Info Scan"),width:800,height:450,resizable:!1,close:function(){l.dispose()}});it(!1,o.val())};this.disposeComponent=function(){h.off("keyup");ut.off("click");b.off("click");ct.off("click");at=null;lt=null;d.off("click");g.off("click");nt.off("click");tt.off("click");o.off("change");d=g=nt=tt=o=null;u!=null&&u.destroy();u=null;ti=null;rt=null;y=null;p=null;et=null;ot=null;st=null;w=null;ut=null;b=null;dt=null;wt=null;e=null;a=null;l=null;ii=!1;h!=null&&(h.dialog("destroy"),h.remove());h=null;this.displayData=null;this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};n.InfoScanForm=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s,h){function fi(){d.empty();d=null;pt.empty();pt=null;tt.empty();tt=null;c=null;v=null;y=null;p=null;w=null;ot=null;ft=null;nt=null;g=null;it=null;rt=null;ut=null;l=null;ot=null;b=null;progresBar=null;k=null;et!=null&&(et.dialog("destroy"),et.remove());et=null}function li(){wt.onClose&&wt.onClose();fi()}function ei(){ui||(l[0].style.visibility="visible",t.ajax({url:n.Application.contextUrl+"Attachment/GetAttachment",dataType:"json",data:{AD_Table_ID:u,Record_ID:f},error:function(){n.ADialog.info("ERRORGettingAttachment");l[0].style.visibility="hidden"},success:function(i){var u=i.result.FLocation,f=i.result.Attachment,e,a,v,ti,y,ot,o,h,p,w,nt,c,it,st,rt,ht,ut,ct,ft,vt,bt,kt,dt,et,gt,ni;if(u==null){n.ADialog.info("ERRORGettingAttachment");l[0].style.visibility="hidden";return}e=t("<div class='vis-latest-attachments'>");g.append(e);a=t("<div class='vis-attach-top'>");e.append(a);v=t("<div class='vis-attach-file-location pull-left' style='margin-top: -12px;'>");a.append(v);ti=t("<label>").append(n.Msg.getMsg("FileLocation"));v.append(ti);lt=t("<select>");lt.attr("disabled",!0);for(y in u.values)ot=t("<option value="+u.values[y].Key+">"),ot.append(u.values[y].Name),lt.append(ot),u.selectedvalue==u.values[y].Key&&lt.val(u.selectedvalue);v.append(lt);o=t("<div class='vis-attach-top-btns pull-right'>");a.append(o);h=t("<input type='file' multiple='true' style='display:none;'>");o.append(h);h.change(function(){vi(this)});h.click(function(){this.value=null});p=t("<a title='"+n.Msg.getMsg("SelectFile")+"' class='vis-attach-ico vis-browse-ico' style='margin-top:-12px'>");o.append(p);p.on("click",function(){h.trigger("click")});s&&p.hide();w=t("<div class='vis-dropdown pull-left'>");o.append(w);nt=t("<a class='vis-btn vis-btn-arrange vis-dropdown-toggle' type='button' data-toggle='dropdown' style='color: #fff;display:none;'>");nt.append(n.Msg.getMsg("Arrange"));nt.append(t("<span class='vis-caret'>"));w.append(nt);c=t("<ul class='dropdown-menu' role='menu' aria-labelledby='dropdownMenu1' id='dropdownMenu' style='margin-left: -33px;'>");w.append(c);it=t("<li role='presentation'>");st=t("<a role='menuitem' tabindex='-1' href='#'>");st.append(n.Msg.getMsg("Type"));it.append(st);it.on("click",function(){});c.append(it);rt=t("<li role='presentation'>");ht=t("<a role='menuitem' tabindex='-1' href='#'>");ht.append(n.Msg.getMsg("Size"));rt.append(ht);rt.on("click",function(){});c.append(rt);ut=t("<li role='presentation'>");ct=t("<a role='menuitem' tabindex='-1' href='#'>");ct.append(n.Msg.getMsg("Name"));ut.append(ct);ut.on("click",function(){});c.append(ut);d=t("<div class='vis-attach-content-wrap' style='display:none;border-bottom: 0px;padding-bottom:0px'>");e.append(d);e.append(at);ft=t("<div class='pull-right' style='height:40px;overflow:auto;margin-top: 5px;'>");at.append(ft);vt=t("<a title='"+n.Msg.getMsg("Upload")+"' href='javascript:void(0)'  class='vis-attach-ico vis-uploadall-ico' style='height:30px;width:30px;margin-right: 7px;' >");ft.append(vt);vt.on("click",function(){yi()});bt=t("<a title='"+n.Msg.getMsg("Cancel")+"' href='javascript:void(0)'  class='vis-attach-ico vis-cancelall-ico' style='margin-right: 10px;height:30px;width:30px;'>");ft.append(bt);bt.on("click",function(){d.empty();yt=[];b=[];d.hide();at.hide();tt.css("height","356px")});if(pt=t("<div class='vis-old-attachments'>"),g.append(pt),tt=t("<div class='vis-attach-content-wrap' style='height:356px;'>"),pt.append(tt),f!=null&&(r=f.AD_Attachment_ID),f!=null&&f._lines!=null){r=f.AD_Attachment_ID;for(kt in f._lines)oi(f._lines[kt],kt)}dt=t("<div class='vis-attach-footer'>");g.append(dt);et=t("<div class='vis-attach-btns pull-right' style='margin-top: 5px;'>");dt.append(et);gt=t('<a title="'+n.Msg.getMsg("DeleteAll")+'" class="vis-btn" style="margin-left: 5px;cursor: pointer;">').append(n.Msg.getMsg("DeleteAll"));et.append(gt);gt.on("click",function(){k.length==0||s||n.ADialog.confirm("DeleteRecord?",!0,"","Confirm",function(i){var r,u;if(i){r="";for(u in k)r+=k[u].Line_ID+",";l[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Attachment/DeleteAttachment",dataType:"json",data:{AttachmentLines:r},error:function(){n.ADialog.info("ERRORDeletingFile");l[0].style.visibility="hidden"},success:function(t){t.result==-1?n.ADialog.info("ErrorDeletingFile"):(tt.empty(),k=[]);l[0].style.visibility="hidden"}})}})});ni=t('<a title="'+n.Msg.getMsg("Cancel")+'" class="vis-btn"  style="margin-left: 5px;cursor: pointer;">').append(n.Msg.getMsg("Cancel"));ni.on("click",function(){wt.onClose&&wt.onClose();fi()});et.append(ni);ui=!0;l[0].style.visibility="hidden"}}))}var ui=!1,d=null,pt=null,tt=null,lt=null,r=0,wt,et,ot,c,v,y,p,w,nt,g,it,rt,ut,ft,l,gt,bt,st,kt,ni,a;o||(o=0);h||(h=!1);s||(s=!1);this.onClose=null;wt=this;et=null;et=n.Application.isRTL?t("<div style='margin-right: -14px;margin-left: -3px;margin-top: -5px;overflow:hidden;width:100%;height:100%;'>"):t("<div style='margin-right: -3px;margin-left: -14px;margin-top: -5px;overflow:hidden;width:100%;height:100%;'>");ot=t("<ul style='height:30px;display:none;list-style:none;width:97%;margin-left:-41px'>");c=t("<li>");c.css("float","left");c.css("margin","1px");c.css("padding","5px");c.css("display","block");c.css("position","relative");c.css("font-weight","700");c.css("border","0px");c.css("border-bottom","none");c.css("border-width","1px");c.css("color","#999");c.css("cursor","default");c.css("height","35px");c.css("margin-bottom","-1px");c.css("margin-right","5px");c.css("border-top-left-radius","3px");c.css("border-top-right-radius","3px");c.append(n.Msg.getMsg("FileAttachment"));ot.append(c);v=t("<li>");v.css("float","left");v.css("margin","1px");v.css("padding","5px");v.css("display","block");v.css("position","relative");v.css("font-weight","700");c.css("border","0px");v.css("border-bottom","none");v.css("border-width","1px");v.css("color","#999");v.css("cursor","default");v.css("height","35px");v.css("margin-bottom","-1px");v.css("margin-right","5px");v.css("border-top-left-radius","3px");v.css("border-top-right-radius","3px");v.append(n.Msg.getMsg("InboxMailAttachment"));ot.append(v);y=t("<li>");y.css("float","left");y.css("margin","1px");y.css("padding","5px");y.css("display","block");y.css("position","relative");y.css("font-weight","700");c.css("border","0px");y.css("border-bottom","none");y.css("border-width","1px");y.css("color","#999");y.css("cursor","default");y.css("height","35px");y.css("margin-bottom","-1px");y.css("margin-right","5px");y.css("border-top-left-radius","3px");y.css("border-top-right-radius","3px");y.append(n.Msg.getMsg("SentMailAttachment"));ot.append(y);p=t("<li>");p.css("float","left");p.css("margin","1px");p.css("padding","5px");p.css("display","block");p.css("position","relative");p.css("font-weight","700");c.css("border","0px");p.css("border-bottom","none");p.css("border-width","1px");p.css("color","#999");p.css("cursor","default");p.css("height","35px");p.css("margin-bottom","-1px");p.css("margin-right","5px");p.css("border-top-left-radius","3px");p.css("border-top-right-radius","3px");p.append(n.Msg.getMsg("Letter"));ot.append(p);w=t("<li>");w.css("float","left");w.css("margin","1px");w.css("padding","5px");w.css("display","block");w.css("position","relative");w.css("font-weight","700");c.css("border","0px");w.css("border-bottom","none");w.css("border-width","1px");w.css("color","#999");w.css("cursor","default");w.css("height","35px");w.css("margin-bottom","-1px");w.css("margin-right","5px");w.css("border-top-left-radius","3px");w.css("border-top-right-radius","3px");w.append(n.Msg.getMsg("Appointments"));ot.append(w);et.append(ot);nt=t("<div>");nt.css("width","98%");nt.css("height","98%");nt.css("position","absolute");nt.css("border","0px");nt.css("margin-top","2px");g=t("<div>");g.css("width","100%");g.css("height","100%");g.css("position","absolute");nt.append(g);it=t("<div>");it.append("Inbox Mail Att");it.css("width","100%");it.css("height","100%");it.css("position","absolute");nt.append(it);rt=t("<div>");rt.append("SENT MAIL Att");rt.css("width","100%");rt.css("height","100%");rt.css("position","absolute");nt.append(rt);ut=t("<div>");ut.append("Leter Att");ut.css("width","100%");ut.css("height","100%");ut.css("position","absolute");nt.append(ut);ft=t("<div>");ft.append("Appointment Att");ft.css("width","100%");ft.css("height","100%");ft.css("position","absolute");nt.append(ft);l=t("<div class='vis-apanel-busy'>");l.css("width","100%");l.css("height","100%");l.css("text-align","center");l.css("position","absolute");nt.append(l);gt=t("<div style='width: 100%;height: 100%;background:black;opacity: .1;display:none; position:absolute;'>");nt.append(gt);bt=t("<div style='width: 100%;height: 100%;background:transparent;text-align: center;display:none ;vertical-align: middle;position:absolute;'>");nt.append(bt);st=null;st=n.Application.isRTL?t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:41%;width: 80%;right: 9%;'>"):t("<div id='progress_bar' class='vis-ui-progress-bar vis-ui-container' style='top:41%;width: 80%;left: 9%;'>");kt=t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute'>");ni=t("<span class='vis-ui-label'  style='position:absolute'>").append("0%");kt.append(ni);st.append(kt);bt.append(st);et.append(nt);g[0].style.visibility="visible";it[0].style.visibility="hidden";rt[0].style.visibility="hidden";ut[0].style.visibility="hidden";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";c.css("background","#fff");c.css("color","#0088CC");a=function(n,t){t?(n.css("background","#fff"),n.css("color","#0088CC")):(n.css("background","#eee"),n.css("color","#999"))};c.on("click",function(){g[0].style.visibility="visible";it[0].style.visibility="hidden";rt[0].style.visibility="hidden";ut[0].style.visibility="hidden";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";a(c,!0);a(v,!1);a(y,!1);a(p,!1);a(w,!1);ei()});v.on("click",function(){g[0].style.visibility="hidden";it[0].style.visibility="visible";rt[0].style.visibility="hidden";ut[0].style.visibility="hidden";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";a(c,!1);a(v,!0);a(y,!1);a(p,!1);a(w,!1)});y.on("click",function(){g[0].style.visibility="hidden";it[0].style.visibility="hidden";rt[0].style.visibility="visible";ut[0].style.visibility="hidden";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";a(c,!1);a(v,!1);a(y,!0);a(p,!1);a(w,!1)});p.on("click",function(){g[0].style.visibility="hidden";it[0].style.visibility="hidden";rt[0].style.visibility="hidden";ut[0].style.visibility="visible";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";a(c,!1);a(v,!1);a(y,!1);a(p,!0);a(w,!1)});w.on("click",function(){g[0].style.visibility="hidden";it[0].style.visibility="hidden";rt[0].style.visibility="hidden";ut[0].style.visibility="hidden";ft[0].style.visibility="visible";l[0].style.visibility="hidden";a(c,!1);a(v,!1);a(y,!1);a(p,!1);a(w,!0)});this.show=function(){g[0].style.visibility="visible";it[0].style.visibility="hidden";rt[0].style.visibility="hidden";ut[0].style.visibility="hidden";ft[0].style.visibility="hidden";l[0].style.visibility="hidden";a(c,!0);a(v,!1);a(y,!1);a(p,!1);a(w,!1);ei();et.dialog({width:841,height:502,title:n.Msg.getMsg("Attachment"),resizable:!1,modal:!0,close:li})};var at=t("<div style='width:100%;overflow: auto;margin-top: 5px;border-bottom: 2px solid #eee;display:none;float: left;'>"),b=[];var ai=function(){t.ajax({url:n.Application.contextUrl+"Attachment/GetAttachment",dataType:"json",data:{AD_Table_ID:u,Record_ID:f},error:function(){n.ADialog.info("ERRORGettingAttachment");l[0].style.visibility="hidden"},success:function(n){var t=n.result.Attachment,i;if(t!=null&&(r=t.AD_Attachment_ID),t!=null&&t._lines!=null){r=t.AD_Attachment_ID;for(i in t._lines)oi(t._lines[i],i)}l[0].style.visibility="hidden"}})},vi=function(i){for(var r=[],u,l,o,a,v,s,y,g,w,c,f,it,e=0;e<i.files.length;e++){if(file=i.files[e],file==undefined)return;if(file.name.indexOf("&")>-1||file.name.indexOf("?")>-1||file.name.indexOf("#")>-1||file.name.indexOf("/")>-1||file.name.indexOf("\\")>-1){r.push(file.name);continue}for(u in b)if(file.name==b[u].name){window.setTimeout(function(){n.ADialog.info("AlreadyExists")},20);return}if(k!=null)for(u in k)if(file.name==k[u].Name&&!k[u].IsDeleted){window.setTimeout(function(){n.ADialog.info("AlreadyExists")},20);return}l={};o=t("<div class='vis-attach-file-wrapla'>");d.append(o);a=t("<div class='vis-attach-file-top'>");v=t("<a class='vis-file-close-ico'>");a.append(v);o.append(a);d.show();at.show();v.on("click",function(){var n=t(t(this).parent()).parent(),r,i;n.css("display","none");r=n.html();n.empty();n=null;for(i in b)if(String(r).indexOf(b[i].name)>-1){b.splice(i,1);break}b.length>4?(d.css("height","153px"),tt.css("height","153px")):(d.css("height","97px"),tt.css("height","209px"));b.length==0&&(d.hide(),at.hide(),d.css("height","0px"),tt.css("height","356px"))});s=t("<div class='vis-attach-file-content'>");o.append(s);y=t("<div class='vis-attach-file-icon'>");g=ci(file.name);y.append(t("<img src='"+g+"'>"));s.append(y);var p=t("<div class='vis-attach-file-text' style='margin-bottom:10px'>"),nt="",h=t("<p>");file.name.length>17?(nt=file.name.toString().substr(0,17),h.append(nt),w=t("<a href='#' class='VIS_Pref_tooltip'>").append("..."),c=t("<span style='width: inherit;'>"),c.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/ccc.png").append("ToolTip Text")),c.append(t("<label class='VIS_Pref_Label_Font'>").append(file.name)),w.append(c),h.append(w)):h.append(file.name);p.append(h);p.append(t("<p>").append((Number(file.size)/1024).toFixed(2)+"KB"));s.append(p);l.Name=file.name;l.Size=file.size;b.push(file);b.length>4?(d.css("height","153px"),tt.css("height","153px")):(d.css("height","97px"),tt.css("height","209px"))}if(r.length>0){f="";for(it in r)f+=r[it].toString()+"\n";f+=r.length==1?"File has":"Files have";f+=" invalid name. Please change the file name and try again.";n.ADialog.info(f)}},k=[],oi=function(i,r){var w=t("<div class='vis-attach-file-wrap'>"),u,f,c,v,o,h,y,p;tt.append(w);u={};f=t("<div class='vis-attach-file-content'  style='padding-top:5px;padding-bottom:5px;'>");w.append(f);c=t("<div class='vis-attach-file-icon'>");c.append(t("<img src='"+ci(i.FileName)+"'>"));f.append(c);var a=t("<div class='vis-attach-file-text'>"),b="",e=t("<p>");i.FileName.length>17?(b=i.FileName.toString().substr(0,17),e.append(b),v=t("<a href='#' class='VIS_Pref_tooltip'>").append("..."),o=t("<span style='width: inherit;'>"),o.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/ccc.png").append("ToolTip Text")),o.append(t("<label class='VIS_Pref_Label_Font'>").append(i.FileName)),v.append(o),e.append(v)):e.append(i.FileName);a.append(e);a.append(t("<p>").append((Number(i.Size)/1024).toFixed(2)+"KB"));f.append(a);h=t("<div class='vis-attach-BottomRight'>");y=t("<a href='javascript:void(0)'  class='vis-attach-ico vis-download-ico' data-id='"+r+"'>");h.append(y);y.on("click",function(){var n=t(this).data("id");k[n].HaveSource?window.open(k[r].Source,"_blank"):pi(n,this)});p=t("<a class='vis-attach-ico vis-delete-ico' data-id='"+r+"'>");h.append(p);p.on("click",function(){if(s)return!1;var i=t(this);n.ADialog.confirm("DeleteRecord?",!0,"","Confirm",function(r){if(r){var u=i.data("id");l[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Attachment/DeleteAttachment",dataType:"json",data:{AttachmentLines:k[u].Line_ID},error:function(){n.ADialog.info("ERRORDeletingFile");l[0].style.visibility="hidden"},success:function(t){if(t.result==-1)n.ADialog.info("ErrorDeletingFile");else{var r=i.parent().parent().parent();r.css("display","none");r.empty();r=null;k[u].IsDeleted=!0}l[0].style.visibility="hidden"}})}})});f.append(h);u.Name=i.FileName;u.Size=i.Size;u.Line_ID=i.Line_ID;u.HaveSource=!1;u.Source=null;u.IsDeleted=!1;k.push(u)},ti=0,ht=0,si=Date.now().toString(),ct=1048576,ii=0,vt=0,yt=[],yi=function(){var n=null,t,r,i;dt(!0);t=0;r=0;for(i in b)t=parseInt(b[i].size/ct),file.size%ct>0&&t++,ii+=t,n={},n.Name=b[i].name,n.Size=b[i].size,yt.push(n);hi()},hi=function(){var i,e,s;if(b==null||b.length==0){dt(!1);n.ADialog.info("NothingToUpload");return}if(ht>=b.length){t.ajax({url:n.Application.contextUrl+"Attachment/SaveAttachmentEntries",dataType:"json",type:"POST",data:{files:JSON.stringify(yt),AD_Attachment_ID:r,folderKey:si,AD_Table_ID:u,Record_ID:f,fileLocation:lt.val(),NewRecord_ID:o,IsDMSAttachment:h},error:function(){dt(!1);yt=[];l[0].style.visibility="hidden"},success:function(i){var f=i.result.Error,r,e,u;f==""?(h&&(r=t(".vis-old-attachments").find(".vis-attach-file-wrap"),r.length>1&&t(r[0]).remove()),ri(100),window.setTimeout(function(){dt(!1)},500),yt=[],e="transfer",u={},u={to:tt,className:"vis-Att-ui-effects-transfer"},d.effect(e,u,500,function(){window.setTimeout(function(){k=[];tt.empty();ai();b=[];d.empty();d.hide();at.hide();d.css("height","0px");tt.css("height","356px");kt.css("width","O%")},500)})):(yt=[],dt(!1),n.ADialog.info(f));ti=0;ht=0;ii=0;vt=0;l[0].style.visibility="hidden"}});return}i=new XMLHttpRequest;e=new FormData;e.append("file",b[ht].slice(vt*ct,vt*ct+Number(ct)));i.open("POST",n.Application.contextUrl+"Attachment/SaveFileinTemp/?filename="+b[ht].name+"&folderKey="+si,!1);i.send(e);ti++;vt++;s=parseInt(b[ht].size/ct);b[ht].size%ct>0&&s++;vt==s&&(ht++,vt=0);ti<=ii&&ri(parseInt(ti/ii*80));window.setTimeout(function(){hi()},2)},dt=function(n){n?(gt.show(),st.show(),bt.show()):(gt.hide(),st.hide(),bt.hide())},wi=function(t,i,r,u,f){var o,c,e,s,h;for(progresBar.attr("value",0),o=parseInt(t.size/r),t.size%r>0&&o++,c=!1,e=0;e<o;e++)e==o-1&&t.size%r>0&&(r=t.size%r),c=!0,s=new XMLHttpRequest,h=new FormData,h.append("file",t.slice(e*r,e*r+Number(r))),s.open("POST",n.Application.contextUrl+"Attachment/SaveFileinTemp/?filename="+t.name+"&folderKey="+i,!1),s.send(h),u++,ri(parseInt(u/f*80))},pi=function(i){l[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Attachment/DownloadAttachment",dataType:"json",data:{fileName:k[i].Name,AD_Attachment_ID:r,AD_AttachmentLine_ID:k[i].Line_ID},error:function(){n.ADialog.info("ERRORGettingFile");l[0].style.visibility="hidden"},success:function(t){var u=new Date,f=t.result,r=n.Application.contextUrl+"TempDownload/"+f+"/"+k[i].Name+"?"+u.getTime(),e=k[i].Name;k[i].HaveSource=!0;l[0].style.visibility="hidden";window.open(r,"_blank");k[i].Source=r}})},bi=function(){iFrame!=null&&(iFrame.css("visibility","visible"),viewer.css("visibility","visible"),g.css("visibility","collapse"))},ri=function(n){kt.css("width",n+"%");ni.empty();ni.append(n+"%")},ki=function(n){return st.each(function(){t(this).animate({width:n+"%"},{duration:2e3,easing:"swing",step:function(n){var i=t(".ui-label",this),r=t(".value",i);Math.ceil(n)<20&&t(".ui-label",this).is(":visible")?i.hide():i.is(":hidden")&&i.fadeIn();Math.ceil(n)==100?(i.text("Done"),setTimeout(function(){i.fadeOut()},1e3)):r.text(Math.ceil(n)+"%")}})})},ci=function(t){var r,u,i;return t==null||t.length==0?"":(r=t.lastIndexOf("."),u=n.Application.contextUrl+"Areas/VIS/Images/",r<1)?u+"defult.png":(i=t.substr(r,t.length-r),u+(i==".xlsx"||i==".xls"?"excel.png":i==".html"||i==".htm"?"html.png":i==".pdf"?"pdf.png":i==".ppt"?"ppt.png":i==".txt"?"text.png":i==".docx"||i==".doc"?"word.png":i==".xml"?"xml.png":i==".jpg"||i==".gif"||i==".png"?"image.png":i==".mp3"?"audio.png":i==".zip"||i==".rar"?"compresed.png":"defult.png"))}}n.attachmentForm=i}(VIS,jQuery),function(n,t){function i(i,r,u,f,e){function ti(i){var r,u,f,s;i||(ct=t('<div class="wfactivity-homepage-parentdiv"><\/div>'),r=t(' <div class="frm-data-col-wrap frm-data-col-2" style="padding-right: 10px;"> <div class="frm-data-search-wrap"><input class="frm-data-col-searchinput" id="homeSearchWorkflow" type="text" placeholder="'+n.Msg.getMsg("Search")+'"><input type="button" id="btnWorkflowSearch" class="vis-wfSearch-btn"><\/div><\/div>'),nt=r.find("#homeSearchWorkflow"),bt=r.find("#btnWorkflowSearch"),u=t(' <div class="frm-data-col-wrap frm-data-col-2" style="padding-left: 7px"> <div class="frm-data-search-wrap"><select><\/select><\/div><\/div>'),a=u.find("select"),f=t('<div style="display:none;padding-left: 7px" class="frm-data-col-wrap frm-data-col-2"> <label>'+n.Msg.getMsg("FromDate")+'<\/label><input type="date" placeholder="date"><\/div>'),tt=f.find("input"),s=t('<div  style="display:none;padding-right:10px" class="frm-data-col-wrap frm-data-col-2"><label>'+n.Msg.getMsg("ToDate")+'<\/label><input type="date" placeholder="date"><\/div>'),y=s.find("input"),ct.append(u).append(r).append(f).append(s),k=t('<div class="frm-select-all-check"  style="display:none"><\/div>'),h=t('<input type="checkbox">'),k.append("<label>"+n.Msg.getMsg("SelectAll")+"<\/label>"),k.append(h),e.addClass("vis-wfSearchIcon"),e.removeClass("vis-wfSearchIconMinus"),e.attr("title",n.Msg.getMsg("ShowSearch")));kt();o=t('<div class="wfactivity-homepage-activites" style="padding-right:0px"><\/div>')}function kt(i){t.ajax({url:n.Application.contextUrl+"WFActivity/GetWorkflowWindows",dataType:"json",type:"POST",error:function(){return},success:function(t){var u,r;if(t)if(t=JSON.parse(t),a.empty(),a.append('<option value="0_0">'+n.Msg.getMsg("SelectWindow")+"<\/option>"),t&&t.length>0){for(u=!1,r=0;r<t.length;r++)a.append('<option value="'+t[r].AD_Window_ID+"_"+t[r].AD_Node_ID+'">'+t[r].WindowName+"<\/option>"),t[r].AD_Window_ID+"_"+t[r].AD_Node_ID==rt&&(u=!0);rt&&u?a.val(rt):(rt="0_0",a.val("0_0"))}else rt="0_0",a.val("0_0");i&&ht()}})}function ii(i){a.off("change");a.on("change",ui);o.on("scroll",fi);if(!i){bt.on("click",function(){w&&(w=!1,ht())});nt.on("keydown",function(n){n.keyCode==13&&w&&(w=!1,ht())});e.on("click",function(){y.is(":visible")?(t(tt.parent()).css("display","none"),t(y.parent()).css("display","none"),tt.val(""),y.val(""),e.attr("title",n.Msg.getMsg("ShowSearch")),e.addClass("vis-wfSearchIcon"),e.removeClass("vis-wfSearchIconMinus"),h.is(":visible")?o.css("top","65px"):o.css("top","47px")):(t(tt.parent()).css("display","block"),t(y.parent()).css("display","block"),e.attr("title",n.Msg.getMsg("HideSearch")),e.removeClass("vis-wfSearchIcon"),e.addClass("vis-wfSearchIconMinus"),h.is(":visible")?o.css("top","118px"):o.css("top","98px"))});h.on("click",ri)}}function ri(){var i=o.find(".wfActivity-selectchk"),n;for(h.prop("checked")==!1&&(vt=!0),h.prop("checked")==!0&&(st=!0),n=0;n<i.length;n++)h.prop("checked")==!0?t(i[n]).prop("checked")==!1&&t(i[n]).trigger("click"):t(i[n]).prop("checked")==!0&&t(i[n]).trigger("click");vt=!1;h.prop("checked")==!1&&t(o.find(".vis-activityContainer")[0]).trigger("click")}function ui(){ft.hide();r.empty();a.val()=="0_0"?(k.hide(),h.prop("checked")==!0&&h.trigger("click"),y.is(":visible")?o.css("top","98px"):o.css("top","47px")):(k.hide(),y.is(":visible")?o.css("top","118px"):o.css("top","67px"));rt=a.val();ht()}function ht(){it=1;et=10;ft.hide();r.empty();o.empty();s=[];s.length=0;wt.AppendRecord(it,et,!0)}function fi(){if(t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight)if(lt=parseInt(b.html()),at=it*et,at<=lt)it+=1,wt.AppendRecord(it,et);else return}function pt(){var n=o.find('input[class="wfActivity-selectchk"]:checked').length,t=o.find(".wfActivity-selectchk").length;t==n&&h.prop("checked",!0)}var c=null,l=[],g=[],wt=this,ct=null,k=null,nt=null,bt=null,tt=null,y=null,o=null,a=null,h=null,it=1,et=10,lt=0,at=0,v=0,rt="0_0",ot=0,w=!0,st=!1,vt=!1,s=[],p=t("#divTabMenuDataLoder"),ut=t("#hAlrtTxtTypeCount"),b=t("#divfActivity"),ft=t("#workflowActivity"),yt,dt;this.Load=function(r){h&&h.prop("checked")==!1&&ft.hide();i.children().last().remove();p.show();it=1;et=10;lt=0;at=0;ti(r);s=[];r?(i.find(".wfactivity-homepage-activites").remove(),i.append(o)):i.append(ct).append(k).append(o);ii(r);v=a.val();v&&v!="0_0"?(ot=v.split("_")[1],v=v.split("_")[0],y.is(":visible")?i.find(".wfactivity-homepage-activites").css("top","118px"):i.find(".wfactivity-homepage-activites").css("top","68px")):(ot=0,v=0,y.is(":visible")?i.find(".wfactivity-homepage-activites").css("top","98px"):i.find(".wfactivity-homepage-activites").css("top","47px"));t.ajax({url:n.Application.contextUrl+"WFActivity/GetActivities",data:{pageNo:1,pageSize:10,refresh:!0,searchText:nt.val(),AD_Window_ID:v,dateFrom:tt.val(),dateTo:y.val(),AD_Node_ID:ot},dataType:"json",type:"POST",error:function(){p.hide();n.HomeMgr.BindMenuClick();return},success:function(t){nt.val("");window.setTimeout(function(){n.HomeMgr.BindMenuClick();var u=n.HomeMgr.getActiveTab();if(u.activeTabType==3){if(t.result==null||t.result.LstInfo==null){p.hide();b.empty();b.append(0);b.show();ut.empty();ut.append(0);str="<p  id='pnorecFound' style=' margin-top:200px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"<\/p>";i.find("#pnorecFound").remove();o.empty();i.append(str);return}c=t.result.LstInfo;o.empty();r==!0&&(g=[],l=[]);b.empty();b.append(t.result.count);b.show();ut.empty();ut.append(t.result.count);yt(0);n.HomeMgr.adjustDivSize()}else return},100)}})};this.AppendRecord=function(r,u,f){f||(f=!1);p.show();v=a.val();ot=v.split("_")[1];v=v.split("_")[0];t.ajax({url:n.Application.contextUrl+"WFActivity/GetActivities",data:{pageNo:r,pageSize:u,refresh:f,searchText:nt.val(),AD_Window_ID:v,dateFrom:tt.val(),dateTo:y.val(),AD_Node_ID:ot},dataType:"json",type:"POST",error:function(){p.hide();n.HomeMgr.BindMenuClick();w=!0;return},success:function(t){var u,e;if(nt.val(""),n.HomeMgr.BindMenuClick(),u=n.HomeMgr.getActiveTab(),u.activeTabType==3)c=t.result?t.result.LstInfo:null,f==!0&&(g=[],l=[],b.empty(),o.empty(),t.result?(i.find("#pnorecFound").remove(),b.append(t.result.count)):(ut.empty(),ut.append(0),e="<p id='pnorecFound' style=' margin-top:200px;text-align: center'>"+n.Msg.getMsg("NoRecordFound")+"<\/p>",i.find("#pnorecFound").remove(),i.append(e),b.append(0))),yt(r-1),n.HomeMgr.adjustDivSize();else{w=!0;return}}})};yt=function(i){var u=null,r,f,d,e,et,tt;if(c==null||c.length==0){p.hide();k.hide();h.prop("checked",!1);w=!0;return}a.val()!="0_0"?(y.is(":visible")?o.css("top","118px"):o.css("top","67px"),k.show()):(y.is(":visible")?o.css("top","98px"):o.css("top","47px"),k.hide(),h.prop("checked",!1));for(r in c){l.push(c[r]);f={};u=t("<div class='vis-activityContainer' data-id='"+(Number(10*i)+Number(r))+"'>");u.on("click",function(n){var u,i,r,f;if(t(".vis-activityContainer").removeClass("vis-activeFeed"),t(this).addClass("vis-activeFeed"),u=t(n.target).data("viswfazoom"),u=="wfZoom"){t(this).addClass("vis-activeFeed");i=t(n.target).data("index");ni(i);w=!0;return}(i=t(this).data("id"),r=!0,s.length<=1&&h.prop("checked")==!0&&(r=!1),f=t(this).find(".wfActivity-selectchk").data("ids"),s.length!=1||f==s[0])&&(oi(g[i].wfActivityID,i,this,r),w=!0)});var v=t("<div class='vis-feedTitleBar'>"),nt=t('<input class="wfActivity-selectchk" type="checkbox" style="float:left;margin-top:15px" data-ids="'+c[r].AD_Window_ID+"_"+c[r].AD_Node_ID+"_"+c[r].AD_WF_Activity_ID+'" ><\/input>'),b=t("<h3>");b.css("font-weight","normal");b.css("color","#1b95d7");b.append(n.Utility.encodeText(c[r].NodeName));a&&a.val()!="0_0"&&v.append(nt);v.append(b);var it=t("<div class='vis-feedTitleBar-buttons'>"),rt=t("<ul>"),ut=t("<li>"),ft=t("<a href='javascript:void(0)' class='vis-feedIcons vis-icon-viewFeed' data-index='"+(Number(10*i)+Number(r))+"' data-viswfazoom='wfZoom' >");ft.append("View Feed");ut.append(ft);rt.append(ut);it.append(rt);v.append(it);u.append(v);d=t("<div class='vis-feedDetails'>");e=t("<p>");e.append(n.Utility.encodeText(c[r].Summary));et=t("<br>");e.append(et);e.append(n.Utility.encodeText(n.Msg.getMsg("Priority")+" "+c[r].Priority));d.append(e);nt.on("click",function(n){var i=t(n.target);dt(i,n)});tt=t("<div class='vis-feedDateTime'>");tt.append(t("<br>")).append(Globalize.format(new Date(c[r].Created),"d"));d.append(tt);u.append(d);o.append(u);f.ctrl=u;f.index=r;f.recordID=c[r].Record_ID;f.wfActivityID=c[r].AD_WF_Activity_ID;g.push(f);h.prop("checked")==!0&&(nt.trigger("click"),l.length==1)}w=!0;p.hide()};dt=function(n,i){var f=n.data("ids"),e,c,u,r;if(n.prop("checked")==!1&&(h.prop("checked",!1),st=!1),n.prop("checked")==!0)if(s.length==0)s.push(n.data("ids")),st=!1,pt();else if(e=s[0].split("_"),c=f.split("_"),e[0]+"-"+e[1]==c[0]+"-"+c[1])s.push(f),h.prop("checked")!=!0||st||i.stopPropagation(),st=!1,pt();else return pt(),i.preventDefault(),!1;else{if(s=jQuery.grep(s,function(n){return n!=f}),s.length==1&&!vt)for(u=o.find(".wfActivity-selectchk"),r=0;r<u.length;r++)if(t(u[r]).prop("checked")==!0){t(u[r]).parent().trigger("click");i.stopPropagation();return}if(s.length>=0||h.prop("checked")==!0)return i.stopPropagation(),!1}n.prop("checked")==!0};var ei=function(){var i=t(window).width(),r=t(".row.scrollerHorizontal > div").length,u,n,f;r=r-1;t(".scrollerHorizontal").width(i);u=i/r-20;n=parseInt(u);i>=1366&&(ft.css("display")=="none"?(t("#fllupsScreen").css("left",n+20),t("#favLinks").css("left",n*2+40),t("#welcomeScreen,#fllupsScreen,#favLinks").width(n)):ft.css("display")=="block"&&(f=i+n+20,t(".scrollerHorizontal").width(f),t("#workflowActivity").css("left",n+20),t("#fllupsScreen").css("left",n*2+40),t("#favLinks").css("left",n*3+60),t("#welcomeScreen,#fllupsScreen,#favLinks,#workflowActivity").width(n)))},d=[],oi=function(i,u,f,e){p.show();t.ajax({url:n.Application.contextUrl+"WFActivity/GetActivityInfo",dataType:"json",type:"POST",async:e,data:{activityID:i,nodeID:l[u].AD_Node_ID,wfProcessID:l[u].AD_WF_Process_ID},error:function(){p.hide();return},success:function(e){if(s.length<=1||h.prop("checked")==!0){ft.show();n.HomeMgr.adjustDivSize();var c="transfer",o={};o={to:r,className:"wsp-ui-effects-transfer"};window.setTimeout(function(){gt(i,u,e.result);t(f).effect(c,o,500,function(){})},400)}else s.length<=2&&gt(i,u,e.result),p.hide()}})},gt=function(i,u,f){var e={},it,ct,rt,lt,ut,ft,nt,at,vt,yt,pt,st,o,w,c,gt,tt,h,wt,et,ot,bt,kt,b,dt,a,ht,v,k,y,g;if(d=[],e.Index=u,r.empty(),it=t("<div class='vis-workflowActivityDetails-Heading'>"),r.append(it),ct=t("<h3>"),ct.append(n.Msg.getMsg("Detail")),it.append(ct),s.length<=1){rt=t("<a href='javascript:void(0)' class='vis-btn-zoom vis-icon-zoomFeedButton  vis-workflowActivityIcons' data-id='"+u+"'>");rt.append(t("<span class='vis-btn-ico vis-btn-zoom-bg vis-btn-zoom-border'>"));rt.append(n.Msg.getMsg("Zoom"));it.append(rt);rt.on(n.Events.onTouchStartOrClick,function(){var n=t(this).data("id");ni(n)})}if(it.append(t("<div class='clearfix'>")),lt=t("<ul class='vis-IIColumnContent'>"),r.append(lt),ut=t("<li>"),ut.css("width","100%"),ft=t("<p>"),ft.append(n.Msg.getMsg("Node")),ft.append(t("<br>")),ft.append(n.Utility.encodeText(l[u].NodeName)),ut.append(ft),lt.append(ut),s.length<=1&&(nt=t("<p>"),nt.css("margin-top","10px"),nt.append(n.Msg.getMsg("Summary")),nt.append(t("<br>")),nt.append(n.Utility.encodeText(l[u].Summary)),ut.append(nt)),r.append(t("<div class='clearfix'>")),at=t("<h4>"),at.append(n.Msg.getMsg("Description")),r.append(at),vt=t("<p>"),vt.append(n.Utility.encodeText(l[u].Description)),r.append(vt),r.append(t("<div class='clearfix'>")),yt=t("<h4>"),yt.append(n.Msg.getMsg("Help")),r.append(yt),pt=t("<p>"),pt.append(n.Utility.encodeText(l[u].Help)),r.append(pt),r.append(t("<h3>").append(n.Msg.getMsg("Action"))),r.append(t("<div class='clearfix'>")),st=t("<ul class='vis-IIColumnContent'>"),o=t("<li>"),st.append(o),o.append(t("<p>").append(n.Msg.getMsg("Answer"))),f.NodeAction=="C")w=hi(f,i),e.AnswerCtrl=w,w!=null&&(w.getBtnCount()>0?(h=t("<div>"),h.append(w.getControl().css("width","86%").css("margin-bottom","10px")),h.append(w.getBtn(0).css("width","14%").css("height","29px").css("padding","0px").css("border-color","#BBBBBB")),o.append(h)):o.append(w.getControl()),e.AnswerCtrl=w),e.Action="C";else if(f.NodeAction=="W"){c=t('<button style="margin-bottom:10px;margin-top: 0px;width: 100%;" class="VIS_Pref_pass-btn" data-id="'+u+'" data-window="'+f.AD_Window_ID+'" data-col="'+f.KeyCol+'">').append(f.NodeName);e.AnswerCtrl=c;o.append(c);c.on("click",function(){ci(t(this).data("id"),t(this).data("window"),t(this).data("col"))});e.Action="W"}else if(f.NodeAction=="X"){c=t('<button style="margin-bottom:10px;margin-top: 0px;width: 100%;" class="VIS_Pref_pass-btn" data-id="'+u+'" data-form="'+f.AD_Form_ID+'" data-col="'+f.KeyCol+'">').append(f.NodeName);e.AnswerCtrl=c;o.append(c);c.on("click",function(){n.viewManager.startForm(t(this).data("form"))});e.Action="X"}o.append(t("<p>").append(n.Msg.getMsg("Forward")));gt=n.MLookupFactory.get(n.context,0,0,n.DisplayType.Search,"AD_User_ID",0,!1,null);tt=new n.Controls.VTextBoxButton("AD_User_ID",!1,!1,!0,n.DisplayType.Search,gt);e.FwdCtrl=tt;tt.getBtn();tt.getBtnCount()==2&&(h=t("<div>"),h.append(tt.getControl().css("width","86%").css("margin-bottom","10px")),h.append(tt.getBtn(0).css("width","14%").css("height","29px").css("padding","0px").css("border-color","#BBBBBB")),o.append(h));wt=t("<li>");et=t("<a href='javascript:void(0)' class='vis-btn vis-btn-done vis-icon-doneButton vis-workflowActivityIcons' data-id='"+u+"'>");et.append(t("<span class='vis-btn-ico vis-btn-done-bg vis-btn-done-border'>"));et.append(n.Msg.getMsg("Done"));wt.append(et);et.on(n.Events.onTouchStartOrClick,function(){var n=t(this).data("id");si(n)});if(st.append(wt),r.append(st),r.append(t("<div class='clearfix'>")),r.append(t("<p>").append(n.Msg.getMsg("Message"))),r.append(t("<div class='clearfix'>")),ot=t("<div class='vis-sendMessage'>"),bt=t("<input type='text' placeholder='"+n.Msg.getMsg("TypeMessage")+"....'>"),e.MsgCtrl=bt,ot.append(bt),ot.append(t("<input  type='button' class='vis-feedIcons vis-icon-message'>")),ot.append(t("<div class='clearfix'>")),r.append(ot),d.push(e),s.length<=1&&(r.append(t("<h3>").append(n.Msg.getMsg("History"))),r.append(t("<div class='clearfix'>")),kt=t("<div class='vis-history-wrap'>"),r.append(kt),f.Node!=null)){b=t("<div style='margin-top:15px;margin-bottom:15px'>");for(node in f.Node)if(f.Node[node].History!=null){for(hNode in f.Node[node].History)f.Node[node].History[hNode].State=="CC"&&node<f.Node.length-1?(b.append(t("<div class='vis-vertical-img'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/home/4.jpg'>"))),a=t("<div class='vis-approved_wrap'>"),dt="",dt=f.Node[node].Name,v=t("<div class='vis-left-part'>"),f.Node[node].History[hNode].TextMsg.length>0&&(k=t("<a href='javascript:void(0)' class='VIS_Pref_tooltip' style='margin-right:5px'>").append(t("<img class='VIS_Pref_img-i'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/i.png")),y=t("<span>"),y.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/ccc.png").append("ToolTip Text")),y.append(t("<label class='VIS_Pref_Label_Font'>").append(n.Utility.encodeText(f.Node[node].History[hNode].TextMsg))),k.append(y),v.append(k)),v.append(dt),a.append(v),g=t("<div class='vis-right-part'>"),g.append(n.Msg.getMsg("CompletedBy")).append(t("<span class='vis-app_by'>").append(f.Node[node].History[hNode].ApprovedBy)),a.append(g),b.append(a)):node<f.Node.length-1||f.Node.length==1?(a=t("<div class='vis-pending_wrap' style='margin-top:-2px'>"),a.append(t("<div class='vis-left-part'>").append(f.Node[node].Name)),a.append(t("<div class='vis-right-part'>").append(n.Msg.getMsg("Pending"))),b.append(a)):(b.append(t("<div class='vis-vertical-img'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/home/4.jpg'>"))),ht=t("<div class='vis-start_wrap' style='margin-bottom:-8px'>"),v=t("<div class='vis-left-part'>"),f.Node[node].History[hNode].TextMsg.length>0&&(k=t("<a href='javascript:void(0)' class='VIS_Pref_tooltip' style='margin-right:5px'>").append(t("<img class='VIS_Pref_img-i'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/i.png")),y=t("<span >"),y.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/ccc.png").append("ToolTip Text")),y.append(t("<label class='VIS_Pref_Label_Font'>").append(n.Utility.encodeText(f.Node[node].History[hNode].TextMsg))),k.append(y),v.append(k)),v.append(f.Node[node].Name),ht.append(v),g=t("<div class='vis-right-part'>"),g.append(n.Msg.getMsg("CompletedBy")).append(t("<span class='vis-app_by'>").append(f.Node[node].History[hNode].ApprovedBy)),ht.append(g),b.append(ht));kt.append(b)}}p.hide()},ni=function(t){n.AEnv.wfzoom(l[t].AD_Table_ID,l[t].Record_ID,l[t].AD_WF_Activity_ID)},si=function(i){t("#divfeedbsy")[0].style.visibility="visible";window.setTimeout(function(){var r,e,u,f;for(r in d)try{if(i===d[r].Index){var h=d[r].FwdCtrl.getValue(),c=n.Utility.encodeText(d[r].MsgCtrl.val()),e=null;if(d[r].Action=="C"&&(e=d[r].AnswerCtrl.getValue()),u="",s&&s.length>0)for(f=0;f<s.length;f++)u.length>0&&(u+=","),u+=s[f].split("_")[2];else u=l[i].AD_WF_Activity_ID;n.dataContext.getJSONData(n.Application.contextUrl+"WFActivity/ApproveIt",{activityID:u,nodeID:l[i].AD_Node_ID,txtMsg:c,fwd:h,answer:e,AD_Window_ID:v},function(i){i.result==""?(t("#divfeedbsy")[0].style.visibility="hidden",o.empty(),ei(),d=[],s=[],p.show(),kt(!0)):(alert(n.Msg.getMsg(i.result)),t("#divfeedbsy")[0].style.visibility="hidden")});break}}catch(y){alert("FillManadatory");t("#divfeedbsy")[0].style.visibility="hidden"}},2)},hi=function(i,r){var f,e,u;return i.ColID==0?null:i.ColReference==n.DisplayType.YesNo?(u=n.MLookupFactory.get(n.context,0,0,n.DisplayType.List,i.ColName,319,!1,null),new n.Controls.VComboBox(i.ColName,!1,!1,!0,u,50)):i.ColReference==n.DisplayType.List?(u=n.MLookupFactory.get(n.context,0,0,n.DisplayType.List,i.ColName,i.ColReferenceValue,!1,null),new n.Controls.VComboBox(i.ColName,!1,!1,!0,u,50)):i.ColName.toUpperCase()=="C_GENATTRIBUTESETINSTANCE_ID"?(f=null,e=new n.MGAttributeLookup(n.context,0),t.ajax({url:n.Application.contextUrl+"WFActivity/GetRelativeData",async:!1,data:{activityID:r},dataType:"json",success:function(t){t.result&&(f=new n.Controls.VPAttribute("C_GenAttributeSetInstance",!0,!1,!0,n.DisplayType.PAttribute,e,0,!0,!1,!1,!1),f.SetC_GenAttributeSet_ID(t.result.GenAttributeSetID))}}),f):i.ColReference==n.DisplayType.TableDir?(u=n.MLookupFactory.get(n.context,0,0,n.DisplayType.TableDir,i.ColName,i.ColReferenceValue,!1,null),new n.Controls.VComboBox(i.ColName,!1,!1,!0,u,50)):i.ColReference==n.DisplayType.Search?(u=n.MLookupFactory.get(n.context,0,0,n.DisplayType.Search,i.ColName,i.ColReferenceValue,!1,null),new n.Controls.VTextBoxButton(i.ColName,!1,!1,!0,n.DisplayType.Search,u)):new n.Controls.VTextBox(i.ColName,!1,!1,!0,50,100,null,null,!1)},ci=function(t,i,r){var u=new n.Query;u.addRestriction(r,n.Query.prototype.EQUAL,l[t].Record_ID);n.viewManager.startWindow(i,u)};this.clear=function(){for(var n in g)g[n]=null}}n.wfActivity=i}(VIS,jQuery),function(n,t){function i(i,r,u){function rt(){st();ht();ut();ft(u)}function ut(){var f,c,i,l,t;f=n.Env.isBaseLanguage(y,"AD_Ref_List")?"SELECT Value, Name, Description FROM AD_Ref_List WHERE AD_Reference_ID=135 ORDER BY Name":"SELECT l.Value, t.Name, t.Description FROM AD_Ref_List l, AD_Ref_List_Trl t WHERE l.AD_Ref_List_ID=t.AD_Ref_List_ID AND t.AD_Language='"+n.Env.getAD_Language(y)+"' AND l.AD_Reference_ID=135 ORDER BY t.Name";var u=[],e=[],o=[];try{if(c=n.secureEngine.encrypt(f),i=n.dataContext.getJSONData(n.Application.contextUrl+"DocAction/GetReference",{RefQry:c},null),i!=null)for(t in i){var v=i[t].Value,p=i[t].Name,r=i[t].Description;(r==null||r=="undefined")&&(r="");u.push(v);e.push(p);o.push(r)}}catch(w){console.log(w)}for(l=u.length,s=[],h=[],a=[],t=0;t<l;t++)s.push(u[t]),h.push(e[t]),a.push(o[t])}function ft(u){var e,f,o,c;p=r.getValue("DocStatus");e=r.getValue("DocAction");f=r.getValue("Processing");f=f=="N"?!1:!0;o=y.getWindowContext(i,"OrderType");c=y.isSOTrx(i);t.ajax({url:n.Application.contextUrl+"DocAction/GetDocActions",type:"POST",dataType:"Json",data:{AD_Table_ID:d,Record_ID:u,docStatus:p,processing:f,orderType:o,isSOTrx:c,docAction:e,tableName:r.getTableName(),values:JSON.stringify(s),names:JSON.stringify(h),C_DocType_ID:r.getValue("C_DocType_ID"),C_DocTypeTarget_ID:r.getValue("C_DocTypeTarget_ID")},success:function(n){var t=JSON.parse(n);et(t);ot(t)}})}function et(t){if(k(!1),p=t.DocStatus,t.Error!=null&&t.Error!=""&&t.Error!="undefined"){n.ADialog.error(t.Error);return}if(t.DocStatus==null){v.text("*** ERROR ***");return}}function ot(t){for(var u,i,r=0;r<t.Index;r++)for(u=!1,i=0;i<s.length&&!u;i++)t.Options[r].equals(s[i])&&(e.append("<option >"+h[i]+"<\/option>"),u=!0);if(t.DefaultV!=null&&t.DefaultV!=""&&t.DefaultV!="undefined"&&e.val(t.DefaultV).change(),c.prop("disable",!1),o.getNumberOfOptions()==0){n.ADialog.info("InfoDocActionNoOptions","");o.log.info("DocAction - No Options");f.close();return}}function st(){var u=t("<tr>"),o=t("<tr>"),s=t("<tr>"),i=t("<td>"),h=t("<td>"),r;n.Application.isRTL?i.append('<span style="margin-right:3px">'+n.Msg.getMsg("DocAction")+"<\/span>"):i.append("<span >"+n.Msg.getMsg("DocAction")+"<\/span>");h.append(e);u.append(i).append(h);r=t('<td colspan="2">');r.append(v);o.append(r);$td31=t("<td>");$td32=t('<td style="text-align:right">');s.append($td31).append($td32);l.append(u).append(o).append(s);c.append(l);k(!0);c.append(w).append(b);f=new n.ChildDialog}function ht(){e.on("change",function(){var n=g();n!=-1&&a.length>0&&v.text(a[n])});f.onOkClick=function(){ct()&&(o.isOKPressed=!0,o.onClose&&o.onClose())};f.onCancelClick=function(){o.onClose&&o.onClose()}}function k(n){n?(w.show(),b.show(),c.find("button").prop("disabled",!0)):(w.hide(),b.hide(),c.find("button").prop("disabled",!1))}function g(){var t=-1,i,n;if(e.val()==null)return t;for(i=e.val(),n=0;n<h.length&&t==-1;n++)if(i.equals(h[n])){t=n;break}return t}function ct(){k(!0);var n=g();return n==-1?(k(!1),!1):(r.setValue("DocAction",s[n]),!0)}var y=n.Env.getCtx(),d=r.getAD_Table_ID(),s=[],h=[],a=[],p=null,nt=0,tt="",l,f,w,b;this.log=n.Logging.VLogger.getVLogger("VDocAction");var it,e=t('<select style="width:235px;margin-left:10px"><\/select>'),v=t('<p style="font-size:12px;margin-top:10px;margin-bottom:-5px"><\/p>'),c=t('<div style="margin-bottom:-5px"><\/div>'),o=this;this.batch=!1;this.isOKPressed=!1;l=t('<table style="width:360px;margin-bottom:9px">');f=null;this.onClose=null;w=t('<img src="'+n.Application.contextUrl+'Areas/VIS/Images/busy.gif"/>');b=t("<label>"+n.Msg.getMsg("Loading")+"<\/label>");n.Application.isRTL&&(e.css({"margin-left":"0px","margin-right":"10px"}),v.css({"margin-right":"3px"}));rt();this.getNumberOfOptions=function(){return e.children("option").length};this.isStartProcess=function(){return this.isOKPressed};this.isBatch=function(){return this.batch};this.show=function(){f.setContent(c);f.setTitle(n.Msg.getMsg("DocAction"));f.setModal(!0);f.show()};f.onClose=function(){o.dispose()};this.dispose=function(){f.close();f=null;d=null;s=null;h=null;a=null;p=null;nt=0;tt=null;it=null;e=null;v=null;c=null;o=null;l&&l.empty();l=null}}function r(){this.ACTION_COMPLETE="CO";this.ACTION_WAITCOMPLETE="WC";this.ACTION_APPROVE="AP";this.ACTION_REJECT="RJ";this.ACTION_POST="PO";this.ACTION_VOID="VO";this.ACTION_CLOSE="CL";this.ACTION_REVERSE_CORRECT="RC";this.ACTION_REVERSE_ACCRUAL="RA";this.ACTION_REACTIVATE="RE";this.ACTION_NONE="--";this.ACTION_PREPARE="PR";this.ACTION_UNLOCK="XL";this.ACTION_INVALIDATE="IN";this.ACTION_REOPEN="OP";this.STATUS_DRAFTED="DR";this.STATUS_COMPLETED="CO";this.STATUS_APPROVED="AP";this.STATUS_INVALID="IN";this.STATUS_NOTAPPROVED="NA";this.STATUS_VOIDED="VO";this.STATUS_REVERSED="RE";this.STATUS_CLOSED="CL";this.STATUS_UNKNOWN="??";this.STATUS_INPROGRESS="IP";this.STATUS_WAITINGPAYMENT="WP";this.STATUS_WAITINGCONFIRMATION="WC"}n.VDocAction=i;n.DocumentEngine=r}(VIS,jQuery),function(n,t){function i(){function n(n,i,r,u,f,e){if(window.WSP){var o=t("<div id='divAptBusy' class='wsp-busy-indicater'><\/div>");t("body").append(o);f==!1?(o.show(),WSP.AppointmentsForm.init(n,i,r,u,o,e)):(o.show(),WSP.TaskForm.init(n,i,r,u,o,e))}else alert("please download WSP !!!")}return{init:n}}n.AppointmentsForm=i()}(VIS,jQuery),function(n,t){function i(i,r,u){function fu(){var r=t("<div><\/div>"),dt=null,i,u,e,a,v,y,b,ft,vt,yt;dt=n.Application.isRTL?t('<p class="vis-payment-spanPayment-RTL"> '+n.Msg.translate(f,"PaymentMethod")+" <\/p>"):t('<p class="vis-payment-spanPayment"> '+n.Msg.translate(f,"PaymentMethod")+" <\/p>");dt.appendTo(r);p=t('<select class="vis-payment-cmbPayment"><\/select>');p.appendTo(r);r.appendTo(k);lt=t('<table class="vis-payment-table"><\/table>');i=t("<tr><\/tr>");lt.append(i);nr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"CreditCardType")+"<\/p>");tr=t('<p class="vis-payment-span">'+n.Msg.translate(f,"CreditCardNumber")+"<\/p>");ir=t('<p class="vis-payment-span">'+n.Msg.translate(f,"Expires")+"<\/p>");ur=t('<p class="vis-payment-span">'+n.Msg.translate(f,"VoiceAuthCode")+"<\/p>");pt=t('<p class="vis-payment-span">'+n.Msg.translate(f,"Online")+"<\/p>");wi=t('<p class="vis-payment-span"><\/p>');s=t('<table class="vis-payment-table"><\/table>');u=t("<tr><\/tr>");s.append(u);ut=t('<table class="vis-payment-table"><\/table>');u.append(ut);i.append(s);g=t('<select  class="vis-payment-cmb"><\/select>');var gt=t("<tr><\/tr>"),ii=t("<td ><\/td>"),ri=t('<td class="vis-payment-td2"><\/td>');ii.append(nr);ri.append(g);gt.append(ii).append(ri);ut.append(gt);d=t('<input class="vis-payment-inputs" type="text"><\/input>');var hi=t("<tr><\/tr>"),ci=t('<td class="vis-payment-td1"><\/td>'),li=t('<td class="vis-payment-td2"><\/td>');ci.append(tr);li.append(d);hi.append(ci).append(li);ut.append(hi);wt=t('<input class="vis-payment-inputs"  type="text"><\/input>');var ai=t("<tr><\/tr>"),vi=t('<td class="vis-payment-td1"><\/td>'),yi=t('<td class="vis-payment-td2"><\/td>');vi.append(ir);yi.append(wt);ai.append(vi).append(yi);ut.append(ai);bt=t('<input class="vis-payment-inputs"  type="text"><\/input>');var pi=t("<tr><\/tr>"),ar=t('<td class="vis-payment-td1"><\/td>'),vr=t('<td class="vis-payment-td2"><\/td>');ar.append(ur);vr.append(bt);pi.append(ar).append(vr);ut.append(pi);pt=t('<button class="vis-payment-inputs-buttons"  type="button">'+n.Msg.translate(f,"Online")+"<\/button>");e=t("<tr><\/tr>");a=t('<td colspan="2"><\/td>');a.append(pt);e.append(a);ut.append(e);rr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"C_BP_BankAccount_ID")+"<\/p>");bi=t('<p class="vis-payment-span"> <\/p>');h=t('<table class="vis-payment-table"><\/table>');v=t("<tr><\/tr>");si=t('<table class="vis-payment-table"><\/table>');h.append(v);v.append(si);i.append(h);et=t('<select class="vis-payment-cmb"><\/select>');var yr=t("<tr><\/tr>"),pr=t('<td class="vis-payment-td1"><\/td>'),wr=t('<td class="vis-payment-td2"><\/td>');pr.append(rr);wr.append(et);yr.append(pr).append(wr);si.append(yr);cr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"C_BankAccount_ID")+"<\/p>");gi=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"Amount")+"<\/p>");ti=t('<p class="vis-payment-span vis-payment-AmountField"> <\/p>');er=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"RoutingNo")+"<\/p>");fr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"AccountNo")+"<\/p>");hr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"CheckNo")+"<\/p>");ui=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"C_Currency_ID")+"<\/p>");ki=t('<p class="vis-payment-span"> <\/p>');ei=t('<button class="vis-payment-inputs-buttons"  type="button">'+n.Msg.translate(f,"Online")+"<\/button>");c=t('<table class="vis-payment-table"><\/table>');y=t("<tr><\/tr>");w=t('<table class="vis-payment-table"><\/table>');y.append(w);c.append(y);i.append(c);nt=t('<select class="vis-payment-cmb"><\/select>');var br=t("<tr><\/tr>"),kr=t('<td class="vis-payment-td1"><\/td>'),dr=t('<td class="vis-payment-td2"><\/td>');kr.append(cr);dr.append(nt);br.append(kr).append(dr);w.append(br);ti=t('<p class="vis-payment-span vis-payment-AmountField"> <\/p>');var gr=t("<tr><\/tr>"),nu=t('<td class="vis-payment-td1"><\/td>'),tu=t('<td class="vis-payment-td2"><\/td>');nu.append(gi);tu.append(ti);gr.append(nu).append(tu);w.append(gr);it=t('<input  class="vis-payment-inputs"  type="text"> <\/input>');var iu=t("<tr><\/tr>"),ru=t('<td class="vis-payment-td1"><\/td>'),uu=t('<td class="vis-payment-td2"><\/td>');ru.append(er);uu.append(it);iu.append(ru).append(uu);w.append(iu);tt=t('<input class="vis-payment-inputs"  type="text"> <\/input>');var fu=t("<tr><\/tr>"),eu=t('<td class="vis-payment-td1"><\/td>'),ou=t('<td class="vis-payment-td2"><\/td>');eu.append(fr);ou.append(tt);fu.append(eu).append(ou);w.append(fu);rt=t('<input class="vis-payment-inputs"  type="text"> <\/input>');var su=t("<tr><\/tr>"),hu=t('<td class="vis-payment-td1"><\/td>'),cu=t('<td class="vis-payment-td2"><\/td>');hu.append(hr);cu.append(rt);su.append(hu).append(cu);w.append(su);ot=t('<select class="vis-payment-cmb"><\/select>');var lu=t("<tr><\/tr>"),au=t('<td class="vis-payment-td1"><\/td>'),vu=t('<td class="vis-payment-td2"><\/td>');au.append(ui);vu.append(ot);lu.append(au).append(vu);w.append(lu);ei=t('<button class="vis-payment-inputs-buttons"  type="button">'+n.Msg.translate(f,"Online")+"<\/button>");b=t("<tr><\/tr>");ft=t('<td colspan="2"><\/td>');ft.append(ei);b.append(ft);w.append(b);or=t('<Span class="vis-payment-span"> '+n.Msg.translate(f,"C_PaymentTerm_ID")+"<\/span>");l=t('<table  class="vis-payment-table"><\/table>');vt=t("<tr><\/tr>");oi=t('<table  class="vis-payment-table"><\/table>');vt.append(oi);l.append(vt);i.append(l);ht=t('<select class="vis-payment-cmb"><\/select>');var yu=t("<tr><\/tr>"),pu=t('<td class="vis-payment-td1"><\/td>'),wu=t('<td class="vis-payment-td2"><\/td>');pu.append(or);wu.append(ht);yu.append(pu).append(wu);oi.append(yu);lr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"C_CashBook_ID")+"<\/p>");fi=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"C_Currency_ID")+"<\/p>");di=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"Amount")+"<\/p>");ni=t('<p class="vis-payment-span vis-payment-AmountField"> <\/p>');sr=t('<p class="vis-payment-span"> '+n.Msg.translate(f,"DateAcct")+"<\/p>");o=t('<table class="vis-payment-table"><\/table>');yt=t("<tr><\/tr>");at=t('<table class="vis-payment-table"><\/table>');yt.append(at);o.append(yt);i.append(o);st=t('<select class="vis-payment-cmb"><\/select>');var bu=t("<tr><\/tr>"),ku=t('<td class="vis-payment-td1"><\/td>'),du=t('<td class="vis-payment-td2"><\/td>');ku.append(fi);du.append(st);bu.append(ku).append(du);at.append(bu);ct=t('<select class="vis-payment-cmb"><\/select>');var gu=t("<tr><\/tr>"),nf=t('<td class="vis-payment-td1"><\/td>'),tf=t('<td class="vis-payment-td2"><\/td>');nf.append(lr);tf.append(ct);gu.append(nf).append(tf);at.append(gu);kt=t('<input class="vis-payment-inputs vis-payment-date"  type="date"><\/input>');var rf=t("<tr><\/tr>"),uf=t('<td class="vis-payment-td1"><\/td>'),ff=t('<td class="vis-payment-td2"><\/td>');uf.append(sr);ff.append(kt);rf.append(uf).append(ff);at.append(rf);ni=t('<p class="vis-payment-span vis-payment-AmountField"> <\/p> ');var ef=t("<tr><\/tr>"),of=t('<td class="vis-payment-td1"><\/td>'),sf=t('<td class="vis-payment-td2"><\/td>');of.append(di);sf.append(ni);ef.append(of).append(sf);at.append(ef);k.append(lt)}function eu(i){var f=!1;return(y=r.getValue("DocStatus"),r.getValue("C_BPartner_ID")==null)?(n.ADialog.error("0",!0,n.Msg.getMsg("SaveErrorRowNotFound")),f=!1):(y=r.getValue("DocStatus"),y==null&&(y=""),y.equals("RE")||y.equals("VO")||y.equals("CL"))?f=!1:(b=y.equals("CO")||y.equals("WP")?!1:!0,b||ii||r.getValue("M_Warehouse_ID")==null||(b=!0),b?lt.hide():lt.show(),_Amount=r.getValue("GrandTotal"),!b&&_Amount==0)?(n.ADialog.error("",!0,n.Msg.getMsg("PaymentZero")),f=!1):(yr=parseInt(r.getValue("AD_Client_ID")),pr=parseInt(r.getValue("AD_Org_ID")),wr=parseInt(r.getValue("C_BPartner_ID")),a=r.getValue("PaymentRule"),ri=parseInt(r.getValue("C_Currency_ID")),yt=r.getValue("DateAcct"),(r.getValue("C_PaymentTerm_ID")!=null||r.getValue("C_PaymentTerm_ID")!={})&&(ft=parseInt(r.getValue("C_PaymentTerm_ID"))),r.getValue("C_Payment_ID")!=null&&r.getValue("C_Payment_ID")!={}&&(ai=parseInt(r.getValue("C_Payment_ID"))),r.getValue("C_CashLine_ID")!=null&&r.getValue("C_CashLine_ID")!={}&&(vi=parseInt(r.getValue("C_CashLine_ID"))),e={_DocStatus:y,_isSOTrx:ii,_AD_Client_ID:yr,_AD_Org_ID:pr,_C_BPartner_ID:wr,_PaymentRule:a,_C_Currency_ID:ri,_DateAcct:yt,_C_PaymentTerm_ID:ft,_C_Payment_ID:ai,_C_CashLine_ID:vi,values:JSON.stringify(i),_Amount:_Amount},t.ajax({url:n.Application.contextUrl+"PaymentRule/LoadPaymentMethodDetails",type:"POST",async:!1,dataType:"Json",data:e,success:function(n){var i,v,e,r;ar(!1);i=JSON.parse(n);vr=i.CCType;b?lt.hide():lt.show();ni.text(_Amount);ti.text(_Amount);d.val(i.strKNumber);wt.val(i.strKExp);bt.val(i.strKApproval);wi.val(i.strKStatus);i.canChange&&(g.attr("disable",!1),d.attr("disable",!1),wt.attr("disable",!1),bt.attr("disable",!1),pt.attr("disable",!1));it.val(i.StrSRouting);tt.val(i.StrSNumber);rt.val(i.StrSCheck);ki.text(i.StrSStatus);bi.text(i.StrTStatus);yt!=null&&(kt.Value=yt);v=ri;i._Currencies!=null&&i._Currencies!=undefined&&i._Currencies[ri]?(t.each(i._Currencies,function(n,i){ot.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),t.each(i._Currencies,function(n,i){st.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))})):(fi.hide(),st.hide(),ui.hide(),ot.hide());a==null&&(a="");for(e in u.values){if(r=e,dt.equals(r)&&!ii)continue;else if(gt.equals(r)&&ii)continue;p.append(t('<option value="'+r+'">'+u.values[e]+"<\/option>"));r.equals(a)&&p.val(r)}return i.loadPaymentTerms!=null&&i.loadPaymentTerms!=undefined&&(t.each(i.loadPaymentTerms,function(n,i){ht.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),ft!=null&&ft!=undefined&&ht.val(ft)),i.loadAccounts!=null&&i.loadAccounts!=undefined&&(t.each(i.loadAccounts,function(n,i){et.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),i.kp!=null&&et.val(i.kp)),i.ccs!=null&&i.ccs!=undefined&&(t.each(i.ccs,function(n,i){g.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),i.CCType!=null&&g.val(i.CCType)),i.loadBankAccounts!=null&&i.loadBankAccounts!=undefined&&(t.each(i.loadBankAccounts,function(n,i){nt.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),i.kp!=null&&nt.val(i.kp)),i.Checkbook_ID!=null&&nt.val(i.Checkbook_ID),i.loadCashBooks!=null&&i.loadCashBooks!=undefined&&t.each(i.loadCashBooks,function(n,i){ct.append(t("<option><\/option>").attr("value",i.Key).text(i.Name))}),i.Checkbook_ID!=null&&(ct.val(i.Checkbook_ID),yi==0&&(yi=i.Checkbook_ID)),a=="B"?(s.hide(),l.hide(),o.show(),h.hide(),c.hide()):a=="K"?(s.show(),l.hide(),o.hide(),h.hide(),c.hide()):a=="D"?(s.hide(),l.hide(),o.hide(),h.show(),c.hide()):a=="P"?(s.hide(),l.show(),o.hide(),h.hide(),c.hide()):a=="S"&&(s.hide(),l.hide(),o.hide(),h.hide(),c.show()),f=!0}}),f)}function ou(n){if(n!=undefined&&!n){v.close();return}p.on("change",su);ot.on("change",hu);st.on("change",cu);pt.on("click",lu);v.onOkClick=function(){ar(!0);var n=au();n&&(vt.isOKPressed=!0,vt.onClose&&vt.onClose())};v.onCancelClick=function(){vt.onClose&&vt.onClose()};v.onClose=function(){vt.dispose()}}function su(){var n=p.val(),t;n!=null&&(t=n.toLower(),(dt==t.toLower()||dt==t.toUpper())&&(t=gt.toLower()),t+="Panel",n.equals("K")?(s.show(),l.hide(),o.hide(),h.hide(),c.hide()):n.equals("B")?(s.hide(),l.hide(),o.show(),h.hide(),c.hide()):n.equals("D")?(s.hide(),l.hide(),o.hide(),h.show(),c.hide()):n.equals("P")?(s.hide(),l.show(),o.hide(),h.hide(),c.hide()):n.equals("S")?(s.hide(),l.hide(),o.hide(),h.hide(),c.show()):n.equals("T")&&(s.hide(),l.hide(),o.hide(),h.hide(),c.hide()))}function hu(){}function cu(){}function lu(){}function au(){var o=!0,s=vu(),u;return s?(u=p.val(),u==null)?void 0:b&&u?(u.equals(a)||r.setValue("PaymentRule",u),o=!0):(e.cmbPayment=p.val(),u.equals(br)?(e.cmbBCurrency=st.val(),e.cmbBCashBook=ct.val(),e.bDateField=kt.val()):u.equals(kr)?(e.cmbKType=g.val(),e.txtKNumber=d.val(),e.txtKExp=wt.val(),e.txtKApproval=bt.val()):u.equals(gt)?e.cmbTAccount=et.val():u.equals(dr)?e.cmbPTerm=ht.val():u.equals(pi)&&(e.cmbSBankAccount=nt.val(),e.txtSRouting=it.val(),e.txtSNumber=tt.val(),e.txtSCheck=rt.val(),e.cmbSCurrency=ot.val()),e.C_Order_ID=f.getContextAsInt(i,"C_Order_ID"),e.C_Invoice_ID=f.getContextAsInt(i,"C_Invoice_ID"),t.ajax({url:n.Application.contextUrl+"PaymentRule/SaveChanges",type:"POST",async:!1,dataType:"Json",data:e,success:function(n){var t=JSON.parse(n);return t.ErrorMsg!=null&&t.ErrorMsg!=""&&t.ErrorMsg!=undefined&&alert(t.ErrorMsg),t.SucessMsg!=null&&t.SucessMsg!=""&&t.SucessMsg!=undefined&&alert(t.SucessMsg),t.newPaymentRule==null||t.newPaymentRule==undefined||t.newPaymentRule.equals(a)||r.setValue("PaymentRule",t.newPaymentRule),t.newDateAcct==null||t.newDateAcct==undefined||t.newDateAcct.equals(yt)||r.setValue("DateAcct",t.newDateAcct),t.newC_PaymentTerm_ID!=ft&&t.newC_PaymentTerm_ID>0&&r.setValue("C_PaymentTerm_ID",t.newC_PaymentTerm_ID),t._C_Payment_ID!=ai&&(t._C_Payment_ID==0?r.setValue("C_Payment_ID",null):r.setValue("C_Payment_ID",t._C_Payment_ID)),t._C_CashLine_ID!=vi&&(t._C_CashLine_ID==0?r.setValue("C_CashLine_ID",null):r.setValue("C_CashLine_ID",t._C_CashLine_ID)),o=!0},error:function(){return o=!1}}),o):o=!1}function vu(){var i=!0,u,t,s,r,f;try{if(u=p.val(),u==null||u==undefined)return!1;if(t=u,b)return!0;var h=yt,o=ft,c=yi,l=vr,e=0;if(t.equals(br))c=ct.val(),h=kt.val();else if(t.equals(kr))l=g.val(),(d.val()==null||d.val()==""||d.val()==undefined)&&(n.ADialog.error("",!0,n.Msg.getMsg("CreditCardNumberError")),i=!1);else if(t.equals(gt)||t.equals(dt))s=et.val(),s==null&&(n.ADialog.error("",!0,n.Msg.getMsg("PaymentBPBankNotFound")),i=!1);else if(t.equals(dr))o=ht.val(),r!=null&&(o=r);else if(t.equals(pi))r=nt.val(),r!=null&&(e=r),(it.val()==null||it.val()==""||it.val()==undefined)&&(n.ADialog.error("",!0,n.Msg.getMsg("PaymentBankRoutingNotValid")),i=!1),(tt.val()==null||tt.val()==""||tt.val()==undefined)&&(n.ADialog.error("",!0,n.Msg.getMsg("PaymentBankAccountNotValid")),i=!1),(rt.val()==null||rt.val()==""||rt.val()==undefined)&&(n.ADialog.error("",!0,n.Msg.getMsg("PaymentBankCheckNotValid")),i=!1);else return!1;"KTSD".indexOf(t)!=-1&&e==0&&(f=nu,t.equals(gt)?f=gr:t.equals(dt)?f=tu:t.equals(pi)&&(f=iu),e==0&&"S".equals(t)&&(n.ADialog.error("",!0,n.Msg.getMsg("PaymentNoProcessor")),i=!1))}catch(a){log.Severe(a.ToString())}return i}function ar(n){n?(hi.show(),ci.show(),k.find("button").prop("disabled",!0)):(hi.hide(),ci.hide(),k.find("button").prop("disabled",!1))}var vt=this,f=n.Env.getCtx(),li=!1,ii=n.context.isSOTrx(i),y=null,a="",ri=0,yt=null,ft=0,ai=0,vi=0,yi=0,vr="",wi,bi,ki,di,ni,gi,ti,ru,nr,tr,ir,rr,ur,fr,er,ui,fi,or,sr,hr,cr,lr,p,g,et,ot,st,ht,nt,ct,pt,ei,d,wt,bt,tt,it,rt,kt,lt,at,oi,uu,ut,si,w,hi,ci;this.log=n.Logging.VLogger.getVLogger("vPayment");var yr=0,pr=0,wr=0,e={},br="B",dt="D",kr="K",dr="P",pi="S",gt="T",gr="A",nu="C",tu="D",iu="K",b=!1,k,v=null,o,s,h,c,l;this.onClose=null;hi=t('<img src="'+n.Application.contextUrl+'Areas/VIS/Images/busy.gif"/>');ci=t("<label>"+n.Msg.getMsg("Loading")+"<\/label>");this.init=function(){fu();li=eu(u.values);ou(li)};this.isInitOK=function(){return li};this.show=function(){v=new n.ChildDialog;k=t("<div><\/div>");k.append(hi).append(ci);ar(!0);v.setContent(k);v.setWidth(360);v.setTitle(n.Msg.getMsg("Payment"));v.setModal(!0);v.show()};this.onClose=null;this.dispose=function(){k!=null&&(k=null);v=null;o=null;s=null;h=null;c=null;l=null;this.onClose=null;wi=null;bi=null;ki=null;di=null;ni=null;gi=null;ti=null;ru=null;nr=null;tr=null;ir=null;rr=null;ur=null;fr=null;er=null;ui=null;fi=null;or=null;sr=null;hr=null;cr=null;lr=null;p=null;g=null;et=null;ot=null;st=null;ht=null;nt=null;ct=null;pt=null;ei=null;d=null;wt=null;bt=null;tt=null;it=null;rt=null;kt=null;at=null;oi=null;uu=null;ut=null;si=null;w=null}}n.VPayment=i}(VIS,jQuery),function(n,t){n.TestForm=function(){function o(){i=t("<div>");f=t("<input type='text'>");r=t("<input type='button'>").val("Show");u=t("<input type='button'>").val("Close");i.append(f).append(r).append(u)}var i,f,r,u,e;this.frame;this.windowNo;o();e=this;r.on(n.Events.onTouchStartOrClick,function(){alert("Test From has value :==> "+f.val())});u.on(n.Events.onTouchStartOrClick,function(){confirm("wanna close this form???")&&e.dispose()});this.getRoot=function(){return i};this.disposeComponent=function(){e=null;i&&i.remove();i=null;r&&r.off(n.Events.onTouchStartOrClick);u&&u.off(n.Events.onTouchStartOrClick);f=r=u=null;this.getRoot=null;this.disposeComponent=null}};n.TestForm.prototype.init=function(n,t){this.frame=t;this.frame.getContentGrid().append(this.getRoot())};n.TestForm.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null}}(VIS,jQuery),function(n,t){function i(i){var o,s,h,u,f;this.onClose=null;this.dGrid=null;o="SelectDeselectAll";s=!0;this.arrListColumns=[];this.log=n.Logging.VLogger.getVLogger("VCreateFrom");this.divPaging=null;this.ulPaging=null;this.liFirstPage=null;this.liPrevPage=null;this.liCurrPage=null;this.liNextPage=null;this.liLastPage=null;this.cmbPage=null;h=[];this.multiValues=[];this.editedItems=[];this.NonEditableRecord=[];var r=this,e=n.Application.contextUrl,c=e+"JsonData/JDataSet",l=e+"JsonData/ExecuteNonQuer";this.$root=t("<div style='position:relative'>");this.log=n.Logging.VLogger.getVLogger("VCreateFrom");this.$busyDiv=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>");this.topDiv=t("<div style='float: left; width: 100%;'>");this.middelDiv=t("<div style='height: 60%;float: left; width: 99.5%;border: 1px solid;'>");this.bottomDiv=t("<div style='height: 40px; width: 100%; float: left ;margin-top: 10px;'>");this.divPaging=t("<div>");this.record_ID=0;this.windowNo=i.getWindowNo();this.mTab=i;this.initOK=!1;this.isApplied=!1;u="btnOk_"+this.windowNo;this.Okbtn=t("<input id='"+u+"' class='VIS_Pref_btn-2' style='margin-bottom:0px;margin-top:0px ;float:right; margin-right:10px' type='button' value='"+n.Msg.getMsg("OK")+"'>");u="btnCancel_"+this.windowNo;this.cancelbtn=t("<input id='"+u+"' class='VIS_Pref_btn-2' style='margin-bottom:0px;margin-top:0px; margin-right: 3px; float:right' type='button' value='"+n.Msg.getMsg("Cancel")+"'>");u="btnDelete_"+this.windowNo;f=n.Application.contextUrl+"Areas/VIS/Images/base/uncheck-icon.png";this.selectAllButton=t("<button type='button' id='"+u+"' style='margin-bottom:0px;margin-top:0px;display: none;float: left;padding: 0px;border: 0px;' value='Ok' role='button' aria-disabled='false'><img src='"+f+"'><\/button>");u="btnRefresh_"+this.windowNo;f=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";this.btnRefresh=t("<button id='"+u+"' style='margin-bottom: 1px; margin-top: 0px;display: none; float: left; margin-left: 0px;height: 38px; ' class='VIS_Pref_btn-2'><img src='"+f+"'><\/button>");u="btnApply_"+this.windowNo;this.Applybtn=t("<input id='"+u+"' class='VIS_Pref_btn-2' style='margin-bottom:0px;margin-top:0px;display: none; margin-right: 10px; float:right' type='button' value='"+n.Msg.getMsg("Apply")+"'>");n.Application.isRTL&&(this.Okbtn.css("margin-right","-132px"),this.Applybtn.css("margin-right","-365px"),this.cancelbtn.css("margin-right","55px"));this.lblBankAccount=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblOrder=new n.Controls.VLabel;this.lblInvoice=new n.Controls.VLabel;this.lblShipment=new n.Controls.VLabel;this.lblLocator=new n.Controls.VLabel;this.lblDeliveryDate=new n.Controls.VLabel;this.lblProduct=new n.Controls.VLabel;this.lblDocumentNoRef=new n.Controls.VLabel;this.lblDocumentNo=new n.Controls.VLabel;this.lblDate=new n.Controls.VLabel;this.lblAmount=new n.Controls.VLabel;this.lblDepositSlip=new n.Controls.VLabel;this.lblAuthCode=new n.Controls.VLabel;this.lblCheckNo=new n.Controls.VLabel;this.lblContainer=null;f=n.Application.contextUrl+"Areas/VIS/Images/pallet-icon.png";this.ContainerTree=t("<img id='ContainerTree_"+this.windowNo+"' style='height: 27px;' class='pull-left VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled' src='"+f+"'>");this.DocumentNo=null;this.Date=null;this.Amount=null;this.DepositSlip=null;this.AuthCode=null;this.CheckNo=null;this.fromInvoice=!1;this.deliveryDate=null;this.cmbOrder=new n.Controls.VComboBox("",!1,!1,!0);this.cmbInvoice=new n.Controls.VComboBox("",!1,!1,!0);this.cmbShipment=new n.Controls.VComboBox("",!1,!1,!0);this.cmbContainer=null;this.DocumentNoRef=null;this.vProduct=null;this.cmbBankAccount=null;this.vBPartner=null;this.locatorField=null;this.child=null;this.relatedToOrg=new n.Controls.VCheckBox("Related To My Organization",!1,!1,!0,"Related To My Organization",null);this.pattrLookup=new n.MPAttributeLookup(n.context,r.windowNo);this.$productAttribute=new n.Controls.VPAttribute("M_AttributeSetInstance_ID",!1,!1,!0,n.DisplayType.PAttribute,r.pattrLookup,r.windowNo,!1,!1,!1,!0);this.title="";this.vetoablechange=function(t){var f;if(t.propertyName=="M_Product_ID"){r.isApplied=!1;r.setBusy(!0);r.multiValues=[];r.dGrid!=null&&(r.dGrid.destroy(),r.dGrid=null);var u=r.cmbOrder.getControl().find("option:selected").val(),e=r.cmbInvoice.getControl().find("option:selected").val(),o=r.cmbShipment.getControl().find("option:selected").val(),i=r.vProduct.getValue(),s=r.deliveryDate.getValue();u!=null?r.locatorField!=null?r.loadOrders(u,i,s,!1,1):r.loadOrders(u,i,s,!0,1):e!=null?n.VCreateFromShipment.prototype.loadInvoices(e,i,1):o!=null?n.VCreateFromInvoice.prototype.loadShipments(o,i,1):r.setBusy(!1)}else if(t.propertyName=="C_BPartner_ID"){r.setBusy(!0);r.multiValues=[];r.dGrid!=null&&(r.dGrid.destroy(),r.dGrid=null);var h=r.cmbBankAccount.getControl().find("option:selected").val(),c=r.Date.getValue(),l=r.vBPartner.getValue(),a=r.DepositSlip.getValue(),v=r.DocumentNo.getValue(),y=r.AuthCode.getValue(),p=r.CheckNo.getValue(),w=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(h,l,c,v,a,y,p,w,1)}else t.propertyName=="M_Locator_ID"?r.locatorField!=null&&(r.isApplied=!1,f=parseInt(r.locatorField.getValue()),f>0&&n.VCreateFromShipment.prototype.initContainerDetails(f)):this.locatorField.setBackground("")};this.createPageSettings=function(){this.ulPaging=t('<ul style="float:right;margin-top:10px" class="vis-statusbar-ul">');this.liFirstPage=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageFirst16.png" alt="First Page" title="First Page" style="opacity: 0.6;"><\/div><\/li>');this.liPrevPage=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageUp16.png" alt="Page Up" title="Page Up" style="opacity: 0.6;"><\/div><\/li>');this.cmbPage=t('<select style = "width:50px;">');this.liCurrPage=t("<li>").append(this.cmbPage);this.liNextPage=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageDown16.png" alt="Page Down" title="Page Down" style="opacity: 0.6;"><\/div><\/li>');this.liLastPage=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageLast16.png" alt="Last Page" title="Last Page" style="opacity: 0.6;"><\/div><\/li>');this.ulPaging.append(this.liFirstPage).append(this.liPrevPage).append(this.liCurrPage).append(this.liNextPage).append(this.liLastPage);this.pageEvents()};this.pageEvents=function(){this.liFirstPage.on("click",function(){var i,u;if(t(this).css("opacity")=="1"){r.setBusy(!0);var f=r.cmbOrder.getControl().find("option:selected").val(),o=r.cmbInvoice.getControl().find("option:selected").val(),s=r.cmbShipment.getControl().find("option:selected").val(),e=null;if(r.cmbBankAccount!=null&&(e=r.cmbBankAccount.getControl().find("option:selected").val()),i=null,u=null,r.vProduct!=null&&(i=r.vProduct.getValue()),r.deliveryDate!=null&&(u=r.deliveryDate.getValue()),f!=null)r.locatorField!=null?r.loadOrders(f,i,u,!1,1):r.loadOrders(f,i,u,!0,1);else if(o!=null)n.VCreateFromShipment.prototype.loadInvoices(o,i,1);else if(s!=null)n.VCreateFromInvoice.prototype.loadShipments(s,i,1);else if(e!=null){var h=r.Date.getValue(),c=r.vBPartner.getValue(),l=r.DepositSlip.getValue(),a=r.DocumentNo.getValue(),v=r.AuthCode.getValue(),y=r.CheckNo.getValue(),p=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(e,c,h,a,l,v,y,p,1)}}});this.liPrevPage.on("click",function(){var i,u;if(t(this).css("opacity")=="1"){r.setBusy(!0);var f=r.cmbOrder.getControl().find("option:selected").val(),o=r.cmbInvoice.getControl().find("option:selected").val(),s=r.cmbShipment.getControl().find("option:selected").val(),e=null;if(r.cmbBankAccount!=null&&(e=r.cmbBankAccount.getControl().find("option:selected").val()),i=null,u=null,r.vProduct!=null&&(i=r.vProduct.getValue()),r.deliveryDate!=null&&(u=r.deliveryDate.getValue()),f!=null)r.locatorField!=null?r.loadOrders(f,i,u,!1,parseInt(r.cmbPage.val())-1):r.loadOrders(f,i,u,!0,parseInt(r.cmbPage.val())-1);else if(o!=null)n.VCreateFromShipment.prototype.loadInvoices(o,i,parseInt(r.cmbPage.val())-1);else if(s!=null)n.VCreateFromInvoice.prototype.loadShipments(s,i,parseInt(r.cmbPage.val())-1);else if(e!=null){var h=r.Date.getValue(),c=r.vBPartner.getValue(),l=r.DepositSlip.getValue(),a=r.DocumentNo.getValue(),v=r.AuthCode.getValue(),y=r.CheckNo.getValue(),p=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(e,c,h,a,l,v,y,p,parseInt(r.cmbPage.val())-1)}}});this.liNextPage.on("click",function(){var i,u;if(t(this).css("opacity")=="1"){r.setBusy(!0);var f=r.cmbOrder.getControl().find("option:selected").val(),o=r.cmbInvoice.getControl().find("option:selected").val(),s=r.cmbShipment.getControl().find("option:selected").val(),e=null;if(r.cmbBankAccount!=null&&(e=r.cmbBankAccount.getControl().find("option:selected").val()),i=null,u=null,r.vProduct!=null&&(i=r.vProduct.getValue()),r.deliveryDate!=null&&(u=r.deliveryDate.getValue()),f!=null)r.locatorField!=null?r.loadOrders(f,i,u,!1,parseInt(r.cmbPage.val())+1):r.loadOrders(f,i,u,!0,parseInt(r.cmbPage.val())+1);else if(o!=null)n.VCreateFromShipment.prototype.loadInvoices(o,i,parseInt(r.cmbPage.val())+1);else if(s!=null)n.VCreateFromInvoice.prototype.loadShipments(s,i,parseInt(r.cmbPage.val())+1);else if(e!=null){var h=r.Date.getValue(),c=r.vBPartner.getValue(),l=r.DepositSlip.getValue(),a=r.DocumentNo.getValue(),v=r.AuthCode.getValue(),y=r.CheckNo.getValue(),p=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(e,c,h,a,l,v,y,p,parseInt(r.cmbPage.val())+1)}}});this.liLastPage.on("click",function(){var i,u;if(t(this).css("opacity")=="1"){r.setBusy(!0);var f=r.cmbOrder.getControl().find("option:selected").val(),o=r.cmbInvoice.getControl().find("option:selected").val(),s=r.cmbShipment.getControl().find("option:selected").val(),e=null;if(r.cmbBankAccount!=null&&(e=r.cmbBankAccount.getControl().find("option:selected").val()),i=null,u=null,r.vProduct!=null&&(i=r.vProduct.getValue()),r.deliveryDate!=null&&(u=r.deliveryDate.getValue()),f!=null)r.locatorField!=null?r.loadOrders(f,i,u,!1,parseInt(r.cmbPage.find("Option:last").val())):r.loadOrders(f,i,u,!0,parseInt(r.cmbPage.find("Option:last").val()));else if(o!=null)n.VCreateFromShipment.prototype.loadInvoices(o,i,parseInt(r.cmbPage.find("Option:last").val()));else if(s!=null)n.VCreateFromInvoice.prototype.loadShipments(s,i,parseInt(r.cmbPage.find("Option:last").val()));else if(e!=null){var h=r.Date.getValue(),c=r.vBPartner.getValue(),l=r.DepositSlip.getValue(),a=r.DocumentNo.getValue(),v=r.AuthCode.getValue(),y=r.CheckNo.getValue(),p=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(e,c,h,a,l,v,y,p,parseInt(r.cmbPage.find("Option:last").val()))}}});this.cmbPage.on("change",function(){var t,i;r.setBusy(!0);var u=r.cmbOrder.getControl().find("option:selected").val(),e=r.cmbInvoice.getControl().find("option:selected").val(),o=r.cmbShipment.getControl().find("option:selected").val(),f=null;if(r.cmbBankAccount!=null&&(f=r.cmbBankAccount.getControl().find("option:selected").val()),t=null,i=null,r.vProduct!=null&&(t=r.vProduct.getValue()),r.deliveryDate!=null&&(i=r.deliveryDate.getValue()),u!=null)r.locatorField!=null?r.loadOrders(u,t,i,!1,r.cmbPage.val()):r.loadOrders(u,t,i,!0,r.cmbPage.val());else if(e!=null)n.VCreateFromShipment.prototype.loadInvoices(e,t,r.cmbPage.val());else if(o!=null)n.VCreateFromInvoice.prototype.loadShipments(o,t,r.cmbPage.val());else if(f!=null){var s=r.Date.getValue(),h=r.vBPartner.getValue(),c=r.DepositSlip.getValue(),l=r.DocumentNo.getValue(),a=r.AuthCode.getValue(),v=r.CheckNo.getValue(),y=r.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(f,h,s,l,c,a,v,y,r.cmbPage.val())}})};this.resetPageCtrls=function(n){if(this.cmbPage.empty(),n.TotalPage>0){for(var i=0;i<n.TotalPage;i++)this.cmbPage.append(t("<option value="+(i+1)+">"+(i+1)+"<\/option>"));this.cmbPage.val(n.CurrentPage);n.TotalPage>n.CurrentPage?(this.liNextPage.css("opacity","1"),this.liLastPage.css("opacity","1")):(this.liNextPage.css("opacity","0.6"),this.liLastPage.css("opacity","0.6"));n.CurrentPage>1?(this.liFirstPage.css("opacity","1"),this.liPrevPage.css("opacity","1")):(this.liFirstPage.css("opacity","0.6"),this.liPrevPage.css("opacity","0.6"));n.TotalPage==1&&(this.liFirstPage.css("opacity","0.6"),this.liPrevPage.css("opacity","0.6"),this.liNextPage.css("opacity","0.6"),this.liLastPage.css("opacity","0.6"))}else this.liFirstPage.css("opacity","0.6"),this.liPrevPage.css("opacity","0.6"),this.liNextPage.css("opacity","0.6"),this.liLastPage.css("opacity","0.6")};this.setBusy=function(n){this.$busyDiv.css("display",n?"block":"none")};this.MergeItemsForSave=function(){var f=r.cmbOrder.getControl().find("option:selected").val(),e=r.cmbInvoice.getControl().find("option:selected").val(),o=r.cmbShipment.getControl().find("option:selected").val(),n,i,u;if(r.editedItems.length>0)for(n in r.editedItems)i=r.editedItems[n].M_Product_ID_K,u=t.grep(r.multiValues,function(t){return f!=null?t.M_Product_ID_K==i&&t.C_Order_ID_K==r.editedItems[n].C_Order_ID_K:e!=null?t.M_Product_ID_K==i&&t.C_Invoice_ID_K==r.editedItems[n].C_Invoice_ID_K:o!=null?t.M_Product_ID_K==i&&t.M_InOut_ID_K==r.editedItems[n].M_InOut_ID_K:t.C_Payment_ID_K==r.editedItems[n].C_Payment_ID_K}),u.length>0||r.multiValues.push(r.editedItems[n])};this.showDialog=function(){this.locatorField&&(this.locatorField.setBackground(!1),this.locatorField.addVetoableChangeListener(this));this.vProduct&&this.vProduct.addVetoableChangeListener(this);this.vBPartner&&this.vBPartner.addVetoableChangeListener(this);var n=this;this.$root.append(this.$busyDiv);this.setBusy(!1);this.$root.dialog({modal:!0,title:this.title,width:900,height:600,resizable:!1,position:{at:"center top",of:window},close:function(){n.dispose();n.dGrid!=null&&n.dGrid.destroy();r=null;n.$root.dialog("destroy");n.$root=null}})};this.disposeComponent=function(){r=null;this.Okbtn&&this.Okbtn.off("click");this.cancelbtn&&this.cancelbtn.off("click");this.selectAllButton&&this.selectAllButton.off("click");this.btnRefresh&&this.btnRefresh.off("click");this.Applybtn&&this.Applybtn.off("click");this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};i.prototype.create=function(t){var i=n.Env.getCtx().getContextAsInt(t.getWindowNo(),"BaseTable_ID"),r=null;if(i==392)r=new n.VCreateFromStatement(t);else if(i==318)r=new n.VCreateFromInvoice(t);else if(i==319)r=new n.VCreateFromShipment(t);else return i==426?null:null;return r};i.prototype.initBPDetails=function(n){return n};i.prototype.initBPartner=function(t){var r=n.MLookupFactory.getMLookUp(n.Env.getCtx(),this.windowNo,3499,n.DisplayType.Search),i;return this.vBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,r),i=n.Env.getCtx().getContextAsInt(this.windowNo,"C_BPartner_ID"),this.vBPartner.setValue(i),this.initBPartnerOIS(i,t)};i.prototype.initBPartnerOIS=function(i,r){var e=this.cmbOrder,u,f;return t(e).html(""),u=!1,r?(f=n.dataContext.getJSONRecord("MDocType/GetDocType",n.Env.getCtx().getContextAsInt(this.windowNo,"C_DocTypeTarget_ID").toString()),u=n.Utility.Util.getValueOfBoolean(f.IsReturnTrx)):u="Y".equals(n.Env.getCtx().getWindowContext(this.windowNo,"IsReturnTrx")),this.getOrders(n.Env.getCtx(),i,u,r),this.initBPDetails(i)};i.prototype.getOrders=function(i,r,u,f){var o="o.DocumentNo||' - ' ||".concat(n.DB.to_char("o.DateOrdered",n.DisplayType.Date,n.Env.getAD_Language(i))).concat("||' - '||").concat(n.DB.to_char("o.GrandTotal",n.DisplayType.Amount,n.Env.getAD_Language(i))),e="m.M_InOutLine_ID";f&&(e="m.C_InvoiceLine_ID");var s=n.Env.getCtx().getContextAsInt(this.windowNo,"AD_Org_ID"),h="Y".equals(n.Env.getCtx().getWindowContext(this.windowNo,"IsDropShip")),c="Y".equals(n.Env.getCtx().getWindowContext(this.windowNo,"IsSOTrx"));t.ajax({url:n.Application.contextUrl+"VCreateFrom/VCreateGetOrders",type:"POST",data:{displays:o,columns:e,C_BPartner_IDs:r,isReturnTrxs:u,OrgIds:s,IsDrop:h,IsSOTrx:c,forInvoices:f},success:function(t){var r=t.result,u,f,i;if(r&&r.length>0)try{for(i=0;i<r.length;i++)u=n.Utility.Util.getValueOfInt(r[i].key),f=n.Utility.encodeText(r[i].value),i==0&&$self.cmbOrder.getControl().append(" <option value=0> <\/option>"),$self.cmbOrder.getControl().append(" <option value="+u+">"+f+"<\/option>");$self.cmbOrder.getControl().prop("selectedIndex",0)}catch(e){}},error:function(n){$self.log.info(n)}})};i.prototype.jbInit=function(){var u,i;this.init();this.lblBankAccount.getControl().text(n.Msg.getMsg("BankAcctCurrency"));this.lblBPartner.getControl().text(n.Msg.getMsg("BusinessPartner"));this.lblOrder.getControl().text(n.Msg.getMsg("Order"));this.lblInvoice.getControl().text(n.Msg.getMsg("Invoice"));this.lblShipment.getControl().text(n.Msg.getMsg("Shipment/Receipt"));this.lblLocator.getControl().text(n.Msg.getMsg("M_Locator_ID"));this.lblDeliveryDate.getControl().text(n.Msg.getMsg("DeliveryDate"));this.lblProduct.getControl().text(n.Msg.getMsg("ProductName"));this.lblDocumentNoRef.getControl().text(n.Msg.getMsg("DocumentNo"));this.lblDocumentNo.getControl().text(n.Msg.getMsg("DocumentNo"));this.lblDate.getControl().text(n.Msg.getMsg("DateAcct"));this.lblAmount.getControl().text(n.Msg.getMsg("Amount"));this.lblDepositSlip.getControl().text(n.Msg.getMsg("DepositSlipNo"));this.lblAuthCode.getControl().text(n.Msg.getMsg("AuthCode"));this.lblCheckNo.getControl().text(n.Msg.getMsg("CheckNo"));var e=t("<div class='VIS_Pref_show'>"),r=t("<div class='VIS_Pref_dd' style='float: left; height: 34px;'>"),f=t("<div style='float: left; margin-right: 5px; width: 30%; text-align: right'>");n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>"));u=t("<h5 style='width: 100%'>");i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>");this.topDiv.append(e);e.append(r);r.append(f);f.append(u);n.Application.isRTL?this.cmbBankAccount!=null?(u.append(this.lblBankAccount.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbBankAccount.getControl().css("width","100%"))):this.DocumentNoRef!=null&&(u.append(this.lblDocumentNoRef.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.DocumentNoRef.getControl().css("width","100%"))):this.vBPartner!=null&&(u.append(this.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),this.cmbBankAccount!=null?(i.append(this.vBPartner.getControl().css("width","78%")).append(this.vBPartner.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")),i.append(this.vBPartner.getBtn(1).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))):i.append(this.vBPartner.getControl().css("width","88%")).append(this.vBPartner.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")));r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>");f=t("<div style='float: left; margin-right: 5px; width: 30%; text-align: right'>");n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>"));u=t("<h5 style='width: 100%'>");i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show'>");e.append(r);r.append(f);f.append(u);n.Application.isRTL?this.vBPartner!=null&&(u.append(this.lblBPartner.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),this.cmbBankAccount!=null?(i.append(this.vBPartner.getControl().css("width","78%")).append(this.vBPartner.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")),i.append(this.vBPartner.getBtn(1).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))):i.append(this.vBPartner.getControl().css("width","88%")).append(this.vBPartner.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))):this.cmbBankAccount!=null?(u.append(this.lblBankAccount.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbBankAccount.getControl().css("width","100%"))):this.DocumentNoRef!=null&&(u.append(this.lblDocumentNoRef.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.DocumentNoRef.getControl().css("width","100%")));e=t("<div class='VIS_Pref_show'>");this.Amount!=null?(r=t("<div class='VIS_Pref_dd' style='float: left; height: 34px; width:35%'>"),i=t("<div style='float: left; width: 58%;' class='VIS_Pref_slide-show pp'>"),f=t("<div style='float: left; margin-right: 5px;width: 40%; text-align: right'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 40%; text-align: left'>"))):(r=t("<div class='VIS_Pref_dd' style='float: left; height: 34px;'>"),i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>"),f=t("<div style='float: left; margin-right: 5px;width: 30%; text-align: right'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>")));u=t("<h5 style='width: 100%'>");this.topDiv.append(e);e.append(r);r.append(f);f.append(u);n.Application.isRTL?this.Date!=null&&(u.append(this.lblDate.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.Date.getControl().css("width","100%"))):this.DocumentNo!=null&&(u.append(this.lblDocumentNo.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.DocumentNo.getControl().css("width","100%")));n.Application.isRTL?(this.cmbInvoice!=null&&(u.append(this.lblInvoice.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbInvoice.getControl().css("width","100%"))),this.cmbShipment!=null&&(u.append(this.lblShipment.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbShipment.getControl().css("width","100%")))):this.cmbOrder!=null&&(u.append(this.lblOrder.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbOrder.getControl().css("width","100%")));this.Amount!=null&&(r=t("<div class='VIS_Pref_dd' style='float: left; height: 34px; width:30%'>"),f=t("<div style='float: left; margin-right: 5px;width: 40%; text-align: right'>"),u=t("<h5 style='width: 100%'>"),i=t("<div style='float: left; width: 58%;' class='VIS_Pref_slide-show pp'>"),e.append(r),r.append(f),f.append(u),u.append(this.lblAmount.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.Amount.getControl().css("width","100%")));this.Amount!=null?(r=t("<div class='VIS_Pref_dd' style='float: left; height: 34px; width:35%'>"),i=t("<div style='float: left; width: 58%;' class='VIS_Pref_slide-show pp'>"),f=t("<div style='float: left; margin-right: 5px;width: 40%; text-align: right'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 40%; text-align: left'>"))):(r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>"),f=t("<div style='float: left; margin-right: 5px;width: 30%; text-align: right'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>")),i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>"));u=t("<h5 style='width: 100%'>");e.append(r);r.append(f);f.append(u);n.Application.isRTL?this.cmbOrder!=null&&(u.append(this.lblOrder.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbOrder.getControl().css("width","100%"))):(this.cmbInvoice!=null&&(u.append(this.lblInvoice.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbInvoice.getControl().css("width","100%"))),this.cmbShipment!=null&&(u.append(this.lblShipment.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.cmbShipment.getControl().css("width","100%"))));n.Application.isRTL?this.DocumentNo!=null&&(u.append(this.lblDocumentNo.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.DocumentNo.getControl().css("width","100%"))):this.Date!=null&&(u.append(this.lblDate.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.Date.getControl().css("width","100%")));(this.locatorField!=null||this.cmbContainer!=null)&&(this.middelDiv.css("height","52%"),e=t("<div class='VIS_Pref_show'>"),r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>"),f=t("<div style='float: left; margin-right: 5px;width: 30%; text-align: right'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>")),u=t("<h5 style='width: 100%'>"),i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>"),this.topDiv.append(e),e.append(r),r.append(f),f.append(u),n.Application.isRTL?this.cmbContainer!=null&&(u.append(this.lblContainer.getControl().addClass("VIS_Pref_Label_Font")),r.css("visibility","hidden").append(i),n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"]!=undefined&&n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y",!0)&&(r.css("visibility","visible").append(i),this.ContainerTree.removeClass("VIS_Tree-Container-disabled")),i.append(this.cmbContainer.getControl().attr("disabled",!0).css("width","90%").css("float","left").css("background","#f5f5f5")).append(this.ContainerTree)):this.locatorField!=null&&(u.append(this.lblLocator.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.locatorField.getControl().css("width","88%")).append(this.locatorField.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))),r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>"),f=t("<div style='float: left; margin-right: 5px;width: 30%; text-align: right'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>")),u=t("<h5 style='width: 100%'>"),i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>"),e.append(r),r.append(f),f.append(u),n.Application.isRTL?this.locatorField!=null&&(u.append(this.lblLocator.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.locatorField.getControl().css("width","88%")).append(this.locatorField.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))):this.cmbContainer!=null&&(u.append(this.lblContainer.getControl().addClass("VIS_Pref_Label_Font")),r.css("visibility","hidden").append(i),n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"]!=undefined&&n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y",!0)&&(r.css("visibility","visible").append(i),this.ContainerTree.removeClass("VIS_Tree-Container-disabled")),i.append(this.cmbContainer.getControl().attr("disabled",!0).css("width","88%").css("float","left").css("background","#f5f5f5")).append(this.ContainerTree)));e=t("<div class='VIS_Pref_show'>");this.CheckNo!=null?(r=t("<div class='VIS_Pref_dd' style='float: left; height: 34px; width:35%'>"),f=t("<div style='float: left; margin-right: 5px;width: 40%; text-align: right'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 40%; text-align: left'>")),i=t("<div style='float: left; width: 58%;' class='VIS_Pref_slide-show pp'>")):(r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>"),f=t("<div style='float: left; margin-right: 5px;width: 30%; text-align: right'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>")),i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>"));u=t("<h5 style='width: 100%'>");this.topDiv.append(e);e.append(r);r.append(f);f.append(u);n.Application.isRTL?this.AuthCode!=null&&(u.append(this.lblAuthCode.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.AuthCode.getControl().css("width","100%"))):this.DepositSlip!=null&&(u.append(this.lblDepositSlip.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.DepositSlip.getControl().css("width","100%")));n.Application.isRTL?this.vProduct!=null&&(u.append(this.lblProduct.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.vProduct.getControl().css("width","78%")).append(this.vProduct.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")),i.append(this.vProduct.getBtn(1).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"))):this.deliveryDate!=null&&(u.append(this.lblDeliveryDate.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.deliveryDate.getControl().css("width","100%")));this.CheckNo!=null&&(r=t("<div class='VIS_Pref_dd' style='float: left; height: 34px; width:30%'>"),f=t("<div style='float: left; margin-right: 5px;width: 40%; text-align: right'>"),u=t("<h5 style='width: 100%'>"),i=t("<div style='float: left; width: 58%;' class='VIS_Pref_slide-show pp'>"),e.append(r),r.append(f),f.append(u),u.append(this.lblCheckNo.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.CheckNo.getControl().css("width","100%")));this.CheckNo!=null?(r=t("<div class='VIS_Pref_dd' style='float: left; height: 34px; width:35%'>"),f=t("<div style='float: left; margin-right: 5px;width: 40%; text-align: right'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 40%; text-align: left'>")),i=t("<div style='float: left; width: 58%;' class='VIS_Pref_slide-show pp'>")):(r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>"),f=t("<div style='float: left; margin-right: 5px;width: 30%; text-align: right'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>")),i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>"));u=t("<h5 style='width: 100%'>");e.append(r);r.append(f);f.append(u);n.Application.isRTL?this.deliveryDate!=null&&(u.append(this.lblDeliveryDate.getControl().addClass("VIS_Pref_Label_Font")),r.append(i),i.append(this.deliveryDate.getControl().css("width","100%"))):this.vProduct!=null&&(u.append(this.lblProduct.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.vProduct.getControl().css("width","78%")).append(this.vProduct.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")),i.append(this.vProduct.getBtn(1).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")));n.Application.isRTL?this.DepositSlip!=null&&(u.append(this.lblDepositSlip.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.DepositSlip.getControl().css("width","100%"))):this.AuthCode!=null&&(u.append(this.lblAuthCode.getControl().addClass("VIS_Pref_Label_Font")),i.removeClass("VIS_Pref_slide-show pp"),r.append(i),i.append(this.AuthCode.getControl().css("width","100%")));this.relatedToOrg!=null&&(e=t("<div class='VIS_Pref_show'>"),r=t("<div class='VIS_Pref_dd' style='float: left ; height: 34px;'>"),f=t("<div style='float: left; margin-right: 5px;width: 100%; text-align: left'>"),n.Application.isRTL&&(f=t("<div style='float: right; margin-right: 5px; width: 30%; text-align: left'>")),u=t("<h5 style='width: 100%'>"),i=t("<div style='float: left; width: 68%;' class='VIS_Pref_slide-show pp'>"),this.topDiv.append(e),e.append(r),r.append(f),f.append(u),u.append(this.relatedToOrg.getControl().css("width","100%")))};i.prototype.init=function(){this.createPageSettings();this.divPaging.append(this.ulPaging);this.$root.append(this.topDiv).append(this.middelDiv).append(this.divPaging).append(this.bottomDiv);this.bottomDiv.append(this.selectAllButton);this.bottomDiv.append(this.btnRefresh);this.bottomDiv.append(this.cancelbtn);this.bottomDiv.append(this.Applybtn);this.bottomDiv.append(this.Okbtn);this.bottomDiv.append(this.divPaging);this.middelDiv.append(this.dGrid);$self=this;this.Okbtn.on("click",function(){var r;if($self.isApplied){$self.$root.dialog("close");return}$self.setBusy(!0);var u=$self.cmbOrder.getControl().find("option:selected").val(),f=$self.cmbInvoice.getControl().find("option:selected").val(),e=$self.cmbShipment.getControl().find("option:selected").val(),i=null;if($self.dGrid!=null&&(i=$self.dGrid.getSelection()),i==null||i.length==0){n.ADialog.info("RecordSelectionRequired");$self.setBusy(!1);return}if($self.locatorField!=null){if($self.dGrid!=null&&u!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.get(i[item]).C_Order_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));else if($self.dGrid!=null&&f!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Invoice_ID_K==$self.dGrid.get(i[item]).C_Invoice_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));$self.MergeItemsForSave();n.VCreateFromShipment.prototype.saveMInOut(!1)}else if($self.cmbBankAccount!=null){if($self.dGrid!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.C_Payment_ID_K==$self.dGrid.get(i[item]).C_Payment_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));n.VCreateFromStatement.prototype.saveStatment();$self.middelDiv.css("height","67%")}else{if($self.dGrid!=null&&u!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.get(i[item]).C_Order_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));if($self.dGrid!=null&&e!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_InOut_ID_K&&n.M_InOut_ID_K==$self.dGrid.get(i[item]).M_InOut_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));n.VCreateFromInvoice.prototype.saveInvoice()}});this.Applybtn.on("click",function(){var r;$self.setBusy(!0);var u=$self.cmbOrder.getControl().find("option:selected").val(),f=$self.cmbInvoice.getControl().find("option:selected").val(),e=$self.cmbShipment.getControl().find("option:selected").val(),i=null;if($self.dGrid!=null&&(i=$self.dGrid.getSelection()),i==null||i.length==0){n.ADialog.info("RecordSelectionRequired");$self.setBusy(!1);return}if($self.locatorField!=null){if($self.dGrid!=null&&u!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.get(i[item]).C_Order_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));else if($self.dGrid!=null&&f!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Invoice_ID_K==$self.dGrid.get(i[item]).C_Invoice_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));$self.MergeItemsForSave();n.VCreateFromShipment.prototype.saveMInOut(!0)}else if($self.cmbBankAccount!=null){if($self.dGrid!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.C_Payment_ID_K==$self.dGrid.get(i[item]).C_Payment_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));n.VCreateFromStatement.prototype.saveStatment();$self.middelDiv.css("height","67%")}else{if($self.dGrid!=null&&u!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.get(i[item]).C_Order_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));if($self.dGrid!=null&&e!=null)for(item in i)r=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(i[item]).M_InOut_ID_K&&n.M_InOut_ID_K==$self.dGrid.get(i[item]).M_InOut_ID_K}),r.length>0||$self.multiValues.push($self.dGrid.get(i[item]));n.VCreateFromInvoice.prototype.saveInvoice()}});i.prototype.callBackSave=function(t){if(t==!1)$self.setBusy(!1);else{$self.isApplied=!0;n.ADialog.info("VIS_SuccessFullyInserted",null,null,null);var i=$self.cmbOrder.getControl().find("option:selected").val(),r=$self.cmbInvoice.getControl().find("option:selected").val(),e=$self.cmbShipment.getControl().find("option:selected").val(),u=$self.vProduct.getValue(),f=$self.deliveryDate.getValue();(i>0||r>0)&&($self.locatorField!=null?($self.dGrid.selectNone(),i>0&&($self.multiValues=[],$self.loadOrders(i,u,f,!1,1)),r>0&&($self.multiValues=[],n.VCreateFromShipment.prototype.loadInvoices(r,u,1)),$self.dGrid.selectNone(),$self.editedItems=[]):($self.dGrid.selectNone(),i>0&&($self.multiValues=[],$self.loadOrders(i,u,f,!0,1)),r>0&&($self.multiValues=[],n.VCreateFromShipment.prototype.loadInvoices(r,u,1)),$self.dGrid.selectNone(),$self.editedItems=[]))}};this.cancelbtn.on("click",function(){$self.setBusy(!1);$self.$root.dialog("close")});this.selectAllButton.on("click",function(){});if(this.relatedToOrg)this.relatedToOrg.getControl().on("click",function(){var n,t,i;$self.isApplied=!1;$self.setBusy(!0);$self.multiValues=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);n=$self.cmbOrder.getControl().find("option:selected").val();n!=null?($self.cmbInvoice.getControl().prop("selectedIndex",-1),$self.cmbShipment.getControl().prop("selectedIndex",-1),t=$self.vProduct.getValue(),i=$self.deliveryDate.getValue(),$self.loadOrders(n,t,i,!1,1)):$self.setBusy(!1)});if(this.btnRefresh)this.btnRefresh.on("click",function(){var t;if($self.cmbBankAccount!=null&&($self.setBusy(!0),t=$self.cmbBankAccount.getControl().find("option:selected").val(),t)){var i=$self.Date.getValue(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(t,r,i,f,u,e,o,s,$self.cmbPage.val())}});if(this.cmbOrder&&this.cmbOrder.getControl().change(function(){var n,t,i;$self.isApplied=!1;$self.setBusy(!0);$self.editedItems=[];$self.multiValues=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);n=$self.cmbOrder.getControl().find("option:selected").val();$self.cmbInvoice.getControl().prop("selectedIndex",-1);$self.cmbShipment.getControl().prop("selectedIndex",-1);$self.lblDeliveryDate.setVisible(!0);$self.deliveryDate.setVisible(!0);t=$self.vProduct.getValue();i=$self.deliveryDate.getValue();$self.locatorField!=null?$self.loadOrders(n,t,i,!1,1):$self.loadOrders(n,t,i,!0,1)}),this.cmbBankAccount&&this.cmbBankAccount.getControl().change(function(){var t;if($self.editedItems=[],$self.setBusy(!0),t=$self.cmbBankAccount.getControl().find("option:selected").val(),t){n.VCreateFromStatement.prototype.initBPartner(t);$self.Date.setValue("");$self.DepositSlip.setValue("");$self.DocumentNo.setValue("");$self.AuthCode.setValue("");var i=$self.vBPartner.getValue(),r=$self.Date.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(t,i,r,f,u,e,o,s,1)}}),this.Date&&this.Date.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.DocumentNo&&this.DocumentNo.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.DepositSlip&&this.DepositSlip.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.AuthCode&&this.AuthCode.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.CheckNo&&this.CheckNo.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.Amount&&this.Amount.getControl().change(function(){$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.Date.getValue(),i=$self.cmbBankAccount.getControl().find("option:selected").val(),r=$self.vBPartner.getValue(),u=$self.DepositSlip.getValue(),f=$self.DocumentNo.getValue(),e=$self.AuthCode.getValue(),o=$self.CheckNo.getValue(),s=$self.Amount.getValue();n.VCreateFromStatement.prototype.loadBankAccounts(i,r,t,f,u,e,o,s,1)}),this.cmbInvoice&&this.cmbInvoice.getControl().change(function(){$self.isApplied=!1;$self.setBusy(!0);$self.editedItems=[];$self.multiValues=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.cmbInvoice.getControl().find("option:selected").val(),i=$self.vProduct.getValue();$self.cmbOrder.getControl().prop("selectedIndex",-1);$self.cmbShipment.getControl().prop("selectedIndex",-1);$self.lblDeliveryDate.setVisible(!1);$self.deliveryDate.setVisible(!1);n.VCreateFromShipment.prototype.loadInvoices(t,i,1)}),this.cmbShipment&&this.cmbShipment.getControl().change(function(){$self.setBusy(!0);$self.editedItems=[];$self.multiValues=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var t=$self.cmbShipment.getControl().find("option:selected").val(),i=$self.vProduct.getValue();$self.cmbOrder.getControl().prop("selectedIndex",-1);$self.cmbInvoice.getControl().prop("selectedIndex",-1);$self.lblDeliveryDate.setVisible(!1);$self.deliveryDate.setVisible(!1);n.VCreateFromInvoice.prototype.loadShipments(t,i,1)}),this.deliveryDate&&this.deliveryDate.getControl().change(function(){$self.isApplied=!1;$self.setBusy(!0);$self.multiValues=[];$self.editedItems=[];$self.dGrid!=null&&($self.dGrid.destroy(),$self.dGrid=null);var n=$self.cmbOrder.getControl().find("option:selected").val(),t=$self.vProduct.getValue(),i=$self.deliveryDate.getValue();$self.locatorField!=null?$self.loadOrders(n,t,i,!1,1):$self.loadOrders(n,t,i,!0,1)}),this.ContainerTree)this.ContainerTree.on("click",function(){var i,t;(n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"]==undefined||n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y",!0))&&(i=$self.locatorField.getValue(),i>0&&(t=new n.productContainerTree(0,i,0),t!=null&&(t.showDialog(),t.onClosing=function(n,t){$self.cmbContainer.getControl().empty();$self.cmbContainer.getControl().append(" <option value="+n+">"+t+"<\/option>")}),t=null),i=null)})};i.prototype.isInitOK=function(){return this.initOK};i.prototype.loadOrders=function(t,i,r,u,f){var e=this.getOrdersData(n.Env.getCtx(),t,i,r,u,f)};i.prototype.getOrdersData=function(i,r,u,f,e,o){var h,v,p,s;if($self.dGrid!=null){h=$self.dGrid.getSelection();for(item in h)v=t.grep($self.multiValues,function(n){return n.M_Product_ID_K==$self.dGrid.get(h[item]).M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.get(h[item]).C_Order_ID_K}),v.length>0||$self.multiValues.push($self.dGrid.get(h[item]))}if($self.mTab.keyColumnName=="M_InOut_ID"?$self.record_ID=$self.mTab.getValue("M_InOut_ID"):$self.mTab.keyColumnName=="C_Invoice_ID"&&($self.record_ID=$self.mTab.getValue("C_Invoice_ID")),$self.relatedToOrg.getValue()){var c="",l="",a="",y="";o||(o=1);c=n.Env.isBaseLanguage(i,"C_UOM")?" LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)":" LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='"+n.Env.getAD_Language(i).concat("')");u!=null&&(l=" AND l.M_Product_ID="+u);f!=null&&(s=n.DB.to_date(f,!0),y=s,a=" AND l.DatePromised <= "+s);p=$self.mTab.getValue($self.windowNo,"AD_Org_ID");t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetOrdersDataCommon",dataType:"json",type:"POST",data:{keyColumnName:$self.mTab.keyColumnName,tableName:"C_OrderLine",recordID:$self.record_ID,pageNo:o,forInvoicees:e,C_Ord_IDs:r,isBaseLangess:c,MProductIDss:l,DelivDates:a,adOrgIDSs:p},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));$self.setBusy(!1);$self.log.info(t);return},success:function(t){var i=JSON.parse(t);if(i.Error){n.ADialog.error(i.Error);$self.setBusy(!1);return}$self.resetPageCtrls(i.pSetting);$self.loadGrid(i.data);$self.setBusy(!1)}})}else{var c="",l="",a="",y="";c=n.Env.isBaseLanguage(i,"C_UOM")?" LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)":" LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='"+n.Env.getAD_Language(i)+"')";u>0&&(l=" AND l.M_Product_ID="+u);f!=null&&(s=n.DB.to_date(f,!0),a=" AND l.DatePromised <= "+s);o||(o=1);t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetOrdersDataCommonOrg",dataType:"json",type:"POST",data:{keyColumnName:$self.mTab.keyColumnName,tableName:"C_OrderLine",recordID:$self.record_ID,pageNo:o,forInvoicees:e,C_Ord_IDs:r,isBaseLangess:c,MProductIDss:l,DelivDates:a},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));$self.setBusy(!1);$self.log.info(t);return},success:function(t){var i=JSON.parse(t);if(i.Error){n.ADialog.error(i.Error);$self.setBusy(!1);return}$self.resetPageCtrls(i.pSetting);$self.loadGrid(i.data);$self.setBusy(!1)}})}return[]};i.prototype.loadOrder=function(t,i){var r=null;r=this.getOrderData(n.Env.getCtx(),t,i);this.loadGrid(r)};i.prototype.getOrderData=function(i,r,u){var o=[],s,f,e;return $self.relatedToOrg.getValue()?(f="",f=n.Env.isBaseLanguage(i,"C_UOM")?" LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)":" LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='"+n.Env.getAD_Language(i)+"')",s=$self.mTab.getValue($self.windowNo,"AD_Org_ID"),e=n.Env.getAD_Language(i),t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetOrderDataCommons",dataType:"json",type:"POST",async:!1,data:{forInvoices:u,isBaseLangs:f,C_OrderID:r,orggetVals:s,langs:e},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));$self.setBusy(!1);$self.log.info(t);return},success:function(n){var i=JSON.parse(n),u,r,t;if(i&&i!=null&&i.length>0)for(u=1,r=0;r<i.length;r++)t={},t.Quantity=i[r].quantity,t.QuantityEntered=i[r].quantityentered,t.C_UOM_ID=i[r].c_uom_id,t.M_Product_ID=i[r].m_product_id,t.M_AttributeSetInstance_ID=i[r].m_attributesetinstance_id,t.C_Order_ID=i[r].c_order_id,t.M_InOut_ID=null,t.C_Invoice_ID=null,t.C_UOM_ID_K=i[r].c_uom_id_k,t.M_Product_ID_K=i[r].m_product_id_k,t.M_AttributeSetInstance_ID_K=i[r].m_attributesetinstance_id_k,t.C_Order_ID_K=i[r].c_order_id_k,t.M_InOut_ID_K=null,t.C_Invoice_ID_K=null,t.C_PaymentTerm_ID=i[r].C_PaymentTerm_ID,t.PaymentTermName=i[r].PaymentTermName,t.IsAdvance=i[r].IsAdvance,t.C_InvoicePaymentTerm_ID=i[r].C_InvoicePaymentTerm_ID,t.IsInvoicePTAdvance=i[r].IsInvoicePTAdvance,t.recid=u,o.push(t);$self.setBusy(!1)}}),o):(f="",f=n.Env.isBaseLanguage(i,"C_UOM")?" LEFT OUTER JOIN C_UOM uom ON (l.C_UOM_ID=uom.C_UOM_ID)":" LEFT OUTER JOIN C_UOM_Trl uom ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='"+n.Env.getAD_Language(i)+"')",e=n.Env.getAD_Language(i),t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetOrderDataCommonsNotOrg",dataType:"json",type:"POST",async:!1,data:{forInvoices:u,isBaseLangs:f,C_OrderID:r,langs:e},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));$self.setBusy(!1);$self.log.info(t);return},success:function(n){var i=JSON.parse(n),u,r,t;if(i&&i!=null&&i.length>0)for(u=1,r=0;r<i.length;r++)t={},t.Quantity=i[r].quantity,t.QuantityEntered=i[r].quantityentered,t.C_UOM_ID=i[r].c_uom_id,t.M_Product_ID=i[r].m_product_id,t.M_AttributeSetInstance_ID=i[r].m_attributesetinstance_id,t.C_Order_ID=i[r].c_order_id,t.M_InOut_ID=null,t.C_Invoice_ID=null,t.C_UOM_ID_K=i[r].c_uom_id_k,t.M_Product_ID_K=i[r].m_product_id_k,t.M_AttributeSetInstance_ID_K=i[r].m_attributesetinstance_id_k,t.C_Order_ID_K=i[r].c_order_id_k,t.M_InOut_ID_K=null,t.C_Invoice_ID_K=null,t.C_PaymentTerm_ID=i[r].C_PaymentTerm_ID,t.PaymentTermName=i[r].PaymentTermName,t.IsAdvance=i[r].IsAdvance,t.C_InvoicePaymentTerm_ID=i[r].C_InvoicePaymentTerm_ID,t.IsInvoicePTAdvance=i[r].IsInvoicePTAdvance,t.recid=u,o.push(t);$self.setBusy(!1)}}),o)};i.prototype.loadGrid=function(i){function s(){for(var n=0;n<$self.dGrid.records.length;n++)$self.NonEditableRecord.indexOf(n+1)>=0&&($self.dGrid.unselect(n+1),t("#grid_"+$self.dGrid.name+"_rec_"+(n+1)+"  input").attr("disabled",!0))}function c(n,i){var r=$self.dGrid.records[i].M_Product_ID_K,e=t.grep($self.editedItems,function(n){return u!=null?n.M_Product_ID_K==r&&n.C_Order_ID_K==$self.dGrid.records[i].C_Order_ID_K:f!=null?n.M_Product_ID_K==r&&n.C_Invoice_ID_K==$self.dGrid.records[i].C_Invoice_ID_K:o!=null?n.M_Product_ID_K==r&&n.M_InOut_ID_K==$self.dGrid.records[i].M_InOut_ID_K:n.C_Payment_ID_K==$self.dGrid.records[item].C_Payment_ID_K});e.length>0?($self.editedItems.splice($self.editedItems.indexOf(e[0]),1),$self.editedItems.push($self.dGrid.records[i])):$self.editedItems.push($self.dGrid.records[i])}function v(n,i,r){var u=null;return t.ajax({url:a,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}var e,h,r;this.dGrid!=null&&(this.dGrid.destroy(),this.dGrid=null);this.arrListColumns.length==0&&(this.arrListColumns.push({field:"Select",caption:n.Msg.getMsg("Select"),sortable:!1,size:"50px",hidden:!1,render:function(){return'<div><input type=checkbox disabled="true"><\/div>'}}),this.arrListColumns.push({field:"Quantity",caption:n.Msg.getMsg("QtyPending"),sortable:!1,size:"150px",render:"number:4",hidden:!1}),this.arrListColumns.push({field:"QuantityPending",caption:n.Msg.getMsg("Quantity"),sortable:!1,size:"150px",render:"number:4",hidden:!0}),this.arrListColumns.push({field:"QuantityEntered",caption:n.Msg.getMsg("QtyEntered"),editable:{type:"float"},render:"number:4",sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"C_UOM_ID",caption:n.Msg.getMsg("UomName"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"M_Product_ID",caption:n.Msg.getMsg("ProductName"),sortable:!0,size:"150px",hidden:!1}),this.arrListColumns.push({field:"M_AttributeSetInstance_ID",caption:n.Msg.getMsg("ASI"),sortable:!1,size:"150px",editable:{type:"custom",ctrl:$self.$productAttribute,showAll:!0},render:function(n){var t=$self.pattrLookup,i=n.M_AttributeSetInstance_ID,r;return n.changes&&typeof n.changes.M_AttributeSetInstance_ID!="undefined"&&(i=n.changes.M_AttributeSetInstance_ID),t&&(r=t.getDisplay(i,!0)),r}}),this.arrListColumns.push({field:"C_PaymentTerm_ID",caption:n.Msg.getMsg("C_PaymentTerm_ID"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"PaymentTermName",caption:n.Msg.getMsg("PaymentTermName"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"IsAdvance",caption:n.Msg.getMsg("IsAdvance"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"C_InvoicePaymentTerm_ID",caption:n.Msg.getMsg("C_InvoicePaymentTerm_ID"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"IsInvoicePTAdvance",caption:n.Msg.getMsg("IsInvoicePTAdvance"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"C_Order_ID",caption:n.Msg.getMsg("OrderLine"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"M_InOut_ID",caption:n.Msg.getMsg("Shipment/Receipt"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"C_Invoice_ID",caption:n.Msg.getMsg("Invoice"),sortable:!1,size:"150px",hidden:!1}),this.arrListColumns.push({field:"C_UOM_ID_K",caption:n.Msg.getMsg("UomName"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"M_Product_ID_K",caption:n.Msg.getMsg("ProductName"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"C_Order_ID_K",caption:n.Msg.getMsg("Order"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"M_InOut_ID_K",caption:n.Msg.getMsg("Shipment/Receipt"),sortable:!1,size:"150px",hidden:!0}),this.arrListColumns.push({field:"C_Invoice_ID_K",caption:n.Msg.getMsg("Invoice"),sortable:!1,size:"150px",hidden:!0}));w2utils.encodeTags(i);e="gridCreateForm"+this.windowNo;e=e.replace(".","");this.dGrid=t(this.middelDiv).w2grid({name:e,recordHeight:30,show:{selectColumn:!0},multiSelect:!0,columns:this.arrListColumns,records:i,onSelect:function(n){n.onComplete=function(){s()}}});this.dGrid.selectNone();var u=$self.cmbOrder.getControl().find("option:selected").val(),f=$self.cmbInvoice.getControl().find("option:selected").val(),o=$self.cmbShipment.getControl().find("option:selected").val();for(itm in $self.multiValues)for(item in $self.dGrid.records)h=t.grep($self.multiValues,function(n){return u!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.records[item].C_Order_ID_K:f!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.C_Invoice_ID_K==$self.dGrid.records[item].C_Invoice_ID_K:o!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.M_InOut_ID_K==$self.dGrid.records[item].M_InOut_ID_K:n.C_Payment_ID_K==$self.dGrid.records[item].C_Payment_ID_K}),h.length>0&&$self.dGrid.select(parseInt(item)+1);if(this.dGrid.records.length>0)for($self.NonEditableRecord=[],r=0;r<$self.dGrid.records.length;r++)t(t("#grid_"+$self.dGrid.name+"_rec_"+(r+1)).find("input[type=checkbox]")[1]).prop("checked",i[r].Select),$self.dGrid.records[r].C_InvoicePaymentTerm_ID==$self.dGrid.records[r].C_PaymentTerm_ID||$self.dGrid.records[r].C_InvoicePaymentTerm_ID==0||$self.dGrid.records[r].C_InvoicePaymentTerm_ID!=$self.dGrid.records[r].C_PaymentTerm_ID&&$self.dGrid.records[r].IsAdvance==!1&&$self.dGrid.records[r].IsInvoicePTAdvance==!1||(t("#grid_"+$self.dGrid.name+"_rec_"+(r+1)+"  input").attr("disabled",!0),$self.NonEditableRecord.push(r+1));this.dGrid.on("change",function(t){if(s(),$self.dGrid.columns[t.column].field=="QuantityEntered"){if($self.fromInvoice){if($self.dGrid.records[t.index].QuantityPending<parseFloat(t.value_new).toFixed(4)){n.ADialog.error("InvoiceQtyGreater");t.value_new=t.value_original;return}}else if($self.dGrid.records[t.index].QuantityPending<parseFloat(t.value_new).toFixed(4)){n.ADialog.error("QtyCanNotbeGreater");t.value_new=t.value_original;return}$self.dGrid.records[t.index].QuantityEntered=parseFloat(t.value_new).toFixed(4);(u>0||f>0)&&c("QuantityEntered",t.index,parseFloat(t.value_new).toFixed(4))}else $self.dGrid.columns[t.column].field=="M_AttributeSetInstance_ID"&&($self.dGrid.records[t.index].M_AttributeSetInstance_ID=t.value_new,(u>0||f>0)&&c("M_AttributeSetInstance_ID",t.index,t.value_new))});this.dGrid.on("click",function(t){t.preventDefault;s();n.Env.getCtx().setContext($self.windowNo,"M_Product_ID",n.Utility.Util.getValueOfInt($self.dGrid.records[t.recid-1].M_Product_ID_K))});var y=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u=null;return v(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u},l=n.Application.contextUrl,a=l+"JsonData/JDataSet",p=l+"JsonData/ExecuteNonQuer";this.dGrid.on("unselect",function(n){if(n.all)n.onComplete=function(){for(item in $self.dGrid.records){var n=t.grep($self.multiValues,function(n){return u!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.C_Order_ID_K==$self.dGrid.records[item].C_Order_ID_K:f!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.C_Invoice_ID_K==$self.dGrid.records[item].C_Invoice_ID_K:o!=null?n.M_Product_ID_K==$self.dGrid.records[item].M_Product_ID_K&&n.M_InOut_ID_K==$self.dGrid.records[item].M_InOut_ID_K:n.C_Payment_ID_K==$self.dGrid.records[item].C_Payment_ID_K});n.length>0&&$self.multiValues.splice($self.multiValues.indexOf(n[0]),1)}};else{var i=w2ui[n.target].records[n.index].M_Product_ID_K,r=t.grep($self.multiValues,function(t){return u!=null?t.M_Product_ID_K==i&&t.C_Order_ID_K==w2ui[n.target].records[n.index].C_Order_ID_K:f!=null?t.M_Product_ID_K==i&&t.C_Invoice_ID_K==w2ui[n.target].records[n.index].C_Invoice_ID_K:o!=null?t.M_Product_ID_K==i&&t.M_InOut_ID_K==w2ui[n.target].records[n.index].M_InOut_ID_K:t.C_Payment_ID_K==$self.dGrid.records[item].C_Payment_ID_K});r.length>0&&$self.multiValues.splice($self.multiValues.indexOf(r[0]),1)}})};n.VCreateFrom=i}(VIS,jQuery),function(n,t){function i(i){function e(){var t,i;return r.title=n.Msg.getMsg("Invoice")+" .. "+n.Msg.getMsg("CreateFrom"),r.lblInvoice!=null&&r.lblInvoice.getControl().css("display","none"),r.cmbInvoice!=null&&r.cmbInvoice.getControl().css("display","none"),r.lblLocator!=null&&r.lblLocator.getControl().css("display","none"),r.locatorField!=null&&r.locatorField.getControl().css("display","none"),r.deliveryDate=new n.Controls.VDate("DeliveryDate",!1,!1,!0,n.DisplayType.Date,"DeliveryDate"),t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),r.windowNo,2221,n.DisplayType.Search),r.vProduct=new n.Controls.VTextBoxButton("M_Product_ID",!0,!1,!0,n.DisplayType.Search,t),i=r.initBPartner(!0),r.vBPartner.setReadOnly(!0),s(i),r.fromInvoice=!0,!0}function o(i,f){var e="s.DocumentNo||' - '||".concat(n.DB.to_char("s.MovementDate",n.DisplayType.Date,n.Env.getAD_Language(n.Env.getCtx()))),o="Y".equals(n.Env.getCtx().getWindowContext(u.windowNo,"IsDropShip")),s="Y".equals(n.Env.getCtx().getWindowContext(u.windowNo,"IsSOTrx"));t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetShipments",type:"POST",data:{displays:e,CBPartnerIDs:f,IsDrop:o,IsSOTrx:s},success:function(t){var u=JSON.parse(t),f,e,i;if(u&&u.length>0){for(i=0;i<u.length;i++)f=n.Utility.Util.getValueOfInt(u[i].key),e=n.Utility.encodeText(u[i].value),i==0&&r.cmbShipment.getControl().append(" <option value=0> <\/option>"),r.cmbShipment.getControl().append(" <option value="+f+">"+e+"<\/option>");r.cmbShipment.getControl().prop("selectedIndex",0)}},error:function(n){u.log.info(n)}})}function s(t){r.cmbShipment.getControl().html("");o(n.Env.getCtx(),t)}var r=this.$super,u,f;r.constructor(i);u=this;e();r.jbInit();r.initOK=!0;f=i.getWindowNo();this.log=n.Logging.VLogger.getVLogger("VCreateFromInvoice");this.disposeComponent=function(){r=null;u=null;this.disposeComponent=null}}n.Utility.inheritPrototype(i,n.VCreateFrom);i.prototype.saveInvoice=function(){var i,n,t;if(this.$super.dGrid==null||(i={},n=this.$super.multiValues,n==null)||n.length<=0)return!1;for(t=0;t<n.length;t++)i[t]=n[t];var r=this.$super.mTab.getValue("C_Invoice_ID"),u=this.$super.cmbOrder.getControl().find("option:selected").val(),f=this.$super.cmbShipment.getControl().find("option:selected").val();return this.saveData(i,"",u,f,r)};i.prototype.loadShipments=function(t,i,r){var u=this.getShipmentsData(n.Env.getCtx(),t,i,r)};i.prototype.getShipmentsData=function(i,r,u,f){var e=this,o,c,s,h;if(this.$super.record_ID=$self.mTab.getValue("C_Invoice_ID"),e.$super.dGrid!=null){o=e.$super.dGrid.getSelection();for(item in o)c=t.grep(e.$super.multiValues,function(n){return n.M_Product_ID_K==e.$super.dGrid.get(o[item]).M_Product_ID_K&&n.M_InOut_ID_K==e.$super.dGrid.get(o[item]).M_InOut_ID_K}),c.length>0||e.$super.multiValues.push(e.$super.dGrid.get(o[item]))}return s="",h="",s=n.Env.isBaseLanguage(i,"C_UOM")?"FROM C_UOM uom INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID) ":"FROM C_UOM_Trl uom Left join C_UOM uom1 on (uom1.C_UOM_ID=uom.C_UOM_ID)  INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='"+n.Env.getAD_Language(i)+"') ",u!=null&&(h=" AND l.M_Product_ID="+u),f||(f=1),t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetDataVCreateFrom",dataType:"json",type:"POST",data:{keyColumnName:e.$super.mTab.keyColumnName,tableName:"M_InOutLine",recordID:e.$super.record_ID,pageNo:f,mInOutId:r,isBaseLanguages:s,mProductIDD:h},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));e.$super.setBusy(!1);selfChild.log.info(t);return},success:function(t){var i=JSON.parse(t);if(i.Error){n.ADialog.error(i.Error);e.$super.setBusy(!1);return}e.$super.resetPageCtrls(i.pSetting);e.$super.loadGrid(i.data);e.$super.setBusy(!1)}}),[]};i.prototype.loadShipment=function(t){var i=this.getShipmentData(n.Env.getCtx(),t);this.$super.loadGrid(i)};i.prototype.getShipmentData=function(i,r){var u="";return u=n.Env.isBaseLanguage(i,"C_UOM")?"FROM C_UOM uom INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID) ":"FROM C_UOM_Trl uom INNER JOIN M_InOutLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='"+n.Env.getAD_Language(i)+"') ",t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetShipmentDatas",type:"POST",async:!1,data:{MInOutIDs:r,isBaseLanguageUmos:u},success:function(n){var i=JSON.parse(n),r,u;if(i&&i.length>0)for(r=1,u=0;u<i.length;u++){var t={},f=dr.getDecimal(0),e=dr.getDecimal(1);t.Quantity=f;t.QuantityEntered=e;t.C_UOM_ID=dr.getString(3);t.M_Product_ID=dr.getString(5);t.C_Order_ID=".";t.M_InOut_ID=dr.getString(7);t.C_Invoice_ID=null;t.C_UOM_ID_K=dr.getString(2);t.M_Product_ID_K=dr.getInt(4);t.C_Order_ID_K=dr.getInt(8);t.M_InOut_ID_K=dr.getInt(6);t.C_Invoice_ID_K=null;t.recid=r;r++;n.push(t)}},error:function(){}}),[]};i.prototype.saveData=function(i,r,u,f,e){var o=this;t.ajax({type:"POST",url:n.Application.contextUrl+"Common/SaveInvoice",dataType:"json",data:{model:i,selectedItems:r,C_Order_ID:u,C_Invoice_ID:e,M_inout_id:f},success:function(n){if(returnValue=n.result,returnValue){o.dispose();o.$super.$root.dialog("close");o.$super.setBusy(!1);return}o.$super.setBusy(!1);alert(returnValue)},error:function(n,t,i){console.log(t);o.$super.setBusy(!1);alert(i)}})};i.prototype.dispose=function(){this.disposeComponent!=null&&this.disposeComponent()};n.VCreateFromInvoice=i}(VIS,jQuery),function(n,t){function i(i){function f(){var e,t,i,u,f;r.title=n.Msg.getElement(n.Env.getCtx(),"M_InOut_ID",!1)+" .. "+n.Msg.translate(n.Env.getCtx(),"CreateFrom");r.lblShipment!=null&&r.lblShipment.getControl().css("display","none");r.cmbShipment!=null&&r.cmbShipment.getControl().css("display","none");r.Applybtn&&r.Applybtn.css("display","block");e=3537;t=new n.MLocatorLookup(n.Env.getCtx(),r.windowNo);r.locatorField=new n.Controls.VLocator("M_Locator_ID",!0,!1,!0,n.DisplayType.Locator,t);r.deliveryDate=new n.Controls.VDate("DeliveryDate",!1,!1,!0,n.DisplayType.Date,"DeliveryDate");i=n.MLookupFactory.getMLookUp(n.Env.getCtx(),r.windowNo,2221,n.DisplayType.Search);r.vProduct=new n.Controls.VTextBoxButton("M_Product_ID",!0,!1,!0,n.DisplayType.Search,i);r.DocumentNoRef=new n.Controls.VTextBox("DocumentNo",!1,!0,!0,50,100,null,null,!1);r.lblContainer=new n.Controls.VLabel;r.cmbContainer=new n.Controls.VComboBox("",!1,!1,!0);r.lblContainer.getControl().text(n.Msg.getMsg("VIS_Container"));r.lblContainer!=null&&r.lblContainer.getControl().css("display","block");r.cmbContainer!=null&&r.cmbContainer.getControl().css("display","block");u=n.Env.getCtx().getContextAsInt(r.windowNo,"DocumentNo");r.DocumentNoRef.setValue(u);f=r.initBPartner(!1);r.vBPartner.setReadOnly(!0);o(f)}function e(i,f,e){var o="i.DocumentNo||' - '||".concat(n.DB.to_char("DateInvoiced",n.DisplayType.Date,n.Env.getAD_Language(i))).concat("|| ' - ' ||").concat(n.DB.to_char("GrandTotal",n.DisplayType.Amount,n.Env.getAD_Language(i))),s="Y".equals(n.Env.getCtx().getWindowContext(u.windowNo,"IsDropShip"));t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetInvoicesVCreate",type:"POST",data:{displays:o,cBPartnerId:f,isReturnTrxs:e,IsDrops:s},success:function(t){var u=JSON.parse(t),f,e,i;if(u&&u.length>0)try{for(i=0;i<u.length;i++)f=n.Utility.Util.getValueOfInt(u[i].key),e=n.Utility.encodeText(u[i].value),i==0&&r.cmbInvoice.getControl().append(" <option value=0> <\/option>"),r.cmbInvoice.getControl().append(" <option value="+f+">"+e+"<\/option>");r.cmbInvoice.getControl().prop("selectedIndex",0)}catch(o){}},error:function(n){u.log.info(n)}})}function o(t){r.cmbInvoice.getControl().html("");var i="Y".equals(n.Env.getCtx().getWindowContext(r.windowNo,"IsReturnTrx"));e(n.Env.getCtx(),t,i)}var r=this.$super,u;r.constructor(i);u=this;f();r.jbInit();r.initOK=!0;this.log=n.Logging.VLogger.getVLogger("VCreateFromShipment");this.disposeComponent=function(){r=null;u=null;this.disposeComponent=null}}n.Utility.inheritPrototype(i,n.VCreateFrom);i.prototype.saveMInOut=function(t){var u,i,r,f,e;if(this.$super.dGrid==null||(u={},i=this.$super.multiValues,i==null)||i.length<=0)return this.$super.setBusy(!1),!1;for(r=0;r<i.length;r++)u[r]=i[r];if(f=this.$super.locatorField.getValue(),f==null||f==0)return n.ADialog.info("Error",!0,n.Msg.translate(n.Env.getCtx(),"VIS_locfieldMandatory"),""),this.$super.setBusy(!1),!1;if(u.length==0)return this.$super.setBusy(!1),!1;e=this.$super.cmbContainer.getValue();e===undefined&&(e=0);var o=f,s=this.$super.mTab.getValue("M_InOut_ID"),h=this.$super.cmbInvoice.getControl().find("option:selected").val(),c=this.$super.cmbOrder.getControl().find("option:selected").val();return this.saveData(u,"",c,h,o,s,e,t)};i.prototype.loadInvoices=function(t,i,r){var u=this.getInvoicesData(n.Env.getCtx(),t,i,r)};i.prototype.getInvoicesData=function(i,r,u,f){var e=this,o,c,s,h;if(this.$super.record_ID=$self.mTab.getValue("M_InOut_ID"),e.$super.dGrid!=null){o=e.$super.dGrid.getSelection();for(item in o)c=t.grep(e.$super.multiValues,function(n){return n.M_Product_ID_K==e.$super.dGrid.get(o[item]).M_Product_ID_K&&n.C_Invoice_ID_K==e.$super.dGrid.get(o[item]).C_Invoice_ID_K}),c.length>0||e.$super.multiValues.push(e.$super.dGrid.get(o[item]))}return s="",h="",s=n.Env.isBaseLanguage(i,"C_UOM")?"FROM C_UOM uom INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID) ":"FROM C_UOM_Trl uom Left join C_UOM uom1 on (uom1.C_UOM_ID=uom.C_UOM_ID) INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='"+n.Env.getAD_Language(i)+"') ",u!=null&&(h=" AND l.M_Product_ID = "+u),f||(f=1),t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetInvoicesDataVCreate",dataType:"json",type:"POST",data:{keyColumnName:e.$super.mTab.keyColumnName,tableName:"C_InvoiceLine",recordID:e.$super.record_ID,pageNo:f,isBaseLangss:s,cInvoiceID:r,mProductIDs:h},error:function(t){alert(n.Msg.getMsg("ErrorWhileGettingData"));selfChild.log.info(t);e.$super.setBusy(!1);return},success:function(t){var i=JSON.parse(t);if(i.Error){n.ADialog.error(i.Error);e.$super.setBusy(!1);return}e.$super.resetPageCtrls(i.pSetting);e.$super.loadGrid(i.data);e.$super.setBusy(!1)}}),[]};i.prototype.initContainerDetails=function(){this.$super.cmbContainer.getControl().html("")};i.prototype.loadInvoice=function(t){var i=this.getInvoiceData(n.Env.getCtx(),t);this.$super.loadGrid(i)};i.prototype.getInvoiceData=function(t,i){var o=[],f="SELECT round((l.QtyInvoiced-SUM(COALESCE(mi.Qty,0))) * (CASE WHEN l.QtyInvoiced=0 THEN 0 ELSE l.QtyEntered/l.QtyInvoiced END ),2) as QUANTITY,round((l.QtyInvoiced-SUM(COALESCE(mi.Qty,0))) * (CASE WHEN l.QtyInvoiced=0 THEN 0 ELSE l.QtyEntered/l.QtyInvoiced END ),2) as QTYENTER, l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name), l.M_Product_ID,p.Name, l.C_InvoiceLine_ID,l.Line, l.C_OrderLine_ID ",u,e;f=n.Env.isBaseLanguage(t,"C_UOM")?f.concat("FROM C_UOM uom ").concat("INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID) "):f.concat("FROM C_UOM_Trl uom ").concat("INNER JOIN C_InvoiceLine l ON (l.C_UOM_ID=uom.C_UOM_ID AND uom.AD_Language='").concat(n.Env.getAD_Language(t)).concat("') ");f=f.concat("INNER JOIN M_Product p ON (l.M_Product_ID=p.M_Product_ID) ").concat("LEFT OUTER JOIN M_MatchInv mi ON (l.C_InvoiceLine_ID=mi.C_InvoiceLine_ID) ").concat("WHERE l.C_Invoice_ID="+i+" GROUP BY l.QtyInvoiced,l.QtyEntered,l.C_UOM_ID,COALESCE(uom.UOMSymbol,uom.Name),l.M_Product_ID,p.Name, l.C_InvoiceLine_ID,l.Line,l.C_OrderLine_ID ORDER BY l.Line");u=null;try{for(u=n.DB.executeReader(f.toString(),null,null),e=1;u.read();){var r={},s=u.getDecimal(0),h=u.getDecimal(1);r.Quantity=s;r.QuantityEntered=h;r.C_UOM_ID=u.getString(3);r.M_Product_ID=u.getString(5);r.C_Order_ID=".";r.M_InOut_ID=null;r.C_Invoice_ID=u.getString(7);r.C_UOM_ID_K=u.getString(2);r.M_Product_ID_K=u.getInt(4);r.C_Order_ID_K=u.getInt(8);r.M_InOut_ID_K=null;r.C_Invoice_ID_K=u.getInt(6);r.recid=e;e++;o.push(r)}u.close()}catch(c){}return o};i.prototype.saveData=function(i,r,u,f,e,o,s,h){var c=this;console.log(e);t.ajax({type:"POST",url:n.Application.contextUrl+"Common/SaveShipment",dataType:"json",data:{model:i,selectedItems:r,C_Order_ID:u,C_Invoice_ID:f,M_Locator_ID:e,M_InOut_ID:o,Container_ID:s},success:function(n){if(returnValue=n.result,returnValue){h?c.$super.callBackSave(returnValue):(c.dispose(),c.$super.setBusy(!1),c.$super.$root.dialog("close"));return}},error:function(n,t,i){console.log(t);c.$super.setBusy(!1);alert(i)}})};i.prototype.dispose=function(){this.disposeComponent!=null&&this.disposeComponent()};n.VCreateFromShipment=i}(VIS,jQuery),function(n,t){function i(t){function f(){var f,e,t;return i.mTab.getValue("C_BankStatement_ID")==null?(n.ADialog.error(n.Msg.getMsg("SaveErrorRowNotFound",!0)),!1):(i.title=n.Msg.getElement(n.Env.getCtx(),"C_BankStatement_ID",!1)+" .. "+n.Msg.getMsg("CreateFrom"),i.relatedToOrg=null,i.lblOrder!=null&&i.lblOrder.getControl().css("display","none"),i.cmbOrder!=null&&i.cmbOrder.getControl().css("display","none"),i.lblShipment!=null&&i.lblShipment.getControl().css("display","none"),i.cmbShipment!=null&&i.cmbShipment.getControl().css("display","none"),i.lblInvoice!=null&&i.lblInvoice.getControl().css("display","none"),i.cmbInvoice!=null&&i.cmbInvoice.getControl().css("display","none"),f=4917,e=n.MLookupFactory.getMLookUp(n.Env.getCtx(),u,f,n.DisplayType.TableDir),i.cmbBankAccount=new n.Controls.VComboBox("C_BankAccount_ID",!0,!0,!0,e,150,n.DisplayType.TableDir,0),i.Date=new n.Controls.VDate("Date",!1,!1,!0,n.DisplayType.Date,"Date"),i.DocumentNo=new n.Controls.VTextBox("DocumentNo",!1,!1,!0,50,100,null,null,!1),i.Amount=new n.Controls.VAmountTextBox("Amount",!1,!1,!0,50,100,n.DisplayType.Amount,n.Msg.getMsg("Amount")),i.DepositSlip=new n.Controls.VTextBox("DepositSlip",!1,!1,!0,50,100,null,null,!1),i.AuthCode=new n.Controls.VTextBox("AuthCode",!1,!1,!0,50,100,null,null,!1),i.CheckNo=new n.Controls.VTextBox("CheckNo",!1,!1,!0,50,100,null,null,!1),i.cmbBankAccount.getControl().prop("selectedIndex",0),t=n.Env.getCtx().getContextAsInt(u,"C_BankAccount_ID"),i.cmbBankAccount.setValue(t),r.initBPartner(t),r.loadBankAccounts(t,0,"","","","","","0",1),i.btnRefresh&&i.btnRefresh.css("display","black"),!0)}var i=this.$super,r,u;i.constructor(t);r=this;u=t.getWindowNo();f();i.jbInit();i.initOK=!0;i.middelDiv.css("height","67%");this.disposeComponent=function(){this.disposeComponent=null}}function u(n,i,r){var u=null;return t.ajax({url:e,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}var f,o;n.Utility.inheritPrototype(i,n.VCreateFrom);i.prototype.initBPartner=function(t){var i=this.$super,r=" C_BPartner.C_BPartner_ID IN (SELECT  p.C_BPartner_ID as C_BPartner_ID FROM C_Payment p WHERE p.Processed='Y' AND p.IsReconciled='N' AND p.DocStatus IN ('CO','CL','RE','VO') AND p.PayAmt<>0 AND p.C_BankAccount_ID = "+t+" AND NOT EXISTS (SELECT * FROM C_BankStatementLine l WHERE p.C_Payment_ID=l.C_Payment_ID AND l.StmtAmt <> 0) )",u=n.MLookupFactory.get(n.Env.getCtx(),this.windowNo,5398,n.DisplayType.Search,"C_BPartner_ID",0,!1,r);i.vBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,u)};i.prototype.getTableFieldVOs=function(){var t=this.$super,i;t.arrListColumns=[];t.arrListColumns.push({field:"Date",caption:n.Msg.getMsg("DateAcct"),sortable:!0,size:"100px",hidden:!1,render:"date"});t.arrListColumns.push({field:"C_Payment_ID",caption:n.Msg.getMsg("Payment"),sortable:!0,size:"100px",hidden:!1});t.arrListColumns.push({field:"C_Currency_ID",caption:n.Msg.getMsg("Currency"),sortable:!0,size:"80px",hidden:!1});i=n.Utility.Util.getValueOfInt(f("VIS_145"));i>0&&t.arrListColumns.push({field:"VA034_DepositSlipNo",caption:n.Msg.getMsg("DepositSlipNo"),sortable:!0,size:"100px",hidden:!1});t.arrListColumns.push({field:"AuthCode",caption:n.Msg.getMsg("AuthCode"),sortable:!0,size:"100px",hidden:!1});t.arrListColumns.push({field:"CheckNo",caption:n.Msg.getMsg("CheckNo"),sortable:!0,size:"80px",hidden:!1});t.arrListColumns.push({field:"Amount",caption:n.Msg.getMsg("Amount"),sortable:!0,size:"80px",hidden:!1});t.arrListColumns.push({field:"ConvertedAmount",caption:n.Msg.getMsg("ConvertedAmount"),sortable:!0,size:"80px",hidden:!1});t.arrListColumns.push({field:"Description",caption:n.Msg.getMsg("Description"),sortable:!0,size:"250px",hidden:!1});t.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.getMsg("BusinessPartner"),sortable:!0,size:"150px",hidden:!1});t.arrListColumns.push({field:"Type",caption:n.Msg.getMsg("Type"),sortable:!0,size:"80px",hidden:!0});t.arrListColumns.push({field:"C_Payment_ID_K",caption:n.Msg.getMsg("Payment"),sortable:!0,size:"150px",hidden:!0});t.arrListColumns.push({field:"C_Currency_ID_K",caption:n.Msg.getMsg("Currency"),sortable:!0,size:"150px",hidden:!0})};i.prototype.loadBankAccounts=function(t,i,r,u,f,e,o,s,h){var c=this.$super,l=c.mTab.getValue("StatementDate"),a=this.getBankAccountsData(n.Env.getCtx(),t,i,r,l,u,f,e,o,s,h);this.getTableFieldVOs()};i.prototype.getBankAccountsData=function(i,r,u,f,e,o,s,h,c,l,a){var v=this,y,p,nt,tt;if(v.$super.dGrid!=null){y=v.$super.dGrid.getSelection();for(item in y)p=t.grep(v.$super.multiValues,function(n){return n.C_Payment_ID_K==v.$super.dGrid.get(y[item]).C_Payment_ID_K}),p.length>0||v.$super.multiValues.push(v.$super.dGrid.get(y[item]))}e==null&&(e=DateTime.Today.Date);var it=n.DB.to_date(e,!0),w="",b="",k="0",d="",g="";return u>0&&(k=" AND p.C_BPartner_ID = "+u),o!=""&&(d=" AND p.DocumentNo LIKE '"+o+"'"),f!=""&&f!=null&&(nt=n.DB.to_date(f,!0),w=" AND p.DateAcct = "+nt),o!=""&&(g=" AND cs.DocumentNo LIKE '"+o+"'"),f!=""&&f!=null&&(tt=n.DB.to_date(f,!0),b=" AND cs.DateAcct = "+tt),a||(a=1),t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetBankAccountsData",dataType:"json",type:"POST",data:{pageNo:a,dates:it,trxDatess:w,trxDatesUnions:b,cBPartnerIDs:k,DocumentNos:d,DocumentNoUnions:g,DepositSlips:s,AuthCodes:h,CheckNos:c,Amounts:l,cBankAccountId:r},error:function(){alert(n.Msg.getMsg("ErrorWhileGettingData"));v.$super.setBusy(!1);return},success:function(t){var i=JSON.parse(t);if(i.Error){n.ADialog.error(i.Error);v.$super.setBusy(!1);return}v.$super.resetPageCtrls(i.pSetting);v.$super.loadGrid(i.data);v.$super.setBusy(!1)}}),[]};i.prototype.loadBankAccount=function(t){var i=this.$super,r=i.mTab.getValue("StatementDate"),u=this.getBankAccountData(n.Env.getCtx(),t,r);this.getTableFieldVOs();setTimeout(function(){i.loadGrid(u)},10)};i.prototype.getBankAccountData=function(i,r,u){var s=[],f,o,e;try{for(u==null&&(u=DateTime.Today.Date),f=null,t.ajax({url:n.Application.contextUrl+"Form/GetBankAccontData",async:!1,data:{C_BankAccount_ID:r,ts:u}}).done(function(t){f=(new n.DB.DataReader).toJson(t)}),o=1;f.read();)e={},e.Date=f.getString(0),e.C_Payment_ID=f.getString(2),e.C_Currency_ID=f.getString(4),e.Amount=f.getDecimal(5),e.ConvertedAmount=f.getDecimal(6),e.C_BPartner_ID=f.getString(7),e.Type=f.getString(8),e.C_Payment_ID_K=f.getString(1),e.C_Currency_ID_K=f.getInt(3),e.recid=o,o++,s.push(e)}catch(h){}return s};var r=n.Application.contextUrl,e=r+"JsonData/JDataSetWithCode",s=r+"JsonData/ExecuteNonQuer";f=function(t,i,r){var e=r?!0:!1,o={sql:t,page:1,pageSize:0},f=null;return u(o,e,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);f=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;e&&r(f)}),f};o=function(t,i,r){var o=r?!0:!1,e={sql:t,page:1,pageSize:0},f;return i&&(e.param=i),f=null,u(e,o,function(t){f=(new n.DB.DataReader).toJson(t);r&&r(f)}),f};i.prototype.saveStatment=function(){var n;if(this.$super.dGrid==null)return!1;var r=this.$super.mTab.getValue("C_BankStatement_ID"),i={},t=this.$super.multiValues;if(t==null||t.length<=0)return!1;for(n=0;n<t.length;n++)i[n]=t[n];return this.saveData(i,"",r)};i.prototype.saveData=function(i,r,u){var f=this;t.ajax({type:"POST",url:n.Application.contextUrl+"Common/SaveStatment",dataType:"json",data:{model:i,selectedItems:r,C_BankStatement_ID:u},success:function(n){if(returnValue=n.result,returnValue){f.dispose();f.$super.$root.dialog("close");f.$super.setBusy(!1);return}f.$super.setBusy(!1);alert(returnValue)},error:function(n,t,i){console.log(t);f.$super.setBusy(!1);alert(i)}})};i.prototype.dispose=function(){this.disposeComponent!=null&&this.disposeComponent()};n.VCreateFromStatement=i}(VIS,jQuery),function(n,t){function i(){function c(){var t='<div style="width: 400px;margin: 20px auto;vertical-align: middle;"><div style="width: 400px;float: left;"><div style="width: 100px;float: left;   margin-top: 8px;"><span>'+n.Msg.getMsg("VISPRO_SelectTable")+'<\/span><\/div><div style="width: 300px;float: left;"><select style="width: 100%;float: left;" class="VIS_Pref_pass" id="cmbAllTable_@windowNo"><\/select><\/div><\/div><div style="float: left;margin-left: 5px;margin-top: 7px; display: none;"><input id="chkAllTable_@windowNo" type="checkbox" /><span>'+n.Msg.getMsg("VISPRO_AllTable")+'<\/span><\/div><div style="width: 400px;float: left; display: none;"><div style="width: 100px;float: left;"><span>'+n.Msg.getMsg("VISPRO_Path")+'<\/span><\/div><div style="width: 300px;float: left;"><input style="width: 81%;float: left;" class="VIS_Pref_pass" type="text" id="txtpath_@windowNo" /><input type="file" multiple="" webkitdirectory="" style="height: -1px; width:30px "><\/div><\/div><div style="width: 400px;float: left; display: none;"><div style="width: 100px;float: left;"><span>'+n.Msg.getMsg("VISPRO_EntityType")+'<\/span><\/div><div style="width: 300px;float: left;"><input id="chkClassType_@windowNo" type="checkbox" /><span>'+n.Msg.getMsg("VISPRO_ClassType")+'<\/span><\/div><\/div><div class="VIS-locator-DivStyle" style="text-align: right"><input type="button" id="btnCancel_@windowNo" style="margin-bottom:0px;margin-top:0px; float:right " value="'+n.Msg.getMsg("Cancel")+'" class="VIS_Pref_btn-2" /><input type="button" id="btnOk_@windowNo" style="margin-bottom:0px;margin-top:0px; float:right; margin-right:10px" class="VIS_Pref_btn-2" value="'+n.Msg.getMsg("VIS_Genrate")+'" /><a href="javascript:void(0)" class="VIS_Pref_pass-btn" style="display: none; margin-bottom: 0px; margin-top: 0px;float: right; margin-right: 10px;" id="btnOkA_@windowNo" >'+n.Msg.getMsg("VIS_Download")+"<\/a><\/div><\/div>";t=t.replaceAll("@windowNo",i.windowNo);r.html(t);r.append(s);u=r.find("#btnOk_"+i.windowNo);e=r.find("#btnCancel_"+i.windowNo);f=r.find("#btnOkA_"+i.windowNo);h=r.find("#cmbAllTable_"+i.windowNo);chkAllTable=r.find("#chkAllTable_"+i.windowNo);txtpath=r.find("#txtpath_"+i.windowNo);chkClassType=r.find("#chkClassType_"+i.windowNo)}function l(){y()}function a(){if(u!=null)u.on(n.Events.onTouchStartOrClick,function(){o(!0);v();o(!1)});if(f!=null)f.on(n.Events.onTouchStartOrClick,function(){f.css("display","none");u.css("display","block")});if(e!=null)e.on(n.Events.onTouchStartOrClick,function(){i.dispose()})}function v(){var e=i,r=h.find("option:selected").val();t.ajax({url:n.Application.contextUrl+"Common/GenerateXClasses",dataType:"json",data:{directory:"",chkStatus:!1,tableId:r,classType:""},success:function(t){if(t.contant!=null){var i="data:text/csv;charset=utf-8,"+encodeURIComponent(t.contant);f.attr("download",t.fileName).attr("href",i).attr("target","_blank");n.ADialog.info(t.msg);f.css("display","block");u.css("display","none")}o(!1)}})}function y(){t.ajax({url:n.Application.contextUrl+"GenerateXModel/GenXModelGetTable",type:"POST",async:!1,success:function(t){var r=t.result,i;if(r)for(i=0;i<r.length;i++)h.append("<option value='"+r[i].AD_Table_ID+"'>"+n.Utility.encodeText(r[i].Name)+"<\/option>")},error:function(n){i.log.info(n)}})}function k(n,i,r){var u=null;return t.ajax({url:w,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function o(n){s.css("display",n?"block":"none")}this.frame;this.windowNo;this.log=n.Logging.VLogger.getVLogger("GenerateXModel");var i=this,r=t("<div style='width: 100%; height: 100%; background-color: white;'>"),s=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),u=null,f=null,e=null,h=null;varchkAllTable=null;vartxtpath=null;varchkClassType=null;var p=n.Application.contextUrl,w=p+"JsonData/JDataSet",b=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,k(f,e,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u};this.Initialize=function(){c();l();a();o(!1)};this.getRoot=function(){return r};this.disposeComponent=function(){u&&u.off(n.Events.onTouchStartOrClick);e&&e.off(n.Events.onTouchStartOrClick);i=null;this.windowNo=null;r=null;s=null;this.getRoot=null;this.disposeComponent=null}}n.AForms=n.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;try{this.Initialize()}catch(i){}this.frame.getContentGrid().append(this.getRoot())};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.AForms.GenerateXModel=i}(VIS,jQuery),function(n,t){function i(i,r,u){this.windowNo=i;this.AD_Client_ID=r;this.AD_Org_ID=0;this.DateFrom=null;this.DateTo=null;var f=this;this.ASchemas=[];this.ASchema=[];this.log=n.Logging.VLogger.getVLogger("AccountViewer");this.dataByData=null;this._elements=[];this.documentQuery=!1;this.C_AcctSchema_ID=0;this.PostingType="";this.AD_Table_ID=u;this.Record_ID=0;this.whereInfo=[];this.tableInfo=[];this.displayQty=!1;this.displaySourceAmt=!1;this.displayDocumentInfo=!1;this.sortBy1="";this.sortBy2="";this.sortBy3="";this.sortBy4="";this.group1=!1;this.group2=!1;this.group3=!1;this.group4=!1;this._leadingColumns=0;this._ref1=null;this._ref2=null;this.TABLE_ALIAS="zz";this.FUNCTION_COUNT="Count";this.FUNCTION_SUM="Sum";this.onLoaded=null;this.AD_Client_ID==0&&(this.AD_Client_ID=n.Env.getCtx().getContextAsInt(this.windowNo,"AD_Client_ID"));this.AD_Client_ID==0&&(this.AD_Client_ID=n.Env.getCtx().ctx.AD_Client_ID);this.AD_Org_ID==0&&(this.AD_Org_ID=Number(n.context.getWindowTabContext(this.windowNo,0,"AD_Org_ID")));this.ELEMENTTYPE_AD_Reference_ID=181;this.ELEMENTTYPE_Account="AC";this.ELEMENTTYPE_Activity="AY";this.ELEMENTTYPE_BPartner="BP";this.ELEMENTTYPE_LocationFrom="LF";this.ELEMENTTYPE_LocationTo="LT";this.ELEMENTTYPE_Campaign="MC";this.ELEMENTTYPE_Organization="OO";this.ELEMENTTYPE_OrgTrx="OT";this.ELEMENTTYPE_Project="PJ";this.ELEMENTTYPE_Product="PR";this.ELEMENTTYPE_SubAccount="SA";this.ELEMENTTYPE_SalesRegion="SR";this.ELEMENTTYPE_UserList1="U1";this.ELEMENTTYPE_UserList2="U2";this.ELEMENTTYPE_UserElement1="X1";this.ELEMENTTYPE_UserElement2="X2";this.getClientAcctSchema=function(i,r){var e=[],u=this;return t.ajax({url:n.Application.contextUrl+"AcctViewerData/GetClientAcctSchema",type:"POST",async:!0,data:{ad_client_id:i,ad_org_id:r},success:function(t){var r,f,o,i,s;if(t.result&&t.result.AcctSchemas)for(r=t.result.AcctSchemas,i=0;i<r.length;i++)f={},c_acctschema_id=r[i].Key,f.Key=c_acctschema_id,f.Name=n.Utility.encodeText(r[i].Name),e.push(f);if(t.result&&t.result.OtherAcctSchemas)for(o=t.result.OtherAcctSchemas,i=0;i<o.length;i++)s={},s.Key=o[i].Key,s.Name=n.Utility.encodeText(o[i].Name),e.push(s);u.ASchemas=e;u.ASchema=e[0];u.onLoaded&&u.onLoaded()},error:function(n){f.log.info(n);u.onLoaded&&u.onLoaded()}}),e};this.getClientAcctSchema(this.AD_Client_ID,this.AD_Org_ID)}function r(r,u,f,e,o){function hf(){ku.getControl().text(n.Msg.getMsg("Selection"));hr.getControl().text(n.Msg.translate(n.Env.getCtx(),fr));si.getControl().text(n.Msg.translate(n.Env.getCtx(),fr));cr.getControl().text(n.Msg.translate(n.Env.getCtx(),ou));ft.find("label").text(n.Msg.getMsg(hu));vr.getControl().text(n.Msg.translate(n.Env.getCtx(),su));yr.getControl().text(n.Msg.translate(n.Env.getCtx(),vi));lr.getControl().text(n.Msg.translate(n.Env.getCtx(),cu));ar.getControl().text(n.Msg.translate(n.Env.getCtx(),"AcctDateTo"));pr.getControl().text(n.Msg.translate(n.Env.getCtx(),er));wr.getControl().text(n.Msg.translate(n.Env.getCtx(),or));br.getControl().text(n.Msg.translate(n.Env.getCtx(),"Project"));kr.getControl().text(n.Msg.translate(n.Env.getCtx(),sr));du.getControl().text(n.Msg.getMsg("Display"));di.find("label").text(n.Msg.getMsg("DisplayQty"));nr.find("label").text(n.Msg.getMsg("DisplaySourceInfo"));gi.find("label").text(n.Msg.getMsg("DisplayDocumentInfo"));dr.getControl().text(n.Msg.getMsg("SortBy"));gr.getControl().text(n.Msg.getMsg("GroupBy"));dt.getControl().css("color","#19A0ED");k.text(n.Msg.getMsg("RePost"));k.show();at.find("label").text(n.Msg.getMsg("Force"));at.show()}function cf(){ui.css("font-size","14px").css("color","#333333");ri.css("font-size","28px").css("color","#19A0ED");vt.show();w.show();ni.css("display","none");k.hide();at.hide();si.getControl().hide();g.getControl().hide();w.find("#btnSelctDoc_"+h).attr("name",w.find("#btnSelctDoc_"+h).parent().find("select").val()+"_ID");w.find("#btnSelctDocClear_"+h).attr("name",w.find("#btnSelctDocClear_"+h).parent().find("select").val()+"_ID")}function uu(){ri.css("font-size","14px").css("color","#333333");ui.css("font-size","28px").css("color","#19A0ED");vt.hide();w.hide();ni.css("display","block");k.show();at.show();si.getControl().show();g.getControl().show()}function nt(n){ur.css("display",n?"block":"none")}function lf(i){var e,s,o,u,f,r,c;for(l.dGrid!=null&&(l.dGrid.destroy(),l.dGrid=null),l.arrListColumns=[],e=[],s=1,o=0;o<i.Data.length;o++){for(u=i.Data[o],f={},r=0;r<i.Columns.length;r++)l.arrListColumns.length!=i.Columns.length&&l.arrListColumns.push({field:i.Columns[r],caption:n.Msg.translate(n.Env.getCtx(),i.Columns[r]),sortable:!0,size:"16%",hidden:!1}),u[r]!=null&&typeof u[r]=="object"?f[i.Columns[r]]=u[r].Name:u[r]!=null&&i.Columns[r].indexOf("Date")>0?(c=new Date(parseInt(u[r].substr(6))),e!=null&&(f[i.Columns[r]]=c.toDateString())):f[i.Columns[r]]=u[r];f.recid=s;s++;e.push(f)}setTimeout(10);w2utils.encodeTags(e);l.dGrid=t(ni).w2grid({name:"gridAccViewer"+h,recordHeight:40,columns:l.arrListColumns,records:e})}function fi(n){var i=n.attr("name"),t;return n.find("span").text(" "),s.whereInfo.length>0&&(t=s.whereInfo.map(function(n){return n.Key==i}).indexOf(!0),s.whereInfo.splice(t,1)),n.width=44,0}function af(){if(ri!=null)ri.on(n.Events.onTouchStartOrClick,function(){cf()});if(ui!=null)ui.on(n.Events.onTouchStartOrClick,function(){uu()});if(ct!=null&&ct.getControl().change(function(){gu()}),g!=null&&g.getControl().change(function(){nt(!0);s.C_AcctSchema_ID=g.getControl().find("option:selected").val();setTimeout(function(){s.Query(r,nf)},2)}),et!=null)et.on("click",function(){nt(!0);g.setValue(ct.getControl().find("option:selected").val());rr();nt(!1)});if(ft!=null&&ft.change(function(){tf()}),lt!=null&&lt.getControl().change(function(){rf();s.Record_ID=f}),k!=null)k.on("click",function(){nt(!0);var n=wf();setTimeout(function(){n?vf(s.Record_ID):nt(!1)},5)});if(c!=null)c.on("click",function(){ei(c)});if(d!=null)d.on("click",function(){ei(d)});if(a!=null)a.on("click",function(){ei(a)});if(v!=null)v.on("click",function(){ei(v)});if(y!=null)y.on("click",function(){ei(y)});if(p!=null)p.on("click",function(){ei(p)});if(ot!=null)ot.on("click",function(){fi(c)});if(st!=null)st.on("click",function(){fi(d)});if(tt!=null)tt.on("click",function(){fi(a)});if(it!=null)it.on("click",function(){fi(v)});if(rt!=null)rt.on("click",function(){fi(y)});if(ut!=null)ut.on("click",function(){fi(p)})}function vf(i){t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerRePost",type:"POST",async:!0,data:{dataRecID:i},success:function(){},error:function(n){$selfObj.log.info(n);nt(!1)}})}function yf(){var f;tr=t("<div id='topDiv_"+h+"' style='float: left; width: 100%; height: 45px; margin-bottom: 2px;margin-left: 0px;'><div id='queryDiv_"+h+"'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='lblquery_"+h+"' class='VIS_Pref_Label_Font' style='vertical-align: middle; cursor: pointer;font-size: 28px;color: #19A0ED;'>"+n.Msg.getMsg("ViewerQuery")+"<\/label><\/div><div id='resulttopDiv_"+h+"' style='display: inline-block; width: 160px;'><label id='lblresult_"+h+"' class='VIS_Pref_Label_Font' style='vertical-align: middle; cursor: pointer;'>"+n.Msg.getMsg("ViewerResult")+"<\/label><\/div><\/div>");f=t("<div id='resultTopFilterDiv_"+h+"' style='float: right;width: 50%;'>");f.append(si.getControl().css("display","inline-block").css("width","49%").css("text-align","right").css("margin-top","5px").addClass("VIS_Pref_Label_Font")).append(g.getControl().css("display","inline-block").css("width","50%").css("float","right").css("height","32px"));tr.append(f);w=t("<div id='leftSideDiv_"+h+"' style='float: left; margin-bottom: 3px; margin-left: 0px;background-color: #F1F1F1; '>");n.Application.isRTL&&(w.css("float","right"),et.css("float","left"),k.css("float","right"));w.css("width","50%");w.css("height",ir);gt=t("<div style='float: left;width: 100%;height: 100%;' id='parameterLeftDiv_"+h+"'>");w.append(gt);var u=t("<table style='width: 100%;height: 100%;'>"),r=t("<tr>"),i=t("<td style='padding: 4px 2px 2px;'>");gt.append(u);u.append(r);r.append(i);i.append(hr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px; '>");r.append(i);i.append(ct.getControl().css("display","inline-block").css("width","100%").css("height","32px"));r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(cr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(yi.getControl().css("display","inline-block").css("width","100%").css("height","32px"));r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(ft);i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(lt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i.append(c).append(ot);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(lr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(hi);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(ar.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(ci);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(vr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(ii.getControl().css("display","inline-block").css("width","100%").css("height","32px"));r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(yr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(d).append(st);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(pr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(a).append(tt);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(wr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(v).append(it);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(br.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(y).append(rt);r=t("<tr>");i=t("<td style='padding: 4px 2px 2px;'>");u.append(r);r.append(i);i.append(kr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 0px 15px 0px;'>");r.append(i);i.append(p).append(ut);vt=t("<div id='rightSideDiv_"+h+"' style='float: right;margin-bottom: 3px; margin-right: 0px; '>");vt.css("width","50%");vt.css("height",ir);gt=t("<div style='float: left;width: 100%;height: 100%;' id='parameterRightDiv_"+h+"'>");vt.append(gt);u=t("<table style='width: 100%;height: 100%;'>");r=t("<tr>");i=t("<td style='padding: 4px 15px 2px;'>");gt.append(u);u.append(r);r.append(i);i.append(gi);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");u.append(r);r.append(i);i.append(nr);r=t("<tr>");i=t("<td style='padding: 4px 15px 2px;'>");u.append(r);r.append(i);i.append(di);r=t("<tr>");i=t("<td style='padding: 4px 15px 2px;'>");u.append(r);r.append(i);i.append(dr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));i=t("<td style='padding: 4px 15px 2px;'>");r.append(i);i.append(gr.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");u.append(r);r.append(i);i.append(pt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 4px 15px 2px;'>");r.append(i);i.append(nu);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");u.append(r);r.append(i);i.append(wt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 4px 15px 2px;'>");r.append(i);i.append(tu);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");u.append(r);r.append(i);i.append(bt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 4px 15px 2px;'>");r.append(i);i.append(iu);r=t("<tr>");i=t("<td style='padding: 0px 15px 0px;'>");u.append(r);r.append(i);i.append(kt.getControl().css("display","inline-block").css("width","100%").css("height","32px"));i=t("<td style='padding: 4px 15px 2px;'>");r.append(i);i.append(ru);ht=t("<div style='float: left;background-color: #F1F1F1; width:100%'>");ht.css("height",50);ht.append(k);ht.append(at);ht.append(dt.getControl().css("margin-left","10px").css("margin-right","10px").css("margin-top","15px").addClass("VIS_Pref_Label_Font"));ht.append(et);ht.append(oi);ni=t("<div id='resultDiv_"+h+"' style='float: left; width: 100%; display: none; margin-bottom: 2px;margin-left: 0px;background-color: #F1F1F1;'>");ni.css("height",ir);yt.append(tr).append(w).append(vt).append(ni).append(ht);yt.append(ur)}function pf(t,u){s=new i(h,r,t);s.onLoaded=function(){ai(ct.getControl(),s.getAcctSchema());g.getControl().append("<option value='-1' ><\/option>");ai(g.getControl(),s.getAcctSchema());gu();ai(lt.getControl(),s.getTable());ai(yi.getControl(),s.getPostingType());ai(ii.getControl(),s.getOrg());c.find("span").text("");d.attr("Name",vi);st.attr("Name",vi);d.find("span").text("");a.attr("Name",er);tt.attr("Name",er);a.find("span").text("");v.attr("Name",or);it.attr("Name",or);v.find("span").text("");y.attr("Name",lu);rt.attr("Name",lu);y.find("span").text("");p.attr("Name",sr);ut.attr("Name",sr);p.find("span").text("");var i=t!=0&&u!=0;i&&ft.prop("checked",!0);tf();rf();dt.getControl().text(n.Msg.getMsg("VIS_EnterSelctionAndDisplayToQueryFind"));dt.getControl().css("color","#19A0ED");i&&(s.AD_Table_ID=t,s.Record_ID=u);rr()}}function gu(){var o=ct.getControl().find("option:selected").val(),e,r,t,i,u;if(o!=null){for(s.C_AcctSchema_ID=o,e=s.getAcctSchemaElements(s.C_AcctSchema_ID),pt.getControl().empty(),wt.getControl().empty(),bt.getControl().empty(),kt.getControl().empty(),li({Key:"",Name:""}),li({Key:"DateAcct",Name:n.Msg.translate(n.Env.getCtx(),"DateAcct")}),li({Key:"DateTrx",Name:n.Msg.translate(n.Env.getCtx(),"DateTrx")}),li({Key:"C_Period_ID",Name:n.Msg.translate(n.Env.getCtx(),"C_Period_ID")}),r=[],r.push(yu),r.push(pu),r.push(wu),r.push(bu),t=[],t.push(a),t.push(v),t.push(y),t.push(p),t.push(tt),t.push(it),t.push(rt),t.push(ut),t.push(pi),t.push(wi),t.push(bi),t.push(ki),i=0,u=0;u<e.length&&i<r.length;u++){var f=e[u][0],h=s.getColumnName(f.elementtype),c=s.getColumnName(f.elementtype);li({Key:h,Name:n.Msg.translate(n.Env.getCtx(),c)});f.elementtype=="OO"||f.elementtype=="AC"||(r[i].getControl().text(n.Msg.translate(n.Env.getCtx(),c)),r[i].getControl().show(),t[i].attr("Name",h),t[i].find("span").text(""),t[i].show(),i++)}while(i<r.length)r[i].getControl().hide(),i++;pt.getControl().prop("selectedIndex",0);wt.getControl().prop("selectedIndex",0);bt.getControl().prop("selectedIndex",0);kt.getControl().prop("selectedIndex",0)}}function li(n){pt.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>");wt.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>");bt.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>");kt.getControl().append(" <option selected value='"+n.Key+"' >"+n.Name+"<\/option>")}function rr(){var t="",i,u,f;if(s.C_AcctSchema_ID=0,s.AD_Org_ID=0,i=ct.getControl().find("option:selected").val(),i!=null&&(s.C_AcctSchema_ID=i),t=t.concat("C_AcctSchema_ID=").concat(s.C_AcctSchema_ID),i=yi.getControl().find("option:selected").val(),i!=null&&i!="0"&&(s.PostingType=i),t=t.concat(", PostingType=").concat(s.PostingType),s.documentQuery=ft.prop("checked"),t=t.concat(", DocumentQuery=").concat(s.documentQuery),ft.prop("checked")){if(s.AD_Table_ID==0||s.Record_ID==0)return;t=t.concat(", AD_Table_ID=").concat(s.AD_Table_ID).concat(", Record_ID=").concat(s.Record_ID)}else if(s.DateFrom=hi.val(),s.DateFrom!=""&&(t=t.concat(", DateFrom=").concat(s.DateFrom)),s.DateTo=ci.val(),s.DateTo!=""&&(t=t.concat(", DateTo=").concat(s.DateTo)),i=ii.getControl().find("option:selected").val(),i!=null&&(s.AD_Org_ID=i),t=t.concat(", AD_Org_ID=").concat(s.AD_Org_ID),u=s.whereInfo,u!=null)for(f=0;f<u.length;f++)t=t.concat(", ").concat(u[f].Value);s.displayQty=di.prop("checked");t=t.concat(", - Display Qty=").concat(s.displayQty);s.displaySourceAmt=nr.prop("checked");t=t.concat(", Source=").concat(s.displaySourceAmt);s.displayDocumentInfo=gi.prop("checked");t=t.concat(", Doc=").concat(s.displayDocumentInfo);pt.getControl().find("option:selected").val()!=null&&(s.sortBy1=pt.getControl().find("option:selected").val());s.group1=nu.prop("checked");t=t.concat(" - Sorting: ").concat(s.sortBy1).concat("/").concat(s.group1);wt.getControl().find("option:selected").val()!=null&&(s.sortBy2=wt.getControl().find("option:selected").val());s.group2=tu.prop("checked");t=t.concat(", ").concat(s.sortBy2).concat("/").concat(s.group2);bt.getControl().find("option:selected").val()!=null&&(s.sortBy3=bt.getControl().find("option:selected").val());s.group3=iu.prop("checked");t=t.concat(", ").concat(s.sortBy3).concat("/").concat(s.group3);kt.getControl().find("option:selected").val()!=null&&(s.sortBy4=kt.getControl().find("option:selected").val());s.group4=ru.prop("checked");t=t.concat(", ").concat(s.sortBy4).concat("/").concat(s.group4);et.Enabled=!1;dt.getControl().text(n.Msg.translate(n.Env.getCtx(),"Processing"));uu();s.Query(r,nf);s.C_AcctSchema_ID>0&&g.setValue(s.C_AcctSchema_ID);et.Enabled=!0;dt.getControl().text(n.Msg.getMsg("VIS_EnterSelctionAndDisplayToQueryFind"))}function nf(n){n!=null&&lf(n);nt(!1)}function tf(){var n=ft.prop("checked");n?(lt.getControl().removeAttr("disabled"),c.removeAttr("disabled"),ot.removeAttr("disabled"),hi.attr("disabled","disabled"),ci.attr("disabled","disabled"),ii.getControl().attr("disabled","disabled"),d.attr("disabled","disabled"),a.attr("disabled","disabled"),v.attr("disabled","disabled"),y.attr("disabled","disabled"),p.attr("disabled","disabled"),st.attr("disabled","disabled"),tt.attr("disabled","disabled"),it.attr("disabled","disabled"),rt.attr("disabled","disabled"),ut.attr("disabled","disabled"),pi.attr("disabled","disabled"),wi.attr("disabled","disabled"),bi.attr("disabled","disabled"),ki.attr("disabled","disabled")):(lt.getControl().attr("disabled","disabled"),c.attr("disabled","disabled"),ot.attr("disabled","disabled"),hi.removeAttr("disabled"),ci.removeAttr("disabled"),ii.getControl().removeAttr("disabled"),d.removeAttr("disabled"),a.removeAttr("disabled"),v.removeAttr("disabled"),y.removeAttr("disabled"),p.removeAttr("disabled"),st.removeAttr("disabled"),tt.removeAttr("disabled"),it.removeAttr("disabled"),rt.removeAttr("disabled"),ut.removeAttr("disabled"),pi.removeAttr("disabled"),wi.removeAttr("disabled"),bi.removeAttr("disabled"),ki.removeAttr("disabled"))}function rf(){var n=lt.getControl().find("option:selected").val();n!=null&&jQuery.grep(s.tableInfo,function(t){return t.Name==n})[0]!=null&&(s.AD_Table_ID=jQuery.grep(s.tableInfo,function(t){return t.Name==n})[0].Key);c.find("span").text("");c.attr("Name",n+"_ID");ot.attr("Name",n+"_ID")}function ei(t){var r=t.attr("name"),f="IsSummary='N'",u=r,i,o,e;r.equals("Account_ID")?(u="C_ElementValue_ID",i=s.getAcctSchemaElement("AC"),i!=null&&(f+=" AND C_Element_ID="+i.c_element_id)):r.equals("User1_ID")?(u="C_ElementValue_ID",i=s.getAcctSchemaElement("U1"),i!=null&&(f+=" AND C_Element_ID="+i.c_element_id)):r.equals("User2_ID")?(u="C_ElementValue_ID",i=s.getAcctSchemaElement("U2"),i!=null&&(f+=" AND C_Element_ID="+i.c_element_id)):ft.prop("checked")&&(f="");o=u.substring(0,u.length-3);e=r=="M_Product_ID"?new n.InfoWindow(101,"",s.windowNo,"",!1):r=="C_BPartner_ID"?new n.InfoWindow(100,"",s.windowNo,"",!1):new n.infoGeneral(!0,s.windowNo,"",o,u,!1,f);e.onClose=function(){var i=null,n=e.getSelectedValues();return(n!=null&&(i=u+"="+n.toString()),e=null,i==null||i.length==0||n==null)?(t.find("span").text(""),s.whereInfo.Remove(r),t.width=44,0):(t==c?s.Record_ID=n:s.whereInfo.push({Key:r,Value:r+"="+n}),t.find("span").text(s.getButtonText(o,u,i)),t.find("span").text()!=""?t.AutoSize=!0:t.Width=44,n)};e.show()}function wf(){if(n.ADialog.ask("PostImmediate?")){if(s.documentQuery&&s.AD_Table_ID!=0&&s.Record_ID!=0){var i=at.prop("checked");bf(function(r){var u=!1,f,e;r=="Yes"&&(u=!0);window.FRPT&&u?(f=Number(n.context.getWindowTabContext(h,0,"AD_Org_ID")),e=Number(n.context.getWindowTabContext(h,0,"C_DocType_ID")),t.ajax({url:n.Application.contextUrl+"FRPT/PostingLogicFRPT/PostImediateFRPT",dataType:"json",async:!0,data:{AD_Client_ID:s.AD_Client_ID,AD_Table_ID:s.AD_Table_ID,Record_ID:s.Record_ID,force:i,OrgID:f,AD_Window_ID:ff,DocTypeID:e},error:function(){nt(!1);n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer"))},success:function(n){n.result&&rr()}})):t.ajax({url:n.Application.contextUrl+"Posting/PostImmediate",dataType:"json",data:{AD_Client_ID:s.AD_Client_ID,AD_Table_ID:s.AD_Table_ID,Record_ID:s.Record_ID,force:i},error:function(){nt(!1);n.ADialog.info(n.Msg.getMsg("ERRORGettingPostingServer"))},success:function(n){n.result=="OK"&&rr()}})})}return!0}return nt(!1),!1}function bf(i){t.ajax({url:n.Application.contextUrl+"Posting/PostByNewLogic",dataType:"json",async:!0,data:{AD_Client_ID:n.context.getAD_Client_ID()},error:function(){alert(n.Msg.getMsg("ERRORGettingPostingServer"))},success:function(n){i&&i(n.result)}})}function ai(t,i){for(var r=0;r<i.length;r++)t.append(" <option selected value='"+i[r].Key+"' >"+n.Utility.decodeText(i[r].Name)+"<\/option>");t.prop("selectedIndex",0)}var yt=t("<div style='position:relative;'>"),ur=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>"),l=this,uf=r,fu=u,eu=f,h=e,ff=o;this.arrListColumns=[];this.dGrid=null;var fr="C_AcctSchema_ID",ef="DocumentType",ou="PostingType",su="AD_Org_ID",vi="Account_ID",hu="SelectDocument",cu="AcctDateFrom",er="M_Product_ID",or="C_BPartner_ID",lu="C_Project_ID",sr="C_Campaign_ID",b=n.Application.contextUrl+"Areas/VIS/Images/base/Find24.gif",ti=n.Application.contextUrl+"Areas/VIS/Images/cancel-18.png",au=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png",vu=n.Application.contextUrl+"Areas/VIS/Images/base/Print24.PNG",et=t("<button id='btnRefresh_"+h+"'style='margin-bottom: 1px; margin-top: 6px; float: right; margin-left: 15px; height: 38px;' class='VIS_Pref_btn-2'><img src='"+au+"'/><\/button>"),oi=t("<button id='btnPrint_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;float: right;margin-right: 10px;margin-top: 5px;'><img src='"+vu+"'/><\/button>"),k=t("<button id='btnRePost_"+h+"' style='float: left; display: inline-block;height: 30px;margin-top: 10px;margin-left: 5px;' ><img src='"+b+"'/><\/button>"),c=t("<button Name='btnSelctDoc' id='btnSelctDoc_"+h+"' style='height:30px; padding: 0px;'><img src='"+b+"'/><span style='padding-left: 8px;padding-right: 8px;'><\/span><\/button>"),d=t("<button  Name='btnAccount' id='btnAccount_"+h+"'   style='height:30px; padding: 0px;'><img src='"+b+"'/><span style='padding-left: 8px;padding-right: 8px;'><\/span><\/button>"),a=t("<button  Name='btnProduct' id='btnProduct_"+h+"'   style='height:30px; padding: 0px;'><img src='"+b+"'/><span style='padding-left: 8px;padding-right: 8px;'><\/span><\/button>"),v=t("<button Name='btnBPartner' id='btnBPartner_"+h+"' style='height:30px; padding: 0px;'><img src='"+b+"'/><span style='padding-left: 8px;padding-right: 8px;'><\/span><\/button>"),y=t("<button  Name='btnProject' id='btnProject_"+h+"'   style='height:30px; padding: 0px;'><img src='"+b+"'/><span style='padding-left: 8px;padding-right: 8px;'><\/span><\/button>"),p=t("<button Name='btnCampaning' id='btnCampaning_"+h+"' style=' height:30px; padding: 0px;'><img src='"+b+"'/><span style='padding-left: 8px;padding-right: 8px;'><\/span><\/button>"),ot=t("<button Name='btnSelctDocClear' id='btnSelctDocClear_"+h+"' class='VIS-pref-button'><img src='"+ti+"'/><span style='padding-left: 3px;'><\/span><\/button>"),st=t("<button  Name='btnAccountClear' id='btnAccountClear_"+h+"'   class='VIS-pref-button'><img src='"+ti+"'/><span style='padding-left: 3px;'><\/span><\/button>"),tt=t("<button  Name='btnProductClear' id='btnProductClear_"+h+"'   class='VIS-pref-button'><img src='"+ti+"'/><span style='padding-left: 3px;'><\/span><\/button>"),it=t("<button Name='btnBPartnerClear' id='btnBPartnerClear_"+h+"' class='VIS-pref-button'><img src='"+ti+"'/><span style='padding-left: 3px;'><\/span><\/button>"),rt=t("<button  Name='btnProjectClear' id='btnProjectClear_"+h+"'   class='VIS-pref-button'><img src='"+ti+"'/><span style='padding-left: 3px;'><\/span><\/button>"),ut=t("<button Name='btnCampaningClear' id='btnCampaningClear_"+h+"' class='VIS-pref-button'><img src='"+ti+"'/><span style='padding-left: 3px;'><\/span><\/button>"),ct=new n.Controls.VComboBox("",!1,!1,!0),g=new n.Controls.VComboBox("",!1,!1,!0),yi=new n.Controls.VComboBox("",!1,!1,!0),ii=new n.Controls.VComboBox("",!1,!1,!0),lt=new n.Controls.VComboBox("",!1,!1,!0),pt=new n.Controls.VComboBox("",!1,!1,!0),wt=new n.Controls.VComboBox("",!1,!1,!0),bt=new n.Controls.VComboBox("",!1,!1,!0),kt=new n.Controls.VComboBox("",!1,!1,!0),hr=new n.Controls.VLabel,si=new n.Controls.VLabel,cr=new n.Controls.VLabel,lr=new n.Controls.VLabel,ar=new n.Controls.VLabel,vr=new n.Controls.VLabel,yr=new n.Controls.VLabel,pr=new n.Controls.VLabel,wr=new n.Controls.VLabel,br=new n.Controls.VLabel,kr=new n.Controls.VLabel,dr=new n.Controls.VLabel,gr=new n.Controls.VLabel,yu=new n.Controls.VLabel,pu=new n.Controls.VLabel,wu=new n.Controls.VLabel,bu=new n.Controls.VLabel,pi=t("<button id='btnSel5_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+b+"' /><span><\/span><\/button>"),wi=t("<button id='btnSel6_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+b+"' /><span><\/span><\/button>"),bi=t("<button id='btnSel7_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+b+"' /><span><\/span><\/button>"),ki=t("<button id='btnSel8_"+h+"' style='border: 0px;background-color: transparent; padding: 0px;'><img src='"+b+"' /><span><\/span><\/button>"),dt=new n.Controls.VLabel,ku=new n.Controls.VLabel,du=new n.Controls.VLabel,ri=null,ui=null,ft=t("<input id='chkSelectDoc_"+h+"' type='checkbox' checked class='VIS_Pref_automatic'><span><label id='lblSelectDoc_"+h+"' class='VIS_Pref_Label_Font'>SelectDoc<\/label><\/span>"),di=t("<input id='chkQty_"+h+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblQty_"+h+"' class='VIS_Pref_Label_Font'>chkQty<\/label><\/span>"),at=t("<input id='chkforcePost_"+h+"' type='checkbox' class='VIS_Pref_automatic' style='display: inline-block;margin-left: 20px;'><span><label id='lblforcePost_"+h+"' class='VIS_Pref_Label_Font'>chkforcePost<\/label><\/span>"),gi=t("<input id='chkDisDocinfo_"+h+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblDisDocinfo_"+h+"' class='VIS_Pref_Label_Font'>chkDisDocinfo<\/label><\/span>"),nr=t("<input id='chkDisSouce_"+h+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblDisSouce_"+h+"' class='VIS_Pref_Label_Font'>chkDisSouce<\/label><\/span>"),nu=t("<input id='chkSumriz1_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),tu=t("<input id='chkSumriz2_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),iu=t("<input id='chkSumriz3_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),ru=t("<input id='chkSumriz4_"+h+"' type='checkbox' class='VIS_Pref_automatic'>"),hi=t("<input id='vdtpkAccDateFrom_"+h+"' type='date' name='DateOrdered' style='display: inline-block;line-height: 23px;width:100%'>"),ci=t("<input id='vdtpkAccDateTo_"+h+"' type='date' name='DateOrdered' style='display: inline-block;line-height: 23px;width:100%'>"),tr=null,w=null,vt=null,gt=null,ht=null,ni=null,of=t(window).width()/2,sf=t(window).width()/2,ir=t(window).height()-200,s=null;this.showDialog=function(){yf();nt(!0);ri=yt.find("#lblquery_"+h);ui=yt.find("#lblresult_"+h);uu();k.hide();at.hide();oi.hide();hf();af();pf(fu,eu);yt.dialog({modal:!0,resizable:!1,title:n.Msg.getMsg("AcctViewer"),width:t(window).width()/2+t(window).width()/4,position:{at:"center top",of:window},close:function(){l.dGrid!=null&&(l.dGrid.destroy(),l.dGrid=null);l.dispose();l=null;yt.dialog("destroy");yt=null}})};this.disposeComponent=function(){et&&et.off("click");oi&&oi.off("click");k&&k.off("click");c&&c.off("click");d&&d.off("click");a&&a.off("click");v&&v.off("click");y&&y.off("click");p&&p.off("click");ot&&ot.off("click");st&&st.off("click");tt&&tt.off("click");it&&it.off("click");rt&&rt.off("click");ut&&ut.off("click");uf=null;fu=null;eu=null;h=null;this.arrListColumns=null;this.dGrid=null;fr=null;ef=null;ou=null;su=null;vi=null;hu=null;cu=null;b=null;au=null;vu=null;et=null;oi=null;k=null;c=null;d=null;a=null;v=null;y=null;p=null;ot=null;st=null;tt=null;it=null;rt=null;ut=null;ct=null;g=null;yi=null;ii=null;lt=null;pt=null;wt=null;bt=null;kt=null;hr=null;si=null;cr=null;lr=null;ar=null;vr=null;yr=null;pr=null;wr=null;br=null;kr=null;dr=null;gr=null;yu=null;pu=null;wu=null;bu=null;pi=null;wi=null;bi=null;ki=null;dt=null;ku=null;du=null;ri=null;ui=null;ft=null;di=null;at=null;gi=null;nr=null;nu=null;tu=null;iu=null;ru=null;hi=null;ci=null;tr=null;w=null;vt=null;gt=null;ht=null;ni=null;of=null;sf=null;ir=null;s=null;ur=null;this.disposeComponent=null}}i.prototype.getAcctSchema=function(){return this.ASchemas};i.prototype.getTable=function(){var i=[],r=null;return t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerGetTabelData",type:"POST",async:!1,success:function(t){var f,u;if((this.tableInfo==undefined||this.tableInfo==null)&&(this.tableInfo=[]),t.result)for(f=t.result,u=0;u<f.length;u++){var o=f[u].AD_Table_ID,e=n.Utility.encodeText(f[u].TableName),s=n.Msg.translate(n.Env.getCtx(),e+"_ID");i.push({Key:e,Name:s});this.tableInfo.push({Key:o,Name:e});o==this.AD_Table_ID&&(r=e)}},error:function(n){$selfObj.log.info(n)}}),i};i.prototype.getOrg=function(){var i=[],r=this.AD_Client_ID;return t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerGetOrgData",type:"POST",async:!1,data:{client_id:r},success:function(t){var u=t.result,r;if(u)for(i.push({Key:0,Name:""}),r=0;r<u.length;r++)i.push({Key:u[r].AD_Org_ID,Name:n.Utility.encodeText(u[r].OrgName)})},error:function(n){$selfObj.log.info(n)}}),i};i.prototype.getPostingType=function(){var i=[];return t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerGetPostingType",type:"POST",async:!1,data:{reference_id:125},success:function(t){var u=t.result,r;if(u)for(i.push({Key:0,Name:""}),r=0;r<u.length;r++)i.push({Key:u[r].PostingValue,Name:n.Utility.encodeText(u[r].PostingName)})},error:function(n){$selfObj.log.info(n)}}),i};i.prototype.getAcctSchemaElements=function(i){this._elements=[];var r=this._elements;return t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerGetAcctSchElements",type:"POST",async:!0,data:{keys:i},success:function(t){var u=t.result,i,f;if(u)for(i=0;i<u.length;i++)f=[],f.push({c_acctschema_element_id:u[i].C_AcctSchema_Element_ID,name:n.Utility.encodeText(u[i].ElementName),elementtype:u[i].ElementType,c_elementvalue_id:u[i].C_ElementValue_ID,seqno:u[i].SeqNo,detail:u[i].Detail,c_element_id:u[i].C_Element_ID}),r.push(f)},error:function(n){$selfObj.log.info(n)}}),r};i.prototype.getAcctSchemaElement=function(n){var t,i;for(this._elements==null&&this.getAcctSchemaElements(),t=0;t<this._elements.length;t++)if(i=this._elements[t][0],i.elementtype.equals(n))return i;return null};i.prototype.getColumnName=function(n){return n.equals(this.ELEMENTTYPE_Organization)?"AD_Org_ID":n.equals(this.ELEMENTTYPE_Account)?"Account_ID":n.equals(this.ELEMENTTYPE_BPartner)?"C_BPartner_ID":n.equals(this.ELEMENTTYPE_Product)?"M_Product_ID":n.equals(this.ELEMENTTYPE_Activity)?"C_Activity_ID":n.equals(this.ELEMENTTYPE_LocationFrom)?"C_LocFrom_ID":n.equals(this.ELEMENTTYPE_LocationTo)?"C_LocTo_ID":n.equals(this.ELEMENTTYPE_Campaign)?"C_Campaign_ID":n.equals(this.ELEMENTTYPE_OrgTrx)?"AD_OrgTrx_ID":n.equals(this.ELEMENTTYPE_Project)?"C_Project_ID":n.equals(this.ELEMENTTYPE_SalesRegion)?"C_SalesRegion_ID":n.equals(this.ELEMENTTYPE_UserList1)?"User1_ID":n.equals(this.ELEMENTTYPE_UserList2)?"User2_ID":n.equals(this.ELEMENTTYPE_UserElement1)?"UserElement1_ID":n.equals(this.ELEMENTTYPE_UserElement2)?"UserElement2_ID":""};i.prototype.getButtonText=function(i,r,u){var e=n.Env.getAD_Language(n.Env.getCtx()),o=n.MLookupFactory.getLookup_TableDirEmbed(e,r,"avd",r),f="<"+u+">";return t.ajax({url:n.Application.contextUrl+"AcctViewerData/AcctViewerGetButtonText",type:"POST",async:!1,data:{lookupDirEmbeded:o,tName:i,wheres:" avd WHERE avd.",selectSQLs:u},success:function(n){var t=n.result;t!=""&&(f=t)},error:function(n){$selfObj.log.info(n)}}),f};i.prototype.Query=function(t,i){var r="",f,e,o,u;if(this.C_AcctSchema_ID!=0&&(r=r.concat(this.TABLE_ALIAS).concat(".C_AcctSchema_ID=").concat(this.C_AcctSchema_ID)),this.PostingType!=null&&this.PostingType.length>0&&(r.length>0&&(r=r.concat(" AND ")),r=r.concat(this.TABLE_ALIAS).concat(".PostingType='").concat(this.PostingType).concat("'")),this.documentQuery)r.length>0&&(r=r.concat(" AND ")),r=r.concat(this.TABLE_ALIAS).concat(".AD_Table_ID=").concat(this.AD_Table_ID).concat(" AND ").concat(this.TABLE_ALIAS).concat(".Record_ID=").concat(this.Record_ID);else{if(f=this.whereInfo,f!=null)for(e=0;e<f.length;e++)o=f[e].Value,o!=null&&o.length>0&&(r.length>0&&(r=r.concat(" AND ")),r=r.concat(this.TABLE_ALIAS).concat(".").concat(o));(!this.DateFrom!=null||this.DateTo!=null)&&(r.length>0&&(this.DateFrom!=""||this.DateTo!="")&&(r=r.concat(" AND ")),this.DateFrom!=""&&this.DateTo!=""?r=r.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') BETWEEN ").concat(n.DB.to_date(this.DateFrom)).concat(" AND ").concat(n.DB.to_date(this.DateTo)):this.DateFrom!=""?r=r.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') >= ").concat(n.DB.to_date(this.DateFrom)):this.DateTo!=""&&(r=r.concat("TRUNC(").concat(this.TABLE_ALIAS).concat(".DateAcct,'DD') <= ").concat(n.DB.to_date(this.DateTo))));this.AD_Org_ID!=0&&(r.length>0&&(r=r.concat(" AND ")),r=r.concat(this.TABLE_ALIAS).concat(".AD_Org_ID=").concat(this.AD_Org_ID))}u="";this.sortBy1.length>0&&(u=u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy1));this.sortBy2.length>0&&(u.length>0&&(u=u.concat(",")),u=u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy2));this.sortBy3.length>0&&(u.length>0&&(u=u.concat(",")),u=u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy3));this.sortBy4.length>0&&(u.length>0&&(u=u.concat(",")),u=u.concat(this.TABLE_ALIAS).concat(".").concat(this.sortBy4));u.length==0&&(u=u.concat(this.TABLE_ALIAS).concat(".Fact_Acct_ID"));this.getDataModel(t,r,u,this.group1,this.group2,this.group3,this.group4,this.sortBy1,this.sortBy2,this.sortBy3,this.sortBy4,this.displayDocumentInfo,this.displaySourceAmt,this.displayQty,i)};i.prototype.getDataModel=function(i,r,u,f,e,o,s,h,c,l,a,v,y,p,w){var b=this;t.ajax({url:n.Application.contextUrl+"Common/GetDataQuery",async:!0,dataType:"json",type:"POST",data:{AD_Client_ID:i,whereClause:r,orderClause:u,gr1:f,gr2:e,gr3:o,gr4:s,sort1:h,sort2:c,sort3:l,sort4:a,displayDocInfo:v,displaySrcAmt:y,displayqty:p},success:function(n){b.dataByData=n.result;w(n.result)}})};r.prototype.dispose=function(){this.disposeComponent()};n.AcctViewer=r}(VIS,jQuery),function(n,t){function i(){function g(){var ut="topDiv_"+i.windowNo,p="btnSpaceDiv_"+i.windowNo,ft="btnSpace_"+i.windowNo,et="spnSelect_"+i.windowNo,ot="spnGenerate_"+i.windowNo,w="lblGenerate_"+i.windowNo,b="lblSelect_"+i.windowNo,k=n.Application.contextUrl+"Areas/VIS/Images/clear16.png",c=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png",d,g,nt,tt,it,l,rt,a,y;o=t('<button id = "btnClearBP_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2" style="width: 30px; height: 29px; padding: 0px; border-color: #BBBBBB;"><img tabindex="-1" src="'+k+'" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/button>');s=t('<button id = "btnClearOrd_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2" style="width: 30px; height: 29px; padding: 0px; border-color: #BBBBBB;"><img tabindex="-1" src="'+k+'" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/button>');i.topDiv=t("<div id='"+ut+"' style='float: left; width: 100%; height: 45px; margin-bottom: 2px;margin-left: 0px;'><div id='"+p+"' style='width: 260px; height: 45px;float: left;padding-left: 11px; padding-top: 11px;; background-color: #F1F1F1;'><button id='"+ft+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+c+"' /><\/button><\/div><div id='"+et+"'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='"+b+"' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 28px;color: #19A0ED;'>"+n.Msg.translate(n.Env.getCtx(),"Select")+"<\/label><\/div><div id='"+ot+"' style='display: inline-block; width: 160px;'><label id='"+w+"' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 17px;'>"+n.Msg.translate(n.Env.getCtx(),"Generate")+"<\/label><\/div><\/div>");d="sideDiv_"+i.windowNo;g="parameterDiv_"+i.windowNo;i.btnSpaceDiv=i.topDiv.find("#"+p);this.lblGenrate=i.topDiv.find("#"+w);this.lblSelect=i.topDiv.find("#"+b);i.sideDiv=t("<div id='"+d+"' style='float: left; margin-left: 0px; background-color: #F1F1F1;'>");i.sideDiv.css("width",r);i.sideDiv.css("height",v);i.div=t("<div style='float: left; width: 100%;' id='"+g+"'>");i.sideDiv.append(i.div);var h=t("<table style='width: 100%;'>"),u=t("<tr>"),f=t("<td style='padding: 4px 15px 0px;'>");i.div.append(h);h.append(u);u.append(f);f.append(i.lblWarehouse.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");f=t("<td style='padding: 0px 15px 8px;'>");h.append(u);u.append(f);f.append(i.cmbWarehouse.getControl().css("display","inline-block").css("width","236px").css("height","30px"));u=t("<tr>");f=t("<td style='padding: 4px 15px 0px;'>");h.append(u);u.append(f);f.append(i.lblBPartner.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");f=t("<td style='padding: 0px 15px 8px;'>");h.append(u);u.append(f);f.append(i.vSearchBPartner.getControl().css("width","176px")).append(i.vSearchBPartner.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")).append(o);nt=n.Msg.translate(n.Env.getCtx(),"SalesOrder_No");u=t("<tr>");f=t("<td style='padding: 0px 15px 0px;'>");h.append(u);u.append(f);f.append(nt);u=t("<tr>");f=t("<td style='padding: 0px 15px 0px;'>");h.append(u);u.append(f);f.append(i.vSearchOrder.getControl(0).css("width","176px")).append(i.vSearchOrder.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")).append(s);tt="gridSelectDiv_"+i.windowNo;it="gridGenerateDiv_"+i.windowNo;i.gridSelectDiv=t("<div id='"+tt+"' style='float: right; margin-right: 15px;border: 1px solid darkgray;'>");i.gridSelectDiv.css("width",e);i.gridSelectDiv.css("height",v);i.gridGenerateDiv=t("<div id='"+it+"' style='height: 85%; float: right; display: none; background-color: #F1F1F1; margin-left: 15px;;margin-right: 15px;'>");i.gridGenerateDiv.css("width",t(window).width()-30);l="btnOk_"+i.windowNo;i.okBtn=t("<input id='"+l+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 1px; float: right; margin-right: 15px ;width: 70px;height: 38px;' type='button' value='Ok'>");l="btnRefresh_"+i.windowNo;c=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";i.btnRefresh=t("<button id='"+l+"' style='margin-bottom: 1px; margin-top: 0px; float: left; margin-left: 15px; height: 38px;' class='VIS_Pref_btn-2'><img src='"+c+"'><\/button>");rt="discriptionDiv_"+i.windowNo;i.bottumDiv=t("<div style='width: 100%; height: 50px; float: left; margin-bottom: 0px;margin-top: 5px;'>");a=t("<div id='"+rt+"' style='width: 69%; float: left; margin-bottom: 0px;  padding-top: 8px;padding-left: 10px; text-align: left;'>");a.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font"));y=t("<div style='width: 175px; float: right; text-align: right; margin-bottom: 0px;'>");y.append(i.okBtn);i.bottumDiv.append(i.btnRefresh).append(a).append(y);i.$root.append(i.$busyDiv);i.$root.append(i.topDiv).append(i.sideDiv).append(i.gridSelectDiv).append(i.gridGenerateDiv).append(i.bottumDiv)}function nt(){i.lblWarehouse.getControl().text(n.Msg.translate(n.Env.getCtx(),"M_Warehouse_ID"));i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));i.tabSelect.getControl().text(n.Msg.getMsg("Select",!1,!1));i.tabGenrate.getControl().text(n.Msg.getMsg("Generate",!1,!1));i.lblStatusInfo.getControl().text(n.Msg.getMsg("VIS_OrderGenShip",!1,!1))}function tt(){var t,r,u;t=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,2223,n.DisplayType.TableDir,"M_Warehouse_ID",0,!1,"M_Warehouse.IsActive='Y'");i.cmbWarehouse=new n.Controls.VComboBox("M_Warehouse_ID",!0,!1,!0,t,150,n.DisplayType.TableDir,0);r=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,2762,n.DisplayType.Search);i.vSearchBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,r);u=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,2161,n.DisplayType.Search,"C_Order_ID",0,!1,"DocStatus='CO'");i.vSearchOrder=new n.Controls.VTextBoxButton("C_Order_ID",!0,!1,!0,n.DisplayType.Search,u)}function w(r){i.dGrid!=null&&(i.dGrid.destroy(),i.dGrid=null);i.arrListColumns.length==0&&(i.arrListColumns.push({field:"AD_Org_ID",caption:n.Msg.translate(n.Env.getCtx(),"AD_Org_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_DocType_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_DocType_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DocumentNo",caption:n.Msg.getElement(n.Env.getCtx(),"DocumentNo"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.getElement(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DateOrdered",caption:n.Msg.getElement(n.Env.getCtx(),"DateOrdered"),sortable:!0,size:"16%",min:150,hidden:!1,render:"date"}),i.arrListColumns.push({field:"C_Order_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_UOM_ID"),sortable:!0,size:"150px",hidden:!0}));setTimeout(10);w2utils.encodeTags(r);i.dGrid=t(i.gridSelectDiv).w2grid({name:"gridGenShipForm"+i.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:i.arrListColumns,records:r})}function y(){var r=[],s=n.Env.getCtx().getAD_Client_ID(),f="",e="",o="";u!=null&&u.toString()!="-1"&&(f=" AND ic.M_Warehouse_ID="+u);c!=null&&(e=" AND ic.C_BPartner_ID="+c);l!=null&&(o=" AND C_Order_ID="+l);t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv");t.ajax({url:n.Application.contextUrl+"VCreateFrom/ExecuteQueryVinoutgen",type:"POST",data:{adClientID:s,mWarehouseIDs:f,cBPartnerIDs:e,cOrderIDSearchs:o},success:function(u){var f=JSON.parse(u),s,e,o;if(f&&f.length>0)try{for(s=1,e=0;e<f.length;e++)o={},o.C_Order_ID=f[e].c_order_id,o.AD_Org_ID=f[e].ord,o.C_DocType_ID=f[e].doctype,o.DocumentNo=n.Utility.encodeText(f[e].documentno),o.C_BPartner_ID=f[e].bpname,o.DateOrdered=f[e].dateordered,o.recid=s,s++,r.push(o)}catch(h){}else n.ADialog.info("NoDataFound"),i.okBtn.attr("disabled","disabled");w(r);t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")},error:function(){t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")}})}function it(){var r,u,f,e,t,n;if(i.dGrid==null)return!1;if((r=[],u=i.dGrid.getSelection(),u!=null)&&!(u.length<=0)){for(f=u.toString().split(","),n=0;n<f.length;n++)r[n]=i.dGrid.get(f[n]).C_Order_ID;if(r.length==0)return"";for(e="C_Order_ID",t=e,t=r.length>1?t.concat(" IN ("):t.concat("="),n=0;n<r.length;n++)n>0&&(t=t.concat(",")),t=e.endsWith("_ID")?t.concat(r[n].toString()):t.concat("'").concat(r[n].toString());return r.length>1&&(t=t.concat(")")),t.toString()}}function rt(r){var f=i;t.ajax({url:n.Application.contextUrl+"Common/GenerateShipments",dataType:"json",data:{whereClause:r,M_Warehouse_ID:u},success:function(r){r.DocumentText!=null&&(ut(!0),f.gridGenerateDiv.html(r.DocumentText),f.lblStatusInfo.getControl().text(r.lblStatusInfo));r.ErrorMsg!=null&&n.ADialog.info("",null,r.ErrorMsg,null);f.$busyDiv[0].style.visibility="hidden";t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")},error:function(){f.$busyDiv[0].style.visibility="hidden";t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")}})}function ut(n){n&&(i.btnRefresh.hide(),i.okBtn.hide(),i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),n=!1,i.gridSelectDiv.animate({width:e},"fast"),i.sideDiv.animate({width:"toggle",height:"toggle"},"slow"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","#333333");lblGenrate.css("font-size","28px").css("color","#19A0ED")}var i;this.frame;this.windowNo;i=this;this.arrListColumns=[];this.dGrid=null;var h=null,u=null,c=null,b=!1,k=!1,f=!1,l=null;this.lblWarehouse=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblStatusInfo=new n.Controls.VLabel;this.tabSelect=new n.Controls.VLabel;this.tabGenrate=new n.Controls.VLabel;this.cmbWarehouse=new n.Controls.VComboBox("",!1,!1,!0);this.vSearchBPartner=null;this.vSearchOrder=null;this.$root=t("<div style='width: 100%; height: 100%; background-color: white;'>");this.$busyDiv=t("<div class='vis-apanel-busy'>");this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.div=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;this.btnSpaceDiv=null;this.lblGenrate=null;this.lblSelect=null;var o=null,s=null,r=260,a=50,e=t(window).width()-(r+20+5),p=t(window).width()-(20+a),d=e+r+5,v=t(window).height()-210;this.vetoablechange=function(){c=i.vSearchBPartner.getValue();l=i.vSearchOrder.getValue();i.okBtn.removeAttr("disabled");y()};this.Initialize=function(){if(tt(),nt(),g(),this.btnToggel=this.$root.find("#btnSpace_"+i.windowNo),this.spnSelect=this.$root.find("#spnSelect_"+i.windowNo),this.spnGenerate=this.$root.find("#spnGenerate_"+i.windowNo),this.okBtn!=null)this.okBtn.on(n.Events.onTouchStartOrClick,function(){var r=i;if(i.cmbWarehouse.getControl().find("option:selected").val()==undefined){n.ADialog.error("SelectWarehouseFirst");return}i.$busyDiv[0].style.visibility="visible";t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv");i.okBtn.attr("disabled","disabled");h=it();h!=null&&h.length>0?rt(h):(n.ADialog.error("PlzSelectatLeast1Inv"),i.$busyDiv[0].style.visibility="hidden");i.okBtn.removeAttr("disabled")});if(this.cancelBtn!=null)this.cancelBtn.on(n.Events.onTouchStartOrClick,function(){i.$root.dialog("close")});if(this.btnRefresh!=null)this.btnRefresh.on(n.Events.onTouchStartOrClick,function(){i.okBtn.removeAttr("disabled");u=i.cmbWarehouse.getControl().find("option:selected").val();c=i.vSearchBPartner.getValue();y()});if(this.btnToggel!=null)this.btnToggel.on(n.Events.onTouchStartOrClick,function(){f?(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),f=!1,i.btnSpaceDiv.animate({width:r},"slow"),i.gridSelectDiv.animate({width:e},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:r},"slow",null,function(){i.dGrid.resize()})):(i.btnToggel.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),f=!0,i.btnSpaceDiv.animate({width:a},"slow"),i.sideDiv.animate({width:a},"slow"),i.div.css("display","none"),i.gridSelectDiv.animate({width:p},"slow",null,function(){i.dGrid.resize()}))});if(this.spnGenerate!=null)this.spnGenerate.on(n.Events.onTouchStartOrClick,function(){i.btnRefresh.hide();i.okBtn.hide();f&&(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),f=!1,i.gridSelectDiv.animate({width:e},"fast"),i.sideDiv.animate({width:r},"fast"),i.btnSpaceDiv.animate({width:r},"fast"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","#333333");lblGenrate.css("font-size","28px").css("color","#19A0ED")});if(this.spnSelect!=null)this.spnSelect.on(n.Events.onTouchStartOrClick,function(){f||(i.btnRefresh.show(),i.okBtn.show(),i.gridGenerateDiv.css("display","none"),i.gridSelectDiv.css("display","block"),i.sideDiv.css("display","block"),i.div.css("display","block"),i.gridSelectDiv.animate({width:e},"fast"),i.btnToggel.show(),lblSelect.css("font-size","28px").css("color","#19A0ED"),lblGenrate.css("font-size","17px").css("color","#333333"))});if(this.cmbWarehouse!=null&&this.cmbWarehouse.getControl().change(function(){i.okBtn.removeAttr("disabled");u=i.cmbWarehouse.getControl().find("option:selected").val();y()}),this.vSearchBPartner!=null&&this.vSearchBPartner.addVetoableChangeListener(this),this.vSearchOrder!=null&&this.vSearchOrder.addVetoableChangeListener(this),o!=null)o.on(n.Events.onTouchStartOrClick,function(){i.vSearchBPartner.isReadOnly||i.vSearchBPartner.setValue(null,!1,!0)});if(s!=null)s.on(n.Events.onTouchStartOrClick,function(){i.vSearchOrder.isReadOnly||i.vSearchOrder.setValue(null,!1,!0)})};this.display=function(){w(null)};this.getRoot=function(){return this.$root};this.disposeComponent=function(){this.okBtn&&this.okBtn.off(n.Events.onTouchStartOrClick);this.cancelBtn&&this.cancelBtn.off(n.Events.onTouchStartOrClick);o&&o.off(n.Events.onTouchStartOrClick);s&&s.off(n.Events.onTouchStartOrClick);i=null;this.frame=null;this.windowNo=null;this.arrListColumns=null;this.dGrid=null;h=null;u=null;c=null;b=null;k=null;f=null;this.lblWarehouse=null;this.lblBPartner=null;this.lblStatusInfo=null;this.tabSelect=null;this.tabGenrate=null;this.cmbWarehouse=null;this.vSearchBPartner=null;this.$root=null;this.$busyDiv=null;this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;r=null;e=null;p=null;d=null;v=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(t,i){this.frame=i;this.windowNo=t;n.Env.getCtx().setContext(this.windowNo,"IsSOTrx","Y");try{var r=this.Initialize()}catch(u){}this.frame.getContentGrid().append(this.getRoot());this.display();this.cmbWarehouse.getControl().focus()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VInOutGen=i}(VIS,jQuery),function(n,t){function i(){function g(){var ut="topDiv_"+i.windowNo,p="btnSpaceDiv_"+i.windowNo,ft="btnSpace_"+i.windowNo,et="spnSelect_"+i.windowNo,ot="spnGenerate_"+i.windowNo,w="lblGenerate_"+i.windowNo,b="lblSelect_"+i.windowNo,k=n.Application.contextUrl+"Areas/VIS/Images/clear16.png",d,g,nt,tt,it,l,c,rt,a,y;o=t('<button id = "btnClearBP_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2" style="width: 30px; height: 29px; padding: 0px; border-color: #BBBBBB;"><img tabindex="-1" src="'+k+'" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/button>');s=t('<button id = "btnClearOrd_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2" style="width: 30px; height: 29px; padding: 0px; border-color: #BBBBBB;"><img tabindex="-1" src="'+k+'" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/button>');c=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";i.topDiv=t("<div id='"+ut+"' style='float: left; width: 100%; height: 45px; margin-bottom: 2px;margin-left: 0px;'><div id='"+p+"' style='width: 260px; height: 45px;float: left;padding-left: 11px; padding-top: 11px;; background-color: #F1F1F1;'><button id='"+ft+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+c+"' /><\/button><\/div><div id='"+et+"'style='display: inline-block;  padding-left: 15px;margin-right: 15px;' ><label id='"+b+"' class='VIS_Pref_Label_Font' style='vertical-align: middle;font-size: 28px;color: #19A0ED;'>"+n.Msg.translate(n.Env.getCtx(),"Select")+"<\/label><\/div><div id='"+ot+"' style='display: inline-block; width: 160px;'><label id='"+w+"' class='VIS_Pref_Label_Font' style='vertical-align: middle; font-size: 17px;'>"+n.Msg.translate(n.Env.getCtx(),"Generate")+"<\/label><\/div><\/div>");d="sideDiv_"+i.windowNo;g="parameterDiv_"+i.windowNo;i.btnSpaceDiv=i.topDiv.find("#"+p);this.lblGenrate=i.topDiv.find("#"+w);this.lblSelect=i.topDiv.find("#"+b);i.sideDiv=t("<div id='"+d+"' style='float: left; margin-left: 0px; background-color: #F1F1F1;'>");i.sideDiv.css("width",r);i.sideDiv.css("height",v);i.div=t("<div style='float: left; width: 100%;' id='"+g+"'>");i.sideDiv.append(i.div);var h=t("<table style='width: 100%;'>"),u=t("<tr>"),e=t("<td style='padding: 4px 15px 0px;'>");i.div.append(h);h.append(u);u.append(e);e.append(i.lblOrg.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");e=t("<td style='padding: 0px 15px 8px;'>");h.append(u);u.append(e);e.append(i.cmbOrg.getControl().css("display","inline-block").css("width","236px").css("height","30px"));u=t("<tr>");e=t("<td style='padding: 0px 15px 0px;'>");h.append(u);u.append(e);e.append(i.lblBPartner.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");e=t("<td style='padding: 0px 15px 8px;'>");h.append(u);u.append(e);e.append(i.vSearchBPartner.getControl().css("width","176px")).append(i.vSearchBPartner.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")).append(o);nt=n.Msg.translate(n.Env.getCtx(),"DocumentNo");u=t("<tr>");e=t("<td style='padding: 0px 15px 0px;' title=' "+n.Msg.getMsg("SalesOrderNo",!1,!1)+"'>");h.append(u);u.append(e);e.append(nt);u=t("<tr>");e=t("<td style='padding: 0px 15px 0px;'>");h.append(u);u.append(e);e.append(i.vSearchOrderShipment.getControl(0).css("width","176px")).append(i.vSearchOrderShipment.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")).append(s);u=t("<tr>");e=t("<td style='padding: 0px 15px 0px;font-size:12px;'>");h.append(u);u.append(e);e.append("("+n.Msg.getMsg("SalesOrderNo",!1,!1)+")");tt="gridSelectDiv_"+i.windowNo;it="gridGenerateDiv_"+i.windowNo;i.gridSelectDiv=t("<div id='"+tt+"' style='float: right; margin-right: 15px;border: 1px solid darkgray;'>");i.gridSelectDiv.css("width",f);i.gridSelectDiv.css("height",v);i.gridGenerateDiv=t("<div id='"+it+"' style='height: 85%; float: right; display: none; background-color: #F1F1F1; margin-left: 15px;;margin-right: 15px;'>");i.gridGenerateDiv.css("width",t(window).width()-30);l="btnOk_"+i.windowNo;i.okBtn=t("<input id='"+l+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 1px; float: right; margin-right: 15px ;width: 70px;height: 38px;' type='button' value='Ok'>");l="btnRefresh_"+i.windowNo;c=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";i.btnRefresh=t("<button id='"+l+"' style='margin-bottom: 1px; margin-top: 0px; float: left; margin-left: 15px;height: 38px; ' class='VIS_Pref_btn-2'><img src='"+c+"'><\/button>");rt="discriptionDiv_"+i.windowNo;i.bottumDiv=t("<div style='width: 100%; height: 50px; float: left; margin-bottom: 0px;margin-top: 5px;'>");a=t("<div id='"+rt+"' style='width: 69%; float: left; margin-bottom: 0px; padding-top: 8px;padding-left: 10px; text-align: left;'>");a.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font"));y=t("<div style='width: 175px; float: right; text-align: right; margin-bottom: 0px;'>");y.append(i.okBtn);i.bottumDiv.append(i.btnRefresh).append(a).append(y);i.$root.append(i.$busyDiv);i.$root.append(i.topDiv).append(i.sideDiv).append(i.gridSelectDiv).append(i.gridGenerateDiv).append(i.bottumDiv)}function nt(){i.lblOrg.getControl().text(n.Msg.translate(n.Env.getCtx(),"AD_Org_ID"));i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));i.tabSelect.getControl().text(n.Msg.getMsg("Select",!1,!1));i.tabGenrate.getControl().text(n.Msg.getMsg("Generate",!1,!1));i.lblStatusInfo.getControl().text(n.Msg.getMsg("VIS_OrderGenInv",!1,!1))}function tt(){var u=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,2163,n.DisplayType.TableDir,"AD_Org_ID",0,!1,"AD_Org.AD_Org_ID <> 0  AND AD_Org.IsSummary='N' AND AD_Org.IsActive='Y'"),t,r;i.cmbOrg=new n.Controls.VComboBox("AD_Org_ID",!0,!1,!0,u,150,n.DisplayType.TableDir,0);t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,2762,n.DisplayType.Search);i.vSearchBPartner=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,t,0);r=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,2161,n.DisplayType.Search,"C_Order_ID",0,!1,"DocStatus='CO'");i.vSearchOrderShipment=new n.Controls.VTextBoxButton("C_Order_ID",!0,!1,!0,n.DisplayType.Search,r,0)}function w(r){i.dGrid!=null&&(i.dGrid.destroy(),i.dGrid=null);i.arrListColumns.length==0&&(i.arrListColumns.push({field:"AD_Org_ID",caption:n.Msg.translate(n.Env.getCtx(),"AD_Org_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_DocType_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_DocType_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DocumentNo",caption:n.Msg.getElement(n.Env.getCtx(),"DocumentNo"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.getElement(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"16%",min:150,hidden:!1}),i.arrListColumns.push({field:"DateOrdered",caption:n.Msg.getElement(n.Env.getCtx(),"DateOrdered"),sortable:!0,size:"16%",min:150,hidden:!1,render:"date"}),i.arrListColumns.push({field:"TotalLines",caption:n.Msg.getElement(n.Env.getCtx(),"TotalLines"),sortable:!0,size:"20%",min:150,hidden:!1}),i.arrListColumns.push({field:"C_Order_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_UOM_ID"),sortable:!0,size:"150px",hidden:!0}));w2utils.encodeTags(r);i.dGrid=t(i.gridSelectDiv).w2grid({name:"gridGenForm"+i.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:i.arrListColumns,records:r})}function y(){var r=[],s=n.Env.getCtx().getAD_Client_ID(),u="",f="",o="";e!=null&&e.toString()!="-1"&&(u=" AND ic.AD_Org_ID="+e);c!=null&&(f=" AND ic.C_BPartner_ID="+c);l!=null&&(o=" AND C_Order_ID="+l);t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv");t.ajax({url:n.Application.contextUrl+"VCreateFrom/ExecuteQueryVInvoiceGen",type:"POST",data:{adClientID:s,adOrgIDs:u,cBPartnerIDs:f,ordShipmentids:o},success:function(u){var f=JSON.parse(u),s,e,o;if(f&&f.length>0)try{for(s=1,e=0;e<f.length;e++)o={},o.C_Order_ID=f[e].c_order_id,o.AD_Org_ID=f[e].ord,o.C_DocType_ID=f[e].doctype,o.DocumentNo=f[e].documentno,o.C_BPartner_ID=f[e].bpname,o.DateOrdered=f[e].dateordered,o.TotalLines=f[e].tLines,o.recid=s,s++,r.push(o)}catch(h){}else n.ADialog.info("NoDataFound"),i.okBtn.attr("disabled","disabled");w(r);t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")},error:function(){t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")}})}function it(){var r,u,f,t,n;if(i.dGrid==null)return!1;if((r=[],u=i.dGrid.getSelection(),u!=null)&&!(u.length<=0)){for(f=u.toString().split(","),n=0;n<f.length;n++)r[n]=i.dGrid.get(f[n]).C_Order_ID;if(r.length==0)return"";for(t="",n=0;n<r.length;n++)n>0&&(t=t.concat(",")),t=t.concat(r[n].toString());return t.toString()}}function rt(r){var u=i;t.ajax({url:n.Application.contextUrl+"Common/GenerateInvoices",dataType:"json",data:{whereClause:r},success:function(r){r.DocumentText!=null&&(ut(!0),u.gridGenerateDiv.html(r.DocumentText),u.lblStatusInfo.getControl().text(r.lblStatusInfo));r.ErrorMsg!=null&&n.ADialog.info("",null,r.ErrorMsg,null);u.$busyDiv[0].style.visibility="hidden";t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")},error:function(){u.$busyDiv[0].style.visibility="hidden";t(i.$root[0]).removeClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).removeClass("vis-apanel-busyVInOutGenBusyDiv")}})}function ut(n){n&&(i.btnRefresh.hide(),i.okBtn.hide(),i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),n=!1,i.gridSelectDiv.animate({width:f},"fast"),i.sideDiv.animate({width:"toggle",height:"toggle"},"slow"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","#333333");lblGenrate.css("font-size","28px").css("color","#19A0ED")}var i,l;this.frame;this.windowNo;i=this;this.arrListColumns=[];this.dGrid=null;var h=null,e=null,c=null,b=!1,k=!1,u=!1;this.lblOrg=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblStatusInfo=new n.Controls.VLabel;this.tabSelect=new n.Controls.VLabel;this.tabGenrate=new n.Controls.VLabel;this.cmbOrg=new n.Controls.VComboBox("",!1,!1,!0);this.vSearchBPartner=null;this.vSearchOrderShipment=null;l=null;this.$root=t("<div style='width: 100%; height: 100%; background-color: white;'>");this.$busyDiv=t("<div class='vis-apanel-busy'>");this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.div=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;this.btnSpaceDiv=null;this.lblGenrate=null;this.lblSelect=null;var o=null,s=null,r=260,a=50,f=t(window).width()-(r+20+5),p=t(window).width()-(20+a),d=f+r+5,v=t(window).height()-210;this.vetoablechange=function(){c=i.vSearchBPartner.getValue();l=i.vSearchOrderShipment.getValue();i.okBtn.removeAttr("disabled");y()};this.Initialize=function(){if(tt(),nt(),g(),this.btnToggel=this.$root.find("#btnSpace_"+i.windowNo),this.spnSelect=this.$root.find("#spnSelect_"+i.windowNo),this.spnGenerate=this.$root.find("#spnGenerate_"+i.windowNo),this.okBtn!=null)this.okBtn.on(n.Events.onTouchStartOrClick,function(){i.$busyDiv[0].style.visibility="visible";t(i.$root[0]).addClass("vis-apanel-busyVInOutGenRoot");t(i.$busyDiv[0]).addClass("vis-apanel-busyVInOutGenBusyDiv");i.okBtn.attr("disabled","disabled");h=it();h!=null&&h.length>0?rt(h):(i.$busyDiv[0].style.visibility="hidden",n.ADialog.error("PlzSelectatLeast1Inv"));i.okBtn.removeAttr("disabled")});if(this.cancelBtn!=null)this.cancelBtn.on(n.Events.onTouchStartOrClick,function(){i.$root.dialog("close")});if(this.btnRefresh!=null)this.btnRefresh.on(n.Events.onTouchStartOrClick,function(){i.okBtn.removeAttr("disabled");e=i.cmbOrg.getControl().find("option:selected").val();c=i.vSearchBPartner.getValue();y()});if(this.btnToggel!=null)this.btnToggel.on(n.Events.onTouchStartOrClick,function(){u?(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!1,i.btnSpaceDiv.animate({width:r},"slow"),i.gridSelectDiv.animate({width:f},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:r},"slow",null,function(){i.dGrid.resize()})):(i.btnToggel.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!0,i.btnSpaceDiv.animate({width:a},"slow"),i.sideDiv.animate({width:a},"slow"),i.div.css("display","none"),i.gridSelectDiv.animate({width:p},"slow",null,function(){i.dGrid.resize()}))});if(this.spnGenerate!=null)this.spnGenerate.on(n.Events.onTouchStartOrClick,function(){i.btnRefresh.hide();i.okBtn.hide();u&&(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),u=!1,i.gridSelectDiv.animate({width:f},"fast"),i.sideDiv.animate({width:r},"fast"),i.btnSpaceDiv.animate({width:r},"fast"));i.gridSelectDiv.css("display","none");i.sideDiv.css("display","none");i.gridGenerateDiv.css("display","block");i.btnToggel.hide();lblSelect.css("font-size","17px").css("color","#333333");lblGenrate.css("font-size","28px").css("color","#19A0ED")});if(this.spnSelect!=null)this.spnSelect.on(n.Events.onTouchStartOrClick,function(){u||(i.btnRefresh.show(),i.okBtn.show(),i.gridGenerateDiv.css("display","none"),i.gridSelectDiv.css("display","block"),i.sideDiv.css("display","block"),i.div.css("display","block"),i.gridSelectDiv.animate({width:f},"fast"),i.btnToggel.show(),lblSelect.css("font-size","28px").css("color","#19A0ED"),lblGenrate.css("font-size","17px").css("color","#333333"))});if(this.cmbOrg!=null&&this.cmbOrg.getControl().change(function(){i.okBtn.removeAttr("disabled");e=i.cmbOrg.getControl().find("option:selected").val();y()}),this.vSearchBPartner!=null&&this.vSearchBPartner.addVetoableChangeListener(this),this.vSearchOrderShipment!=null&&this.vSearchOrderShipment.addVetoableChangeListener(this),o!=null)o.on(n.Events.onTouchStartOrClick,function(){i.vSearchBPartner.isReadOnly||i.vSearchBPartner.setValue(null,!1,!0)});if(s!=null)s.on(n.Events.onTouchStartOrClick,function(){i.vSearchOrderShipment.isReadOnly||i.vSearchOrderShipment.setValue(null,!1,!0)})};this.display=function(){w(null)};this.getRoot=function(){return this.$root};this.disposeComponent=function(){this.okBtn&&this.okBtn.off(n.Events.onTouchStartOrClick);this.cancelBtn&&this.cancelBtn.off(n.Events.onTouchStartOrClick);o&&o.off(n.Events.onTouchStartOrClick);s&&s.off(n.Events.onTouchStartOrClick);i=null;this.frame=null;this.windowNo=null;this.arrListColumns=null;this.dGrid=null;h=null;e=null;c=null;b=null;k=null;u=null;this.lblOrg=null;this.lblBPartner=null;this.lblStatusInfo=null;this.tabSelect=null;this.tabGenrate=null;this.cmbOrg=null;this.vSearchBPartner=null;this.$root=null;this.$busyDiv=null;this.topDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridGenerateDiv=null;this.bottumDiv=null;this.okBtn=null;this.cancelBtn=null;this.btnRefresh=null;this.btnToggel=null;this.spnSelect=null;this.spnGenerate=null;r=null;f=null;p=null;d=null;v=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(t,i){this.frame=i;this.windowNo=t;n.Env.getCtx().setContext(this.windowNo,"IsSOTrx","Y");try{var r=this.Initialize()}catch(u){}this.frame.getContentGrid().append(this.getRoot());this.display();this.cmbOrg.getControl().focus()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VInvoiceGen=i}(VIS,jQuery),function(n,t){function i(){function ci(){var a=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png",p=n.Application.contextUrl+"Areas/VIS/Images/clear16.png",a=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png",e,l,o,s,h,c;g=t('<button id = "btnClearBP_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2" style="width: 30px; height: 29px; padding: 0px; border-color: #BBBBBB;"><img tabindex="-1" src="'+p+'" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/button>');nt=t('<button id = "btnClearOrd_'+i.windowNo+'" tabindex="-1" class="vis-controls-txtbtn-table-td2" style="width: 30px; height: 29px; padding: 0px; border-color: #BBBBBB;"><img tabindex="-1" src="'+p+'" title="'+n.Msg.getMsg("Clear",!1,!1)+'"><\/button>');i.topDiv=t("<div id='topDiv_"+i.windowNo+"' style='float: left; width: 100%; height: 45px; margin-bottom: 2px;margin-left: 0px;'><div id='btnSpaceDiv_"+i.windowNo+"' style='width: 260px; height: 45px;float: left;padding-left: 11px; padding-top: 11px;; background-color: #F1F1F1;'><button id='btnToggelDiv_"+i.windowNo+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+a+"' /><\/button><\/div><\/div>");e=t("<div style='float: left;  margin-right: 15px;padding-top: 10px;'>");e.append(i.lblInvoice.getControl().css("display","inline-block").css("font-size","24px").css("margin-left","15px").css("color","#19A0ED").addClass("VIS_Pref_Label_Font"));e.append(chkSameBPartnerDiv);e.append(chkSameProductDiv);e.append(chkSameQtyDiv);e.css("width",y);e.css("height","45px");i.topDiv.append(e);i.invoiceTopDiv=e;i.btnSpaceDiv=i.topDiv.find("#btnSpaceDiv_"+i.windowNo);i.sideDiv=t("<div id='sideDiv_"+i.windowNo+"' style='float: left; margin-left: 0px;background-color: #F1F1F1; '>");i.sideDiv.css("width",v);i.sideDiv.css("height",ft-3);i.div=t("<div style='float: left;overflow-y: scroll;height: 100%;' id='parameterDiv_"+i.windowNo+"'>");i.sideDiv.append(i.div);var f=t("<table style='width: 100%;height: 100%;'>"),r=t("<tr>"),u=t("<td style='padding: 4px 15px 2px;'>");i.div.append(f);f.append(r);r.append(u);u.append(i.lblMatchFrom.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.cmbMatchFrom.getControl().css("display","inline-block").css("width","236px").css("height","32px"));r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblMatchTo.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.cmbMatchTo.getControl().css("display","inline-block").css("width","236px").css("height","32px"));r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblMatchMode.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.cmbMatchMode.getControl().css("display","inline-block").css("width","236px").css("height","32px"));r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblBPartner.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.onlyVendor.getControl().css("width","176px")).append(i.onlyVendor.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")).append(g);r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblProduct.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.onlyProduct.getControl().css("width","176px")).append(i.onlyProduct.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB")).append(nt);r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblDateFrom.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.dtpFrom);r=t("<tr>");u=t("<td style='padding: 4px 15px 2px;'>");f.append(r);r.append(u);u.append(i.lblDateTo.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");u=t("<td style='padding: 0px 15px 0px;'>");f.append(r);r.append(u);u.append(i.dtpTo);r=t("<tr>");u=t("<td style='padding: 10px 15px 0px;'>");f.append(r);r.append(u);u.append(chkIsReturnTrxDiv);i.divForGrid=t("<div id='divForGrid_"+i.windowNo+"' style='float: left;margin-left: 15px;margin-right: 15px'>");i.divForGrid.css("width",y);i.divForGrid.css("height",ft-3);i.gridInvoiceDiv=t("<div id='gridInvoiceDiv_"+i.windowNo+"' style='width: 100%;float: left; '>");i.gridInvoiceDiv.css("height","47%");i.invoicegrd=t("<div style='float: left; width: 100%;height: 99%;'>");i.gridInvoiceDiv.append(i.invoicegrd);i.gridReciptDiv=t("<div id='gridReciptDiv_"+i.windowNo+"' style='width: 100%;float: left;'>");i.gridReciptDiv.css("height","46%");l=t("<div style='float: left; width: 100%; margin-top: 0px;'>");l.append(i.lblReceipt.getControl().css("display","inline-block").css("font-size","24px").css("color","#19A0ED").addClass("VIS_Pref_Label_Font"));i.reciptgrd=t("<div style='float: left; width: 100%;height: 99%;'>");i.gridReciptDiv.append(i.reciptgrd);o=t("<div style='float: left; width: 60%; margin-left: 185px;margin-top: 3px;'>");s=t("<div style='float: left;width: 33%;'>");s.append(i.lblMatched.getControl().css("display","block").addClass("VIS_Pref_Label_Font"));s.append(i.txtMatched.getControl().css("width","100%"));o.append(s);h=t("<div style='float: left; padding-left: 15px;margin-top: 0px;width: 33%;'>");h.append(i.lblMatchedTo.getControl().css("display","block").addClass("VIS_Pref_Label_Font"));h.append(i.txtMatchedTo.getControl().css("width","100%"));o.append(h);c=t("<div style='float: left; padding-left: 15px;margin-top: 0px;width: 33.3%; '>");c.append(i.lblDifference.getControl().css("display","block").addClass("VIS_Pref_Label_Font"));c.append(i.txtDifference.getControl().css("width","100%"));o.append(c);i.bottumButtonDiv=t("<div style='float: left;margin-top: 5px; width:100%'>");i.bottumButtonDiv.css("height",55);i.bottumButtonDiv.append(i.btnSearch);i.bottumButtonDiv.append(o);i.bottumButtonDiv.append(i.btnProcess);i.bottumDiv=t("<div style='float: left;background-color: #F1F1F1; width:100%'>");i.bottumDiv.css("height",30);i.bottumDiv.append(i.lblStatusInfo.getControl().addClass("VIS_Pref_Label_Font"));i.bottumDiv.append(i.lblStatusCount.getControl().css("float","right").addClass("VIS_Pref_Label_Font"));i.divForGrid.append(i.gridInvoiceDiv).append(l).append(i.gridReciptDiv);i.$root.append(i.topDiv).append(i.sideDiv).append(i.divForGrid).append(i.bottumButtonDiv).append(i.bottumDiv);i.$root.append(i.$busyDiv)}function li(){var r=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";i.dtpFrom=t("<input id='dateFrom_"+i.windowNo+"' type='date' name='DateOrdered' style='display: inline-block;line-height: 23px;width:236px'>");i.dtpTo=t("<input id='dateTo_"+i.windowNo+"' type='date' name='DateOrdered' style='display: inline-block;line-height: 23px;width:236px'>");this.chkIsReturnTrxDiv=t("<div>");i.chkIsReturnTrx=t("<input id='chkIsReturnTrx_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblIsReturnTrx_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Return Transaction<\/label><\/span>");this.chkIsReturnTrxDiv.append(i.chkIsReturnTrx);this.chkSameBPartnerDiv=t("<div style='float: right; margin-right: 15px;'>");n.Application.isRTL&&(this.chkSameBPartnerDiv=t("<div style='float: left; margin-right: 15px;margin-left: 15px;'>"));i.chkSameBPartner=t("<input id='chkSameBPartner_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameBPartner_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Same BPartner<\/label><\/span>");this.chkSameBPartnerDiv.append(i.chkSameBPartner);this.chkSameProductDiv=t("<div style='float: right; margin-right: 15px;' >");n.Application.isRTL&&(this.chkSameProductDiv=t("<div style='float: left; margin-right: 15px;'>"));i.chkSameProduct=t("<input id='chkSameProduct_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameProduct_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Same Product<\/label><\/span>");this.chkSameProductDiv.append(i.chkSameProduct);this.chkSameQtyDiv=t("<div style='float: right; margin-right: 15px;' >");n.Application.isRTL&&(this.chkSameQtyDiv=t("<div style='float: left; margin-right: 15px;'>"));i.chkSameQty=t("<input id='chkSameQty_"+i.windowNo+"' type='checkbox' class='VIS_Pref_automatic'><span><label id='lblSameQty_"+i.windowNo+"' class='VIS_Pref_Label_Font'>Same Quantity<\/label><\/span>");this.chkSameQtyDiv.append(i.chkSameQty);i.btnSearch=t("<input id='btnSearch_"+i.windowNo+"' class='VIS_Pref_pass-btn' style='margin-top: 10px;margin-left: 15px;  float: left;' type='button' value='Search'>");i.btnProcess=t("<Button id='btnProcess_"+i.windowNo+"' style='margin-top: 10px; float: right;margin-right: 15px;' class='VIS_Pref_btn-2'>"+n.Msg.getMsg("Match")+"<\/Button>");i.lblInvoice.getControl().text(n.Msg.translate(n.Env.getCtx(),"Invoice"));i.lblReceipt.getControl().text(n.Msg.translate(n.Env.getCtx(),"Receipt"));i.lblMatchFrom.getControl().text(n.Msg.translate(n.Env.getCtx(),"MatchFrom"));i.lblMatchTo.getControl().text(n.Msg.translate(n.Env.getCtx(),"MatchTo"));i.lblMatchMode.getControl().text(n.Msg.translate(n.Env.getCtx(),"MatchMode"));i.lblBPartner.getControl().text(n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"));i.lblProduct.getControl().text(n.Msg.translate(n.Env.getCtx(),"M_Product_ID"));i.lblDateFrom.getControl().text(n.Msg.translate(n.Env.getCtx(),"DateFrom"));i.lblDateTo.getControl().text(n.Msg.translate(n.Env.getCtx(),"DateTo"));i.lblMatched.getControl().text(n.Msg.translate(n.Env.getCtx(),"ToBeMatched"));i.lblMatchedTo.getControl().text(n.Msg.translate(n.Env.getCtx(),"Matching"));i.lblDifference.getControl().text(n.Msg.translate(n.Env.getCtx(),"Difference"));i.chkIsReturnTrx.prop("checked",!1);i.btnProcess.attr("disabled","disabled");i.chkSameProduct.prop("checked",!0);i.chkSameBPartner.prop("checked",!0);i.chkSameQty.prop("checked",!1);i.chkIsReturnTrx.next("label").text(n.Msg.translate(n.Env.getCtx(),"isReturnTrx"));i.chkSameProduct.next("label").text(n.Msg.translate(n.Env.getCtx(),"SameProduct"));i.chkSameBPartner.next("label").text(n.Msg.translate(n.Env.getCtx(),"SameBPartner"));i.chkSameQty.next("label").text(n.Msg.translate(n.Env.getCtx(),"SameQty"));i.lblSearch.getControl().text(n.Msg.translate(n.Env.getCtx(),"Search"));i.btnSearch.text(n.Msg.translate(n.Env.getCtx(),"Search"))}function bt(){ui();kt();i.lblStatusInfo.getControl().text("");i.lblStatusCount.getControl().text(0)}function ai(){var t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,3499,n.DisplayType.Search);i.onlyVendor=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,t);t=n.MLookupFactory.getMLookUp(n.Env.getCtx(),i.windowNo,3840,n.DisplayType.Search);i.onlyProduct=new n.Controls.VTextBoxButton("M_Product_ID",!0,!1,!0,n.DisplayType.Search,t)}function kt(){i.cmbMatchTo.getControl().empty();var n=null;i.cmbMatchFrom.getControl().find("option").length>0&&(n=i.cmbMatchFrom.getControl().find("option:selected").val(),n.equals(r[o])?i.cmbMatchTo.getControl().append(" <option value='"+r[f]+"'>"+r[f]+"<\/option>"):n.equals(r[u])?i.cmbMatchTo.getControl().append(" <option value='"+r[f]+"'>"+r[f]+"<\/option>"):(i.cmbMatchTo.getControl().append(" <option value='"+r[o]+"'>"+r[o]+"<\/option>"),i.cmbMatchTo.getControl().append(" <option value='"+r[u]+"'>"+r[u]+"<\/option>")),i.cmbMatchTo.getControl().prop("selectedIndex",0),i.lblInvoice.getControl().text(n));dt()}function dt(){selection=i.cmbMatchTo.getControl().find("option:selected").val();i.lblReceipt.getControl().text(selection)}function ot(){var v=i.cmbMatchFrom.getControl()[0].selectedIndex,c=i.cmbMatchTo.getControl().find("option:selected").val(),h=o,l,a,t,e;c.equals(r[f])?h=f:c.equals(r[u])&&(h=u);pt=h;ii(v,h);et="";i.vdgvReceipt!=null&&i.vdgvReceipt.clear();i.onlyProduct.getValue()!=null&&(l=i.onlyProduct.getValue(),vt=" AND lin.M_Product_ID="+l);i.onlyVendor.getValue()!=null&&(a=i.onlyVendor.getValue(),yt=" AND hdr.C_BPartner_ID="+a);t=i.dtpFrom.val();e=i.dtpTo.val();t!=""&&e!=""?ct=" AND "+s+" BETWEEN "+n.DB.to_date(t)+" AND "+n.DB.to_date(e):t!=""?lt=" AND "+s+" >= "+n.DB.to_date(t):e!=""&&(at=" AND "+s+" <= "+n.DB.to_date(e));ri(i.vdgvInvoice);i.txtMatched.getControl().val(0);i.lblStatusInfo.getControl().text(i.cmbMatchFrom.getControl().find("option:selected").val()+"# = "+i.vdgvInvoice.records.length+" -"+i.cmbMatchTo.getControl().find("option:selected").val()+"# = "+i.vdgvReceipt.records.length);i.lblStatusCount.getControl().text(0)}function c(n){var t,s,h,e,c,v,y,a,w;tt="";it="";rt="";t=-1;n!=null?t=n:i.vdgvInvoice.getSelection().length>0&&(t=Number(i.vdgvInvoice.getSelection().toString()));s=0;t<0?i.$busyDiv[0].style.visibility="hidden":(h=i.cmbMatchTo.getControl().find("option:selected").val(),e=o,h.equals(r[f])?e=f:h.equals(r[u])&&(e=u),c=i.cmbMatchFrom.getControl()[0].selectedIndex,pt=c,ii(e,c),v={key:i.vdgvInvoice.get(t).C_BPartner_ID_K,value:i.vdgvInvoice.get(t).C_BPartner_ID},y={key:i.vdgvInvoice.get(t).M_Product_ID_K,value:i.vdgvInvoice.get(t).M_Product_ID},i.chkSameBPartner.prop("checked")&&(tt=" AND hdr.C_BPartner_ID="+v.key),i.chkSameProduct.prop("checked")&&(it=" AND lin.M_Product_ID="+y.key),a=i.vdgvInvoice.get(t).Qty,w=i.vdgvInvoice.get(t).Matched,s=a-w,i.chkSameQty.prop("checked")&&(rt=" AND "+p+"="+a),et=i.vdgvInvoice.get(t).Line_K,ri(i.vdgvReceipt));l=s;i.txtMatched.setValue(l);i.txtMatchedTo.setValue(0);i.txtDifference.setValue(l);i.lblStatusInfo.getControl().text(i.cmbMatchFrom.getControl().find("option:selected").val()+"# = "+i.vdgvInvoice.records.length+" -"+i.cmbMatchTo.getControl().find("option:selected").val()+"# = "+i.vdgvReceipt.records.length);i.lblStatusCount.getControl().text(0)}function vi(){var n=-1,o,h,c;if(i.vdgvInvoice.getSelection().length>0&&(n=Number(i.vdgvInvoice.getSelection().toString())),n<0){e=!1;i.$busyDiv[0].style.visibility="hidden";return}var b={key:i.vdgvInvoice.get(n).C_BPartner_ID_K,value:i.vdgvInvoice.get(n).C_BPartner_ID},a={key:i.vdgvInvoice.get(n).Line_K,value:i.vdgvInvoice.get(n).Line},v={key:i.vdgvInvoice.get(n).M_Product_ID_K,value:i.vdgvInvoice.get(n).M_Product_ID},y=l,k=i.vdgvInvoice.get(n).Matched,f=i.vdgvReceipt.getSelection().toString();if(f==null){e=!1;i.$busyDiv[0].style.visibility="hidden";return}if(f.length<=0){e=!1;i.$busyDiv[0].style.visibility="hidden";return}o=!0;(i.cmbMatchFrom.getControl().find("option:selected").val().equals(r[u])||i.cmbMatchTo.getControl().find("option:selected").val().equals(r[u]))&&(o=!1);var p=i.cmbMatchMode.getControl()[0].selectedIndex,w=i.cmbMatchFrom.getControl()[0].selectedIndex,s=[],t=f.toString().split(",");for(n=0;n<t.length;n++)if(h=i.vdgvReceipt.get(t[n])._ID,h!=null){if(c={key:i.vdgvReceipt.get(t[n]).M_Product_ID_K,value:i.vdgvReceipt.get(t[n]).M_Product_ID},v.key!=c.key)continue;s.push(i.vdgvReceipt.get(t[n]))}else continue;if(s.length>0)yi(o,p,w,a.key,y,s);else{e=!1;i.$busyDiv[0].style.visibility="hidden";return}}function ii(n){tt="";it="";rt="";ct="";lt="";at="";vt="";yt="";ti=i.cmbMatchMode.getControl()[0].selectedIndex==wt;st="";gt=i.chkIsReturnTrx.prop("checked");ht="";ni=!1;matchToTypeMATCH_ORDER="matchToTypeMATCH_ORDER";n==o?(st="displayMATCH_INVOICE",s="hdr.DateInvoiced",p="lin.QtyInvoiced"):n==u?(ht="displayMATCH_ORDER",s="hdr.DateOrdered",p="lin.QtyOrdered"):(s="hdr.MovementDate",p="lin.MovementQty")}function ri(r){var e=[],o={displayMATCH_INVOICEs:st,chkIsReturnTrxProps:gt,displayMATCH_ORDERs:ht,matchToTypeMATCH_SHIPMENTs:ni,matchedsss:ti,chkSameBPartnerss:tt,chkSameProductss:it,chkSameQtyss:rt,from_ss:ct,fromIfs:lt,to_Dats:at,matchToTypes:pt,MATCH_SHIPMENTs:f,MATCH_ORDERs:u,onlyProduct_ss:vt,onlyVendor_ss:yt,MatchToID:et};t.ajax({url:n.Application.contextUrl+"VCreateFrom/GetTableLoadVmatch",dataType:"json",data:o,success:function(n){var t=JSON.parse(n),o,u,f;if(t&&t!=null)for(o=1,u=0;u<t.length;u++)f={},f._ID=t[u]._ID,f.DocumentNo=t[u].DocNo,f.Date=t[u].Date,f.C_BPartner_ID=t[u].CBPartnerIDK,f.C_BPartner_ID_K=t[u].CBPartnerID,f.Line=t[u].Line,f.Line_K=t[u].Line_K,f.M_Product_ID=t[u].MProductIDK,f.M_Product_ID_K=t[u].MProductID,f.Qty=t[u].Qty,f.Matched=t[u].Matched,f.recid=o,o++,e.push(f);e.length<1?(ui(r.name.contains("vdgvReceipt")),i.$busyDiv[0].style.visibility="hidden"):r.name.contains("vdgvReceipt")?(wi(i.arrListColumns,e),i.$busyDiv[0].style.visibility="hidden"):r.name.contains("vdgvInvoice")&&(pi(i.arrListColumns,e),c())},error:function(n){console.log(n);i.$busyDiv[0].style.visibility="hidden"}})}function yi(r,u,f,o,s,h){var c=i;t.ajax({url:n.Application.contextUrl+"Common/CreateMatchRecord",dataType:"json",data:{invoice:r,MatchMode:u,MatchFrom:f,LineMatched:o,ToMatchQty:s,SelectedItems:JSON.stringify(h)},success:function(t){ot();i.vdgvReceipt.delete(!0);var r=JSON.parse(t);r.Msg!=""?n.ADialog.info("",null,r.Msg,null):r.MatchedPO_ID>0?n.ADialog.info("Matched",null,n.Msg.getMsg("PurchaseOrder")+" - "+r.MatchedPO_ID,null):r.MatchedInv_ID>0&&n.ADialog.info("Matched",null,n.Msg.getMsg("Invoice")+" - "+r.MatchedInv_ID,null);e=!1;i.$busyDiv[0].style.visibility="hidden"},error:function(n,t){console.log(t);e=!1;i.$busyDiv[0].style.visibility="hidden"}})}function ui(r){i.arrListColumns.length==0&&(i.arrListColumns.push({field:"_ID",caption:"_ID",sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"DocumentNo",caption:n.Msg.translate(n.Env.getCtx(),"DocumentNo"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"Date",caption:n.Msg.translate(n.Env.getCtx(),"Date"),sortable:!0,size:"11%",hidden:!1,render:"date"}),i.arrListColumns.push({field:"C_BPartner_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"C_BPartner_ID_K",caption:n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID"),sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"Line",caption:n.Msg.translate(n.Env.getCtx(),"Line"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"Line_K",caption:n.Msg.translate(n.Env.getCtx(),"Line"),sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"M_Product_ID",caption:n.Msg.translate(n.Env.getCtx(),"M_Product_ID"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"M_Product_ID_K",caption:n.Msg.translate(n.Env.getCtx(),"M_Product_ID"),sortable:!0,size:"11%",hidden:!0}),i.arrListColumns.push({field:"Qty",caption:n.Msg.translate(n.Env.getCtx(),"Qty"),sortable:!0,size:"11%",hidden:!1}),i.arrListColumns.push({field:"Matched",caption:n.Msg.translate(n.Env.getCtx(),"Matched"),sortable:!0,size:"11%",hidden:!1}));r==null?(i.vdgvInvoice!=null&&(i.vdgvInvoice.destroy(),i.vdgvInvoice=null),i.vdgvInvoice=t(i.invoicegrd).w2grid({name:"vdgvInvoice"+i.windowNo,recordHeight:30,show:{selectColumn:!1},onSelect:function(n){c(n.recid)},multiSelect:!1,columns:i.arrListColumns,records:null}),i.vdgvReceipt!=null&&(i.vdgvReceipt.destroy(),i.vdgvReceipt=null),i.vdgvReceipt=t(i.reciptgrd).w2grid({name:"vdgvReceipt"+i.windowNo,recordHeight:30,show:{selectColumn:!0},onSelect:function(n){this.multiSelect=!0;a(n.recid,!0)},onUnselect:function(n){a(n.recid,!1)},multiSelect:!1,columns:i.arrListColumns,records:null})):r?r&&(i.vdgvReceipt!=null&&(i.vdgvReceipt.destroy(),i.vdgvReceipt=null),i.vdgvReceipt=t(i.reciptgrd).w2grid({name:"vdgvReceipt"+i.windowNo,recordHeight:30,show:{selectColumn:!0},onSelect:function(n){this.multiSelect=!0;a(n.recid,!0)},onUnselect:function(n){a(n.recid,!1)},multiSelect:!1,columns:i.arrListColumns,records:null})):(i.vdgvInvoice!=null&&(i.vdgvInvoice.destroy(),i.vdgvInvoice=null),i.vdgvInvoice=t(i.invoicegrd).w2grid({name:"vdgvInvoice"+i.windowNo,recordHeight:30,show:{selectColumn:!1},onSelect:function(n){c(n.recid)},multiSelect:!1,columns:i.arrListColumns,records:null}))}function pi(n,r){i.vdgvInvoice!=null&&(i.vdgvInvoice.destroy(),i.vdgvInvoice=null);w2utils.encodeTags(r);i.vdgvInvoice=t(i.invoicegrd).w2grid({name:"vdgvInvoice"+i.windowNo,recordHeight:30,show:{selectColumn:!1},onSelect:function(n){c(n.recid)},multiSelect:!1,columns:n,records:r})}function wi(n,r){i.vdgvReceipt!=null&&(i.vdgvReceipt.destroy(),i.vdgvReceipt=null);w2utils.encodeTags(r);i.vdgvReceipt=t(i.reciptgrd).w2grid({name:"vdgvReceipt"+i.windowNo,recordHeight:30,show:{selectColumn:!0},onSelect:function(n){this.multiSelect=!0;a(n.recid,!0)},onUnselect:function(n){a(n.recid,!1)},multiSelect:!1,columns:n,records:r})}function a(n,t){var o,s,r,u,c,a;if(!(i.vdgvInvoice.records.length<1)){if(!i.chkSameProduct.prop("checked")){setTimeout(function(){i.vdgvReceipt.unselect(Number(n))},10);return}o=-1;s=null;i.vdgvInvoice.getSelection().length>0&&(o=Number(i.vdgvInvoice.getSelection().toString()),s={key:i.vdgvInvoice.get(o).M_Product_ID_K,value:i.vdgvInvoice.get(o).M_Product_ID});var f=0,h=0,e=n+","+i.vdgvReceipt.getSelection().toString().replace(n,"");if(t&&e!=null&&e.length>0)for(e=e.replace(/,$/,""),r=e.toString().split(","),u=0;u<r.length;u++)if(c=i.vdgvReceipt.get(r[0])._ID,c!=null){if(a={key:i.vdgvReceipt.get(r[u]).M_Product_ID_K,value:i.vdgvReceipt.get(r[u]).M_Product_ID},s.key!=a.key){setTimeout(function(){i.vdgvReceipt.unselect(Number(n))},10);return}i.cmbMatchMode.getControl()[0].selectedIndex==k&&(f=f+Number(i.vdgvReceipt.get(r[u]).Qty));f=f-Number(i.vdgvReceipt.get(r[u]).Matched);h++}d=f;i.txtMatchedTo.setValue(d.toString());i.txtDifference.setValue(l-d);h<=0&&i.btnProcess.removeAttr("disabled");i.lblStatusCount.getControl().text(h)}}var i,h;this.frame;this.windowNo;i=this;this.arrListColumns=[];this.vdgvInvoice=null;this.vdgvReceipt=null;this.lblMatchFrom=new n.Controls.VLabel;this.lblMatchTo=new n.Controls.VLabel;this.lblMatchMode=new n.Controls.VLabel;this.lblBPartner=new n.Controls.VLabel;this.lblProduct=new n.Controls.VLabel;this.lblDateFrom=new n.Controls.VLabel;this.lblDateTo=new n.Controls.VLabel;this.lblInvoice=new n.Controls.VLabel;this.lblReceipt=new n.Controls.VLabel;this.lblMatched=new n.Controls.VLabel;this.lblMatchedTo=new n.Controls.VLabel;this.lblDifference=new n.Controls.VLabel;this.lblStatusInfo=new n.Controls.VLabel;this.lblStatusCount=new n.Controls.VLabel;this.lblSearch=new n.Controls.VLabel;this.cmbMatchFrom=new n.Controls.VComboBox("",!1,!1,!0);this.cmbMatchTo=new n.Controls.VComboBox("",!1,!1,!0);this.cmbMatchMode=new n.Controls.VComboBox("",!1,!1,!0);this.chkIsReturnTrx=null;this.chkSameBPartner=null;this.chkSameProduct=null;this.chkSameQty=null;this.onlyVendor=null;this.onlyProduct=null;this.dtpFrom=null;this.dtpTo=null;this.btnSearch=null;this.btnProcess=null;this.btnToggel=null;this.txtMatched=new n.Controls.VTextBox("",!1,!0,!1);this.txtMatchedTo=new n.Controls.VTextBox("",!1,!0,!1);this.txtDifference=new n.Controls.VTextBox("",!1,!0,!1);this.$root=t("<div style='width: 100%; height: 100%; background-color: white;'>");this.$busyDiv=t("<div id='testBesy' style='height: 100%;' class='vis-apanel-busy'>");this.sideDiv=null;this.gridSelectDiv=null;this.gridInvoiceDiv=null;this.gridReciptDiv=null;this.processlDiv=null;this.bottumDiv=null;this.bottumButtonDiv=null;this.btnSpaceDiv=null;this.topDiv=null;this.div=null;this.divForGrid=null;this.invoicegrd=null;this.reciptgrd=null;this.invoiceTopDiv=null;var w=!1,v=260,b=50,y=t(window).width()-(v+30),ut=t(window).width()-(30+b),ft=t(window).height()-240,fi=n.Env.getCtx().getAD_Client_ID(),ei=n.Env.getCtx().getAD_Org_ID(),oi=n.Env.getCtx().getAD_User_ID(),o=0,f=1,u=2,k=0,wt=1,si=null,s="",p="",hi="",l=0,d=0,et="",g=null,nt=null,e=!1,r=[];r.push(n.Msg.getElement3(n.Env.getAD_Language(n.Env.getCtx()),"C_Invoice_ID",!1));r.push(n.Msg.getElement3(n.Env.getAD_Language(n.Env.getCtx()),"M_InOut_ID",!1));r.push(n.Msg.getElement3(n.Env.getAD_Language(n.Env.getCtx()),"C_Order_ID",!1));h=[];h.push(n.Msg.getMsg("NotMatched"));h.push(n.Msg.getMsg("Matched"));var st="",gt="",ht="",ni=!1,ti="",tt="",it="",rt="",ct="",lt="",at="",vt="",yt="",pt="";this.Initialize=function(){for(var u=0;u<r.length;u++)this.cmbMatchFrom.getControl().append(" <option value='"+r[u]+"'>"+r[u]+"<\/option>");for(u=0;u<h.length;u++)this.cmbMatchMode.getControl().append(" <option value='"+h[u]+"'>"+h[u]+"<\/option>");if(this.cmbMatchFrom.getControl().prop("selectedIndex",0),this.cmbMatchMode.getControl().prop("selectedIndex",0),ai(),li(),ci(),this.btnToggel=this.$root.find("#btnToggelDiv_"+i.windowNo),this.gridSelectDiv=this.$root.find("#divForGrid_"+i.windowNo),this.cmbMatchFrom.getControl()!=null&&this.cmbMatchFrom.getControl().change(function(){i.$busyDiv[0].style.visibility="visible";bt();kt();i.$busyDiv[0].style.visibility="hidden"}),this.cmbMatchTo.getControl()!=null&&this.cmbMatchTo.getControl().change(function(){i.$busyDiv[0].style.visibility="visible";dt();i.$busyDiv[0].style.visibility="hidden"}),this.cmbMatchMode.getControl()!=null&&this.cmbMatchMode.getControl().change(function(){i.cmbMatchMode.getControl()[0].selectedIndex==k?i.btnProcess.text(n.Msg.getMsg("Match")):i.btnProcess.text(n.Msg.getMsg("Unmatch"))}),this.btnSearch!=null)this.btnSearch.on(n.Events.onTouchStartOrClick,function(){i.$busyDiv[0].style.visibility="visible";ot()});if(this.btnProcess!=null)this.btnProcess.on(n.Events.onTouchStartOrClick,function(){e||(i.$busyDiv[0].style.visibility="visible",e=!0,vi())});if(this.btnToggel!=null)this.btnToggel.on(n.Events.onTouchStartOrClick,function(){w?(i.btnToggel.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),w=!1,i.btnSpaceDiv.animate({width:v},"slow"),i.gridSelectDiv.animate({width:y},"slow"),i.invoiceTopDiv.animate({width:y},"slow"),i.div.css("display","block"),i.sideDiv.animate({width:v},"slow",null,function(){i.vdgvInvoice.resize();i.vdgvReceipt.resize()})):(i.btnToggel.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),w=!0,i.btnSpaceDiv.animate({width:b},"slow"),i.sideDiv.animate({width:b},"slow"),i.div.css("display","none"),i.invoiceTopDiv.animate({width:ut},"slow"),i.gridSelectDiv.animate({width:ut},"slow",null,function(){i.vdgvInvoice.resize();i.vdgvReceipt.resize()}))});if(this.chkSameBPartner.change(function(){i.$busyDiv[0].style.visibility="visible";c()}),this.chkSameQty.change(function(){i.$busyDiv[0].style.visibility="visible";c()}),this.chkSameProduct.change(function(){i.$busyDiv[0].style.visibility="visible";c()}),g!=null)g.on(n.Events.onTouchStartOrClick,function(){i.onlyVendor.isReadOnly||i.onlyVendor.setValue(null,!1,!0)});if(nt!=null)nt.on(n.Events.onTouchStartOrClick,function(){i.onlyProduct.isReadOnly||i.onlyProduct.setValue(null,!1,!0)});i.$busyDiv[0].style.visibility="hidden"};this.display=function(){bt()};this.getRoot=function(){return this.$root};this.callConsolidate=function(){t.ajax({url:n.Application.contextUrl+"Common/Consolidate",dataType:"json",async:!0,success:function(){}});i.vdgvReceipt.multiSelect=!0;var r="vdgvReceipt"+i.windowNo;w2ui[r].multiSelect=!0};this.disposeComponent=function(){this.btnSearch&&this.btnSearch.off(n.Events.onTouchStartOrClick);this.btnProcess&&this.btnProcess.off(n.Events.onTouchStartOrClick);this.btnToggel&&this.btnToggel.off(n.Events.onTouchStartOrClick);this.frame=null;this.windowNo=null;this.arrListColumns=null;this.vdgvInvoice=null;this.vdgvReceipt=null;this.lblMatchFrom=null;this.lblMatchTo=null;this.lblMatchMode=null;this.lblBPartner=null;this.lblProduct=null;this.lblDateFrom=null;this.lblDateTo=null;this.lblInvoice=null;this.lblReceipt=null;this.lblMatched=null;this.lblMatchedTo=null;this.lblDifference=null;this.lblStatusInfo=null;this.lblStatusCount=null;this.lblSearch=null;this.cmbMatchFrom=null;this.cmbMatchTo=null;this.cmbMatchMode=null;this.chkIsReturnTrx=null;this.chkSameBPartner=null;this.chkSameProduct=null;this.chkSameQty=null;this.onlyVendor=null;this.onlyProduct=null;this.dtpFrom=null;this.dtpTo=null;this.btnSearch=null;this.btnProcess=null;this.btnToggel=null;this.txtMatched=null;this.txtMatchedTo=null;this.txtDifference=null;this.$root=null;this.$busyDiv=null;this.sideDiv=null;this.gridSelectDiv=null;this.gridInvoiceDiv=null;this.gridReciptDiv=null;this.processlDiv=null;this.bottumDiv=null;this.btnSpaceDiv=null;w=null;v=null;b=null;y=null;ut=null;ft=null;fi=null;ei=null;oi=null;o=null;f=null;u=null;k=null;wt=null;si=null;s=null;p=null;hi=null;l=null;d=null;i=null;r=null;h=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(t,i){this.frame=i;this.windowNo=t;n.Env.getCtx().setContext(this.windowNo,"IsSOTrx","Y");try{var r=this.Initialize()}catch(u){}this.frame.getContentGrid().append(this.getRoot());this.display();this.callConsolidate()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VMatch=i}(VIS,jQuery),function(n,t){function i(){function dt(){var k,d;setBusy(!0);v.setValue(!0);k=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";l=t("<div id='sideDiv_"+i.windowNo+"' style='float: left; margin-left: 0px; width:260px;height: 90%'>");w=t("<div id='btnSpaceDiv_"+i.windowNo+"' style='width: 260px; height: 45px;float: left;padding-left: 11px; padding-top: 11px;background-color: #F1F1F1;   margin-bottom: 1px;'><button id='btnSpace_"+i.windowNo+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+k+"' /><\/button><\/div><\/div>");b=t("<div style='float: left; width: 100%;background-color: #F1F1F1;height:"+vt+"px ' id='parameterDiv_"+i.windowNo+"'>");l.append(w).append(b);k=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";u=t("<button id='btnRefresh_"+i.windowNo+"' style='margin-bottom: 1px; margin-top: 0px; float: left;margin-left: 15px;height: 38px; ' class='VIS_Pref_btn-2'><img src='"+k+"'><\/button>");y=t("<input id='btnCreateCharge_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px;margin-top: 1px; float: right; margin-right:10px; height:38px;' type='button' value='"+n.Msg.getMsg("CreateNew",!1,!1)+"'>");a=t("<input id='btnCancel_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 1px; float: right;margin-right:5px; width:70px; height:38px;' type='button' value='"+n.Msg.getMsg("Cancel",!1,!1)+"'>");c=t("<input id='btnAccount_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px;margin-top: 1px; float:right; margin-right: 0px; height:38px;' type='button' value='"+n.Msg.getMsg("ChargeFromAccount",!1,!1)+"'>");var o=t("<table style='width: 100%;'>"),r=t("<tr>"),e=t("<td style='padding: 4px 15px 2px;'>");b.append(o);o.append(r);r.append(e);e.append(nt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");e=t("<td style='padding: 4px 15px 2px;'>");o.append(r);r.append(e);e.append(s.getControl().css("display","inline-block").css("width","236px").css("height","30px"));r=t("<tr>");e=t("<td style='padding: 4px 15px 2px;'>");o.append(r);r.append(e);e.append(tt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));r=t("<tr>");e=t("<td style='padding: 0px 15px 0px;'>");o.append(r);r.append(e);e.append(h.getControl().css("display","inline-block").css("width","236px").css("height","30px"));r=t("<tr>");e=t("<td style='padding: 4px 15px 2px;'>");o.append(r);r.append(e);e.append(v.getControl().css("height","30px"));rt=t("<div style='width: 100%; height: 45px; float: left; background-color: #F1F1F1;'>");d=t("<div style='width: 100%; float: right; text-align: right; margin-bottom: 0px;'>");d.append(c).append(a);rt.append(y).append(u);f=t("<div id='rightSideGridDiv_"+i.windowNo+"' style='height: 98%; float: right;  margin-left: 15px;margin-right: 15px;'>");f.css("width",ft);it=t("<div id='gridDiv_"+i.windowNo+"' style=' float: left; border: 1px solid rgb(169, 169, 169); width: 100%;margin-top: 1px;height:"+(b.height()+45)+"px'>");f.append(it);f.append(d);l.append(rt);p.append(st);p.append(l).append(f)}function gt(u){r!=null&&(r.destroy(),r=null);o.length==0&&(o.push({field:"C_ElementValue_ID",caption:n.Msg.getMsg("C_ELEMENTVALUE_ID"),sortable:!0,size:"16%",min:150,hidden:!0}),o.push({field:"Value",caption:n.Msg.getMsg("SearchKey"),sortable:!0,size:"25%",min:150,hidden:!1}),o.push({field:"Name",caption:n.Msg.getMsg("Name"),sortable:!0,size:"25%",min:150,hidden:!1}),o.push({field:"Expense",caption:n.Msg.getMsg("Expense"),sortable:!0,size:"25%",min:150,hidden:!1,editable:{type:"checkbox"}}));w2utils.encodeTags(u);r=t(it).w2grid({name:"gridAccountElement"+i.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:o,records:u})}function lt(){var r=[];d=n.Env.getCtx().getContextAsInt("$C_AcctSchema_ID");ht=n.Env.getCtx().getAD_Client_ID();ct=n.Env.getCtx().getAD_Org_ID();t.ajax({url:n.Application.contextUrl+"VCharge/VChargeLodGrideData",dataType:"json",data:{mcAcctSchemaID:d,mADClientId:ht},success:function(n){var e,u,f,t,i;if(n.result.meID!=0){if(n.result&&n.result.VchargeMCElemTaxCatID){if(e=n.result.VchargeMCElemTaxCatID,et=n.result.VchargeMCElemTaxCatID[0].mCElementID,et==0)return;ot=n.result.VchargeMCElemTaxCatID[0].mCTaxCategoryID}if(n.result&&n.result.VchargeCElementValue){for(u=n.result.VchargeCElementValue,f=1,t=0;t<u.length;t++)i={},i.C_ElementValue_ID=u[t].C_ElementValue_ID,i.Value=u[t].Value,i.Name=u[t].Name,i.Expense=u[t].Expense=="false"?!1:!0,i.recid=f,f++,r.push(i);gt(r);setBusy(!1)}}},error:function(n){setBusy(!1);i.log.info(n)}})}function ni(i,r,u,f,e){t.ajax({url:n.Application.contextUrl+"VCharge/CreateCharge",dataType:"json",data:{m_C_AcctSchema_ID:i,m_C_TaxCategory_ID:r,name:u,C_ElementValue_ID:f,expense:e},success:function(t){if(t.ID==0){n.ADialog.info("ChargeNotCreated",!0,null);setBusy(!1);return}s.ctrl.val("");h.ctrl.val("");var i=t.ID;n.ADialog.info("ChargeCreated",!0,null);lt()}})}function ti(i,r,u,f,e){t.ajax({url:n.Application.contextUrl+"VCharge/CreateChargeByList",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({AcctSchemaID:i,TaxCategoryID:r,namepara:u,ElementValuID:f,expense:e}),success:function(t){t.listCreatedP&&n.ADialog.info("ChargeCreated",!0,null);t.listRejectedP&&n.ADialog.info("ChargeNotCreated",!0,null);setBusy(!1)}})}this.frame;this.windowNo;var i=this,o=[],r=null;this.log=n.Logging.VLogger.getVLogger("VCharge");var yt=!1,pt=!1,g=!1,nt=new n.Controls.VLabel(n.Msg.getMsg("SearchKey",!1,!1),"SearchKey",!1,!0),tt=new n.Controls.VLabel(n.Msg.getMsg("Name",!1,!1),"Name",!1,!0),s=new n.Controls.VTextBox("SearchKey",!0,!1,!0,50,100,null,null,!1),h=new n.Controls.VTextBox("Name",!1,!1,!0,50,100,null,null,!1),v=new n.Controls.VCheckBox("Expense",!1,!1,!0,n.Msg.getMsg("Expense",!1,!1),null),wt=new n.Controls.VCheckBox("SelectAll",!1,!1,!0,n.Msg.getMsg("SelectAll",!1,!1),null),y=null,c=null,bt=new n.Controls.VLabel;this.log=n.Logging.VLogger.getVLogger("VCharge");var p=t("<div style='width: 100%; height: 100%; background-color: white; '>"),st=t("<div class='vis-apanel-busy' style='width:100%;height:100%;z-index: 1'>"),l=null,f=null,w=null,b=null,it=null,rt=null,a=null,u=null,e=null,k=260,ut=50,ft=t(window).width()-(k+30),at=t(window).width()-(30+ut),kt=ft+k+5,vt=t(window).height()-210,et=0,d=0,ot=0,ht=0,ct=0;setBusy=function(n){st.css("display",n?"block":"none")};this.Initialize=function(){if(dt(),e=p.find("#btnSpace_"+i.windowNo),a!=null)a.on(n.Events.onTouchStartOrClick,function(){i.dispose()});if(u!=null)u.on(n.Events.onTouchStartOrClick,function(){s.ctrl.val("");h.ctrl.val("");setBusy(!0);lt()});if(e!=null)e.on(n.Events.onTouchStartOrClick,function(){g?(y.show(),u.show(),nt.getControl().show(),tt.getControl().show(),s.getControl().show(),h.getControl().show(),v.getControl().show(),e.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),g=!1,f.animate({width:ft},"slow"),w.animate({width:k},"slow"),l.animate({width:k},"slow",null,function(){r.resize()})):(y.hide(),u.hide(),nt.getControl().hide(),tt.getControl().hide(),s.getControl().hide(),h.getControl().hide(),v.getControl().hide(),e.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),g=!0,w.animate({width:ut},"slow"),l.animate({width:ut},"slow"),f.animate({width:at},"slow",null,function(){r.resize()}))});if(c!=null)c.on(n.Events.onTouchStartOrClick,function(){var i,t,n;setBusy(!0);var u=[],f=[],e=[];if(r){if(i=r.getSelection(),!i){setBusy(!1);return}if(i.length<=0){setBusy(!1);return}for(t=i.toString().split(","),n=0;n<t.length;n++)u[n]=r.get(t[n]).C_ElementValue_ID,f[n]=r.get(t[n]).Name,e[n]=r.get(t[n]).Expense;if(u.length==0)return setBusy(!1),"";ti(d,ot,f,u,e)}});if(y!=null)y.on(n.Events.onTouchStartOrClick,function(){var u,f,r;if(setBusy(!0),u=v.getValue(),f=s.getValue().trim(),f.length==0){n.ADialog.warn("SearchKeyMandatory",!0,null);setBusy(!1);return}if(r=h.getValue().trim(),r.length==0){n.ADialog.warn("NameMandatory",!0,null);setBusy(!1);return}t.ajax({url:n.Application.contextUrl+"VCharge/CreateElementValue",dataType:"json",data:{m_AD_Org_ID:ct,value:f,name:r,expense:u,m_C_Element_ID:et},success:function(t){if(t.ID==0){i.log.saveError("ChargeNotCreated",t.Msg);n.ADialog.warn(t.Msg,!0,null);setBusy(!1);return}ni(d,ot,r,t.ID,u)}})})};this.display=function(){setTimeout(lt(),5)};this.getRoot=function(){return p};this.disposeComponent=function(){a&&a.off(n.Events.onTouchStartOrClick);u&&u.off(n.Events.onTouchStartOrClick);e&&e.off(n.Events.onTouchStartOrClick);c&&c.off(n.Events.onTouchStartOrClick);i.windowNo=null;o=null;r=null;yt=null;pt=null;g=null;nt=null;tt=null;s=null;h=null;v=null;wt=null;btnCreateCharg=null;c=null;bt=null;i.log=null;p=null;st=null;l=null;f=null;w=null;b=null;it=null;rt=null;a=null;u=null;e=null;k=null;ut=null;ft=null;at=null;kt=null;vt=null;et=null;d=null;ot=null;ht=null;ct=null;i=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.display()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VCharge=i}(VIS,jQuery),function(n,t){function i(){function ti(){var p,k;setBusy(!0);p=n.Application.contextUrl+"Areas/VIS/Images/base/arrow-left.png";h=t("<div id='sideDiv_"+i.windowNo+"' style='float: left; margin-left: 0px; width:260px;height: 90%'>");v=t("<div id='btnSpaceDiv_"+i.windowNo+"' style='width: 260px; height: 45px;float: left;padding-left: 11px; padding-top: 11px;background-color: #F1F1F1;   margin-bottom: 1px;'><button id='btnSpace_"+i.windowNo+"' style='border: 0px;background-color: transparent; padding: 0px;' ><img src='"+p+"' /><\/button><\/div><\/div>");c=t("<div style='float: left; width: 100%;background-color: #F1F1F1;height:"+at+"px ' id='parameterDiv_"+i.windowNo+"'>");h.append(v).append(c);p=n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png";f=t("<button id='btnRefresh_"+i.windowNo+"' style='margin-bottom: 1px; margin-top: 0px; float: right;margin-right: 10px;height: 38px; ' class='VIS_Pref_btn-2'><img src='"+p+"'><\/button>");l=t("<input id='btnOk_"+i.windowNo+"' class='VIS_Pref_btn-2' style='margin-bottom: 1px; margin-top: 1px; float: right;margin-right: 5px ;width: 70px;height: 38px;' type='button' value='"+n.Msg.getMsg("OK",!1,!1)+"'>");var y=t("<table style='width: 100%;'>"),u=t("<tr>"),s=t("<td style='padding: 4px 15px 2px;'>");c.append(y);y.append(u);u.append(s);s.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");s=t("<td style='padding: 4px 15px 2px;'>");y.append(u);u.append(s);s.append(b.getControl().css("display","inline-block").css("width","236px").css("height","30px"));u=t("<tr>");s=t("<td style='padding: 4px 15px 2px;'>");y.append(u);u.append(s);s.append(w.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");s=t("<td style='padding: 0px 15px 0px;'>");y.append(u);u.append(s);s.append(rt.getControl().css("display","inline-block").css("width","236px").css("height","30px"));u=t("<tr>");s=t("<td style='padding: 4px 15px 2px;'>");y.append(u);u.append(s);s.append(dt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");s=t("<td style='padding: 0px 15px 0px;'>");y.append(u);u.append(s);s.append(ut.getControl().css("display","inline-block").css("width","236px").css("height","30px"));u=t("<tr>");s=t("<td style='padding: 4px 15px 2px;'>");y.append(u);u.append(s);s.append(gt.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"));u=t("<tr>");s=t("<td style='padding: 0px 15px 0px;'>");y.append(u);u.append(s);s.append(ft.getControl().css("display","inline-block").css("width","236px").css("height","30px"));g=t("<div style='width: 100%; height: 45px; float: left; background-color: #F1F1F1;'>");k=t("<div style='width: 100%; float: right; text-align: right; margin-bottom: 0px;'>");k.append(l);g.append(f);o=t("<div id='rightSideGridDiv_"+i.windowNo+"' style='height: 98%; float: right;  margin-left: 15px;margin-right: 15px;'>");o.css("width",tt);d=t("<div id='gridDiv_"+i.windowNo+"' style=' float: left; border: 1px solid rgb(169, 169, 169); width: 100%;margin-top: 1px;height:"+(c.height()+45)+"px'>");d.append(e);o.append(d);o.append(k);h.append(g);a.append(et);a.append(h).append(o)}function ii(){st.push({Key:"0",Name:n.Msg.getMsg("ModeView",!1,!1)});ui();ri()}function ri(){t.ajax({url:n.Application.contextUrl+"Common/GetDataQueryAttribute",type:"GET",dataType:"json",async:!1,success:function(n){if(n.lst){u=n.lst;for(var t=0;t<u.length;t++)vt(b.getControl(),u[t].GetKeyNamePair,t),vt(rt.getControl(),u[t].GetKeyNamePair,t)}n.priceList&&ot(ut.getControl(),n.priceList);n.whList&&ot(ft.getControl(),n.whList);setBusy(!1)}})}function ui(){ot(k.getControl(),st)}function ot(n,t){for(var i=0;i<t.length;i++)n.append(" <option selected value='"+t[i].Key+"' >"+t[i].Name+"<\/option>");n.prop("selectedIndex",0)}function vt(n,t,i){i==0&&n.append(" <option selected value='0' ><\/option>");n.append(" <option selected value='"+t.Key+"' >"+t.Name+"<\/option>");n.prop("selectedIndex",0)}function fi(i,r){var s,h,o,f,u;for(r=r<2?2:r,i+=1,row=0;row<i;row++)for(s=t("<tr id='row_"+row+"' >"),e.append(s),col=0;col<r;col++)h=t("<td id='col_"+col+"'  style='padding: 4px 15px 2px;'>"),s.append(h);o=new n.Controls.VLabel;o.getControl().text("Mode");f=e.find("#row_0");r==2?(u=f.find("#col_"+(r-1)),u.append(k.getControl().css("display","inline-block").css("width","236px").css("height","30px")),u=f.find("#col_"+(r-2)),u.append(o.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))):(u=f.find("#col_2"),u.append(k.getControl().css("display","inline-block").css("width","236px").css("height","30px")),u=f.find("#col_1"),u.append(o.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font")))}function ei(r,u){var f=0,e=0,o=0,s=0;r&&(f=r.GetM_Attribute_ID,e=r.GetM_AttributeValue_ID);u&&(o=u.GetM_Attribute_ID,s=u.GetM_AttributeValue_ID);t.ajax({url:n.Application.contextUrl+"Common/GetGridElement",dataType:"json",data:{xM_Attribute_ID:f,xM_AttributeValue_ID:e,yM_Attribute_ID:o,yM_AttributeValue_ID:s,M_PriceList_Version_ID:ht,M_Warehouse_ID:ct,windowNo:i.windowNo},async:!1,success:function(){setBusy(!1)}})}function oi(){var h,c,a,t,f,p,w;if(b!=null&&!it){if(h=b.getControl()[0].selectedIndex,c=rt.getControl()[0].selectedIndex,h==c){i.log.warning("Same Attribute Selected");return}it=!0;ht=ut.getControl().find("option:selected").val();ct=ft.getControl().find("option:selected").val();var v=2,o=[],s=[],l=null,y=null;for(h>0&&(o=u[h-1].GetMAttributeValues),o!=null&&(v=o.length+1,i.log.info("X - "+u[h-1].GetName+" #"+o.length)),a=2,c>0&&(s=u[c-1].GetMAttributeValues),s.length>0&&(a=s.length+1,i.log.info("Y - "+u[c-1].GetName+" #"+s.length)),i.log.info("Rows="+a+" - Cols="+v),fi(a,v),t=null,f=null,row=0;row<a;row++)for(col=0;col<v;col++)o!=null&&(l=o[col]),s!=null&&(y=s[row]),row==0&&col==0?(p=new n.Controls.VLabel,w=new n.Controls.VLabel,o!=null&&(p.getControl().text(u[h-1].GetName),t=e.find("#row_1"),f=t.find("#col_"+col),f.append(p.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))),s.length>0&&(w.getControl().text(u[c-1].GetName),t=e.find("#row_1"),f=t.find("#col_"+col),f.append(w.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))),l!=null&&(r=new n.Controls.VLabel,r.getControl().text(l.Name),t=e.find("#row_1"),f=t.find("#col_"+(col+1)),f.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font")))):row==0?l!=null&&(r=new n.Controls.VLabel,r.getControl().text(l.Name),t=e.find("#row_1"),f=t.find("#col_"+(col+1)),f.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))):col==0?y!=null&&(r=new n.Controls.VLabel,r.getControl().text(y.Name),t=e.find("#row_"+row+1),f=t.find("#col_"+col),f.append(r.getControl().css("display","inline-block").addClass("VIS_Pref_Label_Font"))):ei(l,y,col,row+1);it=!1}}function si(){var n=k.getControl().find("option:selected").val();n!=bt&&n!=kt&&n==wt}this.frame;this.windowNo;var i=this,yt=!1,pt=!1,p=!1,it=!1,st=[],wt=0,bt=0,kt=0,ht=0,ct=0,u=[],r=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_Attribute_ID"),"M_Attribute_ID",!1,!0),w=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_Attribute_ID"),"M_Attribute_ID",!1,!0),dt=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_PriceList_ID"),"M_PriceList_ID",!1,!0),gt=new n.Controls.VLabel(n.Msg.getElement(n.Env.getCtx(),"M_Warehouse_ID"),"M_Warehouse_ID",!1,!0),hi=new n.Controls.VLabel(n.Msg.getMsg("Mode",!1,!1),"Mode",!1,!0),b=new n.Controls.VComboBox("",!1,!1,!0),rt=new n.Controls.VComboBox("",!1,!1,!0),ut=new n.Controls.VComboBox("",!1,!1,!0),ft=new n.Controls.VComboBox("",!1,!1,!0),k=new n.Controls.VComboBox("",!1,!1,!0);this.log=n.Logging.VLogger.getVLogger("VAttributeGrid");var a=t("<div class='vis-forms-container' style='width: 100%; height: 100%; background-color: white; '>"),et=t("<div class='vis-apanel-busy' style='width:100%;height:100%;z-index: 1'>"),h=null,o=null,v=null,c=null,d=null,g=null,l=null,f=null,s=null,y=260,nt=50,tt=t(window).width()-(y+30),lt=t(window).width()-(30+nt),ni=tt+y+5,at=t(window).height()-210,e=t("<table style='width: 100%;'>");setBusy=function(n){et.css("display",n?"block":"none")};this.Initialize=function(){if(ti(),s=a.find("#btnSpace_"+i.windowNo),l!=null)l.on(n.Events.onTouchStartOrClick,function(){si();i.dispose()});if(f!=null)f.on(n.Events.onTouchStartOrClick,function(){setBusy(!0);e.empty();oi();setBusy(!1)});if(s!=null)s.on(n.Events.onTouchStartOrClick,function(){p?(f.show(),r.getControl().show(),w.getControl().show(),s.animate({borderSpacing:0},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),p=!1,o.animate({width:tt},"slow"),c.css("display","block"),v.animate({width:y},"slow"),h.animate({width:y},"slow")):(f.hide(),r.getControl().hide(),w.getControl().hide(),s.animate({borderSpacing:180},{step:function(n){t(this).css("-webkit-transform","rotate("+n+"deg)");t(this).css("-moz-transform","rotate("+n+"deg)");t(this).css("transform","rotate("+n+"deg)")},duration:"slow"},"linear"),p=!0,o.animate({width:lt},"slow"),h.animate({width:nt},"slow"),v.animate({width:nt},"slow"),c.css("display","none"))})};this.display=function(){setTimeout(ii(),5)};this.getRoot=function(){return a};this.disposeComponent=function(){l&&l.off(n.Events.onTouchStartOrClick);f&&f.off(n.Events.onTouchStartOrClick);s&&s.off(n.Events.onTouchStartOrClick);i.windowNo=null;yt=null;pt=null;p=null;r=null;w=null;i.log=null;a=null;et=null;h=null;o=null;v=null;c=null;d=null;g=null;l=null;f=null;s=null;y=null;nt=null;tt=null;lt=null;ni=null;at=null;i=null;this.getRoot=null;this.disposeComponent=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.display()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VAttributeGrid=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function r(){function dt(){v=t("<div>");v.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1","z-index":"9999999"});v[0].style.visibility="hidden";b.append(v)}function o(n){v[0].style.visibility=n?"visible":"hidden"}function gt(){var f=t(window).height()*(94/100),i,u;k=t("<div class='vis-mainContainer' style='height:"+f+"px !important'>");i=" <div class='vis-pSelectInfo'> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_BankAccount_ID")+" <\/label> <select id='VIS_cmbBankAccount_"+r.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.getMsg("CurrentBalance")+" <\/label> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrentBal_"+r.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_BPartner_ID")+" <\/label> <select id='VIS_cmbbusinessPartner_"+r.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label style='width:100%;'>"+n.Msg.translate(n.Env.getCtx(),"PayDate")+" <\/label> <input  id='VIS_cmbPayDate_"+r.windowNo+"'type='date'> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"PaymentRule")+" <\/label> <select id='VIS_cmbPaymentMethod_"+r.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.getMsg("PaymentAmount")+" <\/label> <input type='number' id='VIS_txtPaymentAmount_"+r.windowNo+"' disabled MaxLength='50'><\/input> <\/div> <div class='vis-paymentselect-field'> <input type='checkbox' id='VIS_chkOnlyDue_"+r.windowNo+"' style='height: 15px;width: auto;'><\/input> <label for='VIS_chkOnlyDue_"+r.windowNo+"'>"+n.Msg.getMsg("OnlyDue")+" <\/label> <div class='vis-paymentselect-field'> <div class='vis-paymentselect-field'> <label for='VIS_lblShowDetail_"+r.windowNo+"'><\/label> <div class='vis-paymentselect-field'> <button class='VIS_Pref_btn-2' disabled id='VIS_btnRefresh_"+r.windowNo+"' style='margin-top: 5px;margin-bottom: -10px;'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png'><\/button> <\/div> <\/div>";d=t("<div class='vis-pSelectIionGrid'>");u=" <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_"+r.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;height:40px;margin-left:10px;' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnOK_"+r.windowNo+"' disabled style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("OK")+"' ><\/input> <\/div> <\/div>";k.append(t(i)).append(d).append(t(u));b.append(k);ni()}function ni(){f=t("#VIS_cmbBankAccount_"+r.windowNo);s=t("#VIS_cmbbusinessPartner_"+r.windowNo);h=t("#VIS_cmbPaymentMethod_"+r.windowNo);tt=t("#VIS_txtCurrentBal_"+r.windowNo);p=t("#VIS_chkOnlyDue_"+r.windowNo);a=t("#VIS_txtPaymentAmount_"+r.windowNo);ut=t("#VIS_lblShowDetail_"+r.windowNo);w=t("#VIS_btnRefresh_"+r.windowNo);y=t("#VIS_cmbPayDate_"+r.windowNo);g=t("#VIS_btnOK_"+r.windowNo);it=t("#VIS_btnCancel_"+r.windowNo);var n=new Date,i=("0"+n.getDate()).slice(-2),u=("0"+(n.getMonth()+1)).slice(-2),e=n.getFullYear()+"-"+u+"-"+i;y.val(e);ft();ti();ri();l.BankAccount.length>0&&et()}function ti(){w.on("click",function(){o(!0);ei()&&window.setTimeout(function(){ii();o(!1)},20)});g.on("click",function(){var t,i;if(e.getSelection().length<=0)return n.ADialog.info("PleaseSelectRecord"),!1;if(t=e.getSelection(),t.length>0){for(i=0;i<t.length;i++)rt[t[i]].SELECT=!0;o(!0);window.setTimeout(function(){oi()},20)}});it.on("click",function(){r.dispose()});f.on("change",function(){o(!0);window.setTimeout(function(){fi();et();o(!1)},20)});p.on("click",function(){w.trigger("click")})}function ft(){try{e!=null&&(e.destroy(),e=null)}catch(t){}u.length==0&&(u.push({field:"SELECT",caption:n.Msg.getMsg("SELECT"),sortable:!0,size:"100px",hidden:!0}),u.push({field:"C_INVOICE_ID",caption:n.Msg.getMsg("Invoice"),sortable:!0,size:"100px"}),u.push({field:"DUEDATE",caption:n.Msg.getMsg("DueDate"),sortable:!0,size:"100px"}),u.push({field:"BUSINESSPARTNER",caption:n.Msg.getMsg("BusinessPartner"),sortable:!0,size:"100px"}),u.push({field:"DOCUMENTNO",caption:n.Msg.getMsg("Document_No"),sortable:!0,size:"100px"}),u.push({field:"CURRENCY",caption:n.Msg.getMsg("Currency"),sortable:!0,size:"100px"}),u.push({field:"GRANDTOTAL",caption:n.Msg.getMsg("GrandTotal"),sortable:!0,size:"100px"}),u.push({field:"DISCOUNTAMOUNT",caption:n.Msg.getMsg("DiscountAmt"),sortable:!0,size:"100px"}),u.push({field:"DISCOUNTDATE",caption:n.Msg.getMsg("DiscountDate"),sortable:!0,size:"100px"}),u.push({field:"AMOUNTDUE",caption:n.Msg.getMsg("AmountDue"),sortable:!0,size:"100px"}),u.push({field:"PAYMENTAMOUNT",caption:n.Msg.getMsg("PaymentAmount"),sortable:!0,size:"100px"}));e=d.w2grid({name:"gridPaymentSelection_"+r.windowNo,recordHeight:40,show:{selectColumn:!0},multiSelect:!0,columns:u,records:c});e.on("select",function(t){nt+=n.Utility.Util.getValueOfDecimal(c[t.index].PAYMENTAMOUNT);a.val(nt);var i=e.getSelection();g.removeAttr("disabled")});e.on("unselect",function(t){nt-=n.Utility.Util.getValueOfDecimal(c[t.index].PAYMENTAMOUNT);a.val(nt);var i=e.getSelection()})}function ii(){var u,r,e;c=[];u=0;r=[];r.push(f.val());l!=null?(e=jQuery.grep(l.BankAccount,function(t){return t.ID==n.Utility.Util.getValueOfInt(f.val())}),e.length>0?r.push(e[0].Currency_ID):r.push(0)):r.push(0);r.push(s.val());r.push(y.val());r.push(h.val());r.push(a.val());r.push(p.prop("checked"));t.ajax({url:n.Application.contextUrl+"VPaySelect/GetGridRecords",async:!1,datatype:"Json",type:"POST",cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(r),success:function(n){var t=JSON.parse(n),r;if(c=[],t!=null||t!=undefined)for(rt=t,i=0;i<t.length;i++)r={},r.SELECT=t[i].SELECT,r.C_INVOICE_ID=t[i].C_INVOICE_ID,r.DUEDATE=t[i].DUEDATE,r.BUSINESSPARTNER=t[i].BUSINESSPARTNER,r.DOCUMENTNO=t[i].DOCUMENTNO,r.CURRENCY=t[i].CURRENCY,r.GRANDTOTAL=t[i].GRANDTOTAL,r.DISCOUNTAMOUNT=t[i].DISCOUNTAMOUNT,r.DISCOUNTDATE=t[i].DISCOUNTDATE,r.AMOUNTDUE=t[i].AMOUNTDUE,r.PAYMENTAMOUNT=t[i].PAYMENTAMOUNT,r.recid=u,u++,c.push(r)},error:function(n){console.log(n)}});ft()}function ri(){t.ajax({url:n.Application.contextUrl+"VPaySelect/GetDetail",async:!1,datatype:"Json",type:"GET",cache:!1,success:function(n){var t=JSON.parse(n);l=t;(t!=null||t!=undefined)&&t.BankAccount.length>0&&(w.removeAttr("disabled"),ui(t));o(!1)},error:function(n){console.log(n);o(!1)}})}function ui(n){var i;if(n.BankAccount!=null||n.BankAccount.length>0){f.empty();for(i in n.BankAccount)f.append(t('<Option value="'+n.BankAccount[i].ID+'">'+n.BankAccount[i].Value+"<\/option>"))}if(n.BusinessPartner!=null||n.BusinessPartner.length>0){s.empty();s.append(t('<Option value="-1"><\/option>'));for(i in n.BusinessPartner)s.append(t('<Option value="'+n.BusinessPartner[i].ID+'">'+n.BusinessPartner[i].Value+"<\/option>"))}if(n.PaymentMethod!=null||n.PaymentMethod.length>0){h.empty();for(i in n.PaymentMethod)h.append(t('<Option value="'+n.PaymentMethod[i].ID+'">'+n.PaymentMethod[i].Value+"<\/option>"))}o(!1)}function fi(){t.ajax({url:n.Application.contextUrl+"VPaySelect/GetPaymentMethod",async:!1,datatype:"Json",type:"GET",cache:!1,data:{C_BankAccount_ID:parseInt(f.val())},success:function(n){var i=JSON.parse(n),r;if((i!=null||i!=undefined)&&(i!=null||i.length>0)){h.empty();for(r in i)h.append(t('<Option value="'+i[r].ID+'">'+i[r].Value+"<\/option>"))}},error:function(n){console.log(n)}})}function et(){var t=jQuery.grep(l.BankAccount,function(t){return t.ID==n.Utility.Util.getValueOfInt(f.val())});t.length>0&&tt.val(t[0].CurrentBalance+" "+t[0].ISOCode)}function ei(){return s!=null&&s.val()<=0?(n.ADialog.info("SelectBusinessPartnerFirst"),o(!1),!1):!0}function oi(){var i=[],u;i.push(f.val());l!=null?(u=jQuery.grep(l.BankAccount,function(t){return t.ID==n.Utility.Util.getValueOfInt(f.val())}),i.push(u[0].Currency_ID)):i.push(0);i.push(s.val());i.push(y.val());i.push(h.val());i.push(a.val());i.push(p.prop("checked"));i.push(JSON.stringify(rt));t.ajax({url:n.Application.contextUrl+"VPaySelect/GeneratePaymentSelection",async:!1,datatype:"Json",type:"POST",cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(i),success:function(t){var f=JSON.parse(t),i,u;(f!=null||f!=undefined)&&(r.dispose(),i=new n.CFrame,u=new n.Apps.AForms.VPayPrint,i.setName(n.Msg.getMsg("Payment Print/Export")),i.setTitle(n.Msg.getMsg("Payment Print/Export")),i.hideHeader(!1),i.setContent(u),i.show(),u.initialize())},error:function(n){console.log(n)}})}this.windowNo;var b=t("<div style='width: 100%; height: 100%; background-color: white;'>"),r=this,k=null,ot=null,st=null,ht=null,ct=null,lt=null,at=null,vt=null,d=null,yt=null,pt=null,wt=null,bt=null,f=null,s=null,h=null,y=null,kt=null,p=null,tt=null,ut=null,a=null,u=[],e=null,w=null,g=null,it=null,c=[],rt=null,l=null,nt=0,v=null;this.initialize=function(){dt();o(!0);window.setTimeout(function(){gt()},20)};this.getRoot=function(){return b};this.disposeComponent=function(){windowNo=null;b=null;r=this;k=null;ot=null;st=null;ht=null;ct=null;lt=null;at=null;vt=null;d=null;yt=null;pt=null;wt=null;bt=null;f=null;s=null;h=null;y=null;kt=null;p=null;tt=null;ut=null;a=null;u=null;e=null;w=null;g=null;it=null;c=null}}n.Apps.AForms=n.Apps.AForms||{};r.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};r.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VPaySelect=r}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(){function ut(){s=t("<div>");s.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1","z-index":"9999999"});s[0].style.visibility="hidden";c.append(s)}function r(n){s[0].style.visibility=n?"visible":"hidden"}function ft(){a=t("<div class='vis-mainContainer'>");var r=" <div class='vis-pPrintInfo'> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_PaySelection_ID")+" <\/label> <div class='vis-paymentPrintChk-field'> <input type='checkbox' id='VIS_chkShowPrintPayment_"+i.windowNo+"' style='height: 15px;width: auto;'><\/input> <label for='VIS_chkOnlyDue_"+i.windowNo+"'>"+n.Msg.getMsg("ShowPrintedPayments")+" <\/label> <\/div> <select id='VIS_PaySelection_"+i.windowNo+"' style='background-position: 99%;'><\/select> <\/div> <div class='vis-paymentPrint-field' style='margin-right:24px;'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_BankAccount_ID")+" <\/label> <input type='text' name='vis-name vis-fieldreadonly' style='background: #f8f8f8 !important;' disabled id='VIS_txtBankAccount_"+i.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentPrint-field'> <label>"+n.Msg.getMsg("CurrentBalance")+" <\/label> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrentBal_"+i.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentPrint-field' style='margin-right:24px;'> <label>"+n.Msg.translate(n.Env.getCtx(),"PaymentRule")+" <\/label> <select name='vis-name' id='VIS_cmbPaymentMethod_"+i.windowNo+"'><\/select> <\/div> <div class='vis-paymentPrint-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Currency_ID")+" <\/label> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtCurrency_"+i.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentPrint-field' style='margin-right:24px;'> <label>"+n.Msg.getMsg("CheckNo")+" <\/label> <input type='number' name='vis-name'  id='VIS_txtCheckNo_"+i.windowNo+"' MaxLength='50'><\/input> <\/div> <div class='vis-paymentPrint-field'> <label>"+n.Msg.getMsg("NoOfPayments")+" <\/label> <input type='text' class='vis-fieldreadonly' disabled id='VIS_txtNoOfPayments_"+i.windowNo+"' MaxLength='50'><\/input> <\/div> <\/div>",u=" <div class='vis-pPrintProcess'> <div class='vis-paymentPrint-field' style='float:right;'> <input id='VIS_btnCancel_"+i.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnPrint_"+i.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("Print")+"' ><\/input> <\/div> <\/div>";a.append(t(r)).append(t(u));c.append(a);ut();et()}function et(){u=t("#VIS_PaySelection_"+i.windowNo);p=t("#VIS_txtBankAccount_"+i.windowNo);w=t("#VIS_txtCurrentBal_"+i.windowNo);f=t("#VIS_cmbPaymentMethod_"+i.windowNo);b=t("#VIS_txtCurrency_"+i.windowNo);e=t("#VIS_txtCheckNo_"+i.windowNo);v=t("#VIS_txtNoOfPayments_"+i.windowNo);l=t("#VIS_chkShowPrintPayment_"+i.windowNo);l.attr("disabled",!0);k=t("#VIS_btnPrint_"+i.windowNo);d=t("#VIS_btnExport_"+i.windowNo);g=t("#VIS_btnCancel_"+i.windowNo);y(!0);st()}function y(i){var f=null;f=i?0:u.val();r(!0);t.ajax({url:n.Application.contextUrl+"VPayPrint/GetDetail",async:!1,datatype:"Json",type:"GET",cache:!1,data:{showPrintedPayment:l.prop("checked"),C_PaymentSelect_ID:f,isFirstTime:i},success:function(n){var t=JSON.parse(n);controlsData=t;(t!=null||t!=undefined)&&(ot(t),nt(),r(!1))},error:function(n){r(!1);console.log(n)}})}function nt(){t.ajax({url:n.Application.contextUrl+"VPayPrint/LoadPaymentRuleInfo",async:!1,datatype:"Json",type:"GET",cache:!1,data:{paymentMethod_ID:f.val(),C_PaySelection_ID:u.val(),m_C_BankAccount_ID:o,PaymentRule:f.text()},success:function(n){var t=JSON.parse(n);r(!1);(t!=null||t!=undefined)&&(e.val(t.CheckNo),v.val(t.NoOfPayments))},error:function(n){console.log(n)}})}function ot(i){var c,l,y,a,s;try{if(c=u.val(),l=0,i.PaymentSelection!=null||i.PaymentSelection.length>0){u.empty();for(s in i.PaymentSelection)u.append(t('<Option value="'+i.PaymentSelection[s].ID+'">'+i.PaymentSelection[s].Value+"<\/option>"))}if(c>0&&(u.val(c),y="VIS_135",a=[],a[0]=new n.DB.SqlParam("@pSelectID",c),l=n.Utility.Util.getValueOfInt(h(y,a))),i.PaymentMethod!=null||i.PaymentMethod.length>0){f.empty();for(s in i.PaymentMethod)f.append(t('<Option value="'+i.PaymentMethod[s].ID+'">'+i.PaymentMethod[s].Value+"<\/option>"))}l>0&&f.val(l);(i.PSelectInfo!=null||i.PSelectInfo.length>0)&&(p.val(i.PSelectInfo[0].BankAccount),e.val(i.PSelectInfo[0].CheckNo),w.val(i.PSelectInfo[0].CurrentBalance),b.val(i.PSelectInfo[0].Currency),v.val(i.PSelectInfo[0].NoOfPayments),o=i.PSelectInfo[0].BankAccount_ID)}catch(k){return n.ADialog.info("VPayPrintNoRecords"),r(!1),!1}if(u.val()==null)return n.ADialog.info("VPayPrintNoRecords"),!1}function st(){k.on("click",function(){tt()&&ht()});d.on("click",function(){tt()&&at()});g.on("click",function(){i.dispose()});u.on("change",function(){r(!0);window.setTimeout(function(){y(!1);r(!1)},20)});f.on("change",function(){r(!0);window.setTimeout(function(){nt();r(!1)},20)});l.on("click",function(){r(!0);window.setTimeout(function(){y(!1);r(!1)},20)})}function tt(){try{if(u==null||u.val()<=-1||o<=-1||f.val()<=-1||e.val().length<=0)return n.ADialog.info("VPayPrintNoRecords"),!1}catch(t){return n.ADialog.info("VPayPrintNoRecords"),!1}return!0}function ht(){r(!0);t.ajax({url:n.Application.contextUrl+"VPayPrint/Cmd_Print",async:!1,datatype:"Json",type:"GET",cache:!1,data:{paymentMethod_ID:f.val(),C_PaySelection_ID:u.val(),m_C_BankAccount_ID:o,PaymentRule:f.text(),checkNo:e.val()},success:function(t){r(!1);var u=JSON.parse(t);if(u!=null||u!=undefined)n.ADialog.confirm("ContinueCheckPrint?",!0,"","Confirm",function(n){n?(r(!0),window.setTimeout(function(){ct(u)},20)):i.dispose()});else return n.ADialog.info("VPayPrintNoRecords"),!1},error:function(n){console.log(n)}})}function ct(s){var l=s.check_ID[0],c=[];c.push(f.val());c.push(u.val());c.push(o);c.push(f.text());c.push(e.val());c.push(JSON.stringify(s.check_ID));c.push(JSON.stringify(s.m_batch));c.push(JSON.stringify(s.m_checks));t.ajax({url:n.Application.contextUrl+"VPayPrint/ContinueCheckPrint",async:!1,datatype:"Json",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(t){var f="VIS_152",s=[],c,l,a,e;s[0]=new n.DB.SqlParam("@BankAcct_ID",o);c=h(f,s);f="VIS_150";l=h(f);a=new n.APrint(c,l,parseInt(u.val()),i.windowNo);a.startPdf(null);r(!1);e=JSON.parse(t);(e!=null||e!=undefined)&&n.ADialog.confirm("VPayPrintPrintRemittance?",!0,"","Confirm",function(n){n?(r(!0),window.setTimeout(function(){lt(t)},20)):i.dispose()})},error:function(n){r(!1);console.log(n)}})}function lt(f){var e=JSON.parse(f);t.ajax({url:n.Application.contextUrl+"VPayPrint/VPayPrintRemittance",async:!1,datatype:"Json",type:"POST",contentType:"application/json; charset=utf-8",data:f,success:function(t){var l,f,o,s,c;r(!1);l=JSON.parse(t);e!=null||e!=undefined?(f="VIS_151",o=h(f),f="VIS_150",s=h(f),c=new n.APrint(o,s,parseInt(u.val()),i.windowNo),c.startPdf(null),i.dispose()):n.ADialog.info("PaymentNotProcessed")},error:function(n){console.log(n)}})}function at(){r(!0);t.ajax({url:n.Application.contextUrl+"VPayPrint/Cmd_Export",async:!1,datatype:"Json",type:"POST",cache:!1,data:{paymentMethod_ID:f.val(),C_PaySelection_ID:u.val(),m_C_BankAccount_ID:o,PaymentRule:f.text(),checkNo:e.val()},success:function(t){r(!1);var i=JSON.parse(t);if(i!=null||i!=undefined)n.ADialog.confirm("VPayPrintSuccess?",!0,"","Confirm",function(t){if(t){r(!0);window.setTimeout(function(){vt(i)},20);var u=n.Application.contextUrl+"TempDownload/"+i.filepath;window.open(u,"_blank")}});else return n.ADialog.info("VPayPrintNoRecords"),!1},error:function(n){console.log(n)}})}function vt(i){var u=[];u.push(JSON.stringify(i.check_ID));u.push(JSON.stringify(i.m_batch));u.push(JSON.stringify(i.m_checks));t.ajax({url:n.Application.contextUrl+"VPayPrint/VPayPrintSuccess",async:!1,datatype:"Json",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(u),success:function(n){r(!1);var t=JSON.parse(n);t!=null||t!=undefined},error:function(n){console.log(n)}})}function yt(n,i,r){var u=null;return t.ajax({url:rt,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}var h;this.windowNo=n.Env.getWindowNo();var c=t("<div style='width: 100%; height: 100%; background-color: white;'>"),i=this,a=null,u=null,p=null,w=null,f=null,b=null,e=null,v=null,l=null,k=null,d=null,g=null,o=null,s=null,it=n.Application.contextUrl,rt=it+"JsonData/JDataSetWithCode";this.initialize=function(){ft()};this.getRoot=function(){return c};h=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u=null;return i&&(e.param=i),yt(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u};this.lockUI=function(){};this.unlockUI=function(){};this.disposeComponent=function(){windowNo=null;c=null;i=this}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VPayPrint=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(){function ut(){c=t("<div>");c.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1","z-index":"9999999"});c[0].style.visibility="hidden";v.append(c)}function h(n){c[0].style.visibility=n?"visible":"hidden"}function ft(){var e=t(window).height()*(92/100),u,f;y=t("<div class='vis-mainContainer' style='height:"+e+"px !important'>");u=" <div class='vis-pBOMInfo'> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"M_Product_ID")+" <\/label> <select id='VIS_cmbProduct_"+i.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Invoice_ID")+" <\/label> <select id='VIS_cmbinvoice_"+i.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Order_ID")+" <\/label> <select id='VIS_cmbOrder_"+i.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"C_Project_ID")+" <\/label> <select id='VIS_cmbOpportunity_"+i.windowNo+"'><\/select> <\/div> <div class='vis-paymentselect-field'> <label>"+n.Msg.translate(n.Env.getCtx(),"Qty")+"<\/label> <input type='number' id='VIS_txtQuantity_"+i.windowNo+"' min='0' MaxLength='50'><\/input> <\/div> <div class='vis-paymentselect-field'> <button class='VIS_Pref_btn-2'  id='VIS_btnRefresh_"+i.windowNo+"' style='margin-top: 5px;margin-bottom: -10px;'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Refresh24.png'><\/button> <\/div> <\/div>";r=t("<div class='vis-BOMLines'>");f=" <div class='vis-pSelectProcess'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_"+i.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;height:40px;margin-left:10px;' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnOK_"+i.windowNo+"' disabled style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-top:10px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("OK")+"' ><\/input> <\/div> <\/div>";y.append(t(u)).append(r).append(t(f));v.append(y);et()}function et(){u=t("#VIS_cmbProduct_"+i.windowNo);f=t("#VIS_cmbinvoice_"+i.windowNo);e=t("#VIS_cmbOrder_"+i.windowNo);o=t("#VIS_cmbOpportunity_"+i.windowNo);a=t("#VIS_txtQuantity_"+i.windowNo);p=t("#VIS_btnCancel_"+i.windowNo);s=t("#VIS_btnOK_"+i.windowNo);w=t("#VIS_btnRefresh_"+i.windowNo);b();ot()}function ot(){w.on("click",function(){h(!0);r.empty();window.setTimeout(function(){b();h(!1)},20)});s.on("click",function(){lt()});p.on("click",function(){i.dispose()});u.on("change",function(){u.val()>0?s.removeAttr("disabled"):s.attr("disabled",!0);h(!0);window.setTimeout(function(){ht()},20)});f.on("change",function(){f.val()>0?(u.val()>0&&s.removeAttr("disabled"),e.attr("disabled",!0),o.attr("disabled",!0)):(s.attr("disabled",!0),e.removeAttr("disabled"),o.removeAttr("disabled"))});e.on("change",function(){e.val()>0?(u.val()>0&&s.removeAttr("disabled"),f.attr("disabled",!0),o.attr("disabled",!0)):(s.attr("disabled",!0),f.removeAttr("disabled"),o.removeAttr("disabled"))});o.on("change",function(){o.val()>0?(u.val()>0&&s.removeAttr("disabled"),e.attr("disabled",!0),f.attr("disabled",!0)):(s.attr("disabled",!0),e.removeAttr("disabled"),f.removeAttr("disabled"))});a.on("change",function(){for(var i,n=0;n<t(r[0]).children().length;n++)i=l[n].BOMQty,t(t(t(t(r[0]).children()[n]).children()[0]).children()[1]).attr("Value",i*a.val())})}function b(){t.ajax({url:n.Application.contextUrl+"VBOMDrop/GetDetail",async:!1,datatype:"Json",type:"GET",cache:!1,success:function(n){var t=JSON.parse(n);controlsData=t;(t!=null||t!=undefined)&&st(t);h(!1)},error:function(n){console.log(n);h(!1)}})}function st(n){var i;if(n.Product!=null||n.Product.length>0){u.empty();u.append(t('<Option value="-1"><\/option>'));for(i in n.Product)u.append(t('<Option value="'+n.Product[i].ID+'">'+n.Product[i].Value+"<\/option>"))}if(n.Invoice!=null||n.Invoice.length>0){f.empty();f.append(t('<Option value="-1"><\/option>'));for(i in n.Invoice)f.append(t('<Option value="'+n.Invoice[i].ID+'">'+n.Invoice[i].Value+"<\/option>"))}if(n.Order!=null||n.Order.length>0){e.empty();e.append(t('<Option value="-1"><\/option>'));for(i in n.Order)e.append(t('<Option value="'+n.Order[i].ID+'">'+n.Order[i].Value+"<\/option>"))}if(n.Opportunity!=null||n.Opportunity.length>0){o.empty();o.append(t('<Option value="-1"><\/option>'));for(i in n.Product)o.append(t('<Option value="'+n.Opportunity[i].ID+'">'+n.Opportunity[i].Value+"<\/option>"))}h(!1)}function ht(){a.val("");t.ajax({url:n.Application.contextUrl+"VBOMDrop/GetBOMLines",async:!1,datatype:"Json",type:"GET",cache:!1,data:{productID:parseInt(u.val())},success:function(n){var t=JSON.parse(n);controlsData=t;t!=null||t!=undefined?ct(t):r.empty();h(!1)},error:function(n){console.log(n);h(!1)}})}function ct(n){var e="",i;r.empty();var u="",f="";for(l=n,i=0;i<n.length;i++){e="";n[i].BOMType=="P"?(u="<input type='checkbox' checked disabled id='VIS_chkBOMLine_"+i+"' style='height: 15px;width: auto;'><\/input>",f="<input type='number' id='VIS_qtyBOMLine_"+i+"' style='background: pink;width:200%;' min='0' value='"+n[i].BOMQty+"'><\/input>"):n[i].BOMType=="O"?(u="<input type='checkbox' id='VIS_chkBOMLine_"+i+"' style='height: 15px;width: auto;'><\/input>",f="<input type='number' disabled id='VIS_qtyBOMLine_"+i+"' style='background: #FFF5FF;width:200%;'  min='0' value='"+n[i].BOMQty+"'><\/input>"):(u=" <input type='radio' name='vis-radiolist' checked id='VIS_chkBOMLine_"+i+"' style='height: 15px;width: auto;'><\/input>",f="<input type='number' id='VIS_qtyBOMLine_"+i+"' style='background: pink;width:200%;' min='0' value='"+n[i].BOMQty+"'><\/input>");e+="<div class='vis-bomlinesdata'> <div style='float:left;width: 50%;'> <label style='margin: 5px;width:100%;'>"+n[i].ProductName+"<\/label>"+f+" <\/div> <div style='float:right;'>"+u+" <label style='margin-right:5px;'>"+n[i].BOMTypeName+"<\/label> <\/div> <\/div>";r.append(t(e));t("#VIS_chkBOMLine_"+i).on("click",function(){var n=t(t(t(t(this).parent()).parent().children()[0]).children()[1]);t(this).prop("checked")?(n.css("background","pink"),n.removeAttr("disabled")):(n.css("background","#FFF5FF"),n.attr("disabled",!0))})}}function lt(){var c=[],s,a;for(c.push(u.val()),c.push(f.val()),c.push(e.val()),c.push(o.val()),s=0;s<t(r[0]).children().length;s++)a=t(t(t(t(r[0]).children()[s]).children()[1]).children()[0]).prop("checked"),a?(l[s].IsSelected=!0,l[s].BOMQty=t(t(t(t(r[0]).children()[s]).children()[0]).children()[1]).val()):l[s].IsSelected=!1;c.push(JSON.stringify(l));t.ajax({url:n.Application.contextUrl+"VBOMDrop/SaveRecord",async:!1,datatype:"Json",type:"POST",cache:!1,contentType:"application/json; charset=utf-8",data:JSON.stringify(c),success:function(t){JSON.parse(t)?i.dispose():n.ADialog.info("RecordNotSaved")},error:function(n){console.log(n);h(!1)}})}this.windowNo=null;var v=t("<div style='width: 100%; height: 100%; background-color: white;'>"),i=this,y=null,k=null,r=null,d=null,g=null,nt=null,tt=null,it=null,rt=null,u=null,f=null,e=null,o=null,a=null,s=null,p=null,c=null,l=[],w=null;this.initialize=function(){ut();h(!0);window.setTimeout(function(){ft()},20)};this.getRoot=function(){return v};this.disposeComponent=function(){v=null;i=null;y=null;k=null;r=null;d=null;g=null;nt=null;tt=null;it=null;rt=null;u=null;f=null;e=null;o=null;a=null;s=null;p=null;c=null;l=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VBOMDrop=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(){function at(){e=t("<div>");e.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1","z-index":"9999999"});e[0].style.visibility="hidden";o.append(e)}function l(n){e[0].style.visibility=n?"visible":"hidden"}function vt(){var ft=t(window).height()*(96/100),et=n.MLookupFactory.get(n.Env.getCtx(),0,0,n.DisplayType.TableDir,"AD_Org_ID",0,!1,null),tt,e,it,c,rt,f,y,p,w,b,k,d,g,nt,ut;a=new n.Controls.VComboBox("AD_Org_ID",!1,!1,!0,et,50);tt=n.MLookupFactory.get(n.Env.getCtx(),0,0,n.DisplayType.List,"MovementType",189,!1,null);v=new n.Controls.VComboBox("MovementType",!1,!1,!0,tt,29);e=t("<div><\/div>");it=n.MLookupFactory.get(n.context,0,0,n.DisplayType.Search,"M_Locator_ID",0,!1,"");u=new n.Controls.VTextBoxButton("M_Locator_ID",!1,!1,!0,n.DisplayType.Search,it);e.append(u.getControl());e.append(u.getBtn(0));e.append(u.getBtn(1));u.getControl().addClass("vis-lookupTextboxes");u.getBtn(0).addClass("vis-lookupButtons");u.getBtn(1).addClass("vis-lookupButtons");u.getBtn(0).css("height","30");u.getBtn(0).css("width","30");u.getBtn(1).css("width","30");u.getBtn(1).css("height","30");u.getBtn(0).css("padding","0px");u.getBtn(1).css("padding","0px");c=t("<div><\/div>");rt=n.MLookupFactory.get(n.context,0,0,n.DisplayType.Search,"M_Product_ID",0,!1,"");r=new n.Controls.VTextBoxButton("M_Product_ID",!1,!1,!0,n.DisplayType.Search,rt);c.append(r.getControl());c.append(r.getBtn(0));c.append(r.getBtn(1));r.getControl().addClass("vis-lookupTextboxes");r.getBtn(0).addClass("vis-lookupButtons");r.getBtn(1).addClass("vis-lookupButtons");r.getBtn(0).css("height","30");r.getBtn(0).css("width","30");r.getBtn(0).css("padding","0px");r.getBtn(1).css("height","30");r.getBtn(1).css("width","30");r.getBtn(0).css("padding","0px");r.getBtn(1).css("padding","0px");s=t("<div class='vis-mainContainer' style='height:"+ft+" !important'>");f=t("<div class='vis-pSelectInfo' style='height:76%;'>");y=t("<div class='vis-paymentselect-field'>");y.append(t("<label>"+n.Msg.translate(n.Env.getCtx(),"AD_Org_ID")+" <\/label>"));y.append(a.getControl());f.append(y);p=t("<div class='vis-paymentselect-field'>");p.append(t("<label>"+n.Msg.translate(n.Env.getCtx(),"MovementType")+" <\/label>"));p.append(v.getControl());f.append(p);w=t("<div class='vis-paymentselect-field'>");w.append(t("<label style='width:100%;'>"+n.Msg.translate(n.Env.getCtx(),"M_Locator_ID")+" <\/label>"));w.append(e);f.append(w);b=t("<div class='vis-paymentselect-field'>");b.append(t("<label style='width:100%;'>"+n.Msg.translate(n.Env.getCtx(),"Product")+" <\/label>"));b.append(c);f.append(b);k=t("<div class='vis-paymentselect-field'>");k.append(t("<label style='width:100%;'>"+n.Msg.translate(n.Env.getCtx(),"DateFrom")+" <\/label>"));k.append(t("<input  id='VIS_dtpFromDate"+i.windowNo+"'type='date'>"));f.append(k);d=t("<div class='vis-paymentselect-field'>");d.append(t("<label style='width:100%;'>"+n.Msg.translate(n.Env.getCtx(),"DateTo")+" <\/label>"));d.append(t("<input  id='VIS_dtpToDate"+i.windowNo+"'type='date'>"));f.append(d);g=t("<div class='vis-paymentselect-field' style='float:right;width:20%;'>");g.append(t("<button class='VIS_Pref_btn-2' id='VIS_btnRefresh_"+i.windowNo+"' style='margin-top: 5px;'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/requery.png'><\/button>"));f.append(g);nt=t("<div class='vis-paymentselect-field' style='float:right;width:20%;'>");nt.append(t("<button class='VIS_Pref_btn-2' id='VIS_btnZoom_"+i.windowNo+"' style='margin-top: 5px;margin-right: 10px;'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/zoom.png'><\/button>"));f.append(nt);h=t("<div class='vis-pSelectIionGrid'>");ut=" <div class='vis-pSelectProcess' style='float:none;'> <div class='vis-paymentselect-field'> <input id='VIS_btnCancel_"+i.windowNo+"' style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;height:40px;margin-left:10px;margin-right:5px;' type='submit' value='"+n.Msg.getMsg("Cancel")+"' ><\/input> <input id='VIS_btnOK_"+i.windowNo+"'  style='background-color:#616364;color: white;font-weight: 200;font-family: helvetica;font-size: 14px;padding: 10px 15px;float:right;width:100px;margin-left:10px;height:40px;' type='submit' value='"+n.Msg.getMsg("OK")+"' ><\/input> <\/div> <\/div>";s.append(f).append(h).append(t(ut));o.append(s);yt();window.setTimeout(function(){wt()},20);pt();l(!0)}function yt(){k=t("#VIS_dtpFromDate"+i.windowNo);d=t("#VIS_dtpToDate"+i.windowNo);y=t("#VIS_btnRefresh_"+i.windowNo);g=t("#VIS_btnZoom_"+i.windowNo);p=t("#VIS_btnOK_"+i.windowNo);w=t("#VIS_btnCancel_"+i.windowNo);var n=new Date,r=("0"+n.getDate()).slice(-2),u=("0"+(n.getMonth()+1)).slice(-2),f=n.getFullYear()+"-"+u+"-"+r}function pt(){y.on("click",function(){nt()});g.on("click",function(){bt()});p.on("click",function(){nt()});w.on("click",function(){i.dispose()})}function wt(){n.AEnv.getGridWindow(i.windowNo,223,function(r){var e,u;if(r.error!=null){n.ADialog.error(r.error);self.dispose();self=null;return}(e=t.parseJSON(r.result),n.context.setContextOfWindow(t.parseJSON(r.wCtx),i.windowNo),u=new n.GridWindow(e),u!=null)&&(b=u.getTabs()[0],f=new n.GridController(!1),f.initGrid(!0,i.windowNo,i,b),f.setVisible(!0),window.innerHeight>700?f.sizeChanged(window.innerHeight-230,window.innerWidth):f.sizeChanged(window.innerHeight-215,window.innerWidth),h.append(f.getRoot()),f.activate(),c=new n.Query,c.addRestriction("AD_Client_ID",n.Query.prototype.EQUAL,n.context.getAD_Client_ID()))})}function nt(){var e=null,t,i;e=c!=null?jQuery.extend(!0,{},c):new n.Query;t=a.getValue();(t==null||t.toString()=="-1"||t.toString().trim().length==0)&&(t=null);t!=null&&t.toString().length>0&&e.addRestriction("AD_Org_ID",n.Query.prototype.EQUAL,t);t=u.getValue();t!=null&&t.toString().length>0&&e.addRestriction("M_Locator_ID",n.Query.prototype.EQUAL,t);t=r.getValue();t!=null&&t.toString().length>0&&e.addRestriction("M_Product_ID",n.Query.prototype.EQUAL,t);t=v.getValue();(t==null||t.toString()=="-1"||t.toString().trim().length==0)&&(t=null);t!=null&&t.toString().length>0&&e.addRestriction("MovementType",n.Query.prototype.EQUAL,t);i=k.val().toString();i!=null&&i.length>0&&(i=new Date(i),e.addRestriction("TRUNC(MovementDate,'DD')",n.Query.prototype.GREATER_EQUAL,i));i=d.val().toString();i!=null&&i.length>0&&(i=new Date(i),e.addRestriction("TRUNC(MovementDate,'DD')",n.Query.prototype.LESS_EQUAL,i));b.setQuery(e);f.query(0,0,!1)}function bt(){var r=0,u=null,e=null,o=[],t=n.context.getContextAsInt(i.windowNo,"M_InOutLine_ID"),s,h;if(t!=0?(n.context.getContext(i.windowNo,"MovementType").equals("C-")?r=169:n.context.getContext(i.windowNo,"MovementType").equals("C+")?r=409:n.context.getContext(i.windowNo,"MovementType").equals("V+")?r=184:n.context.getContext(i.windowNo,"MovementType").equals("V-")&&(r=411),u="M_InOut_ID",e="VIS_140",o[0]=new n.DB.SqlParam("@lineID",t)):(t=n.context.getContextAsInt(i.windowNo,"M_InventoryLine_ID"),t!=0?(r=168,u="M_Inventory_ID",e="VIS_141",o[0]=new n.DB.SqlParam("@lineID",t)):(t=n.context.getContextAsInt(i.windowNo,"M_MovementLine_ID"),t!=0?(r=170,u="M_Movement_ID",e="VIS_142",o[0]=new n.DB.SqlParam("@lineID",t)):(t=n.context.getContextAsInt(i.windowNo,"M_ProductionLine_ID"),t!=0&&(r=191,u="M_Production_ID",e="VIS_143",o[0]=new n.DB.SqlParam("@lineID",t))))),r!=0)if(s=0,h=0,h=f.getSelectedRows(),h.length>0)s=n.Utility.Util.getValueOfInt(tt(e,null,null)),dt(u,t,r,s);else return alert(n.Msg.getMsg("NoRecordSelected"))}function kt(n,i,r){var u=null;return t.ajax({url:lt,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function dt(t,i,r,u){var f=new n.Query;f.addRestriction(t,n.Query.prototype.EQUAL,u);n.viewManager.startWindow(r,f)}var tt;this.windowNo=null;var o=t("<div style='width: 100%; height: 100%; background-color: white;'>"),i=this,s=null,it=null,h=null,rt=null,ut=null,ft=null,et=null,a=null,v=null,k=null,d=null,ot=[],st=null,y=null,g=null,p=null,w=null,ht=[],e=null,u=null,r=null,f=null,c=null,b=null,ct=n.Application.contextUrl,lt=ct+"JsonData/JDataSetWithCode";this.initialize=function(){at();l(!0);window.setTimeout(function(){vt();l(!1)},20)};tt=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u=null;return kt(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u};this.getRoot=function(){return o};this.dataStatusChanged=function(){};this.setBusy=function(n){l(n)};this.disposeComponent=function(){windowNo=null;o=null;i=this;s=null;it=null;$divBankAccount=null;$divCurrentBalance=null;$divBusinessPartner=null;$divOnlyDueInvoice=null;$divPaymentDate=null;$divPaymentMethod=null;h=null;rt=null;ut=null;ft=null;et=null;$cmbBankAccount=null;$cmbBusinessPartner=null;$cmbPaymentMethod=null;$cmbPaymentDate=null;$lblCurrentBal=null;$chkOnlyDueInvoice=null;$txtCurrentBal=null;$lblMsg=null;$txtPaymentAmount=null;ot=null;st=null;y=null;p=null;w=null;ht=null}}n.Apps.AForms=n.Apps.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot());this.initialize()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VTrxMaterial=i}(VIS,jQuery),function(n,t){function r(r,u,f){function yr(){var t="",u=!1,i;n.Application.isRTL?(u=!0,t="border-left: 3px solid #d9e3e7;"):t="border-right: 3px solid #d9e3e7;";i='<div class="vis-advancedSearch-contentWrap"> <div class="vis-advancedSearchContentArea vis-pull-left" style="'+t+'"> <div class="vis-advancedSearchContentArea-up"> <div class="vis-advanedSearch-InputsWrap"><div class="vis-form-group vis-advancedSearchInput" style="width: 25%;"><label id="lblQryName_'+r+'" for="QueryName">'+n.Msg.getMsg("QueryName")+'<\/label><input readonly id="txtQryName_'+r+'" type="text" name="QueryName" maxlength="60"><\/div> <div class="vis-form-group vis-advancedSearchInput" style="width: 25%;"><label id="lblSavedQry_'+r+'" for="GetSavedQuery">'+n.Msg.getMsg("GetSavedQuery")+'<\/label><select id="drpSavedQry_'+r+'"><\/select><\/div> <div class="vis-advancedSearch-Icons vis-pull-left">   <ul>   <li class="vis-pull-left"><button disabled id="btnDelete_'+r+'" class="vis-advancedSearchActionIcon vis-advancedSearch-delIcon"><\/button><\/li><\/ul><\/div><\/div><div class="vis-advanedSearch-InputsWrap vis-pull-left">  <div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v">    <label id="lblColumn_'+r+'"  for="Column">'+n.Msg.getMsg("Column")+'<\/label>  <select id="drpColumn_'+r+'"><\/select><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-op"><label id="lblOperator_'+r+'" for="Oprator">'+n.Msg.getMsg("Operator")+'<\/label><select id="drpOperator_'+r+'"><\/select><\/div> <div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" id="divValue1_'+r+'">   <label  id="lblQryValue_'+r+'" for="QueryValue">'+n.Msg.getMsg("QueryValue")+'<\/label> <input  id="txtQryValue_'+r+'" type="text" name="QueryValue"><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" id="divValue2_'+r+'"><label for="QueryName"  id="lblToQryValue_'+r+'">'+n.Msg.getMsg("ToQueryValue")+'<\/label><input  id="txtToQryValue_'+r+'" type="text" name="QueryName"><\/div><div class="vis-form-group vis-advancedSearchInput vis-advancedSearchInput-v" style="display:none;padding-top: 30px;" id="divFullDay_'+r+'"><input style="width: auto;float: left;margin-top: 2px;" id="checkFullDay_'+r+'" type="checkbox" name="QueryName"><label for="QueryName"  id="lblToQryValue_'+r+'">'+n.Msg.getMsg("FullDay")+'<\/label><\/div><div class="vis-advancedSearch-calender-Icon vis-pull-left"><ul><li class="vis-pull-left"><button id="btnSave_'+r+'" disabled class="vis-advancedSearchActionIcon vis-advancedSearch-SaveIcon"><\/button><\/li><\/ul><\/div><\/div><div id="divDynamic_'+r+'"><div class="vis-advanedSearch-InputsWrap vis-advancedSearchMrgin"><div class="vis-form-group vis-advancedSearchInput1 vis-pull-left"><input type="checkbox"  id="chkDynamic_'+r+'"  name="IsDynamic" class="vis-pull-left"><label for="IsDynamic" >'+n.Msg.getMsg("IsDynamic")+'<\/label><\/div><div class="vis-form-group vis-advancedSearchInput"><select id="drpDynamicOp_'+r+'" disabled><option>'+n.Msg.getMsg("Today")+"<\/option><option>"+n.Msg.getMsg("lastxDays")+"<\/option><option>"+n.Msg.getMsg("lastxMonth")+"<\/option><option>"+n.Msg.getMsg("lastxYears")+'<\/option><\/select><\/div><div class="vis-form-group vis-advancedSearchHorigontal-dynamic vis-pull-left" id="divYear_'+r+'"><label for="Year">'+n.Msg.getMsg("Year")+'<\/label><input id="txtYear_'+r+'" type="number" min="1" max="99" /><\/div><div class="vis-form-group vis-advancedSearchHorigontal-dynamic vis-pull-left" id="divMonth_'+r+'"><label for="Month">'+n.Msg.getMsg("Month")+'<\/label><input id="txtMonth_'+r+'" type="number" min="0" max="12" /><\/div><div class="vis-form-group vis-advancedSearchHorigontal-dynamic vis-pull-left" id="divDay_'+r+'"> <label for="Day">'+n.Msg.getMsg("Day")+'<\/label><input id="txtDay_'+r+'" type="number" min="0" max="31" /><\/div><\/div><\/div><\/div><div class="vis-advancedSearchContentArea-down"><div class="vis-advancedSearchTableWrap vis-table-responsive vis-pull-left"><table id="tblQry_'+r+'" class="vis-advancedSearchTable"><thead><tr class="vis-advancedSearchTableHead"><th>'+n.Msg.translate(n.Env.getCtx(),"AD_Column_ID")+'<\/th><th style="display:none">'+n.Msg.translate(n.Env.getCtx(),"KEYVALUE")+"<\/th><th>"+n.Msg.translate(n.Env.getCtx(),"OperatorName")+"<\/th><th>"+n.Msg.translate(n.Env.getCtx(),"QueryValue")+'<\/th><th style="display:none">'+n.Msg.translate(n.Env.getCtx(),"VALUE1VALUE")+"<\/th><th>"+n.Msg.translate(n.Env.getCtx(),"QueryValue2")+"<\/th><th>"+n.Msg.getMsg("FullDay")+'<\/th><th style="display:none">'+n.Msg.translate(n.Env.getCtx(),"VALUE2VALUE")+'<\/th><th style="display:none">'+n.Msg.translate(n.Env.getCtx(),"AD_USERQUERYLINE_ID")+'<\/th><th style="display:none">'+n.Msg.translate(n.Env.getCtx(),"Operator")+"<\/th><th>"+n.Msg.translate(n.Env.getCtx(),"Action")+'<\/th><\/tr><\/thead><tbody class="vis-advancedSearchTableBody"><\/tbody><\/table><\/div><\/div><div class="vis-advancedSearchContentArea-button"><div class="vis-advcedfooterBtn">';t=u?"float:right":"float:left";i+='<button id="btnRefresh_'+r+'" class="VIS_Pref_btn-2"  style="margin-bottom:0px;margin-top:0px;'+t+'">'+n.Msg.getMsg("Refresh")+'<\/button><div class="vis-pull-right">  <button id="btnCancel_'+r+'" class="VIS_Pref_btn-2"  style="margin-top:0px;margin-right:10px;margin-bottom:0px;margin-left:10px;">'+n.Msg.getMsg("Cancel")+'<\/button><button id="btnOk_'+r+'" class="VIS_Pref_btn-2"  style="margin-bottom:0px;margin-top:0px;">'+n.Msg.getMsg("Ok")+'<\/button><\/div><\/div><\/div><\/div><div class="vis-advancedSearch-RecentRecords">  <div class="vis-RecentRecords-Heading">';t=u?"margin-right:15px":"margin-left:15px";i+='<h4 style="'+t+'" >'+n.Msg.getMsg("VHistory")+'<\/h4><\/div><div class="vis-RecentRecords-listWrap" style="'+t+'"> <ul id="ulQry_'+r+'" ><li data-value="0" title="'+n.Msg.getMsg("All")+'" >'+n.Msg.getMsg("All")+'<\/li><li data-value="365" title="'+n.Msg.getMsg("YearAll")+'">'+n.Msg.getMsg("YearAll")+'<\/li><li data-value="365 | C" title="'+n.Msg.getMsg("YearCreated")+'">'+n.Msg.getMsg("YearCreated")+'<\/li><li data-value="31" title="'+n.Msg.getMsg("MonthAll")+'">'+n.Msg.getMsg("MonthAll")+'<\/li><li data-value="31 | C" title="'+n.Msg.getMsg("MonthCreated")+'">'+n.Msg.getMsg("MonthCreated")+'<\/li><li data-value="7" title="'+n.Msg.getMsg("WeekAll")+'">'+n.Msg.getMsg("WeekAll")+'<\/li><li data-value="7 | C" title="'+n.Msg.getMsg("WeekCreated")+'">'+n.Msg.getMsg("WeekCreated")+'<\/li><li data-value="1" title="'+n.Msg.getMsg("DayAll")+'">'+n.Msg.getMsg("DayAll")+'<\/li><li data-value="1 | C" title="'+n.Msg.getMsg("DayCreated")+'">'+n.Msg.getMsg("DayCreated")+'<\/li><\/ul><\/div><\/div><\/div><div class="vis-advancedSearchFooter vis-pull-right"> <p id="pstatus_'+r+'" >16 / 16<\/p><\/div><div class="vis-apanel-busy vis-advancedSearchbusy" id="divBusy_'+r+'" ><p style="text-align:center"> '+n.Msg.getMsg("Loading")+"<\/p><\/div>";e.append(i);pr();wr();br()}function pr(){ft=e.find("#ulQry_"+r);a=e.find("#drpSavedQry_"+r);k=e.find("#drpColumn_"+r);v=e.find("#drpOperator_"+r);rt=e.find("#divValue1_"+r);tt=e.find("#divValue2_"+r);rr=e.find("#divFullDay_"+r);b=e.find("#txtQryName_"+r);kt=e.find("#btnOk_"+r);ot=e.find("#btnCancel_"+r);at=e.find("#btnSave_"+r);lt=e.find("#btnDelete_"+r);dt=e.find("#btnRefresh_"+r);st=e.find("#divDynamic_"+r);p=e.find("#chkDynamic_"+r);y=e.find("#drpDynamicOp_"+r);gt=e.find("#txtYear_"+r);ut=e.find("#txtMonth_"+r);d=e.find("#txtDay_"+r);nt=e.find("#divYear_"+r);et=e.find("#divMonth_"+r);it=e.find("#divDay_"+r);vt=e.find("#checkFullDay_"+r);nt.hide();et.hide();it.hide();st.hide();ri=e.find("#tblQry_"+r);ui=ri.find("tbody");ir=e.find("#pstatus_"+r);tr=e.find("#divBusy_"+r)}function wr(){var h,o,f,t,e,u;for(s=ai(null,!1),h=i.getData(n.context,wi,bi,"Code"),hr(s),oi=ft.html(),er(h),o='<option value="-1"> <\/option>',f=0;f<ii.length;f++)(t=ii[f],t.getIsEncrypted())||(e=t.getColumnName(),t.getDisplayType()==n.DisplayType.Button&&(t.getAD_Reference_Value_ID()==0?t.setDisplayType(n.DisplayType.String):e.endsWith("_ID")?t.setDisplayType(n.DisplayType.Table):(t.setDisplayType(n.DisplayType.List),t.lookup=new n.MLookupFactory.getMLookUp(n.context,r,t.getAD_Column_ID(),n.DisplayType.List))),u=t.getHeader(),u!=null&&u.length!=0||(u=n.Msg.getElement(n.context,e),u!=null&&u.Length!=0))&&(t.getIsKey()&&(u+=" (ID)"),o+='<option value="'+e+'">'+u+"<\/option>");k.html(o);w(!1)}function br(){ot.on("click",function(){g||(o.okBtnPressed=!1,h.close())});p.on("change",function(){var n=p.prop("checked");y.prop("disabled",!n);v.prop("disabled",n);or(!n);ti(!n);tu(n);n?hi(o.getIsUserColumn(k.val())):(nt.hide(),et.hide(),it.hide())});y.on("change",function(){hi()});k.on("change",function(){var t,r,e,i,f;g||(p.prop("disabled",!0),p.prop("checked",!1),p.trigger("change"),st.hide(),t=k.val(),yi(!0),t&&t!="-1"?(r=null,e=null,r=t.endsWith("_ID")||t.endsWith("_Acct")||t.endsWith("_ID_1")||t.endsWith("_ID_2")||t.endsWith("_ID_3")?o.getOperatorsQuery(n.Query.prototype.OPERATORS_ID):t.startsWith("Is")?o.getOperatorsQuery(n.Query.prototype.OPERATORS_YN):o.getOperatorsQuery(n.Query.prototype.OPERATORS),i=u.getField(t),i!=null&&n.DisplayType.IsDate(i.getDisplayType())?(y.html(o.getOperatorsQuery(n.Query.prototype.OPERATORS_DATE_DYNAMIC,!0)),st.show(),p.prop("disabled",!1),hi(),i.getDisplayType()==n.DisplayType.DateTime&&(wt(!1),bt(!0))):o.getIsUserColumn(t)&&(y.html(o.getOperatorsQuery(n.Query.prototype.OPERATORS_DYNAMIC_ID,!0)),st.show(),p.prop("disabled",!1),hi(!0)),i.getDisplayType()!=n.DisplayType.DateTime&&(wt(!0),bt(!1)),v.html(r),v[0].SelectedIndex=0,f=vi(t),sr(!0,f),ci(at,!0),v.prop("disabled",!1)):(bt(!1),wt(!0)),or(!0),ti(!1))});v.on("change",function(){var t,i,r;g||(t=v.val(),t||(t=""),i=k.val(),r=vi(i),t&&t!="0"?n.Query.prototype.BETWEEN.equals(t)?(sr(!1,r),ti(!0)):(i=k.val(),r=vi(i),r.getDisplayType()==n.DisplayType.DateTime&&n.Query.prototype.EQUAL.equals(t)?(wt(!1),bt(!0)):(wt(!0),bt(!1),ti(!1))):(ci(at,!1),ti(!1),yi(!0)))});a.on("change",function(){if(!g){var t=a.val();si&&ui.find(".vis-advancedSearchTableRow").length>0?n.ADialog.confirm("SaveSearch?",!0,"","Confirm",function(n){n?a.val(o.saveQueryID):fr(t)}):fr(t)}});ri.on("click",function(n){if(!g&&n.target.nodeName==="IMG"){var r=t(n.target).data("index");c.splice(r,1);i.deleteLines(t(n.target).data("userquery"));li(c)}});ft.on("click","LI",function(){var i,r;g||(i=t(this).data("value"),i!=null?(w(!0),r=t(this).index(),setTimeout(function(){var u,f,t;r<9?(u=i.toString().split("|"),f=u.length,o.created=f==1?!1:!0,o.days=parseInt(u[0]),i=""):o.days=0;l=new n.Query(ht);l.addRestriction(i);t=0;t=ai(l,!0);l.setRecordCount(t);w(!1);t!=0&&(o.okBtnPressed=!0,h.close())},10)):(o.okBtnPressed=!1,h.close()))});at.on("click",ki);lt.on("click",function(){if(!g){var t=a.val();t==null||t.toString()==""||parseInt(t)<1||n.ADialog.confirm("DeleteConfirm",!0,"","Confirm",function(r){if(r){w(!0);window.setTimeout(function(){var e=n.dataContext.getJSONData(n.Application.contextUrl+"ASearch/GetQueryDefault",{UserQuery_ID:t},null),r,f;if(e>0){n.ADialog.warn("QueryDefaultForOther");w(!1);return}u.userQueryID==t&&(o.needRefreshWindow=!0);r=a.find("option:selected").text();i.deleteUserQuery(t)?(f=i.getData(n.context,wi,bi,"Code"),ft.empty(),ft.html(oi),er(f),a[0].selectedIndex=0,n.ADialog.info("Deleted",!0,r,""),b.val(""),b.prop("readony",!0),w(!1),a.trigger("change")):n.ADialog.info("DeleteError",!0,r,"");w(!1)},10)}else w(!1)})}});kt.on("click",function(){g||(o.okPressed=!0,o.okBtnPressed=!0,iu())});dt.on("click",function(){if(!g){ki();var t=ar(),n=0;n=ai(t,!0);hr(n)}})}function kr(){ot&&(ot.off("click"),p.off("change"),y.off("change"),k.off("change"),v.off("change"),a.off("change"),ri.off("click"),ft.off("click"),at.off("click"),lt.off("click"),kt.off("click"),dt.off("click"))}function fr(n){if(o.saveQueryID=n,si=!1,n&&n!="-1")c=i.getQueryLines(n),li(c),b.val(a.find("option:selected").text()),b.prop("readonly",!1),ci(lt,!0);else ci(lt,!1),b.val(""),b.prop("readonly",!0),c=null,li(null)}function er(t){var u="",e="",r,i,f;if(t!=null)for(r in t)i=n.Utility.encodeText(t[r].Name),f=i,i.length>25&&(i=i.substr(0,25)+"..."),u+='<li data-value="'+t[r].Code+'" title="'+f+'">'+i+"<\/li>",e+='<option value="'+t[r].AD_UserQuery_ID+'" title="'+f+'">'+i+"<\/option>";u.length>0&&ft.append(u);a.html("<option value='-1' > <\/option>"+e)}function hi(n){var t=y[0].selectedIndex;if(n){nt.hide();et.hide();it.hide();return}nt.show();et.show();p.is(":checked")?it.show():it.hide();d.prop("readonly",!1);ut.prop("min",1);t==3||t==6?(ut.prop("min",0),d.val(0),ut.val(0),gt.val(1)):t==2||t==5?(nt.hide(),gt.val(""),ut.val(1),d.val(0)):t==1||t==4?(nt.hide(),et.hide(),d.val(0)):t==0&&(d.prop("readonly",!0),nt.hide(),et.hide(),d.val(0))}function dr(){return it.is(":visible")||nt.is(":visible")||it.is(":visible")}function gr(n){var t="",i;return n==3||n==6?(i=Math.round(ni(n)/365,1),t="Last "+i.toString()+" Years"):n==2||n==5?(i=Math.round(ni(n)/31,1),t="Last "+i.toString()+" Month"):t=ni()!=0?"Last "+ni()+" Days":"This Day",t}function nu(n){return" adddays(sysdate, - "+ni(n)+") "}function ni(n){var u=0,i,t;if(n==3||n==6){var r=gt.val(),i=ut.val(),t=d.val();r=r&&r!=""?parseInt(r):0;i=i&&i!=""?parseInt(i):0;t=t&&t!=""?parseInt(t):0;u=r*365+i*31+t}else n==2||n==5?(i=ut.val(),t=d.val(),i=i&&i!=""?parseInt(i):0,t=t&&t!=""?parseInt(t):0,u=i*31+t):(t=t=d.val(),t=t&&t!=""?parseInt(t):0,u=t);return u}function or(n){var r=rt.children()[1],i=null;rt.children().length>2&&(i=rt.children()[2]);i?t(i).prop("disabled",!n).prop("readonly",!n):r!=null&&t(r).prop("disabled",!n).prop("readonly",!n)}function ti(n){var r=tt.children()[1],i=null;tt.children().length>2&&(i=tt.children()[2]);i?t(i).prop("disabled",!n).prop("readonly",!n):r!=null&&t(r).prop("disabled",!n).prop("readonly",!n)}function wt(n){tt.css("display",n?"block":"none")}function bt(n){rr.css("display",n?"block":"none")}function tu(n){n?vt.prop("disabled",!0):vt.prop("disabled",!1)}function ci(n,t){n.prop("disabled",!t)}function sr(i,r){var e,o,u,f;i&&(yt=null);pt=null;e=null;o=null;i?(e=rt.children()[1],rt.children().length>2&&(o=rt.children()[2])):(e=tt.children()[1],tt.children().length>2&&(o=tt.children()[2]));e!=null&&(t(e).remove(),o!=null&&t(o).remove(),e=null);u=null;u=r!=null?r.getIsKey()?new n.Controls.VNumTextBox(r.getColumnName(),!1,!1,!0,r.getDisplayLength(),r.getFieldLength(),r.getColumnName()):n.VControlFactory.getControl(null,r,!0,!0,!1):new n.Controls.VTextBox("columnName",!1,!0,!1,20,20,"format","GetObscureType",!1);u!=null&&(u.setReadOnly(!1),r.getDisplayType()==n.DisplayType.AmtDimension&&(u.hideButton(!1),u.setReadOnlyTextbox(!1)),n.DisplayType.Text==r.getDisplayType()||n.DisplayType.TextLong==r.getDisplayType()?(u.getControl().attr("rows","1"),u.getControl().css("width","100%")):n.DisplayType.YesNo==r.getDisplayType()?u.getControl().css("clear","both"):n.DisplayType.IsDate(r.getDisplayType())&&u.getControl().css("line-height","1"),f=null,u.getBtnCount()>0&&!(u instanceof n.Controls.VComboBox)&&(f=u.getBtn(0)),i?(rt.append(u.getControl()),yt=u,f&&(rt.append(f),u.getControl().css("width","65%"),f.css("max-width","35px"))):(tt.append(u.getControl()),pt=u,f&&(tt.append(f),u.getControl().css("width","65%"),f.css("max-width","35px"))),r.getDisplayType()==n.DisplayType.AmtDimension&&u.getControl().css("width","100%"))}function li(t){var r,e;ui.empty();var f="",u="",i=null;if(t)for(r=0,e=t.length;r<e;r++)u='<tr class="vis-advancedSearchTableRow">',i=t[r],u+="<td>"+i.KEYNAME+'<\/td><td style="display:none">'+i.KEYVALUE+"<\/td><td>"+i.OPERATORNAME+"<\/td><td>"+i.VALUE1NAME+'<\/td><td style="display:none">'+i.VALUE1VALUE+"<\/td><td>"+i.VALUE2NAME+'<\/td><td style="display:none">'+i.VALUE2VALUE+"<\/td><td>"+i.FULLDAY+'<\/td><td style="display:none">'+i.AD_USERQUERYLINE_ID+'<\/td><td style="display:none">'+i.OPERATOR+'<\/td><td><img style="cursor:pointer" data-userQuery="'+i.AD_USERQUERYLINE_ID+'" data-index = "'+r+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/delete10.png" /><\/td>',u+="<\/tr>",f+=u;ui.html(f)}function ai(t,i){var u="SELECT COUNT(*) FROM ",e,f,c,h;u+=ht;e=!1;ct!=null&&ct.length>0&&(u+=ct.indexOf("@")==-1?" WHERE "+ct:" WHERE "+n.Env.parseContext(n.context,r,ct,!1),e=!0);t!=null&&t.getIsActive()&&(u+=e?" AND ":" WHERE ",u+=n.Env.parseContext(n.context,r,t.getWhereClause(!0),!1));f=n.MRole.getDefault().addAccessSQL(u.toString(),ht,n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO);n.context.setContext(r,vr,"FindSQL",f);s=999999;try{c=n.secureEngine.encrypt(f);s=n.dataContext.getJSONData(n.Application.contextUrl+"ASearch/GetNoOfRecrds",{RecQuery:c},null)}catch(l){ei.Log(n.Level.SEVERE,f,l)}return h=n.MRole.getDefault(),o.okPressed=!1,s==0||s==null?(s=0,i&&n.ADialog.info("FindZeroRecords",!0,"")):t!=null&&h.getIsQueryMax(s)?n.ADialog.error("FindOverMax",!0,s+" > "+h.getMaxQueryRecords()):o.okPressed=!0,t!=null,s}function hr(n){var t=" "+n+" / "+s+" ";if(ir.text(t),s<f){ur=!0;return}}function vi(n){var t,i;if(n==null||n.length==0)return null;for(t=0;t<ii.length;t++)if(i=ii[t],n.equals(i.getColumnName()))return i;return null}function ki(){var i=k.val(),n,t,s,o,h;if(!i||i=="-1"||(n=k.find("option:selected").text(),t="",n==null||n.trim().length==0))return!1;if(t=i.toString(),si=!0,s=p.prop("checked"),s)if(dr()){var r=">=",u=" >= ",f=gr(y[0].selectedIndex),e=nu(y[0].selectedIndex);gi(n,t,u,r,f,e,null,null,di())}else{var r="=",u=" = ",f=y.find("option:selected").text(),e=y.val();gi(n,t,u,r,f,e,null,null,di())}else o=v.val(),v[0].selectedIndex>-1&&(o=y.find("option:selected").text()),h=v.val(),gi(n,t,o,h,lr(!0),cr(!0),lr(!1),cr(!1),di());return k[0].selectedIndex=0,v[0].selectedIndex=0,yi(),yi(!0),b.prop("readonly",!1),bt(!1),wt(!0),p.prop("checked",!1),vt.prop("checked",!1),st.hide(),!0}function cr(t){var i=null;return(i=t?yt:pt,i!=null)?i.getDisplayType()==n.DisplayType.YesNo?i.getValue().toString().toLowerCase()=="true"?"Y":"N":i.displayType==n.DisplayType.AmtDimension?i.getText():i.getValue():""}function lr(t){var i=null;return(i=t?yt:pt,i!=null)?i.displayType==n.DisplayType.AmtDimension?i.getText():i.getDisplay():""}function di(){if(vt)return vt.is(":checked")?"Y":"N"}function gi(t,i,r,u,f,e,o,s,h){c==null&&(c=[]);var l={};l.KEYNAME=t;l.KEYVALUE=i;l.OPERATORNAME=u;l.VALUE1NAME=n.Utility.encodeText(f);l.FULLDAY=h;l.VALUE1VALUE=f==""?"":e==null?"NULL":n.Utility.encodeText(n.Utility.Util.getValueOfString(e));l.VALUE2NAME=n.Utility.encodeText(o);l.VALUE2VALUE=s==null?"NULL":n.Utility.encodeText(n.Utility.Util.getValueOfString(s));l.AD_USERQUERYLINE_ID=0;l.OPERATOR=r;c.push(l);li(c)}function yi(n){var t=null;t=n?pt:yt;t!=null&&t.setValue(null)}function ar(){var l=new n.Query(ht),b,p,tt,h,o,k,w,t;if(c)for(b=0;b<c.length;b++){var s=c[b],nt=s.KEYNAME.toString(),a=s.KEYVALUE.toString(),f=vi(a),y=f.getColumnSQL(),u=s.OPERATORNAME.toString(),e=s.VALUE1VALUE,i=null;if(e!=null&&e.toString().trim().startsWith("adddays")||e.toString().trim().startsWith("@")||(i=nr(f,e)),p=null,e==null||e.toString().length<1){if(n.Query.prototype.BETWEEN.equals(u))continue;i=n.Env.NULLString;p="NULL"}else p=s.VALUE1NAME.toString();if(tt=s.FULLDAY.toString(),f.getIsVirtualColumn())if(y=f.vo.ColumnSQL,a=f.vo.ColumnSQL,n.Query.prototype.BETWEEN.equals(u)){if(h=s.VALUE2VALUE.toString(),h==null||h.toString().trim().length<1)continue;if(o=nr(f,h),k=s.VALUE2NAME.toString(),o==null)continue;t=pi(i,o,a,u,!0);where=n.Env.parseContext(n.context,r,t,!1);l.addRestriction(t)}else t=pi(i,o,a,u,!0),where=n.Env.parseContext(n.context,r,t,!1),l.addRestriction(t);else{var d="C_DimAmt",it="IsActive",rt="Amount",ut="S",v="E",ft="L",et="ECT",ot="F",g="R",st="OM",ct="WH";if(f.getDisplayType()==n.DisplayType.DateTime&&n.Query.prototype.EQUAL.equals(u)&&i&&tt=="Y"){var lt=i.getFullYear(),at=i.getMonth(),vt=i.getDate();o=new Date(lt,at,vt,24,00,00);i=new Date(lt,at,vt,00,00,00);s.VALUE2VALUE=o.toUTCString();u=n.Query.prototype.BETWEEN}if(n.Query.prototype.BETWEEN.equals(u)){if(h=s.VALUE2VALUE.toString(),h==null||h.toString().trim().length<1)continue;if(f.getDisplayType()==n.DisplayType.AmtDimension&&(w=ut+v+ft+et+" "+d+"_ID "+ot+g+st+" "+d+" "+ct+v+g+v+" "+it+"='Y' AND "+rt+" "+u+e+" AND "+h,i=n.MRole.getDefault().addAccessSQL(w.toString(),"C_DimAmt",n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO),u=n.Query.prototype.IN),f.getDisplayType()==n.DisplayType.AmtDimension)t=pi(i,o,y,u,!1),where=n.Env.parseContext(n.context,r,t,!1),l.addRestriction(t);else{if(o=nr(f,h),k=s.VALUE2NAME.toString(),o==null)continue;l.addRangeRestriction(y,i,o,nt,p,k)}}else f.getDisplayType()==n.DisplayType.AmtDimension&&(w=ut+v+ft+et+" "+d+"_ID "+ot+g+st+" "+d+" "+ct+v+g+v+" "+it+"='Y' AND "+rt+" "+u+e,i=n.MRole.getDefault().addAccessSQL(w.toString(),"C_DimAmt",n.MRole.SQL_NOTQUALIFIED,n.MRole.SQL_RO),u=n.Query.prototype.IN),i==null&&e!=null&&(e.toString().trim().startsWith("adddays")||e.toString().trim().startsWith("@"))?(t=a+u+e,f.getDisplayType()==n.DisplayType.AmtDimension&&(t=a+n.Query.prototype.IN+"("+i+")"),where=n.Env.parseContext(n.context,r,t,!1),l.addRestriction(t)):f.getDisplayType()==n.DisplayType.AmtDimension?(t=pi(i,o,y,u,!1),where=n.Env.parseContext(n.context,r,t,!1),l.addRestriction(t)):l.addRestriction(y,u,i,nt,p)}}return l}function pi(t,i,r,u,f){var e="",o=/(\d{4})-(\d{2})-(\d{2})T(\d{2})\:(\d{2})\:(\d{2})/;return typeof t=="string"&&(e+=" UPPER( "),e+=r,typeof t=="string"&&(e+=" ) "),t==null||"NULL".equals(t.toString().toUpper())||"NullValue".toUpper().equals(t.toString().toUpper())?e+=u.equals(n.Query.prototype.EQUAL)?" IS NULL ":" IS NOT NULL ":(e+=u,(n.Query.prototype.IN.equals(u)||n.Query.prototype.NOT_IN.equals(u))&&(e+="("),t instanceof Date||t&&o.test(t.toString())?e+=n.DB.to_date(tcode,!1):"string"==typeof t?f?(e+=" UPPER( ",e+=n.DB.to_string(t.toString()),e+=" ) "):e+=t.toString():e+=t,n.Query.prototype.BETWEEN.equals(u)?(e+=" AND ",i instanceof Date||i&&o.test(i.toString())?e+=n.DB.to_date(i,!1):typeof i=="string"?(e+=" UPPER( ",e+=n.DB.to_string(i.toString()),e+=" ) "):e+=i):(n.Query.prototype.IN.equals(u)||n.Query.prototype.NOT_IN.equals(u))&&(e+=")")),e}function nr(t,i){var u,r,e,f,o;if(i==null||(u=t.getDisplayType(),r=i.toString(),r==null||r.equals(n.Env.NULLString)||r==""||r.toUpper()=="NULL"))return null;try{if(u==n.DisplayType.Integer||n.DisplayType.IsID(u)&&t.getColumnName().endsWith("_ID"))return parseInt(r);if(n.DisplayType.IsNumeric(u))return parseFloat(r);if(n.DisplayType.IsDate(u)){e="";try{return new Date(r)}catch(h){e=""}try{return Date.Parse(e)}catch(c){return null}}}catch(s){return f=s.message,(f==null||f.length==0)&&(f=s.toString()),o="",o+=t.getColumnName()+" = "+r+" - "+f,n.ADialog.error("ValidationError",!0,o.toString()),null}return r}function iu(){var f,r;if(w(!0),ki(),l=ar(),l.getRestrictionCount()==0){w(!1);h.close();return}f=l.getWhereClause(!0);r=n.Utility.encodeText(b.val());r!=null&&r.trim().length==0?r=null:o.needRefreshWindow=!0;var t=a.val(),u="";t=t!=null&&t.toString()!="-1"&&parseInt(t)>0?t:0;window.setTimeout(function(){if(t!=0||r!=null)if(i.insertOrUpdate(t,r,f,wi,bi,c,o.getID))fi=!1,u=t>0?"Updated":"Saved",o.saveQueryID=i.id;else{if(i.alreadyExist){n.ADialog.error("SearchExist");w(!1);fi=!0;return}fi=!0;u=t>0?"UpdatedError":"SaveError"}var e=!1;ai(l,!0)!=0&&(e=!0);w(!1);u!=""&&n.ADialog.info("",!0,n.Msg.getMsg(u)+" "+r,null);e&&h.close()},10)}function w(n){g=n;tr.css("visibility",g?"visible":"hidden");kt.prop("disabled",n);ot.prop("disabled",n);dt.prop("disabled",n)}var ru=u.getName(),wi=u.getAD_Tab_ID(),bi=u.getAD_Table_ID(),ht=u.getTableName(),ct=u.getWhereClause(),ii=u.getFields(),e=t("<div style='height:100%'>"),tr=null,o=this,h=null,kt,ot,lt,at,dt,b,a,k,v,y,p,gt,ut,d,ir,vt,ft,st,nt,et,it,rt,tt,ri,ui,rr,vr=99,s=0,ur=!1,fi=!1,g=!1,c=null,ei=n.Logging.VLogger.getVLogger("Find"),yt,pt,oi,si,l;this.onClose=null;this.created=!1;this.days=0;this.okPressed=!1;this.okBtnPressed=!1;this.needRefreshWindow=!1;oi="";this.saveQueryID=-1;si=!1;l=new n.Query(ht);l.addRestriction(ct);yr();this.getID=function(n){this.saveQueryID=n};this.getSavedID=function(){return this.saveQueryID};this.show=function(){h=new n.ChildDialog;h.setHeight(550);h.setWidth(860);h.setTitle(n.Msg.getMsg("Find"));h.setModal(!0);h.onClose=function(){o.onClose&&o.onClose();o.dispose()};h.show();h.setContent(e);h.hideButtons();w(!1);ot.focus()};this.getSavedQueryName=function(){return b.val()?n.Utility.encodeText(b.val()):""};this.getQuery=function(){var t=n.MRole.getDefault();return t.getIsQueryMax(s)?(l=n.Query.prototype.getNoRecordQuery(ht,!1),s=0,ei.warning("Query - over max")):ei.info("Query="+l),l};this.disposeComponent=function(){kr();kt=ot=lt=at=dt=null;b=a=k=v=y=p=gt=ut=d=null;ft=st=nt=et=it=null;e&&e.remove();e=null;s=ur=fi=null;c=null;ei=null;this.created=this.days=0;this.okPressed=this.okBtnPressed=null;yt=pt=oi=null;l=null}}var u=n.Application.contextUrl,f=u+"JsonData/ExecuteNonQuer",e=function(n,i,r){var e=r?!0:!1,u=null,o={sql:n,param:i};return t.ajax({url:f+"yWithCode",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:e,data:JSON.stringify(o)}).done(function(n){u=n;r&&r(n)}),u},i={alreadyExist:!1,id:0,getData:function(t,i,r,u){var o=t.getAD_Client_ID(),f=null;try{f=n.dataContext.getJSONData(n.Application.contextUrl+"ASearch/GetData",{ColumnName:u,Tab_ID:i,Table_ID:r},null)}catch(e){console.log(e)}return f},getQueryLines:function(t){var i=null,o=[],f,e,u,r;try{if(i=n.dataContext.getJSONData(n.Application.contextUrl+"ASearch/GetQueryLines",{UserQuery_ID:t},null),f="",e="",i!=null)for(u in i)r={},r.KEYNAME=i[u].KEYNAME,r.KEYVALUE=i[u].KEYVALUE,r.OPERATORNAME=i[u].OPERATORNAME,r.VALUE1NAME=i[u].VALUE1NAME,r.VALUE1VALUE=i[u].VALUE1VALUE,r.VALUE2NAME=i[u].VALUE2NAME,r.VALUE2VALUE=i[u].VALUE2VALUE,r.AD_USERQUERYLINE_ID=i[u].AD_USERQUERYLINE_ID,r.FULLDAY=i[u].FULLDAY,f=i[u].OPERATORNAME,e=n.Query.prototype.OPERATORS[f],r.OPERATOR=e,o.push(r)}catch(s){}return o},deleteLines:function(t){var i=[],r;return i[0]=new n.DB.SqlParam("@AD_UserQuery_ID",t),r=e("VIS_147",i,null),r>=0},deleteUserQuery:function(i){var r=-1;return t.ajax({url:n.Application.contextUrl+"ASearch/DeleteQuery",type:"POST",datatype:"json",async:!1,data:{id:i}}).done(function(n){r=parseInt(n)}),r>=0},insertOrUpdate:function(r,u,f,e,o,s){var h=-1;return t.ajax({url:n.Application.contextUrl+"ASearch/InsertOrUpdateQuery",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:!1,data:JSON.stringify({id:r,name:u,where:f,tabid:e,tid:o,qLines:s})}).done(function(n){h=parseInt(n);h==-5&&(i.alreadyExist=!0)}),h>0&&(i.id=h),h>=0}};r.prototype.getOperatorsQuery=function(t,i){var f="",r="",u;for(u in t)r=t[u],i&&(r=n.Msg.getMsg(r)),f+='<option value="'+u+'">'+r+"<\/option>";return f};r.prototype.getIsUserColumn=function(n){return n.endsWith("atedBy")||n.equals("AD_User_ID")?!0:n.equals("SalesRep_ID")?!0:!1};r.prototype.getCurrentDays=function(){return this.days};r.prototype.getIsCreated=function(){return this.created};r.prototype.getIsOKPressed=function(){return this.okPressed&&this.okBtnPressed};r.prototype.needRefresh=function(){return this.needRefreshWindow};r.prototype.dispose=function(){this.disposeComponent()};n.Find=r}(VIS,jQuery),function(n,t){function i(n,i,r){var f=null;return t.ajax({url:u,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){f=n;r&&r(n)}),f}function f(i,r,u,f,e,o,s,h){this.init=function(){l()};var c=[],l=function(){var i=null,l,w,b,v,k,y,p,e,a;if(t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GetZoomTargets",data:{tableName:r},success:function(n){i=JSON.parse(n)}}),i!=null&&i.length>0)for(l=0;l<i.length;l++)if(w=i[l],t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GetZoomTarget",data:{targetTableName:w,curWindow_ID:f,targetWhereClause:u.getWhereClause()},success:function(n){zoomList=JSON.parse(n)}}),zoomList!=null)for(e in zoomList){b=zoomList[e];v=!0;for(k in c)if(c[k].Key==zoomList[e].Key){v=!1;break}v&&c.push(b)}if(i=null,c.length==0)alert(n.Msg.getMsg("NoZoomTarget"));else{y=t("<div>");p=t("<ul class=vis-apanel-rb-ul>");y.append(p);for(e in c){a=t("<li data-id='"+c[e].Key+"'>");a.append(c[e].Name);a.on("click",function(i){var f,r,u;i.stopImmediatePropagation();f=t(this).data("id");r=new n.Query;r.addRestriction(s,n.Query.prototype.EQUAL,h);n.viewManager.startWindow(f,r);u=t("#w2ui-overlay");u.hide();u=null});p.append(a)}o.w2overlay(y.clone(!0),{css:{height:"200px"}})}},a=function(n,t){var i;if(t!=null&&t.Length!=0&&(i=t,!(i.indexOf(" EXISTS ")>0)&&!(i.indexOf(" IN ")>0)&&!(i.indexOf("(")>0)&&!(i.indexOf(")")>0)))while(i.indexOf("=")!=-1){var f=i.indexOf("="),u=i.lastIndexOf(" ",f),e=f-(u+1),r=i.substr(u+1,e);r.indexOf(".")!=-1&&(u=r.indexOf(".")+1,e=f-u,r=r.substr(u,e));n.indexOf(r)<0&&n.push(r);i=i.substr(f+1)}},v=function(t,i){var r,o,s;if(i==null||i.Length==0)return!0;if(r=i,o=!0,r.indexOf(" EXISTS ")>0||r.indexOf(" IN ")>0||r.indexOf("(")>0||r.indexOf(")")>0)return!1;while(r.indexOf("=")!=-1){var u=r.indexOf("="),f=r.lastIndexOf(" ",u),e=r.substr(f+1,u-(f+1)),h="",c="";e.indexOf(".")!=-1&&(f=e.indexOf("."),e=e.substr(f,u));for(s in t)if(e==t[s].columnName){h="'"+t[s].columnValue+"'";break}if(r=r.substr(u+1),f=0,u=r.indexOf(" "),c=u==-1?r.substr(f):r.substr(f,u),!n.Evaluator.evaluateLogicTuple(h,"=",c)){o=!1;break}}return o}}var r=n.Application.contextUrl,u=r+"JsonData/JDataSetWithCode",e=function(t,r,u){var o=u?!0:!1,e={sql:t,page:1,pageSize:0},f;return r&&(e.param=r),f=null,i(e,o,function(t){f=(new n.DB.DataReader).toJson(t);u&&u(f)}),f},o=function(t,r,u){var o=u?!0:!1,e={sql:t,page:1,pageSize:0},f;return r&&(e.param=r),f=null,i(e,o,function(t){f=(new n.DB.DataSet).toJson(t);u&&u(f)}),f};n.AZoomAcross=f}(VIS,jQuery),function(n,t){function i(i,r,u,f){function ui(){w=f;w||(at=i.gridTable.AD_Table_ID,o=r.getSelectedRows(),l=i.getRecords()[i.getCurrentRow()]);a=t('<ul class="vis-sms-ul" ><\/ul>');v=t("<div>");v.css("position","absolute");v.css("bottom","0");v.css("background","url('"+n.Application.contextUrl+"Areas/VIS/Images/LoadingCircle.gif') no-repeat");v.css("background-position","center center");v.css("width","100%");v.css("height","100%");v.css("text-align","center");v.css("opacity",".1");v[0].style.visibility="hidden"}function fi(){var i='         <div class="contentArea" style="width: 100%; float: left; height: 96%">',r;i+=' <div class="vis-sms-leftDiv"><\/div>';i+='   <div class="vis-sms-ContentWrap"><div class="vis-sms-ContentArea"><div class="vis-sms-leftWrap"><div class="vacom-form-horizontal">';i+='   <div class="vis-sms-inputWrap"><div class="vis-sms-form-data-sub">';i+='         <input type="text"  id="'+s.windowNo+'_emailMoblie"  placeholder="'+n.Msg.getMsg("EnterMobileNumber")+'">';i+="<\/div>";i+="  <\/div>";i+='  <\/div><div class="vis-sms-textarea-div" style="width: 100%; float: left; border: 1px solid rgb(204, 204, 204);">';i+=' <textarea  ondrop="return false;" id="'+s.windowNo+'_vis-sms-textarea" style="width: 100%; height:100%;resize:none" placeholder="'+n.Msg.getMsg("WriteMsgHere")+'"><\/textarea><\/div>';i+=' <div class="vis-sms-leftFooter">';i+='<div ><p class="vis-sms-counter" id='+s.windowNo+'_acCount><\/p> <p  class="vis-sms-counter"   id='+s.windowNo+'_oper><\/p> <p  class="vis-sms-counter"   id='+s.windowNo+"_maxCount >160<\/p> <\/div>";i+=' <input id="'+s.windowNo+'_dyndis" type="checkbox"><label  id="'+s.windowNo+'_dyndislbl"  for="'+s.windowNo+'_dyndis" >'+n.Msg.getMsg("DynamicSms")+"<\/label><\/div><\/div>";i+='  <div class="vis-sms-divider"><\/div>';i+=' <div class="vis-sms-rytWrap"><div class="vis-sms-rytContent">';i+=' <div class="vis-sms-rytBcc"><div><h4 style="float:left">'+n.Msg.getMsg("Mobile")+"<\/h4>";i+=' <img  id="'+s.windowNo+'_SmsRefresh"  style="cursor: pointer;float:right;margin-top:8px" title="'+n.Msg.getMsg("Refresh")+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/Refresh24.png">';i+='   <\/div><div class="vis-sms-BccList">';i+=" <\/div><\/div><\/div><\/div>  <\/div><\/div>";e.append(t(i));r=0;k=e.find("#"+s.windowNo+"_dyndis");e.find(".contentArea").css("height",e.height()-44);e.find(".vis-sms-leftDiv").height(e.height()-44);y=e.find(".vis-sms-leftDiv");et=e.find(".vis-sms-BccList");c=e.find("#"+s.windowNo+"_emailMoblie");pt=e.find("#"+s.windowNo+"_SmsRefresh");c.css("margin-top","10px");h=e.find("#"+s.windowNo+"_vis-sms-textarea");$leftfootArea=e.find(".vis-sms-leftFooter");rt=e.find("#"+s.windowNo+"_acCount");ut=e.find("#"+s.windowNo+"_oper");ot=e.find("#"+s.windowNo+"_maxCount");e.find(".vis-sms-textarea-div").css("margin-top","10px");e.find(".vis-sms-rytBcc").height(e.find(".vis-sms-rytContent").height()-10);w?(e.find(".vis-sms-leftDiv").hide(),e.find(".vis-sms-rytWrap").hide(),e.find(".vis-sms-textarea-div").height(e.height()-150),e.find(".vis-sms-leftWrap").css("width","100%"),e.find("#"+s.windowNo+"_dyndislbl").hide(),r=e.width()-40,k.prop("checked",!1),k.hide()):(e.find(".vis-sms-textarea-div").height(e.height()-150),r=e.width()-240,e.find(".vis-sms-leftWrap").width(r-345));b=e.find(".vis-sms-ContentWrap");b.css("width",r);yt=!0;e.find(".vis-sms-BccList").height(e.find(".vis-sms-rytContent").height()-70)}function ei(){var f,u,c,s,h,r;for(nt=t('<img src="'+n.Application.contextUrl+'Areas/VIS/Images/Action.png" style="cursor:pointer" ><\/img>'),f=t('<div class="vis-apanel-lb-toggle" style="height:100%;overflow-x:hidden;overflow-y:hidden"><\/div>'),f.append(nt),y.append(f),p=t('<ul class="vis-apanel-lb-ul"><\/ul>'),p.css({height:e.height()-80+"px",overflow:"auto","white-space":"nowrap",width:"150%"}),u=0;u<i.gridTable.getFields().length;u++)if(c=i.gridTable.getFields(0)[u].getColumnName().toUpper()==i.getKeyColumnName().toUpper(),i.gridTable.getFields(0)[u].getIsDisplayed()||c){if(c||p.append(t("<li>"+i.gridTable.getFields(0)[u].getHeader()+"<\/li>")),s=[],h=[],i.gridTable.getFields(0)[u].getColumnName().toUpper().equals(g))for(r=0;r<o.length;r++)n.DisplayType.IsLookup(i.getField(g).getDisplayType())?o[r][g.toLower()]!=null&&(s.push(o[r][g.toLower()]),h.push(o[r][i.getKeyColumnName().toLower()])):o[r][g.toLower()]!=null&&(s.push(o[r][g.toLower()]),h.push(o[r][i.getKeyColumnName().toLower()]));si(s,h)}f.append(p)}function wt(n){var t,u;if(n&&(a.empty(),o=r.getSelectedRows(),l=i.getRecords()[i.getCurrentRow()]),r.singleRow)bt();else if(o.length>0)for(t=0;t<o.length;t++)o[t].mobile!=null&&(u=o[t][i.getKeyColumnName().toLower()],a.append('<li class="vis-sms-list-li-bcc"  data-mobile="'+o[t].mobile+'"><input id="'+s.windowNo+"_"+o[t].mobile+'_CheckBoxList1" type="checkbox" value="'+o[t].mobile+'" checked/><label class="vis-sms-chcklist-label"  for="'+s.windowNo+"_"+o[t].mobile+'_CheckBoxList1">'+o[t].mobile+"("+u+")<\/label><\/li>"));else bt();n||et.append(a);a.children().length>1&&k.prop("checked")==!0&&(c.val(""),c.prop("disabled",!0))}function bt(){if(l.mobile!=null){var n=l[i.getKeyColumnName().toLower()];a.append('<li class="vis-sms-list-li-bcc" data-mobile="'+l.mobile+'"><input id="'+s.windowNo+"_"+l.mobile+'_CheckBoxList1" type="checkbox" value="'+l.mobile+'" checked /><label class="vis-sms-chcklist-label"  for="'+s.windowNo+"_"+l.mobile+'_CheckBoxList1">'+l.mobile+"("+n+")<\/label><\/li>")}}function oi(){it=t('<img  class="vis-Sms-sendButton" title="'+n.Msg.getMsg("SendSms").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/sendSms.png"> <\/img>');ht.append(it);w||(tt=t('<img  class="vis-sms-preview-btn" title="'+n.Msg.getMsg("Preview").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/preview.png"> <\/img>'),ht.append(tt))}function si(i,r){for(var u,o,f,e=0;e<i.length;e++)if(u=n.dataContext.getJSONData(n.Application.contextUrl+"Sms/GetUser",{BPartner_ID:i[e]},null),o=!1,u!=null)for(f in u)if(u[f].ISSMS!=null&&u[f].ISSMS.toString().equals("Y")){if(u[f].MOBILE==null||u[f].MOBILE=="")continue;if(t(a.children("li").data(u[f].MOBILE+r[e])).length>0)continue;a.append('<li  class="vis-sms-list-li-bcc"><input id="'+s.windowNo+"_"+u[f].MOBILE+'_CheckBoxList1" type="checkbox"  value="'+u[f].MOBILE+r[e]+'" checked/><label class="vis-sms-chcklist-label" for="'+s.windowNo+"_"+u[f].MOBILE+'_CheckBoxList1">'+u[f].MOBILE+"("+r[e]+")<\/label><\/li>")}}function hi(){it.on("click",bi);h.on("keyup",kt);if(!w){nt.on("click",ci);k.on("click",li);p.children("li").on("click",ai);tt.on("click",vi);nt.trigger("click");pt.on("click",yi)}}function ci(){k.prop("checked")==!0?y.width()==40?(y.css("width","200px"),y.find("ul").show(),b.width(b.width()-160),e.find(".vis-sms-leftWrap").width(e.find(".vis-sms-leftWrap").width()-160)):ct():y.width()!=40&&ct()}function ct(){y.css({width:"40px"});y.find("ul").hide();b.width(b.width()+160);e.find(".vis-sms-leftWrap").width(e.find(".vis-sms-leftWrap").width()+160)}function li(){this.checked?(y.width()!=40&&y.find("ul").show(),r.singleRow==!1&&o.length>1&&(c.val(""),c.prop("disabled",!0))):(y.width()!=40&&ct(),c.prop("disabled",!1))}function ai(){var r=h[0],f="@@"+t(this).text()+"@@",s=r.scrollTop,n=0,u=r.selectionStart||r.selectionStart=="0"?"ff":document.selection?"ie":!1,e,o,i;u=="ie"?(h.focus(),i=document.selection.createRange(),i.moveStart("character",-h.val().length),n=i.text.length):u=="ff"&&(n=r.selectionStart);e=h.val().substring(0,n);o=h.val().substring(n,h.val().length);h.val(e+f+o);n=n+f.length;u=="ie"?(h.focus(),i=document.selection.createRange(),i.moveStart("character",-h.val().length),i.moveStart("character",n),i.moveEnd("character",0),i.select()):u=="ff"&&(r.selectionStart=n,r.selectionEnd=n,h.focus());r.scrollTop=s;r=null;kt()}function vi(){var f=h.val(),e="",u,i;e=r.singleRow==!1&&o.length>0?dt(f,0):gt(f);u=t("<div><\/div>");u.append(n.Utility.encodeText(e));i=new n.ChildDialog;i.setHeight(420);i.setWidth(850);i.setTitle(n.Msg.getMsg("Preview"));i.setModal(!0);i.setContent(u);i.show();i.hidebuttons()}function yi(){wt(!0)}function kt(){rt.text(h.val().length);parseInt(rt.text())>parseInt(ot.text())?(ut.text(">"),lt("#ED0000")):parseInt(rt.text())==parseInt(ot.text())?(ut.text("="),lt("#000000")):(ut.text("<"),lt("#000000"))}function lt(n){ut.css("color",n);rt.css("color",n);ot.css("color",n)}function pi(t,u){for(var l=t,h={},f=t;f.indexOf("@@")>-1;){f=f.substring(f.indexOf("@@")+2);var c=f.substring(0,f.indexOf("@@")),s=null,e=Object.keys(r.getColumnNames()).filter(function(n){return r.getColumnNames()[n]===c})[0];n.DisplayType.IsLookup(i.getField(e).getDisplayType())||n.DisplayType.Location==i.getField(e).getDisplayType()?o[u][e.toLower()]!=null&&o[u][e.toLower()]!=undefined&&(s=i.getField(e.toLower()).lookup.getDisplay(o[u][e.toLower()])):n.DisplayType.IsDate(i.getField(e).getDisplayType())?(s=i.getField(e).value,s=new Date(s)):s=o[u][e.toLower()];f=f.substring(f.indexOf("@@")+2);h["@@"+c+"@@"]=s}return h}function wi(t){for(var u=t,o={};u.indexOf("@@")>-1;){u=u.substring(u.indexOf("@@")+2);var s=u.substring(0,u.indexOf("@@")),e=null,f=Object.keys(r.getColumnNames()).filter(function(n){return r.getColumnNames()[n]===s})[0];n.DisplayType.IsLookup(i.getField(f).getDisplayType())||n.DisplayType.Location==i.getField(f).getDisplayType()?l[f.toLower()]!=null&&l[f.toLower()]!=undefined&&(e=i.getField(f.toLower()).lookup.getDisplay(l[f.toLower()])):n.DisplayType.IsDate(i.getField(f).getDisplayType())?(e=i.getField(f).value,e=new Date(e)):e=l[f.toLower()];u=u.substring(u.indexOf("@@")+2);o["@@"+s+"@@"]=e}return o}function dt(t,u){for(var h=t,f=t;f.indexOf("@@")>-1;){f=f.substring(f.indexOf("@@")+2);var c=f.substring(0,f.indexOf("@@")),s=null,e=Object.keys(r.getColumnNames()).filter(function(n){return r.getColumnNames()[n]===c})[0];n.DisplayType.IsLookup(i.getField(e).getDisplayType())||n.DisplayType.Location==i.getField(e).getDisplayType()?o[u][e.toLower()]!=null&&o[u][e.toLower()]!=undefined&&(s=i.getField(e.toLower()).lookup.getDisplay(o[u][e.toLower()])):n.DisplayType.IsDate(i.getField(e).getDisplayType())?(s=i.getField(e).value,s=new Date(s)):s=o[u][e.toLower()];f=f.substring(f.indexOf("@@")+2);h=h.replace("@@"+c+"@@",s)}return h}function gt(t){for(var f=t;f.indexOf("@@")>-1;){f=f.substring(f.indexOf("@@")+2);var o=f.substring(0,f.indexOf("@@")),e=null,u=Object.keys(r.getColumnNames()).filter(function(n){return r.getColumnNames()[n]===o})[0];n.DisplayType.IsLookup(i.getField(u).getDisplayType())||n.DisplayType.Location==i.getField(u).getDisplayType()?l[u.toLower()]!=null&&l[u.toLower()]!=undefined&&(e=i.getField(u.toLower()).lookup.getDisplay(l[u.toLower()])):n.DisplayType.IsDate(i.getField(u).getDisplayType())?(e=i.getField(u).value,e=new Date(e)):e=r.singleRow==!0?i.getField(u).value:l[u.toLower()];f=f.substring(f.indexOf("@@")+2);t=t.replace("@@"+o+"@@",e)}return t}function bi(t){var i=h.val(),r=!0;(i==null||i==""||i.trim().length==0)&&(r=!1,n.ADialog.confirm("SendWithoutBody",!0,"","Confirm",function(n){n&&ni(t,i)}));r&&ni(t,i)}function ni(){var s,p,i,f,u,y,w,b,d,g;if(ft=[],s="",p=[],k.prop("checked")==!1){if(i={},i.MobileNumbers=[],c.val().contains(";"))for(f=c.val().split(";"),u=0;u<f.length;u++)f[u]!=null&&f[u]!=""&&(ii(f[u])?i.MobileNumbers.push(f[u]):s+=f[u]+",");else c.val()!=null&&c.val()!=""&&(ii(c.val())?i.MobileNumbers.push(c.val()):s+=c.val()+",");if(a!=null&&a!=undefined)if(selectedValues=[],e.find("[id*=CheckBoxList1]:checked").each(function(){selectedValues.push(t(this).val())}),selectedValues.length>0)for(y=0;y<selectedValues.length;y++)selectedValues[y]?i.MobileNumbers.push(selectedValues[y]):s+=selectedValues[y]+",";else if(c.val().trim().length==0){window.setTimeout(function(){n.ADialog.info("NoNumberFound")},2);return}if(s!=""){window.setTimeout(function(){n.ADialog.info("InvalidMobileNumbers"," ",n.Msg.getMsg("MobileNo")+s)},2);return}if(i.Body={},i.MobileNumbers.length>0)for(w=0;w<i.MobileNumbers.length;w++)ft.push({num:i.MobileNumbers[w],info:'"'+i.MobileNumbers[w]+'","'+h.val()+'","'+new Date+'","@@response@@"'});p.push(i)}else if(selectedValues=[],t("[id*=CheckBoxList1]:checked").each(function(){selectedValues.push(t(this).val())}),r.singleRow==!0&&o.length>0)p.push(ti(l,0));else for(b=0;b<o.length;b++)p.push(ti(o[b],b));d=JSON.stringify(p);v[0].style.visibility="visible";g={sms:d,format:h.val()};t.ajax({url:n.Application.contextUrl+"Sms/SendSms",data:g,datatype:"json",type:"post",cache:!1,success:function(i){var r=JSON.parse(i),e,o,u,s,h,c,f;if(v[0].style.visibility="hidden",r.ResultMessage=="SmsConfigurationNotFound"){window.setTimeout(function(){n.ADialog.info("SmsConfigurationNotFound")},2);return}for(e=t('<div style="max-height: 300px;overflow:auto"><\/div>'),o=t("<table><\/table>"),u=0;u<r.Response.length;u++)s=t("<tr><\/tr>"),h=t("<td><\/td>"),h.append(r.Response[u].mobileNumber+" - "+r.Response[u].response),s.append(h),o.append(s);e.append(o);c=t('<a style="float:right" href="javascript:void(0)" ><img title="'+n.Msg.getMsg("SaveSmsLog")+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/Save24.PNG"><\/img><\/a>');e.append(c);f=new n.ChildDialog;f.setTitle(n.Msg.getMsg("Information"));f.setContent(e);f.show();f.hidebuttons();c.on("click",function(){for(var i="",u,f,e,n=0;n<r.Response.length;n++)u=t.grep(ft,function(t){return t.num==r.Response[n].mobileNumber}),i+=u[0].info.replace("@@response@@",r.Response[n].response)+"\n";f=(new Date).toISOString().slice(0,19).replace(/-/g,"");e="data:text/csv;base64,"+window.btoa(i);t(this).attr("href",e).attr("download","file-"+f+".csv")})},error:function(t){console.log(t);n.ADialog.error("MessageSendingFailed");v[0].style.visibility="hidden"}})}function ti(n,t){var i={},u,t,e,f;if(i.MobileNumbers=[],c.val().contains(";"))for(u=c.val().split(";"),t=0;t<u.length;t++)u[t]!=null&&u[t]!=""&&i.MobileNumbers.push(u[t]);else c.val()!=null&&c.val()!=""&&i.MobileNumbers.push(c.val());if(a!=null&&a!=undefined&&Object.keys(n).indexOf("mobile")>-1&&selectedValues.indexOf(n.mobile)>-1&&i.MobileNumbers.push(n.mobile),e="",r.singleRow==!1?(i.Body=pi(h.val(),t),e=dt(h.val(),t)):(i.Body=wi(h.val()),e=gt(h.val())),i.MobileNumbers.length>0)for(f=0;f<i.MobileNumbers.length;f++)ft.push({num:i.MobileNumbers[f],info:'"'+i.MobileNumbers[f]+'","'+e+'","'+new Date+'","@@response@@"'});return i}function ii(n){var i=!0,t,r;if(n.indexOf("(")>-1&&(n=n.substring(0,n.toString().indexOf("("))),n.length<10||n.length>17)i=!1;else{for(r=n.length,t=0;t<r;t++)isNaN(n[t])&&(/\s+$/.test(n[t])||n[t]!="("&&n[t]!=")"&&(i=!1));n.indexOf("(")>-1&&!n.indexOf(")")>-1&&(i=!1)}return i}function ki(){e.height(vt);e.width(st);var n=0;e.find(".contentArea").css("height",e.height()-44);e.find(".vis-sms-leftDiv").height(e.height()-44);e.find(".vis-sms-textarea-div").css("margin-top","10px");e.find(".vis-sms-rytBcc").height(e.find(".vis-sms-rytContent").height()-10);w?(e.find(".vis-sms-leftDiv").hide(),e.find(".vis-sms-rytWrap").hide(),e.find(".vis-sms-textarea-div").height(e.height()-150),e.find(".vis-sms-leftWrap").css("width","100%"),n=e.width()-40,k.prop("checked",!1),k.hide()):(e.find(".vis-sms-textarea-div").height(e.height()-150),n=st-(e.find(".vis-sms-leftDiv").width()+30),e.find(".vis-sms-leftWrap").width(n-345));b=e.find(".vis-sms-ContentWrap");b.css("width",n)}this.frame=null;this.windowNo=n.Env.getWindowNo();var ri=n.Env.getCtx(),d=null,w=!1,g="C_BPARTNER_ID",o=null,l=null,at=0,ft=[],s=this,vt=0,st=0,p=null,e=t('<div class="vis-sms-rootDiv vis-forms-container"><\/div>'),ht=t('<div class="vis-awindow-header vis-menuTitle">'),y=null,b=null,et=null,nt=null,h=null,a=null,c=null,p=null,rt,ut,ot,it,tt,yt=!1,v,pt=null,k=null;ui();this.initializeComponent=function(){var i=t('<a href="javascript:void(0)"  class="vis-mainMenuIcons vis-icon-menuclose"><\/a>'),u="";u=w?t("<p>"+n.Msg.getMsg("Sms")+" ("+n.Msg.getMsg("Contacts")+") <\/p>"):t("<p>"+n.Msg.getMsg("Sms")+" ("+r.aPanel.$parentWindow.getName()+") <\/p>");e.append(ht.append(i).append(u));e.append(v);i.click(function(n){s.dispose();s=null;n.stopPropagation()});fi();oi();w||(ei(),wt(!1));hi()};this.disposeComponent=function(){it.off("click");w||(nt.off("click"),p.children("li").off("click"),p.remove(),nt.remove());k.off("click");tt!=undefined&&(tt.off("click"),tt.remove());h.off("keyup");e.find(".vis-sms-CcBcc").off("click");ri=null;d=null;w=!1;g="";o=null;l=null;at=0;p=null;e.remove();e=null;y.remove();y=null;b.remove();b=null;et.remove();et=null;nt=null;a.remove();a=null;c.remove();c=null;p!=null&&p.remove();p=null;it.remove();it=null;tt=null;s=null};this.show=function(){d=new n.ChildDialog;d.setHeight(800);d.setWidth(1600);d.setTitle(n.Msg.getMsg("Sms"));d.setModal(!0);d.show();e=t('<div class="vis-sms-rootDiv"><\/div>');d.setContent(e);initializeComponent()};this.getRoot=function(){return e};this.sizeChanged=function(n,t){vt=n;st=t;yt==!0&&ki()}}i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;t.hideHeader(!0);this.initializeComponent();this.frame.getContentGrid().append(this.getRoot())};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Sms=i}(VIS,jQuery),function(n,t){function f(n,i,u){var f=null;return t.ajax({url:r,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){f=n;u&&u(n)}),f}function e(i,r,f,e,o,s){var a=232,c="",l=null,h=null;this.getRequests=function(){for(var e=u("VIS_72",null),h,l,a,o,i;e.read();)if(parseInt(e.getString(0))==0){n.ADialog.error("VIS_NotSupported");return}for(c="(AD_Table_ID="+r+" AND Record_ID="+f+")",r==114?c+=" OR AD_User_ID="+f+" OR SalesRep_ID="+f:r==291?c+=" OR C_BPartner_ID="+f:r==259?c+=" OR C_Order_ID="+f:r==318?c+=" OR C_Invoice_ID="+f:r==335?c+=" OR C_Payment_ID="+f:r==208?c+=" OR M_Product_ID="+f:r==203?c+=" OR C_Project_ID="+f:r==539&&(c+=" OR A_Asset_ID="+f),e=null,t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GetProcessedRequest",data:{AD_Table_ID:r,Record_ID:f},success:function(t){e=(new n.DB.DataReader).toJson(t)}}),h=0,l=0;e.read();)"Y"==e.getString(0)?h=e.getString(1):l+=e.getString(1);a=t("<div>");o=t("<ul class=vis-apanel-rb-ul>");a.append(o);i=t("<li data-id='RequestCreate'>");i.append(n.Msg.getMsg("RequestNew"));i.on("click",function(n){v(n)});if(o.append(i),l>0){i=t("<li data-id='RequestActive'>");i.append(n.Msg.getMsg("RequestActive"));i.on("click",function(n){y(n)});o.append(i)}if(h>0){i=t("<li data-id='RequestActive'>");i.append(n.Msg.getMsg("RequestAll"));i.on("click",function(n){p(n)});o.append(i)}s.w2overlay(a.clone(!0),{css:{height:"200px"}})};var v=function(i){i.stopImmediatePropagation();l=n.viewManager.startWindow(a,null);l.onLoad=function(){var n=l.cPanel.curGC;n.onRowInserting=function(){l.cPanel.cmd_new(!1)};n.onRowInserted=function(){h=l.cPanel.curTab;h.setValue("AD_Table_ID",r);h.setValue("Record_ID",f);e!=null&&e>0&&h.setValue("C_BPartner_ID",e);r==291?h.setValue("C_BPartner_ID",f):r==114?h.setValue("AD_User_ID",f):r==203?h.setValue("C_Project_ID",f):r==539?h.setValue("A_Asset_ID",f):r==259?h.setValue("C_Order_ID",f):r==318?h.setValue("C_Invoice_ID",f):r==208?h.setValue("M_Product_ID",f):r==335?h.setValue("C_Payment_ID",f):r==319&&h.setValue("M_InOut_ID",f)}};var u=t("#w2ui-overlay");u.hide();u=null},y=function(i){var r,u;i.stopImmediatePropagation();r=new n.Query;r.addRestriction("("+c+") AND Processed='N'");n.viewManager.startWindow(a,r);u=t("#w2ui-overlay");u.hide();u=null},p=function(i){var r,u;i.stopImmediatePropagation();r=new n.Query;r.addRestriction(c);n.viewManager.startWindow(a,r);u=t("#w2ui-overlay");u.hide();u=null}}var i=n.Application.contextUrl,r=i+"JsonData/JDataSetWithCode",u=function(t,i,r){var o=r?!0:!1,e={sql:t,page:1,pageSize:0},u;return i&&(e.param=i),u=null,f(e,o,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u};n.ARequest=e}(VIS,jQuery),function(n,t){function i(){var c=n.Application.contextFullUrl,i;if(c||(c=n.Application.contextUrl),c&&c.toString().toLowerCase().indexOf("softwareonthecloud.com")>-1){n.ADialog.info("VIS_GotoControlPanel",!0,"","");return}var l=t("<div class='vis-forms-container' style='height:100%'>"),ft=t("<div style='width:80%;height:100%;overflow:auto;' class='vis-pull-left'>"),rt=t("<div style='height:100%'>");l.append(rt);rt.append(ft);i=t("<div style='background-color: rgb(241, 241, 241);width:20%;height:100%;padding:15px;word-wrap: break-word;' class='vis-pull-right' >");rt.append(i);i.append(t('<h3 style="margin-top:5px;font-size: 16px;font-weight: 200px;color: #1b95d7;">').append(n.Msg.getMsg("Result")));var r=t("<div class='vis-apanel-busy' style='height:100%'>"),yt=n.Env.getWindowNo(),a=null,v=null,y=null,p=null,f=null,e=null,w=null,o=null,b=null,k=null,d=null,g=null,nt=null,s=null,ot=null,tt=null,it=null,ut=null,u=null,h=null,et=null;this.load=function(){var ui=t("<div class='vis-graywrap'>"),i,rt,ut,ot,vt,yt,pt,wt,bt,ri,u,kt,dt,gt,ni,ti,c,ii;ft.append(ui);i=t("<div class='initial-client-form'>");ui.append(i);i.append(t("<h3 class='VIS_Pref_change-pass' style='margin-left:15px;margin-right: 15px;'>").append(t("<label class='VIS_Pref_Label_Font' style='margin-top:0px'>").append(n.Msg.getMsg("TenantHeaderComment"))));rt=t("<div class='vis-intial-form-data'>");rt.append(t("<label>").append(n.Msg.translate(n.context,"AD_Client_ID")));a=t('<input type="text" name="tenant" placeholder="'+n.Msg.getMsg("Tenant")+'">');rt.append(a);i.append(rt);ut=t("<div class='vis-intial-form-data' >");ut.append(t("<label>").append(n.Msg.translate(n.context,"AD_Org_ID")));v=t('<input type="text" name="tenant" placeholder="'+n.Msg.getMsg("Org")+'">');ut.append(v);i.append(ut);ot=t("<div class='vis-intial-form-data'>");ot.append(t("<label>").append(n.Msg.parseTranslation(n.context,"@AD_User_ID@ @AD_Client_ID@")));y=t('<input type="text" name="tenant" placeholder="'+n.Msg.getMsg("TenantAdmin")+'">');ot.append(y);i.append(ot);vt=t("<div class='vis-intial-form-data' >");vt.append(t("<label>").append(n.Msg.parseTranslation(n.context,"@AD_User_ID@ @AD_Org_ID@")));p=t('<input type="text" name="tenant" placeholder="'+n.Msg.getMsg("TenantUser")+'">');vt.append(p);i.append(vt);yt=t("<div class='vis-intial-form-dataCombo'>");yt.append(t("<label>").append(n.Msg.translate(n.context,"C_Currency_ID")));f=t('<select placeholder="Currency">');yt.append(f);i.append(yt);pt=t("<div class='vis-intial-form-dataCombo'>");pt.append(t("<label>").append(n.Msg.translate(n.context,"C_Country_ID")));e=t('<select placeholder="Country">');pt.append(e);i.append(pt);wt=t("<div class='vis-intial-form-dataCombo'>");wt.append(t("<label>").append(n.Msg.translate(n.context,"City")));w=t('<input type="text" placeholder="'+n.Msg.getMsg("City")+'" style="width:100%;">');wt.append(w);i.append(wt);bt=t("<div class='vis-intial-form-dataCombo' >");bt.append(t("<label>").append(n.Msg.translate(n.context,"C_Region_ID")));o=t('<select placeholder="Region">');bt.append(o);i.append(bt);i.append(t('<div style="width:100%;float:left;">').append(t("<label  style='margin-right:15px;margin-left:15px;margin-top:10px;color: #499EDE;font-family: helvetica;font-weight: 400;font-size: 16px;' class='vis-pull-left'>").append(n.Msg.getMsg("Optional"))));ri=t('<div style="padding-left:15px;padding-right:15px;">');u=t("<div class='vis-intial-form-data' style='width: 100%;border:1px darkgrey solid;padding:10px;border-radius: 5px;margin-top:0px;'>");ri.append(u);i.append(ri);kt=t('<div class="vis-initial-form-checkbox" >');b=t('<input type="checkbox">');kt.append(b);kt.append(t("<label>").append(n.Msg.translate(n.context,"C_Project_ID")));u.append(kt);dt=t('<div class="vis-initial-form-checkbox">');k=t('<input type="checkbox">');dt.append(k);dt.append(t("<label>").append(n.Msg.translate(n.context,"C_SalesRegion_ID")));u.append(dt);gt=t('<div class="vis-initial-form-checkbox">');d=t('<input type="checkbox" checked disabled>');gt.append(d);gt.append(t("<label>").append(n.Msg.translate(n.context,"M_Product_ID")));u.append(gt);ni=t('<div class="vis-initial-form-checkbox">');g=t('<input type="checkbox">');ni.append(g);ni.append(t("<label>").append(n.Msg.translate(n.context,"C_Campaign_ID")));u.append(ni);ti=t('<div class="vis-initial-form-checkbox">');nt=t('<input type="checkbox" checked disabled>');ti.append(nt);ti.append(t("<label>").append(n.Msg.translate(n.context,"C_BPartner_ID")));u.append(ti);c=t("<div class='vis-initial-btn-left vis-pull-right'>");i.append(c);ii=t('<div style="display: inline;">');c.append(ii);h=t('<input type="checkbox" style="margin-right: 5px;margin-left: 10px;margin-top: 5px;display:none">');h.prop("checked",!0);h.on("click",function(){h.prop("checked")?s.css("display","none"):s.css("display","initial")});ii.append(h);et=t("<label style='margin-right: 10px;font-size: 14px;color: #666;font-weight: normal;display:none'>").append(n.Msg.getMsg("UseDefault"));ii.append(et);s=t("<a class='vis-initial-btn vis-initial-btn-blue' style='margin-right:10px;display:none;'>").append(n.Msg.getMsg("LoadAccountingValues"));s.on("click",function(){it.trigger("click")});c.append(s);it=t("<input type='file' style='display:none;' accept='.csv*'>");it.change(function(){lt(this)});c.append(it);tt=t("<a class='vis-initial-btn' style='margin-right: 15px;'>").append(n.Msg.getMsg("Done"));tt.on("click",function(){at()});c.append(tt);l.append(r);r[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"VSetup/GetInitialData",dataType:"json",error:function(){n.ADialog.error(n.Msg.getMsg("ERRORGettingInitialData"));r[0].style.visibility="hidden"},success:function(t){var i=t.result;if(i==null){n.ADialog.error(n.Msg.getMsg("ERRORGettingInitialData"));r[0].style.visibility="hidden";return}st(i.currency);ht(i.country);ct(i.region);r[0].style.visibility="hidden"}})};var st=function(n){if(n!=null)for(var i in n)f.append(t('<option value="'+n[i].ID+'">').append(n[i].Name))},ht=function(n){if(n!=null)for(var i in n)e.append(t('<option value="'+n[i].ID+'">').append(n[i].Name))},ct=function(n){if(n!=null)for(var i in n)o.append(t('<option value="'+n[i].ID+'">').append(n[i].Name))},lt=function(t){u=t.files[0].name;r[0].style.visibility="visible";window.setTimeout(function(){ut=Date.now().toString();var i=new XMLHttpRequest,f=new FormData;f.append("file",t.files[0]);i.open("POST",n.Application.contextUrl+"Attachment/SaveFileinTemp/?filename="+u+"&folderKey="+ut,!1);i.send(f);r[0].style.visibility="hidden"},2)},at=function(){var l,tt,s,c,it,ot,rt,st,ft,ht,et;if(i.empty(),l=a.val(),l==null||l.length==0||l.trim().length==0){n.ADialog.error("FillTenantName");return}if(tt=v.val(),tt==null||tt.length==0||tt.trim().length==0){n.ADialog.error("FillOrgName");return}if(s=y.val(),s==null||s.length==0||s.trim().length==0){n.ADialog.error("FillUserClient");return}if(c=p.val(),c==null||c.length==0||c.trim().length==0){n.ADialog.error("FillUserOrg");return}if(it=w.val(),it==null||it.length==0||it.trim().length==0){n.ADialog.error("FillCity");return}if(ot=f.val(),rt=f.find("option:selected").text(),rt==null||rt.length==0||rt.trim().length==0){n.ADialog.error("FillCurrency");return}if(st=e.val(),ft=e.find("option:selected").text(),ft==null||ft.length==0||ft.trim().length==0){n.ADialog.error("FillCountry");return}if(ht=o.val(),et=o.find("option:selected").text(),et==null||et.length==0||et.trim().length==0){n.ADialog.error("FillRegion");return}if(h.prop("checked"))u=null;else if(u==null||u.length==0||u.trim().length==0){n.ADialog.error("SelectFile");return}if(s==c){n.ADialog.error("UsernameMustBeDifferent");return}var ct=d.prop("checked"),lt=nt.prop("checked"),at=b.prop("checked"),yt=g.prop("checked"),pt=k.prop("checked");r[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"VSetup/InitailizeClientSetup",type:"POST",dataType:"json",data:{clientName:l,orgName:tt,userClient:s,userOrg:c,city:it,currencyID:ot,currencyName:rt,countryID:st,countryName:ft,regionID:ht,regionName:et,cfProduct:ct,cfBPartner:lt,cfProject:at,cfMCampaign:yt,cfSRegion:pt,fileName:u,folderKey:ut},error:function(){n.ADialog.error("ErrorCreatingTenant");r[0].style.visibility="hidden"},success:function(n){var t=n.result;r[0].style.visibility="hidden";vt(t)}})},vt=function(r){r.Log!=null&&r.Log.trim().length>0&&(i.append(t('<div style="margin-bottom:10px">').append(" Error - "+r.Log)),i.append(t('<div style="margin-bottom:10px">').append(n.Msg.getMsg("VIS_TenantErrorMsg"))));i.append(t('<div style="margin-bottom:10px">').append(" Tenant Name - "+r.TenantName));i.append(t('<div style="margin-bottom:10px">').append(" Organization Name - "+r.OrgName));i.append(t('<div style="margin-bottom:10px">').append(" Admin Role - "+r.AdminRole));i.append(t('<div style="margin-bottom:10px">').append(" User Role - "+r.UserRole));i.append(t('<div style="margin-bottom:10px">').append(" Admin Username - "+r.AdminUser));i.append(t('<div style="margin-bottom:10px">').append(" Admin User Password - "+r.AdminUserPwd));i.append(t('<div style="margin-bottom:10px">').append(" Org Username - "+r.OrgUser));i.append(t('<div style="margin-bottom:10px">').append(" Org User Password - "+r.OrgUserPwd));var u=n.Application.isRTL?t('<a href="javascript:void(o)" style="float:left;" class="vis-initial-btn vis-initial-btn-blue">').append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Save24.png'>")):t('<a href="javascript:void(o)" style="float:right;" class="vis-initial-btn vis-initial-btn-blue">').append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/base/Save24.png'>"));u.on("click",function(){var n="",i,u;n+=" Tenant Name - "+r.TenantName+"\t\n";n+=" Organization Name - "+r.OrgName+"\t\n";n+=" Admin Role - "+r.AdminRole+"\t\n";n+=" User Role - "+r.UserRole+"\t\n";n+=" Admin Username - "+r.AdminUser+"\t\n";n+=" Admin User Password - "+r.AdminUserPwd+"\t\n";n+=" Org Username - "+r.OrgUser+"\t\n";n+=" Org User Password - "+r.OrgUserPwd+"\t\n";i=(new Date).toISOString().slice(0,19).replace(/-/g,"");u="data:text/csv;base64,"+window.btoa(n);t(this).attr("href",u).attr("download","file-"+i+".txt");divLog.dialog("close");divLog=null});i.append(u)};this.disposeComponent=function(){a=null;v=null;y=null;p=null;f=null;e=null;w=null;o=null;b=null;k=null;d=null;g=null;nt=null;s=null;ot=null;tt=null;r=null;l=null};this.getRoot=function(){return l}}n.Apps=n.Apps||{};n.Apps.AForms=n.Apps.AForms||{};i.prototype.sizeChanged=function(){};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.load();this.frame.getContentGrid().append(this.getRoot())};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VSetup=i}(VIS,jQuery),function(n,t){function i(){function s(o){e=o;u=e.find("#vis_favScroll");h();f=t("#userFav-Tab");i=t('<ul class="vis-userFavourites-ListMenu">');i.on("click",function(u){var f=t(u.target),e;f.data("btn")=="action"?n.viewManager.startAction(f.data("action"),f.data("id")):f.data("btn")=="zoom"?n.viewManager.startActionInNewTab(f.data("action"),f.data("id")):f.data("btn")=="remove"&&(a(f.data("id")),e=t(f).parent().parent(),e.empty(),e.remove(),r(i.find("li").length))})}function h(){t.ajax({url:n.Application.contextUrl+"Home/GetFavouriteNode",dataType:"json",error:function(){alert(n.Msg.getMsg("ERRORGetFavouriteNode"))},success:function(n){if(u.empty(),n.result)for(var t=0,f=n.result.length;t<f;t++)o(n.result[t]);r(i.find("li").length);u.append(i)}})}function c(n){o(n);r(i.find("li").length)}function o(r){var f,u,e,c,l,o,h,s;i!=null&&(f=t('<li data-nodeid="'+r.NodeID+'" >'),u=0,r.Action=="W"?u=r.WindowID:r.Action=="X"?u=r.FormID:r.Action=="P"?u=r.ProcessID:r.Action=="R"&&(u=r.ProcessID),e=t('<a href="#" data-id="'+u+'" data-action="'+r.Action+'" data-nodeid="'+r.NodeID+'" data-btn="action" style="overflow: auto;width: 100%;height: 100%;padding-top: 17px;" >'),c=t("<a data-id='"+u+"' data-action='"+r.Action+"' data-btn='zoom' style='height: 25px;width: 25px;float: right;margin-right: -10px;'>").append(t("<img data-id='"+u+"' data-action='"+r.Action+"' data-btn='zoom' src='"+n.Application.contextUrl+"Areas/VIS/Images/zoomfav.png' >")),f.append(c),l=t("<a data-id='"+r.NodeID+"'  data-btn='remove' style='height: 25px;width: 25px;float: right;'>").append(t("<img data-id='"+r.NodeID+"'  data-btn='remove' src='"+n.Application.contextUrl+"Areas/VIS/Images/removefav.png' >")),f.append(l),f.append(e),o=r.Name,o.length>27?(o=o.substr(0,27),e.append(o),h=t("<a href='#' class='VIS_Pref_tooltip' style='display: inline-block;'>").append("..."),s=t("<span style='width: inherit;'>"),s.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/ccc.png").append("ToolTip Text")),s.append(t("<label class='VIS_Pref_Label_Font'>").append(r.Name)),h.append(s),e.append(h)):e.append(r.Name),i.append(f))}function l(n){var f,u,e,o;if(i!=null){for(f=i.find("li"),u=null,e=0,o=f.length;e<o;e++)u=t(f[e]),u.data("nodeid")===n&&u.remove();f=u=null;r(i.find("li").length)}}function a(i){n.FavouriteHelper.removeFavourite(i);t.ajax({url:n.Application.contextUrl+"Home/RemoveNodeFavourite/?nodeID="+i,dataType:"json"})}function r(t){f.empty();f.html("<span class='favouritesIcons icon-favourite' /><span class='favouriteTabLabel-Large'>"+n.Msg.getMsg("Favourites")+" - <\/span><strong>"+t+"<\/strong>")}var e,u,i,f;return{init:s,addFavourite:c,removeFavourite:l}}n.favMgr=i()}(VIS,jQuery),function(n,t){function h(i,r){var u=null,f="";url=n.Application.contextUrl+"WSP/Contacts/GetBPLocation?WinNo="+r.windowNo+"&bpartnerID="+i;t.ajax({type:"GET",async:!1,url:url,dataType:"json",success:function(n){u=JSON.parse(n);for(var t=0;t<u.lstBPLocation.length;t++)f+="<option value='"+u.lstBPLocation[t].ID+"'>"+u.lstBPLocation[t].Name+"<\/option>";o.empty();o.append(f)}})}function c(t,i,r,f,e,o){u=new n.ChildDialog;u.setContent(t);i=="Customer"?u.setTitle(n.Msg.getMsg("Customer")):i=="Employee"?u.setTitle(n.Msg.getMsg("Employee")):i=="Vendor"?u.setTitle(n.Msg.getMsg("Vendor")):i=="Prospect"&&u.setTitle(n.Msg.getMsg("Prospect"));u.setEnableResize(!1);u.setModal(!0);u.show();l(e,i,o);r.on("change",function(){h(r.val(),f)})}function l(e,o,s){u.onOkClick=function(){var l=t("#divBPartner_"+i.windowNo).find("img"),rt=t(window).height()*(50/100),ut=t(window).width()*(50/100),u;e.css("margin-top",rt);e.css("margin-left",ut);s.show();l.css("visibility","visible");var h=t("#txtName_"+i.windowNo).val(),c=t("#txtSearchKey_"+i.windowNo).val(),a=t("#ddlGreeting1_"+i.windowNo).val(),ft=t("#txtName2_"+i.windowNo).val(),v=t("#ddlBPGroup_"+i.windowNo).val(),y=t("#ddlBPRelation_"+i.windowNo).val(),p=t("#ddlBPLoaction_"+i.windowNo).val(),w=t("#txtContact_"+i.windowNo).val(),b=t("#ddlGreeting_"+i.windowNo).val(),k=t("#txtTitle_"+i.windowNo).val(),d=t("#txtEmail_"+i.windowNo).val(),g=r.getValue(),nt=t("#txtPhone_"+i.windowNo).val(),tt=t("#txtPhone2_"+i.windowNo).val(),it=t("#txtFax_"+i.windowNo).val();if(h.trim()==""||c.trim()==""){n.ADialog.info("NameMandatory");s.hide();l.css("visibility","collapse");return}u=null;o=="Customer"?u=n.Msg.getMsg("Customer"):o=="Employee"?u=n.Msg.getMsg("Employee"):o=="Vendor"?u=n.Msg.getMsg("Vendor"):o=="Prospect"&&(u=n.Msg.getMsg("Prospect"));url=n.Application.contextUrl+"WSP/Contacts/AddBPartnerInfo";v=="0"&&(v=undefined);y=="0"&&(y=undefined);p=="0"&&(p=undefined);b=="0"&&(b=undefined);a=="0"&&(a=undefined);g==null&&(g=undefined);nt==""&&(nt=undefined);tt==""&&(tt=undefined);w==""&&(w=undefined);h==null&&(h=undefined);it==""&&(it=undefined);c==""&&(c=undefined);k==""&&(k=undefined);d==""&&(d=undefined);u==""&&(u=undefined);t.ajax({type:"Post",async:!1,url:url,dataType:"json",data:{searchKey:c,name:h,name2:ft,greeting:b,bpGroup:v,bpRelation:y,bpLocation:p,contact:w,greeting1:a,title:k,email:d,address:g,phoneNo:nt,phoneNo2:tt,fax:it,windowNo:i.windowNo,BPtype:u},success:function(n){s.hide();l.css("visibility","collapse");alert(n);f.empty()}})}}function a(i,u,o,s,h,l,a){var y=null,p="",w="",b="",k="",g=new n.MLocationLookup(n.context.ctx,i.windowNo),nt,d;r=new n.Controls.VLocation("C_Location_ID",!0,!1,!0,n.DisplayType.Location,g);nt=r.getBtnCount();f=t("<div id='divBPartner_"+i.windowNo+"' style='width:auto;height:auto;margin-right:5px'> <img src='/ViennaAdvantageWeb1/Areas/VIS/Images/busy.gif' style=' margin-top: 120px; margin-left: 327px; z-index:9999;position:absolute;visibility:collapse'>");d=n.Application.contextUrl+"WSP/Contacts/AddBusinessPartner?WinNo="+i.windowNo+"&UserID="+u;t.ajax({type:"GET",async:!1,url:d,dataType:"json",success:function(n){for(var i=JSON.parse(n),t=0;t<i.lstGreeting.length;t++)p+="<option value='"+i.lstGreeting[t].ID+"'>"+i.lstGreeting[t].Name+"<\/option>";for(t=0;t<i.lstBPGroup.length;t++)w+="<option value='"+i.lstBPGroup[t].ID+"'>"+i.lstBPGroup[t].Name+"<\/option>";for(t=0;t<i.lstBPRelation.length;t++)b+="<option value='"+i.lstBPRelation[t].ID+"'>"+i.lstBPRelation[t].Name+"<\/option>";for(t=0;t<i.lstBPLocation.length;t++)k+="<option value='"+i.lstBPLocation[t].ID+"'>"+i.lstBPLocation[t].Name+"<\/option>";y=v(p,w,k,b,o,s)}});f.append(y);f.load();c(f,h,e,i,l,a)}function v(u,f,c,l,a,v){var y=t("<table id='tableBPartner_"+i.windowNo+"'><tr><td><div style='margin-top: 0px; float: right' class='wsp-BPartner'>"+n.Msg.getMsg("SearchKey")+" <\/div><\/td><td style='width:300px'><div style='margin-top: 0px;width:100%' class='wsp-BPartner'><input id='txtSearchKey_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td><td style='width:50px'><\/td> <td style='margin-left:10px'><div style='margin-top: 0px; float: right;margin-right: 5px' class='wsp-BPartner'>"+n.Msg.getMsg("Greeting")+"  <\/div><\/td><td style='width:300px'><div style='margin-top: 0px;margin-right:5px' class='wsp-BPartner'><select id='ddlGreeting1_"+i.windowNo+"' style='width:100%'>"+u+"<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Name")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtName_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Name2")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtName2_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td><td style='width:50px'> <\/td> <td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("BPGroup")+"  <\/div><\/td><td style='width:300px'><div style='margin-right: 5px' class='wsp-BPartner'><select id='ddlBPGroup_"+i.windowNo+"' style='width: 100%'>"+f+"<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("BPRelation")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><select style='width:100%' id='ddlBPRelation_"+i.windowNo+"' >"+l+"<\/select><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("BPLoaction")+"  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><select id='ddlBPLoaction_"+i.windowNo+"' style='width:100%'><\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Contact")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtContact_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Greeting")+"  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><select id='ddlGreeting_"+i.windowNo+"' style='width: 100%'>"+u+"<\/select><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Title")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' class='wsp-BPartner'><input id='txtTitle_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("EmailAddress")+"  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><input id='txtEmail_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Address")+"  <\/div><\/td><td style='width:300px'><div style='width:100%' id='divAddress_"+i.windowNo+"' class='wsp-BPartner' ><\/div> <\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Phone")+"  <\/div><\/td><td style='width:300px'><div  class='wsp-BPartner' style='margin-right: 5px'><input id='txtPhone_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td><\/tr><tr><td><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("2ndPhone")+"  <\/div><\/td><td style='width:300px'><div class='wsp-BPartner' style='width:100%;'><input id='txtPhone2_"+i.windowNo+"' style='height: 25px;width:100%' type='text'><\/div><\/td> <td style='width:50px'><\/td><td style='margin-left:10px'><div style='float: right' class='wsp-BPartner'>"+n.Msg.getMsg("Fax")+"  <\/div><\/td><td style='width:300px' ><div style='margin-bottom:7px;margin-right: 5px' class='wsp-BPartner' ><input id='txtFax_"+i.windowNo+"' style='height: 25px;width:100%;' type='text'><\/div><\/td><\/tr><\/table>"),p=y.find("#divAddress_"+i.windowNo);return y.find("#ddlBPRelation_"+i.windowNo).val(a),e=y.find("#ddlBPRelation_"+i.windowNo),o=y.find("#ddlBPLoaction_"+i.windowNo),s=y.find("#ddlBPGroup_"+i.windowNo).val(v),h(a,i),r.getBtn(0).css("width","10%"),r.getBtn(0).css("height","10%"),r.getBtn(0).css("padding","0px"),r.getBtn(1).css("width","10%"),r.getBtn(1).css("height","10%"),r.getBtn(1).css("padding","0px"),p.append(r.getControl().css("width","80%")).append(r.getBtn(0)).append(r.getBtn(1)),y}var u=null,f=null,i=null,r=null,e=null,o=null,s=null;n.BPartner=function(n,t,r,u,e,o,s){f!=null&&f.empty();i=n;a(i,t,r,u,e,o,s)};n.AddUpdateBPartner=function(i,h,c,l,a,v){function ti(n,t,i){ii(n,t,i)}function ii(i,e,o){var s=null,h="",c="",l="",v="",p=new n.MLocationLookup(n.context.ctx,i),w,a;r=new n.Controls.VLocation("C_Location_ID",!0,!1,!0,n.DisplayType.Location,p);w=r.getBtnCount();f=t("<div id='divBPartner_"+i+"' style='width:auto;height:auto;margin-right:5px'> <img src='/ViennaAdvantageWeb1/Areas/VIS/Images/busy.gif' style=' margin-top: 120px; margin-left: 327px; z-index:9999;position:absolute;visibility:collapse'>");ei(f,i,e,o);a=n.Application.contextUrl+"BPartner/InitBP?WinNo="+i+"&bPartnerID="+e+"&bpType="+o;t.ajax({type:"GET",async:!1,url:a,dataType:"json",success:function(t){for(var u=JSON.parse(t),r=0;r<u.lstGreeting.length;r++)h+="<option value='"+u.lstGreeting[r].ID+"'>"+n.Utility.encodeText(u.lstGreeting[r].Name)+"<\/option>";for(r=0;r<u.lstBPGroup.length;r++)c+="<option value='"+u.lstBPGroup[r].ID+"'>"+n.Utility.encodeText(u.lstBPGroup[r].Name)+"<\/option>";for(r=0;r<u.lstBPRelation.length;r++)l+="<option value='"+u.lstBPRelation[r].ID+"'>"+n.Utility.encodeText(u.lstBPRelation[r].Name)+"<\/option>";s=ri(i,e,o,u,h,c,v,l)}});window.setTimeout(function(){u!=null&&(f.append(s),f.load(),t(".vis-apanel-busy").css("visibility","hidden"),t(".vis-apanel-busy").css("height","460px"),t(".vis-apanel-busy").css("z-index","99"),y!=null&&y.hide())},500)}function ri(i,u,f,h,c,l){var a=t("<DIV class='vis-MainDivBPartnerPopUp'><DIV class='vis-DivBPartnerLeft' ><DIV class='vis-FirstDivBPartnerPopUp' > <\/DIV>"+kt("50%","Phone Number",5)+kt("50%","Internet",100)+"<DIV class='vis-SecondDivBPartnerPopUp'> <\/DIV>"+kt("100%","Address",5)+"<DIV class='vis-ThirdDivBPartnerPopUp'> <\/DIV> <\/DIV><DIV class='vis-FourthDivBPartnerPopUp'> <\/DIV> <\/DIV>"),v;a.find(".vis-FirstDivBPartnerPopUp").append("<DIV class='vis-FirstDivCotrol' ><\/DIV>");a.find(".vis-FirstDivBPartnerPopUp").append("<DIV class='vis-DivBPartnerRight' > <\/DIV>");a.find(".vis-SecondDivBPartnerPopUp").append("<DIV class='vis-SecondDivCotrol' ><\/DIV> ");a.find(".vis-SecondDivBPartnerPopUp").append("<DIV class='vis-SecondDivImgCotrol'><\/DIV> ");a.find(".vis-ThirdDivBPartnerPopUp").append("<DIV class='vis-ThirdDivCotrol' ><\/DIV>");a.find(".vis-FourthDivBPartnerPopUp").append("<DIV class='vis-FourthDivHeader' > "+n.Msg.getMsg("BPType")+" <\/DIV> <DIV class='vis-FourthDivControl'><\/DIV>");a.find(".vis-DivBPartnerRight").append("<div class='image-upload' style='float: right; position: absolute; z-index: 999; top:40px;overflow:hidden;right:20px'><label for='file-input' class='vis-file-label-bp'><span style='margin-right:8px' class='vis-change-picture-ico'><\/span><\/label><input type='file' id='VISFileDialog_"+i+"' accept='image/*' class='wsp-file-input' value='Add Pic' style='opacity: 0; width: 100%; margin-top: 0px; float: right; z-index: 999; position: absolute; right: 0px; cursor: pointer;'><\/div>");a.find(".vis-DivBPartnerRight").append("<DIV class='vis-FirstDivImgCotrol'><\/DIV>");a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("SearchKeyValue")+"  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory'  id='txtSearchKey_"+i+"' style='height: 25px;width:100%' type='text'><\/div><\/DIV>");a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("Greeting")+"  <\/div> <div class='vis-all-control'><select id='ddlGreeting_"+i+"' style='width: 100%'>"+c+"<\/select><\/div><\/DIV>");a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("ContactName")+"  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory' id='txtContact_"+i+"' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>");a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("CompanyName")+"  <\/div> <div class='vis-all-control'><input class='vis-gc-vpanel-table-mandatory' id='txtName_"+i+"' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>");a.find(".vis-FirstDivCotrol").append("<DIV class='vis-FirstDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("BusinessPartnerGroup")+"  <\/div> <div class='vis-all-control'><select class='vis-gc-vpanel-table-mandatory' id='ddlBPGroup_"+i+"' style='width: 100%;float:left'>"+l+"<\/select> <\/div><\/DIV>");a.find(".vis-FirstDivImgCotrol").append("<DIV class='vis-FirstDivCotrolChild' >  <div style='float: left;width:100%;height:242px;line-height:236px;background: none repeat scroll 0% 0% #EEE;padding:0px;text-align:center;margin-top:20px' ><img id='imgBPartner_"+i+"' /><\/div> ");a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("Phone")+"  <\/div> <div class='vis-all-control'><input id='txtPhone_"+i+"' style='height: 25px;width:100%' type='text'><\/div><\/DIV>");a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("Mobile")+"  <\/div> <div class='vis-all-control'><input id='txtMobile_"+i+"' style='height: 25px;width:100%' type='text'><\/div><\/DIV>");a.find(".vis-SecondDivCotrol").append("<DIV class='vis-SecondDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("Fax")+"  <\/div> <div class='vis-all-control'><input id='txtFax_"+i+"' style='height: 25px;width:100%;' type='text'> <\/div><\/DIV>");a.find(".vis-SecondDivImgCotrol").append("<DIV class='vis-SecondDivCotrolChild' > <div class='vis-all-lable'>"+n.Msg.getMsg("EmailAddress")+"  <\/div> <div class='vis-all-control'><input id='txtEmail_"+i+"' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>");a.find(".vis-SecondDivImgCotrol").append("<DIV class='vis-SecondDivCotrolChild' > <div class='vis-all-lable'>"+n.Msg.getMsg("WebUrl")+"  <\/div> <div class='vis-all-control'><input id='txtWebUrl_"+i+"' style='height: 25px;width:100%' type='text'> <\/div><\/DIV>");a.find(".vis-ThirdDivCotrol").append("<DIV class='vis-ThirdDivCotrolChild'> <div class='vis-all-lable'>"+n.Msg.getMsg("Address")+"  <\/div> <div id='divAddress_"+i+"' class='vis-all-control'><\/div><\/DIV>");a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkCustomer_"+i+"' type='checkbox'> "+n.Msg.getMsg("Customer")+"<\/div><\/DIV>");a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkVendor_"+i+"' type='checkbox'>  "+n.Msg.getMsg("Vendor")+" <\/div><\/DIV>");a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkProspect_"+i+"' type='checkbox'> "+n.Msg.getMsg("Prospect")+"<\/div><\/DIV>");a.find(".vis-FourthDivControl").append("<DIV style='float: left;width:25%'> <div style='float: left;width:100%' class='wsp-BPartner'><input id='chkEmployee_"+i+"' type='checkbox'> "+n.Msg.getMsg("Employee")+"<\/div><\/DIV>");v=a.find("#divAddress_"+i);e=a.find("#ddlBPRelation_"+i);o=a.find("#ddlBPLoaction_"+i);s=a.find("#ddlBPGroup_"+i);p=a.find("#txtName_"+i);w=a.find("#txtSearchKey_"+i);d=a.find("#ddlGreeting1_"+i);st=a.find("#txtName2_"+i);b=a.find("#txtContact_"+i);k=a.find("#ddlGreeting_"+i);g=a.find("#txtTitle_"+i);tt=a.find("#txtEmail_"+i);nt=a.find("#txtPhone_"+i);ht=a.find("#txtPhone2_"+i);it=a.find("#txtFax_"+i);ft=a.find("#chkCustomer_"+i);et=a.find("#chkVendor_"+i);vt=a.find("#chkProspect_"+i);ot=a.find("#chkEmployee_"+i);r.setValue(h.location);yt=a.find("#VISFileDialog_"+i);pt=a.find("#imgBPartner_"+i);wt=a.find("#txtMobile_"+i);bt=a.find("#txtWebUrl_"+i);ui();u>0?(e.val(h.bpRelationID),s.val(h.bpGroupID),o.val(h.bpLocationID),p.val(n.Utility.decodeText(h.name)),w.val(n.Utility.decodeText(h.searchKey)),d.val(),st.val(n.Utility.decodeText(h.name2)),pt.removeAttr("src").attr("src",h.userImage),b.val(n.Utility.decodeText(h.contact)),k.val(),g.val(n.Utility.decodeText(h.title)),tt.val(n.Utility.decodeText(h.email)),nt.val(n.Utility.decodeText(h.phoneNo)),ht.val(n.Utility.decodeText(h.phoneNo2)),it.val(n.Utility.decodeText(h.fax)),k.val(h.greeting),d.val(h.greeting1),r.setValue(h.location),wt.val(h.mobile),bt.val(h.WebUrl),h.isCustomer&&ft.attr("checked","checked"),h.isVendor&&et.attr("checked","checked"),h.isEmployee&&ot.attr("checked","checked"),dt(e.val(),i,h.bpLocationID)):lt>0&&at>0&&(a.find("#ddlBPRelation_"+i).val(lt),a.find("#ddlBPGroup_"+i).val(at),dt(e.val(),i,h.bpLocationID));r.getBtn(0).css("width","10%");r.getBtn(0).css("height","30px");r.getBtn(0).css("padding","0px");r.getBtn(1).css("width","10%");r.getBtn(1).css("height","30px");r.getBtn(1).css("padding","0px");v.append(r.getControl().css("width","80%")).append(r.getBtn(0)).append(r.getBtn(1));rt=a.find("#divAddress_"+i).find("Input");ct=a.find("#divAddress_"+i).find("Button").eq(1);oi(i,f,u);e.on("change",function(){dt(e.val(),i)});w.on("focusout",function(){w.val()==""?t("#divSearchKey").css("visibility","visible"):t("#divSearchKey").css("visibility","collapse ")});p.on("focusout",function(){p.val()==""?t("#divName").css("visibility","visible"):t("#divName").css("visibility","collapse")});s.on("focusout",function(){s.val()=="0"||s.val()==""?t("#divBPGroup").css("visibility","visible"):t("#divBPGroup").css("visibility","collapse ")});rt.on("focusout",function(){r.getValue()<=0?t("#divAddressValidate_"+i).css("visibility","visible"):t("#divAddressValidate_"+i).css("visibility","collapse ")});ct.on("focusout",function(){r.getValue()<=0?t("#divAddressValidate_"+i).css("visibility","visible"):t("#divAddressValidate_"+i).css("visibility","collapse ")});b.on("focusout",function(){b.val()==""?t("#divContact_"+i).css("visibility","visible"):t("#divContact_"+i).css("visibility","collapse")});return a}function kt(n,t,i){return"<DIV class='vis-BPsplitter' style='width:"+n+"'><span style='background-color: white; position: relative;top: -0.8em;margin-left: "+i+"px;'> "+t+" <\/span><\/DIV>"}function ui(){yt.on("change",function(){ni=Date.now().toString();var t=new XMLHttpRequest,i=new FormData;i.append("file",yt[0].files[0]);i.append("fileKey",ni);t.open("POST",n.Application.contextUrl+"BPartner/SaveImageAsByte",!0);t.setRequestHeader("Cache-Control","no-cache");t.setRequestHeader("Pragma","no-cache");t.send(i);t.addEventListener("load",function(n){var i=n.target.response,r=JSON.parse(i),t=JSON.parse(r);pt.removeAttr("src").attr("src","data:image/jpg;base64,"+t[0]);gt=t[1]},!1)})}function fi(){w.off("focusout");p.off("focusout");s.off("focusout");rt.off("focusout");ct.off("focusout");b.off("focusout");r.dispose();r=null;p=null;st=null;rt=null;b=null;tt=null;it=null;k=null;d=null;nt=null;ht=null;w=null;g=null;c=null;f.remove();f.empty()}function ei(i){u=new n.ChildDialog;u.setContent(i);u.onClose=function(){fi()};var r=t(window).width();r>=1366?(u.setHeight(620),u.setWidth(870)):(u.setHeight(520),u.setWidth(670));u.setTitle(n.Msg.getMsg("BusinessPartner"));u.setEnableResize(!1);u.setModal(!0);u.show();u.getRoot().dialog({position:[200,130]})}function oi(i,f,h){u.onOkClick=function(){var l,a,u;if(y!=null?(y.show(),l=t(window).height()*(50/100),a=t(window).width()*(50/100)):t(".vis-apanel-busy").css("visibility","visible"),ut=r.getValue(),w.val().trim()=="")return n.ADialog.info("SearchKeyMandatory"),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;if(p.val().trim()=="")return n.ADialog.info("NameMandatory"),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;if(s.val().trim()=="0")return n.ADialog.info("BPGroupMandatory"),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;if(b.val().trim()=="")return n.ADialog.info("ContactMandatory"),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;if(ut<=0||ut==null)return n.ADialog.info("AddressMandatory"),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;if(ft.is(":checked")==!1&&et.is(":checked")==!1&&vt.is(":checked")==!1&&ot.is(":checked")==!1)return alert(n.Msg.getMsg("PleaseSelectBusinessType")),y!=null&&y.hide(),t(".vis-apanel-busy").css("visibility","hidden"),!1;u=null;u=f;url=n.Application.contextUrl+"BPartner/AddBPartnerInfo";var v=w.val(),rt=p.val(),st=p.val(),c=k.val(),ht=s.val(),ct=e.val(),lt=o.val(),at=b.val(),oi=d.val(),yt=g.val(),pt=tt.val(),kt=nt.val(),dt=nt.val(),ni=it.val(),ti=ft.is(":checked"),ii=et.is(":checked"),ri=vt.is(":checked"),ui=ot.is(":checked"),fi=wt.val(),ei=bt.val();window.setTimeout(function(){t.ajax({type:"Post",async:!1,url:url,dataType:"json",data:{C_BPartner_ID:h,searchKey:v,name:rt,name2:st,greeting:c,bpGroup:ht,bpRelation:ct,bpLocation:lt,contact:at,greeting1:c,title:yt,email:pt,address:ut,phoneNo:kt,phoneNo2:dt,fax:ni,windowNo:i,BPtype:u,isCustomer:ti,isVendor:ii,isProspect:ri,fileName:gt,mobile:fi,webUrl:ei,isEmployee:ui},success:function(i){n.ADialog.info("","",JSON.parse(i));y!=null&&y.hide();t(".vis-apanel-busy").css("visibility","hidden")}})},2)}}function dt(i,r,u){var f=null,e="";url=n.Application.contextUrl+"BPartner/GetBPLocation?WinNo="+r+"&bpartnerID="+i;t.ajax({type:"GET",async:!1,url:url,dataType:"json",success:function(t){f=JSON.parse(t);for(var i=0;i<f.lstBPLocation.length;i++)e+="<option value='"+f.lstBPLocation[i].ID+"'>"+n.Utility.encodeText(f.lstBPLocation[i].Name)+"<\/option>";o.empty();o.append(e);o.val(u)}})}var p=null,w=null,k=null,st=null,b=null,d=null,g=null,tt=null,nt=null,ht=null,it=null,g=null,rt=null,ct=null,y=null,lt=0,at=0,ut=null,ft=null,et=null,vt=null,ot=null,yt=null,gt=null,ni="",pt=null,wt=null,bt=null;l==null&&(t(".vis-apanel-busy").css("visibility","visible"),t(".vis-apanel-busy").css("z-index","9999999"));y=l;f!=null&&f.empty();lt=a;at=v;ti(i,h,c)}}(VIS,jQuery),function(n,t){function y(){r=null;f=null;s=null;$mainUserInfo=null;a=800;c=1048576;l=10;r=t(" <div id='mainUserInfoDiv_"+i+"'><div class='wsp-view_left_part' style='float:left;width: 45%;padding-left: 10px;padding-right: 10px'><input type='hidden' value='0' id='userID_"+i+"'><\/input> <p id='hduserName_"+i+"' style='display: none;'><\/p>  <p id='userName_"+i+"' class='wsp-view_profile_name'><\/p> <a id='dotImg_"+i+"' href='javascript:void(0)' style='display: none;'><\/a><div id='popUpDiv_"+i+"' style='display: none;'><\/div><input type='hidden' value='0' id='BPID_"+i+"'><\/input><input type='hidden' value='0' id='BPGroupID_"+i+"'><\/input><input type='hidden' value='' id='userTableID_"+i+"'><p id='companyName_"+i+"' class='wsp-view_profile_possession'><\/p><p class='wsp-view_profile_possession' style='border-bottom: 1px solid #DFDFDF; padding-bottom: 20px;' id='pContactTypeCategory_"+i+"'><\/p><div class='wsp-profile_big_img_mobile'><span id='editMobileImage_"+i+"' class='mobilespan' style='width:24px;float:right;'><input type='file' id='wsp-fileinput_"+i+"' class='wsp-file-input' value='Add Pic' style='opacity: 0; width: 7%; margin-top: -6px; float: left; z-index: 999; position: absolute; cursor: pointer;'><img src='"+n.Application.contextUrl+"Areas/WSP/Images/Edit-icon.png' style='z-index: 100; position: absolute;'><\/span><img id='mobileImg_"+i+"' width='100%' alt='Image is not available' src='Areas/VIS/Images/home/User.png'><\/div><div id='divTeam_"+i+"' class='wsp-view_team'><\/div><div id='divContactDetails_"+i+"' class='wsp-view_team'><\/div><div id='divcompanyDetails_"+i+"' class='wsp-view_team'><\/div><div id='divRole_"+i+"' class='wsp-view_team'><\/div><\/div><div class='wsp-view_right_part'  style='float:left;width: 55%;' id='WSP_view_right_part_"+i+"'><div id='userBigImg_"+i+"' class='wsp-profile_big_img' style='width: 322px;'><div class='image-upload' style='float: right; position: absolute; z-index: 999; width: 100%'> <label for='file-input' class='wsp-file-label'><span class='wsp-change-picture-ico'><\/span><\/label><input type='file' id='wsp-file-input_"+i+"' class='wsp-file-input' value='Add Pic' style='opacity: 0; width: 30%; margin-top: 0px; float: right; z-index: 999; position: absolute; right: 0px; cursor: pointer;'><\/div><div class='wsp-bigimg'> <img id='bigUserImage_"+i+"' alt='Image is not available' src='"+n.Application.contextUrl+"Areas/VIS/Images/home/User.png'><\/div><\/div><div class='wsp-action'><table id='actionTable_"+i+"' class='wsp-tableRightContent'><tbody><tr style='height:30px'> <td class='tdactionlist'><a id='edit_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'> <img src='"+n.Application.contextUrl+"Areas/WSP/Images/edit_2.png'><\/span> <p>Edit <\/p> <\/a> <\/td> <td class='tdactionlist'> <a id='sendSMS_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'> <img src='"+n.Application.contextUrl+"Areas/WSP/Images/send_sms.png'><\/span> <p> Send Sms <\/p> <\/a> <\/td> <\/tr>  <tr style='height:30px'>       <td class='tdactionlist'><a id='email_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon email_icon'>           <img src='"+n.Application.contextUrl+"Areas/WSP/Images/message.png'><\/span>           <p>Email <\/p>       <\/a>       <\/td>       <td class='tdactionlist'><a id='appointment_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'>           <img src='"+n.Application.contextUrl+"Areas/WSP/Images/appointment.png'><\/span>           <p>Appointment <\/p>       <\/a>       <\/td>   <\/tr>   <tr style='height:30px'>       <td class='tdactionlist'><a id='activity_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'>            <img src='"+n.Application.contextUrl+"Areas/WSP/Images/activity.png'><\/span>           <p>Activity<\/p>       <\/a>       <\/td>        <td class='tdactionlist'><a id='createOrder_"+i+"' href='javascript:void(0)' class='wsp-tableaction'><span class='wsp-left_icon'>           <img src='"+n.Application.contextUrl+"Areas/WSP/Images/create_order.png'><\/span>           <p>Create Order<\/p>       <\/a>        <\/td>    <\/tr>   <tr style='height:30px'>       <td class='tdactionlist'><a id='BPInfo_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'>           <img src='"+n.Application.contextUrl+"Areas/WSP/Images/bp_info.png'><\/span>           <p>BP Info<\/p>       <\/a>        <\/td>        <td class='tdactionlist'><a id='addBPartner_"+i+"' href='javascript:void(0)' class='wsp-tableaction'><span class='wsp-left_icon'>           <img src='"+n.Application.contextUrl+"Areas/WSP/Images/addBPartner.png'><\/span>           <p style=''>Add BPartner <\/p>       <\/a>       <\/td>   <\/tr> <tr style='height:30px'><td class='tdactionlist'><a id='History_"+i+"' class='wsp-tableaction' href='javascript:void(0)'><span class='wsp-left_icon'><img src='/Areas/WSP/Images/History24.png'><\/span><p>"+n.Msg.getMsg("History")+"<\/p><\/a><\/td><\/tr>   <tr>   <\/tr><\/tbody><\/table><\/div><div id='divBirthday_"+i+"' class='wsp-birthday_container' style='display: none;'><\/div><\/div><\/div>")}var i=0,o=t(document).width(),v=t(document).height(),r=null,h=0,e=null,f=null,s=null,a=null,c=null,l=null,u=null,o=t(document).width(),v=t(document).height();n.ContactInfo=function(v,p){for(var w=n.DB.executeReader("SELECT COUNT(*) FROM AD_Table WHERE TableName='C_BPartner'",null);w.read();)if(parseInt(w.getString(0))==0){n.ADialog.error("VIS_NotSupported");self.dispose();return}h=v;i=p;t(".vis-apanel-busy").css("visibility","visible");e=n.Application.contextUrl+"WSP/Contacts/UserContactInfo?WinNo="+i+"&userID="+h+"&isPartialViewLoad=true";y(h,e);this.show=function(){if(!window.WSP){alert("please download WSP !!!");t(".vis-apanel-busy").css("visibility","hidden");return}window.setTimeout(function(){u=new n.ChildDialog;u.setContent(r);u.setWidth(610);u.setTitle(n.Msg.getMsg("ContactInfo"));u.setEnableResize(!1);u.setModal(!0);u.show();u.getRoot().dialog({position:[400,0]});u.onClose=function(){dispose()};t.ajax({type:"GET",async:!1,url:e,dataType:"json",success:function(h){function ri(i,r,f){f.stopPropagation();t.ajax({type:"GET",async:!1,url:i,dataType:"json",success:function(t){var i=JSON.parse(t),f=new n.Query;r?(f.addRestriction("C_BPartner_ID",n.Query.prototype.EQUAL,i[1]),n.viewManager.startWindow(i[0],f),k.find("p").removeAttr("style"),u.close()):(f.addRestriction("C_Order_ID",n.Query.prototype.EQUAL,i[1]),win=n.viewManager.startWindow(i[0],f),win.onLoad=function(){var n=win.cPanel.curGC;n.onRowInserting=function(){win.cPanel.cmd_new(!1)};n.onRowInserted=function(){tab=win.cPanel.curTab;tab.setValue("C_BPartner_ID",et.text())}},st.find("p").removeAttr("style"),u.close())}})}var v=JSON.parse(h),p="",y,wt,nt,d;v[0].Customer!=""&&(p+=v[0].Customer);v[0].Vendor!=""&&(v[0].Customer!=""&&(p+=","),p+=v[0].Vendor);v[0].Employee!=""&&((v[0].Customer!=""||v[0].Vendor!="")&&(p+=","),p+=v[0].Employee);v[0].Prospect!=""&&((v[0].Customer!=""||v[0].Vendor!=""||v[0].Employee!="")&&(p+=","),p+=v[0].Prospect);var ht=r.find("#divRole_"+i),ct=r.find("#divTeam_"+i),b=r.find("#divContactDetails_"+i),it=r.find("#dotImg_"+i),w=r.find("#userID_"+i),lt=r.find("#userTableID_"+i),rt=r.find("#hduserName_"+i),ft=r.find("#userName_"+i),et=r.find("#BPID_"+i),bt=r.find("#BPGroupID_"+i),ui=r.find("#companyName_"+i),fi=r.find("#pContactTypeCategory_"+i),ai=r.find("#mobileImg_"+i),ur=r.find("#team_"+i),fr=r.find("#teamNotFound_"+i),vi=r.find("#address_"+i),yi=r.find("#country_"+i),pi=r.find("#postal_"+i),wi=r.find("#phone_"+i),bi=r.find("#userEmail_"+i),er=r.find("#emailNotFound_"+i),kt=r.find("#divcompanyDetails_"+i),ei=r.find("#companyNotFound"+i),or=r.find("#role_"+i),ki=r.find("#roleNotFound_"+i),at=r.find("#bigUserImage_"+i),ot=r.find("#divBirthday_"+i),sr=r.find("#userBigImg_"+i),k=r.find("#edit_"+i);s=r.find("#WSP_dots_"+i);var dt=r.find("#sendSMS_"+i),gt=r.find("#email_"+i),g=r.find("#BPInfo_"+i),st=r.find("#createOrder_"+i),vt=r.find("#addBPartner_"+i),di=r.find("#History_"+i),yt=r.find("#appointment_"+i),pt=r.find("#activity_"+i),gi=r.find("#ImportContacts_"+i),tt=r.find("#wsp-file-input_"+i),oi=r.find("#wsp-fileinput_"+i),hr=r.find(".WSP_profile_big_img"),nr=r.find(".WSP_profile_big_img_mobile"),si=null,tr=r.find("#mainUserInfoDiv_"+i),ni=!1,ut=!1,ti=!1,v=JSON.parse(h),hi="",ii="";for(w.empty(),w.append(v[0].UserID),rt.empty(),rt.append(v[0].FirstName),rt.hide(),ft.empty(),it.empty(),p==""||p==null?(k.removeAttr("href"),k.css("cursor","auto"),k.find("p").css("color","black"),g.removeAttr("href"),g.css("cursor","auto"),g.find("p").css("color","black")):(k.attr("href","javascript:void(0)"),k.css("cursor","pointer"),k.removeAttr("style"),g.attr("href","javascript:void(0)"),g.css("cursor","pointer"),g.removeAttr("style")),o>=1e3&&o<=1024?v[0].FirstName.length>15?(it.show(),ft.append(v[0].FirstName.substring(0,15)).append(it.append("..."))):ft.append(v[0].FirstName):v[0].FirstName.length>20?(it.show(),ft.append(v[0].FirstName.substring(0,20)).append(it.append("..."))):ft.append(v[0].FirstName),et.empty(),et.append(v[0].BPartnerID),lt.append(v[0].TableID),bt.empty(),bt.append(v[0].BPGroupID),ui.empty(),ui.append(v[0].CompanyName),fi.empty(),fi.append(p),ai.removeAttr("src").attr("src",v[0].Image),ct.empty(),ct.append("<p>"+n.Msg.getMsg("Teams")+"<\/p>"),y=0;y<v.length;y++)v[y].Team!=""&&v[y].Team!=null&&(ni=!0,ii+=y==0||ii==""?v[y].Team:", "+v[y].Team);for(ni||ct.append(" <p  id='teamNotFound_"+i+"' style='word-break: break-all; font-style: italic;'>"+n.Msg.getMsg("NotFound")+"<\/p>"),ni&&ct.append(" <p id='team_"+i+"' >"+ii+"<\/p>"),vi.empty(),b.empty(),b.append("<p style='word-break: break-all;'> "+n.Msg.getMsg("ContactDetails")+" <a href='javascript:void(0)'> <img style='margin-bottom:3px' id='showAddressOnGoogleMap_"+i+"' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/ToLink20.png'> <\/a><\/p> "),y=0;y<v.length;y++)v[y].FirstName==""&&v[y].Address!=""&&v[y].Address!=null&&(ut=!0,b.append("<p id='address_"+i+"' style='word-break: break-all'>"+v[y].Address+"<\/p>"));for(yi.empty(),v[0].CountryName!=""&&v[0].CountryName!=null&&(ut=!0,b.append("<p id='country_"+i+"' style='word-break: break-all'>"+v[0].City+"("+v[0].CountryName+")<\/p> ")),pi.empty(),v[0].Postal!=""&&v[0].Postal!=null&&(ut=!0,b.append("<p id='postal_"+i+"' style='word-break: break-all'>"+n.Msg.getMsg("ZipCode")+": "+v[0].Postal+"<\/p>")),wi.empty(),y=0;y<v.length;y++)v[y].FirstName==""&&v[y].PhoneNo!=""&&v[y].PhoneNo!=null&&(ut=!0,o<=1024?b.append("<a href='tel:"+v[y].PhoneNo+"'><p id='phone_"+i+"' style='word-break: break-all'><span class='wsp-caller'><img src='"+n.Application.contextUrl+"Areas/WSP/Images/caller.png'><\/span>"+v[y].PhoneNo+"<\/p><\/a>"):b.append("<p id='phone_"+i+"' style='word-break: break-all'><span class='wsp-caller'><img src='"+n.Application.contextUrl+"Areas/WSP/Images/caller.png'><\/span>"+v[y].PhoneNo+"<\/p>"));for(bi.empty(),v[0].Email!=""&&v[0].Email!=null&&(ut=!0,b.append("<p id='userEmail_"+i+"' style='word-break: break-all;display: inline-flex;margin-top: 0;'> <span class='wsp-caller'><img src='"+n.Application.contextUrl+"Areas/WSP/Images/sms.png'><\/span>"+v[0].Email+"<\/p>")),!ut,kt.empty(),kt.append("<p>"+n.Msg.getMsg("Company")+"<\/p>"),kt.append("<p id='companyDetails_"+i+"' style='word-break: break-all'>"+v[0].CompanyName+"<\/p>"),ei.empty(),v[0].CompanyName!=""&&v[0].CompanyName!=null&&ei.append(n.Msg.getMsg("NotFound")),ht.empty(),ht.append("<p>"+n.Msg.getMsg("RoleAssign")+"<\/p>"),y=0;y<v.length;y++)v[y].Role!=""&&v[y].Role!=null&&(ti=!0,hi+=y==0?v[y].Role:", "+v[y].Role);ti&&ht.append("<p id='role_"+i+"'>"+hi+"<\/p>");ki.empty();ti||ht.append("<p id='roleNotFound_"+i+"' style='word-break: break-all; font-style: italic;'>"+n.Msg.getMsg("NotFound")+"<\/p>");v[0].Image.indexOf("User")>0?at.removeAttr("src").attr("src",n.Application.contextUrl+"Areas/VIS/Images/home/User.png"):at.removeAttr("src").attr("src",v[0].Image);ot.empty();var ci=new Date,li=new Date(v[0].Birthday),ir=ci.getMonth()+1+"/"+ci.getDate(),rr=li.getMonth()+1+"/"+li.getDate();v[0].Birthday!=""?(ot.show(),ot.css("border","1px solid #1886BF"),wt=t("<div class='wsp-birthdat_text'>"),rr==ir&&wt.append("<p> "+n.Msg.getMsg("Today")+" "+n.Msg.getMsg("is")+" <span class='wsp-birthday_text_highlight'>"+v[0].FirstName+"<\/span> "+n.Msg.getMsg("Birthday")+"<\/p>"),wt.append("<p>"+v[0].FirstName+" "+n.Msg.getMsg("Birthday")+" "+n.Msg.getMsg("on")+"  <span class='wsp-birthday_text_highlight'>"+v[0].Birthday+"<\/span><\/p> <\/div>"),ot.append(wt)):ot.hide();it.on("click",function(n){$popUp.show();var t=r.find("<div class='arrow_box'> <p style='margin-left:5px;margin-top:5px;margin-right:5px'>"+rt.text()+"<\/p><\/div>");$popUp.append(t);$popUp.delay(2e3).fadeOut();n.stopPropagation()});if(s!=null)s.on("click",function(n){tr.animate({right:"-1000px"},a);n.stopPropagation()});t(".ui-dialog-content").on("click",function(n){t("#w2ui-overlay").hide();n.stopPropagation()});nt=t("<ul id='ulEditOption' class='vis-apanel-rb-ul'>");d=t("<ul id='ulCreateOrder' class='vis-apanel-rb-ul'>");k.on("click",function(r){var u,h,e;if(p==""||p==null)return r.preventDefault(),!1;k.find("p").css("background-color","#e0e0e0");r.stopPropagation();var o=w.text(),s=p.split(",");if(s.length>1){for(t("#w2ui-overlay").show(),nt!=null&&nt.empty(),u=t("<div/>"),u.css("width","auto"),u.css("height","100%"),nt.css("width","auto"),nt.css("height","100%"),h="",e=0;e<s.length;e++)h+="<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' id='"+s[e].trim()+"_"+i+"'>"+n.Msg.getMsg(s[e].trim())+"<\/li>";nt.append(h);u.append(nt);k.w2overlay(u.clone(!0),{css:{height:"300px"}});u.css("top","395px");nt.load()}else p==n.Msg.getMsg("Employee")&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Employee Master&userID="+o),p==n.Msg.getMsg("Customer")&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Customer Master&userID="+o),p==n.Msg.getMsg("Vendor")&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Vendor Master&userID="+o),p==n.Msg.getMsg("Prospect")&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Prospects&userID="+o),ri(f,!0,r)});nt.on("click","LI",function(i){t("#w2ui-overlay").hide();var r=t(this).text();r==n.Msg.getMsg("Employee")&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Employee Master&userID="+w.text());r==n.Msg.getMsg("Customer")&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Customer Master&userID="+w.text());r==n.Msg.getMsg("Vendor")&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Vendor Master&userID="+w.text());r==n.Msg.getMsg("Prospect")&&(f=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Prospects&userID="+w.text());ri(f,!0,i);i.stopPropagation()});dt.on("click",function(i){dt.find("p").css("background-color","#e0e0e0");t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");i.stopPropagation();window.setTimeout(function(){var r=new n.Sms(null,null,0,!0),i=new n.CFrame;i.setName(n.Msg.getMsg("Sms"));i.setTitle(n.Msg.getMsg("Sms"));i.hideHeader(!0);i.setContent(r);i.show();r.initializeComponent();t(".vis-apanel-busy").css("visibility","hidden");u.close()},2)});gt.on("click",function(r){gt.find("p").css("background-color","#e0e0e0");t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");r.stopPropagation();window.setTimeout(function(){var f=new n.Email(t("#userEmail_"+i).text(),null,null,w.text(),!0,!0,lt.text()),r=new n.CFrame;r.setName(n.Msg.getMsg("EMail"));r.setTitle(n.Msg.getMsg("EMail"));r.hideHeader(!0);r.setContent(f);r.show();f.initializeComponent();t(".vis-apanel-busy").css("visibility","hidden");u.close()},2)});g.on("click",function(i){if(p==""||p==null)return i.preventDefault(),!1;g.find("p").css("background-color","#e0e0e0");window.setTimeout(function(){var r=w.text(),i="";i=n.Application.contextUrl+"WSP/Contacts/GetWindowID?windowName=Business Partner Info&userID="+r;t.ajax({type:"GET",async:!1,url:i,dataType:"json",success:function(t){var i=JSON.parse(t),r=new n.Query;r.addRestriction("C_BPartner_ID",n.Query.prototype.EQUAL,i[1]);n.viewManager.startWindow(i[0],r);g.find("p").removeAttr("style");u.close()}})},500)});st.on("click",function(r){var u,f;st.find("p").css("background-color","#e0e0e0");t("#w2ui-overlay").show();t("#w2ui-overlay").find("div").empty();d!=null&&d.empty();u=t("<div/>");u.css("width","auto");u.css("height","100%");d.css("width","auto");d.css("height","100%");f=t("<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' id='SaleOrder_"+i+"'>"+n.Msg.getMsg("Sales Order")+"<\/li> <li  style='margin-top:10px;margin-left:10px;margin-right:13px;font-size: 15px' id='PurchaseOrder_"+i+"' >"+n.Msg.getMsg("PurchaseOrder")+"<\/li>");d.append(f);u.append(d);st.w2overlay(u.clone(!0),{css:{height:"300px"}});u.css("top","395px");r.stopPropagation();d.load()});d.on("click","LI",function(i){t("#w2ui-overlay").hide();var r=t(this).text();e=n.Application.contextUrl+"WSP/Contacts/GetWindowAndOrderID?windowName="+r+"&userID="+w.text();ri(e,!1,i);i.stopPropagation()});vt.on("click",function(t){vt.find("p").css("background-color","#e0e0e0");t.stopPropagation();$saleOrder=null;$purchaseOrder=null;n.AddUpdateBPartner(i,0,p,null,et.text(),bt.text());vt.find("p").removeAttr("style")});di.on("click",function(){var t=new n.AttachmentHistory(lt.val(),w.text(),et.text(),0,"AD_User_ID");t.show()});yt.on("click",function(r){r.stopPropagation();yt.find("p").css("background-color","#e0e0e0");t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");window.setTimeout(function(){n.AppointmentsForm.init(lt.text(),t("#userID_"+i).text(),n.context.getAD_User_ID(),rt.text(),!1);yt.find("p").removeAttr("style");t(".vis-apanel-busy").css("visibility","hidden");u.close()},500)});gi.on("click",function(n){n.stopPropagation();t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");window.setTimeout(function(){WSP.importcontacts(self);t(".vis-apanel-busy").css("visibility","hidden")},50)});pt.on("click",function(r){r.stopPropagation();pt.find("p").css("background-color","#e0e0e0");t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");window.setTimeout(function(){n.AppointmentsForm.init(0,t("#userID_"+i).text(),n.context.getAD_User_ID(),rt.text(),!0);pt.find("p").removeAttr("style");t(".vis-apanel-busy").css("visibility","hidden")},500)});tt.on("change",function(){t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");var f=w.text(),i=new XMLHttpRequest,r=new FormData,u=tt;if(r.append("file",u[0].files[0]),r.append("userID",f),u[0].files[0].size/c>l){alert(n.Msg.getMsg("UploadedFileSizeLimit"));tt.replaceWith(tt.val("").clone(!0));return}i.open("POST",n.Application.contextUrl+"WSP/Contacts/SaveImageAsByte",!0);i.setRequestHeader("Cache-Control","no-cache");i.setRequestHeader("Pragma","no-cache");i.send(r);i.addEventListener("load",function(n){var i=n.target.response,r=JSON.parse(i);image=JSON.parse(r);at.removeAttr("src").attr("src","data:image/jpg;base64,"+image[1]);t(".vis-apanel-busy").css("visibility","hidden")},!1);tt.val("")});oi.on("change",function(){t(".vis-apanel-busy").css("visibility","visible");t(".vis-apanel-busy").css("z-index","999999999999");var f=w.text(),i=new XMLHttpRequest,r=new FormData,u=tt;if(r.append("file",u[0].files[0]),r.append("userID",f),u[0].files[0].size/c>l){alert(n.Msg.getMsg("UploadedFileSizeLimit"));return}i.open("POST",n.Application.contextUrl+"WSP/Contacts/SaveImageAsByte",!0);i.setRequestHeader("Cache-Control","no-cache");i.setRequestHeader("Pragma","no-cache");i.send(r);i.addEventListener("load",function(n){var i=n.target.response,r=JSON.parse(i);image=JSON.parse(r);at.removeAttr("src").attr("src","data:image/jpg;base64,"+image[1]);nr.removeAttr("src").attr("src","data:image/jpg;base64,"+image[1]);t(".vis-apanel-busy").css("visibility","hidden")},!1)});si=b.find("#showAddressOnGoogleMap_"+i);si.on("click",function(){var n=b.find("#address_"+i).text()+b.find("#country_"+i).text(),t="http://local.google.com/maps?q="+n;window.open(t)});t(".vis-apanel-busy").css("visibility","hidden")}})},2)}}}(VIS,jQuery),function(n,t){function i(){function b(){h=t('<div style="width:100%;height:100%">');u=t("<ul class='vis-apanel-rb-ul' style='width:100%;height:100%'>");e=t("<li data-isfav='no' data-id='favaction'>").append(n.Msg.getMsg("AddFav"));o=t("<li data-isfav='yes' data-id='favaction'>").append(n.Msg.getMsg("RemoveFav"));l=t("<li data-isfav='"+i.data("isfav")+"' data-id='favaction'>").append(n.Msg.getMsg("OpenNewTab"));u.append(e);u.append(o);u.append(l);h.append(u);d()}function k(n){i=n;f=i.data("value");a=i.data("action");s=i.data("actionid");y=i.data("name");v=i.data("isfav");p||(b(),p=!0);v=="yes"?(e.css("display","none"),o.css("display","block")):(e.css("display","block"),o.css("display","none"));i.w2overlay(h.clone(!0),{css:{height:"300px"}})}function d(){e.on("click",w);o.on("click",w);l.on("click",g)}function w(){v=="yes"?(i.removeClass("vis-favitmchecked"),i.addClass("vis-favitmunchecked"),i.data("isfav","no"),tt(f),n.favMgr.removeFavourite(f)):(r={},r.Action=a,r.WindowID=s,r.FormID=s,r.ProcessID=s,r.NodeID=f,r.Name=y,i.removeClass("vis-favitmunchecked"),i.addClass("vis-favitmchecked"),i.data("isfav","yes"),nt(f),n.favMgr.addFavourite(r))}function g(){n.viewManager.startActionInNewTab(a,s)}function nt(i){t.ajax({url:n.Application.contextUrl+"Home/SetNodeFavourite/?nodeID="+i,dataType:"json"})}function tt(i){t.ajax({url:n.Application.contextUrl+"Home/RemoveNodeFavourite/?nodeID="+i,dataType:"json"})}function it(n){c||(c=t("#vis_divTree"));var r=c.children(0).find("[data-value='"+n+"']"),i=t(r.children()[1]);i.removeClass("vis-favitmchecked");i.addClass("vis-favitmunchecked");i.data("isfav","no")}var h=null,u=null,f=null,i=null,r=null,c=null,e=null,o=null,l=null,a,s,y,v,p=!1;return{removeFavourite:it,showOverlay:k}}n.FavouriteHelper=i()}(VIS,jQuery),function(n,t){function i(i,r,u,f,e,o,s,h,c,l){function pf(){k=o;k?s!=null&&s!=undefined&&(li=s):(li=r.gridTable.AD_Table_ID,v=u.getSelectedRows(),w=r.getRecords()[r.getCurrentRow()]);et=t('<ul class="vis-email-ul" ><\/ul>');rt=t("<div>");rt.css("position","absolute");rt.css("bottom","0");rt.css("background","url('"+n.Application.contextUrl+"Areas/VIS/Images/LoadingCircle.gif') no-repeat");rt.css("background-position","center center");rt.css("width","98%");rt.css("height","98%");rt.css("text-align","center");rt.css("opacity",".1");rt[0].style.visibility="hidden"}function wf(){e?(dt=t('<img  class="vis-email-sendbtn" title="'+n.Msg.getMsg("SendMail").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-send.png"> <\/img>'),ii.append(dt)):(dt=t('<img  class="vis-email-saveAttachbtn" title="'+n.Msg.getMsg("SaveAttachment").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-saveAttachment.png"> <\/img>'),ii.append(dt));k||(vi=t('<img  class="vis-email-btns" title="'+n.Msg.getMsg("Preview").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-preview.png"> <\/img>'),ii.append(vi),pi=t('<img  class="vis-email-btns" title="'+n.Msg.getMsg("SaveAs").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-saveas.png"> <\/img>'),ii.append(pi),ht=t('<img  class="vis-email-btns"  title="'+n.Msg.getMsg("Save").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-save.png"> <\/img>'),ii.append(ht),yi=t('<img  class="vis-email-btns" title="'+n.Msg.getMsg("Open").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-open.png"> <\/img>'),ii.append(yi));e||(ru=t('<img  class="vis-email-btns" title="'+n.Msg.getMsg("SavePdf").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/email-savepdf.png"> <\/img>'),uu=t('<img  class="vis-email-btns" style="width:20px" title="'+n.Msg.getMsg("NewLetter").replace("&","")+'" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/New24.png"> <\/img>'),ii.append(ru).append(uu))}function bf(){var i={windowNo:p.windowNo,language:n.Env.getAD_Language(n.Env.getCtx())};t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Email/Init",data:i,success:function(n){kf(n)}})}function kf(n){var r,u;a.append(t(n));r=0;st=a.find("#"+p.windowNo+"_dyndis");a.find(".vis-email-attachmentContainer").hide();d=a.find(".vis-email-leftDiv");ki=a.find(".vis-Email-BccList");g=a.find("#"+p.windowNo+"_emailSubject");er=a.find(".vis-DMSAttachDocList");tr=a.find(".vis-dmsdocumentheader");window.VADMS||(er.css("display","none"),tr.css("display","none"));c!=undefined&&c!=null&&g.val(c);sr=a.find("#"+p.windowNo+"_vis-email-attacImg");ai=a.find("#"+p.windowNo+"_vis-Email-textarea");hr=a.find(".vis-Email-leftFooter");a.find(".contentArea").css("height",a.height()-44);a.find(".vis-Email-textarea-div").css({"margin-top":"10px"});u=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());u==!0&&a.find(".vis-Email-textarea-div").css({overflow:"auto"});a.find(".vis-email-leftDiv").height(a.height()-44);a.find(".vis-Email-rytWrap").height(a.height()-44);k?(a.find(".vis-form-data-sub").css("margin-top","0px"),a.find(".vis-email-leftDiv").hide(),a.find(".vis-Email-rytWrap").hide(),at=a.find("#"+p.windowNo+"_emailToTop"),nt=a.find("#"+p.windowNo+"_emailBccTop"),ot=a.find("#"+p.windowNo+"_eamilCcTop"),nt.hide(),ot.hide(),a.find(".vis-Email-textarea-div").height(a.height()-180),a.find(".vis-Email-leftWrap").css("width","100%"),a.find(".vis-Email-leftFooter").hide(),r=a.width()-40,st.prop("checked",!1),a.find(".vis-Email-topinputWrap").css("overflow","auto"),st.hide(),i!=undefined&&i!=null&&at.val(i),a.find(".vis-form-data-sub").width(a.width()-85)):e?(a.find(".vis-Email-topinputWrap").hide(),at=a.find("#"+p.windowNo+"_emailTo"),nt=a.find("#"+p.windowNo+"_emailBcc"),ot=a.find("#"+p.windowNo+"_eamilCc"),a.find(".vis-Email-textarea-div").height(a.height()-145),or=a.find("#"+p.windowNo+"_emailRefresh"),r=a.width()-90,a.find(".vis-Email-leftWrap").width(r-350),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-60)):(a.find(".vis-Email-rytWrap").hide(),a.find(".vis-Email-topinputWrap").hide(),sr.hide(),a.find(".vis-Email-textarea-div").height(a.height()-142),a.find(".vis-Email-leftWrap").css("margin-right","20px"),r=a.width()-240,a.find(".vis-Email-leftWrap").width(r-25),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-60));window.VADMS?a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height()-(a.find(".vis-Email-rytForm").height()+70)-520):a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height()-(a.find(".vis-Email-rytForm").height()+70)-280);lt=a.find(".vis-Email-ContentWrap");lt.css("width",r);y!=null&&y!=undefined&&(y.body.style.width=r-370+"px");wu=!0}function df(){try{ai.kendoEditor({tools:["bold","italic","underline","strikethrough","justifyLeft","justifyCenter","justifyRight","justifyFull","insertUnorderedList","insertOrderedList","indent","outdent","createLink","unlink","insertImage","insertFile","subscript","superscript","createTable","addRowAbove","addRowBelow","addColumnLeft","addColumnRight","deleteRow","deleteColumn","viewHtml","formatting","cleanFormatting","fontName",{name:"fontSize",items:[].concat([{text:"8px",value:"8px"}],[{text:"12px",value:"12px"}],[{text:"16px",value:"16px"}],[{text:"20px",value:"20px"}],[{text:"24px",value:"24px"}])},"foreColor","backColor"],keyup:ku,encoded:!1});y=ai.data("kendoEditor");y.value("");h!=undefined&&h!=null&&y.value(h)}catch(t){return console.log(t),n.ADialog.error("PleaseInstallKendoUIModule"),p.dispose(),p=null,!1}return!0}function ku(){(y.value()!=""||g.val()!="")&&(ct=1)}function du(n){var i,t,f;if(n==!0&&(v=u.getSelectedRows(),w=r.getRecords()[r.getCurrentRow()]),u.singleRow&&v.length==0)gu();else if(v.length>0){for(i="",t=0;t<v.length;t++)e&&v[t].email!=null&&(e=!0,f=v[t][r.getKeyColumnName().toLower()],i+='<li class="vis-list-li-bcc"  data-email="'+v[t].email+'"><input data-currentrec="Y" data-recID="'+f+'" id="'+p.windowNo+"_"+v[t].email+'_CheckBoxList1" type="checkbox" value="'+v[t].email+'" checked/><label class="vis-chcklist-label"  for="'+p.windowNo+"_"+v[t].email+'_CheckBoxList1">'+v[t].email+"("+f+")<\/label><\/li>");et.append(i);i=null}else gu();n||ki.append(et)}function gu(){if(e&&w.email!=null){e=!0;var n=w[r.getKeyColumnName().toLower()];et.append('<li class="vis-list-li-bcc" data-email="'+w.email+'"><input id="'+p.windowNo+"_"+w.email+'_CheckBoxList1" type="checkbox" value="'+w.email+'" checked /><label class="vis-chcklist-label" for="'+p.windowNo+"_"+w.email+'_CheckBoxList1">'+w.email+"("+n+")<\/label><\/li>")}}function nf(i){var h,f,e,o,s,u;for(i?it.empty():(di=t('<div class="vis-apanel-lb-toggle">'),kt=t('<img src="'+n.Application.contextUrl+'Areas/VIS/Images/Action.png" style="cursor:pointer" ><\/img>'),gt=t('<div class="vis-apanel-lb-toggle" style="border:none;height:100%;overflow-x:hidden;overflow-y: hidden;"><\/div>'),fi=t("<div class='vis-apanel-lb-oflow' style='border-top:0;display:none' >"),fi.html("<a data-dir='u' href='javascript:void(0)'><img style='margin-left:10px' data-dir='u' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/arrow-top.png' ><\/a><a data-dir='d' href='javascript:void(0)' ><img style='margin-left:10px' data-dir='d' src='"+n.Application.contextUrl+"Areas/VIS/Images/base/arrow-bottom.png' /><\/a>"),gi=t('<div class="vis-apanel-lb-toggle" style="padding-top:5px;height:50px;overflow-x:hidden;overflow-y: hidden;"><\/div>'),gi.append(fi),di.append(kt),d.append(di),d.append(gt),d.append(gi),it=t('<ul class="vis-apanel-lb-ul"><\/ul>'),it.css({overflow:"auto","overflow-x":"hidden","white-space":"nowrap",width:"150%"})),h="",f=0;f<r.gridTable.getFields().length;f++)if(e=r.gridTable.getFields(0)[f].getColumnName().toUpper()==r.getKeyColumnName().toUpper(),r.gridTable.getFields(0)[f].getIsDisplayed()||e){if(e||(h+="<li>"+r.gridTable.getFields(0)[f].getHeader()+"<\/li>"),o=[],s=[],r.gridTable.getFields(0)[f].getColumnName().toUpper().equals(ei))for(u=0;u<v.length;u++)n.DisplayType.IsLookup(r.getField(ei).getDisplayType())?v[u][ei.toLower()]!=null&&(o.push(v[u][ei.toLower()]),s.push(v[u][r.getKeyColumnName().toLower()])):v[u][ei.toLower()]!=null&&(o.push(v[u][ei.toLower()]),s.push(v[u][r.getKeyColumnName().toLower()]));gf(o,s)}e||it.append(h);i||gt.append(it);it.children("li").on("click",ee)}function tf(){if(!k)if(it.height()>t(it.parent()).height()){gt.css("border-bottom","1px solid white");fi.css("display","inherit");var n=gi.height()+di.height()+60;gt.height(d.height()-n);d.css("overflow","hidden");gt.css({"overflow-x":"hidden",width:"107%","overflow-y":"visible"})}else gt.css("border-bottom","none"),fi.css("display","none")}function gf(i,r){for(var f,e=0;e<i.length;e++){var u=n.dataContext.getJSONData(n.Application.contextUrl+"Email/GetUser",{BPartner_ID:i[e]},null),o="";if(u!=null)for(f in u)if(u[f].Email!=null){if(u[f].Email==null||u[f].Email=="")continue;if(t(et.children("li").data(u[f].Email+r[e])).length>0)continue;o+='<li  class="vis-list-li-bcc"><input data-currentrec="N" data-recid="'+r[e]+'" id="'+p.windowNo+"_"+u[f].Email+'_CheckBoxList1" type="checkbox"  value="'+u[f].Email+'" checked/><label class="vis-chcklist-label"  for="'+p.windowNo+"_"+u[f].Email+'_CheckBoxList1">'+u[f].Email+"("+r[e]+")<\/label><\/li>"}et.append(o);o=null}}function ne(){g.on("change",ku);if(!k)fi.on("click",function(n){var r,e;if(n.stopPropagation(),r=t(n.target).data("dir"),r){var o=it.parent().height(),s=it.height(),u=it.parent().scrollTop(),f=Math.ceil(o/2),i=0;if(r=="d"){if(u+f>=s-f)return;e=s-o;i=u+f;it.parent().animate({scrollTop:i>e?e:i},1e3,"easeOutBounce")}else if(r=="u"){if(u==0)return;i=u-f;it.parent().animate({scrollTop:i<0?0:i},1e3,"easeOutBounce")}}});sr.on("click",function(){te()});ui.on("click","li",function(i){var u,r;if(i.stopPropagation(),u=t(this).attr("value"),parseInt(u)==0)re(i);else if(parseInt(u)==1){if(t("#w2ui-overlay").hide(),pt!=null&&pt.GetDmsCloseOrNot()){n.ADialog.info("DMSAlreadyOpen");return}r=new n.CFrame;pt=new VADMS.DocumentManagementSystem;r.setName(n.Msg.getMsg("VADMS_Document"));r.setTitle(n.Msg.getMsg("VADMS_Document"));r.hideHeader(!0);pt.setWindowNo(p.windowNo);pt.OpenFromEmail(!0);r.setContent(pt);pt.initialize();r.show()}});if(e){dt.on("click",se);if(or!=null&&or!=undefined)or.on("click",ve)}else dt.on("click",he);if(!e){ru.on("click",ce);uu.on("click",le)}if(k)a.find(".vis-Email-CcBcc").on("click",ye);else{kt.on("click",ie);st.on("click",fe);vi.on("click",oe);yi.on("click",sf);pi.on("click",hf);ht.on("click",vu);kt.trigger("click")}lf();e||g.keyup(function(){ct=g.val()!=""?y.value()!=""?1:0:0})}function te(){var i,r;ui!=null&&ui.empty();i=t("<div/>");i.css("width","auto");i.css("height","100%");ui.css("width","auto");ui.css("height","100%");r="<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' class='vis-filesystem' value='0'>"+n.Msg.getMsg("FileSystem")+"<\/li> ";window.VADMS&&(r+="<li style='margin-top:15px;margin-left:10px;margin-right:13px;font-size: 15px' class='vis-dms' value='1'>"+n.Msg.getMsg("DMS")+"<\/li>");ui.append(r);i.append(ui);sr.w2overlay(i.clone(!0),{css:{height:"300px"}});i.css("top","395px");ui.load()}function ie(n){st.prop("checked")==!0?d.width()==40?(e?(middleDivWidth=ri-(a.find(".vis-email-leftDiv").width()+200),a.find(".vis-Email-leftWrap").width(middleDivWidth-355),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-45),lt.width(middleDivWidth)):(middleDivWidth=ri-(a.find(".vis-email-leftDiv").width()+200),a.find(".vis-Email-leftWrap").width(middleDivWidth-15),a.find(".vis-form-data-sub").width(middleDivWidth-40),lt.width(middleDivWidth)),d.css("width","200px"),d.find("ul").show(),tf(),y!=null&&y!=undefined&&(y.body.style.width=y.body.style.width-160)):(cu(),gt.css("border-bottom","none"),k||fi.css("display","none")):d.width()!=40&&cu();n.stopPropagation()}function cu(){d.css({width:"40px"});d.find("ul").hide();e?(middleDivWidth=ri-(a.find(".vis-email-leftDiv").width()+40),a.find(".vis-Email-leftWrap").width(middleDivWidth-355),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-45),lt.width(middleDivWidth)):(middleDivWidth=ri-(a.find(".vis-email-leftDiv").width()+40),a.find(".vis-Email-leftWrap").width(middleDivWidth-15),a.find(".vis-form-data-sub").width(middleDivWidth-40),lt.width(middleDivWidth));y!=null&&y!=undefined&&(y.body.style.width=y.body.style.width+160)}function re(){var n;if(gr==!1){if(a.find(".vis-email-attachmentContainer").is(":visible"))a.find(".vis-email-attachmentContainer").hide(),a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height()+(a.find(".vis-email-attachmentContainer").height()+13));else if(n=a.find(".vis-Email-ContentArea").height(),a.find(".vis-email-attachmentContainer").show(),a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height()-(a.find(".vis-email-attachmentContainer").height()+13)),ft==null||ft==undefined){rf();ft=a.find("<input type='file' multiple='true' style='display:none;'>");nu.append(ft);cr.on("click",function(){ft.trigger("click")});ft.change(function(){lu(this)})}}else a.find(".vis-email-attachmentContainer").is(":visible")||(n=a.find(".vis-Email-ContentArea").height(),(ft==null||ft==undefined)&&(rf(),ft=t("<input type='file' multiple='true' style='display:none;'>"),ft.change(function(){this.files.length<1||(a.find(".vis-email-attachmentContainer").show(),lu(this),k?a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-ContentArea").height()-(a.find(".vis-form-horizontal").height()+30)):a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-ContentArea").height()-(a.find(".vis-form-horizontal").height()+50)),ef())}))),ft.trigger("click")}function rf(){nu=t("<div><\/div>");var n=t("<div><\/div>");if(a.find(".vis-email-attachmentContainer").append(n),gr==!1&&(cr=t('<a class="vis-attach-ico browse-ico" style="margin-right:8px;float:right;height:30px;width:30px;margin-top:6px;"><\/a>'),nu.append(cr),n.append(cr)),tu=t("<div><\/div>"),n.append(tu),si=t("<div class='vis-attach-content-wrap' style='height:83px;border-bottom:2px solid white;padding-bottom:0px'>"),si.append(t('<div style="height:auto;overflow:auto" ><\/div>')),tu.append(si),a.find(".vis-email-attachmentContainer").append(lr),gr==!1){iu=t("<div><\/div>");n.append(iu);fu=t('<a href="javascript:void(0)" class="vis-attach-ico uploadall-ico" style="height:30px;width:30px;margin-right: 7px;float:right"><\/a>');iu.append(fu);fu.on("click",function(){ef()})}}function uf(){return si.children(0).height()<75?!1:!0}function fe(){this.checked?(d.width()!=40&&d.find("ul").show(),e==!0&&u.singleRow==!1&&v.length>1&&(at.val(""),at.prop("disabled",!0),ot.val(""),ot.prop("disabled",!0),nt.val(""),nt.prop("disabled",!0)),ou=!0):(d.width()!=40&&cu(),e==!0&&u.singleRow==!1&&v.length>1&&(at.prop("disabled",!1),ot.prop("disabled",!1),nt.prop("disabled",!1)),ou=!1,gt.css("border-bottom","none"),k||fi.css("display","none"))}function ee(){y.paste("@@"+t(this).text()+"@@")}function oe(){var f=y.value(),e="",r,i;e=u.singleRow==!1||v.length>0?pe(f,0):we(f);r=t("<div><\/div>");r.append(e);t(r.find("table")).css({width:"100%",border:"1px solid Black"});t(r.find("td")).css({border:"1px solid Black"});i=new n.ChildDialog;i.setHeight(420);i.setWidth(850);i.setTitle(n.Msg.getMsg("Preview"));i.setModal(!0);i.setContent(r);i.show();i.hidebuttons()}function se(t){var i=g.val(),r=y.value(),u=!0;if((i==null||i==""||i.trim().length==0)&&(r==null||r==""||r.trim().length==0)){u=!1;n.ADialog.confirm("SendWithoutSubjectandBody",!0,"","Confirm",function(n){n&&pr(t,i,r)});return}if(i==null||i==""||i.trim().length==0){u=!1;n.ADialog.confirm("SendWithoutSubject",!0,"","Confirm",function(n){n&&pr(t,i,r)});return}if(r==null||r==""||r.trim().length==0){u=!1;n.ADialog.confirm("SendWithoutBody",!0,"","Confirm",function(n){n&&pr(t,i,r)});return}u&&pr(t,i,r)}function pr(i,e){var k,ut,l,s,o,ft,ht,ct,a,it,c,h,wt,lt;yt=!1;var d=at.val(),b=nt.val(),g=ot.val();if(d.trim().length>0)if(d.contains(";")){for(s=d.split(";"),o=0;o<s.length;o++)if(s[o]!=null&&s[o]!="")if(bt(s[o].trim()))yt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+s[o])},2);return}}else if(bt(d.trim()))yt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+d)},2);return}if(g.trim().length>0)if(g.contains(";")){for(s=g.split(";"),o=0;o<s.length;o++)if(s[o]!=null&&s[o]!="")if(bt(s[o].trim()))yt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+s[o])},2);return}}else if(bt(g.trim()))yt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+g)},2);return}if(b.trim().length>0)if(b.contains(";")){for(s=b.split(";"),o=0;o<s.length;o++)if(s[o]!=null&&s[o]!="")if(bt(s[o].trim()))yt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+s[o])},2);return}}else if(bt(b.trim()))yt=!0;else{window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+b)},2);return}if(k=[],st.prop("checked")==!1){if(ut=!1,l={},l.To=d,l.Cc=g,l.Bcc=[],b.contains(";"))for(s=b.split(";"),o=0;o<s.length;o++)s[o]!=null&&s[o]!=""&&l.Bcc.push(s[o]);else b!=null&&b!=""&&l.Bcc.push(b);if(et!=null&&et!=undefined&&(tt=[],t("[id*=CheckBoxList1]:checked").each(function(){tt.push(t(this).val())}),tt.length>0))for(a=0;a<tt.length;a++){if(!bt(tt[a])){window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+tt[a])},2);return}ut=!0;l.Bcc.push(tt[a])}if(l.Subject=e,l.TableID=li,l.Recordids="",w!=null)if(u.singleRow==!1||v.length>0){for(ft="",c=0;c<v.length;c++)ft+=v[c][r.keyColumnName.toLower()]+",";l.Recordids=ft}else l.Recordids=f>0?f:u.singleRow==!0?r.getField(r.keyColumnName.toLower()).value:w[r.keyColumnName.toLower()];else f>0&&(l.Recordids=f);if(l.AttachmentFolder=vr,!ut&&!yt){window.setTimeout(function(){n.ADialog.info("NoEmailAddressFound")},2);return}k.push(l)}else if(tt=[],ht=[],ct=[],t("[id*=CheckBoxList1]:checked").each(function(){tt.push(t(this).val());ht.push(t(this).data("recid"));ct.push(t(this).data("currentrec"))}),tt.length>0){for(a=0;a<tt.length;a++)if(!bt(tt[a])){window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+tt[a])},2);return}for(it=0;it<tt.length;it++)if(u.singleRow==!0&&v.length==0){if(h=ur(w,0),h==null||h==undefined)return;k.push(h)}else for(c=0;c<v.length;c++)if(ht[it]==v[c][r.getKeyColumnName().toLower()]){if(h=null,h=ct[it]=="N"?ur(v[c],c,tt[it]):ur(v[c],c),h==null||h==undefined)continue;k.push(h)}}else if(yt)if(u.singleRow==!0&&v.length==0){if(h=ur(w,0),h==null||h==undefined)return;k.push(h)}else for(c=0;c<v.length;c++)(h=ur(v[c],c),h!=null&&h!=undefined)&&k.push(h);if(k.length==0){window.setTimeout(function(){n.ADialog.info("NoEmailAddressFound")},2);return}wt=JSON.stringify(k);lt=!1;n.ADialog.confirm("WantAlertMessage",!0,"","Confirm",function(i){i&&(lt=!0);rt[0].style.visibility="visible";var r={mails:n.Utility.encodeText(wt),AD_User_ID:vt.getAD_User_ID(),AD_Client_ID:vt.getAD_Client_ID(),AD_Org_ID:vt.getAD_Org_ID(),attachment_ID:dr,fileNamesFornNewAttach:JSON.stringify(bi),fileNamesForopenFormat:JSON.stringify(hi),mailFormat:n.Utility.encodeText(y.value()),notify:lt,strDocAttach:n.context.getContext("DocumentAttachViaEmail_"+p.windowNo)};t.ajax({url:n.Application.contextUrl+"Email/SendMail",data:r,datatype:"json",type:"post",cache:!1,async:!0,success:function(t){rt[0].style.visibility="hidden";var i=JSON.parse(t);i==""?(p.dispose(),p=null,pt!=null&&pt.dispose(),pt=null):window.setTimeout(function(){n.ADialog.info(i);i.contains("MailSent")&&n.context.setContext("DocumentAttachViaEmail_"+p.windowNo,"")},2)}})})}function bt(n){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n)}function he(){var e,i,h,o,s;if(e=g.val(),e==null||e==""||e.trim().length==0){n.ADialog.info("PleaseAddSubject");return}if(i=y.value(),i!=null&&i!=""&&i!=undefined&&!(i.trim().length<1)){if(h="",o={},v=u.getSelectedRows(),w=r.getRecords()[r.getCurrentRow()],u.singleRow==!1||v.length>0)for(s=0;s<v.length;s++)o[v[s][r.keyColumnName.toLower()]]=yu(i,s);else f>0?o[f]=br(i):o[w[r.keyColumnName.toLower()]]=br(i);rt[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Email/SaveAttachment",datatype:"json",type:"post",cache:!1,data:{subject:e,AD_Table_ID:li,html:n.Utility.encodeText(i),values:JSON.stringify(o)},success:function(){rt[0].style.visibility="hidden";n.ADialog.info("Saved")},error:function(n){console.log(n)}})}}function ce(){var i=y.value(),o,f,e;if(i!=null&&i!=""&&i!=undefined&&!(i.trim().length<1)){if(o="",f=[],v=u.getSelectedRows(),w=r.getRecords()[r.getCurrentRow()],u.singleRow==!1||v.length>0)for(e=0;e<v.length;e++)f.push(yu(i,e));else f.push(br(i));rt[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Email/InsertAttachmentText",datatype:"json",type:"post",cache:!1,data:{html:n.Utility.encodeText(i),values:JSON.stringify(f)},success:function(t){var i,r;rt[0].style.visibility="hidden";i=JSON.parse(t);bu=i;r=bu;window.open(n.Application.contextUrl+r);return}})}}function le(t){rr=!1;ir=0;ct==1?(y.value()!=""||g.val()!="")&&n.ADialog.confirm("DoYouWantToSave",!0,"","Confirm",function(n){n?(vu(t),ct=0,ir=1):(g.val(""),y.value(""),oi=0,ht.css("opacity","1"),ct=0)}):(g.val(""),y.value(""),oi=0,ht.css("opacity","1"),ct=0)}function sf(t){var r=0,i;au=0;i=new n.Openmailformat(u.gTab.getAD_Window_ID(),e);ae=i;e||(ir=0,y.value()!=""&&g.val()!=""&&ct==1&&(n.ADialog.confirm("DoYouWantToSave",!0,"","Confirm",function(n){n?(vu(t),au=1,rr=!0):(oi=0,ht.css("opacity","1"),ct=0,i.show())}),r=1));r==0&&i.show();i.onClose=function(){ct=0;var n=i.getSelectedRow();n!=null&&n!=undefined&&(oi=n.AD_TEXTTEMPLATE_ID,wr=n.AD_CLIENT_ID,g.val(n.SUBJECT),wr!=vt.getAD_Client_ID()?ht.css("opacity","0.4"):ht.css("opacity","1"),n.ISDYNAMICCONTENT=="Y"?st.prop("checked",!1).trigger("click"):st.prop("checked",!0).trigger("click"),fr=n.AD_Window_ID!=null&&n.AD_Window_ID!=undefined&&n.AD_Window_ID>0?!1:!0,kr=n.NAME,y.value(n.MAILTEXT));rr=!1}}function hf(){var i=y.value(),t;i!=null&&i.trim()!=""&&i!=undefined&&(t=new n.Newmailformat(e),t.show(),t.onClose=function(){kr=t.getName();fr=t.saveForAll();cf(0)})}function vu(){if(wr==vt.getAD_Client_ID()){var n=y.value();n!=null&&n!=""&&n!=undefined&&(oi>0?cf(oi):hf())}}function ve(){et.empty();du(!0);nf(!0)}function cf(i){var u={id:i,AD_Client_ID:vt.getAD_Client_ID(),AD_Org_ID:vt.getAD_Org_ID(),name:n.Utility.encodeText(kr),isDynamic:st.prop("checked"),subject:n.Utility.encodeText(g.val()),text:n.Utility.encodeText(y.value()),saveforAll:fr,AD_Window_ID:r.getAD_Window_ID(),folderName:vr,attachmentID:dr};t.ajax({type:"POST",url:n.Application.contextUrl+"Email/SaveFormats",data:u,success:function(n){oi=parseInt(n);wr=vt.getAD_Client_ID();ht.css("opacity","1");ct=0;e||(ir==1&&(g.val(""),y.value("")),rr==!0&&window.setTimeout(function(){au==1&&(sf(),rr=!1)},200))}})}function ye(){nt.is(":visible")?(nt.hide(),ot.hide(),a.find(".vis-email-attachmentContainer").is(":visible")?a.find(".vis-Email-textarea-div").height(a.height()-365):a.find(".vis-Email-textarea-div").height(a.height()-180)):(nt.show(),ot.show(),a.find(".vis-email-attachmentContainer").is(":visible")?a.find(".vis-Email-textarea-div").height(a.height()-440):a.find(".vis-Email-textarea-div").height(a.height()-255))}function ur(t,i,e){var c=!1,o={},s,i,h;if(o.To=at.val(),o.Cc=ot.val(),o.Bcc=[],nt.val().contains(";"))for(s=nt.val().split(";"),i=0;i<s.length;i++)s[i]!=null&&s[i]!=""&&o.Bcc.push(s[i]);else nt.val()!=null&&nt.val()!=""&&o.Bcc.push(nt.val());if(e)bt(e)||window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+e);return},2),o.Bcc.push(e),c=!0;else if(et!=null&&et!=undefined)if(Object.keys(t).indexOf("email")>-1&&tt.indexOf(t.email)>-1)bt(t.email)||window.setTimeout(function(){n.ADialog.info("NotValidEmail",!0,":"+t.email);return},2),o.Bcc.push(t.email),c=!0;else if((!u.singleRow!=!1||v.length!=1)&&(!u.singleRow==!1||v.length>1))return;if(h=g.val(),h.trim().length==0&&(h="  "),o.Subject=h,o.TableID=li,o.Recordids=u.singleRow==!0&&v.length==0?f:t[r.keyColumnName.toLower()],o.Body=u.singleRow==!1?yu(y.value(),i):br(y.value()),o.AttachmentFolder=vr,u.singleRow!=!0&&v.length!=1||c||yt)return o}function yu(t,i){for(var e=t,s={};e.indexOf("@@")>-1;){e=e.substring(e.indexOf("@@")+2);var h=e.substring(0,e.indexOf("@@")),o=null,f=Object.keys(u.getColumnNames()).filter(function(n){return u.getColumnNames()[n]===h})[0];f!=undefined&&f!=null&&(n.DisplayType.IsLookup(r.getField(f).getDisplayType())||n.DisplayType.Location==r.getField(f).getDisplayType()?v[i][f.toLower()]!=null&&v[i][f.toLower()]!=undefined&&(o=r.getField(f.toLower()).lookup.getDisplay(v[i][f.toLower()])):n.DisplayType.IsDate(r.getField(f).getDisplayType())?(o=r.getField(f).value,o=new Date(o).toLocaleString()):o=v[i][f.toLower()]);e=e.substring(e.indexOf("@@")+2);s["@@"+h+"@@"]=o}return s}function br(t){for(var f=t,o={};f.indexOf("@@")>-1;){f=f.substring(f.indexOf("@@")+2);var s=f.substring(0,f.indexOf("@@")),e=null,i=Object.keys(u.getColumnNames()).filter(function(n){return u.getColumnNames()[n]===s})[0];i!=undefined&&i!=null&&(n.DisplayType.IsLookup(r.getField(i).getDisplayType())||n.DisplayType.Location==r.getField(i).getDisplayType()?w[i.toLower()]!=null&&w[i.toLower()]!=undefined&&(e=r.getField(i.toLower()).lookup.getDisplay(w[i.toLower()])):n.DisplayType.IsDate(r.getField(i).getDisplayType())?(e=r.getField(i).value,e=new Date(e).toLocaleString()):e=u.singleRow==!0&&v.length==0?r.getField(i).value:w[i.toLower()]);f=f.substring(f.indexOf("@@")+2);o["@@"+s+"@@"]=e}return o}function pe(t,i){for(var s=t,e=t;e.indexOf("@@")>-1;){e=e.substring(e.indexOf("@@")+2);var h=e.substring(0,e.indexOf("@@")),o=null,f=Object.keys(u.getColumnNames()).filter(function(n){return u.getColumnNames()[n]===h})[0];f!=undefined&&f!=null&&(n.DisplayType.IsLookup(r.getField(f).getDisplayType())||n.DisplayType.Location==r.getField(f).getDisplayType()?v[i][f.toLower()]!=null&&v[i][f.toLower()]!=undefined&&(o=r.getField(f.toLower()).lookup.getDisplay(v[i][f.toLower()])):n.DisplayType.IsDate(r.getField(f).getDisplayType())?(o=r.getField(f).value,o=new Date(o).toLocaleString()):o=v[i][f.toLower()]);e=e.substring(e.indexOf("@@")+2);s=o!=null&&o!=undefined?s.replace("@@"+h+"@@",o):s.replace("@@"+h+"@@","")}return s}function we(t){for(var f=t;f.indexOf("@@")>-1;){f=f.substring(f.indexOf("@@")+2);var o=f.substring(0,f.indexOf("@@")),e=null,i=Object.keys(u.getColumnNames()).filter(function(n){return u.getColumnNames()[n]===o})[0];i!=undefined&&i!=null&&(n.DisplayType.IsLookup(r.getField(i).getDisplayType())||n.DisplayType.Location==r.getField(i).getDisplayType()?e=w[i.toLower()]!=null&&w[i.toLower()]!=undefined?r.getField(i.toLower()).lookup.getDisplay(w[i.toLower()]):"":n.DisplayType.IsDate(r.getField(i).getDisplayType())?(e=r.getField(i).value,e=new Date(e).toLocaleString()):u.singleRow==!0&&v.length==0?(e=r.getField(i).value,e==null&&(e="")):e=w[i.toLower()]);f=f.substring(f.indexOf("@@")+2);t=t.replace("@@"+o+"@@",e)}return t}function lf(){var n=0;a.height(pu);a.width(ri);a.find(".contentArea").css("height",a.height()-44);a.find(".vis-Email-BccList").height(1);a.find(".vis-email-leftDiv").height(a.height()-44);k?(a.find(".vis-email-attachmentContainer").is(":visible")?a.find(".vis-Email-textarea-div").height(a.height()-345):a.find(".vis-Email-textarea-div").height(a.height()-180),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-85),n=a.width()-40):e?(a.find(".vis-email-attachmentContainer").is(":visible")?a.find(".vis-Email-textarea-div").height(a.height()-(a.find(".vis-email-attachmentContainer").height()+150)):a.find(".vis-Email-textarea-div").height(a.height()-(a.find(".vis-email-attachmentContainer").height()+70)),n=ri-(a.find(".vis-email-leftDiv").width()+30),a.find(".vis-Email-leftWrap").width(n-355),a.find(".vis-form-data-sub").width(a.find(".vis-Email-leftWrap").width()-45)):(a.find(".vis-Email-textarea-div").height(a.height()-155),y!=null&&y!=undefined,n=ri-(a.find(".vis-email-leftDiv").width()+30),a.find(".vis-Email-leftWrap").width(n-15),a.find(".vis-form-data-sub").width(n-40));lt!=null&&lt.css("width",n-10);y!=null&&y!=undefined&&(y.body.style.width=n-370+"px");k||(window.VADMS?a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height()-(a.find(".vis-Email-rytForm").height()+310)):a.find(".vis-Email-BccList").height(a.find(".vis-Email-rytContent").height()-(a.find(".vis-Email-rytForm").height()+70)))}var su,ar,yr,lu,ir;this.frame=null;this.windowNo=n.Env.getWindowNo();var vt=n.Env.getCtx(),ti=null,ei="C_BPARTNER_ID",v=null,w=null,oi=0,kr,fr,b=[],af=[],si=null,dr=0;l&&(dr=l);var gr=!0,yt=!1,li=0,tt=[],k=!1,hi=[],bi=[],it=null,a=null,d=null,lt=null,ki=null,er=null,kt=null,et=null,st=null,at=null,nt=null,ot=null,or=null,sr=null,g=null,ai=null,y=null,hr=null,vi=null,dt=null,yi=null,pi=null,ht=null,vf=null,rt,ii=t('<div class="vis-awindow-header vis-menuTitle">'),p=this,nu,cr,tu,iu,ru,uu,fu,pu=0,ri=0,be=p.windowNo;a=t('<div class="vis-email-rootDiv vis-forms-container"><\/div>');var eu=t('<div class="vis-email-rootDivBusy"><\/div>'),ui=t("<ul id='ulAttachmentOption' class='vis-apanel-rb-ul'>"),pt=null,wu=!1,di,gt,gi,ou=!1,lr=t("<div style='width: 100%;height: 100%;background:black;opacity: .1;display:none'>"),wi=null;wi=n.Application.isRTL?t("<div id='progress_bar' class='vis-ui-progress-bar ui-container' style='top:41%;width: 80%;right: 10%;'>"):t("<div id='progress_bar' class='vis-ui-progress-bar ui-container' style='top:41%;width: 80%;left: 9%;'>");lr.append(wi);su=t("<div class='vis-ui-progress' style='width: 0%; display: block;position:absolute;margin-top:2px'>");wi.append(su);ar=t("<span class='ui-label' >").append("0%");wi.append(ar);var hu=0,ci=0,vr=Date.now().toString(),wt=1048576,ni=0,nr=0,yf=[],bu="",ft=null,ut,tr=null,fi,ct=0;pf();this.initializeComponent=function(){var i=null,r;(e==!0?(i=t('<a href="javascript:void(0)"  class="vis-mainMenuIcons vis-icon-menuclose"><\/a>'),r=k?t("<p>"+n.Msg.getMsg("EMail")+" ("+n.Msg.getMsg("Contacts")+") <\/p>"):t("<p>"+n.Msg.getMsg("EMail")+" ("+u.aPanel.$parentWindow.getName()+") <\/p>")):(i=t('<a href="javascript:void(0)"  class="vis-mainMenuIcons vis-icon-menuclose"><\/a>'),r=k?t("<p>"+n.Msg.getMsg("Letter")+" ("+n.Msg.getMsg("Contacts")+") <\/p>"):t("<p>"+n.Msg.getMsg("Letter")+" ("+u.aPanel.$parentWindow.getName()+") <\/p>")),a.append(ii.append(i).append(r)),i.click(function(n){p.dispose();p=null;n.stopPropagation()}),bf(),df()!=!1)&&(a.append(rt),wf(),k||e&&du(!1),k||nf(!1),ne())};this.getRoot=function(){return a};this.leftULsize=function(){if(!k){var n=gi.height()+di.height()+60;t(it.parent()).height(d.height()-n);ou==!0&&tf()}};yr=function(n){n?(lr.show(),wi.show()):(lr.hide(),wi.hide())};lu=function(i){for(var f,u,c,e,l,v,o,y,d,w,h,r=0;r<i.files.length;r++){if(ut=i.files[r],ut==undefined)return;if(ut.size!=0){for(u in b)if(ut.name==b[u].name){window.setTimeout(function(){n.ADialog.info("fileAlreadyAttached")},2);return}if(hi!=null)for(f=0;f<hi.length;f++)if(ut.name==hi[f]){window.setTimeout(function(){n.ADialog.info("fileAlreadyAttached")},2);return}ni=0;for(u in b)ni+=b[u].size;if(ni+ut.size>wt*24){window.setTimeout(function(){n.ADialog.info("MaxFileSize25MB")},2);return}if(ut.size>wt*24){window.setTimeout(function(){n.ADialog.info("MaxFileSize25MB")},2);return}c={};e=t("<div style='margin-bottom:3px' class='vis-attach-file-wrapla'>");si.children(0).append(e);l=t("<div class='vis-attach-file-top'>");v=t("<a class='vis-file-close-ico'>");l.append(v);e.append(l);si.show();v.on("click",function(){var i=t(t(this).parent()).parent(),r=i.html(),n;i.remove();i=null;for(n in b)if(String(r).indexOf(b[n].name)>-1){ni=ni-n.size;b.splice(n,1);break}bi.splice(0,bi.length);for(n in b)bi.push(b[n].name);uf()||(a.find(".vis-attach-content-wrap").height(83),a.find(".vis-email-attachmentContainer").height(90),k?a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height()-(t(".vis-form-horizontal").height()+30)):a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height()-(t(".vis-form-horizontal").height()+50)));b.length==0&&(a.find(".vis-email-attachmentContainer").hide(),a.find(".vis-email-attachmentContainer").height(90),a.find(".vis-attach-content-wrap").height(83),k?a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height()-(t(".vis-form-horizontal").height()+30)):a.find(".vis-Email-textarea-div").height(t(".vis-Email-ContentArea").height()-(t(".vis-form-horizontal").height()+50)));ci--});o=t("<div class='vis-attach-file-content'>");e.append(o);y=t("<div class='vis-attach-file-icon'>");d=ff(ut.name);y.append(t("<img src='"+d+"'>"));o.append(y);var p=t("<div class='vis-attach-file-text' style='margin-bottom:10px'>"),g="",s=t("<p>");ut.name.length>17?(g=ut.name.toString().substr(0,17),s.append(g),w=t("<a href='javascript:void(0)' class='VIS_Pref_tooltip'>").append("..."),h=t("<span style='width: inherit;'>"),h.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/email-ccc.png").append("ToolTip Text")),h.append(t("<label class='VIS_Pref_Label_Font'>").append(ut.name)),w.append(h),s.append(w)):s.append(ut.name);p.append(s);p.append(t("<p>").append((Number(ut.size)/1024).toFixed(2)+"KB"));o.append(p);c.Name=ut.name;c.Size=ut.size;b.push(ut);uf()&&a.find(".vis-email-attachmentContainer").height()==90&&(a.find(".vis-email-attachmentContainer").height(155),a.find(".vis-attach-content-wrap").height(145))}}};var ff=function(t){var r,u,i;return t==null||t.length==0?"":(r=t.lastIndexOf("."),u=n.Application.contextUrl+"Areas/VIS/Images/",r<1)?u+"defult.png":(i=t.substr(r,t.length-r),u+(i==".xlsx"||i==".xls"?"excel.png":i==".html"||i==".htm"?"html.png":i==".pdf"?"pdf.png":i==".ppt"?"ppt.png":i==".txt"?"text.png":i==".docx"||i==".doc"?"word.png":i==".xml"?"xml.png":"defult.png"))},ke=function(i,r){var s=t("<div class='vis-attach-file-wrapla'>"),h,c,u,f,l,v,o;si.append(s);h=t("<div class='vis-attach-file-top'>");c=t("<a class='vis-file-close-ico'>");h.append(c);s.append(h);c.on("click",function(){var n=t(t(this).parent()).parent(),r,i;n.css("display","none");r=n.html();n.empty();n=null;for(i in hi)if(String(r).indexOf(hi[i])>-1){hi.splice(i,1);break}});u={};f=t("<div class='vis-attach-file-content'>");s.append(f);l=t("<div class='vis-attach-file-icon'>");l.append(t("<img src='"+ff(i)+"'>"));f.append(l);var a=t("<div class='vis-attach-file-text'  style='margin-bottom:10px'>"),y="",e=t("<p>");i.length>17?(y=i.toString().substr(0,17),e.append(y),v=t("<a href='javascript:void(0)' class='VIS_Pref_tooltip'>").append("..."),o=t("<span style='width: inherit;'>"),o.append(t("<img class='VIS_Pref_callout'>").attr("src",n.Application.contextUrl+"Areas/VIS/Images/email-ccc.png").append("ToolTip Text")),o.append(t("<label class='VIS_Pref_Label_Font'>").append(i)),v.append(o),e.append(v)):e.append(i);a.append(e);a.append(t("<p>").append((Number(r)/1024).toFixed(2)+"KB"));f.append(a);u.Name=i;u.Line_ID=0;u.HaveSource=!1;u.Source=null;u.IsDeleted=!1;af.push(u)},ef=function(){var t=null,i=0,r=0,n;ni=0;for(n in b)i=parseInt(b[n].size/wt),ut.size%wt>0&&i++,ni+=i,r+=b[n].size,t={},bi.push(b[n].name),t.Name=b[n].name,t.Size=b[n].size,yf.push(t);r>wt*24||(yr(!0),of())},of=function(){var t,i,r;if((b==null||b.length==0)&&(yr(!1),a.find(".vis-email-attachmentContainer").hide(),a.find(".vis-Email-textarea-div").height(a.find(".vis-Email-textarea-div").height()+(a.find(".vis-email-attachmentContainer").height()+13)),window.setTimeout(function(){n.ADialog.info("NothingToUpload");return},2)),ci>=b.length){yr(!1);return}t=new XMLHttpRequest;i=new FormData;i.append("file",b[ci].slice(nr*wt,nr*wt+Number(wt)));t.open("POST",n.Application.contextUrl+"Email/SaveAttachmentinTemp?filename="+b[ci].name+"&folderKey="+vr,!1);t.send(i);hu++;nr++;r=parseInt(b[ci].size/wt);b[ci].size%wt>0&&r++;nr==r&&(ci++,nr=0);hu<=ni&&ue(parseInt(hu/ni*100));window.setTimeout(function(){of()},2)},ue=function(n){su.css("width",n+"%");ar.empty();ar.append(n+"%")};ir=0;var wr=vt.getAD_Client_ID(),rr=!1,ae=null,au=0;this.show=function(){ti=new n.ChildDialog;ti.setHeight(800);ti.setWidth(1600);ti.setTitle(n.Msg.getMsg("EMail"));ti.setModal(!0);ti.show();ti.setContent(a);initializeComponent()};this.disposeComponent=function(){vt=null;ti=null;ei="";v=null;w=null;li=0;tt=null;k||(yi!=null&&yi.off("click"),vi!=null&&vi.off("click"),ht!=null&&ht.off("click"),pi!=null&&pi.off("click"),kt!=null&&kt.off("click"),it!=null&&it.remove(),kt!=null&&kt.remove(),et!=null&&et.remove(),st!=null&&st.remove(),ai!=null&&ai.remove());dt!=null&&dt.off("click");ft!=null&&ft!=undefined&&(ft.off("change"),ft.off("click"));it=null;a!=null&&a.remove();a=null;d!=null&&d.remove();d=null;lt!=null&&lt.remove();lt=null;ki!=null&&ki.remove();ki=null;kt=null;et=null;st=null;e&&(at!=null&&at.remove(),at=null,nt!=null&&nt.remove(),nt=null,ot!=null&&ot.remove(),ot=null);g!=null&&g.remove();g=null;ai=null;y!=null&&y!=undefined&&y.destroy();y=null;hr!=null&&hr.remove();hr=null;vi=null;dt=null;vf=null;yi=null;ht=null;pi=null};this.sizeChanged=function(n,t){pu=n;ri=t;wu==!0&&(lf(),this.leftULsize())};this.ShowDMSDocumentAttchment=function(){var r=null,f=null,u,i;if(er.children().remove(),u=t("<ul><\/ul>"),n.context.getContext("DocumentAttachViaEmail_"+p.windowNo)!=""){for(tr.empty(),tr.append(n.Msg.getMsg("Documents")),r=n.context.getContext("DocumentAttachViaEmail_"+p.windowNo).split(","),i=0;i<r.length;i++)r[i].trim()!=""&&(f=r[i].split("-"),u.append("<Li><input type='checkbox' checked value='"+f[0]+"'> "+f[1]+"<\/Li>"));er.append(u)}else tr.empty();u.on("click","input",function(){var r="",e=t(this).attr("value"),o,u,i,f;if(t(this).is(":checked"))t(this).is(":checked")&&(f=e+"-"+t(this).text(),r=n.context.getContext("DocumentAttachViaEmail_"+p.windowNo)+(r!=""?","+f:f));else for(o=n.context.getContext("DocumentAttachViaEmail_"+p.windowNo).split(","),u=jQuery.grep(o,function(n){if(!n.trim().contains(e.toString().trim()))return n}),i=0;i<u.length;i++)r+=i==0?u[i].trim():","+u[i].trim();n.context.setContext("DocumentAttachViaEmail_"+p.windowNo,r)})};this.IsBusy=function(n){n?eu.css("display","block"):eu.css("display","none");eu.appendTo(a)}}i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;t.hideHeader(!0);this.initializeComponent();this.frame.getContentGrid().append(this.getRoot())};i.prototype.refresh=function(){window.VADMS&&this.ShowDMSDocumentAttchment();this.leftULsize()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Email=i}(VIS,jQuery),function(n,t){n.Newmailformat=function(i){function s(){var r,i;e=t('<div class="vis-forms-container" ><\/div>');var o=t("<div><\/div>"),s=t('<div style="overflow:auto;margin-bottom:10px"><\/div>'),h=t('<p  style="float:left;margin-right:10px"  >'+n.Msg.getMsg("Name")+"<\/p>");u=t('<input type="text" style="float:left;margin-right:4px" ><\/input>');s.append(h).append(u);f=t('<input type="checkbox" style="float:right"><\/input>');r=t('<p  style="float:right;margin-bottom:0px;margin-right:4px"  >'+n.Msg.getMsg("ForAllWindows")+"<\/p>");i=t("<div><\/div>");n.Application.isRTL&&(h.css({float:"right","margin-right":"0px","margin-left":"0px"}),u.css({float:"right","margin-right":"10px","margin-left":"0px"}),f.css("float","left"),r.css({float:"left","margin-right":"5px"}),i.css({float:"right","margin-bottom":"-5px"}));i.append(r).append(f);o.append(s).append(i);e.append(o)}function h(){return u.val()==null||u.val()==""?(n.ADialog.info("FileNameMendatory"),!1):(o.onClose(),!0)}function c(){e.remove();e=null;u.remove();u=null;f.remove();f=null;r=null}var e,u,f,r,o=this;s();this.show=function(){r=new n.ChildDialog;i?r.setTitle(n.Msg.getMsg("EmailFormats")):r.setTitle(n.Msg.getMsg("LetterFormats"));r.setModal(!0);r.setContent(e);r.show();r.onOkClick=h;r.onClose=c};this.getName=function(){return u.val()};this.saveForAll=function(){return f.prop("checked")}}}(VIS,jQuery),function(n,t){n.Openmailformat=function(i,r){function l(){u=n.dataContext.getJSONData(n.Application.contextUrl+"Email/GetMailFormat",{Window_ID:i},null)}function a(){var n=w2ui.openformatgrid.getSelection();return o=w2ui.openformatgrid.get(n),h.onClose(),!0}function v(){u=null;s=null;f=null;w2ui.openformatgrid!=undefined&&w2ui.openformatgrid.destroy();e.remove()}var s,u=null,o={},h=this,c=[],e,f;this.onClose=null;l();this.show=function(){var o,l,i,s,c,h;if(e=t('<div class="vis-forms-container" style="height:304px"><\/div>'),f=new n.ChildDialog,n.Application.isRTL?f.setHeight(435):f.setHeight(430),f.setWidth(850),r?f.setTitle(n.Msg.getMsg("EmailFormat")):f.setTitle(n.Msg.getMsg("LetterFormat")),f.setModal(!0),f.setContent(e),f.show(),f.onOkClick=a,f.onClose=v,o=[],l=[],u!=null){for(i in u)u[i].name=="NAME"?o.push({field:u[i].name,caption:n.Msg.getMsg("Name"),size:"20%",hidden:!1}):u[i].name=="SUBJECT"?o.push({field:u[i].name,caption:n.Msg.getMsg("Subject"),size:"20%",hidden:!1}):u[i].name=="MAILTEXT"?o.push({field:u[i].name,caption:n.Msg.getMsg("Mailtext"),size:"20%",hidden:!1}):u[i].name=="CREATED"?o.push({field:u[i].name,caption:n.Msg.getMsg("Created"),size:"20%",hidden:!1}):u[i].name=="ISDYNAMICCONTENT"?o.push({field:u[i].name,caption:n.Msg.getMsg("IsDynamicContent"),size:"20%",hidden:!1}):o.push({field:u[i].name,caption:n.Msg.getMsg(u[i].name),size:"100px",hidden:!0});for(s=0;s<u[0].RowCount;s++){c={};c.recid=s;for(h in u)c[u[h].name]=u[h].name=="MAILTEXT"?u[h].value[s]:n.Utility.encodeText(u[h].value[s]);l.push(c)}}e.w2grid({name:"openformatgrid",recordHeight:30,show:{selectColumn:!0},multiSelect:!1,columns:o,records:l})};this.getSelectedRow=function(){return o};this.getAttachments=function(){return c}}}(VIS,jQuery),function(n,t){function e(n,i,r){var u=null;return t.ajax({url:o,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function c(i,r,u,f,e,o,s,h){var a=null,y=o,p=s,c=new n.ReportViewer(f,e),v,l;s>0&&c.setNodeID(s);o>0&&c.setTreeID(o);h||c.showSummary(h);i&&c.setAD_Table_ID(i);v=function(i){var f,e,r;a=n.context.getAD_Client_ID();r=null;f=null;e=[];try{for(r=null,t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GetPrintFormats",data:{AD_Table_ID:i,AD_Tab_ID:u},success:function(t){r=(new n.DB.DataReader).toJson(t)}});r.read();)n.Utility.Util.getValueOfInt(r.get(2).toString())==a&&(f={},f.Key=n.Utility.Util.getValueOfInt(r.get(0)),f.Name=r.getString(1),e.push(f));r.close();e.length==0?f==null?l(null,i,i):l(f,0,i):l(e[0],0,i)}catch(o){r.close()}};l=function(i,f,e){var o=[],s,l;o.push(r.getTableName());o.push(r.getWhereClause(!0));u&&o.push(u.toString());s=null;s=i!=null?i.Key:f;l=c.getGenerateReportPara(o,r.getCode(0),f>0&&u>0,p,y,h,0,1,"",s);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:l,type:"POST",success:function(t){t==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var f=jQuery.parseJSON(t),u=f.repInfo;if(u.IsError){n.ADialog.error(u.ErrorText);c.close();return}u.HTML&&u.HTML.length>0&&(c.show(u.HTML,u.AD_PrintFormat_ID,i,e,o,r.getCode(0),f.pSetting),c.setReportBytes(u.Report),c.setIteration(f.pSetting.TotalPage),(n.context.ctx.$AutoArchive=="1"||n.context.ctx.$AutoArchive=="2")&&c.archiveDocument(o,e,u.Report))}})};v(i)}function l(i,r,u){function ei(n){var i=t("#reportcreate").find(".progress-bar").width()*100/t("#reportcreate").width();isNaN(i)&&(i=0);i<=n&&t("#reportcreate").removeClass("hide").find(".progress-bar").attr("aria-valuenow",n).css({width:n+"%"}).text(n.toFixed(0)+"%")}function bi(){t("#reportcreateresult").removeClass().text("")}function ki(n){bi();t("#reportcreateresult").addClass("alert alert-success").text(n);t("#forreportdownload").removeClass("hide")}function fr(){var n=window.open(),i;n.document.write("<html ><head>");n.document.write("<\/head><body >");i=t(ai);t(i.children()).css({overflow:"hidden"});n.document.write(i.html());n.document.write("<\/body><\/html>");n.print();n.close()}function ir(){fi=t('<ul style="float:right;margin-top:10px" class="vis-statusbar-ul">');v=t('<li style="opacity: 1;"><div style="width: 20px;height: 20px;float: left;"><img style="max-height: 18px;float: left;" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageFirstWhite.png" alt="First Page" title="First Page" ><\/div><\/li>');y=t('<li style="opacity: 1;"><div style="width: 20px;height: 20px;float: left;"><img style="max-height: 18px;float: left;" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageUpWhite.png" alt="Page Up" title="Page Up" ><\/div><\/li>');o=t("<select style='height:20px'>");wi=t("<li>").append(o);p=t('<li style="opacity: 1;"><div style="width: 20px;height: 20px;float: left;"><img style="max-height: 18px;float: left;" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageDownWhite.png" alt="Page Down" title="Page Down" ><\/div><\/li>');w=t('<li style="opacity: 1;"><div style="width: 20px;height: 20px;float: left;"><img style="max-height: 18px;float: left;" src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageLastWhite.png" alt="Last Page" title="Last Page" ><\/div><\/li>');fi.append(v).append(y).append(wi).append(p).append(w);er()}function er(){v.on("click",function(){t(this).css("opacity")=="1"&&ht(1)});y.on("click",function(){t(this).css("opacity")=="1"&&ht(parseInt(o.val())-1)});p.on("click",function(){t(this).css("opacity")=="1"&&ht(parseInt(o.val())+1)});w.on("click",function(){t(this).css("opacity")=="1"&&ht(parseInt(o.find("Option:last").val()))});o.on("change",function(){ht(o.val())})}function ci(n){if(o.empty(),n.TotalPage>0){for(var i=0;i<n.TotalPage;i++)o.append(t("<option value="+(i+1)+">"+(i+1)+"<\/option>"));o.val(n.CurrentPage);ot.setIteration(n.TotalPage);n.TotalPage>n.CurrentPage?(p.css("opacity","1"),w.css("opacity","1")):(p.css("opacity","0.6"),w.css("opacity","0.6"));n.CurrentPage>1?(v.css("opacity","1"),y.css("opacity","1")):(v.css("opacity","0.6"),y.css("opacity","0.6"));n.TotalPage==1&&(v.css("opacity","0.6"),y.css("opacity","0.6"),p.css("opacity","0.6"),w.css("opacity","0.6"))}else v.css("opacity","0.6"),y.css("opacity","0.6"),p.css("opacity","0.6"),w.css("opacity","0.6")}var g=t("<div style='height:100%;width:100%;'>"),h=null,ct=null,it=null,e=null,lt=null,at=null,vt=null,yt=null,pt=null,rt=null,ut=null,nt=null,tt=null,l=null,ai=null,ft=null,rr=null,a=null,et=null,dt=null,vi=n.Env.getScreenHeight()-50,si=t(window).width(),ot=this,kt,ur,st,k,hi,di,gi,oi,d,li;l=new n.CFrame;l.setName(n.Msg.getMsg("Report"));l.setTitle(n.Msg.getMsg("Report"));var gt=null,yi=t("<div>"),wt=t("<ul class='vis-apanel-rb-ul'>");yi.append(wt);var pi=!1,c=[],ui=null,ni=0,ti=0,bt,fi,v,y,wi,p,w,o,ii=!0,b=null;this.getGenerateReportPara=function(t,i,r,u,f,e,o,s,h,c){b||(b=new n.ProcessInfo("",0,a,0),b.setAD_User_ID(n.context.getAD_User_ID()),b.setAD_Client_ID(n.context.getAD_Client_ID()));b.setAD_PInstance_ID(o);b.setPageNo(s);b.setFileType(h);b.set_AD_PrintFormat_ID(c);return{processInfo:b.toJson(),queryInfo:JSON.stringify(t),code:i,isCreateNew:r,treeID:f,node_ID:u,IsSummary:e}};this.setNodeID=function(n){ni=n};this.setTreeID=function(n){ti=n};this.setAD_Table_ID=function(){a=a};this.showSummary=function(n){ii=n};this.setReportBytes=function(n){ui=n};kt=0;this.setIteration=function(n){kt=n};this.archiveDocument=function(i,r,u){s(!0);t.ajax({url:n.Application.contextUrl+"JsonData/ArchiveDoc/",dataType:"json",type:"post",data:{AD_Process_ID:0,Name:i[0],AD_Table_ID:r,Record_ID:0,C_BPartner_ID:0,isReport:!0,binaryData:u},success:function(){n.ADialog.info("Archived",!0,"","");s(!1)}})};ur=function(){for(var i,r,u,n=0;n<arguments.length;n++)i=t('<iframe style="visibility: collapse;"><\/iframe>'),t("body").append(i),r=i[0].contentDocument,u='<form action="'+arguments[n]+'" method="GET"><\/form>',r.write(u),t("form",r).submit(),setTimeout(function(n){return function(){n.remove()}}(i),2e3)};st="";k=0;this.getRoot=function(){return g};this.dispose=function(){};this.show=function(t,i,r,f,e,o,s){rr=r;a=f;et=e;ft=i;dt=o;pi=n.MRole.getDefault().getIsCanExport(a);u!=!0&&(pi?(ut.css("display","block"),rt.css("display","block"),n.context.ctx["#BULK_REPORT_DOWNLOAD"]=="Y"?(tt.css("display","block"),nt.css("display","block")):(tt.css("display","none"),nt.css("display","none"))):(ut.css("display","none"),rt.css("display","none"),tt.css("display","none"),nt.css("display","none")));ri(t);s&&ci(s)};hi=function(){if(u){var n=g.children()[1];n=null}v.off("click");y.off("click");p.off("click");w.off("click");o.off("change");g.empty();g.remove();e&&e.empty();h.empty();h.remove();l&&(l.dispose(),l=null);v=y=p=w=o=null;g=null;h=null;ct=null;it=null;e=null;lt=null;at=null;vt=null;yt=null;pt=null};this.close=function(){hi()};di=function(){n.Application.isRTL?(h=t("<div class='vis-report-header' style='padding-right: 10px;padding-left:0px;'>").append(t('<h3 class="vis-report-tittle" style="float:right;padding-top: 10px;">').append(n.Msg.getMsg("Report"))),ct=t('<a href="javascript:void(0)" class="vis-mainMenuIcons vis-icon-menuclose" style="float:left">'),it=t('<div class="vis-report-top-icons" style="float:left;">'),e=t('<ul style="margin-top: 10px;">'),it.append(e),pt=t('<li><a style="cursor:pointer;"  title="'+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Print"))+'" class="vis-report-icon vis-print-ico"><\/a><\/li>'),e.append(pt),yt=t("<li><a style='cursor:pointer;'  title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("PrintCustomize"))+"' class='vis-report-icon vis-customize-ico'><\/a><\/li>"),e.append(yt),vt=t("<li><a style='cursor:pointer;'  title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Search"))+"' class='vis-report-icon vis-search-ico'><\/a><\/li>"),e.append(vt),at=t("<li><a style='cursor:pointer;'  title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Requery"))+"' class='vis-report-icon vis-requery-ico'><\/a><\/li>"),e.append(at),lt=t("<li><a style='cursor:pointer;'  title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Archive"))+"' class='vis-report-icon vis-archive-ico'><\/a><\/li>"),e.append(lt),nt=t("<li style='display:none'><a style='cursor:pointer;'  title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveAllPagePdf"))+"' class='vis-report-icon vis-savepdfALL-ico'><\/a><\/li>"),e.append(nt),rt=t("<li><a style='cursor:pointer;'  title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SavePdf"))+"' class='vis-report-icon vis-savepdf-ico'><\/a><\/li>"),e.append(rt),tt=t("<li style='display:none'><a style='cursor:pointer;' title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveAllRecordCsv"))+"' class='vis-report-icon vis-savecsvAll-ico'><\/a><\/li>"),e.append(tt),ut=t("<li><a style='cursor:pointer;' title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveCSV"))+"' class='vis-report-icon vis-savecsv-ico'><\/a><\/li>"),e.append(ut),gt=t("<li><a style='cursor:pointer;'  title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("ReportFormat"))+"' class='vis-report-icon vis-repformat-ico'><\/a><\/li>"),e.append(gt),bt=t("<div class='vis-report-top-icons'>"),ir(),bt.append(fi),h.append(ct),h.append(it),h.append(bt),g.append(h)):(h=t("<div class='vis-report-header' style='padding-left: 10px;padding-right: 0px;'>").append(t('<h3 class="vis-report-tittle" style="float:left;padding-top: 10px;">').append(n.Msg.getMsg("Report"))),ct=t('<a href="javascript:void(0)" class="vis-mainMenuIcons vis-icon-menuclose" style="float:right">'),it=t('<div class="vis-report-top-icons" style="float:right;">'),e=t('<ul style="margin-top: 10px;">'),it.append(e),gt=t("<li><a style='cursor:pointer;'  title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("ReportFormat"))+"'  class='vis-report-icon vis-repformat-ico'><\/a><\/li>"),e.append(gt),ut=t("<li><a style='cursor:pointer;'  title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveCSV"))+"' class='vis-report-icon vis-savecsv-ico'><\/a><\/li>"),e.append(ut),tt=t("<li style='display:none'><a style='cursor:pointer;'  title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveAllRecordCsv"))+"' class='vis-report-icon vis-savecsvAll-ico'><\/a><\/li>"),e.append(tt),rt=t("<li><a style='cursor:pointer;' title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SavePdf"))+"' class='vis-report-icon vis-savepdf-ico'><\/a><\/li>"),e.append(rt),nt=t("<li style='display:none'><a style='cursor:pointer;' title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("SaveAllPagePdf"))+"' class='vis-report-icon vis-savepdfALL-ico'><\/a><\/li>"),e.append(nt),lt=t("<li><a style='cursor:pointer;' title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Archive"))+"' class='vis-report-icon vis-archive-ico'><\/a><\/li>"),e.append(lt),at=t("<li><a style='cursor:pointer;' title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Requery"))+"' class='vis-report-icon vis-requery-ico'><\/a><\/li>"),e.append(at),vt=t("<li><a style='cursor:pointer;' title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Search"))+"' class='vis-report-icon vis-search-ico'><\/a><\/li>"),e.append(vt),yt=t("<li><a style='cursor:pointer;' title='"+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("PrintCustomize"))+"' class='vis-report-icon vis-customize-ico'><\/a><\/li>"),e.append(yt),pt=t('<li><a style="cursor:pointer;" title="'+n.Utility.Util.cleanMnemonic(n.Msg.getMsg("Print"))+'" class="vis-report-icon vis-print-ico"><\/a><\/li>'),e.append(pt),bt=t("<div class='vis-report-top-icons'>"),ir(),bt.append(fi),h.append(ct),h.append(it),h.append(bt),g.append(h));gi()};gi=function(){ct.on("click",function(){hi()});pt.on("click",function(){fr()});yt.on("click",function(){var t=new n.Query;t.addRestriction("AD_PrintFormat_ID",n.Query.prototype.EQUAL,ft);n.viewManager.startWindow(240,t)});at.on("click",function(){d.empty();d.css("width","0px");ht(o.val())});rt.on("click",function(){nr(o.val(),0);null});ut.on("click",function(){tr(o.val(),0,null)});nt.on("click",function(){var r,t;for(k=0,st="",r=new n.BulkDownload(i,"PDF"),r.show(),t=1;t<=kt;t++)nr(t,kt,r)});tt.on("click",function(){var r,t;for(k=0,st="",r=new n.BulkDownload(i,"CSV"),r.show(),t=1;t<=kt;t++)tr(t,kt,r)});gt.on("click",function(){var i,r,u;for(wt.empty(),i=0;i<c.length;i++)c[i].ID&&(r=c[i].IsDefault=="Y"?"vis-favitmchecked":"vis-favitmunchecked",u=t('<li data-isdefbtn="no" data-id="'+c[i].ID+'"><a data-isdefbtn="no" data-id="'+c[i].ID+'">'+c[i].Name+'<\/a><a data-isdefbtn="yes" data-id="'+c[i].ID+'" style="min-height: 16px;display: inline-block;margin-left: 5px;min-width: 16px;margin-top: 0px" class="vis-menufavitm '+r+'" > <\/a><\/li>'),wt.append(u));wt.append(t('<li data-isdefbtn="no" data-id="-1"><a data-id="-1">'+n.Msg.getMsg("NewReport")+"<\/a>"));t(this).w2overlay(yi.clone(!0),{css:{height:"300px"}})});wt.on("click","LI",function(i){var y=t(i.target),e=y.data("id"),h,u,l,v,p;if(e){if(y.data("isdefbtn")=="yes"){for(h="VIS_102",u=[],u[0]=new n.DB.SqlParam("@Ad_Table_ID",a),u[1]=new n.DB.SqlParam("@AD_Tab_ID",r.getAD_Tab_ID()),f(h,u),h="VIS_103",u=[],u[0]=new n.DB.SqlParam("@id",e),f(h,u),l=0;l<c.length;l++)c[l].IsDefault=c[l].ID==e?"Y":"N";return}ft=e;d.empty();d.css("width","0px");s(!0);v=!1;e==-1&&(e=a,v=!0);p=ot.getGenerateReportPara(et,dt,v,ni,ti,ii,0,o.val(),"",e);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:p,type:"POST",success:function(t){t==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var r=jQuery.parseJSON(t),i=r.repInfo;if(i.ErrorText){n.ADialog.error(i.ErrorText);s(!1);return}ri(i.HTML);ui=i.Report;ci(r.pSetting);ft=i.AD_PrintFormat_ID;s(!1)}})}});vt.on("click",function(){var t=new n.Find(i,r,0);t.onClose=function(){if(t.getIsOKPressed()){var n=t.getQuery(),i=t.getCurrentDays(),r=t.getIsCreated();t.dispose();t=null;et[1]=n.getWhereClause(!0);ht(1)}};t.show()});lt.on("click",function(){ot.archiveDocument(et,a,ui)})};var ht=function(i){s(!0);var r=ot.getGenerateReportPara(et,dt,!1,ni,ti,ii,0,i,"",ft);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:r,type:"POST",success:function(t){t==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var r=jQuery.parseJSON(t),i=r.repInfo;if(i.ErrorText){n.ADialog.error(i.ErrorText);s(!1);return}ri(i.HTML);ui=i.Report;ci(r.pSetting);s(!1)}})},nr=function(i,r,u){s(!0);var f=ot.getGenerateReportPara(et,dt,!1,ni,ti,ii,0,i,n.ProcessCtl.prototype.REPORT_TYPE_PDF,ft);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:f,type:"POST",success:function(f){f==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var o=jQuery.parseJSON(f),e=o.repInfo;if(e.ErrorText){n.ADialog.error(e.ErrorText);s(!1);return}e.HTML&&e.HTML.length>0?ri(e.HTML):r==0?window.open(n.Application.contextUrl+e.ReportFilePath):(u.setBulkBusy(!1),t("#forreportdownload").addClass("hide"),st+='<input type="checkbox" data-num="'+i+'"  data-url="'+n.Application.contextUrl+e.ReportFilePath+'" checked />',k+=1,ei(k/r*100),k==r&&setTimeout(function(){ei(100);ki(n.Msg.getMsg("Generated"));t("<form>",{id:"download_form",html:st,action:"#",Class:"hide"}).appendTo(document.body).submit()},1e3));s(!1)}})},tr=function(i,r,u){s(!0);var f=ot.getGenerateReportPara(et,dt,!1,ni,ti,ii,0,i,n.ProcessCtl.prototype.REPORT_TYPE_CSV,ft);t.ajax({url:n.Application.contextUrl+"JsonData/GenerateReport/",dataType:"json",data:f,type:"POST",success:function(f){f==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var o=jQuery.parseJSON(f),e=o.repInfo;if(e.ErrorText){n.ADialog.error(e.ErrorText);s(!1);return}e.HTML&&e.HTML.length>0?ri(e.HTML):r==0?window.open(n.Application.contextUrl+e.ReportFilePath):(u.setBulkBusy(!1),t("#forreportdownload").addClass("hide"),st+='<input type="checkbox" data-num="'+i+'" data-url="'+n.Application.contextUrl+e.ReportFilePath+'" checked />',k+=1,ei(k/r*100),k==r&&setTimeout(function(){ei(100);ki(n.Msg.getMsg("Generated"));t("<form>",{id:"download_form",html:st,action:"#",Class:"hide"}).appendTo(document.body).submit()},1e3));s(!1)}})},ri=function(i){var e,o,h,b;if(u!=!0){wt.empty();var f=null,p=[],l=-1;try{for(t.ajax({type:"Get",async:!1,url:n.Application.contextUrl+"Form/GetShowReportDetails",data:{AD_Table_ID:a,AD_Tab_ID:r.getAD_Tab_ID()},success:function(t){f=(new n.DB.DataReader).toJson(t)}}),c=[];f.read();)l=parseInt(l)+1,e=f.getString(1),p.indexOf(e)>-1&&(e=e+"_"+(parseInt(l)+1)),o={},o.ID=n.Utility.Util.getValueOfInt(f.get(0)),o.Name=e,o.IsDefault=f.getString(3),p.push(f.getString(1)),c.push(o);f.close()}catch(k){console.log(k)}f=null;d.html(i);d.css("min-width",si+"px");ai=i;var w=document.getElementsByClassName("vis-reptabledetect"),v=0,y=0;for(h=0,b=w.length;h<b;h++)y=t(w[h]).width(),y>v&&(v=y);d.css("width",v+50)}s(!1)},s=function(n){li.css("display",n?"block":"none")};di();oi=t("<div Style='height:"+vi+"px;width:"+si+"px;overflow:auto;background:#63BFE9;float:left;'>");d=t("<div Style='height:"+vi+"px;width:"+si+"px;'>");oi.append(d);li=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>");s(!0);oi.append(li);u||g.append(oi);l.hideHeader(!0);l.setContent(ot);l.show()}function a(u,f,e,o,s){function l(f){t.ajax({url:n.Application.contextUrl+"JsonData/GetReportFileTypes/",dataType:"json",data:{AD_Process_ID:u},success:function(n){var e,u,o;if(n!=null&&(e=jQuery.parseJSON(n),e.length!=0)){for(u=0;u<e.length;u++)o="",o=u==0?t("<li tabindex="+u+" data-val="+e[u].Key+" class='vis-selected-li-print'>"+e[u].Name+"<\/li>"):t("<li tabindex="+u+" data-val="+e[u].Key+">"+e[u].Name+"<\/li>"),i.append(o),o=null;f.w2overlay(r.clone(!0),{css:{height:"300px"}})}}})}function c(i,r,h){s&&s.length!=0?t.ajax({url:n.Application.contextUrl+"JsonData/GenerateMultiPrint/",dataType:"json",data:{AD_Process_ID:u,Name:"Print",AD_Table_ID:f,RecIDs:s,WindowNo:o,filetype:h},success:function(t){t==null&&alert(n.Msg.getMsg("ERRORGettingRepData"));var i=jQuery.parseJSON(t);if(r&&r(),i.IsError){n.ADialog.error(i.ErrorText);return}i.ReportFilePath&&window.open(n.Application.contextUrl+i.ReportFilePath)}}):t.ajax({url:n.Application.contextUrl+"JsonData/GeneratePrint/",dataType:"json",data:{AD_Process_ID:u,Name:"Print",AD_Table_ID:f,Record_ID:e,WindowNo:o,filetype:h},success:function(t){var i,u,e;if(t==null&&alert(n.Msg.getMsg("ERRORGettingRepData")),i=jQuery.parseJSON(t),r&&r(),i.IsError){n.ADialog.error(i.ErrorText);return}i.ReportFilePath?window.open(n.Application.contextUrl+i.ReportFilePath):i.IsTelerikReport?window.KJS&&(u=new KJS.TelerikContainer(i.AD_PInstance_ID,f),u.show(),this.unlock()):n.context.getIsUseCrystalReportViewer()&&(e=new n.ReportViewerContainer(i),e.show())}})}i.off("click");i.on("click","LI",function(n){var i=t(n.target).data("val");c(!1,null,i)});this.start=function(f){function s(){var i=t(t(t(document).find(".w2ui-overlay").find("li"))[0]),n=i.eq(0);t("#w2ui-overlay-main").attr("tabindex",1);t("#w2ui-overlay-main").focus();t("#w2ui-overlay-main").keydown(function(r){if(r.which===40)n?(n.hasClass("vis-selected-li-print")&&n.removeClass("vis-selected-li-print"),next=n.next(),n=next.length>0?next.addClass("vis-selected-li-print"):i.eq(0).addClass("vis-selected-li-print")):n=i.eq(0).addClass("vis-selected-li-print");else if(r.which===38)n?(n.hasClass("vis-selected-li-print")&&n.removeClass("vis-selected-li-print"),next=n.prev(),n=next.length>0?next.addClass("vis-selected-li-print"):i.last().addClass("vis-selected-li-print")):n=i.last().addClass("vis-selected-li-print");else if(r.which===13){if(n){var u=n.data("val");c(!1,null,u);t("#w2ui-overlay-main").off("keydown");t("#w2ui-overlay-main").remove()}}else t("#w2ui-overlay-main").off("keydown"),t("#w2ui-overlay-main").remove();return r.stopPropagation(),!1})}var e=[],o;if(e[0]=new n.DB.SqlParam("@AD_Process_ID",u),o=h("VIS_149",e),o=="Y"&&n.context.getIsUseCrystalReportViewer()){c(!1,null,n.ProcessCtl.prototype.REPORT_TYPE_PDF);return}i.find("LI").length>0?(f.w2overlay(r.clone(!0),{css:{height:"300px"}}),window.setTimeout(function(){s()},100)):(l(f),window.setTimeout(function(){s()},100))};this.startPdf=function(t){c(!1,t,n.ProcessCtl.prototype.REPORT_TYPE_PDF)};this.startCsv=function(t){c(!0,t,n.ProcessCtl.prototype.REPORT_TYPE_CSV)}}function v(i){var r=t('<div style="width:100%;height:100%"> '),u=t("<div class='vis-apanel-busy bsyCrsyVwr' style='width:98%;height:98%;position:absolute'>"),f;this.getRoot=function(){return r};this.addReport=function(){r.append(u);f(!0);var e=t("<iframe style = 'width:100%;height:99.4%;' pluginspage='http://www.adobe.com/products/acrobat/readstep2.html'>");i.pi&&i.pi.getAD_PInstance_ID()?e.attr("src",n.Application.contextUrl+"Areas/VIS/WebPages/CrystalReprotViewer.aspx?title=rpt&aid="+i.pi.getAD_PInstance_ID()+"&pid="+i.pi.getAD_Process_ID()+"&tid="+i.pi.getTable_ID()+"&rid="+i.pi.getRecord_ID()):e.attr("src",n.Application.contextUrl+"Areas/VIS/WebPages/CrystalReprotViewer.aspx?title=rpt&aid="+i.AD_PInstance_ID+"&pid="+i.AD_Process_ID+"&tid="+i.AD_Table_ID+"&rid="+i.RecordID);r.append(e)};this.dispose=function(){r.remove();r=null};f=function(n){u.css("display",n?"block":"none")};this.show=function(){var t=new n.CFrame;t.setName(n.Msg.getMsg("Report"));t.setTitle(n.Msg.getMsg("Report"));t.setContent(this);this.addReport();t.show()}}var r=t('<div style="width:100%;height:100%">'),i=t("<ul class='vis-apanel-rb-ul'  style='width:100%;height:100%'>");r.append(i);var u=n.Application.contextUrl,o=u+"JsonData/JDataSetWithCode",s=u+"JsonData/ExecuteNonQuer",y=function(t,i,r){var o=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,e(f,o,function(t){u=(new n.DB.DataReader).toJson(t);r&&r(u)}),u},f=function(n,i,r){var f=r?!0:!1,u=null,e={sql:n,param:i};return t.ajax({url:s+"yWithCode",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:f,data:JSON.stringify(e)}).done(function(n){u=n;r&&r(n)}),u},h=function(t,i,r){var f=r?!0:!1,o={sql:t,page:1,pageSize:0},u;return i&&(o.param=i),u=null,e(o,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u};n.ReportViewer=l;n.AReport=c;n.APrint=a;n.ReportViewerContainer=v}(VIS,jQuery),function(n,t){n.AttachmentHistory=function(i,r,u,f,e){function ye(){o=t("<div>");o.css({position:"absolute",bottom:"0",background:"url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat","background-position":"center center",width:"98%",height:"98%","text-align":"center",opacity:".1"});o[0].style.visibility="hidden";br.append(o)}function pe(){br=t('<div class="vis-forms-container" style="height:100%">');d=t('<div class="vis-history-inboxDiv">');yt=t('<div style="display:none" class="vis-history-mainRelatedDiv">');di=t('<div style="display:none" class="vis-history-mainRelatedDiv">');kr=t('<div class="vis-attachhistory-content-wrap">');yu=t('<div class="vis-attachhistory-left-wrap">');dr=t('<div class="vis-attachhistory-table-top">');gi=t('<div class="vis-attachhistory-search-wrap">');du=t('<div class="vis-attachhistory-search">').append(' <input placeholder="'+n.Msg.getMsg("Search")+'" type="text">').append('<span class="vis-attachhistory-search-icon"><\/span>');gi.append('<img class="prthistory" style="margin-top:15px;margin-left:40px" title="'+n.Msg.getMsg("Print")+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-print.png"  />').append(du);v=t('<div class="vis-attachhistory-right-wrap">');k=t('<div class="vis-attachhistory-right-wrap">').hide();bu==!0?k.append('<label class="vis-attachhistory-noRecFoundforIP" > '+n.Msg.getMsg("NoRecordFound")+" <\/label>"):k.append('<label class="vis-attachhistory-noRecFound" > '+n.Msg.getMsg("NoRecordFound")+" <\/label>");pu=t('<div class="vis-attachhistory-apanel-tabcontrol">');nr=t('<ul class="vis-attachhistory-appsaction-ul vis-attachhistory-apanel-tabcontrol-ul">');nr.append('<li data-type="History" class="vis-attachhistory-apanel-tab-selected" style="opacity: 1;">'+n.Msg.getMsg("History")+'<\/li><li  data-type="RelatedHistory"  style="opacity: 1;">'+n.Msg.getMsg("RelatedHistory")+"<\/li>");u>0&&nr.append('<li  data-type="UserHistory"  style="opacity: 1;">'+n.Msg.getMsg("UserHistory")+"<\/li>");dr.append(pu.append(nr));wu=t('<div class="vis-attachhistory-table-wrap">').append(d).append(yt).append(di).append(ou);br.append(kr.append(yu.append(dr).append(wu)));kr.append(gi).append(v).append(k);ht=gi.find("input");ve=du.find(".prthistory");ni=t('<ul class="vis-his-attachs">');oi=t('<ul class="vis-his-attachs">');ku=t("<ul class='vis-apanel-rb-ul'>");ku.append('<li style="display:none" data-type="R"><a><span class="vis-attachhistory-email-icon vis-attachhistory-reply-icon"><\/span>'+n.Msg.getMsg("Reply")+'<\/a><\/li> <li data-type="F"><a style="color: rgb(111, 111, 111); "><span class="vis-attachhistory-email-icon vis-attachhistory-forword-icon"><\/span>'+n.Msg.getMsg("Forward")+"<\/a><\/li>")}function we(){ou=t('<ul style="float:right;margin-top:10px" class="vis-statusbar-ul">');et=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageFirst16.png" alt="First Page" title="First Page" style="opacity: 0.6;"><\/div><\/li>');ot=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageUp16.png" alt="Page Up" title="Page Up" style="opacity: 0.6;"><\/div><\/li>');gt=t('<li><select class="vis-statusbar-combo"><\/select><\/li>');at=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageDown16.png" alt="Page Down" title="Page Down" style="opacity: 0.6;"><\/div><\/li>');lt=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageLast16.png" alt="Last Page" title="Last Page" style="opacity: 0.6;"><\/div><\/li>');ou.append(et).append(ot).append(gt).append(at).append(lt)}function re(u){var e,f;for(o[0].style.visibility="visible",t.ajax({url:n.Application.contextUrl+"AttachmentHistory/LoadRecordDataCount",datatype:"json",async:!1,type:"get",cache:!1,data:{searchText:u,_AD_Table_ID:i,_Record_ID:r},success:function(n){uf=JSON.parse(n)}}),e=parseInt(uf/ai),ui=e+(uf%ai>0?1:0),it=1,s=gt.find("select"),s.empty(),f=1;f<=ui;f++)s.append("<option>"+f+"<\/option>");et.css("opacity","0.6");ot.css("opacity","0.6")}function sr(u){t.ajax({url:n.Application.contextUrl+"AttachmentHistory/LoadRecordData",datatype:"json",type:"get",async:!1,cache:!1,data:{searchText:u,_AD_Table_ID:i,_Record_ID:r,historyPageNo:it,pageSize:ai},success:function(n){n=JSON.parse(n);de(n)},error:function(){}})}function hr(i){(i==undefined||i==null)&&(i="");t.ajax({url:n.Application.contextUrl+"AttachmentHistory/RelatedHistory",datatype:"json",type:"get",cache:!1,data:{keyColumnID:r,pageSize:ai,pageNo:nt,searchText:n.Utility.encodeText(i),keyColName:e},success:function(n){var i=JSON.parse(n),r,t;if(ke(i),fu==undefined||fu==0||ki==!0){for(fu=i.TotalRecords,r=parseInt(fu/ai),nt=1,fi=r+(fu%ai>0?1:0),s=gt.find("select"),s.empty(),t=1;t<=fi;t++)s.append("<option>"+t+"<\/option>");et.css("opacity","0.6");ot.css("opacity","0.6");no()}else to();o[0].style.visibility="hidden";ki=!1},error:function(n){console.log(n);o[0].style.visibility="hidden";ki=!1}})}function cr(i){(i==undefined||i==null)&&(i="");t.ajax({url:n.Application.contextUrl+"AttachmentHistory/UserHistory",datatype:"json",type:"get",cache:!1,data:{C_BPartner_ID:u,pageSize:ai,pageNo:tt,searchText:n.Utility.encodeText(i)},success:function(n){var i=JSON.parse(n),r,t;if(i.RHistory!=null&&be(i),eu==undefined||eu==0||ki==!0){for(eu=i.TotalRecords,r=parseInt(eu/ai),tt=1,ei=r+(eu%ai>0?1:0),s=gt.find("select"),s.empty(),t=1;t<=ei;t++)s.append("<option>"+t+"<\/option>");et.css("opacity","0.6");ot.css("opacity","0.6");ge()}else io();o[0].style.visibility="hidden";ki=!1},error:function(n){console.log(n);o[0].style.visibility="hidden";ki=!1}})}function be(i){var u,f,e,r;for(bt=[],yi=[],u=i.RHistory,bt.push({field:"ID",caption:n.Msg.getMsg("id"),size:"150px",hidden:!0}),bt.push({field:"Record_ID",caption:n.Msg.getMsg("record_id"),size:"150px",hidden:!0}),bt.push({field:"Created",caption:n.Msg.getMsg("Date"),size:"150px",hidden:!1}),bt.push({field:"Type",caption:n.Msg.getMsg("Type"),size:"150px",hidden:!1}),n.Application.isRTL?bt.push({field:"TableName",caption:n.Msg.getMsg("Table"),size:"150px",hidden:!1,resizable:!0,style:"text-align: right",render:function(i){var r=t('<img class="findImg" data-ids="'+i.Record_ID+"-"+i.AD_Table_ID+'" style="margin-left:10px;cursor:pointer" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email"  >'),u=t("<div >").append(r).append(i.TableName);return u.html()}}):bt.push({field:"TableName",caption:n.Msg.getMsg("Table"),size:"150px",hidden:!1,resizable:!0,style:"text-align: left",render:function(i){var r=t('<img class="findImg" data-ids="'+i.Record_ID+"-"+i.AD_Table_ID+'" style="margin-right:10px;cursor:pointer" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email"  >'),u=t("<div >").append(r).append(i.TableName);return u.html()}}),bt.push({field:"Subject",caption:n.Msg.getMsg("Subject"),size:"150px",hidden:!1}),bt.push({field:"UserName",caption:n.Msg.getMsg("UserName"),size:"150px",hidden:!1}),u.length>0&&(y=Object.keys(u[0])),r=0;r<y.length;r++)if(y[r]=="ID"||y[r]=="Record_ID"||y[r]=="Created"||y[r]=="Type"||y[r]=="TableName"||y[r]=="Subject"||y[r]=="UserName")continue;else bt.push({field:y[r],caption:n.Msg.getMsg(y[r]),size:"100px",hidden:!0});for(f=0;f<u.length;f++){for(e={},e.recid=f,r=0;r<y.length;r++)y[r]=="Created"?e[y[r]]=new Date(u[f][y[r]]).toLocaleString():y[r]=="Type"?u[f][y[r]]=="A"?e[y[r]]=n.Msg.getMsg("Appointment"):u[f][y[r]]=="T"?e[y[r]]=n.Msg.getMsg("Task"):u[f][y[r]]=="L"?e[y[r]]=n.Msg.getMsg("Letter"):u[f][y[r]]=="M"?e[y[r]]=n.Msg.getMsg("SentMail"):(u[f][y[r]]=="Z"||u[f][y[r]]=="I")&&(e[y[r]]=n.Msg.getMsg("InboxMail")):e[y[r]]=n.Utility.encodeText(u[f][y[r]]);yi.push(e)}}function ke(i){var u,f,e,r;for(dt=[],vi=[],u=i.RHistory,dt.push({field:"ID",caption:n.Msg.getMsg("id"),size:"150px",hidden:!0}),dt.push({field:"Record_ID",caption:n.Msg.getMsg("record_id"),size:"150px",hidden:!0}),dt.push({field:"Created",caption:n.Msg.getMsg("Date"),size:"150px",hidden:!1}),dt.push({field:"Type",caption:n.Msg.getMsg("Type"),size:"150px",hidden:!1}),n.Application.isRTL?dt.push({field:"TableName",caption:n.Msg.getMsg("Table"),size:"150px",hidden:!1,resizable:!0,style:"text-align: right",render:function(i){var r=t('<img class="findImg" data-ids="'+i.Record_ID+"-"+i.AD_Table_ID+'" style="margin-left:10px;cursor:pointer" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email"  >'),u=t("<div >").append(r).append(i.TableName);return u.html()}}):dt.push({field:"TableName",caption:n.Msg.getMsg("Table"),size:"150px",hidden:!1,resizable:!0,style:"text-align: left",render:function(i){var r=t('<img class="findImg" data-ids="'+i.Record_ID+"-"+i.AD_Table_ID+'" style="margin-right:10px;cursor:pointer" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email"  >'),u=t("<div >").append(r).append(i.TableName);return u.html()}}),dt.push({field:"Subject",caption:n.Msg.getMsg("Subject"),size:"150px",hidden:!1}),u.length>0&&(h=Object.keys(u[0])),r=0;r<h.length;r++)if(h[r]=="ID"||h[r]=="Record_ID"||h[r]=="Created"||h[r]=="Type"||h[r]=="TableName"||h[r]=="Subject")continue;else dt.push({field:h[r],caption:n.Msg.getMsg(h[r]),size:"100px",hidden:!0});for(f=0;f<u.length;f++){for(e={},e.recid=f,r=0;r<h.length;r++)h[r]=="Created"?e[h[r]]=new Date(u[f][h[r]]).toLocaleString():h[r]=="Type"?u[f][h[r]]=="A"?e[h[r]]=n.Msg.getMsg("Appointment"):u[f][h[r]]=="T"?e[h[r]]=n.Msg.getMsg("Task"):u[f][h[r]]=="L"?e[h[r]]=n.Msg.getMsg("Letter"):u[f][h[r]]=="M"?e[h[r]]=n.Msg.getMsg("SentMail"):u[f][h[r]]=="I"&&(e[h[r]]=n.Msg.getMsg("InboxMail")):e[h[r]]=n.Utility.encodeText(u[f][h[r]]);vi.push(e)}}function de(t){var i,u,r,f;for(wt=[],si=[],wt.push({field:"id",caption:n.Msg.getMsg("id"),size:"150px",hidden:!0}),wt.push({field:"record_id",caption:n.Msg.getMsg("record_id"),size:"150px",hidden:!0}),wt.push({field:"created",caption:n.Msg.getMsg("Date"),size:"150px",hidden:!1}),wt.push({field:"type",caption:n.Msg.getMsg("Type"),size:"150px",hidden:!1}),wt.push({field:"name",caption:n.Msg.getMsg("CreatedBy"),size:"150px",hidden:!1}),bu==!0?wt.push({field:"subject",caption:n.Msg.getMsg("Subject"),size:"150px",hidden:!1}):wt.push({field:"subject",caption:n.Msg.getMsg("Subject"),size:"230px",hidden:!1}),t.length>0&&(h=Object.keys(t[0])),i=0;i<t.length;i++){for(u={},u.recid=i,r=0;r<h.length;r++)f=h[r],u[f]=h[r]=="created"?new Date(t[i][f]).toLocaleString():n.Utility.encodeText(t[i][f]);si.push(u)}}function ge(){b!=undefined&&b!=null&&(b.destroy(),b=null);b=di.w2grid({name:"userhistorygrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:bt,records:yi});b.on("select",wr);b.on("search",pr);yi.length>0?(b.select(0),k.hide(),v.show()):(k.show(),v.hide());t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])})}function no(){p!=undefined&&p!=null&&(p.destroy(),p=null);p=yt.w2grid({name:"realtedhistorygrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:dt,records:vi});p.on("select",wr);p.on("search",pr);vi.length>0?(p.select(0),k.hide(),v.show()):(k.show(),v.hide());t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])})}function vr(){ut.destroy();ut=null;ut=d.w2grid({name:"historyinboxgrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:wt,records:si});ut.on("select",wr);ut.on("search",pr);si.length>0?(ut.select(0),k.hide(),v.show()):(k.show(),v.hide());o[0].style.visibility="hidden";o[0].style.visibility="hidden"}function to(){p.destroy();p=null;p=yt.w2grid({name:"realtedhistorygrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:dt,records:vi});p.on("select",wr);p.on("search",pr);vi.length>0?(p.select(0),k.hide(),v.show()):(k.show(),v.hide());o[0].style.visibility="hidden";t(".findImg").off("click");t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])})}function io(){b.destroy();b=null;b=di.w2grid({name:"userhistorygrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:bt,records:yi});b.on("select",wr);b.on("search",pr);yi.length>0?(b.select(0),k.hide(),v.show()):(k.show(),v.hide());o[0].style.visibility="hidden";t(".findImg").off("click");t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])})}function ro(){nr.on("click",lo);gi.find("input").on("keydown",fe);gi.find("img").on("click",fo);ni.on("click",po);oi.on("click",wo);v.on("keydown",ce);v.on("click",ce);at.on("click",eo);ot.on("click",oo);gt.on("change",so);et.on("click",ho);lt.on("click",co);ku.on(n.Events.onTouchStartOrClick,"LI",function(n){var i=t(this).data("type");uo(i,n)})}function uo(t){var f=null,u;t=="R"||t=="F"&&(f=new n.Email("",null,null,r,!0,!0,i,hi.html(),ar.text(),pf));u=new n.CFrame;u.setName(n.Msg.getMsg("EMail"));u.setTitle(n.Msg.getMsg("EMail"));u.hideHeader(!0);u.setContent(f);u.show();f.initializeComponent();kt.close()}function fo(){g!=undefined&&g.is(":visible")==!0?(t(".vis-attachhistory-right-row > ul > li").css("float","left"),t(".vis-attachhistory-right-row > ul").css("height","auto"),ue(g.html()),t(".vis-attachhistory-right-row > ul > li").css("float","none"),t(".vis-attachhistory-right-row > ul").css("height","45px")):l!=undefined&&l.is(":visible")==!0&&(t(".vis-attachhistory-right-row > ul > li").css("float","left"),t(".vis-attachhistory-right-row > ul").css("height","auto"),t(t(".vis-attachhistory-to").find("p")).text(t(t(".vis-attachhistory-to").find("p")).text().replace(/;/g,"; ")),t(t(".vis-attachhistory-bcc").find("p")).text(t(t(".vis-attachhistory-bcc").find("p")).text().replace(/;/g,"; ")),t(t(".vis-attachhistory-cc").find("p")).text(t(t(".vis-attachhistory-cc").find("p")).text().replace(/;/g,"; ")),ue(l.html()),t(".vis-attachhistory-right-row > ul > li").css("float","none"),t(".vis-attachhistory-right-row > ul").css("height","45px"),t(t(".vis-attachhistory-to").find("p")).text(t(t(".vis-attachhistory-to").find("p")).text().replace(/; /g,";")),t(t(".vis-attachhistory-bcc").find("p")).text(t(t(".vis-attachhistory-bcc").find("p")).text().replace(/; /g,";")),t(t(".vis-attachhistory-cc").find("p")).text(t(t(".vis-attachhistory-cc").find("p")).text().replace(/; /g,";")))}function ue(t){var i=window.open(),r='<link rel="stylesheet" href="'+n.Application.contextUrl+'Areas/VIS/Content/VIS.all.min.css" />';i.document.write(r+t);setTimeout(function(){i.print();i.close()},300)}function fe(n){(n.keyCode==undefined||n.keyCode==13)&&ht!=undefined&&ht!=null&&(ki=!0,d.is(":visible")?(o[0].style.visibility="visible",re(ht.val()),sr(ht.val()),ne=ht.val(),vr()):yt.is(":visible")?(o[0].style.visibility="visible",hr(ht.val()),te=ht.val()):(o[0].style.visibility="visible",cr(ht.val()),ie=ht.val()))}function eo(){d.is(":visible")?(it<ui&&(o[0].style.visibility="visible",it++,s.val(it),sr(),vr()),yr()):yt.is(":visible")?nt<fi&&(o[0].style.visibility="visible",nt++,s.val(nt),hr(),lu()):tt<ei&&(o[0].style.visibility="visible",tt++,s.val(tt),cr(),au())}function oo(){d.is(":visible")?(it>1&&(o[0].style.visibility="visible",it--,s.val(it),sr(),vr()),yr()):yt.is(":visible")?(nt>1&&(o[0].style.visibility="visible",nt--,s.val(nt),hr()),lu()):(tt>1&&(o[0].style.visibility="visible",tt--,s.val(tt),cr()),au())}function so(){d.is(":visible")?(o[0].style.visibility="visible",it=s.val(),sr(),vr(),yr()):yt.is(":visible")?(o[0].style.visibility="visible",nt=s.val(),hr(),lu()):(o[0].style.visibility="visible",tt=s.val(),cr(),au())}function ho(){d.is(":visible")?(o[0].style.visibility="visible",it=1,s.val(it),sr(),vr(),yr()):yt.is(":visible")?(o[0].style.visibility="visible",nt=1,s.val(nt),hr(),lu()):(o[0].style.visibility="visible",tt=1,s.val(tt),cr(),au())}function co(){d.is(":visible")?(o[0].style.visibility="visible",it=ui,s.val(it),sr(),vr(),yr()):yt.is(":visible")?(o[0].style.visibility="visible",nt=fi,s.val(nt),hr(),lu()):(o[0].style.visibility="visible",tt=ei,s.val(tt),cr(),au())}function yr(){it==1&&it<ui?(et.css("opacity","0.6"),ot.css("opacity","0.6"),at.css("opacity","1"),lt.css("opacity","1")):it>1&&it<ui?(et.css("opacity","1"),ot.css("opacity","1"),at.css("opacity","1"),lt.css("opacity","1")):it==ui&&ui==1?(et.css("opacity","0.6"),ot.css("opacity","0.6"),at.css("opacity","0.6"),lt.css("opacity","0.6")):it==ui&&(et.css("opacity","1"),ot.css("opacity","1"),at.css("opacity","0.6"),lt.css("opacity","0.6"))}function lu(){nt==1&&nt<fi?(et.css("opacity","0.6"),ot.css("opacity","0.6"),at.css("opacity","1"),lt.css("opacity","1")):nt>1&&nt<fi?(et.css("opacity","1"),ot.css("opacity","1"),at.css("opacity","1"),lt.css("opacity","1")):nt==fi&&fi==1?(et.css("opacity","0.6"),ot.css("opacity","0.6"),at.css("opacity","0.6"),lt.css("opacity","0.6")):nt==fi&&(et.css("opacity","1"),ot.css("opacity","1"),at.css("opacity","0.6"),lt.css("opacity","0.6"))}function au(){tt==1&&tt<ei?(et.css("opacity","0.6"),ot.css("opacity","0.6"),at.css("opacity","1"),lt.css("opacity","1")):tt>1&&tt<ei?(et.css("opacity","1"),ot.css("opacity","1"),at.css("opacity","1"),lt.css("opacity","1")):tt==ei&&ei==1?(et.css("opacity","0.6"),ot.css("opacity","0.6"),at.css("opacity","0.6"),lt.css("opacity","0.6")):tt==ei&&(et.css("opacity","1"),ot.css("opacity","1"),at.css("opacity","0.6"),lt.css("opacity","0.6"))}function lo(i){var f=t(i.target).data("type"),r;if(f=="History"){for((ht!="undefined"||ht!=null)&&ht.val(ne),s=gt.find("select"),s.empty(),r=1;r<=ui;r++)s.append("<option>"+r+"<\/option>");yr();d.show();di.hide();yt.hide();s.val(it);si.length>0?(ut.select(0),ut.refresh(),k.hide(),v.show()):(k.show(),v.hide())}else if(f=="RelatedHistory"){for((ht!="undefined"||ht!=null)&&ht.val(te),s=gt.find("select"),s.empty(),r=1;r<=fi;r++)s.append("<option>"+r+"<\/option>");p==undefined||p==null?(o[0].style.visibility="visible",hr(),s.val(nt)):(v.find("*").show(),vi.length>0&&(p.select(0),p.refresh(),s.val(nt)));t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])});vi.length>0?(p.select(0),k.hide(),v.show()):(k.show(),v.hide());d.hide();di.hide();yt.show()}else if(f=="UserHistory"){if((ht!="undefined"||ht!=null)&&ht.val(ie),u==null||u==0){n.ADialog.info("BPartnerNotFound");return}for(s=gt.find("select"),s.empty(),r=1;r<=ei;r++)s.append("<option>"+r+"<\/option>");b==undefined||b==null?(o[0].style.visibility="visible",cr(),s.val(tt)):(v.find("*").show(),yi.length>0&&(b.select(0),b.refresh(),s.val(tt)));t(".findImg").on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[1],r[0])});yi.length>0?(b.select(0),k.hide(),v.show()):(k.show(),v.hide());d.hide();yt.hide();di.show()}t(i.target).addClass("vis-attachhistory-apanel-tab-selected");t(i.target).siblings("li").removeClass("vis-attachhistory-apanel-tab-selected")}function pr(n){n.onComplete=function(){d.is(":visible")?ut.last.searchIds.length>0&&ut.select(ut.last.searchIds[0]):p.last.searchIds.length>0&&p.select(p.last.searchIds[0])}}function wr(i){var r;if(o[0].style.visibility="visible",r=i.target=="historyinboxgrid"?ut.get(i.recid):i.target=="realtedhistorygrid"?p.get(i.recid):b.get(i.recid),t(".vis-attachhistory-view-comments").text(n.Msg.getMsg("ViewMoreComments")),r.type==n.Msg.getMsg("Appointment")||r.Type=="Appointment"||r.type==n.Msg.getMsg("Task")||r.Type=="Task"?g!=undefined&&g.is(":visible")==!1&&(t(st[0].children[0]).hide(),g.show()):r.type==n.Msg.getMsg("VA048_CallType")||r.Type=="Call"?rt!=undefined&&rt.is(":visible")==!1&&(t(vt[0].children[0]).hide(),rt.show()):l!=undefined&&l.is(":visible")==!1&&(t(ft[0].children[0]).hide(),l.show()),r.type!=undefined)switch(r.type){case n.Msg.getMsg("Appointment"):lr(r.id);window.setTimeout(function(){w=r.id;c=!0;a=!1;pt(w,c,a)},200);break;case n.Msg.getMsg("Task"):lr(r.id);window.setTimeout(function(){w=r.id;c=!0;a=!1;pt(w,c,a)},200);break;case n.Msg.getMsg("SentMail"):ee(r.id);window.setTimeout(function(){w=r.id;c=!1;a=!1;pt(w,c,a)},200);break;case n.Msg.getMsg("InboxMail"):oe(r.id);window.setTimeout(function(){w=r.id;c=!1;a=!1;pt(w,c,a)},200);break;case n.Msg.getMsg("Letter"):se(r.id);window.setTimeout(function(){w=r.id;c=!1;a=!1;pt(w,c,a)},200);break;case n.Msg.getMsg("VA048_CallType"):he(r.id);window.setTimeout(function(){w=r.id;c=!1;a=!0;pt(w,c,a)},200)}else switch(r.Type){case n.Msg.getMsg("Appointment"):lr(r.ID);window.setTimeout(function(){w=r.ID;c=!0;a=!1;pt(w,c,a)},200);break;case n.Msg.getMsg("Task"):lr(r.ID);window.setTimeout(function(){w=r.ID;c=!0;a=!1;pt(w,c,a)},200);break;case n.Msg.getMsg("SentMail"):ee(r.ID);window.setTimeout(function(){lr(r.ID);w=r.ID;c=!1;a=!1;pt(w,c,a)},200);break;case n.Msg.getMsg("InboxMail"):oe(r.ID);window.setTimeout(function(){lr(r.ID);w=r.ID;c=!1;a=!1;pt(w,c,a)},200);break;case n.Msg.getMsg("Letter"):se(r.ID);window.setTimeout(function(){lr(r.ID);w=r.ID;c=!1;a=!1;pt(w,c,a)},200);break;case n.Msg.getMsg("VA048_CallType"):he(r.ID);window.setTimeout(function(){w=r.ID;c=!1;a=!0;pt(w,c,a)},200)}}function lr(t){var r="SELECT AI.AppointmentsInfo_ID, AI.Subject,AI.Location,AI.Description,AI.AD_Table_ID, AI.Record_ID,  (  CASE Label    WHEN 1     THEN  '"+n.Msg.getMsg("Important",!0)+"'    WHEN 2    THEN '"+n.Msg.getMsg("Business",!0)+"'    WHEN 3    THEN   '"+n.Msg.getMsg("Personal",!0)+"'    WHEN 4    THEN '"+n.Msg.getMsg("Vacation",!0)+"'    WHEN 5    THEN '"+n.Msg.getMsg("MustAttend",!0)+"'    WHEN 6    THEN '"+n.Msg.getMsg("TravelRequired",!0)+"'    WHEN 7    THEN '"+n.Msg.getMsg("NeedsPreparation",!0)+"'    WHEN 8    THEN '"+n.Msg.getMsg("BirthDay",!0)+"'    WHEN 9    THEN '"+n.Msg.getMsg("Anniversary",!0)+"'    WHEN 10    Then '"+n.Msg.getMsg("PhoneCall",!0)+"'    ELSE '"+n.Msg.getMsg("None",!0)+"'  END ) AS label ,  AI.StartDate , AI.EndDate,  (  CASE AI.AllDay    WHEN 'Y'        THEN '"+n.Msg.getMsg("Yes",!0)+"'        ELSE '"+n.Msg.getMsg("No",!0)+"'  END) AS Allday ,  (  CASE AI.Status    WHEN 1    THEN '"+n.Msg.getMsg("Tentative",!0)+"'     WHEN 2    THEN '"+n.Msg.getMsg("Busy",!0)+"'    WHEN 3    THEN '"+n.Msg.getMsg("OutOfOffice",!0)+"'    Else     '"+n.Msg.getMsg("Free",!0)+"'     End) as Status,      AI.ReminderInfo , AI.AttendeeInfo,  AI.RecurrenceInfo ,      (       CASE AI.IsPrivate        WHEN 'Y'        THEN '"+n.Msg.getMsg("Yes")+"'        ELSE '"+n.Msg.getMsg("No")+"'      END) AS IsPrivate,AI.comments ,ac.Name as caname   FROM AppointmentsInfo ai LEFT OUTER JOIN appointmentcategory AC  ON AI.appointmentcategory_id=ac.appointmentcategory_id WHERE AI.AppointmentsInfo_ID="+t,e=n.secureEngine.encrypt(r),i=n.dataContext.getJSONData(n.Application.contextUrl+"AttachmentHistory/GetAppointmentData",{AppQry:e},null),s,u,f;if(i!=null){if(s=0,s=d.is(":visible")?0:i.AD_Table_ID+"-"+i.Record_ID,r="",u=i.AttendeeInfo,u!=null&&u!=""&&(r=" SELECT Name FROM AD_User WHERE AD_User_ID IN ("+u.replace(/;/g,",")+")",e=n.secureEngine.encrypt(r),names=n.dataContext.getJSONData(n.Application.contextUrl+"AttachmentHistory/GetUser",{UserQry:e},null),names!=null&&names.length>0)){for(r="",f=0;f<names.length;f++)r+=names[f]+", ";r=r.substring(0,r.length-2)}yo(t,i.Location,i.Description,i.label,i.StartDate,i.EndDate,i.Allday,"",i.comments,s,i.Subject,i.caname,"",i.AppointmentsInfo_ID,r)}else o[0].style.visibility="hidden"}function ee(i){t.ajax({url:n.Application.contextUrl+"AttachmentHistory/LoadSentMails",datatype:"json",type:"get",cache:!1,data:{ID:i},success:function(n){var t=JSON.parse(n),r=0;r=d.is(":visible")?0:t.AD_Table_ID+"-"+t.Record_ID;wf(i,t.Title,t.To,t.From,t.Date,t.Detail,t.Bcc,t.Cc,t.Comments,t.IsMail,t.IsLetter,t.Attach,r,t.ID)}})}function oe(i){t.ajax({url:n.Application.contextUrl+"AttachmentHistory/LoadInboxMails",datatype:"json",type:"get",cache:!1,data:{ID:i},success:function(n){var t=JSON.parse(n),r=0;r=d.is(":visible")?0:t.AD_Table_ID+"-"+t.Record_ID;wf(i,t.Title,t.To,t.From,t.Date,t.Detail,t.Bcc,t.Cc,t.Comments,t.IsMail,t.IsLetter,t.Attach,r,t.ID)}})}function se(i){t.ajax({url:n.Application.contextUrl+"AttachmentHistory/LoadLetters",datatype:"json",type:"get",cache:!1,data:{ID:i},success:function(n){var t=JSON.parse(n),r=0;r=d.is(":visible")?0:t.AD_Table_ID+"-"+t.Record_ID;wf(i,t.Title,"","",t.Date,t.Detail,"","",t.Comments,!1,!0,t.Attach,r,t.ID)}})}function he(i){t.ajax({url:n.Application.contextUrl+"AttachmentHistory/LoadCall",datatype:"json",type:"get",cache:!1,data:{ID:i},success:function(t){var r=JSON.parse(t),u=0;u=d.is(":visible")?0:r.AD_Table_ID+"-"+r.Record_ID;ao(i,r.VA048_IsConference,r.VA048_From,r.VA048_To,r.VA048_Duration,r.VA048_Price,r.VA048_Price_Unit,r.VA048_Status,r.VA048_CallNotes,r.Created,r.AD_Table_ID,r.Record_ID,u,n.Msg.getMsg("VA048_CallType"),"",r.VA048_FullName,r.Attach)}})}function ao(i,r,u,f,e,s,h,c,l,a,y,p,w,b,k,d,g){var e,tt,it,ut,et,ot,nt;if(ft!=undefined&&ft.hide(),st!=undefined&&st.hide(),e=e>=60?vo(e):e+" "+n.Msg.getMsg("VA048_Seconds"),bi==undefined||bi==null||bi==""){if(bi=t("<p>"+n.Utility.encodeText(u)+"<\/p>"),ti=t("<p>"+n.Utility.encodeText(f)+"<\/p>"),ff=t("<p>"+n.Utility.encodeText(e)+"<\/p>"),ef=t("<p>"+n.Utility.encodeText(c)+"<\/p>"),of=t("<p>"+n.Utility.encodeText(s)+"<\/p>"),sf=t("<p>"+n.Utility.encodeText(h)+"<\/p>"),hf=t(" <p>"+n.Utility.encodeText(new Date(a).toLocaleString())+"<\/p>"),er=t("<p>"+n.Utility.encodeText(b)+"<\/p>"),cf=t('<p style="max-height:120px;overflow-y: scroll;">'+n.Utility.encodeText(l)+"<\/p>"),af=t("<p>"+n.Utility.encodeText(d)+"<\/p>"),lf=t("<p>"+(r=="Y"?n.Msg.getMsg("VA048_Conference"):n.Msg.getMsg("VA048_CallType"))+"<\/p>"),ct=n.Application.isRTL?t('<img style="float:left;cursor:pointer" data-ids="'+w+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="'+n.Msg.getMsg("VA048_CallType")+'">'):t('<img style="float:right;cursor:pointer" data-ids="'+w+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="'+n.Msg.getMsg("VA048_CallType")+'">'),w==0?ct.hide():ct.show(),vt=t('<div class="vis-attachhistory-right-content">'),rt=t('<div class="vis-attachhistory-grid-data" >'),tt=t('<div style="float:left;width:100%;margin-bottom:10px"><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>"+n.Msg.getMsg("Title")+' <img src="'+n.Application.contextUrl+'Areas/vis/Images/history-call.png" alt="'+n.Msg.getMsg("Title")+'"><\/h6>').append(ct)).append(lf)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>"+n.Msg.getMsg("User")+"<\/h6> ").append(af)),rt.append(tt),it=t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>"+n.Msg.getMsg("VA048_From")+"<\/h6>")).append(bi)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>"+n.Msg.getMsg("VA048_To")+"<\/h6> ").append(ti)),rt.append(it),ut=t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2"> ').append("<h6>"+n.Msg.getMsg("VA048_Duration")+"<\/h6> ").append(ff)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>"+n.Msg.getMsg("VA048_Status")+"<\/h6>").append(ef)),rt.append(ut),et=t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append("<h6>"+n.Msg.getMsg("VA048_Price")+"<\/h6>").append(of)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>"+n.Msg.getMsg("VA048_PriceUnit")+"<\/h6> ").append(sf)),rt.append(et),ot=t('<div style="float:left;width:100%;margin-bottom:10px" ><\/div>').append(t('<div class="vis-attachhistory-right-row2">').append("<h6>"+n.Msg.getMsg("Created")+"<\/h6>").append(hf)).append(t('<div class="vis-attachhistory-right-row3" style="margin-right: 4px;" >').append("<h6>"+n.Msg.getMsg("Category")+"<\/h6> ").append(er)),rt.append(ot),rt.append(t('<div class="vis-attachhistory-right-row" style="margin-bottom:20px;margin-right: 4px;">').append("<h6>"+n.Msg.getMsg("VA048_Notes")+"<\/h6> ").append(cf)),rt.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("Attachments")+"<\/h6>")),g!=undefined&&g.length>0)for(nt=0;nt<g.length;nt++)oi.append('<li><a data-attid="'+g[nt].AttID+'" data-id="'+g[nt].ID+'">'+n.Utility.encodeText(g[nt].Name)+'<\/a><span class="vis-attachhistory-attach-download"><img src="'+n.Application.contextUrl+'Areas/vis/Images/history-download.png" alt="'+n.Msg.getMsg("VA048_CallType")+'"><\/span><\/li>');else rt.find(".vis-attachhistory-right-row").last().hide();rt.find(".vis-attachhistory-right-row").last().append(oi);(wi==undefined||wi==null)&&(wi=t('<input type="text" placeholder="'+n.Msg.getMsg("TypeComment")+'"><\/input>'));yf=t('<div class="vis-attachhistory-bottom"><\/div>');vf=t('<div class="vis-attachhistory-comments"><\/div>');vf.append(wi).append('<span class="vis-attachhistory-comment-icon"><\/span>');yf.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(vf).append('<p class="vis-attachhistory-view-comments">'+n.Msg.getMsg("ViewMoreComments")+"<\/p>"));vt.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(rt).append(yf);cu=t('<div class="vis-attachhistory-right-row" >');rt.append(cu);v.append(vt);ct.on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[0],r[1])})}else{if(vt.show(),bi.text(n.Utility.encodeText(u)),ti.text(n.Utility.encodeText(f)),ff.text(n.Utility.encodeText(e)),ef.text(n.Utility.encodeText(c)),of.text(n.Utility.encodeText(s)),sf.text(n.Utility.encodeText(h)),hf.text(n.Utility.encodeText(new Date(a).toLocaleString())),er.text(n.Utility.encodeText(b)),cf.text(n.Utility.encodeText(l)),af.text(n.Utility.encodeText(d)),lf.text(n.Utility.encodeText(r=="Y"?n.Msg.getMsg("VA048_Conference"):n.Msg.getMsg("VA048_CallType"))),g!=undefined&&g.length>0){for(oi.empty(),nt=0;nt<g.length;nt++)oi.append('<li><a data-attid="'+g[nt].AttID+'" data-id="'+g[nt].ID+'">'+n.Utility.encodeText(g[nt].Name)+'<\/a><span class="vis-attachhistory-attach-download"><img src="'+n.Application.contextUrl+'Areas/vis/Images/history-download.png" alt="'+n.Msg.getMsg("VA048_CallType")+'"><\/span><\/li>');t(oi.parent()).show()}else t(oi.parent()).hide();ct.data("ids",w);w==0?ct.hide():ct.show();t(vt[0].children[0]).hide()}t(".vis-attachhistory-view-comments").off("click");t(".vis-attachhistory-view-comments").on("click",function(){bf(i,!1,!0,this)});k!=undefined?wi.val(n.Utility.encodeText(k)):wi.val("");t(".vis-attachhistory-comment-icon").data("ID",i);o[0].style.visibility="hidden"}function vo(t){var f=~~(t/3600),r=~~(t%3600/60),u=t%60,i="";return f>0&&(i+=""+hrs+":"+(r<10?"0":"")),i+=""+r+":"+(u<10?"0":""),i+=""+u,i+" "+n.Msg.getMsg("VA048_Minutes")}function wf(i,r,u,f,e,s,h,y,p,w,b,k,d,g){var nt;if(st!=undefined&&st.hide(),vt!=undefined&&vt.hide(),c=!1,a=!1,ir==undefined||ir==null){if(ar=t("<p>"+n.Utility.encodeText(r)+"<\/p>"),ti=t("<p>"+n.Utility.encodeText(u)+"<\/p>"),rr=t("<p>"+n.Utility.encodeText(h)+"<\/p>"),ur=t("<p>"+n.Utility.encodeText(y)+"<\/p>"),tr=t(" <p>"+n.Utility.encodeText(f)+"<\/p>"),ir=t("<p>"+n.Utility.encodeText(e)+"<\/p>"),li=t('<a class="vis-attachhistory-email-dropdown"><\/a>'),(hi==undefined||hi==null)&&(hi=t('<p class="vis-attachhistory-detail"><\/p>')),hi.html(s),(ii==undefined||ii==null)&&(ii=t('<input type="text" placeholder="'+n.Msg.getMsg("TypeComment")+'"><\/input>')),pi=t('<img src="'+n.Application.contextUrl+'Areas/vis/Images/history-email.png" alt="email">'),ci=n.Application.isRTL?t('<img style="float:left;cursor:pointer;margin-top:3px;margin-right:5px" data-ids="'+d+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email">'):t('<img style="float:right;cursor:pointer;margin-top:3px;margin-right:5px" data-ids="'+d+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email">'),ft=t('<div class="vis-attachhistory-right-content">'),l=t('<div class="vis-attachhistory-grid-data">'),l.append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>"+n.Msg.getMsg("Title")+"<\/h6>").append(pi)).append(ar)),l.append(t('<div class="vis-attachhistory-right-row3"><\/div>').append(li).append(ci)),b==!0&&l.find(".vis-attachhistory-right-row").last().hide(),b==!0&&l.append(t('<div class="vis-attachhistory-right-row3">').append(ir)),d==0?ci.hide():ci.show(),w==!0?pi.prop("src",n.Application.contextUrl+"Areas/vis/Images/history-email.png"):b==!0&&pi.prop("src",n.Application.contextUrl+"Areas/vis/Images/history-letter.png"),l.append(t('<div class="vis-attachhistory-right-row vis-attachhistory-to">').append("<h6>"+n.Msg.getMsg("To")+"<\/h6> ").append(ti)),(u=="undefined"||u==null||u==""||b==!0)&&l.find(".vis-attachhistory-right-row").last().hide(),l.append(t('<div value="bccDiv" class="vis-attachhistory-right-row  vis-attachhistory-bcc">').append("<h6>"+n.Msg.getMsg("Bcc")+"<\/h6> ").append(rr)),(h=="undefined"||h==null||h==""||b==!0)&&l.find(".vis-attachhistory-right-row").last().hide(),l.append(t('<div  value="ccDiv"  class="vis-attachhistory-right-row vis-attachhistory-cc">').append("<h6>"+n.Msg.getMsg("Cc")+"<\/h6> ").append(ur)),(y=="undefined"||y==null||y==""||b==!0)&&l.find(".vis-attachhistory-right-row").last().hide(),l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("From")+"<\/h6>").append(tr)),l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("Attachments")+"<\/h6>")),k!=undefined&&k.length>0)for(nt=0;nt<k.length;nt++)ni.append('<li><a data-IDs="'+k[nt].ID+'">'+n.Utility.encodeText(k[nt].Name)+'<\/a><span class="vis-attachhistory-attach-download"><img src="'+n.Application.contextUrl+'Areas/vis/Images/history-download.png" alt="email"><\/span><\/li>');else l.find(".vis-attachhistory-right-row").last().hide();l.find(".vis-attachhistory-right-row").last().append(ni);su=t('<div class="vis-attachhistory-right-row">');l.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("Details")+"<\/h6>").append(hi)).append(su);gr=t('<div class="vis-attachhistory-bottom"><\/div>');gu=t('<div class="vis-attachhistory-comments"><\/div>');gu.append(ii).append('<span class="vis-attachhistory-comment-icon"><\/span>');gr.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(gu).append('<p class="vis-attachhistory-view-comments" style="float:right;width:auto">'+n.Msg.getMsg("ViewMoreComments")+"<\/p>"));ft.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(l).append(gr);gi.parent()!=undefined?v.append(ft):v.append(ft);ci.on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[0],r[1])})}else{if(ft.show(),t(ft[0].children[0]).hide(),(li==undefined||li==null)&&(li=t('<a class="vis-attachhistory-email-dropdown"><\/a>')),w==!0?(pi.prop("src",n.Application.contextUrl+"Areas/vis/Images/history-email.png"),li.show()):b==!0&&(pi.prop("src",n.Application.contextUrl+"Areas/vis/Images/history-letter.png"),li.hide()),ar.text(n.Utility.encodeText(r)),u=="undefined"||u==null&&u==""||b==!0?t(ti.parent()).hide():(ti.text(n.Utility.encodeText(u)),t(ti.parent()).show()),h=="undefined"||h==null||h==""||b==!0?t(rr.parent()).hide():(rr.text(n.Utility.encodeText(h)),t(rr.parent()).show()),y=="undefined"||y==null||y==""||b==!0?t(ur.parent()).hide():(ur.text(n.Utility.encodeText(y)),t(ur.parent()).show()),b==!0?t(tr.parent()).hide():(tr.text(n.Utility.encodeText(f)),t(tr.parent()).show()),ci.data("ids",d),d==0?ci.hide():ci.show(),ir.text(n.Utility.encodeText(e)),k!=undefined&&k.length>0){for(ni.empty(),nt=0;nt<k.length;nt++)ni.append('<li><a  data-IDs="'+k[nt].ID+'">'+n.Utility.encodeText(k[nt].Name)+'<\/a><span class="vis-attachhistory-attach-download"><img src="'+n.Application.contextUrl+'Areas/vis/Images/history-download.png" alt="email"><\/span><\/li>');t(ni.parent()).show()}else t(ni.parent()).hide();hi.html(s)}t(".vis-attachhistory-view-comments").off("click");t(".vis-attachhistory-view-comments").on("click",function(){bf(g,!1,!1,this)});if(w){pf=g;li.show();t(".vis-attachhistory-email-dropdown").off("click");t(".vis-attachhistory-email-dropdown").on("click",function(){t(this).w2overlay(ku.clone(!0),{css:{height:"300px"}})})}else li.hide();t(".vis-attachhistory-comment-icon").data("ID",i);p!=undefined?ii.val(n.Utility.encodeText(p)):ii.val("");o[0].style.visibility="hidden"}function yo(i,r,u,f,e,s,h,l,y,p,w,b,k,d,nt){var tt,it,rt;if(ft!=undefined&&ft.hide(),vt!=undefined&&vt.hide(),c=!0,a=!1,or==undefined||or==null){iu=t("<p>"+n.Utility.encodeText(r)+"<\/p>");tu=t("<p>"+n.Utility.encodeText(w)+"<\/p>");fr=t("<p>"+n.Utility.encodeText(u)+"<\/p>");er=t("<p>"+n.Utility.encodeText(b)+"<\/p>");tf=t("<p>"+n.Utility.encodeText(nt)+"<\/p>");rf=t("<p>"+n.Utility.encodeText(f)+"<\/p>");or=t("<p>"+n.Utility.encodeText(new Date(e).toLocaleString())+"<\/p>");ru=t(" <p>"+n.Utility.encodeText(new Date(s).toLocaleString())+"<\/p>");uu=t("<p>"+n.Utility.encodeText(h)+"<\/p>");(ri==undefined||ri==null)&&(ri=t('<input type="text" placeholder="'+n.Msg.getMsg("TypeComment")+'"><\/input>'));ct=n.Application.isRTL?t('<img style="float:left;cursor:pointer" data-ids="'+p+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email">'):t('<img style="float:right;cursor:pointer" data-ids="'+p+'" src="'+n.Application.contextUrl+'Areas/vis/Images/history-zoom.png" alt="email">');st=t('<div class="vis-attachhistory-right-content">');g=t('<div class="vis-attachhistory-grid-data" >');tt=t('<div style="float:left;width:100%" ><\/div>');tt.append(t('<div class="vis-attachhistory-right-row2">').append(t("<h6>"+n.Msg.getMsg("Title")+' <img src="'+n.Application.contextUrl+'Areas/vis/Images/history-appointment.png"  alt="email"><\/h6>').append(ct)).append(tu));p==0?ct.hide():ct.show();tt.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>"+n.Msg.getMsg("Location")+"<\/h6> ").append(iu));(r=="undefined"||r==null&&r=="")&&g.find(".vis-attachhistory-right-row").last().hide();g.append(tt);it=t('<div style="float:left;width:100%" ><\/div>');it.append(t('<div  class="vis-attachhistory-right-row2"> ').append("<h6>"+n.Msg.getMsg("StartDate")+"<\/h6> ").append(or));it.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>"+n.Msg.getMsg("EndDate")+"<\/h6>").append(ru));g.append(it);rt=t('<div style="float:left;width:100%" ><\/div>');rt.append(t('<div class="vis-attachhistory-right-row2">').append("<h6>"+n.Msg.getMsg("AllDay")+"<\/h6>").append(uu));rt.append(t('<div class="vis-attachhistory-right-row3"  style="margin-bottom:11px" >').append("<h6>"+n.Msg.getMsg("Category")+"<\/h6> ").append(er));g.append(rt);g.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("Contacts")+"<\/h6> ").append(tf));hu=t('<div class="vis-attachhistory-right-row" >');g.append(t('<div class="vis-attachhistory-right-row">').append("<h6>"+n.Msg.getMsg("Description")+"<\/h6> ").append(fr)).append(hu);(u=="undefined"||u==null&&u=="")&&g.find(".vis-attachhistory-right-row").last().hide();nu=t('<div class="vis-attachhistory-bottom"><\/div>');nf=t('<div class="vis-attachhistory-comments"><\/div>');nf.append(ri).append('<span class="vis-attachhistory-comment-icon"><\/span>');nu.append(t('<div class="vis-attachhistory-right-row" style="margin-top:0px">').append(nf).append('<p class="vis-attachhistory-view-comments">'+n.Msg.getMsg("ViewMoreComments")+"<\/p>"));st.append('<div style="display:none" class="vis-attachhistory-grid-data">').append(g).append(nu);v.append(st);ct.on("click",function(i){var r=t(i.target).data("ids").split("-");n.AEnv.zoom(r[0],r[1])})}else st.show(),tu.text(n.Utility.encodeText(w)),iu.text(n.Utility.encodeText(r)),u=="undefined"||u==null||u==""?t(fr.parent()).hide():(fr.text(n.Utility.encodeText(u)),t(fr.parent()).show()),tf.text(n.Utility.encodeText(nt)),b=="undefined"||b==null||b==""?er.text(n.Utility.encodeText("")):er.text(n.Utility.encodeText(b)),ct.data("ids",p),p==0?ct.hide():ct.show(),or.text(n.Utility.encodeText(new Date(e).toLocaleString())),ru.text(n.Utility.encodeText(new Date(s).toLocaleString())),uu.text(n.Utility.encodeText(h)),t(st[0].children[0]).hide();t(".vis-attachhistory-view-comments").off("click");t(".vis-attachhistory-view-comments").on("click",function(){bf(d,!0,!1,this)});y!=undefined?ri.val(n.Utility.encodeText(y)):ri.val("");t(".vis-attachhistory-comment-icon").data("ID",i);o[0].style.visibility="hidden"}function bf(i,r,u,f){r==!0?g.is(":visible")?(t.ajax({url:n.Application.contextUrl+"AttachmentHistory/ViewChatonHistory",datatype:"json",type:"POST",cache:!1,data:{record_ID:i,isAppointment:r,isCall:u},success:function(n){var t=JSON.parse(n);kf(t,r,u)},error:function(){n.ADialog.error("RecordNotSaved")}}),t(f).text(n.Msg.getMsg("HideComments"))):(g.show(),t(st[0].children[0]).hide(),t(f).text(n.Msg.getMsg("ViewMoreComments"))):u==!0?rt.is(":visible")?(t.ajax({url:n.Application.contextUrl+"AttachmentHistory/ViewChatonHistory",datatype:"json",type:"POST",cache:!1,data:{record_ID:i,isAppointment:r,isCall:u},success:function(n){var t=JSON.parse(n);kf(t,r,u)},error:function(){n.ADialog.error("RecordNotSaved")}}),t(f).text(n.Msg.getMsg("HideComments"))):(rt.show(),t(vt[0].children[0]).hide(),t(f).text(n.Msg.getMsg("ViewMoreComments"))):l.is(":visible")?(t.ajax({url:n.Application.contextUrl+"AttachmentHistory/ViewChatonHistory",datatype:"json",type:"POST",cache:!1,data:{record_ID:i,isAppointment:r,isCall:u},success:function(n){var t=JSON.parse(n);kf(t,r,u)},error:function(){n.ADialog.error("RecordNotSaved")}}),t(f).text(n.Msg.getMsg("HideComments"))):(l.show(),t(ft[0].children[0]).hide(),t(f).text(n.Msg.getMsg("ViewMoreComments")))}function vu(t,i){return t+='   <div class="vis-attachhistory-comment-data"><div class="vis-attachhistory-comment-detail">',t+=i.UserImage!="NoRecordFound"&&i.UserImage!="FileDoesn'tExist"&&i.UserImage!=null?'<img  class="userAvatar-Feeds"  src="'+i.UserImage+"?"+new Date+'">':'<img  class="userAvatar-Feeds" src="'+n.Application.contextUrl+'Areas/VIS/Images/home/defaultUser46X46.png ">',t+='<div class="vis-attachhistory-comment-text">',t+=i.CreatedBy==n.Env.getCtx().getAD_User_ID()?"<h6>"+n.Msg.getMsg("Me")+" <\/h6>":"<h6>"+i.UserName+"<\/h6>",t+(" <p>"+i.CharacterData+'<\/p><\/div><div class="vis-attachhistory-comment-dateTime"><p>'+new Date(i.Created).toLocaleString()+"<\/p><\/div><\/div><\/div>")}function kf(n,i,r){var u,f;if(n.length>0){for(u=' <div class="vis-attachhistory-comments-container">',f=0;f<n.length;f++)u=vu(u,n[f]);u+="<\/div>"}r==!0?rt.is(":visible")?(t(vt[0].children[0]).show(),t(vt[0].children[0]).empty(),t(vt[0].children[0]).append(u),rt.hide()):(rt.show(),t(vt[0].children[0]).hide()):i==!0?g.is(":visible")?(t(st[0].children[0]).show(),t(st[0].children[0]).empty(),t(st[0].children[0]).append(u),g.hide()):(g.show(),t(st[0].children[0]).hide()):l.is(":visible")?(t(ft[0].children[0]).show(),t(ft[0].children[0]).empty(),t(ft[0].children[0]).append(u),l.hide()):(l.show(),t(ft[0].children[0]).hide())}function po(i){var r=i.target,f="",u="";(t(r).is("a")?(f=t(r).text(),u=t(r).data("ids")):t(r).is("img")?(f=t(t(r).parent()).siblings().text(),u=t(t(r).parent()).siblings().data("ids")):t(r).is("span")&&(f=t(r).siblings().text(),u=t(r).siblings().data("ids")),u!=null&&u!=0)&&(o[0].style.visibility="hidden",t.ajax({url:n.Application.contextUrl+"AttachmentHistory/DownloadAttachment",datatype:"json",type:"get",cache:!1,data:{ID:u,Name:f},success:function(t){var i=JSON.parse(t),r=n.Application.contextUrl+"TempDownload/"+i;window.open(r);o[0].style.visibility="hidden"}}))}function wo(i){var r=i.target,f="",u="",e="";(t(r).is("a")?(f=t(r).text(),e=t(r).data("AttID"),u=t(r).data("id")):t(r).is("img")?(f=t(t(r).parent()).siblings().text(),e=t(t(r).parent()).siblings().data("attid"),u=t(t(r).parent()).siblings().data("id")):t(r).is("span")&&(f=t(r).siblings().text(),e=t(r).siblings().data("attid"),u=t(t(r).parent()).siblings().data("id")),u!=null&&u!=0)&&(o[0].style.visibility="hidden",t.ajax({url:n.Application.contextUrl+"AttachmentHistory/DownloadAttachmentCall",datatype:"json",type:"get",cache:!1,data:{AttID:e,ID:u,Name:f},success:function(t){var i=JSON.parse(t),r;i!=null&&i!=""?(r=n.Application.contextUrl+"TempDownload/"+i,window.open(r)):n.ADialog.error("AttachmentNotFound");o[0].style.visibility="hidden"}}))}function ce(i){var f=i.target,r,u;(i.keyCode==undefined||i.keyCode==13)&&(i.keyCode!=undefined||t(f).hasClass("vis-attachhistory-comment-icon"))&&(r=0,r=t(".vis-attachhistory-comment-icon").data("ID"),r!=0)&&(u="",u=c==!0?ri.val():a==!0?wi.val():ii.val(),u.length!=0)&&t.ajax({url:n.Application.contextUrl+"AttachmentHistory/SaveComment",datatype:"json",type:"POST",cache:!1,data:{ID:r,Text:u,isAppointment:c,isCall:a},success:function(n){var f=JSON.parse(n),r=!0,i,u;if(a==!0?(wi.val(""),rt.is(":visible")&&(r=!1)):c==!0?(ri.val(""),g.is(":visible")&&(r=!1)):(ii.val(""),l.is(":visible")&&(r=!1)),r==!0){if(f.length>0){for(i=' <div class="vis-attachhistory-comments-container">',u=0;u<f.length;u++)i=vu(i,f[u]);i+="<\/div>"}c==!0?(t(st[0].children[0]).empty(),t(st[0].children[0]).append(i)):a==!0?(t(vt[0].children[0]).empty(),t(vt[0].children[0]).append(i)):(t(ft[0].children[0]).empty(),t(ft[0].children[0]).append(i))}else pt(w,c,a)},error:function(){n.ADialog.error("RecordNotSaved")}})}function pt(i,r,u){t.ajax({url:n.Application.contextUrl+"AttachmentHistory/ViewChatonLastHistory",datatype:"json",type:"POST",cache:!1,data:{record_ID:i,isAppointment:r,isCall:u},success:function(n){var f=JSON.parse(n),t,i;if(f.length>0)if(r)for(t='<div style="height:88px"><\/div>',hu.empty(),i=0;i<f.length;i++)t=vu(t,f[i]),hu.append(t);else if(u)for(t="<div><\/div>",cu.empty(),i=0;i<f.length;i++)t=vu(t,f[i]),cu.append(t);else for(t='<div style="height:120px"><\/div>',su.empty(),i=0;i<f.length;i++)t=vu(t,f[i]),su.append(t);else u?cu.empty():r?hu.empty():su.empty()}})}var le=n.Env.getWindowNo(),ae=n.Env.getCtx(),wt=[],si=[],h=[],dt=[],vi=[],c,bt=[],yi=[],y=[],kt,br,d,ut,yt,p,b,di,df=this,kr,yu,du,gi,dr,pu,nr,wu,v,ft,st,g,gr,nu,k,gu,nf,l,ni,ar,ti,tr,gf,hi,ir,ii,rr,ur,pi,ri,ci,ct,li,tu,iu,fr,er,tf,rf,or,ru,uu,o,ai=50,it,nt,uf,fu,eu,ui,fi,ei,tt,ou,et,lt,at,ot,gt,s,ht,ve,bu,ne,te,ie,ku,su,hu,vt,rt,wi,ff,ef,of,sf,hf,cf,lf,af,vf,yf,a,oi,cu,bi,ki,w,pf;this.initializeComponent=function(){bu=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());it=1;nt=1;tt=1;we();pe();ye();re();sr();ro()};this.displayInboxDiv=function(){ut=d.w2grid({name:"historyinboxgrid",recordHeight:30,show:{toolbar:!0},multiSelect:!1,columns:wt,records:si});ut.on("select",wr);ut.on("search",pr);si.length>0?(ut.select(0),k.hide(),v.show()):(k.show(),v.hide());o[0].style.visibility="hidden";t(".vis-attachhistory-search-icon").on("click",fe)};ki=!1;w=0;pf=0;this.getRoot=function(){return br};this.show=function(){kt=new n.ChildDialog;this.initializeComponent();kt.setContent(br);bu==!0?(kt.setHeight(650),kt.setWidth(800)):(kt.setHeight(650),kt.setWidth(1e3));kt.setTitle(n.Msg.getMsg("History"));kt.setModal(!0);kt.show();kt.hideButtons();this.displayInboxDiv();kt.onClose=function(){df.dispose()}};this.dispose=function(){le=0;ae=null;wt=[];wt=null;si=[];si=null;h=[];h=null;kr!=null&&kr.remove();yu!=null&&yu.remove();dr!=null&&dr.remove();pu!=null&&pu.remove();nr!=null&&nr.remove();wu!=null&&wu.remove();v!=null&&v.remove();ft!=null&&ft.remove();st!=null&&st.remove();g!=null&&g.remove();gr!=null&&gr.remove();nu!=null&&nu.remove();k!=null&&k.remove();l!=null&&l.remove();ni!=null&&ni.remove();oi!=null&&oi.remove();ar!=null&&ar.remove();ti!=null&&ti.remove();tr!=null&&tr.remove();bi!=null&&bi.remove();gf!=null&&gf.remove();hi!=null&&hi.remove();ir!=null&&ir.remove();ii!=null&&ii.remove();rr!=null&&rr.remove();ur!=null&&ur.remove();pi!=null&&pi.remove();ri!=null&&ri.remove();iu!=null&&iu.remove();tu!=null&&tu.remove();fr!=null&&fr.remove();rf!=null&&rf.remove();or!=null&&or.remove();ru!=null&&ru.remove();uu!=null&&uu.remove();o!=null&&o.remove();ou!=null&&ou.remove();et!=null&&et.remove();lt!=null&&lt.remove();at!=null&&at.remove();ot!=null&&ot.remove();gt!=null&&gt.remove();s!=null&&s.remove();d!=null&&d!=undefined&&d.remove();d=null;ut!=null&&ut!=undefined&&ut.destroy();ut=null;w2ui.historyinboxgrid!=undefined&&w2ui.historyinboxgrid.destroy();p!=null&&p!=undefined&&p.destroy();p=null;w2ui.realtedhistorygrid!=undefined&&w2ui.realtedhistorygrid.destroy();b!=null&&b!=undefined&&b.destroy();b=null;w2ui.userhistorygrid!=undefined&&w2ui.userhistorygrid.destroy();df=null}}}(VIS,jQuery),function(n,t){function r(){var d=null,g=null,v=null,ot=null,nt=null,y=null,tt=null,st=null,ht=null,yt=null,o=null,p=null,ct=null,s=null,pt=null,lt=null,h=null,wt=null,at=null,c=null,bt=null,vt=null,l=null,kt=null,it=null,w=null,rt=null,dt=null,ut=null,ft=null,b=null,e=null,u=null,ei=null,oi=null,a=null,r=null,f=-1,k=!1;this.Load=function(i,r){d=i;g=r;n.Application.isRTL?(tt=t("<div class='vis-rad-recordData' style='float:right'>"),e=t("<button  class='vis-rad-navBtn' disabled='disabled' style='float:left'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/down-arrow.png'>")),u=t("<button  class='vis-rad-navBtn' disabled='disabled' style='float:left'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/up-arrow.png'>")),it=t("<div class='vis-rad-actionIcons' style='float:right'>"),w=t("<button  class='vis-rad-actionBtn' style='margin-right:0px'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/add-new.png'>")),ut=t("<div class='vis-rad-btnWrap' style='float:left'>"),b=t("<a href = 'javascript:void(0)'  class='vis-rad-buttons' style='margin-left:0px'>").append(n.Msg.getMsg("Cancel")),dt=t("<span class='vis-rad-paging' style='float:none' >").append(a),s=t("<input type='checkbox' checked style='float:right' >"),pt=t("<label style='float:right'>").append(n.Msg.translate(n.Env.getCtx(),"IsActive")),h=t("<input type='checkbox' checked style='float:right'>"),wt=t("<label style='float:right'>").append(n.Msg.translate(n.Env.getCtx(),"IsExclude")),c=t("<input type='checkbox' style='float:right'>"),bt=t("<label style='float:right'>").append(n.Msg.translate(n.Env.getCtx(),"IsReadOnly")),l=t("<input type='checkbox' style='float:right'>"),kt=t("<label style='float:right'>").append(n.Msg.translate(n.Env.getCtx(),"IsDependentEntities"))):(tt=t("<div class='vis-rad-recordData'>"),e=t("<button  class='vis-rad-navBtn' disabled='disabled'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/down-arrow.png'>")),u=t("<button  class='vis-rad-navBtn' disabled='disabled'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/up-arrow.png'>")),it=t("<div class='vis-rad-actionIcons' >"),w=t("<button  class='vis-rad-actionBtn'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/add-new.png'>")),ut=t("<div class='vis-rad-btnWrap' >"),b=t("<a href = 'javascript:void(0)'  class='vis-rad-buttons'>").append(n.Msg.getMsg("Cancel")),dt=t("<span class='vis-rad-paging'>").append(a),s=t("<input type='checkbox' checked >"),pt=t("<label>").append(n.Msg.translate(n.Env.getCtx(),"IsActive")),h=t("<input type='checkbox' checked >"),wt=t("<label>").append(n.Msg.translate(n.Env.getCtx(),"IsExclude")),c=t("<input type='checkbox'>"),bt=t("<label>").append(n.Msg.translate(n.Env.getCtx(),"IsReadOnly")),l=t("<input type='checkbox'>"),kt=t("<label>").append(n.Msg.translate(n.Env.getCtx(),"IsDependentEntities")));v=t("<div class='vis-forms-container'>");ot=t("<div class='vis-forms-container vis-rad-contantWrap'>");nt=t("<div class='vis-rad-contantTop'>");ht=t("<div class='vis-rad-roleCombo'>");yt=t("<lable>").append(n.Msg.translate(n.Env.getCtx(),"AD_Role_ID"));o=t("<select>");ht.append(yt);ht.append(o);p=t("<div class='vis-rad-recordOp'>");ct=t("<div class='vis-rad-check'>");ct.append(s);ct.append(pt);p.append(ct);lt=t("<div class='vis-rad-check'>");lt.append(h);lt.append(wt);p.append(lt);at=t("<div class='vis-rad-check'>");at.append(c);at.append(bt);p.append(at);vt=t("<div class='vis-rad-check'>");vt.append(l);vt.append(kt);p.append(vt);tt.append(ht);tt.append(p);nt.append(tt);st=t("<div class='vis-rad-navIcons'>");st.append(e);st.append(u);nt.append(st);y=t("<div class='vis-rad-contantBottom'>");rt=t("<button  class='vis-rad-actionBtn'>").append(t("<img src='"+n.Application.contextUrl+"Areas/VIS/Images/del.png'>"));it.append(w);it.append(rt);y.append(it);a=t("<lable>");y.append(dt);ft=t("<a href = 'javascript:void(0)'  class='vis-rad-buttons'>").append(n.Msg.getMsg("Ok"));ut.append(b);ut.append(ft);y.append(ut);ot.append(nt);ot.append(y);v.append(ot);ri();gt();ni();v.dialog({width:600,height:228,resizable:!1,title:"Record",modal:!0})};var gt=function(){var t=n.dataContext.getJSONData(n.Application.contextUrl+"RecordAccess/GetRoles",null,null),r='<option Value="-1"><\/option>';if(t!=null)for(i in t)r+='<option value="'+t[i].AD_Role_ID+'">'+t[i].Name+"<\/option>";o.append(r);r=null;t=null},ni=function(){var t,i,u;if(r==null&&(r=[]),t=n.dataContext.getJSONData(n.Application.contextUrl+"RecordAccess/GetRecordAccess",{Table_ID:d,Record_ID:g},null),i=null,t!=null)for(u in t)i={},i.AD_ROLE_ID=t[u].AD_ROLE_ID,i.ISACTIVE=t[u].ISACTIVE,i.ISDEPENDENTENTITIES=t[u].ISDEPENDENTENTITIES,i.ISEXCLUDE=t[u].ISEXCLUDE,i.ISREADONLY=t[u].ISREADONLY,r.push(i);i=null;t=null;r.length>0?(f=0,et()):k=!0},ti=function(){var r=o.val(),i;r!=-1&&(i=!1,k||(i=!0),t.ajax({url:n.Application.contextUrl+"RecordAccess/SaveAccess/",dataType:"json",data:{AD_Role_ID:r,AD_Table_ID:d,Record_ID:g,isActive:s.prop("checked"),isExclude:h.prop("checked"),isReadOnly:c.prop("checked"),isDependentEntities:l.prop("checked"),isUpdate:i},success:function(n){var t=n.result;t==!0&&ii()}}))},ri=function(){e.on("click",function(){f+=1;et()});u.on("click",function(){k?k=!1:f-=1;et()});w.on("click",function(){ui()});rt.on("click",function(){fi()});ft.on("click",function(){ti()});b.on("click",function(){ii()})},ui=function(){k=!0;f=r.length-1;et();o.val(-1);s.attr("checked",!0);h.attr("checked",!0);c.attr("checked",!1);l.attr("checked",!1);a.empty();a.append("+"+(r.length+1)+"/"+(r.length+1));r.length>0&&(u.attr("disabled",!1),u.css("opacity","1"))},et=function(){o.val(r[f].AD_ROLE_ID);s.attr("checked",r[f].ISACTIVE=="Y"?!0:!1);h.attr("checked",r[f].ISEXCLUDE=="Y"?!0:!1);c.attr("checked",r[f].ISREADONLY=="Y"?!0:!1);l.attr("checked",r[f].ISDEPENDENTENTITIES=="Y"?!0:!1);a.empty();a.append(f+1+"/"+r.length);r.length>f+1?(e.attr("disabled",!1),e.css("opacity","1")):(e.attr("disabled",!0),e.css("opacity",".5"));f==0?(u.attr("disabled",!0),u.css("opacity",".5")):(u.attr("disabled",!1),u.css("opacity","1"))},fi=function(){var i=o.val();i==-1||k||t.ajax({url:n.Application.contextUrl+"RecordAccess/DeleteRecord/",dataType:"json",data:{AD_Role_ID:i,AD_Table_ID:d,Record_ID:g,isActive:s.prop("checked"),isExclude:h.prop("checked"),isReadOnly:c.prop("checked"),isDependentEntities:l.prop("checked")},success:function(n){var t=n.result;t==!0&&ii()}})},ii=function(){e.off("click");u.off("click");w.off("click");rt.off("click");ft.off("click");b.off("click");gt=null;ni=null;ti=null;ri=null;ui=null;et=null;fi=null;d=null;g=null;nt=null;y=null;ei=null;oi=null;e=null;u=null;w=null;rt=null;ft=null;b=null;yt=null;o=null;s=null;h=null;c=null;l=null;a=null;r=null;gt=null;ni=null;ti=null;v.dialog("destroy");v.remove();v=null}}n.RecordAccessDialog=r}(VIS,jQuery),function(n,t){function i(){function lf(n,i,r){var u=null;return t.ajax({url:hf,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function af(){b=si.getContextAsInt("$C_Currency_ID");yi=cf("VIS_131");yf();pf();te();gf();wf();bf();kf();df();bi.append(ot).append(st).append(gt).append(of);ht.getControl().css("background-color",fi(!0));wi.resizable({handles:"e",minWidth:226,maxWidth:600,resize:function(n,i){var r=i.size.width;r>197&&bi.width(t(document).width()-(r+40))}});ot.css("display","");st.css("display","none");dt.append(wi.append(l)).append(bi);var i=t('<div style="padding-right: 15px;">');i.append(' <a class="vis-group-btn vis-group-create vis-group-grayBtn" style="float: right;">'+n.Msg.getMsg("Process")+"<\/a>");wi.append(i);dt.append(wi.append(l).append(i)).append(bi);bt=dt.find(".vis-group-btn");bt.css({"pointer-events":"none",opacity:"0.5"});ne();vf();dt.find(".vis-allocation-resultdiv").css({width:"100%",margin:"0",bottom:"0",position:"inherit"});f[0].style.visibility="hidden"}function vf(){ht.fireValueChanged=ge;rt.on("change",function(){ar("C_Currency_ID",rt.val());d()});y.on("change",function(){ar("Date",y.is(":checked"));d()});yt.on("change",function(){to()});c.on("change",function(){if(uf()){if(new Date(c.val())<nt)return n.ADialog.info("",!0,n.Msg.getMsg("SelectMaxDate")+Globalize.format(new Date(nt),"yyyy-MM-dd"),""),c.val(Globalize.format(new Date(nt),"yyyy-MM-dd")),!1}else n.ADialog.info("",!0,n.Msg.getMsg("PleaseSelectRecord"),"")});bt.on("click",function(){if(uf()){if(c.val().trim()=="")return n.ADialog.info("",!0,n.Msg.getMsg("InvalidDateFormat"),""),!1;if(new Date(c.val())<nt)return n.ADialog.info("",!0,n.Msg.getMsg("SelectMaxDate")+Globalize.format(new Date(nt),"yyyy-MM-dd"),""),c.val(Globalize.format(new Date(nt),"yyyy-MM-dd")),!1;vt?parseInt(o.val())>0?ff():n.ADialog.info("",!0,n.Msg.getMsg("ValidateOrg"),""):n.ADialog.confirm("ConfirmForDiffOrg",!0,"","Confirm",function(t){if(t)parseInt(o.val())>0?ff():n.ADialog.info("",!0,n.Msg.getMsg("ValidateOrg"),"");else return})}else n.ADialog.info("",!0,n.Msg.getMsg("PleaseSelectRecord"),"")});nu.on("click",function(){rf();au()});ki.on("change",function(){ei()});ut.on("change",function(){ei()});vr.on("change",function(){ei()});di.on("change",function(){ei()});ni.on("change",function(n){for(var u=t("#grid_"+i.name+'_records td[col="0"]').find('input[type="checkbox"]'),f,r=0;r<u.length;r++)t(u[r]).prop("checked",ni.prop("checked")),i.editChange.call(i,u[r],r,0,n),f={type:"click",phase:"before",target:"grid",recid:r,index:r,isStopped:!1,"isCan//celled":!1,onComplete:null},i.trigger(f);ni.prop("checked")==!1&&(h=[])});ti.on("change",function(n){for(var u=t("#grid_"+r.name+'_records td[col="0"]').find('input[type="checkbox"]'),f,i=0;i<u.length;i++)t(u[i]).prop("checked",ti.prop("checked")),r.editChange.call(r,u[i],i,0,n),f={type:"click",phase:"before",target:"grid",recid:i,index:i,isStopped:!1,"isCan//celled":!1,onComplete:null},r.trigger(f)});ii.on("change",function(n){for(var r=t("#grid_"+u.name+'_records td[col="0"]').find('input[type="checkbox"]'),f,i=0;i<r.length;i++)t(r[i]).prop("checked",ii.prop("checked")),u.editChange.call(u,r[i],i,0,n),f={type:"click",phase:"before",target:"grid",recid:i,index:i,isStopped:!1,"isCan//celled":!1,onComplete:null},u.trigger(f)});o.on("change",function(){parseInt(o.val())>0?o.css("background-color",fi(!1)):o.css("background-color",fi(!0))});ft.on("change",function(){yr=ft.val();d()});tr.on("change",function(){ar("Date",tr.is(":checked"));pt=tr.is(":checked");d()});ku.on("click",function(n){for(var u=t("#grid_"+i.name+'_records td[col="0"]').find('input[type="checkbox"]'),f,r=0;r<u.length;r++)t(u[r]).prop("checked",!1),i.editChange.call(i,u[r],r,0,n),f={type:"click",phase:"before",target:"grid",recid:r,index:r,isStopped:!1,"isCan//celled":!1,onComplete:null},i.trigger(f);h=[];ei()})}function yf(){var t=null,r=n.MLookupFactory.getMLookUp(si,er.windowNo,3505,n.DisplayType.TableDir),i;if(t=r.getData(!0,!0,!1,!1),t!=null&&t!=undefined&&t.length>0)for(i=0;i<t.length;i++)rt.append("<option value="+t[i].Key+">"+t[i].Name+"<\/option>"),t[i].Key==b&&rt.val(b);r=n.MLookupFactory.getMLookUp(si,er.windowNo,3499,n.DisplayType.Search);ht=new n.Controls.VTextBoxButton("C_BPartner_ID",!0,!1,!0,n.DisplayType.Search,r)}function fi(n){return n?"#FFB6C1":"White"}function pf(){t.ajax({type:"POST",url:n.Application.contextUrl+"PaymentAllocation/GetDocType",dataType:"json",success:function(t){var r=JSON.parse(t),i;if(r)for(ut.empty(),ut.append("<option value= 0 >Select<\/option>"),i=0;i<r.length;i++)vu=n.Utility.Util.getValueOfString(r[i].DocType),yu=n.Utility.Util.getValueOfInt(r[i].C_DocType_ID),ut.append(" <option value="+yu+">"+vu+"<\/option>");else ut.append("<option value= 0 >Select<\/option>");ut.prop("selectedIndex",0)},error:function(n){console.log(n)}})}function ei(){if(w>0){if(p=vr.val(),v=di.val(),v!=""&&p>v)return di.val(""),n.ADialog.info("Message",!0,n.Msg.getMsg("VIS_FromDateGreater"),"");f[0].style.visibility="visible";kt=1;hr=1;cr=0;lr=!1;a=0;var i=y.is(":checked"),r=null;s=c.val();r=s!=null&&s!=undefined&&s!=""?n.DB.to_date(s):n.DB.to_date(new Date);gi=ki.val();nr=ut.val();p!=null&&p!=undefined&&p!=""&&n.DB.to_date(p);v!=null&&v!=undefined&&v!=""&&n.DB.to_date(v);t.ajax({url:n.Application.contextUrl+"PaymentAllocation/GetInvoice",data:{_C_Currency_ID:b,_C_BPartner_ID:w,isInterBPartner:pt,chk:i,date:r,page:kt,size:et,docNo:gi,c_docType_ID:nr,fromDate:p,toDate:v,conversionDate:yr},async:!0,success:function(n){var t=JSON.parse(n),r,u;if(t){if(kt==1&&t.length>0&&(cr=t[0].InvoiceRecord,hr=Math.ceil(cr/et)),h.length>0){for(lt=h.length,r=0;r<t.length;r++)u=h.filter(function(n){return n.C_InvoicePaySchedule_ID==t[r].C_InvoicePaySchedule_ID}),u.length==0&&(t[r].recid=h.length+r,h.push(t[r]));t=h;h=[]}he(t,i);ai=9;ct=10;rr=13;ur=14;li.find("#grid_openformatgridinvoice_"+e.windowNo+"_records").on("scroll",cu);lr=!0;ou()}},error:function(){f[0].style.visibility="hidden"}})}}function wf(){var u=t('<div class="vis-allocation-leftControls">'),f,r,i;u.append('<span class="vis-allocation-inputLabels">'+n.translatedTexts.C_BPartner_ID+"<\/span>").append(ht.getControl().addClass("vis-allocation-bpartner")).append(ht.getBtn(0).css("width","30px").css("height","30px").css("padding","0px").css("border-color","#BBBBBB"));f=t('<div class="vis-allocation-leftControls">');f.append('<span class="vis-allocation-inputLabels">'+n.translatedTexts.C_Currency_ID+"<\/span>").append(rt);l.append(u).append(f);r=t('<div class="vis-allocation-leftControls"><input name="vchkMultiCurrency" class="vis-allocation-multicheckbox" type="checkbox"><label>'+n.Msg.getMsg("MultiCurrency")+'<\/label><\/div><div class="vis-allocation-leftControls"><input  class="vis-allocation-cashbox"  type="checkbox"><label>'+n.Msg.getMsg("Cash")+'<\/label><\/div><div class="vis-allocation-leftControls"><input  class="vis-allocation-autowriteoff"  type="checkbox"><label>'+n.Msg.getMsg("AutoWriteOff")+'<\/label><\/div><div class="vis-allocation-leftControls"><input id=VIS_chkbxBPAllocation_'+e.windowNo+' class="vis-allocation-interBP" style="display:none !important;" type="checkbox"><label style="display:none !important;">'+n.Msg.getMsg("BPAllocation")+'<\/label><\/div><div class="vis-allocation-leftControls"><div class="panel-group" style="margin: 0px;" id="accordion" role="tablist" aria-multiselectable="true"><div class="panel panel-default"><div class="panel-heading" role="tab" id="headingOne"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#accordion" href="#collapseOne" aria-expanded="true" aria-controls="collapseOne" class="VIS-Accordion-head collapsed">'+n.Msg.getMsg("InvoiceFilter")+'<i class="glyphicon glyphicon-chevron-down pull-right"><\/i><\/a><\/h4><\/div><div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne" style="height: 0px;"><div class="panel-body" style=" overflow: auto; height: 140px !important; "><div class="vis-allocation-leftControls"><span class="vis-allocation-inputLabels">'+n.Utility.encodeText(n.Msg.getMsg("Document_No"))+'<\/span> <input class="vis-allocation-docNo" type="textbox"><\/input><\/div><div class="vis-allocation-leftControls vis-allocation-cmbdoctype"><span class="vis-allocation-inputLabels">'+n.Msg.getMsg("DocType")+"<\/span><\/div><\/div><\/div><\/div><\/div><\/div><\/div>");l.append(r);r.find(".vis-allocation-cmbdoctype").append(ut);r.find(".panel-body").append('<div class="vis-allocation-leftControls"><span class="vis-allocation-inputLabels">'+n.Msg.getMsg("VIS_FromDate")+'<\/span><input  class="vis-allocation-fromDate"  type="date"><\/input><\/div><div class="vis-allocation-leftControls"><span class="vis-allocation-inputLabels">'+n.Msg.getMsg("VIS_ToDate")+'<\/span><input  class="vis-allocation-toDate"  type="date"><\/input><\/div>');u.find(".vis-allocation-bpartner").css("width","calc(100% - 30px)");y=l.find(".vis-allocation-multicheckbox");yt=l.find(".vis-allocation-cashbox");nu=l.find(".vis-allocation-autowriteoff");ki=l.find(".vis-allocation-docNo");vr=l.find(".vis-allocation-fromDate");di=l.find(".vis-allocation-toDate");i=t('<div class="vis-allocation-resultdiv">');i.append('<div class="vis-allocation-leftControls"><span class="vis-allocation-inputLabels">'+n.Msg.getMsg("Difference")+"<\/span>");i.append('<div style="width:20% !important" class="vis-allocation-leftControls"><span class="vis-allocation-lblCurrnecy"><\/span><span class="vis-allocation-lbldifferenceAmt" style="float:right;"><\/span>');i.append('<div class="vis-allocation-leftControls"><span class="vis-allocation-inputLabels" title="View allocation will be created on this date" type="date" >'+n.Msg.getMsg("TransactionDate")+'<\/span><input  class="vis-allocation-date" disabled  id=VIS_cmbDate_'+e.windowNo+' type="date"><\/input><\/div>');i.append('<div class="vis-allocation-leftControls"><span class="vis-allocation-inputLabels" title="View allocation will be created on this date" type="date" >'+n.Msg.getMsg("DateAcct")+'<\/span><input  class="vis-allocation-date" disabled id=VIS_cmbAcctDate_'+e.windowNo+' type="date"><\/input><\/div>');i.append('<div class="vis-allocation-leftControls"> <span class="vis-allocation-inputLabels" title="View allocation will be created in this organization" >'+n.translatedTexts.AD_Org_ID+'<\/span> <select class="vis-allocation-currencycmb" id=VIS_cmbOrg_'+e.windowNo+"><\/select>");i.append('<div class="vis-allocation-leftControls" id=VIS_cnvrDateDiv_'+e.windowNo+'><span class="vis-allocation-inputLabels" title="View allocation will be created on this date" type="date" >'+n.Msg.getMsg("ConversionDate")+'<\/span><input  class="vis-allocation-date" style="display:block;" id=VIS_cmbConversionDate_'+e.windowNo+' type="date"><\/input><\/div>');l.append(i);c=l.find("#VIS_cmbDate_"+e.windowNo);c.val(Globalize.format(new Date,"yyyy-MM-dd"));wt=l.find("#VIS_cmbAcctDate_"+e.windowNo);wt.val(Globalize.format(new Date,"yyyy-MM-dd"));ft=l.find("#VIS_cmbConversionDate_"+e.windowNo);ir=l.find("#VIS_cnvrDateDiv_"+e.windowNo);ir.css("display","none");o=l.find("#VIS_cmbOrg_"+e.windowNo);tr=l.find("#VIS_chkbxBPAllocation_"+e.windowNo);gr=i.find(".vis-allocation-lbldifferenceAmt");tf=i.find(".vis-allocation-lblCurrnecy")}function bf(){ot.append('<div style=" width: 100%; float: left; "><p style="float:left;">'+n.translatedTexts.C_Payment_ID+'<\/p>  <input style="float:left;" type="checkbox" id="paymentselectall" /><p class="vis-allocate-paymentSum">'+n.Msg.getMsg("SelectedPayments")+"0-Sum 0.00<\/p><\/div>").append('<div class="vis-allocation-payment-grid"><\/div>');hi=ot.find(".vis-allocation-payment-grid");wr=ot.find(".vis-allocate-paymentSum");ti=ot.find("#paymentselectall")}function kf(){st.append('<div style=" width: 100%; float: left; "><p style="float:left;">'+n.translatedTexts.C_CashLine_ID+'<\/p> <input style="float:left;" type="checkbox" id="cashselectall" /><p class="vis-allocate-cashSum">'+n.Msg.getMsg("SelectedCashlines")+" 0-Sum 0.00<\/p><\/div>").append('<div  class="vis-allocation-cashLine-grid"><\/div>');ci=st.find(".vis-allocation-cashLine-grid");br=st.find(".vis-allocate-cashSum");ii=st.find("#cashselectall")}function df(){gt.append('<div style=" width: 100%; float: left; "><p style="float:left;">'+n.translatedTexts.C_Invoice_ID+'<\/p> <input style="float:left;" type="checkbox" id="invoiceselectall" /><p style="float:left;margin-left: 10px;"> '+n.Msg.getMsg("Reset")+' <\/p> <span id="clrbutton_'+e.windowNo+'" style="float:left;cursor: pointer !important;margin-left: 5px;margin-top: 2px;" class="glyphicon glyphicon-refresh"><\/span><p class="vis-allocate-invoiceSum">'+n.Msg.getMsg("SelectedInvoices")+" 0-Sum 0.00<\/p><\/div>").append('<div  class="vis-allocation-invoice-grid"><\/div>');li=gt.find(".vis-allocation-invoice-grid");kr=gt.find(".vis-allocate-invoiceSum");ni=gt.find("#invoiceselectall");ku=gt.find("#clrbutton_"+e.windowNo)}function gf(){t.ajax({type:"POST",url:n.Application.contextUrl+"VIS/PaymentAllocation/GetOrganization",dataType:"json",success:function(t){var r=JSON.parse(t),i;if(r)for(o.empty(),o.css("background-color",fi(!0)),o.append("<option value=0><\/option>"),i=0;i<r.length;i++)OrgName=n.Utility.Util.getValueOfString(r[i].Name),AD_Org_ID=n.Utility.Util.getValueOfInt(r[i].Value),o.append(" <option value="+AD_Org_ID+">"+OrgName+"<\/option>");else o.append("<option value=0><\/option>");n.context.getContextAsInt("#AD_Org_ID")>0?(o.val(n.context.getContextAsInt("#AD_Org_ID")),o.css("background-color",fi(!1))):o.prop("selectedIndex",0)},error:function(n){console.log(n)}})}function ne(){f=t("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>");f[0].style.visibility="hidden";dt.append(f)}function d(){var r;if(w!=0&&b!=0){ht.getControl().css("background-color",fi(!1));f[0].style.visibility="visible";kt=1;hr=1;cr=0;ri=1;tu=1;iu=0;ui=1;ru=1;uu=0;fu=!1;eu=!1;lr=!1;a=0;r=null;s=c.val();r=s!=null&&s!=undefined&&s!=""?n.DB.to_date(s):n.DB.to_date(new Date);var i=y.is(":checked"),u=si.getAD_Role_ID(),o=si.getAD_User_ID(),h=n.MRole.getDefault(),l=w;t.ajax({url:n.Application.contextUrl+"PaymentAllocation/GetPayments",data:{_C_Currency_ID:b,_C_BPartner_ID:w,isInterBPartner:pt,chk:i,page:ui,size:et},async:!0,success:function(n){var t=JSON.parse(n);if(t){ui==1&&t.length>0&&(uu=t[0].PaymentRecord,ru=Math.ceil(uu/et));fe(t,i);hi.find("#grid_openformatgrid_"+e.windowNo+"_records").on("scroll",su);fu=!0;ou()}},error:function(){f[0].style.visibility="hidden"}});t.ajax({url:n.Application.contextUrl+"PaymentAllocation/GetCashJounral",data:{_C_Currency_ID:b,_C_BPartner_ID:w,isInterBPartner:pt,chk:i,page:ri,size:et},async:!0,success:function(n){var t=JSON.parse(n);if(t){ri==1&&t.length>0&&(iu=t[0].CashRecord,tu=Math.ceil(iu/et));oe(t,i);ci.find("#grid_openformatgridcash_"+e.windowNo+"_records").on("scroll",hu);eu=!0;ou()}},error:function(){f[0].style.visibility="hidden"}});ei();no()}}function te(){t.ajax({url:n.Application.contextUrl+"PaymentAllocation/GetCurrencyPrecision",data:{_C_Currency_ID:b},async:!0,success:function(n){var t=JSON.parse(n);t&&(at=t)},error:function(){}})}function ou(){f[0].style.visibility=fu==!0&&eu==!0&&lr==!0?"hidden":"visible"}function su(){t(this).scrollTop()>0&&(f[0].style.visibility="visible",t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight&&ui<ru&&(ui++,ie(ui,et)),f[0].style.visibility="hidden")}function ie(i,r){var u=y.is(":checked"),f=null;s=c.val();f=s!=null&&s!=undefined&&s!=""?n.DB.to_date(s):n.DB.to_date(new Date);t.ajax({url:n.Application.contextUrl+"PaymentAllocation/GetPayments",data:{_C_Currency_ID:b,_C_BPartner_ID:w,isInterBPartner:pt,chk:u,page:i,size:r},async:!0,success:function(n){var t=JSON.parse(n);t&&ee(t)},error:function(){}})}function hu(){t(this).scrollTop()>0&&(f[0].style.visibility="visible",t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight&&ri<tu&&(ri++,re(ri,et)),f[0].style.visibility="hidden")}function re(i,r){var u=y.is(":checked"),f=null;s=c.val();f=s!=null&&s!=undefined&&s!=""?n.DB.to_date(s):n.DB.to_date(new Date);t.ajax({url:n.Application.contextUrl+"PaymentAllocation/GetCashJounral",data:{_C_Currency_ID:b,_C_BPartner_ID:w,isInterBPartner:pt,chk:u,page:i,size:r},async:!0,success:function(n){var t=JSON.parse(n);t&&se(t)},error:function(){}})}function cu(){t(this).scrollTop()>0&&(f[0].style.visibility="visible",t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight&&kt<hr&&(kt++,ue(kt,et)),f[0].style.visibility="hidden")}function ue(i,r){var f=y.is(":checked"),u=null;s=c.val();u=s!=null&&s!=undefined&&s!=""?n.DB.to_date(s):n.DB.to_date(new Date);gi=ki.val();nr=ut.val();p!=null&&p!=undefined&&p!=""&&n.DB.to_date(p);v!=null&&v!=undefined&&v!=""&&n.DB.to_date(v);t.ajax({url:n.Application.contextUrl+"PaymentAllocation/GetInvoice",data:{_C_Currency_ID:b,_C_BPartner_ID:w,isInterBPartner:pt,chk:f,date:u,page:i,size:r,docNo:gi,c_docType_ID:nr,fromDate:p,toDate:v,conversionDate:yr},async:!0,success:function(n){var t=JSON.parse(n),i,r;if(t){if(h.length>0){for(lt=h.length,i=0;i<t.length;i++)r=h.filter(function(n){return n.C_InvoicePaySchedule_ID==t[i].C_InvoicePaySchedule_ID}),r.length==0&&(t[i].recid=h.length+i,h.push(t[i]));t=h;h=[]}ce(t);ai=9;ct=10;rr=13;ur=14}},error:function(){}})}function fe(i,u){var f=[],a,s,o,h,c,l;for(f.push({field:"SelectRow",caption:"check",size:"40px",editable:{type:"checkbox"}}),f.push({field:"Date1",caption:n.translatedTexts.Date,size:"80px",hidden:!1}),f.push({field:"Documentno",caption:n.translatedTexts.DocumentNo,size:"120px",hidden:!1}),f.push({field:"CpaymentID",caption:n.translatedTexts.c_payment_id,size:"150px",hidden:!0}),u?f.push({field:"Isocode",caption:n.translatedTexts.TrxCurrency,size:"85px",hidden:!1}):f.push({field:"Isocode",caption:n.translatedTexts.TrxCurrency,size:"85px",hidden:!0}),f.push({field:"ConversionName",caption:n.translatedTexts.C_ConversionType_ID,size:"85px",hidden:!1}),u?f.push({field:"Payment",caption:n.translatedTexts.Amount,size:"150px",hidden:!1}):f.push({field:"Payment",caption:n.translatedTexts.Amount,size:"150px",hidden:!0}),f.push({field:"ConvertedAmount",caption:n.translatedTexts.ConvertedAmount,size:"150px",hidden:!1}),f.push({field:"OpenAmt",caption:n.translatedTexts.OpenAmount,size:"150px",hidden:!1}),f.push({field:"Multiplierap",caption:n.translatedTexts.multiplierap,size:"150px",hidden:!0}),f.push({field:"AppliedAmt",caption:n.translatedTexts.AppliedAmount,size:"150px",hidden:!1}),f.push({field:"C_ConversionType_ID",caption:n.translatedTexts.C_ConversionType_ID,size:"85px",hidden:!0}),f.push({field:"DATEACCT",caption:n.translatedTexts.DateAcct,size:"85px",hidden:!1}),f.push({field:"AD_Org_ID",caption:n.translatedTexts.AD_Org_ID,size:"85px",hidden:!0}),f.push({field:"OrgName",caption:n.translatedTexts.AD_Org_ID,size:"85px",hidden:!1}),a=[],s=[],i.length>0&&(s=Object.keys(i[0])),o=0;o<i.length;o++){for(h={},h.recid=o,c=0;c<s.length;c++)l=s[c],h[l]=l=="SelectRow"?!1:n.Utility.encodeText(i[o][l]);a.push(h)}r!=undefined&&r!=null&&(r.destroy(),r=null);r=hi.w2grid({name:"openformatgrid_"+e.windowNo,show:{toolbar:!0},multiSelect:!0,columns:f,records:a,onClick:function(n){pe(n);lu()},onChange:function(n){be(n)},onDblClick:function(n){le(n)},onSelect:function(n){n.all&&(n.onComplete=function(){hi.find("#grid_openformatgrid_"+e.windowNo+"_records").on("scroll",su)})}});r.autoLoad=!0;t(t(r.box)[0]).find(".w2ui-search-down").css("margin-top","4px");t(t(r.box)[0]).find(".w2ui-search-clear").css("margin-top","4px")}function ee(t){var u=[],f=[],c,i,o,s,h;for(t.length>0&&(f=Object.keys(t[0])),c=0,r.records.length>0&&(c=r.records.length),i=0;i<t.length;i++){for(o={},o.recid=i,s=0;s<f.length;s++)h=f[s],o[h]=h=="SelectRow"?!1:n.Utility.encodeText(t[i][h]);u.push(o)}w2utils.encodeTags(u);r.add(u);u=[];f=[];hi.find("#grid_openformatgrid_"+e.windowNo+"_records").on("scroll",su)}function oe(i,r){var f=[],a,s,o,h,c,l;for(f.push({field:"SelectRow",caption:"check",size:"40px",editable:{type:"checkbox"}}),f.push({field:"Created",caption:n.translatedTexts.Date,size:"80px",hidden:!1}),f.push({field:"ReceiptNo",caption:n.translatedTexts.RECEIPTNO,size:"120px",hidden:!1}),r==!0?f.push({field:"Isocode",caption:n.Msg.getMsg("TrxCurrency"),size:"85px",hidden:!1}):f.push({field:"Isocode",caption:n.Msg.getMsg("TrxCurrency"),size:"85px",hidden:!0}),f.push({field:"ConversionName",caption:n.translatedTexts.C_ConversionType_ID,size:"85px",hidden:!1}),r==!0?f.push({field:"Amount",caption:n.translatedTexts.Amount,size:"150px",hidden:!1}):f.push({field:"Amount",caption:n.translatedTexts.Amount,size:"150px",hidden:!0}),f.push({field:"ConvertedAmount",caption:n.Msg.getMsg("ConvertedAmount"),size:"150px",hidden:!1}),f.push({field:"OpenAmt",caption:n.translatedTexts.OpenAmount,size:"150px",hidden:!1}),f.push({field:"AppliedAmt",caption:n.translatedTexts.AppliedAmount,size:"150px",hidden:!1}),f.push({field:"CcashlineiID",caption:n.translatedTexts.ccashlineid,size:"150px",hidden:!0}),f.push({field:"Multiplierap",caption:n.translatedTexts.multiplierap,hidden:!0}),f.push({field:"C_ConversionType_ID",caption:n.translatedTexts.C_ConversionType_ID,size:"85px",hidden:!0}),f.push({field:"DATEACCT",caption:n.translatedTexts.DateAcct,size:"85px",hidden:!1}),f.push({field:"AD_Org_ID",caption:n.translatedTexts.AD_Org_ID,size:"85px",hidden:!0}),f.push({field:"OrgName",caption:n.translatedTexts.AD_Org_ID,size:"85px",hidden:!1}),a=[],s=[],i.length>0&&(s=Object.keys(i[0])),o=0;o<i.length;o++){for(h={},h.recid=o,c=0;c<s.length;c++)l=s[c],h[l]=l.toLower()=="selectrow"?!1:n.Utility.encodeText(i[o][l]);a.push(h)}u!=undefined&&u!=null&&(u.destroy(),u=null);u=ci.w2grid({name:"openformatgridcash_"+e.windowNo,multiSelect:!0,show:{toolbar:!0},columns:f,records:a,onChange:function(n){ke(n)},onClick:function(n){we(n);lu()},onDblClick:function(n){ae(n)},onSelect:function(n){n.all&&(n.onComplete=function(){ci.find("#grid_openformatgridcash_"+e.windowNo+"_records").on("scroll",hu)})}});u.autoLoad=!0;t(t(u.box)[0]).find(".w2ui-search-down").css("margin-top","4px");t(t(u.box)[0]).find(".w2ui-search-clear").css("margin-top","4px")}function se(t){var r=[],f=[],c,i,o,s,h;for(t.length>0&&(f=Object.keys(t[0])),c=0,u.records.length>0&&(c=u.records.length),i=0;i<t.length;i++){for(o={},o.recid=i,s=0;s<f.length;s++)h=f[s],o[h]=h.toLower()=="selectrow"?!1:n.Utility.encodeText(t[i][h]);r.push(o)}w2utils.encodeTags(r);u.add(r);r=[];f=[];ci.find("#grid_openformatgridcash_"+e.windowNo+"_records").on("scroll",hu)}function he(r,u){var f=[],v,h,s,c,l,a,o,u,y;for(f.push({field:"SelectRow",caption:"check",size:"40px",editable:{type:"checkbox"}}),f.push({field:"Date1",caption:n.translatedTexts.Date,render:"date:yyyy-mm-dd",size:"80px",hidden:!1}),f.push({field:"InvoiceScheduleDate",caption:n.translatedTexts.ScheduleDate,size:"80px",hidden:!1}),f.push({field:"Documentno",caption:n.translatedTexts.DocumentNo,size:"120px",hidden:!1}),f.push({field:"CinvoiceID",caption:n.translatedTexts.cinvoiceid,size:"150px",hidden:!0}),u?f.push({field:"Isocode",caption:n.Msg.getMsg("TrxCurrency"),size:"85px",hidden:!1}):f.push({field:"Isocode",caption:n.Msg.getMsg("TrxCurrency"),size:"85px",hidden:!0}),f.push({field:"ConversionName",caption:n.translatedTexts.C_ConversionType_ID,size:"85px",hidden:!1}),u?f.push({field:"Currency",caption:n.translatedTexts.Amount,size:"100px",hidden:!1}):f.push({field:"Currency",caption:n.translatedTexts.Amount,size:"100px",hidden:!0}),f.push({field:"Converted",caption:n.Msg.getMsg("ConvertedAmount"),size:"100px",hidden:!1}),f.push({field:"Amount",caption:n.translatedTexts.OpenAmount,size:"100px",hidden:!1}),f.push({field:"Discount",caption:n.translatedTexts.DiscountAmt,size:"100px",hidden:!1}),f.push({field:"Multiplierap",caption:n.translatedTexts.multiplierap,hidden:!0}),f.push({field:"DocBaseType",caption:n.translatedTexts.DocBaseType,size:"150px",hidden:!0}),f.push({field:"Writeoff",caption:n.translatedTexts.WriteOffAmount,size:"100px",hidden:!1}),f.push({field:"AppliedAmt",caption:n.translatedTexts.AppliedAmount,size:"100px",hidden:!1}),yi>0&&f.push({field:"C_InvoicePaySchedule_ID",caption:n.translatedTexts.C_InvoicePaySchedule_ID,size:"100px",hidden:!1}),f.push({field:"C_ConversionType_ID",caption:n.translatedTexts.C_ConversionType_ID,size:"85px",hidden:!0}),f.push({field:"DATEACCT",caption:n.translatedTexts.DateAcct,size:"85px",hidden:!1}),f.push({field:"AD_Org_ID",caption:n.translatedTexts.AD_Org_ID,size:"85px",hidden:!0}),f.push({field:"OrgName",caption:n.translatedTexts.AD_Org_ID,size:"85px",hidden:!1}),v=[],h=[],r.length>0&&(h=Object.keys(r[0])),s=0;s<r.length;s++){for(c={},c.recid=s,l=0;l<h.length;l++)a=h[l],c[a]=a.toLower()=="selectrow"?!1:n.Utility.encodeText(r[s][a]);v.push(c)}if(i!=undefined&&i!=null&&(i.destroy(),i=null),i=li.w2grid({name:"openformatgridinvoice_"+e.windowNo,show:{toolbar:!0},multiSelect:!0,columns:f,records:v,onChange:function(n){de(n)},onClick:function(n){ye(n)},onDblClick:function(n){ve(n)},onSelect:function(n){n.all&&(n.onComplete=function(){li.find("#grid_openformatgridinvoice_"+e.windowNo+"_records").on("scroll",cu)})}}),lt>0)for(o=0;o<lt;o++)u=t("#grid_"+i.name+'_records td[col="0"]').find('input[type="checkbox"]'),t(u[o]).prop("checked",!0),i.editChange.call(i,u[o],o,0,event),y={type:"click",phase:"before",target:"grid",recid:o,index:o,isStopped:!1,"isCan//celled":!1,onComplete:null},i.trigger(y);lt=0;i.autoLoad=!0;t(t(i.box)[0]).find(".w2ui-search-down").css("margin-top","4px");t(t(i.box)[0]).find(".w2ui-search-clear").css("margin-top","4px")}function ce(r){var o=[],s=[],a,f,h,c,l,u,v,y;for(r.length>0&&(s=Object.keys(r[0])),a=0,i.records.length>0&&(a=i.records.length),f=0;f<r.length;f++){for(h={},h.recid=f+a,c=0;c<s.length;c++)l=s[c],h[l]=l.toLower()=="selectrow"?!1:n.Utility.encodeText(r[f][l]);o.push(h)}if(w2utils.encodeTags(o),i.add(o),lt>0)for(u=0;u<lt;u++)v=t("#grid_"+i.name+'_records td[col="0"]').find('input[type="checkbox"]'),t(v[u]).prop("checked",!0),i.editChange.call(i,v[u],u,0,event),y={type:"click",phase:"before",target:"grid",recid:u,index:u,isStopped:!1,"isCan//celled":!1,onComplete:null},i.trigger(y);lt=0;o=[];s=[];li.find("#grid_openformatgridinvoice_"+e.windowNo+"_records").on("scroll",cu)}function le(n){var i,u;if(r.columns[n.column].field=="AppliedAmt"){if(i=r.getChanges(),i==undefined||i.length==0)return;if(u=t.grep(i,function(t){return parseInt(t.recid)==parseInt(n.recid)}),u==null||u==undefined||u[0].SelectRow==undefined){r.columns[n.column].editable=!1;return}r.columns[n.column].editable={type:"text"}}}function ae(n){var i,r;if(u.columns[n.column].field=="AppliedAmt"){if(i=u.getChanges(),i==undefined||i.length==0)return;if(r=t.grep(i,function(t){return parseInt(t.recid)==parseInt(n.recid)}),r==null||r==undefined||r[0].SelectRow==undefined){u.columns[n.column].editable=!1;return}u.columns[n.column].editable={type:"text"}}}function ve(n){var r,u;if(i.columns[n.column].field=="AppliedAmt"||i.columns[n.column].field=="Writeoff"||i.columns[n.column].field=="Discount"){if(r=i.getChanges(),r==undefined||r.length==0)return;if(u=t.grep(r,function(t){return parseInt(t.recid)==parseInt(n.recid)}),u==null||u==undefined||u[0].SelectRow==undefined){i.columns[n.column].editable=!1;return}i.columns[n.column].editable={type:"text"}}}function ye(r){var o=i.getColumn("AppliedAmt",!0),h,u,e,f,s,c,l;if(r.column==0||r.column==null){if(h=i.getChanges(),u=t.grep(h,function(n){return parseInt(n.recid)==parseInt(r.recid)}),u==null||u==undefined||u.length==0||u[0].SelectRow==undefined)i.refreshCell(0,"AppliedAmt"),i.refreshCell(0,"Writeoff"),i.refreshCell(0,"Discount");else if(u[0].SelectRow==!0)if(a==0?a=i.get(r.recid).C_ConversionType_ID:a!=i.get(r.recid).C_ConversionType_ID&&(e=document.getElementsByName(r.target),e.length>0&&(e=e[0]),f=t(e).find("#grid_openformatgridinvoice_rec_"+r.recid+""),f.length>0&&(f=f[0]),t(f).find("input:checked").prop("checked")&&t(f).find("input:checked").prop("checked",!1),i.get(r.recid).changes=!1,i.columns[o].editable=!1,i.get(r.recid).changes.AppliedAmt="0",i.refreshCell(0,"AppliedAmt"),i.get(r.recid).changes.Discount="0",i.refreshCell(0,"Discount"),i.get(r.recid).changes.Writeoff="0",i.refreshCell(0,"Writeoff"),n.ADialog.warn("VIS_ConversionNotMatched")),y.is(":checked")){if(ft.val()=="")return n.ADialog.warn("VIS_SlctcnvrsnDate"),i.get(r.recid).changes=!1,i.unselect(r.recid),i.columns[o].editable=!1,i.get(r.recid).changes.AppliedAmt="0",i.refreshCell(r.recid,"AppliedAmt"),s=t("#grid_"+i.name+'_records td[col="0"]').find('input[type="checkbox"]'),t(s[r.recid]).prop("checked",!1),i.editChange.call(i,s[r.recid],r.recid,0,r),c={type:"click",phase:"before",target:"grid",recid:r.recid,index:r.recid,isStopped:!1,"isCan//celled":!1,onComplete:null},i.trigger(c),!1;l=Globalize.format(new Date(ft.val()),"yyyy-MM-dd");wt.val(Globalize.format(new Date(l),"yyyy-MM-dd"))}else lu();else i.unselect(r.recid),i.columns[o].editable=!1,i.get(0).changes.AppliedAmt="0",i.refreshCell(0,"AppliedAmt"),i.get(0).changes.Discount="0",i.refreshCell(0,"Discount"),i.get(0).changes.Writeoff="0",i.refreshCell(0,"Writeoff");oi(r.recid,r.column,!0,!1)}}function pe(i){var l,e,s,o,c,v,u,f,h;if(sr){i.preventDefault();return}if(u=r.getColumn("AppliedAmt",!0),i.column==0||i.column==null){if(l=r.getChanges(),e=t.grep(l,function(n){return parseInt(n.recid)==parseInt(i.recid)}),e==null||e==undefined||e.length==0||e[0].SelectRow==undefined)r.refreshCell(i.recid,"AppliedAmt");else if(e[0].SelectRow==!0){if(a==0?a=r.get(i.recid).C_ConversionType_ID:a!=r.get(i.recid).C_ConversionType_ID&&(s=document.getElementsByName(i.target),s.length>0&&(s=s[0]),o=t(s).find("#grid_openformatgrid_rec_"+i.recid+""),o.length>0&&(o=o[0]),t(o).find("input:checked").prop("checked")&&t(o).find("input:checked").prop("checked",!1),r.get(i.recid).changes=!1,r.unselect(i.recid),r.columns[u].editable=!1,r.get(i.recid).changes.AppliedAmt="0",r.refreshCell(i.recid,"AppliedAmt"),n.ADialog.warn("VIS_ConversionNotMatched")),y.is(":checked")){if(ft.val()=="")return n.ADialog.warn("VIS_SlctcnvrsnDate"),r.get(i.recid).changes=!1,r.unselect(i.recid),r.columns[u].editable=!1,r.get(i.recid).changes.AppliedAmt="0",r.refreshCell(i.recid,"AppliedAmt"),f=t("#grid_"+r.name+'_records td[col="0"]').find('input[type="checkbox"]'),t(f[i.recid]).prop("checked",!1),r.editChange.call(r,f[i.recid],i.recid,0,i),h={type:"click",phase:"before",target:"grid",recid:i.recid,index:i.recid,isStopped:!1,"isCan//celled":!1,onComplete:null},r.trigger(h),!1;if(c=r.records[i.recid].DATEACCT,v=Globalize.format(new Date(ft.val()),"yyyy-MM-dd"),c=Globalize.format(new Date(c),"yyyy-MM-dd"),v!=c)return n.ADialog.warn("VIS_SelectSameDate"),u=r.getColumn("DATEACCT",!0),r.get(i.recid).changes=!1,r.unselect(i.recid),r.columns[u].editable=!1,r.get(i.recid).changes.AppliedAmt="0",r.refreshCell(i.recid,"AppliedAmt"),f=t("#grid_"+r.name+'_records td[col="0"]').find('input[type="checkbox"]'),t(f[i.recid]).prop("checked",!1),r.editChange.call(r,f[i.recid],i.recid,0,i),h={type:"click",phase:"before",target:"grid",recid:i.recid,index:i.recid,isStopped:!1,"isCan//celled":!1,onComplete:null},r.trigger(h),!1}}else r.unselect(i.recid),r.columns[u].editable=!1,r.get(i.recid).changes.AppliedAmt="0",r.refreshCell(i.recid,"AppliedAmt");oi(i.recid,i.column,!1,!1)}}function we(i){var l,e,s,o,c,v,r,f,h;if(or){i.preventDefault();return}if(r=u.getColumn("AppliedAmt",!0),i.column==0||i.column==null){if(l=u.getChanges(),e=t.grep(l,function(n){return parseInt(n.recid)==parseInt(i.recid)}),e==null||e==undefined||e.length==0||e[0].SelectRow==undefined)u.refreshCell(0,"AppliedAmt");else if(e[0].SelectRow==!0){if(a==0?a=u.get(i.recid).C_ConversionType_ID:a!=u.get(i.recid).C_ConversionType_ID&&(s=document.getElementsByName(i.target),s.length>0&&(s=s[0]),o=t(s).find("#grid_openformatgridcash_rec_"+i.recid+""),o.length>0&&(o=o[0]),t(o).find("input:checked").prop("checked")&&t(o).find("input:checked").prop("checked",!1),u.get(i.recid).changes=!1,u.unselect(i.recid),u.columns[r].editable=!1,u.refreshCell(0,"AppliedAmt"),n.ADialog.warn("VIS_ConversionNotMatched")),y.is(":checked")){if(ft.val()=="")return n.ADialog.warn("VIS_SlctcnvrsnDate"),u.get(i.recid).changes=!1,u.unselect(i.recid),u.columns[r].editable=!1,u.refreshCell(i.recid,"AppliedAmt"),f=t("#grid_"+u.name+'_records td[col="0"]').find('input[type="checkbox"]'),t(f[i.recid]).prop("checked",!1),u.editChange.call(u,f[i.recid],i.recid,0,i),h={type:"click",phase:"before",target:"grid",recid:i.recid,index:i.recid,isStopped:!1,"isCan//celled":!1,onComplete:null},u.trigger(h),!1;if(c=u.records[i.recid].DATEACCT,v=Globalize.format(new Date(ft.val()),"yyyy-MM-dd"),c=Globalize.format(new Date(c),"yyyy-MM-dd"),v!=c)return n.ADialog.warn("VIS_SelectSameDate"),r=u.getColumn("DATEACCT",!0),u.get(i.recid).changes=!1,u.unselect(i.recid),u.columns[r].editable=!1,u.refreshCell(i.recid,"AppliedAmt"),f=t("#grid_"+u.name+'_records td[col="0"]').find('input[type="checkbox"]'),t(f[i.recid]).prop("checked",!1),u.editChange.call(u,f[i.recid],i.recid,0,i),h={type:"click",phase:"before",target:"grid",recid:i.recid,index:i.recid,isStopped:!1,"isCan//celled":!1,onComplete:null},u.trigger(h),!1}}else u.unselect(i.recid),u.columns[r].editable=!1,u.get(0).changes.AppliedAmt="0",u.refreshCell(0,"AppliedAmt");oi(i.recid,i.column,!0,!0)}}function be(t){if(sr){t.preventDefault();return}var i=r.getColumn("AppliedAmt",!0);if(r.columns[i].editable!=undefined){if(r.getChanges(t.recid)!=undefined&&r.getChanges(t.recid).length>0&&r.get(t.recid).changes){if(n.Utility.Util.getValueOfInt(t.value_new)>0&&n.Utility.Util.getValueOfInt(t.value_new)>n.Utility.Util.getValueOfInt(r.get(t.recid).OpenAmt)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}if(n.Utility.Util.getValueOfInt(r.get(t.recid).OpenAmt)<0&&n.Utility.Util.getValueOfInt(t.value_new)<n.Utility.Util.getValueOfInt(r.get(t.recid).OpenAmt)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}r.get(t.recid).changes.AppliedAmt=t.value_new;r.refreshCell(t.recid,"AppliedAmt")}else t.column>0&&r.set(t.recid,{AppliedAmt:t.value_new});t.column==i&&(parseFloat(r.get(t.index).OpenAmt)>parseFloat(r.get(t.index).AppliedAmt)||r.set(0,{AppliedAmt:r.get(t.index).OpenAmt}),oi(t.index,t.column,!1,!1))}}function ke(t){if(or){t.preventDefault();return}var i=u.getColumn("AppliedAmt",!0);if(u.columns[i].editable!=undefined){if(u.getChanges(t.recid)!=undefined&&u.getChanges(t.recid).length>0&&u.get(t.recid).changes){if(n.Utility.Util.getValueOfInt(t.value_new)>0&&n.Utility.Util.getValueOfInt(t.value_new)>n.Utility.Util.getValueOfInt(u.get(t.recid).OpenAmt)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}if(n.Utility.Util.getValueOfInt(u.get(t.recid).OpenAmt)<0&&n.Utility.Util.getValueOfInt(t.value_new)<n.Utility.Util.getValueOfInt(u.get(t.recid).OpenAmt)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}u.get(t.recid).changes.AppliedAmt=t.value_new;u.refreshCell(t.recid,"AppliedAmt")}else t.column>0&&u.set(t.recid,{AppliedAmt:t.value_new});t.column==i&&(parseFloat(u.get(t.index).OpenAmt)>parseFloat(u.get(t.index).AppliedAmt)||u.set(0,{AppliedAmt:u.get(t.index).paidamount}),oi(t.index,t.column,!0,!0))}}function de(t){var r=i.getColumn("AppliedAmt",!0),u=i.getColumn("Writeoff",!0),f=i.getColumn("Discount",!0),e=0;if(i.columns[r].editable!=undefined||i.columns[u].editable!=undefined||i.columns[f].editable!=undefined){if(i.getChanges(t.recid)!=undefined&&i.getChanges(t.recid).length>0&&i.get(t.recid).changes){if(n.Utility.Util.getValueOfInt(t.value_new)>0&&n.Utility.Util.getValueOfInt(t.value_new)>n.Utility.Util.getValueOfInt(i.get(t.recid).Amount)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}if(n.Utility.Util.getValueOfInt(i.get(t.recid).Amount)<0&&n.Utility.Util.getValueOfInt(t.value_new)<n.Utility.Util.getValueOfInt(i.get(t.recid).Amount)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}if(e=n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.Discount)>0?n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.Discount):n.Utility.Util.getValueOfDecimal(i.get(t.recid).Discount),r==t.column){if(n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)<0&&n.Utility.Util.getValueOfDecimal(t.value_new)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.Writeoff)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.Discount)<n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}if(n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)>0&&n.Utility.Util.getValueOfDecimal(t.value_new)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.Writeoff)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.Discount)>n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}i.get(t.recid).changes.AppliedAmt=t.value_new;i.refreshCell(t.recid,"AppliedAmt")}else if(u==t.column){if(n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)<0&&n.Utility.Util.getValueOfDecimal(t.value_new)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.AppliedAmt)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.Discount)<n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}if(n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)>0&&n.Utility.Util.getValueOfDecimal(t.value_new)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.AppliedAmt)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.Discount)>n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}i.get(t.recid).changes.Writeoff=t.value_new;i.refreshCell(t.recid,"Writeoff")}else if(f==t.column){if(n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)<0&&n.Utility.Util.getValueOfDecimal(t.value_new)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.AppliedAmt)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.Writeoff)<n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}if(n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)>0&&n.Utility.Util.getValueOfDecimal(t.value_new)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.AppliedAmt)+n.Utility.Util.getValueOfDecimal(i.get(t.recid).changes.Writeoff)>n.Utility.Util.getValueOfDecimal(i.get(t.recid).Amount)){n.ADialog.warn("AppliedAmtgrtr");t.preventDefault();return}i.get(t.recid).changes.Discount=t.value_new;i.refreshCell(t.recid,"Discount")}}else t.column>0&&(r==t.column?i.set(t.recid,{AppliedAmt:t.value_new}):u==t.column?i.set(t.recid,{Writeoff:t.value_new}):f==t.column&&i.set(t.recid,{Discount:t.value_new}));(t.column==i.getColumn("Discount",!0)||t.column==i.getColumn("Writeoff",!0)||t.column==i.getColumn("AppliedAmt",!0))&&oi(t.index,t.column,!0,!1)}}function oi(n,t,f,e){var s=n,d=t,it,rt,k,c,l,ft,tt,v,ut,y,nt,p,w,b,o;if((d==null||d==undefined)&&(d=0),it=null,f){if(e){if(d==0)if(c=u.columns,nf=pi(u.getChanges(),s),pu=g(c,"AppliedAmt"),k=c[pu].field,l=u.get(s).changes,nf)wu=g(c,"OpenAmt"),y=parseFloat(u.get(s)[c[wu].field]),k=="AppliedAmt"&&(l!=null&&l!=undefined?(l.AppliedAmt=y,u.refreshCell(s,"AppliedAmt")):u.set(s,{AppliedAmt:y}));else{for(k=="AppliedAmt"&&(l!=null&&l!=undefined?(l.AppliedAmt=0,u.refreshCell(s,"AppliedAmt")):u.set(s,{AppliedAmt:0})),p=!1,o=0;o<i.getChanges().length;o++)i.getChanges()[o].SelectRow==undefined||i.getChanges()[o].SelectRow==!1||(p=!0);for(w=!1,o=0;o<u.getChanges().length;o++)u.getChanges()[o].SelectRow==undefined||u.getChanges()[o].SelectRow==!1||(w=!0);for(b=!1,o=0;o<r.getChanges().length;o++)r.getChanges()[o].SelectRow==undefined||r.getChanges()[o].SelectRow==!1||(b=!0);p||w||b||(a=0)}}else if(d==0)if(c=i.columns,du=pi(i.getChanges(),s),l=i.get(s).changes,rr=g(c,"Writeoff"),ft=c[rr].field,ur=g(c,"AppliedAmt"),tt=c[ur].field,du)v=i.records[s],ut={SelectRow:v.SelectRow,InvoiceRecord:v.InvoiceRecord,Date1:v.Date1,Documentno:v.Documentno,CinvoiceID:v.CinvoiceID,Isocode:v.Isocode,Currency:v.Currency,Converted:v.Converted,Amount:v.Amount,Discount:v.Discount,Multiplierap:v.Multiplierap,DocBaseType:v.DocBaseType,Writeoff:v.Writeoff,AppliedAmt:v.AppliedAmt,C_InvoicePaySchedule_ID:v.C_InvoicePaySchedule_ID,InvoiceScheduleDate:v.InvoiceScheduleDate,C_ConversionType_ID:v.C_ConversionType_ID,ConversionName:v.ConversionName,DATEACCT:v.DATEACCT,AD_Org_ID:v.AD_Org_ID,OrgName:v.OrgName},h.push(ut),ai=g(c,"Amount"),y=parseFloat(i.get(s)[c[ai].field]),ct=g(c,"Discount"),y=y-parseFloat(i.get(s)[c[ct].field]),tt=="AppliedAmt"&&(l!=null&&l!=undefined?(l.Writeoff=0,l.AppliedAmt=y,ct=g(c,"Discount"),l.Discount=parseFloat(i.get(s)[c[ct].field]),i.refreshCell(s,"Writeoff"),i.refreshCell(s,"AppliedAmt"),i.refreshCell(s,"Discount")):(i.set(s,{Writeoff:0}),i.set(s,{AppliedAmt:y})));else{for(nt=0;nt<h.length;nt++)h[nt].C_InvoicePaySchedule_ID==i.records[s].C_InvoicePaySchedule_ID&&h.splice(nt,1);for(tt=="AppliedAmt"&&l!=null&&l!=undefined&&(l.Writeoff=0,l.AppliedAmt=y,ct=g(c,"Discount"),l.Discount=parseFloat(i.get(s)[c[ct].field]),i.refreshCell(s,"Writeoff"),i.refreshCell(s,"AppliedAmt"),i.refreshCell(s,"Discount")),p=!1,o=0;o<i.getChanges().length;o++)i.getChanges()[o].SelectRow==undefined||i.getChanges()[o].SelectRow==!1||(p=!0);for(w=!1,o=0;o<u.getChanges().length;o++)u.getChanges()[o].SelectRow==undefined||u.getChanges()[o].SelectRow==!1||(w=!0);for(b=!1,o=0;o<r.getChanges().length;o++)r.getChanges()[o].SelectRow==undefined||r.getChanges()[o].SelectRow==!1||(b=!0);p||w||b||(a=0)}}else if(d==0)if(c=r.columns,gu=pi(r.getChanges(),s),pr=g(c,"AppliedAmt"),k=c[pr].field,l=r.get(s).changes,gu)bu=g(c,"OpenAmt"),y=parseFloat(r.get(s)[c[bu].field]),rt=g(c,"Date1"),it=new Date(r.get(s)[c[rt].field]),k=="AppliedAmt"&&(l!=null&&l!=undefined?(l.AppliedAmt=y,r.refreshCell(s,"AppliedAmt")):r.set(s,{AppliedAmt:y}));else{for(k=="AppliedAmt"&&(l!=null&&l!=undefined?(l.AppliedAmt=0,r.refreshCell(s,"AppliedAmt")):r.set(s,{AppliedAmt:0})),p=!1,o=0;o<i.getChanges().length;o++)i.getChanges()[o].SelectRow==undefined||i.getChanges()[o].SelectRow==!1||(p=!0);for(w=!1,o=0;o<u.getChanges().length;o++)u.getChanges()[o].SelectRow==undefined||u.getChanges()[o].SelectRow==!1||(w=!0);for(b=!1,o=0;o<r.getChanges().length;o++)r.getChanges()[o].SelectRow==undefined||r.getChanges()[o].SelectRow==!1||(b=!0);p||w||b||(a=0)}nu.is(":checked")&&rf();au()}function g(n,t){for(var r=0,i=0;i<n.length;i++)if(n[i].field==t){r=i;break}return r}function pi(n,i){if(n==null||n.length==0)return!1;var r=t.grep(n,function(n){return parseInt(n.recid)==i});return r==null||r==undefined||r.length==0||r[0].SelectRow==undefined?!1:r[0].SelectRow}function rf(){var f,e,n,s;if(it=0,tt=0,yt.is(":checked"))for(f=u.getChanges(),n=0;n<f.length;n++)f[n].SelectRow==!0&&(tt+=parseFloat(f[n].AppliedAmt));else for(e=r.getChanges(),n=0;n<e.length;n++)e[n].SelectRow==!0&&(tt+=parseFloat(e[n].AppliedAmt));var o=i.getChanges(),t=null,h=i.columns;for(n=o.length-1;n>=0;n--)o[n].SelectRow==!0&&(it+=parseFloat(o[n].AppliedAmt),t==null&&(t=i.get(o[n].recid),t[h[ai].field]<=0&&(t=null)));it>tt&&(s=it-tt,it*.05>=s&&t!=null&&(t.changes.Writeoff=s,t.changes.AppliedAmt=t.changes.AppliedAmt-s,i.refreshCell(t.recid,"Writeoff"),i.refreshCell(t.recid,"AppliedAmt")))}function ge(){ar(ht.getName(),ht.value)}function lu(){var n,t,f;for(k=[],_dateAcct=[],n=0;n<r.getChanges().length;n++)r.getChanges()[n].SelectRow===undefined||r.getChanges()[n].SelectRow==!0&&(t=r.records[r.getChanges()[n].recid].Date1,k.push(new Date(t)),f=r.records[r.getChanges()[n].recid].DATEACCT,_dateAcct.push(new Date(f)),wt.val(Globalize.format(new Date(Math.max.apply(null,_dateAcct)),"yyyy-MM-dd")),_dateAcct=[]);for(n=0;n<i.getChanges().length;n++)i.getChanges()[n].SelectRow===undefined||i.getChanges()[n].SelectRow==!0&&(t=i.records[i.getChanges()[n].recid].Date1,k.push(new Date(t)),r.getChanges().length==0&&u.getChanges().length==0&&(f=i.records[i.getChanges()[n].recid].DATEACCT,_dateAcct.push(new Date(f)),wt.val(Globalize.format(new Date(Math.max.apply(null,_dateAcct)),"yyyy-MM-dd"))));for(n=0;n<u.getChanges().length;n++)u.getChanges()[n].SelectRow===undefined||u.getChanges()[n].SelectRow==!0&&(t=u.records[u.getChanges()[n].recid].Created,k.push(new Date(t)),r.getChanges().length==0&&(f=u.records[u.getChanges()[n].recid].DATEACCT,_dateAcct.push(new Date(f)),wt.val(Globalize.format(new Date(Math.max.apply(null,_dateAcct)),"yyyy-MM-dd"))));nt=new Date(Math.max.apply(null,k));k.length==0&&(nt=new Date);c.val(Globalize.format(new Date(nt),"yyyy-MM-dd"));console.log("Max Date:- "+nt)}function uf(){var n,t;for(k=[],vt=!0,n=0;n<r.getChanges().length;n++)r.getChanges()[n].SelectRow===undefined||r.getChanges()[n].SelectRow==!0&&(t=r.records[r.getChanges()[n].recid].Date1,vt&&parseInt(o.val())!=parseInt(r.records[r.getChanges()[n].recid].AD_Org_ID)&&(vt=!1),k.push(new Date(t)));for(n=0;n<i.getChanges().length;n++)i.getChanges()[n].SelectRow===undefined||i.getChanges()[n].SelectRow==!0&&(t=i.records[i.getChanges()[n].recid].Date1,vt&&parseInt(o.val())!=parseInt(i.records[i.getChanges()[n].recid].AD_Org_ID)&&(vt=!1),k.push(new Date(t)));for(n=0;n<u.getChanges().length;n++)u.getChanges()[n].SelectRow===undefined||u.getChanges()[n].SelectRow==!0&&(t=u.records[u.getChanges()[n].recid].Created,vt&&parseInt(o.val())!=parseInt(u.records[u.getChanges()[n].recid].AD_Org_ID)&&(vt=!1),k.push(new Date(t)));return k.length==0?!1:!0}function ar(n,t){t!=null&&(n=="C_BPartner_ID"?(w=t,d()):n=="C_Currency_ID"?(b=parseInt(t),d()):n=="Date"&&y&&d())}function au(){var p,h,w,b,k,t,o,l,y,e,s,d;f[0].style.visibility="visible";p=n.DisplayType.GetNumberFormat(n.DisplayType.Amount);h=new Date;h=null;w=parseFloat(0);dr=0;var a=null,v=null,c=null;if(a=r.getChanges(),v=u.getChanges(),c=i.getChanges(),a!=null)for(t=0;t<a.length;t++)if(a[t].SelectRow==!0){var o=r.get(a[t].recid),l=new Date(o.Date1),y=new n.TimeUtil;h=y.max(h,l);e=Object.keys(o);s=parseFloat(a[t][e[e.indexOf("AppliedAmt")]]);w=w+(isNaN(s)?0:s);dr++}if(wr.text(n.Msg.getMsg("SelectedPayments")+dr+" - "+n.Msg.getMsg("Sum")+"  "+p.GetFormatedValue(w.toFixed(at))+" "),b=parseFloat(0),fr=0,v!=null)for(t=0;t<v.length;t++)if(v[t].SelectRow==!0){var o=u.get(v[t].recid),l=new Date(o.Created),y=new n.TimeUtil;h=y.max(h,l);e=Object.keys(o);s=parseFloat(v[t][e[e.indexOf("AppliedAmt")]]);b=b+(isNaN(s)?0:s);fr++}if(br.text(n.Msg.getMsg("SelectedCashlines")+fr+" - "+n.Msg.getMsg("Sum")+"  "+p.GetFormatedValue(b.toFixed(at))+" "),k=parseFloat(0),vi=0,c!=null)for(t=0;t<c.length;t++)c[t].SelectRow==!0&&(o=i.get(c[t].recid),l=yi>0?new Date(o.InvoiceScheduleDate):new Date(o.Date1),l=="Invalid Date"&&(l=new Date(o.Date1)),y=new n.TimeUtil,h=y.max(h,l),e=Object.keys(o),s=c[t][e[e.indexOf("AppliedAmt")]]!=""?parseFloat(c[t][e[e.indexOf("AppliedAmt")]]):0,k=k+(isNaN(s)?0:s),vi++);kr.text(n.Msg.getMsg("SelectedInvoices")+vi+" - "+n.Msg.getMsg("Sum")+"  "+p.GetFormatedValue(k.toFixed(at))+" ");rt.children("option").filter(":selected").text()!=null&&tf.text(rt.children("option").filter(":selected").text());d=parseFloat(w.toFixed(at))+parseFloat(b.toFixed(at))-parseFloat(k.toFixed(at));gr.text(p.GetFormatedValue(d.toFixed(at)));d==parseFloat(0)?(bt.prop("readonly",!1),bt.css({"pointer-events":"auto",opacity:"1"})):(bt.prop("readonly",!0),bt.css({"pointer-events":"none",opacity:"0.5"}));f[0].style.visibility="hidden"}function no(){var i=n.DisplayType.GetNumberFormat(n.DisplayType.Amount),r=parseFloat(0);wr.text(n.Msg.getMsg("SelectedPayments")+0+" - "+n.Msg.getMsg("Sum")+"  "+i.GetFormatedValue(r)+" ");br.text(n.Msg.getMsg("SelectedCashlines")+0+" - "+n.Msg.getMsg("Sum")+"  "+i.GetFormatedValue(r)+" ");kr.text(n.Msg.getMsg("SelectedInvoices")+0+" - "+n.Msg.getMsg("Sum")+"  "+i.GetFormatedValue(r)+" ");gr.text(i.GetFormatedValue(0));ni.prop("checked",!1);ti.prop("checked",!1);ii.prop("checked",!1);t(".vis-allocation-payment-grid, .vis-allocation-cashLine-grid, .vis-allocation-invoice-grid").css("height","85%");t(".vis-allocation-leftControls").prop("style"," margin-bottom: 5px");y.is(":checked")?ir.css("display","block"):ir.css("display","none")}function to(){var i,f,n,e,t;if(r!=undefined&&(i=r.getChanges()),u!=undefined&&(f=u.getChanges()),ti.prop("checked",!1),ii.prop("checked",!1),yt.is(":checked")){if(or=!1,sr=!0,i!=null){for(n=0;n<i.length;n++)e=pi(r.getChanges(),i[n].recid),e&&(t=r.get(i[n].recid).changes,t!=null&&t!=undefined&&(t.SelectRow=!1,t.AppliedAmt=0,r.refreshCell(i[n].recid,"SelectRow"),r.refreshCell(i[n].recid,"AppliedAmt")));r.refresh()}ot.css("display","none");st.css("display","");u.refresh()}else{if(or=!0,sr=!1,f!=null){for(n=0;n<f.length;n++)e=pi(u.getChanges(),f[n].recid),e&&(t=u.get(f[n].recid).changes,t!=null&&t!=undefined&&(t.SelectRow=!1,t.AppliedAmt=0,u.refreshCell(f[n].recid,"SelectRow"),u.refreshCell(f[n].recid,"AppliedAmt")));u.refresh()}st.css("display","none");ot.css("display","");r.refresh()}au()}function ff(){var i=!0,t;it>tt?(t=it-tt,it*.05<=t&&(i=!1,n.ADialog.confirm("AllocationWriteOffWarn",!0,"","Confirm",function(n){n&&ef()}))):tt>it&&(t=tt-it,tt*.05>=t&&(i=n.ADialog.error("AllocationWriteOffWarn")));i&&ef()}function ef(){f[0].style.visibility="visible";var n=r.getChanges(),t=u.getChanges(),e=i.getChanges(),o=c.val(),s=wt.val();yt.is(":checked")?io(n,t,e,o,s):ro(n,t,e,o,s)}function io(e,s,l,a,v){if(vi+fr==0)return"";t.ajax({url:n.Application.contextUrl+"PaymentAllocation/CheckPeriodState",data:{DateTrx:c.val()},async:!1,success:function(a){var b,p,y,k,g,nt;if(a!="")return n.ADialog.info("",!0,a,""),d(),f[0].style.visibility="hidden","";var ut="",ft="",et="",ot="",st="",tt=0,ht=[],ct=[],it=[];for(p=0;p<e.length;p++)y=r.get(e[p].recid),tt=parseInt(y.C_ConversionType_ID),ht.push({AppliedAmt:e[p].AppliedAmt,Date:y.Date1,Converted:y.ConvertedAmount,CpaymentID:y.CpaymentID,Documentno:y.Documentno,Isocode:y.Isocode,Multiplierap:y.Multiplierap,OpenAmt:y.OpenAmt,Payment:y.Payment,Org:parseInt(o.val())});if(s.length>0)for(b=Object.keys(u.get(0)),ut=b[b.indexOf("AppliedAmt")],p=0;p<s.length;p++)y=u.get(s[p].recid),tt=parseInt(y.C_ConversionType_ID),ct.push({AppliedAmt:s[p].AppliedAmt,Date:y.Created,Amount:y.Amount,ccashlineid:y.CcashlineiID,Converted:y.ConvertedAmount,Isocode:y.Isocode,Multiplierap:y.Multiplierap,OpenAmt:y.OpenAmt,ReceiptNo:y.ReceiptNo,Org:parseInt(o.val())});if(l.length>0)for(b=Object.keys(i.get(0)),ft=b[b.indexOf("AppliedAmt")],et=b[b.indexOf("Discount")],ot=b[b.indexOf("Writeoff")],st=b[b.indexOf("Amount")],p=0;p<l.length;p++)y=i.get(l[p].recid),tt=parseInt(y.C_ConversionType_ID),k=l[p].Discount,k==undefined&&(k=y.Discount),g=l[p].AppliedAmt,g==undefined&&(g=y.AppliedAmt),nt=l[p].Writeoff,nt==undefined&&(nt=y.Writeoff),yi<=0?it.push({AppliedAmt:g,Discount:k,Writeoff:nt,cinvoiceid:y.CinvoiceID,Converted:y.Converted,Currency:y.Currency,Date:y.Date1,Docbasetype:y.DocBaseType,documentno:y.Documentno,Isocode:y.Isocode,Multiplierap:y.Multiplierap,Amount:y.Amount,Org:parseInt(o.val())}):it.push({AppliedAmt:g,Discount:k,Writeoff:nt,cinvoiceid:y.CinvoiceID,Converted:y.Converted,Currency:y.Currency,Date:y.InvoiceScheduleDate,Docbasetype:y.DocBaseType,documentno:y.Documentno,Isocode:y.Isocode,Multiplierap:y.Multiplierap,Amount:y.Amount,c_invoicepayschedule_id:y.C_InvoicePaySchedule_ID,Org:parseInt(o.val())});t.ajax({url:n.Application.contextUrl+"PaymentAllocation/SaveCashData",type:"POST",data:{paymentData:JSON.stringify(ht),cashData:JSON.stringify(ct),invoiceData:JSON.stringify(it),currency:rt.val(),isCash:yt.is(":checked"),_C_BPartner_ID:w,_windowNo:er.windowNo,payment:ut,DateTrx:c.val(),appliedamt:ft,discount:et,writeOff:ot,open:st,DateAcct:v,_CurrencyType_ID:tt,isInterBPartner:!1},success:function(t){h=[];n.ADialog.info("",!0,t,"");d();f[0].style.visibility="hidden"},error:function(t){n.ADialog.info("",!0,t,"");f[0].style.visibility="hidden"}})},error:function(t){n.ADialog.info("",!0,t,"");f[0].style.visibility="hidden"}})}function ro(e,s,l,a,v){if(vi+pr==0)return"";t.ajax({url:n.Application.contextUrl+"PaymentAllocation/CheckPeriodState",data:{DateTrx:c.val()},async:!1,success:function(a){var b,p,y,k,g,nt;if(a!="")return n.ADialog.info("",!0,a,""),d(),f[0].style.visibility="hidden","";var tt="",ft="",et="",ot="",st="",it=0,ht=[],ct=[],ut=[];for(p=0;p<e.length;p++)y=r.get(e[p].recid),b=Object.keys(r.get(0)),it=parseInt(y.C_ConversionType_ID),tt=b[10],ht.push({appliedamt:e[p].AppliedAmt,date:y.Date1,converted:y.ConvertedAmount,cpaymentid:y.CpaymentID,documentno:y.Documentno,isocode:y.Isocode,multiplierap:y.Multiplierap,openamt:y.OpenAmt,payment:y.Payment,Org:parseInt(o.val())});if(s.length>0)for(b=Object.keys(u.get(0)),p=0;p<s.length;p++)y=u.get(s[p].recid),ct.push({appliedamt:s[p].AppliedAmt,date:y.Created,amount:y.Amount,ccashlineid:y.CcashlineiID,converted:y.ConvertedAmount,isocode:y.Isocode,multiplierap:y.Multiplierap,openamt:y.OpenAmt,receiptno:y.ReceiptNo,Org:parseInt(o.val())});if(l.length>0)for(b=Object.keys(i.get(0)),ft=b[b.indexOf("AppliedAmt")],tt=b[b.indexOf("AppliedAmt")],et=b[b.indexOf("Discount")],ot=b[b.indexOf("Writeoff")],st=b[b.indexOf("Amount")],p=0;p<l.length;p++)y=i.get(l[p].recid),it=parseInt(y.C_ConversionType_ID),k=l[p].Discount,k==undefined&&(k=y.Discount),g=l[p].AppliedAmt,g==undefined&&(g=y.AppliedAmt),nt=l[p].Writeoff,nt==undefined&&(nt=y.Writeoff),yi<=0?ut.push({appliedamt:g,discount:k,writeoff:nt,cinvoiceid:y.CinvoiceID,converted:y.Converted,currency:y.Currency,date:y.Date1,docbasetype:y.DocBaseType,documentno:y.Documentno,isocode:y.Isocode,multiplierap:y.Multiplierap,amount:y.Amount,Org:parseInt(o.val())}):ut.push({appliedamt:g,discount:k,writeoff:nt,cinvoiceid:y.CinvoiceID,converted:y.Converted,currency:y.Currency,date:y.InvoiceScheduleDate,docbasetype:y.DocBaseType,DocumentNo:y.Documentno,Isocode:y.Isocode,Multiplierap:y.Multiplierap,Amount:y.Amount,c_invoicepayschedule_id:y.C_InvoicePaySchedule_ID,Org:parseInt(o.val())});t.ajax({url:n.Application.contextUrl+"PaymentAllocation/SavePaymentData",type:"POST",data:{paymentData:JSON.stringify(ht),cashData:JSON.stringify(ct),invoiceData:JSON.stringify(ut),currency:rt.val(),isCash:yt.is(":checked"),_C_BPartner_ID:w,_windowNo:er.windowNo,payment:tt,DateTrx:c.val(),appliedamt:ft,discount:et,writeOff:ot,open:st,DateAcct:v,_CurrencyType_ID:it,isInterBPartner:!1},success:function(t){h=[];d();n.ADialog.info("",!0,t,"");f[0].style.visibility="hidden"},error:function(){n.ADialog.info("",!0,a,"");f[0].style.visibility="hidden"}})},error:function(t){n.ADialog.info("",!0,t,"");f[0].style.visibility="hidden"}})}this.frame=null;this.windowNo=0;var si=n.Env.getCtx(),e=this,dt=t('<div class="vis-allocate-root vis-forms-container">'),wi=t('<div class="vis-leftpanel-wrapper" style="padding-right:0px">'),l=t('<div style="height: calc(100% - 42px);padding-right:15px; overflow: auto;">'),bi=t('<div class="vis-allocation-rightContainer">'),ot=t('<div class="vis-allocate-paymentdiv" >'),st=t('<div class="vis-allocate-cashdiv" >'),gt=t('<div class="vis-allocate-invoicediv" >'),of=t("<div >"),ht=null,rt=t('<select class="vis-allocation-currencycmb" ><\/select>'),o=null,ut=t('<select class="vis-allocation-docTypecmb" ><\/select>'),ki,vr,di,p,v,gi,nr=null,vu,yu=null,hi=null,ci=null,li=null,r=null,u=null,i=null,ni=null,ti=null,ii=null,nt=null,y=null,yt=null,tr=null,pt=!1,wt=null,c=null,yr="",ft=null,ir=null,w=0,b=0,pr=10,pu=8,s=null,wu=7,bu=8,ai=9,ct=8,rr=11,ur=12,wr=null,br=null,kr=null,vi=0,dr=0,fr=0,h=[],lt=0,ku=null,du=!1,gu=!1,nf=!1,gr=null,bt=null,tf=null,nu=null,f=null,er=this,or=!0,sr=!1,tt=0,it=0,yi=0,at=0,et=50,kt=1,hr=1,cr=0,ri=1,tu=1,iu=0,ui=1,ru=1,uu=0,fu=!1,eu=!1,lr=!1,a=0,k=[],vt=!0,sf=n.Application.contextUrl,hf=sf+"JsonData/JDataSetWithCode",cf=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u=null;return lf(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u};n.translatedTexts=n.Msg.translate(n.Env.getCtx(),["AD_Org_ID","C_BPartner_ID","C_Currency_ID","C_Payment_ID ","C_CashLine_ID","C_Invoice_ID ","Date","DocumentNo","TrxCurrency","C_ConversionType_ID","Amount","ConvertedAmount","OpenAmount","multiplierap","AppliedAmount","C_ConversionType_ID","RECEIPTNO","ccashlineid","ScheduleDate","cinvoiceid","DiscountAmt","DocBaseType","WriteOffAmount","C_InvoicePaySchedule_ID","DateAcct"],!0);af();this.disposeComponent=function(){r!=undefined&&r!=null&&(r.destroy(),r=null);u!=undefined&&u!=null&&(u.destroy(),u=null);i!=undefined&&i!=null&&(i.destroy(),i=null);ni=null;ti=null;ii=null;k=null};this.getRoot=function(){return dt}}i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.frame.getContentGrid().append(this.getRoot())};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps=n.Apps||{};n.Apps.AForms=n.Apps.AForms||{};n.Apps.AForms.VAllocation=i}(VIS,jQuery),function(n,t){function i(){function ci(){h.append('<div class="col-lg-4 col-md-4"><div class="vis-group-content-wrap"><\/div><\/div><div class="col-lg-4 col-md-4"><div class="vis-group-content-wrap"><\/div><\/div><div class="col-lg-4 col-md-4 last-child"><div class="vis-group-content-wrap"><\/div><\/div>');var n=h.find(".vis-group-content-wrap");v=t(n[0]);c=t(n[1]);l=t(n[2]);n=null;li();yi();pi();wi()}function li(){i=t("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>");i[0].style.visibility="hidden";h.append(i)}function ai(){b.on("click",nr);d.on("click",at);y.on("keydown",ur);nt.on("click",ti);ut.on("click",pt);it.on("click",yt);w.on("keydown",fr);tt.on("click",vt);p.on("keydown",er);rt.on("click",ir);g.on("click",tr);r.on("scroll",rr);h.on("click",vi)}function vi(i){var r=t(i.target);return!r.hasClass("vis-group-roless")&&r.parents(".vis-group-roless").length==0&&!r.hasClass("vis-group-ass-btns vis-group-save-btn")&&a.length>0?(n.ADialog.confirm("VIS_SaveRole",!0,"","Confirm",function(n){n?ti():a=[]}),i.stopPropagation(),!1):!r.hasClass("vis-group-groupss")&&r.parents(".vis-group-groupss").length==0&&!r.hasClass("vis-group-ass-btns vis-group-save-btn")&&e.length>0?(n.ADialog.confirm("VIS_SaveRole",!0,"","Confirm",function(n){n?pt():e=[]}),i.stopPropagation(),!1):void 0}function yi(){i[0].style.visibility="visible";v.append('<div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-createUser">'+n.Msg.getMsg("VIS_CreateInviteUser")+'<\/h4><span class=" vis-group-pointer vis-group-head-right">'+n.Msg.getMsg("SortBy")+'<\/span><div class="vis-group-clear-both"><\/div><\/div>');st=v.find(".vis-group-head-right");v.append('<div class="vis-group-content-headDown"><input class="vis-group-add-btn vis-group-pointer vis-group-addLeft vis-group-ass-btns" type="button"><input class="vis-group-SearchText" value="" placeholder="'+n.Msg.getMsg("Search")+'" type="text"><input class=" vis-group-pointer vis-group-ass-btns vis-group-search-icon" type="button"><div class="vis-group-clear-both"><\/div> <\/div>');y=v.find(".vis-group-SearchText");d=v.find(".vis-group-search-icon");b=v.find(".vis-group-add-btn");r=t('<div class="vis-group-users-container">').append('<div style="border-top: 1px solid #dfdfdf; width: 97%;"><\/div>');r.height(t(h.parent()).height()-95);v.append(r);ki()}function pi(){c.append(' <div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-role">'+n.Msg.getMsg("Role")+'<\/h4><h7 class="vis-group-SaveMessage">'+n.Msg.getMsg("VIS_RoleSaved")+'<\/h7><div class="vis-group-top-right"><input class="vis-group-ass-btns vis-group-pointer vis-group-add-btn" type="button"><input class="vis-group-ass-btns vis-group-pointer vis-group-save-btn" type="button"><\/div><div class="vis-group-content-headDown"><span><input class="vis-group-SearchText" value="" placeholder="'+n.Msg.getMsg("Search")+'" type="text"><input class="vis-group-ass-btns vis-group-ass-btnse vis-group-pointer vis-group-search-icon" type="button"> <\/span><\/div><div class="vis-group-clear-both"><\/div><\/div>');nt=c.find(".vis-group-save-btn");g=c.find(".vis-group-add-btn");p=c.find(".vis-group-SearchText");tt=c.find(".vis-group-ass-btnse");u=t('<div class="vis-group-role-container">');u.append('<div style="border-top: 1px solid #dfdfdf; width: 97%;"><\/div>');c.append(u);u.height(t(h.parent()).height()-95);ui()}function wi(){l.append('<div class="vis-group-content-head"><h4 class="vis-group-content-tittle vis-group-rights">'+n.Msg.getMsg("VIS_Groups")+'<\/h4><h7 class="vis-group-SaveMessage">'+n.Msg.getMsg("VIS_GroupSaved")+'<\/h7><div class="vis-group-top-right"><div class="vis-group-top-right"><input class="vis-group-ass-btns vis-group-pointer vis-group-add-btn" type="button"><input class="vis-group-ass-btns vis-group-pointer vis-group-save-btn" type="button"><\/div><\/div><div class="vis-group-content-headDown"><span><input class="vis-group-SearchText"  value="" placeholder="'+n.Msg.getMsg("Search")+'" type="text"><input class="vis-group-ass-btns vis-group-ass-btnse vis-group-pointer vis-group-search-icon" type="button"> <\/span><\/div><div class="vis-group-clear-both"><\/div><\/div>');w=l.find(".vis-group-SearchText");it=l.find(".vis-group-ass-btnse");rt=l.find(".vis-group-add-btn");ut=l.find(".vis-group-save-btn");f=t('<div class="vis-group-role-container">').append('<div style="vis-group-border-top: 1px solid #dfdfdf; width: 97%;"><\/div>');l.append(f);f.height(t(h.parent()).height()-95);gi()}function bi(){k.append("<li value=1>"+n.Msg.getMsg("Name")+"<\/li>");k.append("<li value=2>"+n.Msg.getMsg("SearchKey")+"<\/li>");k.append("<li value=3>"+n.Msg.getMsg("EMail")+"<\/li>");st.on("click",function(){t(this).w2overlay(k.clone(!0))});k.on(n.Events.onTouchStartOrClick,"LI",function(){ni=t(this).val();at()})}function ki(){di();at()}function di(){var i=' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap"  data-UID="{{AD_UserID}}"><div class="vis-group-user-profile vis-group-pro-width"><div style=" height:46px;width:46px" class="vis-group-user-img">{{#if UserImage}}<img src="'+n.Application.contextUrl+'{{UserImage}}" alt="user-img">{{else}}<img src="'+n.Application.contextUrl+'Areas/VIS/Images/home/defaultUser46X46.PNG" alt="user-img">{{/if}}<\/div><div class="vis-group-user-text">{{#if IsActive }}<p style="font-weight: bold">{{Username}}<\/p>{{else}}<p>{{Username}}<\/p>{{/if}}<span>{{Email}}<\/span><\/div><\/div><div class="vis-group-user-right"><ul>{{#if IsActive }}{{#if IsUpdate}}<li><span class="vis-group-user-ico vis-group-pointer vis-group-activeUser" data-UID="{{AD_UserID}}"><\/span><\/li>{{else}}<li><span disabled class="vis-group-user-ico vis-group-pointer vis-group-activeUser" data-UID="{{AD_UserID}}"><\/span><\/li>{{/if}}{{else}}{{#if IsUpdate}}<li><span class="vis-group-user-ico vis-group-pointer vis-group-inactiveUser"  data-UID="{{AD_UserID}}"><\/span><\/li>{{else}}<li><span disabled class="vis-group-user-ico vis-group-pointer vis-group-inactiveUser"  data-UID="{{AD_UserID}}"><\/span><\/li>{{/if}}{{/if}}<li><span class="vis-group-user-ico vis-group-pointer vis-group-edit" data-UID="{{AD_UserID}}-{{UserTableID}}-{{UserWindowID}}"><\/span><\/li><\/ul><p>{{Country}}<\/p><\/div><\/div>{{/each}}​<\/script>';wt=t(i).html();ht=Handlebars.compile(wt)}function ui(){bt=t(' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-roless vis-group-role-pad"  data-UID="{{AD_Role_ID}}"><div class="vis-group-user-profile">{{#if IsAssignedToUser}}{{#if IsUpdate}}<input type="checkbox" data-UID="{{AD_Role_ID}}" checked="">{{else}}<input disabled type="checkbox" data-UID="{{AD_Role_ID}}" checked="">{{/if}}<label style="color: #535353;font-weight: bold;">{{Name}}<\/label>{{else}}{{#if IsUpdate}}<input type="checkbox" data-UID="{{AD_Role_ID}}" >{{else}}<input disabled type="checkbox" data-UID="{{AD_Role_ID}}" >{{/if}}<label>{{Name}}<\/label>{{/if}}<\/div><div class="vis-group-user-right"><ul><li><span class="vis-group-user-ico vis-group-pointer vis-group-edit"  data-UID="{{AD_Role_ID}}-{{roleWindowID}}"><\/span><\/li><\/ul><\/div><\/div>{{/each}}​<\/script>').html();kt=Handlebars.compile(bt)}function gi(){dt=t(' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-groupss vis-group-role-pad" data-UID="{{AD_Group_ID}}"><div class="vis-group-user-profile">{{#if IsAssignedToUser}}<input type="checkbox" data-UID="{{AD_Group_ID}}" checked=""><label style="color: #535353;font-weight: bold;">{{Name}}<\/label>{{else}}<input type="checkbox" data-UID="{{AD_Group_ID}}" ><label>{{Name}}<\/label>{{/if}}<\/div><div class="vis-group-user-right"><ul><li><span class="vis-group-user-ico vis-group-info vis-group-pointer"   data-UID="{{AD_Group_ID}}-{{GroupWindowID}}"><\/span><\/li><li><span class="vis-group-user-ico vis-group-edit vis-group-pointer"   data-UID="{{AD_Group_ID}}-{{GroupWindowID}}"><\/span><\/li><\/ul>                           <\/div><\/div>{{/each}}​<\/script>').html();gt=Handlebars.compile(dt)}function nr(){var t=new n.createUser;t.intialize();t.show()}function tr(){var t=new n.createrole;t.intialize();t.show()}function ir(){i[0].style.visibility="visible";lt==0&&t.ajax({url:n.Application.contextUrl+"Group/GetWindowIds",async:!1,success:function(n){var t=JSON.parse(n);t!=null&&t!=undefined&&(lt=t.GroupWindowID,ei=t.RoleWindowID,oi=t.UserWindowID)},error:function(){n.Msg.getMsg("VIS_GroupWindowNotFound")}});var r=new n.Query;r.addRestriction("AD_GroupInfo_ID",n.Query.prototype.EQUAL,0);n.viewManager.startWindow(lt,r);i[0].style.visibility="hidden"}function at(){ot=1;t.ajax({url:n.Application.contextUrl+"Group/GetUserInfo",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{searchText:y.val(),sortBy:ni,pageNo:ot,pageSize:ri},success:function(n){var i=JSON.parse(n);r.find(".vis-group-user-wrap").remove();r.append(ht(i));r.off("click");r.on("click",or);t(r.children(".vis-group-user-wrap")).length>0&&t(r.children(".vis-group-user-wrap")[0]).trigger("click");ot++},error:function(){n.ADialog.error("VIS_ErrorLoadingContacts");i[0].style.visibility="hidden"}})}function rr(){t(this).scrollTop()+t(this).innerHeight()>=this.scrollHeight&&t.ajax({url:n.Application.contextUrl+"Group/GetUserInfo",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{searchText:y.val(),sortBy:ni,pageNo:ot,pageSize:ri},success:function(n){ot++;var t=JSON.parse(n);r.append(ht(t));i[0].style.visibility="hidden"},error:function(){n.ADialog.error("VIS_ErrorLoadingContacts");i[0].style.visibility="hidden"}})}function ur(n){(n.keyCode==undefined||n.keyCode==13)&&y!=undefined&&y!=null&&at()}function fr(n){(n.keyCode==undefined||n.keyCode==13)&&w!=undefined&&w!=null&&yt()}function er(n){(n.keyCode==undefined||n.keyCode==13)&&p!=undefined&&p!=null&&vt()}function or(i){var u,f,e;if(!(a.length>0)){if(u=t(i.target),t(t(r.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op vis-group-selected-opbackground"),u.hasClass("vis-group-user-wrap"))u.addClass("vis-group-selected-op vis-group-selected-opbackground"),ct=u.data("uid");else if(t(u.parents(".vis-group-user-wrap")).length>0)t(u.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op vis-group-selected-opbackground"),ct=t(u.parents().find(".vis-group-selected-op")).data("uid");else return;u.hasClass("vis-group-user-ico vis-group-pointer vis-group-edit")?(f=u.data("uid").split("-"),e=new n.Query,e.addRestriction("AD_User_ID",n.Query.prototype.EQUAL,f[0]),n.viewManager.startWindow(f[2],e)):u.hasClass("vis-group-user-ico vis-group-pointer vis-group-activeUser")&&u.attr("disabled")!="disabled"?fi(u,!1):u.hasClass("vis-group-user-ico vis-group-pointer vis-group-inactiveUser")&&u.attr("disabled")!="disabled"&&fi(u,!0);vt(u)}}function vt(){i[0].style.visibility="visible";var r=p.val();t.ajax({url:n.Application.contextUrl+"Group/GetRoleInfo",data:{AD_User_ID:ct,name:r},success:function(n){var f=JSON.parse(n),r;u.find(".vis-group-user-wrap").remove();u.append(kt(f));u.off("click");u.on("click",sr);for(t(u.children(".vis-group-user-wrap")).length>0&&t(t(u).children(".vis-group-user-wrap")[0]).trigger("click"),ft=[],r=0;r<f.length;r++)ft.push({AD_Role_ID:f[r].AD_Role_ID,IsAssignedToUser:f[r].IsAssignedToUser});t(u.find("input")).off("click");t(u.find("input")).on("click",lr);i[0].style.visibility="hidden"},error:function(){n.ADialog.error("VIS_ErrorLoadingRoles");i[0].style.visibility="hidden"}})}function yt(){i[0].style.visibility="visible";var r=w.val();t.ajax({url:n.Application.contextUrl+"Group/GetGroupInfo",data:{AD_Role_ID:o,name:r},success:function(n){var u=JSON.parse(n),r;f.find(".vis-group-user-wrap").remove();f.append(gt(u));f.off("click");f.on("click",hr);for(t(f.children(".vis-group-user-wrap")).length>0&&t(t(f).children(".vis-group-user-wrap")[0]).trigger("click"),et=[],i[0].style.visibility="hidden",r=0;r<u.length;r++)r==0&&(lt=u[r].GroupWindowID),et.push({AD_Group_ID:u[r].AD_Group_ID,IsAssignedToUser:u[r].IsAssignedToUser});t(f.find("input")).off("click");t(f.find("input")).on("click",ar)},error:function(){n.ADialog.error("VIS_ErrorLoadingGroups");i[0].style.visibility="hidden"}})}function sr(i){var r,f;if(si=!0,e.length>0){n.ADialog.confirm("VIS_SaveGroup",!0,"","Confirm",function(n){n?pt():e=[]});return}r=t(i.target);t(t(u.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op vis-group-selected-opbackground");r.hasClass("vis-group-user-wrap")?(r.addClass("vis-group-selected-op vis-group-selected-opbackground"),o=r.data("uid")):o=t(r.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op vis-group-selected-opbackground").data("uid");r.hasClass("vis-group-user-ico vis-group-pointer vis-group-edit")&&(o=r.data("uid"),o=o.split("-"),f=new n.Query,f.addRestriction("AD_Role_ID",n.Query.prototype.EQUAL,o[0]),n.viewManager.startWindow(o[1],f),o=o[0]);o!=undefined&&yt(r);i.originalEvent===undefined&&i.stopPropagation()}function hr(i){var r,u;hi=!0;r=t(i.target);t(t(f.children(".vis-group-selected-op"))[0]).removeClass("vis-group-selected-op");r.hasClass("vis-group-user-wrap")?(r.addClass("vis-group-selected-op"),s=r.data("uid")):(t(r.parents(".vis-group-user-wrap")).addClass("vis-group-selected-op"),s=t(r.parents().find(".vis-group-selected-op")).data("uid"));r.hasClass("vis-group-user-ico vis-group-edit vis-group-pointer")?(s=r.data("uid"),s=s.split("-"),u=new n.Query,u.addRestriction("AD_GroupInfo_ID",n.Query.prototype.EQUAL,s[0]),n.viewManager.startWindow(s[1],u)):r.hasClass("vis-group-user-ico vis-group-info vis-group-pointer")&&(s=r.data("uid"),s=s.split("-"),cr(s[0]));i.originalEvent===undefined&&i.stopPropagation()}function cr(t){var i=new n.groupInfo(t);i.intialize();i.show()}function lr(i){if(e.length>0){n.ADialog.confirm("VIS_SaveGroup",!0,"","Confirm",function(n){n?pt():e=[]});return}var u=t(i.target),r=t.grep(ft,function(n){return n.AD_Role_ID==u.data("uid")});r!=null&&r.length>0&&(r[0].IsAssignedToUser=u.prop("checked"));r=t.grep(a,function(n){return n==u.data("uid")});r==null||r.length==0?a.push(u.data("uid")):a.splice(a.indexOf(u.data("uid")),1);i.stopPropagation()}function ar(i){if(a.length>0){n.ADialog.confirm("VIS_SaveRole",!0,"","Confirm",function(n){n?ti():a=[]});return}var u=t(i.target),r=t.grep(et,function(n){return n.AD_Group_ID==u.data("uid")});r!=null&&r.length>0&&(r[0].IsAssignedToUser=u.prop("checked"));r=t.grep(e,function(n){return n==u.data("uid")});r==null||r.length==0?e.push(u.data("uid")):e.splice(e.indexOf(u.data("uid")),1);i.stopPropagation()}function ti(){i[0].style.visibility="visible";a=[];t.ajax({url:n.Application.contextUrl+"Group/UpdateUserRoles",type:"Post",data:{AD_User_ID:ct,roles:JSON.stringify(ft)},success:function(){t(t(c.find("h7"))[0]).show();t(t(c.find("h7"))[0]).fadeOut(1600,"linear");vt()},error:function(){n.ADialog.error(n.Msg.getMsg("VIS_ErrorSavingRole"));i[0].style.visibility="hidden"}})}function pt(){i[0].style.visibility="visible";e=[];t.ajax({url:n.Application.contextUrl+"Group/UpdateUserGroups",type:"Post",data:{AD_Role_ID:o,AD_Group_ID:s,groups:JSON.stringify(et)},success:function(){t(t(l.find("h7"))[0]).show();t(t(l.find("h7"))[0]).fadeOut(1600,"linear");yt()},error:function(){n.ADialog.error(n.Msg.getMsg("VIS_ErrorSavingGroups"));i[0].style.visibility="hidden"}})}function fi(r,u){i[0].style.visibility="visible";var f="";u?(r.removeClass("vis-group-user-ico vis-group-pointer vis-group-inactiveUser"),r.addClass("vis-group-user-ico vis-group-pointer vis-group-activeUser"),f=n.Application.contextUrl+"Group/ActiveUser"):(r.removeClass("vis-group-user-ico vis-group-pointer vis-group-activeUser"),r.addClass("vis-group-user-ico vis-group-pointer vis-group-inactiveUser"),f=n.Application.contextUrl+"Group/InActiveUser");t.ajax({url:f,data:{AD_User_ID:r.data("uid")},success:function(t){var r=JSON.parse(t);r<1&&n.ADialog.error("VIS_UserNotUpdated");i[0].style.visibility="hidden"},error:function(){n.ADialog.error("VIS_UserNotUpdated");i[0].style.visibility="hidden"}})}this.frame=null;this.windowNo=null;var ii=this,h=t('<div class="vis-group-assign-content">'),k=t('<ul class="vis-apanel-rb-ul"><\/ul>'),v=null,c=null,l=null,r=null,y=null,d=null,b=null,st=null,g=null,nt=null,u=null,i=null,p=null,tt=null,w=null,it=null,rt=null,ut=null,f=null,wt,ht,bt,kt,dt,gt,ni=-1,ct=0,ft=[],et=[],a=[],e=[],o=0,s=0,lt=0,ei=0,oi=0,ot=0,ri=20,si=!1,hi=!1;this.initializeComponent=function(){ci();ai();bi()};this.disposeComponent=function(){b!=null&&b!=undefined&&b.off("click");d.off("click");y.off("keydown");nt.off("click");ut.off("click");it.off("click");w.off("keydown");tt.off("click");p.off("keydown");rt.off("click");g.off("click");r.off("scroll");h.off("click");this.frame=null;this.windowNo=null;v.remove();v=null;c.remove();c=null;l.remove();l=null;r.remove();r=null;y.remove();y=null;d.remove();d=null;b.remove();b=null;st.remove();st=null;g.remove();g=null;nt.remove();nt=null;u.remove();u=null;i.remove();i=null;w.remove();w=null;it.remove();it=null;p.remove();p=null;tt.remove();tt=null;rt.remove();rt=null;ut.remove();ut=null;f.remove();f=null;wt.remove();ht.remove();bt.remove();kt.remove();dt.remove();gt.remove();ft=null;et=null;a=null;e=null;h.remove();h=null;k=null;ii=null};this.getRoot=function(){return h}}i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;t.setTitle("VIS_Group");this.frame.getContentGrid().append(this.getRoot());this.initializeComponent()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.GroupForm=i}(VIS,jQuery),function(n,t){function i(){function ft(){i=t("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>");i[0].style.visibility="hidden";r.append(i)}function et(){r=t("<div>");var i='  <div style="overflow:hidden" class="vis-group-assinRole-content"><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("EMail")+'<\/label><input  tabindex="1" class="vis-group-email" type="text" name="Name"><\/div><div style="width:auto;float:right;margin-top:5px" class="vis-group-assinRole-data"> <a tabindex="2" class="vis-group-btn vis-group-pointer vis-group-create vis-group-grayBtn" style="float: left;">'+n.Msg.getMsg("Create")+'<\/a><a tabindex="3" class="vis-group-btn vis-group-pointer vis-group-invite vis-group-blueBtn" style="float: right;">'+n.Msg.getMsg("VIS_Invite")+"<\/a><\/div><\/div>";s=t('<div class="vis-group-assignContainer" style="visibility:hidden"><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("Name")+'<\/label><input  tabindex="4" type="text" maxlength="60"  class="vis-group-name vis-group-mandatory"  name="Name"><\/div><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("VIS_UserID")+'<\/label><input tabindex="5" type="text" maxlength="80"  class="vis-group-uid"  name="Name"><\/div><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("Password")+'<\/label><input tabindex="6" type="password" maxlength="250"  class="vis-group-pwd"  name="Name"><\/div><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("Mobile")+'<\/label><input tabindex="7" type="text"  maxlength="50" class="vis-group-mobile"  name="Name"><\/div><a tabindex="8" class="vis-group-btn vis-group-Save vis-group-pointer vis-group-grayBtn" style="float: right;">'+n.Msg.getMsg("Save")+"<\/a><\/div>");o=t('<div class="vis-group-roleContainer" ><div> <label >'+n.Msg.getMsg("SelectRole")+"<\/label> <\/div><\/div>");r.append(i);f=r.find(".vis-group-assinRole-content");f.height("100px");c=r.find(".vis-group-create");l=r.find(".vis-group-invite");a=s.find(".vis-group-Save");e=s.find(".vis-group-name");p=s.find(".vis-group-uid");b=s.find(".vis-group-mobile");w=s.find(".vis-group-pwd");v=r.find(".vis-group-email")}function ot(){e.on("change",lt);c.on("click",tt);c.on("keydown",st);l.on("click",it);l.on("keydown",ct);a.on("click",rt);a.on("keydown",ht)}function st(n){(n.keyCode==undefined||n.keyCode==13)&&tt()}function ht(n){(n.keyCode==undefined||n.keyCode==13)&&rt()}function ct(n){(n.keyCode==undefined||n.keyCode==13)&&it()}function lt(){e.val().length>0?e.removeClass("vis-group-mandatory"):e.addClass("vis-group-mandatory")}function at(){g=t(' <script type="text/x-handlebars-template">{{#each this}}<div class="vis-group-user-wrap vis-group-role-pad"  data-UID="{{AD_Role_ID}}"><div class="vis-group-user-profile"><input tabindex="7"  type="checkbox" data-UID="{{AD_Role_ID}}" ><label>{{Name}}<\/label><\/div><\/div>{{/each}}​<\/script>').html();nt=Handlebars.compile(g)}function vt(){i[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Group/GetRoleInfo",data:{AD_User_ID:0},success:function(r){var f=JSON.parse(r),e=t('<div style="height:230px;overflow:auto;margin-bottom:10px">'),u;e.append(nt(f));o.append(e);k=t('<a tabindex="400" class="vis-group-btn vis-group-pointer vis-group-finish vis-group-grayBtn" style="float: right;">'+n.Msg.getMsg("VIS_Finish")+"<\/a>");o.append(k);k.on("click",ut);k.on("keydown",yt);for(t(o.children(".vis-group-user-wrap")).length>0&&t(t(o).children(".vis-group-user-wrap")[0]).trigger("click"),u=0;u<f.length;u++)d.push({AD_Role_ID:f[u].AD_Role_ID,IsAssignedToUser:!1});t(o.find("input")).off("click");t(o.find("input")).on("click",pt);i[0].style.visibility="hidden"},error:function(){n.ADialog.error("VIS_ErrorLoadingRoles");i[0].style.visibility="hidden"}})}function yt(n){(n.keyCode==undefined||n.keyCode==13)&&ut()}function pt(n){var r=t(n.target),i=t.grep(d,function(n){return n.AD_Role_ID==r.data("uid")});i!=null&&i.length>0&&(i[0].IsAssignedToUser=r.prop("checked"));n.stopPropagation()}function tt(){f.find(".vis-group-roleContainer").css("display","none");f.find(".vis-group-assignContainer").css("display","inherit");f.append(s);r.find(".vis-group-assignContainer").css({visibility:"visible"});f.height("369px")}function it(){f.find(".vis-group-assignContainer").css("display","none");f.find(".vis-group-roleContainer").css("display","inherit");f.append(o);f.height("385px")}function rt(){var f,o;if(t(r.find(".vis-group-assignContainer")[0]).css("visibility")=="visible"){if(f=e.val(),f==null||f==undefined||f==""){n.ADialog.info("VIS_PleaseName");return}i[0].style.visibility="visible";(y==null||y==undefined)&&(y=null);o=n.secureEngine.encrypt(w.val());t.ajax({url:n.Application.contextUrl+"Group/SaveNewUser",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",async:!0,data:{Name:f,Email:v.val(),Value:p.val(),password:o,mobile:b.val(),OrgID:JSON.stringify(y)},success:function(t){var r=JSON.parse(t);i[0].style.visibility="hidden";r==!1?n.ADialog.error("VIS_ErrorSavingUser"):u.close()},error:function(){i[0].style.visibility="hidden";n.ADialog.error("VIS_ErrorSavingUser")}})}}function ut(){var r=v.val(),h,s,e,f,o;if(r==null||r==undefined||r==""){n.ADialog.error("NotValidEmail");return}if(h=new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i),r.indexOf(";")==-1){if(f=h.test(r),!f){n.ADialog.error("NotValidEmail",!0,":"+r);return}}else for(s=r.split(";"),e=0;e<s.length;e++)if(f=h.test(s[e]),!f){n.ADialog.error("NotValidEmail",!0,":"+s[e]);return}if(o=t.grep(d,function(n){return n.IsAssignedToUser==!0}),o==null||o==undefined||o.length==0){n.ADialog.info("VIS_SelectRole");return}r!=null&&r!=undefined&&r!=""&&r.length>0&&(i[0].style.visibility="visible",t.ajax({url:n.Application.contextUrl+"Group/InviteUsers",type:"POST",datatype:"json",async:!0,data:{email:r,roles:JSON.stringify(o)},success:function(t){var r=JSON.parse(t);n.ADialog.info(r);i[0].style.visibility="hidden";u.close()},error:function(){n.ADialog.error("VIS_ErrorInvitingUsers");i[0].style.visibility="hidden"}}))}var r=null,f=null,c=null,l=null,a=null,v=null,e=null,p=null,w=null,b=null,u=null,h=this,y=null,i=null,g,nt=null,o=null,d=[],s=null,k=null;this.intialize=function(){et();ot();ft();at();vt()};this.setSelectedOrg=function(n){y=n};this.show=function(){u=new n.ChildDialog;u.setContent(r);u.setWidth(550);u.setTitle(n.Msg.getMsg("VIS_CreateUser"));u.setModal(!0);u.onClose=function(){h.onClose&&h.onClose();h.dispose()};u.show();u.hideButtons()};this.dispose=function(){this.prop=null;$div=null;u=null;h=null;r.remove();r=null;c.remove();c=null;l.remove();l=null;a.remove();a=null;v.remove();v=null;e.remove();e=null;p.remove();p=null;w.remove();w=null;b.remove();b=null;u=null;h=null}}n.createUser=i}(VIS,jQuery),function(n,t){function i(i){function h(){u=t("<div>");t.ajax({url:n.Application.contextUrl+"Group/GetOrgAccess",success:function(n){var i=JSON.parse(n);u.append(s(i));t(u.find("input")).on("click",a)},error:function(){n.ADialog.error("VIS_ErrorLoadingOrg")}})}function c(){o=t(' <script type="text/x-handlebars-template">{{#each this}}<div style="border-bottom:1px solid lightgray" class="vis-group-assinRole-check"><div style="width:100%" class="vis-group-user-profile"><input type="Checkbox" data-uid="{{OrgID}}"> <p style="margin-bottom:2px">{{OrgName}}<\/p><span style="margin-left:30px;float:left">{{Description}}<\/span><\/div><\/div>{{/each}}​<\/script>').html();s=Handlebars.compile(o)}function l(){r.onOkClick=function(){i(f);e.dispose()};r.onCancelClick=function(){e.dispose()}}function a(n){var i=t(n.target);i.prop("checked")?t.inArray(i.data("uid"))==-1&&f.push(i.data("uid")):f.splice(f.indexOf(i.data("uid")),1)}var u=null,o,s=null,r=null,f=[],e=this;this.intialize=function(){c();h()};this.show=function(){r=new n.ChildDialog;r.setContent(u);r.setWidth(450);r.setHeight(350);r.setTitle(n.Msg.getMsg("VIS_OrgAccess"));r.setModal(!0);r.onClose=function(){e.dispose()};r.show();l()};this.dispose=function(){this.prop=null;$div=null;u.remove();u=null;o=null;s=null;r=null;e=null;f=null}}n.orgAccess=i}(VIS,jQuery),function(n,t){function i(i){function f(){u=t('<div  class="vis-forms-container">');e()}function e(){t.ajax({url:n.Application.contextUrl+"Group/GetGroupChildInfo",data:{groupID:i},success:function(t){var i=JSON.parse(t),r='<div class="vis-group-gi-content"><label>'+i.GroupName+"<\/label>";i.Description!=null&&i.Description!=undefined&&i.Description!=""&&(r+="<p>"+i.Description+"<\/p>");i.WindowName!=null&&i.WindowName!=undefined&&i.WindowName!=""&&(r+='<div class="vis-group-gi-data"><label>'+n.Msg.getMsg("Windows")+":<\/label><p>"+i.WindowName+"<\/p>","<\/div>");i.FormName!=null&&i.FormName!=undefined&&i.FormName!=""&&(r+='<div class="vis-group-gi-data"><label>'+n.Msg.getMsg("VIS_Forms")+":<\/label><p>"+i.FormName+"<\/p>","<\/div>");i.ProcessName!=null&&i.ProcessName!=undefined&&i.ProcessName!=""&&(r+='<div class="vis-group-gi-data"><label>'+n.Msg.getMsg("VIS_Processes")+":<\/label><p>"+i.ProcessName+"<\/p>","<\/div>");i.WorkflowName!=null&&i.WorkflowName!=undefined&&i.WorkflowName!=""&&(r+='<div class="vis-group-gi-data"><label>'+n.Msg.getMsg("VIS_Workflows")+":<\/label><p>"+i.WorkflowName+"<\/p>","<\/div>");r+="<\/div>";u.append(r)},error:function(){n.ADialog.error("VIS_ErrorGettingGroupInfo")}})}var u=null,r=null;this.intialize=function(){f()};this.show=function(){r=new n.ChildDialog;r.setContent(u);r.setHeight(500);r.setWidth(550);r.setTitle(n.Msg.getMsg("VIS_Groupinfo"));r.setModal(!0);r.onClose=function(){self.onClose&&self.onClose();self.dispose()};r.show();r.hideButtons()};this.dispose=function(){self=null;u.remove();u=null;r=null}}n.groupInfo=i}(VIS,jQuery),function(n,t){function i(){function v(){var i='<div class="vis-group-assinRole-content"><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("Role")+'<\/label><input tabindex="1" maxlength="60" class="vis-group-role-text vis-group-mandatory" type="text"><\/div><div class="vis-group-assinRole-data"><label>'+n.Msg.getMsg("VIS_UserLevel")+'<\/label><select  tabindex="2"  class="vis-group-role-select" ><\/select><\/div><div class="vis-group-assinRole-data"><a style="float:left"  tabindex="3"  class="vis-group-btn vis-group-orgAccess vis-group-pointer vis-group-grayBtn">'+n.Msg.getMsg("VIS_OrgAccess")+'<\/a><a  tabindex="4"  class="vis-group-btn vis-group-Save vis-group-pointer vis-group-grayBtn" style="float: right;">'+n.Msg.getMsg("Save")+"<\/a><\/div><\/div>";r.append(i);u=r.find(".vis-group-role-text");o=r.find(".vis-group-role-select");s=r.find(".vis-group-orgAccess");h=r.find(".vis-group-Save");y();f[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Group/GetUserLevel",success:function(n){var t=JSON.parse(n),i;if(t!=null&&t.length>0)for(i=0;i<t.length;i++)o.append('<option value="'+t[i].ID+'">'+t[i].Name+"<\/option>");f[0].style.visibility="hidden"}})}function y(){f=t("<div class='vis-apanel-busy' style='height:96%; width:98%;'><\/div>");f[0].style.visibility="hidden";r.append(f)}function p(){s.on("click",l);s.on("keydown",w);h.on("click",a);h.on("keydown",b);u.on("change",k)}function w(n){(n.keyCode==undefined||n.keyCode==13)&&l()}function b(n){(n.keyCode==undefined||n.keyCode==13)&&a()}function k(){u.val().length>0?u.removeClass("vis-group-mandatory"):u.addClass("vis-group-mandatory")}function l(){var t=new n.orgAccess(c.setSelectedOrg);window.setTimeout(function(){t.intialize();t.show()},20)}function a(){var s=u.val(),r=o.val();if(s==null||s==undefined||s==""){n.ADialog.info("VIS_PleaseName");return}if(e==undefined||e==null||e==""||e.length==0){n.ADialog.info("VIS_SelectOrgAccess");return}if(r==null||r==undefined||r==""||r==-1){n.ADialog.info("VIS_SelectUserLevel");return}f[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"Group/AddNewRole",data:{name:s,userLevel:r,orgID:JSON.stringify(e)},success:function(t){var r=JSON.parse(t);r==!1?n.ADialog.error("VIS_ErrorSavingRole"):i.close();f[0].style.visibility="hidden"},error:function(){n.ADialog.error("VIS_ErrorSavingRole");f[0].style.visibility="hidden"}})}var r=t("<div>"),i=null,u=null,o=null,s=null,h=null,e=null,c=this,f=null;this.intialize=function(){v();p()};this.setSelectedOrg=function(n){e=n};this.show=function(){i=new n.ChildDialog;i.setContent(r);i.setWidth(550);i.setTitle(n.Msg.getMsg("VIS_CreateRole"));i.setModal(!0);i.onClose=function(){c.dispose();c=null};i.show();i.hideButtons()};this.dispose=function(){u.remove();u=null;o.remove();o=null;s.remove();s=null;h.remove();h=null;r.remove();r=null;i=null}}n.createrole=i}(VIS,jQuery),function(n,t){function i(){var b,k,d,g,p;this.onClose=null;var nt=this,r=null,u=null,e=null,a=null,o=null,s=null,h=null,i=null,c=[],w=null,v=null,tt=null,y=[],f=[],l=null,it=function(){r=t("<div>");u=t("<div class='vis-apanel-busy' style='width:96%;height:97%;text-align:center;position:absolute;'>");u[0].style.visibility="visible";r.append(u);e=t("<div>");a=t("<div style='height: 388px;width: 100%;background: aliceblue;overflow:auto;'>");e.append(a);h=t("<div>");e.append(h);var i=n.Msg.getMsg("Cancel"),f=n.Msg.getMsg("Ok");s=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(i);o=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(f);h.append(s);h.append(o);r.append(e);l=t("<table>")};it();b=function(){s.on("click",function(){p()});o.on("click",function(){d()})};b();k=function(){var k,d,e,r,b,o;if(i=[],k=null,e=n.dataContext.getJSONData(n.Application.contextUrl+"MarkModule/LoadModules",null,null),e!=null)for(r in e)k={},k.AD_ModuleInfo_ID=e[r].AD_ModuleInfo_ID,k.Name=e[r].Name,i.push(k);if(c.length==1&&(d={RecordID:c[0],TableID:v},e=n.dataContext.getJSONData(n.Application.contextUrl+"MarkModule/GetExportData",d,null),e!=null))for(r in e)y.push(e[r]);var h=null,p=null,s=null,w=null;if(y.length==0)for(r=0;r<i.length;r++)h=t("<tr>"),p=t("<td>"),s=t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'),w=t("<input type='checkbox'>"),s.append(w),s.append(i[r].Name),p.append(s),h.append(p),l.append(h),o={},o.Ctrl=w,o.AD_ModuleInfo_ID=i[r].AD_ModuleInfo_ID,f.push(o);else for(b=0;b<i.length;b++)h=t("<tr>"),p=t("<td>"),s=t('<label class="vis-gc-vpanel-table-label-checkbox" style="display: inline-block; opacity: 1;">'),w=y.indexOf(i[b].AD_ModuleInfo_ID)>-1?t("<input type='checkbox' checked>"):t("<input type='checkbox'>"),s.append(w),s.append(i[b].Name),p.append(s),h.append(p),l.append(h),o={},o.Ctrl=w,o.AD_ModuleInfo_ID=i[b].AD_ModuleInfo_ID,f.push(o);a.append(l);u[0].style.visibility="hidden"};d=function(){var i,t,e,o,r;for(u[0].style.visibility="visible",i=[],t=0;t<f.length;t++)e=f[t].Ctrl,e.prop("checked")&&i.push(f[t].AD_ModuleInfo_ID);o={moduleId:i,_recordID:c,_tableID:v,_strRecordID:w};r=n.dataContext.getJSONData(n.Application.contextUrl+"MarkModule/SaveExportData",o);r.result!="OK"&&alert(r.result);u[0].style.visibility="hidden";p()};this.show=function(){r.dialog({title:n.Msg.getMsg("VIS_MarkModule"),width:400,height:500,resizable:!1,modal:!0,close:g});k()};this.init=function(n,t,i){c=n.toString().split(",");w=n;v=t;tt=i};g=function(){p()};p=function(){nt.onClose&&nt.onClose();e=null;a=null;s.off("click");o.off("click");o=null;s=null;h=null;k=null;d=null;it=null;b=null;g=null;u=null;i=null;c=null;w=null;v=null;tt=null;y=null;f=null;l=null;r!=null&&(r.dialog("destroy"),r.remove());r=null}}n.MarkModule=i}(VIS,jQuery),function(n,t){function r(r){function uf(){di=t('<div class="vis-forms-container" style="width:100%;height:100%"><\/div>');ff();ef();su();ki=!0;hu();af(y)}function si(n){n&&pt!=null&&pt.css({display:"block"});n||pt==null||pt.css({display:"none"})}function sf(){rt!=null&&rt.children().find("input").prop("checked",!1)}function yr(n){var t,i;if(n==null||n.length==0)return null;for(t=0;t<h.getFields().length;t++)if(i=h.getFields()[t],n.equals(i.getColumnName()))return i;return null}function vu(t){var i=null,r;return(t&&(i=yt),i!=null)?i.getDisplayType()==n.DisplayType.YesNo?i.getValue().toString().toLowerCase()=="true"?"Y":"N":n.DisplayType.IsDate(i.getDisplayType())?(r=i.getValue(),r&&r.endsWith(".000Z")&&(r=r.replace(".000Z","Z")),r):i.getValue():""}function vf(t){var i=null;if(t&&(i=yt),i!=null){if(i.getDisplayType()==n.DisplayType.YesNo)return i.getValue().toString().toLowerCase()=="true"?"Y":"N";i.setValue("")}}function yu(n){var t=null;return(n&&(t=yt),t!=null)?t.getDisplay():""}function yf(n){var t=null;return(n&&(t=yt),t!=null)?t.getDisplayType(""):""}function pr(n){var t=null;n&&(t=yt);t!=null&&t.setValue(null)}function pu(n){var r=et.children()[1],i=null;et.children().length>2&&(i=et.children()[2]);i?t(i).prop("disabled",!n).prop("readonly",!n):r!=null&&t(r).prop("disabled",!n).prop("readonly",!n)}function pf(n,t){n.prop("disabled",!t)}function wr(i,r){var f,o,u,e;i&&(yt=null);rf=null;f=null;o=null;i&&(f=et.children()[0],et.children().length>1&&(o=et.children()[1]));f!=null&&(t(f).remove(),o!=null&&t(o).remove(),f=null);u=null;u=r!=null?r.getIsKey()?new n.Controls.VNumTextBox(r.getColumnName(),!1,!1,!0,r.getDisplayLength(),r.getFieldLength(),r.getColumnName()):n.VControlFactory.getControl(null,r,!0,!0,!1):new n.Controls.VTextBox("columnName",!1,!0,!1,20,20,"format","GetObscureType",!1);u!=null&&(u.setReadOnly(!1),n.DisplayType.Text==r.getDisplayType()||n.DisplayType.TextLong==r.getDisplayType()?(u.getControl().attr("rows","1"),u.getControl().css("width","100%")):n.DisplayType.YesNo==r.getDisplayType()?u.getControl().css("clear","both"):n.DisplayType.IsDate(r.getDisplayType())&&u.getControl().css("line-height","1"),e=null,u.getBtnCount()>0&&!(u instanceof n.Controls.VComboBox)&&(e=u.getBtn(0)),i&&(et.append(u.getControl().css("width","95%")),yt=u,e&&(et.append(e),u.getControl().css("width","60%"),e.css("max-width","35px"))))}function wf(n){var e={},o,r;nt={};var u="",s="",t=null,i=null,h=null,c=null,l=null,a=null,v=null,y=null;for(o=0;o<n.length;o++){for(nt={},nt.Color=n[o].Color,nt.Condition=[],u=n[o].ConditionValue.split("&"),s=n[o].ConditionText.split("&"),r=0;r<u.length;r++)e={},u[r].contains("!")?(t=u[r].trim().split("!"),i=s[r].trim().split("!"),v="!",y="!=",h=i[0].trim().substring(1,i[0].lastIndexOf("@")),c=t[0].trim().substring(1,t[0].lastIndexOf("@")),a=i[1],l=t[1]):u[r].contains("=")?(t=u[r].split("="),i=s[r].split("="),v="=",y="=",h=i[0].trim().substring(1,i[0].lastIndexOf("@")),c=t[0].trim().substring(1,t[0].lastIndexOf("@")),a=i[1],l=t[1]):u[r].contains("<")?(t=u[r].split("<"),i=s[r].split("<"),v="<",y="<",h=i[0].trim().substring(1,i[0].lastIndexOf("@")),c=t[0].trim().substring(1,t[0].lastIndexOf("@")),a=i[1],l=t[1]):u[r].contains(">")&&(t=u[r].split(">"),i=s[r].split(">"),v=">",y=">",h=i[0].trim().substring(1,i[0].lastIndexOf("@")),c=t[0].trim().substring(1,t[0].lastIndexOf("@")),a=i[1],l=t[1]),e.ColHeader=h,e.ColName=c,e.Operator=v,e.OperatorText=y,e.QueryValue=l,e.QueryText=a,nt.Condition.push(e);f.push(nt)}ki||ni(f)}var wt=r.curGC,h=wt.getMTab(),d=wt.vCardView,br=h.getAD_Window_ID(),kr=h.getAD_Tab_ID(),wu=h.getName(),bu=r.curGC.aPanel.$parentWindow.getName(),e=d.getAD_CardView_ID(),tt=d.getField_Group_ID(),st=0,hi=0,gi=null,nr=null,tr=null,ir=null,bt=null,l=null,ku=[],s=h.getFields(),rr=[],ur=null,ci=null,dr=0,a=-1,li=0,ti=0,ti=0,du=0,ii=[],p=[],gr=[],gu=0,ri="",nf=0,v=0,w=!1,tf=null,ft=null,kt=null,ai=null,vi=null,fr=null,nu=null,tu=null,er=null,or=null,ui=null,yi=null,u=null,o=null,pi=null,sr=null,hr=null,it=null,c=0,g=null,ri="",ht=0,cr=0,iu=[],ru=0,bf=n.context.getAD_User_Name(),wi=null,bi=null,lt=null,at=null,rt=null,ut=[],vt=null,ct="",fi=!1,uu=n.Msg.getMsg("IsDefault"),y=null,yt=null,rf=null,et=null,b=null,fu=h.getFields().slice(),lr=this,ot=null,f=[],nt=null,dt=null,ei=[],oi=null,ki=!1,eu=[],pt=null,di,k,ff=function(){for(var n=0;n<h.getFields().length;n++)rr.push(h.getFields()[n]);for(n=0;n<d.fields.length;n++)iu.push(d.fields[n].getAD_Field_ID())},ef=function(){var i;pt=t("<div class='vis-apanel-busy vis-cardviewmainbusy'><\/div> ");u=t("<div class='vis-cardviewmain'><\/div>");var r=t("<div class='vis-cardviewmainfirstchild vis-pull-left'><\/div>"),e=t("<div class='vis-cardviewmainsecondchild'><\/div>"),f=t("<div class='vis-cardviewCondition'><\/div>").append("<div class='vis-cardviewConditionControls'> <\/div>  <div class='vis-cardviewConditionGrid'> <\/div> "),h=t("<div class='vis-cardviewbtn'><button class='vis-btnDelete'> <\/button> <div class='vis-cdv-customokcancle'><button class='vis-btnOk'>  "+n.Msg.getMsg("Ok")+"  <\/button><button class='vis-btnCardViewCancle'>  "+n.Msg.getMsg("Cancel")+"  <\/button><\/div> <\/div>");u.append(r);r.append("<div class='vis-firstdiv vis-pull-left' ><\/div>");r.append("<div class='vis-seconddiv vis-pull-right'><\/div>");r.append("<div class='vis-thirddiv vis-pull-left' ><\/div>");u.find(".vis-firstdiv").append("<div class='vis-first-divHeader'><label class='vis-ddlcardview'>"+n.Msg.getMsg("SelectCardView")+" <\/label><label style='display:none' class='vis-lbcardviewname'>"+n.Msg.getMsg("CardViewName")+" <\/label><\/div>  ");var s=t("<div class='vis-CardView vis-pull-left'> <div  class='vis-cardviewchild vis-pull-left'><\/div>  <\/div>"),c=t("<input style='width:100%;display:none' class='vis-txtcardviewname' type='text'>"),a=t("<div class='vis-User vis-pull-left'><\/div>"),v=t("<div class='vis-pull-left'><button  class='vis-btnnew vis-cvd-btn'>  <\/button><button style='display:none' class='vis-btncancle vis-cvd-canclebtn'>  <\/button> <button class='vis-btnedit vis-cvd-editbtn'>  <\/button><\/div>");s.find(".vis-cardviewchild").append("<select class='vis-cmbcardview'> <\/select>");a.append("<Select type='text' class='vis-cmbuser'> <\/Select>");n.MRole.isAdministrator?(u.append(e),u.find(".vis-firstdiv").append(" <div style='display:none' class='vis-first-divHeader vis-pull-right'><label >"+n.Msg.getMsg("SelectUser")+"<\/label><\/div>"),u.find(".vis-CardView").append(""),u.find(".vis-firstdiv").append(s),u.find(".vis-cardviewchild").append(c),u.find(".vis-cardviewchild").css({width:"67%"}),u.find(".vis-CardView").append(v),pi=u.find(".vis-cmbuser"),ou(f.find(".vis-cardviewConditionControls")),u.append(f),u.append(h),u.find(".vis-btnDelete").css("display","block")):(f.css("width","100%"),u.find(".vis-firstdiv").append(s),u.find(".vis-cardviewchild").append(c),u.find(".vis-cardviewchild").css({width:"92%"}),r.css({width:"100%",float:"left"}),u.find(".k ").css("display","none"),ou(f.find(".vis-cardviewConditionControls")),u.append(f),u.append(h),u.find(".vis-btnDelete").css("display","none"));lf(u.find(".vis-cardviewConditionGrid"));e.append("<label class='vis-pull-left'> "+n.Msg.getMsg("SelectRole")+"<\/label>");e.append("<div style='border: 1px solid #ccc;height: 171px;margin-top: 25px;overflow:auto'><ul class='vis-ulrole'> <\/ul><\/div>");rt=u.find(".vis-ulrole");bi=u.find(".vis-ddlcardview");o=u.find(".vis-cmbcardview");wi=u.find(".vis-lbcardviewname");g=u.find(".vis-txtcardviewname");lt=u.find(".vis-btnnew");at=u.find(".vis-btncancle");btnEdit=u.find(".vis-btnedit");i=t("<div class='vis-divtextcontrol' ><\/div>");i.append("<div style='display:none' class='vis-second-divHeader vis-pull-left' ><div style='width:100%'> <label>"+n.Msg.getMsg("Window")+"<\/label><\/div><div style='width:100%'><input type='text'  class='vis-txtwindowname' style='width:100%' > <\/input><\/div><\/div>");i.append("<div style='display:none' class='vis-second-divHeader vis-pull-left' ><div style='width:100%'><label>"+n.Msg.getMsg("Tab")+"<\/label><\/div><div style='width:100%'><input type='text'  class='vis-txttabname' style='width:100%' > <\/input><\/div><\/div>");i.append("<div class='vis-second-divHeader vis-pull-left' ><div style='width:100%'><label>"+n.Msg.getMsg("GroupByField")+"<\/label><\/div><div style='width:92%'><select   class='vis-cmbgroupfield' style='width:100%;height:31px'> <\/select><\/div><\/div>");u.find(".vis-seconddiv").append(i);sr=i.find(".vis-txtwindowname");hr=i.find(".vis-txttabname");it=i.find(".vis-cmbgroupfield");kt=n.MRole.isAdministrator?t("<div class='vis-third-header vis-pull-left'><\/div>"):t("<div style='width:101%' class='vis-third-header vis-pull-left'><\/div>");ai=t("<div class='vis-left-fields vis-pull-left'><\/div>");vi=t("<div class='vis-left-fields vis-pull-left' ><\/div>");fr=t("<div class='vis-cardviewbutton vis-pull-left' ><button class='vis-btnup'  style='margin-top:10px'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/up-cardview.png'><\/button><button  class='vis-btnright'  style='margin-top:10px'><img  src='"+n.Application.contextUrl+"Areas/VIS/Images/"+(n.Application.isRTL?"left":"right")+"-shift.png' ><\/button><\/div>");fr.append("<button   class='vis-btnleft' style='margin-top:10px'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/"+(n.Application.isRTL?"right":"left")+"-shift.png' ><\/button><button  class='vis-btndown' style='margin-top:10px'><img src='"+n.Application.contextUrl+"Areas/VIS/Images/down arrow.png' ><\/button>");nu=t("<div style='width:100%'><label>"+n.Msg.getMsg("SelectField")+"<\/label><\/div>");tu=t("<div style='width:100%'><label>"+n.Msg.getMsg("IncludedField")+"<\/label><\/div>");er=t("<div style='width:99%;border: 1px solid #ccc;height:77%;overflow:auto'><\/div>");or=t("<div style='width:100%;border: 1px solid #ccc;height:77%;overflow:auto'><\/div>");ui=t("<ul  class='vis-windowfield'><\/ul>");yi=t("<ul  class='vis-cardviewcolumnfield'><\/ul>");er.append(ui);or.append(yi);ai.append(nu);ai.append(er);vi.append(tu);vi.append(or);kt.append(ai);kt.append(fr);kt.append(vi);u.find(".vis-thirddiv").append(kt);di.append(u);u.before(pt);bt=u.find(".vis-windowfield");l=u.find(".vis-cardviewcolumnfield");gi=u.find(".vis-btnright");nr=u.find(".vis-btnleft");tr=u.find(".vis-btnup");ir=u.find(".vis-btndown");btnOk=u.find(".vis-btnOk");btnCardViewCancle=u.find(".vis-btnCardViewCancle");btnDelete=u.find(".vis-btnDelete");y=u.find(".vis-cmbcolumn");et=u.find(".vis-cvd-valcontainer");b=u.find(".vis-cmboperator");btnSave=u.find(".vis-btnsave");ot=u.find(".vis-cv-rowtable");dt=u.find(".vis-cmbcolor");pt.css({display:"none"});of()},ou=function(i){var r=t('<div style="float:left;Width:calc( 100% - 41px)">'),u=t("<div class='vis-divcvc-cmbcolor'><div style='width:100%'><lable>"+n.Msg.getMsg("BGColor")+"<\/lable><\/div> <div style='width:100%'> <input class='vis-cmbcolor' type='color' /><\/div><\/div>"),f=t("<div class='vis-divcvc-cmbcolumn'><div style='width:100%'><lable>"+n.Msg.getMsg("Column")+"<\/lable><\/div> <div><select class='vis-cmbcolumn'><\/select><\/div><\/div>"),e=t("<div class='vis-divcvc-cmboperator'><div style='width:100%'><lable>"+n.Msg.getMsg("Operator")+"<\/lable><\/div>  <div><select class='vis-cmboperator'><\/select> <\/div><\/div>"),o=t("<div class='vis-divcvc-queryvalue'><div style='width:100%'><lable>"+n.Msg.getMsg("QueryValue")+"<\/lable><\/div> <div class='vis-cvd-valcontainer' style='width:100%'><\/div><\/div>"),s=t("<div class='vis-divcvc-btnsave'><button class='vis-btnsave'><\/button><\/div>");r.append(u);r.append(f);r.append(e);r.append(o);i.append(r);i.append(s)},su=function(i){o.children().remove();var r=n.Application.contextUrl+"CardView/GetCardView";if(t.ajax({type:"GET",async:!1,url:r,dataType:"json",contentType:"application/json; charset=utf-8",data:{ad_Window_ID:br,ad_Tab_ID:kr},success:function(t){if(ft=JSON.parse(t),st=ft[0].lstCardViewData,hi=ft[0].lstRoleData,vt=ft[0].lstCardViewRoleData,oi=ft[0].lstCardViewConditonData,st!=null&&st.length>0)for(var r=0;r<st.length;r++)o.append("<Option ad_user_id="+st[r].UserID+" cardviewid="+st[r].CardViewID+" ad_field_id="+st[r].AD_GroupField_ID+"> "+w2utils.encodeTags(st[r].CardViewName)+"<\/Option>");else lt.trigger("click"),at.prop("disabled",!0),btnEdit.trigger("click"),btnDelete.prop("disabled",!0);o.find("[cardviewid='"+e+"']").attr("selected","selected");ht=e;try{i?(ht=o.find(":selected").attr("cardviewid"),tt=o.find(":selected").attr("ad_field_id"),c=parseInt(o.find(":selected").attr("ad_user_id")),e=ht):(c=parseInt(o.find(":selected").attr("ad_user_id")),v=c,cr=c)}catch(u){}n.MRole.isAdministrator&&vr(rt);v>0&&rt.attr("disabled","disabled")},error:function(n){alert(n.statusText)}}),o!=null)o.on("change",function(){ki=!1;hu()})},hu=function(){var n=o.find(":selected");n.length>0&&(e=parseInt(n.attr("cardviewid")),c=parseInt(n.attr("ad_user_id")));au();cu();e>0?gt(!0,!1):gt(!1,!1);ar();vr(rt)},cu=function(){sr.val(bu);hr.val(wu);sr.prop("disabled","disabled");hr.prop("disabled","disabled")},ar=function(){var u,f,i,r,e;if(it!=null&&it.children().remove(),u=null,f=null,h!=null&&h.getFields().length>0)for(it.append("<Option FieldID=-1><\/Option>"),s=h.getFields(),i=0;i<s.length;i++)(r=s[i].getColumnName().toLower(),r!="created"&&r!="createdby"&&r!="updated"&&r!="updatedby")&&(n.DisplayType.IsLookup(s[i].getDisplayType())&&s[i].getLookup()&&s[i].getLookup().getIsValidated()||s[i].getDisplayType()==n.DisplayType.YesNo)&&it.append("<Option FieldID="+s[i].getAD_Field_ID()+"> "+s[i].getHeader()+"<\/Option>");if(tt!=null&&tt>0&&(e=jQuery.grep(s,function(n){return n.getAD_Field_ID()==tt}),it.find("[FieldID='"+tt+"']").attr("selected","selected"),ru=it.find(":selected").attr("fieldid")),it!=null)it.on("change",function(){tt=parseInt(t(this).find(":selected").attr("fieldid"))})},gt=function(t,i){var r,u,f;if(ui!=null&&ui.children().remove(),tf=null,gt,ft=null,s=h.getFields(),hf(yi,t),h!=null&&h.getFields().length>0)for(r=0;r<s.length;r++)(u=s[r].getColumnName().toLower(),u!="created"&&u!="createdby"&&u!="updated"&&u!="updatedby")&&(n.DisplayType.IsLOB(s[r].getDisplayType())||d.hasIncludedCols&&!i&&(f=jQuery.grep(ii,function(n){return n==s[r].getAD_Field_ID()}),f.length>0)||ui.append("<li index="+r+" FieldID="+s[r].getAD_Field_ID()+"> "+s[r].getHeader()+"<\/li>"))},of=function(){if(lt!=null)lt.on("click",function(n){n.stopPropagation();fi=!1;wi.css({display:"block"});g.css({display:"block"});bi.css({display:"none"});o.css({display:"none"});lt.css({display:"none"});at.css({display:"block"});btnEdit.css({display:"none"});u.find(".vis-cardviewchild").css({width:"81%"});w=!0;ut=[];sf();it.find("[FieldID='-1']").attr("selected","selected");gt(!1,!0);yi.children().remove();rt.find("input[type=checkbox]").attr("disabled",!1);eu=f;f=[];ni(f)});if(at!=null)at.on("click",function(n){n.stopPropagation();fi=!1;bi.css({display:"block"});o.css({display:"block"});wi.css({display:"none"});g.css({display:"none"});lt.css({display:"block"});at.css({display:"none"});g.val("");btnEdit.css({display:"block"});u.find(".vis-cardviewchild").css({width:"67%"});w=!1;gt(!0,!1);ar();vr(rt);ni(eu)});if(btnEdit!=null)btnEdit.on("click",function(n){n.stopPropagation();fi=!0;wi.css({display:"block"});g.css({display:"block"});bi.css({display:"none"});o.css({display:"none"});lt.css({display:"none"});at.css({display:"block"});btnEdit.css({display:"none"});u.find(".vis-cardviewchild").css({width:"81%"});g.val(o.find(":selected").text().trim())});if(pi!=null)pi.on("change",function(){});if(bt!=null)bt.on("click","li",function(){ur!=null&&ur.css("background-color","white");t(this).css("background-color","#1aa0ed");ur=t(this);dr=t(this).index();li=t(this).attr("FieldID");ri=t(this).text()});if(l!=null)l.on("click","li",function(){ci!=null&&ci.css("background-color","white");t(this).css("background-color","#1aa0ed");ci=t(this);a=t(this).index();ti=t(this).attr("FieldID");du=t(this).attr("cardviewcolumnid");ri=t(this).text();gu=t(this).attr("seqno")});if(gi!=null)gi.on("click",function(n){parseInt(li)<=0||(l.append("<li seqno=0 index="+nf+"  FieldID="+li+"> "+ri+"<\/li>"),li=0,bt.children().eq(dr).remove(),n.stopPropagation(),n.preventDefault())});if(nr!=null)nr.on("click",function(n){if(!(parseInt(ti)<=0)){l.children().eq(a).remove();var t=bt.children().length+1;bt.append("<li seqno=0 index="+t+"  FieldID="+ti+"> "+ri+"<\/li>");ti=0;a=-1;n.stopPropagation();n.preventDefault()}});if(tr!=null)tr.on("click",function(n){if(parseInt(a)!=0&&parseInt(a)!=-1){var t=parseInt(a)-1,i=l.children().eq(a),r=l.children().eq(t);l.children().eq(a).remove();l.children().eq(t).before(i);a=t;n.stopPropagation();n.preventDefault()}});if(ir!=null)ir.on("click",function(n){var i=l.children().length-1;if(i!=a&&parseInt(a)!=-1){var t=parseInt(a)+1,r=l.children().eq(a),u=l.children().eq(t);l.children().eq(a).remove();u.after(r);a=t;n.stopPropagation();n.preventDefault()}});if(rt!=null)rt.on("click","li",function(){var i=t(this).attr("ad_role_id"),n;if(t(this).find("input").is(":checked"))t(this).find("input").prop("checked",!0),ut.push({AD_Role_ID:parseInt(i)});else for(t(this).find("input").prop("checked",!1),n=0;n<ut.length;n++)ut[n].AD_Role_ID==i&&ut.splice(n,1)});if(btnOk!=null)btnOk.on("click",function(t){si(!0);window.setTimeout(function(){var u="",o="",s,r;for(ei=[],s="",i=0;i<f.length;i++){for(u="",o="",j=0;j<f[i].Condition.length;j++)j==0?(u+="@"+f[i].Condition[j].ColName+"@"+f[i].Condition[j].Operator+f[i].Condition[j].QueryValue,o+="@"+f[i].Condition[j].ColHeader+"@"+f[i].Condition[j].Operator+f[i].Condition[j].QueryText):(u+=" & @"+f[i].Condition[j].ColName+"@"+f[i].Condition[j].Operator+f[i].Condition[j].QueryValue,o+=" & @"+f[i].Condition[j].ColHeader+"@"+f[i].Condition[j].Operator+f[i].Condition[j].QueryText);ei.push({Color:f[i].Color.toString(),ConditionValue:u,ConditionText:o})}if(w){if(g.val()=="")return n.ADialog.error("FillMandatory",!0,"Name"),si(!1),!1}else if(!w&&e<1&&n.MRole.isAdministrator)return n.ADialog.error("ClickNew",!0,""),si(!1),!1;if(r={},r.FieldGroupID=tt,r.IncludedCols=lu(p),!r.IncludedCols)return!1;r.Conditions=ei;r.AD_CardView_ID=e;w&&parseInt(v)<0&&(r.FieldGroupID=ru,r.IncludedCols=iu,r.Conditions=ei,r.AD_CardView_ID=ht);d.setCardViewData(r);wt.isCardRow&&d.refreshUI(wt.getVCardPanel().width());k.close();t.stopPropagation();t.preventDefault()},50)});if(btnCardViewCancle!=null)btnCardViewCancle.on("click",function(){k.close()});if(btnDelete!=null)btnDelete.on("click",function(t){var i=confirm(n.Msg.getMsg("SureWantToDelete"));i&&(ki=!1,cf(),su(!0),cu(),ar(),gt(!0,!1),c==n.context.getAD_User_ID()&&(v=0,c=0));t.stopPropagation();t.preventDefault()});if(y!=null)y.on("change",function(t){var i,r,f,e,u;t.stopPropagation();i=y.val();pr(!0);i&&i!="-1"&&(r=null,f=null,r=i.endsWith("_ID")||i.endsWith("_Acct")||i.endsWith("_ID_1")||i.endsWith("_ID_2")||i.endsWith("_ID_3")?lr.getOperatorsQuery(n.Query.prototype.CVOPERATORS_ID):i.startsWith("Is")?lr.getOperatorsQuery(n.Query.prototype.OPERATORS_YN):lr.getOperatorsQuery(n.Query.prototype.CVOPERATORS),e=h.getField(i),b.html(r),b[0].SelectedIndex=0,u=yr(i),wr(!0,u),b.prop("disabled",!1));pu(!0)});if(b!=null)b.on("change",function(){var t=b.val(),i,r;t||(t="");i="";r="";t&&t!="0"?n.Query.prototype.BETWEEN.equals(t)&&(i=y.val(),r=yr(i),wr(!1,r)):(pf(btnSave,!1),pr(!0))});if(btnSave!=null)btnSave.on("click",function(){var n,i,r;y.find(":selected").val()!=-1&&(n={},nt={},i="",i=Modernizr.inputtypes.color?dt.val():dt.spectrum("get"),r=t.map(f,function(n,t){if(n.Color==i)return t}),r.length<=0?(nt.Color=i.toString(),nt.Condition=[],n.ColHeader=y.find(":selected").text(),n.ColName=y.find(":selected").val(),n.Operator=b.val(),n.OperatorText=b.find(":selected").text(),n.QueryValue=vu(!0),n.QueryText=yu(!0),nt.Condition.push(n),f.push(nt)):(n.ColHeader=y.find(":selected").text(),n.ColName=y.find(":selected").val(),n.Operator=b.val(),n.OperatorText=b.find(":selected").text(),n.QueryValue=vu(!0),n.QueryText=yu(!0),f[r[0]].Condition.push(n)),ni(f),y.find("[value='-1']").attr("selected","selected"),b[0].SelectedIndex=-1,vf(!0),yf(!0))});if(ot!=null)ot.on("click","tr td img",function(){var r=t(this).parent().parent().index(),u=t(this).parent().parent().children().eq(0).attr("value"),e=t(this).parent().parent().children().eq(1).attr("value"),n;for(ot.find("tr").eq(r).remove(),n=t.map(f,function(n,t){if(n.Color==u)return t}),i=0;i<f[n].Condition.length;i++)if(e==f[n].Condition[i].ColName&&f[n].Condition.splice(i,1),f[n].Condition.length<=0){f.splice(n,1);break}});if(ot!=null)ot.on("click","tr td",function(){var n=t(this).attr("value");typeof n!="undefined"&&n.startsWith("#")&&(Modernizr.inputtypes.color?dt.val(n):dt.spectrum("set",n))})},kf=function(n,t){n!=null&&n.children().remove();for(var i=0;i<p.length;i++)n.append("<li seqno="+p[i].SeqNo+" index="+i+" FieldID="+p[i].AD_Field_ID+"> "+p[i].FieldName+"<\/li>");t>0&&(ci=n.find("[fieldid='"+t+"']"),n.find("[fieldid='"+t+"']").css("background-color","#1aa0ed"))},df=function(n,t){var i,r;for(n!=null&&n.children().remove(),i=0;i<t.length;i++)(r=jQuery.grep(p,function(n){return n.AD_Field_ID==t[i].getAD_Field_ID()}),r.length>0)||n.append("<li index="+i+" FieldID="+t[i].getAD_Field_ID()+"> "+t[i].getHeader()+"<\/li>")},hf=function(i,r){var h,s,u,o;if(i!=null&&i.children().remove(),p=[],ku=[],ii=[],r&&(e>0||typeof e=="undefined"))typeof e=="undefined"&&(e=0),h=n.Application.contextUrl+"CardView/GetCardViewColumns",t.ajax({type:"GET",async:!1,url:h,dataType:"json",contentType:"application/json; charset=utf-8",data:{ad_CardView_ID:e},success:function(n){var t,r,u;if(ft=JSON.parse(n),t=ft[0].lstCardViewData,oi=ft[0].lstCardViewConditonData,t!=null&&t.length>0)for(tt=t[0].AD_GroupField_ID,c=t[0].UserID,r=0;r<t.length;r++)t[r].AD_Field_ID!=0&&(u=jQuery.grep(rr,function(n){return n.getAD_Field_ID()==t[r].AD_Field_ID}),u.length>0&&ii.push(u[0].getAD_Field_ID()),i.append("<li seqno=0 index="+r+" CardViewColumnID=0 FieldID="+t[r].AD_Field_ID+"> "+t[r].FieldName+"<\/li>"));oi!=null&&oi.length>0?(f=[],wf(oi)):(f=[],ni(f))},error:function(n){alert(n.statusText)}});else if(d.hasIncludedCols&&(s=null,ii=[],u=d.fields,u!=null&&u.length>0))for(o=0;o<u.length;o++)s=jQuery.grep(rr,function(n){return n.getAD_Field_ID()==u[o].getAD_Field_ID()}),s.length>0&&ii.push(s[0].getAD_Field_ID()),p.push({AD_Field_ID:u[o].getAD_Field_ID(),CardViewID:e,SeqNo:0,FieldName:u[o].getHeader()}),i.append("<li seqno=0 index="+o+" CardViewColumnID=0 FieldID="+u[o].getAD_Field_ID()+"> "+u[o].getHeader()+"<\/li>")},lu=function(){var f,u,r,i,s;if(n.MRole.isAdministrator)if(w)if(ct=g.val(),ut==null||ut.length<=0)if(v!=n.context.getAD_User_ID()){if(!confirm(n.Msg.getMsg("CardViewWarning")))return v=0,!1;v=n.context.getAD_User_ID()}else v=0;else v=0;else ct=g.val(),v==c||(v=0);else(!c||c<1)&&(w=!0,v=n.context.getAD_User_ID()),w&&(ht>0&&cr>0?(w=!1,e=ht,c=cr,ct=o.find(":selected").text()+" ("+uu+")"):ct=o.find(":selected").text()+" "+uu);for(ct.length<1&&!fi?ct=o.find(":selected").text():fi&&(ct=g.val()),f=l.children().length,p=[],u=[],r=0;r<f;r++)i={},i.AD_Field_ID=l.children().eq(r).attr("fieldid"),i.CardViewID=e,p.push(i),u.push(parseInt(i.AD_Field_ID));return gr.push({AD_Window_ID:br,AD_Tab_ID:kr,UserID:v,AD_GroupField_ID:tt,isNewRecord:w,CardViewName:ct,CardViewID:e}),s=n.Application.contextUrl+"CardView/SaveCardViewColumns",t.ajax({type:"POST",async:!1,url:s,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({lstCardView:gr,lstCardViewColumns:p,LstRoleID:ut,lstCardViewCondition:ei}),success:function(n){var t=JSON.parse(n);e=t;si(!1)},error:function(n){alert(n.statusText);si(!1)}}),u},cf=function(){var i=n.Application.contextUrl+"CardView/DeleteCardViewRecord";t.ajax({type:"POST",async:!1,url:i,dataType:"json",contentType:"application/json; charset=utf-8",data:JSON.stringify({ad_CardView_ID:e}),success:function(n){var t=JSON.parse(n)},error:function(n){alert(n.statusText)}})},gf=function(n){n!=null&&n.children().remove();n.append("<Option ad_user_id=-1 ><\/Option>");for(var t=0;t<userInfo.length;t++)n.append("<Option ad_user_id="+userInfo[t].AD_User_ID+" > "+userInfo[t].UserName+"<\/Option>");c>0&&pi.find("[ad_user_id='"+c+"']").attr("selected","selected")},vr=function(n){var r,t,i;for(ut=[],r="",c>0&&(r="disabled"),n!=null&&n.children().remove(),t=0;t<hi.length;t++)n.append("<li ad_role_id="+hi[t].AD_Role_ID+" > <input type='checkbox' "+r+"> "+w2utils.encodeTags(hi[t].RoleName)+"<\/li>");for(t=0;t<vt.length;t++)if(vt[t]!=null)for(i=0;i<vt[t].length;i++)vt[t][i].AD_CardView_ID==e&&(n.find("[ad_role_id='"+vt[t][i].AD_Role_ID+"']").find("input").prop("checked",!0),ut.push({AD_Role_ID:vt[t][i].AD_Role_ID}))},au=function(){c>0?k!=null&&k.changeTitle(n.Msg.getMsg("Card")+"("+n.Msg.getMsg("IsPrivate")+")"):k!=null&&k.changeTitle(n.Msg.getMsg("Card"))},lf=function(i){var r=t("<Table class='vis-cv-headertable'><tr class='vis-cv-TableHead'><th >"+n.Msg.getMsg("BGColor")+"<\/th><th>"+n.Msg.getMsg("Column")+"<\/th><th>"+n.Msg.getMsg("Operator")+"<\/th><th>"+n.Msg.getMsg("QueryValue")+"<\/th><th>"+n.Msg.getMsg("Action")+"<\/th><tr><\/Table>"),u=t("<div class='vis-cv-divrowtable'><Table class='vis-cv-rowtable'><\/Table><\/div>");i.append(r);i.append(u)},ni=function(i){var r,f;if(ot!=null&&ot.children().remove(),i!=null){var e=null,o=u.find(".vis-cv-TableHead").children().eq(0).innerWidth(),s=u.find(".vis-cv-TableHead").children().eq(1).innerWidth(),h=u.find(".vis-cv-TableHead").children().eq(2).innerWidth(),c=u.find(".vis-cv-TableHead").children().eq(3).innerWidth(),l=u.find(".vis-cv-TableHead").children().eq(4).innerWidth();for(r=0;r<i.length;r++)for(f=0;f<i[r].Condition.length;f++)e=t("<tr class='vis-cv-TableRow'><\/tr"),e.append("<td value="+i[r].Color+" style='width:"+o+"px'><div class='vis-cvd-bgcolor' style='background-color:"+i[r].Color+";cursor:pointer'>"+i[r].Color+"<\/div><\/td>"),e.append("<td style='width:"+s+"px' value="+i[r].Condition[f].ColName+">"+i[r].Condition[f].ColHeader+"<\/td>"),e.append("<td style='width:"+h+"px' value="+i[r].Condition[f].Operator+">"+i[r].Condition[f].OperatorText+"<\/td>"),e.append("<td style='width:"+c+"px' value="+i[r].Condition[f].QueryValue+">"+i[r].Condition[f].QueryText+"<\/td>"),e.append("<td style='width:"+l+"px'><img  style='cursor:pointer;margin-right:5px;width:20px;height:20px'  src='"+n.Application.contextUrl+"Areas/VIS/Images/delete-ico.png' > <\/td>"),ot.append(e)}},af=function(){for(var f='<option value="-1"> <\/option>',t,u,i,r=0;r<fu.length;r++)if(t=fu[r],!t.getIsEncrypted()){if(u=t.getColumnName(),t.getDisplayType()==n.DisplayType.Button){if(t.getAD_Reference_Value_ID()==0)continue;u.endsWith("_ID")?t.setDisplayType(n.DisplayType.Table):t.setDisplayType(n.DisplayType.List)}(i=t.getHeader(),i!=null&&i.length!=0||(i=n.Msg.getElement(n.context,u),i!=null&&i.Length!=0))&&(t.getIsKey()&&(i+=" (ID)"),f+='<option value="'+u+'">'+i+"<\/option>")}y.html(f)},ne=function(){var n=y.val(),t;pr(!0);n&&n!="-1"&&(t=yr(n),wr(!0,t));pu(!0)};uf();this.getRoot=function(){return di};this.show=function(){k=new n.ChildDialog;k.setTitle(n.Msg.getMsg("Card"));k.setContent(di);k.onOkClick=function(){if(w){if(g.val().trim()=="")return n.ADialog.error("FillMandatory",!0,"Name"),!1}else if(!w&&e<1&&(o.val()==""||o.val()==null)&&n.MRole.isAdministrator)return n.ADialog.error("ClickNew",!0,""),!1;var t={};if(t.FieldGroupID=tt,t.IncludedCols=lu(p),!t.IncludedCols)return!1;t.Conditions=[];t.AD_CardView_ID=e;n.MRole.isAdministrator&&v<1&&ht>0&&(t.Conditions=[],t.AD_CardView_ID=ht);d.setCardViewData(t);wt.isCardRow&&d.refreshUI(wt.getVCardPanel().width())};k.show();k.hideButtons();au();ni(f);Modernizr.inputtypes.color||dt.spectrum({showButtons:!1,preferredFormat:"hex"})}}r.prototype.getOperatorsQuery=function(t,i){var f="",r="",u;for(u in t)r=t[u],i&&(r=n.Msg.getMsg(r)),f+='<option value="'+u+'">'+r+"<\/option>";return f};n.CVDialog=r}(VIS,jQuery),function(n,t){function i(i){function st(i){var e,o;u=t("<div style='overflow: hidden;'>");s=t('<div class="vis-apanel-busy" style="width: 96%; height: 97%; text-align: center; position: absolute; visibility: hidden;"><\/div>');l=t('<div style="display: inline-block; float: left;width:99%;height:auto;margin-top: 2px;">');a=t('<div style="padding-left: 7px;height:88.9%;display: inline-block; float: left;width:100%;height:87.8%;">');w=t("<button class='vis-initial-btn vis-initial-btn-blue' style='border: none;'>"+n.Msg.getMsg("SelectFile")+"<\/button>");b=t("<div class='VIS-form-data' style='width: 100%;height:200px;border: 1px solid #ccc;margin-top: 11px;padding: 10px;overflow:auto;'>");v=t('<div style="display: inline-block; float: left;width:100%;height:auto;margin-top: 2px;">');d=t("<div style='float: left;'>");y=t('<div style="float:right;">');e=n.Msg.getMsg("Cancel");e.indexOf("&")>-1&&(e=e.replace("&",""));o=n.Msg.getMsg("Ok");o.indexOf("&")>-1&&(o=o.replace("&",""));p=t("<button class='VIS_Pref_btn-2' style='margin-top: 5px;margin-bottom: -10px;'>").append(e);f=t("<button class='VIS_Pref_btn-2' disabled='true' style='margin-top: 5px;margin-bottom: -10px;margin-right:5px'>").append(o);h=i?t("<input type='file' multiple='true'>"):t("<input type='file'>");a.append(w);a.append(b);l.append(a);v.append(d);y.append(p);y.append(f);v.append(y);l.append(v);u.append(l);u.append(s);r=[]}function ht(){p.on("click",function(){g=!1;et()});f.on("click",function(){ft()});w.on("click",function(){h.val("");h.trigger("click")});h.on("change",function(){ut(this)})}function ct(){g||(k="");ot.onClose(k);et()}this.onClose=null;var u,s,l,a,v,y,p,f,r,h,w,b,d,ot=this,g=!1,tt=0,o=0,k=Date.now().toString()+"_FileCtrl",e=1048576,it=0,c=0,rt=[];st(i);ht();this.show=function(){u.dialog({width:500,height:377,resizable:!1,modal:!0,title:n.Msg.getMsg("Upload"),close:ct})};var ut=function(i){for(var u=[],c,e,o,v,s=0;s<i.files.length;s++){if(file=i.files[s],file==undefined)return;if(file.name.indexOf("&")>-1||file.name.indexOf("?")>-1||file.name.indexOf("#")>-1||file.name.indexOf("/")>-1||file.name.indexOf("\\")>-1){u.push(file.name);continue}for(c in r)if(file.name==r[c].name){window.setTimeout(function(){n.ADialog.info("fileAlreadyAttached")},20);return}if(e={},e.Name=file.name,e.Size=file.size,!(e.Size>17e6)){r.push(file);var h=t("<div class='VIS-file-wrap'>"),y=t("<p>"+e.Name+"<\/p>"),l=r.length-1,a=t("<span class='VIS-close-ico mychoice_"+l+"'  data-index='"+l+"'>");a.on("click",function(){var n=t(this).parent(),i,u;n&&(i=n.children()[0],i&&(u=r.map(function(n){return n.name==t(i).text()}).indexOf(!0),r.splice(u,1),n.remove()));r.length==0?f.attr("disabled","true"):f.removeAttr("disabled")});h.append(y);h.append(a);b.append(h);r.length==0?f.attr("disabled","true"):f.removeAttr("disabled")}}if(u.length>0){o="";for(v in u)o+=u[v].toString()+"\n";o+=u.length==1?"File has":"Files have";o+=" "+n.Msg.getMsg("VIS_InvalidName")+" "+n.Msg.getMsg("VIS_ChangeFileName");n.ADialog.info(o)}},ft=function(){var t,u;s[0].style.visibility="visible";var n=null,i=0;for(t in r)i=parseInt(r[t].size/e),file.size%e>0&&i++,it+=i,n={},n.Name=r[t].name,n.Size=r[t].size,rt.push(n);u=nt()},nt=function(){var t,i,f;if(r==null||r.length==0)return n.ADialog.info("NothingToUpload"),s[0].style.visibility="hidden",!1;if(o>=r.length)return s[0].style.visibility="hidden",g=!0,u.dialog("close"),!0;t=new XMLHttpRequest;i=new FormData;i.append("file",r[o].slice(c*e,c*e+Number(e)));t.open("POST",n.Application.contextUrl+"Attachment/SaveFileinTemp/?filename="+r[o].name+"&folderKey="+k,!1);t.send(i);tt++;c++;f=parseInt(r[o].size/e);r[o].size%e>0&&f++;c==f&&(o++,c=0);window.setTimeout(function(){nt()},2)},et=function(){p.off("click");f.off("click");s=l=a=v=y=p=f=null;r=h=w=b=d=null;tt=o=k=e=it=c=rt=null;ut=ft=nt=loadTables=loadLanguage=loadEDL=loadExportScope=null;u!=null&&(u.dialog("destroy"),u.remove());u=null}}n.VisImportFiles=i}(VIS,jQuery);VIS=window.VIS||{},function(n,t){function i(i,r){function a(n){v.css("display",n?"block":"none")}function y(t){if(t.error==null){var i=JSON.parse(t.result);if(!i.IsError)if(i.ShowParameter)u.pInstanceId=i.AD_PInstance_ID,u.fields=i.ProcessFields;else return i.ReportProcessInfo!=null&&(n.ADialog.info(i.ReportProcessInfo.Summary,!0,"",""),n.Msg.getMsg("ImportedSuccessfully")==i.ReportProcessInfo.Summary)?(p.parentcall(!0),u&&(u.isOkProcess=!0),!0):(u&&(u.isOkProcess=!1),p.parentcall(!1),!1)}}function b(){f=t("<div title='ParameterDialog'>");c=t("<table class='vis-processpara-table'>");f.append(c);s=t('<input type="button" style="margin-right:5px" >').val(n.Msg.getMsg("OK"));s.addClass("VIS_Pref_btn-2");o=t("<input type='button'>").val(n.Msg.getMsg("Close"));o.addClass("VIS_Pref_btn-2");o.css({"margin-bottom":"0px","margin-top":"7px"});s.css({"margin-bottom":"0px","margin-top":"7px"})}function k(t,i){if(t){u.paraList=i;var r=new n.ProcessInfo(u.name,u.processId,0,0);r.setAD_PInstance_ID(u.pInstanceId);n.dataContext.executeProcess({processInfo:r.toJson(),parameterList:i},function(n){y(n)})}}var p=r,f,c,w,h,l,e,s,o,v,u;this.windowNo=i;this.processId=null;this.name=null;this.entityType=null;this.pInstanceId=0;this.className=null;this.fields=null;this.paraList=null;this.asyncProcess=!0;this.gridFields=[];this.depOnFieldColumn=[];this.depOnField=[];this.vEditors=[];this.vEditors2=[];this.mFields=[];this.mFields2=[];this.isOkClicked=!1;this.onClosed;v=t("<div class='vis-apanel-busy' style='width:95%;height:98%;position:absolute'>");u=this;this.onCloseMain=null;this.isOkProcess=!1;this.process=function(t,i,r){var f=new n.ProcessInfo(i,t,0,0),e,o;f.setAD_PInstance_ID(u.pInstanceId);f.setWindowNo(r);e={processInfo:f.toJson()};this.asyncProcess?n.dataContext.process(e,function(n){y(n)}):(o=n.dataContext.process(e),y(o))};b();this.addLine=function(){w=h=l=e=null;h=t("<td class=''>");l=t("<td class=''>");e=t("<td class='vis-processpara-table-td3'>");c.append(t("<tr>").append(h).append(l).append(e))};this.addFields=function(t,i){if(t&&h.append(t.getControl()),i&&(i.getControl().width("200px"),i.getControl().height("30px"),e.append(i.getControl()),i.getBtnCount()>0)){var r=i.getBtn(0);e.append(r);i.getDisplayType()==n.DisplayType.MultiKey&&e.append(i.getBtn(1))}};this.addButtons=function(){this.addLine();e.append(o).append(s)};this.showDialog=function(){f.append(v);f.dialog({modal:!0,width:"auto",close:function(){if(k(u.isOkClicked,u.parameterList),u.onCloseMain)u.onCloseMain(u.isOkClicked);u.dispose();u=null;a(!1)}});window.setTimeout(function(){o.focus()},200);a(!1)};this.onClose=function(n){u.isOkClicked=n;f.dialog("close")};o.on(n.Events.onTouchStartOrClick,function(){u.onClose(!1)});s.on(n.Events.onTouchStartOrClick,function(){a(!0);var n=u.saveParameters();if(!n){a(!1);return}u.parameterList=n;u.onClose(!0,n)});this.disposeComponent=function(){o.off(n.Events.onTouchStartOrClick);s.off(n.Events.onTouchStartOrClick);f.dialog("destroy");f.remove();u=null;this.gridFields.length=0;this.gridFields=null;this.depOnFieldColumn.length=0;this.depOnFieldColumn-null;this.depOnField.length=0;this.depOnField=null;this.vEditors.length=0;this.vEditors2.length=0;this.mFields.length=0;this.mFields2.length=0;this.parameterList=null;this.addLine=null;this.addFields=null;this.addButtons=null;this.showDialog=null;this.onClose=null;this.isOkClicked=null;f=c=w=h=l=e=s=o=null}}i.prototype.initDialog=function(i,r,u,f,e){var a,o,c,b,p,v,k,s,w,y,h,l;for(this.processId=i,this.name=r,this.entityType=u,this.className=f,typeof e!="undefined"&&(this.asyncProcess=e),this.process(i,r,this.windowNo),a=this.fields,o=null,c=0,b=a.length;c<b;c++){for(o=new n.GridField(a[c]),this.addLine(),this.mFields.push(o),p=o.getDependentOn(!1),v=0;v<p.length;v++)this.depOnField.push(o),this.depOnFieldColumn.push(p[v]);k=n.VControlFactory.getLabel(o);s=n.VControlFactory.getControl(null,o,!1);s&&(l=o.getDefault(n.context,this.windowNo),s.setValue(l),s.addVetoableChangeListener(this));o.setPropertyChangeListener(s);this.vEditors.push(s);this.addFields(k,s);o.getIsRange()?(this.addLine(),w={},t.extend(!0,w,a[c]),y=new n.GridField(w),this.mFields2.push(y),h=n.VControlFactory.getControl(null,y,!1),h&&(l=y.getDefault(n.context,this.windowNo),h.setValue(l),h.addVetoableChangeListener(this)),this.vEditors2.push(h),this.addFields(null,h)):(this.mFields2.push(null),this.vEditors2.push(null))}return this.addButtons(),!0};i.prototype.vetoablechange=function(t){var f,r,e,u,o,i;if(console.log(t),f=t.newValue==null?"":t.newValue.toString(),r=t.propertyName,n.Env.getCtx().setWindowContext(this.windowNo,r,f),this.depOnFieldColumn.indexOf(r)!==-1)for(e=this.getDependantFields(r),u=0,o=e.length;u<o;u++)(i=field,i!=null)&&(i.refreshLookup(),i.setValue(i.getDefault(Env.getCtx(),this.windowNo),!0))};i.prototype.getDependantFields=function(n){var i=[],r,t;if(this.depOnFieldColumn.indexOf(n)!=-1)for(r=this.depOnFieldColumn.length,t=0;t<r;t++)this.depOnFieldColumn[t].equals(n)&&i.indexOf(this.depOnField[t])<0&&i.push(this.depOnField[t]);return i};i.prototype.saveParameters=function(){for(var r=new StringBuilder,v=this.mFields.length,t=0,u,e,o,y,s,h,c,i,a,t=0;t<v;t++)u=this.mFields[t],u.getIsMandatory(!0)&&(e=this.vEditors[t],o=e.getValue(),o==null||o.toString().length==0?(u.setInserting(!0),u.setError(!0),r.length()>0&&r.append(", "),r.append(u.getHeader())):u.setError(!1),y=this.vEditors2[t],y!=null&&(s=e.getValue(),h=this.mFields2[t],s==null||s.toString().length==0?(u.setInserting(!0),h.setError(!0),r.length()>0&&r.append(", "),r.append(u.getHeader())):h.setError(!1)));if(r.length()!=0)return n.ADialog.error("FillMandatory",!0,r.toString()),!1;for(c=[],i={},t=0;t<v;t++){var p=this.vEditors[t],f=this.vEditors2[t],w=p.getValue(),l=null;(f!=null&&(l=f.getValue()),w!=null||l!=null)&&(i={},a=this.mFields[t],i.Name=a.getColumnName(),i.DisplayType=a.getDisplayType(),i.Result=w,i.Result2=l,i.Info=p.getDisplay(),f!=null&&(i.Info_To=f.getDisplay()),c.push(i))}return c};i.prototype.dispose=function(){this.disposeComponent()};n.ParameterDialog=i}(VIS,jQuery),function(n,t){function f(n,i,u){var f=null;return t.ajax({url:r,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){f=n;u&&u(n)}),f}function e(t,i){function f(){var o,e,i,f;try{if(o="VIS_100",e=[],e[0]=new n.DB.SqlParam("@processName",t),i=u(o,e),i!=null&&i.getTables()[0].getRows().length>0){var s=i.tables[0].getRow(0).getCell(0),h=i.tables[0].getRow(0).getCell(1),c=i.tables[0].getRow(0).getCell(2),l=i.tables[0].getRow(0).getCell(3);s>0?(f=new n.ParameterDialog(r.parent.windowNo,r),f.initDialog(s,h,l,c,!1),f.onCloseMain=function(t){t?n.ADialog.info("ProcessWait",!0,"",""):n.ADialog.info("Process Canceled",!0,"","")},f.showDialog(),f=null):n.ADialog.info("ProcessNotFound",!0,"","")}}catch(a){}}this.parent=i;var r=this;f();this.lockUI=function(n){r.lockUI&&r.lockUI(n)};this.unlockUI=function(n){r.unlockUI&&r.unlockUI(n)};this.parentcall=function(n){r.parentcall&&r.parentcall(n)}}var i=n.Application.contextUrl,r=i+"JsonData/JDataSetWithCode",u=function(t,i,r){var o=r?!0:!1,e={sql:t,page:1,pageSize:0},u;return i&&(e.param=i),u=null,f(e,o,function(t){u=(new n.DB.DataSet).toJson(t);r&&r(u)}),u};n.ProcessWrapper=e}(VIS,jQuery),function(n,t){function i(){function go(n,i,r){var u=null;return t.ajax({url:vh,type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:i,data:JSON.stringify(n)}).done(function(n){u=n;r&&r(n)}),u}function es(){t.ajax({url:n.Application.contextUrl+"TreeMaintenance/TreeDataForCombo",success:function(r){var f=JSON.parse(r),u;if(f)for(w.append(t("<Option value=''> <\/option>")),u=0;u<f.length;u++)w.append(t("<Option value="+f[u].ID+" data-type='"+f[u].TreeType+"' data-isallnodes='"+f[u].IsAllNodes+"'  >"+n.Utility.encodeText(f[u].Name)+"<\/option>"));hi!=null&&w.val(hi.attr("value"));i[0].style.visibility="hidden"},error:function(n){console.log(n);i[0].style.visibility="visible"}})}function os(){ir.css("display","none");o=0;f.empty();r.empty();ct.empty();yt="";ii.val("");hi=null;g.addClass("vis-tm-delete");e.val("");window.setTimeout(function(){f.empty();b.data("kendoTreeView").destroy();b.empty()},200);gu.text(n.Msg.getMsg("SelectTree"));ui.text(n.Msg.getMsg("SelectTree"));fi.css("display","none");ti.addClass("vis-tm-delete");y.prop("disabled",!0);pi.prop("disabled",!0);y.css("cursor","not-allowed");pi.css("cursor","not-allowed");e.prop("disabled",!0);ii.prop("disabled",!0);tt.prop("disabled",!0);et.prop("disabled",!0);et.css("cursor","not-allowed");vr.css("display","none");di.css("display","none");pi.prop("checked",!1);et.prop("checked",!1);y.prop("checked",!1);nt.prop("checked",!1)}function su(){var u="SELECT ad_table_id FROM ad_tree WHERE ad_tree_id="+o,i,r,f,s,e;if(u=k(u,null,null),u.tables[0].rows.length>0&&(u=u.tables[0].rows[0].cells.ad_table_id),i="SELECT tablename FROM ad_table WHERE ad_table_id="+u,i=k(i,null,null),i.tables[0].rows.length>0&&(i=i.tables[0].rows[0].cells.tablename),dr(),r="SELECT Count(*) as Count FROM "+i+" WHERE IsActive='Y' AND "+i+"_ID  IN (SELECT Node_ID FROM "+nr+" where AD_Tree_ID="+o+")",r=n.MRole.addAccessSQL(r,i,!0,!1),r=k(r,null,null),r=r.tables[0].rows[0].cells.count,or=r>0?!0:!1,ri=="false"&&r==li.length&&(f="SELECT node_id  FROM "+nr+" WHERE isactive ='Y' AND AD_Tree_ID="+o,f=k(f,null,null),f!=null))for(s=null,e=0;e<f.tables[0].rows.length;e++)if(s=f.tables[0].rows[e].cells.node_id,t.inArray(s,li)<0){or=!0;break}else or=!1}function tf(i,r,u,f){ot[0].style.visibility="visible";rt.is(":checked")||(fa(),f=rt.is(":checked")?!0:!1);t.ajax({url:n.Application.contextUrl+"TreeMaintenance/BindTree",type:"Post",data:{treeType:i,AD_Tree_ID:r,isAllNodes:u,isSummary:f},success:function(n){var t=JSON.parse(n);t&&(nc(t),window.setTimeout(function(){window.setTimeout(function(){w.val()==""?os():w.val()==null&&os();su()},400)},500),po=t,vo=t.settree);ot[0].style.visibility="hidden"},error:function(n){console.log(n);ot[0].style.visibility="hidden"}})}function gh(){ki.css("display","none");e.css("border-right","none");si=!1;it.css("display","none");h.css("border-bottom","0px");h.css("height","100%");gt.css("height","100%");h.resizable("destroy");gt.removeClass("VIS-TM-resizediv");hi!=null&&tf(dt,o,pr,si)}function nc(i){ot[0].style.visibility="visible";ir.css("display","inherit");b&&b.data("kendoTreeView")!=undefined&&(b.data("kendoTreeView").destroy(),b.empty());b=u.kendoTreeView({autoScroll:!0,dragAndDrop:!0,drag:tc,drop:ic,dataSource:i.settree,select:function(n){d[0].style.visibility="visible";rt.is(":checked")&&ar.css("display","inherit");hr==!0;r.empty();nt.prop("checked",!1);u.find(".k-state-selected").removeClass("k-state-selected");t(n.node).find(".k-state-hover").addClass("k-state-selected").removeClass("k-state-hover");var i=t(t(t(n.node).find(".treechild")[0]).find("p")).text();ui.text(i);br=t(t(n.node).find(".treechild")[0]).attr("data-nodeid");er=!0;cf=-1;g.addClass("vis-tm-delete");fi.css("display","none");bf=!1;u.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode");u.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode");window.setTimeout(function(){u.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode");u.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode");ft=1;st=50;v=y.is(":checked")?e.val():"";c=y.is(":checked")?"true":"false";window.setTimeout(function(){br=u.find(".k-state-selected").find(".treechild").attr("data-nodeid");rt.is(":checked")&&(u.find(".k-state-hover").removeClass("k-state-hover"),gi(br,o,ft,st,v,c,n))},300)},300)},template:"<div class='treechild'  data-getparentnode='#= item.getparentnode #'       data-IsSummary='#= item.IsSummary #' data-TableName='#= item.TableName #' data-NodeID='#= item.NodeID #'   data-TreeParentID='#= item.TreeParentID #' data-ParentID='#= item.ParentID #'  ><div class='imgdivTree' style='float:left;margin-top:3px'><img src='"+n.Application.contextUrl+"#= item.ImageSource #' style='height:20px' ><\/div><div class='textdivTree' style='float:left;margin:3px 5px 0 10px'><p>"+n.Utility.encodeText("#= item.text #")+"<\/p><\/div><\/div>"});tu();b.find(".k-plus").on("click",function(){t(this).hasClass("k-minus")&&(at.css("display","inherit"),wt.css("display","none"));t(this).hasClass("k-plus")&&(wt.css("display","inherit"),at.css("display","none"))});b.find(".k-in").on("dblclick",function(){t(u.find(".k-state-selected").parent().find("span")[0]).hasClass("k-minus")&&(at.css("display","inherit"),wt.css("display","none"));t(u.find(".k-state-selected").parent().find("span")[0]).hasClass("k-plus")&&(wt.css("display","inherit"),at.css("display","none"))});window.setTimeout(function(){ir.css("display","none")},200);ru==!0&&(b.data("kendoTreeView").expand(".k-item"),u.find("div").find("div[data-nodeid='"+so+"']").parent().addClass("k-state-selected"),u.find("span").hasClass("k-state-selected")&&u.find("div").find("div[data-nodeid='"+so+"']").parent().addClass("k-state-selected")[0].scrollIntoView());e.val()!=""&&fr(ur);au();window.setTimeout(function(){e.val()!=""&&fr(he)},200);hc()}function tc(n){ur=n;it.addClass("vis-tm-bottomdivdisable");ro.css("display","inherit");ci.css("display","inherit");vu=t(n.sourceNode).find(".treechild").attr("data-nodeid");wo=t(n.sourceNode).find(".treechild").parent().parent().parent();ss=t(n.sourceNode);sr=this.dragging._draggable.hint.find(".k-denied");t(u.find("ul")[0]).css("width","95%");s.addClass("VIS-TM-ondragdrop");vu!=0&&(ht.css("display","inherit"),s.css("display","inherit"));t(n.sourceNode).find(".treechild").attr("data-nodeid")==0&&n.setStatusClass("k-denied");t(n.dropTarget).parent().parent().attr("data-issummary")=="false"&&n.setStatusClass("k-denied");t(n.dropTarget).parent().parent().parent().parent().parent().find(".treechild").attr("data-issummary")=="false"&&n.setStatusClass("k-denied");t(n.dropTarget).hasClass("k-top")&&t(n.dropTarget).find(".treechild").attr("data-issummary")=="false"&&n.setStatusClass("k-denied");t(n.dropTarget).hasClass("k-item")&&n.setStatusClass("k-denied");this.dragging._draggable.hint.find(".k-add").length==1&&t(n.dropTarget).parent().attr("data-issummary")=="false"&&n.setStatusClass("k-denied");t(n.dropTarget).parent().find(".textdivTree").length==1&&this.dragging._draggable.hint.find(".k-add").length==1&&n.setStatusClass("k-denied");(t(n.dropTarget).attr("aria-expanded")=="true"||t(n.dropTarget).attr("aria-expanded")=="false")&&n.setStatusClass("k-denied");t(n.dropTarget).hasClass("selectchangecolor")?(sr.css("display","none"),sr.parent().prepend(hs),sr.parent().find(".vis-tm-unlinkimgss").css("display","inherit")):(sr.css("display","inherit"),sr.parent().find(".vis-tm-unlinkimgss").css("display","none"));t(n.dropTarget).hasClass("glyphicon glyphicon-trash")&&(sr.css("display","none"),sr.parent().prepend(hs));yo=this.dragging._draggable.hint.find("span").hasClass("k-insert-bottom");yo&&n.setStatusClass("k-denied");t(n.dropTarget).hasClass("k-state-hover")&&t(n.dropTarget).find(".treechild").attr("data-issummary")=="false"&&n.setStatusClass("k-denied");t(n.dropTarget).hasClass("VIS-TM-root-node")&&n.setStatusClass("k-denied")}function ic(n){var f,l,h,r,c;if(rf=0,rf=u.find(".k-state-selected").find(".treechild").attr("data-nodeid"),ur=n,vt.css("overflow","auto"),nf.css("overflow","auto"),pf.css("overflow","auto"),it.removeClass("vis-tm-bottomdivdisable"),ro.css("display","none"),ci.css("display","none"),n.sourceNode.previousSibling==n.destinationNode&&n.dropPosition=="after"){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}if(n.sourceNode.nextSibling==n.destinationNode&&n.dropPosition=="before"){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}if(n.dropPosition=="after"){if(t(n.dropTarget).parent().attr("data-nodeid")==0){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}if(t(n.dropTarget).find(".treechild").attr("data-nodeid")==0){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}if(t(n.dropTarget).hasClass("k-minus")){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}}if(n.dropPosition=="before"){if(t(n.dropTarget).find(".treechild").attr("data-nodeid")==0){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}if(t(n.dropTarget).hasClass("k-minus")){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}if(t(n.dropTarget).parent().hasClass("imgdivTree")){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}if(t(n.dropTarget).hasClass("VIS-TM-tree-wrap")){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}if(t(n.dropTarget).parent().hasClass("k-bot")&&t(t(t(n.dropTarget).parent()).parent()).parent().attr("role")!="group"){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}if(t(n.dropTarget).parent().hasClass("textdivTree")&&t(n.dropTarget).parent().parent().attr("data-nodeid")==0){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}}if(n.dropPosition=="over"){if(t(n.dropTarget).parent().attr("data-issummary")=="false"){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}if(t(n.dropTarget).find(".treechild").attr("data-nodeid")==0){n.preventDefault();s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");return}}if(s.hasClass("selectchangecolor")&&t(t(this.dragging._draggable.hint)).animate({left:"250px",opacity:"0.5",height:"2px",width:"2px"},1e3),s.removeClass("VIS-TM-ondragdrop"),s.css("display","none"),ht.css("display","none"),!sr.hasClass("k-denied")||s.hasClass("selectchangecolor")){if(f=" SELECT treetype FROM ad_tree WHERE ad_tree_id="+o,f=k(f,null,null),treeType=f.tables[0].rows[0].cells.treetype,tr=treeType=="PR"?"AD_TreeNodePR":treeType=="BP"?"AD_TreeNodeBP":treeType=="MM"?"AD_TreeNodeMM":"AD_TreeNode",l=b.find(".k-state-hover").find(".treechild").attr("data-nodeid"),h=b.find(".k-state-hover").find(".treechild").attr("data-issummary"),h=="true"){rc(o,vu,l);r=t(n.destinationNode);i[0].style.visibility="visible";window.setTimeout(function(){i[0].style.visibility="visible";ls(r);e.val()!=""&&fr(n);au();cs();i[0].style.visibility="hidden"},100);return}if(h=t(n.destinationNode).parent().parent().find(".treechild").attr("data-issummary"),n.sourceNode===n.destinationNode){n.setValid(!1);i[0].style.visibility="hidden";return}if(cs(),rf>0&&window.setTimeout(function(){u.find(".k-state-selected").removeClass("k-state-selected");t(u.find("div").find("div[data-nodeid='"+rf+"']").parent()).addClass("k-state-selected");au()},200),t(n.destinationNode).parent().parent().parent().attr("role")=="tree"){r=t(n.destinationNode);i[0].style.visibility="visible";var v=n.dropPosition,y=n.sourceNode,p=t(t(n.sourceNode.parentElement).parent().find(".k-in")[0]).find(".treechild").attr("data-nodeid");window.setTimeout(function(){var e,h,f,u;if(i[0].style.visibility="visible",e=r.parent().children(),e.length>0){var n=0,c="SELECT seqno FROM "+tr+"  WHERE AD_Tree_ID="+o+" AND node_id="+r.find(".treechild").attr("data-nodeid"),s=k(c,null,null);s.tables[0].rows.length>0&&(n=s.tables[0].rows[0].cells.seqno);v=="after"&&(n=n+1);h="update "+tr+" set seqno=seqno+1,Updated=Sysdate,parent_ID=0 where seqno >="+n+" AND (parent_id=0 or parent_id is null)  AND AD_Tree_ID="+o;eu(h,null,null);f=t(y).find(".treechild").attr("data-nodeid");p>0?(u="update "+tr+" set seqno="+n+",parent_id=0  where node_id="+f+"   AND AD_Tree_ID="+o,eu(u,null,null)):(u="update "+tr+" set seqno="+n+" where node_id="+f+" AND (parent_id=0 or parent_id is null) AND AD_Tree_ID="+o,eu(u,null,null))}i[0].style.visibility="hidden"},600)}else{if(c=t(n.destinationNode),c.length==0){if(wu=t(n.sourceNode).find(".treechild").attr("data-nodeid"),vf=t(n.sourceNode).find(".treechild").parent().parent().parent(),s.hasClass("selectchangecolor"))yl();else{s.removeClass("VIS-TM-ondragdrop");s.css("display","none");ht.css("display","none");i[0].style.visibility="hidden";return}return}var w=n.destinationNode.parentElement,a=n.sourceNode.parentElement,d=n.destinationNode,g=n.sourceNode;i[0].style.visibility="visible";window.setTimeout(function(){var s,f,r,n,e,u;if(i[0].style.visibility="visible",s=t(t(g).find(".treechild").parent().parent().parent().parent().parent()).find("li").find(".k-state-hover").find("div").attr("data-nodeid"),f=c.parent().children(),w==a){if(r=t(a.parentElement).find(".treechild").attr("data-nodeid"),r!=0)for(n=0;n<f.length;n++)e=t(f[n]).find(".treechild").attr("data-nodeid"),u="UPDATE ",u+=tr+" SET Parent_ID="+r+", SeqNo="+n+", Updated=SysDate WHERE AD_Tree_ID="+o+" AND Node_ID="+e,eu(u,null,null)}else if(r=t(d.parentElement).parent().find(".treechild").attr("data-nodeid"),r!=0)for(n=0;n<f.length;n++)e=t(f[n]).find(".treechild").attr("data-nodeid"),u="UPDATE ",u+=tr+" SET Parent_ID="+r+", SeqNo="+n+", Updated=SysDate WHERE AD_Tree_ID="+o+" AND Node_ID="+e,eu(u,null,null);i[0].style.visibility="hidden"},600)}window.setTimeout(function(){e.val()!=""&&fr(n)},300)}}function cs(){u.find(".k-state-selected").length>1&&(u.find(".k-state-selected").removeClass("k-state-selected"),r.empty())}function ls(n){var r=n.parent(),i,f;r.attr("role")=="tree"?(i=n.parent().children().children("ul").children()[n.parent().children().children("ul").children().length-1],i&&r&&(i.remove(),t(t(r.children()[0]).children("ul")).prepend(i))):(n.children("ul")&&(i=n.children("ul").children()),i&&(i=t(i[i.length-1])),i&&i.siblings().length>0&&(f=t(i.siblings()[0]).parent(),u.data("kendoTreeView").detach(i[0]),f.prepend(i[0])))}function rc(r,u,f){i[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"TreeMaintenance/SaveTreeDragDrop",type:"Post",data:{treeID:r,NodeID:u,ParentID:f},success:function(t){var r=JSON.parse(t);r==n.Msg.getMsg("VIS_DataSave");i[0].style.visibility="hidden"},error:function(n){console.log(n);i[0].style.visibility="hidden"}})}function gi(u,f,o,s,c,l,a){d[0].style.visibility="visible";c==null&&(c="");tu();t.ajax({url:n.Application.contextUrl+"TreeMaintenance/GetDataTreeNodeSelect",type:"Post",async:!1,data:{nodeID:u,treeID:f,pageNo:o,pageLength:s,searchChildNode:c,getTreeNodeChkValue:l},success:function(u){var f,s,c;if(hr!=!1){var o=JSON.parse(u),h=null;if(o.length>0){for(d[0].style.visibility="visible",er==!0&&r.empty(),oi=!0,f=0;f<o.length;f++)if((er!=!1||!(r.find("li li").length>0)||(s=r.find('[data-id="'+o[f].parentID+'"]'),!s||!(s.length>0)))&&o[f].parentID!=0)if(c=t('<input class="VIS-tm-checkbox" style="cursor:pointer;float:left; margin-right: 10px;margin-left:0" type="checkbox" />'),o[f].issummary=="Y")continue;else h="<img class=' summNonsumImage ' style='float:left;margin-right:10px;margin-top:3px' src='"+n.Application.contextUrl+"Areas/VIS/Images/mWindow.png'><\/img>",r.append(t('<li class="VIS-tm-topMLi" style="cursor:default;padding:5px 0px">').append(c).append(h).append(t("<li class='VIS-tm-MLi'    data-id='"+o[f].parentID+"' data-issummary='"+o[f].issummary+"' id='"+o[f].parentID+"'   >"+n.Utility.encodeText(o[f].name)+"<\/li>")));fi.css("display","none");vs();fo();tu()}else r.find("li").length>0?(oi=!0,fi.css("display","none")):(oi=!1,fi.css("display","inherit"));fr(a);window.setTimeout(function(){r.find("input:checked").length>0?g.removeClass("vis-tm-delete"):g.addClass("vis-tm-delete")},200);rr();nt.is(":checked")&&(r.find("input").prop("checked",!0),r.find("input").parent().addClass("vis-tm-menuselectedcolor"));r.find("li").length>0?(oi=!0,fi.css("display","none")):(oi=!1,fi.css("display","inherit"));e.prop("disabled",!1);ni.prop("disabled",!1);e.focus();gf=!0;kf=!0;ar.css("display","none");i[0].style.visibility="hidden";su();d[0].style.visibility="hidden"}},error:function(n){ar.css("display","none");oi=!1;console.log(n);r.empty();e.prop("disabled",!1);ni.prop("disabled",!1);e.focus();kf=!0;i[0].style.visibility="hidden";d[0].style.visibility="hidden"}});window.setTimeout(function(){r.find("li").length>0?(oi=!0,fi.css("display","none"),ti.removeClass("vis-tm-delete"),d[0].style.visibility="hidden"):(oi=!1,ti.addClass("vis-tm-delete"))},500);vt.height(ei.height()-(h.height()+60+kr.height()))}function as(){i[0].style.visibility="hidden";th();var u=new n.ChildDialog;u.setEnableResize(!1);u.setTitle(n.Msg.getMsg("UnlinkRecord"));u.setModal(!0);u.setContent(fe);u.show();u.onClose=function(){};u.onOkClick=function(){for(var n=[],u,i=0;i<r.find("input:checked").length;i++)u=t(r.find("input:checked")[i]).parent().find("li").attr("data-id"),n.push(u);r.find("input:checked").length==0&&n.push(hu);bottomchildselectedID=n;n=n.toString();ef(o,n);a.removeClass("VIS-TM-ondragdrop");a.css("display","none")};u.onCancelClick=function(){a.removeClass("VIS-TM-ondragdrop");a.css("display","none")}}function uc(u,f){var o,s,e,h;for(d[0].style.visibility="visible",o=[],s="",e=0;e<r.find("li li").length;e++)h=t(r.find("li li")[e]).attr("data-id"),o.push(h);s=o.toString();t.ajax({url:n.Application.contextUrl+"TreeMaintenance/UpdateItemSeqNo",type:"Post",data:{treeID:f,itemsid:s,ParentID:u},success:function(n){var t=JSON.parse(n)},error:function(n){console.log(n);i[0].style.visibility="visible"}});d[0].style.visibility="hidden"}function dr(){t.ajax({url:n.Application.contextUrl+"TreeMaintenance/TreeTableName",async:!1,data:{treeID:o},success:function(n){var t=JSON.parse(n);nr=t},error:function(n){console.log(n);i[0].style.visibility="hidden"}})}function vs(){t(r.find("li")).draggable({cursorAt:{left:-10,top:-10},helper:function(){var i=t(r.find("li")).find("input:checked").parent(),n;if(i.length===0&&(i=t(this)),n=t("<div/>").attr("id","draggingContainer"),t(r.find("li")).find("input:checked").length==0){if(t(this).hasClass("VIS-tm-topMLi"))return;i=t(this).parent();n=t('<div style="background-color:lightblue;"/>').attr("id","draggingContainer")}return n.append(i.clone()),l=n,l.css("width","250px"),l.css({"z-index":2}),l.css({"max-height":"250px",overflow:"auto"}),l.css({overflow:"hidden"}),n},start:function(){var n,i,r;for(ae=t(this).attr("id"),wr=!0,vi=[],cu=[],n=0;n<t(t(l.find("li li"))).length;n++)i=t(t(l.find("li li"))[n]).attr("id"),cu.push(parseInt(i)),vi.push(i);tu();bo=!1;gr=!0;lu=!1;ys();ci.css("display","inherit");g.css("display","none");a.height(it.height());a.css("margin-top","5px");a.css("background-color","#FFC0CB");a.css("display","inherit");a.mouseover(function(){a.addClass("selectchangecolor");a.css("background-color","#ff0000")});a.mouseleave(function(){a.removeClass("selectchangecolor");a.css("background-color","#FFC0CB")});r=ei.width()-35;it.width(r);ti.css("display","none");vt.css("overflow","hidden")},drag:function(){},stop:function(){var e,f,s,u,r;if(gr=!1,a.hasClass("selectchangecolor"))if(i[0].style.visibility="visible",dr(),e="Select node_id from "+nr+" where parent_id="+hu+" AND isactive='Y' and ad_tree_id="+o+"",f=k(e,null,null),f!=null&&f.tables[0].rows.length==0){if(s=[],vi.length>0)if(ri=="false"){for(u=[],r=0;r<cu.length;r++)t.inArray(cu[r],li)>=0||u.push(cu[r]);u.length>0?ef(o,u.toString()):(n.ADialog.info("NeverDelete",!0,iu),i[0].style.visibility="hidden")}else ef(o,vi.toString());else n.ADialog.info("NeverDelete",!0,iu),i[0].style.visibility="hidden";a.removeClass("VIS-TM-ondragdrop");a.css("display","none");g.css("display","inherit")}else as();a.removeClass("VIS-TM-ondragdrop");a.css("display","none");g.css("display","inherit");it.css("width","100%");vt.css("overflow","auto");ci.css("display","none");ti.css("display","inherit")}})}function yr(r,u,e,o){f.find("li").length==0&&ct.empty();af!=!1&&f.empty();lt[0].style.visibility="visible";e=n.Utility.encodeText(e);e==null&&(e="");ar.css("display","inherit");ci.css("display","inherit");t.ajax({url:n.Application.contextUrl+"TreeMaintenance/LoadMenuData",type:"Post",data:{pageLength:ve,pageNo:bi,treeID:r,searchtext:e,demandsMenu:o},success:function(i){var u=JSON.parse(i),o,s,e,l=t("<span style='margin-left:8px'><\/span>"),r,h,c;if(u){for(r=0;r<u.length;r++)f.find("li li").length>0&&(h=f.find('[data-id="'+u[r].ID+'"]'),h&&h.length>0)||u[r].ID!=0&&(u[r].issummary=="Y"?(u[r].disabled==!0?(e=t('<input class="vis-tm-chkbox" disabled  style="float:left; margin-right: 10px;" type="checkbox" />'),o="<img class='"+u[r].classopacity+" summNonsumImage ' style='float:left;margin-right:10px;margin-top:3px'  src='"+n.Application.contextUrl+"Areas/VIS/Images/summary.png'><\/img>"):(e=t('<input  class="vis-tm-chkbox"  style="cursor:pointer;float:left; margin-right: 10px;" type="checkbox" />'),o="<img class=' summNonsumImage ' style='float:left;margin-right:10px;margin-top:3px'  src='"+n.Application.contextUrl+"Areas/VIS/Images/folder.png'><\/img>"),f.append(t('<li class="vis-tm-upperLi">').append(t("<div class='vis-tm-upperdivchkandimg'>").append(e).append(o)).append(t("<div class='vis-tm-upperdivli'>").append(t("<li class='"+u[r].classopacity+" vis-tm-textli ' checkSummary='checkSummary'  style='cursor:default;color:"+u[r].color+"' id='"+u[r].ID+"' data-id='"+u[r].ID+"'  style='cursor:pointer'  >"+n.Utility.encodeText(u[r].Name)+" ("+n.Utility.encodeText(u[r].description)+")<\/li>").append(t("<span title='"+n.Msg.getMsg("UnlinkNode")+"' style='cursor:pointer;margin-left:8px' class='"+u[r].unlinkClass+"'><\/span>")))))):(u[r].disabled==!0?(e=t('<input  class="vis-tm-chkbox"  disabled  style="float:left; margin-right: 10px;" type="checkbox" />'),s="<img class='"+u[r].classopacity+" summNonsumImage ' style='float:left;margin-right:10px;margin-top:3px' src='"+n.Application.contextUrl+"Areas/VIS/Images/nonSummary.png'><\/img>"):(e=t('<input  class="vis-tm-chkbox"  style="cursor:pointer;float:left; margin-right: 10px;" type="checkbox" />'),s="<img class=' summNonsumImage ' style='float:left;margin-right:10px;margin-top:3px' src='"+n.Application.contextUrl+"Areas/VIS/Images/mWindow.png'><\/img>"),f.append(t('<li class="vis-tm-upperLi">').append(t("<div class='vis-tm-upperdivchkandimg'>").append(e).append(s)).append(t("<div class='vis-tm-upperdivli'>").append(t("<li class='"+u[r].classopacity+" vis-tm-textli ' style='cursor:default;color:"+u[r].color+"' id='"+u[r].ID+"' data-id='"+u[r].ID+"'   style='cursor:pointer'  >"+n.Utility.encodeText(u[r].Name)+" ("+n.Utility.encodeText(u[r].description)+")<\/li>").append(t("<span title='"+n.Msg.getMsg("UnlinkNode")+"'  style='cursor:pointer;margin-left:8px' class='"+u[r].unlinkClass+"'><\/span>")))))));f.find("li").length>0?ou.css("display","none"):ou.css("display","inherit")}else f.find("li").length>0?ou.css("display","none"):ou.css("display","inherit");fc();ws();tt.prop("disabled",!1);ar.css("display","none");ci.css("display","none");ir.css("display","none");lt[0].style.visibility="hidden";c=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());c&&t(f.find("li")).draggable("destroy")},error:function(n){console.log(n);ar.css("display","none");ci.css("display","none");tt.prop("disabled",!1);ir.css("display","none");i[0].style.visibility="hidden";lt[0].style.visibility="hidden"}})}function fc(n){ur=n;t(f.find("li")).draggable({cursorAt:{left:-10,top:-10},helper:function(){var i,n;return l=[],i=t(f.find("input:checked")).parent().parent(),i.length===0&&(i=t(this)),n=t("<div/>"),t(f.find("input:checked")).parent().parent().length==0?t(this).hasClass("vis-tm-textli")?t(this).parent().parent().find("input").attr("disabled")=="disabled"?window.setTimeout(function(){},200):(i=t(this).parent().parent(),n=t('<div style="background-color:lightblue;"/>').attr("id","draggingContainer")):t(this).hasClass("vis-tm-upperLi")&&(t(this).find("input").attr("disabled")=="disabled",n=t('<div style="background-color:lightblue;"/>').attr("id","draggingContainer")):t(this).hasClass("vis-tm-textli")?(t(this).parent().parent().find("input").attr("disabled")=="disabled",n=t('<div style="background-color:lightblue;"/>').attr("id","draggingContainer")):t(this).hasClass("vis-tm-upperLi")&&(t(this).find("input").attr("disabled")=="disabled",n=t("<div/>").attr("id","draggingContainer")),t(this).parent().parent().find("input").attr("disabled")!="disabled"&&t(this).parent().parent().find("input").attr("disabled")!=undefined&&n.append(i.clone()),(t(f.find("input:checked")).length>0||i.find("input").attr("disabled")==undefined)&&!i.hasClass("vis-tm-opacity")&&n.append(i.clone()),l=n,l.css({width:"350px"}),l.css({"z-index":2}),l.find(".vis-tm-upperLi").length>5&&(l.css({"max-height":"250px",overflow:"auto"}),l.css({overflow:"hidden"})),nu=n,n},start:function(){var u,r,i,f,e;if(ci.css("display","inherit"),nu.find("li").length>0&&lr.css("display","inherit"),bo=!0,nu.find(".vis-tm-textli").hasClass("vis-tm-textli")&&(gr=!0),ae=t(this).attr("id"),wr=!1,yu=!0,vi=[],fu=[],lu=!0,l.find(".vis-tm-upperLi").length==0)i=l.find("li").attr("id"),vi.push(i);else for(u=l.find(".vis-tm-upperLi"),r=0;r<u.length;r++)i=t(u.find("li")[r]).attr("id"),vi.push(i),f=t(u[r]).find("img").attr("src"),e=f.substr(f.lastIndexOf("/")+1),e=="mWindow.png"||e=="folder.png"?fu.push("new"):fu.push("update");tu();fo(n);ys()},drag:function(){},stop:function(){vi=[];gr=!1;ci.css("display","none");lr.css("display","none")}})}function tu(){ei.droppable({drop:function(n,r){var f=!0,s,c,h,o,e,l;ke==!1&&(f=!1);t(r.draggable).hasClass("ui-dialog")&&(i[0].style.visibility="hidden",f=!1);u.find("span").hasClass("k-state-hover")||u.find("span").hasClass("k-state-selected")||(i[0].style.visibility="hidden",f=!1);yu=!1;u.find("span").hasClass("k-state-hover")?pu=t(u.find("li").find("span")).parent().find(".k-state-hover").parent().parent():u.find("span").hasClass("k-state-selected")&&(pu=t(u.find("li").find("span")).parent().find(".k-state-selected").parent().parent());u.find("span").hasClass("k-state-hover")?(o=b.find(".k-state-hover").find(".treechild"),yi=o,s=o.attr("data-issummary"),c=o.attr("data-nodeid"),h=o.attr("data-parentid")):u.find("span").hasClass("k-state-selected")&&(e=u.find(".k-state-selected").find(".treechild"),e.parent().css("border","none"),yi=e,c=e.attr("data-nodeid"),s=e.attr("data-issummary"),h=e.attr("data-parentid"));l=[];s=="true"?(lu==!1&&yi.parent().hasClass("k-state-selected")&&(f=!1),df=f,f==!0?(df=f,eo(c,h,vi,wr,fu)):f==!1&&(yu=!0,i[0].style.visibility="hidden")):s!="false"||rt.is(":checked")||(SummaryIDs=t(pu.parent().parent().find(".treechild")[0]).attr("data-nodeid"),yi=t(pu.parent().parent().find(".treechild")[0]),eo(SummaryIDs,h,vi,wr,fu))}})}function ys(){u.data("kendoTreeView").wrapper.find(".k-in").on({mouseenter:function(){gr==!0&&(ke=!0,t(this).hasClass("k-state-selected")&&t(this).css("border","2px solid #bac0cc"))},mouseleave:function(){gr==!0&&t(this).hasClass("k-state-selected")&&t(this).css("border","none");ke=!1}})}function fo(){r.parent().droppable({drop:function(r,f){var o=!0,e;if(yu==!1&&(o=!1),t(f.draggable).hasClass("ui-dialog")&&(i[0].style.visibility="hidden",o=!1),o==!0&&!wr)if(u.find(".k-state-selected").length==1){e=u.find(".k-state-selected").find(".treechild");yi=e;var s=e.attr("data-nodeid"),h=e.attr("data-issummary"),c=e.attr("data-parentid");h=="true"&&nu.find(".vis-tm-textli").hasClass("vis-tm-textli")&&(i[0].style.visibility="visible",eo(s,c,vi,wr,fu))}else nu.find(".vis-tm-textli").hasClass("vis-tm-textli")&&n.ADialog.info("SelectAnySummaryTreeNode");u.find(".k-state-selected").length==0&&nu.find(".vis-tm-textli").hasClass("vis-tm-textli")&&n.ADialog.info("SelectAnySummaryTreeNode")},tolerance:"pointer"})}function eo(s,h,c,a,v){var p=c.toString();p!=""&&(i[0].style.visibility="visible",ct.empty(),v=v.toString(),t.ajax({url:n.Application.contextUrl+"TreeMaintenance/SaveDataOnDrop",type:"Post",data:{summaryid:s,nodid:h,treeID:o,dragMenuNodeID:p,checkMorRdragable:a,IsExistItem:v},success:function(o){var ht=!0,ii=JSON.parse(o),et,dt,ri,v,ot,ct,lt,vt,p,h,w,gt,b,c,bt,ut,g,it,st,ft,ni,ti,kt;if(a)for(et=0;et<l.find("li").find(".VIS-tm-MLi").length;et++)u.find("div").find("div[data-nodeid='"+s+"']").parent().hasClass("k-state-selected")&&lu==!1||(ot=t(l.find("li").find(".VIS-tm-MLi")[et]).attr("id"),t(r.find("li").find("li[data-id='"+ot+"']").parent()).remove());if(ii==n.Msg.getMsg("VIS_DataSave")){if(dt=f.find(".vis-tm-menuselectedcolor"),ri=l.find("li .vis-tm-textli").attr("id"),u.find("div").find("div[data-nodeid='"+s+"']").parent().hasClass("k-state-selected"))for(v=l.find("li li").length-1;v>=0;v--)if(ot=l.find("li li").attr("id"),lu!=!1){if(ct=r.find("input:checked").length,lt=r.find("input").length,ct==lt?ct!=0&&lt!=0?nt.prop("checked",!1):nt.prop("checked",!1):nt.prop("checked",!1),vt=t(l.find("li li")[v]).attr("id"),p=t(l.find("li li")[v]).text(),p=p.substring(0,p.lastIndexOf("(")),h=t(l.find("li li")[v]).parent().parent().find("img").attr("src"),h=h.substring(h.lastIndexOf("/")+1),w=null,h=="nonSummary.png")w="<img class='summNonsumImage' style='float:left;margin-right:10px;margin-top:3px'  src='"+n.Application.contextUrl+"Areas/VIS/Images/mWindow.png'><\/img>";else if(h=="summary.png")w="<img class=' summNonsumImage ' style='float:left;margin-right:10px;margin-top:3px' src='"+n.Application.contextUrl+"Areas/VIS/Images/folder.png'><\/img>";else if(h=="folder.png"){w="<img class=' summNonsumImage ' style='float:left;margin-right:10px;margin-top:3px' src='"+n.Application.contextUrl+"Areas/VIS/Images/folder.png'><\/img>";continue}(h=="mWindow.png"&&(w="<img class='summNonsumImage' style='float:left;margin-right:10px;margin-top:3px'  src='"+n.Application.contextUrl+"Areas/VIS/Images/mWindow.png'><\/img>"),e.val()==""||!y.is(":checked")||p.contains(e.val()))&&(gt=t('<input class="VIS-tm-checkbox" style="cursor:pointer;float:left; margin-right: 10px;margin-left:0" type="checkbox" />'),r.prepend(t('<li class="VIS-tm-topMLi" style="padding:5px 0px">').append(gt).append(w).append(t("<li class='VIS-tm-MLi' data-id='"+vt+"'  id='"+vt+"' style='cursor:default'  >"+n.Utility.encodeText(p)+"<\/li>"))))}for(b=0;b<l.find("li .vis-tm-textli").length;b++){c=t(t(f.find("li"))).find("li[data-id='"+t(l.find(".vis-tm-textli")[b]).attr("data-id")+"']").parent().parent();c.find("input").prop("disabled","true");c.find("input").prop("checked",!1);c.find("img").addClass("vis-tm-opacity");c.find(".vis-tm-textli").addClass("vis-tm-opacity");c.find("input").css("cursor","not-allowed");c.find("span").hasClass("VIS-Tm-glyphiconglyphicon-link")||c.find("span").addClass("VIS-Tm-glyphiconglyphicon-link");tt.val()=="Unlinked"&&c.remove();var yt=t(t(f.find("li"))).find("li[data-id='"+t(l.find(".vis-tm-textli")[b]).attr("data-id")+"']").parent().parent().find("img").attr("src"),pt=t(t(f.find("li"))).find("li[data-id='"+t(l.find(".vis-tm-textli")[b]).attr("data-id")+"']").parent().parent().find("img"),k,h=yt;h!=null&&(h=h.substring(h.lastIndexOf("/")+1),h=="mWindow.png"?k=n.Application.contextUrl+"Areas/VIS/Images/nonSummary.png":h=="folder.png"&&(k=n.Application.contextUrl+"Areas/VIS/Images/summary.png"),pt.attr("src",k));ht=!1}for(bt=0;bt<f.find(".vis-tm-menuselectedcolor").length;bt++)ht=!1;if(ht!=!1&&l.find(".vis-tm-textli").length==1){var ui=t(t(f.find("li"))).find("li[data-id='"+l.find(".vis-tm-textli").attr("data-id")+"']"),yt=t(t(f.find("li"))).find("li[data-id='"+l.find(".vis-tm-textli").attr("data-id")+"']").parent().parent().find("img").attr("src"),pt=t(t(f.find("li"))).find("li[data-id='"+l.find(".vis-tm-textli").attr("data-id")+"']").parent().parent().find("img"),k,h=yt;h!=null&&(h=h.substring(h.lastIndexOf("/")+1),h=="mWindow.png"?k=n.Application.contextUrl+"Areas/VIS/Images/nonSummary.png":h=="folder.png"&&(k=n.Application.contextUrl+"Areas/VIS/Images/summary.png"),pt.attr("src",k))}for(ut=[],g=0;g<l.find(".vis-tm-textli").length;g++)(it=null,st=null,t(l.find(".vis-tm-textli")[g]).attr("checkSummary")=="checkSummary"?(it="true",st="Areas/VIS/Images/folder.png"):(it="false",st="Areas/VIS/Images/mWindow.png"),rt.is(":checked")&&it=="false")||(rt.is(":checked")&&it=="true"&&(wt.css("display","inherit"),at.css("display","none")),rt.is(":checked")||(wt.css("display","inherit"),at.css("display","none")),ft=t(l.find(".vis-tm-textli")[g]).text(),ft=ft.substring(0,ft.lastIndexOf("(")),ni=u.data("kendoTreeView").append({text:n.Utility.encodeText(ft),IsSummary:it,getparentnode:yi.attr("data-nodeid"),TableName:yi.attr("data-tablename"),NodeID:t(l.find(".vis-tm-textli")[g]).attr("id"),TreeParentID:yi.attr("data-nodeid"),ParentID:yi.attr("data-nodeid"),ImageSource:st},yi),ut.push(ni));if(ti=yi.parent().parent().parent(),ut&&ut.length>0)for(kt=ut.length-1;kt>=0;kt--)ls(ti);dt.removeClass("vis-tm-menuselectedcolor");r.find("li").length>0&&(fi.css("display","none"),d[0].style.visibility="hidden")}vs();rr();window.setTimeout(function(){e.val()!=""&&fr(he)},200);ff();or=!0;i[0].style.visibility="hidden"},error:function(n){console.log(n);i[0].style.visibility="hidden"}}))}function sc(){w.on("change",ea);rt.on("click",ha);pf.on("scroll",sa);f.on("click",ra);r.on("click",ia);e.on("keyup",fr);e.on("keypress",dl);ni.on("click",ta);e.on("input",function(n){if(""==this.value){u.find("span").removeClass("VIS-TM-highlight");ft=1;st=50;v=e.val();c=y.is(":checked")?"true":"false";var t=u.find(".k-state-selected").find(".treechild").attr("data-nodeid");gi(t,o,ft,st,v,c,n)}});ii.on("input",function(){""==this.value&&w.val()!=""&&(f.empty(),window.setTimeout(function(){f.empty();yt="";pt=tt.val();bi=1;yr(o,dt,yt,pt)},200))});to.on("click",bl);no.on("click",oe);us.on("click",pl);ii.on("keyup",wl);h.on("resize",vl);h.find(".ui-resizable-e").css("right","0px");h.find(".ui-resizable-s").css("bottom","0px");ll();g.on("click",cl);tt.on("change",al);s.mouseover(function(){s.addClass("selectchangecolor");s.css("background-color","#ff0000")});s.mouseleave(function(){s.removeClass("selectchangecolor");s.css("background-color","#FFC0CB")});vt.on("scroll",hl);window.setTimeout(function(){e.width(cr.width()-(ki.width()+40+ni.width()))},200);y.is(":checked")&&(uu=-1);y.on("click",function(n){c=y.is(":checked")?"true":"false";fr(n)});nt.on("click",fl);wt.on("click",ul);at.on("click",rl);ti.on("click",gc);et.on("click",ws);di.on("click",bc);vr.on("click",wc);rs.on("click",pc);lr.mouseover(function(){lr.css({cursor:"not-allowed"})});lr.mouseleave(function(){lr.css({cursor:"default"})});wf.on("click",yc);pi.on("click",lc)}function hc(){var i,r,c,l,a,v,u,t,s;wi=[];i="SELECT ad_table_id FROM ad_tree WHERE ad_tree_id="+o;i=k(i,null,null);i.tables[0].rows.length>0&&(i=i.tables[0].rows[0].cells.ad_table_id);r="SELECT tablename FROM ad_table WHERE ad_table_id="+i;r=k(r,null,null);r.tables[0].rows.length>0&&(r=r.tables[0].rows[0].cells.tablename);ri="true";r=="AD_Menu"&&(c="SELECT count(*) FROM AD_Role WHERE ad_tree_menu_id="+o,l=yf(c),l>0?ri="false":(a="SELECT count(*) FROM AD_ClientInfo WHERE ad_tree_menu_id="+o,v=yf(a),v>0&&(ri="false")));var f=k("SELECT ad_menu_id FROM AD_Menu WHERE ad_form_id IN (SELECT ad_form_id FROM ad_form WHERE name IN ('Tree Maintenance'))",null,null);if(f!=null&&f.tables[0].rows.length>0)for(t=0;t<f.tables[0].rows.length;t++)wi.push(f.tables[0].rows[t].cells.ad_menu_id);if(u=k("SELECT ad_menu_id FROM AD_Menu WHERE ad_window_id IN (SELECT ad_window_id FROM ad_window WHERE name IN ('Role','Tenant','Tree'))",null,null),u!=null&&u.tables[0].rows.length>0)for(t=0;t<u.tables[0].rows.length;t++)wi.push(u.tables[0].rows[t].cells.ad_menu_id);li=wi;wi=wi.toString();var y="SELECT name FROM ad_menu WHERE ad_menu_id IN("+wi+") ORDER BY upper(name)",e=k(y,null,null),h="";if(e!=null&&e.tables[0].rows.length>0)for(s=0;s<e.tables[0].rows.length;s++)h+=e.tables[0].rows[s].cells.name,h+=",";iu=h+" "+n.Msg.getMsg("MenuBinded");d[0].style.visibility="hidden"}function cc(n){var i,t,r;dr();i="SELECT MAX(seqno) FROM "+nr+" WHERE AD_Tree_ID="+o;t=yf(i);t+=1;r="update "+nr+" set seqno="+t+",Updated=Sysdate,parent_ID=0 WHERE AD_Tree_ID="+o+" AND node_id="+n;eu(r,null,null)}function lc(){}function ac(){if(w.val()!=""){if(t(this).find("span").hasClass("vis-tm-delete"))return;n.ADialog.confirm("RemoveUnlinkedItem",!0,"","Confirm",function(n){if(n){vc();wt.css("display","none");at.css("display","inherit");var t=w.find("option:selected").text();ui.text(t);or=!1}else return})}}function vc(){i[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"TreeMaintenance/RemoveLinkedItemFromTree",type:"Post",data:{treeID:o,menuId:wi},success:function(t){var r=JSON.parse(t);r=="count"?(f.empty(),yt=ii.val(),pt=tt.val(),bi=1,yr(o,dt,yt,pt),window.setTimeout(function(){oe();window.setTimeout(function(){or=!1;i[0].style.visibility="hidden"},200)},200)):r=="menubind"&&(i[0].style.visibility="hidden",n.ADialog.info("NeverDelete",!0,iu))},error:function(n){console.log(n);i[0].style.visibility="hidden"}})}function yc(){if(w.val()!=""){var f=t('<ul class="vis-apanel-tm-ul"><\/ul>'),u=t("<div>"),i=t('<div style="padding:0 8px 0 5px;min-width:150px">'),r=t('<span class="VIS-Tm-glyphiconglyphicon-link" style="float:left;margin-right:6px" ><\/span>');ne=t('<p style="line-height:19px;cursor:pointer;float:left;margin-left: 4px;margin-bottom: 8px;">'+n.Msg.getMsg("RemoveLinkedItem")+"<\/p>").append(r);u.append(i);i.append(t('<div style="margin-top: 7px;" ><\/div>').append(pi).append(dh));i.append(t('<div style="float: left;margin-bottom: 6px;margin-top: 15px;width:100%" ><\/div>').append(ne));t(this).w2overlay(u);or==!0?r.removeClass("vis-tm-delete"):r.addClass("vis-tm-delete");ne.on("click",ac)}}function ff(n){if(u.find("span").hasClass("k-state-selected")&&vt.find("ul").height()<vt.height()){ft=1;st=50;v=y.is(":checked")?e.val():"";c=y.is(":checked")?"true":"false";er=!1;var t=u.find(".k-state-selected").find(".treechild").attr("data-nodeid");gi(t,o,ft,st,v,c,n)}}function te(){et.prop("checked",!1)}function pc(){var i=yf("SELECT AD_Window_ID FROM AD_Window WHERE Name='Tree'"),t=new n.Query;t.addRestriction("AD_Tree_ID",n.Query.prototype.EQUAL,o);n.viewManager.startWindow(i,t)}function wc(){vr.css("display","none");ii.val("");w.val()!=""&&(f.empty(),window.setTimeout(function(){f.empty();yt="";pt=tt.val();bi=1;yr(o,dt,yt,pt)},200))}function bc(n){e.val("");e.focus();di.css("display","none");u.find("span").removeClass("VIS-TM-highlight");ft=1;st=50;v=e.val();c=y.is(":checked")?"true":"false";er=!0;var t=u.find(".k-state-selected").find(".treechild").attr("data-nodeid");w.val()!=""&&gi(t,o,ft,st,v,c,n)}function ws(n){if(ur=n,et.is(":checked")){lt[0].style.visibility="visible";pe=!1;for(var i=0;i<f.find("input").length;i++)t(f.find("input")[i]).attr("disabled")=="disabled"&&t(f.find("input")[i]).parent().parent().removeClass("vis-tm-menuselectedcolor"),t(f.find("input")[i]).attr("disabled")!="disabled"&&(t(f.find("input")[i]).prop("checked",!0),t(f.find("input")[i]).parent().parent().addClass("vis-tm-menuselectedcolor"));lt[0].style.visibility="hidden"}else pe==!1&&(lt[0].style.visibility="visible",f.find("input").prop("checked",!1),f.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"),lt[0].style.visibility="hidden")}function kc(n){t(n.target).hasClass("VIS-tm-MLi")&&(t(this).find("li").removeClass("vis-tm-menuselectedcolor"),t(this).find("li").find("input").prop("checked",!1),t(n.target).parent().addClass("vis-tm-menuselectedcolor"),t(n.target).parent().find("input").prop("checked",!0),nt.prop("checked",!1));t(n.target).hasClass(" summNonsumImage ")&&(t(this).find("li").removeClass("vis-tm-menuselectedcolor"),t(this).find("li").find("input").prop("checked",!1),t(n.target).parent().addClass("vis-tm-menuselectedcolor"),t(n.target).parent().find("input").prop("checked",!0),nt.prop("checked",!1));t(n.target).hasClass("VIS-tm-checkbox")&&(t(n.target).parent().find("input").prop("checked")?t(n.target).parent().addClass("vis-tm-menuselectedcolor"):(t(n.target).parent().removeClass("vis-tm-menuselectedcolor"),t(n.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"),nt.prop("checked",!1)))}function dc(n){v="";var r=t(n.currentTarget);r[0].scrollHeight-r.scrollTop()==r.outerHeight()&&(ie=!1,re+=1,i[0].style.visibility="visible",ds(br,o,re,oo,v,c,n))}function gc(f){var h,s;if(i[0].style.visibility="visible",w.val()!=""&&(e.prop("disabled",!1),ni.prop("disabled",!1)),hr=!1,oi==!1){hr=!0;ti.addClass("vis-tm-delete");i[0].style.visibility="hidden";return}if(u.find(".k-state-selected").length==0){i[0].style.visibility="hidden";hr=!0;return}if(w.val()==""){i[0].style.visibility="hidden";hr=!0;return}nl();ie=!0;re=1;oo=50;v="";c="false";h=u.find(".k-state-selected").find(".treechild").attr("data-nodeid");i[0].style.visibility="visible";window.setTimeout(function(){ds(h,o,re,oo,v,c,f)},200);bt.on("click",kc);ks.on("scroll",dc);s=new n.ChildDialog;s.setHeight(550);s.setWidth(450);s.setEnableResize(!1);s.setTitle(n.Msg.getMsg("SetOrder"));s.setModal(!0);s.setContent(bs);bt.empty();s.show();s.onClose=function(){ru=!0};s.onOkClick=function(i){var s,f,p;if(ue==!1){ue=!0;ru=!0;d[0].style.visibility="visible";s=u.find(".k-state-selected").find(".treechild").attr("data-nodeid");so=s;var h=u.find(".k-state-selected").find(".treechild").attr("data-nodeid"),l=[],a="";for(f=0;f<bt.find("li li").length;f++)p=t(bt.find("li li")[f]).attr("data-id"),l.push(p);a=l.toString();t.ajax({url:n.Application.contextUrl+"TreeMaintenance/UpdateItemSeqNo",type:"Post",data:{treeID:o,itemsid:a,ParentID:h},success:function(n){var t=JSON.parse(n);oe();r.empty();ft=1;st=50;v=y.is(":checked")?e.val():"";c=y.is(":checked")?"true":"false";er=!0;gi(h,o,ft,st,v,c,i);wt.css("display","inherit");at.css("display","none")},error:function(n){console.log(n);d[0].style.visibility="hidden"}})}v=y.is(":checked")?e.val():"";c=y.is(":checked")?"true":"false";hr=!0};s.onCancelClick=function(){i[0].style.visibility="hidden";v=y.is(":checked")?e.val():"";c=y.is(":checked")?"true":"false";ue=!0;hr=!0;ru=!1}}function nl(){bs.append(ks.append(bt))}function ds(r,u,f,e,o,s){o==null&&(o="");ie==!0&&bt.empty();tu();t.ajax({url:n.Application.contextUrl+"TreeMaintenance/FillSequenceDailog",type:"Post",data:{nodeID:r,treeID:u,pageNo:f,pageLength:e,searchChildNode:o,getTreeNodeChkValue:s},success:function(r){var u,o,s,e;i[0].style.visibility="visible";var f=JSON.parse(r),h=null,c=null;if(f.length>0)for(u=0;u<f.length;u++)er==!1&&bt.find("li li").length>0&&(o=bt.find('[data-id="'+f[u].parentID+'"]'),o&&o.length>0)||f[u].parentID!=0&&(s=t('<input class="VIS-tm-checkbox" style="cursor:pointer;float:left; margin-right: 10px;margin-left:0" type="checkbox" />'),f[u].issummary=="Y"?(h="<img class='summNonsumImage' style='float:left;margin-right:10px;margin-top:3px'  src='"+n.Application.contextUrl+"Areas/VIS/Images/folder.png'><\/img>",bt.append(t('<li class="VIS-tm-topMLi" style="cursor:default;padding:5px 0px">').append(s).append(h).append(t("<li class='VIS-tm-MLi' data-NodePID='"+f[u].NodeParentID+"' data-id='"+f[u].parentID+"' data-issummary='"+f[u].issummary+"' id='"+f[u].parentID+"'   >"+n.Utility.encodeText(f[u].name)+"<\/li>")))):(c="<img class=' summNonsumImage ' style='float:left;margin-right:10px;margin-top:3px' src='"+n.Application.contextUrl+"Areas/VIS/Images/mWindow.png'><\/img>",e=t('<li class="VIS-tm-topMLi" style="cursor:default;padding:5px 0px">'),e.append(s),e.append(c),e.append(t("<li class='VIS-tm-MLi'  data-NodePID='"+f[u].NodeParentID+"'  data-id='"+f[u].parentID+"' data-issummary='"+f[u].issummary+"' id='"+f[u].parentID+"'   >"+n.Utility.encodeText(f[u].name)+"<\/li>")),bt.append(e)));il();bt.sortable("refresh");window.setTimeout(function(){i[0].style.visibility="hidden"},500)},error:function(n){console.log(n);bt.empty();i[0].style.visibility="hidden"}})}function il(){var n=null;bt.sortable({cursorAt:{left:-10,top:-10},helper:function(i,r){n=t("<li />");r.hasClass("vis-tm-menuselectedcolor")||r.addClass("vis-tm-menuselectedcolor").siblings().removeClass("vis-tm-menuselectedcolor");var u=r.parent().children(".vis-tm-menuselectedcolor").clone();return gs=r.data("multidrag",u).siblings(".vis-tm-menuselectedcolor"),r.data("multidrag",u).siblings(".vis-tm-menuselectedcolor").hide(),tl=n.append(u),n.append(u)},start:function(n,i){ue=!1;bt.find("input").prop("checked",!1);hu=i.item.find("li").attr("id");t(this).parent().parent().parent().css("overflow","hidden")},change:function(){},update:function(){},stop:function(n,t){t.item.after(t.item.data("multidrag")).remove();window.setTimeout(function(){gs.remove()},100);bt.find("input").prop("checked",!1);bt.find(".vis-tm-menuselectedcolor").find("input").prop("checked",!0)}})}function rl(){w.val()!=""&&u.find("li").length>1&&(ot[0].style.visibility="visible",window.setTimeout(function(){at.css("display","none");wt.css("display","inherit");wt.css("float","right");b.data("kendoTreeView").expand(".k-item");ot[0].style.visibility="hidden"},150))}function ul(){w.val()!=""&&(ot[0].style.visibility="visible",window.setTimeout(function(){at.css("display","inherit");wt.css("display","none");at.css("float","right");b.data("kendoTreeView").collapse(".k-item");ot[0].style.visibility="hidden"},150))}function fl(){nt.is(":checked")?(r.find("input").prop("checked",!0),r.find("li").addClass("vis-tm-menuselectedcolor"),g.removeClass("vis-tm-delete"),r.find("input:checked").length==0&&g.addClass("vis-tm-delete")):(r.find("input").prop("checked",!1),r.find("li").removeClass("vis-tm-menuselectedcolor"),g.addClass("vis-tm-delete"))}function hl(n){v=e.val();var i=t(n.currentTarget);el=i[0].scrollHeight;ol=i.scrollTop();sl=i.outerHeight();i[0].scrollHeight-i.scrollTop()-10==i.outerHeight()-10&&r.find("li").length>0&&(ft+=1,er=!1,d[0].style.visibility="visible",gi(br,o,ft,st,v,c,n),d[0].style.visibility="hidden",r.find("li").length>0&&(fi.css("display","none"),d[0].style.visibility="hidden"))}function cl(){kt=[];r.find("input:checked").length>0&&n.ADialog.confirm("DoYouWantToUnlink",!0,"","Confirm",function(u){if(u)i[0].style.visibility="visible",window.setTimeout(function(){for(var e=[],f,u=0;u<r.find("input:checked").length;u++)(f=t(r.find("input:checked")[u]).parent().find("li").attr("data-id"),ri=="false"&&t.inArray(parseInt(f),li)>=0)||(kt.push(f),e.push(parseInt(f)));bottomchildselectedID=kt;kt=kt.toString();kt.length>0?ef(o,kt):(n.ADialog.info("NeverDelete",!0,iu),i[0].style.visibility="hidden")},200);else{i[0].style.visibility="hidden";return}});i[0].style.visibility="hidden"}function ef(e,o){var s,h,c,l;i[0].style.visibility="visible";s="SELECT ad_table_id FROM ad_tree WHERE ad_tree_id="+e;s=k(s,null,null);s.tables[0].rows.length>0&&(s=s.tables[0].rows[0].cells.ad_table_id);h=" SELECT treetype FROM ad_tree WHERE ad_tree_id="+e;h=k(h,null,null);treeType=h.tables[0].rows[0].cells.treetype;c="";c=treeType=="PR"?"AD_TreeNodePR":treeType=="BP"?"AD_TreeNodeBP":treeType=="MM"?"AD_TreeNodeMM":"AD_TreeNode";ut=[];l="";r.find("input:checked").length>0&&(o=o.toString(),of(c,o,e));r.find("input:checked").length==0&&of(c,o,e);t.ajax({url:n.Application.contextUrl+"TreeMaintenance/DeleteNodeFromBottom",type:"Post",data:{nodeid:o,treeID:e,menuArray:wi},success:function(e){var et=JSON.parse(e),rt,b,c,h,v,a,k,d,w,it;if(et==""){for(nt.prop("checked",!1),rt=!0,h=0;h<r.find("input:checked").length;h++)if(rt=!1,ri!="false"||(w=t(r.find("input:checked").parent().find("li")[h]).attr("data-id"),!(t.inArray(parseInt(w),li)>=0))){b=o.toString();b=b.split(",");c=f.find("li").find("li[data-id='"+b[h]+"']").parent().parent();c.find("input").prop("disabled",!1);c.find("img").removeClass("vis-tm-opacity");c.find(".vis-tm-textli").removeClass("vis-tm-opacity");c.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link");c.find("input").css("cursor","pointer");c.hasClass("vis-tm-menuselectedcolor")&&(ct.empty(),c.find("input").prop("checked",!0));tt.val()=="Linked"&&c.remove();var ft=t(r.find("input:checked").parent().find(".VIS-tm-MLi")[h]).attr("data-id"),p=t(t(f.find("li"))).find("li[data-id='"+ft+"']").parent().parent().find("img").attr("src"),y=t(t(f.find("li"))).find("li[data-id='"+ft+"']").parent().parent().find("img"),l,s=p;if(s!=null)if(s=s.substring(s.lastIndexOf("/")+1),s=="nonSummary.png")l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png",y.attr("src",l);else if(s=="summary.png")for(l=n.Application.contextUrl+"Areas/VIS/Images/folder.png",y.attr("src",l),ch(ft),u.data("kendoTreeView").remove(u.find("div").find("div[data-nodeid='"+bottomchildselectedID[h]+"']").parent().parent().parent()),h=0;h<ut.length;h++){v=ut[h];u.data("kendoTreeView").remove(u.find("div").find("div[data-nodeid='"+v+"']").parent().parent().parent());t(r.find("input:checked")[h]).parent().remove();a=t(t(f.find("li"))).find("li[data-id='"+v+"']").parent().parent();a.find("input").prop("disabled",!1);a.removeClass("vis-tm-menuselectedcolor");a.find("img").removeClass("vis-tm-opacity");a.find(".vis-tm-textli").removeClass("vis-tm-opacity");a.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link");a.find("input").css("cursor","pointer");var p=t(t(f.find("li"))).find("li[data-id='"+v+"']").parent().parent().find("img").attr("src"),y=t(t(f.find("li"))).find("li[data-id='"+v+"']").parent().parent().find("img"),l,s=p;s!=null&&(s=s.substring(s.lastIndexOf("/")+1),s=="nonSummary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png":s=="summary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/folder.png":s=="mWindow.png"?l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png":s=="folder.png"&&(l=n.Application.contextUrl+"Areas/VIS/Images/folder.png"));y.attr("src",l)}}if(rt==!0&&r.find("input:checked").length==0){c=f.find("li").find("li[data-id='"+ut+"']").parent().parent();c.find("input").prop("disabled",!1);c.find("img").removeClass("vis-tm-opacity");c.find(".vis-tm-textli").removeClass("vis-tm-opacity");c.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link");c.find("input").css("cursor","pointer");c.hasClass("vis-tm-menuselectedcolor")&&(ct.empty(),c.find("input").prop("checked",!0));tt.val()=="Linked"&&c.remove();var p=t(t(f.find("li"))).find("li[data-id='"+ut+"']").parent().parent().find("img").attr("src"),y=t(t(f.find("li"))).find("li[data-id='"+ut+"']").parent().parent().find("img"),l,s=p;if(s!=null)if(s=s.substring(s.lastIndexOf("/")+1),s=="nonSummary.png")l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png",y.attr("src",l);else if(s=="summary.png")for(l=n.Application.contextUrl+"Areas/VIS/Images/folder.png",y.attr("src",l),ch(ut),u.data("kendoTreeView").remove(u.find("div").find("div[data-nodeid='"+ut+"']").parent().parent().parent()),h=0;h<ut.length;h++){v=ut[h];u.data("kendoTreeView").remove(u.find("div").find("div[data-nodeid='"+v+"']").parent().parent().parent());t(r.find("input:checked")[h]).parent().remove();a=t(t(f.find("li"))).find("li[data-id='"+v+"']").parent().parent();a.find("input").prop("disabled",!1);a.removeClass("vis-tm-menuselectedcolor");a.find("img").removeClass("vis-tm-opacity");a.find(".vis-tm-textli").removeClass("vis-tm-opacity");a.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link");a.find("input").css("cursor","pointer");var p=t(t(f.find("li"))).find("li[data-id='"+v+"']").parent().parent().find("img").attr("src"),y=t(t(f.find("li"))).find("li[data-id='"+v+"']").parent().parent().find("img"),l,s=p;s!=null&&(s=s.substring(s.lastIndexOf("/")+1),s=="nonSummary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png":s=="summary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/folder.png":s=="mWindow.png"?l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png":s=="folder.png"&&(l=n.Application.contextUrl+"Areas/VIS/Images/folder.png"));y.attr("src",l)}r.find("li").find("li[data-id='"+ut+"']").parent().remove();u.data("kendoTreeView").remove(u.find("div").find("div[data-nodeid='"+ut+"']").parent().parent().parent())}for(g.addClass("vis-tm-delete"),k=[],d=0;d<r.find("input:checked").length;d++)(w=t(r.find("input:checked").parent().find("li")[d]).attr("data-id"),ri=="false"&&t.inArray(parseInt(w),li)>=0)||k.push(w);for(it=0;it<k.length;it++)r.find("li").find("li[data-id='"+k[it]+"']").parent().remove();r.find("input:checked").length>0&&n.ADialog.info("NeverDelete");ff()}rr();te();su();i[0].style.visibility="hidden"},error:function(n){console.log(n);i[0].style.visibility="hidden"}});rr()}function rr(){r.find("input").length==0?(nt.prop("disabled",!0),nt.css("cursor","not-allowed"),nt.prop("checked",!1),g.addClass("vis-tm-delete"),ti.addClass("vis-tm-delete"),oi=!1):(ti.removeClass("vis-tm-delete"),oi=!0,nt.prop("disabled",!1),nt.css("cursor","pointer"))}function ll(){var i=""+n.Msg.getMsg("All")+"",r=""+n.Msg.getMsg("Linked")+"",u=""+n.Msg.getMsg("UnLinked")+"";tt.append(t("<Option value='All'>"+i+"<\/option>"));tt.append(t("<Option value='Linked'>"+r+"<\/option>"));tt.append(t("<Option value='Unlinked'>"+u+"<\/option>"))}function al(){w.val()!=""&&(ct.empty(),f.empty(),pt=tt.val(),window.setTimeout(function(){tt.prop("disabled",!0);ir.css("display","inherit");af=!1;pt=tt.val();yt=ii.val();bi=1;yr(o,dt,yt,pt)},200))}function vl(n,t){var i=t.size.height;h.css("height",i);h.css("overflow-x","none");h.css("width","100%");window.setTimeout(function(){vt.height(ei.height()-(h.height()+kr.height()+45))},200);it.css("overflow","hidden");it.height(ei.height()-h.height());a.height(it.height()-10);gt.height(i-10);h.addClass("VIS-TM-resizediv");gt.addClass("VIS-TM-resizediv")}function th(){fe=t("<div>");nh=t('<input style="margin-right: 10px;" type="checkbox"/>');var r=t("<span>"+n.Msg.getMsg("WantToUnlinked")+"<span/>"),i=t('<span style="font-size: 16px;">'+n.Msg.getMsg("UnlinkedWithChild")+"<span/>");fe.append(t('<div style="padding: 10px;">').append(i))}function yl(r){ur=r;dr();var f="Select node_id from "+nr+" where parent_id="+vu+" AND isactive='Y' and ad_tree_id="+o+"",u=k(f,null,null);if(u!=null&&u.tables[0].rows.length==0){if(bu=!0,s.removeClass("VIS-TM-ondragdrop"),s.css("display","none"),ht.css("display","none"),ri=="false"){if(t.inArray(parseInt(wu),li)>=0){n.ADialog.info("NeverDelete",!0,iu);return}ho(o,wu,vf,bu)}else ho(o,wu,vf,bu);return}i[0].style.visibility="hidden";th();n.ADialog.confirm("ChildAlsoWillbeRemove",!0,"","Confirm",function(n){n?(bu=!0,ho(o,wu,vf,bu),s.removeClass("VIS-TM-ondragdrop"),s.css("display","none"),ht.css("display","none")):(s.removeClass("VIS-TM-ondragdrop"),s.css("display","none"),ht.css("display","none"))})}function ho(e,o,s,h){var c,l,v,a,y;o!=0?(ih=!1,i[0].style.visibility="visible",c="SELECT ad_table_id FROM ad_tree WHERE ad_tree_id="+e,c=k(c,null,null),c.tables[0].rows.length>0&&(c=c.tables[0].rows[0].cells.ad_table_id),l="SELECT tablename FROM ad_table WHERE ad_table_id="+c,l=k(l,null,null),l.tables[0].rows.length>0&&(l=l.tables[0].rows[0].cells.tablename),v=" SELECT treetype FROM ad_tree WHERE ad_tree_id="+e,v=k(v,null,null),treeType=v.tables[0].rows[0].cells.treetype,a="",a=treeType=="PR"?"AD_TreeNodePR":treeType=="BP"?"AD_TreeNodeBP":treeType=="MM"?"AD_TreeNodeMM":"AD_TreeNode",kt=o.toString(),of(a,kt,e),y="select parent_ID  from "+a+" WHERE NODE_ID="+o+" AND AD_Tree_ID="+e+" AND IsActive='Y'",y=k(y,null,null),t.ajax({url:n.Application.contextUrl+"TreeMaintenance/DeleteNodeFromTree",type:"Post",data:{nodeid:o,treeID:e,unlinkchild:h,menuArray:wi},success:function(e){var k=JSON.parse(e),p,v,s,g,d;if(k==""){r.find("input:checked").length==0&&nt.prop("checked",!1);ah=k;r.find("li").find("li[data-id='"+o+"']").parent().remove();s=f.find("li").find("li[data-id='"+o+"']").parent().parent();s.find("input").prop("disabled",!1);s.find("img").removeClass("vis-tm-opacity");s.find(".vis-tm-textli").removeClass("vis-tm-opacity");s.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link");s.find("input").css("cursor","pointer");s.hasClass("vis-tm-menuselectedcolor")&&(ct.empty(),s.find("input").prop("checked",!0));var w=t(t(f.find("li"))).find("li[data-id='"+o+"']").parent().parent().find("img").attr("src"),b=t(t(f.find("li"))).find("li[data-id='"+o+"']").parent().parent().find("img"),l,c=w;if(c!=null&&(c=c.substring(c.lastIndexOf("/")+1),c=="nonSummary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png":c=="summary.png"&&(l=n.Application.contextUrl+"Areas/VIS/Images/folder.png"),b.attr("src",l)),rh=a,h==!0)for(ri=="false"&&uh(),u.data("kendoTreeView").remove(ss),p=0;p<ut.length;p++)if(v=ut[p],r.find("li").find("li[data-id='"+v+"']").parent().remove(),ri!="false"||!(t.inArray(parseInt(v),li)>=0)){s=f.find("li").find("li[data-id='"+v+"']").parent().parent();s.find("input").prop("disabled",!1);s.find("img").removeClass("vis-tm-opacity");s.find(".vis-tm-textli").removeClass("vis-tm-opacity");s.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link");s.find("input").css("cursor","pointer");s.hasClass("vis-tm-menuselectedcolor")&&(s.find("input").prop("checked",!0),ct.empty());tt.val()=="Linked"&&s.remove();var w=t(t(f.find("li"))).find("li[data-id='"+v+"']").parent().parent().find("img").attr("src"),b=t(t(f.find("li"))).find("li[data-id='"+v+"']").parent().parent().find("img"),l,c=w;c!=null&&(c=c.substring(c.lastIndexOf("/")+1),c=="nonSummary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png":c=="summary.png"&&(l=n.Application.contextUrl+"Areas/VIS/Images/folder.png"),b.attr("src",l))}h==!1&&(g=null,d=y.tables[0].rows[0].cells.parent_id,yi=u.find("div").find("div[data-nodeid='"+d+"']"));ff()}wo.find("span").hasClass("k-state-selected")&&ui.text(n.Msg.getMsg("SelectTree"));rr();te();su();i[0].style.visibility="hidden"},error:function(n){console.log(n);i[0].style.visibility="hidden"}})):n.ADialog.info("VIS_SelectTreeNode")}function uh(){for(var r=[],s,i,f,h,o=0;o<ee.length;o++)s=ee[o],r.push(parseInt(s));for(i=0;i<r.length;i++)t.inArray(r[i],li)>=0&&(cc(r[i]),f=u.find("div").find("div[data-nodeid='"+r[i]+"']").parent().parent().parent(),u.find("div").find("div[data-nodeid='"+r[i]+"']").parent().parent().parent().remove(),rt.is(":checked")||(h=u.data("kendoTreeView").append({text:n.Utility.encodeText(f.text()),IsSummary:f.find(".treechild").attr("data-issummary"),getparentnode:0,TableName:f.find(".treechild").attr("data-tablename"),NodeID:f.find(".treechild").attr("data-nodeid"),TreeParentID:f.find(".treechild").attr("data-nodeid"),ParentID:0,ImageSource:"Areas/VIS/Images/mWindow.png"},t(t(u.find(".treechild")[0])))));e.val()!=""&&window.setTimeout(function(){fr(he)},200)}function of(r,u,f){i[0].style.visibility="visible";t.ajax({url:n.Application.contextUrl+"TreeMaintenance/SelectAllChildNodes",type:"Post",async:!1,data:{TableName:r,treeID:f,nodeID:u},success:function(n){i[0].style.visibility="visible";var t=JSON.parse(n);ut=[];t!=null&&(ut=t.split(","),ee=ut)},error:function(n){console.log(n);i[0].style.visibility="hidden"}})}function pl(){w.val()!=""&&(f.empty(),yt=ii.val(),pt=tt.val(),bi=1,yr(o,dt,yt,pt))}function wl(n){n.which!=13&&n.which!=8&&n.which!=46&&vr.css("display","inherit");(n.which==8||n.which==46)&&ii.val()==""&&vr.css("display","none");n.which==13&&w.val()!=""&&(f.empty(),yt=ii.val(),pt=tt.val(),bi=1,yr(o,dt,yt,pt))}function bl(t){w.val()!=""&&ir.css("display","inherit");ur=t;w.empty();es();ru=!1;oe();ti.addClass("vis-tm-delete");wt.css("display","none");at.css("display","inherit");at.css("float","right");ui.text(n.Msg.getMsg("SelectTree"));rr()}function oe(){r.empty();ps=!1;w.val()!=""&&(rt.is(":checked")?(si=!0,hi!=null&&tf(dt,o,pr,si)):(si=!1,hi!=null&&tf(dt,o,pr,si)));it.css("overflow","hidden")}function dl(n){if(gf=!0,n.which==13){if(e.val()!=""&&rt.is(":checked")&&(e.prop("disabled",!0),ni.prop("disabled",!0)),c=="true"&&u.find(".k-state-selected").length==1){ft=1;st=50;c=y.is(":checked")?"true":"false";var f=u.find(".k-state-selected").find("div").attr("data-nodeid");v=e.val();r.empty();gi(f,o,ft,st,v,c,n)}e.val()!=""&&w.val()!=""&&(g.removeClass("vis-tm-delete"),i[0].style.visibility="visible",b.find("span.k-in").find(".treechild").find("p").each(function(){var u=t(this).text().toUpperCase(),r;if(u==e.val().toUpperCase()){n.preventDefault();r=t(this).parent().parent().parent().parent().parent().attr("class");b.data("kendoTreeView").expand("."+r);b.find("span").removeClass("k-state-selected");t(this).parent().parent().parent().addClass("k-state-selected");this.parentNode.parentNode.parentNode.scrollIntoView();i[0].style.visibility="hidden";return}}),sh(n),g.addClass("vis-tm-delete"),i[0].style.visibility="hidden")}else uu=-1}function sh(n){if(rt.is(":checked")&&(e.prop("disabled",!0),ni.prop("disabled",!0)),fh=sf,eh=e.val(),se=hh(fh,eh,uu),se>-1){var t=hf[se];currentNode=t;uu=se;gl(t,n)}else oh=!1,e.val()!=""&&(e.prop("disabled",!1),ni.prop("disabled",!1))}function hh(n,t,i){for(var r=i+1;r<n.length;r++)if(r!=-1&&n[r].trim().toLowerCase().contains(t.trim().toLowerCase()))return r;return i>-1?(i=-1,hh(n,t,i)):-1}function gl(n,t){return n!=-1?(currentNode=n,na(n,!0,t)):(currentNode=0,!1)}function na(n,i,f){y.is(":checked")?(r.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"),vt.find("li").find("li[id='"+n+"']").parent().find("input").prop("checked",!0),vt.find("li").find("li[id='"+n+"']").parent().addClass("vis-tm-menuselectedcolor"),vt.find("li").find("li[id='"+n+"']").parent().hasClass("vis-tm-menuselectedcolor")&&(vt.find("li").find("li[id='"+n+"']").parent()[0].scrollIntoView(),vt.height(it.height()-(kr.height()+50)))):gf==!0&&(u.find(".k-state-selected").removeClass("k-state-selected"),t(u.find("div").find("div[data-nodeid='"+n+"']").parent()).addClass("k-state-selected"),t(u.find("div").find("div[data-nodeid='"+n+"']").parent()).hasClass("k-state-selected")&&(t(u.find("div").find("div[data-nodeid='"+n+"']").parent()).addClass("k-state-selected")[0].scrollIntoView(),au()),window.setTimeout(function(){ft=1;st=50;v=y.is(":checked")?e.val():"";c=y.is(":checked")?"true":"false";var t=u.find("div").find("div[data-nodeid='"+n+"']").parent().text();ui.text(t);r.empty();gi(n,o,ft,st,v,c,f)},400))}function ta(n){if(e.val()!=""&&(e.prop("disabled",!0),ni.prop("disabled",!0)),c=="true"&&u.find(".k-state-selected").length==1){ft=1;st=50;c=y.is(":checked")?"true":"false";var f=u.find(".k-state-selected").find("div").attr("data-nodeid");v=e.val();r.empty();gi(f,o,ft,st,v,c,n)}e.val()!=""&&(i[0].style.visibility="visible",b.find("span.k-in").find(".treechild").find("p").each(function(){var r=t(this).text().toUpperCase(),i;r==e.val().toUpperCase()&&(n.preventDefault(),i=t(this).parent().parent().parent().parent().parent().attr("class"),b.data("kendoTreeView").expand("."+i),b.find("span").removeClass("k-state-selected"),t(this).parent().parent().parent().addClass("k-state-selected"),this.parentNode.parentNode.parentNode.scrollIntoView())}),sh(n),i[0].style.visibility="hidden")}function fr(i){var f,o;if(w.val()!=""&&(di.css("display","inherit"),co==!0&&(co=!1,he=i)),w.val()=="")return!1;if(t(e).val()==""||!bf){t(e).val()==""&&(r.find("span").removeClass("VIS-TM-highlight"),u.find("span").removeClass("VIS-TM-highlight"),di.css("display","none"),gf=!0,co=!0);bf=!0;return}if(i!=undefined&&i.which!=13)if(f=e.val().toUpperCase(),o=f.length,y.is(":checked"))uu=-1,hf=[],sf=[],u.find("span").removeClass("VIS-TM-highlight"),r.find("li li").each(function(i,u){var c=t(u),s=n.Utility.decodeText(t(this).text()),h,e;if(hf.push(c.attr("id")),sf.push(s),h="",e=0,f=="")s.toUpperCase().indexOf(f,e)==0&&(t(this).find("span").removeClass("VIS-TM-highlight"),r.find(".vis-tm-menuselectedcolor").removeClass("vis-tm-menuselectedcolor"),g.addClass("vis-tm-delete"),r.find("input").prop("checked",!1));else{while((p=s.toUpperCase().indexOf(f,e))>=0)h+=s.substring(e,p)+'<span class="VIS-TM-highlight">'+s.substr(p,o)+"<\/span>",e=p+o;s.toUpperCase().indexOf(f,e)==-1&&t(this).find("span").removeClass("VIS-TM-highlight");e>0&&(h+=s.substring(e))}});else{if(hf=[],sf=[],r.find("li").find("span").removeClass("VIS-TM-highlight"),b.data("kendoTreeView").expand(".k-item"),at.css("display","none"),wt.css("display","inherit"),t(e).val()==""&&b.find("span").removeClass("VIS-TM-highlight"),t("span.k-in > span.highlight").each(function(){t(this).parent().text(t(this).parent().text())}),t.trim(e.val())=="")return;f=e.val().toUpperCase();o=f.length;b.find("span.k-in").each(function(i,r){var h=t(r),e=n.Utility.decodeText(t(this).text()),s,u;for(hf.push(h.find(".treechild").attr("data-nodeid")),sf.push(e),s="",u=0;(p=e.toUpperCase().indexOf(f,u))>=0;)s+=e.substring(u,p)+'<span class="VIS-TM-highlight">'+e.substr(p,o)+"<\/span>",u=p+o;e.toUpperCase().indexOf(f,u)==-1&&t(this).find("span").removeClass("VIS-TM-highlight");u>0&&(s+=e.substring(u),t(this).find("p").html(s))})}}function au(){u.find(".k-state-hover").removeClass("k-state-hover");u.find(".vis-tm-selectedkendoNode").removeClass("vis-tm-selectedkendoNode");u.find(".k-state-selected").find("p").addClass("vis-tm-selectedkendoNode")}function ia(n){var i,u;t(n.target).hasClass("summNonsumImage")&&(t(n.target).parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"),t(n.target).parent().parent().find("input").prop("checked",!1),t(n.target).parent().addClass("vis-tm-menuselectedcolor"),t(n.target).parent().find("input").prop("checked",!0),g.removeClass("vis-tm-delete"),i=r.find("input").length,u=r.find("input:checked").length,i==u&&nt.prop("checked",!0));t(n.target).hasClass("VIS-tm-MLi")&&(t(this).find("li").removeClass("vis-tm-menuselectedcolor"),t(this).find("li").find("input").prop("checked",!1),t(n.target).parent().addClass("vis-tm-menuselectedcolor"),t(n.target).parent().find("input").prop("checked",!0),g.removeClass("vis-tm-delete"),nt.prop("checked",!1),i=r.find("input").length,u=r.find("input:checked").length,i==u&&nt.prop("checked",!0));t(n.target).hasClass("VIS-tm-checkbox")&&(t(n.target).parent().find("input").prop("checked")?(t(n.target).parent().addClass("vis-tm-menuselectedcolor"),g.removeClass("vis-tm-delete"),i=r.find("input").length,u=r.find("input:checked").length,i==u&&nt.prop("checked",!0)):(t(n.target).parent().removeClass("vis-tm-menuselectedcolor"),t(n.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"),nt.prop("checked",!1),r.find("input:checked").length>0?g.removeClass("vis-tm-delete"):g.addClass("vis-tm-delete")))}function ce(n){ur=n;var t=f.find("input:checked").length,i=f.find("[disabled]").length,r=f.find("input").length,u=r-i;t==u?n!="disabled"&&et.prop("checked",!0):et.prop("checked",!1)}function lf(){}function ra(s){var p,l,a,h;if(ur=s,p=f,i[0].style.visibility="visible",f.find("input:checked").length>1&&ct.empty(),t(s.target).hasClass("VIS-Tm-glyphiconglyphicon-link")){kt=[];l=t(s.target).parent();a=t(s.target).parent().attr("id");kt.push(a);kt=kt.toString();window.setTimeout(function(){ur=s},200);ri=="false"?t.inArray(parseInt(a),li)<0?lh(o,kt,l):(n.ADialog.info("NeverDelete",!0,iu),i[0].style.visibility="hidden"):lh(o,kt,l);return}if(t(s.target).hasClass("vis-tm-textli")&&(t(this).find("input").prop("checked",!1),t(this).find("li").removeClass("vis-tm-menuselectedcolor"),t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"),t(t(s.target).parent().parent()).find("input").prop("checked",!0),ai=t(t(s.target).parent().parent()).find("img").attr("src"),s.target.id=t(s.target).attr("id"),t(s.target).parent().parent().find("input").attr("disabled")=="disabled"&&t(t(s.target).parent().parent()).find("input").prop("checked",!1),et.prop("checked",!1),ce(t(s.target).parent().parent().find("input").attr("disabled")),du&&lf(t(s.target).parent().parent())),t(s.target).hasClass("vis-tm-upperLi")&&(t(s.target).parent().find("li").removeClass("vis-tm-menuselectedcolor"),t(s.target).addClass("vis-tm-menuselectedcolor"),t(s.target).parent().find("input").prop("checked",!1),t(s.target).find("input").prop("checked",!0),ai=t(s.target).find("img").attr("src"),s.target.id=t(s.target).find(".vis-tm-textli").attr("id"),t(s.target).find("input").attr("disabled")=="disabled"&&t(s.target).find("input").prop("checked",!1),et.prop("checked",!1),ce(t(s.target).find("input").attr("disabled")),du&&lf(t(s.target))),t(s.target).hasClass("vis-tm-upperdivchkandimg")&&(t(s.target).parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"),t(s.target).parent().addClass("vis-tm-menuselectedcolor"),t(s.target).parent().parent().find("input").prop("checked",!1),t(s.target).find("input").prop("checked",!0),ai=t(s.target).find("img").attr("src"),s.target.id=t(s.target).parent().find(".vis-tm-textli").attr("id"),t(s.target).find("input").attr("disabled")=="disabled"&&t(s.target).find("input").prop("checked",!1),et.prop("checked",!1),ce(t(s.target).find("input").attr("disabled")),du&&lf(t(s.target).parent().parent())),t(s.target).hasClass("vis-tm-chkbox")){if(i[0].style.visibility="visible",t(s.target).attr("disabled")!="disabled")if(t(s.target).prop("checked")){for(t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"),s.target.id=s.target.id=t(s.target).parent().parent().find(".vis-tm-textli").attr("id"),ai=t(s.target).parent().parent().find("img").attr("src"),h=0;h<f.find(".vis-tm-menuselectedcolor").length;h++)t(f.find(".vis-tm-menuselectedcolor").find("input")[h]).attr("disabled")=="disabled"&&t(f.find(".vis-tm-menuselectedcolor").find("input")[h]).parent().parent().removeClass("vis-tm-menuselectedcolor");var w=f.find("input:checked").length,d=f.find("[disabled]").length,g=f.find("input").length,tt=g-d;w==tt?et.prop("checked",!0):et.prop("checked",!1)}else t(s.target).parent().parent().removeClass("vis-tm-menuselectedcolor"),ai=t(s.target).parent().parent().find("img").attr("src"),s.target.id=0,et.prop("checked",!1);i[0].style.visibility="hidden";du&&lf(t(s.target).parent().parent())}t(s.target).hasClass("summNonsumImage")&&(t(s.target).parent().parent().parent().find("li").removeClass("vis-tm-menuselectedcolor"),t(s.target).parent().parent().addClass("vis-tm-menuselectedcolor"),t(s.target).parent().parent().parent().find("input").prop("checked",!1),t(s.target).parent().find("input").prop("checked",!0),ai=t(s.target).parent().find("img").attr("src"),s.target.id=t(s.target).parent().parent().find(".vis-tm-textli").attr("id"),t(s.target).parent().find("input").attr("disabled")=="disabled"&&t(s.target).parent().find("input").prop("checked",!1),et.prop("checked",!1),ce(t(s.target).parent().find("input").attr("disabled")),du&&lf(t(s.target).parent()));(s.target.id==""||s.target.id=="undefined")&&(s.target.id=t(s.target).find(".vis-tm-menuselectedcolor").find("li").attr("id"));f.find(".vis-tm-menuselectedcolor").length==1&&f.find(".vis-tm-menuselectedcolor").find("li").hasClass("vis-tm-opacity")&&s.target.id!=""?t.ajax({url:n.Application.contextUrl+"TreeMaintenance/GetNodePath",type:"Post",data:{node_ID:s.target.id,treeID:o},success:function(h){var d,it,p,w,tt,g,l,a;et.prop("checked",!1);d=JSON.parse(h);d=d.replaceAll("\\\\"," \\ ");ct.empty();ct.append(n.Utility.encodeText(d));pi.is(":checked")&&(nt.prop("checked",!1),it=t(s.target).parent().parent().find("li").attr("id"),p=t(s.target).parent().parent().find("img").attr("src"),p=p.substring(p.lastIndexOf("/")+1),p=="summary.png"&&(w=t(s.target).text(),w=w.substring(0,w.lastIndexOf("(")),ui.text(w),cf=-1),ai.lastIndexOf("/"),ai=ai.substring(ai.lastIndexOf("/")+1),ai!="mWindow.png"&&ai!="folder.png"&&(rt.is(":checked")?pi.is(":checked")&&(i[0].style.visibility="visible",ai!="nonSummary.png"?b.data("kendoTreeView").expand(".k-item"):(dr(),tt="Select parent_id from "+nr+" where node_id="+s.target.id+" AND isactive='Y' and ad_tree_id="+o+"",g=k(tt,null,null),g!=null&&g.tables[0].rows.length>0&&(l=g.tables[0].rows[0].cells.parent_id,l==null&&(l=0),cf!=l&&(b.data("kendoTreeView").expand(".k-item"),window.setTimeout(function(){t(u.find(".k-state-selected")).removeClass("k-state-selected");t(u.find("div").find("div[data-nodeid='"+l+"']").parent()).addClass("k-state-selected")[0].scrollIntoView();var n=t(u.find(".k-state-selected")).text();ui.text(n);cf=l;au()},200),r.empty(),ft=1,st=50,v=e.val(),c=y.is(":checked")?"true":"false",gi(l,o,ft,st,v,c,s),cf=l))),i[0].style.visibility="hidden"):b.data("kendoTreeView").expand(".k-item")),t(u.find("div").find("div[data-nodeid='"+s.target.id+"']").parent()).addClass("k-state-selected").length!=0?(t(u.find(".k-state-selected")).removeClass("k-state-selected"),t(u.find(".k-state-focused")).removeClass("k-state-focused"),window.setTimeout(function(){t(u.find("div").find("div[data-nodeid='"+s.target.id+"']").parent()).addClass("k-state-selected")[0].scrollIntoView();au()},200),r.empty(),ft=1,st=50,v=e.val(),c=y.is(":checked")?"true":"false",gi(s.target.id,o,ft,st,v,c,s)):f.find(".vis-tm-menuselectedcolor").length==1&&(a=f.find(".vis-tm-menuselectedcolor").find("img").attr("src"),a=a.substring(a.lastIndexOf("/")+1),a!="nonSummary.png"&&a!="summary.png"&&ct.empty()));i[0].style.visibility="hidden"},error:function(n){console.log(n);i[0].style.visibility="hidden"}}):ct.empty();i[0].style.visibility="hidden"}function ch(n){var i=u.find("div").find("div[data-nodeid='"+n+"']").parent().parent().parent();i.children("ul").length>0&&(ku=t(t(i.children("ul")[0]).find("ul")[0]).length>0?t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).length>0?t(t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).length>0?t(t(t(t(t(i.children("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).find("ul")[0]).length>0?!0:!1:!1:!1:!1)}function lh(e,o){var s,c,h,a,l;i[0].style.visibility="visible";s="SELECT ad_table_id FROM ad_tree WHERE ad_tree_id="+e;s=k(s,null,null);s.tables[0].rows.length>0&&(s=s.tables[0].rows[0].cells.ad_table_id);c=" SELECT treetype FROM ad_tree WHERE ad_tree_id="+e;c=k(c,null,null);treeType=c.tables[0].rows[0].cells.treetype;h="";h=treeType=="PR"?"AD_TreeNodePR":treeType=="BP"?"AD_TreeNodeBP":treeType=="MM"?"AD_TreeNodeMM":"AD_TreeNode";a="Select node_id from "+h+" where parent_id="+o+" AND isactive='Y' and ad_tree_id="+e+"";l=k(a,null,null);l!=null&&l.tables[0].rows.length>0?n.ADialog.confirm("ChildAlsoWillbeRemove",!0,"","Confirm",function(s){if(s)o=o.toString(),of(h,o,e),t.ajax({url:n.Application.contextUrl+"TreeMaintenance/DeleteNodeFromBottom",type:"Post",data:{nodeid:o,treeID:e,menuArray:wi},success:function(e){var w=JSON.parse(e),c,v,a,h;if(w==""){for(r.find("input:checked").length==0&&nt.prop("checked",!1),ct.empty(),c=f.find("li").find("li[data-id='"+o+"']").parent().parent(),c.find("input").prop("disabled",!1),c.find("img").removeClass("vis-tm-opacity"),c.find(".vis-tm-textli").removeClass("vis-tm-opacity"),c.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"),c.find("input").css("cursor","pointer"),c.hasClass("vis-tm-menuselectedcolor")&&(ct.empty(),c.find("input").prop("checked",!0)),ri=="false"&&uh(),u.data("kendoTreeView").remove(u.find("div").find("div[data-nodeid='"+o+"']").parent().parent().parent()),r.find("li").find("li[data-id='"+o+"']").parent().remove(),v=0;v<ut.length;v++)if(a=ut[v],r.find("li").find("li[data-id='"+a+"']").parent().remove(),ri!="false"||!(t.inArray(parseInt(a),li)>=0)){h=f.find("li").find("li[data-id='"+a+"']").parent().parent();h.find("input").prop("disabled",!1);h.find("img").removeClass("vis-tm-opacity");h.find(".vis-tm-textli").removeClass("vis-tm-opacity");h.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link");h.find("input").css("cursor","pointer");h.hasClass("vis-tm-menuselectedcolor")&&(ct.empty(),h.find("input").prop("checked",!0));tt.val()=="Linked"&&h.remove();var y=f.find("li").find("li[data-id='"+a+"']").parent().parent().find("img").attr("src"),p=f.find("li").find("li[data-id='"+a+"']").parent().parent().find("img"),l,s=y;s!=null&&(s=s.substring(s.lastIndexOf("/")+1),s=="nonSummary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png":s=="summary.png"&&(l=n.Application.contextUrl+"Areas/VIS/Images/folder.png"),p.attr("src",l))}var y=f.find("li").find("li[data-id='"+o+"']").parent().parent().find("img").attr("src"),p=f.find("li").find("li[data-id='"+o+"']").parent().parent().find("img"),l,s=y;s!=null&&(s=s.substring(s.lastIndexOf("/")+1),s=="nonSummary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png":s=="summary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/folder.png":s=="folder.png"?l=n.Application.contextUrl+"Areas/VIS/Images/folder.png":s=="mWindow.png"&&(l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png"),p.attr("src",l));r.find("li").length!=0||u.find("span").hasClass("k-state-selected")||ui.text(n.Msg.getMsg("SelectTree"));ff()}rr();te();su();i[0].style.visibility="hidden"},error:function(n){console.log(n);i[0].style.visibility="hidden"}});else{i[0].style.visibility="hidden";return}}):(o=o.toString(),of(h,o,e),t.ajax({url:n.Application.contextUrl+"TreeMaintenance/DeleteNodeFromBottom",type:"Post",data:{nodeid:o,treeID:e,menuArray:wi},success:function(e){var w=JSON.parse(e),h,v,a,c;if(w==""){for(ct.empty(),h=f.find("li").find("li[data-id='"+o+"']").parent().parent(),h.find("input").prop("disabled",!1),h.find("img").removeClass("vis-tm-opacity"),h.find(".vis-tm-textli").removeClass("vis-tm-opacity"),h.find("span").removeClass("VIS-Tm-glyphiconglyphicon-link"),h.find("input").css("cursor","pointer"),u.data("kendoTreeView").remove(u.find("div").find("div[data-nodeid='"+o+"']").parent().parent().parent()),r.find("li").find("li[data-id='"+o+"']").parent().remove(),v=0;v<ut.length;v++)if(a=ut[v],ri!="false"||!(t.inArray(parseInt(a),li)>=0)){c=f.find("li").find("li[data-id='"+a+"']").parent().parent();c.find("input").prop("disabled",!1);c.find("img").removeClass("vis-tm-opacity");c.find(".vis-tm-textli").removeClass("vis-tm-opacity");c.removeClass("vis-tm-menuselectedcolor");tt.val()=="Linked"&&c.remove();var y=f.find("li").find("li[data-id='"+a+"']").parent().parent().find("img").attr("src"),p=f.find("li").find("li[data-id='"+a+"']").parent().parent().find("img"),l,s=y;s!=null&&(s=s.substring(s.lastIndexOf("/")+1),s=="nonSummary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png":s=="summary.png"&&(l=n.Application.contextUrl+"Areas/VIS/Images/folder.png"),p.attr("src",l))}var y=f.find("li").find("li[data-id='"+o+"']").parent().parent().find("img").attr("src"),p=f.find("li").find("li[data-id='"+o+"']").parent().parent().find("img"),l,s=y;s!=null&&(s=s.substring(s.lastIndexOf("/")+1),s=="nonSummary.png"?l=n.Application.contextUrl+"Areas/VIS/Images/mWindow.png":s=="summary.png"&&(l=n.Application.contextUrl+"Areas/VIS/Images/folder.png"),p.attr("src",l));ff()}r.find("li").length!=0||u.find("span").hasClass("k-state-selected")||ui.text(n.Msg.getMsg("SelectTree"));rr();te();su();i[0].style.visibility="hidden"},error:function(n){console.log(n);i[0].style.visibility="hidden"}}))}function fa(){dr();var n="SELECT Count(*) as Count FROM "+nr+" WHERE isactive ='Y' AND AD_Tree_ID="+o;n=k(n,null,null);n=n.tables[0].rows[0].cells.count;n>5e3?(rt.prop("checked",!0),rt.prop("disabled",!0),d[0].style.visibility="hidden",si=!0,lo=!0,ki.css("display","inherit"),e.css("border-right","1px solid #ccc"),it.css("display","inherit"),h.css("border-bottom","1px solid #1aa0ed"),h.css("height","70%"),gt.css("height","100%"),h.resizable({handles:"n,s,se"}),h.find(".ui-resizable-e").css("right","0px"),h.find(".ui-resizable-s").css("bottom","0px"),gt.addClass("VIS-TM-resizediv"),it.height(ei.height()-h.height()-20),e.width(cr.width()-(ki.width()+40+ni.width())),di.css("right","145px")):(rt.prop("disabled",!1),lo=!1)}function ea(){if(ps=!1,kf=!0,ru=!1,df=!1,w.val()!=""){ot[0].style.visibility="visible";wf.removeClass("vis-tm-opacity");rt.prop("disabled",!1);ir.css("display","inherit");tt.prop("disabled",!0);pi.prop("disabled",!1);pi.css("cursor","pointer");y.prop("disabled",!1);y.css("cursor","pointer");e.prop("disabled",!1);ii.prop("disabled",!1);et.prop("disabled",!1);et.css("cursor","pointer");ti.addClass("vis-tm-delete");wt.css("display","none");at.css("display","inherit");g.addClass("vis-tm-delete");er=!0;af=!0;f.empty();r.empty();yt="";ii.val("");e.val("");fi.css("display","inherit");ve=50;bi=1;tt.val(t(tt.find("option")[0]).attr("value"));var i=w.find("option:selected").text();gu.text(n.Msg.getMsg("AllItems"));ui.text(i);hi=w.find("option:selected");dt=hi.attr("data-type");o=hi.val();pr=hi.attr("data-isallnodes");window.setTimeout(function(){tf(dt,o,pr,si)},100);window.setTimeout(function(){f.empty();pt="All";bi=1;yr(o,dt,yt,pt);tu();fo()},200);oa();rt.is(":checked")?(si=!0,it.css("display","inherit"),h.css("border-bottom","1px solid #1aa0ed"),h.css("height","70%"),gt.css("height","100%"),h.resizable({}),h.find(".ui-resizable-e").css("right","0px"),h.find(".ui-resizable-s").css("bottom","0px"),gt.addClass("VIS-TM-resizediv"),it.height(ei.height()-h.height()-20),vt.height(ei.height()-(h.height()+kr.height()+40)),ki.css("display","inherit"),e.css("border-right","1px solid #ccc")):(e.css("border-right","none"),ki.css("display","none"),si=!1,it.css("display","none"),h.css("border-bottom","0px"),h.css("height","100%"),gt.css("height","100%"),h.resizable("destroy"),gt.removeClass("VIS-TM-resizediv"),it.height(ei.height()-h.height()))}else wf.addClass("vis-tm-opacity"),rt.prop("disabled",!0),rt.prop("checked",!0),ir.css("display","none"),o=0,f.empty(),r.empty(),b.data("kendoTreeView").destroy(),b.empty(),ct.empty(),yt="",ii.val(""),hi=null,g.addClass("vis-tm-delete"),e.val(""),window.setTimeout(function(){f.empty()},200),gu.text(n.Msg.getMsg("SelectTree")),ui.text(n.Msg.getMsg("SelectTree")),fi.css("display","none"),ti.addClass("vis-tm-delete"),y.prop("disabled",!0),pi.prop("disabled",!0),y.css("cursor","not-allowed"),pi.css("cursor","not-allowed"),e.prop("disabled",!0),ii.prop("disabled",!0),tt.prop("disabled",!0),et.prop("disabled",!0),et.css("cursor","not-allowed"),vr.css("display","none"),di.css("display","none");pi.prop("checked",!1);et.prop("checked",!1);y.prop("checked",!1);f.empty();nt.prop("checked",!1);rr()}function oa(){gt.height(h.height()-10)}function sa(n){var i=t(n.currentTarget);i[0].scrollHeight-i.scrollTop()==i.outerHeight()&&f.find("li").length>0&&(pt=tt.val(),af=!1,pe=!0,bi+=1,yr(o,dt,yt,pt))}function ha(n){w.val()!=""&&(r.empty(),rt.is(":checked")?(d[0].style.visibility="hidden",si=!0,ki.css("display","inherit"),e.css("border-right","1px solid #ccc"),it.css("display","inherit"),h.css("border-bottom","1px solid #1aa0ed"),h.css("height","70%"),gt.css("height","100%"),h.resizable({handles:"n,s,se"}),h.find(".ui-resizable-e").css("right","0px"),h.find(".ui-resizable-s").css("bottom","0px"),gt.addClass("VIS-TM-resizediv"),hi!=null&&tf(dt,o,pr,si),it.height(ei.height()-h.height()-20),e.width(cr.width()-(ki.width()+40+ni.width())),di.css("right","145px")):(gh(),e.val()!=""&&y.prop("checked",!1),e.width(cr.width()-(ni.width()+30)),di.css("right","35px")),wt.css("display","none"),at.css("display","inherit"),rr(),window.setTimeout(function(){e.val()!=""&&window.setTimeout(function(){fr(n)},200)},200),uu=-1,ru=!1)}function ca(){i=t("<div class='BusyDiv'>");i.css("position","absolute");i.css("bottom","0");i.css("background","url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat");i.css("background-position","center center");i.css("width","98%");i.css("height","98%");i.css("text-align","center");i.css("z-index","1000");i[0].style.visibility="visible";le.append(i)}function la(){var i=null;i=t('<div style="position: relative; width: 100%; height: 100%; z-index: -1;">');d=t("<div>");d.css("position","absolute");d.css("bottom","0");d.css("background","url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat");d.css("background-position","center center");d.css("width","98%");d.css("height","98%");d.css("text-align","center");d.css("z-index","1000");i[0].style.visibility="visible";i.append(d);it.append(i)}function aa(){lt=t("<div>");lt.css("position","absolute");lt.css("bottom","0");lt.css("background","url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat");lt.css("background-position","center center");lt.css("width","98%");lt.css("height","98%");lt.css("text-align","center");lt.css("z-index","1000");lt[0].style.visibility="visible";nf.append(lt)}function va(){ot=t("<div>");ot.css("position","absolute");ot.css("bottom","0");ot.css("background","url('"+n.Application.contextUrl+"Areas/VIS/Images/busy.gif') no-repeat");ot.css("background-position","center center");ot.css("width","98%");ot.css("height","98%");ot.css("text-align","center");ot.css("z-index","1000");ot[0].style.visibility="visible";h.append(ot)}var s,ht,di,ti,lr,ei,ar,uo,vr,ou,ci,or,bf,kf,rf,oi,uf,nr,cu,gr,nu,df,ec,lu,oc,ne,ie,kt,fe,nh,ih,rh,ee,ut,kl,uu,fh,eh,se,oh,ua,lo,af;this.frame;this.windowNo;var ya=this,le=t('<div class="vis-forms-container" style="padding:15px 0 7px;background-color:white;height:100%"/>'),b,si=!0,hi,dt,o,pr,ao="",ae=0,vo,ve=50,bi=1,l,vi=[],fu=[],wr=!0,yo=null,vu,br=0,i=null,d=null,lt=null,ot=null,er=!0,yu=!0,pu,po,wo=null,tr=null,yt="",ah=null,bo=!0,v=null,ft=1,st=50,ye=0,wu=0,vf=null,bu=!1,yi=null,ku=!1,pt="All",pe=!1,hr=!0,ko=n.Application.contextUrl,vh=ko+"JsonData/JDataSet",yh=ko+"JsonData/ExecuteNonQuer",we=t("<div  class='VIS-TM-left-tree' style='border-right:1px solid #ccc' >"),ph=t("<div  class='VIS-TM-middle'>"),be=t("<div class='VIS-TM-right-slide'>"),ke=!1,k=function(t,i,r){var e=r?!0:!1,f={sql:t,page:1,pageSize:0},u;return i&&(f.param=i),u=null,go(f,e,function(t){u=(new n.DB.DataSet).toJson(t);r&&r(u)}),u},yf=function(t,i,r){var f=r?!0:!1,e={sql:t,page:1,pageSize:0},u=null;return go(e,f,function(t){i=(new n.DB.DataSet).toJson(t);var i=(new n.DB.DataSet).toJson(t);u=i.getTable(0).getRows().length>0?i.getTable(0).getRow(0).getCell(0):null;i.dispose();i=null;f&&r(u)}),u},eu=function(n,i,r){var f=r?!0:!1,u=null,e={sql:n,param:i};return t.ajax({url:yh+"y",type:"POST",datatype:"json",contentType:"application/json; charset=utf-8",async:f,data:JSON.stringify(e)}).done(function(n){u=n;r&&r(n)}),u};var de=t('<div class="VIS-TM-data-head">'),ns=t('<div class="VIS-TM-data">'),rt=t('<input disabled type="checkbox" checked="true" />'),ts=t("<span>"+n.Msg.getMsg("OnlySummaryLevel")+"<span/>"),is=t("<h4>"+n.Msg.getMsg("SelectTree")+"<\/h4>"),du=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase());de.append(is).append(ns.append(rt).append(ts));var ge=t('<div class="VIS-TM-treeCombo">'),w=t("<select><\/select>"),no=t('<span style="display:none" class="VIS-Tm-search-icontree glyphicon glyphicon-refresh"  title='+n.Msg.getMsg("RefreshSelectTree")+"><\/span>"),to=t('<span class="VIS-Tm-search-icontree glyphicon glyphicon-refresh" style="float:left" title="'+n.Msg.getMsg("tmRefresh")+'"><\/span>'),wt=t('<input class="VIS-tm-expandtree search-icon" type="button" style="margin-bottom:2px;float:right;display:none;margin-left: 5px;" title="'+n.Msg.getMsg("TreeCollapse")+'" >'),at=t('<input class="VIS-tm-collapsetree search-icon" type="button" style="margin-bottom:2px;float:right;margin-left: 5px;" title="'+n.Msg.getMsg("TreeExpand")+'" >'),rs=t("<img class='VIS-Tm-zoombtn' title='"+n.Msg.getMsg("CreateNewTree")+"'  src='"+n.Application.contextUrl+"Areas/VIS/Images/Zoom16.png'><\/img>"),ir=t('<div class="vis-tm-treeCmbDisable "><\/div>');ge.append(ir).append(w).append(rs).append(to).append(wt).append(at);var h=t('<div class="VIS-TM-tree-wrap" style="border-bottom:1px solid #1aa0ed" >'),u=t('<div class="VIS-TM-root-node" style="overflow:visible">'),gt=t('<div class="vis-tm-topTreeDiv">');h.resizable({handles:"n,s,se"});s=t('<div style="z-index:9;width:28px;display:none;text-align:center;float: right; height: 95%; position: absolute; right: 5px;"><\/div>');ht=t('<span class="VIS-Tm-deletetreenode" style="margin:auto;display:none;position: relative;top: 50%;"><\/span>');s.append(ht);gt.append(no).append(s).append(u);h.append(gt);var cr=t("<div class='VIS-TM-tree-search'>"),e=t("<input disabled placeholder='"+n.Msg.getMsg("Search")+"' type='search'>"),ni=t('<span class="VIS-Tm-search-icontree glyphicon glyphicon-search" style="top:0px"><\/span>'),ki=t('<div style="float: left;padding: 4px 2px;">'),y=t('<input type="checkbox" disabled style="float: left;margin-right:6px">'),wh=t('<label style="font-weight: normal;margin-bottom:0px">'+n.Msg.getMsg("NodeItem")+"<\/label>");ki.append(y).append(wh);di=t('<span class="vis-tmlinkdel-icon"><\/span>');cr.append(e).append(di).append(ki).append(ni);var kr=t("<div class='VIS-TM-data-headMID'>"),g=t("<span style='display:inherit;margin-top:10px;margin-bottom:4px' class='VIS-Tm-unlinkforbottmo ' title='"+n.Msg.getMsg("UnlinkNode")+"' ><\/span>"),ui=t('<h4 style="float:left">'+n.Msg.getMsg("SelectTree")+"<\/h4>"),vt=t("<div class='VIS-TM-dataWrap' style='padding-top:0px' >"),fi=t('<span class="VIS-TM-recordeNotFound">'+n.Msg.getMsg("TMRecordNotFound")+"<\/span>"),r=t('<ul class="vis-tm-sortable" style="list-style: none;padding:0">'),nt=t('<input type="checkbox" disabled style="float: left;margin: 12px 10px 0 0;" />'),bh=t('<span class="glyphicon glyphicon-search" style="display:none;cursor:pointer;float:left;color:#000;margin: 14px 0 0 6px;font-size: 10px;" ><\/span>');vt.append(r).append(fi);ti=t('<span style="display:inherit;margin-top:10px;margin-bottom:4px" class="vis-tm-childnodeinidailog" title="'+n.Msg.getMsg("SetOrder")+'">Set Order<\/span>');ti.addClass("vis-tm-delete");lr=t('<div style="display:none;position:absolute;height: 40.2px;width: 100%; z-index: 5;"><\/div>');kr.append(lr).append(nt).append(ui).append(bh).append(g).append(ti);var io=t("<div class='VIS-TM-data-head'>"),gu=t("<h4>"+n.Msg.getMsg("AllItems")+"<\/h4>"),nf=t("<div class='VIS-TM-dataWrap'>"),pf=t("<div class='VIS-TM-treeList'>"),f=t("<ul style='list-style: none' class='scrolldrag' >"),ii=t("<input disabled placeholder='"+n.Msg.getMsg("Search")+"' type='search'>"),us=t('<span class="VIS-Tm-search-icontree glyphicon glyphicon-search" style="top:0px;float:none"><\/span>'),fs=t("<div class='VIS-TM-path'>"),ct=t("<i style='font-weight:600'>"),tt=t('<select disabled style="float: right;"><\/select>'),kh=t('<span style="margin-right: 7px;float:left">'+n.Msg.getMsg("Show")+"<span/>"),pi=t('<input type="checkbox"  style="float:left;margin-right:9px" disabled  />'),dh=t('<span style="margin-right: 2px;float: left;margin-top: 4px;">'+n.Msg.getMsg("TraceItem")+"<span/>"),et=t('<input type="checkbox" disabled style="float: left;margin: 4px 10px 0 0;" />'),wf=t('<span class="vis-unlinkallNodes vis-tm-opacity" title="'+n.Msg.getMsg("UnlinkItem")+'"  ><b><\/b><b><\/b><b><\/b><\/span>');io.append(et).append(gu).append(t('<div style="float: right;">').append(kh).append(wf).append(tt));var a=t('<div class="vis-tm-nodeItemDeleteliketopdiv"><span class="VIS-Tm-deletetreenode vis-tm-nodeItemDeletespans" ><\/span><\/div>'),it=t('<div style="float:left;width:100%;">'),ro=t('<div style="z-index:999;height:100%;display:none;position:absolute; left:0; right:0; top:0; bottom:0;"><\/div>');it.append(ro).append(kr).append(vt).append(a);ei=t('<div class="VIS-TM-leftMianDataDiv">');ei.append(h).append(it);ar=t('<div style="display:none;height: 100%; width: 100%; position: absolute;z-index: 9999;"><\/div>');we.append(ar).append(t('<div style="height:100%;margin-top:3px" >').append(de).append(ge).append(ei).append(cr));uo=t('<div class="VIS-TM-Righttree-search" >');vr=t('<span class="vis-tmlinkdel-icon"><\/span>');uo.append(ii).append(vr).append(us);ou=t('<span class="VIS-TM-recordeNotFound" style="margin-top:50%" >'+n.Msg.getMsg("TMRecordNotFound")+"<\/span>");ci=t('<div style="z-index:999;height:100%;display:none;position:absolute; left:0; right:0; top:0; bottom:0;"><\/div>');nf.append(ci).append(uo).append(pf.append(f).append(ou)).append(fs.append(ct));be.append(t('<div  style="height:100%">').append(io).append(nf));le.append(we).append(be);or=!1;bf=!0;kf=!0;var sr=null,ss=null,hs=t('<div class="vis-tm-unlinkimgss">');rf=0;oi=!1;var hu=null;uf=null;nr=null;cu=[];gr=!1;nu=null;df=null;ec=!0;lu=!0;oc=null;var c=!1,ps=!1,gf=!1;var wi=[],ri="true",li=null,iu=null;ne=null;ie=!0;var re=1,oo=50,ru=!1,so=0;var bt=t("<ul style='padding:0;list-style: none'>"),bs=t("<div>"),ks=t('<div style="padding: 10px;height:425px;overflow:auto">');var gs=null,tl=null,ue=!0;var el=0,ol=0,sl=0;kt=[];fe=null;nh=null;ih=!0;rh=null;ee="";ut=[];kl=0;uu=-1;oh=!0;var sf=[],hf=[],ur=null,co=!0,he=null;var ai=null,cf=-1;ua=!0;lo=null;af=!0;this.Initialize=function(){ca();aa();va();la();es();sc();window.setTimeout(function(){i[0].style.visibility="hidden"},200);i[0].style.visibility="visible";lt[0].style.visibility="hidden";ot[0].style.visibility="hidden";d[0].style.visibility="hidden"};this.disposeComponent=function(){b=null;si=null;hi=null;dt=null;o=null;pr=null;ao=null;ae=null;vo=null;ve=null;bi=null;l=null;vi=null;wr=null;vu=null;br=null;i=null;pu=null;po=null;we=null;ph=null;be=null;de=null;ns=null;rt=null;ts=null;is=null;ge=null;w=null;no=null;to=null;h=null;u=null;cr=null;e=null;ni=null;kr=null;ui=null;vt=null;fi=null;r=null;io=null;gu=null;nf=null;pf=null;f=null;fs=null;ct=null};this.getRoot=function(){return window.kendo==undefined||window.kendo==null?t('<div><p style="text-align: center;line-height: 600px;">'+n.Msg.getMsg("PleaseInstallKendoUIModule")+"<\/p><\/div>"):(window.setTimeout(function(){g.addClass("vis-tm-delete");h.find(".ui-resizable-n").css("display","none")},200),i[0].style.visibility="visible",le)};this.formSizeChanged=function(){it.height(ei.height()-h.height()-20);e.width(cr.width()-(ki.width()+40+ni.width()));vt.height(it.height());it.css("overflow","hidden")};this.sizeChanged=function(n,t){this.formSizeChanged(n,t)}}i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;this.Initialize();this.frame.getContentGrid().append(this.getRoot())};i.prototype.sizeChanged=function(n,t){this.formSizeChanged(n,t)};i.prototype.refresh=function(){this.formSizeChanged()};i.prototype.dispose=function(){this.disposeComponent();this.frame&&this.frame.dispose();this.frame=null};n.Apps.AForms.VTreeMaintenance=i}(VIS,jQuery),function(n,t){function i(i,r){function l(){}function a(t,i,r,u){s.filter("p#forreportcreate").text(n.Msg.getMsg("Generating"+u+"File"));h.filter("p#forreportdownload").text(n.Msg.getMsg("Downloading"+u+"File"))}var u,f;this.onClose=null;var e=t("<div><\/div>"),o=t('<div style="overflow-y:auto;margin-bottom:15px"><\/div>'),s=t('<p id="forreportcreate"><\/p><div class="vis-ui-progress-bar hide" id="reportcreate"><div class="progress-bar vis-ui-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><\/div><\/div><br /><p class="hide" id="reportcreateresult"><\/p> <div style="margin-bottom: 15px;"><\/div>'),h=t('<p id="forreportdownload" class="hide"><\/p><div class="vis-ui-progress-bar hide" id="reportdownload"><div class="progress-bar vis-ui-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><\/div><\/div><br /><p class="hide" id="reportdownloadresult"><\/p>'),c=t("<div class='vis-apanel-busy' style='width:98%;height:98%;position:absolute'>");e.append(c).append(s).append(h);this.winNo=i;u=null;this.prop={WindowNo:i};a(o,i,this.prop,r);f=this;this.show=function(){u=new n.ChildDialog;u.setContent(e);u.setHeight(450);u.setWidth(650);u.setTitle(n.Msg.getMsg("Reports"));u.setModal(!0);u.onClose=function(){f.onClose&&f.onClose();f.dispose()};u.show();l();u.hidebuttons()};this.onClose=function(){u.close()};this.setBulkBusy=function(n){c.css("display",n?"block":"none")};this.dispose=function(){this.prop=null;o=null;e=null;u=null;f=null;this.setBulkBusy(!1)}}n.BulkDownload=i}(VIS,jQuery),function(n,t){function i(){function et(){c=t('<div class="Page-content" style="height:100%;background-color:white;">');e=t(' <div class="formLeft" style="background-color: rgb(241, 241, 241);display: inline-block; float: left;width:23%;height:87.8%;overflow:auto;padding-left: 7px;">');r=t('<div class="VIS_formDataRow">');u=t("<div id=PCont_Name_"+i.windowNo+' class="VIS_formData">');k=t("<label>"+n.Msg.translate(n.Env.getCtx(),"Name")+"<\/label><br>");d=t("<input type=text id=containerName_"+i.windowNo+" ><\/input>");u.append(k).append(d);r.append(u);e.append(r);r=t('<div class="VIS_formDataRow">');u=t("<div id=PCont_WarehouseSearch_"+i.windowNo+' class="VIS_formData" style="margin-top:20px">');g=t("<label>"+n.Msg.translate(n.Env.getCtx(),"M_Warehouse_ID")+"<\/label><br>");u.append(g);r.append(u);e.append(r);r=t('<div class="VIS_formDataRow">');u=t("<div id=PCont_LocatorSearch_"+i.windowNo+' class="VIS_formData" style="margin-top:20px">');tt=t("<label>"+n.Msg.translate(n.Env.getCtx(),"M_Locator_ID")+"<\/label><br>");u.append(tt).append(o);r.append(u);e.append(r);r=t('<div class="VIS_formDataRow">');u=t('<div class="VIS_formData">');v=t('<input type=button id="PCont_btnSearch_'+i.windowNo+' class="#" style="margin-top:20px;width: 100px;" value = '+n.Msg.getMsg("Search")+"><\/input>");u.append(v);r.append(u);e.append(r);l=t(' <div class="formRight" style="display: inline-block; float: left; width: 75%; height: 87.8%; margin-left: 10px;">');p=t('<div style="display: inline-block; float: left; width: 75%; height: 87.8%; margin-left: 10px;">');a=t("<div>");y=t('<input type=button id="PCont_OK_'+i.windowNo+' style="margin-top:20px;width: 100px;" value = '+n.Msg.getMsg("OK")+"><\/input>");a.append(y);l.append(p).append(a);c.append(e).append(l);f.append(c).append(b)}function ot(){h=f.find("#PCont_WarehouseSearch_"+i.windowNo);st();o=f.find("#PCont_LocatorSearch_"+i.windowNo);ht();var t=f.find("#containerName_"+i.windowNo)[0].value;w(t,$ReqControlWarehouse.value,$ReqControlLocator.value);v.on("click",function(){var n=f.find("#containerName_"+i.windowNo)[0].value;w(n,$ReqControlWarehouse.value,$ReqControlLocator.value)});y.on("click",function(){var t=n.context.getWindowTabContext(i.windowNo,1,"KeyColumnName"),r=0;if(t.length>0)r=n.context.getWindowContext(i.windowNo,t,!0);else{w2alert(n.Msg.getMsg("VIS_TableNotFound"));return}r>0&&$selectedContainerId>0?lt(t,r,$selectedContainerId):w2alert(n.Msg.getMsg("VIS_RecordNotSelected"))})}function st(){nt=n.MLookupFactory.get(n.Env.getCtx(),i.windowNo,3798,n.DisplayType.Search,"M_Warehouse_ID",0,!1,null);this.$ReqControlWarehouse=new n.Controls.VTextBoxButton("M_Warehouse_ID",!0,!0,!0,n.DisplayType.Search,nt);this.$ReqControlWarehouse.getControl().css("width","55%");this.$ReqControlWarehouse.getBtn(0).css("height","29px");this.$ReqControlWarehouse.getBtn(0).css("margin-top","-1px");this.$ReqControlWarehouse.getBtn(0).css("width","14%");this.$ReqControlWarehouse.getBtn(1).css("height","29px");this.$ReqControlWarehouse.getBtn(1).css("margin-top","-1px");this.$ReqControlWarehouse.getBtn(1).css("width","14%");h.append(this.$ReqControlWarehouse.getControl());h.append(this.$ReqControlWarehouse.getBtn(0));h.append(this.$ReqControlWarehouse.getBtn(1));var t=ut(i.windowNo,"M_Warehouse_ID");$ReqControlWarehouse.setValue(t)}function ht(){it=new n.MLocatorLookup(n.Env.getCtx(),i.windowNo);this.$ReqControlLocator=new n.Controls.VLocator("M_Locator_ID",!0,!0,!0,n.DisplayType.Locator,it);this.$ReqControlLocator.getControl().css("width","55%");this.$ReqControlLocator.getBtn(0).css("height","29px");this.$ReqControlLocator.getBtn(0).css("margin-top","-1px");this.$ReqControlLocator.getBtn(0).css("width","14%");this.$ReqControlLocator.getBtn(1).css("height","29px");this.$ReqControlLocator.getBtn(1).css("margin-top","-1px");this.$ReqControlLocator.getBtn(1).css("width","14%");o.append(this.$ReqControlLocator.getControl());o.append(this.$ReqControlLocator.getBtn(0));o.append(this.$ReqControlLocator.getBtn(1));var t=ut(i.windowNo,"M_Locator_ID");$ReqControlLocator.setValue(t)}function ut(t,i){return n.context.getWindowContext(t,i,!1)}function w(i,r,u){t.ajax({type:"POST",url:n.Application.contextUrl+"ProductContainer/ProductContainer",data:{Name:i,WarehouseId:r,LocatorId:u},dataType:"json",success:function(n){var t=JSON.parse(n);t?ct(t):w2ui[s].clear()},error:function(n){console.log(n)}})}function ct(t){var u=[],f=[],i,r;for(u.push({field:"ContainerName",caption:n.Msg.getMsg("ContainerName"),size:"15%"}),u.push({field:"Width",caption:n.Msg.getMsg("Width"),size:"15%"}),u.push({field:"Height",caption:n.Msg.getMsg("Height"),size:"15%"}),u.push({field:"ParentPath",caption:n.Msg.getMsg("ParentPath"),size:"22%"}),u.push({field:"M_ProductContainer_ID",caption:n.Msg.getMsg("M_ProductContainer_ID"),hidden:!0}),u.push({field:"Ref_M_Container_ID",caption:n.Msg.getMsg("Ref_M_Container_ID"),hidden:!0}),i=0;i<t.length;i++)r={},r.M_ProductContainer_ID=t[i].M_ProductContainer_ID,r.Ref_M_Container_ID=t[i].Ref_M_Container_ID,r.ContainerName=t[i].ContainerName,r.ParentPath=t[i].ParentPath,r.Width=t[i].Width,r.Height=t[i].Height,r.recid=i+1,f[i]=r;s="PCont_gridContainer"+Math.random();s=s.replace(".","");w2utils.encodeTags(f);rt=p.w2grid({name:s,recordHeight:20,show:{toolbar:!1,columnHeaders:!0,lineNumbers:!0,selectColumn:!1,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:u,records:f,onClick:function(n){$selectedContainerId=rt.get(n.recid).M_ProductContainer_ID}})}function lt(r,u,e){t.ajax({type:"POST",url:n.Application.contextUrl+"ProductContainer/UpdateProductContainer",data:{TableName:r,RecordId:u,ContainerId:e},dataType:"json",success:function(t){var u=JSON.parse(t),r;u?(w2alert(n.Msg.getMsg("VIS_UpdatedSuccess")),r=f.find("#containerName_"+i.windowNo)[0].value,w(r,$ReqControlWarehouse.value,$ReqControlLocator.value)):w2alert(n.Msg.getMsg("VIS_NotUpdated"))},error:function(n){console.log(n)}})}function ft(n){b[0].style.visibility=n}this.frame;this.windowNo;var i=this,f=t("<div style='height:100%;background-color:white;' >"),b=t("<div class='vis-apanel-busy' style='height:100%;position:relative;z-index: 2'>"),c=null,r=null,e=null,l=null,u=null,a=null,k=null,d=null,g=null,h=null,nt=null;this.$ReqControlWarehouse=null;var tt=null,o=null,it=null;this.$ReqControlLocator=null;var v=null,y=null,p=null,rt=null,s=null;this.$selectedContainerId=null;this.Initialize=function(){ft("visible");et();ot();ft("hidden")};this.getRoot=function(){return f};this.formSizeChanged=function(){};this.sizeChanged=function(){};disposeComponent=function(){this.$ReqControlWarehouse=null;this.$ReqControlLocator=null;this.$selectedContainerId=null}}n.AForms=n.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;var i=this.Initialize();this.frame.getContentGrid().append(this.getRoot());this.formSizeChanged()};i.prototype.sizeChanged=function(n,t){this.formSizeChanged(n,t)};i.prototype.refresh=function(){this.formSizeChanged()};i.prototype.dispose=function(){disposeComponent();this.frame=null};n.AForms.productContainer=i}(VIS,jQuery),function(n,t){function i(){function pi(){tt=t('<div class="VIS_main-wrap">');b=t('<div class="VIS_form-wrap">');h=t('<div class="VIS_form-row">');c=t('<div class="VIS_form-col">');lt=t("<label>"+n.Msg.translate(n.Env.getCtx(),"M_Warehouse_ID")+"<\/label>");w=t('<select disabled style="background: #f5f5f5;">');c.append(lt).append(w);v=t('<div class="VIS_form-col">');at=t("<label>"+n.Msg.translate(n.Env.getCtx(),"M_WarehouseTo_ID")+"<\/label>");o=t("<select>");v.append(at).append(o);h.append(c).append(v);b.append(h);h=t('<div class="VIS_form-row">');c=t('<div class="VIS_form-col">');vt=t("<label>"+n.Msg.translate(n.Env.getCtx(),"M_Locator_ID")+"<\/label>");u=t("<select>");c.append(vt).append(u);v=t('<div class="VIS_form-col">');yt=t("<label>"+n.Msg.translate(n.Env.getCtx(),"M_LocatorTo_ID")+"<\/label>");e=t("<select>");v.append(yt).append(e);h.append(c).append(v);b.append(h);h=t('<div class="VIS_form-row">');c=t('<div class="VIS_form-col">');pt=t("<label>"+n.Msg.translate(n.Env.getCtx(),"VIS_FromContainer")+"<\/label>");f=t('<select disabled class="VIS-container-move-combo-width" style="background: #f5f5f5;">');d=t('<span class="pull-left VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled"><\/span>');c.append(pt).append(f).append(d);v=t('<div class="VIS_form-col">');wt=t("<label>"+n.Msg.translate(n.Env.getCtx(),"Ref_M_ProductContainerTo_ID")+"<\/label>");i=t('<select disabled class="VIS-container-move-combo-width" style="background: #f5f5f5;">');$btnToContainerTree=t('<span class="pull-left VIS_buttons-ContainerTree VIS-pallet-icon VIS_Tree-Container-disabled"><\/span>');v.append(wt).append(i).append($btnToContainerTree);h.append(c).append(v);b.append(h);h=t('<div class="VIS_form-row">');c=t('<div class="VIS_form-col-checkbox">');l=t('<input type="checkbox" name="">');bt=t("<label title="+n.Msg.translate(n.Env.getCtx(),"VIS_MoveFullContainerToolTip")+">"+n.Msg.translate(n.Env.getCtx(),"VIS_MoveFullContainer")+"<\/label>");c.append(l).append(bt);it=t('<div class="VIS_form-col-checkbox">');y=t('<input type="checkbox" name="WithoutContainer">');kt=t("<label title="+n.Msg.translate(n.Env.getCtx(),"VIS_WithoutContainerToolTip")+">"+n.Msg.translate(n.Env.getCtx(),"VIS_WithoutContainer")+"<\/label>");it.append(y).append(kt);h.append(c).append(it);b.append(h);rt=t(' <div class="VIS_outer-table-wrap">');ut=t('<div class="VIS_outer-table-wrap">');rt.append(ut);ft=t('<div class="VIS_buttons-wrap">');dt=t('<div class="pull-left" style="display: none;"><label>'+n.Msg.translate(n.Env.getCtx(),"VIS_ContainerGridInfo")+"<\/label><\/div>");nt=t('<div class="pull-right">');et=t('<span class="btn">'+n.Msg.translate(n.Env.getCtx(),"VIS_OK")+"<\/span>");wi(nt);nt.append(et);ft.append(dt).append(nt);tt.append(b).append(rt).append(ft);ct.append(tt).append(ii)}function wi(i){ulPaging=t('<ul style="float:left;margin-top:4px" class="vis-statusbar-ul">');liFirstPage=t('<li style="display: none; "><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageFirst16.png" alt="First Page" title="'+n.Msg.translate(n.Env.getCtx(),"FirstPage")+'"  style="opacity: 0.6;"><\/div><\/li>');liPrevPage=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageUp16.png" alt="Page Up" title="'+n.Msg.translate(n.Env.getCtx(),"PageUp")+'"  style="opacity: 0.6;"><\/div><\/li>');cmbPage=t("<select>");liCurrPage=t("<li>").append(cmbPage);liNextPage=t('<li style="opacity: 1;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageDown16.png" alt="Page Down" title="'+n.Msg.translate(n.Env.getCtx(),"PageDown")+'" style="opacity: 0.6;"><\/div><\/li>');liLastPage=t('<li style="display: none;"><div><img src="'+n.Application.contextUrl+'Areas/VIS/Images/base/PageLast16.png" alt="Last Page" title="'+n.Msg.translate(n.Env.getCtx(),"LastPage")+'" style="opacity: 0.6;"><\/div><\/li>');ulPaging.append(liFirstPage).append(liPrevPage).append(liCurrPage).append(liNextPage).append(liLastPage);i.append(ulPaging)}function bi(){liPrevPage.on("click",function(n){n.preventDefault();t(this).css("opacity")=="1"&&(r("visible"),g(ht,!0,-1))});liNextPage.on("click",function(n){n.preventDefault();t(this).css("opacity")=="1"&&(r("visible"),g(ht,!0,1))});cmbPage.on("change",function(n){n.preventDefault();r("visible");g(ht,!0,0)})}function ki(n,t){cmbPage.val(n);t>0?(t>n?liNextPage.css("opacity","1"):liNextPage.css("opacity","0.6"),n>1?liPrevPage.css("opacity","1"):liPrevPage.css("opacity","0.6"),t==1&&(liPrevPage.css("opacity","0.6"),liNextPage.css("opacity","0.6"))):(liPrevPage.css("opacity","0.6"),liNextPage.css("opacity","0.6"));r("hidden")}function di(){gi();nr();tr();ui();u.on("change",function(){r("visible");f.empty();u.val()=="0"?d.addClass("VIS_Tree-Container-disabled"):d.removeClass("VIS_Tree-Container-disabled");window.setTimeout(function(){g(0,!1,0)},20);r("hidden")});o.on("change",function(){r("visible");i.empty();ui();r("hidden")});e.on("change",function(){r("visible");i.empty();e.val()=="0"?$btnToContainerTree.addClass("VIS_Tree-Container-disabled"):$btnToContainerTree.removeClass("VIS_Tree-Container-disabled");r("hidden")});g(0,!1,0);et.on("click",function(){if(o.val()=="0")return n.ADialog.error("VIS_ToWarehouseNotSelected",!0,"",""),!1;if(u.val()=="0")return n.ADialog.error("VIS_FromLocatorNotSelected",!0,"",""),!1;if(e.val()=="0")return n.ADialog.error("VIS_ToLocatorNotSelected",!0,"",""),!1;if(f.val()==null&&i.val()==null)return n.ADialog.error("VIS_SelectContainer",!0,"",""),!1;var t=p.length;if(t==0&&!y.is(":checked")&&!l.is(":checked"))return n.ADialog.error("VIS_MoveQtyNotSelected",!0,"",""),!1;l.is(":checked")?n.ADialog.confirm("VIS_DoYouWantToDeleteManualCL",!0,"","Confirm",function(n){if(n)r("visible"),fi(),r("hidden");else return!1}):(r("visible"),fi(),r("hidden"))});d.on("click",function(){if(!d.hasClass("VIS_Tree-Container-disabled")){var i=w.val()=="0"||w.val()==null?0:parseInt(w.val()),r=u.val()=="0"||u.val()==null?0:parseInt(u.val()),t=new n.productContainerTree(i,r,null,null);t!=null&&(t.showDialog(),t.onClosing=function(n,t){ht=n;n>0&&dt.css("display","block");f.empty();f.append(" <option value="+n+"  selected>"+t+"<\/option>");p=[];g(n,!1,0)});t=null}});$btnToContainerTree.on("click",function(){if(!$btnToContainerTree.hasClass("VIS_Tree-Container-disabled")){var r=o.val()=="0"||o.val()==null?0:parseInt(o.val()),u=e.val()=="0"||e.val()==null?0:parseInt(e.val()),t=new n.productContainerTree(r,u,null,null);t!=null&&(t.showDialog(),t.onClosing=function(n,t){i.empty();i.append(" <option value="+n+"  selected>"+t+"<\/option>")});t=null}});l.change(function(){this.checked?(w2ui[grdname].lock(""),t(this).prop("checked",!0),y.prop("checked",!1)):(w2ui[grdname].unlock(""),t(this).prop("checked",!1))});y.change(function(){this.checked?(w2ui[grdname].lock(""),t(this).prop("checked",!0),l.prop("checked",!1)):(w2ui[grdname].unlock(""),t(this).prop("checked",!1))});bi()}function gi(){var i=n.context.getWindowContext(a.windowNo,"DTD001_MWarehouseSource_ID",!0);t.ajax({type:"POST",url:n.Application.contextUrl+"ProductContainer/LoadWarehouse",data:{fromWarehouse_ID:i},dataType:"json",success:function(t){var r=JSON.parse(t),i;if(r)for(i=0;i<r.length;i++)key=n.Utility.Util.getValueOfInt(r[i].ID),value=n.Utility.Util.getValueOfString(r[i].Name),w.append(" <option value="+key+">"+value+"<\/option>");w.prop("selectedIndex",0)},error:function(n){r("hidden");console.log(n)}})}function nr(){var i=n.context.getWindowContext(a.windowNo,"DTD001_MWarehouseSource_ID",!0);t.ajax({type:"POST",url:n.Application.contextUrl+"ProductContainer/LoadLocator",data:{fromWarehouse_ID:i},dataType:"json",success:function(t){var r=JSON.parse(t),i;if(r)for(u.empty(),u.append("<option value= 0 >Select<\/option>"),i=0;i<r.length;i++)key=n.Utility.Util.getValueOfInt(r[i].ID),value=n.Utility.Util.getValueOfString(r[i].Name),u.append(" <option value="+key+">"+value+"<\/option>");else u.append("<option value= 0 >Select<\/option>");u.prop("selectedIndex",0)},error:function(n){r("hidden");console.log(n)}})}function tr(){var i=n.context.getWindowContext(a.windowNo,"M_Warehouse_ID",!0);i==""&&(i=0);t.ajax({type:"POST",url:n.Application.contextUrl+"ProductContainer/LoadWarehouse",data:{fromWarehouse_ID:i},dataType:"json",success:function(t){var r=JSON.parse(t),i;if(r)for(o.append("<option value= 0 >Select<\/option>"),i=0;i<r.length;i++)key=n.Utility.Util.getValueOfInt(r[i].ID),value=n.Utility.Util.getValueOfString(r[i].Name),o.append(" <option value="+key+">"+value+"<\/option>");else o.append("<option value= 0 >Select<\/option>");o.prop("selectedIndex",0)},error:function(n){r("hidden");console.log(n)}})}function ui(){var i=o.val()=="0"||o.val()==null?0:parseInt(o.val());t.ajax({type:"POST",url:n.Application.contextUrl+"ProductContainer/LoadLocator",data:{fromWarehouse_ID:i},dataType:"json",success:function(t){var r=JSON.parse(t),i;if(r)for(e.empty(),e.append("<option value= 0 >Select<\/option>"),i=0;i<r.length;i++)key=n.Utility.Util.getValueOfInt(r[i].ID),value=n.Utility.Util.getValueOfString(r[i].Name),e.append(" <option value="+key+">"+value+"<\/option>");else e.append("<option value= 0 >Select<\/option>");e.prop("selectedIndex",0)},error:function(n){r("hidden");console.log(n)}})}function g(i,f,e){s=1;k=1;st=0;ni=!1;var o=parseInt(n.context.getWindowContext(a.windowNo,"AD_Org_ID",!0)),h=n.context.getWindowContext(a.windowNo,"MovementDate",!0),c=u.val()=="0"||u.val()==null?0:parseInt(u.val());f&&(s=parseInt(cmbPage.val()),e!=0&&(e==-1?(s=s-1,s<1&&(s=1)):e==1&&(s=s+1,s>ti&&(s=ti))));t.ajax({type:"POST",url:n.Application.contextUrl+"ProductContainer/MoveContainer",data:{container:i,movementDate:h,AD_Org_ID:o,locator:c,page:s,size:gt},dataType:"json",success:function(n){var u=JSON.parse(n),i;if(u){if(s==1&&u.length>0&&(st=u[0].ContainerRecord,k=Math.ceil(st/gt)),ir(u),f)ot=s,cmbPage.val(ot),ot>1?liPrevPage.css("opacity","1"):liPrevPage.css("opacity","0.6"),r("hidden");else{if(ti=k,liCurrPage.find("option").remove(),k>0)for(i=0;i<k;i++)cmbPage.append(t("<option value="+(i+1)+">"+(i+1)+"<\/option>"));ki(ot,k);cmbPage.val(s)}ni=!0}},error:function(n){r("hidden");console.log(n)}})}function ir(i){var f=[],e=[],r,u,o;for(f.push({field:"ProductName",caption:n.Msg.translate(n.Env.getCtx(),"ProductName"),size:"20%"}),f.push({field:"ASI",caption:n.Msg.translate(n.Env.getCtx(),"ASI"),size:"15%"}),f.push({field:"UomName",caption:n.Msg.translate(n.Env.getCtx(),"UomName"),size:"15%"}),f.push({field:"ContainerQty",caption:n.Msg.translate(n.Env.getCtx(),"ContainerQty"),size:"10%"}),f.push({field:"MoveQty",caption:n.Msg.translate(n.Env.getCtx(),"MoveQty"),editable:{type:"float"},render:"number:4",sortable:!1,size:"10%"}),f.push({field:"M_ProductContainer_ID",caption:n.Msg.translate(n.Env.getCtx(),"M_ProductContainer_ID"),hidden:!0}),f.push({field:"M_PRODUCT_ID",caption:n.Msg.translate(n.Env.getCtx(),"M_PRODUCT_ID"),hidden:!0}),f.push({field:"M_AttributeSetInstance_ID",caption:n.Msg.translate(n.Env.getCtx(),"M_AttributeSetInstance_ID"),size:"15%",hidden:!0}),f.push({field:"C_Uom_ID",caption:n.Msg.translate(n.Env.getCtx(),"C_Uom_ID"),size:"15%",hidden:!0}),f.push({field:"M_Transaction_ID",caption:n.Msg.translate(n.Env.getCtx(),"M_Transaction_ID"),size:"15%",hidden:!0}),r=0;r<i.length;r++)u={},u.ProductName=i[r].ProductName,u.ASI=i[r].ASI,u.UomName=i[r].UomName,u.ContainerQty=i[r].ContainerQty,u.M_ProductContainer_ID=i[r].M_ProductContainer_ID,u.M_Product_ID=i[r].M_Product_ID,u.M_AttributeSetInstance_ID=i[r].M_AttributeSetInstance_ID,u.C_Uom_ID=i[r].C_Uom_ID,p.length>0?(o=t.map(p,function(n){if(n.M_Product_ID==i[r].M_Product_ID&&n.M_AttributeSetInstance_ID==i[r].M_AttributeSetInstance_ID)return n}),u.MoveQty=o.length>0?o[0].MoveQty:0):u.MoveQty=0,u.recid=r+1,e[r]=u;grdname="MCont_gridContainer"+Math.random();grdname=grdname.replace(".","");w2utils.encodeTags(e);ri=ut.w2grid({name:grdname,recordHeight:20,show:{toolbar:!1,columnHeaders:!0,lineNumbers:!0,selectColumn:!1,toolbarReload:!1,toolbarColumns:!0,toolbarSearch:!1,toolbarAdd:!1,toolbarDelete:!1,toolbarSave:!1,selectionBorder:!1,recordTitles:!1},columns:f,records:e,multiSelect:!1,onClick:function(){},onChange:function(t){if(t.column==4&&t.value_new&&t.value_new!=0){var i=t.value_new,r=w2ui[grdname].get(t.recid).ContainerQty;if(r<0&&i>0)return n.ADialog.error("VIS_CantbePositive"),t.value_new=0,!1;if(Math.abs(i)>Math.abs(r))return n.ADialog.error("VIS_CantGreater"),t.value_new=0,!1;rr(i,t.recid)}}});(l.is(":checked")||y.is(":checked"))&&w2ui[grdname].lock("")}function fi(){var s=[],o=l.is(":checked"),h=!1,k,d,v,b,w,c;if(h=y.is(":checked"),o&&f.val()==null)return n.ADialog.error("VIS_FullContainerMove",!0,"",""),!1;if(k=f.val()=="0"||f.val()==null?0:parseInt(f.val()),d=i.val()=="0"||i.val()==null?0:parseInt(i.val()),k==d)return n.ADialog.error("VIS_ContainerCantSame",!0,"",""),!1;if(v=p.length,v==0&&!o&&!h)return n.ADialog.error("VIS_MoveQtyNotSelected",!0,"",""),!1;if(b=n.context.getWindowContext(a.windowNo,"M_Movement_ID",!0),v>0||o||h){if(!o&&!h&&v>0&&(t.each(p,function(){this.ToLocator=parseInt(e.val());this.ToContainer=i.val()=="0"||i.val()==null?0:parseInt(i.val())}),s=p),o||h){for(s=[],w=0;w<w2ui[grdname].records.length;w++){c=w2ui[grdname].records[w];s.push({M_Product_ID:c.M_Product_ID,M_AttributeSetInstance_ID:c.M_AttributeSetInstance_ID,C_UOM_ID:c.C_Uom_ID,FromLocator:parseInt(u.val()),ToLocator:parseInt(e.val()),FromContainer:f.val()=="0"||f.val()==null?0:parseInt(f.val()),ToContainer:i.val()=="0"||i.val()==null?0:parseInt(i.val()),MoveQty:c.ContainerQty,M_Movement_ID:b,IsFullMoveContainer:o?!0:!1,IsfullContainerQtyWise:h?!0:!1});break}s.length==0&&o&&s.push({M_Product_ID:0,M_AttributeSetInstance_ID:0,C_UOM_ID:0,FromLocator:parseInt(u.val()),ToLocator:parseInt(e.val()),FromContainer:f.val()=="0"||f.val()==null?0:parseInt(f.val()),ToContainer:i.val()=="0"||i.val()==null?0:parseInt(i.val()),MoveQty:0,M_Movement_ID:b,IsFullMoveContainer:o?!0:!1,IsfullContainerQtyWise:h?!0:!1})}if(s.length==0)return n.ADialog.error("VIS_MoveQtyNotSelected",!0,"",""),!1;t.ajax({url:n.Application.contextUrl+"ProductContainer/SaveMoveData",type:"POST",data:{moveData:JSON.stringify(s)},success:function(t){JSON.parse(t)=="VIS_SuccessFullyInserted"?n.ADialog.info("VIS_SuccessFullyInserted",!0,"",""):n.ADialog.error("Error",!0,n.Msg.translate(n.Env.getCtx(),"VIS_NotInserted")+" - "+t,"");l.prop("checked",!1);y.prop("checked",!1);p=[];a.frame.close()},error:function(){p=[];a.frame.close();r("hidden")}})}}function rr(t,r){var s=l.is(":checked"),h=y.is(":checked"),c=n.context.getWindowContext(a.windowNo,"M_Movement_ID",!0),v=w2ui[grdname].getChanges().length,o;t!=0&&(o=w2ui[grdname].get(r),p.push({M_Product_ID:o.M_Product_ID,M_AttributeSetInstance_ID:o.M_AttributeSetInstance_ID,C_UOM_ID:o.C_Uom_ID,FromLocator:parseInt(u.val()),ToLocator:parseInt(e.val()),FromContainer:f.val()=="0"||f.val()==null?0:parseInt(f.val()),ToContainer:i.val()=="0"||i.val()==null?0:parseInt(i.val()),MoveQty:t,M_Movement_ID:c,IsFullMoveContainer:s?!0:!1,IsfullContainerQtyWise:h?!0:!1}))}function r(n){ii[0].style.visibility=n}this.frame;this.windowNo;var a=this,ct=t("<div style='height:100%;background-color:white;' class='vis-forms-container' >"),ii=t("<div class='vis-apanel-busy' style='height:100%;position:relative;z-index: 2'>"),tt=null,b=null,h=null,c=null,v=null,it=null,lt=null,w=null,at=null,o=null,vt=null,u=null,yt=null,e=null,d=null,pt=null,f=null,wt=null,i=null,ei=null,oi=null,si=null,hi,ci=null,l=null,bt=null,y=null,kt=null,li=null,ai=null,rt=null,ut=null,ri=null;this.grdname;var ft=null,nt=null,vi=null,et=null,yi=null,dt=null,gt=50,ot=1,s=1,k=1,st=0,ni=!1,ti=1,ht=0,p=[];this.Initialize=function(){r("visible");pi();di();r("hidden")};this.setHeight=function(){return 700};this.getRoot=function(){return ct};disposeComponent=function(){tt=null;b=null;h=null;c=null;v=null;it=null;lt=null;w=null;at=null;o=null;vt=null;u=null;yt=null;e=null;pt=null;f=null;wt=null;i=null;ei=null;oi=null;si=null;hi;ci=null;l=null;bt=null;y=null;kt=null;li=null;ai=null;rt=null;ut=null;ri=null;this.grdname=null;ft=null;nt=null;vi=null;et=null;yi=null;gt=null;s=null;k=null;st=null;ni=null;a=null;ct=null}}n.AForms=n.AForms||{};i.prototype.init=function(n,t){this.frame=t;this.windowNo=n;var i=this.Initialize();this.frame.getContentGrid().append(this.getRoot())};i.prototype.dispose=function(){disposeComponent();this.frame=null};n.AForms.productContainerMove=i}(VIS,jQuery),function(n,t){function i(i,r,u,f){function et(n){var t;return n=n.toUpperCase(),n.contains("M_LOCATOR_ID")?t=n.substr(n.indexOf("M_LOCATOR_ID=")+13,n.length):n.contains("M_LOCATORTO_ID")&&(t=n.substr(n.indexOf("M_LOCATORTO_ID=")+15,n.length)),t!=undefined&&(t=t.contains("AND")?t.substr(0,t.indexOf("AND")).trim():t.trim()),t}function g(u){t.ajax({url:n.Application.contextUrl+"ProductContainer/LoadContainerAsTree",type:"GET",datatype:"json",contentType:"application/json; charset=utf-8",data:{warehouse:i,locator:r,container:0,validation:f},success:function(n){u(n)},error:function(){n.ADialog.error("VIS_ErrorLoadingFromController")}})}function nt(n){var r,i,e,f;for(o='<div id=containerParent style="width:100%;height:400px"><div><div class="well VIS_tree-container" style="width:100%; padding: 8px 0;float: left;"><div id=containerParent1 style="overflow-y: auto;height: 383px;"><ul class="nav nav-list">',r=JSON.parse(n),i=0;i<r.length;i++)if(i==0){w(r[i],r[i].Level);continue}else if(r[i-1].Level<r[i].Level){o+='<ul class="nav nav-list tree" style="display: none;">';w(r[i],r[i].Level);i+1==r.length&&(o+="<\/li> <\/ul>");continue}else if(r[i-1].Level==r[i].Level&&r[i].Level!=1){o+="<\/li>";w(r[i],r[i].Level);i+1==r.length&&(o+="<\/li>");continue}else if(r[i-1].Level>r[i].Level&&r[i].Level!=1){if(r[i-1].Level>r[i].Level)for(e=r[i-1].Level-r[i].Level,f=0;f<e;f++)tt();w(r[i],r[i].Level);i+1==r.length&&(o+="<\/li>");continue}else if(r[i].Level==1){if(r[i-1].Level>r[i].Level)for(e=r[i-1].Level-1,f=0;f<e;f++)tt();o+="<\/li>";o+='<li class="divider"><\/li>';w(r[i],r[i].Level);i+1==r.length&&(o+="<\/li>");continue}o+="<\/ul> <\/div> <\/div> <\/div> <\/div>";t("#VIS_ContainerParentChild").html(o);h=t("#VIS_ContainerParentChild")[0];t("label.tree-toggler").click(function(){var n=t(h);n.find(".nav-header").removeClass("current");t(t(this)).addClass("current");t(this).parent().children("ul.tree").toggle(300)});b.click(function(){c.val()!=""&&it(t(h),c.val());c.val()==""&&t(h).find(".nav-header").removeClass("current")});u&&b.trigger("click");t(document).keypress(function(n){var i=n.keyCode?n.keyCode:n.which;i==13&&n.preventDefault();i=="13"&&c.val()!=""&&it(t(h),c.val())});t(document).keyup(function(){$NameInput.val()!=""?$NameInput.css("background-color",rt(!1)):$NameInput.css("background-color",rt(!0))})}function w(n,t){o+=t==1?"<li data-value="+n.M_ProductContainer_ID+' class="First">':"<li data-value="+n.M_ProductContainer_ID+">";o+='<label class="tree-toggler nav-header" for='+n.M_ProductContainer_ID+">"+n.ContainerName+'<span class="vis-treewindow-span"><span class="vis-css-treewindow-arrow-up"><\/span><\/span><\/label>'}function tt(){o+="<\/li> <\/ul>"}function it(n,i){var r=n.find("label:contains('"+i+"')");t("label").removeClass("current");r.addClass("current");t(r).parents(".First").find("ul.tree:last-child").css("display")=="none"?(t(r).parents(".First").find("ul.tree:last-child").toggle(),t(r).parents(".First").find("ul.tree:last-child").css("display","block")):t(r).parents(".First").find("ul.tree:last-child").css("display","block");r[0].scrollIntoView()}function ot(u,f,e,o,s){t.ajax({url:n.Application.contextUrl+"ProductContainer/SaveContainer",datatype:"json",async:!1,contentType:"application/json; charset=utf-8",data:{warehouseId:i,locatorId:r,value:u,name:f,height:e,width:o,parentContainerId:s},success:function(i){JSON.parse(i)==""?(n.ADialog.info("VIS_ContainerInserted",!0,"",""),t(h).empty(),h=t("<div id='VIS_ContainerParentChild' style='height:400px; float: left; width: 100%;'><\/div>"),g(nt),ut(),ft()):n.ADialog.error("",!0,JSON.parse(i),"")},error:function(){n.ADialog.error("VIS_ErrorLoadingFromController")}})}function rt(n){return n?"#FFB6C1":"White"}function ut(){y=e.find("#AddNewContainer");y[0].style.display="none";a[0].style.display="block";l[0].style.display="none";v[0].style.display="none";e.find("#VIS_DialogOKCancelProductContainer")[0].style.display="block";e.find("#containerParent").css("height","400px");e.find("#containerParent1").css("height","383px");e.find("#VIS_ContainerParentChild").css("height","397px");p[0].style.display="none"}function st(){y=e.find("#AddNewContainer");y[0].style.display="block";a[0].style.display="none";l[0].style.display="block";v[0].style.display="block";e.find("#VIS_DialogOKCancelProductContainer")[0].style.display="none";e.find("#containerParent").css("height","295px");e.find("#containerParent1").css("height","275px");e.find("#VIS_ContainerParentChild").css("height","295px");p[0].style.display="block"}function ft(){$searchInput.val("");$NameInput.val("");$HeightInput.val("");$WidthInput.val("")}var d=this;this.onClose=null;this.onClosing=null;var e=null,s=null,o,h=null,b=null,c=null,l=null,a=null,v=null,y=null,k,p=null;this.showDialog=function(){var o,w="",y,tt;f!=null?o=et(f):r>0&&(o=r);o!=null&&(w=n.dataContext.getJSONRecord("ProductContainer/GetWarehouseAndLocatorName",o));e=t("<div style='float: left; width: 100%;min-height:480px; max-height:480px !important'><\/div>");tt=t("<div id='AddNewContainer' style='float: left; width: 100%; display:none;'><div class='VIS_form-data-row'><div class='VIS_form-data-col'><label>"+n.Msg.translate(n.Env.getCtx(),"Value")+"<\/label><input id='VIS_SearchValue' type='text'/><\/div><div class='VIS_form-data-col'><label>"+n.Msg.translate(n.Env.getCtx(),"Name")+"<\/label><input id='VIS_Name' type='text' style='background-color:#FFB6C1'/><\/div><\/div><div class='VIS_form-data-row'><div class='VIS_form-data-col'><label>"+n.Msg.translate(n.Env.getCtx(),"Height")+"<\/label><input id='VIS_Height' type='Number'/><\/div><div class='VIS_form-data-col'><label>"+n.Msg.translate(n.Env.getCtx(),"Width")+"<\/label><input id='VIS_Width' type='Number'/><\/div><\/div><div class='VIS_form-data-row'><div class='VIS_form-data-col'><label>"+n.Msg.translate(n.Env.getCtx(),"Ref_M_Container_ID")+"<\/label><\/div><\/div><\/div>");y=t("<div class='VIS_form-data-row'><div class='VIS_form-search-wrap'><input class='VIS_form-search-wrap input' id='VIS_Search' type='text' placeholder='Search Here...'><button class='VIS_form-search-wrap button' id=VIS_BtnSearch title="+n.Msg.translate(n.Env.getCtx(),"VIS_Search")+"><i class='glyphicon glyphicon-search'><\/i><\/button><button class='VIS_form-search-wrap button' id=VIS_BtnAdd title="+n.Msg.translate(n.Env.getCtx(),"VIS_NewContainer")+"><i class='glyphicon glyphicon-plus'><\/i><\/button><button class='VIS_form-search-wrap button' style='display:none;' id=VIS_BtnSave title="+n.Msg.translate(n.Env.getCtx(),"VIS_SaveContainer")+"><i class='glyphicon glyphicon-floppy-disk'><\/i><\/button><button class='VIS_form-search-wrap button' style='display:none;' id=VIS_BtnCancel title="+n.Msg.translate(n.Env.getCtx(),"VIS_Cancel")+"><i class='glyphicon glyphicon-remove'><\/i><\/button><\/div><\/div>");h=t("<div id='VIS_ContainerParentChild' class='VIS_Tree-Container' ><\/div>");k=t("<div id='VIS_DialogOKCancelProductContainer' class='VIS_buttons-wrap VIS_pop-btn-wrap' style='display:block; margin-right: -7px'> <span class='btn' id=VIS_DialogOK>"+n.Msg.translate(n.Env.getCtx(),"VIS_DialogOK")+"<\/span> <span class='btn' id=VIS_DialogCancel>"+n.Msg.translate(n.Env.getCtx(),"VIS_DialogCancel")+"<\/span> <\/div>");p=t("<div id='VIS_LabelInfo' class='VIS_Tree-Container-labelInfo'><label>"+w+"<\/label><\/div>");y.append(h);e.append(tt).append(y).append(k).append(p);s=new n.ChildDialog;s.setContent(e);s.setTitle(n.Msg.translate(n.Env.getCtx(),"VIS_Container"));s.setWidth("450px");s.setEnableResize(!1);s.setModal(!0);s.show();s.hidebuttons();b=e.find("#VIS_BtnSearch");c=e.find("#VIS_Search");$searchInput=e.find("#VIS_SearchValue");$NameInput=e.find("#VIS_Name");$HeightInput=e.find("#VIS_Height");$WidthInput=e.find("#VIS_Width");a=e.find("#VIS_BtnAdd");l=e.find("#VIS_BtnSave");v=e.find("#VIS_BtnCancel");$DialogbtnOk=e.find("#VIS_DialogOK");$DialogbtnCancel=e.find("#VIS_DialogCancel");$DialogbtnOk.click(function(){var i=h,r=t(i).find(".current").length,u,f;if(r>1)return n.ADialog.error("VIS_SelectSingleContainer",!0,"",""),!1;if(r>0){u=parseInt(t(i).find(".current")[0].htmlFor);f=t(t(i).find(".current")[0]).text();d.onClosing(u,f);s.close()}else s.close()});$DialogbtnCancel.click(function(){s.close()});u&&c.val(u);g(nt);a.click(function(){st()});v.click(function(){ut();ft()});l.click(function(){var s,u;if($NameInput.val()=="")return n.ADialog.error("VIS_ContainerNameNotSelected",!0,"",""),!1;if(s=f,i==""&&r==""&&f=="")return n.ADialog.error("VIS_WarehouseOrLocatorNotFound",!0,"",""),!1;f!=null&&(f=f.toUpperCase(),f.contains("M_LOCATOR_ID")?u=f.substr(f.indexOf("M_LOCATOR_ID=")+13,f.length):f.contains("M_LOCATORTO_ID")&&(u=f.substr(f.indexOf("M_LOCATORTO_ID=")+15,f.length)),u!=undefined&&(r=u.contains("AND")?u.substr(0,u.indexOf("AND")).trim():u.trim(),parseInt(r)==0&&n.ADialog.error("VIS_WarehouseOrLocatorNotFound",!0,"","")));var e=h,c=t(e).find(".current").length,o=0;if(c<=1)t(e).find(".current")[0]!=undefined&&(o=parseInt(t(e).find(".current")[0].htmlFor));else return n.ADialog.error("VIS_SelectSingleContainer",!0,"",""),!1;ot($searchInput.val(),$NameInput.val(),$HeightInput.val()==""?0:$HeightInput.val(),$WidthInput.val()==""?0:$WidthInput.val(),o)})};jQuery.expr[":"].contains=function(n,t,i){return jQuery(n).text().toUpperCase().indexOf(i[3].toUpperCase())>=0};this.disposeComponent=function(){d=null;e=null;s=null;o;h=null;b=null;c=null;p=null;l=null;a=null;v=null;y=null;k;this.disposeComponent=null}}i.prototype.dispose=function(){this.disposeComponent()};n.productContainerTree=i}(VIS,jQuery),function(n,t){function i(i,r,u,f){function v(){h=t("<div class='vis-height-full'>");c=t("<div class='vis-apanel-busy'>");s=t("<div class='vis-height-full'>");h.append(s).append(c);e=new n.ChildDialog;y()}function y(){n.dataContext.getFormDataString({AD_Form_ID:r},function(i){if(i.error!=null){n.ADialog.error(i.error);o.dispose();o=null;return}var r=t.parseJSON(i.result);if(r.IsError){n.ADialog.error(r.Message);o.dispose();o=null;return}e.setTitle(r.DisplayName);openForm(r,o,f);r=null})}function p(n){e.setContent(s);n.setHeight?e.setHeight(n.setHeight()):e.setHeight(i);n.setWidth?e.setWidth(n.setWidth()):e.setWidth(window.innerWidth-100);e.setModal(!0);e.onClose=function(){n.dispose&&n.dispose();e.dispose&&e.dispose();u.dataRefresh();o.disposeComponent&&o.disposeComponent()};e.show();e.hidebuttons()}var h,c,s,e,a=n.Env.getCtx(),l=n.Logging.VLogger.getVLogger("VIS.AForm"),o=this;v();this.getContentGrid=function(){return s};this.close=function(){e&&e.close()};this.disposeComponent=function(){h.remove();h=null;s.remove();s=null;this.getContentGrid=null;o=null};openForm=function(t,i,r){var e,h,s;if(t.IsReport)return n.ADialog.info("Form Report is not supported"),!1;e="";e=t.Prefix+t.ClassName;console.log(e);l.info("Form Name= "+t.Name+", Class="+e);a.setWindowContext(f,"WindowName",t.DisplayName);try{h=n.Utility.getFunctionByName(e,window);s=new h(r);s.init(r,o);s.setRecordID&&s.setRecordID(u.getRecord_ID());p(s)}catch(c){return l.log(n.Logging.Level.WARNING,"Class="+e+", AD_Form Name="+t.Name,c),!1}return!0}}n.WForm=i}(VIS,jQuery);VIS=window.VIS||{},function(){function n(){this.record_ID=0;this.windowNo=0;this.curTab=null;this.selectedRow=null;this.panelWidth;var t=null,i=null,r=null,u=null,f=null,n=$('<div style="height:100%;width:100%;padding:15px"><\/div>');this.init=function(){var e='<div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Name: <\/span><label class="vis-testPanel-Label" id="'+this.windowNo+'lblName"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Location: <\/span><label class="vis-testPanel-Label" id="'+this.windowNo+'lblLocation"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Business Partner: <\/span><label class="vis-testPanel-Label" id="'+this.windowNo+'lblBPartner"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Date Time: <\/span><label class="vis-testPanel-Label" id="'+this.windowNo+'lblDateTime"><\/label> <\/div><div class="vis-testPanel-Div"><span class="vis-testPanel-Span">Amount: <\/span><label class="vis-testPanel-Label" id="'+this.windowNo+'lblAmount"><\/label> <\/div>';n.append(e);t=n.find("#"+this.windowNo+"lblName");i=n.find("#"+this.windowNo+"lblLocation");r=n.find("#"+this.windowNo+"lblBPartner");u=n.find("#"+this.windowNo+"lblDateTime");f=n.find("#"+this.windowNo+"lblAmount")};this.getRoot=function(){return n};this.update=function(){var n,e;t.text(VIS.context.getWindowContext(this.windowNo,"Name"));try{e="C_Location_ID";n=this.selectedRow[e.toLower()];(VIS.DisplayType.IsLookup(this.curTab.getField(e).getDisplayType())||VIS.DisplayType.Location==this.curTab.getField(e).getDisplayType())&&(n&&(n=this.curTab.getField(e.toLower()).lookup.getDisplay(n)),i.text(n));n=null;e="C_BPartner_ID";n=this.selectedRow[e.toLower()];(VIS.DisplayType.IsLookup(this.curTab.getField(e).getDisplayType())||VIS.DisplayType.Location==this.curTab.getField(e).getDisplayType())&&(n&&(n=this.curTab.getField(e.toLower()).lookup.getDisplay(n)),r.text(n));n=null;e="T_DateTime";VIS.DisplayType.IsDate(this.curTab.getField(e).getDisplayType())&&(n=this.curTab.getField(e).value,n=new Date(n).toLocaleString(),u.text(n));n=null;e="T_Amount";n=this.selectedRow[e.toLower()];f.text(n)}catch(o){}};this.disposeComponent=function(){this.record_ID=0;this.windowNo=0;this.curTab=null;this.rowSource=null;this.panelWidth=null;t.remove();t=null;i.remove();i=null;r.remove();r=null;u.remove();u=null;f.remove();f=null;n.remove();n=null}}n.prototype.startPanel=function(n,t){this.windowNo=n;this.curTab=t;this.init()};n.prototype.refreshPanelData=function(n,t){this.record_ID=n;this.selectedRow=t;this.update(n)};n.prototype.sizeChanged=function(n){this.panelWidth=n};n.prototype.dispose=function(){this.disposeComponent()};VIS.TestPanel=n}(),function(n,t){VIS.VApp=function(){function i(){var n=t.context.getAD_Language().replace("_","-");Globalize.culture(n)}function r(){document.getElementById("vis_mainConatiner").removeChild(document.getElementById("vis_busyGrid"));var t=n("#vis_antiForgeryToken").val();n.ajaxSetup({headers:{VerificationToken:t}});VIS.Application.isIOS=/ipad|iphone|ipod/i.test(navigator.userAgent.toLowerCase())}function u(){var n=t.Logging;n.VLogMgt.initialize(!0);n.VLogMgt.setLevel(VIS.Ini.getTraceLevel())}function f(){VIS.Ini.updateLocalContextFromIni()}function e(){r();i();f();u();VIS.desktopMgr.start();VIS.Env.setWINDOW_PAGE_SIZE(VIS.Ini.getLocalStorage(VIS.IniConstants.WIN_PAGESIZE))}return{init:e}}()}(jQuery,VIS),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutOrder")}var f=n.Logging.Level,t=n.Utility.Util,u=!1,r=0;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.DocType=function(i,r,u,e,o,s){var d="PR",y="WR",it="F",b,k,a,g,tt,c,ft;if(this.isCalloutActive()||o==null||o.toString()==""||(b=t.getValueOfInt(o),b==null||b==0))return"";this.setCalloutActive(!0);k=t.getValueOfString(u.getValue("DocumentNo"));a=k==null;!a&&k.startsWith("<")&&k.endsWith(">")&&(a=!0);var rt=t.getValueOfInt(u.getValue("C_DocType_ID")),p="SELECT d.DocSubTypeSO,d.HasCharges,'N',d.IsDocNoControlled,s.CurrentNext,s.CurrentNextSys,s.AD_Sequence_ID,d.IsSOTrx, d.IsReturnTrx, d.value, d.IsBlanketTrx FROM C_DocType d LEFT OUTER JOIN AD_Sequence s ON (d.DocNoSequence_ID=s.AD_Sequence_ID) WHERE C_DocType_ID=@param1",h=null,v=[];try{g=0;a||t.getValueOfInt(rt)==0||(v[0]=new n.DB.SqlParam("@param1",rt),h=n.DB.executeReader(p,v),h.read()&&(g=t.getValueOfInt(h.get("currentnextsys"))),h.close());v[0]=new n.DB.SqlParam("@param1",b);h=n.DB.executeReader(p,v);v.length=0;v=null;var l="",w=!0,nt=!1,ut="";if(h.read()&&(l=h.get("docsubtypeso"),ut=h.get("value"),l==null&&(l="--"),i.setContext(r,"OrderType",l),i.setContext(r,"DocTypeValue",ut),l=="BO"?(i.setContext(r,"BlanketOrderType",l),u.setValue("BlanketOrderType",l)):(i.setContext(r,"BlanketOrderType","OO"),u.setValue("BlanketOrderType","OO")),!l=="SO"&&u.setValue("IsDropShip","N"),"N"==h.get("issotrx")&&(w=!1),nt=h.get("isreturntrx")=="Y"?!0:!1,nt?l==y?u.setValue("DeliveryRule",it):u.setValue("DeliveryRule","M"):(l==y?u.setValue("DeliveryRule",it):l==d?u.setValue("DeliveryRule","R"):u.setValue("DeliveryRule","A"),l==y||l==d||l=="WI"?u.setValue("InvoiceRule","I"):u.setValue("InvoiceRule","D"),l==y?u.setValue("PaymentRule","B"):u.setValue("PaymentRule","P"),i.setContext(r,"HasCharges",t.getValueOfString(h.get("hascharges")))),h.get("isdocnocontrolled")=="Y"&&(a||g==t.getValueOfInt(h.get("ad_sequence_id"))||(a=!0),a&&(n.Ini.getLocalStorage(n.IniConstants.P_VIENNASYS)&&i.getAD_Client_ID()<1e6?u.setValue("DocumentNo","<"+h.tables[0].rows[0].cells.currentnextsys+">"):u.setValue("DocumentNo","<"+h.tables[0].rows[0].cells.currentnext+">")))),h.close(),nt)return this.setCalloutActive(!1),"";l==y||l==d||(tt=i.getContextAsInt(r,"C_BPartner_ID"),p="SELECT PaymentRule,C_PaymentTerm_ID,InvoiceRule,DeliveryRule,FreightCostRule,DeliveryViaRule, PaymentRulePO,PO_PaymentTerm_ID FROM C_BPartner WHERE C_BPartner_ID="+tt,tt!=0&&(h=n.DB.executeReader(p,null)),h.read()&&(c=h.get(w?"paymentrule":"paymentrulepo"),c!=null&&c.length!=0&&((w&&c=="B"||c=="S"||c=="U")&&(c="P"),w||c!="B"||(c="P"),u.setValue("PaymentRule",c)),ft=h.get(w?"c_paymentterm_id":"po_paymentterm_id"),h!=null&&u.setValue("C_PaymentTerm_ID",ft),c=h.get("invoicerule"),c!=null&&c.length!=0&&u.setValue("InvoiceRule",c),c=h.get("deliveryrule"),c!=null&&c.length!=0&&u.setValue("DeliveryRule",c),c=h.get("freightcostrule"),c!=null&&c.length!=0&&u.setValue("FreightCostRule",c),c=h.get("deliveryviarule"),c!=null&&c.length!=0&&u.setValue("DeliveryViaRule",c)),h.close())}catch(et){return this.setCalloutActive(!1),h!=null&&(h.close(),h=null),this.log.log(f.SEVERE,p,et),et}return this.setCalloutActive(!1),i=r=u=e=o=s=null,""};i.prototype.BlanketOrderLine=function(i,r,u,f,e,o){var s=null,v,nt,rt,p,ut,ft,g;if(this.isCalloutActive()||e==null||e.toString()=="")return"";try{if(v=0,e!=null&&(v=t.getValueOfInt(e.toString())),v==0)return"";if(this.setCalloutActive(!0),nt=v.toString(),s=n.dataContext.getJSONRecord("MOrderLine/GetOrderLine",nt),s!=null){var l=t.getValueOfInt(s.M_Product_ID),h=t.getValueOfInt(s.Qty),y=t.getValueOfInt(s.QtyOrdered),a=t.getValueOfInt(s.QtyReleased),tt=t.getValueOfDouble(s.PriceList),w=t.getValueOfDouble(s.PriceActual),c=t.getValueOfDouble(s.C_UOM_ID),it=t.getValueOfDouble(s.Discount),b=t.getValueOfDouble(s.PriceEntered),k=t.getValueOfInt(s.M_AttributeSetInstance_ID),d=t.getValueOfDouble(s.C_Tax_ID);QtyEntered=t.getValueOfDecimal(h);paramStr=c.toString().concat(",");rt=n.dataContext.getJSONRecord("MUOM/GetPrecision",paramStr);p=QtyEntered.toFixed(t.getValueOfInt(rt));QtyEntered!=p&&(this.log.fine("Corrected QtyEntered Scale UOM="+c+"; QtyEntered="+QtyEntered+"->"+p),QtyEntered=p);paramStr=l.toString().concat(",",c.toString(),",",QtyEntered.toString());ut=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",paramStr);y=ut;y==null&&(y=QtyEntered);ft=QtyEntered!=y;ft&&(paramStr=l.toString().concat(",",c.toString(),",",a.toString()),g=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",paramStr),g!=null&&(a=g));l!=0&&l!=null&&u.setValue("M_Product_ID",l);h!=0&&h!=null&&u.setValue("QtyEntered",h);tt!=null&&u.setValue("PriceList",tt);w!=null&&(u.setValue("PriceActual",w),u.setValue("LineNetAmt",w*h));b!=null&&(u.setValue("PriceEntered",b),u.setValue("PriceEntered",b));it!=null&&u.setValue("Discount",it);c!=0&&c!=null&&u.setValue("C_UOM_ID",c);h!=0&&h!=null&&a!=null&&u.setValue("QtyBlanket",h+a-a);k!=0&&k!=null&&u.setValue("M_AttributeSetInstance_ID",k);d!=0&&d!=null&&u.setValue("C_Tax_ID",d)}}catch(et){return this.setCalloutActive(!1),et}return this.setCalloutActive(!1),o=null,this.Qty(i,r,u,f,u.getValue("QtyEntered"))};i.prototype.BlanketOrder=function(i,r,u,f,e,o){var s=null,h,rt,it;if(this.isCalloutActive()||e==null||e.toString()=="")return"";try{if(h=0,e!=null&&(h=t.getValueOfInt(e.toString())),h==0)return"";if(this.setCalloutActive(!0),rt=i.isSOTrx(r),it=h.toString(),s=n.dataContext.getJSONRecord("MOrder/GetOrder",it),s!=null){var l=t.getValueOfDouble(s.C_BPartner_ID),a=t.getValueOfDouble(s.M_PriceList_ID),v=t.getValueOfDouble(s.M_Warehouse_ID),y=t.getValueOfDouble(s.C_PaymentTerm_ID),p=t.getValueOfDouble(s.PaymentRule),w=t.getValueOfDouble(s.C_Payment_ID),b=t.getValueOfDouble(s.VA009_PaymentMethod_ID),k=t.getValueOfDouble(s.C_Currency_ID),d=t.getValueOfDouble(s.C_Project_ID),g=t.getValueOfDouble(s.C_Campaign_ID);c;var c=t.getValueOfDouble(s.C_ProjectRef_ID),nt=t.getValueOfDouble(s.SalesRep_ID),tt=t.getValueOfDouble(s.PriorityRule);l!=0&&l!=null&&u.setValue("C_BPartner_ID",l);a!=0&&a!=null&&u.setValue("M_PriceList_ID",a);v!=0&&v!=null&&u.setValue("M_Warehouse_ID",v);y!=0&&y!=null&&u.setValue("C_PaymentTerm_ID",y);p!=0&&p!=null&&u.setValue("PaymentRule",p);w!=0&&w!=null&&u.setValue("C_Payment_ID",w);b!=0&&b!=null&&u.setValue("VA009_PaymentMethod_ID",b);k!=0&&k!=null&&u.setValue("C_Currency_ID",k);d!=0&&d!=null&&u.setValue("C_Project_ID",d);g!=0&&g!=null&&u.setValue("C_Campaign_ID",g);c!=0&&c!=null&&u.setValue("C_ProjectRef_ID",c);nt!=0&&nt!=null&&u.setValue("SalesRep_ID",nt);tt!=0&&tt!=null&&u.setValue("PriorityRule",tt);u.getField("C_IncoTerm_ID")!=null&&u.setValue("C_IncoTerm_ID",t.getValueOfInt(s.C_IncoTerm_ID))}}catch(ut){return this.setCalloutActive(!1),ut}return this.setCalloutActive(!1),o=null,this.BPartner(i,r,u,f,u.getValue("C_BPartner_ID"))};i.prototype.BPartner=function(i,r,u,f,e,o){var c=null,h=null,vt,yt,b,et,ot,g,st,ht,k,ct,nt,lt,ut,pt,rt,tt,it,s,at,wt,a,bt;if(this.isCalloutActive()||e==null||e.toString()=="")return"";try{var p=0,l="N",ft="N";if((e!=null&&(p=t.getValueOfInt(e.toString())),p==0)||(vt=t.getValueOfBoolean(u.getValue("IsReturnTrx")),vt))return"";this.setCalloutActive(!0);var w=!1,k="VA009_",d=i.isSOTrx(r),h=n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix",k);if(h!=null&&(w=h.VA009_),k=w.toString()+","+p,h=n.dataContext.getJSONRecord("MBPartner/GetBPartnerOrderData",k),h!=null){if(yt=t.getValueOfInt(u.getValue("M_PriceList_ID")),a=t.getValueOfDecimal(u.getValue("C_Order_Blanket")),yt>0&&a>0||(b=t.getValueOfInt(d?h.M_PriceList_ID:h.PO_PriceList_ID),b!=0&&u.setValue("M_PriceList_ID",b)),u.setValue("Bill_BPartner_ID",p),et=t.getValueOfInt(h.Bill_Location_ID),et==0?(ot=t.getValueOfInt(h.Bill_BPartner_ID),ot>0&&u.setValue("Bill_BPartner_ID",ot)):u.setValue("Bill_Location_ID",et),g=t.getValueOfInt(h.C_BPartner_Location_ID),p.toString()==i.getContext("C_BPartner_ID")&&(st=i.getContext("C_BPartner_Location_ID"),st.length>0&&(g=t.getValueOfInt(st))),g==0?u.setValue("C_BPartner_Location_ID",null):(u.setValue("C_BPartner_Location_ID",g),"Y"==t.getValueOfString(h.IsShipTo)&&u.setValue("Bill_Location_ID",g)),ht=t.getValueOfInt(h.SalesRep_ID),ht>0&&u.setValue("SalesRep_ID",ht),w){var y=t.getValueOfInt(h.VA009_PaymentMethod_ID),v=n.dataContext.getJSONRecord("MBPartner/GetBPDetails",p);v!=null&&(l=t.getValueOfString(v.IsVendor),ft=t.getValueOfString(v.IsCustomer),d?l=="Y"?(y=0,c=null,ft=="Y"&&(y=t.getValueOfInt(v.VA009_PaymentMethod_ID),c=t.getValueOfString(v.VA009_PAYMENTBASETYPE))):ft=="Y"&&(y=t.getValueOfInt(v.VA009_PaymentMethod_ID),c=t.getValueOfString(v.VA009_PAYMENTBASETYPE)):l=="Y"?(y=t.getValueOfInt(v.VA009_PO_PaymentMethod_ID),c=t.getValueOfString(v.VA009_PAYMENTBASETYPEPO)):(y=0,c=null));y==0?(a=t.getValueOfInt(u.getValue("C_Order_Blanket")),a>0&&(k=w.toString()+","+a.toString(),h=n.dataContext.getJSONRecord("MOrder/GetPaymentMethod",k),h!=null&&(ct=t.getValueOfInt(h.VA009_PaymentMethod_ID),ct>0&&(u.setValue("VA009_PaymentMethod_ID",ct),c=t.getValueOfString(h.VA009_PaymentBaseType),c!="W"&&c!=null&&(u.setValue("PaymentMethod",c),l=="N"?u.setValue("PaymentRule",c):u.setValue("PaymentRulePO",c)))))):y==0?u.setValue("VA009_PaymentMethod_ID",null):(u.setValue("VA009_PaymentMethod_ID",y),c!="W"&&c!=null?(u.setValue("PaymentMethod",c),l=="N"?u.setValue("PaymentRule",c):u.setValue("PaymentRulePO",c)):(u.setValue("PaymentMethod","T"),l=="N"?u.setValue("PaymentRule","T"):u.setValue("PaymentRulePO","T")))}nt=t.getValueOfInt(h.AD_User_ID);p.toString()==i.getContext("C_BPartner_ID")&&(lt=i.getContext("AD_User_ID"),lt.length>0&&(nt=t.getValueOfInt(lt)));nt==0?u.setValue("AD_User_ID",null):(u.setValue("AD_User_ID",nt),u.setValue("Bill_User_ID",nt));d&&(ut=t.getValueOfString(h.CreditStatusSettingOn),ut=="CH"?(tt=t.getValueOfDouble(h.SO_CreditLimit),tt!=0&&(it=t.getValueOfDouble(h.CreditAvailable),it<=0&&n.ADialog.info("CreditOver"))):(pt=t.getValueOfInt(u.getValue("C_BPartner_Location_ID")),rt=n.dataContext.getJSONRecord("MBPartner/GetLocationData",pt.toString()),rt!=null&&(ut=t.getValueOfString(rt.CreditStatusSettingOn),ut=="CL"&&(tt=t.getValueOfDouble(rt.SO_CreditLimit),tt!=0&&(it=t.getValueOfDouble(rt.CreditAvailable),it<=0&&n.ADialog.info("CreditOver"))))));s=t.getValueOfString(h.POReference);s!=null&&s.length!=0&&u.setValue("POReference",s);s=t.getValueOfString(h.SO_Description);s!=null&&s.trim().length!=0&&u.setValue("Description",s);s=t.getValueOfString(h.IsDiscountPrinted);s!=null&&s.length!=0?u.setValue("IsDiscountPrinted",s):u.setValue("IsDiscountPrinted","N");at=i.getContext("OrderType");u.setValue("InvoiceRule","D");u.setValue("DeliveryRule","A");w?c!="W"&&c!=null?l=="N"?u.setValue("PaymentRule",c):u.setValue("PaymentRulePO",c):(l=="N"?u.setValue("PaymentRule","T"):u.setValue("PaymentRulePO","T"),u.setValue("PaymentMethod","T")):u.setValue("PaymentRule","P");at=="PR"?(u.setValue("InvoiceRule","I"),u.setValue("DeliveryRule","R")):at=="WR"?w?c!="W"&&c!=null?l=="N"?u.setValue("PaymentRule",c):u.setValue("PaymentRulePO",c):(l=="N"?u.setValue("PaymentRule","T"):u.setValue("PaymentRulePO","T"),u.setValue("PaymentMethod","T")):u.setValue("PaymentRule","B"):(w?c!="W"&&c!=null?l=="N"?u.setValue("PaymentRule",c):u.setValue("PaymentRulePO",c):(l=="N"?u.setValue("PaymentRule","T"):u.setValue("PaymentRulePO","T"),u.setValue("PaymentMethod","T")):(s=t.getValueOfString(d?h.PaymentRule:h.PaymentRulePO),s!=null&&s.length!=0&&(s=="B"&&(s="P"),(d&&s=="S"||s=="U")&&(s="P"),u.setValue("PaymentRule",s))),wt=t.getValueOfInt(u.getValue("C_PaymentTerm_ID")),a=t.getValueOfDecimal(u.getValue("C_Order_Blanket")),wt>0&&a>0||(b=t.getValueOfInt(d?h.C_PaymentTerm_ID:h.PO_PaymentTerm_ID),bt=this.checkAdvancePaymentTerm(t.getValueOfInt(u.getValue("C_DocTypeTarget_ID")),b),bt?b!=0&&u.setValue("C_PaymentTerm_ID",b):u.setValue("C_PaymentTerm_ID",null)),s=t.getValueOfString(h.InvoiceRule),s!=null&&s.length!=0&&u.setValue("InvoiceRule",s),s=t.getValueOfString(h.DeliveryRule),s!=null&&s.length!=0&&u.setValue("DeliveryRule",s),s=t.getValueOfString(h.FreightCostRule),s!=null&&s.length!=0&&u.setValue("FreightCostRule",s),s=t.getValueOfString(h.DeliveryViaRule),s!=null&&s.length!=0&&u.setValue("DeliveryViaRule",s))}}catch(kt){return this.setCalloutActive(!1),kt}return this.setCalloutActive(!1),o=null,this.BPartnerBill(i,r,u,f,u.getValue("Bill_BPartner_ID"))};i.prototype.BPartnerLoc=function(i,r,u,e,o,s){var h=null,l="",c,a,v,y,p,w;if(this.isCalloutActive()||o==null||o.toString()=="")return"";try{if((c=0,o!=null&&(c=t.getValueOfInt(o.toString())),c==0)||(a=t.getValueOfBoolean(u.getValue("IsReturnTrx")),a))return"";this.setCalloutActive(!0);v=i.isSOTrx(r);v&&(l="SELECT bp.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable FROM C_BPartner_Location p INNER JOIN C_BPartner bp ON (bp.C_BPartner_ID = p.C_BPartner_ID) WHERE p.C_BPartner_Location_ID = "+c,h=n.DB.executeReader(l),h.read()&&(y=h.getString("CreditStatusSettingOn"),y=="CL"&&(p=t.getValueOfDouble(h.get("so_creditlimit")),p!=0&&(w=t.getValueOfDouble(h.get("creditavailable")),h!=null&&w<=0&&n.ADialog.info("CreditOver",null,"","")))))}catch(b){return h!=null&&(h.close(),h=null),this.log.log(f.SEVERE,l,b),this.setCalloutActive(!1),b}this.setCalloutActive(!1);s=null};i.prototype.BPartnerBill=function(i,r,u,e,o){var h,c,b,k,l,a,y,v,p,d,g,s,w,nt,tt,it;if(this.isCalloutActive()||o==null||o.toString()=="")return"";h=null;try{if(c=t.getValueOfInt(o.toString()),c==null||c==0)return"";if(this.setCalloutActive(!0),b=t.getValueOfBoolean(u.getValue("IsReturnTrx")),b)return this.setCalloutActive(!1),"";k="SELECT p.AD_Language,p.C_PaymentTerm_ID,p.M_PriceList_ID,p.PaymentRule,p.POReference,p.SO_Description,p.IsDiscountPrinted,p.InvoiceRule,p.DeliveryRule,p.FreightCostRule,DeliveryViaRule,p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable,c.AD_User_ID,p.PO_PriceList_ID, p.PaymentRulePO, p.PO_PaymentTerm_ID,lbill.C_BPartner_Location_ID AS Bill_Location_ID FROM C_BPartner p LEFT OUTER JOIN C_BPartner_Location lbill ON (p.C_BPartner_ID=lbill.C_BPartner_ID AND lbill.IsBillTo='Y' AND lbill.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID="+c+" AND p.IsActive='Y'";l="Y"==i.getWindowContext(r,"IsSOTrx",!0);h=n.DB.executeReader(k);h.read()&&(a=t.getValueOfInt(h.get("bill_location_id")),c.toString()==i.getContext("C_BPartner_ID")&&(y=i.getContext("C_BPartner_Location_ID"),y.length>0&&(a=t.getValueOfInt(y))),a==0?u.setValue("Bill_Location_ID",null):u.setValue("Bill_Location_ID",t.getValueOfInt(a)),v=t.getValueOfInt(h.get("ad_user_id")),c.toString()==i.getContext("C_BPartner_ID")&&(p=i.getContext("AD_User_ID"),p.length>0&&(v=t.getValueOfInt(p))),v==0?u.setValue("Bill_User_ID",null):u.setValue("Bill_User_ID",t.getValueOfInt(v.toString())),l&&(d=0,d!=0&&(g=0,h!=null&&g<0&&n.ADialog.info("CreditLimitOver",null,"",""))),s=h.get("poreference"),s=h.get("so_description"),s!=null&&s.toString().trim().length!=0&&u.setValue("Description",s),s=h.get("isdiscountprinted"),s!=null&&s.toString().length!=0?u.setValue("IsDiscountPrinted",s):u.setValue("IsDiscountPrinted","N"),w=i.getContext("OrderType"),u.setValue("InvoiceRule","D"),u.setValue("PaymentRule","P"),w=="PR"?u.setValue("InvoiceRule","I"):w=="WR"?u.setValue("PaymentRule","B"):(s=h.get(l?"paymentrule":"paymentrulepo"),s!=null&&s.toString().length!=0&&(s=="B"&&(s="P"),l&&(s=="S"||s=="U")&&(s="P"),u.setValue("PaymentRule",s)),nt=t.getValueOfInt(u.getValue("C_PaymentTerm_ID")),tt=t.getValueOfDecimal(u.getValue("C_Order_Blanket")),nt>0&&tt>0||(ii=h.get(l?"c_paymentterm_id":"po_paymentterm_id"),it=this.checkAdvancePaymentTerm(t.getValueOfInt(u.getValue("C_DocTypeTarget_ID")),ii),it?h!=null&&u.setValue("C_PaymentTerm_ID",ii):u.setValue("C_PaymentTerm_ID",null)),s=h.get("invoicerule"),s!=null&&s.toString().length!=0&&u.setValue("InvoiceRule",s)));h.close()}catch(rt){return this.setCalloutActive(!1),h!=null&&(h.close(),h=null),this.log(f.SEVERE,"bPartnerBill",rt),rt}return this.setCalloutActive(!1),this.PriceList(i,r,u,e,u.getValue("M_PriceList_ID"))};i.prototype.PriceList=function(i,r,e,o,s,h){var a="",c=null,l,v;if(this.isCalloutActive()||s==null||s.toString()=="")return"";try{if(l=t.getValueOfInt(s.toString()),l==null||l==0)return"";if(this.setCalloutActive(!0),u&&this.log.warning("init"),a="SELECT pl.IsTaxIncluded,pl.EnforcePriceLimit,pl.C_Currency_ID,c.StdPrecision,plv.M_PriceList_Version_ID,plv.ValidFrom FROM M_PriceList pl,C_Currency c,M_PriceList_Version plv WHERE pl.C_Currency_ID=c.C_Currency_ID AND pl.M_PriceList_ID=plv.M_PriceList_ID AND pl.M_PriceList_ID="+l+"ORDER BY plv.ValidFrom DESC",c=n.DB.executeReader(a),c.read()){e.setValue("IsTaxIncluded","Y"==c.get("istaxincluded").toString());i.setContext(r,"EnforcePriceLimit",c.get("enforcepricelimit").toString());var p=t.getValueOfInt(c.get("c_currency_id")),w=t.getValueOfInt(e.getValue("C_Currency_ID")),b=t.getValueOfDecimal(e.getValue("C_Order_Blanket"));w>0&&b>0||e.setValue("C_Currency_ID",p);v=t.getValueOfInt(c.get("m_pricelist_version_id"));i.setContext(r,"M_PriceList_Version_ID",v)}c.close()}catch(y){return this.setCalloutActive(!1),c!=null&&c.close(),this.log(f.SEVERE,a,y),y}return u&&this.log.warning("finish"),this.setCalloutActive(!1),i=r=e=o=s=h=null,""};i.prototype.Product=function(i,f,e,o,s,h){var b,v,y,c,nt,k,a,l,g,it,ot;if(this.isCalloutActive()||s==null||s.toString()=="")return"";var p=t.getValueOfInt(s);if(p==null||p==0||(v="Y"==i.getContext("IsReturnTrx"),v))return"";this.setCalloutActive(!0);try{u&&this.log.warning("init");e.setValue("C_Charge_ID",null);e.setValue("M_AttributeSetInstance_ID",null);var nt=e.getValue("M_Product_ID").toString().concat(",",e.getValue("C_BPartner_ID").toString()),w=n.dataContext.getJSONRecord("MOrderLine/GetProductInfo",nt),st=w.productType.toString();st=="S"?e.setValue("IsContract",!0):(e.setValue("IsContract",!1),e.setValue("NoofCycle",null),e.setValue("QtyPerCycle",null),e.setValue("StartDate",null),e.setValue("C_Contract_ID",0),e.setValue("EndDate",null),e.setValue("C_Frequency_ID",0));b=i.getWindowContext(f,"IsSOTrx",!0)=="Y";v=i.getWindowContext(f,"IsReturnTrx",!0)=="Y";w.IsDropShip.toString()=="Y"?e.setValue("IsDropShip",!0):e.setValue("IsDropShip",!1);r=t.getValueOfInt(w.countEd011);y=0;r>0&&(y=t.getValueOfInt(w.purchasingUom),y>0&&b==!1&&v==!1?e.setValue("C_UOM_ID",y):e.setValue("C_UOM_ID",t.getValueOfInt(w.headerUom)));var ut=i.getContextAsInt(f,"C_BPartner_ID",!1),ht=t.getValueOfDecimal(e.getValue("QtyOrdered")),b=i.getWindowContext(f,"IsSOTrx",!0)=="Y",ct=i.getContextAsInt(f,"M_PriceList_ID",!1),lt=i.getContextAsInt(f,"M_PriceList_Version_ID",!1),tt=i.getContextAsInt(f,"M_AttributeSetInstance_ID",!1),at=e.getValue("DateOrdered"),vt=t.getValueOfInt(e.getValue("C_UOM_ID")),l=p.toString().concat(",",ut.toString(),",",ht.toString(),",",b,",",ct.toString(),",",lt.toString(),",",at.toString(),",",null,",",tt.toString(),",",vt,",",r);try{if(c=null,c=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",l),c!=null&&(e.setValue("PriceList",c.PriceList),e.setValue("PriceLimit",c.PriceLimit),e.setValue("PriceActual",c.PriceActual),e.setValue("PriceEntered",c.PriceEntered),e.setValue("C_Currency_ID",t.getValueOfInt(c.C_Currency_ID)),e.setValue("Discount",c.Discount),r<=0&&e.setValue("C_UOM_ID",t.getValueOfInt(c.C_UOM_ID)),e.setValue("QtyOrdered",e.getValue("QtyEntered")),r>0&&y>0&&b==!1&&v==!1&&(nt=e.getValue("M_Product_ID").toString().concat(","+i.getAD_Client_ID().toString()+","+e.getValue("C_Order_ID").toString()+","+ut.toString()+","+e.getValue("QtyEntered").toString()+","+t.getValueOfString(y)),k=n.dataContext.getJSONRecord("MOrderLine/GetPricesOnProductChange",nt),PriceList=t.getValueOfDecimal(k.PriceList),e.setValue("PriceList",PriceList),PriceEntered=t.getValueOfDecimal(k.PriceEntered),e.setValue("PriceEntered",PriceEntered),PriceActual=t.getValueOfDecimal(k.PriceEntered),e.setValue("PriceActual",PriceActual),e.setValue("QtyOrdered",t.getValueOfDecimal(k.QtyOrdered))),i.setContext(f,"EnforcePriceLimit",c.IsEnforcePriceLimit?"Y":"N"),i.setContext(f,"DiscountSchema",c.IsDiscountSchema?"Y":"N"),i.isSOTrx())){var ft=t.getValueOfDecimal(e.getValue("QtyOrdered")),et=i.getContextAsInt(f,"M_Warehouse_ID"),tt=i.getContextAsInt(f,"M_AttributeSetInstance_ID"),d=0;e.getValue("C_OrderLine_ID")!=null&&(d=t.getValueOfInt(e.getValue("C_OrderLine_ID")));d==null&&(d=0);l=p.toString().concat(",",et.toString(),",",tt.toString(),",",d.toString());a=n.dataContext.getJSONRecord("MStorage/GetQtyAvailable",l);a==null&&(a=n.Env.ZERO);a==0||a.toString().compareTo(ft)<0||(l=et.toString()+","+p.toString()+","+tt.toString()+","+d.toString(),g=n.dataContext.getJSONRecord("MOrderLine/GetNotReserved",l),g==null&&(g=n.Env.ZERO),it=a-g,it.compareTo(ft)<0&&(ot=n.Msg.parseTranslation(i,"@QtyAvailable@="+a+" - @QtyNotReserved@="+g+" = "+it),n.ADialog.info("InsufficientQtyAvailable",!0,ot,"")))}u&&this.log.warning("fini")}catch(rt){return this.log.saveError("calloutorder",rt.toString()),this.setCalloutActive(!1),rt.message}this.setCalloutActive(!1)}catch(rt){this.setCalloutActive(!1);this.log.saveError("calloutorder",rt.toString())}return this.setCalloutActive(!1),h=null,this.Tax(i,f,e,o,s)};i.prototype.Charge=function(i,r,u,e,o,s){var c,y,l,a,h,v;try{if(this.isCalloutActive()||o==null||o.toString()=="")return"";if((this.setCalloutActive(!0),c=t.getValueOfInt(o),c==null||c==0)||(y="Y"==i.getContext("IsReturnTrx"),y))return this.setCalloutActive(!1),"";u.getValue("M_Product_ID")!=null&&u.setValue("M_Product_ID",null);u.setValue("M_AttributeSetInstance_ID",null);u.setValue("S_ResourceAssignment_ID",null);l=i.getContextAsInt("#C_UOM_ID");l>0?u.setValue("C_UOM_ID",l):u.setValue("C_UOM_ID",100);i.setContext(r,"DiscountSchema","N");a="SELECT ChargeAmt FROM C_Charge WHERE C_Charge_ID="+c;h=null;h=n.DB.executeReader(a);h!=null&&h.read()&&(v=t.getValueOfDecimal(h.get("chargeamt")));u.setValue("PriceEntered",v);u.setValue("PriceActual",v);u.setValue("PriceLimit",n.Env.ZERO);u.setValue("PriceList",n.Env.ZERO);u.setValue("Discount",n.Env.ZERO);h.close()}catch(p){return this.setCalloutActive(!1),h!=null&&(h.close(),h=null),this.log.log(f.SEVERE,a,p),p}return this.setCalloutActive(!1),s=null,this.Tax(i,r,u,e,o)};i.prototype.Tax=function(i,r,f,e,o,s){var p,y,l,a,h,w,b,k,d,v;if(this.isCalloutActive()||o==null||o.toString()==""||(console.log("Before Charge Or Product"),t.getValueOfInt(f.getValue("C_Charge_ID"))==0&&t.getValueOfInt(f.getValue("M_Product_ID"))==0))return"";this.setCalloutActive(!0);try{var nt="",tt="",ut=t.getValueOfString(f.getValue("M_Product_ID")).concat(",",f.getValue("C_Order_ID").toString()+","+t.getValueOfString(f.getValue("C_Charge_ID"))),c=n.dataContext.getJSONRecord("MOrderLine/GetTaxId",ut),ft=t.getValueOfInt(c._CountVATAX),it=i.getWindowContext(r,"IsSOTrx",!0)=="Y",rt=i.getWindowContext(r,"IsReturnTrx",!0)=="Y";if(ft>0&&(nt=t.getValueOfString(c.taxRule)),nt=="T"&&(it==!0&&rt==!1||it==!1&&rt==!1))if(p=t.getValueOfInt(c.taxId),t.getValueOfInt(p)>0)f.setValue("C_Tax_ID",p);else{if(t.getValueOfInt(f.getValue("M_Product_ID"))>0)return f.setValue("M_Product_ID",""),this.setCalloutActive(!1),c.TaxExempt=="Y"?n.ADialog.info("TaxNoExemptFound"):n.ADialog.info("VATAX_DefineTax");if(t.getValueOfInt(f.getValue("C_Charge_ID"))>0)return f.setValue("C_Charge_ID",""),this.setCalloutActive(!1),c.TaxExempt=="Y"?n.ADialog.info("TaxNoExemptFound"):n.ADialog.info("VATAX_DefineChargeTax")}else{if(y=e.getColumnName(),o==null)return"";if((u&&this.log.warning("init"),l=0,l=y=="M_Product_ID"?t.getValueOfInt(o):t.getValueOfInt(i.getContextAsInt(r,"M_Product_ID")),a=0,a=y=="C_Charge_ID"?t.getValueOfInt(o):t.getValueOfInt(i.getContextAsInt(r,"C_Charge_ID")),this.log.fine("Product="+l+", C_Charge_ID="+a),l==0&&a==0)||(h=0,h=y=="C_BPartner_Location_ID"?t.getValueOfInt(o):t.getValueOfInt(i.getContextAsInt(r,"C_BPartner_Location_ID")),h==0))return this.setCalloutActive(!1),this.Amt(i,r,f,e,o);this.log.fine("Ship BP_Location="+h);w=i.getContext("DateOrdered");this.log.fine("Bill Date="+w);b=i.getContext("DatePromised");this.log.fine("Ship Date="+b);k=i.getContextAsInt(r,"AD_Org_ID");this.log.fine("Org="+k);d=i.getContextAsInt(r,"M_Warehouse_ID");this.log.fine("Warehouse="+d);v=i.getContextAsInt(r,"Bill_Location_ID");v==0&&(v=h);this.log.fine("Bill BP_Location="+v);var et="Y"==i.getWindowContext(r,"IsSOTrx",!0),tt=l.toString()+","+a.toString()+","+w.toString()+","+b.toString()+","+k.toString()+","+d.toString()+","+v.toString()+","+h.toString()+","+et.toString(),g=n.dataContext.getJSONRecord("MTax/Get_Tax_ID",tt);this.log.info("Tax ID="+g);g==0||f.setValue("C_Tax_ID",t.getValueOfInt(g));u&&this.log.warning("fini")}}catch(ot){return this.setCalloutActive(!1),ot}return this.setCalloutActive(!1),s=null,this.Amt(i,r,f,e,o)};i.prototype.Amt=function(i,f,e,o,s,h){var w,ui,nt,d,it,c,l,g,a,v,ot,dt,rt,y,vt,lt,at,p,ht,ti,b,ii,ct,bt;if(this.isCalloutActive()||s==null||s.toString()==""||(console.log("Before Charge Or Product"),t.getValueOfInt(e.getValue("C_Charge_ID"))==0&&t.getValueOfInt(e.getValue("M_Product_ID"))==0))return"";console.log("After Charge Or Product");this.setCalloutActive(!0);try{u&&this.log.Warning("init");var et=i.getContextAsInt(f,"C_UOM_ID"),tt=i.getContextAsInt(f,"M_Product_ID"),pt=i.getContextAsInt(f,"M_PriceList_ID"),k=t.getValueOfInt(e.getValue("C_OrderLine_Blanket_ID"))>0?!0:!1,kt=t.getValueOfInt(e.getValue("C_Quotation_Line_ID"))>0?!0:!1;kt&&(k=kt);w=t.getValueOfDecimal(e.getValue("QtyDelivered"))>0?!0:!1;w||(w=t.getValueOfDecimal(e.getValue("QtyInvoiced"))>0?!0:!1);ui=pt.toString();y=n.dataContext.getJSONRecord("MPriceList/GetPriceList",pt.toString());nt=t.getValueOfInt(y.StdPrecision);d=t.getValueOfDecimal(e.getValue("QtyEntered"));it=t.getValueOfDecimal(e.getValue("QtyOrdered"));this.log.fine("QtyEntered="+d+", Ordered="+it+", UOM="+et);c=t.getValueOfDecimal(e.getValue("PriceEntered"));l=t.getValueOfDecimal(e.getValue("PriceActual"));a=t.getValueOfDecimal(e.getValue("Discount"));g=t.getValueOfDecimal(e.getValue("PriceLimit"));v=t.getValueOfDecimal(e.getValue("PriceList"));this.log.fine("PriceList="+v+", Limit="+g+", Precision="+nt);this.log.fine("PriceEntered="+c+", Actual="+l+", Discount="+a);var lt=i.getContextAsInt(f,"C_BPartner_ID",!1),at=tt.toString().concat(",",e.getValue("C_Order_ID").toString()+","+t.getValueOfString(e.getValue("M_AttributeSetInstance_ID"))+","+t.getValueOfString(e.getValue("C_UOM_ID"))+","+i.getAD_Client_ID().toString()+","+lt.toString()+","+e.getValue("QtyEntered").toString()),p=n.dataContext.getJSONRecord("MOrderLine/GetPrices",at);if(r=t.getValueOfInt(p.countEd011),ot=t.getValueOfInt(p.countVAPRC),(r>=1||ot>=1)&&(l=c),o.getColumnName()=="QtyEntered"&&r>0&&(t.getValueOfInt(e.getValue("Orig_OrderLine_ID"))>0||k||w||(v=t.getValueOfDecimal(p.PriceList),e.setValue("PriceList",t.getValueOfDecimal(p.PriceList)),c=t.getValueOfDecimal(p.PriceEntered),e.setValue("PriceEntered",t.getValueOfDecimal(p.PriceEntered)),l=t.getValueOfDecimal(p.PriceEntered),e.setValue("PriceActual",l))),o.getColumnName()!="QtyOrdered"&&o.getColumnName()!="QtyEntered"&&o.getColumnName()!="M_Product_ID"||"N"==i.getContext("DiscountSchema"))o.getColumnName()=="PriceActual"?(l=t.getValueOfDecimal(s),c=l,this.log.fine("PriceActual="+l+" -> PriceEntered="+c),e.setValue("PriceEntered",c)):o.getColumnName()=="PriceEntered"&&(c=t.getValueOfDecimal(s),st=tt.toString().concat(",",et.toString(),",",c.toString()),ht=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",st),l=ht,t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO  WHERE PREFIX IN('VAPRC_','ED011_')"))>1&&(l=c),l==null&&(l=c),this.log.fine("PriceEntered="+c+" -> PriceActual="+l),e.setValue("PriceActual",l));else if(dt=i.getContextAsInt(f,"C_BPartner_ID"),o.getColumnName()=="QtyEntered"&&(rt=tt.toString().concat(",",et.toString()+","+d.toString()),y=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",rt),it=y),it==null&&(it=d),!(t.getValueOfInt(e.getValue("Orig_OrderLine_ID"))>0)){var fi=i.getWindowContext(f,"IsSOTrx",!0)=="Y",ei=e.getValue("DateOrdered"),st=tt.toString().concat(",",dt.toString(),",",it.toString(),",",fi,",",pt.toString(),",","0,",ei.toString(),",",null,",",null,",",et,",",r),ut=null;ut=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",st);vt=ut.PriceStd;r<=0&&ot<=0?(st=tt.toString().concat(",",et.toString(),",",vt.toString()),ht=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",st),c=ht):(lt=i.getContextAsInt(f,"C_BPartner_ID",!1),k||w||(at=tt.toString().concat(",",e.getValue("C_Order_ID").toString()+","+t.getValueOfString(e.getValue("M_AttributeSetInstance_ID"))+","+t.getValueOfString(e.getValue("C_UOM_ID"))+","+i.getAD_Client_ID().toString()+","+lt.toString()+","+e.getValue("QtyEntered").toString()+","+r.toString()+","+ot.toString()),p=n.dataContext.getJSONRecord("MOrderLine/GetPricesOnChange",at),v=t.getValueOfDecimal(p.PriceList),e.setValue("PriceList",t.getValueOfDecimal(p.PriceList)),c=t.getValueOfDecimal(p.PriceEntered)));c==null&&(c=vt);this.log.fine("QtyChanged -> PriceActual="+vt+", PriceEntered="+c+", Discount="+ut.Discount);l=ut.PriceStd;k||w||e.setValue("PriceActual",c);r<=0&&ot<=0?k||w||e.setValue("Discount",ut.Discount):k||w||(l=c,e.setValue("Discount",(t.getValueOfDecimal(e.getValue("PriceList"))-c)/t.getValueOfDecimal(e.getValue("PriceList"))*100));e.setValue("PriceEntered",c);i.setContext(f,"DiscountSchema",ut.DiscountSchema?"Y":"N")}if(o.getColumnName()=="Discount")l=t.getValueOfDecimal((100-a)/100*v),t.scale(l)>nt&&(l=l.toFixed(nt)),c=l,c==null&&(c=l),e.setValue("PriceActual",l),e.setValue("PriceEntered",c);else{if(v==0)a=n.Env.ZERO;else if(a=t.getValueOfDecimal((v-l)/v*100),isNaN(a))return this.setCalloutActive(!1),"PriceListNotSelected";a=a.toFixed(2);k||w||e.setValue("Discount",a)}this.log.fine("PriceEntered="+c+", Actual="+l+", Discount="+a);var gt=!1,ft=i.getContext("EnforcePriceLimit"),yt=i.isSOTrx()&&ft!=null&&ft=="Y";if(ft==""){var rt=t.getValueOfInt(e.getValue("C_Order_ID")).toString(),ni=n.dataContext.getJSONRecord("MOrder/GetOrder",rt),wt="SELECT EnforcePriceLimit FROM M_PriceList WHERE IsActive = 'Y' AND M_PriceList_ID = "+ni.M_PriceList_ID;ft=n.DB.executeScalar(wt);yt=ni.IsSOTrx&&ft!=null&&ft=="Y";wt="SELECT OverwritePriceLimit FROM AD_Role WHERE IsActive = 'Y' AND AD_Role_ID = "+i.getContext("#AD_Role_ID");gt=t.getValueOfBoolean(n.DB.executeScalar(wt))}if(ti="Y"==i.getContext("IsReturnTrx"),yt&&(gt||ti)&&(yt=!1),yt&&g!=0&&l.compareTo(g)<0&&(l=g,c=l,c==null&&(c=g),this.log.fine("(under) PriceEntered="+c+", Actual"+g),k||w||(e.setValue("PriceActual",g),e.setValue("PriceEntered",c)),n.ADialog.info("UnderLimitPrice",!0,"",""),v!=0&&(a=t.getValueOfDecimal((v-l)/v*100),a=a.toFixed(2),k||w||e.setValue("Discount",a))),c=t.getValueOfDecimal(e.getValue("PriceEntered")),b=d*c,d>0&&b==0&&(ii=t.getValueOfDecimal(e.getValue("C_OrderLine_Blanket_ID")),y=n.dataContext.getJSONRecord("MOrderLine/GetOrderLine",ii.toString()),y!=null)){var v=t.getValueOfDouble(y.PriceList),l=t.getValueOfDouble(y.PriceActual),c=t.getValueOfDouble(y.PriceEntered),a=t.getValueOfDouble(y.Discount);c!=null&&(e.setValue("PriceEntered",c),e.setValue("LineNetAmt",c*d),b=c*d);v!=null&&e.setValue("PriceList",v);a!=null&&e.setValue("Discount",a);l!=null&&e.setValue("PriceActual",l)}if(t.scale(b)>nt&&(b=b.toFixed(nt)),this.log.info("LineNetAmt="+b),e.setValue("LineNetAmt",b),ct=n.Env.ZERO,o.getColumnName()=="TaxAmt")ct=e.getValue("TaxAmt");else if(bt=e.getValue("C_Tax_ID"),bt!=null){var oi=bt,ri=this.IsTaxIncluded(f,i),rt=oi.toString().concat(",",b.toString(),",",ri,",",nt.toString()),y=null;ct=n.dataContext.getJSONRecord("MTax/CalculateTax",rt);e.setValue("TaxAmt",ct)}ri?e.setValue("LineTotalAmt",t.getValueOfDecimal(b)):e.setValue("LineTotalAmt",t.getValueOfDecimal(b)+ct)}catch(si){return this.setCalloutActive(!1),si}return this.setCalloutActive(!1),i=f=e=o=s=h=null,""};i.prototype.IsTaxIncluded=function(t,i){var r=i.getContext("IsTaxIncluded"),u;try{if(r.toString().length==0){if(u=i.getContextAsInt(t,"M_PriceList_ID"),u==0)return!1;r=n.DB.executeScalar("SELECT IsTaxIncluded FROM M_PriceList WHERE M_PriceList_ID="+u,null,null).toString();r==null&&(r="N");i.setContext(t,"IsTaxIncluded",r)}}catch(f){this.setCalloutActive(!1);this.log.severe(f.toString())}return i=t=mTab=mField=value=oldValue=null,"Y"==r};i.prototype.Qty=function(i,f,e,o,s,h){var a="",b,tt,et,dt,gt,ut,ui,it,ni,vt,p,pt,g,k,v,w,y,ti,st,ht,wt,ii;if(this.isCalloutActive()||s==null||s.toString()==""||(console.log("Before Charge Or Product"),t.getValueOfInt(e.getValue("C_Charge_ID"))==0&&t.getValueOfInt(e.getValue("M_Product_ID"))==0))return"";console.log("After Charge Or Product");this.setCalloutActive(!0);try{b=i.getContextAsInt(f,"M_Product_ID");u&&this.log.Warning("init - M_Product_ID="+b+" - ");var l=n.Env.ZERO,c=n.Env.ZERO,li=n.Env.ZERO,nt,d,lt="Y"==i.getContext("IsReturnTrx"),rt=t.getValueOfInt(e.getValue("C_OrderLine_Blanket_ID"))>0?!0:!1,bt=t.getValueOfInt(e.getValue("C_Quotation_Line_ID"))>0?!0:!1;bt&&(rt=bt);var ct=i.getContextAsInt(f,"C_BPartner_ID",!1),kt=n.dataContext.getJSONRecord("MBPartner/GetBPartner",ct.toString()),ri=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",b.toString());if(b==0)c=t.getValueOfDecimal(e.getValue("QtyEntered")),l=c,e.setValue("QtyOrdered",l);else if(o.getColumnName()=="C_UOM_ID")p=t.getValueOfInt(s),c=t.getValueOfDecimal(e.getValue("QtyEntered")),it=ct.toString().concat(",",e.getValue("C_Order_ID").toString()+","+t.getValueOfString(e.getValue("M_AttributeSetInstance_ID"))+","+t.getValueOfString(p)+","+i.getAD_Client_ID().toString()+","+e.getValue("M_Product_ID").toString()+","+e.getValue("QtyEntered").toString()),tt=n.dataContext.getJSONRecord("MOrderLine/GetProductPriceOnUomChange",it),r=t.getValueOfInt(tt.countEd011),r>0&&t.getValueOfInt(e.getValue("C_Order_ID"))?(et=t.getValueOfInt(tt.isAttributeValue),et==1?(dt=t.getValueOfDecimal(tt.PriceEntered),rt||(e.setValue("PriceList",t.getValueOfDecimal(tt.PriceList)),e.setValue("PriceLimit",t.getValueOfDecimal(tt.PriceLimit)),e.setValue("PriceActual",t.getValueOfDecimal(tt.PriceEntered)),e.setValue("PriceEntered",t.getValueOfDecimal(tt.PriceEntered))),a=p.toString().concat(","),k=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(k)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+p+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),a=b.toString().concat(",",p.toString(),",",c.toString()),w=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=w,y=!1,l!=null&&(y=c!=l),l==null&&(y=!1,l=1),y?e.setValue("QtyOrdered",l):e.setValue("QtyOrdered",l*v),rt||(e.setValue("PriceActual",dt),e.setValue("PriceList",t.getValueOfDecimal(tt.PriceList)))):(et==2||et==0)&&(et==2?(gt=t.getValueOfDecimal(tt.PriceEntered),rt||(e.setValue("PriceList",t.getValueOfDecimal(tt.PriceList)),e.setValue("PriceLimit",t.getValueOfDecimal(tt.PriceLimit)),e.setValue("PriceActual",t.getValueOfDecimal(tt.PriceEntered)),e.setValue("PriceEntered",t.getValueOfDecimal(tt.PriceEntered))),a=p.toString().concat(","),k=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(k)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+p+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),a=b.toString().concat(",",p.toString(),",",c.toString()),w=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=w,y=!1,l!=null&&(y=c!=l),l==null&&(y=!1,l=1),y?e.setValue("QtyOrdered",l):e.setValue("QtyOrdered",l*v),rt||(e.setValue("PriceActual",gt),e.setValue("PriceList",t.getValueOfDecimal(tt.PriceList)))):(a=p.toString().concat(","),k=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(k)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+p+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),a=b.toString().concat(",",p.toString(),",",c.toString()),w=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=w,l==null&&(l=c),y=c!=l,nt=t.getValueOfDecimal(e.getValue("PriceEntered")),a=b.toString().concat(",",p.toString(),",",nt.toString()),w=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),d=w,d==null&&(d=nt),this.log.fine("UOM="+p+", QtyEntered/PriceActual="+c+"/"+nt+" -> "+y+" QtyOrdered/PriceEntered="+l+"/"+d),i.setContext(f,"UOMConversion",y?"Y":"N"),e.setValue("QtyOrdered",l),e.setValue("PriceEntered",d),ut=0,ui=0,rt||(it=b.toString().concat(",",e.getValue("C_Order_ID").toString()+","+t.getValueOfString(e.getValue("M_AttributeSetInstance_ID"))+","+t.getValueOfString(p)+","+i.getAD_Client_ID().toString()+","+kt.M_DiscountSchema_ID.toString()+","+kt.FlatDiscount.toString()+","+e.getValue("QtyEntered").toString()+","+t.getValueOfString(ri)),g=n.dataContext.getJSONRecord("MOrderLine/GetPricesOnUomChange",it),PriceList=t.getValueOfDecimal(g.PriceList),e.setValue("PriceList",t.getValueOfDecimal(g.PriceList)),d=t.getValueOfDecimal(g.PriceEntered),e.setValue("PriceEntered",t.getValueOfDecimal(g.PriceEntered)),nt=t.getValueOfDecimal(g.PriceEntered),e.setValue("PriceActual",nt))))):(a=p.toString().concat(","),k=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(k)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+p+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),a=b.toString().concat(",",p.toString(),",",c.toString()),w=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=w,l==null&&(l=c),y=c!=l,nt=t.getValueOfDecimal(e.getValue("PriceActual")),a=b.toString().concat(",",p.toString(),",",nt.toString()),w=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),d=w,d==null&&(d=nt),this.log.fine("UOM="+p+", QtyEntered/PriceActual="+c+"/"+nt+" -> "+y+" QtyOrdered/PriceEntered="+l+"/"+d),i.setContext(f,"UOMConversion",y?"Y":"N"),e.setValue("QtyOrdered",l),e.setValue("PriceEntered",d));else if(o.getColumnName()=="QtyEntered")p=i.getContextAsInt(f,"C_UOM_ID"),c=t.getValueOfDecimal(s),a=p.toString().concat(","),k=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(k)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+p+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),a=b.toString().concat(",",p.toString(),",",c.toString()),w=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=w,l==null&&(l=c),y=c!=l,this.log.fine("UOM="+p+", QtyEntered="+c+" -> "+y+" QtyOrdered="+l),i.setContext(f,"UOMConversion",y?"Y":"N"),e.setValue("QtyOrdered",l);else if(o.getColumnName()=="QtyOrdered"){p=i.getContextAsInt(f,"C_UOM_ID");l=t.getValueOfDecimal(s);a=b.toString().concat(",");var k=n.dataContext.getJSONRecord("MProduct/GetUOMPrecision",a),fi=k,at=l.toFixed(fi);l!=at&&(this.log.fine("Corrected QtyOrdered Scale "+l+"->"+at),l=at,e.setValue("QtyOrdered",l));a=b.toString().concat(",",p.toString(),",",l.toString());ni=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",a);c=ni;c==null&&(c=l);y=l!=c;this.log.fine("UOM="+p+", QtyOrdered="+l+" -> "+y+" QtyEntered="+c);i.setContext(f,"UOMConversion",y?"Y":"N");e.setValue("QtyEntered",c)}else l=t.getValueOfDecimal(e.getValue("QtyOrdered"));if(b!=0&&lt&&(vt=t.getValueOfInt(e.getValue("Orig_InOutLine_ID")),vt!=0)){a=vt.toString();var yt=n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine",a),ei=yt.MovementQty,ot=t.getValueOfDecimal(ei);l=t.getValueOfDecimal(e.getValue("QtyOrdered"));ot<l&&(i.isSOTrx()?n.ADialog.info("QtyShippedAndReturned",null,ot.toString(),""):n.ADialog.info("QtyRecievedAndReturnd",null,ot.toString(),""),e.setValue("QtyOrdered",ot),l=ot,p=i.getContextAsInt(f,"C_UOM_ID"),a=b.toString().concat(",",p.toString(),",",l.toString()),c=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",a),c==null&&(c=l),e.setValue("QtyEntered",c),this.log.fine("QtyEntered : "+c.toString()+"QtyOrdered : "+l.toString()))}if(b!=0&&l>0&&!lt&&o.getColumnName()=="M_AttributeSetInstance_ID"){c=t.getValueOfDecimal(e.getValue("QtyEntered"));var ut=0,it=b.toString().concat(",",e.getValue("C_Order_ID").toString()+","+t.getValueOfString(e.getValue("M_AttributeSetInstance_ID"))+","+t.getValueOfString(e.getValue("C_UOM_ID"))+","+i.getAD_Client_ID().toString()+","+ct.toString()+","+c.toString()),g=n.dataContext.getJSONRecord("MOrderLine/GetPrices",it);g!=null&&(r=t.getValueOfInt(g.countEd011),pt=t.getValueOfInt(g.countVAPRC),d=g.PriceEntered,ut=g.PriceList,rt||(e.setValue("PriceList",ut),e.setValue("PriceActual",d),e.setValue("PriceEntered",d)),r<=0&&pt<=0?(it=e.getValue("C_UOM_ID").toString().concat(","),k=n.dataContext.getJSONRecord("MUOM/GetPrecision",it),v=c.toFixed(t.getValueOfInt(k)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+t.getValueOfInt(e.getValue("C_UOM_ID"))+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),it=b.toString().concat(",",e.getValue("C_UOM_ID").toString(),",",c.toString()),w=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",it),l=w,l==null&&(l=c),y=c!=l,nt=t.getValueOfDecimal(e.getValue("PriceEntered")),a=b.toString().concat(",",e.getValue("C_UOM_ID").toString(),",",nt.toString()),w=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),d=w,d==null&&(d=nt),this.log.fine("UOM="+p+", QtyEntered/PriceActual="+c+"/"+nt+" -> "+y+" QtyOrdered/PriceEntered="+l+"/"+d),i.setContext(f,"UOMConversion",y?"Y":"N"),e.setValue("QtyOrdered",l),e.setValue("PriceEntered",d)):(rt||(it=b.toString().concat(",",e.getValue("C_Order_ID").toString()+","+t.getValueOfString(e.getValue("M_AttributeSetInstance_ID"))+","+t.getValueOfString(e.getValue("C_UOM_ID"))+","+i.getAD_Client_ID().toString()+","+ct.toString()+","+c.toString()+","+r.toString()+","+pt.toString()),g=n.dataContext.getJSONRecord("MOrderLine/GetPricesOnChange",it),ut=t.getValueOfDecimal(g.PriceList),e.setValue("PriceList",ut),d=t.getValueOfDecimal(g.PriceEntered),e.setValue("PriceEntered",d),nt=t.getValueOfDecimal(g.PriceEntered),e.setValue("PriceActual",nt)),a=e.getValue("C_UOM_ID").toString().concat(","),k=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),v=c.toFixed(t.getValueOfInt(k)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+t.getValueOfInt(e.getValue("C_UOM_ID"))+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),a=b.toString().concat(",",e.getValue("C_UOM_ID").toString(),",",c.toString()),w=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),l=w,y=!1,l!=null&&(y=c!=l),l==null&&(y=!1,l=1),y?e.setValue("QtyOrdered",l):e.setValue("QtyOrdered",l*v)))}if(b!=0&&i.isSOTrx()&&l>0&&!lt&&(ti=n.dataContext.getJSONRecord("MProduct/GetProduct",b.toString()),st=0,t.getValueOfBoolean(ti.IsStocked))){var oi=i.getContextAsInt(f,"M_Warehouse_ID"),si=i.getContextAsInt(f,"M_AttributeSetInstance_ID"),hi=b.toString().concat(",",oi.toString(),",",si.toString(),",",st.toString()),yt=null,ft=n.dataContext.getJSONRecord("MStorage/GetQtyAvailable",hi);ft==null&&(ft=n.Env.ZERO);ft==0||ft.toString().compareTo(l)<0||(st=e.getValue("C_OrderLine_ID")==""?0:t.getValueOfInt(e.getValue("C_OrderLine_ID")),st==null&&(st=0),ht=yt.notReserved,ht==null&&(ht=n.Env.ZERO),wt=ft-ht,wt<l&&(ii=n.Msg.parseTranslation(i,"@QtyAvailable@="+ft+"  -  @QtyNotReserved@="+ht+"  =  "+wt),n.ADialog.info("InsufficientQtyAvailable",null,ii,"")))}}catch(ci){return this.setCalloutActive(!1),ci}return this.setCalloutActive(!1),i=f=e=o=s=h=null,""};i.prototype.Orig_Order=function(i,r,u,f,e,o){var h,s,a,v,y,l,c;if(this.isCalloutActive()||e==null||e.toString()==""||(h=t.getValueOfInt(e),h==null||h==0))return"";this.setCalloutActive(!0);try{s=n.dataContext.getJSONRecord("MOrder/GetOrder",h.toString());a=n.dataContext.getJSONRecord("MBPartner/GetBPartner",s.C_BPartner_ID.toString());u.setValue("Orig_InOut_ID",null);u.setValue("C_BPartner_ID",t.getValueOfInt(s.C_BPartner_ID));u.setValue("C_BPartner_Location_ID",t.getValueOfInt(s.C_BPartner_Location_ID));u.setValue("Bill_BPartner_ID",t.getValueOfInt(s.Bill_BPartner_ID));u.setValue("Bill_Location_ID",t.getValueOfInt(s.Bill_Location_ID));s.AD_User_ID!=0&&u.setValue("AD_User_ID",t.getValueOfInt(s.AD_User_ID));s.Bill_User_ID!=0&&u.setValue("Bill_User_ID",t.getValueOfInt(s.Bill_User_ID));i.isSOTrx()?u.setValue("M_ReturnPolicy_ID",t.getValueOfInt(a.M_ReturnPolicy_ID)):u.setValue("M_ReturnPolicy_ID",t.getValueOfInt(a.PO_ReturnPolicy_ID));!0&&(this.setCalloutActive(!1),u.setValue("M_PriceList_ID",t.getValueOfInt(s.M_PriceList_ID)),this.setCalloutActive(!0));u.setValue("PaymentRule",s.PaymentRule);v=this.checkAdvancePaymentTerm(t.getValueOfInt(u.getValue("C_DocTypeTarget_ID")),t.getValueOfInt(s.C_PaymentTerm_ID));v?u.setValue("C_PaymentTerm_ID",t.getValueOfInt(s.C_PaymentTerm_ID)):u.setValue("C_PaymentTerm_ID",null);u.setValue("Bill_Location_ID",t.getValueOfInt(s.Bill_Location_ID));u.setValue("InvoiceRule",s.InvoiceRule);u.setValue("PaymentRule",s.PaymentRule);u.setValue("DeliveryViaRule",s.DeliveryViaRule);u.setValue("FreightCostRule",s.FreightCostRule);y=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'"));y>0&&(l=n.DB.executeScalar("SELECT VA009_PaymentMethod_ID FROM C_Order WHERE C_Order_ID="+h),l>0&&(u.setValue("VA009_PaymentMethod_ID",l),c=n.DB.executeScalar("SELECT VA009_PaymentBaseType FROM VA009_PaymentMethod WHERE VA009_PaymentMethod_ID="+l),c!="W"&&c!=null&&(u.setValue("PaymentMethod",c),u.setValue("PaymentRule",c))))}catch(p){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.Orig_InOut=function(i,r,u,f,e,o){var h,s;if(this.isCalloutActive()||e==null||e.toString()=="")return"";try{if(h=t.getValueOfInt(e),h==null||h==0)return"";this.setCalloutActive(!0);s=n.dataContext.getJSONRecord("MInOut/GetInOut",h.toString());u.setValue("C_Project_ID",t.getValueOfInt(s.C_Project_ID));u.setValue("C_Campaign_ID",t.getValueOfInt(s.C_Campaign_ID));u.setValue("C_Activity_ID",t.getValueOfInt(s.C_Activity_ID));u.setValue("AD_OrgTrx_ID",t.getValueOfInt(s.AD_OrgTrx_ID));u.setValue("User1_ID",t.getValueOfInt(s.User1_ID));u.setValue("User2_ID",t.getValueOfInt(s.User2_ID));t.getValueOfString(s.IsDropShip)=="Y"?(u.setValue("M_Warehouse_ID",t.getValueOfInt(s.M_Warehouse_ID)),u.setValue("IsDropShip",!0)):(u.setValue("IsDropShip",!1),u.setValue("M_Warehouse_ID",null))}catch(c){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.Orig_OrderLine=function(i,r,u,f,e,o){var c,s,a,v,l,y,h;if(this.isCalloutActive()||e==null||e.toString()=="")return"";try{if(c=t.getValueOfInt(e),c==null||c==0)return"";this.setCalloutActive(!0);s=n.dataContext.getJSONRecord("MOrderLine/GetOrderLine",c.toString());u.setValue("Orig_InOutLine_ID",null);u.setValue("C_Tax_ID",t.getValueOfInt(s.C_Tax_ID));u.setValue("PriceList",t.getValueOfDecimal(s.PriceList));u.setValue("PriceLimit",t.getValueOfDecimal(s.PriceLimit));u.setValue("PriceActual",t.getValueOfDecimal(s.PriceActual));u.setValue("PriceEntered",t.getValueOfDecimal(s.PriceEntered));u.setValue("C_Currency_ID",t.getValueOfInt(s.C_Currency_ID));u.setValue("Discount",t.getValueOfDecimal(s.Discount));a=i.getContextAsInt(r,"M_PriceList_ID");v=n.dataContext.getJSONRecord("MPriceList/GetPriceList",a.toString());l=t.getValueOfInt(v.StdPrecision);y=t.getValueOfDecimal(u.getValue("QtyOrdered"));h=y*t.getValueOfDecimal(s.PriceActual);t.scale(h)>l&&(h=h.toFixed(l));this.log.info("LineNetAmt="+h);u.setValue("LineNetAmt",h)}catch(p){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.Orig_InOutLine=function(i,r,u,f,e,o){var h,s;if(this.isCalloutActive()||e==null||e.toString()=="")return"";try{if(h=t.getValueOfInt(e),h==null||h==0)return"";this.setCalloutActive(!0);s=n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine",h.toString());s!=null&&(u.setValue("C_Project_ID",t.getValueOfInt(s.C_Project_ID)),u.setValue("C_Campaign_ID",t.getValueOfInt(s.C_Campaign_ID)),u.setValue("M_Product_ID",t.getValueOfInt(s.M_Product_ID)),u.setValue("M_AttributeSetInstance_ID",t.getValueOfInt(s.M_AttributeSetInstance_ID)),u.setValue("C_UOM_ID",t.getValueOfInt(s.C_UOM_ID)),u.setValue("QtyEntered",t.getValueOfDecimal(s.QtyEntered)),t.getValueOfString(s.IsDropShip)=="Y"?(u.setValue("IsDropShip",!0),i.setContext(r,"IsDropShip",t.getValueOfString(s.IsDropShip))):u.setValue("IsDropShip",!1))}catch(c){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.checkAdvancePaymentTerm=function(i,r){var u=!0,f=n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix","VA009_"),e;return f!=null&&!f.VA009_?u:(t.getValueOfInt(i)!=0&&t.getValueOfInt(r)!=0&&(e=i.toString()+","+r.toString(),u=n.dataContext.getJSONRecord("MOrder/checkAdvancePaymentTerm",e)),u)};n.Model.CalloutOrder=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutInventoryMove")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.UOM=function(i,r,u,f,e,o){var c,s,v,a,l,h;if(e==null||e.toString()==""||this.isCalloutActive()||e==null)return"";this.setCalloutActive(!0);try{c=t.getValueOfDecimal(u.getValue("M_Product_ID"));c==0&&(QtyEntered=1,QtyOrdered=QtyEntered,u.setValue("QtyOrdered",QtyOrdered),u.setValue("QtyEntered",QtyEntered));f.getColumnName()=="C_UOM_ID"?(s=t.getValueOfInt(e),QtyEntered=t.getValueOfDecimal(u.getValue("QtyEntered")),c=t.getValueOfInt(u.getValue("M_Product_ID")),paramStr=c.toString().concat(",").concat(s.toString()).concat(",").concat(QtyEntered.toString()),l=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",paramStr),QtyOrdered=l,h=!1,QtyOrdered!=null&&(h=QtyEntered!=QtyOrdered),QtyOrdered==null&&(h=!1,QtyOrdered=1),h?u.setValue("MovementQty",QtyOrdered):u.setValue("MovementQty",QtyOrdered*QtyEntered)):f.getColumnName()=="QtyEntered"&&(s=i.getContextAsInt(r,"C_UOM_ID"),QtyEntered=t.getValueOfDecimal(e),paramStr=s.toString().concat(","),v=n.dataContext.getJSONRecord("MUOM/GetPrecision",paramStr),a=QtyEntered.toFixed(t.getValueOfInt(v)),QtyEntered!=a&&(this.log.fine("Corrected QtyEntered Scale UOM="+s+"; QtyEntered="+QtyEntered+"->"+a),QtyEntered=a,u.setValue("QtyEntered",QtyEntered)),paramStr=c.toString().concat(",",s.toString(),",",QtyEntered.toString()),l=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",paramStr),QtyOrdered=l,QtyOrdered==null&&(QtyOrdered=QtyEntered),h=QtyEntered!=QtyOrdered,this.log.fine("UOM="+s+", QtyEntered="+QtyEntered+" -> "+h+" QtyOrdered="+QtyOrdered),i.setContext(r,"UOMConversion",h?"Y":"N"),u.setValue("MovementQty",QtyOrdered))}catch(y){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutInventoryMove=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutAssignment")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.Product=function(i,u,f,e,o,s){var c,v;if(o==null||o.toString()==""||this.isCalloutActive()||o==null||(c=t.getValueOfInt(o),c==0))return"";this.setCalloutActive(!0);var l=0,a=null,y=null,p=null,w="SELECT p.M_Product_ID, ra.Name, ra.Description, ra.Qty FROM S_ResourceAssignment ra INNER JOIN M_Product p ON (p.S_Resource_ID=ra.S_Resource_ID) WHERE ra.S_ResourceAssignment_ID="+c,h=null;try{h=n.DB.executeReader(w,null,null);h.read()&&(l=t.getValueOfInt(h.get(0)),a=t.getValueOfString(h.get(1)),y=t.getValueOfString(h.get(2)),p=t.getValueOfDecimal(h.get(3)));h.close()}catch(b){h!=null&&(h.close(),h=null);this.setCalloutActive(!1);this.log.log(r.SEVERE,"product",b)}return this.log.fine("S_ResourceAssignment_ID="+c+" - M_Product_ID="+l),l!=0&&(f.setValue("M_Product_ID",t.getValueOfInt(l)),y!=null&&(a+=" ("+y+")"),"."!=a&&f.setValue("Description",a),v="Qty",f.getTableName().startsWith("C_Order")?v="QtyOrdered":f.getTableName().startsWith("C_Invoice")&&(v="QtyInvoiced"),p!=null&&f.setValue(v,p)),this.setCalloutActive(!1),i=u=f=e=o=s=null,""};n.Model.CalloutAssignment=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutCashJournal")}function r(){n.CalloutEngine.call(this,"VIS.CalloutSetReadOnly")}function u(){n.CalloutEngine.call(this,"VIS.CalloutCashJournalLine")}var f=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.Invoice=function(i,r,u,e,o,s){var l,v,g,d;if(this.isCalloutActive())return"";if(o==null||o.toString()=="")return e.getColumnName()=="C_Invoice_ID"&&(this.setCalloutActive(!0),u.setValue("C_BPartner_ID",null),u.setValue("C_BPartner_Location_ID",null),u.setValue("C_InvoicePaySchedule_ID",null),i.setContext(r,"InvTotalAmt",""),i.setContext("InvTotalAmt",""),u.setValue("ConvertedAmt",n.Env.ZERO),u.setValue("Amount",n.Env.ZERO),u.setValue("DiscountAmt",n.Env.ZERO),u.setValue("WriteOffAmt",n.Env.ZERO),u.setValue("OverUnderAmt",n.Env.ZERO),this.setCalloutActive(!1)),"";this.setCalloutActive(!0);var a=t.getValueOfInt(o),p=0,w=0,b=0,c=null;try{c=n.dataContext.getJSONRecord("MInvoice/GetInvPaySchedDetail",a.toString());c!=null&&(w=t.getValueOfInt(c.C_InvoicePaySchedule_ID),u.setValue("C_InvoicePaySchedule_ID",w),p=t.getValueOfDecimal(c.dueAmount),b=1)}catch(y){return c!=null&&(c=null),this.log.log(f.SEVERE,"CalloutCashJournal.Invoice -"+a,y.message),y.toString()}if(a==null||a==0)return u.setValue("C_Currency_ID",null),this.setCalloutActive(!1),"";var k=new Date(i.getContext(r,"DateAcct")),nt="TO_DATE( '"+(Number(k.getMonth())+1)+"-"+k.getDate()+"-"+k.getFullYear()+"', 'MM-DD-YYYY')",tt=a.toString()+","+nt.toString()+","+w.toString(),h=null;try{h=n.dataContext.getJSONRecord("MInvoice/GetInvoiceDetails",tt);h!=null&&(l=0,u.setValue("C_BPartner_ID",t.getValueOfInt(h.C_BPartner_ID)),u.setValue("C_Currency_ID",t.getValueOfInt(h.C_Currency_ID)),u.setValue("C_ConversionType_ID",t.getValueOfInt(h.C_ConversionType_ID)),u.setValue("C_BPartner_Location_ID",t.getValueOfInt(h.C_BPartner_Location_ID)),l=b==0?t.getValueOfDecimal(h.invoiceOpen):p,v=t.getValueOfDecimal(h.paymentTermDiscount),g="Y"==h.IsSOTrx,g||(l=b==0?l*-1:p*-1,v=v*-1),d=t.getValueOfString(h.docbaseType),"ARC"==d||"API"==d?u.setValue("VSS_PAYMENTTYPE","P"):u.setValue("VSS_PAYMENTTYPE","R"),i.setContext("InvTotalAmt",l.toString()),u.setValue("Amount",l-v),u.setValue("DiscountAmt",v),u.setValue("WriteOffAmt",n.Env.ZERO))}catch(y){return idr!=null&&(idr.close(),idr=null),this.log.log(f.SEVERE,"invoice",y),this.setCalloutActive(!1),y.toString()}return this.setCalloutActive(!1),i=r=u=e=o=s=null,""};i.prototype.SetAmount=function(i,r,u,f,e){var l,y,p,o,w,a,v,s,h,c;if(this.isCalloutActive()||e==null||e.toString()=="")return"";if(this.setCalloutActive(!0),e==null||e.toString()=="")return t.getValueOfInt(u.getValue("C_Invoice_ID"))>0?(l=t.getValueOfDecimal(n.dataContext.getJSONRecord("MCashBook/GetPaySheduleAmt",u.getValue("C_Invoice_ID").toString())),i.setContext(r,"InvTotalAmt",l.toString()),u.setValue("Amount",l),this.setCalloutActive(!1),""):"";if(u.setValue("DiscountAmt",n.Env.ZERO),u.setValue("WriteOffAmt",n.Env.ZERO),u.setValue("OverUnderAmt",n.Env.ZERO),y=n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix","VA009_"),y.VA009_){if(i.setContext("InvTotalAmt",""),s=t.getValueOfInt(e),s==null||s==0)return i.setContext(r,"InvTotalAmt",null),u.getTableName()=="C_Payment"?u.setValue("PayAmt",null):u.setValue("Amount",null),u.setValue("DiscountAmt",0),u.setValue("WriteOffAmt",n.Env.ZERO),i.setContext("InvTotalAmt",0),this.setCalloutActive(!1),"";p=s.toString()+","+u.getValue("C_Cash_ID")+","+u.getValue("C_Invoice_ID");o=n.dataContext.getJSONRecord("MCashBook/GetPaySheduleData",p);o!=null&&(u.getTableName()=="C_Payment"?(w=o.IsReturnTrx,w=="Y"?u.setValue("PayAmt",t.getValueOfDecimal(o.DueAmt)*-1):u.setValue("PayAmt",t.getValueOfDecimal(o.DueAmt))):(u.setValue("Amount",t.getValueOfDecimal(o.DueAmt)),i.setContext(r,"InvTotalAmt",t.getValueOfDecimal(u.getValue("Amount"))),u.setValue("WriteOffAmt",0),u.setValue("OverUnderAmt",0),a=t.getValueOfDate(o.accountDate),v=t.getValueOfString(o.isSoTrx),t.getValueOfDate(o.DiscountDate)>=a?(v=="N"?u.setValue("DiscountAmt",-1*t.getValueOfDecimal(o.DiscountAmt)):u.setValue("DiscountAmt",t.getValueOfDecimal(o.DiscountAmt)),u.setValue("Amount",t.getValueOfDecimal(o.DueAmt)-t.getValueOfDecimal(o.DiscountAmt))):t.getValueOfDate(o.DiscountDays2)>=a?(v=="N"?u.setValue("DiscountAmt",-1*t.getValueOfDecimal(o.Discount2)):u.setValue("DiscountAmt",t.getValueOfDecimal(o.Discount2)),u.setValue("Amount",t.getValueOfDecimal(o.DueAmt)-t.getValueOfDecimal(o.Discount2))):u.setValue("DiscountAmt",0)))}else{if(s=t.getValueOfInt(e),s==null||s==0)return i.setContext(r,"InvTotalAmt",null),u.getTableName()=="C_Payment"?u.setValue("PayAmt",null):u.setValue("Amount",null),this.setCalloutActive(!1),"";h=n.dataContext.getJSONRecord("MCashBook/GetInvSchedDueAmt",s.toString());h!=null&&(c=h.DueAmt,u.getTableName()=="C_Payment"?h.IsReturnTrx=="Y"?u.setValue("PayAmt",c*-1):u.setValue("PayAmt",c):(u.setValue("Amount",c),i.setContext(r,"InvTotalAmt",t.getValueOfDecimal(u.getValue("Amount")))))}return this.setCalloutActive(!1),""};i.prototype.Amounts=function(i,r,u,f,e,o){var v,c,p,s,b,nt;if(this.isCalloutActive())return"";if(v=0,c=0,"I"==u.getValue("CashType")){if(v=i.getContext("InvTotalAmt"),(v==null||v.toString().length==0)&&(v=i.getContext(r,"InvTotalAmt")),v==null||v.toString().length==0)return"";c=t.getValueOfDecimal(v)}if(this.setCalloutActive(!0),p=0,s=t.getValueOfDecimal(u.getValue("Amount")),"I"==u.getValue("CashType")){var a=t.getValueOfDecimal(u.getValue("DiscountAmt")),l=t.getValueOfDecimal(u.getValue("WriteOffAmt")),h=t.getValueOfDecimal(u.getValue("OverUnderAmt")),w=f.getColumnName(),y=u.getValue("VSS_PaymentType");y=="P"?(s>0&&(s=s*-1,u.setValue("PayAmt",s)),a>0&&(a=a*-1),l>0&&(l=l*-1,u.setValue("WriteOffAmt",l)),h>0&&(h=h*-1,u.setValue("OverUnderAmt",h)),c>0&&(c=c*-1)):(s<0&&(s=s*-1,u.setValue("PayAmt",s)),a<0&&(a=a*-1),l<0&&(l=l*-1,u.setValue("WriteOffAmt",l)),h<0&&(h=h*-1,u.setValue("OverUnderAmt",h)),c<0&&(c=c*-1));this.log.fine(w+" - Invoice="+c+" - Amount="+s+", Discount="+a+", WriteOff="+l);w=="Amount"?(b=c-s,h=b-a-l,(y=="R"&&h>0||y=="P"&&h<0)&&n.ADialog.info("LessScheduleAmount"),(y=="P"&&h>0||y=="R"&&h<0)&&(n.ADialog.info("MoreScheduleAmount"),s=c-a-l,h=c-s-a-l,u.setValue("PayAmt",s)),u.setValue("DiscountAmt",a),u.setValue("OverUnderAmt",h)):(b=c-a,s=b-l-h,(y=="P"&&s>0||y=="R"&&s<0)&&(n.ADialog.info("MoreScheduleAmount"),w=="OverUnderAmt"&&(s=c-a-l,h=c-s-a-l,u.setValue("OverUnderAmt",h)),w=="DiscountAmt"&&(s=c-h-l,a=c-s-h-l,u.setValue("DiscountAmt",a)),w=="WriteOffAmt"&&(s=c-a-h,l=c-s-a-h,u.setValue("WriteOffAmt",l))),u.setValue("Amount",s),(y=="R"&&h>0||y=="P"&&h<0)&&n.ADialog.info("LessScheduleAmount"))}var k=u.getValue("C_Cash_ID").toString(),d=n.dataContext.getJSONRecord("MCashBook/GetCashJournal",k),it=d.DateAcct,g=d.C_Currency_ID,tt=d.C_Currency_ID;return u.getValue("C_Currency_ID")!=null&&(g=u.getValue("C_Currency_ID").toString()),nt=0,u.getField("C_ConversionType_ID")!=null&&(nt=t.getValueOfInt(u.getValue("C_ConversionType_ID"))),g!=tt?(k=s.toString()+","+g+","+tt+","+it+","+nt.toString()+","+i.getAD_Client_ID().toString()+","+i.getAD_Org_ID().toString(),p=n.dataContext.getJSONRecord("MConversionRate/CurrencyConvert",k),t.getValueOfDecimal(u.getValue("Amount"))!=0&&p==0&&n.ADialog.info("NoCurrencyConversion")):p=s,u.setValue("convertedAmt",p),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.BeginningBalCalc=function(i,r,u,e,o,s){var h,c,l;if(o==null||o.toString()==""||this.isCalloutActive())return"";if(this.setCalloutActive(!0),h=t.getValueOfInt(o),h==null||h==0)return u.setValue("BeginningBalance",0),this.setCalloutActive(!1),"";var v=t.getValueOfInt(u.getValue("C_CashBook_ID")),y=t.getValueOfInt(u.getValue("AD_Client_ID")),p=t.getValueOfInt(u.getValue("AD_Org_ID")),w=i.getContext("DateAcct");try{c="";c=v.toString()+","+y.toString()+","+p.toString();l=t.getValueOfDecimal(n.dataContext.getJSONRecord("MCashJournal/GetBeginningBalCalc",c));u.setValue("BeginningBalance",l)}catch(a){return idr!=null&&idr.close(),this.log.log(f.SEVERE,"Beginning balance",a),this.setCalloutActive(!1),a.toString()}return this.setCalloutActive(!1),i=r=u=e=o=s=null,""};i.prototype.SetCurrency=function(i,r,u,f,e,o){var s,h,c,w,l,b,p;if((e==null||e.toString()=="")&&f.getColumnName()!="C_ConversionType_ID")return u.setValue("C_Currency_ID",0),"";if(this.isCalloutActive())return"";if(this.setCalloutActive(!0),s="",h=t.getValueOfDecimal(u.getValue("Amount")),f.getColumnName()=="C_CashBook_ID"){if(c=t.getValueOfInt(e),c==null||c==0)return u.setValue("C_Currency_ID",0),this.setCalloutActive(!1),"";s=c.toString();w=n.dataContext.getJSONRecord("MCashBook/GetCashBook",s);u.setValue("C_Currency_ID",w.C_Currency_ID)}else if(f.getColumnName()=="C_BankAccount_ID"){if(l=t.getValueOfInt(e),l==null||l==0)return u.setValue("C_Currency_ID",0),this.setCalloutActive(!1),"";s=l.toString();b=t.getValueOfInt(n.dataContext.getJSONRecord("MCashBook/GetBankAcctCurr",s));u.setValue("C_Currency_ID",b)}if(h!=0){s=u.getValue("C_Cash_ID").toString();var a=0,v=n.dataContext.getJSONRecord("MCashBook/GetCashJournal",s),d=v.DateAcct,y=v.C_Currency_ID,k=v.C_Currency_ID;u.getValue("C_Currency_ID")!=null&&(y=u.getValue("C_Currency_ID").toString());p=0;u.getField("C_ConversionType_ID")!=null&&(p=t.getValueOfInt(u.getValue("C_ConversionType_ID")));y!=k?(s=h.toString()+","+y+","+k+","+d+","+p.toString()+","+i.getAD_Client_ID().toString()+","+i.getAD_Org_ID().toString(),a=n.dataContext.getJSONRecord("MConversionRate/CurrencyConvert",s),a==0&&n.ADialog.info("NoCurrencyConversion")):a=h;u.setValue("convertedAmt",a)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.ConvertedAmt=function(i,r,u,f,e,o){var s,h,l,v,c,a;if(e==null||e.toString()==""||this.isCalloutActive())return"";this.setCalloutActive(!0);s="";try{if(s=e.toString()+","+u.getValue("C_Cash_ID").toString(),h=n.dataContext.getJSONRecord("MCashBook/GetConvertedAmt",s),l=t.getValueOfInt(h.CurrTo),l==0)return this.setCalloutActive(!1),"";v=t.getValueOfInt(h.CurrFrom);c=t.getValueOfInt(h.Amt);s="";s=c.toString()+","+v.toString()+","+l.toString()+","+i.getAD_Client_ID().toString()+","+i.getAD_Org_ID().toString();a=n.dataContext.getJSONRecord("MConversionRate/Convert",s);c!=0&&a==0&&n.ADialog.info("NoCurrencyConversion");u.setValue("ConvertedAmt",a);u.setValue("Amount",c)}catch(y){this.setCalloutActive(!1)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.GetBeginBal=function(t,i,r,u,f){if(f==null||f==""||this.isCalloutActive())return"";this.setCalloutActive(!0);var o=f.toString(),e=0;return e=n.dataContext.getJSONRecord("MCashBook/GetBegiBalance",o),e!=0&&r.setValue("BeginningBalance",e),this.setCalloutActive(!1),""};n.Model.CalloutCashJournal=i;n.Utility.inheritPrototype(r,n.CalloutEngine);r.prototype.SetReadnly=function(n,i,r,u,f){return f==null||f.toString()==""||f.toString()=="E"?(this.setCalloutActive(!1),f!=null&&f.toString()=="E"&&(r.getField("VSS_PAYMENTTYPE").setReadOnly(!0),r.setValue("VSS_PAYMENTTYPE","P")),""):(this.setCalloutActive(!0),t.getValueOfString(r.getValue("CashType"))=="A"||t.getValueOfString(r.getValue("CashType"))=="E"?(r.setValue("VSS_PAYMENTTYPE","P"),r.getField("VSS_PAYMENTTYPE").setReadOnly(!0)):t.getValueOfString(r.getValue("CashType"))=="F"||t.getValueOfString(r.getValue("CashType"))=="R"?(r.setValue("VSS_PAYMENTTYPE","R"),r.getField("VSS_PAYMENTTYPE").setReadOnly(!0)):t.getValueOfString(r.getValue("CashType"))=="I"?r.getField("VSS_PAYMENTTYPE").setReadOnly(!0):r.getField("VSS_PAYMENTTYPE").setReadOnly(!1),t.getValueOfString(r.getValue("VSS_PAYMENTTYPE"))=="P"?t.getValueOfDecimal(r.getValue("amount"))>0&&r.setValue("Amount",0-t.getValueOfDecimal(r.getValue("amount"))):t.getValueOfString(r.getValue("VSS_PAYMENTTYPE"))=="R"&&t.getValueOfDecimal(r.getValue("amount"))<0&&r.setValue("Amount",0-t.getValueOfDecimal(r.getValue("amount"))),this.setCalloutActive(!1),"")};r.prototype.SetAmountValue=function(n,i,r,u,f){return f==null||f.toString()==""?(r.getField("VSS_PAYMENTTYPE").setReadOnly(!1),this.setCalloutActive(!1),""):(this.setCalloutActive(!0),t.getValueOfString(r.getValue("CashType"))!="B"&&(t.getValueOfString(r.getValue("VSS_PAYMENTTYPE"))=="P"?t.getValueOfDecimal(r.getValue("amount"))>0&&r.setValue("Amount",0-t.getValueOfDecimal(r.getValue("amount"))):t.getValueOfString(r.getValue("VSS_PAYMENTTYPE"))=="R"&&t.getValueOfDecimal(r.getValue("amount"))<0&&r.setValue("Amount",0-t.getValueOfDecimal(r.getValue("amount")))),this.setCalloutActive(!1),"")};n.Model.CalloutSetReadOnly=r;n.Utility.inheritPrototype(u,n.CalloutEngine);u.prototype.SetBPLocation=function(i,r,u,f,e){var o,c,s,l,h;if(this.isCalloutActive()||e==null||e.toString()=="")return u.setValue("C_BPartner_Location_ID",null),"";this.setCalloutActive(!0);try{if(u.getValue("CashType")=="B"||u.getValue("CashType")=="C"){if(o=u.getValue("C_BPartner_ID"),o==null||o=="")return u.setValue("C_BPartner_Location_ID",null),this.setCalloutActive(!1),"";if(c=o.toString()+","+i.getAD_Client_ID().toString(),s=n.dataContext.getJSONRecord("MCashJournal/GetBPLocation",c),s!=null){if(l=t.getValueOfInt(s.CreditStatusSettingOn),h=t.getValueOfInt(s.C_BPartner_Location_ID),l=="CL"&&h==0)return this.setCalloutActive(!1),n.Msg.getMsg("LocationNew");u.setValue("C_BPartner_Location_ID",h)}}}catch(a){this.setCalloutActive(!1);this.log.severe(a.toString())}return this.setCalloutActive(!1),""};u.prototype.setAccountNo=function(i,r,u,f,e){if(this.isCalloutActive()||e==null||e.toString()=="")return u.setValue("C_BankAccount_ID",null),"";this.setCalloutActive(!0);try{var o=n.dataContext.getJSONRecord("MCashJournal/GetBankAccountData",e);o!=null&&(u.setValue("RoutingNo",t.getValueOfString(o.RoutingNo)),u.setValue("AccountNo",t.getValueOfString(o.AccountNo)))}catch(s){this.setCalloutActive(!1);this.log.severe(s.toString())}return this.setCalloutActive(!1),""};n.Model.CalloutCashJournalLine=u}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutSetAttributeCode")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.FillAttribute=function(i,r,u,f,e){var o,s,l,h,a,c;return this.isCalloutActive()||e==null||e.toString()==""?"":(o=i.getContext(r,"AttrCode"),this.setCalloutActive(!0),o!=null&&o!=""&&(s="SELECT M_AttributeSet_ID FROM M_Product WHERE M_Product_ID = "+t.getValueOfInt(e),l=t.getValueOfInt(n.DB.executeScalar(s)),l>0&&(s="SELECT M_AttributeSetInstance_ID FROM M_ProductAttributes WHERE UPC = '"+o+"' AND M_Product_ID = "+t.getValueOfInt(e),h=t.getValueOfInt(n.DB.executeScalar(s)),h>0?u.setValue("M_AttributeSetInstance_ID",h):o.indexOf("(01)")>=0&&(a=o+","+t.getValueOfInt(e)+","+r,c=n.dataContext.getJSONRecord("MInOut/GetASIID",a),c!=0&&u.setValue("M_AttributeSetInstance_ID",c)))),this.setCalloutActive(!1),"")};i.prototype.FillUPC=function(i,r,u,f,e){var s="",h=0,o;if(this.isCalloutActive()||e==null||e.toString()=="")return"";if(o=i.getContext(r,"AttrCode"),this.setCalloutActive(!0),t.getValueOfString(o)!=""){if(s="SELECT Count(*) FROM M_Manufacturer WHERE IsActive = 'Y' AND UPC = '"+o+"'",h=t.getValueOfInt(n.DB.executeScalar(s,null,null)),h>0)return this.setCalloutActive(!1),n.Msg.getMsg("Attribute Code Already Exist");u.setValue("UPC",o)}return this.setCalloutActive(!1),""};n.Model.CalloutSetAttributeCode=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutProduct")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.ProductCategory=function(i,r,u,f,e,o){var s,c,h,l;return e==null||e.toString()==""?"":(s=t.getValueOfInt(e),s==null||t.getValueOfInt(s)==0||s==0)?"":(c=t.getValueOfInt(e),h=null,h=n.dataContext.getJSONRecord("MProductCategory/GetProductCategory",c),l=h.IsPurchasedToOrder,u.setValue("IsPurchasedToOrder",l),pc=null,i=r=u=f=e=o=null,"")};i.prototype.UOM=function(i,r,u,f,e,o){var s,h,c;return this.isCalloutActive()||e==null||e.toString()==""?"":u.getValue("M_Product_id")==null?"":(this.setCalloutActive(!0),s="select count(*) from m_transaction where m_product_id = "+t.getValueOfInt(u.getValue("M_Product_id")),h=t.getValueOfInt(n.DB.executeScalar(s,null,null)),h>0&&(n.ADialog.info("Can't change UOM due to Transactions happens based on existing UOM"),s="select c_uom_id from m_product where m_product_id =  "+t.getValueOfInt(u.getValue("M_Product_id")),c=t.getValueOfInt(n.DB.executeScalar(s,null,null)),u.setValue("C_UOM_ID",c)),this.setCalloutActive(!1),i=r=u=f=e=o=null,"")};i.prototype.ResourceGroup=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=t.getValueOfString(f);return o==null||o.length==0?"":("O"==o?r.setValue("BasisType",null):r.setValue("BasisType","I"),n=i=r=u=f=e=null,"")};i.prototype.Organization=function(i,r,u,f,e,o){var h,s,c;return e==null||e.toString()==""?"":(h=t.getValueOfInt(e),h==null)?"":(s=null,s=n.dataContext.getJSONRecord("MLocator/GetLocator",paramString),c=s.Default_Locator_ID,u.setValue("M_Locator_ID",c),i=r=u=f=e=o=null,"")};n.Model.CalloutProduct=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutPayment")}function r(){n.CalloutEngine.call(this,"VIS.CalloutPaymentAllocate")}function u(){n.CalloutEngine.call(this,"VIS.CalloutPaymentTypeSO")}var f=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.Invoice=function(i,r,u,e,o){var c,g,y,nt,s,tt,p,a;if(o==null||o.toString()==""||(c=t.getValueOfInt(o.toString()),this.isCalloutActive()||c==null||c==0))return"";this.setCalloutActive(!0);u.setValue("C_Order_ID",null);u.setValue("C_Charge_ID",null);u.setValue("IsPrepayment",!1);u.setValue("DiscountAmt",n.Env.ZERO);u.setValue("WriteOffAmt",n.Env.ZERO);u.setValue("IsOverUnderPayment",!1);u.setValue("OverUnderAmt",n.Env.ZERO);var l=0,b="",k=!1,it=u.getField("IsInDispute")!=null,v=0,d=0,h=null;try{h=n.dataContext.getJSONRecord("MInvoice/GetInvPaySchedDetail",c.toString());h!=null&&(l=t.getValueOfInt(h.C_InvoicePaySchedule_ID),v=t.getValueOfDecimal(h.dueAmount),b=t.getValueOfString(h.IsReturnTrx),"Y"==b&&(v=v*-1),u.setValue("C_InvoicePaySchedule_ID",l),u.setValue("PayAmt",v),d=1,g=n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix","VA009_"),g.VA009_&&(t.getValueOfString(h.VA009_PaymentBaseType)!="B"&&t.getValueOfString(h.VA009_PaymentBaseType)!="C"&&t.getValueOfString(h.VA009_PaymentBaseType)!="P"?u.setValue("VA009_PaymentMethod_ID",t.getValueOfInt(h.VA009_PaymentMethod_ID)):u.setValue("VA009_PaymentMethod_ID",null)))}catch(w){return this.setCalloutActive(!1),this.log.log(f.SEVERE,"CalloutPayment.Invoice -"+c,w.message),w.toString()}i.getContextAsInt(r,"C_Invoice_ID")==c&&i.getContextAsInt(r,"C_InvoicePaySchedule_ID")!=0&&(l=i.getContextAsInt(r,"C_InvoicePaySchedule_ID"));y=new Date(u.getValue("DateTrx"));y==null&&(y=new Date);nt=c.toString()+","+l.toString()+","+y.toString();s=null;try{s=n.dataContext.getJSONRecord("MPayment/GetInvoiceData",nt);s!=null&&(u.setValue("C_BPartner_ID",t.getValueOfInt(s.C_BPartner_ID)),u.setValue("C_Bpartner_Location_Id",t.getValueOfInt(s.C_Bpartner_Location_Id)),tt=t.getValueOfInt(s.C_Currency_ID),u.setValue("C_Currency_ID",tt),u.setValue("C_ConversionType_ID",s.C_ConversionType_ID),p=t.getValueOfDecimal(s.invoiceOpen),p==null&&(p=n.Env.ZERO),a=t.getValueOfDecimal(s.invoiceDiscount),a==null&&(a=n.Env.ZERO),d==0&&u.setValue("PayAmt",p-a),u.setValue("C_InvoicePaySchedule_ID",l),u.setValue("DiscountAmt",a),i.setContext(r,"C_Invoice_ID",c.toString()),k=t.getValueOfString(s.IsInDispute)=="Y",it&&(k?(u.setValue("IsInDispute",!0),n.ADialog.info("DiscrepancyInvoice")):u.setValue("IsInDispute",!1)))}catch(w){return this.setCalloutActive(!1),w.message}return this.setCalloutActive(!1),this.DocType(i,r,u,e,o)};i.prototype.Order=function(i,r,u,f,e){var s,a,h,c,o,v,l,y;if(e==null||e.toString()==""||(s=e,this.isCalloutActive()||s==null||s==0))return"";this.setCalloutActive(!0);u.setValue("C_Invoice_ID",null);u.setValue("C_Charge_ID",null);u.setValue("IsPrepayment",!0);u.setValue("DiscountAmt",n.Env.ZERO);u.setValue("WriteOffAmt",n.Env.ZERO);u.setValue("IsOverUnderPayment",!1);u.setValue("OverUnderAmt",n.Env.ZERO);a=u.getValue("DateTrx");a==null&&(a=new Date);h=!1;c="VA009_";try{o=n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix",c);o!=null&&(h=o.VA009_);c=h.toString()+","+s.toString();o=n.dataContext.getJSONRecord("MPayment/GetOrderData",c);o!=null&&(u.setValue("C_BPartner_ID",t.getValueOfInt(o.C_BPartner_ID)),u.setValue("C_BPartner_Location_ID",t.getValueOfInt(o.C_BPartner_Location_ID)),v=t.getValueOfInt(o.C_Currency_ID),u.setValue("C_Currency_ID",v),l=t.getValueOfDecimal(o.GrandTotal),l==null&&(l=n.Env.ZERO),h&&(y=t.getValueOfInt(o.VA009_PaymentMethod_ID),u.setValue("VA009_PaymentMethod_ID",y)),u.setValue("PayAmt",l))}catch(p){return this.setCalloutActive(!1),p.message}return this.setCalloutActive(!1),this.DocType(i,r,u,f,e)};i.prototype.Charge=function(t,i,r,u,f){if(f==null||f.toString()=="")return""};i.prototype.DocType=function(i,r,u,f,e,o){var h=i.getContextAsInt(r,"C_Invoice_ID"),v=i.getContextAsInt(r,"C_Order_ID"),c=i.getContextAsInt(r,"C_DocType_ID"),y,p;this.log.fine("Payment_DocType - C_Invoice_ID="+h+", C_DocType_ID="+c);var s=c.toString(),l=n.dataContext.getJSONRecord("MDocType/GetDocType",s),a=t.getValueOfBoolean(l.IsSOTrx);return(c!=0&&i.setWindowContext(r,"IsSOTrx",a?"Y":"N"),h!=0&&(s=h.toString(),y=n.dataContext.getJSONRecord("MInvoice/GetInvoice",s),l!=null&&t.getValueOfBoolean(y.IsSOTrx)!=a))?n.Msg.getMsg("DocTypeInvInconsistent"):v!=0&&(s=v.toString(),p=n.dataContext.getJSONRecord("MOrder/GetOrder",s),l!=null&&t.getValueOfBoolean(p.IsSOTrx)!=a)?n.Msg.getMsg("DocTypeOrdInconsistent"):(i=r=u=f=e=o=null,"")};i.prototype.AmountCurrencyType=function(i,r,u,f,e){var o,h,c;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);var l=u.getValue("C_BPartner_ID"),a=u.getValue("AsOnDate"),s=!1;try{o=null;o=n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix","VA027_");o!=null&&(s=o.VA027_);h=s.toString()+","+l.toString()+","+a.toString();o=n.dataContext.getJSONRecord("MPayment/GetOutStandingAmt",h);o!=null&&(c=t.getValueOfString(o),u.setValue("OutStandingAmount",c))}catch(v){return this.setCalloutActive(!1),v.message}return this.setCalloutActive(!1),""};i.prototype.Amounts=function(i,r,u,f,e,o){var w,rt,y,ut,tt,it,d,lt;if(this.isCalloutActive()||(w=i.getContextAsInt(r,"C_Invoice_ID"),i.getContextAsInt(r,"C_Payment_ID")==0&&i.getContextAsInt(r,"C_BPartner_ID")==0&&w==0)||(rt=u.getValue("C_Currency_ID"),rt==null))return"";if(w!=0){this.setCalloutActive(!0);y=f.getColumnName();ut=0;i.getContextAsInt(r,"C_Invoice_ID")==w&&u.getValue("C_InvoicePaySchedule_ID")!=null&&(ut=u.getValue("C_InvoicePaySchedule_ID"));var l=n.Env.ZERO,h=n.Env.ZERO,b=0,ft=0,p="N",et=!0;w!=0&&(tt=u.getValue("DateTrx"),tt==null&&(tt=new Date),it=w.toString()+","+ut.toString()+","+tt.toString(),d=n.dataContext.getJSONRecord("MPayment/GetInvoiceData",it),d!=null&&(b=t.getValueOfInt(d.C_Currency_ID),ft=t.getValueOfInt(d.C_ConversionType_ID),l=t.getValueOfDecimal(d.invoiceOpen),l==null&&(l=n.Env.ZERO),h=t.getValueOfDecimal(d.invoiceDiscount),p=d.IsReturnTrx));this.log.fine("Open="+l+" Discount= "+h+", C_Invoice_ID="+w+", C_Currency_ID="+b);var c=t.getValueOfDecimal(u.getValue("PayAmt")==null?n.Env.ZERO:u.getValue("PayAmt")),a=t.getValueOfDecimal(u.getValue("WriteOffAmt")==null?n.Env.ZERO:u.getValue("WriteOffAmt")),s=t.getValueOfDecimal(u.getValue("OverUnderAmt")==null?n.Env.ZERO:u.getValue("OverUnderAmt")),v=t.getValueOfDecimal(u.getValue("DiscountAmt")==null?n.Env.ZERO:u.getValue("DiscountAmt"));p=="Y"?(c>0&&(c=c*-1,u.setValue("PayAmt",c)),v>0&&(v=v*-1),h>0&&(h=h*-1),a>0&&(a=a*-1,u.setValue("WriteOffAmt",a)),s>0&&(s=s*-1,u.setValue("OverUnderAmt",s)),l>0&&(l=l*-1)):(c<0&&(c=c*-1,u.setValue("PayAmt",c)),v<0&&(v=v*-1),h<0&&(h=h*-1),a<0&&(a=a*-1,u.setValue("WriteOffAmt",a)),s<0&&(s=s*-1,u.setValue("OverUnderAmt",s)),l<0&&(l=l*-1));this.log.fine("Pay="+c+", Discount="+v+", WriteOff="+a+", OverUnderAmt="+s);var nt=t.getValueOfInt(rt),it=nt.toString(),ot=n.dataContext.getJSONRecord("MCurrency/GetCurrency",it),k=ot.StdPrecision,ht=u.getValue("DateAcct"),st=0,ct=t.getValueOfInt(u.getValue("C_ConversionType_ID"));ct!=null&&(st=ct);var at=i.getContextAsInt(r,"AD_Client_ID"),vt=i.getContextAsInt(r,"AD_Org_ID"),g=n.Env.ONE;if(nt>0&&b>0&&nt!=b||y=="C_Currency_ID"||y=="C_ConversionType_ID"){if(this.log.fine("InvCurrency="+b+", PayCurrency="+nt+", Date="+ht+", Type="+st),lt=b+","+nt+","+ht+","+st+","+at+","+vt,g=n.dataContext.getJSONRecord("MConversionRate/GetRate",lt),g==null||g.toString()==0){if(this.setCalloutActive(!1),b==0)return"";if(u.setValue("C_Currency_ID",b),y=="C_ConversionType_ID"){if(ft==0)return"";u.setValue("C_ConversionType_ID",ft)}return"NoCurrencyConversion"}l=t.getValueOfDecimal((l*g).toFixed(ot.StdPrecision));v!=0&&(h=v);h=t.getValueOfDecimal((h*g).toFixed(ot.StdPrecision));this.log.fine("Rate="+g+", InvoiceOpenAmt="+l+", DiscountAmt="+h)}y=="C_Currency_ID"||y=="C_ConversionType_ID"?(a=0,u.setValue("WriteOffAmt",a),s=0,u.setValue("OverUnderAmt",s),v=0,u.setValue("DiscountAmt",v),h=v,c=l-h-a-s,u.setValue("PayAmt",t.getValueOfDecimal(c.toFixed(k)))):w==0?(n.Env.ZERO!=h&&u.setValue("DiscountAmt",n.Env.ZERO),n.Env.ZERO!=a&&u.setValue("WriteOffAmt",n.Env.ZERO),n.Env.ZERO!=s&&u.setValue("OverUnderAmt",n.Env.ZERO)):y=="PayAmt"?(v!=0&&(h=v),s=l-c-h-a,(p=="N"&&s>0||p=="Y"&&s<0)&&n.ADialog.info("LessScheduleAmount"),(p=="Y"&&s>0||p=="N"&&s<0)&&(n.ADialog.info("MoreScheduleAmount"),c=l-h-a,s=l-c-h-a,et?u.setValue("PayAmt",t.getValueOfDecimal(c.toFixed(k))):u.setValue("PayAmt",c)),et?(u.setValue("DiscountAmt",t.getValueOfDecimal(h.toFixed(k))),u.setValue("OverUnderAmt",t.getValueOfDecimal(s.toFixed(k)))):(u.setValue("DiscountAmt",h),u.setValue("OverUnderAmt",s))):(h=v,c=l-h-a-s,(p=="Y"&&c>0||p=="N"&&c<0)&&(n.ADialog.info("MoreScheduleAmount"),y=="OverUnderAmt"&&(c=l-h-a,s=l-c-h-a),y=="DiscountAmt"&&(c=l-s-a,h=l-c-s-a),y=="WriteOffAmt"&&(c=l-h-s,a=l-c-h-s)),et?(u.setValue("PayAmt",t.getValueOfDecimal(c.toFixed(k))),u.setValue("DiscountAmt",t.getValueOfDecimal(h.toFixed(k))),u.setValue("WriteOffAmt",t.getValueOfDecimal(a.toFixed(k))),u.setValue("OverUnderAmt",t.getValueOfDecimal(s.toFixed(k)))):(u.setValue("PayAmt",c),u.setValue("DiscountAmt",h),u.setValue("WriteOffAmt",a),u.setValue("OverUnderAmt",s)),(p=="N"&&s>0||p=="Y"&&s<0)&&n.ADialog.info("LessScheduleAmount"));this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};n.Model.CalloutPayment=i;n.Utility.inheritPrototype(r,n.CalloutEngine);r.prototype.Invoice=function(i,r,u,e,o,s){var h,c,k,p,a,v,y;if(o==null||o.toString()==""||(h=t.getValueOfInt(o),this.isCalloutActive()||h==null||h==0))return"";var nt=i.getContextAsInt(r,"C_Payment_ID"),p=nt.toString(),w=null;if(w=n.dataContext.getJSONRecord("MPayment/GetPayment",p),w.C_Charge_ID!=0||w.C_Invoice_ID!=0||w.C_Order_ID!=0)return n.Msg.getMsg("PaymentIsAllocated");this.setCalloutActive(!0);u.setValue("DiscountAmt",n.Env.ZERO);u.setValue("WriteOffAmt",n.Env.ZERO);u.setValue("OverUnderAmt",n.Env.ZERO);c=0;i.getContextAsInt(r,"C_Invoice_ID")==h&&i.getContextAsInt(r,"C_InvoicePaySchedule_ID")!=0&&(c=i.getContextAsInt(r,"C_InvoicePaySchedule_ID"));var b=0,g=0,l=null;try{l=n.dataContext.getJSONRecord("MInvoice/GetInvPaySchedDetail",h);l!=null&&(c=t.getValueOfInt(l.C_InvoicePaySchedule_ID),b=t.getValueOfDecimal(l.dueAmount),IsReturnTrx=l.IsReturnTrx,"Y"==IsReturnTrx&&(b=b*-1),u.setValue("C_InvoicePaySchedule_ID",c),u.setValue("Amount",b),g=1)}catch(d){return this.setCalloutActive(!1),this.log.log(f.SEVERE,"PaymentAllocate.Invoice -"+h,d.message),d.toString()}k=t.getValueOfDate(i.getContextAsTime(r,"DateTrx"));k==null&&(k=new Date);p=h.toString()+","+c.toString()+","+k.toString();a=null;try{a=n.dataContext.getJSONRecord("MPayment/GetInvoiceData",p);a!=null&&(v=t.getValueOfDecimal(a.invoiceOpen),v==null&&(v=n.Env.ZERO),y=t.getValueOfDecimal(a.invoiceDiscount),y==null&&(y=n.Env.ZERO),u.setValue("InvoiceAmt",v),g==0&&u.setValue("Amount",v-y),u.setValue("DiscountAmt",y),i.setContext(r,"C_Invoice_ID",h.toString()))}catch(d){return this.setCalloutActive(!1),d.message}return this.setCalloutActive(!1),i=r=u=e=o=s=null,""};r.prototype.Amounts=function(i,r,u,f,e,o){var d,g,b,k,p,w,it,y;if(this.isCalloutActive()||(d=i.getContextAsInt(r,"C_Invoice_ID"),d==0))return"";this.setCalloutActive(!0);g=0;u.getValue("C_InvoicePaySchedule_ID")!=null&&(g=u.getValue("C_InvoicePaySchedule_ID"));var a=n.Env.ZERO,v="N",tt=0,nt=!0,h=t.getValueOfDecimal(u.getValue("Amount")),c=t.getValueOfDecimal(u.getValue("DiscountAmt")),l=t.getValueOfDecimal(u.getValue("WriteOffAmt")),s=t.getValueOfDecimal(u.getValue("OverUnderAmt")),rt=t.getValueOfDecimal(u.getValue("InvoiceAmt"));return this.log.fine("Amt="+h+", Discount="+c+", WriteOff="+l+", OverUnder="+s+", Invoice="+rt),b=i.getContext(r,"DateTrx"),b==null&&(b=new Date),k=d.toString()+","+g.toString()+","+b.toString(),p=n.dataContext.getJSONRecord("MPayment/GetInvoiceData",k),p!=null&&(tt=t.getValueOfInt(p.C_Currency_ID),a=t.getValueOfDecimal(p.invoiceOpen),a==null&&(a=n.Env.ZERO),n.Env.ZERO==c&&(c=t.getValueOfDecimal(p.invoiceDiscount)),v=p.IsReturnTrx),v=="Y"?(h>0&&(h=h*-1,u.setValue("Amount",h)),c>0&&(c=c*-1),l>0&&(l=l*-1,u.setValue("WriteOffAmt",l)),s>0&&(s=s*-1,u.setValue("OverUnderAmt",s)),a>0&&(a=a*-1)):(h<0&&(h=h*-1,u.setValue("Amount",h)),c<0&&(c=c*-1),l<0&&(l=l*-1,u.setValue("WriteOffAmt",l)),s<0&&(s=s*-1,u.setValue("OverUnderAmt",s)),a<0&&(a=a*-1)),w=f.getColumnName(),k=tt.toString(),it=n.dataContext.getJSONRecord("MCurrency/GetCurrency",k),y=it.StdPrecision,w=="Amount"?(s=a-h-c-l,(v=="N"&&s>0||v=="Y"&&s<0)&&n.ADialog.info("LessScheduleAmount"),(v=="Y"&&s>0||v=="N"&&s<0)&&(n.ADialog.info("MoreScheduleAmount"),h=a-c-l,s=a-h-c-l,nt?u.setValue("Amount",h.toFixed(y)):u.setValue("Amount",h)),nt?(u.setValue("DiscountAmt",c.toFixed(y)),u.setValue("OverUnderAmt",s.toFixed(y))):(u.setValue("DiscountAmt",c),u.setValue("OverUnderAmt",s))):(h=a-c-l-s,(v=="Y"&&h>0||v=="N"&&h<0)&&(n.ADialog.info("MoreScheduleAmount"),w=="OverUnderAmt"&&(h=a-c-l,s=a-h-c-l),w=="DiscountAmt"&&(h=a-s-l,c=a-h-s-l),w=="WriteOffAmt"&&(h=a-c-s,l=a-h-c-s)),nt?(u.setValue("Amount",h.toFixed(y)),u.setValue("DiscountAmt",c.toFixed(y)),u.setValue("WriteOffAmt",l.toFixed(y)),u.setValue("OverUnderAmt",s.toFixed(y))):(u.setValue("Amount",h),u.setValue("DiscountAmt",c),u.setValue("WriteOffAmt",l),u.setValue("OverUnderAmt",s)),(v=="N"&&s>0||v=="Y"&&s<0)&&n.ADialog.info("LessScheduleAmount")),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutPaymentAllocate=r;n.Utility.inheritPrototype(u,n.CalloutEngine);u.prototype.SetPaymentType=function(n,t,i,r,u){if(this.isCalloutActive()||u==null||u.toString()=="")return"";try{if(this.setCalloutActive(!0),r.getColumnName()=="PaymentRule")if(i.getValue("PaymentRule")==null)i.setValue("PaymentMethod",null);else{var f=i.getValue("PaymentRule");i.setValue("PaymentMethod",f)}}catch(e){return this.setCalloutActive(!1),e}return this.setCalloutActive(!1),""};n.Model.CalloutPaymentTypeSO=u}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutProject")}function r(){n.CalloutEngine.call(this,"VIS.CalloutProjectLine")}var u=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.Planned=function(i,r,u,f,e,o){var d,g,p,a,v;if(e==null||e.toString()==""||this.isCalloutActive()||e==null)return"";this.setCalloutActive(!0);var y,s,c,h,w=0,l=i.getStdPrecision(),b=t.getValueOfInt(u.getValue("C_ProjectTask_ID")),nt="SELECT C_Project_ID FROM C_ProjectPhase WHERE C_ProjectPhase_id IN (select C_ProjectPhase_id from C_ProjectTask WHERE C_ProjectTask_ID="+b+")",k=t.getValueOfInt(n.DB.executeScalar(nt,null,null));return b==0&&(k=t.getValueOfInt(u.getValue("C_Project_ID"))),d="SELECT PriceLimit FROM M_ProductPrice WHERE M_PriceList_Version_ID = (SELECT c.m_pricelist_version_id FROM  c_project c WHERE c.c_project_Id="+k+")  AND M_Product_id="+t.getValueOfInt(u.getValue("M_Product_ID")),g=t.getValueOfDecimal(n.DB.executeScalar(d,null,null)),y=t.getValueOfDecimal(u.getValue("PlannedQty")),y==null?y=Envs.ONE:w=(t.getValueOfDecimal(u.getValue("PlannedPrice"))-g)*t.getValueOfDecimal(u.getValue("PlannedQty")),s=t.getValueOfDecimal(u.getValue("PlannedPrice")),s==null&&(s=n.Env.ZERO),c=u.getValue("PriceList"),c==null&&(c=s),h=u.getValue("Discount"),h==null&&(h=n.Env.ZERO),p=f.getColumnName(),p=="PlannedPrice"?(c==0?h=n.Env.ZERO:(a=(s*n.Env.ONEHUNDRED/c).toFixed(l),h=n.Env.ONEHUNDRED-a),u.setValue("Discount",h),this.log.fine("PriceList="+c+" - Discount="+h+" -> [PlannedPrice="+s+"] (Precision="+l+")")):p=="PriceList"?(n.Env.signum(c)==0?h=n.Env.ZERO:(a=(s*n.Env.ONEHUNDRED/c).toFixed(l),h=n.Env.ONEHUNDRED-a),u.setValue("Discount",h),this.log.fine("[PriceList="+c+"] - Discount="+h+" -> PlannedPrice="+s+" (Precision="+l+")")):p=="Discount"&&(a=(h/n.Env.ONEHUNDRED).toFixed(10),a=n.Env.ONE-a,s=c*a,t.scale(s)>l&&(s=s.toFixed(l)),u.setValue("PlannedPrice",s),this.log.fine("PriceList="+c+" - [Discount="+h+"] -> PlannedPrice="+s+" (Precision="+l+")")),v=y*s,t.scale(v)>l&&(v=v.toFixed(l)),this.log.fine("PlannedQty="+y+" * PlannedPrice="+s+" -> PlannedAmt="+v+" (Precision="+l+")"),u.setValue("PlannedAmt",v),u.setValue("PlannedMarginAmt",w),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.Product=function(i,r,u,f,e,o){var c,l,a,h,p;if(e==null||e.toString()==""||(c=t.getValueOfInt(e),l=i.getContextAsInt(r,"M_PriceList_Version_ID"),c==null||t.getValueOfInt(c)==0||l==0))return"";this.setCalloutActive(!0);var v=i.getContextAsInt(r,"C_BPartner_ID"),y=t.getValueOfDecimal(u.getValue("PlannedQty")),s=t.getValueOfDateTime(u.getValue("PlannedDate"));return s==null?(s=t.getValueOfDateTime(u.getValue("DateContract")),s==null&&(s=t.getValueOfDateTime(u.getValue("DateFinish")),s==null&&(s=new Date)),a=c.toString().concat(",",v.toString(),",",y.toString(),",",isSOTrx,",",M_PriceList_ID.toString(),",",l.toString(),",",s.toString(),",",null),h=null,h=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",a),p=null,u.setValue("PriceList",h.PriceList),u.setValue("PlannedPrice",h.PriceActual),u.setValue("Discount",h.Discount),u.setValue("PlannedAmt",h.LineAmt),""):(i=r=u=f=e=o=null,"")};n.Model.CalloutProject=i;n.Utility.inheritPrototype(r,n.CalloutEngine);r.prototype.Charge=function(t,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=r.getValue("C_Charge_ID").toString(),s=n.dataContext.getJSONRecord("MCharge/GetCharge",o);return r.setValue("PlannedQty",1),r.setValue("PlannedPrice",s),t=i=r=u=f=e=null,""};n.Model.CalloutProjectLine=r}(VIS,jQuery),function(n){function t(){n.CalloutEngine.call(this,"VIS.CalloutBankStatement")}var i=n.Logging.Level,r=n.Utility.Util;n.Utility.inheritPrototype(t,n.CalloutEngine);t.prototype.BankAccount=function(t,r,u,f,e,o){if(e==null||e.toString()=="")return"";try{var l=e,h=e.toString(),s;s=n.dataContext.getJSONRecord("MBankStatement/GetCurrentBalance",h);u.setValue("BeginningBalance",s)}catch(c){this.setCalloutActive(!1);this.log.log(i.SEVERE,"",c)}return t=r=u=f=e=o=null,""};t.prototype.Amount=function(n,t,i,r,u,f){var s,h,o,e,c;return u==null||u.toString()==""?"":this.isCalloutActive()?"":(this.setCalloutActive(!0),s=i.getValue("StmtAmt"),s==null&&(s=0),h=i.getValue("TrxAmt"),h==null&&(h=0),e=i.getValue("ChargeAmt"),e==null&&(e=0),o=s-h,r.getColumnName()=="ChargeAmt"?(e=u,e==null&&(e=0),o=o-e,i.setValue("InterestAmt",o)):(c=i.getValue("InterestAmt"),c==null&&(c=0),o=o-c,i.setValue("ChargeAmt",o)),this.setCalloutActive(!1),n=t=i=r=u=f=null,"")};t.prototype.Payment=function(t,r,u,f,e,o){var s,h,l,a,v,c;if(e==null||e.toString()==""||(s=e,s==null||s==0))return u.setValue("StmtAmt",0),u.setValue("TrxAmt",0),u.setValue("ChargeAmt",0),u.setValue("ChargeAmt",0),u.setValue("C_BPartner_ID",0),u.setValue("C_Invoice_ID",0),"";h=u.getValue("StmtAmt");h==null&&(h=0);l=u.getValue("C_Currency_ID");a=u.getValue("ValutaDate");try{v=s.toString()+","+l.toString()+","+a.toString();c=n.dataContext.getJSONRecord("MBankStatement/GetPayment",v);u.setValue("TrxAmt",c);h==0&&u.setValue("StmtAmt",c)}catch(y){return this.setCalloutActive(!1),dr!=null&&dr.close(),this.log.log(i.SEVERE,"BankStmt_Payment",y),y.toString()}return this.Amount(t,r,u,f,e),t=r=u=f=e=o=null,""};t.prototype.SetConvertedAmt=function(t,u,f,e,o,s){var h,c,l,a,v;if(o==null||o.toString()==""||this.isCalloutActive()||(h=r.getValueOfInt(f.getValue("C_Payment_ID")),h==0))return"";c=f.getValue("C_Currency_ID");l=f.getValue("DateAcct");try{a=h.toString()+","+c.toString()+","+l.toString();v=n.dataContext.getJSONRecord("MBankStatement/GetConvertedAmt",a);f.setValue("StmtAmt",v)}catch(y){return this.setCalloutActive(!1),dr!=null&&dr.close(),this.log.log(i.SEVERE,"BankStmt_DateAcct",y),y.toString()}return this.Amount(t,u,f,e,o),t=u=f=e=o=s=null,""};n.Model.CalloutBankStatement=t}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutOfferSerIncluded")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.CalculatePrice=function(n,t,i){return Decimal.Subtract(Decimal.Multiply(n,t),i)};i.prototype.CalculateRebate=function(n,t,i){return Decimal.Multiply(Decimal.Multiply(n,t),Decimal.Multiply(new Decimal(.01),i))};i.prototype.OfferServices=function(i,r,u,f,e,o){var it,ht,kt,st;if(e==null||e.toString()==""||(it=24,ht=t.getValueOfInt(e),ht==null||ht==0))return"";var ct=0,lt=new Decimal(0),at=new Decimal(0),vt=new Decimal(0),s,l,a,v,h,k,d,pt,wt,ut=null;try{for(st=[],st[0]=new n.DB.SqlParam("@FO_SERVICE_ID",ht),ut=n.DB.executeReader("select uom.FO_HOTEL_UOM_ID,s.DESCRIPTION from FO_HOTEL_UOM uom inner join FO_SERVICE s ON(uom.FO_HOTEL_UOM_ID= s.FO_HOTEL_UOM_ID) where s.FO_SERVICE_ID=@FO_SERVICE_ID ",st,null);ut.read();)ct=t.getValueOfInt(ut[0]),u.setValue("AUOM_ID",ct),u.setValue("CG1UOM_ID",ct),u.setValue("CG2UOM_ID",ct),u.setValue("DESCRIPTION",t.getValueOfString(ut[1]));ut.close()}catch(bt){this.setCalloutActive(!1);ut!=null&&ut.close();this.log.severe(bt.toString())}kt="select PRICE,CHILDGROUP1,CHILDGROUP2,UOM1,UOM2 from FO_SERVICE_PRICE_PRICELINE where CREATED=(select max(CREATED) from FO_SERVICE_PRICE_PRICELINE where FO_SERVICE_ID=@FO_SERVICE_ID)";try{for(st=[],st[0]=new n.DB.SqlParam("@FO_SERVICE_ID",ht),ut=n.DB.executeReader(kt,st,null);ut.read();)lt=t.getValueOfDecimal(ut[0]),at=t.getValueOfDecimal(ut[1]),vt=t.getValueOfDecimal(ut[2]),pt=ut[3].toString(),wt=ut[4].toString(),pt.equals("Y")&&(at=Decimal.Multiply(Decimal.Multiply(lt,at),new Decimal(.01))),wt.equals("Y")&&(vt=Decimal.Multiply(Decimal.Multiply(lt,vt),new Decimal(.01))),u.setValue("APRICE",lt),u.setValue("CG1PRICE",at),u.setValue("CG2PRICE",vt);ut.close()}catch(bt){this.setCalloutActive(!1);this.log.severe(bt.toString())}var dt=u.getValue("AUOM_ID").toString(),g=t.getValueOfInt(u.getValue("ANUM")),p=t.getValueOfDecimal(u.getValue("AP0RICE")),b=t.getValueOfDecimal(u.getValue("AREBATE")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1P0RICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),gt=t.getValueOfDateTime(u.getValue("ADATETO")),ni=t.getValueOfDateTime(u.getValue("ADATEFROM")),c=Utility.timeUtil.getDaysBetween(ni,gt),yt=ni.Subtract(gt),ft,rt,ti=c/30,ri=c%30,ii=c/7,ui=c%7;ft=ri==0?ti:ti+1;rt=ui==0?ii:ii+1;var fi=yt.TotalMilliseconds,et=yt.TotalSeconds,ot=yt.TotalMinutes;if(t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(dt)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(rt),p,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(it*c),p,h);l=CalculatePrice(new Decimal(it*c),y,h);a=CalculatePrice(new Decimal(it*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(ot),p,h);l=CalculatePrice(new Decimal(ot),y,h);a=CalculatePrice(new Decimal(ot),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(et),p,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}}else switch(int.Parse(dt)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(rt),p,b);s=CalculatePrice(new Decimal(rt),p,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),w,b);a=CalculatePrice(new Decimal(rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(it*c),p,b);s=CalculatePrice(new Decimal(it*c),p,h);k=CalculateRebate(new Decimal(it*c),y,b);l=CalculatePrice(new Decimal(it*c),y,k);d=CalculateRebate(new Decimal(it*c),w,b);a=CalculatePrice(new Decimal(it*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(ot),p,b);s=CalculatePrice(new Decimal(ot),p,h);k=CalculateRebate(new Decimal(ot),y,b);l=CalculatePrice(new Decimal(ot),y,k);d=CalculateRebate(new Decimal(ot),w,b);a=CalculatePrice(new Decimal(ot),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(et),p,b);s=CalculatePrice(new Decimal(et),p,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),w,b);a=CalculatePrice(new Decimal(et),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};i.prototype.tochkdate=function(i,r,u,f,e,o){var it,s,l,a,h,k,d,v,ct,vt,yt,at,st;if(e==null||e.toString()==""||(it=24,ct=t.getValueOfDateTime(e),ct==null||ct.equals(0)))return"";var ot=t.getValueOfDateTime(e),ht=t.getValueOfDateTime(u.getValue("ADATEFROM")),g=t.getValueOfInt(u.getValue("CG1NUM")),nt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),p=t.getValueOfDecimal(u.getValue("CG2PRICE"));try{if(ot=t.getValueOfDateTime(u.getValue("ADATETO")),vt=Utility.timeUtil.getDaysBetween(ht,ot),vt<=0)yt=Utility.TimeUtil.AddDays(ht,1),u.setValue("ADATETO",yt);else if(ot.compareTo(ht)>0){var lt=ot.Subtract(ht),c=Utility.timeUtil.getDaysBetween(ht,ot),gt=lt.TotalMilliseconds,ft=lt.TotalMinutes,et=lt.TotalMinutes,ut,rt,pt=c/30,bt=c%30,wt=c/7,kt=c%7;ut=bt==0?pt:pt+1;rt=kt==0?wt:wt+1;at=t.getValueOfDateTime(u.getValue("ADATEFROM"));u.setValue("CG1DATETO",ot);u.setValue("CG2DATETO",ot);u.setValue("CG1DATEFROM",at);u.setValue("CG2DATEFROM",at);st=u.getValue("AUOM_ID").toString();(st==""||st.toString().trim().length==0)&&(st="0");var w=t.getValueOfDecimal(u.getValue("APRICE")),tt=t.getValueOfInt(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE"));if(t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(st)){case 1000003:s=w;l=y;a=p;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),w,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ut),w,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(rt),w,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),w,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(it*c),w,h);l=CalculatePrice(new Decimal(it*c),y,h);a=CalculatePrice(new Decimal(it*c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),w,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),w,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(tt*rt),w,h);l=CalculatePrice(new Decimal(g*rt),y,h);a=CalculatePrice(new Decimal(nt*rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(tt*rt),w,h);l=CalculatePrice(new Decimal(g*rt),y,h);a=CalculatePrice(new Decimal(nt*rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(tt*(c+1)),w,h);l=CalculatePrice(new Decimal(g*(c+1)),y,h);a=CalculatePrice(new Decimal(nt*(c+1)),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*tt),w,h);l=CalculatePrice(new Decimal((c+1)*g),y,h);a=CalculatePrice(new Decimal((c+1)*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(it*c*tt),w,h);l=CalculatePrice(new Decimal(it*c*g),y,h);a=CalculatePrice(new Decimal(it*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(it*c*tt),w,h);l=CalculatePrice(new Decimal(it*c*g),y,h);a=CalculatePrice(new Decimal(it*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}}else switch(int.Parse(st)){case 1000003:s=w;l=y;a=p;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),w,b);s=CalculatePrice(new Decimal(c),w,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),p,b);a=CalculatePrice(new Decimal(c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ut),w,b);s=CalculatePrice(new Decimal(ut),w,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),p,b);a=CalculatePrice(new Decimal(ut),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(rt),w,b);s=CalculatePrice(new Decimal(rt),w,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),p,b);a=CalculatePrice(new Decimal(rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),w,b);s=CalculatePrice(new Decimal(c+1),w,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),p,b);a=CalculatePrice(new Decimal(c+1),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(it*c),w,b);s=CalculatePrice(new Decimal(it*c),w,h);k=CalculateRebate(new Decimal(it*c),y,b);l=CalculatePrice(new Decimal(it*c),y,k);d=CalculateRebate(new Decimal(it*c),p,b);a=CalculatePrice(new Decimal(it*c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),w,b);s=CalculatePrice(new Decimal(et),w,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),p,b);a=CalculatePrice(new Decimal(et),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),w,b);s=CalculatePrice(new Decimal(ft),w,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),p,b);a=CalculatePrice(new Decimal(ft),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(tt*rt),w,b);s=CalculatePrice(new Decimal(tt*rt),w,h);k=CalculateRebate(new Decimal(g*rt),y,b);l=CalculatePrice(new Decimal(g*rt),y,k);d=CalculateRebate(new Decimal(nt*rt),p,b);a=CalculatePrice(new Decimal(nt*rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(tt*rt),w,b);s=CalculatePrice(new Decimal(tt*rt),w,h);k=CalculateRebate(new Decimal(g*rt),y,b);l=CalculatePrice(new Decimal(g*rt),y,k);d=CalculateRebate(new Decimal(nt*rt),p,b);a=CalculatePrice(new Decimal(nt*rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal(tt*(c+1)),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal((c+1)*tt),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(it*c*tt),w,b);s=CalculatePrice(new Decimal(it*c*tt),w,h);k=CalculateRebate(new Decimal(it*c*g),y,b);l=CalculatePrice(new Decimal(it*c*g),y,k);d=CalculateRebate(new Decimal(it*c*nt),p,b);a=CalculatePrice(new Decimal(it*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(it*c*tt),w,b);s=CalculatePrice(new Decimal(it*c*tt),w,h);k=CalculateRebate(new Decimal(it*c*g),y,b);l=CalculatePrice(new Decimal(it*c*g),y,k);d=CalculateRebate(new Decimal(it*c*nt),p,b);a=CalculatePrice(new Decimal(it*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}tt==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0));g==0&&u.setValue("CG1TOTAL_AMOUNT",0);nt==0&&u.setValue("CG2TOTAL_AMOUNT",0)}}catch(dt){this.setCalloutActive(!1);this.log.severe(dt.toString())}return i=r=u=f=e=o=null,""};i.prototype.fromchkdate=function(i,r,u,f,e,o){var it,s,l,a,h,k,d,v,ct,vt,at,ht;if(e==null||e.toString()==""||(it=24,ct=t.getValueOfDateTime(e),ct==null||ct.equals(0)))return"";var ot=t.getValueOfDateTime(u.getValue("ADATEFROM")),st=t.getValueOfDateTime(u.getValue("ADATETO")),g=t.getValueOfInt(u.getValue("CG1NUM")),nt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),p=t.getValueOfDecimal(u.getValue("CG2PRICE"));try{if(ot=t.getValueOfDateTime(u.getValue("ADATEFROM")),ot.compareTo(st)>0)u.setValue("CG1DATEFROM",ot),u.setValue("CG2DATEFROM",ot),vt=Utility.timeUtil.addDays(ot,1),u.setValue("ADATETO",vt);else if(st.compareTo(ot)>0){var lt=st.Subtract(ot),c=Utility.timeUtil.getDaysBetween(ot,st),dt=lt.TotalMilliseconds,ft=lt.TotalSeconds,et=lt.TotalMinutes,ut,rt,yt=c/30,wt=c%30,pt=c/7,bt=c%7;ut=wt==0?yt:yt+1;rt=bt==0?pt:pt+1;at=t.getValueOfDateTime(u.getValue("ADATEFROM"));u.setValue("CG1DATETO",st);u.setValue("CG2DATETO",st);u.setValue("CG1DATEFROM",at);u.setValue("CG2DATEFROM",at);ht=u.getValue("AUOM_ID").toString();(ht==""||ht.toString().trim().length==0)&&(ht="0");var w=t.getValueOfDecimal(u.getValue("APRICE")),tt=t.getValueOfInt(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE"));if(t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(ht)){case 1000003:s=w;l=y;a=p;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),w,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ut),w,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(rt),w,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),w,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(it*c),w,h);l=CalculatePrice(new Decimal(it*c),y,h);a=CalculatePrice(new Decimal(it*c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),w,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),w,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(tt*rt),w,h);l=CalculatePrice(new Decimal(g*rt),y,h);a=CalculatePrice(new Decimal(nt*rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(tt*rt),w,h);l=CalculatePrice(new Decimal(g*rt),y,h);a=CalculatePrice(new Decimal(nt*rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(tt*(c+1)),w,h);l=CalculatePrice(new Decimal(g*(c+1)),y,h);a=CalculatePrice(new Decimal(nt*(c+1)),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*tt),w,h);l=CalculatePrice(new Decimal((c+1)*g),y,h);a=CalculatePrice(new Decimal((c+1)*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(it*c*tt),w,h);l=CalculatePrice(new Decimal(it*c*g),y,h);a=CalculatePrice(new Decimal(it*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(it*c*tt),w,h);l=CalculatePrice(new Decimal(it*c*g),y,h);a=CalculatePrice(new Decimal(it*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}}else switch(int.Parse(ht)){case 1000003:s=w;l=y;a=p;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),w,b);s=CalculatePrice(new Decimal(c),w,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),p,b);a=CalculatePrice(new Decimal(c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ut),w,b);s=CalculatePrice(new Decimal(ut),w,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),p,b);a=CalculatePrice(new Decimal(ut),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(rt),w,b);s=CalculatePrice(new Decimal(rt),w,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),p,b);a=CalculatePrice(new Decimal(rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),w,b);s=CalculatePrice(new Decimal(c+1),w,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),p,b);a=CalculatePrice(new Decimal(c+1),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(it*c),w,b);s=CalculatePrice(new Decimal(it*c),w,h);k=CalculateRebate(new Decimal(it*c),y,b);l=CalculatePrice(new Decimal(it*c),y,k);d=CalculateRebate(new Decimal(it*c),p,b);a=CalculatePrice(new Decimal(it*c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),w,b);s=CalculatePrice(new Decimal(et),w,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),p,b);a=CalculatePrice(new Decimal(et),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),w,b);s=CalculatePrice(new Decimal(ft),w,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),p,b);a=CalculatePrice(new Decimal(ft),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(tt*rt),w,b);s=CalculatePrice(new Decimal(tt*rt),w,h);k=CalculateRebate(new Decimal(g*rt),y,b);l=CalculatePrice(new Decimal(g*rt),y,k);d=CalculateRebate(new Decimal(nt*rt),p,b);a=CalculatePrice(new Decimal(nt*rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(tt*rt),w,b);s=CalculatePrice(new Decimal(tt*rt),w,h);k=CalculateRebate(new Decimal(g*rt),y,b);l=CalculatePrice(new Decimal(g*rt),y,k);d=CalculateRebate(new Decimal(nt*rt),p,b);a=CalculatePrice(new Decimal(nt*rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal(tt*(c+1)),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal((c+1)*tt),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(it*c*tt),w,b);s=CalculatePrice(new Decimal(it*c*tt),w,h);k=CalculateRebate(new Decimal(it*c*g),y,b);l=CalculatePrice(new Decimal(it*c*g),y,k);d=CalculateRebate(new Decimal(it*c*nt),p,b);a=CalculatePrice(new Decimal(it*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(it*c*tt),w,b);s=CalculatePrice(new Decimal(it*c*tt),w,h);k=CalculateRebate(new Decimal(it*c*g),y,b);l=CalculatePrice(new Decimal(it*c*g),y,k);d=CalculateRebate(new Decimal(it*c*nt),p,b);a=CalculatePrice(new Decimal(it*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}tt==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0));g==0&&u.setValue("CG1TOTAL_AMOUNT",0);nt==0&&u.setValue("CG2TOTAL_AMOUNT",0)}}catch(kt){this.setCalloutActive(!1);this.log.severe(kt.toString())}return i=r=u=f=e=o=null,""};i.prototype.UOMSelected=function(i,r,u,f,e,o){var it,s,l,a,h,k,d,v,ot;if(e==null||e.toString()==""||(it=24,ot=t.getValueOfInt(e),ot=t.getValueOfInt(u.getValue("AUOM_ID")),ot==null))return"";u.setValue("CG1UOM_ID",ot);u.setValue("CG2UOM_ID",ot);var ht=u.getValue("AUOM_ID").toString(),p=t.getValueOfDecimal(u.getValue("APRICE")),g=t.getValueOfInt(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),ct=t.getValueOfDateTime(u.getValue("ADATETO")),lt=t.getValueOfDateTime(u.getValue("ADATEFROM")),st=ct.Subtract(lt),c=Utility.timeUtil.getDaysBetween(lt,ct),wt=st.TotalMilliseconds,ft=st.TotalSeconds,et=st.TotalMinutes,ut,rt,at=c/30,yt=c%30,vt=c/7,pt=c%7;if(ut=yt==0?at:at+1,rt=pt==0?vt:vt+1,t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(ht)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ut),p,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(rt),p,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(it*c),p,h);l=CalculatePrice(new Decimal(it*c),y,h);a=CalculatePrice(new Decimal(it*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),p,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}}else switch(int.Parse(ht)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ut),p,b);s=CalculatePrice(new Decimal(ut),p,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),w,b);a=CalculatePrice(new Decimal(ut),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(rt),p,b);s=CalculatePrice(new Decimal(rt),p,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),w,b);a=CalculatePrice(new Decimal(rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(it*c),p,b);s=CalculatePrice(new Decimal(it*c),p,h);k=CalculateRebate(new Decimal(it*c),y,b);l=CalculatePrice(new Decimal(it*c),y,k);d=CalculateRebate(new Decimal(it*c),w,b);a=CalculatePrice(new Decimal(it*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),p,b);s=CalculatePrice(new Decimal(et),p,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),w,b);a=CalculatePrice(new Decimal(et),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};i.prototype.AVALSelected=function(i,r,u,f,e,o){var it,s,l,a,h,k,d,v,ot;if(e==null||e.toString()=="")return"";it=24;ot=null;try{ot=u.getValue("AUOM_ID").toString()}catch(pt){return this.setCalloutActive(!1),""}var p=t.getValueOfDecimal(u.getValue("APRICE")),b=t.getValueOfDecimal(u.getValue("AREBATE")),g=t.getValueOfInt(u.getValue("ANUM")),ht=t.getValueOfDateTime(u.getValue("ADATETO")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),ct=t.getValueOfDateTime(u.getValue("ADATEFROM")),st=ht.Subtract(ct),c=Utility.timeUtil.getDaysBetween(ct,ht),wt=st.TotalMilliseconds,ft=st.TotalSeconds,et=st.TotalMinutes,ut,rt,lt=c/30,vt=c%30,at=c/7,yt=c%7;if(ut=vt==0?lt:lt+1,rt=yt==0?at:at+1,t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(ot)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ut),p,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(rt),p,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(it*c),p,h);l=CalculatePrice(new Decimal(it*c),y,h);a=CalculatePrice(new Decimal(it*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),p,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*rt),p,h);l=CalculatePrice(new Decimal(nt*rt),y,h);a=CalculatePrice(new Decimal(tt*rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(it*c*g),p,h);l=CalculatePrice(new Decimal(it*c*nt),y,h);a=CalculatePrice(new Decimal(it*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}}else switch(int.Parse(ot)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ut),p,b);s=CalculatePrice(new Decimal(ut),p,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),w,b);a=CalculatePrice(new Decimal(ut),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(rt),p,b);s=CalculatePrice(new Decimal(rt),p,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),w,b);a=CalculatePrice(new Decimal(rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(it*c),p,b);s=CalculatePrice(new Decimal(it*c),p,h);k=CalculateRebate(new Decimal(it*c),y,b);l=CalculatePrice(new Decimal(it*c),y,k);d=CalculateRebate(new Decimal(it*c),w,b);a=CalculatePrice(new Decimal(it*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),p,b);s=CalculatePrice(new Decimal(et),p,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),w,b);a=CalculatePrice(new Decimal(et),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*rt),p,b);s=CalculatePrice(new Decimal(g*rt),p,h);k=CalculateRebate(new Decimal(nt*rt),y,b);l=CalculatePrice(new Decimal(nt*rt),y,k);d=CalculateRebate(new Decimal(tt*rt),w,b);a=CalculatePrice(new Decimal(tt*rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(it*c*g),p,b);s=CalculatePrice(new Decimal(it*c*g),p,h);k=CalculateRebate(new Decimal(it*c*nt),y,b);l=CalculatePrice(new Decimal(it*c*nt),y,k);d=CalculateRebate(new Decimal(it*c*tt),w,b);a=CalculatePrice(new Decimal(it*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v)}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};n.Model.CalloutOfferSerIncluded=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutOfferServices")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.CalculatePrice=function(n,t,i){return Decimal.Subtract(Decimal.Multiply(n,t),i)};i.prototype.CalculateRebate=function(n,t,i){return Decimal.Multiply(Decimal.Multiply(n,t),Decimal.Multiply(new Decimal(.01),i))};i.prototype.OfferServices=function(i,r,u,f,e,o){var st,wt,ot,ft,et;if(e==null||e.toString()==""||(st=t.getValueOfInt(e),st==null||st==0))return"";var ht=0,ct=new Decimal(0),lt=new Decimal(0),at=new Decimal(0),s,l,a,v,h,k,d,vt,yt,rt=null;try{for(ot=[],ot[0]=new n.DB.SqlParam("@FO_SERVICE_ID",st),rt=n.DB.executeReader("select uom.FO_HOTEL_UOM_ID,s.DESCRIPTION from FO_HOTEL_UOM uom inner join FO_SERVICE s ON(uom.FO_HOTEL_UOM_ID= s.FO_HOTEL_UOM_ID) where s.FO_SERVICE_ID=@FO_SERVICE_ID ",ot,null);rt.read();)ht=t.getValueOfInt(rt[0]),u.setValue("AUOM_ID",ht),u.setValue("CG1UOM_ID",ht),u.setValue("CG2UOM_ID",ht),u.setValue("DESCRIPTION",t.getValueOfString(rt[1]));rt.close()}catch(pt){this.setCalloutActive(!1);rt!=null&&rt.close();this.log.severe(pt.toString())}finally{rt!=null&&rt.close()}wt="select PRICE,CHILDGROUP1,CHILDGROUP2,UOM1,UOM2 from FO_SERVICE_PRICE_PRICELINE where CREATED=(select max(CREATED) from FO_SERVICE_PRICE_PRICELINE where FO_SERVICE_ID=@FO_SERVICE_ID)";try{for(ot=[],ot[0]=new SqlParameter("@FO_SERVICE_ID",st),rt=n.DB.executeReader(wt,ot,null);rt.read();)ct=t.getValueOfDecimal(rt[0]),lt=t.getValueOfDecimal(rt[1]),at=t.getValueOfDecimal(rt[2]),vt=rt[3].toString(),yt=rt[4].toString(),vt=="Y"&&(lt=Decimal.Multiply(Decimal.Multiply(ct,lt),new Decimal(.01))),yt=="Y"&&(at=Decimal.Multiply(Decimal.Multiply(ct,at),new Decimal(.01))),u.setValue("APRICE",ct),u.setValue("CG1PRICE",lt),u.setValue("CG2PRICE",at)}catch(pt){this.setCalloutActive(!1);this.log.severe(pt.toString())}finally{rt!=null&&rt.close()}var bt=u.getValue("AUOM_ID").toString(),g=t.getValueOfInt(u.getValue("ANUM")),p=t.getValueOfDecimal(u.getValue("APRICE")),b=t.getValueOfDecimal(u.getValue("AREBATE")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),kt=t.getValueOfDateTime(u.getValue("ADATETO")),dt=t.getValueOfDateTime(u.getValue("ADATEFROM")),c=Utility.timeUtil.getDaysBetween(dt,kt),gt=dt.Subtract(kt),ut,it,ni=c/30,ii=c%30,ti=c/7,ri=c%7;if(ut=ii==0?ni:ni+1,it=ri==0?ti:ti+1,ft=gt.Seconds,et=gt.Minutes,t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(bt)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(ut),p,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(it),p,h);l=CalculatePrice(new Decimal(it),y,h);a=CalculatePrice(new Decimal(it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(24*c),p,h);l=CalculatePrice(new Decimal(24*c),y,h);a=CalculatePrice(new Decimal(24*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),p,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}}else switch(int.Parse(bt)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(ut),p,b);s=CalculatePrice(new Decimal(ut),p,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),w,b);a=CalculatePrice(new Decimal(ut),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(it),p,b);s=CalculatePrice(new Decimal(it),p,h);k=CalculateRebate(new Decimal(it),y,b);l=CalculatePrice(new Decimal(it),y,k);d=CalculateRebate(new Decimal(it),w,b);a=CalculatePrice(new Decimal(it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(24*c),p,b);s=CalculatePrice(new Decimal(24*c),p,h);k=CalculateRebate(new Decimal(24*c),y,b);l=CalculatePrice(new Decimal(24*c),y,k);d=CalculateRebate(new Decimal(24*c),w,b);a=CalculatePrice(new Decimal(24*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),p,b);s=CalculatePrice(new Decimal(et),p,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),w,b);a=CalculatePrice(new Decimal(et),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};i.prototype.tochkdate=function(i,r,u,f,e,o){var s,l,a,h,k,d,v,ht,ut,at,vt,lt,ot;if(e==null||e.toString()==""||(ht=t.getValueOfDateTime(e),ht==null||ht.equals(0)))return"";ut=t.getValueOfDateTime(e);ut=t.getValueOfDateTime(u.getValue("ADATETO"));var st=t.getValueOfDateTime(u.getValue("ADATEFROM")),g=t.getValueOfInt(u.getValue("CG1NUM")),nt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),p=t.getValueOfDecimal(u.getValue("CG2PRICE"));try{if(ut=t.getValueOfDateTime(u.getValue("ADATETO")),at=Utility.TimeUtil.getDaysBetween(st,ut),at<=0)vt=Utility.TimeUtil.AddDays(st,1),u.setValue("ADATETO",vt);else if(ut.compareTo(st)>0){var ct=ut.Subtract(st),c=Utility.TimeUtil.getDaysBetween(st,ut),dt=ct.Milliseconds,ft=ct.Seconds,et=ct.Minutes,rt,it,yt=c/30,wt=c%30,pt=c/7,bt=c%7;rt=wt==0?yt:yt+1;it=bt==0?pt:pt+1;lt=t.getValueOfDateTime(u.getValue("ADATEFROM"));u.setValue("CG1DATETO",ut);u.setValue("CG2DATETO",ut);u.setValue("CG1DATEFROM",lt);u.setValue("CG2DATEFROM",lt);ot=u.getValue("AUOM_ID").toString();(ot==""||ot.Trim().Length==0)&&(ot="0");var w=t.getValueOfDecimal(u.getValue("APRICE")),tt=System.Convert.ToInt16(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE"));if(t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(ot)){case 1000003:s=w;l=y;a=p;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),w,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(rt),w,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(it),w,h);l=CalculatePrice(new Decimal(it),y,h);a=CalculatePrice(new Decimal(it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),w,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(24*c),w,h);l=CalculatePrice(new Decimal(24*c),y,h);a=CalculatePrice(new Decimal(24*c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(et),w,h);l=CalculatePrice(new Decimal(et),y,h);a=CalculatePrice(new Decimal(et),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ft),w,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(tt*it),w,h);l=CalculatePrice(new Decimal(g*it),y,h);a=CalculatePrice(new Decimal(nt*it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(tt*it),w,h);l=CalculatePrice(new Decimal(g*it),y,h);a=CalculatePrice(new Decimal(nt*it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(tt*(c+1)),w,h);l=CalculatePrice(new Decimal(g*(c+1)),y,h);a=CalculatePrice(new Decimal(nt*(c+1)),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*tt),w,h);l=CalculatePrice(new Decimal((c+1)*g),y,h);a=CalculatePrice(new Decimal((c+1)*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(24*c*tt),w,h);l=CalculatePrice(new Decimal(24*c*g),y,h);a=CalculatePrice(new Decimal(24*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(24*c*tt),w,h);l=CalculatePrice(new Decimal(24*c*g),y,h);a=CalculatePrice(new Decimal(24*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}}else switch(int.Parse(ot)){case 1000003:s=w;l=y;a=p;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),w,b);s=CalculatePrice(new Decimal(c),w,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),p,b);a=CalculatePrice(new Decimal(c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(rt),w,b);s=CalculatePrice(new Decimal(rt),w,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),p,b);a=CalculatePrice(new Decimal(rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(it),w,b);s=CalculatePrice(new Decimal(it),w,h);k=CalculateRebate(new Decimal(it),y,b);l=CalculatePrice(new Decimal(it),y,k);d=CalculateRebate(new Decimal(it),p,b);a=CalculatePrice(new Decimal(it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),w,b);s=CalculatePrice(new Decimal(c+1),w,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),p,b);a=CalculatePrice(new Decimal(c+1),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(24*c),w,b);s=CalculatePrice(new Decimal(24*c),w,h);k=CalculateRebate(new Decimal(24*c),y,b);l=CalculatePrice(new Decimal(24*c),y,k);d=CalculateRebate(new Decimal(24*c),p,b);a=CalculatePrice(new Decimal(24*c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(et),w,b);s=CalculatePrice(new Decimal(et),w,h);k=CalculateRebate(new Decimal(et),y,b);l=CalculatePrice(new Decimal(et),y,k);d=CalculateRebate(new Decimal(et),p,b);a=CalculatePrice(new Decimal(et),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ft),w,b);s=CalculatePrice(new Decimal(ft),w,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),p,b);a=CalculatePrice(new Decimal(ft),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(tt*it),w,b);s=CalculatePrice(new Decimal(tt*it),w,h);k=CalculateRebate(new Decimal(g*it),y,b);l=CalculatePrice(new Decimal(g*it),y,k);d=CalculateRebate(new Decimal(nt*it),p,b);a=CalculatePrice(new Decimal(nt*it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(tt*it),w,b);s=CalculatePrice(new Decimal(tt*it),w,h);k=CalculateRebate(new Decimal(g*it),y,b);l=CalculatePrice(new Decimal(g*it),y,k);d=CalculateRebate(new Decimal(nt*it),p,b);a=CalculatePrice(new Decimal(nt*it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal(tt*(c+1)),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal((c+1)*tt),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(24*c*tt),w,b);s=CalculatePrice(new Decimal(24*c*tt),w,h);k=CalculateRebate(new Decimal(24*c*g),y,b);l=CalculatePrice(new Decimal(24*c*g),y,k);d=CalculateRebate(new Decimal(24*c*nt),p,b);a=CalculatePrice(new Decimal(24*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(24*c*tt),w,b);s=CalculatePrice(new Decimal(24*c*tt),w,h);k=CalculateRebate(new Decimal(24*c*g),y,b);l=CalculatePrice(new Decimal(24*c*g),y,k);d=CalculateRebate(new Decimal(24*c*nt),p,b);a=CalculatePrice(new Decimal(24*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}tt==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0));g==0&&u.setValue("CG1TOTAL_AMOUNT",0);nt==0&&u.setValue("CG2TOTAL_AMOUNT",0)}}catch(kt){this.setCalloutActive(!1);this.log.severe(kt.toString())}return i=r=u=f=e=o=null,""};i.prototype.fromchkdate=function(i,r,u,f,e,o){var s,l,a,h,k,d,v,ht,at,lt,st;if(e==null||e.toString()==""||(ht=t.getValueOfDateTime(e),ht==null||ht.equals(0)))return"";var et=t.getValueOfDateTime(u.getValue("ADATEFROM")),ot=t.getValueOfDateTime(u.getValue("ADATETO")),g=t.getValueOfInt(u.getValue("CG1NUM")),nt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),p=t.getValueOfDecimal(u.getValue("CG2PRICE"));try{if(et=t.getValueOfDateTime(u.getValue("ADATEFROM")),et.compareTo(ot)>0)u.setValue("CG1DATEFROM",et),u.setValue("CG2DATEFROM",et),at=et.addDays(1),u.setValue("ADATETO",at);else if(ot.compareTo(et)>0){var ct=et.subtract(ot),c=Utility.TimeUtil.getDaysBetween(et,ot),kt=ct.Milliseconds,ut=ct.Seconds,ft=ct.Minutes,rt,it,vt=c/30,pt=c%30,yt=c/7,wt=c%7;rt=pt==0?vt:vt+1;it=wt==0?yt:yt+1;lt=t.getValueOfDateTime(u.getValue("ADATEFROM"));u.setValue("CG1DATETO",ot);u.setValue("CG2DATETO",ot);u.setValue("CG1DATEFROM",lt);u.setValue("CG2DATEFROM",lt);st=u.getValue("AUOM_ID").toString();(st==""||st.Trim().Length==0)&&(st="0");var w=t.getValueOfDecimal(u.getValue("APRICE")),tt=t.getValueOfInt(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE"));if(t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(st)){case 1000003:s=w;l=y;a=p;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(tt),w,h);l=CalculatePrice(new Decimal(g),y,h);a=CalculatePrice(new Decimal(nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),w,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(rt),w,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(it),w,h);l=CalculatePrice(new Decimal(it),y,h);a=CalculatePrice(new Decimal(it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),w,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(24*c),w,h);l=CalculatePrice(new Decimal(24*c),y,h);a=CalculatePrice(new Decimal(24*c),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(ft),w,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ut),w,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*tt),w,h);l=CalculatePrice(new Decimal(c*g),y,h);a=CalculatePrice(new Decimal(c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(tt*it),w,h);l=CalculatePrice(new Decimal(g*it),y,h);a=CalculatePrice(new Decimal(nt*it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(tt*it),w,h);l=CalculatePrice(new Decimal(g*it),y,h);a=CalculatePrice(new Decimal(nt*it),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(tt*(c+1)),w,h);l=CalculatePrice(new Decimal(g*(c+1)),y,h);a=CalculatePrice(new Decimal(nt*(c+1)),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*tt),w,h);l=CalculatePrice(new Decimal((c+1)*g),y,h);a=CalculatePrice(new Decimal((c+1)*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(24*c*tt),w,h);l=CalculatePrice(new Decimal(24*c*g),y,h);a=CalculatePrice(new Decimal(24*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(24*c*tt),w,h);l=CalculatePrice(new Decimal(24*c*g),y,h);a=CalculatePrice(new Decimal(24*c*nt),p,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}}else switch(int.Parse(st)){case 1000003:s=w;l=y;a=p;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(tt),w,b);s=CalculatePrice(new Decimal(tt),w,h);k=CalculateRebate(new Decimal(g),y,b);l=CalculatePrice(new Decimal(g),y,k);d=CalculateRebate(new Decimal(nt),p,b);a=CalculatePrice(new Decimal(nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),w,b);s=CalculatePrice(new Decimal(c),w,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),p,b);a=CalculatePrice(new Decimal(c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(rt),w,b);s=CalculatePrice(new Decimal(rt),w,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),p,b);a=CalculatePrice(new Decimal(rt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(it),w,b);s=CalculatePrice(new Decimal(it),w,h);k=CalculateRebate(new Decimal(it),y,b);l=CalculatePrice(new Decimal(it),y,k);d=CalculateRebate(new Decimal(it),p,b);a=CalculatePrice(new Decimal(it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),w,b);s=CalculatePrice(new Decimal(c+1),w,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),p,b);a=CalculatePrice(new Decimal(c+1),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(24*c),w,b);s=CalculatePrice(new Decimal(24*c),w,h);k=CalculateRebate(new Decimal(24*c),y,b);l=CalculatePrice(new Decimal(24*c),y,k);d=CalculateRebate(new Decimal(24*c),p,b);a=CalculatePrice(new Decimal(24*c),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(ft),w,b);s=CalculatePrice(new Decimal(ft),w,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),p,b);a=CalculatePrice(new Decimal(ft),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ut),w,b);s=CalculatePrice(new Decimal(ut),w,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),p,b);a=CalculatePrice(new Decimal(ut),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*tt),w,b);s=CalculatePrice(new Decimal(c*tt),w,h);k=CalculateRebate(new Decimal(c*g),y,b);l=CalculatePrice(new Decimal(c*g),y,k);d=CalculateRebate(new Decimal(c*nt),p,b);a=CalculatePrice(new Decimal(c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(tt*it),w,b);s=CalculatePrice(new Decimal(tt*it),w,h);k=CalculateRebate(new Decimal(g*it),y,b);l=CalculatePrice(new Decimal(g*it),y,k);d=CalculateRebate(new Decimal(nt*it),p,b);a=CalculatePrice(new Decimal(nt*it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(tt*it),w,b);s=CalculatePrice(new Decimal(tt*it),w,h);k=CalculateRebate(new Decimal(g*it),y,b);l=CalculatePrice(new Decimal(g*it),y,k);d=CalculateRebate(new Decimal(nt*it),p,b);a=CalculatePrice(new Decimal(nt*it),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal(tt*(c+1)),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(tt*(c+1)),w,b);s=CalculatePrice(new Decimal((c+1)*tt),w,h);k=CalculateRebate(new Decimal(g*(c+1)),y,b);l=CalculatePrice(new Decimal(g*(c+1)),y,k);d=CalculateRebate(new Decimal(nt*(c+1)),p,b);a=CalculatePrice(new Decimal(nt*(c+1)),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(24*c*tt),w,b);s=CalculatePrice(new Decimal(24*c*tt),w,h);k=CalculateRebate(new Decimal(24*c*g),y,b);l=CalculatePrice(new Decimal(24*c*g),y,k);d=CalculateRebate(new Decimal(24*c*nt),p,b);a=CalculatePrice(new Decimal(24*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(24*c*tt),w,b);s=CalculatePrice(new Decimal(24*c*tt),w,h);k=CalculateRebate(new Decimal(24*c*g),y,b);l=CalculatePrice(new Decimal(24*c*g),y,k);d=CalculateRebate(new Decimal(24*c*nt),p,b);a=CalculatePrice(new Decimal(24*c*nt),p,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}tt==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0));g==0&&u.setValue("CG1TOTAL_AMOUNT",0);nt==0&&u.setValue("CG2TOTAL_AMOUNT",0)}}catch(bt){this.setCalloutActive(!1);this.log.severe(bt.toString())}return i=r=u=f=e=o=null,""};i.prototype.UOMSelected=function(i,r,u,f,e,o){var s,l,a,h,k,d,v,et;if(e==null||e.toString()==""||(et=t.getValueOfInt(e),et=t.getValueOfInt(u.getValue("AUOM_ID")),et==null))return"";u.setValue("CG1UOM_ID",et);u.setValue("CG2UOM_ID",et);var ct=u.getValue("AUOM_ID").toString(),p=t.getValueOfDecimal(u.getValue("APRICE")),g=t.getValueOfInt(u.getValue("ANUM")),b=t.getValueOfDecimal(u.getValue("AREBATE")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),ot=t.getValueOfDateTime(u.getValue("ADATETO")),st=t.getValueOfDateTime(u.getValue("ADATEFROM")),ht=st.compareTo(ot)>0?st.Subtract(ot):ot.Subtract(st);var c=Utility.timeUtil.getDaysBetween(st,ot),pt=ht.Milliseconds,ut=ht.Seconds,ft=ht.Minutes,rt,it,lt=c/30,vt=c%30,at=c/7,yt=c%7;if(rt=vt==0?lt:lt+1,it=yt==0?at:at+1,t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(ct)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(rt),p,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(it),p,h);l=CalculatePrice(new Decimal(it),y,h);a=CalculatePrice(new Decimal(it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(24*c),p,h);l=CalculatePrice(new Decimal(24*c),y,h);a=CalculatePrice(new Decimal(24*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ut),p,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}}else switch(int.Parse(ct)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(rt),p,b);s=CalculatePrice(new Decimal(rt),p,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),w,b);a=CalculatePrice(new Decimal(rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(it),p,b);s=CalculatePrice(new Decimal(it),p,h);k=CalculateRebate(new Decimal(it),y,b);l=CalculatePrice(new Decimal(it),y,k);d=CalculateRebate(new Decimal(it),w,b);a=CalculatePrice(new Decimal(it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(24*c),p,b);s=CalculatePrice(new Decimal(24*c),p,h);k=CalculateRebate(new Decimal(24*c),y,b);l=CalculatePrice(new Decimal(24*c),y,k);d=CalculateRebate(new Decimal(24*c),w,b);a=CalculatePrice(new Decimal(24*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ut),p,b);s=CalculatePrice(new Decimal(ut),p,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),w,b);a=CalculatePrice(new Decimal(ut),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};i.prototype.AVALSelected=function(i,r,u,f,e,o){var s,l,a,h,k,d,v,et;if(e==null||e.toString()=="")return"";et=null;try{et=u.getValue("AUOM_ID").toString()}catch(yt){return this.setCalloutActive(!1),""}var p=t.getValueOfDecimal(u.getValue("APRICE")),b=t.getValueOfDecimal(u.getValue("AREBATE")),g=t.getValueOfInt(u.getValue("ANUM")),st=t.getValueOfDateTime(u.getValue("ADATETO")),nt=t.getValueOfInt(u.getValue("CG1NUM")),tt=t.getValueOfInt(u.getValue("CG2NUM")),y=t.getValueOfDecimal(u.getValue("CG1PRICE")),w=t.getValueOfDecimal(u.getValue("CG2PRICE")),ht=t.getValueOfDateTime(u.getValue("ADATEFROM")),ot=ht.Subtract(st),c=Utility.TimeUtil.getDaysBetween(ht,st),pt=ot.Milliseconds,ut=ot.Seconds,ft=ot.Minutes,rt,it,ct=c/30,at=c%30,lt=c/7,vt=c%7;if(rt=at==0?ct:ct+1,it=vt==0?lt:lt+1,t.getValueOfInt(b)==0){h=n.Env.ZERO;switch(int.Parse(et)){case 1000003:s=p;l=y;a=w;l=y;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:s=CalculatePrice(new Decimal(g),p,h);l=CalculatePrice(new Decimal(nt),y,h);a=CalculatePrice(new Decimal(tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:s=CalculatePrice(new Decimal(c),p,h);l=CalculatePrice(new Decimal(c),y,h);a=CalculatePrice(new Decimal(c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:s=CalculatePrice(new Decimal(rt),p,h);l=CalculatePrice(new Decimal(rt),y,h);a=CalculatePrice(new Decimal(rt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:s=CalculatePrice(new Decimal(it),p,h);l=CalculatePrice(new Decimal(it),y,h);a=CalculatePrice(new Decimal(it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:s=CalculatePrice(new Decimal(c+1),p,h);l=CalculatePrice(new Decimal(c+1),y,h);a=CalculatePrice(new Decimal(c+1),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:s=CalculatePrice(new Decimal(24*c),p,h);l=CalculatePrice(new Decimal(24*c),y,h);a=CalculatePrice(new Decimal(24*c),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:s=CalculatePrice(new Decimal(ft),p,h);l=CalculatePrice(new Decimal(ft),y,h);a=CalculatePrice(new Decimal(ft),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:s=CalculatePrice(new Decimal(ut),p,h);l=CalculatePrice(new Decimal(ut),y,h);a=CalculatePrice(new Decimal(ut),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:s=CalculatePrice(new Decimal(c*g),p,h);l=CalculatePrice(new Decimal(c*nt),y,h);a=CalculatePrice(new Decimal(c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:s=CalculatePrice(new Decimal(g*it),p,h);l=CalculatePrice(new Decimal(nt*it),y,h);a=CalculatePrice(new Decimal(tt*it),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:s=CalculatePrice(new Decimal(g*(c+1)),p,h);l=CalculatePrice(new Decimal(nt*(c+1)),y,h);a=CalculatePrice(new Decimal(tt*(c+1)),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:s=CalculatePrice(new Decimal((c+1)*g),p,h);l=CalculatePrice(new Decimal((c+1)*nt),y,h);a=CalculatePrice(new Decimal((c+1)*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:s=CalculatePrice(new Decimal(24*c*g),p,h);l=CalculatePrice(new Decimal(24*c*nt),y,h);a=CalculatePrice(new Decimal(24*c*tt),w,h);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}}else switch(int.Parse(et)){case 1000003:s=p;l=y;a=w;u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000004:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000005:h=CalculateRebate(new Decimal(g),p,b);s=CalculatePrice(new Decimal(g),p,h);k=CalculateRebate(new Decimal(nt),y,b);l=CalculatePrice(new Decimal(nt),y,k);d=CalculateRebate(new Decimal(tt),w,b);a=CalculatePrice(new Decimal(tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000006:h=CalculateRebate(new Decimal(c),p,b);s=CalculatePrice(new Decimal(c),p,h);k=CalculateRebate(new Decimal(c),y,b);l=CalculatePrice(new Decimal(c),y,k);d=CalculateRebate(new Decimal(c),w,b);a=CalculatePrice(new Decimal(c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000007:h=CalculateRebate(new Decimal(rt),p,b);s=CalculatePrice(new Decimal(rt),p,h);k=CalculateRebate(new Decimal(rt),y,b);l=CalculatePrice(new Decimal(rt),y,k);d=CalculateRebate(new Decimal(rt),w,b);a=CalculatePrice(new Decimal(rt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000008:h=CalculateRebate(new Decimal(it),p,b);s=CalculatePrice(new Decimal(it),p,h);k=CalculateRebate(new Decimal(it),y,b);l=CalculatePrice(new Decimal(it),y,k);d=CalculateRebate(new Decimal(it),w,b);a=CalculatePrice(new Decimal(it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000009:h=CalculateRebate(new Decimal(c+1),p,b);s=CalculatePrice(new Decimal(c+1),p,h);k=CalculateRebate(new Decimal(c+1),y,b);l=CalculatePrice(new Decimal(c+1),y,k);d=CalculateRebate(new Decimal(c+1),w,b);a=CalculatePrice(new Decimal(c+1),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000010:h=CalculateRebate(new Decimal(24*c),p,b);s=CalculatePrice(new Decimal(24*c),p,h);k=CalculateRebate(new Decimal(24*c),y,b);l=CalculatePrice(new Decimal(24*c),y,k);d=CalculateRebate(new Decimal(24*c),w,b);a=CalculatePrice(new Decimal(24*c),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000011:h=CalculateRebate(new Decimal(ft),p,b);s=CalculatePrice(new Decimal(ft),p,h);k=CalculateRebate(new Decimal(ft),y,b);l=CalculatePrice(new Decimal(ft),y,k);d=CalculateRebate(new Decimal(ft),w,b);a=CalculatePrice(new Decimal(ft),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000012:h=CalculateRebate(new Decimal(ut),p,b);s=CalculatePrice(new Decimal(ut),p,h);k=CalculateRebate(new Decimal(ut),y,b);l=CalculatePrice(new Decimal(ut),y,k);d=CalculateRebate(new Decimal(ut),w,b);a=CalculatePrice(new Decimal(ut),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000013:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000014:h=CalculateRebate(new Decimal(c*g),p,b);s=CalculatePrice(new Decimal(c*g),p,h);k=CalculateRebate(new Decimal(c*nt),y,b);l=CalculatePrice(new Decimal(c*nt),y,k);d=CalculateRebate(new Decimal(c*tt),w,b);a=CalculatePrice(new Decimal(c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000015:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000016:h=CalculateRebate(new Decimal(g*it),p,b);s=CalculatePrice(new Decimal(g*it),p,h);k=CalculateRebate(new Decimal(nt*it),y,b);l=CalculatePrice(new Decimal(nt*it),y,k);d=CalculateRebate(new Decimal(tt*it),w,b);a=CalculatePrice(new Decimal(tt*it),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000017:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal(g*(c+1)),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000018:h=CalculateRebate(new Decimal(g*(c+1)),p,b);s=CalculatePrice(new Decimal((c+1)*g),p,h);k=CalculateRebate(new Decimal(nt*(c+1)),y,b);l=CalculatePrice(new Decimal(nt*(c+1)),y,k);d=CalculateRebate(new Decimal(tt*(c+1)),w,b);a=CalculatePrice(new Decimal(tt*(c+1)),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;case 1000019:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=Decimal.Add(Decimal.Add(s,l),a);u.setValue("GRAND_TOTAL",v);break;case 1000020:h=CalculateRebate(new Decimal(24*c*g),p,b);s=CalculatePrice(new Decimal(24*c*g),p,h);k=CalculateRebate(new Decimal(24*c*nt),y,b);l=CalculatePrice(new Decimal(24*c*nt),y,k);d=CalculateRebate(new Decimal(24*c*tt),w,b);a=CalculatePrice(new Decimal(24*c*tt),w,d);u.setValue("ATOTAL_AMOUNT",s);u.setValue("CG1TOTAL_AMOUNT",l);u.setValue("CG2TOTAL_AMOUNT",a);v=s;u.setValue("GRAND_TOTAL",v);break;default:ShowMessage.Info("false",!0,"","")}return g==0&&(u.setValue("ATOTAL_AMOUNT",0),u.setValue("GRAND_TOTAL",0)),nt==0&&u.setValue("CG1TOTAL_AMOUNT",0),tt==0&&u.setValue("CG2TOTAL_AMOUNT",0),i=r=u=f=e=o=null,""};n.Model.CalloutOfferServices=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutCheckInOut")}var r=n.Logging.Level,t=n.Utility.Util;i.prototype.TypeSelection=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=t.getValueOfBoolean(f);return o==null?"":(o==!0?r.setValue("flag1",!0):r.setValue("flag1",!1),n=i=r=u=f=e=null,"")};i.prototype.RecordSort=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=t.getValueOfBoolean(f);return o==null?"":(o==!0?r.setValue("flag2",!0):r.setValue("flag2",!1),n=i=r=u=f=e=null,"")};i.prototype.EndDate=function(i,r,u,f,e,o){var s,h,c;if(e==null||e.toString()==""||(s=t.getValueOfDateTime(e),s==null||s.equals(0)))return"";h=t.getValueOfDateTime(e);c=t.getValueOfDateTime(u.getValue("DATE_FROM"));try{h=t.getValueOfDateTime(u.getValue("TILL_DATE"));h.compareTo(c)<0&&(n.ADialog.info("EndAndStartDate"),u.setValue("TILL_DATE",c))}catch(l){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};i.prototype.StartDate=function(n,i,r,u,f,e){var s,o,h;if(f==null||f.toString()==""||(s=t.getValueOfDateTime(f),s==null||s.equals(0)))return"";o=t.getValueOfDateTime(r.getValue("DATE_FROM"));h=t.getValueOfDateTime(r.getValue("TILL_DATE"));try{o=t.getValueOfDateTime(r.getValue("DATE_FROM"));o.compareTo(h)>0&&r.setValue("TILL_DATE",o)}catch(c){this.setCalloutActive(!1)}return n=i=r=u=f=e=null,""};n.Model.CalloutCheckInOut=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutInventory")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.Product=function(i,r,u,f,e,o){var l,v,d,g,ut,s,a,y,h,tt,c,it,w,rt,p;if(this.isCalloutActive()||f.getColumnName()!="M_ProductContainer_ID"||e!=null&&e.toString()!=""||(e=0),this.isCalloutActive()||e==null||e.toString()=="")return"";l=0;v=i.getContext(r,"AttrCode");v!=null&&v!=""&&f.getColumnName()!="M_ProductContainer_ID"&&(a=e.toString()+","+v.toString(),l=n.dataContext.getJSONRecord("MInventoryLine/GetProductAttribute",a));var b=t.getValueOfInt(u.getValue("M_InventoryLine_ID")),st=t.getValueOfInt(u.getValue("M_Inventory_ID")),k=null,ht=st.toString();if(k=n.dataContext.getJSONRecord("MInventory/GetMInventory",ht),d=k.MovementDate,g=k.AD_Org_ID,f.getColumnName()=="M_Product_ID"&&(ut=n.dataContext.getJSONRecord("MInventoryLine/GetProductUOM",e.toString()),u.setValue("C_UOM_ID",t.getValueOfInt(ut))),s=null,a=b.toString(),b!=null&&b!=0){y=null;y=n.dataContext.getJSONRecord("MInventoryLine/GetMInventoryLine",a);var h=y.M_Product_ID,c=y.M_Locator_ID,nt=t.getValueOfInt(u.getValue("M_Product_ID")),ft=t.getValueOfInt(u.getValue("M_Locator_ID")),p=t.getValueOfInt(u.getValue("M_ProductContainer_ID")),et=0;if(nt!=h||ft!=c||f.getColumnName()=="M_ProductContainer_ID"){this.setCalloutActive(!0);l>0&&u.setValue("M_AttributeSetInstance_ID",l);nt==h?et=t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID")):u.setValue("M_AttributeSetInstance_ID",null);try{s=this.SetQtyBook(g,et,nt,ft,t.getValueOfDate(d),p);u.setValue("QtyBook",s)}catch(ot){return this.setCalloutActive(!1),this.log.severe(ot.toString()),u.setValue("QtyBook",s)}}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""}if((h=0,tt=t.getValueOfInt(u.getValue("M_Product_ID")),tt!=null&&(h=tt),h==0)||(c=0,it=t.getValueOfInt(u.getValue("M_Locator_ID")),it!=null&&(c=it),c==0))return"";this.setCalloutActive(!0);l>0&&u.setValue("M_AttributeSetInstance_ID",l);w=0;rt=t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID"));rt!=null&&(w=rt);u.setValue("M_AttributeSetInstance_ID",null);p=t.getValueOfInt(u.getValue("M_ProductContainer_ID"));try{s=this.SetQtyBook(g,w,h,c,t.getValueOfDate(d),p);u.setValue("QtyBook",s)}catch(ot){return this.setCalloutActive(!1),this.log.severe(ot.toString()),u.setValue("QtyBook",s)}return this.log.info("M_Product_ID="+h+", M_Locator_ID="+c+", M_AttributeSetInstance_ID="+w+" - QtyBook="+s),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.AttributeSetInstance=function(i,r,u,f,e,o){var s,v,l,y,w;if(this.isCalloutActive())return"";var tt=t.getValueOfInt(u.getValue("M_InventoryLine_ID")),b=t.getValueOfInt(u.getValue("M_Inventory_ID")),a=null,k=b.toString();a=n.dataContext.getJSONRecord("MInventory/GetMInventory",k);var d=a.MovementDate,g=a.AD_Org_ID,h=null,c=0,p=t.getValueOfInt(u.getValue("M_Product_ID"));if((p!=null&&(c=p),c==0)||(s=0,v=t.getValueOfInt(u.getValue("M_Locator_ID")),v!=null&&(s=v),s==0))return"";this.setCalloutActive(!0);l=0;y=t.getValueOfInt(u.getValue("M_AttributeSetInstance_ID"));y!=null&&(l=y);w=t.getValueOfInt(u.getValue("M_ProductContainer_ID"));try{h=this.SetQtyBook(g,l,c,s,t.getValueOfDate(d),w);u.setValue("QtyBook",h)}catch(nt){return this.setCalloutActive(!1),this.log.severe(nt.toString()),u.setValue("QtyBook",h)}return this.log.info("M_Product_ID="+c+", M_Locator_ID="+s+", M_AttributeSetInstance_ID="+l+" - QtyBook="+h),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.SetDiff=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=0,s=0,h=0;this.setCalloutActive(!0);try{u.getColumnName().equals("DifferenceQty")?(s=t.getValueOfDecimal(r.getValue("OpeningStock")),h=t.getValueOfDecimal(r.getValue("DifferenceQty")),o=s-h,r.setValue("AsOnDateCount",o),r.setValue("QtyCount",0)):u.getColumnName().equals("AsOnDateCount")&&(s=t.getValueOfDecimal(r.getValue("OpeningStock")),o=t.getValueOfDecimal(r.getValue("AsOnDateCount")),h=s-o,r.setValue("DifferenceQty",h),r.setValue("QtyCount",0))}catch(c){return this.setCalloutActive(!1),this.log.severe(c.toString()),c.message}return this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.SetQtyBook=function(i,r,u,f,e,o){var c=null,l="",a="",v=0,h=!1,s;return(n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"]!=undefined&&(h=n.context.ctx["#PRODUCT_CONTAINER_APPLICABLE"].equals("Y",!0)),s="TO_DATE( '"+(Number(e.getMonth())+1)+"-"+e.getDate()+"-"+e.getFullYear()+"', 'MM-DD-YYYY')",l=h?"SELECT COUNT(*) FROM M_Transaction WHERE movementdate = "+s+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+" AND NVL(M_ProductContainer_ID, 0) = "+o:"SELECT COUNT(*) FROM M_Transaction WHERE movementdate = "+s+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r,v=t.getValueOfInt(n.DB.executeScalar(l)),v>0?(a=h?"SELECT  NVL(ContainerCurrentQty, 0) AS currentqty FROM M_Transaction WHERE M_Transaction_ID = (SELECT MAX(M_Transaction_ID)   FROM M_Transaction  WHERE movementdate = (SELECT MAX(movementdate) FROM M_Transaction WHERE movementdate <= "+s+"  AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+" AND NVL(M_ProductContainer_ID, 0) = "+o+") AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+" AND NVL(M_ProductContainer_ID, 0) = "+o+")  AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+" AND NVL(M_ProductContainer_ID, 0) = "+o:"SELECT currentqty FROM M_Transaction WHERE M_Transaction_ID = (SELECT MAX(M_Transaction_ID)   FROM M_Transaction  WHERE movementdate = (SELECT MAX(movementdate) FROM M_Transaction WHERE movementdate <= "+s+"  AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+") AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+") AND AD_Org_ID = "+i+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r,c=t.getValueOfDecimal(n.DB.executeScalar(a))):(l=h?"SELECT COUNT(*) FROM M_Transaction WHERE movementdate < "+s+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+" AND NVL(M_ProductContainer_ID, 0) = "+o:"SELECT COUNT(*) FROM M_Transaction WHERE movementdate < "+s+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r,v=t.getValueOfInt(n.DB.executeScalar(l)),v>0&&(a=h?"SELECT NVL(ContainerCurrentQty, 0) AS currentqty FROM M_Transaction WHERE M_Transaction_ID = (SELECT MAX(M_Transaction_ID)   FROM M_Transaction  WHERE movementdate =  (SELECT MAX(movementdate) FROM M_Transaction WHERE movementdate < "+s+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+" AND NVL(M_ProductContainer_ID, 0) = "+o+") AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+" AND NVL(M_ProductContainer_ID, 0) = "+o+")  AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+" AND NVL(M_ProductContainer_ID, 0) = "+o:"SELECT currentqty FROM M_Transaction WHERE M_Transaction_ID = (SELECT MAX(M_Transaction_ID)   FROM M_Transaction  WHERE movementdate =  (SELECT MAX(movementdate) FROM M_Transaction WHERE movementdate < "+s+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+") AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r+") AND AD_Org_ID = "+i+" AND  M_Product_ID = "+u+" AND M_Locator_ID = "+f+" AND M_AttributeSetInstance_ID = "+r,c=t.getValueOfDecimal(n.DB.executeScalar(a)))),c!=null)?c:0};i.prototype.SetUOMQty=function(i,r,u,f,e,o){var v,h,y,a,l,c;if(e==null||e.toString()==""||this.isCalloutActive())return"";var p=0,w=0,b=0,s=0;this.setCalloutActive(!0);try{if(v=t.getValueOfDecimal(u.getValue("M_Product_ID")),v==0)return this.setCalloutActive(!1),"";u.getValue("IsInternalUse")==!1||u.getValue("IsInternalUse")==null?(f.getColumnName()=="C_UOM_ID"?(h=t.getValueOfInt(e),QtyEntered=t.getValueOfDecimal(u.getValue("QtyEntered")),v=t.getValueOfInt(u.getValue("M_Product_ID")),paramStr=v.toString().concat(",").concat(h.toString()).concat(",").concat(QtyEntered.toString()),l=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",paramStr),s=l,c=!1,s!=null&&(c=QtyEntered!=s),s==null&&(c=!1,s=1),c?s:s=s*QtyEntered):f.getColumnName()=="QtyEntered"&&(h=i.getContextAsInt(r,"C_UOM_ID"),QtyEntered=t.getValueOfDecimal(e),paramStr=h.toString().concat(","),y=n.dataContext.getJSONRecord("MUOM/GetPrecision",paramStr),a=QtyEntered.toFixed(t.getValueOfInt(y)),QtyEntered!=a&&(this.log.fine("Corrected QtyEntered Scale UOM="+h+"; QtyEntered="+QtyEntered+"->"+a),QtyEntered=a,u.setValue("QtyEntered",QtyEntered)),paramStr=v.toString().concat(",",h.toString(),",",QtyEntered.toString()),l=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",paramStr),s=l,s==null&&(s=QtyEntered),c=QtyEntered!=s,this.log.fine("UOM="+h+", QtyEntered="+QtyEntered+" -> "+c+" QtyOrdered="+s),i.setContext(r,"UOMConversion",c?"Y":"N"),s),u.getValue("AdjustmentType").toString()=="D"?(w=t.getValueOfDecimal(u.getValue("OpeningStock")),b=s,p=w-b,u.setValue("DifferenceQty",s),u.setValue("AsOnDateCount",p)):u.getValue("AdjustmentType").toString()=="A"&&(w=t.getValueOfDecimal(u.getValue("OpeningStock")),p=s,b=w-p,u.setValue("AsOnDateCount",s),u.setValue("DifferenceQty",b))):u.getValue("IsInternalUse")==!0&&(f.getColumnName()=="C_UOM_ID"?(h=t.getValueOfInt(e),QtyEntered=t.getValueOfDecimal(u.getValue("QtyEntered")),v=t.getValueOfInt(u.getValue("M_Product_ID")),paramStr=v.toString().concat(",").concat(h.toString()).concat(",").concat(QtyEntered.toString()),l=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",paramStr),s=l,c=!1,s!=null&&(c=QtyEntered!=s),s==null&&(c=!1,s=1),c?u.setValue("QtyInternalUse",s):u.setValue("QtyInternalUse",s*QtyEntered)):f.getColumnName()=="QtyEntered"&&(h=i.getContextAsInt(r,"C_UOM_ID"),QtyEntered=t.getValueOfDecimal(e),paramStr=h.toString().concat(","),y=n.dataContext.getJSONRecord("MUOM/GetPrecision",paramStr),a=QtyEntered.toFixed(t.getValueOfInt(y)),QtyEntered!=a&&(this.log.fine("Corrected QtyEntered Scale UOM="+h+"; QtyEntered="+QtyEntered+"->"+a),QtyEntered=a,u.setValue("QtyEntered",QtyEntered)),paramStr=v.toString().concat(",",h.toString(),",",QtyEntered.toString()),l=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",paramStr),s=l,s==null&&(s=QtyEntered),c=QtyEntered!=s,this.log.fine("UOM="+h+", QtyEntered="+QtyEntered+" -> "+c+" QtyOrdered="+s),i.setContext(r,"UOMConversion",c?"Y":"N"),u.setValue("QtyInternalUse",s)))}catch(k){return this.setCalloutActive(!1),this.log.severe(k.toString()),k.message}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutInventory=i}(VIS,jQuery),function(n){function r(){n.CalloutEngine.call(this,"VIS.CalloutInvoice")}var u=n.Logging.Level,t=n.Utility.Util,i=0;n.Utility.inheritPrototype(r,n.CalloutEngine);r.prototype.DocType=function(i,r,f,e,o,s){var l,a,h,c;if(o==null||o.toString()==""||(l=o,l==null||l==0))return"";a=l.toString();h=n.dataContext.getJSONRecord("MDocType/GetDocTypeData",a);try{i.setContext(r,"HasCharges",t.getValueOfString(h.HasCharges));h.IsDocNoControlled=="Y"&&f.setValue("DocumentNo","<"+t.getValueOfString(h.CurrentNext)+">");c=t.getValueOfString(h.DocBaseType);i.setContext(r,"DocBaseType",c);c.startsWith("AP")?f.setValue("PaymentRule","S"):c.endsWith("C")&&f.setValue("PaymentRule","P");f.getField("TreatAsDiscount")!=null&&(c.equals("APC")?f.setValue("TreatAsDiscount",t.getValueOfBoolean(h.TreatAsDiscount)):f.setValue("TreatAsDiscount",!1))}catch(v){return this.setCalloutActive(!1),h!=null&&h.close(),this.log.log(u.SEVERE,sql,v),v.message}return i=r=f=e=o=s=null,""};r.prototype.BPartner=function(i,r,f,e,o,s){var p,k,c,tt,l,ht,ct,it,rt,ut,ft,et,lt,g,nt;if(o==null||o.toString()=="")return"";try{if(p=t.getValueOfInt(o),p==null||p==0)return"";var w="N",ot="N",d="SELECT p.AD_Language,p.C_PaymentTerm_ID, COALESCE(p.M_PriceList_ID,g.M_PriceList_ID) AS M_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted,",tt=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'"));tt>0&&(d+=" p.VA009_PaymentMethod_ID, p.VA009_PO_PaymentMethod_ID, ");d+="p.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable, l.C_BPartner_Location_ID,c.AD_User_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID,  p.SalesRep_ID,p.IsSalesRep  FROM C_BPartner p INNER JOIN C_BP_Group g ON (p.C_BP_Group_ID=g.C_BP_Group_ID) LEFT OUTER JOIN C_BPartner_Location l ON (p.C_BPartner_ID=l.C_BPartner_ID AND l.IsBillTo='Y' AND l.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID="+p+" AND p.IsActive='Y'";var b=i.isSOTrx(r),h=null,a=null;try{if(h=n.DB.executeReader(d,null,null),h.read()){if(k=t.getValueOfInt(h.get(b?"m_pricelist_id":"po_pricelist_id")),k>0&&f.setValue("M_PriceList_ID",k),c=t.getValueOfString(h.get(b?"paymentrule":"paymentrulepo")),c!=null&&c.length!=0&&(i.getContext("DocBaseType").toString().endsWith("C")?c="P":b&&(c.toString().equals("S")||c.toString().equals("U"))&&(c="P"),f.setValue("PaymentRule",c)),tt=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='VA009_'  AND IsActive = 'Y'")),tt>0){var y=t.getValueOfInt(h.get("VA009_PaymentMethod_ID")),w="N",v=n.dataContext.getJSONRecord("MBPartner/GetBPDetails",p);v!=null&&(w=t.getValueOfString(v.IsVendor),ot=t.getValueOfString(v.IsCustomer),b?w=="Y"?(y=0,l=null,ot=="Y"&&(y=t.getValueOfInt(v.VA009_PaymentMethod_ID),l=t.getValueOfString(v.VA009_PAYMENTBASETYPE))):ot=="Y"&&(y=t.getValueOfInt(v.VA009_PaymentMethod_ID),l=t.getValueOfString(v.VA009_PAYMENTBASETYPE)):w=="Y"?(y=t.getValueOfInt(v.VA009_PO_PaymentMethod_ID),l=t.getValueOfString(v.VA009_PAYMENTBASETYPEPO)):(y=0,l=null));y==0?f.setValue("VA009_PaymentMethod_ID",null):(f.setValue("VA009_PaymentMethod_ID",y),l=n.DB.executeScalar("SELECT VA009_PaymentBaseType FROM VA009_PaymentMethod WHERE VA009_PaymentMethod_ID="+y),l!=null?(f.setValue("PaymentMethod",l),w=="N"?f.setValue("PaymentRule",l):f.setValue("PaymentRule",l)):(f.setValue("PaymentMethod","T"),w=="N"?f.setValue("PaymentRule","T"):f.setValue("PaymentRule","T")))}ht=t.getValueOfInt(f.getValue("C_PaymentTerm_ID"));ct=t.getValueOfDecimal(f.getValue("C_Order_Blanket"));ht>0&&ct>0||(k=t.getValueOfInt(h.get(b?"c_paymentterm_id":"po_paymentterm_id")),k>0&&f.setValue("C_PaymentTerm_ID",k));it=t.getValueOfInt(h.get("c_bpartner_location_id"));p.toString().equals(i.getContext("C_BPartner_ID"))&&(rt=i.getContext("C_BPartner_Location_ID"),rt&&rt.toString().length>0&&(it=parseInt(rt)));it==0?f.setValue("C_BPartner_Location_ID",null):f.setValue("C_BPartner_Location_ID",it);ut=t.getValueOfInt(h.get("ad_user_id"));p.toString().equals(i.getContext("C_BPartner_ID"))&&(ft=i.getContext("AD_User_ID"),ft&&ft.toString().length>0&&(ut=parseInt(ft)));ut==0?f.setValue("AD_User_ID",null):f.setValue("AD_User_ID",ut);b&&(et=h.getString("CreditStatusSettingOn"),et=="CH"?(g=t.getValueOfDouble(h.get("so_creditlimit")),g!=0&&(nt=t.getValueOfDouble(h.get("creditavailable")),h!=null&&nt<=0&&n.ADialog.info("CreditOver"))):(lt=t.getValueOfInt(f.getValue("C_BPartner_Location_ID")),d="SELECT bp.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable FROM C_BPartner_Location p INNER JOIN C_BPartner bp ON (bp.C_BPartner_ID = p.C_BPartner_ID) WHERE p.C_BPartner_Location_ID = "+lt,a=n.DB.executeReader(d),a.read()&&(et=a.getString("CreditStatusSettingOn"),et=="CL"&&(g=t.getValueOfDouble(a.get("so_creditlimit")),g!=0&&(nt=t.getValueOfDouble(a.get("creditavailable")),h!=null&&nt<=0&&n.ADialog.info("CreditOver"))))));c=t.getValueOfString(h.get("poreference"));c!=null&&c.length!=0?f.setValue("POReference",c):f.setValue("POReference",null);c=t.getValueOfString(h.get("so_description"));c!=null&&c.toString().trim().length!=0&&f.setValue("Description",c);c=t.getValueOfString(h.get("isdiscountprinted"));c!=null&&c.toString().trim().length!=0?f.setValue("IsDiscountPrinted",c):f.setValue("IsDiscountPrinted","N")}h.close()}catch(st){return this.setCalloutActive(!1),h!=null&&h.close(),a!=null&&a.close(),this.log.log(u.SEVERE,"bPartner",st),st.message}finally{h!=null&&h.close();a!=null&&a.close()}}catch(st){this.setCalloutActive(!1);this.log.severe(st.toString())}return this.setCalloutActive(!1),i=r=f=e=o=s=null,""};r.prototype.PaymentTerm=function(t,i,r,u,f,e){var o,h,c,l,s,a;if(f==null||f.toString()=="")return"";try{if(o=f,h=t.getContextAsInt(i,"C_Invoice_ID",!1),o==null||o==0||h==0)return"";if(l=o.toString().concat(",",h.toString()),s=n.dataContext.getJSONRecord("MPaymentTerm/GetPaymentTerm",l),s!=null){if(c=s.Get_ID,a=s.Apply,c==0)return"PaymentTerm not found";r.setValue("IsPayScheduleValid",a?!0:!1)}}catch(v){this.setCalloutActive(!1);this.log.severe(v.toString())}return t=i=r=u=f=e=null,""};r.prototype.Product=function(r,u,f,e,o,s){var a,b,d,c,ht,p,tt,ut,w,h;if(this.isCalloutActive()||o==null||o.toString()=="")return f.setValue("VA038_AmortizationTemplate_ID",0),"";if(a=o,a==null||a==0)return"";this.setCalloutActive(!0);try{f.setValue("C_Charge_ID",null);f.setValue("M_AttributeSetInstance_ID",null);b=r.getWindowContext(u,"IsSOTrx",!0)=="Y";sql="SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'";i=t.getValueOfInt(n.DB.executeScalar(sql));d=n.dataContext.getJSONRecord("MInvoice/GetInvoice",f.getValue("C_Invoice_ID").toString());c=0;i>0&&(sql="SELECT C_UOM_ID FROM M_Product_PO WHERE IsActive = 'Y' AND  C_BPartner_ID = "+t.getValueOfInt(d.C_BPartner_ID)+" AND M_Product_ID = "+a,c=t.getValueOfInt(n.DB.executeScalar(sql)),c>0&&b==!1?f.setValue("C_UOM_ID",c):(sql="SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_Product_ID = "+a,f.setValue("C_UOM_ID",t.getValueOfInt(n.DB.executeScalar(sql)))));var it=r.getContextAsInt(u,"C_BPartner_ID",!1),ft=f.getValue("QtyInvoiced"),g=r.getContextAsInt(u,"M_PriceList_ID",!1),et=r.getContextAsInt(u,"M_PriceList_Version_ID"),ot=r.getContextAsInt(u,"M_AttributeSetInstance_ID"),st=r.getContext("DateInvoiced"),l=t.getValueOfInt(f.getValue("C_UOM_ID")),y=a.toString().concat(",",it.toString(),",",ft.toString(),",",b,",",g.toString(),",",et.toString(),",",null,",",st.toString(),",",ot.toString(),",",l,",",i),v=null;if(v=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",y),ht=null,f.setValue("PriceList",v.PriceList),f.setValue("PriceLimit",v.PriceLimit),f.setValue("PriceActual",v.PriceActual),f.setValue("PriceEntered",v.PriceEntered),f.setValue("C_Currency_ID",t.getValueOfInt(v.C_Currency_ID)),i<=0&&f.setValue("C_UOM_ID",t.getValueOfInt(v.C_UOM_ID)),i>0&&c>0&&b==!1){var y=a.toString(),l=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",y),g=t.getValueOfInt(d.M_PriceList_ID),nt=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",g.toString()),rt=n.dataContext.getJSONRecord("MUOM/GetPrecision",l.toString()),k=n.dataContext.getJSONRecord("MBPartner/GetBPartner",it.toString());sql="SELECT PriceList , PriceStd , PriceLimit FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+nt+" AND ( M_AttributeSetInstance_ID = 0 OR M_AttributeSetInstance_ID IS NULL ) AND C_UOM_ID="+c;p=n.DB.executeDataSet(sql);p.getTables().length>0&&(p.getTables()[0].getRows().length>0?(y=a.toString().concat(",",r.getAD_Client_ID().toString(),",",p.getTables()[0].getRows()[0].getCell("PriceStd").toString(),",",k.M_DiscountSchema_ID.toString(),",",k.FlatDiscount.toString(),",",f.getValue("QtyEntered").toString()),tt=t.getValueOfDecimal(n.dataContext.getJSONRecord("MOrderLine/FlatDiscount",y)),f.setValue("PriceList",t.getValueOfDecimal(p.getTables()[0].getRows()[0].getCell("PriceList"))),f.setValue("PriceLimit",t.getValueOfDecimal(p.getTables()[0].getRows()[0].getCell("PriceLimit"))),f.setValue("PriceActual",tt),f.setValue("PriceEntered",tt),sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+l+" AND con.C_UOM_To_ID = "+c,h=t.getValueOfDecimal(n.DB.executeScalar(sql)),h==0&&(sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+l+" AND con.C_UOM_To_ID = "+c,h=t.getValueOfDecimal(n.DB.executeScalar(sql))),l==c&&h==0&&(h=1),f.setValue("QtyInvoiced",t.getValueOfDecimal(f.getValue("QtyEntered")).toFixed(rt)*h)):(sql="SELECT PriceList FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+nt+" AND M_AttributeSetInstance_ID = 0 AND C_UOM_ID="+l,ut=t.getValueOfDecimal(n.DB.executeScalar(sql)),sql="SELECT PriceStd FROM M_ProductPrice WHERE Isactive='Y' AND M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND M_PriceList_Version_ID = "+nt+" AND M_AttributeSetInstance_ID = 0 AND C_UOM_ID="+l,w=t.getValueOfDecimal(n.DB.executeScalar(sql)),y=a.toString().concat(",",r.getAD_Client_ID().toString(),",",w.toString(),",",k.M_DiscountSchema_ID.toString(),",",k.FlatDiscount.toString(),",",f.getValue("QtyEntered").toString()),w=t.getValueOfDecimal(n.dataContext.getJSONRecord("MOrderLine/FlatDiscount",y)),sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.M_Product_ID = "+t.getValueOfInt(f.getValue("M_Product_ID"))+" AND con.C_UOM_ID = "+l+" AND con.C_UOM_To_ID = "+c,h=t.getValueOfDecimal(n.DB.executeScalar(sql)),h==0&&(sql="SELECT con.DivideRate FROM C_UOM_Conversion con INNER JOIN C_UOM uom ON con.C_UOM_ID = uom.C_UOM_ID WHERE con.IsActive = 'Y' AND con.C_UOM_ID = "+l+" AND con.C_UOM_To_ID = "+c,h=t.getValueOfDecimal(n.DB.executeScalar(sql))),f.setValue("PriceList",ut*h),f.setValue("PriceActual",w*h),f.setValue("PriceEntered",w*h),h==0&&(h=1),f.setValue("QtyInvoiced",t.getValueOfDecimal(f.getValue("QtyEntered")).toFixed(rt)*h)))}r.setContext(u,"EnforcePriceLimit",v.IsEnforcePriceLimit?"Y":"N");r.setContext(u,"DiscountSchema",v.IsDiscountSchema?"Y":"N")}catch(ct){this.setCalloutActive(!1);this.log.severe(ct.toString())}return this.setCalloutActive(!1),s=null,this.Tax(r,u,f,e,o)};r.prototype.Charge=function(i,r,u,f,e,o){var s,h,c,l;if(e==null||e.toString()=="")return u.setValue("VA038_AmortizationTemplate_ID",0),"";s=null;try{if(h=e,h==null||h==0)return"";if(u.getValue("M_Product_ID")!=null)return u.setValue("C_Charge_ID",null),"ChargeExclusively";u.setValue("M_AttributeSetInstance_ID",null);u.setValue("S_ResourceAssignment_ID",null);c=i.getContextAsInt("#C_UOM_ID");c>0?u.setValue("C_UOM_ID",c):u.setValue("C_UOM_ID",100);i.setContext(r,"DiscountSchema","N");l="SELECT ChargeAmt FROM C_Charge WHERE C_Charge_ID="+h;s=n.DB.executeReader(l,null,null);s.read()&&(u.setValue("PriceEntered",t.getValueOfDecimal(s.get("chargeamt"))),u.setValue("PriceActual",t.getValueOfDecimal(s.get("chargeamt"))),u.setValue("PriceLimit",0),u.setValue("PriceList",0),u.setValue("Discount",0));s.close()}catch(a){return this.setCalloutActive(!1),s!=null&&s.close(),a.message}return o=null,this.Tax(i,r,u,f,e)};r.prototype.Tax=function(i,r,u,f,e,o){var y,p,l,h,c,w,a,b,k,d,nt,v;if(e==null||e.toString()=="")return"";y=f.getColumnName();try{var g="",tt=t.getValueOfString(u.getValue("C_Invoice_ID")).concat(",",u.getValue("M_Product_ID").toString()+","+t.getValueOfString(u.getValue("C_Charge_ID"))),s=n.dataContext.getJSONRecord("MInvoice/GetTax",tt),it=t.getValueOfInt(s._CountVATAX),ut=i.getWindowContext(r,"IsSOTrx",!0)=="Y";if(it>0&&(g=t.getValueOfString(s.taxRule)),g=="T")if(p=t.getValueOfInt(s.taxId),p>0)u.setValue("C_Tax_ID",p);else{if(t.getValueOfInt(u.getValue("M_Product_ID"))>0)return u.setValue("M_Product_ID",""),this.setCalloutActive(!1),s.TaxExempt=="Y"?n.ADialog.info("TaxNoExemptFound"):n.ADialog.info("VATAX_DefineTax");if(t.getValueOfInt(u.getValue("C_Charge_ID"))>0)return u.setValue("C_Charge_ID",""),this.setCalloutActive(!1),s.TaxExempt=="Y"?n.ADialog.info("TaxNoExemptFound"):n.ADialog.info("VATAX_DefineChargeTax")}else{if((l=0,l=y.toString()=="M_Product_ID"?e:i.getContextAsInt(r,"M_Product_ID"),h=0,h=y.toString()=="C_Charge_ID"?e:i.getContextAsInt(r,"C_Charge_ID"),this.log.fine("Product="+l+", C_Charge_ID="+h),l==0&&h==0)||(c=i.getContextAsInt(r,"C_BPartner_Location_ID"),c==0))return this.Amt(i,r,u,f,e);this.log.fine("Ship BP_Location="+c);w=c;this.log.fine("Bill BP_Location="+w);a=i.getContext("DateInvoiced");this.log.fine("Bill Date="+a);b=a;this.log.fine("Ship Date="+b);k=i.getContextAsInt(r,"AD_Org_ID");this.log.fine("Org="+k);d=i.getContextAsInt("#M_Warehouse_ID");this.log.fine("Warehouse="+d);nt=h.toString().concat(",",a.toString(),b.toString(),",",k.toString(),",",d.toString(),",",w.toString(),",",c.toString(),",",i.getWindowContext(r,"IsSOTrx",!0).equals("Y"));v=t.getValueOfInt(n.dataContext.getJSONRecord("MTax/Get",nt));this.log.info("Tax ID="+v);v==0||u.setValue("C_Tax_ID",v)}}catch(rt){this.setCalloutActive(!1);this.log.severe(rt.toString())}return o=null,this.Amt(i,r,u,f,e)};r.prototype.Amt=function(r,f,e,o,s,h){var ut,g,nt,c,l,b,et,p,ct,tt,lt,ot,pt,at,k,a,y,v,w,dt,ft,yt;if(this.isCalloutActive()||s==null||s.toString()=="")return"";this.setCalloutActive(!0);try{this.log.log(u.WARNING,"amt - init");var d=r.getContextAsInt(f,"C_UOM_ID"),it=r.getContextAsInt(f,"M_Product_ID"),ht=r.getContextAsInt(f,"M_PriceList_ID"),y=ht.toString(),a;a=n.dataContext.getJSONRecord("MPriceList/GetPriceList",y);ut=a.StdPrecision;ct=t.getValueOfInt(e.getValue("C_OrderLine_ID"));g=e.getValue("QtyEntered");nt=e.getValue("QtyInvoiced");this.log.fine("QtyEntered="+g+", Invoiced="+nt+", UOM="+d);c=e.getValue("PriceEntered");l=e.getValue("PriceActual");b=e.getValue("PriceLimit");p=e.getValue("PriceList");this.log.fine("PriceList="+p+", Limit="+b+", Precision="+ut);this.log.fine("PriceEntered="+c+", Actual="+l);o.getColumnName()=="QtyEntered"&&i>0&&(tt=r.getContextAsInt(f,"C_BPartner_ID",!1),ct==0&&(y=it.toString().concat(",",e.getValue("C_Invoice_ID").toString()+","+t.getValueOfString(e.getValue("M_AttributeSetInstance_ID"))+","+d.toString()+","+r.getAD_Client_ID().toString()+","+tt.toString()+","+g.toString()),v=n.dataContext.getJSONRecord("MInvoice/GetPrices",y),v!=null&&(p=v.PriceList,e.setValue("PriceList",p),c=v.PriceEntered,e.setValue("PriceLimit",v.PriceLimit),l=c,e.setValue("PriceActual",l),e.setValue("PriceEntered",c))));(o.getColumnName()=="QtyInvoiced"||o.getColumnName()=="QtyEntered"||o.getColumnName()=="M_Product_ID")&&!1==r.getContext("DiscountSchema")?(tt=r.getContextAsInt(f,"C_BPartner_ID"),o.getColumnName()=="QtyEntered"&&(y=it.toString().concat(",",d.toString(),",",g.toString()),nt=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",y)),nt==null&&(nt=g),lt=r.getWindowContext(f,"IsSOTrx",!0)=="Y",ot=e.getValue("DateInvoiced"),i=t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'")),pt=n.dataContext.getJSONRecord("MInvoice/GetInvoice",e.getValue("C_Invoice_ID").toString()),at=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",pt.M_PriceList_ID.toString()),ct==0&&(k=ot==null?it.toString().concat(",",tt.toString(),",",nt.toString(),",",lt,",",ht.toString(),",",at.toString(),",",ot,",",null,",",d.toString(),",",i):it.toString().concat(",",tt.toString(),",",nt.toString(),",",lt,",",ht.toString(),",",at.toString(),",",ot.toString(),",",null,",",d.toString(),",",i),a=null,a=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",k),i<=0?(y=it.toString().concat(",",d.toString(),",",l.toString()),c=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",y)):(k=it.toString().concat(",",e.getValue("C_Invoice_ID").toString()+","+t.getValueOfString(e.getValue("M_AttributeSetInstance_ID"))+","+d.toString()+","+r.getAD_Client_ID().toString()+","+tt.toString()+","+g.toString()),v=n.dataContext.getJSONRecord("MInvoice/GetPrices",k),v!=null&&(p=v.PriceList,e.setValue("PriceList",p),c=v.PriceEntered,e.setValue("PriceLimit",v.PriceLimit))),c==null&&(c=a.PriceStd),this.log.fine("amt - QtyChanged -> PriceActual="+a.PriceStd+", PriceEntered="+c+", Discount="+a.Discount),l=i<=0?a.PriceStd:c,e.setValue("PriceActual",l),e.setValue("PriceEntered",c)),r.setContext(f,"DiscountSchema",a.IsDiscountSchema?"Y":"N")):o.getColumnName()=="PriceActual"?(l=s,c=l,this.log.fine("amt - PriceActual="+l+" -> PriceEntered="+c),e.setValue("PriceEntered",c)):o.getColumnName()=="PriceEntered"&&(c=s,l=c,l==null&&(l=c),this.log.fine("amt - PriceEntered="+c+" -> PriceActual="+l),e.setValue("PriceActual",l));var wt=!1,rt=r.getContext("EnforcePriceLimit"),st=r.isSOTrx()&&rt!=null&&rt=="Y";if(rt==""){var k=t.getValueOfInt(e.getValue("C_Invoice_ID")).toString(),bt=n.dataContext.getJSONRecord("MInvoice/GetInvoice",k),vt="SELECT EnforcePriceLimit FROM M_PriceList WHERE IsActive = 'Y' AND M_PriceList_ID = "+bt.M_PriceList_ID;rt=n.DB.executeScalar(vt);st=bt.IsSOTrx&&rt!=null&&rt=="Y";vt="SELECT OverwritePriceLimit FROM AD_Role WHERE IsActive = 'Y' AND AD_Role_ID = "+r.getContext("#AD_Role_ID");wt=t.getValueOfBoolean(n.DB.executeScalar(vt))}if(st&&wt&&(st=!1),st&&t.getValueOfDouble(b)!=0&&l.compareTo(b)<0&&(l=b,c=l,c==null&&(c=b),this.log.fine("amt =(under) PriceEntered="+c+", Actual"+b),e.setValue("PriceActual",b),e.setValue("PriceEntered",c),n.ADialog.info("UnderLimitPrice"),t.getValueOfInt(p)!=0&&(et=(p-l)/p*100,t.scale(et)>2&&(et=et.toFixed(2)))),c=t.getValueOfDecimal(e.getValue("PriceEntered")),w=g*c,t.scale(w)>ut&&(w=w.toFixed(ut)),this.log.info("amt = LineNetAmt="+w),e.setValue("LineNetAmt",w),dt="Y"==r.getWindowContext(f,"IsSOTrx",!0),ft=n.Env.ZERO,o.getColumnName()=="TaxAmt")ft=e.getValue("TaxAmt");else if(yt=e.getValue("C_Tax_ID"),yt!=null){var gt=yt,kt=this.IsTaxIncluded(f,r),k=gt.toString().concat(",",w.toString(),",",kt,",",ut.toString()),a=null;ft=n.dataContext.getJSONRecord("MTax/CalculateTax",k);e.setValue("TaxAmt",ft)}kt?e.setValue("LineTotalAmt",t.getValueOfDecimal(w)):e.setValue("LineTotalAmt",t.getValueOfDecimal(w)+ft)}catch(ni){this.setCalloutActive(!1);this.log.severe(ni.toString())}return this.setCalloutActive(!1),r=f=e=o=s=h=null,""};r.prototype.IsTaxIncluded=function(t,i){var r=i.getContext("IsTaxIncluded"),u;try{if(r.toString().length==0){if(u=i.getContextAsInt(t,"M_PriceList_ID"),u==0)return!1;r=n.DB.executeScalar("SELECT IsTaxIncluded FROM M_PriceList WHERE M_PriceList_ID="+u,null,null).toString();r==null&&(r="N");i.setContext(t,"IsTaxIncluded",r)}}catch(f){this.setCalloutActive(!1);this.log.severe(f.toString())}return i=t=mTab=mField=value=oldValue=null,"Y"==r};r.prototype.Qty=function(r,f,e,o,s,h){var p,w,l,c,nt,b,it,ot,k,rt,ut,ft,et,v,d,a,y;if(s==null||s.toString()==""||this.isCalloutActive()||s==null)return"";this.setCalloutActive(!0);try{if(p="",w=r.getContextAsInt(f,"M_Product_ID"),this.log.log(u.WARNING,"qty - init - M_Product_ID="+w),w==0)c=e.getValue("QtyEntered"),e.setValue("QtyInvoiced",c);else if(o.getColumnName().toString().equals("C_UOM_ID")||o.getColumnName().toString().equals("M_AttributeSetInstance_ID"))a=t.getValueOfInt(e.getValue("C_UOM_ID")),c=e.getValue("QtyEntered"),it=r.getContextAsInt(f,"C_BPartner_ID",!1),ot=n.dataContext.getJSONRecord("MBPartner/GetBPartner",it.toString()),p=w.toString().concat(",",e.getValue("C_Invoice_ID").toString()+","+t.getValueOfString(e.getValue("M_AttributeSetInstance_ID"))+","+a.toString()+","+r.getAD_Client_ID().toString()+","+it.toString()+","+c.toString()),k=n.dataContext.getJSONRecord("MInvoice/GetPrices",p),k!=null&&(i=k.countEd011,rt=k.countVAPRC,i<=0&&rt<=0?(v=null,c!=null&&(p=a.toString(),d=n.dataContext.getJSONRecord("MUOM/GetPrecision",p),v=c.toFixed(d)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+a+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),p=w.toString().concat(",",a.toString(),",",c.toString()),l=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",p),l==null&&(l=c),y=c!=l,nt=e.getValue("PriceActual"),p=w.toString().concat(",",a.toString(),",",nt.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",p),b==null&&(b=nt),this.log.fine("qty - UOM="+a+", QtyEntered/PriceActual="+c+"/"+nt+" -> "+y+" QtyInvoiced/PriceEntered="+l+"/"+b),r.setContext(f,"UOMConversion",y?"Y":"N"),e.setValue("QtyInvoiced",l),e.setValue("PriceEntered",b)):(ut=k.PriceList,e.setValue("PriceList",ut),b=k.PriceEntered,e.setValue("PriceLimit",k.PriceLimit),e.setValue("PriceActual",b),e.setValue("PriceEntered",b),p=a.toString().concat(","),ft=n.dataContext.getJSONRecord("MUOM/GetPrecision",p),v=c.toFixed(t.getValueOfInt(ft)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+a+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),p=w.toString().concat(",",a.toString(),",",c.toString()),et=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",p),l=et,y=!1,l!=null&&(y=c!=l),l==null&&(y=!1,l=1),y?e.setValue("QtyInvoiced",l):e.setValue("QtyInvoiced",l*v)));else if(o.getColumnName().equals("QtyEntered"))a=r.getContextAsInt(f,"C_UOM_ID"),c=s,v=null,c!=null&&(d=n.dataContext.getJSONRecord("MUOM/GetPrecision",a.toString()),v=c.toFixed(d)),c!=v&&(this.log.fine("Corrected QtyEntered Scale UOM="+a+"; QtyEntered="+c+"->"+v),c=v,e.setValue("QtyEntered",c)),g=w.toString().concat(",",a.toString(),",",c.toString()),l=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",g),l==null&&(l=c),y=c!=l,this.log.fine("qty - UOM="+a+", QtyEntered="+c+" -> "+y+" QtyInvoiced="+l),r.setContext(f,"UOMConversion",y?"Y":"N"),e.setValue("QtyInvoiced",l);else if(o.getColumnName().equals("QtyInvoiced")){a=r.getContextAsInt(f,"C_UOM_ID");l=s;var g=w.toString(),d=n.dataContext.getJSONRecord("MProduct/GetUOMPrecision",g),tt=null;l!=null&&(tt=l.toFixed(d));l!=tt&&(this.log.fine("Corrected QtyInvoiced Scale "+l+"->"+tt),l=tt,e.setValue("QtyInvoiced",l));g=w.toString().concat(",",a.toString(),",",l.toString());c=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",g);c==null&&(c=l);y=l!=c;this.log.fine("qty - UOM="+a+", QtyInvoiced="+l+" -> "+y+" QtyEntered="+c);r.setContext(f,"UOMConversion",y?"Y":"N");e.setValue("QtyEntered",c)}}catch(st){this.setCalloutActive(!1);this.log.severe(st.toString())}finally{this.setCalloutActive(!1)}return r=f=e=o=s=h=null,""};r.prototype.PriceList=function(i,r,f,e,o,s){var l="",h=null,c,a,v;try{if(o==null||o.toString()==""||(c=t.getValueOfInt(o.toString()),c==null||c==0))return"";l="SELECT pl.IsTaxIncluded,pl.EnforcePriceLimit,pl.C_Currency_ID,c.StdPrecision,plv.M_PriceList_Version_ID,plv.ValidFrom FROM M_PriceList pl,C_Currency c,M_PriceList_Version plv WHERE pl.C_Currency_ID=c.C_Currency_ID AND pl.M_PriceList_ID=plv.M_PriceList_ID AND pl.M_PriceList_ID="+c+"ORDER BY plv.ValidFrom DESC";h=n.DB.executeReader(l);h.read()&&(f.setValue("IsTaxIncluded",Boolean("Y".equals(h.get("istaxincluded")))),i.setContext(r,"EnforcePriceLimit",h.get("enforcepricelimit")),a=t.getValueOfInt(h.get("c_currency_id")),f.setValue("C_Currency_ID",a),v=t.getValueOfInt(h.get("m_pricelist_version_id")),i.setContext(r,"M_PriceList_Version_ID",v));h.close()}catch(y){return this.setCalloutActive(!1),h!=null&&h.close(),this.log.log(u.severe,l,y),y.message}return i=r=f=e=o=s=null,""};n.Model.CalloutInvoice=r}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutInvoiceBatch")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.Date=function(n,t,i,r,u,f){return u==null||u.toString()==""?"":(i.setValue("DateAcct",u),this.SetDocumentNo(n,t,i),n=t=i=r=u=f=null,"")};i.prototype.BPartner=function(i,u,f,e,o,s){var l,c,p,a,w,v,b,g,nt;if(o==null||o.toString()==""||(l=t.getValueOfInt(o),l==null||l==0))return"";var k="SELECT p.AD_Language,p.C_PaymentTerm_ID, COALESCE(p.M_PriceList_ID,g.M_PriceList_ID) AS M_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted, p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable, l.C_BPartner_Location_ID,c.AD_User_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID FROM C_BPartner p INNER JOIN C_BP_Group g ON (p.C_BP_Group_ID=g.C_BP_Group_ID) LEFT OUTER JOIN C_BPartner_Location l ON (p.C_BPartner_ID=l.C_BPartner_ID AND l.IsBillTo='Y' AND l.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID=@Param1 AND p.IsActive='Y'",y=i.isSOTrx(),d=[],h=null;try{d[0]=new n.DB.SqlParam("@Param1",l);h=n.DB.executeReader(k,d,null);h.read()&&(c=t.getValueOfString(h.get(y?"paymentrule":"paymentrulepo")),c!=null&&c.length!=0&&(i.getContext("DocBaseType").endsWith("C")?c="P":(this.isSOTrx&&c=="S"||c=="U")&&(c="P")),p=t.getValueOfInt(h.get(y?"c_paymentterm_id":"po_paymentterm_id")),p>0&&f.setValue("C_PaymentTerm_ID",p),a=t.getValueOfInt(h.get("c_bpartner_location_id")),l.toString().equals(i.getContext("C_BPartner_ID"))&&(w=i.getContext("C_BPartner_Location_ID"),w.toString().length>0&&(a=t.getValueOfInt(w))),a==0?f.setValue("C_BPartner_Location_ID",null):f.setValue("C_BPartner_Location_ID",t.getValueOfInt(a)),v=t.getValueOfInt(h.get("ad_user_id")),l.toString().equals(i.getContext("C_BPartner_ID"))&&(b=i.getContext("AD_User_ID"),b.toString().length>0&&(v=t.getValueOfInt(b))),v==0?f.setValue("AD_User_ID",null):f.setValue("AD_User_ID",t.getValueOfInt(v)),y&&(g=t.getValueOfDouble(h.get("so_creditlimit")),g!=0&&(nt=t.getValueOfDouble(h.get("creditavailable")),h==null&&nt<0&&n.ADialog.info("CreditLimitOver"))));h.close()}catch(tt){return this.setCalloutActive(!1),h!=null&&h.close(),this.log.log(r.severe,k,tt),tt.message}return this.SetDocumentNo(i,u,f),s=null,this.Tax(i,u,f,e,o)};i.prototype.DocType=function(n,t,i,r,u,f){return this.SetDocumentNo(n,t,i),n=t=i=r=u=f=null,""};i.prototype.SetDocumentNo=function(i,r,u,f,e,o){var w=i.getContextAsInt(r,"C_InvoiceBatch_ID"),b="SELECT COALESCE(MAX(C_InvoiceBatchLine_ID),0) FROM C_InvoiceBatchLine WHERE C_InvoiceBatch_ID="+w,l=n.DB.executeScalar(b),a,s,v,y,c,h,p;l!=0&&(a=l.toString(),s=null,s=n.dataContext.getJSONRecord("MInvoiceBatchLine/GetInvoiceBatchLine",a),v=i.getContextAsInt(r,"C_DocType_ID"),y=i.getContextAsInt(r,"C_BPartner_ID"),v!=s.C_DocType_ID||y!=s.C_BPartner_ID)&&(c=s.DocumentNo,c!=null)&&(h=0,h=t.getValueOfInt(c),h!=0)&&(p=t.getValueOfString(h+1),u.setValue("DocumentNo",p),i=r=u=f=e=o=null)};i.prototype.Charge=function(i,u,f,e,o,s){var c;if(o==null||o.toString()==""||(c=t.getValueOfInt(o),c==null||t.getValueOfInt(c)==0))return"";var l="SELECT ChargeAmt FROM C_Charge WHERE C_Charge_ID=@Param1",a=[],h=null;try{a[0]=new n.DB.SqlParam("@Param1",c);h=n.DB.executeReader(l,a,null);h.read()&&f.setValue("PriceEntered",t.getValueOfDecimal(h.get(0)));h.close()}catch(v){return this.setCalloutActive(!1),h!=null&&h.close(),this.log.log(r.severe,l,v),v.message}return s=null,this.Tax(i,u,f,e,o)};i.prototype.Tax=function(i,r,u,f,e){var p=f.getColumnName(),o,s,h,c,l,a,y,v;return e==null||e.toString()==""?"":(o=0,o=p.equals("C_Charge_ID")?t.getValueOfInt(e):i.getContextAsInt(r,"C_Charge_ID"),this.log.fine("C_Charge_ID="+o),o==0)?this.Amt(i,r,u,f,e):(s=i.getContextAsInt(r,"C_BPartner_Location_ID"),s==0)?this.Amt(i,r,u,f,e):(this.log.fine("BP_Location="+s),h=t.getValueOfDate(i.getContext("DateInvoiced")),this.log.fine("Bill Date="+h),c=h,this.log.fine("Ship Date="+c),l=i.getContextAsInt(r,"AD_Org_ID"),this.log.fine("Org="+l),a=i.getContextAsInt("#M_Warehouse_ID"),this.log.fine("Warehouse="+a),y=o.toString().concat(",",h.toString(),c.toString(),",",l.toString(),",",a.toString(),",",s.toString(),",",s.toString(),",",i.getWindowContext(r,"IsSOTrx",!0).equals("Y")),v=n.dataContext.getJSONRecord("MTax/Get",y),v==0||u.setValue("C_Tax_ID",t.getValueOfInt(v)),this.Amt(i,r,u,f,e))};i.prototype.Amt=function(i,r,u,f,e,o){var s,v,h,y;if(this.isCalloutActive()||e==null||e.toString()=="")return"";this.setCalloutActive(!0);var a=i.getStdPrecision(),c=t.getValueOfDecimal(u.getValue("QtyEntered")),l=t.getValueOfDecimal(u.getValue("PriceEntered"));if(this.log.fine("QtyEntered="+c+", PriceEntered="+l),c==null&&(c=n.Env.ZERO),l==null&&(l=n.Env.ZERO),s=c*l,t.scale(s)>a&&(s=s.toFixed(a)),v="Y"==i.getContext("IsTaxIncluded"),h=null,f.getColumnName().equals("TaxAmt"))h=u.getValue("TaxAmt");else if(y=u.getValue("C_Tax_ID"),y!=null){var p=t.getValueOfInt(y),w=p.toString().concat(",",s.toString(),",",v.toString(),",",a.toString());h=n.dataContext.getJSONRecord("MTax/CalculateTax",w);u.setValue("TaxAmt",h)}return v?(u.setValue("LineTotalAmt",s),u.setValue("LineNetAmt",t.getValueOfDecimal(s)*t.getValueOfDecimal(h))):(u.setValue("LineNetAmt",s),u.setValue("LineTotalAmt",t.getValueOfDecimal(s)+t.getValueOfDecimal(h))),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutInvoiceBatch=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutMovement")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.Product=function(i,u,f,e,o,s){var h,c,l,a,y,p,v;if(o==null||o.toString()=="")return t.getValueOfInt(n.DB.executeScalar("SELECT COUNT(*) FROM AD_column WHERE ad_table_id =  (SELECT ad_table_id   FROM ad_table   WHERE upper(tablename) = upper('M_MovementLine')) and upper(columnname) = 'C_UOM_ID'",null,null))>0&&(f.setValue("MovementQty",1),f.setValue("QtyEntered",1)),"";this.setCalloutActive(!0);try{if(h=o,h==null||h==0)return"";f.setValue("M_AttributeSetInstance_ID",null);c="SELECT COUNT(*) FROM AD_column WHERE ad_table_id =  (SELECT ad_table_id   FROM ad_table   WHERE upper(tablename) = upper('M_MovementLine')) and upper(columnname) = 'C_UOM_ID'";t.getValueOfInt(n.DB.executeScalar(c,null,null))>0&&(c="select c_uom_id from m_product where m_product_id="+h,l=t.getValueOfInt(n.DB.executeScalar(c,null,null)),f.setValue("C_UOM_ID",l),o!=s&&(f.setValue("MovementQty",1),f.setValue("QtyEntered",1)),l=t.getValueOfDecimal(f.getValue("C_UOM_ID")),a=t.getValueOfDecimal(f.getValue("QtyEntered")),h=t.getValueOfInt(f.getValue("M_Product_ID")),y=h.toString().concat(",").concat(l.toString()).concat(",").concat(a.toString()),p=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",y),QtyOrdered=p,v=!1,QtyOrdered!=null&&(v=a!=QtyOrdered),QtyOrdered==null&&(v=!1,QtyOrdered=1),v?f.setValue("MovementQty",QtyOrdered):f.setValue("MovementQty",QtyOrdered*a))}catch(w){return this.setCalloutActive(!1),this.log.log(r.severe,c,w),w.message}return this.setCalloutActive(!1),i=u=f=e=o=s=null,""};n.Model.CalloutMovement=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutGLJournal")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.Period=function(i,u,f,o,s,h){var y,w,a,v;if(this.isCalloutActive()||s==null||s.toString()=="")return"";if(y=o.getColumnName(),this.setCalloutActive(!0),w=i.getContextAsInt(u,"AD_Client_ID",!1),a=new Date,a=y=="DateAcct"?s:f.getValue("DateAcct"),v=0,y=="C_Period_ID"&&(v=t.getValueOfInt(s)),y=="DateDoc")f.setValue("DateAcct",s);else if(y=="DateAcct"){var p="SELECT C_Period_ID FROM C_Period WHERE C_Year_ID IN \t(SELECT C_Year_ID FROM C_Year WHERE C_Calendar_ID =  (SELECT C_Calendar_ID FROM AD_ClientInfo WHERE AD_Client_ID=@param1)) AND @param2 BETWEEN StartDate AND EndDate AND PeriodType='S'",l=[],c=null;try{l[0]=new n.DB.SqlParam("@param1",w);l[1]=new n.DB.SqlParam("@param2",a);l[1].setIsDate(!0);c=n.DB.executeReader(p,l,null);c.read()&&(v=t.getValueOfInt(c.get(0)));c.close()}catch(k){return c!=null&&c.close(),this.log.log(r.SEVERE,p,e),this.setCalloutActive(!1),k.message}v!=0&&f.setValue("C_Period_ID",t.getValueOfInt(v))}else{var p="SELECT PeriodType, StartDate, EndDate FROM C_Period WHERE C_Period_ID=@param",l=[],c=null;try{if(l[0]=new n.DB.SqlParam("@param",v),c=n.DB.executeReader(p,l,null),c.read()){var d=c.get("periodtype"),g=c.get("startdate"),b=c.get("enddate");d=="S"&&(a==null||a<g||a>b)&&f.setValue("DateAcct",b)}c.close()}catch(k){return c!=null&&c.close(),this.log.log(r.SEVERE,p,e),this.setCalloutActive(!1),e.message}}return this.setCalloutActive(!1),i=u=f=o=s=h=null,""};i.prototype.Rate=function(i,u,f,o,s,h){var a;if(s==null||s.toString()=="")return"";try{var v=t.getValueOfInt(f.getValue("C_Currency_ID")),y=t.getValueOfInt(v),p=t.getValueOfInt(f.getValue("C_ConversionType_ID")),w=t.getValueOfInt(p),l=f.getValue("DateAcct");l==null&&(a=new Date,l=a.toGMTString());var b=t.getValueOfInt(i.getContextAsInt(u,"C_AcctSchema_ID",!1)),k=b,d=n.dataContext.getJSONRecord("MAcctSchema/GetAcctSchema",k),g=t.getValueOfInt(i.getContextAsInt(u,"AD_Client_ID",!1)),nt=t.getValueOfInt(i.getContextAsInt(u,"AD_Org_ID",!1)),tt=y+","+d.C_Currency_ID+","+l+","+w+","+g+","+nt,c=n.dataContext.getJSONRecord("MConversionRate/GetRate",tt);this.log.fine("rate = "+c);c==null&&(c=0);f.setValue("CurrencyRate",c)}catch(it){return this.log.log(r.SEVERE,sql,e),this.setCalloutActive(!1),e.message}return i=u=f=o=s=h=null,""};i.prototype.Amt=function(i,r,u,f,e,o){var h,c,l,a;if(e==null||e.toString()==""||this.isCalloutActive())return"";this.setCalloutActive(!0);var y=t.getValueOfInt(i.getContextAsInt(r,"C_AcctSchema_ID")),p=y.toString(),w=n.dataContext.getJSONRecord("MAcctSchema/GetAcctSchema",p),v=w.StdPrecision,s=u.getValue("CurrencyRate");return s==null&&(s=1,u.setValue("CurrencyRate",s)),h=u.getValue("AmtSourceDr"),h==null&&(h=0),c=u.getValue("AmtSourceCr"),c==null&&(c=0),l=h*s,l.toFixed(v),u.setValue("AmtAcctDr",l),a=c*s,a.toFixed(v),u.setValue("AmtAcctCr",a),this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutGLJournal=i}(VIS,jQuery),function(n){function t(){n.CalloutEngine.call(this,"VIS.CalloutProduction")}var i=n.Logging.Level,r=n.Utility.Util;n.Utility.inheritPrototype(t,n.CalloutEngine);t.prototype.Product=function(n,t,i,r,u,f){if(u==null||u.toString()=="")return"";var e=u;return e==null||e==0?"":(i.setValue("M_AttributeSetInstance_ID",null),n=t=i=r=u=f=null,"")};t.prototype.SetAttributeSetInstance=function(t,i,r,u,f,e){if(f==null||f.toString()==""||this.isCalloutActive())return"";this.setCalloutActive(!0);try{var o=f.toString(),s=n.dataContext.getJSONRecord("MProductionLine/GetAttributeSetInstance",o);r.setValue("M_AttributeSetInstance_ID",s)}catch(h){this.setCalloutActive(!1);this.log.severe(h.toString())}return this.setCalloutActive(!1),t=i=r=u=f=e=null,""};t.prototype.SetBOM=function(t,i,r,u,f,e){var o,s;if(f==null||f.toString()==""||this.isCalloutActive())return"";this.setCalloutActive(!0);try{u.getColumnName().equals("M_Product_ID")?(r.setValue("M_AttributeSetInstance_ID",0),o=f.toString().concat(",",0)):u.getColumnName().equals("M_AttributeSetInstance_ID")&&(o=r.getValue("M_Product_ID").toString().concat(",",f.toString()));s=n.dataContext.getJSONRecord("MProductionLine/GetBOM",o);r.setValue("M_BOM_ID",s)}catch(h){this.setCalloutActive(!1);this.log.severe(h.toString())}return this.setCalloutActive(!1),t=i=r=u=f=e=null,""};n.Model.CalloutProduction=t}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutRequest")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.CopyMail=function(i,u,f,e,o,s){var v=e.getColumnName(),c;if(this.log.info(v+"="+o),o==null||o.toString()=="")return"";var y=t.getValueOfInt(o),l="SELECT MailHeader, MailText FROM R_MailText WHERE R_MailText_ID=@Param1",a=[],h=null;try{a[0]=new n.DB.SqlParam("@Param1",t.getValueOfInt(y));h=n.DB.executeReader(l,a,null);h.read()&&(c=h.get("mailtext"),c=n.Env.parseContext(i,u,c,!1,!0),f.setValue("Result",c));h.close()}catch(p){this.setCalloutActive(!1);h!=null&&h.close();this.log.log(r.SEVERE,l,p)}return i=u=f=e=o=s=null,""};i.prototype.CopyResponse=function(i,u,f,e,o,s){var v=e.getColumnName(),c;if(this.log.info(v+"="+o),o==null||o.toString()=="")return"";var y=t.getValueOfInt(o),l="SELECT Name, ResponseText FROM R_StandardResponse WHERE R_StandardResponse_ID=@Param1",a=[],h=null;try{a[0]=new n.DB.SqlParam("@Param1",t.getValueOfInt(y));h=n.DB.executeReader(l,a,null);h.read()&&(c=h.get("responsetext"),c=n.Env.parseContext(i,u,c,!1,!0),f.setValue("Result",c));h.close()}catch(p){this.setCalloutActive(!1);h!=null&&h.close();this.log.log(r.SEVERE,l,p)}return i=u=f=e=o=s=null,""};i.prototype.Type=function(i,r,u,f,e,o){var l=f.getColumnName(),s,c,h;return(this.log.info(l+"="+e),u.setValue("R_Status_ID",null),e==null||e.toString()=="")?"":(s=t.getValueOfInt(e),s==0)?"":(c=s.toString(),h=n.dataContext.getJSONRecord("MRequestType/GetDefaultR_Status_ID",c),h!=0&&u.setValue("R_Status_ID",t.getValueOfInt(h)),i=r=u=f=e=o=null,"")};n.Model.CalloutRequest=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutRequisition")}var u=n.Logging.Level,t=n.Utility.Util,r=!1;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.Product=function(i,r,u,f,e,o){var s,h,c,l;try{if(e==null||e.toString()==""||(s=e,s==null||s==0))return"";u.setValue("M_AttributeSetInstance_ID",null);var a=i.getContextAsInt(r,"C_BPartner_ID"),v=u.getValue("Qty"),y=!1,p=i.getContextAsInt(r,"M_PriceList_ID"),w=i.getContextAsInt(r,"M_PriceList_Version_ID"),b=u.getValue("DateRequired"),c="SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'",k=t.getValueOfInt(n.DB.executeScalar(c)),d,g=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",s);d=k>0?s.toString().concat(",",a,",",v,",",y,",",p,",",w,",",b,",",null,",",g,",",k):s.toString().concat(",",a,",",v,",",y,",",p,",",w,",",b,",",null);h=null;h=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",d);u.setValue("PriceActual",h.PriceActual);i.setContext(r,"EnforcePriceLimit",h.EnforcePriceLimit?"Y":"N");i.setContext(r,"DiscountSchema",h.DiscountSchema?"Y":"N");u.setValue("C_UOM_ID",g);c="SELECT C_OrderLine_ID FROM C_OrderLine WHERE C_Order_ID = (SELECT C_Order_ID  FROM C_Order  WHERE DocumentNo= (SELECT DocumentNo FROM M_Requisition WHERE M_Requisition.M_Requisition_id = "+u.getValue("M_Requisition_id")+") AND AD_Client_ID ="+i.getAD_Client_ID()+") AND M_Product_ID="+e;l=t.getValueOfInt(n.DB.executeScalar(c));l>0&&u.setValue("C_OrderLine_ID",l)}catch(nt){return this.setCalloutActive(!1),nt.message}return i=r=u=f=e=o=null,""};i.prototype.Amt=function(i,r,u,f,e,o){var s;if(e==null||e.toString()==""||this.isCalloutActive()||e==null)return"";try{if(this.setCalloutActive(!0),f.getColumnName()=="Qty"&&"Y"==i.getContext("DiscountSchema")){var v=i.getContextAsInt(r,"M_Product_ID"),y=i.getContextAsInt(r,"C_BPartner_ID"),p=e,w=i.getContextAsInt(r,"M_PriceList_ID"),b=i.getContextAsInt(r,"M_PriceList_Version_ID"),k=u.getValue("DateInvoiced"),d=v.concat(",",y,",",p,",",!1,",",w,",",b,",",k,",",null),c=null;c=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",d);u.setValue("PriceActual",c.PriceActual)}var h=i.getStdPrecision(),l=u.getValue("QtyEntered"),a=u.getValue("PriceActual");this.log.fine("amt - Qty="+l+", Price="+a+", Precision="+h);s=l*a;t.scale(s)>h&&(s=s.toFixed(h));u.setValue("LineNetAmt",s);this.log.info("amt - LineNetAmt="+s)}catch(g){this.setCalloutActive(!1);this.log.saveError("CalloutRequisation",g)}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.Qty=function(i,u,f,e,o,s){var a="",p,h,c,v,g,w,tt,l,nt,y,b,k,it,d;if(this.isCalloutActive()||o==null||o.toString()==""||(console.log("Before Charge Or Product"),t.getValueOfInt(f.getValue("M_Product_ID"))==0))return"";console.log("After Charge Or Product");this.setCalloutActive(!0);try{if(p=i.getContextAsInt(u,"M_Product_ID"),r&&this.log.Warning("init - M_Product_ID="+p+" - "),h=n.Env.ZERO,c=n.Env.ZERO,p==0)h=t.getValueOfDecimal(f.getValue("QtyEntered")),c=h,f.setValue("Qty",c);else if(e.getColumnName()=="C_UOM_ID"){l=t.getValueOfInt(o);h=t.getValueOfDecimal(f.getValue("QtyEntered"));w=n.dataContext.getJSONRecord("ModulePrefix/GetModulePrefix","VA009_");tt=0;w!=null&&(tt=w.VA009_?1:0);var rt=i.getContextAsInt(u,"C_BPartner_ID"),ut=i.getContextAsInt(u,"M_AttributeSetInstance_ID"),ft=i.getContextAsInt(u,"M_PriceList_ID"),et=i.getContextAsInt(u,"M_PriceList_Version_ID"),ot=i.getContext(u,"DateDoc");a=p.toString().concat(",",rt,",",h,",",!1,",",ft,",",et,",",ot,",",null,",",ut.toString(),",",l,",",tt);w=null;w=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",a);w!=null&&(v=w.PriceActual);a=l.toString().concat(",");nt=n.dataContext.getJSONRecord("MUOM/GetPrecision",a);y=h.toFixed(t.getValueOfInt(nt));h!=y&&(this.log.fine("Corrected QtyEntered Scale UOM="+l+"; QtyEntered="+h+"->"+y),h=y,f.setValue("QtyEntered",h));a=p.toString().concat(",",l.toString(),",",h.toString());b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a);c=b;c==null&&(c=h);k=h!=c;v==0?(v=t.getValueOfDecimal(f.getValue("PriceActual")),a=p.toString().concat(",",l.toString(),",",v.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),g=b,g==null&&(g=v),this.log.fine("UOM="+l+", QtyEntered/PriceActual="+h+"/"+v+" -> "+k+" QtyRequired/PriceEntered="+c+"/"+g),i.setContext(u,"UOMConversion",k?"Y":"N"),f.setValue("PriceActual",g)):f.setValue("PriceActual",v);f.setValue("Qty",c)}else e.getColumnName()=="QtyEntered"&&(l=i.getContextAsInt(u,"C_UOM_ID"),h=t.getValueOfDecimal(o),a=l.toString().concat(","),nt=n.dataContext.getJSONRecord("MUOM/GetPrecision",a),y=h.toFixed(t.getValueOfInt(nt)),h!=y&&(this.log.fine("Corrected QtyEntered Scale UOM="+l+"; QtyEntered="+h+"->"+y),h=y,f.setValue("QtyEntered",h)),a=p.toString().concat(",",l.toString(),",",h.toString()),b=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",a),c=b,c==null&&(c=h),k=h!=c,this.log.fine("UOM="+l+", QtyEntered="+h+" -> "+k+" Qty="+c),i.setContext(u,"UOMConversion",k?"Y":"N"),f.setValue("Qty",c));v=t.getValueOfDecimal(f.getValue("PriceActual"));it=i.getStdPrecision();d=h*v;t.scale(d)>it&&(d=d.toFixed(it));f.setValue("LineNetAmt",d);this.log.info("amt - LineNetAmt="+d)}catch(st){return this.setCalloutActive(!1),st}return this.setCalloutActive(!1),i=u=f=e=o=s=null,""};n.Model.CalloutRequisition=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutPaySelection")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.PayAmt=function(n,i,r,u,f,e){var o,h,s;if(this.isCalloutActive()||f==null||f==""||(o=t.getValueOfInt(r.getValue("C_Invoice_ID")),o==null)||(h=o,h==0))return"";var c=t.getValueOfDecimal(r.getValue("OpenAmt")),l=t.getValueOfDecimal(r.getValue("PayAmt")),a=t.getValueOfDecimal(r.getValue("DiscountAmt"));return this.setCalloutActive(!0),s=c-l-a,this.log.fine(" - OpenAmt="+c+" - PayAmt="+l+", Discount="+a+", Difference="+s),r.setValue("DifferenceAmt",s),this.setCalloutActive(!1),n=i=r=u=f=e=null,""};i.prototype.Invoice=function(i,u,f,e,o,s){var c,a,p;if(this.isCalloutActive()||o==null||o==""||(c=t.getValueOfInt(o),c==0))return"";a=i.getContextAsInt(u,"C_BankAccount_ID");p=i.getContext("PayDate");this.setCalloutActive(!0);var l=n.Env.ZERO,v=n.Env.ZERO,w="SELECT currencyConvert(invoiceOpen(i.C_Invoice_ID, 0), i.C_Currency_ID,ba.C_Currency_ID, i.DateInvoiced, i.C_ConversionType_ID, i.AD_Client_ID, i.AD_Org_ID) as OpenAmt, paymentTermDiscount(i.GrandTotal,i.C_Currency_ID,i.C_PaymentTerm_ID,i.DateInvoiced,'"+p+"') As DiscountAmt, i.IsSOTrx FROM C_Invoice_v i, C_BankAccount ba WHERE i.C_Invoice_ID=@Param2 AND ba.C_BankAccount_ID=@Param3",y=[],h=null;try{y[0]=new n.DB.SqlParam("@Param2",c);y[1]=new n.DB.SqlParam("@Param3",a);h=n.DB.executeReader(w,y,null);h.read()&&(l=h.get("openamt"),v=h.get("discountamt"),IsSOTrx="Y"==h.get("issotrx"));h.close()}catch(b){this.setCalloutActive(!1);h!=null&&h.close();this.log.log(r.SEVERE,w,b)}return this.log.fine(" - OpenAmt="+l+" (Invoice="+c+",BankAcct="+a+")"),f.setValue("OpenAmt",l),f.setValue("PayAmt",l-v),f.setValue("DiscountAmt",v),f.setValue("DifferenceAmt",n.Env.ZERO),f.setValue("IsSOTrx","N"),this.setCalloutActive(!1),i=u=f=e=o=s=null,""};n.Model.CalloutPaySelection=i}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutOrderLine")}function r(){n.CalloutEngine.call(this,"VIS.CalloutOrderlineRecording")}var u=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.EndDate=function(i,r,u,f,e,o){if(e==null||e.toString()=="")return"";var h=new Date(u.getValue("StartDate")),c=t.getValueOfInt(u.getValue("C_Frequency_ID")),l="Select NoOfMonths from C_Frequency where C_Frequency_ID="+c,v=t.getValueOfInt(n.DB.executeScalar(l,null,null)),a=t.getValueOfInt(u.getValue("NoofCycle")),s=h.getDate()+"/"+(h.getMonth()+months*a)+"/"+h.getFullYear();return s=s<=0?new Date:new Date(s),s=s.toISOString(),u.setValue("EndDate",s),i=r=u=f=e=o=null,""};i.prototype.Qty=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var s=t.getValueOfDecimal(f),h=t.getValueOfDecimal(r.getValue("QtyPerCycle")),o=s*h;return r.setValue("QtyEntered",o),r.setValue("QtyOrdered",o),n=i=r=u=f=e=null,""};i.prototype.QtyPerCycle=function(n,i,r,u,f,e){if(f==null||f.toString()=="")return"";var s=t.getValueOfDecimal(f),h=t.getValueOfDecimal(r.getValue("NoofCycle")),o=h*s;return r.setValue("QtyEntered",o),r.setValue("QtyOrdered",o),n=i=r=u=f=e=null,""};n.Model.CalloutOrderLine=i;n.Utility.inheritPrototype(r,n.CalloutEngine);r.prototype.Orderline=function(i,r,u,f,e,o){if(e==null||e.toString()==""||t.getValueOfInt(e)==0||this.isCalloutActive())return"";try{this.setCalloutActive(!0);var h=t.getValueOfInt(e),s=n.dataContext.getJSONRecord("MOrderLine/GetOrderLine",h);u.setValue("M_Product_ID",s.M_Product_ID);u.setValue("Qty",s.Qty);u.setValue("C_UOM_ID",s.C_UOM_ID);u.setValue("C_BPartner_ID",s.C_BPartner_ID);u.setValue("PlannedHours",s.PlannedHours);this.setCalloutActive(!1)}catch(c){this.setCalloutActive(!1)}return i=r=u=f=e=o=null,""};n.Model.CalloutOrderlineRecording=r}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutContract")}function o(){n.CalloutEngine.call(this,"VIS.CalloutContractProduct")}function s(){n.CalloutEngine.call(this,"VIS.CalloutContractQty")}function r(){n.CalloutEngine.call(this,"VIS.CalloutOrderContract")}function h(){n.CalloutEngine.call(this,"VIS.CalloutSetContract")}var c=n.Logging.Level,t=n.Utility.Util,f=!1,u=0;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.InvoiceCount=function(i,r,u,f,e,o){if(e==null||e.toString()==""||t.getValueOfInt(e)==0)return"";var s=t.getValueOfDateTime(u.getValue("StartDate")),h=u.getValue("EndDate"),c=t.getValueOfInt(u.getValue("C_Frequency_ID")),l="Select NoOfDays from C_Frequency where C_Frequency_ID="+c,a=t.getValueOfInt(n.DB.executeScalar(l,null,null)),v=(h-s).Days,y=v/a;return u.setValue("TotalInvoice",y),i=r=u=f=e=o=null,""};i.prototype.EndDate=function(i,r,u,f,e,o){var h=new Date(u.getValue("StartDate")),c=new Date(u.getValue("StartDate")),l=n.dataContext.getJSONRecord("MOrderLine/GetNoOfMonths",t.getValueOfString(u.getValue("C_Frequency_ID"))),a=t.getValueOfInt(u.getValue("TotalInvoice")),s=h.setMonth(h.getMonth()+l*a);return s=new Date(h.setDate(h.getDate()-1)),u.setValue("EndDate",s),s=new Date(s),s=s.toISOString(),h=c.toISOString(),s<h&&u.setValue("EndDate",c),i=r=u=f=e=o=null,""};i.prototype.BillStartDate=function(t,i,r,u,f,e){if(f==null||f.toString()=="")return"";var o=new Date(r.getValue("StartDate")),s=new Date(r.getValue("BillStartDate"));return s.toISOString()<o.toISOString()&&(n.ADialog.info("StartDateShouldBeLessThanBillStartDate"),r.setValue("BillStartDate",r.getValue("StartDate"))),t=i=r=u=f=e=null,""};i.prototype.StartDate=function(i,r,u,f,e,o){if(e==null||e.toString()=="")return"";var h=new Date(u.getValue("StartDate")),c=t.getValueOfInt(u.getValue("C_Frequency_ID")),l="Select NoOfDays from C_Frequency where C_Frequency_ID="+c,a=t.getValueOfInt(n.DB.executeScalar(l,null,null)),v=t.getValueOfInt(u.getValue("TotalInvoice")),y=v*a,s=new Date(h.setDate(h.getDay()+t.getValueOfDouble(y)));return s=s.toISOString(),u.setValue("EndDate",s),i=r=u=f=e=o=null,""};i.prototype.StartDateChange=function(i,r,u,f,e,o){if(e==null||e.toString()=="")return"";var c=t.getValueOfInt(u.getValue("C_Frequency_ID")),l="Select NoOfMonths from C_Frequency where C_Frequency_ID="+c,a=t.getValueOfInt(n.DB.executeScalar(l,null,null)),v=t.getValueOfInt(u.getValue("TotalInvoice")),s=new Date(e),y=new Date(e),h=s.setMonth(s.getMonth()+a*v);return h=new Date(s.setDate(s.getDate()-1)),u.setValue("EndDate",h.toISOString()),h=h.toISOString(),s=y.toISOString(),h<s&&u.setValue("EndDate",s),u.setValue("BillStartDate",u.getValue("StartDate")),i=r=u=f=e=o=null,""};n.Model.CalloutContract=i;n.Utility.inheritPrototype(o,n.CalloutEngine);o.prototype.ContractProduct=function(n,i,r,u,f,e){if(f==null||f.toString()==""||t.getValueOfInt(f)==0)return"";var o=t.getValueOfInt(r.getValue("M_Proudct_ID"));return o!=0&&t.getValueOfBoolean(f)&&(r.setValue("PriceList",0),r.setValue("PriceLimit",0),r.setValue("PriceActual",0),r.setValue("PriceEntered",0)),n=i=r=u=f=e=null,""};n.Model.CalloutContractProduct=o;n.Utility.inheritPrototype(s,n.CalloutEngine);s.prototype.Qty=function(i,r,u,f,e,o){var v,y;if(this.isCalloutActive()||e==null||e.toString()=="")return"";var h=t.getValueOfDecimal(u.getValue("PriceActual")),c=t.getValueOfDecimal(e),l=0,a=n.Env.ZERO,s=n.Env.ZERO;return u.setValue("LineNetAmt",h*c),l=t.getValueOfInt(u.getValue("C_Tax_ID")),v="select rate from c_tax WHERE c_tax_id="+l+"",a=t.getValueOfDecimal(n.DB.executeScalar(v,null,null)),y=t.getValueOfDecimal(u.getValue("LineNetAmt")),s=t.getValueOfDecimal(t.getValueOfDecimal(y)*t.getValueOfDecimal(a)/100),s=s.toFixed(2),u.setValue("taxamt",s),u.setValue("GrandTotal",h*c+t.getValueOfDecimal(u.getValue("TaxAmt"))),i=r=u=f=e=o=null,""};n.Model.CalloutContractQty=s;n.Utility.inheritPrototype(r,n.CalloutEngine);r.prototype.DocType=function(i,r,u,f,o,s){var ot="O",st="S",ot="O",st="S",ut="F",nt="PR",b="WR",y="",d,g,w,tt,it,a,ft,l,p,h,et;try{if(o==null||o.toString()==""||(d=o,d==null||d==0))return"";if(g=u.getValue("DocumentNo"),w=g==null,!w&&g.toString().startsWith("<")&&g.toString().endsWith(">")&&(w=!0),tt=u.getValue("C_DocType_ID"),y="SELECT d.DocSubTypeSO,d.HasCharges,'N',d.IsDocNoControlled,s.CurrentNext,s.CurrentNextSys,s.AD_Sequence_ID,d.IsSOTrx, d.IsReturnTrx FROM C_DocType d LEFT OUTER JOIN AD_Sequence s ON (d.DocNoSequence_ID=s.AD_Sequence_ID) WHERE C_DocType_ID=",it=0,a=null,w||tt==0)y=y+d,a=n.DB.executeDataset(y,null);else for(y=y+tt,a=n.DB.executeDataset(y,null),l=0;l<a.getTables()[0].rows.count;l++)it=t.getValueOfInt(a.getRows()[l].getCell("AD_Sequence_ID"));var v="",k=!0,rt=!1;for(l=0;l<a.getTables()[0].rows.count;l++)if(v=t.getValueOfString(a.getRows()[l].getCell("DocSubTypeSO")),v==null&&(v="--"),i.setContext(r,"OrderType",v),v.toString().equals("SO")||u.setValue("IsDropShip","N"),"N".toString().equals(t.getValueOfString(a.getRows()[l].getCell("IsSOTrx")))&&(k=!1),rt="Y".toString().equals(t.getValueOfString(a.getRows()[l].getCell("IsReturnTrx"))),rt?v.toString().equals(b)?u.setValue("DeliveryRule",ut):u.setValue("DeliveryRule","M"):(v.toString().equals(b)?u.setValue("DeliveryRule",ut):v.toString().equals(nt)?u.setValue("DeliveryRule","R"):u.setValue("DeliveryRule","A"),v.toString().equals(b)||v.toString().equals(nt)||v.toString().equals("WI")?u.setValue("InvoiceRule","I"):u.setValue("InvoiceRule","D"),v.toString().equals(b)?u.setValue("PaymentRule",PAYMENTRULE_Cash):u.setValue("PaymentRule",PAYMENTRULE_OnCredit),i.setContext(r,"HasCharges",t.getValueOfString(a.getRows()[l].getCell("HasCharges")))),p[3].toString().equals("Y")&&(w||it==t.getValueOfInt(a.getRows()[l].getCell("AD_Sequence_ID"))||(w=!0),w))try{u.setValue("DocumentNo","<"+t.getValueOfString(a.getRows()[l].getCell("CurrentNext"))+">")}catch(ht){this.setCalloutActive(!1)}if(rt)return"";if(!v.toString().equals(b)&&!v.toString().equals(nt))for(ft=i.getContextAsInt(r,"C_BPartner_ID"),y="SELECT PaymentRule,C_PaymentTerm_ID,InvoiceRule,DeliveryRule,FreightCostRule,DeliveryViaRule, PaymentRulePO,PO_PaymentTerm_ID FROM C_BPartner WHERE C_BPartner_ID="+ft,a=n.DB.executeDataset(y,null),l=0;l<a.getTables()[0].rows.count;l++)p=a.getTables()[0].rows[l],h=t.getValueOfString(p.get(k?"paymentrule":"paymentrulepo")),h!=null&&h.toString().length!=0&&(k&&(h.toString().equals("B")||h.toString().equals("S")||h.toString().equals("U"))&&(h="P"),!k&&h.toString().equals("B")&&(h="P"),u.setValue("PaymentRule",h)),et=t.getValueOfInt(p.get(k?"c_paymentterm_id":"po_paymentterm_id")),p!=null&&u.setValue("C_PaymentTerm_ID",et),h=p[2].toString(),h!=null&&h.length!=0&&u.setValue("InvoiceRule",h),h=p[3].toString(),h!=null&&h.length!=0&&u.setValue("DeliveryRule",h),h=p[4].toString(),h!=null&&h.length!=0&&u.setValue("FreightCostRule",h),h=p[5].toString(),h!=null&&h.length!=0&&u.setValue("DeliveryViaRule",h)}catch(ht){return this.setCalloutActive(!1),this.log.log(c.SEVERE,y,ht),e.message}return i=r=u=f=o=s=null,""};r.prototype.BPartner=function(i,r,u,f,o,s){var et="O",ot="S",et="O",ot="S",k="",a,rt,v,d,b,l,y,g,p,nt,w,tt,ut,ft,h,it;try{if(o==null||o.toString()==""||(a=0,o!=null&&(a=t.getValueOfInt(o.toString())),a==0)||(rt=u.getValue("IsReturnTrx"),rt))return"";for(this.setCalloutActive(!0),k="SELECT p.AD_Language,p.C_PaymentTerm_ID, COALESCE(p.M_PriceList_ID,g.M_PriceList_ID) AS M_PriceList_ID, p.PaymentRule,p.POReference, p.SO_Description,p.IsDiscountPrinted, p.InvoiceRule,p.DeliveryRule,p.FreightCostRule,DeliveryViaRule, p.SO_CreditLimit, p.SO_CreditLimit-p.SO_CreditUsed AS CreditAvailable, lship.C_BPartner_Location_ID,c.AD_User_ID, COALESCE(p.PO_PriceList_ID,g.PO_PriceList_ID) AS PO_PriceList_ID, p.PaymentRulePO,p.PO_PaymentTerm_ID, lbill.C_BPartner_Location_ID AS Bill_Location_ID, p.SOCreditStatus, lbill.IsShipTo FROM C_BPartner p INNER JOIN C_BP_Group g ON (p.C_BP_Group_ID=g.C_BP_Group_ID) LEFT OUTER JOIN C_BPartner_Location lbill ON (p.C_BPartner_ID=lbill.C_BPartner_ID AND lbill.IsBillTo='Y' AND lbill.IsActive='Y') LEFT OUTER JOIN C_BPartner_Location lship ON (p.C_BPartner_ID=lship.C_BPartner_ID AND lship.IsShipTo='Y' AND lship.IsActive='Y') LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID="+a+" AND p.IsActive='Y'",v=i.getWindowContext(r,"IsSOTrx",!0)=="Y",d=n.DB.executeDataset(k,null),b=0;b<d.getTables()[0].rows.count;b++)l=d.getTables()[0].rows[b],y=t.getValueOfInt(l.get(v?"m_pricelist_id":"po_pricelist_id")),l!=null&&y!=0&&u.setValue("M_PriceList_ID",y),u.setValue("Bill_BPartner_ID",a),g=t.getValueOfInt(l.get("bill_location_id")),g==0?u.setValue("Bill_Location_ID",null):u.setValue("Bill_Location_ID",g),p=t.getValueOfInt(l.get("c_bpartner_location_id")),a.toString().equals(i.getContext("C_BPartner_ID"))&&(nt=i.getContext("C_BPartner_Location_ID"),nt.toString().length>0&&(p=int.Parse(nt))),p==0?u.setValue("C_BPartner_Location_ID",null):(u.setValue("C_BPartner_Location_ID",p),"Y".toString().equals(t.getValueOfString(l.get("isshipto")))&&u.setValue("Bill_Location_ID",p)),w=t.getValueOfInt(l.get("ad_user_id").toString()),a.toString().toString().equals(i.getContext("C_BPartner_ID"))&&(tt=i.getContext("AD_User_ID"),tt.toString().length>0&&(w=t.getValueOfInt(tt))),w==0?u.setValue("AD_User_ID",null):(u.setValue("AD_User_ID",w),u.setValue("Bill_User_ID",w)),v&&(ut=t.getValueOfDouble(l.get("so_creditlimit")),ut!=0&&(ft=t.getValueOfDouble(l.get("creditavailable")),l!=null&&ft<0)),h=l.get("poreference").toString(),h!=null&&h.toString().length!=0&&u.setValue("POReference",h),h=t.getValueOfString(l.get("so_description")),h!=null&&h.toString().trim().length!=0&&u.setValue("Description",h),h=t.getValueOfString(l.get("isdiscountprinted")),h!=null&&h.toString().length!=0?u.setValue("IsDiscountPrinted",h):u.setValue("IsDiscountPrinted","N"),it=i.getContext("OrderType"),u.setValue("InvoiceRule","D"),u.setValue("DeliveryRule","A"),u.setValue("PaymentRule",PAYMENTRULE_OnCredit),it.toString().equals("PR")?(u.setValue("InvoiceRule","I"),u.setValue("DeliveryRule","R")):it.toString().equals(MOrder.DocSubTypeSO_POS)?u.setValue("PaymentRule",PAYMENTRULE_Cash):(h=l[v?"PaymentRule":"PaymentRulePO"].toString(),h!=null&&h.length!=0&&(h.toString().equals("B")&&(h="P"),v&&(h.toString().equals("S")||h.toString().equals("U"))&&(h="P"),u.setValue("PaymentRule",h)),y=t.getValueOfInt(l.get(v?"c_paymentterm_id":"po_paymentterm_id")),l!=null&&y!=0&&u.setValue("C_PaymentTerm_ID",y),h=t.getValueOfString(l.get("invoicerule")),h!=null&&h.length!=0&&u.setValue("InvoiceRule",h),h=t.getValueOfString(l.get("deliveryrule")),h!=null&&h.length!=0&&u.setValue("DeliveryRule",h),h=t.getValueOfString(l.get("freightcostrule")),h!=null&&h.length!=0&&u.setValue("FreightCostRule",h),h=t.getValueOfString(l.get("deliveryviarule")),h!=null&&h.length!=0&&u.setValue("DeliveryViaRule",h))}catch(st){return this.log.log(c.SEVERE,k,st),this.setCalloutActive(!1),e.message}return this.setCalloutActive(!1),i=r=u=f=o=s=null,""};r.prototype.Product=function(i,r,e,o,s){var c,k,ot,a,p,l,nt,y,w,ut;if(s==null||s.toString()=="")return"";try{if((c=s,c==null||c==0)||(k="Y".toString().equals(i.getContext("IsReturnTrx")),k))return"";this.setCalloutActive(!0);f&&this.log.warning("init");e.setValue("C_Charge_ID",null);e.setValue("M_AttributeSetInstance_ID",null);var ft=i.getContextAsInt(r,"C_BPartner_ID"),et=t.getValueOfDecimal(e.getValue("QtyEntered")),d=i.getWindowContext(r,"IsSOTrx",!0)=="Y",g=i.getContextAsInt(r,"M_PriceList_ID"),b=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",g.toString());b==0&&(b=i.getContextAsInt(r,"M_PriceList_Version_ID"));ot=e.getValue("DateOrdered");a="SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'";u=t.getValueOfInt(n.DB.executeScalar(a));p=0;u>0&&(a="SELECT C_UOM_ID FROM M_Product_PO WHERE IsActive = 'Y' AND  C_BPartner_ID = "+t.getValueOfInt(e.getValue("C_BPartner_ID"))+" AND M_Product_ID = "+c,p=t.getValueOfInt(n.DB.executeScalar(a)),p>0&&d==!1?e.setValue("C_UOM_ID",p):(a="SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_Product_ID = "+c,e.setValue("C_UOM_ID",t.getValueOfInt(n.DB.executeScalar(a)))));var st=t.getValueOfInt(e.getValue("C_UOM_ID")),l=c.toString().concat(",",ft.toString(),",",et.toString(),",",d,",",g.toString(),",",b.toString(),",",null,",",null,",",null,",",st,",",u),h=null;if(h=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",l),e.setValue("PriceList",h.PriceList),e.setValue("PriceLimit",h.PriceLimit),e.setValue("PriceActual",h.PriceActual),e.setValue("PriceEntered",h.PriceEntered),t.getValueOfInt(h.C_Currency_ID)>0&&e.setValue("C_Currency_ID",t.getValueOfInt(h.C_Currency_ID)),e.setValue("Discount",h.Discount),e.setValue("C_UOM_ID",t.getValueOfInt(h.C_UOM_ID)),e.setValue("QtyOrdered",e.getValue("QtyEntered")),i.setContext(r,"EnforcePriceLimit",h.IsEnforcePriceLimit?"Y":"N"),i.setContext(r,"DiscountSchema",h.IsDiscountSchema?"Y":"N"),i.getWindowContext(r,"IsSOTrx",!0)=="Y"&&(l=c.toString()+",0",nt=n.dataContext.getJSONRecord("MProduct/GetProduct",l),nt)){var tt=t.getValueOfDecimal(e.getValue("QtyEntered")),it=i.getContextAsInt(r,"M_Warehouse_ID"),rt=i.getContextAsInt(r,"M_AttributeSetInstance_ID"),l=it+","+c+","+rt,v=n.dataContext.getJSONRecord("MStorage/GetQtyAvailable",l);v==null&&(v=n.Env.ZERO);v==0||v.toString().compareTo(tt)<0||(y=0,e.getValue("C_OrderLine_ID")!=null&&(y=t.getValueOfInt(e.getValue("C_OrderLine_ID"))),y==null&&(y=0),l=it.toString()+","+c.toString()+","+rt.toString()+","+y.toString(),w=t.getValueOfDecimal(n.dataContext.getJSONRecord("MOrderLine/GetNotReserved",l)),w==null&&(w=n.Env.ZERO),ut=v-w,ut.toString().compareTo(tt)<0)}this.setCalloutActive(!1);f&&this.log.warning("fini")}catch(ht){this.setCalloutActive(!1)}return this.Tax(i,r,e,o,s)};r.prototype.Tax=function(i,r,u,f,e){var o=0,s=n.Env.ZERO,h=n.Env.ZERO,a="",c,l;return o=t.getValueOfInt(u.getValue("C_Tax_ID")),c="select rate from c_tax WHERE c_tax_id="+o+"",s=t.getValueOfDecimal(n.DB.executeScalar(c,null,null)),a=this.Amt(i,r,u,f,e),l=t.getValueOfDecimal(u.getValue("LineNetAmt")),h=t.getValueOfDecimal(t.getValueOfDecimal(l)*t.getValueOfDecimal(s)/100),u.setValue("taxamt",h),this.Amt(i,r,u,f,e)};r.prototype.Amt=function(i,r,e,o,s,h){var ot,v,ft,it,nt,rt,g;if(this.isCalloutActive()||s==null||s.toString()=="")return"";this.setCalloutActive(!0);try{f&&this.log.warning("init");var d=i.getContextAsInt(r,"C_UOM_ID"),p=i.getContextAsInt(r,"M_Product_ID"),ut=i.getContextAsInt(r,"M_PriceList_ID"),ht=ut.toString(),y=n.dataContext.getJSONRecord("MPriceList/GetPriceList",ht),tt=t.getValueOfInt(y.StdPrecision),k,c,l,w,a,b;if(k=t.getValueOfDecimal(e.getValue("QtyEntered")),k=t.getValueOfDecimal(e.getValue("QtyEntered")),this.log.fine("QtyEntered="+k+", Ordered="+k+", UOM="+d),c=t.getValueOfDecimal(e.getValue("PriceEntered")),l=t.getValueOfDecimal(e.getValue("PriceActual")),a=t.getValueOfDecimal(e.getValue("Discount")),w=t.getValueOfDecimal(e.getValue("PriceLimit")),b=t.getValueOfDecimal(e.getValue("PriceList")),this.log.fine("PriceList="+b+", Limit="+w+", Precision="+tt),this.log.fine("PriceEntered="+c+", Actual="+l+", Discount="+a),(o.getColumnName().toString().equals("QtyEntered")||o.getColumnName().toString().equals("QtyEntered")||o.getColumnName().toString().equals("M_Product_ID"))&&!"N".toString().equals(i.getContext("DiscountSchema"))){ot=i.getContextAsInt(r,"C_BPartner_ID");o.getColumnName().toString().equals("QtyEntered")&&(v=p.toString()+","+d.toString()+","+k.toString(),k=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",v)));ft=i.getWindowContext(r,"IsSOTrx",!0)=="Y";it=n.dataContext.getJSONRecord("MPriceListVersion/GetM_PriceList_Version_ID",ut.toString());it==0&&(it=i.getContextAsInt(r,"M_PriceList_Version_ID"));nt="SELECT COUNT(AD_MODULEINFO_ID) FROM AD_MODULEINFO WHERE PREFIX='ED011_'";u=t.getValueOfInt(n.DB.executeScalar(nt));rt=0;u>0&&(nt="SELECT C_UOM_ID FROM M_Product_PO WHERE IsActive = 'Y' AND  C_BPartner_ID = "+t.getValueOfInt(e.getValue("C_BPartner_ID"))+" AND M_Product_ID = "+p,rt=t.getValueOfInt(n.DB.executeScalar(nt)),rt>0&&ft==!1?e.setValue("C_UOM_ID",rt):(nt="SELECT C_UOM_ID FROM M_Product WHERE IsActive = 'Y' AND M_Product_ID = "+p,e.setValue("C_UOM_ID",t.getValueOfInt(n.DB.executeScalar(nt)))));var ct=t.getValueOfInt(e.getValue("C_UOM_ID")),v=p.toString().concat(",",ot.toString(),",",k.toString(),",",ft,",",ut.toString(),",",it.toString(),",",null,",",null,",",null,",",ct,",",u),y=null;y=n.dataContext.getJSONRecord("MProductPricing/GetProductPricing",v);v=p.toString()+","+d.toString()+","+y.PriceStd.toString();c=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",v));(c==null||c==0)&&(c=y.PriceStd);this.log.fine("QtyChanged -> PriceActual="+y.PriceStd+", PriceEntered="+c+", Discount="+y.Discount);l=y.PriceStd;e.setValue("PriceActual",y.PriceActual);e.setValue("Discount",y.Discount);e.setValue("PriceEntered",y.PriceEntered);i.setContext(r,"DiscountSchema",y.DiscountSchema?"Y":"N")}else o.getColumnName().toString().equals("PriceActual")?(l=t.getValueOfDecimal(s),v=p.toString()+","+d.toString()+","+l.toString(),c=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",v)),(c==null||c==0)&&(c=l),this.log.fine("PriceActual="+l+" -> PriceEntered="+c),e.setValue("PriceEntered",c)):o.getColumnName().toString().equals("PriceEntered")&&(c=t.getValueOfDecimal(s),v=p.toString()+","+d.toString()+","+c.toString(),l=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",v)),(l==null||c==0)&&(l=c),this.log.fine("PriceEntered="+c+" -> PriceActual="+l),e.setValue("PriceActual",l));o.getColumnName().toString().equals("Discount")?(l=t.getValueOfDecimal((100-t.getValueOfDouble(a))/100*t.getValueOfDouble(b)),t.scale(l)>tt&&(l=l.toFixed(tt)),v=p.toString()+","+d.toString()+","+l.toString(),c=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",v)),(c==null||c==0)&&(c=l),e.setValue("PriceActual",l),e.setValue("PriceEntered",c)):(a=b==0?n.Env.ZERO:t.getValueOfDecimal((b-l)/b*100),t.scale(a)>2&&(a=a.toFixed(2)),e.setValue("Discount",a));this.log.fine("PriceEntered="+c+", Actual="+l+", Discount="+a);var st=i.getContext("EnforcePriceLimit"),et=i.getWindowContext(r,"IsSOTrx",!0)=="Y"&&st!=null&&st.toString().equals("Y"),lt="Y".toString().equals(i.getContext("IsReturnTrx"));et&&(n.MRole.getDefault().IsOverwritePriceLimit()||lt)&&(et=!1);et&&t.getValueOfDouble(w)!=0&&l.toString().compare(w)<0&&(l=w,v=p.toString()+","+d.toString()+","+w.toString(),c=t.getValueOfDecimal(n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",v)),(c==null||c==0)&&(c=w),this.log.fine("(under) PriceEntered="+c+", Actual"+w),e.setValue("PriceActual",w),e.setValue("PriceEntered",c),n.ADialog.info("UnderLimitPrice"),b!=0&&(a=t.getValueOfDecimal((b-l)/b*100),t.scale(a)>2&&(a=a.toFixed(2)),e.setValue("Discount",a)));g=k*l;t.scale(g)>tt&&(g=g.toFixed(tt));this.log.info("LineNetAmt="+g);e.setValue("LineNetAmt",g);e.setValue("GrandTotal",t.getValueOfDecimal(e.getValue("TaxAmt"))+g)}catch(at){}return this.setCalloutActive(!1),i=r=e=o=s=h=null,""};n.Model.CalloutOrderContract=r;n.Utility.inheritPrototype(h,n.CalloutEngine);h.prototype.SetContract=function(t,i,r,u,f){if(this.isCalloutActive()||f==null||f.toString()=="")return"";this.setCalloutActive(!0);try{var e=t.getContextAsInt(i,"M_Product_ID"),o=e.toString().concat(","),s=n.dataContext.getJSONRecord("MProduct/GetProductType",o);s=="S"?r.getField("IsContract").setReadOnly(!1):(r.getValue("IsContract",!1),r.getField("IsContract").setReadOnly(!0))}catch(h){this.log.severe(h.toString())}return this.setCalloutActive(!1),""};n.Model.CalloutSetContract=h}(VIS,jQuery),function(n){function i(){n.CalloutEngine.call(this,"VIS.CalloutInOut")}var r=n.Logging.Level,t=n.Utility.Util;n.Utility.inheritPrototype(i,n.CalloutEngine);i.prototype.Order=function(i,r,u,f,e,o){var h,c,s,l;if(e==null||e.toString()=="")return"";try{if((h=t.getValueOfInt(e.toString()),h==null||h==0)||this.isCalloutActive())return"";c=h.toString();s=n.dataContext.getJSONRecord("MOrder/GetOrder",c);t.getValueOfInt(s.ID)!=0&&(u.setValue("DateOrdered",s.DateOrdered),u.setValue("POReference",s.POReference),u.setValue("AD_Org_ID",t.getValueOfInt(s.AD_Org_ID)),u.setValue("DeliveryRule",s.DeliveryRule),u.setValue("DeliveryViaRule",s.DeliveryViaRule),u.setValue("M_Shipper_ID",t.getValueOfInt(s.M_Shipper_ID)),u.setValue("FreightCostRule",s.FreightCostRule),u.setValue("FreightAmt",s.FreightAmt),u.setValue("C_BPartner_ID",t.getValueOfInt(s.C_BPartner_ID)),u.setValue("C_BPartner_Location_ID",t.getValueOfInt(s.C_BPartner_Location_ID)),u.setValue("AD_OrgTrx_ID",t.getValueOfInt(s.AD_OrgTrx_ID)),u.setValue("C_Activity_ID",t.getValueOfInt(s.C_Activity_ID)),u.setValue("C_Campaign_ID",t.getValueOfInt(s.C_Campaign_ID)),u.setValue("C_Project_ID",t.getValueOfInt(s.C_Project_ID)),u.setValue("User1_ID",t.getValueOfInt(s.User1_ID)),u.setValue("User2_ID",t.getValueOfInt(s.User2_ID)),u.getField("C_IncoTerm_ID")!=null&&u.setValue("C_IncoTerm_ID",t.getValueOfInt(s.C_IncoTerm_ID)),l=u.getValue("IsReturnTrx"),l&&(u.setValue("Orig_Order_ID",s.Orig_Order_ID),u.setValue("Orig_InOut_ID",s.Orig_InOut_ID),t.getValueOfString(s.IsDropShip)=="Y"?u.setValue("IsDropShip",!0):u.setValue("IsDropShip",!1)),u.setValue("M_Warehouse_ID",t.getValueOfInt(s.M_Warehouse_ID)))}catch(a){this.setCalloutActive(!1);this.log.severe(a.toString())}return i=r=u=f=e=o=null,""};i.prototype.DocType=function(i,u,f,e,o,s){var c,v,h,l,a;if(o==null||o.toString()==""||(c=t.getValueOfInt(o.toString()),c==null||c==0))return"";v="SELECT d.docBaseType, d.IsDocNoControlled, s.CurrentNext, d.IsReturnTrx FROM C_DocType d, AD_Sequence s WHERE C_DocType_ID="+c+" AND d.DocNoSequence_ID=s.AD_Sequence_ID(+)";h=null;try{i.setContext(u,"C_DocTypeTarget_ID",c);h=n.DB.executeReader(v,null,null);h.read()&&(l=h.get("docbasetype"),a=h.get("isreturntrx")=="Y",l.equals("MMS")&&!a?f.setValue("MovementType","C-"):l.equals("MMS")&&a?f.setValue("MovementType","C+"):l.equals("MMR")&&!a?f.setValue("MovementType","V+"):l.equals("MMR")&&a&&f.setValue("MovementType","V-"),h.get("isdocnocontrolled")=="Y"&&f.setValue("DocumentNo","<"+h.get("currentnext")+">"));h.close()}catch(y){return this.setCalloutActive(!1),h!=null&&(h.close(),h=null),this.log.log(r.SEVERE,v,y),y.message}return i=u=f=e=o=s=null,""};i.prototype.BPartner=function(i,u,f,o,s,h){var v="",c=null,l=null,y,b,k,a,p,w,d;if(s==null||s.toString()=="")return"";try{if(y=t.getValueOfInt(s.toString()),y==null||y==0)return"";if(b=f.getValue("IsReturnTrx"),k=f.getValue("C_Order_ID"),v="SELECT p.AD_Language, p.POReference,p.CreditStatusSettingOn,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable,l.C_BPartner_Location_ID, c.AD_User_ID , p.SOCreditStatus FROM C_BPartner p LEFT OUTER JOIN C_BPartner_Location l ON (p.C_BPartner_ID=l.C_BPartner_ID) LEFT OUTER JOIN AD_User c ON (p.C_BPartner_ID=c.C_BPartner_ID) WHERE p.C_BPartner_ID="+y,c=n.DB.executeReader(v,null,null),c.read()&&(a=t.getValueOfInt(c.get("c_bpartner_location_id")),k==null&&(a==0?f.setValue("C_BPartner_Location_ID",null):f.setValue("C_BPartner_Location_ID",a)),a=t.getValueOfInt(c.get("ad_user_id")),a==0?f.setValue("AD_User_ID",null):f.setValue("AD_User_ID",a),!b))if(p=c.getString("CreditStatusSettingOn"),w=t.getValueOfDouble(c.get("creditavailable")),p=="CH")c.get("SOCreditStatus")!=null&&(c.get("SOCreditStatus").equals("X")||w<=0&&n.ADialog.info("CreditLimitOver"));else if(d=t.getValueOfInt(f.getValue("C_BPartner_Location_ID")),v="SELECT bp.CreditStatusSettingOn,p.SOCreditStatus,p.SO_CreditLimit, NVL(p.SO_CreditLimit,0) - NVL(p.SO_CreditUsed,0) AS CreditAvailable FROM C_BPartner_Location p INNER JOIN C_BPartner bp ON (bp.C_BPartner_ID = p.C_BPartner_ID) WHERE p.C_BPartner_Location_ID = "+d,l=n.DB.executeReader(v),l.read()&&(p=l.getString("CreditStatusSettingOn"),p=="CL")){var nt=t.getValueOfDouble(l.get("so_creditlimit")),w=t.getValueOfDouble(l.get("creditavailable")),g=dr.getString("SOCreditStatus");g!=null&&(g.equals("X")||w<=0&&n.ADialog.info("CreditOver"))}c.close()}catch(tt){return this.setCalloutActive(!1),c!=null&&(c.close(),c=null),l!=null&&(l.close(),l=null),this.log.log(r.SEVERE,v,e),e.message}return i=u=f=o=s=h=null,""};i.prototype.Warehouse=function(i,u,f,e,o,s){var l,a,h,c,v;if(o==null||o.toString()==""||this.isCalloutActive()||(l=t.getValueOfInt(o),l==null||l==0))return"";this.setCalloutActive(!0);a="SELECT w.AD_Org_ID, l.M_Locator_ID FROM M_Warehouse w LEFT OUTER JOIN M_Locator l ON (l.M_Warehouse_ID=w.M_Warehouse_ID AND l.IsDefault='Y') WHERE w.M_Warehouse_ID="+l;h=null;try{h=n.DB.executeReader(a,null,null);h.read()&&(c=t.getValueOfInt(h.get("ad_org_id")),v=i.getContextAsInt(u,"AD_Org_ID"),v!=c&&f.setValue("AD_Org_ID",c),c=t.getValueOfInt(h.get("m_locator_id")),c==0?i.setContext(u,0,"M_Locator_ID",null):(this.log.config("M_Locator_ID="+c),i.setContext(u,"M_Locator_ID",c)));h.close()}catch(y){return this.setCalloutActive(!1),h!=null&&(h.close(),h=null),this.log.log(r.SEVERE,a,y),this.setCalloutActive(!1),y.message}return this.setCalloutActive(!1),i=u=f=e=o=s=null,""};i.prototype.OrderLine=function(i,r,u,f,e,o){var c,s,a,l,h,v;if(e==null||e.toString()=="")return"";if(this.setCalloutActive(!0),c=t.getValueOfInt(e.toString()),c==null||c==0)return this.setCalloutActive(!1),"";try{h=c.toString();s=n.dataContext.getJSONRecord("MOrderLine/GetOrderLine",h);t.getValueOfInt(s.GetID)!=0&&(u.setValue("M_Product_ID",t.getValueOfInt(s.M_Product_ID)),u.setValue("M_AttributeSetInstance_ID",t.getValueOfInt(s.M_AttributeSetInstance_ID)),u.setValue("C_UOM_ID",t.getValueOfInt(s.C_UOM_ID)),a=t.getValueOfDecimal(s.QtyOrdered)-t.getValueOfDecimal(s.QtyDelivered),u.setValue("MovementQty",a),l=a,t.getValueOfDecimal(s.QtyEntered).toString().compareTo(t.getValueOfDecimal(s.QtyOrdered))!=t.getValueOfDecimal(s.QtyOrdered)&&(l=l*t.getValueOfDecimal(s.QtyEntered)/t.getValueOfDecimal(s.QtyOrdered).toFixed(12)),u.setValue("QtyEntered",l),u.setValue("C_Activity_ID",t.getValueOfInt(s.C_Activity_ID)),u.setValue("C_Campaign_ID",t.getValueOfInt(s.C_Campaign_ID)),u.setValue("C_Project_ID",t.getValueOfInt(s.C_Project_ID)),u.setValue("C_ProjectPhase_ID",t.getValueOfInt(s.C_ProjectPhase_ID)),u.setValue("C_ProjectTask_ID",t.getValueOfInt(s.C_ProjectTask_ID)),u.setValue("AD_OrgTrx_ID",t.getValueOfInt(s.AD_OrgTrx_ID)),u.setValue("User1_ID",t.getValueOfInt(s.User1_ID)),u.setValue("User2_ID",t.getValueOfInt(s.User2_ID)),t.getValueOfBoolean(s.IsReturnTrx)&&(u.setValue("Orig_OrderLine_ID",t.getValueOfInt(s.Orig_OrderLine_ID)),h=s.Orig_InOutLine_ID,v=n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine",h),u.setValue("M_Locator_ID",v.M_Locator_ID)),t.getValueOfString(s.IsDropShip)=="Y"?u.setValue("IsDropShip",!0):u.setValue("IsDropShip",!1))}catch(y){this.setCalloutActive(!1);this.log.severe(y.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.Product=function(i,r,u,f,e,o){var h,w,a,v,s,y,l,p;if(this.isCalloutActive()||e==null||e.toString()==""||(h=t.getValueOfInt(e),h==0))return"";this.setCalloutActive(!0);try{if(w=0,u.setValue("M_AttributeSetInstance_ID",null),a=i.getWindowContext(r,"IsSOTrx",!0)=="Y",a)return this.setCalloutActive(!1),"";v=h.toString();s=n.dataContext.getJSONRecord("MProduct/GetC_UOM_ID",v);u.setValue("C_UOM_ID",s);y=t.getValueOfDecimal(u.getValue("QtyEntered"));u.setValue("MovementQty",y);var b="SELECT C_BPartner_ID FROM M_InOut WHERE M_InOut_ID = "+t.getValueOfInt(u.getValue("M_InOut_ID")),k=t.getValueOfInt(n.DB.executeScalar(b)),d="SELECT vdr.C_UOM_ID FROM M_Product p LEFT JOIN M_Product_Po vdr ON p.M_Product_ID= vdr.M_Product_ID WHERE p.M_Product_ID="+h+" AND vdr.C_BPartner_ID = "+k,c=t.getValueOfInt(n.DB.executeScalar(d));s!=0&&(s!=c&&c!=0?(l=t.getValueOfDecimal(n.DB.executeScalar("SELECT trunc(multiplyrate,4) FROM C_UOM_Conversion WHERE C_UOM_ID = "+s+" AND C_UOM_To_ID = "+c+" AND M_Product_ID= "+h+" AND IsActive='Y'")),l>0?u.setValue("QtyEntered",t.getValueOfInt(u.getValue("QtyEntered"))*l):(p=t.getValueOfDecimal(n.DB.executeScalar("SELECT trunc(multiplyrate,4) FROM C_UOM_Conversion WHERE C_UOM_ID = "+s+" AND C_UOM_To_ID = "+c+" AND IsActive='Y'")),p>0&&u.setValue("QtyEntered",t.getValueOfInt(u.getValue("QtyEntered"))*l)),u.setValue("C_UOM_ID",c)):u.setValue("C_UOM_ID",s))}catch(g){this.setCalloutActive(!1);this.log.severe(g.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};i.prototype.Qty=function(i,u,f,e,o,s){var y,c,h,l,w,p,b,v,nt,tt,k,d,a;if(this.isCalloutActive()||o==null||o.toString()=="")return"";this.setCalloutActive(!0);try{if(y=i.getContextAsInt(u,"M_Product_ID"),this.log.log(r.WARNING,"qty - init - M_Product_ID="+y),l="",w=0,y==0?(h=t.getValueOfDecimal(f.getValue("QtyEntered")),f.setValue("MovementQty",h)):e.getColumnName().toString().equals("C_UOM_ID")?(a=o,h=t.getValueOfDecimal(f.getValue("QtyEntered")),l=a.toString(),w=n.dataContext.getJSONRecord("MUOM/GetPrecision",l),p=h.toFixed(w),h.toString().compareTo(p)!=0&&(this.log.fine("Corrected qtyEntered Scale UOM="+a+"; qtyEntered="+h+"->"+p),h=p,f.setValue("QtyEntered",h)),l=y.toString().concat(",",a.toString(),",",h.toString()),c=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",l),c==null&&(c=h),v=h.compareTo(c)!=0,this.log.fine("UOM="+a+", qtyEntered="+h+" -> "+v+" movementQty="+c),i.setContext(u,"UOMConversion",v?"Y":"N"),f.setValue("MovementQty",c)):i.getContextAsInt(u,"C_UOM_ID")==0?(h=t.getValueOfDecimal(f.getValue("QtyEntered")),f.setValue("MovementQty",h)):e.getColumnName().toString().equals("QtyEntered")?(a=i.getContextAsInt(u,"C_UOM_ID"),h=t.getValueOfDecimal(o),l=y.toString(),w=n.dataContext.getJSONRecord("MProduct/GetUOMPrecision",l),p=h.toFixed(w),h.compareTo(p)!=0&&(this.log.fine("Corrected qtyEntered Scale UOM="+a+"; qtyEntered="+h+"->"+p),h=p,f.setValue("QtyEntered",h)),l=y.toString().concat(",",a.toString(),",",h.toString()),c=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductFrom",l),c==null&&(c=h),v=h.compareTo(c)!=0,this.log.fine("UOM="+a+", qtyEntered="+h+" -> "+v+" movementQty="+c),i.setContext(u,"UOMConversion",v?"Y":"N"),f.setValue("MovementQty",c)):e.getColumnName().toString().equals("MovementQty")&&(a=i.getContextAsInt(u,"C_UOM_ID"),c=t.getValueOfDecimal(o),l=y.toString(),w=n.dataContext.getJSONRecord("MProduct/GetUOMPrecision",l),b=c.toFixed(w),c.compareTo(b)!=0&&(this.log.fine("Corrected movementQty "+c+"->"+b),c=b,f.setValue("MovementQty",c)),l=y.toString().concat(",",a.toString(),",",c.toString()),h=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",l),h==null&&(h=c),v=c.compareTo(h)!=0,this.log.fine("UOM="+a+", movementQty="+c+" -> "+v+" qtyEntered="+h),i.setContext(u,"UOMConversion",v?"Y":"N"),f.setValue("QtyEntered",h)),nt="Y".equals(i.getContext("IsReturnTrx")),y!=0&&nt&&(tt=t.getValueOfInt(f.getValue("C_OrderLine_ID")),l=tt.toString(),k=n.dataContext.getJSONRecord("MOrderLine/GetOrderLine",l),k.Get_ID()!=0&&(d=k.tOrig_InOutLine_ID,d!=0))){var l=d.toString(),it=n.dataContext.getJSONRecord("MInOutLine/GetMInOutLine",l),g=it.MovementQty;c=t.getValueOfDecimal(f.getValue("MovementQty"));g.toString().compareTo(c)<0&&(i.getWindowContext(u,"IsSOTrx",!0)=="Y"?n.ADialog.info("QtyShippedAndReturned"):n.ADialog.info("QtyRecievedAndReturnd"),f.setValue("MovementQty",g),c=g,a=i.getContextAsInt(u,"C_UOM_ID"),l=y.toString().concat(",",a.toString(),",",c.toString()),h=n.dataContext.getJSONRecord("MUOMConversion/ConvertProductTo",l),h==null&&(h=c),f.setValue("QtyEntered",h),f.setValue("MovementQty",c),this.log.fine("qtyEntered : "+h.toString()+"movementQty : "+c.toString()))}}catch(rt){this.setCalloutActive(!1);this.log.severe(rt.toString())}return this.setCalloutActive(!1),i=u=f=e=o=s=null,""};i.prototype.Asi=function(i,r,u,f,e,o){var s;if(this.isCalloutActive()||e==null||e.toString()==""||(s=t.getValueOfInt(e),s==null||s==0))return"";this.setCalloutActive(!0);try{var l=i.getContextAsInt(r,"M_Product_ID"),c=i.getContextAsInt(r,"M_Warehouse_ID"),h=n.dataContext.getJSONRecord("MinOut/GetWHLocator",c.toString()),a=i.getContextAsInt(r,"M_Locator_ID");a==0&&(u.setValue("M_Locator_ID",h),i.setContext(r,"M_Locator_ID",h));this.log.fine("M_Product_ID="+l+", M_ASI_ID="+s+" - M_Warehouse_ID="+c+", M_Locator_ID="+h)}catch(v){this.setCalloutActive(!1);this.log.severe(ex.toString())}return this.setCalloutActive(!1),i=r=u=f=e=o=null,""};n.Model.CalloutInOut=i}(VIS,jQuery)